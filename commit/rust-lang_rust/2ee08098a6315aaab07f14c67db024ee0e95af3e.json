{"sha": "2ee08098a6315aaab07f14c67db024ee0e95af3e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJlZTA4MDk4YTYzMTVhYWFiMDdmMTRjNjdkYjAyNGVlMGU5NWFmM2U=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-28T12:52:21Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-28T12:52:21Z"}, "message": "opt-in jemalloc", "tree": {"sha": "daa75c52c641577945c44b0d4f9838772341988f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/daa75c52c641577945c44b0d4f9838772341988f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2ee08098a6315aaab07f14c67db024ee0e95af3e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2ee08098a6315aaab07f14c67db024ee0e95af3e", "html_url": "https://github.com/rust-lang/rust/commit/2ee08098a6315aaab07f14c67db024ee0e95af3e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2ee08098a6315aaab07f14c67db024ee0e95af3e/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3432c4366f578b4f0a9a6e0384292d72e43ebf03", "url": "https://api.github.com/repos/rust-lang/rust/commits/3432c4366f578b4f0a9a6e0384292d72e43ebf03", "html_url": "https://github.com/rust-lang/rust/commit/3432c4366f578b4f0a9a6e0384292d72e43ebf03"}], "stats": {"total": 26, "additions": 23, "deletions": 3}, "files": [{"sha": "cb8f01f78887ff31041a638bf8d520569a931b07", "filename": "ARCHITECTURE.md", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/2ee08098a6315aaab07f14c67db024ee0e95af3e/ARCHITECTURE.md", "raw_url": "https://github.com/rust-lang/rust/raw/2ee08098a6315aaab07f14c67db024ee0e95af3e/ARCHITECTURE.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/ARCHITECTURE.md?ref=2ee08098a6315aaab07f14c67db024ee0e95af3e", "patch": "@@ -184,7 +184,10 @@ To see logs from the language server, set `RUST_LOG=info` env variable. To see\n all communication between the server and the client, use\n `RUST_LOG=gen_lsp_server=debug` (this will print quite a bit of stuff).\n \n-There's `Status of rust-analyzer` command which prints common high-level debug info.\n+There's `rust-analyzer: status` command which prints common high-level debug\n+info. In particular, it prints info about memory usage of various data\n+structures, and, if compiled with jemalloc support (`cargo install --features\n+jemalloc`), the summary statistic about the heap.\n \n To run tests, just `cargo test`.\n "}, {"sha": "908899129fa45df47e2cbbc62ffb62bd20c9459b", "filename": "crates/ra_ide_api/Cargo.toml", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/2ee08098a6315aaab07f14c67db024ee0e95af3e/crates%2Fra_ide_api%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/2ee08098a6315aaab07f14c67db024ee0e95af3e/crates%2Fra_ide_api%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2FCargo.toml?ref=2ee08098a6315aaab07f14c67db024ee0e95af3e", "patch": "@@ -14,8 +14,9 @@ fst = \"0.3.1\"\n rustc-hash = \"1.0\"\n parking_lot = \"0.7.0\"\n unicase = \"2.2.0\"\n-jemallocator = \"0.1.9\"\n-jemalloc-ctl = \"0.2.0\"\n+\n+jemallocator = { version = \"0.1.9\", optional = true }\n+jemalloc-ctl = { version = \"0.2.0\", optional = true }\n \n ra_syntax = { path = \"../ra_syntax\" }\n ra_ide_api_light = { path = \"../ra_ide_api_light\" }\n@@ -26,3 +27,6 @@ test_utils = { path = \"../test_utils\" }\n \n [dev-dependencies]\n insta = \"0.5.1\"\n+\n+[features]\n+jemalloc = [ \"jemallocator\", \"jemalloc-ctl\" ]"}, {"sha": "51947e4ccd2faeac21455ec72f1af7c396012ef1", "filename": "crates/ra_ide_api/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2ee08098a6315aaab07f14c67db024ee0e95af3e/crates%2Fra_ide_api%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2ee08098a6315aaab07f14c67db024ee0e95af3e/crates%2Fra_ide_api%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Flib.rs?ref=2ee08098a6315aaab07f14c67db024ee0e95af3e", "patch": "@@ -61,6 +61,7 @@ pub use ra_db::{\n \n // We use jemalloc mainly to get heap usage statistics, actual performance\n // differnece is not measures.\n+#[cfg(feature = \"jemalloc\")]\n #[global_allocator]\n static ALLOC: jemallocator::Jemalloc = jemallocator::Jemalloc;\n "}, {"sha": "bd355dd781dad0346c7f17d530f8e1cc0dc3c037", "filename": "crates/ra_ide_api/src/status.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/2ee08098a6315aaab07f14c67db024ee0e95af3e/crates%2Fra_ide_api%2Fsrc%2Fstatus.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2ee08098a6315aaab07f14c67db024ee0e95af3e/crates%2Fra_ide_api%2Fsrc%2Fstatus.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fstatus.rs?ref=2ee08098a6315aaab07f14c67db024ee0e95af3e", "patch": "@@ -133,13 +133,22 @@ struct MemoryStats {\n }\n \n impl MemoryStats {\n+    #[cfg(feature = \"jemalloc\")]\n     fn current() -> MemoryStats {\n         jemalloc_ctl::epoch().unwrap();\n         MemoryStats {\n             allocated: Bytes(jemalloc_ctl::stats::allocated().unwrap()),\n             resident: Bytes(jemalloc_ctl::stats::resident().unwrap()),\n         }\n     }\n+\n+    #[cfg(not(feature = \"jemalloc\"))]\n+    fn current() -> MemoryStats {\n+        MemoryStats {\n+            allocated: Bytes(0),\n+            resident: Bytes(0),\n+        }\n+    }\n }\n \n impl fmt::Display for MemoryStats {"}, {"sha": "bb92747f2f0815aaed1b7152dfa87025ea4c3d1c", "filename": "crates/ra_lsp_server/Cargo.toml", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2ee08098a6315aaab07f14c67db024ee0e95af3e/crates%2Fra_lsp_server%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/2ee08098a6315aaab07f14c67db024ee0e95af3e/crates%2Fra_lsp_server%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2FCargo.toml?ref=2ee08098a6315aaab07f14c67db024ee0e95af3e", "patch": "@@ -34,3 +34,6 @@ ra_vfs = { path = \"../ra_vfs\" }\n [dev-dependencies]\n tempfile = \"3\"\n test_utils = { path = \"../test_utils\" }\n+\n+[features]\n+jemalloc = [ \"ra_ide_api/jemalloc\" ]"}]}