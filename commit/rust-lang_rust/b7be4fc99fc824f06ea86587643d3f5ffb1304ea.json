{"sha": "b7be4fc99fc824f06ea86587643d3f5ffb1304ea", "node_id": "C_kwDOAAsO6NoAKGI3YmU0ZmM5OWZjODI0ZjA2ZWE4NjU4NzY0M2QzZjVmZmIxMzA0ZWE", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-11-01T02:33:04Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-11-01T02:33:04Z"}, "message": "Rollup merge of #89929 - yuvaldolev:handle-submodule-checkout-more-gracefully, r=Mark-Simulacrum\n\nHandling submodule update failures more gracefully from x.py\n\nAddresses #80498\n\nHandling the case where x.py can't check out the right commit of a submodule, because the submodule has local edits that would be overwritten by the checkout, more gracefully.\nThe error is printed in detail, with some hints on how to revert the local changes to the submodule.", "tree": {"sha": "1f5da0781ca5f7f7375b0af8d92b4fbb32df88d7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1f5da0781ca5f7f7375b0af8d92b4fbb32df88d7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b7be4fc99fc824f06ea86587643d3f5ffb1304ea", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhf1HgCRBK7hj4Ov3rIwAAyWcIAIzLqqhdWEWGZ1p1azXHS8iN\nmywXreefWokHd+yPwxPCWAdkh2ea53txXewFqrO2+1VP4eyTPDK8o9hl2t7XiY7Q\nDOZHYuUlJHrGMfm07l2dAZn//Z3Nl5qFRzdkp8LvIdtIaCFytx8/L+s8J56LkeRV\nsN+QR/njyhu1TekjvA37WpzBBbyYAvQKK9H7WsGKW/mB2uQfOsFcNcBCSDf0d8PD\nIKCp8pX/z1OrSW0ZU/kvwhyQCJS59v56+9Pyxte1iQBkEnhNr9XBhLoxvPSCr166\n6XJ3OsInU5kx8RNYmJvk5O508oi6yoQp4cktJYVllN/WFcgkb1x12wh+Pvmow5Y=\n=QS/h\n-----END PGP SIGNATURE-----\n", "payload": "tree 1f5da0781ca5f7f7375b0af8d92b4fbb32df88d7\nparent c65400548a0c9d36d7372592fb64bc95f0f37066\nparent 95ae8687df49e5fb0004b2950241b7e8b66499a1\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1635733984 +0100\ncommitter GitHub <noreply@github.com> 1635733984 +0100\n\nRollup merge of #89929 - yuvaldolev:handle-submodule-checkout-more-gracefully, r=Mark-Simulacrum\n\nHandling submodule update failures more gracefully from x.py\n\nAddresses #80498\n\nHandling the case where x.py can't check out the right commit of a submodule, because the submodule has local edits that would be overwritten by the checkout, more gracefully.\nThe error is printed in detail, with some hints on how to revert the local changes to the submodule.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b7be4fc99fc824f06ea86587643d3f5ffb1304ea", "html_url": "https://github.com/rust-lang/rust/commit/b7be4fc99fc824f06ea86587643d3f5ffb1304ea", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b7be4fc99fc824f06ea86587643d3f5ffb1304ea/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c65400548a0c9d36d7372592fb64bc95f0f37066", "url": "https://api.github.com/repos/rust-lang/rust/commits/c65400548a0c9d36d7372592fb64bc95f0f37066", "html_url": "https://github.com/rust-lang/rust/commit/c65400548a0c9d36d7372592fb64bc95f0f37066"}, {"sha": "95ae8687df49e5fb0004b2950241b7e8b66499a1", "url": "https://api.github.com/repos/rust-lang/rust/commits/95ae8687df49e5fb0004b2950241b7e8b66499a1", "html_url": "https://github.com/rust-lang/rust/commit/95ae8687df49e5fb0004b2950241b7e8b66499a1"}], "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "38d3c7aec4941f5bfe12c1c7957a9eb93f9d5044", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b7be4fc99fc824f06ea86587643d3f5ffb1304ea/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/b7be4fc99fc824f06ea86587643d3f5ffb1304ea/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=b7be4fc99fc824f06ea86587643d3f5ffb1304ea", "patch": "@@ -1026,7 +1026,15 @@ def update_submodule(self, module, checked_out, recorded_submodules):\n         if self.git_version >= distutils.version.LooseVersion(\"2.11.0\"):\n             update_args.append(\"--progress\")\n         update_args.append(module)\n-        run(update_args, cwd=self.rust_root, verbose=self.verbose, exception=True)\n+        try:\n+            run(update_args, cwd=self.rust_root, verbose=self.verbose, exception=True)\n+        except RuntimeError:\n+            print(\"Failed updating submodule. This is probably due to uncommitted local changes.\")\n+            print('Either stash the changes by running \"git stash\" within the submodule\\'s')\n+            print('directory, reset them by running \"git reset --hard\", or commit them.')\n+            print(\"To reset all submodules' changes run\", end=\" \")\n+            print('\"git submodule foreach --recursive git reset --hard\".')\n+            raise SystemExit(1)\n \n         run([\"git\", \"reset\", \"-q\", \"--hard\"],\n             cwd=module_path, verbose=self.verbose)"}]}