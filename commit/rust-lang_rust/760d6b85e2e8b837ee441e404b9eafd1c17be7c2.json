{"sha": "760d6b85e2e8b837ee441e404b9eafd1c17be7c2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc2MGQ2Yjg1ZTJlOGI4MzdlZTQ0MWU0MDRiOWVhZmQxYzE3YmU3YzI=", "commit": {"author": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-07-26T08:41:45Z"}, "committer": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-07-26T08:41:45Z"}, "message": "Ignore the last line overhead when rewriting condition", "tree": {"sha": "e244a948f77a90ff6b92867e2bdfcd9fdd212985", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e244a948f77a90ff6b92867e2bdfcd9fdd212985"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/760d6b85e2e8b837ee441e404b9eafd1c17be7c2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/760d6b85e2e8b837ee441e404b9eafd1c17be7c2", "html_url": "https://github.com/rust-lang/rust/commit/760d6b85e2e8b837ee441e404b9eafd1c17be7c2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/760d6b85e2e8b837ee441e404b9eafd1c17be7c2/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2ffe4d05632ee09c73b948b47eb70d54d3fd95bc", "url": "https://api.github.com/repos/rust-lang/rust/commits/2ffe4d05632ee09c73b948b47eb70d54d3fd95bc", "html_url": "https://github.com/rust-lang/rust/commit/2ffe4d05632ee09c73b948b47eb70d54d3fd95bc"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "99208b92134053cadd5cb97413dc88a60296b614", "filename": "src/expr.rs", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/760d6b85e2e8b837ee441e404b9eafd1c17be7c2/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/760d6b85e2e8b837ee441e404b9eafd1c17be7c2/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=760d6b85e2e8b837ee441e404b9eafd1c17be7c2", "patch": "@@ -1156,12 +1156,23 @@ impl<'a> ControlFlow<'a> {\n         shape: Shape,\n         alt_block_sep: &str,\n     ) -> Option<(String, usize)> {\n+        // Do not take the rhs overhead from the upper expressions into account\n+        // when rewriting pattern.\n+        let new_width = context\n+            .config\n+            .max_width()\n+            .checked_sub(shape.used_width())\n+            .unwrap_or(0);\n+        let fresh_shape = Shape {\n+            width: new_width,\n+            ..shape\n+        };\n         let constr_shape = if self.nested_if {\n             // We are part of an if-elseif-else chain. Our constraints are tightened.\n             // 7 = \"} else \" .len()\n-            try_opt!(shape.offset_left(7))\n+            try_opt!(fresh_shape.offset_left(7))\n         } else {\n-            shape\n+            fresh_shape\n         };\n \n         let label_string = rewrite_label(self.label);"}]}