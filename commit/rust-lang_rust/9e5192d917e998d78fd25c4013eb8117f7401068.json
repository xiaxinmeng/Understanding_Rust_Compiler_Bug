{"sha": "9e5192d917e998d78fd25c4013eb8117f7401068", "node_id": "MDY6Q29tbWl0NzI0NzEyOjllNTE5MmQ5MTdlOTk4ZDc4ZmQyNWM0MDEzZWI4MTE3Zjc0MDEwNjg=", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-02-20T17:51:42Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-02-20T18:08:20Z"}, "message": "Don't lower TypeBound::Lifetime as GenericPredicate::Error", "tree": {"sha": "7b086dc1856824008099a1f4533bf4987383b076", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7b086dc1856824008099a1f4533bf4987383b076"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9e5192d917e998d78fd25c4013eb8117f7401068", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9e5192d917e998d78fd25c4013eb8117f7401068", "html_url": "https://github.com/rust-lang/rust/commit/9e5192d917e998d78fd25c4013eb8117f7401068", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9e5192d917e998d78fd25c4013eb8117f7401068/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ba3a5c518a4e20ddacad05d7a8a67704ca2b2a9a", "url": "https://api.github.com/repos/rust-lang/rust/commits/ba3a5c518a4e20ddacad05d7a8a67704ca2b2a9a", "html_url": "https://github.com/rust-lang/rust/commit/ba3a5c518a4e20ddacad05d7a8a67704ca2b2a9a"}], "stats": {"total": 48, "additions": 23, "deletions": 25}, "files": [{"sha": "99b0ecf3b55f163c95075c09c9fed604e21e95f9", "filename": "crates/hir_ty/src/lower.rs", "status": "modified", "additions": 16, "deletions": 18, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/9e5192d917e998d78fd25c4013eb8117f7401068/crates%2Fhir_ty%2Fsrc%2Flower.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e5192d917e998d78fd25c4013eb8117f7401068/crates%2Fhir_ty%2Fsrc%2Flower.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Flower.rs?ref=9e5192d917e998d78fd25c4013eb8117f7401068", "patch": "@@ -655,17 +655,6 @@ impl TraitRef {\n     ) -> Substs {\n         substs_from_path_segment(ctx, segment, Some(resolved.into()), false)\n     }\n-\n-    pub(crate) fn from_type_bound(\n-        ctx: &TyLoweringContext<'_>,\n-        bound: &TypeBound,\n-        self_ty: Ty,\n-    ) -> Option<TraitRef> {\n-        match bound {\n-            TypeBound::Path(path) => TraitRef::from_path(ctx, path, Some(self_ty)),\n-            TypeBound::Lifetime(_) | TypeBound::Error => None,\n-        }\n-    }\n }\n \n impl GenericPredicate {\n@@ -705,13 +694,22 @@ impl GenericPredicate {\n         bound: &'a TypeBound,\n         self_ty: Ty,\n     ) -> impl Iterator<Item = GenericPredicate> + 'a {\n-        let trait_ref = TraitRef::from_type_bound(ctx, bound, self_ty);\n-        iter::once(trait_ref.clone().map_or(GenericPredicate::Error, GenericPredicate::Implemented))\n-            .chain(\n-                trait_ref\n-                    .into_iter()\n-                    .flat_map(move |tr| assoc_type_bindings_from_type_bound(ctx, bound, tr)),\n-            )\n+        let mut bindings = None;\n+        let trait_ref = match bound {\n+            TypeBound::Path(path) => {\n+                bindings = TraitRef::from_path(ctx, path, Some(self_ty));\n+                Some(\n+                    bindings.clone().map_or(GenericPredicate::Error, GenericPredicate::Implemented),\n+                )\n+            }\n+            TypeBound::Lifetime(_) => None,\n+            TypeBound::Error => Some(GenericPredicate::Error),\n+        };\n+        trait_ref.into_iter().chain(\n+            bindings\n+                .into_iter()\n+                .flat_map(move |tr| assoc_type_bindings_from_type_bound(ctx, bound, tr)),\n+        )\n     }\n }\n "}, {"sha": "659b8fce9ce5e126529591cb2381e1b0961df3c6", "filename": "crates/hir_ty/src/tests/method_resolution.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9e5192d917e998d78fd25c4013eb8117f7401068/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmethod_resolution.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e5192d917e998d78fd25c4013eb8117f7401068/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmethod_resolution.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Fmethod_resolution.rs?ref=9e5192d917e998d78fd25c4013eb8117f7401068", "patch": "@@ -1114,14 +1114,14 @@ fn method_on_dyn_impl() {\n trait Foo {}\n \n impl Foo for u32 {}\n-impl dyn Foo {\n+impl dyn Foo + '_ {\n     pub fn dyn_foo(&self) -> u32 {\n         0\n     }\n }\n \n fn main() {\n-    let f = &42u32 as &dyn Foo<u32>;\n+    let f = &42u32 as &dyn Foo;\n     f.dyn_foo();\n   // ^u32\n }"}, {"sha": "744fb5ff29506b10ba218931f0d9454a5fc19159", "filename": "crates/hir_ty/src/tests/traits.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9e5192d917e998d78fd25c4013eb8117f7401068/crates%2Fhir_ty%2Fsrc%2Ftests%2Ftraits.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e5192d917e998d78fd25c4013eb8117f7401068/crates%2Fhir_ty%2Fsrc%2Ftests%2Ftraits.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Ftraits.rs?ref=9e5192d917e998d78fd25c4013eb8117f7401068", "patch": "@@ -1409,10 +1409,10 @@ fn weird_bounds() {\n         fn test(a: impl Trait + 'lifetime, b: impl 'lifetime, c: impl (Trait), d: impl ('lifetime), e: impl ?Sized, f: impl Trait + ?Sized) {}\n         \"#,\n         expect![[r#\"\n-            23..24 'a': impl Trait + {error}\n-            50..51 'b': impl {error}\n+            23..24 'a': impl Trait\n+            50..51 'b': impl \n             69..70 'c': impl Trait\n-            86..87 'd': impl {error}\n+            86..87 'd': impl \n             107..108 'e': impl {error}\n             123..124 'f': impl Trait + {error}\n             147..149 '{}': ()"}, {"sha": "9a605b09d08a1d46f4dd4edc45c4d1b455ae29f1", "filename": "crates/ide/src/hover.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9e5192d917e998d78fd25c4013eb8117f7401068/crates%2Fide%2Fsrc%2Fhover.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e5192d917e998d78fd25c4013eb8117f7401068/crates%2Fide%2Fsrc%2Fhover.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fhover.rs?ref=9e5192d917e998d78fd25c4013eb8117f7401068", "patch": "@@ -3417,7 +3417,7 @@ impl<T> Foo<T$0> {}\n                 ```\n                 \"#]],\n         );\n-        // lifetimes aren't being substituted yet\n+        // lifetimes bounds arent being tracked yet\n         check(\n             r#\"\n struct Foo<T>(T);\n@@ -3427,7 +3427,7 @@ impl<T: 'static> Foo<T$0> {}\n                 *T*\n \n                 ```rust\n-                T: {error}\n+                T\n                 ```\n                 \"#]],\n         );"}]}