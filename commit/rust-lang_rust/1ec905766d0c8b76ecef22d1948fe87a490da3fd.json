{"sha": "1ec905766d0c8b76ecef22d1948fe87a490da3fd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlYzkwNTc2NmQwYzhiNzZlY2VmMjJkMTk0OGZlODdhNDkwZGEzZmQ=", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2021-02-24T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2021-03-09T13:49:04Z"}, "message": "Use FromStr trait for number option parsing\n\nReplace `parse_uint` with generic `parse_number` based on `FromStr`.\nUse it for parsing inlining threshold to avoid casting later.", "tree": {"sha": "e23db4f17f69b9540d3935451bafe8290213753c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e23db4f17f69b9540d3935451bafe8290213753c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1ec905766d0c8b76ecef22d1948fe87a490da3fd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1ec905766d0c8b76ecef22d1948fe87a490da3fd", "html_url": "https://github.com/rust-lang/rust/commit/1ec905766d0c8b76ecef22d1948fe87a490da3fd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1ec905766d0c8b76ecef22d1948fe87a490da3fd/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3a5d45f68cadc8fff4fbb557780f92b403b19c19", "url": "https://api.github.com/repos/rust-lang/rust/commits/3a5d45f68cadc8fff4fbb557780f92b403b19c19", "html_url": "https://github.com/rust-lang/rust/commit/3a5d45f68cadc8fff4fbb557780f92b403b19c19"}], "stats": {"total": 33, "additions": 17, "deletions": 16}, "files": [{"sha": "36e22f260a79f754083d73aca72eb658c999fe8a", "filename": "compiler/rustc_codegen_llvm/src/back/write.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1ec905766d0c8b76ecef22d1948fe87a490da3fd/compiler%2Frustc_codegen_llvm%2Fsrc%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ec905766d0c8b76ecef22d1948fe87a490da3fd/compiler%2Frustc_codegen_llvm%2Fsrc%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fback%2Fwrite.rs?ref=1ec905766d0c8b76ecef22d1948fe87a490da3fd", "patch": "@@ -1044,7 +1044,7 @@ pub unsafe fn with_llvm_pmb(\n     // thresholds copied from clang.\n     match (opt_level, opt_size, inline_threshold) {\n         (.., Some(t)) => {\n-            llvm::LLVMPassManagerBuilderUseInlinerWithThreshold(builder, t as u32);\n+            llvm::LLVMPassManagerBuilderUseInlinerWithThreshold(builder, t);\n         }\n         (llvm::CodeGenOptLevel::Aggressive, ..) => {\n             llvm::LLVMPassManagerBuilderUseInlinerWithThreshold(builder, 275);"}, {"sha": "9afb0ccd7068c24fd5f933d23c836acd4be223f5", "filename": "compiler/rustc_codegen_ssa/src/back/write.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1ec905766d0c8b76ecef22d1948fe87a490da3fd/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ec905766d0c8b76ecef22d1948fe87a490da3fd/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Fwrite.rs?ref=1ec905766d0c8b76ecef22d1948fe87a490da3fd", "patch": "@@ -106,7 +106,7 @@ pub struct ModuleConfig {\n     pub vectorize_loop: bool,\n     pub vectorize_slp: bool,\n     pub merge_functions: bool,\n-    pub inline_threshold: Option<usize>,\n+    pub inline_threshold: Option<u32>,\n     pub new_llvm_pass_manager: bool,\n     pub emit_lifetime_markers: bool,\n }"}, {"sha": "12ada53c2fa92baf5578fee03887d49e3781e77d", "filename": "compiler/rustc_session/src/config.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1ec905766d0c8b76ecef22d1948fe87a490da3fd/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ec905766d0c8b76ecef22d1948fe87a490da3fd/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Fconfig.rs?ref=1ec905766d0c8b76ecef22d1948fe87a490da3fd", "patch": "@@ -2367,6 +2367,7 @@ crate mod dep_tracking {\n     impl_dep_tracking_hash_via_hash!(PathBuf);\n     impl_dep_tracking_hash_via_hash!(lint::Level);\n     impl_dep_tracking_hash_via_hash!(Option<bool>);\n+    impl_dep_tracking_hash_via_hash!(Option<u32>);\n     impl_dep_tracking_hash_via_hash!(Option<usize>);\n     impl_dep_tracking_hash_via_hash!(Option<NonZeroUsize>);\n     impl_dep_tracking_hash_via_hash!(Option<String>);"}, {"sha": "67af17bafcc0b52b61addf404e26e3df9d1c1acf", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/1ec905766d0c8b76ecef22d1948fe87a490da3fd/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ec905766d0c8b76ecef22d1948fe87a490da3fd/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=1ec905766d0c8b76ecef22d1948fe87a490da3fd", "patch": "@@ -248,9 +248,9 @@ macro_rules! options {\n         pub const parse_list: &str = \"a space-separated list of strings\";\n         pub const parse_opt_list: &str = parse_list;\n         pub const parse_opt_comma_list: &str = \"a comma-separated list of strings\";\n-        pub const parse_uint: &str = \"a number\";\n-        pub const parse_opt_uint: &str = parse_uint;\n-        pub const parse_threads: &str = parse_uint;\n+        pub const parse_number: &str = \"a number\";\n+        pub const parse_opt_number: &str = parse_number;\n+        pub const parse_threads: &str = parse_number;\n         pub const parse_passes: &str = \"a space-separated list of passes, or `all`\";\n         pub const parse_panic_strategy: &str = \"either `unwind` or `abort`\";\n         pub const parse_relro_level: &str = \"one of: `full`, `partial`, or `off`\";\n@@ -413,16 +413,16 @@ macro_rules! options {\n             }\n         }\n \n-        /// Use this for any uint option that has a static default.\n-        fn parse_uint(slot: &mut usize, v: Option<&str>) -> bool {\n+        /// Use this for any numeric option that has a static default.\n+        fn parse_number<T: Copy + FromStr>(slot: &mut T, v: Option<&str>) -> bool {\n             match v.and_then(|s| s.parse().ok()) {\n                 Some(i) => { *slot = i; true },\n                 None => false\n             }\n         }\n \n-        /// Use this for any uint option that lacks a static default.\n-        fn parse_opt_uint(slot: &mut Option<usize>, v: Option<&str>) -> bool {\n+        /// Use this for any numeric option that lacks a static default.\n+        fn parse_opt_number<T: Copy + FromStr>(slot: &mut Option<T>, v: Option<&str>) -> bool {\n             match v {\n                 Some(s) => { *slot = s.parse().ok(); slot.is_some() }\n                 None => false\n@@ -748,13 +748,13 @@ options! {CodegenOptions, CodegenSetter, basic_codegen_options,\n         \"this option is deprecated and does nothing\"),\n     code_model: Option<CodeModel> = (None, parse_code_model, [TRACKED],\n         \"choose the code model to use (`rustc --print code-models` for details)\"),\n-    codegen_units: Option<usize> = (None, parse_opt_uint, [UNTRACKED],\n+    codegen_units: Option<usize> = (None, parse_opt_number, [UNTRACKED],\n         \"divide crate into N units to optimize in parallel\"),\n     control_flow_guard: CFGuard = (CFGuard::Disabled, parse_cfguard, [TRACKED],\n         \"use Windows Control Flow Guard (default: no)\"),\n     debug_assertions: Option<bool> = (None, parse_opt_bool, [TRACKED],\n         \"explicitly enable the `cfg(debug_assertions)` directive\"),\n-    debuginfo: usize = (0, parse_uint, [TRACKED],\n+    debuginfo: usize = (0, parse_number, [TRACKED],\n         \"debug info emission level (0 = no debug info, 1 = line tables only, \\\n         2 = full debug info with variable and type information; default: 0)\"),\n     default_linker_libraries: bool = (false, parse_bool, [UNTRACKED],\n@@ -769,7 +769,7 @@ options! {CodegenOptions, CodegenSetter, basic_codegen_options,\n         \"force use of unwind tables\"),\n     incremental: Option<String> = (None, parse_opt_string, [UNTRACKED],\n         \"enable incremental compilation\"),\n-    inline_threshold: Option<usize> = (None, parse_opt_uint, [TRACKED],\n+    inline_threshold: Option<u32> = (None, parse_opt_number, [TRACKED],\n         \"set the threshold for inlining a function\"),\n     link_arg: (/* redirected to link_args */) = ((), parse_string_push, [UNTRACKED],\n         \"a single extra argument to append to the linker invocation (can be used several times)\"),\n@@ -959,9 +959,9 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n         \"verify incr. comp. hashes of green query instances (default: no)\"),\n     inline_mir: Option<bool> = (None, parse_opt_bool, [TRACKED],\n         \"enable MIR inlining (default: no)\"),\n-    inline_mir_threshold: Option<usize> = (None, parse_opt_uint, [TRACKED],\n+    inline_mir_threshold: Option<usize> = (None, parse_opt_number, [TRACKED],\n         \"a default MIR inlining threshold (default: 50)\"),\n-    inline_mir_hint_threshold: Option<usize> = (None, parse_opt_uint, [TRACKED],\n+    inline_mir_hint_threshold: Option<usize> = (None, parse_opt_number, [TRACKED],\n         \"inlining threshold for functions with inline hint (default: 100)\"),\n     inline_in_all_cgus: Option<bool> = (None, parse_opt_bool, [TRACKED],\n         \"control whether `#[inline]` functions are in all CGUs\"),\n@@ -999,7 +999,7 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n     mir_emit_retag: bool = (false, parse_bool, [TRACKED],\n         \"emit Retagging MIR statements, interpreted e.g., by miri; implies -Zmir-opt-level=0 \\\n         (default: no)\"),\n-    mir_opt_level: Option<usize> = (None, parse_opt_uint, [TRACKED],\n+    mir_opt_level: Option<usize> = (None, parse_opt_number, [TRACKED],\n         \"MIR optimization level (0-4; default: 1 in non optimized builds and 2 in optimized builds)\"),\n     mutable_noalias: bool = (false, parse_bool, [TRACKED],\n         \"emit noalias metadata for mutable references (default: no)\"),\n@@ -1120,7 +1120,7 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n         \"which mangling version to use for symbol names ('legacy' (default) or 'v0')\"),\n     teach: bool = (false, parse_bool, [TRACKED],\n         \"show extended diagnostic help (default: no)\"),\n-    terminal_width: Option<usize> = (None, parse_opt_uint, [UNTRACKED],\n+    terminal_width: Option<usize> = (None, parse_opt_number, [UNTRACKED],\n         \"set the current terminal width\"),\n     tune_cpu: Option<String> = (None, parse_opt_string, [TRACKED],\n         \"select processor to schedule for (`rustc --print target-cpus` for details)\"),"}]}