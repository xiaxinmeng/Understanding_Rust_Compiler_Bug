{"sha": "91fdadba6103b6926ff0c886a6a5da002a80994a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkxZmRhZGJhNjEwM2I2OTI2ZmYwYzg4NmE2YTVkYTAwMmE4MDk5NGE=", "commit": {"author": {"name": "Ariel Ben-Yehuda", "email": "ariel.byd@gmail.com", "date": "2017-10-06T14:12:24Z"}, "committer": {"name": "Ariel Ben-Yehuda", "email": "ariel.byd@gmail.com", "date": "2017-10-06T14:12:24Z"}, "message": "fix logic error in #44269's `prune_cache_value_obligations`\n\nWe want to retain obligations that *contain* inference variables, not\nobligations that *don't contain* them, in order to fix #43132. Because\nof surrounding changes to inference, the ICE doesn't occur in its\noriginal case, but I believe it could still be made to occur on master.\n\nMaybe I should try to write a new test case? Certainly not right now\n(I'm mainly trying to get us a beta that we can ship) but maybe before\nwe land this PR on nightly?\n\nThis seems to cause a 10% performance regression in my imprecise\nattempt to benchmark item-body checking for #43613, but it's better to\nbe slow and right than fast and wrong. If we want to recover that, I\nthink we can change the constrained-type-parameter code to actually\ngive a list of projections that are important for resolving inference\nvariables and filter everything else out.", "tree": {"sha": "74d521109519d6a0620db73d5bcc59b75e99bd8e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/74d521109519d6a0620db73d5bcc59b75e99bd8e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/91fdadba6103b6926ff0c886a6a5da002a80994a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/91fdadba6103b6926ff0c886a6a5da002a80994a", "html_url": "https://github.com/rust-lang/rust/commit/91fdadba6103b6926ff0c886a6a5da002a80994a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/91fdadba6103b6926ff0c886a6a5da002a80994a/comments", "author": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "committer": {"login": "arielb1", "id": 1830974, "node_id": "MDQ6VXNlcjE4MzA5NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1830974?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arielb1", "html_url": "https://github.com/arielb1", "followers_url": "https://api.github.com/users/arielb1/followers", "following_url": "https://api.github.com/users/arielb1/following{/other_user}", "gists_url": "https://api.github.com/users/arielb1/gists{/gist_id}", "starred_url": "https://api.github.com/users/arielb1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arielb1/subscriptions", "organizations_url": "https://api.github.com/users/arielb1/orgs", "repos_url": "https://api.github.com/users/arielb1/repos", "events_url": "https://api.github.com/users/arielb1/events{/privacy}", "received_events_url": "https://api.github.com/users/arielb1/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9ae6ed78acf9dc865e2300a7db556389eed9692d", "url": "https://api.github.com/repos/rust-lang/rust/commits/9ae6ed78acf9dc865e2300a7db556389eed9692d", "html_url": "https://github.com/rust-lang/rust/commit/9ae6ed78acf9dc865e2300a7db556389eed9692d"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "b5449f517692635393f7766bfef31bc7fdc9a50c", "filename": "src/librustc/traits/project.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/91fdadba6103b6926ff0c886a6a5da002a80994a/src%2Flibrustc%2Ftraits%2Fproject.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91fdadba6103b6926ff0c886a6a5da002a80994a/src%2Flibrustc%2Ftraits%2Fproject.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fproject.rs?ref=91fdadba6103b6926ff0c886a6a5da002a80994a", "patch": "@@ -639,7 +639,7 @@ fn prune_cache_value_obligations<'a, 'gcx, 'tcx>(infcx: &'a InferCtxt<'a, 'gcx,\n                   // but we have `T: Foo<X = ?1>` and `?1: Bar<X =\n                   // ?0>`).\n                   ty::Predicate::Projection(ref data) =>\n-                      !infcx.any_unresolved_type_vars(&data.ty()),\n+                      infcx.any_unresolved_type_vars(&data.ty()),\n \n                   // We are only interested in `T: Foo<X = U>` predicates, whre\n                   // `U` references one of `unresolved_type_vars`. =)"}]}