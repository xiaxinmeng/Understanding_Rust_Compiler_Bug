{"sha": "5ce8990885eb09c6cc096c207c39b411aa6ce676", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjZTg5OTA4ODVlYjA5YzZjYzA5NmMyMDdjMzliNDExYWE2Y2U2NzY=", "commit": {"author": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2019-10-29T06:34:05Z"}, "committer": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2019-10-29T06:34:05Z"}, "message": "Simplify approx const truncation check", "tree": {"sha": "460b6d860e22dd44db6dc5961b9d75c84c198b2c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/460b6d860e22dd44db6dc5961b9d75c84c198b2c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5ce8990885eb09c6cc096c207c39b411aa6ce676", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5ce8990885eb09c6cc096c207c39b411aa6ce676", "html_url": "https://github.com/rust-lang/rust/commit/5ce8990885eb09c6cc096c207c39b411aa6ce676", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5ce8990885eb09c6cc096c207c39b411aa6ce676/comments", "author": null, "committer": null, "parents": [{"sha": "e2104d1e2eec9b22729d4ceb9376fba9ce31ef5a", "url": "https://api.github.com/repos/rust-lang/rust/commits/e2104d1e2eec9b22729d4ceb9376fba9ce31ef5a", "html_url": "https://github.com/rust-lang/rust/commit/e2104d1e2eec9b22729d4ceb9376fba9ce31ef5a"}], "stats": {"total": 11, "additions": 4, "deletions": 7}, "files": [{"sha": "81555a4c533b42eb677108146d354d27a2e1ac11", "filename": "clippy_lints/src/approx_const.rs", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/5ce8990885eb09c6cc096c207c39b411aa6ce676/clippy_lints%2Fsrc%2Fapprox_const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ce8990885eb09c6cc096c207c39b411aa6ce676/clippy_lints%2Fsrc%2Fapprox_const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fapprox_const.rs?ref=5ce8990885eb09c6cc096c207c39b411aa6ce676", "patch": "@@ -97,14 +97,11 @@ fn check_known_consts(cx: &LateContext<'_, '_>, e: &Expr, s: symbol::Symbol, mod\n fn is_approx_const(constant: f64, value: &str, min_digits: usize) -> bool {\n     if value.len() <= min_digits {\n         false\n+    } else if constant.to_string().starts_with(value) {\n+        // The value is a truncated constant\n+        true\n     } else {\n         let round_const = format!(\"{:.*}\", value.len() - 2, constant);\n-\n-        let mut trunc_const = constant.to_string();\n-        if trunc_const.len() > value.len() {\n-            trunc_const.truncate(value.len());\n-        }\n-\n-        (value == round_const) || (value == trunc_const)\n+        value == round_const\n     }\n }"}]}