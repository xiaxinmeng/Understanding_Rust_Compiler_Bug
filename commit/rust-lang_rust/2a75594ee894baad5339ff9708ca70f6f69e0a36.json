{"sha": "2a75594ee894baad5339ff9708ca70f6f69e0a36", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJhNzU1OTRlZTg5NGJhYWQ1MzM5ZmY5NzA4Y2E3MGY2ZjY5ZTBhMzY=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-02-05T15:31:25Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-02-05T15:31:25Z"}, "message": "Merge #7505\n\n7505: Widen Highlights root range to covering element r=Veykril a=Veykril\n\nThere have been a few issues about/containing spurious syntax highlighting panics, which all seem to come from the `rust_analyzer::handlers::handle_semantic_tokens_range` request, which I believe this to be the cause of as the text range we want to highlight here is currently potentially smaller than that of the covering element, so we might highlight something that is inside the covering element, but outside of the text range we wish to highlight causing the assert to fail.\r\nUnfortunately this isn't really easy to test since I have yet to find a reproducible cause(#7504 doesn't work for me cause I can't seem to checkout the given commit).\r\n\r\nSee #7504, #7298, #7299 and #7416, all of those contain an assertion failure in syntax highlighting, but only in the range request.\n\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>", "tree": {"sha": "abd96da79edf04649b41c4ea8eb61e9b01123c47", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/abd96da79edf04649b41c4ea8eb61e9b01123c47"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2a75594ee894baad5339ff9708ca70f6f69e0a36", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgHWTNCRBK7hj4Ov3rIwAAdHIIACsiJCFzUweGf+OsF3Qh2k3v\nZhESvskurJXU5U/5tu1d0dbUsQ0G2SO/ZBCLNwcsG2uDqiMfaUH7exWhCsTPrCKq\n8YM1sN2ArhiEg9QPV1ELTyO/dv3KmwfNwvZbEts/O227gJDUnhmURgKS1Ah6/asu\nW/AtJItUk5ojfcAae5FV0EJDsMVUWd1KF3++E7L/0MJc5tMDs8cI5ndYHVHJZI28\nQssjaoKv48pQqtif5b1JuMuPEMtHYImFEMXz1p7JH5li6tVa7vW/vnCeDIEduv91\nK0pBh+FNjRCqghuxt9wLO9d186Yuui9GlHfPTXeNZWFPOrt/Yd1xsq8u3JgVT9o=\n=eNCH\n-----END PGP SIGNATURE-----\n", "payload": "tree abd96da79edf04649b41c4ea8eb61e9b01123c47\nparent 855b00cbe600cad34a14841c37a2ac1f2f3a247e\nparent 34d5d77cfa09f4460a0851b5650f441771e7373e\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1612539085 +0000\ncommitter GitHub <noreply@github.com> 1612539085 +0000\n\nMerge #7505\n\n7505: Widen Highlights root range to covering element r=Veykril a=Veykril\n\nThere have been a few issues about/containing spurious syntax highlighting panics, which all seem to come from the `rust_analyzer::handlers::handle_semantic_tokens_range` request, which I believe this to be the cause of as the text range we want to highlight here is currently potentially smaller than that of the covering element, so we might highlight something that is inside the covering element, but outside of the text range we wish to highlight causing the assert to fail.\r\nUnfortunately this isn't really easy to test since I have yet to find a reproducible cause(#7504 doesn't work for me cause I can't seem to checkout the given commit).\r\n\r\nSee #7504, #7298, #7299 and #7416, all of those contain an assertion failure in syntax highlighting, but only in the range request.\n\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2a75594ee894baad5339ff9708ca70f6f69e0a36", "html_url": "https://github.com/rust-lang/rust/commit/2a75594ee894baad5339ff9708ca70f6f69e0a36", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2a75594ee894baad5339ff9708ca70f6f69e0a36/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "855b00cbe600cad34a14841c37a2ac1f2f3a247e", "url": "https://api.github.com/repos/rust-lang/rust/commits/855b00cbe600cad34a14841c37a2ac1f2f3a247e", "html_url": "https://github.com/rust-lang/rust/commit/855b00cbe600cad34a14841c37a2ac1f2f3a247e"}, {"sha": "34d5d77cfa09f4460a0851b5650f441771e7373e", "url": "https://api.github.com/repos/rust-lang/rust/commits/34d5d77cfa09f4460a0851b5650f441771e7373e", "html_url": "https://github.com/rust-lang/rust/commit/34d5d77cfa09f4460a0851b5650f441771e7373e"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "9bed329d8d83eff33a472d4d70814e0c3dd595be", "filename": "crates/ide/src/syntax_highlighting.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2a75594ee894baad5339ff9708ca70f6f69e0a36/crates%2Fide%2Fsrc%2Fsyntax_highlighting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2a75594ee894baad5339ff9708ca70f6f69e0a36/crates%2Fide%2Fsrc%2Fsyntax_highlighting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting.rs?ref=2a75594ee894baad5339ff9708ca70f6f69e0a36", "patch": "@@ -72,7 +72,7 @@ pub(crate) fn highlight(\n         }\n     };\n \n-    let mut hl = highlights::Highlights::new(range_to_highlight);\n+    let mut hl = highlights::Highlights::new(root.text_range());\n     traverse(&mut hl, &sema, &root, range_to_highlight, syntactic_name_ref_highlighting);\n     hl.to_vec()\n }"}]}