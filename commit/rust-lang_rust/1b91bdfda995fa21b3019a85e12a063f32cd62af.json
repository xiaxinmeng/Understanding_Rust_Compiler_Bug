{"sha": "1b91bdfda995fa21b3019a85e12a063f32cd62af", "node_id": "C_kwDOAAsO6NoAKDFiOTFiZGZkYTk5NWZhMjFiMzAxOWE4NWUxMmEwNjNmMzJjZDYyYWY", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2022-11-14T02:49:24Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-14T02:49:24Z"}, "message": "Rollup merge of #103709 - cuviper:netbsd-9, r=pietroalbini\n\nci: Upgrade dist-x86_64-netbsd to NetBSD 9.0\n\nThis is another step in toolchain upgrades for LLVM 16, which will need at least GCC 7.1.\n\nOur previous NetBSD 8.0 cross-toolchain used its system GCC 5.5. While there are newer versions available in pkgsrc, I could not get those working for cross-compilation. Upgrading to NetBSD 9.0 gets us GCC 7.4, which is sufficient for now.\n\nThis will affect the compatibility of the build we ship for `x86_64-unknown-netbsd`, but others may still build their own from source if that is needed. It is expected that NetBSD 8 will reach EOL soon anyway, approximately one month after 10 is released, but there is no firm date for that.", "tree": {"sha": "64cd2a6a5d63818a383b4d845cf60acdf38935b0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/64cd2a6a5d63818a383b4d845cf60acdf38935b0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1b91bdfda995fa21b3019a85e12a063f32cd62af", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjcay0CRBK7hj4Ov3rIwAAO7AIAI0B3awC6K1Wywj7TySur8Pv\nUpTFTIz3AZX+GXKM/uvjmnZ1TlGenuvX0PBKC+hMAF9vUj1xWjFA6kEnOOJt0262\nMNV25dcODm1Q1ndiW2cAJ1psw46CKR1HkceedfWMmhpUsZ8SpnLqReaWOm7Wm0Oa\n0DvPJqo35K0NJo5PKsNkP5qC9lu42H+VxgVSftzSqhPsiTXNg8PvKhgCNXYAArM2\ngOV9zOXfWc4TbeZp6UV6LMpJwZPWW15dL9XXJ5fI5i7xx4nDzjTReawen82rmb8S\n7LLUHhX3VUWLbYYKmj4wwDahQsw3aqe7wQP5/Xu0yl16rq4icBl3ca3Tzv1DyXg=\n=sUVo\n-----END PGP SIGNATURE-----\n", "payload": "tree 64cd2a6a5d63818a383b4d845cf60acdf38935b0\nparent 7b513af6c4b39b86f70b19fbd1a2dc72aa485d5c\nparent 32a31308138f7855a8171c241c431d2da1715084\nauthor Manish Goregaokar <manishsmail@gmail.com> 1668394164 -0500\ncommitter GitHub <noreply@github.com> 1668394164 -0500\n\nRollup merge of #103709 - cuviper:netbsd-9, r=pietroalbini\n\nci: Upgrade dist-x86_64-netbsd to NetBSD 9.0\n\nThis is another step in toolchain upgrades for LLVM 16, which will need at least GCC 7.1.\n\nOur previous NetBSD 8.0 cross-toolchain used its system GCC 5.5. While there are newer versions available in pkgsrc, I could not get those working for cross-compilation. Upgrading to NetBSD 9.0 gets us GCC 7.4, which is sufficient for now.\n\nThis will affect the compatibility of the build we ship for `x86_64-unknown-netbsd`, but others may still build their own from source if that is needed. It is expected that NetBSD 8 will reach EOL soon anyway, approximately one month after 10 is released, but there is no firm date for that.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1b91bdfda995fa21b3019a85e12a063f32cd62af", "html_url": "https://github.com/rust-lang/rust/commit/1b91bdfda995fa21b3019a85e12a063f32cd62af", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1b91bdfda995fa21b3019a85e12a063f32cd62af/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7b513af6c4b39b86f70b19fbd1a2dc72aa485d5c", "url": "https://api.github.com/repos/rust-lang/rust/commits/7b513af6c4b39b86f70b19fbd1a2dc72aa485d5c", "html_url": "https://github.com/rust-lang/rust/commit/7b513af6c4b39b86f70b19fbd1a2dc72aa485d5c"}, {"sha": "32a31308138f7855a8171c241c431d2da1715084", "url": "https://api.github.com/repos/rust-lang/rust/commits/32a31308138f7855a8171c241c431d2da1715084", "html_url": "https://github.com/rust-lang/rust/commit/32a31308138f7855a8171c241c431d2da1715084"}], "stats": {"total": 37, "additions": 17, "deletions": 20}, "files": [{"sha": "d35e4191cc0b1dfc1ae36d59caf4e74556a6997c", "filename": "compiler/rustc_llvm/build.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1b91bdfda995fa21b3019a85e12a063f32cd62af/compiler%2Frustc_llvm%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b91bdfda995fa21b3019a85e12a063f32cd62af/compiler%2Frustc_llvm%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_llvm%2Fbuild.rs?ref=1b91bdfda995fa21b3019a85e12a063f32cd62af", "patch": "@@ -334,7 +334,7 @@ fn main() {\n         \"c++\"\n     } else if target.contains(\"netbsd\") && llvm_static_stdcpp.is_some() {\n         // NetBSD uses a separate library when relocation is required\n-        \"stdc++_pic\"\n+        \"stdc++_p\"\n     } else if llvm_use_libcxx.is_some() {\n         \"c++\"\n     } else {"}, {"sha": "d03c364547e034cbdbd21b8594a98c5b4c1ce298", "filename": "src/ci/docker/host-x86_64/dist-x86_64-netbsd/Dockerfile", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/1b91bdfda995fa21b3019a85e12a063f32cd62af/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-netbsd%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1b91bdfda995fa21b3019a85e12a063f32cd62af/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-netbsd%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-netbsd%2FDockerfile?ref=1b91bdfda995fa21b3019a85e12a063f32cd62af", "patch": "@@ -1,17 +1,15 @@\n-FROM ubuntu:16.04\n+FROM ubuntu:20.04\n \n COPY scripts/cross-apt-packages.sh /scripts/\n RUN sh /scripts/cross-apt-packages.sh\n+RUN DEBIAN_FRONTEND=noninteractive apt-get install -y zlib1g-dev\n \n COPY host-x86_64/dist-x86_64-netbsd/build-netbsd-toolchain.sh /tmp/\n RUN /tmp/build-netbsd-toolchain.sh\n \n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-COPY scripts/cmake.sh /scripts/\n-RUN /scripts/cmake.sh\n-\n ENV PATH=$PATH:/x-tools/x86_64-unknown-netbsd/bin\n \n ENV \\\n@@ -21,6 +19,5 @@ ENV \\\n \n ENV HOSTS=x86_64-unknown-netbsd\n \n-ENV RUST_CONFIGURE_ARGS --enable-extended --disable-docs \\\n-    --set llvm.allow-old-toolchain\n+ENV RUST_CONFIGURE_ARGS --enable-extended --disable-docs\n ENV SCRIPT python3 ../x.py dist --host $HOSTS --target $HOSTS"}, {"sha": "e0c008b76fa8bb39744460c79d8cc50751880edb", "filename": "src/ci/docker/host-x86_64/dist-x86_64-netbsd/build-netbsd-toolchain.sh", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/1b91bdfda995fa21b3019a85e12a063f32cd62af/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-netbsd%2Fbuild-netbsd-toolchain.sh", "raw_url": "https://github.com/rust-lang/rust/raw/1b91bdfda995fa21b3019a85e12a063f32cd62af/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-netbsd%2Fbuild-netbsd-toolchain.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-netbsd%2Fbuild-netbsd-toolchain.sh?ref=1b91bdfda995fa21b3019a85e12a063f32cd62af", "patch": "@@ -25,19 +25,19 @@ cd netbsd\n \n mkdir -p /x-tools/x86_64-unknown-netbsd/sysroot\n \n-URL=https://ci-mirrors.rust-lang.org/rustc\n-\n-# Originally from ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-$BSD/source/sets/*.tgz\n-curl $URL/2018-03-01-netbsd-src.tgz | tar xzf -\n-curl $URL/2018-03-01-netbsd-gnusrc.tgz | tar xzf -\n-curl $URL/2018-03-01-netbsd-sharesrc.tgz | tar xzf -\n-curl $URL/2018-03-01-netbsd-syssrc.tgz | tar xzf -\n-\n-# Originally from ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-$BSD/amd64/binary/sets/*.tgz\n-curl $URL/2018-03-01-netbsd-base.tgz | \\\n-  tar xzf - -C /x-tools/x86_64-unknown-netbsd/sysroot ./usr/include ./usr/lib ./lib\n-curl $URL/2018-03-01-netbsd-comp.tgz | \\\n-  tar xzf - -C /x-tools/x86_64-unknown-netbsd/sysroot ./usr/include ./usr/lib\n+# URL=https://ci-mirrors.rust-lang.org/rustc\n+\n+SOURCE_URL=https://cdn.netbsd.org/pub/NetBSD/NetBSD-9.0/source/sets\n+curl $SOURCE_URL/src.tgz | tar xzf -\n+curl $SOURCE_URL/gnusrc.tgz | tar xzf -\n+curl $SOURCE_URL/sharesrc.tgz | tar xzf -\n+curl $SOURCE_URL/syssrc.tgz | tar xzf -\n+\n+BINARY_URL=https://cdn.netbsd.org/pub/NetBSD/NetBSD-9.0/amd64/binary/sets\n+curl $BINARY_URL/base.tar.xz | \\\n+  tar xJf - -C /x-tools/x86_64-unknown-netbsd/sysroot ./usr/include ./usr/lib ./lib\n+curl $BINARY_URL/comp.tar.xz | \\\n+  tar xJf - -C /x-tools/x86_64-unknown-netbsd/sysroot ./usr/include ./usr/lib\n \n cd usr/src\n "}]}