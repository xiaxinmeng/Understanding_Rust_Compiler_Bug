{"sha": "9f6e6872c21a467af8946381e40b9021cf18066c", "node_id": "C_kwDOAAsO6NoAKDlmNmU2ODcyYzIxYTQ2N2FmODk0NjM4MWU0MGI5MDIxY2YxODA2NmM", "commit": {"author": {"name": "Sean Cross", "email": "sean@xobs.io", "date": "2022-05-31T08:15:40Z"}, "committer": {"name": "Sean Cross", "email": "sean@xobs.io", "date": "2022-06-04T10:47:27Z"}, "message": "riscv32imac-unknown-xous-elf: add target\n\nXous is a microkernel operating system designed to run on small systems.\nThe kernel contains a wide range of userspace processes that provide\ncommon services such as console output, networking, and time access.\n\nThe kernel and its services are completely written in Rust using a\ncustom build of libstd. This adds support for this target to upstream\nRust so that we can drop support for our out-of-tree `target.json` file.\n\nAdd a Tier 3 target for Xous running on RISC-V.\n\nSigned-off-by: Sean Cross <sean@xobs.io>", "tree": {"sha": "73d4a5c2360a155dcf4a5da7b32dee2f6800df8e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/73d4a5c2360a155dcf4a5da7b32dee2f6800df8e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9f6e6872c21a467af8946381e40b9021cf18066c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9f6e6872c21a467af8946381e40b9021cf18066c", "html_url": "https://github.com/rust-lang/rust/commit/9f6e6872c21a467af8946381e40b9021cf18066c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9f6e6872c21a467af8946381e40b9021cf18066c/comments", "author": {"login": "xobs", "id": 238325, "node_id": "MDQ6VXNlcjIzODMyNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/238325?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xobs", "html_url": "https://github.com/xobs", "followers_url": "https://api.github.com/users/xobs/followers", "following_url": "https://api.github.com/users/xobs/following{/other_user}", "gists_url": "https://api.github.com/users/xobs/gists{/gist_id}", "starred_url": "https://api.github.com/users/xobs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xobs/subscriptions", "organizations_url": "https://api.github.com/users/xobs/orgs", "repos_url": "https://api.github.com/users/xobs/repos", "events_url": "https://api.github.com/users/xobs/events{/privacy}", "received_events_url": "https://api.github.com/users/xobs/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xobs", "id": 238325, "node_id": "MDQ6VXNlcjIzODMyNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/238325?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xobs", "html_url": "https://github.com/xobs", "followers_url": "https://api.github.com/users/xobs/followers", "following_url": "https://api.github.com/users/xobs/following{/other_user}", "gists_url": "https://api.github.com/users/xobs/gists{/gist_id}", "starred_url": "https://api.github.com/users/xobs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xobs/subscriptions", "organizations_url": "https://api.github.com/users/xobs/orgs", "repos_url": "https://api.github.com/users/xobs/repos", "events_url": "https://api.github.com/users/xobs/events{/privacy}", "received_events_url": "https://api.github.com/users/xobs/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "989b806f61cf12840ddcd8b2bf16d6bef055bd01", "url": "https://api.github.com/repos/rust-lang/rust/commits/989b806f61cf12840ddcd8b2bf16d6bef055bd01", "html_url": "https://github.com/rust-lang/rust/commit/989b806f61cf12840ddcd8b2bf16d6bef055bd01"}], "stats": {"total": 25, "additions": 25, "deletions": 0}, "files": [{"sha": "07d5edc0a84f9acdcf71788afd1c8015805412cc", "filename": "compiler/rustc_target/src/spec/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9f6e6872c21a467af8946381e40b9021cf18066c/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f6e6872c21a467af8946381e40b9021cf18066c/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs?ref=9f6e6872c21a467af8946381e40b9021cf18066c", "patch": "@@ -983,6 +983,7 @@ supported_targets! {\n     (\"riscv32imc-unknown-none-elf\", riscv32imc_unknown_none_elf),\n     (\"riscv32imc-esp-espidf\", riscv32imc_esp_espidf),\n     (\"riscv32imac-unknown-none-elf\", riscv32imac_unknown_none_elf),\n+    (\"riscv32imac-unknown-xous-elf\", riscv32imac_unknown_xous_elf),\n     (\"riscv32gc-unknown-linux-gnu\", riscv32gc_unknown_linux_gnu),\n     (\"riscv32gc-unknown-linux-musl\", riscv32gc_unknown_linux_musl),\n     (\"riscv64imac-unknown-none-elf\", riscv64imac_unknown_none_elf),"}, {"sha": "b46ca159370d01517f897bb9b62a258387f05eed", "filename": "compiler/rustc_target/src/spec/riscv32imac_unknown_xous_elf.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/9f6e6872c21a467af8946381e40b9021cf18066c/compiler%2Frustc_target%2Fsrc%2Fspec%2Friscv32imac_unknown_xous_elf.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f6e6872c21a467af8946381e40b9021cf18066c/compiler%2Frustc_target%2Fsrc%2Fspec%2Friscv32imac_unknown_xous_elf.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Friscv32imac_unknown_xous_elf.rs?ref=9f6e6872c21a467af8946381e40b9021cf18066c", "patch": "@@ -0,0 +1,24 @@\n+use crate::spec::{LinkerFlavor, LldFlavor, PanicStrategy, RelocModel};\n+use crate::spec::{Target, TargetOptions};\n+\n+pub fn target() -> Target {\n+    Target {\n+        data_layout: \"e-m:e-p:32:32-i64:64-n32-S128\".into(),\n+        llvm_target: \"riscv32\".into(),\n+        pointer_width: 32,\n+        arch: \"riscv32\".into(),\n+\n+        options: TargetOptions {\n+            os: \"xous\".into(),\n+            linker_flavor: LinkerFlavor::Lld(LldFlavor::Ld),\n+            linker: Some(\"rust-lld\".into()),\n+            cpu: \"generic-rv32\".into(),\n+            max_atomic_width: Some(32),\n+            features: \"+m,+a,+c\".into(),\n+            executables: true,\n+            panic_strategy: PanicStrategy::Abort,\n+            relocation_model: RelocModel::Static,\n+            ..Default::default()\n+        },\n+    }\n+}"}]}