{"sha": "5ae945662994a44cab52f209801ba577eb03b578", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVhZTk0NTY2Mjk5NGE0NGNhYjUyZjIwOTgwMWJhNTc3ZWIwM2I1Nzg=", "commit": {"author": {"name": "Steve Klabnik", "email": "steve@steveklabnik.com", "date": "2015-10-13T17:09:52Z"}, "committer": {"name": "Steve Klabnik", "email": "steve@steveklabnik.com", "date": "2015-10-13T17:09:52Z"}, "message": "Rollup merge of #28988 - ahmedcharles:liballoc_jemalloc, r=nrc", "tree": {"sha": "dbf01c4847dcc341505a1b0fcb7f81a41846bbc4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dbf01c4847dcc341505a1b0fcb7f81a41846bbc4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5ae945662994a44cab52f209801ba577eb03b578", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5ae945662994a44cab52f209801ba577eb03b578", "html_url": "https://github.com/rust-lang/rust/commit/5ae945662994a44cab52f209801ba577eb03b578", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5ae945662994a44cab52f209801ba577eb03b578/comments", "author": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "committer": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ec4362da562a4b591a7d120c6677e14ea713481a", "url": "https://api.github.com/repos/rust-lang/rust/commits/ec4362da562a4b591a7d120c6677e14ea713481a", "html_url": "https://github.com/rust-lang/rust/commit/ec4362da562a4b591a7d120c6677e14ea713481a"}, {"sha": "5ea1f9ffed96d416eb877dfe8d031cd8c9478c6e", "url": "https://api.github.com/repos/rust-lang/rust/commits/5ea1f9ffed96d416eb877dfe8d031cd8c9478c6e", "html_url": "https://github.com/rust-lang/rust/commit/5ea1f9ffed96d416eb877dfe8d031cd8c9478c6e"}], "stats": {"total": 33, "additions": 22, "deletions": 11}, "files": [{"sha": "f46b12e80c56ada9cae738e5b6934bd2e4b4b85f", "filename": "src/liballoc_jemalloc/lib.rs", "status": "modified", "additions": 22, "deletions": 11, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/5ae945662994a44cab52f209801ba577eb03b578/src%2Fliballoc_jemalloc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ae945662994a44cab52f209801ba577eb03b578/src%2Fliballoc_jemalloc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc_jemalloc%2Flib.rs?ref=5ae945662994a44cab52f209801ba577eb03b578", "patch": "@@ -43,8 +43,7 @@ use libc::{c_int, c_void, size_t};\n extern {\n     fn je_mallocx(size: size_t, flags: c_int) -> *mut c_void;\n     fn je_rallocx(ptr: *mut c_void, size: size_t, flags: c_int) -> *mut c_void;\n-    fn je_xallocx(ptr: *mut c_void, size: size_t, extra: size_t,\n-                  flags: c_int) -> size_t;\n+    fn je_xallocx(ptr: *mut c_void, size: size_t, extra: size_t, flags: c_int) -> size_t;\n     fn je_sdallocx(ptr: *mut c_void, size: size_t, flags: c_int);\n     fn je_nallocx(size: size_t, flags: c_int) -> size_t;\n }\n@@ -63,40 +62,52 @@ const MIN_ALIGN: usize = 8;\n const MIN_ALIGN: usize = 16;\n \n // MALLOCX_ALIGN(a) macro\n-fn mallocx_align(a: usize) -> c_int { a.trailing_zeros() as c_int }\n+fn mallocx_align(a: usize) -> c_int {\n+    a.trailing_zeros() as c_int\n+}\n \n fn align_to_flags(align: usize) -> c_int {\n-    if align <= MIN_ALIGN { 0 } else { mallocx_align(align) }\n+    if align <= MIN_ALIGN {\n+        0\n+    } else {\n+        mallocx_align(align)\n+    }\n }\n \n #[no_mangle]\n-pub extern fn __rust_allocate(size: usize, align: usize) -> *mut u8 {\n+pub extern \"C\" fn __rust_allocate(size: usize, align: usize) -> *mut u8 {\n     let flags = align_to_flags(align);\n     unsafe { je_mallocx(size as size_t, flags) as *mut u8 }\n }\n \n #[no_mangle]\n-pub extern fn __rust_reallocate(ptr: *mut u8, _old_size: usize, size: usize,\n-                                align: usize) -> *mut u8 {\n+pub extern \"C\" fn __rust_reallocate(ptr: *mut u8,\n+                                    _old_size: usize,\n+                                    size: usize,\n+                                    align: usize)\n+                                    -> *mut u8 {\n     let flags = align_to_flags(align);\n     unsafe { je_rallocx(ptr as *mut c_void, size as size_t, flags) as *mut u8 }\n }\n \n #[no_mangle]\n-pub extern fn __rust_reallocate_inplace(ptr: *mut u8, _old_size: usize,\n-                                        size: usize, align: usize) -> usize {\n+pub extern \"C\" fn __rust_reallocate_inplace(ptr: *mut u8,\n+                                            _old_size: usize,\n+                                            size: usize,\n+                                            align: usize)\n+                                            -> usize {\n     let flags = align_to_flags(align);\n     unsafe { je_xallocx(ptr as *mut c_void, size as size_t, 0, flags) as usize }\n }\n \n #[no_mangle]\n-pub extern fn __rust_deallocate(ptr: *mut u8, old_size: usize, align: usize) {\n+pub extern \"C\" fn __rust_deallocate(ptr: *mut u8, old_size: usize, align: usize) {\n     let flags = align_to_flags(align);\n     unsafe { je_sdallocx(ptr as *mut c_void, old_size as size_t, flags) }\n }\n \n #[no_mangle]\n-pub extern fn __rust_usable_size(size: usize, align: usize) -> usize {\n+pub extern \"C\" fn __rust_usable_size(size: usize, align: usize) -> usize {\n     let flags = align_to_flags(align);\n     unsafe { je_nallocx(size as size_t, flags) as usize }\n }"}]}