{"sha": "05cd26b22dc1981e89495bc5ad2282aaaec60c51", "node_id": "C_kwDOAAsO6NoAKDA1Y2QyNmIyMmRjMTk4MWU4OTQ5NWJjNWFkMjI4MmFhYWVjNjBjNTE", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev+love@gmail.com", "date": "2022-11-13T07:41:46Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-13T07:41:46Z"}, "message": "Rollup merge of #104345 - fmease:fix-up-a-fluent-message, r=compiler-errors\n\nFix up a Fluent message\n\nFix up a Fluent message which contained arrows `->` after [selectors](https://projectfluent.org/fluent/guide/selectors.html). The original author probably thought that they were required as part of the selector syntax but in reality they were interpreted as literal text and actually showed up in the emitted diagnostic.\n\nThis wasn't caught during the diagnostic migration since the branch constructing the diagnostic in question (`rustc_infer::errors::LifetimeMismatchLabels::Normal`) was not exercised by the UI test suite. I've added two more test cases to do so (one testing `LifetimeMismatchLabels::Normal` where `hir_equal == true` and one where `hir_equal == false`).\n\nDiff visualizing the `->` bug (`master` vs `fix-up-a-fluent-message`):\n\n```diff\n error[E0623]: lifetime mismatch\n   --> src/test/ui/implied-bounds/hrlt-implied-trait-bounds-guard.rs:39:30\n    |\n 39 | fn badboi3<'in_, 'out, T>(a: Foo<'in_, 'out, (&'in_ T, &'out T)>, sadness: &'in_ T) {\n    |                              ^^^^^^^^^^^^^^^^^-------^^-------^^\n    |                              |                |\n    |                              |                these two types are declared with different lifetimes...\n-   |                              ...but data->  from `a` flows->  into `a` here\n+   |                              ...but data from `a` flows into `a` here\n```", "tree": {"sha": "f92b17611da7e153fceb6e0b33419b4bd0f523a1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f92b17611da7e153fceb6e0b33419b4bd0f523a1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/05cd26b22dc1981e89495bc5ad2282aaaec60c51", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjcJ+6CRBK7hj4Ov3rIwAAssEIAJeLR87EUj5OkNFLBAEh9vcD\nIXqbOFCJ5QgP2RTdl9FUv+VW2RApAoSLp9pQYFj80VoNmZv3MkOjohjDIGUi3x5O\nlYEyZWWDwCMGyBjQEhlYalrUgRzBbRtSIPQGxumKwlVMvxeu3BILD8AKrBSuLMaU\ntQfPOwKnCOHbZPH32OU8CA5oTcS0qgpRvZq00c0idnV+bp6CJSZcVxiCUZntsogd\nXxL6qHbu5hBTMZRhi4iI11ijz54gvJKwTrOQbiv/2q3M++Dy6UbCMD+4SRE2Booy\n7CZ6zjjDJ7/iTwELDYsTzxqmCy5c2dboJ18hZm2yFAsFqt7WzzfHq4AdSNtM5+4=\n=fAbs\n-----END PGP SIGNATURE-----\n", "payload": "tree f92b17611da7e153fceb6e0b33419b4bd0f523a1\nparent 0d2e94a9f1aefc7e889fabf973b4200c8d728fa7\nparent 23dadb561783870be104b26fd8db9a9d2abfb0ac\nauthor Yuki Okushi <huyuumi.dev+love@gmail.com> 1668325306 +0900\ncommitter GitHub <noreply@github.com> 1668325306 +0900\n\nRollup merge of #104345 - fmease:fix-up-a-fluent-message, r=compiler-errors\n\nFix up a Fluent message\n\nFix up a Fluent message which contained arrows `->` after [selectors](https://projectfluent.org/fluent/guide/selectors.html). The original author probably thought that they were required as part of the selector syntax but in reality they were interpreted as literal text and actually showed up in the emitted diagnostic.\n\nThis wasn't caught during the diagnostic migration since the branch constructing the diagnostic in question (`rustc_infer::errors::LifetimeMismatchLabels::Normal`) was not exercised by the UI test suite. I've added two more test cases to do so (one testing `LifetimeMismatchLabels::Normal` where `hir_equal == true` and one where `hir_equal == false`).\n\nDiff visualizing the `->` bug (`master` vs `fix-up-a-fluent-message`):\n\n```diff\n error[E0623]: lifetime mismatch\n   --> src/test/ui/implied-bounds/hrlt-implied-trait-bounds-guard.rs:39:30\n    |\n 39 | fn badboi3<'in_, 'out, T>(a: Foo<'in_, 'out, (&'in_ T, &'out T)>, sadness: &'in_ T) {\n    |                              ^^^^^^^^^^^^^^^^^-------^^-------^^\n    |                              |                |\n    |                              |                these two types are declared with different lifetimes...\n-   |                              ...but data->  from `a` flows->  into `a` here\n+   |                              ...but data from `a` flows into `a` here\n```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/05cd26b22dc1981e89495bc5ad2282aaaec60c51", "html_url": "https://github.com/rust-lang/rust/commit/05cd26b22dc1981e89495bc5ad2282aaaec60c51", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/05cd26b22dc1981e89495bc5ad2282aaaec60c51/comments", "author": null, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0d2e94a9f1aefc7e889fabf973b4200c8d728fa7", "url": "https://api.github.com/repos/rust-lang/rust/commits/0d2e94a9f1aefc7e889fabf973b4200c8d728fa7", "html_url": "https://github.com/rust-lang/rust/commit/0d2e94a9f1aefc7e889fabf973b4200c8d728fa7"}, {"sha": "23dadb561783870be104b26fd8db9a9d2abfb0ac", "url": "https://api.github.com/repos/rust-lang/rust/commits/23dadb561783870be104b26fd8db9a9d2abfb0ac", "html_url": "https://github.com/rust-lang/rust/commit/23dadb561783870be104b26fd8db9a9d2abfb0ac"}], "stats": {"total": 34, "additions": 31, "deletions": 3}, "files": [{"sha": "c9d83746d5454debb5f9e21fb847cc1a3cd863bb", "filename": "compiler/rustc_error_messages/locales/en-US/infer.ftl", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/05cd26b22dc1981e89495bc5ad2282aaaec60c51/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Finfer.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/05cd26b22dc1981e89495bc5ad2282aaaec60c51/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Finfer.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Finfer.ftl?ref=05cd26b22dc1981e89495bc5ad2282aaaec60c51", "patch": "@@ -126,10 +126,10 @@ infer_data_lifetime_flow = ...but data with one lifetime flows into the other he\n infer_declared_multiple = this type is declared with multiple lifetimes...\n infer_types_declared_different = these two types are declared with different lifetimes...\n infer_data_flows = ...but data{$label_var1_exists ->\n-    [true] -> {\" \"}from `{$label_var1}`\n+    [true] {\" \"}from `{$label_var1}`\n     *[false] -> {\"\"}\n } flows{$label_var2_exists ->\n-    [true] -> {\" \"}into `{$label_var2}`\n+    [true] {\" \"}into `{$label_var2}`\n     *[false] -> {\"\"}\n } here\n "}, {"sha": "79844dcbdacfd78aeca94de81b46ea5654dc58b6", "filename": "src/test/ui/implied-bounds/hrlt-implied-trait-bounds-guard.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/05cd26b22dc1981e89495bc5ad2282aaaec60c51/src%2Ftest%2Fui%2Fimplied-bounds%2Fhrlt-implied-trait-bounds-guard.rs", "raw_url": "https://github.com/rust-lang/rust/raw/05cd26b22dc1981e89495bc5ad2282aaaec60c51/src%2Ftest%2Fui%2Fimplied-bounds%2Fhrlt-implied-trait-bounds-guard.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimplied-bounds%2Fhrlt-implied-trait-bounds-guard.rs?ref=05cd26b22dc1981e89495bc5ad2282aaaec60c51", "patch": "@@ -31,6 +31,16 @@ fn badboi<'in_, 'out, T>(x: Foo<'in_, 'out, T>, sadness: &'in_ T) -> &'out T {\n     sadness.cast()\n }\n \n+fn badboi2<'in_, 'out, T>(x: Foo<'in_, 'out, T>, sadness: &'in_ T) {\n+    //~^ ERROR lifetime mismatch\n+    let _: &'out T = sadness.cast();\n+}\n+\n+fn badboi3<'in_, 'out, T>(a: Foo<'in_, 'out, (&'in_ T, &'out T)>, sadness: &'in_ T) {\n+    //~^ ERROR lifetime mismatch\n+    let _: &'out T = sadness.cast();\n+}\n+\n fn bad<'short, T>(value: &'short T) -> &'static T {\n     let x: for<'in_, 'out> fn(Foo<'in_, 'out, T>, &'in_ T) -> &'out T = badboi;\n     let x: for<'out> fn(Foo<'short, 'out, T>, &'short T) -> &'out T = x;"}, {"sha": "0c00bbc380e8a2fb8c6506391dc07b8400125f92", "filename": "src/test/ui/implied-bounds/hrlt-implied-trait-bounds-guard.stderr", "status": "modified", "additions": 19, "deletions": 1, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/05cd26b22dc1981e89495bc5ad2282aaaec60c51/src%2Ftest%2Fui%2Fimplied-bounds%2Fhrlt-implied-trait-bounds-guard.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/05cd26b22dc1981e89495bc5ad2282aaaec60c51/src%2Ftest%2Fui%2Fimplied-bounds%2Fhrlt-implied-trait-bounds-guard.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimplied-bounds%2Fhrlt-implied-trait-bounds-guard.stderr?ref=05cd26b22dc1981e89495bc5ad2282aaaec60c51", "patch": "@@ -7,6 +7,24 @@ LL | fn badboi<'in_, 'out, T>(x: Foo<'in_, 'out, T>, sadness: &'in_ T) -> &'out\n    |                             this parameter and the return type are declared with different lifetimes...\n    |                             ...but data from `x` is returned here\n \n-error: aborting due to previous error\n+error[E0623]: lifetime mismatch\n+  --> $DIR/hrlt-implied-trait-bounds-guard.rs:34:30\n+   |\n+LL | fn badboi2<'in_, 'out, T>(x: Foo<'in_, 'out, T>, sadness: &'in_ T) {\n+   |                              ^^^^^^^^^^^^^^^^^^\n+   |                              |\n+   |                              this type is declared with multiple lifetimes...\n+   |                              ...but data with one lifetime flows into the other here\n+\n+error[E0623]: lifetime mismatch\n+  --> $DIR/hrlt-implied-trait-bounds-guard.rs:39:30\n+   |\n+LL | fn badboi3<'in_, 'out, T>(a: Foo<'in_, 'out, (&'in_ T, &'out T)>, sadness: &'in_ T) {\n+   |                              ^^^^^^^^^^^^^^^^^-------^^-------^^\n+   |                              |                |\n+   |                              |                these two types are declared with different lifetimes...\n+   |                              ...but data from `a` flows into `a` here\n+\n+error: aborting due to 3 previous errors\n \n For more information about this error, try `rustc --explain E0623`."}]}