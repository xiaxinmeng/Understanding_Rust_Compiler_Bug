{"sha": "f7330eb752cdd83a9b944d1d64a092c7d2454c17", "node_id": "C_kwDOAAsO6NoAKGY3MzMwZWI3NTJjZGQ4M2E5Yjk0NGQxZDY0YTA5MmM3ZDI0NTRjMTc", "commit": {"author": {"name": "bohan", "email": "bohan-zhang@foxmail.com", "date": "2023-06-13T16:55:36Z"}, "committer": {"name": "bohan", "email": "bohan-zhang@foxmail.com", "date": "2023-06-13T17:38:35Z"}, "message": "fix(resolve): update `shadowed_glob` more precision", "tree": {"sha": "474d4ef8c1c9e0a2bb395aaaf5074b9a904ce665", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/474d4ef8c1c9e0a2bb395aaaf5074b9a904ce665"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f7330eb752cdd83a9b944d1d64a092c7d2454c17", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f7330eb752cdd83a9b944d1d64a092c7d2454c17", "html_url": "https://github.com/rust-lang/rust/commit/f7330eb752cdd83a9b944d1d64a092c7d2454c17", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f7330eb752cdd83a9b944d1d64a092c7d2454c17/comments", "author": {"login": "bvanjoi", "id": 30187863, "node_id": "MDQ6VXNlcjMwMTg3ODYz", "avatar_url": "https://avatars.githubusercontent.com/u/30187863?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bvanjoi", "html_url": "https://github.com/bvanjoi", "followers_url": "https://api.github.com/users/bvanjoi/followers", "following_url": "https://api.github.com/users/bvanjoi/following{/other_user}", "gists_url": "https://api.github.com/users/bvanjoi/gists{/gist_id}", "starred_url": "https://api.github.com/users/bvanjoi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bvanjoi/subscriptions", "organizations_url": "https://api.github.com/users/bvanjoi/orgs", "repos_url": "https://api.github.com/users/bvanjoi/repos", "events_url": "https://api.github.com/users/bvanjoi/events{/privacy}", "received_events_url": "https://api.github.com/users/bvanjoi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bvanjoi", "id": 30187863, "node_id": "MDQ6VXNlcjMwMTg3ODYz", "avatar_url": "https://avatars.githubusercontent.com/u/30187863?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bvanjoi", "html_url": "https://github.com/bvanjoi", "followers_url": "https://api.github.com/users/bvanjoi/followers", "following_url": "https://api.github.com/users/bvanjoi/following{/other_user}", "gists_url": "https://api.github.com/users/bvanjoi/gists{/gist_id}", "starred_url": "https://api.github.com/users/bvanjoi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bvanjoi/subscriptions", "organizations_url": "https://api.github.com/users/bvanjoi/orgs", "repos_url": "https://api.github.com/users/bvanjoi/repos", "events_url": "https://api.github.com/users/bvanjoi/events{/privacy}", "received_events_url": "https://api.github.com/users/bvanjoi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4bd4e2ea824f4f458cae8917047ebb6b88853fe6", "url": "https://api.github.com/repos/rust-lang/rust/commits/4bd4e2ea824f4f458cae8917047ebb6b88853fe6", "html_url": "https://github.com/rust-lang/rust/commit/4bd4e2ea824f4f458cae8917047ebb6b88853fe6"}], "stats": {"total": 57, "additions": 55, "deletions": 2}, "files": [{"sha": "47d8e5993fd825e1a02d81f94d606dcf72e037b5", "filename": "compiler/rustc_resolve/src/imports.rs", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/f7330eb752cdd83a9b944d1d64a092c7d2454c17/compiler%2Frustc_resolve%2Fsrc%2Fimports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f7330eb752cdd83a9b944d1d64a092c7d2454c17/compiler%2Frustc_resolve%2Fsrc%2Fimports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fimports.rs?ref=f7330eb752cdd83a9b944d1d64a092c7d2454c17", "patch": "@@ -338,7 +338,21 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n                         } else {\n                             resolution.binding = Some(nonglob_binding);\n                         }\n-                        resolution.shadowed_glob = Some(glob_binding);\n+\n+                        if let Some(old_binding) = resolution.shadowed_glob {\n+                            assert!(old_binding.is_glob_import());\n+                            if glob_binding.res() != old_binding.res() {\n+                                resolution.shadowed_glob = Some(this.ambiguity(\n+                                    AmbiguityKind::GlobVsGlob,\n+                                    old_binding,\n+                                    glob_binding,\n+                                ));\n+                            } else if !old_binding.vis.is_at_least(binding.vis, this.tcx) {\n+                                resolution.shadowed_glob = Some(glob_binding);\n+                            }\n+                        } else {\n+                            resolution.shadowed_glob = Some(glob_binding);\n+                        }\n                     }\n                     (false, false) => {\n                         return Err(old_binding);"}, {"sha": "a049cac830ab4acc32313f36fa60b924b73d7728", "filename": "tests/ui/resolve/issue-105069.stderr", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f7330eb752cdd83a9b944d1d64a092c7d2454c17/tests%2Fui%2Fresolve%2Fissue-105069.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f7330eb752cdd83a9b944d1d64a092c7d2454c17/tests%2Fui%2Fresolve%2Fissue-105069.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fresolve%2Fissue-105069.stderr?ref=f7330eb752cdd83a9b944d1d64a092c7d2454c17", "patch": "@@ -4,17 +4,19 @@ error[E0659]: `V` is ambiguous\n LL | use V;\n    |     ^ ambiguous name\n    |\n-   = note: ambiguous because of multiple potential import sources\n+   = note: ambiguous because of multiple glob imports of a name in the same module\n note: `V` could refer to the variant imported here\n   --> $DIR/issue-105069.rs:1:5\n    |\n LL | use self::A::*;\n    |     ^^^^^^^^^^\n+   = help: consider adding an explicit import of `V` to disambiguate\n note: `V` could also refer to the variant imported here\n   --> $DIR/issue-105069.rs:3:5\n    |\n LL | use self::B::*;\n    |     ^^^^^^^^^^\n+   = help: consider adding an explicit import of `V` to disambiguate\n \n error: aborting due to previous error\n "}, {"sha": "bff6c911236e641772c0d0a2c906ecd7e7cb0a3d", "filename": "tests/ui/resolve/issue-109153.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/f7330eb752cdd83a9b944d1d64a092c7d2454c17/tests%2Fui%2Fresolve%2Fissue-109153.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f7330eb752cdd83a9b944d1d64a092c7d2454c17/tests%2Fui%2Fresolve%2Fissue-109153.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fresolve%2Fissue-109153.rs?ref=f7330eb752cdd83a9b944d1d64a092c7d2454c17", "patch": "@@ -0,0 +1,14 @@\n+use foo::*;\n+\n+mod foo {\n+    pub mod bar {\n+        pub mod bar {\n+            pub mod bar {}\n+        }\n+    }\n+}\n+\n+use bar::bar; //~ ERROR `bar` is ambiguous\n+use bar::*;\n+\n+fn main() { }"}, {"sha": "1a345d2a3e3a71ad6c2754b8d793be55952c822e", "filename": "tests/ui/resolve/issue-109153.stderr", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/f7330eb752cdd83a9b944d1d64a092c7d2454c17/tests%2Fui%2Fresolve%2Fissue-109153.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f7330eb752cdd83a9b944d1d64a092c7d2454c17/tests%2Fui%2Fresolve%2Fissue-109153.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fresolve%2Fissue-109153.stderr?ref=f7330eb752cdd83a9b944d1d64a092c7d2454c17", "patch": "@@ -0,0 +1,23 @@\n+error[E0659]: `bar` is ambiguous\n+  --> $DIR/issue-109153.rs:11:5\n+   |\n+LL | use bar::bar;\n+   |     ^^^ ambiguous name\n+   |\n+   = note: ambiguous because of multiple glob imports of a name in the same module\n+note: `bar` could refer to the module imported here\n+  --> $DIR/issue-109153.rs:1:5\n+   |\n+LL | use foo::*;\n+   |     ^^^^^^\n+   = help: consider adding an explicit import of `bar` to disambiguate\n+note: `bar` could also refer to the module imported here\n+  --> $DIR/issue-109153.rs:12:5\n+   |\n+LL | use bar::*;\n+   |     ^^^^^^\n+   = help: consider adding an explicit import of `bar` to disambiguate\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0659`."}]}