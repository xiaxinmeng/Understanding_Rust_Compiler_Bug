{"sha": "1911eb8b6180f513a666372baf6e56f78b82dcd8", "node_id": "C_kwDOAAsO6NoAKDE5MTFlYjhiNjE4MGY1MTNhNjY2MzcyYmFmNmU1NmY3OGI4MmRjZDg", "commit": {"author": {"name": "Jacob Pratt", "email": "jacob@jhpratt.dev", "date": "2021-11-18T02:08:16Z"}, "committer": {"name": "Jacob Pratt", "email": "jacob@jhpratt.dev", "date": "2022-02-04T00:15:57Z"}, "message": "Add missing const stability attributes", "tree": {"sha": "8b46f6a3188316dda2ed117e5414ee2de79fc914", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8b46f6a3188316dda2ed117e5414ee2de79fc914"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1911eb8b6180f513a666372baf6e56f78b82dcd8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYKAB0WIQTgxeqBxcDGar1sVhy4DhnkZitapAUCYfxwPQAKCRC4DhnkZita\npEw3AP4zZVtDnUNHeWw7Quxjc9dcSAY5rejGz0Qw4rrwn3r+xwEAo3zRotQuFzfr\nq9gbayd/N/jK2ThDRdSej1zRB0CnJQs=\n=pGBN\n-----END PGP SIGNATURE-----", "payload": "tree 8b46f6a3188316dda2ed117e5414ee2de79fc914\nparent 41f84c258ad5fc12775e25aafe4d67e3304a5bda\nauthor Jacob Pratt <jacob@jhpratt.dev> 1637201296 -0500\ncommitter Jacob Pratt <jacob@jhpratt.dev> 1643933757 -0500\n\nAdd missing const stability attributes\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1911eb8b6180f513a666372baf6e56f78b82dcd8", "html_url": "https://github.com/rust-lang/rust/commit/1911eb8b6180f513a666372baf6e56f78b82dcd8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1911eb8b6180f513a666372baf6e56f78b82dcd8/comments", "author": {"login": "jhpratt", "id": 3161395, "node_id": "MDQ6VXNlcjMxNjEzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/3161395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhpratt", "html_url": "https://github.com/jhpratt", "followers_url": "https://api.github.com/users/jhpratt/followers", "following_url": "https://api.github.com/users/jhpratt/following{/other_user}", "gists_url": "https://api.github.com/users/jhpratt/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhpratt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhpratt/subscriptions", "organizations_url": "https://api.github.com/users/jhpratt/orgs", "repos_url": "https://api.github.com/users/jhpratt/repos", "events_url": "https://api.github.com/users/jhpratt/events{/privacy}", "received_events_url": "https://api.github.com/users/jhpratt/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jhpratt", "id": 3161395, "node_id": "MDQ6VXNlcjMxNjEzOTU=", "avatar_url": "https://avatars.githubusercontent.com/u/3161395?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jhpratt", "html_url": "https://github.com/jhpratt", "followers_url": "https://api.github.com/users/jhpratt/followers", "following_url": "https://api.github.com/users/jhpratt/following{/other_user}", "gists_url": "https://api.github.com/users/jhpratt/gists{/gist_id}", "starred_url": "https://api.github.com/users/jhpratt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jhpratt/subscriptions", "organizations_url": "https://api.github.com/users/jhpratt/orgs", "repos_url": "https://api.github.com/users/jhpratt/repos", "events_url": "https://api.github.com/users/jhpratt/events{/privacy}", "received_events_url": "https://api.github.com/users/jhpratt/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "41f84c258ad5fc12775e25aafe4d67e3304a5bda", "url": "https://api.github.com/repos/rust-lang/rust/commits/41f84c258ad5fc12775e25aafe4d67e3304a5bda", "html_url": "https://github.com/rust-lang/rust/commit/41f84c258ad5fc12775e25aafe4d67e3304a5bda"}], "stats": {"total": 21, "additions": 14, "deletions": 7}, "files": [{"sha": "ee79021ed536e69555e6a8ba2c470549143fd7e8", "filename": "library/core/src/array/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1911eb8b6180f513a666372baf6e56f78b82dcd8/library%2Fcore%2Fsrc%2Farray%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1911eb8b6180f513a666372baf6e56f78b82dcd8/library%2Fcore%2Fsrc%2Farray%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Farray%2Fmod.rs?ref=1911eb8b6180f513a666372baf6e56f78b82dcd8", "patch": "@@ -512,6 +512,7 @@ impl<T, const N: usize> [T; N] {\n \n     /// Returns a slice containing the entire array. Equivalent to `&s[..]`.\n     #[stable(feature = \"array_as_slice\", since = \"1.57.0\")]\n+    #[rustc_const_stable(feature = \"array_as_slice\", since = \"1.57.0\")]\n     pub const fn as_slice(&self) -> &[T] {\n         self\n     }"}, {"sha": "feb9455565844ae5ae127568fb80eae4bc6ee170", "filename": "library/core/src/cell.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1911eb8b6180f513a666372baf6e56f78b82dcd8/library%2Fcore%2Fsrc%2Fcell.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1911eb8b6180f513a666372baf6e56f78b82dcd8/library%2Fcore%2Fsrc%2Fcell.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fcell.rs?ref=1911eb8b6180f513a666372baf6e56f78b82dcd8", "patch": "@@ -1959,6 +1959,7 @@ impl<T: ?Sized> UnsafeCell<T> {\n     /// ```\n     #[inline(always)]\n     #[stable(feature = \"unsafe_cell_raw_get\", since = \"1.56.0\")]\n+    #[rustc_const_stable(feature = \"unsafe_cell_raw_get\", since = \"1.56.0\")]\n     pub const fn raw_get(this: *const Self) -> *mut T {\n         // We can just cast the pointer from `UnsafeCell<T>` to `T` because of\n         // #[repr(transparent)]. This exploits libstd's special status, there is"}, {"sha": "3164b0c5d3cc6dbc263fe78243bfc90a5182efdf", "filename": "library/core/src/num/int_macros.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1911eb8b6180f513a666372baf6e56f78b82dcd8/library%2Fcore%2Fsrc%2Fnum%2Fint_macros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1911eb8b6180f513a666372baf6e56f78b82dcd8/library%2Fcore%2Fsrc%2Fnum%2Fint_macros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fnum%2Fint_macros.rs?ref=1911eb8b6180f513a666372baf6e56f78b82dcd8", "patch": "@@ -1064,6 +1064,7 @@ macro_rules! int_impl {\n         ///\n         /// ```\n         #[stable(feature = \"saturating_div\", since = \"1.58.0\")]\n+        #[rustc_const_stable(feature = \"saturating_div\", since = \"1.58.0\")]\n         #[must_use = \"this returns the result of the operation, \\\n                       without modifying the original\"]\n         #[inline]"}, {"sha": "1ebd1c58f2b59dc3b8b02e743becc57cc17b6ed3", "filename": "library/core/src/num/nonzero.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1911eb8b6180f513a666372baf6e56f78b82dcd8/library%2Fcore%2Fsrc%2Fnum%2Fnonzero.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1911eb8b6180f513a666372baf6e56f78b82dcd8/library%2Fcore%2Fsrc%2Fnum%2Fnonzero.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fnum%2Fnonzero.rs?ref=1911eb8b6180f513a666372baf6e56f78b82dcd8", "patch": "@@ -972,6 +972,7 @@ macro_rules! nonzero_unsigned_is_power_of_two {\n                 /// ```\n                 #[must_use]\n                 #[stable(feature = \"nonzero_is_power_of_two\", since = \"1.59.0\")]\n+                #[rustc_const_stable(feature = \"nonzero_is_power_of_two\", since = \"1.59.0\")]\n                 #[inline]\n                 pub const fn is_power_of_two(self) -> bool {\n                     // LLVM 11 normalizes `unchecked_sub(x, 1) & x == 0` to the implementation seen here."}, {"sha": "c1a134e68cde7b7e2498b932f0e35b5f83566f73", "filename": "library/core/src/num/uint_macros.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1911eb8b6180f513a666372baf6e56f78b82dcd8/library%2Fcore%2Fsrc%2Fnum%2Fuint_macros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1911eb8b6180f513a666372baf6e56f78b82dcd8/library%2Fcore%2Fsrc%2Fnum%2Fuint_macros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fnum%2Fuint_macros.rs?ref=1911eb8b6180f513a666372baf6e56f78b82dcd8", "patch": "@@ -1132,6 +1132,7 @@ macro_rules! uint_impl {\n         ///\n         /// ```\n         #[stable(feature = \"saturating_div\", since = \"1.58.0\")]\n+        #[rustc_const_stable(feature = \"saturating_div\", since = \"1.58.0\")]\n         #[must_use = \"this returns the result of the operation, \\\n                       without modifying the original\"]\n         #[inline]"}, {"sha": "57e64737d0faa53ae4f203234006c37f9761ab9b", "filename": "src/test/ui/stability-attribute/missing-const-stability.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/1911eb8b6180f513a666372baf6e56f78b82dcd8/src%2Ftest%2Fui%2Fstability-attribute%2Fmissing-const-stability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1911eb8b6180f513a666372baf6e56f78b82dcd8/src%2Ftest%2Fui%2Fstability-attribute%2Fmissing-const-stability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstability-attribute%2Fmissing-const-stability.rs?ref=1911eb8b6180f513a666372baf6e56f78b82dcd8", "patch": "@@ -1,11 +1,12 @@\n #![feature(staged_api)]\n+#![feature(const_trait_impl)]\n #![stable(feature = \"stable\", since = \"1.0.0\")]\n \n #[stable(feature = \"stable\", since = \"1.0.0\")]\n pub const fn foo() {} //~ ERROR function has missing const stability attribute\n \n #[unstable(feature = \"unstable\", issue = \"none\")]\n-pub const fn bar() {} // ok for now\n+pub const fn bar() {} // ok because function is unstable\n \n #[stable(feature = \"stable\", since = \"1.0.0\")]\n pub struct Foo;\n@@ -14,11 +15,12 @@ impl Foo {\n     pub const fn foo() {} //~ ERROR associated function has missing const stability attribute\n \n     #[unstable(feature = \"unstable\", issue = \"none\")]\n-    pub const fn bar() {} // ok for now\n+    pub const fn bar() {} // ok because function is unstable\n }\n \n-// FIXME When #![feature(const_trait_impl)] is stabilized, add tests for const\n-// trait impls. Right now, a \"trait methods cannot be stable const fn\" error is\n-// emitted, but that's not in the scope of this test.\n+// FIXME Once #![feature(const_trait_impl)] is allowed to be stable, add a test\n+// for const trait impls. Right now, a \"trait methods cannot be stable const fn\"\n+// error is emitted. This occurs prior to the lint being tested here, such that\n+// the lint cannot currently be tested on this use case.\n \n fn main() {}"}, {"sha": "7eba99a477abe0ed5a14f5933d3546c591e907a5", "filename": "src/test/ui/stability-attribute/missing-const-stability.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1911eb8b6180f513a666372baf6e56f78b82dcd8/src%2Ftest%2Fui%2Fstability-attribute%2Fmissing-const-stability.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1911eb8b6180f513a666372baf6e56f78b82dcd8/src%2Ftest%2Fui%2Fstability-attribute%2Fmissing-const-stability.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstability-attribute%2Fmissing-const-stability.stderr?ref=1911eb8b6180f513a666372baf6e56f78b82dcd8", "patch": "@@ -1,11 +1,11 @@\n error: function has missing const stability attribute\n-  --> $DIR/missing-const-stability.rs:5:1\n+  --> $DIR/missing-const-stability.rs:6:1\n    |\n LL | pub const fn foo() {}\n    | ^^^^^^^^^^^^^^^^^^^^^\n \n error: associated function has missing const stability attribute\n-  --> $DIR/missing-const-stability.rs:14:5\n+  --> $DIR/missing-const-stability.rs:15:5\n    |\n LL |     pub const fn foo() {}\n    |     ^^^^^^^^^^^^^^^^^^^^^"}]}