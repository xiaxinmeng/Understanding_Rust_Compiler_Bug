{"sha": "437338ab658d075b50538541541e3049a79f5911", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQzNzMzOGFiNjU4ZDA3NWI1MDUzODU0MTU0MWUzMDQ5YTc5ZjU5MTE=", "commit": {"author": {"name": "Guillaume Pinot", "email": "texitoi@texitoi.eu", "date": "2014-05-11T16:49:01Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-05-13T02:52:29Z"}, "message": "shootout-nbody improvement\n\n- factorize operation\n- factorize loop (and gain a level of indentation)\n- ~5% faster\n\nThanks to @Ryman for the propositions :)", "tree": {"sha": "fcede60151be93e95516facafacde7905cfc265e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fcede60151be93e95516facafacde7905cfc265e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/437338ab658d075b50538541541e3049a79f5911", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/437338ab658d075b50538541541e3049a79f5911", "html_url": "https://github.com/rust-lang/rust/commit/437338ab658d075b50538541541e3049a79f5911", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/437338ab658d075b50538541541e3049a79f5911/comments", "author": {"login": "TeXitoi", "id": 5787066, "node_id": "MDQ6VXNlcjU3ODcwNjY=", "avatar_url": "https://avatars.githubusercontent.com/u/5787066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TeXitoi", "html_url": "https://github.com/TeXitoi", "followers_url": "https://api.github.com/users/TeXitoi/followers", "following_url": "https://api.github.com/users/TeXitoi/following{/other_user}", "gists_url": "https://api.github.com/users/TeXitoi/gists{/gist_id}", "starred_url": "https://api.github.com/users/TeXitoi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TeXitoi/subscriptions", "organizations_url": "https://api.github.com/users/TeXitoi/orgs", "repos_url": "https://api.github.com/users/TeXitoi/repos", "events_url": "https://api.github.com/users/TeXitoi/events{/privacy}", "received_events_url": "https://api.github.com/users/TeXitoi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "48beab120553b2fcdaafcc2741c796d5c5169fcf", "url": "https://api.github.com/repos/rust-lang/rust/commits/48beab120553b2fcdaafcc2741c796d5c5169fcf", "html_url": "https://github.com/rust-lang/rust/commit/48beab120553b2fcdaafcc2741c796d5c5169fcf"}], "stats": {"total": 43, "additions": 20, "deletions": 23}, "files": [{"sha": "f9a84f276bf6e36bf890865f033d59b4facee7f2", "filename": "src/test/bench/shootout-nbody.rs", "status": "modified", "additions": 20, "deletions": 23, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/437338ab658d075b50538541541e3049a79f5911/src%2Ftest%2Fbench%2Fshootout-nbody.rs", "raw_url": "https://github.com/rust-lang/rust/raw/437338ab658d075b50538541541e3049a79f5911/src%2Ftest%2Fbench%2Fshootout-nbody.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fbench%2Fshootout-nbody.rs?ref=437338ab658d075b50538541541e3049a79f5911", "patch": "@@ -70,33 +70,30 @@ struct Planet {\n \n fn advance(bodies: &mut [Planet, ..N_BODIES], dt: f64, steps: int) {\n     for _ in range(0, steps) {\n-        {\n-            let mut b_slice = bodies.as_mut_slice();\n-            loop {\n-                let bi = match b_slice.mut_shift_ref() {\n-                    Some(bi) => bi,\n-                    None => break\n-                };\n-                for bj in b_slice.mut_iter() {\n-                    let dx = bi.x - bj.x;\n-                    let dy = bi.y - bj.y;\n-                    let dz = bi.z - bj.z;\n+        let mut b_slice = bodies.as_mut_slice();\n+        loop {\n+            let bi = match b_slice.mut_shift_ref() {\n+                Some(bi) => bi,\n+                None => break\n+            };\n+            for bj in b_slice.mut_iter() {\n+                let dx = bi.x - bj.x;\n+                let dy = bi.y - bj.y;\n+                let dz = bi.z - bj.z;\n \n-                    let d2 = dx * dx + dy * dy + dz * dz;\n-                    let mag = dt / (d2 * d2.sqrt());\n+                let d2 = dx * dx + dy * dy + dz * dz;\n+                let mag = dt / (d2 * d2.sqrt());\n \n-                    bi.vx -= dx * bj.mass * mag;\n-                    bi.vy -= dy * bj.mass * mag;\n-                    bi.vz -= dz * bj.mass * mag;\n+                let massj_mag = bj.mass * mag;\n+                bi.vx -= dx * massj_mag;\n+                bi.vy -= dy * massj_mag;\n+                bi.vz -= dz * massj_mag;\n \n-                    bj.vx += dx * bi.mass * mag;\n-                    bj.vy += dy * bi.mass * mag;\n-                    bj.vz += dz * bi.mass * mag;\n-                }\n+                let massi_mag = bi.mass * mag;\n+                bj.vx += dx * massi_mag;\n+                bj.vy += dy * massi_mag;\n+                bj.vz += dz * massi_mag;\n             }\n-        }\n-\n-        for bi in bodies.mut_iter() {\n             bi.x += dt * bi.vx;\n             bi.y += dt * bi.vy;\n             bi.z += dt * bi.vz;"}]}