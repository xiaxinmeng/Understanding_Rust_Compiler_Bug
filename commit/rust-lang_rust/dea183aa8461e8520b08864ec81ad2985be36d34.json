{"sha": "dea183aa8461e8520b08864ec81ad2985be36d34", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRlYTE4M2FhODQ2MWU4NTIwYjA4ODY0ZWM4MWFkMjk4NWJlMzZkMzQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-02-02T21:57:57Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-02-02T21:57:57Z"}, "message": "Auto merge of #31361 - alexcrichton:revert-mk-changes, r=brson\n\nThis reverts commit d03712977d7c913044f2b863269c4491d7fa7c36.", "tree": {"sha": "46e6fbccfe4ac876cb0c3faadc159fba97bf8d35", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/46e6fbccfe4ac876cb0c3faadc159fba97bf8d35"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dea183aa8461e8520b08864ec81ad2985be36d34", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dea183aa8461e8520b08864ec81ad2985be36d34", "html_url": "https://github.com/rust-lang/rust/commit/dea183aa8461e8520b08864ec81ad2985be36d34", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dea183aa8461e8520b08864ec81ad2985be36d34/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2dc132e4d25cf7424deddf6c33c6059d93ff5248", "url": "https://api.github.com/repos/rust-lang/rust/commits/2dc132e4d25cf7424deddf6c33c6059d93ff5248", "html_url": "https://github.com/rust-lang/rust/commit/2dc132e4d25cf7424deddf6c33c6059d93ff5248"}, {"sha": "178d4b0fd3d81983627dfeff8a9218b404140469", "url": "https://api.github.com/repos/rust-lang/rust/commits/178d4b0fd3d81983627dfeff8a9218b404140469", "html_url": "https://github.com/rust-lang/rust/commit/178d4b0fd3d81983627dfeff8a9218b404140469"}], "stats": {"total": 123, "additions": 57, "deletions": 66}, "files": [{"sha": "274f73834d42b77b9c001c24d0bb7f9f9d008539", "filename": "mk/cfg/aarch64-linux-android.mk", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fcfg%2Faarch64-linux-android.mk", "raw_url": "https://github.com/rust-lang/rust/raw/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fcfg%2Faarch64-linux-android.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fcfg%2Faarch64-linux-android.mk?ref=dea183aa8461e8520b08864ec81ad2985be36d34", "patch": "@@ -1,4 +1,5 @@\n # aarch64-linux-android configuration\n+# CROSS_PREFIX_aarch64-linux-android-\n CC_aarch64-linux-android=$(CFG_AARCH64_LINUX_ANDROID_NDK)/bin/aarch64-linux-android-gcc\n CXX_aarch64-linux-android=$(CFG_AARCH64_LINUX_ANDROID_NDK)/bin/aarch64-linux-android-g++\n CPP_aarch64-linux-android=$(CFG_AARCH64_LINUX_ANDROID_NDK)/bin/aarch64-linux-android-gcc -E"}, {"sha": "dd6080fdb0bab1ecc872a8fd9e0f1160bf37a477", "filename": "mk/cfg/x86_64-apple-ios.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fcfg%2Fx86_64-apple-ios.mk", "raw_url": "https://github.com/rust-lang/rust/raw/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fcfg%2Fx86_64-apple-ios.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fcfg%2Fx86_64-apple-ios.mk?ref=dea183aa8461e8520b08864ec81ad2985be36d34", "patch": "@@ -29,4 +29,4 @@ CFG_UNIXY_x86_64-apple-ios := 1\n CFG_LDPATH_x86_64-apple-ios :=\n CFG_RUN_x86_64-apple-ios = $(2)\n CFG_RUN_TARG_x86_64-apple-ios = $(call CFG_RUN_x86_64-apple-ios,,$(2))\n-CFG_GNU_TRIPLE_x86_64-apple-ios := x86_64-apple-ios\n+CFG_GNU_TRIPLE_i386-apple-ios := x86_64-apple-ios"}, {"sha": "afffec1a53a913a398f3c34da36e475314f0a845", "filename": "mk/cfg/x86_64-unknown-bitrig.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fcfg%2Fx86_64-unknown-bitrig.mk", "raw_url": "https://github.com/rust-lang/rust/raw/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fcfg%2Fx86_64-unknown-bitrig.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fcfg%2Fx86_64-unknown-bitrig.mk?ref=dea183aa8461e8520b08864ec81ad2985be36d34", "patch": "@@ -9,7 +9,7 @@ CFG_LIB_GLOB_x86_64-unknown-bitrig=lib$(1)-*.so\n CFG_LIB_DSYM_GLOB_x86_64-unknown-bitrig=$(1)-*.dylib.dSYM\n CFG_JEMALLOC_CFLAGS_x86_64-unknown-bitrig := -m64 -I/usr/include $(CFLAGS)\n CFG_GCCISH_CFLAGS_x86_64-unknown-bitrig := -Wall -Werror -fPIE -fPIC -m64 -I/usr/include $(CFLAGS)\n-CFG_GCCISH_LINK_FLAGS_x86_64-unknown-bitrig := -shared -pic -pthread -m64\n+CFG_GCCISH_LINK_FLAGS_x86_64-unknown-bitrig := -shared -pic -pthread -m64 $(LDFLAGS)\n CFG_GCCISH_DEF_FLAG_x86_64-unknown-bitrig := -Wl,--export-dynamic,--dynamic-list=\n CFG_LLC_FLAGS_x86_64-unknown-bitrig :=\n CFG_INSTALL_NAME_x86_64-unknown-bitrig ="}, {"sha": "f47c4857ef86132d99b4a1541430e760de71c1c6", "filename": "mk/crates.mk", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fcrates.mk", "raw_url": "https://github.com/rust-lang/rust/raw/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fcrates.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fcrates.mk?ref=dea183aa8461e8520b08864ec81ad2985be36d34", "patch": "@@ -139,13 +139,13 @@ ONLY_RLIB_alloc_system := 1\n # Documented-by-default crates\n DOC_CRATES := std alloc collections core libc rustc_unicode\n \n-ifdef CFG_DISABLE_JEMALLOC\n-RUSTFLAGS_rustc_back := --cfg disable_jemalloc\n-else\n+ifeq ($(CFG_DISABLE_JEMALLOC),)\n TARGET_CRATES += alloc_jemalloc\n DEPS_std += alloc_jemalloc\n DEPS_alloc_jemalloc := core libc native:jemalloc\n ONLY_RLIB_alloc_jemalloc := 1\n+else\n+RUSTFLAGS_rustc_back := --cfg disable_jemalloc\n endif\n \n ################################################################################"}, {"sha": "f76368e3d0b86ae0b5e3fe76fc9f05d420ebc274", "filename": "mk/docs.mk", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fdocs.mk", "raw_url": "https://github.com/rust-lang/rust/raw/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fdocs.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdocs.mk?ref=dea183aa8461e8520b08864ec81ad2985be36d34", "patch": "@@ -71,7 +71,7 @@ DOC_L10N_TARGETS :=\n \n # If NO_REBUILD is set then break the dependencies on rustdoc so we\n # build the documentation without having to rebuild rustdoc.\n-ifndef NO_REBUILD\n+ifeq ($(NO_REBUILD),)\n HTML_DEPS := $(RUSTDOC_EXE)\n else\n HTML_DEPS :=\n@@ -152,7 +152,7 @@ define DEF_LIB_DOC\n \n # If NO_REBUILD is set then break the dependencies on rustdoc so we\n # build crate documentation without having to rebuild rustdoc.\n-ifndef NO_REBUILD\n+ifeq ($(NO_REBUILD),)\n LIB_DOC_DEP_$(1) = \\\n \t$$(CRATEFILE_$(1)) \\\n \t$$(RSINPUTS_$(1)) \\"}, {"sha": "0d527bd0688600bc0beb367c7ef65880171a3146", "filename": "mk/grammar.mk", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fgrammar.mk", "raw_url": "https://github.com/rust-lang/rust/raw/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fgrammar.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fgrammar.mk?ref=dea183aa8461e8520b08864ec81ad2985be36d34", "patch": "@@ -41,8 +41,8 @@ $(BG)RustLexer.class: $(BG) $(SG)RustLexer.g4\n \n check-build-lexer-verifier: $(BG)verify\n \n-ifndef NO_REBUILD\n-VERIFY_DEPS := rustc-stage2-H-$(CFG_BUILD) $(LD)stamp.rustc\n+ifeq ($(NO_REBUILD),)\n+VERIFY_DEPS :=  rustc-stage2-H-$(CFG_BUILD) $(LD)stamp.rustc\n else\n VERIFY_DEPS :=\n endif"}, {"sha": "59a00950b5cfde17634027417cb08d100fff3bcb", "filename": "mk/host.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fhost.mk", "raw_url": "https://github.com/rust-lang/rust/raw/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fhost.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fhost.mk?ref=dea183aa8461e8520b08864ec81ad2985be36d34", "patch": "@@ -18,7 +18,7 @@\n # $(5) - the name of the crate being processed\n define CP_HOST_STAGE_N_CRATE\n \n-ifndef ONLY_RLIB_$(5)\n+ifeq ($$(ONLY_RLIB_$(5)),)\n $$(HLIB$(2)_H_$(4))/stamp.$(5): \\\n \t$$(TLIB$(1)_T_$(3)_H_$(4))/stamp.$(5) \\\n \t$$(RUST_DEPS_$(5):%=$$(HLIB$(2)_H_$(4))/stamp.%) \\"}, {"sha": "af6f3ff6ad2b27ead215fcbfd32fc1805139c26a", "filename": "mk/install.mk", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Finstall.mk", "raw_url": "https://github.com/rust-lang/rust/raw/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Finstall.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Finstall.mk?ref=dea183aa8461e8520b08864ec81ad2985be36d34", "patch": "@@ -121,7 +121,7 @@ install-runtime-target-$(1)-cleanup:\n endef\n \n $(foreach target,$(CFG_TARGET), \\\n- $(if $(findstring $(CFG_ADB_DEVICE_STATUS),true), \\\n+ $(if $(findstring $(CFG_ADB_DEVICE_STATUS),\"true\"), \\\n   $(eval $(call INSTALL_RUNTIME_TARGET_N,$(taget),$(CFG_BUILD))) \\\n   $(eval $(call INSTALL_RUNTIME_TARGET_CLEANUP_N,$(target))) \\\n   ))"}, {"sha": "a4174efa5efa948381de65507131ee5a29b12e2c", "filename": "mk/llvm.mk", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fllvm.mk", "raw_url": "https://github.com/rust-lang/rust/raw/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fllvm.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fllvm.mk?ref=dea183aa8461e8520b08864ec81ad2985be36d34", "patch": "@@ -71,7 +71,7 @@ $$(LLVM_STAMP_$(1)): $$(S)src/rustllvm/llvm-auto-clean-trigger\n \t@$$(call E, make: done cleaning llvm)\n \ttouch -r $$@.start_time $$@ && rm $$@.start_time\n \n-ifdef CFG_ENABLE_LLVM_STATIC_STDCPP\n+ifeq ($$(CFG_ENABLE_LLVM_STATIC_STDCPP),1)\n LLVM_STDCPP_RUSTFLAGS_$(1) = -L \"$$(dir $$(shell $$(CC_$(1)) $$(CFG_GCCISH_CFLAGS_$(1)) \\\n \t\t\t\t\t-print-file-name=lib$(CFG_STDCPP_NAME).a))\"\n else\n@@ -95,6 +95,9 @@ endef\n $(foreach host,$(CFG_HOST), \\\n  $(eval $(call DEF_LLVM_RULES,$(host))))\n \n+$(foreach host,$(CFG_HOST), \\\n+ $(eval LLVM_CONFIGS := $(LLVM_CONFIGS) $(LLVM_CONFIG_$(host))))\n+\n # This can't be done in target.mk because it's included before this file.\n define LLVM_LINKAGE_DEPS\n $$(TLIB$(1)_T_$(2)_H_$(3))/stamp.rustc_llvm: $$(LLVM_LINKAGE_PATH_$(2))"}, {"sha": "9d75771dc80a862833c91a6ab8a5c23c1a76c0dc", "filename": "mk/main.mk", "status": "modified", "additions": 10, "deletions": 20, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fmain.mk", "raw_url": "https://github.com/rust-lang/rust/raw/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fmain.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fmain.mk?ref=dea183aa8461e8520b08864ec81ad2985be36d34", "patch": "@@ -86,13 +86,13 @@ CFG_INFO := $(info cfg: version $(CFG_VERSION))\n \n MKFILE_DEPS := config.stamp $(call rwildcard,$(CFG_SRC_DIR)mk/,*)\n MKFILES_FOR_TARBALL:=$(MKFILE_DEPS)\n-ifdef NO_MKFILE_DEPS\n+ifneq ($(NO_MKFILE_DEPS),)\n MKFILE_DEPS :=\n endif\n NON_BUILD_HOST = $(filter-out $(CFG_BUILD),$(CFG_HOST))\n NON_BUILD_TARGET = $(filter-out $(CFG_BUILD),$(CFG_TARGET))\n \n-ifdef MAKE_RESTARTS\n+ifneq ($(MAKE_RESTARTS),)\n CFG_INFO := $(info cfg: make restarts: $(MAKE_RESTARTS))\n endif\n \n@@ -107,40 +107,28 @@ ifneq ($(wildcard $(NON_BUILD_TARGET)),)\n CFG_INFO := $(info cfg: non-build target triples $(NON_BUILD_TARGET))\n endif\n \n-CFG_RUSTC_FLAGS :=\n-ifdef RUSTFLAGS\n-  CFG_RUSTC_FLAGS += $(RUSTFLAGS)\n-endif\n+CFG_RUSTC_FLAGS := $(RUSTFLAGS)\n CFG_GCCISH_CFLAGS :=\n CFG_GCCISH_LINK_FLAGS :=\n \n CFG_JEMALLOC_FLAGS :=\n-ifdef JEMALLOC_FLAGS\n-  CFG_JEMALLOC_FLAGS += $(JEMALLOC_FLAGS)\n-endif\n \n ifdef CFG_DISABLE_OPTIMIZE\n   $(info cfg: disabling rustc optimization (CFG_DISABLE_OPTIMIZE))\n+  CFG_RUSTC_FLAGS +=\n   CFG_JEMALLOC_FLAGS += --enable-debug\n else\n   # The rtopt cfg turns off runtime sanity checks\n   CFG_RUSTC_FLAGS += -O --cfg rtopt\n endif\n \n+CFG_JEMALLOC_FLAGS += $(JEMALLOC_FLAGS)\n+\n ifdef CFG_ENABLE_DEBUG_ASSERTIONS\n   $(info cfg: enabling debug assertions (CFG_ENABLE_DEBUG_ASSERTIONS))\n   CFG_RUSTC_FLAGS += -C debug-assertions=on\n endif\n \n-define DEF_RUSTFLAGS_STAGE\n-RUSTFLAGS_STAGE$(1) :=\n-endef\n-\n-STAGES = 0 1 2 3\n-\n-$(foreach stage,$(STAGES), \\\n-  $(eval $(call DEF_RUSTFLAGS_STAGE,$(stage))))\n-\n ifdef CFG_ENABLE_DEBUGINFO\n   $(info cfg: enabling debuginfo (CFG_ENABLE_DEBUGINFO))\n   CFG_RUSTC_FLAGS += -g\n@@ -198,9 +186,9 @@ endif\n \n \n ifndef CFG_DISABLE_VALGRIND_RPASS\n-  $(info cfg: enabling valgrind run-pass tests)\n+  $(info cfg: enabling valgrind run-pass tests (CFG_ENABLE_VALGRIND_RPASS))\n   $(info cfg: valgrind-rpass command set to $(CFG_VALGRIND))\n-  CFG_VALGRIND_RPASS := $(CFG_VALGRIND)\n+  CFG_VALGRIND_RPASS :=$(CFG_VALGRIND)\n else\n   $(info cfg: disabling valgrind run-pass tests)\n   CFG_VALGRIND_RPASS :=\n@@ -384,6 +372,8 @@ export CFG_BOOTSTRAP_KEY\n TRIPLE_TO_DEBUGGER_SCRIPT_SETTING=\\\n  $(if $(findstring windows,$(1)),none,$(if $(findstring darwin,$(1)),lldb,gdb))\n \n+STAGES = 0 1 2 3\n+\n define SREQ\n # $(1) is the stage number\n # $(2) is the target triple"}, {"sha": "9c74e657a846442979684e70b479db988915326e", "filename": "mk/platform.mk", "status": "modified", "additions": 16, "deletions": 17, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fplatform.mk", "raw_url": "https://github.com/rust-lang/rust/raw/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Fplatform.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fplatform.mk?ref=dea183aa8461e8520b08864ec81ad2985be36d34", "patch": "@@ -82,11 +82,12 @@ AR := ar\n define SET_FROM_CFG\n   ifdef CFG_$(1)\n     ifeq ($(origin $(1)),undefined)\n-      $$(info cfg: using $(1)=$$(CFG_$(1)) (CFG_$(1)))\n-      $(1)=$$(CFG_$(1))\n-    else ifeq ($(origin $(1)),default)\n-      $$(info cfg: using $(1)=$$(CFG_$(1)) (CFG_$(1)))\n-      $(1)=$$(CFG_$(1))\n+      $$(info cfg: using $(1)=$(CFG_$(1)) (CFG_$(1)))\n+      $(1)=$(CFG_$(1))\n+    endif\n+    ifeq ($(origin $(1)),default)\n+      $$(info cfg: using $(1)=$(CFG_$(1)) (CFG_$(1)))\n+      $(1)=$(CFG_$(1))\n     endif\n   endif\n endef\n@@ -100,9 +101,7 @@ include $(wildcard $(CFG_SRC_DIR)mk/cfg/*.mk)\n \n define ADD_INSTALLED_OBJECTS\n   INSTALLED_OBJECTS_$(1) += $$(CFG_INSTALLED_OBJECTS_$(1))\n-  ifdef CFG_THIRD_PARTY_OBJECTS_$(1)\n-    REQUIRED_OBJECTS_$(1) += $$(CFG_THIRD_PARTY_OBJECTS_$(1))\n-  endif\n+  REQUIRED_OBJECTS_$(1) += $$(CFG_THIRD_PARTY_OBJECTS_$(1))\n   INSTALLED_OBJECTS_$(1) += $$(call CFG_STATIC_LIB_NAME_$(1),compiler-rt)\n   REQUIRED_OBJECTS_$(1) += $$(call CFG_STATIC_LIB_NAME_$(1),compiler-rt)\n endef\n@@ -164,15 +163,15 @@ define CFG_MAKE_TOOLCHAIN\n   # Prepend the tools with their prefix if cross compiling\n   ifneq ($(CFG_BUILD),$(1))\n     ifneq ($$(findstring msvc,$(1)),msvc)\n-      CC_$(1)=$(CROSS_PREFIX_$(1))$(CC_$(1))\n-      CXX_$(1)=$(CROSS_PREFIX_$(1))$(CXX_$(1))\n-      CPP_$(1)=$(CROSS_PREFIX_$(1))$(CPP_$(1))\n-      AR_$(1)=$(CROSS_PREFIX_$(1))$(AR_$(1))\n-      LINK_$(1)=$(CROSS_PREFIX_$(1))$(LINK_$(1))\n-      RUSTC_CROSS_FLAGS_$(1)=-C linker=$$(call FIND_COMPILER,$$(LINK_$(1))) \\\n-        -C ar=$$(call FIND_COMPILER,$$(AR_$(1))) $(RUSTC_CROSS_FLAGS_$(1))\n-\n-      RUSTC_FLAGS_$(1)=$$(RUSTC_CROSS_FLAGS_$(1)) $(RUSTC_FLAGS_$(1))\n+       CC_$(1)=$(CROSS_PREFIX_$(1))$(CC_$(1))\n+       CXX_$(1)=$(CROSS_PREFIX_$(1))$(CXX_$(1))\n+       CPP_$(1)=$(CROSS_PREFIX_$(1))$(CPP_$(1))\n+       AR_$(1)=$(CROSS_PREFIX_$(1))$(AR_$(1))\n+       LINK_$(1)=$(CROSS_PREFIX_$(1))$(LINK_$(1))\n+       RUSTC_CROSS_FLAGS_$(1)=-C linker=$$(call FIND_COMPILER,$$(LINK_$(1))) \\\n+           -C ar=$$(call FIND_COMPILER,$$(AR_$(1))) $(RUSTC_CROSS_FLAGS_$(1))\n+\n+       RUSTC_FLAGS_$(1)=$$(RUSTC_CROSS_FLAGS_$(1)) $(RUSTC_FLAGS_$(1))\n     endif\n   endif\n "}, {"sha": "9dbbcbebb979d34a870b47e63c2c1572267f8e27", "filename": "mk/rt.mk", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Frt.mk", "raw_url": "https://github.com/rust-lang/rust/raw/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Frt.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Frt.mk?ref=dea183aa8461e8520b08864ec81ad2985be36d34", "patch": "@@ -107,6 +107,8 @@ $$(RT_OUTPUT_DIR_$(1))/$$(NATIVE_$(2)_$(1)): $$(OBJS_$(2)_$(1))\n \n endef\n \n+$(foreach target,$(CFG_TARGET), \\\n+ $(eval $(call RUNTIME_RULES,$(target))))\n $(foreach lib,$(NATIVE_LIBS), \\\n  $(foreach target,$(CFG_TARGET), \\\n   $(eval $(call THIRD_PARTY_LIB,$(target),$(lib)))))\n@@ -169,7 +171,7 @@ endif\n \n # See #17183 for details, this file is touched during the build process so we\n # don't want to consider it as a dependency.\n-JEMALLOC_DEPS := $(filter-out $(S)src/jemalloc/VERSION,$$(JEMALLOC_DEPS))\n+JEMALLOC_DEPS := $(filter-out $(S)src/jemalloc/VERSION,$(JEMALLOC_DEPS))\n \n JEMALLOC_NAME_$(1) := $$(call CFG_STATIC_LIB_NAME_$(1),jemalloc)\n ifeq ($$(CFG_WINDOWSY_$(1)),1)"}, {"sha": "32a3eb5c20d2840c3f7e16772a83bfc3b4a417c9", "filename": "mk/target.mk", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Ftarget.mk", "raw_url": "https://github.com/rust-lang/rust/raw/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Ftarget.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftarget.mk?ref=dea183aa8461e8520b08864ec81ad2985be36d34", "patch": "@@ -138,12 +138,12 @@ define TARGET_RUSTRT_STARTUP_OBJ\n $$(TLIB$(1)_T_$(2)_H_$(3))/$(4).o: \\\n \t\t$(S)src/rtstartup/$(4).rs \\\n \t\t$$(TLIB$(1)_T_$(2)_H_$(3))/stamp.core \\\n-\t\t$$(HSREQ$(1)_H_$(3)) \\\n+\t\t$$(HSREQ$(1)_T_$(2)_H_$(3)) \\\n \t\t| $$(TBIN$(1)_T_$(2)_H_$(3))/\n \t@$$(call E, rustc: $$@)\n \t$$(STAGE$(1)_T_$(2)_H_$(3)) --emit=obj -o $$@ $$<\n \n-ifdef CFG_RUSTRT_HAS_STARTUP_OBJS_$(2)\n+ifeq ($$(CFG_RUSTRT_HAS_STARTUP_OBJS_$(2)), 1)\n # Add dependencies on Rust startup objects to all crates that depend on core.\n # This ensures that they are built after core (since they depend on it),\n # but before everything else (since they are needed for linking dylib crates)."}, {"sha": "19587a28d5594b6f13e04362e38706016e5387ef", "filename": "mk/tests.mk", "status": "modified", "additions": 10, "deletions": 14, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Ftests.mk", "raw_url": "https://github.com/rust-lang/rust/raw/dea183aa8461e8520b08864ec81ad2985be36d34/mk%2Ftests.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftests.mk?ref=dea183aa8461e8520b08864ec81ad2985be36d34", "patch": "@@ -36,8 +36,6 @@ TEST_CRATES = $(TEST_TARGET_CRATES) $(TEST_HOST_CRATES)\n # Environment configuration\n ######################################################################\n \n-TESTARGS :=\n-\n # The arguments to all test runners\n ifdef TESTNAME\n   TESTARGS += $(TESTNAME)\n@@ -50,8 +48,6 @@ endif\n # Arguments to the cfail/rfail/rpass tests\n ifdef CFG_VALGRIND\n   CTEST_RUNTOOL = --runtool \"$(CFG_VALGRIND)\"\n-else\n-  CTEST_RUNTOOL =\n endif\n \n CTEST_TESTARGS := $(TESTARGS)\n@@ -147,11 +143,10 @@ else\n CFG_ADB_TEST_DIR=\n endif\n \n-DOC_NAMES :=\n # $(1) - name of doc test\n # $(2) - file of the test\n define DOCTEST\n-DOC_NAMES += $(1)\n+DOC_NAMES := $$(DOC_NAMES) $(1)\n DOCFILE_$(1) := $(2)\n endef\n \n@@ -367,7 +362,7 @@ define TEST_RUNNER\n # If NO_REBUILD is set then break the dependencies on everything but\n # the source files so we can test crates without rebuilding any of the\n # parent crates.\n-ifndef NO_REBUILD\n+ifeq ($(NO_REBUILD),)\n TESTDEP_$(1)_$(2)_$(3)_$(4) = $$(SREQ$(1)_T_$(2)_H_$(3)) \\\n \t\t\t    $$(foreach crate,$$(TARGET_CRATES), \\\n \t\t\t\t$$(TLIB$(1)_T_$(2)_H_$(3))/stamp.$$(crate)) \\\n@@ -452,7 +447,7 @@ $(foreach host,$(CFG_HOST), \\\n     $(if $(findstring $(target),$(CFG_BUILD)), \\\n      $(eval $(call DEF_TEST_CRATE_RULES,$(stage),$(target),$(host),$(crate))), \\\n      $(if $(findstring android, $(target)), \\\n-      $(if $(findstring $(CFG_ADB_DEVICE_STATUS),true), \\\n+      $(if $(findstring $(CFG_ADB_DEVICE_STATUS),\"true\"), \\\n        $(eval $(call DEF_TEST_CRATE_RULES_android,$(stage),$(target),$(host),$(crate))), \\\n        $(eval $(call DEF_TEST_CRATE_RULES_null,$(stage),$(target),$(host),$(crate))) \\\n       ), \\\n@@ -705,22 +700,22 @@ check-stage$(1)-T-$(2)-H-$(3)-$(4)-exec: $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4\n # (Encoded as a separate variable because GNU make does not have a\n # good way to express OR on ifeq commands)\n \n-ifdef CTEST_DISABLE_$(4)\n+ifneq ($$(CTEST_DISABLE_$(4)),)\n # Test suite is disabled for all configured targets.\n CTEST_DONT_RUN_$(1)-T-$(2)-H-$(3)-$(4) := $$(CTEST_DISABLE_$(4))\n else\n # else, check if non-self-hosted target (i.e. target not-in hosts) ...\n ifeq ($$(findstring $(2),$$(CFG_HOST)),)\n # ... if so, then check if this test suite is disabled for non-selfhosts.\n-ifdef CTEST_DISABLE_NONSELFHOST_$(4)\n+ifneq ($$(CTEST_DISABLE_NONSELFHOST_$(4)),)\n # Test suite is disabled for this target.\n CTEST_DONT_RUN_$(1)-T-$(2)-H-$(3)-$(4) := $$(CTEST_DISABLE_NONSELFHOST_$(4))\n endif\n endif\n # Neither DISABLE nor DISABLE_NONSELFHOST is set ==> okay, run the test.\n endif\n \n-ifndef CTEST_DONT_RUN_$(1)-T-$(2)-H-$(3)-$(4)\n+ifeq ($$(CTEST_DONT_RUN_$(1)-T-$(2)-H-$(3)-$(4)),)\n $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4)): \\\n \t\t$$(TEST_SREQ$(1)_T_$(2)_H_$(3)) \\\n                 $$(CTEST_DEPS_$(4)_$(1)-T-$(2)-H-$(3))\n@@ -829,7 +824,7 @@ check-stage$(1)-T-$(2)-H-$(3)-doc-$(4)-exec: $$(call TEST_OK_FILE,$(1),$(2),$(3)\n # If NO_REBUILD is set then break the dependencies on everything but\n # the source files so we can test documentation without rebuilding\n # rustdoc etc.\n-ifndef NO_REBUILD\n+ifeq ($(NO_REBUILD),)\n DOCTESTDEP_$(1)_$(2)_$(3)_$(4) = \\\n \t$$(DOCFILE_$(4)) \\\n \t$$(TEST_SREQ$(1)_T_$(2)_H_$(3)) \\\n@@ -864,7 +859,7 @@ define DEF_CRATE_DOC_TEST\n # If NO_REBUILD is set then break the dependencies on everything but\n # the source files so we can test crate documentation without\n # rebuilding any of the parent crates.\n-ifndef NO_REBUILD\n+ifeq ($(NO_REBUILD),)\n CRATEDOCTESTDEP_$(1)_$(2)_$(3)_$(4) = \\\n \t$$(TEST_SREQ$(1)_T_$(2)_H_$(3)) \\\n \t$$(CRATE_FULLDEPS_$(1)_T_$(2)_H_$(3)_$(4)) \\\n@@ -927,7 +922,8 @@ TEST_GROUPS = \\\n \tpretty-rpass-full \\\n \tpretty-rfail-full \\\n \tpretty-rfail \\\n-\tpretty-pretty\n+\tpretty-pretty \\\n+\t$(NULL)\n \n define DEF_CHECK_FOR_STAGE_AND_TARGET_AND_HOST\n check-stage$(1)-T-$(2)-H-$(3): check-stage$(1)-T-$(2)-H-$(3)-exec"}]}