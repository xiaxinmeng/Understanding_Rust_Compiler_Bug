{"sha": "0db05f16c897ac19e09269eb6a7061b888fb7851", "node_id": "C_kwDOAAsO6NoAKDBkYjA1ZjE2Yzg5N2FjMTllMDkyNjllYjZhNzA2MWI4ODhmYjc4NTE", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2022-10-10T01:23:04Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-10-10T01:23:04Z"}, "message": "Rollup merge of #102323 - Stoozy:master, r=cjgillot\n\nTrying to suggest additional lifetime parameter\n\n``@cjgillot`` This is what I have so far for #100615", "tree": {"sha": "8c9ced4e483bca078eaa6af1bee48f843e6d191d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8c9ced4e483bca078eaa6af1bee48f843e6d191d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0db05f16c897ac19e09269eb6a7061b888fb7851", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjQ3P4CRBK7hj4Ov3rIwAArhQIAKcDui7CzLhId7M9S3al2G6t\nK2i+kTr1f3bKDGoU75k+pgINJudKsOaqJorqpZh6ykOIgWWmEUOBK6BxuAM1t/yh\n+PwnjMezo+shBMMgq+Vhc9NOa7yDjNZGBm8uZ5axzDsECfUzR/Skak5HitmalPCM\ndGH07+tNZ1ZZrU9JuGPtqDVhGa5hjsFqLvGRrz6j04kAOUi2Ujbylasty2YWwUWS\n6PzeGKB4kf6vUv7/9qbfbyUgdqXfOcfr9SzgvRZu/s7DlVU+2z/HWcwdgC9TZFU8\no2q0maXjAg93L/SDotNq1jyDx/LBRtDOy7Nom6fDlWy1kL6o0aFLWIeOrHeFx3s=\n=tlkQ\n-----END PGP SIGNATURE-----\n", "payload": "tree 8c9ced4e483bca078eaa6af1bee48f843e6d191d\nparent c50e64d872af4b2f0b61889326ab9f792e1273a1\nparent 2657f9d5da0a9bff0764df824e26f2169e2e398d\nauthor Yuki Okushi <jtitor@2k36.org> 1665364984 +0900\ncommitter GitHub <noreply@github.com> 1665364984 +0900\n\nRollup merge of #102323 - Stoozy:master, r=cjgillot\n\nTrying to suggest additional lifetime parameter\n\n``@cjgillot`` This is what I have so far for #100615\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0db05f16c897ac19e09269eb6a7061b888fb7851", "html_url": "https://github.com/rust-lang/rust/commit/0db05f16c897ac19e09269eb6a7061b888fb7851", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0db05f16c897ac19e09269eb6a7061b888fb7851/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c50e64d872af4b2f0b61889326ab9f792e1273a1", "url": "https://api.github.com/repos/rust-lang/rust/commits/c50e64d872af4b2f0b61889326ab9f792e1273a1", "html_url": "https://github.com/rust-lang/rust/commit/c50e64d872af4b2f0b61889326ab9f792e1273a1"}, {"sha": "2657f9d5da0a9bff0764df824e26f2169e2e398d", "url": "https://api.github.com/repos/rust-lang/rust/commits/2657f9d5da0a9bff0764df824e26f2169e2e398d", "html_url": "https://github.com/rust-lang/rust/commit/2657f9d5da0a9bff0764df824e26f2169e2e398d"}], "stats": {"total": 45, "additions": 41, "deletions": 4}, "files": [{"sha": "c18d5d06d64b84deb4e196bec5495e9f4b95c88f", "filename": "compiler/rustc_resolve/src/late/lifetimes.rs", "status": "modified", "additions": 31, "deletions": 2, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/0db05f16c897ac19e09269eb6a7061b888fb7851/compiler%2Frustc_resolve%2Fsrc%2Flate%2Flifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0db05f16c897ac19e09269eb6a7061b888fb7851/compiler%2Frustc_resolve%2Fsrc%2Flate%2Flifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate%2Flifetimes.rs?ref=0db05f16c897ac19e09269eb6a7061b888fb7851", "patch": "@@ -1333,12 +1333,41 @@ impl<'a, 'tcx> LifetimeContext<'a, 'tcx> {\n                         && let hir::IsAsync::NotAsync = self.tcx.asyncness(lifetime_ref.hir_id.owner.def_id)\n                         && !self.tcx.features().anonymous_lifetime_in_impl_trait\n                     {\n-                        rustc_session::parse::feature_err(\n+                        let mut diag =  rustc_session::parse::feature_err(\n                             &self.tcx.sess.parse_sess,\n                             sym::anonymous_lifetime_in_impl_trait,\n                             lifetime_ref.span,\n                             \"anonymous lifetimes in `impl Trait` are unstable\",\n-                        ).emit();\n+                        );\n+\n+                        match self.tcx.hir().get_generics(lifetime_ref.hir_id.owner.def_id) {\n+                            Some(generics) => {\n+\n+                                let new_param_sugg_tuple;\n+\n+                                new_param_sugg_tuple = match generics.span_for_param_suggestion() {\n+                                    Some(_) => {\n+                                        Some((self.tcx.sess.source_map().span_through_char(generics.span, '<').shrink_to_hi(), \"'a, \".to_owned()))\n+                                    },\n+                                    None => Some((generics.span, \"<'a>\".to_owned()))\n+                                };\n+\n+                                let mut multi_sugg_vec = vec![(lifetime_ref.span.shrink_to_hi(), \"'a \".to_owned())];\n+\n+                                if let Some(new_tuple) =  new_param_sugg_tuple{\n+                                    multi_sugg_vec.push(new_tuple);\n+                                }\n+\n+                                diag.span_label(lifetime_ref.span, \"expected named lifetime parameter\");\n+                                diag.multipart_suggestion(\"consider introducing a named lifetime parameter\",\n+                                multi_sugg_vec,\n+                                rustc_errors::Applicability::MaybeIncorrect);\n+\n+                            },\n+                            None => { }\n+                        }\n+\n+                        diag.emit();\n                         return;\n                     }\n                     scope = s;"}, {"sha": "9833da13ffc2a3a6e6e7256d3bb654b1941ad6ce", "filename": "src/test/ui/suggestions/impl-trait-missing-lifetime-gated.stderr", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/0db05f16c897ac19e09269eb6a7061b888fb7851/src%2Ftest%2Fui%2Fsuggestions%2Fimpl-trait-missing-lifetime-gated.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0db05f16c897ac19e09269eb6a7061b888fb7851/src%2Ftest%2Fui%2Fsuggestions%2Fimpl-trait-missing-lifetime-gated.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fimpl-trait-missing-lifetime-gated.stderr?ref=0db05f16c897ac19e09269eb6a7061b888fb7851", "patch": "@@ -26,17 +26,25 @@ error[E0658]: anonymous lifetimes in `impl Trait` are unstable\n   --> $DIR/impl-trait-missing-lifetime-gated.rs:5:31\n    |\n LL | fn f(_: impl Iterator<Item = &'_ ()>) {}\n-   |                               ^^\n+   |                               ^^ expected named lifetime parameter\n    |\n    = help: add `#![feature(anonymous_lifetime_in_impl_trait)]` to the crate attributes to enable\n+help: consider introducing a named lifetime parameter\n+   |\n+LL | fn f<'a>(_: impl Iterator<Item = &'_'a  ()>) {}\n+   |     ++++                            ++\n \n error[E0658]: anonymous lifetimes in `impl Trait` are unstable\n   --> $DIR/impl-trait-missing-lifetime-gated.rs:8:31\n    |\n LL | fn g(x: impl Iterator<Item = &'_ ()>) -> Option<&'_ ()> { x.next() }\n-   |                               ^^\n+   |                               ^^ expected named lifetime parameter\n    |\n    = help: add `#![feature(anonymous_lifetime_in_impl_trait)]` to the crate attributes to enable\n+help: consider introducing a named lifetime parameter\n+   |\n+LL | fn g<'a>(x: impl Iterator<Item = &'_'a  ()>) -> Option<&'_ ()> { x.next() }\n+   |     ++++                            ++\n \n error: aborting due to 4 previous errors\n "}]}