{"sha": "e03db2301e823be6371464228f7d8b10b3189abd", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUwM2RiMjMwMWU4MjNiZTYzNzE0NjQyMjhmN2Q4YjEwYjMxODlhYmQ=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-10-12T14:04:01Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-10-12T14:04:01Z"}, "message": "Rollup merge of #54811 - pnkfelix:issue-24840-separate-bootstrap-default-for-optimize-from-debug-setting, r=nikomatsakis\n\nDuring rustc bootstrap, make default for `optimize` independent of `debug`\n\nIt may have taken me three and a half years, but I'm following through on my [\"threat\"](https://github.com/rust-lang/rust/issues/24840#issuecomment-97911700)\n\nFix #24840", "tree": {"sha": "e9be23e04e12d69aac6e5342dc6f885ad0e7ae12", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e9be23e04e12d69aac6e5342dc6f885ad0e7ae12"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e03db2301e823be6371464228f7d8b10b3189abd", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbwKnRCRBK7hj4Ov3rIwAAdHIIAKCBFmh4fG4WEYdpyC/vTPTK\n7R/Myms3EX9vY08M11KcNmhGEaw06iMDx50Tmqotqk6bntJgvpFqxu81G9uzpOTW\naH55en/r0dIaccdlDExzQkzNaDKrsmzV/Mtu5SKZ4yHVY8sidXprNur/5vd+0fCG\nxoMopwweZAQSYy/HrT1VqR4fKgNK8VEkBmVNBTGXD3Nmff/Xn//Zn6fQuuTsNiXc\nzYv0omwc0miVZnD+8DOQ2PJji1fXKzbbRGQFlfMXyxwXGBfrrV6EZcAcoIPCl3ux\nwGhowG0RHdBAsNY7ibUiEYZxCMW5S1ZrpFgoXGSyR3fcgmXvSSOQqWCio6CaSmE=\n=rq3d\n-----END PGP SIGNATURE-----\n", "payload": "tree e9be23e04e12d69aac6e5342dc6f885ad0e7ae12\nparent 8455468d0d0a253e5c0bbce5410b6976c84dbd02\nparent 40e20e288d0f928c25bc74c14d74227c4d5c7182\nauthor kennytm <kennytm@gmail.com> 1539353041 +0800\ncommitter GitHub <noreply@github.com> 1539353041 +0800\n\nRollup merge of #54811 - pnkfelix:issue-24840-separate-bootstrap-default-for-optimize-from-debug-setting, r=nikomatsakis\n\nDuring rustc bootstrap, make default for `optimize` independent of `debug`\n\nIt may have taken me three and a half years, but I'm following through on my [\"threat\"](https://github.com/rust-lang/rust/issues/24840#issuecomment-97911700)\n\nFix #24840\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e03db2301e823be6371464228f7d8b10b3189abd", "html_url": "https://github.com/rust-lang/rust/commit/e03db2301e823be6371464228f7d8b10b3189abd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e03db2301e823be6371464228f7d8b10b3189abd/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8455468d0d0a253e5c0bbce5410b6976c84dbd02", "url": "https://api.github.com/repos/rust-lang/rust/commits/8455468d0d0a253e5c0bbce5410b6976c84dbd02", "html_url": "https://github.com/rust-lang/rust/commit/8455468d0d0a253e5c0bbce5410b6976c84dbd02"}, {"sha": "40e20e288d0f928c25bc74c14d74227c4d5c7182", "url": "https://api.github.com/repos/rust-lang/rust/commits/40e20e288d0f928c25bc74c14d74227c4d5c7182", "html_url": "https://github.com/rust-lang/rust/commit/40e20e288d0f928c25bc74c14d74227c4d5c7182"}], "stats": {"total": 39, "additions": 29, "deletions": 10}, "files": [{"sha": "1c851999130a0213ae5daded08d1e8eda4f637ae", "filename": "config.toml.example", "status": "modified", "additions": 26, "deletions": 9, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/e03db2301e823be6371464228f7d8b10b3189abd/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/e03db2301e823be6371464228f7d8b10b3189abd/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=e03db2301e823be6371464228f7d8b10b3189abd", "patch": "@@ -243,19 +243,36 @@\n # =============================================================================\n [rust]\n \n-# Indicates that the build should be optimized for debugging Rust. Note that\n-# this is typically not what you want as it takes an incredibly large amount of\n-# time to have a debug-mode rustc compile any code (notably libstd). If this\n-# value is set to `true` it will affect a number of configuration options below\n-# as well, if unconfigured.\n-#debug = false\n-\n-# Whether or not to optimize the compiler and standard library\n+# Whether or not to optimize the compiler and standard library.\n+#\n # Note: the slowness of the non optimized compiler compiling itself usually\n #       outweighs the time gains in not doing optimizations, therefore a\n-#       full bootstrap takes much more time with optimize set to false.\n+#       full bootstrap takes much more time with `optimize` set to false.\n #optimize = true\n \n+# Indicates that the build should be configured for debugging Rust. A\n+# `debug`-enabled compiler and standard library will be somewhat\n+# slower (due to e.g. checking of debug assertions) but should remain\n+# usable.\n+#\n+# Note: If this value is set to `true`, it will affect a number of\n+#       configuration options below as well, if they have been left\n+#       unconfigured in this file.\n+#\n+# Note: changes to the `debug` setting do *not* affect `optimize`\n+#       above. In theory, a \"maximally debuggable\" environment would\n+#       set `optimize` to `false` above to assist the introspection\n+#       facilities of debuggers like lldb and gdb. To recreate such an\n+#       environment, explicitly set `optimize` to `false` and `debug`\n+#       to `true`. In practice, everyone leaves `optimize` set to\n+#       `true`, because an unoptimized rustc with debugging\n+#       enabled becomes *unusably slow* (e.g. rust-lang/rust#24840\n+#       reported a 25x slowdown) and bootstrapping the supposed\n+#       \"maximally debuggable\" environment (notably libstd) takes\n+#       hours to build.\n+#\n+#debug = false\n+\n # Number of codegen units to use for each compiler invocation. A value of 0\n # means \"the number of cores on this machine\", and 1+ is passed through to the\n # compiler."}, {"sha": "a5ed096a735810b09a0304faa53686c3aa1bac33", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e03db2301e823be6371464228f7d8b10b3189abd/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e03db2301e823be6371464228f7d8b10b3189abd/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=e03db2301e823be6371464228f7d8b10b3189abd", "patch": "@@ -628,6 +628,9 @@ impl Config {\n         let default = false;\n         config.llvm_assertions = llvm_assertions.unwrap_or(default);\n \n+        let default = true;\n+        config.rust_optimize = optimize.unwrap_or(default);\n+\n         let default = match &config.channel[..] {\n             \"stable\" | \"beta\" | \"nightly\" => true,\n             _ => false,\n@@ -640,7 +643,6 @@ impl Config {\n         config.debug_jemalloc = debug_jemalloc.unwrap_or(default);\n         config.rust_debuginfo = debuginfo.unwrap_or(default);\n         config.rust_debug_assertions = debug_assertions.unwrap_or(default);\n-        config.rust_optimize = optimize.unwrap_or(!default);\n \n         let default = config.channel == \"dev\";\n         config.ignore_git = ignore_git.unwrap_or(default);"}]}