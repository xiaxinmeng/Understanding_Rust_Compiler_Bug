{"sha": "2ce2d6b40e85bf543b3a9e38cd08c7065b357807", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJjZTJkNmI0MGU4NWJmNTQzYjNhOWUzOGNkMDhjNzA2NWIzNTc4MDc=", "commit": {"author": {"name": "rail", "email": "12975677+rail-rain@users.noreply.github.com", "date": "2020-09-11T02:41:54Z"}, "committer": {"name": "rail", "email": "12975677+rail-rain@users.noreply.github.com", "date": "2020-09-16T22:11:10Z"}, "message": "fix a FP in `indexing_slicing`\n\ntreat refs to arrays the same as arrays\nin `indexing_slicing` and `out_of_bounds_indexing`", "tree": {"sha": "b66516bbc0a8785a92ec5ea97acf7356f6203ae8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b66516bbc0a8785a92ec5ea97acf7356f6203ae8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2ce2d6b40e85bf543b3a9e38cd08c7065b357807", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2ce2d6b40e85bf543b3a9e38cd08c7065b357807", "html_url": "https://github.com/rust-lang/rust/commit/2ce2d6b40e85bf543b3a9e38cd08c7065b357807", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2ce2d6b40e85bf543b3a9e38cd08c7065b357807/comments", "author": {"login": "rail-rain", "id": 12975677, "node_id": "MDQ6VXNlcjEyOTc1Njc3", "avatar_url": "https://avatars.githubusercontent.com/u/12975677?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rail-rain", "html_url": "https://github.com/rail-rain", "followers_url": "https://api.github.com/users/rail-rain/followers", "following_url": "https://api.github.com/users/rail-rain/following{/other_user}", "gists_url": "https://api.github.com/users/rail-rain/gists{/gist_id}", "starred_url": "https://api.github.com/users/rail-rain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rail-rain/subscriptions", "organizations_url": "https://api.github.com/users/rail-rain/orgs", "repos_url": "https://api.github.com/users/rail-rain/repos", "events_url": "https://api.github.com/users/rail-rain/events{/privacy}", "received_events_url": "https://api.github.com/users/rail-rain/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rail-rain", "id": 12975677, "node_id": "MDQ6VXNlcjEyOTc1Njc3", "avatar_url": "https://avatars.githubusercontent.com/u/12975677?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rail-rain", "html_url": "https://github.com/rail-rain", "followers_url": "https://api.github.com/users/rail-rain/followers", "following_url": "https://api.github.com/users/rail-rain/following{/other_user}", "gists_url": "https://api.github.com/users/rail-rain/gists{/gist_id}", "starred_url": "https://api.github.com/users/rail-rain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rail-rain/subscriptions", "organizations_url": "https://api.github.com/users/rail-rain/orgs", "repos_url": "https://api.github.com/users/rail-rain/repos", "events_url": "https://api.github.com/users/rail-rain/events{/privacy}", "received_events_url": "https://api.github.com/users/rail-rain/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "06f190287848ceeee36be738cbbd8e008f3e7615", "url": "https://api.github.com/repos/rust-lang/rust/commits/06f190287848ceeee36be738cbbd8e008f3e7615", "html_url": "https://github.com/rust-lang/rust/commit/06f190287848ceeee36be738cbbd8e008f3e7615"}], "stats": {"total": 51, "additions": 16, "deletions": 35}, "files": [{"sha": "741195f3b10d5eee8f1da6577ec18919b95574b3", "filename": "clippy_lints/src/indexing_slicing.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2ce2d6b40e85bf543b3a9e38cd08c7065b357807/clippy_lints%2Fsrc%2Findexing_slicing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2ce2d6b40e85bf543b3a9e38cd08c7065b357807/clippy_lints%2Fsrc%2Findexing_slicing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Findexing_slicing.rs?ref=2ce2d6b40e85bf543b3a9e38cd08c7065b357807", "patch": "@@ -88,7 +88,7 @@ declare_lint_pass!(IndexingSlicing => [INDEXING_SLICING, OUT_OF_BOUNDS_INDEXING]\n impl<'tcx> LateLintPass<'tcx> for IndexingSlicing {\n     fn check_expr(&mut self, cx: &LateContext<'tcx>, expr: &'tcx Expr<'_>) {\n         if let ExprKind::Index(ref array, ref index) = &expr.kind {\n-            let ty = cx.typeck_results().expr_ty(array);\n+            let ty = cx.typeck_results().expr_ty(array).peel_refs();\n             if let Some(range) = higher::range(index) {\n                 // Ranged indexes, i.e., &x[n..m], &x[n..], &x[..n] and &x[..]\n                 if let ty::Array(_, s) = ty.kind() {"}, {"sha": "ca8ca53c80c3f436956fef359df23a0778ebd111", "filename": "tests/ui/indexing_slicing_index.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2ce2d6b40e85bf543b3a9e38cd08c7065b357807/tests%2Fui%2Findexing_slicing_index.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2ce2d6b40e85bf543b3a9e38cd08c7065b357807/tests%2Fui%2Findexing_slicing_index.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Findexing_slicing_index.rs?ref=2ce2d6b40e85bf543b3a9e38cd08c7065b357807", "patch": "@@ -15,7 +15,8 @@ fn main() {\n     x[3]; // Ok, should not produce stderr.\n \n     let y = &x;\n-    y[0];\n+    y[0]; // Ok, referencing shouldn't affect this lint. See the issue 6021\n+    y[4]; // Ok, rustc will handle references too.\n \n     let v = vec![0; 5];\n     v[0];"}, {"sha": "2f6c9e2f4e5a09c4f4d38913515f255c19850d08", "filename": "tests/ui/indexing_slicing_index.stderr", "status": "modified", "additions": 6, "deletions": 14, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/2ce2d6b40e85bf543b3a9e38cd08c7065b357807/tests%2Fui%2Findexing_slicing_index.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2ce2d6b40e85bf543b3a9e38cd08c7065b357807/tests%2Fui%2Findexing_slicing_index.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Findexing_slicing_index.stderr?ref=2ce2d6b40e85bf543b3a9e38cd08c7065b357807", "patch": "@@ -8,52 +8,44 @@ LL |     x[index];\n    = help: Consider using `.get(n)` or `.get_mut(n)` instead\n \n error: indexing may panic.\n-  --> $DIR/indexing_slicing_index.rs:18:5\n-   |\n-LL |     y[0];\n-   |     ^^^^\n-   |\n-   = help: Consider using `.get(n)` or `.get_mut(n)` instead\n-\n-error: indexing may panic.\n-  --> $DIR/indexing_slicing_index.rs:21:5\n+  --> $DIR/indexing_slicing_index.rs:22:5\n    |\n LL |     v[0];\n    |     ^^^^\n    |\n    = help: Consider using `.get(n)` or `.get_mut(n)` instead\n \n error: indexing may panic.\n-  --> $DIR/indexing_slicing_index.rs:22:5\n+  --> $DIR/indexing_slicing_index.rs:23:5\n    |\n LL |     v[10];\n    |     ^^^^^\n    |\n    = help: Consider using `.get(n)` or `.get_mut(n)` instead\n \n error: indexing may panic.\n-  --> $DIR/indexing_slicing_index.rs:23:5\n+  --> $DIR/indexing_slicing_index.rs:24:5\n    |\n LL |     v[1 << 3];\n    |     ^^^^^^^^^\n    |\n    = help: Consider using `.get(n)` or `.get_mut(n)` instead\n \n error: indexing may panic.\n-  --> $DIR/indexing_slicing_index.rs:29:5\n+  --> $DIR/indexing_slicing_index.rs:30:5\n    |\n LL |     v[N];\n    |     ^^^^\n    |\n    = help: Consider using `.get(n)` or `.get_mut(n)` instead\n \n error: indexing may panic.\n-  --> $DIR/indexing_slicing_index.rs:30:5\n+  --> $DIR/indexing_slicing_index.rs:31:5\n    |\n LL |     v[M];\n    |     ^^^^\n    |\n    = help: Consider using `.get(n)` or `.get_mut(n)` instead\n \n-error: aborting due to 7 previous errors\n+error: aborting due to 6 previous errors\n "}, {"sha": "2231deee833ee362be885eaaf0a7ed3d321209a2", "filename": "tests/ui/indexing_slicing_slice.stderr", "status": "modified", "additions": 7, "deletions": 19, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/2ce2d6b40e85bf543b3a9e38cd08c7065b357807/tests%2Fui%2Findexing_slicing_slice.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2ce2d6b40e85bf543b3a9e38cd08c7065b357807/tests%2Fui%2Findexing_slicing_slice.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Findexing_slicing_slice.stderr?ref=2ce2d6b40e85bf543b3a9e38cd08c7065b357807", "patch": "@@ -71,29 +71,17 @@ LL |     &x[1..][..5];\n    |\n    = help: Consider using `.get(..n)`or `.get_mut(..n)` instead\n \n-error: slicing may panic.\n-  --> $DIR/indexing_slicing_slice.rs:24:6\n-   |\n-LL |     &y[1..2];\n-   |      ^^^^^^^\n-   |\n-   = help: Consider using `.get(n..m)` or `.get_mut(n..m)` instead\n-\n-error: slicing may panic.\n-  --> $DIR/indexing_slicing_slice.rs:25:6\n+error: range is out of bounds\n+  --> $DIR/indexing_slicing_slice.rs:25:12\n    |\n LL |     &y[0..=4];\n-   |      ^^^^^^^^\n-   |\n-   = help: Consider using `.get(n..m)` or `.get_mut(n..m)` instead\n+   |            ^\n \n-error: slicing may panic.\n-  --> $DIR/indexing_slicing_slice.rs:26:6\n+error: range is out of bounds\n+  --> $DIR/indexing_slicing_slice.rs:26:11\n    |\n LL |     &y[..=4];\n-   |      ^^^^^^^\n-   |\n-   = help: Consider using `.get(..n)`or `.get_mut(..n)` instead\n+   |           ^\n \n error: slicing may panic.\n   --> $DIR/indexing_slicing_slice.rs:31:6\n@@ -133,5 +121,5 @@ LL |     &v[..100];\n    |\n    = help: Consider using `.get(..n)`or `.get_mut(..n)` instead\n \n-error: aborting due to 17 previous errors\n+error: aborting due to 16 previous errors\n "}]}