{"sha": "5ce8e7ba85fa50e067a5262fccd130e071b679fb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjZThlN2JhODVmYTUwZTA2N2E1MjYyZmNjZDEzMGUwNzFiNjc5ZmI=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2015-08-13T13:59:12Z"}, "committer": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2015-08-13T17:48:34Z"}, "message": "trim_multiline: ignore empty lines", "tree": {"sha": "ad1fa21fd91ee2054d6f3c9930b3e12636e77ad8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ad1fa21fd91ee2054d6f3c9930b3e12636e77ad8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5ce8e7ba85fa50e067a5262fccd130e071b679fb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5ce8e7ba85fa50e067a5262fccd130e071b679fb", "html_url": "https://github.com/rust-lang/rust/commit/5ce8e7ba85fa50e067a5262fccd130e071b679fb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5ce8e7ba85fa50e067a5262fccd130e071b679fb/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dece5a6cb53248d67a761b8bd94e47cef776fcd6", "url": "https://api.github.com/repos/rust-lang/rust/commits/dece5a6cb53248d67a761b8bd94e47cef776fcd6", "html_url": "https://github.com/rust-lang/rust/commit/dece5a6cb53248d67a761b8bd94e47cef776fcd6"}], "stats": {"total": 11, "additions": 7, "deletions": 4}, "files": [{"sha": "490d2f6d1f66dc75d39e26f7d70424ae576033cb", "filename": "src/utils.rs", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/5ce8e7ba85fa50e067a5262fccd130e071b679fb/src%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ce8e7ba85fa50e067a5262fccd130e071b679fb/src%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Futils.rs?ref=5ce8e7ba85fa50e067a5262fccd130e071b679fb", "patch": "@@ -70,12 +70,15 @@ pub fn trim_multiline<'a>(s: Cow<'a, str>, ignore_first: bool) -> Cow<'a, str> {\n \n fn trim_multiline_inner<'a>(s: Cow<'a, str>, ignore_first: bool, ch: char) -> Cow<'a, str> {\n     let x = s.lines().skip(ignore_first as usize)\n-             .map(|l| l.char_indices()\n-                       .find(|&(_,x)| x != ch)\n-                       .unwrap_or((l.len(), ch)).0)\n+             .filter_map(|l| { if l.len() > 0 { // ignore empty lines\n+                                Some(l.char_indices()\n+                                      .find(|&(_,x)| x != ch)\n+                                      .unwrap_or((l.len(), ch)).0)\n+                               } else {None}})\n              .min().unwrap_or(0);\n     if x > 0 {\n-        Cow::Owned(s.lines().enumerate().map(|(i,l)| if ignore_first && i==0 {\n+        Cow::Owned(s.lines().enumerate().map(|(i,l)| if (ignore_first && i == 0) ||\n+                                                         l.len() == 0 {\n                                                         l\n                                                      } else {\n                                                         l.split_at(x).1"}]}