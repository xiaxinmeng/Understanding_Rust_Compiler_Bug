{"sha": "93c48a0977927fc3678600d0d79ef43e8f30761f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkzYzQ4YTA5Nzc5MjdmYzM2Nzg2MDBkMGQ3OWVmNDNlOGYzMDc2MWY=", "commit": {"author": {"name": "Andre Bogus", "email": "bogusandre@gmail.com", "date": "2017-08-19T20:52:49Z"}, "committer": {"name": "Andre Bogus", "email": "bogusandre@gmail.com", "date": "2017-08-19T20:52:49Z"}, "message": "remove stars at the beginning of multiline comments", "tree": {"sha": "f5302639562980de39d057399b1d1e5e99fd5729", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f5302639562980de39d057399b1d1e5e99fd5729"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/93c48a0977927fc3678600d0d79ef43e8f30761f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/93c48a0977927fc3678600d0d79ef43e8f30761f", "html_url": "https://github.com/rust-lang/rust/commit/93c48a0977927fc3678600d0d79ef43e8f30761f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/93c48a0977927fc3678600d0d79ef43e8f30761f/comments", "author": {"login": "llogiq", "id": 4200835, "node_id": "MDQ6VXNlcjQyMDA4MzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4200835?v=4", "gravatar_id": "", "url": "https://api.github.com/users/llogiq", "html_url": "https://github.com/llogiq", "followers_url": "https://api.github.com/users/llogiq/followers", "following_url": "https://api.github.com/users/llogiq/following{/other_user}", "gists_url": "https://api.github.com/users/llogiq/gists{/gist_id}", "starred_url": "https://api.github.com/users/llogiq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/llogiq/subscriptions", "organizations_url": "https://api.github.com/users/llogiq/orgs", "repos_url": "https://api.github.com/users/llogiq/repos", "events_url": "https://api.github.com/users/llogiq/events{/privacy}", "received_events_url": "https://api.github.com/users/llogiq/received_events", "type": "User", "site_admin": false}, "committer": {"login": "llogiq", "id": 4200835, "node_id": "MDQ6VXNlcjQyMDA4MzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4200835?v=4", "gravatar_id": "", "url": "https://api.github.com/users/llogiq", "html_url": "https://github.com/llogiq", "followers_url": "https://api.github.com/users/llogiq/followers", "following_url": "https://api.github.com/users/llogiq/following{/other_user}", "gists_url": "https://api.github.com/users/llogiq/gists{/gist_id}", "starred_url": "https://api.github.com/users/llogiq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/llogiq/subscriptions", "organizations_url": "https://api.github.com/users/llogiq/orgs", "repos_url": "https://api.github.com/users/llogiq/repos", "events_url": "https://api.github.com/users/llogiq/events{/privacy}", "received_events_url": "https://api.github.com/users/llogiq/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d1eecbaa2f89350ee0e45fa0238167c82d33af2d", "url": "https://api.github.com/repos/rust-lang/rust/commits/d1eecbaa2f89350ee0e45fa0238167c82d33af2d", "html_url": "https://github.com/rust-lang/rust/commit/d1eecbaa2f89350ee0e45fa0238167c82d33af2d"}], "stats": {"total": 31, "additions": 27, "deletions": 4}, "files": [{"sha": "6dbf2ea959e6a667f1be86e3a52079e48a3bf570", "filename": "clippy_lints/src/doc.rs", "status": "modified", "additions": 21, "deletions": 4, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/93c48a0977927fc3678600d0d79ef43e8f30761f/clippy_lints%2Fsrc%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/93c48a0977927fc3678600d0d79ef43e8f30761f/clippy_lints%2Fsrc%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdoc.rs?ref=93c48a0977927fc3678600d0d79ef43e8f30761f", "patch": "@@ -109,11 +109,11 @@ pub fn strip_doc_comment_decoration(comment: &str, span: Span) -> (String, Vec<(\n     if comment.starts_with(\"/*\") {\n         let doc = &comment[3..comment.len() - 2];\n         let mut sizes = vec![];\n-\n+        let mut contains_initial_stars = false;\n         for line in doc.lines() {\n             let offset = line.as_ptr() as usize - comment.as_ptr() as usize;\n             debug_assert_eq!(offset as u32 as usize, offset);\n-\n+            contains_initial_stars |= line.trim_left().starts_with('*');\n             // +1 for the newline\n             sizes.push((\n                 line.len() + 1,\n@@ -123,8 +123,25 @@ pub fn strip_doc_comment_decoration(comment: &str, span: Span) -> (String, Vec<(\n                 },\n             ));\n         }\n-\n-        return (doc.to_string(), sizes);\n+        if !contains_initial_stars {\n+            return (doc.to_string(), sizes);\n+        }\n+        // remove the initial '*'s if any\n+        let mut no_stars = String::with_capacity(doc.len());\n+        for line in doc.lines() {\n+            let mut chars = line.chars();\n+            while let Some(c) = chars.next() {\n+                if c.is_whitespace() {\n+                    no_stars.push(c);\n+                } else {\n+                    no_stars.push(if c == '*' { ' ' } else { c });\n+                    break;\n+                }\n+            }\n+            no_stars.push_str(chars.as_str());\n+            no_stars.push('\\n');\n+        }\n+        return (no_stars, sizes);\n     }\n \n     panic!(\"not a doc-comment: {}\", comment);"}, {"sha": "b03f90681f2dab723ef8d28bab74fbb94dc17c34", "filename": "tests/ui/doc.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/93c48a0977927fc3678600d0d79ef43e8f30761f/tests%2Fui%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/93c48a0977927fc3678600d0d79ef43e8f30761f/tests%2Fui%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdoc.rs?ref=93c48a0977927fc3678600d0d79ef43e8f30761f", "patch": "@@ -153,3 +153,9 @@ fn issue_902_comment() {}\n /// }\n /// ```\n fn issue_1469() {}\n+\n+/**\n+ * This is a doc comment that should not be a list\n+ *This would also be an error under a strict common mark interpretation\n+ */\n+fn issue_1920() {}"}]}