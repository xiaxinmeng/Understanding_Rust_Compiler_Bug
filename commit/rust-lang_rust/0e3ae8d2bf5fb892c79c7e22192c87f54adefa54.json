{"sha": "0e3ae8d2bf5fb892c79c7e22192c87f54adefa54", "node_id": "C_kwDOAAsO6NoAKDBlM2FlOGQyYmY1ZmI4OTJjNzljN2UyMjE5MmM4N2Y1NGFkZWZhNTQ", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-03-11T19:29:43Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-03-11T19:29:43Z"}, "message": "Rollup merge of #94769 - GuillaumeGomez:collapsed-by-default, r=notriddle\n\nCollapse blanket and auto-trait impls by default\n\nBlocked on #94740 (the two first commits come from it).\n\nThis behaviour was changed in https://github.com/rust-lang/rust/pull/88490 and apparently wasn't caught since then.\n\nYou can test it [here](https://rustdoc.crud.net/imperio/collapsed-by-default/test_docs/struct.Foo.html#blanket-implementations).\n\nr? ``@notriddle``", "tree": {"sha": "386972fa7b50aa725618eb5424e7b9775d6fdde0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/386972fa7b50aa725618eb5424e7b9775d6fdde0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0e3ae8d2bf5fb892c79c7e22192c87f54adefa54", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiK6MnCRBK7hj4Ov3rIwAAnYQIAFQJXgBDSok/2Xt5m3nAMfnl\n8VuGR5nR9EI+LU6KaV1c7UvRUWdXTbfp/wAxw8P20Ownw5rCZu7BubaEkAp5qn5C\nQEIxxBofevn2pCyNTEJQl5O5I+FUoI4J4+L/TMVF+tY9iPjZ03RK//7TWaLgzDyi\nxP0+cUltgCmU8HWMJp8xAg/zf6Uhh7UyFriy3X26QihJdCJp8KqRqWIgmra8x9X3\n7G8NW9k3H10S/A+WMmxe0UjDrZwq7uSU9G25MNCZ4kRI+DvDNh51pKu3JDpk1Sog\nK95TolgifOK1FrBlVKPnmRvT3XVfojYy+0gKN4QrJKlhwtW1orx6jgr7iFkheXA=\n=axK5\n-----END PGP SIGNATURE-----\n", "payload": "tree 386972fa7b50aa725618eb5424e7b9775d6fdde0\nparent 85056107faa408adabfa094b2be4d14906b9530f\nparent aad4227607e9c0aa2db7cd34a854563fbbf251f2\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1647026983 +0100\ncommitter GitHub <noreply@github.com> 1647026983 +0100\n\nRollup merge of #94769 - GuillaumeGomez:collapsed-by-default, r=notriddle\n\nCollapse blanket and auto-trait impls by default\n\nBlocked on #94740 (the two first commits come from it).\n\nThis behaviour was changed in https://github.com/rust-lang/rust/pull/88490 and apparently wasn't caught since then.\n\nYou can test it [here](https://rustdoc.crud.net/imperio/collapsed-by-default/test_docs/struct.Foo.html#blanket-implementations).\n\nr? ``@notriddle``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0e3ae8d2bf5fb892c79c7e22192c87f54adefa54", "html_url": "https://github.com/rust-lang/rust/commit/0e3ae8d2bf5fb892c79c7e22192c87f54adefa54", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0e3ae8d2bf5fb892c79c7e22192c87f54adefa54/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "85056107faa408adabfa094b2be4d14906b9530f", "url": "https://api.github.com/repos/rust-lang/rust/commits/85056107faa408adabfa094b2be4d14906b9530f", "html_url": "https://github.com/rust-lang/rust/commit/85056107faa408adabfa094b2be4d14906b9530f"}, {"sha": "aad4227607e9c0aa2db7cd34a854563fbbf251f2", "url": "https://api.github.com/repos/rust-lang/rust/commits/aad4227607e9c0aa2db7cd34a854563fbbf251f2", "html_url": "https://github.com/rust-lang/rust/commit/aad4227607e9c0aa2db7cd34a854563fbbf251f2"}], "stats": {"total": 25, "additions": 19, "deletions": 6}, "files": [{"sha": "34d1268a7df61d28dc179605d71b7ff6c2daee5a", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/0e3ae8d2bf5fb892c79c7e22192c87f54adefa54/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e3ae8d2bf5fb892c79c7e22192c87f54adefa54/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=0e3ae8d2bf5fb892c79c7e22192c87f54adefa54", "patch": "@@ -699,7 +699,13 @@ fn short_item_info(\n \n // Render the list of items inside one of the sections \"Trait Implementations\",\n // \"Auto Trait Implementations,\" \"Blanket Trait Implementations\" (on struct/enum pages).\n-fn render_impls(cx: &Context<'_>, w: &mut Buffer, impls: &[&&Impl], containing_item: &clean::Item) {\n+fn render_impls(\n+    cx: &Context<'_>,\n+    w: &mut Buffer,\n+    impls: &[&&Impl],\n+    containing_item: &clean::Item,\n+    toggle_open_by_default: bool,\n+) {\n     let tcx = cx.tcx();\n     let mut rendered_impls = impls\n         .iter()\n@@ -722,7 +728,7 @@ fn render_impls(cx: &Context<'_>, w: &mut Buffer, impls: &[&&Impl], containing_i\n                     is_on_foreign_type: false,\n                     show_default_items: true,\n                     show_non_assoc_items: true,\n-                    toggle_open_by_default: true,\n+                    toggle_open_by_default,\n                 },\n             );\n             buffer.into_inner()\n@@ -1143,7 +1149,7 @@ fn render_assoc_items_inner(\n             concrete.into_iter().partition(|t| t.inner_impl().kind.is_blanket());\n \n         let mut impls = Buffer::empty_from(w);\n-        render_impls(cx, &mut impls, &concrete, containing_item);\n+        render_impls(cx, &mut impls, &concrete, containing_item, true);\n         let impls = impls.into_inner();\n         if !impls.is_empty() {\n             write!(\n@@ -1165,7 +1171,7 @@ fn render_assoc_items_inner(\n                  </h2>\\\n                  <div id=\\\"synthetic-implementations-list\\\">\",\n             );\n-            render_impls(cx, w, &synthetic, containing_item);\n+            render_impls(cx, w, &synthetic, containing_item, false);\n             w.write_str(\"</div>\");\n         }\n \n@@ -1177,7 +1183,7 @@ fn render_assoc_items_inner(\n                  </h2>\\\n                  <div id=\\\"blanket-implementations-list\\\">\",\n             );\n-            render_impls(cx, w, &blanket_impl, containing_item);\n+            render_impls(cx, w, &blanket_impl, containing_item, false);\n             w.write_str(\"</div>\");\n         }\n     }"}, {"sha": "bbc85ecd4ad49e3d75448c84bafb213644cbd601", "filename": "src/test/rustdoc-gui/toggle-docs.goml", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/0e3ae8d2bf5fb892c79c7e22192c87f54adefa54/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs.goml", "raw_url": "https://github.com/rust-lang/rust/raw/0e3ae8d2bf5fb892c79c7e22192c87f54adefa54/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Ftoggle-docs.goml?ref=0e3ae8d2bf5fb892c79c7e22192c87f54adefa54", "patch": "@@ -17,7 +17,14 @@ assert-text: (\"#toggle-all-docs\", \"[\u2212]\")\n goto: file://|DOC_PATH|/test_docs/struct.Foo.html\n // We first check that everything is visible.\n assert-text: (\"#toggle-all-docs\", \"[\u2212]\")\n-assert-attribute: (\"details.rustdoc-toggle\", {\"open\": \"\"}, ALL)\n+assert-attribute: (\"#implementations-list details.rustdoc-toggle\", {\"open\": \"\"}, ALL)\n+assert-attribute: (\"#trait-implementations-list details.rustdoc-toggle\", {\"open\": \"\"}, ALL)\n+assert-attribute-false: (\n+    \"#blanket-implementations-list > details.rustdoc-toggle\",\n+    {\"open\": \"\"},\n+    ALL,\n+)\n+\n // We collapse them all.\n click: \"#toggle-all-docs\"\n wait-for: 50"}]}