{"sha": "a6ac6b20f35f4d35d54a686ec6410bbb91373923", "node_id": "C_kwDOAAsO6NoAKGE2YWM2YjIwZjM1ZjRkMzVkNTRhNjg2ZWM2NDEwYmJiOTEzNzM5MjM", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev+love@gmail.com", "date": "2022-11-01T03:03:40Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-01T03:03:40Z"}, "message": "Rollup merge of #103007 - albertlarsan68:better-python-discovery, r=jyn514\n\nAdd better python discovery\n\nThe Microsoft Store version of Python installs itself as `pythonM.m`, with `M` being the major version and `m` the minor.\n\nThe `x.ps1` script will now search for python executables whose command matches the regex `python\\d`.\nThe `\\d` at the end is to protect from using the `pythonw` versions, which do not work as standard python.", "tree": {"sha": "037208ce9ae2d6b9b2a6bdcb7cfe1bf5d48fe1db", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/037208ce9ae2d6b9b2a6bdcb7cfe1bf5d48fe1db"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a6ac6b20f35f4d35d54a686ec6410bbb91373923", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjYIyMCRBK7hj4Ov3rIwAAxVcIAEyV+oQXm6nl9D3F3G0DvNVa\nEhQOjWxUeTSY/W+oFHNxRPx0IEZP7MTCgQiBC0dV1j/EjZIKFjQOpsMZcho1WFT+\n1OOSg321SoiRLYO5Kqf3MBYiluuW8ymRepD4yGYTjqnU19qrz+3VXAEMxKO+GZHx\nvAJByoIVTp3X0j7En91l6+XZgKPmpdxbYKc05ypVe5HoXCE4lF8UXmaoJLRqQnz7\nSbh+EDiPHp/HYQh62s7YbO1oPfXVw6+pUD1zbl25cynYef38F4p+N1Nfb0bvR8MO\nYL6Dys5GryEklzel+8f5GKU6ZZJi+Hu3zOZcc0fnCEvpyp9TFenyZO01Gb5EVs8=\n=nRCz\n-----END PGP SIGNATURE-----\n", "payload": "tree 037208ce9ae2d6b9b2a6bdcb7cfe1bf5d48fe1db\nparent 024207ab43aceb49f2ca957509c503ccf12089d7\nparent c83ddaef948e5aadf3e64169dd3ab4268834fbff\nauthor Yuki Okushi <huyuumi.dev+love@gmail.com> 1667271820 +0900\ncommitter GitHub <noreply@github.com> 1667271820 +0900\n\nRollup merge of #103007 - albertlarsan68:better-python-discovery, r=jyn514\n\nAdd better python discovery\n\nThe Microsoft Store version of Python installs itself as `pythonM.m`, with `M` being the major version and `m` the minor.\n\nThe `x.ps1` script will now search for python executables whose command matches the regex `python\\d`.\nThe `\\d` at the end is to protect from using the `pythonw` versions, which do not work as standard python.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a6ac6b20f35f4d35d54a686ec6410bbb91373923", "html_url": "https://github.com/rust-lang/rust/commit/a6ac6b20f35f4d35d54a686ec6410bbb91373923", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a6ac6b20f35f4d35d54a686ec6410bbb91373923/comments", "author": null, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "024207ab43aceb49f2ca957509c503ccf12089d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/024207ab43aceb49f2ca957509c503ccf12089d7", "html_url": "https://github.com/rust-lang/rust/commit/024207ab43aceb49f2ca957509c503ccf12089d7"}, {"sha": "c83ddaef948e5aadf3e64169dd3ab4268834fbff", "url": "https://api.github.com/repos/rust-lang/rust/commits/c83ddaef948e5aadf3e64169dd3ab4268834fbff", "html_url": "https://github.com/rust-lang/rust/commit/c83ddaef948e5aadf3e64169dd3ab4268834fbff"}], "stats": {"total": 19, "additions": 18, "deletions": 1}, "files": [{"sha": "4309b82627c9c47917df4ef29c9ef8c4a3020544", "filename": "x", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a6ac6b20f35f4d35d54a686ec6410bbb91373923/x", "raw_url": "https://github.com/rust-lang/rust/raw/a6ac6b20f35f4d35d54a686ec6410bbb91373923/x", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/x?ref=a6ac6b20f35f4d35d54a686ec6410bbb91373923", "patch": "@@ -29,5 +29,11 @@ for SEARCH_PYTHON in py python3 python python2; do\n         exec \"$python\" $extra_arg \"$xpy\" \"$@\"\n     fi\n done\n+\n+python=$(bash -c \"compgen -c python\" | grep '^python[2-3]\\.[0-9]\\+$' | head -n1)\n+if ! [ \"$python\" = \"\" ]; then\n+    exec \"$python\" \"$xpy\" \"$@\"\n+fi\n+\n echo \"$0: error: did not find python installed\" >&2\n exit 1"}, {"sha": "81b98919f436cdad411ed6f3c8c55a4180382720", "filename": "x.ps1", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/a6ac6b20f35f4d35d54a686ec6410bbb91373923/x.ps1", "raw_url": "https://github.com/rust-lang/rust/raw/a6ac6b20f35f4d35d54a686ec6410bbb91373923/x.ps1", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/x.ps1?ref=a6ac6b20f35f4d35d54a686ec6410bbb91373923", "patch": "@@ -10,11 +10,15 @@ foreach ($arg in $args) {\n     $xpy_args += \"\"\"$arg\"\"\"\n }\n \n+function Get-Application($app) {\n+    return Get-Command $app -ErrorAction SilentlyContinue -CommandType Application\n+}\n+\n foreach ($python in \"py\", \"python3\", \"python\", \"python2\") {\n     # NOTE: this only tests that the command exists in PATH, not that it's actually\n     # executable. The latter is not possible in a portable way, see\n     # https://github.com/PowerShell/PowerShell/issues/12625.\n-    if (Get-Command $python -ErrorAction SilentlyContinue) {\n+    if (Get-Application $python) {\n         if ($python -eq \"py\") {\n             # Use python3, not python2\n             $xpy_args = @(\"-3\") + $xpy_args\n@@ -24,5 +28,12 @@ foreach ($python in \"py\", \"python3\", \"python\", \"python2\") {\n     }\n }\n \n+$found = (Get-Application \"python*\" | Where-Object {$_.name -match '^python[2-3]\\.[0-9]+(\\.exe)?$'})\n+if (($null -ne $found) -and ($found.Length -ge 1)) {\n+    $python = $found[0]\n+    $process = Start-Process -NoNewWindow -Wait -PassThru $python $xpy_args\n+    Exit $process.ExitCode\n+}\n+\n Write-Error \"${PSCommandPath}: error: did not find python installed\"\n Exit 1"}]}