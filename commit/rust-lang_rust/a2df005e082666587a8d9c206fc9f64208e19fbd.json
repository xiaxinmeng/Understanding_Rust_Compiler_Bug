{"sha": "a2df005e082666587a8d9c206fc9f64208e19fbd", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEyZGYwMDVlMDgyNjY2NTg3YThkOWMyMDZmYzlmNjQyMDhlMTlmYmQ=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2019-10-23T14:42:21Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-10-23T14:42:21Z"}, "message": "Merge #2048\n\n2048: minor cleanup r=matklad a=matklad\n\n\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "30bf15cb9661f979f854688e0b517534442c362a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/30bf15cb9661f979f854688e0b517534442c362a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a2df005e082666587a8d9c206fc9f64208e19fbd", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdsGbNCRBK7hj4Ov3rIwAAdHIIAC1eKNJFR8rcVJEKO/tV4D3R\n4uz8EbO+IeGl6NWKnl/LyWwN7ntFLG+8WFKVTMlHda6tyBKUGt4qWnnj/7SLxvgS\n47RCHcweVACr8NeDZdwV+jpJei2QgVo2qs5qK2QRr2zCAVnR/NeOoV6jAoslj8F9\nRNu96xqJZfBdvfyUoLF/qIEQVRxMhyDUb7WeecKp7AXEyoqLrQKmvppnGrAC+hjs\n4UQwvP2CD42rcEvjG9QXsPbeLVDln43mZjDJJRii2T3EXQk32jdLOiuoY9gP62Xp\nKatWDq7s4v07Z2didkBTcg8A9MLtjghcG+steCIb6Lpb/qUBzYm4PyQ1yUGlsow=\n=nb8X\n-----END PGP SIGNATURE-----\n", "payload": "tree 30bf15cb9661f979f854688e0b517534442c362a\nparent d2e1f9f6da01132fd23394b5b789e4ef96ccc444\nparent afc6ee251d4ee898bfd3f57a8a139750ab86a373\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1571841741 +0000\ncommitter GitHub <noreply@github.com> 1571841741 +0000\n\nMerge #2048\n\n2048: minor cleanup r=matklad a=matklad\n\n\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a2df005e082666587a8d9c206fc9f64208e19fbd", "html_url": "https://github.com/rust-lang/rust/commit/a2df005e082666587a8d9c206fc9f64208e19fbd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a2df005e082666587a8d9c206fc9f64208e19fbd/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d2e1f9f6da01132fd23394b5b789e4ef96ccc444", "url": "https://api.github.com/repos/rust-lang/rust/commits/d2e1f9f6da01132fd23394b5b789e4ef96ccc444", "html_url": "https://github.com/rust-lang/rust/commit/d2e1f9f6da01132fd23394b5b789e4ef96ccc444"}, {"sha": "afc6ee251d4ee898bfd3f57a8a139750ab86a373", "url": "https://api.github.com/repos/rust-lang/rust/commits/afc6ee251d4ee898bfd3f57a8a139750ab86a373", "html_url": "https://github.com/rust-lang/rust/commit/afc6ee251d4ee898bfd3f57a8a139750ab86a373"}], "stats": {"total": 54, "additions": 36, "deletions": 18}, "files": [{"sha": "9c95adc53c52793c7562c76b482fd0a0c59c2529", "filename": "crates/ra_assists/src/assists/early_return.rs", "status": "modified", "additions": 36, "deletions": 18, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/a2df005e082666587a8d9c206fc9f64208e19fbd/crates%2Fra_assists%2Fsrc%2Fassists%2Fearly_return.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a2df005e082666587a8d9c206fc9f64208e19fbd/crates%2Fra_assists%2Fsrc%2Fassists%2Fearly_return.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fassists%2Fearly_return.rs?ref=a2df005e082666587a8d9c206fc9f64208e19fbd", "patch": "@@ -1,44 +1,62 @@\n-//! FIXME: write short doc here\n+//! Assist: `convert_to_guarded_return`\n+//!\n+//! Replace a large conditional with a guarded return.\n+//!\n+//! ```notrust\n+//! fn <|>main() {\n+//!     if cond {\n+//!         foo();\n+//!         bar();\n+//!     }\n+//! }\n+//! ```\n+//! ->\n+//! ```notrust\n+//! fn main() {\n+//!     if !cond {\n+//!         return;\n+//!     }\n+//!     foo();\n+//!     bar();\n+//! }\n+//! ```\n+\n+use std::ops::RangeInclusive;\n \n-use crate::{\n-    assist_ctx::{Assist, AssistCtx},\n-    AssistId,\n-};\n use hir::db::HirDatabase;\n use ra_syntax::{\n     algo::replace_children,\n-    ast::edit::IndentLevel,\n-    ast::make,\n-    ast::Block,\n-    ast::ContinueExpr,\n-    ast::IfExpr,\n-    ast::ReturnExpr,\n+    ast::{self, edit::IndentLevel, make},\n     AstNode,\n     SyntaxKind::{FN_DEF, LOOP_EXPR, L_CURLY, R_CURLY, WHILE_EXPR, WHITESPACE},\n };\n-use std::ops::RangeInclusive;\n+\n+use crate::{\n+    assist_ctx::{Assist, AssistCtx},\n+    AssistId,\n+};\n \n pub(crate) fn convert_to_guarded_return(mut ctx: AssistCtx<impl HirDatabase>) -> Option<Assist> {\n-    let if_expr: IfExpr = ctx.node_at_offset()?;\n+    let if_expr: ast::IfExpr = ctx.node_at_offset()?;\n     let expr = if_expr.condition()?.expr()?;\n     let then_block = if_expr.then_branch()?.block()?;\n     if if_expr.else_branch().is_some() {\n         return None;\n     }\n \n-    let parent_block = if_expr.syntax().parent()?.ancestors().find_map(Block::cast)?;\n+    let parent_block = if_expr.syntax().parent()?.ancestors().find_map(ast::Block::cast)?;\n \n     if parent_block.expr()? != if_expr.clone().into() {\n         return None;\n     }\n \n     // check for early return and continue\n     let first_in_then_block = then_block.syntax().first_child()?.clone();\n-    if ReturnExpr::can_cast(first_in_then_block.kind())\n-        || ContinueExpr::can_cast(first_in_then_block.kind())\n+    if ast::ReturnExpr::can_cast(first_in_then_block.kind())\n+        || ast::ContinueExpr::can_cast(first_in_then_block.kind())\n         || first_in_then_block\n             .children()\n-            .any(|x| ReturnExpr::can_cast(x.kind()) || ContinueExpr::can_cast(x.kind()))\n+            .any(|x| ast::ReturnExpr::can_cast(x.kind()) || ast::ContinueExpr::can_cast(x.kind()))\n     {\n         return None;\n     }\n@@ -86,7 +104,7 @@ pub(crate) fn convert_to_guarded_return(mut ctx: AssistCtx<impl HirDatabase>) ->\n             &mut new_if_and_then_statements,\n         );\n         edit.target(if_expr.syntax().text_range());\n-        edit.replace_ast(parent_block, Block::cast(new_block).unwrap());\n+        edit.replace_ast(parent_block, ast::Block::cast(new_block).unwrap());\n         edit.set_cursor(cursor_position);\n     });\n     ctx.build()"}]}