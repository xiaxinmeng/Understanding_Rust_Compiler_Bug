{"sha": "03c177af89efcc238053b59069eda2c1c6772622", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAzYzE3N2FmODllZmNjMjM4MDUzYjU5MDY5ZWRhMmMxYzY3NzI2MjI=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-12-18T14:32:53Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-12-18T14:32:53Z"}, "message": "Merge #6927\n\n6927: Do not merge imports with different attributes r=lnicola a=Jesse-Bakker\n\nFixes #6925 \n\nCo-authored-by: Jesse Bakker <github@jessebakker.com>", "tree": {"sha": "399c065e36e79b70258b2f77c2bcff43572d98e2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/399c065e36e79b70258b2f77c2bcff43572d98e2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/03c177af89efcc238053b59069eda2c1c6772622", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJf3L2VCRBK7hj4Ov3rIwAAdHIIACUbVJUwqnRmXdUJZUPswBDu\nAy9oHYwFlPJs9yQNkIDiEBQZg1XM1F1THz4IpgMAtEPaGQkzWnZfqOXNQwp7GPbL\nhZH3BJnm4Zgb6+A6JJsp5lmKjNCL4NYUe7DJo78OoEdFVLvmhObN8aEpEbR+Nn0m\nX6exfooXh2DNt4IW6sN04BpKtk0RVne2JJDrQGP8fxwmGd+YKYCPp2GFDyNYK/cx\nh8s14c0Xqfcnz2QKXJebGMMQlYoebEs8gyhSyFZP8Jj7tZNZA8flKNTn5Yri1/05\n9lDDKUucvxb0/CV7tifiymH6EP3yro1aJpJvDHyQO36HLYyS5M1YsLnmB285mn0=\n=pUc+\n-----END PGP SIGNATURE-----\n", "payload": "tree 399c065e36e79b70258b2f77c2bcff43572d98e2\nparent f4929fa9ccd0eda65c2b77fef163c31e33bfb89a\nparent 700034bd5a46dd6e3b5aa6322522e42c2a665fe9\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1608301973 +0000\ncommitter GitHub <noreply@github.com> 1608301973 +0000\n\nMerge #6927\n\n6927: Do not merge imports with different attributes r=lnicola a=Jesse-Bakker\n\nFixes #6925 \n\nCo-authored-by: Jesse Bakker <github@jessebakker.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/03c177af89efcc238053b59069eda2c1c6772622", "html_url": "https://github.com/rust-lang/rust/commit/03c177af89efcc238053b59069eda2c1c6772622", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/03c177af89efcc238053b59069eda2c1c6772622/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f4929fa9ccd0eda65c2b77fef163c31e33bfb89a", "url": "https://api.github.com/repos/rust-lang/rust/commits/f4929fa9ccd0eda65c2b77fef163c31e33bfb89a", "html_url": "https://github.com/rust-lang/rust/commit/f4929fa9ccd0eda65c2b77fef163c31e33bfb89a"}, {"sha": "700034bd5a46dd6e3b5aa6322522e42c2a665fe9", "url": "https://api.github.com/repos/rust-lang/rust/commits/700034bd5a46dd6e3b5aa6322522e42c2a665fe9", "html_url": "https://github.com/rust-lang/rust/commit/700034bd5a46dd6e3b5aa6322522e42c2a665fe9"}], "stats": {"total": 29, "additions": 28, "deletions": 1}, "files": [{"sha": "d6b498be36dbd9205554dcc1c6d3ede3a84e1651", "filename": "crates/ide_db/src/helpers/insert_use.rs", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/03c177af89efcc238053b59069eda2c1c6772622/crates%2Fide_db%2Fsrc%2Fhelpers%2Finsert_use.rs", "raw_url": "https://github.com/rust-lang/rust/raw/03c177af89efcc238053b59069eda2c1c6772622/crates%2Fide_db%2Fsrc%2Fhelpers%2Finsert_use.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_db%2Fsrc%2Fhelpers%2Finsert_use.rs?ref=03c177af89efcc238053b59069eda2c1c6772622", "patch": "@@ -9,7 +9,7 @@ use syntax::{\n     ast::{\n         self,\n         edit::{AstNodeEdit, IndentLevel},\n-        make, AstNode, PathSegmentKind, VisibilityOwner,\n+        make, AstNode, AttrsOwner, PathSegmentKind, VisibilityOwner,\n     },\n     AstToken, InsertPosition, NodeOrToken, SyntaxElement, SyntaxNode, SyntaxToken,\n };\n@@ -180,6 +180,15 @@ fn eq_visibility(vis0: Option<ast::Visibility>, vis1: Option<ast::Visibility>) -\n     }\n }\n \n+fn eq_attrs(\n+    attrs0: impl Iterator<Item = ast::Attr>,\n+    attrs1: impl Iterator<Item = ast::Attr>,\n+) -> bool {\n+    let attrs0 = attrs0.map(|attr| attr.to_string());\n+    let attrs1 = attrs1.map(|attr| attr.to_string());\n+    attrs0.eq(attrs1)\n+}\n+\n pub fn try_merge_imports(\n     lhs: &ast::Use,\n     rhs: &ast::Use,\n@@ -189,6 +198,10 @@ pub fn try_merge_imports(\n     if !eq_visibility(lhs.visibility(), rhs.visibility()) {\n         return None;\n     }\n+    if !eq_attrs(lhs.attrs(), rhs.attrs()) {\n+        return None;\n+    }\n+\n     let lhs_tree = lhs.use_tree()?;\n     let rhs_tree = rhs.use_tree()?;\n     let merged = try_merge_trees(&lhs_tree, &rhs_tree, merge_behavior)?;"}, {"sha": "a603fe87f2c692331b0ae43a0a36d02821a61416", "filename": "crates/ide_db/src/helpers/insert_use/tests.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/03c177af89efcc238053b59069eda2c1c6772622/crates%2Fide_db%2Fsrc%2Fhelpers%2Finsert_use%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/03c177af89efcc238053b59069eda2c1c6772622/crates%2Fide_db%2Fsrc%2Fhelpers%2Finsert_use%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_db%2Fsrc%2Fhelpers%2Finsert_use%2Ftests.rs?ref=03c177af89efcc238053b59069eda2c1c6772622", "patch": "@@ -447,6 +447,20 @@ use std::io;\",\n     )\n }\n \n+#[test]\n+fn merge_groups_skip_attributed() {\n+    check_full(\n+        \"std::io\",\n+        r#\"\n+#[cfg(feature = \"gated\")] use std::fmt::{Result, Display};\n+\"#,\n+        r#\"\n+#[cfg(feature = \"gated\")] use std::fmt::{Result, Display};\n+use std::io;\n+\"#,\n+    )\n+}\n+\n #[test]\n #[ignore] // FIXME: Support this\n fn split_out_merge() {"}]}