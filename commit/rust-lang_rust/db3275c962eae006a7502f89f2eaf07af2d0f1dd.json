{"sha": "db3275c962eae006a7502f89f2eaf07af2d0f1dd", "node_id": "C_kwDOAAsO6NoAKGRiMzI3NWM5NjJlYWUwMDZhNzUwMmY4OWYyZWFmMDdhZjJkMGYxZGQ", "commit": {"author": {"name": "Bryan Garza", "email": "1396101+bryangarza@users.noreply.github.com", "date": "2023-04-28T01:33:52Z"}, "committer": {"name": "Bryan Garza", "email": "1396101+bryangarza@users.noreply.github.com", "date": "2023-05-24T21:52:19Z"}, "message": "Safe Transmute: Add alignment tests", "tree": {"sha": "276307fe1071130a960266f3c42088fc0000c99d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/276307fe1071130a960266f3c42088fc0000c99d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/db3275c962eae006a7502f89f2eaf07af2d0f1dd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/db3275c962eae006a7502f89f2eaf07af2d0f1dd", "html_url": "https://github.com/rust-lang/rust/commit/db3275c962eae006a7502f89f2eaf07af2d0f1dd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/db3275c962eae006a7502f89f2eaf07af2d0f1dd/comments", "author": {"login": "bryangarza", "id": 1396101, "node_id": "MDQ6VXNlcjEzOTYxMDE=", "avatar_url": "https://avatars.githubusercontent.com/u/1396101?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bryangarza", "html_url": "https://github.com/bryangarza", "followers_url": "https://api.github.com/users/bryangarza/followers", "following_url": "https://api.github.com/users/bryangarza/following{/other_user}", "gists_url": "https://api.github.com/users/bryangarza/gists{/gist_id}", "starred_url": "https://api.github.com/users/bryangarza/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bryangarza/subscriptions", "organizations_url": "https://api.github.com/users/bryangarza/orgs", "repos_url": "https://api.github.com/users/bryangarza/repos", "events_url": "https://api.github.com/users/bryangarza/events{/privacy}", "received_events_url": "https://api.github.com/users/bryangarza/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bryangarza", "id": 1396101, "node_id": "MDQ6VXNlcjEzOTYxMDE=", "avatar_url": "https://avatars.githubusercontent.com/u/1396101?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bryangarza", "html_url": "https://github.com/bryangarza", "followers_url": "https://api.github.com/users/bryangarza/followers", "following_url": "https://api.github.com/users/bryangarza/following{/other_user}", "gists_url": "https://api.github.com/users/bryangarza/gists{/gist_id}", "starred_url": "https://api.github.com/users/bryangarza/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bryangarza/subscriptions", "organizations_url": "https://api.github.com/users/bryangarza/orgs", "repos_url": "https://api.github.com/users/bryangarza/repos", "events_url": "https://api.github.com/users/bryangarza/events{/privacy}", "received_events_url": "https://api.github.com/users/bryangarza/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "94ad084ac611b7c21d4f08b1eb30623f09db2cd0", "url": "https://api.github.com/repos/rust-lang/rust/commits/94ad084ac611b7c21d4f08b1eb30623f09db2cd0", "html_url": "https://github.com/rust-lang/rust/commit/94ad084ac611b7c21d4f08b1eb30623f09db2cd0"}], "stats": {"total": 76, "additions": 76, "deletions": 0}, "files": [{"sha": "7f6090a6e4db567b5dd6250aa9829e5716379ef4", "filename": "tests/ui/transmutability/alignment/align-fail.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/db3275c962eae006a7502f89f2eaf07af2d0f1dd/tests%2Fui%2Ftransmutability%2Falignment%2Falign-fail.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db3275c962eae006a7502f89f2eaf07af2d0f1dd/tests%2Fui%2Ftransmutability%2Falignment%2Falign-fail.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftransmutability%2Falignment%2Falign-fail.rs?ref=db3275c962eae006a7502f89f2eaf07af2d0f1dd", "patch": "@@ -0,0 +1,23 @@\n+// check-fail\n+#![feature(transmutability)]\n+\n+mod assert {\n+    use std::mem::{Assume, BikeshedIntrinsicFrom};\n+    pub struct Context;\n+\n+    pub fn is_maybe_transmutable<Src, Dst>()\n+    where\n+        Dst: BikeshedIntrinsicFrom<Src, Context, {\n+            Assume {\n+                alignment: false,\n+                lifetimes: true,\n+                safety: true,\n+                validity: true,\n+            }\n+        }>\n+    {}\n+}\n+\n+fn main() {\n+    assert::is_maybe_transmutable::<&'static [u8; 0], &'static [u16; 0]>(); //~ ERROR `&[u8; 0]` cannot be safely transmuted into `&[u16; 0]`\n+}"}, {"sha": "8a191dc61776d33f9e56df6dbeb42f764cbb33fa", "filename": "tests/ui/transmutability/alignment/align-fail.stderr", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/db3275c962eae006a7502f89f2eaf07af2d0f1dd/tests%2Fui%2Ftransmutability%2Falignment%2Falign-fail.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/db3275c962eae006a7502f89f2eaf07af2d0f1dd/tests%2Fui%2Ftransmutability%2Falignment%2Falign-fail.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftransmutability%2Falignment%2Falign-fail.stderr?ref=db3275c962eae006a7502f89f2eaf07af2d0f1dd", "patch": "@@ -0,0 +1,30 @@\n+error[E0277]: `&[u8; 0]` cannot be safely transmuted into `&[u16; 0]` in the defining scope of `assert::Context`\n+  --> $DIR/align-fail.rs:22:55\n+   |\n+LL | ...tatic [u8; 0], &'static [u16; 0]>();\n+   |                   ^^^^^^^^^^^^^^^^^ The alignment of `&[u8; 0]` should be stricter than that of `&[u16; 0]`, but it is not\n+   |\n+note: required by a bound in `is_maybe_transmutable`\n+  --> $DIR/align-fail.rs:10:14\n+   |\n+LL |       pub fn is_maybe_transmutable<Src, Dst>()\n+   |              --------------------- required by a bound in this function\n+LL |       where\n+LL |           Dst: BikeshedIntrinsicFrom<Src, Context, {\n+   |  ______________^\n+LL | |             Assume {\n+LL | |                 alignment: false,\n+LL | |                 lifetimes: true,\n+...  |\n+LL | |             }\n+LL | |         }>\n+   | |__________^ required by this bound in `is_maybe_transmutable`\n+help: consider removing the leading `&`-reference\n+   |\n+LL -     assert::is_maybe_transmutable::<&'static [u8; 0], &'static [u16; 0]>();\n+LL +     assert::is_maybe_transmutable::<&'static [u8; 0], [u16; 0]>();\n+   |\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0277`."}, {"sha": "62dc672eacb9b1893807709931487576691bea36", "filename": "tests/ui/transmutability/alignment/align-pass.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/db3275c962eae006a7502f89f2eaf07af2d0f1dd/tests%2Fui%2Ftransmutability%2Falignment%2Falign-pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db3275c962eae006a7502f89f2eaf07af2d0f1dd/tests%2Fui%2Ftransmutability%2Falignment%2Falign-pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftransmutability%2Falignment%2Falign-pass.rs?ref=db3275c962eae006a7502f89f2eaf07af2d0f1dd", "patch": "@@ -0,0 +1,23 @@\n+// check-pass\n+#![feature(transmutability)]\n+\n+mod assert {\n+    use std::mem::{Assume, BikeshedIntrinsicFrom};\n+    pub struct Context;\n+\n+    pub fn is_maybe_transmutable<Src, Dst>()\n+    where\n+        Dst: BikeshedIntrinsicFrom<Src, Context, {\n+            Assume {\n+                alignment: false,\n+                lifetimes: false,\n+                safety: true,\n+                validity: false,\n+            }\n+        }>\n+    {}\n+}\n+\n+fn main() {\n+    assert::is_maybe_transmutable::<&'static [u16; 0], &'static [u8; 0]>();\n+}"}]}