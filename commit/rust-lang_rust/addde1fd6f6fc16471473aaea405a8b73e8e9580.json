{"sha": "addde1fd6f6fc16471473aaea405a8b73e8e9580", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFkZGRlMWZkNmY2ZmMxNjQ3MTQ3M2FhZWE0MDVhOGI3M2U4ZTk1ODA=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2016-03-12T20:46:59Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2016-03-23T23:41:48Z"}, "message": "Make warnings of renamed and removed lints themselves lints\n\nThis adds the `renamed_and_removed_lints` warning, defaulting\nto the warning level.\n\nFixes #31141", "tree": {"sha": "df0d821a439a77b9c6f5736b7fdeebb50189ef78", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/df0d821a439a77b9c6f5736b7fdeebb50189ef78"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/addde1fd6f6fc16471473aaea405a8b73e8e9580", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/addde1fd6f6fc16471473aaea405a8b73e8e9580", "html_url": "https://github.com/rust-lang/rust/commit/addde1fd6f6fc16471473aaea405a8b73e8e9580", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/addde1fd6f6fc16471473aaea405a8b73e8e9580/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "98f0a9128f0fc6545de14a5de8f0e91675045e56", "url": "https://api.github.com/repos/rust-lang/rust/commits/98f0a9128f0fc6545de14a5de8f0e91675045e56", "html_url": "https://github.com/rust-lang/rust/commit/98f0a9128f0fc6545de14a5de8f0e91675045e56"}], "stats": {"total": 98, "additions": 68, "deletions": 30}, "files": [{"sha": "f2371c1819fc429fb7be2f9c50445e1286a45189", "filename": "src/librustc/lint/builtin.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/addde1fd6f6fc16471473aaea405a8b73e8e9580/src%2Flibrustc%2Flint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/addde1fd6f6fc16471473aaea405a8b73e8e9580/src%2Flibrustc%2Flint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fbuiltin.rs?ref=addde1fd6f6fc16471473aaea405a8b73e8e9580", "patch": "@@ -160,6 +160,12 @@ declare_lint! {\n     \"two overlapping inherent impls define an item with the same name were erroneously allowed\"\n }\n \n+declare_lint! {\n+    pub RENAMED_AND_REMOVED_LINTS,\n+    Warn,\n+    \"lints that have been renamed or removed\"\n+}\n+\n /// Does nothing as a lint pass, but registers some `Lint`s\n /// which are used by other parts of the compiler.\n #[derive(Copy, Clone)]\n@@ -191,7 +197,8 @@ impl LintPass for HardwiredLints {\n             CONST_ERR,\n             RAW_POINTER_DERIVE,\n             TRANSMUTE_FROM_FN_ITEM_TYPES,\n-            OVERLAPPING_INHERENT_IMPLS\n+            OVERLAPPING_INHERENT_IMPLS,\n+            RENAMED_AND_REMOVED_LINTS\n         )\n     }\n }"}, {"sha": "079a0c94cc5a51567f4fac0c7c9a26fbe19286df", "filename": "src/librustc/lint/context.rs", "status": "modified", "additions": 21, "deletions": 26, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/addde1fd6f6fc16471473aaea405a8b73e8e9580/src%2Flibrustc%2Flint%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/addde1fd6f6fc16471473aaea405a8b73e8e9580/src%2Flibrustc%2Flint%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fcontext.rs?ref=addde1fd6f6fc16471473aaea405a8b73e8e9580", "patch": "@@ -1144,13 +1144,13 @@ impl LateLintPass for GatherNodeLevels {\n     }\n }\n \n-enum CheckLintNameResult<'a> {\n+enum CheckLintNameResult {\n     Ok,\n     // Lint doesn't exist\n     NoLint,\n-    // The lint is either renamed or removed and a warning was\n-    // generated in the DiagnosticBuilder\n-    Mentioned(DiagnosticBuilder<'a>)\n+    // The lint is either renamed or removed. This is the warning\n+    // message.\n+    Warning(String)\n }\n \n /// Checks the name of a lint for its existence, and whether it was\n@@ -1160,27 +1160,18 @@ enum CheckLintNameResult<'a> {\n /// it emits non-fatal warnings and there are *two* lint passes that\n /// inspect attributes, this is only run from the late pass to avoid\n /// printing duplicate warnings.\n-fn check_lint_name<'a>(sess: &'a Session,\n-                       lint_cx: &LintStore,\n-                       lint_name: &str,\n-                       span: Option<Span>) -> CheckLintNameResult<'a> {\n+fn check_lint_name(lint_cx: &LintStore,\n+                   lint_name: &str) -> CheckLintNameResult {\n     match lint_cx.by_name.get(lint_name) {\n         Some(&Renamed(ref new_name, _)) => {\n-            let warning = format!(\"lint {} has been renamed to {}\",\n-                                  lint_name, new_name);\n-            let db = match span {\n-                Some(span) => sess.struct_span_warn(span, &warning[..]),\n-                None => sess.struct_warn(&warning[..]),\n-            };\n-            CheckLintNameResult::Mentioned(db)\n+            CheckLintNameResult::Warning(\n+                format!(\"lint {} has been renamed to {}\", lint_name, new_name)\n+            )\n         },\n         Some(&Removed(ref reason)) => {\n-            let warning = format!(\"lint {} has been removed: {}\", lint_name, reason);\n-            let db = match span {\n-                Some(span) => sess.struct_span_warn(span, &warning[..]),\n-                None => sess.struct_warn(&warning[..])\n-            };\n-            CheckLintNameResult::Mentioned(db)\n+            CheckLintNameResult::Warning(\n+                format!(\"lint {} has been removed: {}\", lint_name, reason)\n+            )\n         },\n         None => {\n             match lint_cx.lint_groups.get(lint_name) {\n@@ -1209,10 +1200,12 @@ fn check_lint_name_attribute(cx: &LateContext, attr: &ast::Attribute) {\n                 continue;\n             }\n             Ok((lint_name, _, span)) => {\n-                match check_lint_name(&cx.tcx.sess, &cx.lints, &lint_name[..], Some(span)) {\n+                match check_lint_name(&cx.lints,\n+                                      &lint_name[..]) {\n                     CheckLintNameResult::Ok => (),\n-                    CheckLintNameResult::Mentioned(mut db) => {\n-                        db.emit();\n+                    CheckLintNameResult::Warning(ref msg) => {\n+                        cx.span_lint(builtin::RENAMED_AND_REMOVED_LINTS,\n+                                     span, msg);\n                     }\n                     CheckLintNameResult::NoLint => {\n                         cx.span_lint(builtin::UNKNOWN_LINTS, span,\n@@ -1228,9 +1221,11 @@ fn check_lint_name_attribute(cx: &LateContext, attr: &ast::Attribute) {\n // Checks the validity of lint names derived from the command line\n fn check_lint_name_cmdline(sess: &Session, lint_cx: &LintStore,\n                            lint_name: &str, level: Level) {\n-    let db = match check_lint_name(sess, lint_cx, lint_name, None) {\n+    let db = match check_lint_name(lint_cx, lint_name) {\n         CheckLintNameResult::Ok => None,\n-        CheckLintNameResult::Mentioned(db) => Some(db),\n+        CheckLintNameResult::Warning(ref msg) => {\n+            Some(sess.struct_warn(msg))\n+        },\n         CheckLintNameResult::NoLint => {\n             Some(sess.struct_err(&format!(\"unknown lint: `{}`\", lint_name)))\n         }"}, {"sha": "159a3d746034e81da9d2737b349a34c34cca6740", "filename": "src/test/compile-fail/lint-removed-allow.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/addde1fd6f6fc16471473aaea405a8b73e8e9580/src%2Ftest%2Fcompile-fail%2Flint-removed-allow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/addde1fd6f6fc16471473aaea405a8b73e8e9580/src%2Ftest%2Fcompile-fail%2Flint-removed-allow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-removed-allow.rs?ref=addde1fd6f6fc16471473aaea405a8b73e8e9580", "patch": "@@ -0,0 +1,17 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// No warnings about removed lint when\n+// allow(renamed_and_removed_lints)\n+\n+#[deny(raw_pointer_derive)]\n+#[allow(renamed_and_removed_lints)]\n+#[deny(unused_variables)]\n+fn main() { let unused = (); } //~ ERR unused"}, {"sha": "9069356604131a789305a1a10202d9ce5afdfc24", "filename": "src/test/compile-fail/lint-removed.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/addde1fd6f6fc16471473aaea405a8b73e8e9580/src%2Ftest%2Fcompile-fail%2Flint-removed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/addde1fd6f6fc16471473aaea405a8b73e8e9580/src%2Ftest%2Fcompile-fail%2Flint-removed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-removed.rs?ref=addde1fd6f6fc16471473aaea405a8b73e8e9580", "patch": "@@ -8,9 +8,11 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// The raw_pointer_derived lint only warns about its own removal\n+// The raw_pointer_derived lint was removed, but is now reported by\n+// the renamed_and_removed_lints lint, which means it's a warning by\n+// default, and allowed in cargo dependency builds.\n // cc #30346\n \n #[deny(raw_pointer_derive)] //~ WARN raw_pointer_derive has been removed\n-#[deny(warnings)]\n+#[deny(unused_variables)]\n fn main() { let unused = (); } //~ ERR unused"}, {"sha": "a2426d80f714dec1b0de3639e07257fb8e6abd64", "filename": "src/test/compile-fail/lint-renamed-allow.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/addde1fd6f6fc16471473aaea405a8b73e8e9580/src%2Ftest%2Fcompile-fail%2Flint-renamed-allow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/addde1fd6f6fc16471473aaea405a8b73e8e9580/src%2Ftest%2Fcompile-fail%2Flint-renamed-allow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-renamed-allow.rs?ref=addde1fd6f6fc16471473aaea405a8b73e8e9580", "patch": "@@ -0,0 +1,17 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// No warnings about renamed lint when\n+// allow(renamed_and_removed_lints)\n+\n+#[deny(unknown_features)]\n+#[allow(renamed_and_removed_lints)]\n+#[deny(unused)]\n+fn main() { let unused = (); } //~ ERR unused"}, {"sha": "27cafeacc203d73f5911dd7e88c59cc05270e9a0", "filename": "src/test/run-pass/ifmt.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/addde1fd6f6fc16471473aaea405a8b73e8e9580/src%2Ftest%2Frun-pass%2Fifmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/addde1fd6f6fc16471473aaea405a8b73e8e9580/src%2Ftest%2Frun-pass%2Fifmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fifmt.rs?ref=addde1fd6f6fc16471473aaea405a8b73e8e9580", "patch": "@@ -12,7 +12,7 @@\n \n #![deny(warnings)]\n #![allow(unused_must_use)]\n-#![allow(unknown_features)]\n+#![allow(unused_features)]\n #![feature(box_syntax)]\n #![feature(question_mark)]\n "}]}