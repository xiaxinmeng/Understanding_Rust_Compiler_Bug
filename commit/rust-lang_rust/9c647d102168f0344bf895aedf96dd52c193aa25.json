{"sha": "9c647d102168f0344bf895aedf96dd52c193aa25", "node_id": "MDY6Q29tbWl0NzI0NzEyOjljNjQ3ZDEwMjE2OGYwMzQ0YmY4OTVhZWRmOTZkZDUyYzE5M2FhMjU=", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2020-11-02T12:17:14Z"}, "committer": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2020-11-02T12:21:18Z"}, "message": "Improve deprecation attribute diagnostic messages.\n\n(From the PR feedback.)\n\nCo-authored-by: Esteban K\u00fcber <esteban@kuber.com.ar>", "tree": {"sha": "a9086c4eea91a8105a187c9d03d5282f644d1b7f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a9086c4eea91a8105a187c9d03d5282f644d1b7f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9c647d102168f0344bf895aedf96dd52c193aa25", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9c647d102168f0344bf895aedf96dd52c193aa25", "html_url": "https://github.com/rust-lang/rust/commit/9c647d102168f0344bf895aedf96dd52c193aa25", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9c647d102168f0344bf895aedf96dd52c193aa25/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9fc991a0ea1df0a5ef96c50fb8dce115c096d8f5", "url": "https://api.github.com/repos/rust-lang/rust/commits/9fc991a0ea1df0a5ef96c50fb8dce115c096d8f5", "html_url": "https://github.com/rust-lang/rust/commit/9fc991a0ea1df0a5ef96c50fb8dce115c096d8f5"}], "stats": {"total": 31, "additions": 12, "deletions": 19}, "files": [{"sha": "2fd625c2a6c260a6fefda2f61555f3d0c2981374", "filename": "compiler/rustc_attr/src/builtin.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9c647d102168f0344bf895aedf96dd52c193aa25/compiler%2Frustc_attr%2Fsrc%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c647d102168f0344bf895aedf96dd52c193aa25/compiler%2Frustc_attr%2Fsrc%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_attr%2Fsrc%2Fbuiltin.rs?ref=9c647d102168f0344bf895aedf96dd52c193aa25", "patch": "@@ -656,7 +656,8 @@ where\n \n         if let Some((_, span)) = &depr {\n             struct_span_err!(diagnostic, attr.span, E0550, \"multiple deprecated attributes\")\n-                .span_note(*span, \"first deprecation attribute here\")\n+                .span_label(attr.span, \"repeated deprecation attribute\")\n+                .span_label(*span, \"first deprecation attribute\")\n                 .emit();\n             break;\n         }"}, {"sha": "04b5c65e464fb5e52eec4ad4396ac17c29a3c604", "filename": "compiler/rustc_passes/src/stability.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9c647d102168f0344bf895aedf96dd52c193aa25/compiler%2Frustc_passes%2Fsrc%2Fstability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c647d102168f0344bf895aedf96dd52c193aa25/compiler%2Frustc_passes%2Fsrc%2Fstability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fstability.rs?ref=9c647d102168f0344bf895aedf96dd52c193aa25", "patch": "@@ -92,10 +92,10 @@ impl<'a, 'tcx> Annotator<'a, 'tcx> {\n \n             if kind == AnnotationKind::Prohibited || kind == AnnotationKind::DeprecationProhibited {\n                 self.tcx.struct_span_lint_hir(USELESS_DEPRECATED, hir_id, *span, |lint| {\n-                    lint.build(\"this `#[deprecated]' annotation has no effect\")\n-                        .span_suggestion(\n+                    lint.build(\"this `#[deprecated]` annotation has no effect\")\n+                        .span_suggestion_short(\n                             *span,\n-                            \"try removing the deprecation attribute\",\n+                            \"remove the unnecessary deprecation attribute\",\n                             String::new(),\n                             rustc_errors::Applicability::MachineApplicable,\n                         )"}, {"sha": "4fc3fddadb99ee279f568b83eaad84b846af206f", "filename": "src/test/ui/deprecation/deprecation-sanity.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9c647d102168f0344bf895aedf96dd52c193aa25/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-sanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c647d102168f0344bf895aedf96dd52c193aa25/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-sanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-sanity.rs?ref=9c647d102168f0344bf895aedf96dd52c193aa25", "patch": "@@ -32,7 +32,7 @@ fn f1() { }\n \n struct X;\n \n-#[deprecated = \"hello\"] //~ ERROR this `#[deprecated]' annotation has no effect\n+#[deprecated = \"hello\"] //~ ERROR this `#[deprecated]` annotation has no effect\n impl Default for X {\n     fn default() -> Self {\n         X"}, {"sha": "7e70c35eeabdf37b11fcba42dd2395eebb66819a", "filename": "src/test/ui/deprecation/deprecation-sanity.stderr", "status": "modified", "additions": 4, "deletions": 8, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9c647d102168f0344bf895aedf96dd52c193aa25/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-sanity.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9c647d102168f0344bf895aedf96dd52c193aa25/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-sanity.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdeprecation%2Fdeprecation-sanity.stderr?ref=9c647d102168f0344bf895aedf96dd52c193aa25", "patch": "@@ -44,25 +44,21 @@ error[E0550]: multiple deprecated attributes\n   --> $DIR/deprecation-sanity.rs:27:1\n    |\n LL | #[deprecated(since = \"a\", note = \"b\")]\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-note: first deprecation attribute here\n-  --> $DIR/deprecation-sanity.rs:26:1\n-   |\n+   | -------------------------------------- first deprecation attribute\n LL | #[deprecated(since = \"a\", note = \"b\")]\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ repeated deprecation attribute\n \n error[E0538]: multiple 'since' items\n   --> $DIR/deprecation-sanity.rs:30:27\n    |\n LL | #[deprecated(since = \"a\", since = \"b\", note = \"c\")]\n    |                           ^^^^^^^^^^^\n \n-error: this `#[deprecated]' annotation has no effect\n+error: this `#[deprecated]` annotation has no effect\n   --> $DIR/deprecation-sanity.rs:35:1\n    |\n LL | #[deprecated = \"hello\"]\n-   | ^^^^^^^^^^^^^^^^^^^^^^^ help: try removing the deprecation attribute\n+   | ^^^^^^^^^^^^^^^^^^^^^^^ help: remove the unnecessary deprecation attribute\n    |\n    = note: `#[deny(useless_deprecated)]` on by default\n "}, {"sha": "bf2436a535fd46cf96f83de95539b028f3aafc0f", "filename": "src/test/ui/stability-attribute/stability-attribute-sanity.stderr", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9c647d102168f0344bf895aedf96dd52c193aa25/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-sanity.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9c647d102168f0344bf895aedf96dd52c193aa25/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-sanity.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstability-attribute%2Fstability-attribute-sanity.stderr?ref=9c647d102168f0344bf895aedf96dd52c193aa25", "patch": "@@ -86,13 +86,9 @@ error[E0550]: multiple deprecated attributes\n   --> $DIR/stability-attribute-sanity.rs:62:1\n    |\n LL | #[rustc_deprecated(since = \"b\", reason = \"text\")]\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-note: first deprecation attribute here\n-  --> $DIR/stability-attribute-sanity.rs:61:1\n-   |\n+   | ------------------------------------------------- first deprecation attribute\n LL | #[rustc_deprecated(since = \"b\", reason = \"text\")]\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ repeated deprecation attribute\n \n error[E0544]: multiple stability levels\n   --> $DIR/stability-attribute-sanity.rs:64:1"}]}