{"sha": "5bf268d0b028d8e8abe62166c533f8515955bc6b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjViZjI2OGQwYjAyOGQ4ZThhYmU2MjE2NmM1MzNmODUxNTk1NWJjNmI=", "commit": {"author": {"name": "Edward Wang", "email": "edward.yu.wang@gmail.com", "date": "2014-05-13T05:20:52Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-05-14T00:24:07Z"}, "message": "Fix #8391\n\nCloses #8391", "tree": {"sha": "69a9db419c28a5a1a0605da3b108d0e564eb936a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/69a9db419c28a5a1a0605da3b108d0e564eb936a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5bf268d0b028d8e8abe62166c533f8515955bc6b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5bf268d0b028d8e8abe62166c533f8515955bc6b", "html_url": "https://github.com/rust-lang/rust/commit/5bf268d0b028d8e8abe62166c533f8515955bc6b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5bf268d0b028d8e8abe62166c533f8515955bc6b/comments", "author": {"login": "edwardw", "id": 454049, "node_id": "MDQ6VXNlcjQ1NDA0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/454049?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwardw", "html_url": "https://github.com/edwardw", "followers_url": "https://api.github.com/users/edwardw/followers", "following_url": "https://api.github.com/users/edwardw/following{/other_user}", "gists_url": "https://api.github.com/users/edwardw/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwardw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwardw/subscriptions", "organizations_url": "https://api.github.com/users/edwardw/orgs", "repos_url": "https://api.github.com/users/edwardw/repos", "events_url": "https://api.github.com/users/edwardw/events{/privacy}", "received_events_url": "https://api.github.com/users/edwardw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "655487b59666afe5a5c9e0a305c27be342b8fa46", "url": "https://api.github.com/repos/rust-lang/rust/commits/655487b59666afe5a5c9e0a305c27be342b8fa46", "html_url": "https://github.com/rust-lang/rust/commit/655487b59666afe5a5c9e0a305c27be342b8fa46"}], "stats": {"total": 15, "additions": 12, "deletions": 3}, "files": [{"sha": "c08078ff86b5d669337fb090eede3a5bd414c135", "filename": "src/librustc/middle/check_match.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/5bf268d0b028d8e8abe62166c533f8515955bc6b/src%2Flibrustc%2Fmiddle%2Fcheck_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5bf268d0b028d8e8abe62166c533f8515955bc6b/src%2Flibrustc%2Fmiddle%2Fcheck_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fcheck_match.rs?ref=5bf268d0b028d8e8abe62166c533f8515955bc6b", "patch": "@@ -239,7 +239,15 @@ fn is_useful(cx: &MatchCheckCtxt, m: &matrix, v: &[@Pat]) -> useful {\n         return not_useful\n     }\n     let real_pat = match m.iter().find(|r| r.get(0).id != 0) {\n-      Some(r) => *r.get(0), None => v[0]\n+        Some(r) => {\n+            match r.get(0).node {\n+                // An arm of the form `ref x @ sub_pat` has type\n+                // `sub_pat`, not `&sub_pat` as `x` itself does.\n+                PatIdent(BindByRef(_), _, Some(sub)) => sub,\n+                _ => *r.get(0)\n+            }\n+        }\n+        None => v[0]\n     };\n     let left_ty = if real_pat.id == 0 { ty::mk_nil() }\n                   else { ty::node_id_to_type(cx.tcx, real_pat.id) };"}, {"sha": "86c9b8c69646941d5f6809ed467018ae989f9661", "filename": "src/test/run-pass/issue-8391.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5bf268d0b028d8e8abe62166c533f8515955bc6b/src%2Ftest%2Frun-pass%2Fissue-8391.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5bf268d0b028d8e8abe62166c533f8515955bc6b/src%2Ftest%2Frun-pass%2Fissue-8391.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-8391.rs?ref=5bf268d0b028d8e8abe62166c533f8515955bc6b", "patch": "@@ -9,8 +9,9 @@\n // except according to those terms.\n \n fn main() {\n-    let _x = match Some(1) {\n-        _y @ Some(_) => 1,\n+    let x = match Some(1) {\n+        ref _y @ Some(_) => 1,\n         None => 2,\n     };\n+    assert_eq!(x, 1);\n }"}]}