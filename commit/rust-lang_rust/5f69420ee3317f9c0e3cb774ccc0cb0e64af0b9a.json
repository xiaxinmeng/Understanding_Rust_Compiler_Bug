{"sha": "5f69420ee3317f9c0e3cb774ccc0cb0e64af0b9a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVmNjk0MjBlZTMzMTdmOWMwZTNjYjc3NGNjYzBjYjBlNjRhZjBiOWE=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-06-11T16:27:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-06-11T16:27:42Z"}, "message": "Merge #9216\n\n9216: fix: Don't allow lookup by self for unprefixed self access completions r=Veykril a=Veykril\n\nFixes #9211\r\nbors r+\n\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>", "tree": {"sha": "75533a57783e7ec7763f0d01a4f68b552460b9c8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/75533a57783e7ec7763f0d01a4f68b552460b9c8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5f69420ee3317f9c0e3cb774ccc0cb0e64af0b9a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgw47+CRBK7hj4Ov3rIwAAbKgIAInmN7WxIupLw8WMlvKgaMUz\n37u6rMOfPVNhpe32iT325nOqtSsEIeVzE0lh9jDhftaHcc9EU4LHwced/sI8Lpta\ndmyyg67nmXRMQHw+CVhr2Pa64L4GfxKXRWd7n2zXzp5kcdCsM7nVhHdkuCvMsoD5\nQE9hMUi95fYToXAt1fIDHiEceFsdsEmUlaBA/Qg2GvZDUH/hTK+Kg9O3bjkse1RC\nVUUWbnv9nxZVtJ5IVF0YsGCgkpL3kq40Aq5zNpgO+mTz+3fU51SD17isY72wpd9X\nwUtc2iIwKV27vxvvYqcpXS/xuwCBCFs6hlvUIrcHLYS+ANxX7YCdEEBI98bKvJI=\n=v0A9\n-----END PGP SIGNATURE-----\n", "payload": "tree 75533a57783e7ec7763f0d01a4f68b552460b9c8\nparent 80b3b740184a6a64ee0ff8767ab6f5b786dc0dd7\nparent 4e588dfd88352e82d785c2b9d369c5c98c028c12\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1623428862 +0000\ncommitter GitHub <noreply@github.com> 1623428862 +0000\n\nMerge #9216\n\n9216: fix: Don't allow lookup by self for unprefixed self access completions r=Veykril a=Veykril\n\nFixes #9211\r\nbors r+\n\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5f69420ee3317f9c0e3cb774ccc0cb0e64af0b9a", "html_url": "https://github.com/rust-lang/rust/commit/5f69420ee3317f9c0e3cb774ccc0cb0e64af0b9a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5f69420ee3317f9c0e3cb774ccc0cb0e64af0b9a/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "80b3b740184a6a64ee0ff8767ab6f5b786dc0dd7", "url": "https://api.github.com/repos/rust-lang/rust/commits/80b3b740184a6a64ee0ff8767ab6f5b786dc0dd7", "html_url": "https://github.com/rust-lang/rust/commit/80b3b740184a6a64ee0ff8767ab6f5b786dc0dd7"}, {"sha": "4e588dfd88352e82d785c2b9d369c5c98c028c12", "url": "https://api.github.com/repos/rust-lang/rust/commits/4e588dfd88352e82d785c2b9d369c5c98c028c12", "html_url": "https://github.com/rust-lang/rust/commit/4e588dfd88352e82d785c2b9d369c5c98c028c12"}], "stats": {"total": 39, "additions": 21, "deletions": 18}, "files": [{"sha": "2eabc2a676aeaac44888e6fb33a4b2bf42315a4e", "filename": "crates/ide_completion/src/render.rs", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5f69420ee3317f9c0e3cb774ccc0cb0e64af0b9a/crates%2Fide_completion%2Fsrc%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f69420ee3317f9c0e3cb774ccc0cb0e64af0b9a/crates%2Fide_completion%2Fsrc%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Frender.rs?ref=5f69420ee3317f9c0e3cb774ccc0cb0e64af0b9a", "patch": "@@ -132,16 +132,17 @@ fn render_field_(\n         ctx.source_range(),\n         receiver.map_or_else(|| name.clone(), |receiver| format!(\"{}.{}\", receiver, name)),\n     );\n-    item.kind(SymbolKind::Field)\n-        .detail(ty.display(ctx.db()).to_string())\n-        .set_documentation(field.docs(ctx.db()))\n-        .set_deprecated(is_deprecated);\n \n     item.set_relevance(CompletionRelevance {\n         type_match: compute_type_match(ctx.completion, ty),\n         exact_name_match: compute_exact_name_match(ctx.completion, &name),\n         ..CompletionRelevance::default()\n     });\n+    item.kind(SymbolKind::Field)\n+        .detail(ty.display(ctx.db()).to_string())\n+        .set_documentation(field.docs(ctx.db()))\n+        .set_deprecated(is_deprecated)\n+        .lookup_by(name);\n \n     if let Some(_ref_match) = compute_ref_match(ctx.completion, ty) {\n         // FIXME\n@@ -164,7 +165,9 @@ fn render_tuple_field_(\n         receiver.map_or_else(|| field.to_string(), |receiver| format!(\"{}.{}\", receiver, field)),\n     );\n \n-    item.kind(SymbolKind::Field).detail(ty.display(ctx.db()).to_string());\n+    item.kind(SymbolKind::Field)\n+        .detail(ty.display(ctx.db()).to_string())\n+        .lookup_by(field.to_string());\n \n     item.build()\n }"}, {"sha": "1357b9f4adfe1db01bf09e3722b1181839206992", "filename": "crates/ide_completion/src/render/function.rs", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/5f69420ee3317f9c0e3cb774ccc0cb0e64af0b9a/crates%2Fide_completion%2Fsrc%2Frender%2Ffunction.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f69420ee3317f9c0e3cb774ccc0cb0e64af0b9a/crates%2Fide_completion%2Fsrc%2Frender%2Ffunction.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Frender%2Ffunction.rs?ref=5f69420ee3317f9c0e3cb774ccc0cb0e64af0b9a", "patch": "@@ -58,29 +58,29 @@ impl<'a> FunctionRender<'a> {\n         Some(FunctionRender { ctx, name, receiver, func: fn_, ast_node, is_method })\n     }\n \n-    fn render(mut self, import_to_add: Option<ImportEdit>) -> CompletionItem {\n+    fn render(self, import_to_add: Option<ImportEdit>) -> CompletionItem {\n         let params = self.params();\n-        if let Some(receiver) = &self.receiver {\n-            self.name = format!(\"{}.{}\", receiver, &self.name)\n-        }\n-        let mut item = CompletionItem::new(\n-            CompletionKind::Reference,\n-            self.ctx.source_range(),\n-            self.name.clone(),\n-        );\n+        let call = if let Some(receiver) = &self.receiver {\n+            format!(\"{}.{}\", receiver, &self.name)\n+        } else {\n+            self.name.clone()\n+        };\n+        let mut item =\n+            CompletionItem::new(CompletionKind::Reference, self.ctx.source_range(), call.clone());\n         item.kind(self.kind())\n             .set_documentation(self.ctx.docs(self.func))\n             .set_deprecated(\n                 self.ctx.is_deprecated(self.func) || self.ctx.is_deprecated_assoc_item(self.func),\n             )\n             .detail(self.detail())\n-            .add_call_parens(self.ctx.completion, self.name.clone(), params)\n-            .add_import(import_to_add);\n+            .add_call_parens(self.ctx.completion, call.clone(), params)\n+            .add_import(import_to_add)\n+            .lookup_by(self.name);\n \n         let ret_type = self.func.ret_type(self.ctx.db());\n         item.set_relevance(CompletionRelevance {\n             type_match: compute_type_match(self.ctx.completion, &ret_type),\n-            exact_name_match: compute_exact_name_match(self.ctx.completion, &self.name),\n+            exact_name_match: compute_exact_name_match(self.ctx.completion, &call),\n             ..CompletionRelevance::default()\n         });\n \n@@ -263,7 +263,7 @@ fn bar(s: &S) {\n         );\n \n         check_edit(\n-            \"self.foo\",\n+            \"foo\",\n             r#\"\n struct S {}\n impl S {"}]}