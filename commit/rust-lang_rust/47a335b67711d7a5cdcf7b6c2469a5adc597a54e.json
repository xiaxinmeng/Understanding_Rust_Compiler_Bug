{"sha": "47a335b67711d7a5cdcf7b6c2469a5adc597a54e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ3YTMzNWI2NzcxMWQ3YTVjZGNmN2I2YzI0NjlhNWFkYzU5N2E1NGU=", "commit": {"author": {"name": "Jonathan Turner", "email": "jonathandturner@users.noreply.github.com", "date": "2016-09-29T03:21:52Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-09-29T03:21:52Z"}, "message": "Rollup merge of #36803 - brson:node, r=alexcrichton\n\nMove nodejs detection into bootstrap\n\nThis avoids issues with mingw path conversions.\n\nr? @alexcrichton", "tree": {"sha": "eb1d62105bea93d4db0cd9de16e19009682c19ab", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eb1d62105bea93d4db0cd9de16e19009682c19ab"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/47a335b67711d7a5cdcf7b6c2469a5adc597a54e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/47a335b67711d7a5cdcf7b6c2469a5adc597a54e", "html_url": "https://github.com/rust-lang/rust/commit/47a335b67711d7a5cdcf7b6c2469a5adc597a54e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/47a335b67711d7a5cdcf7b6c2469a5adc597a54e/comments", "author": {"login": "jonathandturner", "id": 111457284, "node_id": "O_kgDOBqS0BA", "avatar_url": "https://avatars.githubusercontent.com/u/111457284?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonathandturner", "html_url": "https://github.com/jonathandturner", "followers_url": "https://api.github.com/users/jonathandturner/followers", "following_url": "https://api.github.com/users/jonathandturner/following{/other_user}", "gists_url": "https://api.github.com/users/jonathandturner/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonathandturner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonathandturner/subscriptions", "organizations_url": "https://api.github.com/users/jonathandturner/orgs", "repos_url": "https://api.github.com/users/jonathandturner/repos", "events_url": "https://api.github.com/users/jonathandturner/events{/privacy}", "received_events_url": "https://api.github.com/users/jonathandturner/received_events", "type": "Organization", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9143c3c9c0beca5185abd943203eb7c5ebcf8e49", "url": "https://api.github.com/repos/rust-lang/rust/commits/9143c3c9c0beca5185abd943203eb7c5ebcf8e49", "html_url": "https://github.com/rust-lang/rust/commit/9143c3c9c0beca5185abd943203eb7c5ebcf8e49"}, {"sha": "27588dd7a193ab03b1c233af2eae3e27e22addf5", "url": "https://api.github.com/repos/rust-lang/rust/commits/27588dd7a193ab03b1c233af2eae3e27e22addf5", "html_url": "https://github.com/rust-lang/rust/commit/27588dd7a193ab03b1c233af2eae3e27e22addf5"}], "stats": {"total": 34, "additions": 19, "deletions": 15}, "files": [{"sha": "59a3c1c828d4edfddc9b1fdd736d281bcf4b11f0", "filename": "configure", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/47a335b67711d7a5cdcf7b6c2469a5adc597a54e/configure", "raw_url": "https://github.com/rust-lang/rust/raw/47a335b67711d7a5cdcf7b6c2469a5adc597a54e/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=47a335b67711d7a5cdcf7b6c2469a5adc597a54e", "patch": "@@ -645,7 +645,6 @@ valopt datadir \"${CFG_PREFIX}/share\" \"install data\"\n valopt infodir \"${CFG_PREFIX}/share/info\" \"install additional info\"\n valopt llvm-root \"\" \"set LLVM root\"\n valopt python \"\" \"set path to python\"\n-valopt nodejs \"\" \"set path to nodejs\"\n valopt jemalloc-root \"\" \"set directory where libjemalloc_pic.a is located\"\n valopt build \"${DEFAULT_BUILD}\" \"GNUs ./configure syntax LLVM build triple\"\n valopt android-cross-path \"\" \"Android NDK standalone path (deprecated)\"\n@@ -762,9 +761,6 @@ if [ $(echo $python_version | grep -c '^Python 2\\.7') -ne 1 ]; then\n     err \"Found $python_version, but Python 2.7 is required\"\n fi\n \n-# Checking for node, but not required\n-probe CFG_NODEJS nodejs node\n-\n # If we have no git directory then we are probably a tarball distribution\n # and shouldn't attempt to load submodules\n if [ ! -e ${CFG_SRC_DIR}.git ]"}, {"sha": "a8434c3efb3589d256639129fe0d605a2796fab9", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/47a335b67711d7a5cdcf7b6c2469a5adc597a54e/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47a335b67711d7a5cdcf7b6c2469a5adc597a54e/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=47a335b67711d7a5cdcf7b6c2469a5adc597a54e", "patch": "@@ -396,9 +396,6 @@ impl Config {\n                     self.rustc = Some(PathBuf::from(value).join(\"bin/rustc\"));\n                     self.cargo = Some(PathBuf::from(value).join(\"bin/cargo\"));\n                 }\n-                \"CFG_NODEJS\" if value.len() > 0 => {\n-                    self.nodejs = Some(PathBuf::from(value));\n-                }\n                 _ => {}\n             }\n         }"}, {"sha": "962d0666f69f192f8fbb8a37a54fb7ee40ccad92", "filename": "src/bootstrap/sanity.rs", "status": "modified", "additions": 19, "deletions": 8, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/47a335b67711d7a5cdcf7b6c2469a5adc597a54e/src%2Fbootstrap%2Fsanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47a335b67711d7a5cdcf7b6c2469a5adc597a54e/src%2Fbootstrap%2Fsanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fsanity.rs?ref=47a335b67711d7a5cdcf7b6c2469a5adc597a54e", "patch": "@@ -40,17 +40,23 @@ pub fn check(build: &mut Build) {\n             panic!(\"PATH contains invalid character '\\\"'\");\n         }\n     }\n-    let mut need_cmd = |cmd: &OsStr| {\n-        if !checked.insert(cmd.to_owned()) {\n-            return\n-        }\n+    let have_cmd = |cmd: &OsStr| {\n         for path in env::split_paths(&path).map(|p| p.join(cmd)) {\n             if fs::metadata(&path).is_ok() ||\n                fs::metadata(path.with_extension(\"exe\")).is_ok() {\n-                return\n+                return Some(path);\n             }\n         }\n-        panic!(\"\\n\\ncouldn't find required command: {:?}\\n\\n\", cmd);\n+        return None;\n+    };\n+\n+    let mut need_cmd = |cmd: &OsStr| {\n+        if !checked.insert(cmd.to_owned()) {\n+            return\n+        }\n+        if have_cmd(cmd).is_none() {\n+            panic!(\"\\n\\ncouldn't find required command: {:?}\\n\\n\", cmd);\n+        }\n     };\n \n     // If we've got a git directory we're gona need git to update\n@@ -75,8 +81,13 @@ pub fn check(build: &mut Build) {\n \n     need_cmd(\"python\".as_ref());\n \n-    // If a manual nodejs was added to the config,\n-    // of if a nodejs install is detected through config, use it.\n+    // Look for the nodejs command, needed for emscripten testing\n+    if let Some(node) = have_cmd(\"node\".as_ref()) {\n+        build.config.nodejs = Some(node);\n+    } else if let Some(node) = have_cmd(\"nodejs\".as_ref()) {\n+        build.config.nodejs = Some(node);\n+    }\n+\n     if let Some(ref s) = build.config.nodejs {\n         need_cmd(s.as_ref());\n     }"}]}