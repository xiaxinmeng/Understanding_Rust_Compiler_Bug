{"sha": "5d829841cdab630d7953defd12e024e46ecc7c4f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVkODI5ODQxY2RhYjYzMGQ3OTUzZGVmZDEyZTAyNGU0NmVjYzdjNGY=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2019-06-28T12:14:19Z"}, "committer": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2019-06-28T12:14:19Z"}, "message": "Merge #1440\n\n1440: fixed #1384 r=matklad a=zbelial\n\nThis PR fixed #1384 .\n\nCo-authored-by: zjy <zhaojiyang1@xiaomi.com>", "tree": {"sha": "f5c8bf7d4f4958ea6a489b187df0ea4f1da41464", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f5c8bf7d4f4958ea6a489b187df0ea4f1da41464"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5d829841cdab630d7953defd12e024e46ecc7c4f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5d829841cdab630d7953defd12e024e46ecc7c4f", "html_url": "https://github.com/rust-lang/rust/commit/5d829841cdab630d7953defd12e024e46ecc7c4f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5d829841cdab630d7953defd12e024e46ecc7c4f/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "e8dc92ca734e34b25291015008d5c6dfd933fa7a", "url": "https://api.github.com/repos/rust-lang/rust/commits/e8dc92ca734e34b25291015008d5c6dfd933fa7a", "html_url": "https://github.com/rust-lang/rust/commit/e8dc92ca734e34b25291015008d5c6dfd933fa7a"}, {"sha": "de930237ffb5bec9489443477a5b4ff964f56b0e", "url": "https://api.github.com/repos/rust-lang/rust/commits/de930237ffb5bec9489443477a5b4ff964f56b0e", "html_url": "https://github.com/rust-lang/rust/commit/de930237ffb5bec9489443477a5b4ff964f56b0e"}], "stats": {"total": 97, "additions": 90, "deletions": 7}, "files": [{"sha": "298030cb9967ac3463a8a6c8f8c1ea8d798c69b9", "filename": "crates/ra_parser/src/grammar/expressions.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/5d829841cdab630d7953defd12e024e46ecc7c4f/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5d829841cdab630d7953defd12e024e46ecc7c4f/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions.rs?ref=5d829841cdab630d7953defd12e024e46ecc7c4f", "patch": "@@ -181,6 +181,17 @@ pub(crate) fn expr_block_contents(p: &mut Parser) {\n         // fn foo(){\n         //     ;;;some_expr();;;;{;;;};;;;Ok(())\n         // }\n+\n+        // test nocontentexpr_after_item\n+        // fn simple_function() {\n+        //     enum LocalEnum {\n+        //         One,\n+        //         Two,\n+        //     };\n+        //     fn f() {};\n+        //     struct S {};\n+        // }\n+\n         if p.current() == T![;] {\n             p.bump();\n             continue;"}, {"sha": "543af7c4bb1554d1f0cccbf17c0ffe450b530f48", "filename": "crates/ra_parser/src/grammar/items.rs", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/5d829841cdab630d7953defd12e024e46ecc7c4f/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5d829841cdab630d7953defd12e024e46ecc7c4f/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fitems.rs?ref=5d829841cdab630d7953defd12e024e46ecc7c4f", "patch": "@@ -38,7 +38,15 @@ pub(super) fn item_or_macro(p: &mut Parser, stop_on_r_curly: bool, flavor: ItemF\n     let m = p.start();\n     attributes::outer_attributes(p);\n     let m = match maybe_item(p, m, flavor) {\n-        Ok(()) => return,\n+        Ok(()) => {\n+            if p.at(T![;]) {\n+                p.err_and_bump(\n+                    \"expected item, found `;`\\n\\\n+                     consider removing this semicolon\",\n+                );\n+            }\n+            return;\n+        }\n         Err(m) => m,\n     };\n     if paths::is_path_start(p) {\n@@ -263,12 +271,6 @@ fn items_without_modifiers(p: &mut Parser, m: Marker) -> Result<(), Marker> {\n         }\n         _ => return Err(m),\n     };\n-    if p.at(T![;]) {\n-        p.err_and_bump(\n-            \"expected item, found `;`\\n\\\n-             consider removing this semicolon\",\n-        );\n-    }\n     Ok(())\n }\n "}, {"sha": "eadc7fffb136230b4a8e8a7bee0c5ba18674cae4", "filename": "crates/ra_syntax/tests/data/parser/inline/ok/0134_nocontentexpr_after_item.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5d829841cdab630d7953defd12e024e46ecc7c4f/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0134_nocontentexpr_after_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5d829841cdab630d7953defd12e024e46ecc7c4f/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0134_nocontentexpr_after_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0134_nocontentexpr_after_item.rs?ref=5d829841cdab630d7953defd12e024e46ecc7c4f", "patch": "@@ -0,0 +1,8 @@\n+fn simple_function() {\n+    enum LocalEnum {\n+        One,\n+        Two,\n+    };\n+    fn f() {};\n+    struct S {};\n+}"}, {"sha": "50d3b5defec1843d8fd9e995e54a0b42ce2eacf2", "filename": "crates/ra_syntax/tests/data/parser/inline/ok/0134_nocontentexpr_after_item.txt", "status": "added", "additions": 62, "deletions": 0, "changes": 62, "blob_url": "https://github.com/rust-lang/rust/blob/5d829841cdab630d7953defd12e024e46ecc7c4f/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0134_nocontentexpr_after_item.txt", "raw_url": "https://github.com/rust-lang/rust/raw/5d829841cdab630d7953defd12e024e46ecc7c4f/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0134_nocontentexpr_after_item.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0134_nocontentexpr_after_item.txt?ref=5d829841cdab630d7953defd12e024e46ecc7c4f", "patch": "@@ -0,0 +1,62 @@\n+SOURCE_FILE@[0; 111)\n+  FN_DEF@[0; 110)\n+    FN_KW@[0; 2) \"fn\"\n+    WHITESPACE@[2; 3) \" \"\n+    NAME@[3; 18)\n+      IDENT@[3; 18) \"simple_function\"\n+    PARAM_LIST@[18; 20)\n+      L_PAREN@[18; 19) \"(\"\n+      R_PAREN@[19; 20) \")\"\n+    WHITESPACE@[20; 21) \" \"\n+    BLOCK@[21; 110)\n+      L_CURLY@[21; 22) \"{\"\n+      WHITESPACE@[22; 27) \"\\n    \"\n+      ENUM_DEF@[27; 75)\n+        ENUM_KW@[27; 31) \"enum\"\n+        WHITESPACE@[31; 32) \" \"\n+        NAME@[32; 41)\n+          IDENT@[32; 41) \"LocalEnum\"\n+        WHITESPACE@[41; 42) \" \"\n+        ENUM_VARIANT_LIST@[42; 75)\n+          L_CURLY@[42; 43) \"{\"\n+          WHITESPACE@[43; 52) \"\\n        \"\n+          ENUM_VARIANT@[52; 55)\n+            NAME@[52; 55)\n+              IDENT@[52; 55) \"One\"\n+          COMMA@[55; 56) \",\"\n+          WHITESPACE@[56; 65) \"\\n        \"\n+          ENUM_VARIANT@[65; 68)\n+            NAME@[65; 68)\n+              IDENT@[65; 68) \"Two\"\n+          COMMA@[68; 69) \",\"\n+          WHITESPACE@[69; 74) \"\\n    \"\n+          R_CURLY@[74; 75) \"}\"\n+      SEMI@[75; 76) \";\"\n+      WHITESPACE@[76; 81) \"\\n    \"\n+      FN_DEF@[81; 90)\n+        FN_KW@[81; 83) \"fn\"\n+        WHITESPACE@[83; 84) \" \"\n+        NAME@[84; 85)\n+          IDENT@[84; 85) \"f\"\n+        PARAM_LIST@[85; 87)\n+          L_PAREN@[85; 86) \"(\"\n+          R_PAREN@[86; 87) \")\"\n+        WHITESPACE@[87; 88) \" \"\n+        BLOCK@[88; 90)\n+          L_CURLY@[88; 89) \"{\"\n+          R_CURLY@[89; 90) \"}\"\n+      SEMI@[90; 91) \";\"\n+      WHITESPACE@[91; 96) \"\\n    \"\n+      STRUCT_DEF@[96; 107)\n+        STRUCT_KW@[96; 102) \"struct\"\n+        WHITESPACE@[102; 103) \" \"\n+        NAME@[103; 104)\n+          IDENT@[103; 104) \"S\"\n+        WHITESPACE@[104; 105) \" \"\n+        NAMED_FIELD_DEF_LIST@[105; 107)\n+          L_CURLY@[105; 106) \"{\"\n+          R_CURLY@[106; 107) \"}\"\n+      SEMI@[107; 108) \";\"\n+      WHITESPACE@[108; 109) \"\\n\"\n+      R_CURLY@[109; 110) \"}\"\n+  WHITESPACE@[110; 111) \"\\n\""}]}