{"sha": "0f7961d5570f17d6c2098ab11d2a3bcbbfb84ff6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBmNzk2MWQ1NTcwZjE3ZDZjMjA5OGFiMTFkMmEzYmNiYmZiODRmZjY=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-06-19T21:40:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-06-19T21:40:59Z"}, "message": "Merge #4952\n\n4952: Shift bound variables correctly when using assoc type shorthand r=matklad a=flodiebold\n\nFixes #4885.\r\nFixes #4800.\n\nCo-authored-by: Florian Diebold <florian.diebold@freiheit.com>", "tree": {"sha": "1c0ff6de334a33b18adf8fb4f4be94083735e7dd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1c0ff6de334a33b18adf8fb4f4be94083735e7dd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0f7961d5570f17d6c2098ab11d2a3bcbbfb84ff6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJe7TDrCRBK7hj4Ov3rIwAAdHIIAIFNGu0iTraiC6t3lh66oJWF\nXmN8JWH7Ifw8KsJbKizh18Udc8RZokDnfDVM3lWdMVGNQn488kRZyrWcdmasd8l1\nwXKNsq9+hh2bZmnFOqmr3ipG8lRnyDzfK9yK6ow7OkA3wgTSGcNElAKGzpof9kWK\nEIY2glPpb6ij9ipqJ/7WlYyE1ksJFXsrAYHzxGmbgSh5T/CI1OMbecsEqw6Xo4mV\nydUgkWNa8QqkM1nAKDOQ05g6B9UybjuM0T9x1mcBLRjnSWUBCU9gmxD24k0DDX/8\nDH9jL81o0sjonStaCzo3cSpeLJVyc7cqYZ/g6bx2VUbKDwbWgwiXjgnipswbPp0=\n=8Pvj\n-----END PGP SIGNATURE-----\n", "payload": "tree 1c0ff6de334a33b18adf8fb4f4be94083735e7dd\nparent af0dcc54811d48151f38e23598ed56d9c28cd3dc\nparent 170cdf90769d7a2779ffd0a8cb552e5b2f63d11c\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1592602859 +0000\ncommitter GitHub <noreply@github.com> 1592602859 +0000\n\nMerge #4952\n\n4952: Shift bound variables correctly when using assoc type shorthand r=matklad a=flodiebold\n\nFixes #4885.\r\nFixes #4800.\n\nCo-authored-by: Florian Diebold <florian.diebold@freiheit.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0f7961d5570f17d6c2098ab11d2a3bcbbfb84ff6", "html_url": "https://github.com/rust-lang/rust/commit/0f7961d5570f17d6c2098ab11d2a3bcbbfb84ff6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0f7961d5570f17d6c2098ab11d2a3bcbbfb84ff6/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "af0dcc54811d48151f38e23598ed56d9c28cd3dc", "url": "https://api.github.com/repos/rust-lang/rust/commits/af0dcc54811d48151f38e23598ed56d9c28cd3dc", "html_url": "https://github.com/rust-lang/rust/commit/af0dcc54811d48151f38e23598ed56d9c28cd3dc"}, {"sha": "170cdf90769d7a2779ffd0a8cb552e5b2f63d11c", "url": "https://api.github.com/repos/rust-lang/rust/commits/170cdf90769d7a2779ffd0a8cb552e5b2f63d11c", "html_url": "https://github.com/rust-lang/rust/commit/170cdf90769d7a2779ffd0a8cb552e5b2f63d11c"}], "stats": {"total": 94, "additions": 94, "deletions": 0}, "files": [{"sha": "d5154f436ee7e107cf483c8d3c8ef3ada5e35e0c", "filename": "crates/ra_hir_ty/src/lower.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/0f7961d5570f17d6c2098ab11d2a3bcbbfb84ff6/crates%2Fra_hir_ty%2Fsrc%2Flower.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0f7961d5570f17d6c2098ab11d2a3bcbbfb84ff6/crates%2Fra_hir_ty%2Fsrc%2Flower.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Flower.rs?ref=0f7961d5570f17d6c2098ab11d2a3bcbbfb84ff6", "patch": "@@ -467,6 +467,9 @@ impl Ty {\n                             }\n                             TypeParamLoweringMode::Variable => t.substs.clone(),\n                         };\n+                        // We need to shift in the bound vars, since\n+                        // associated_type_shorthand_candidates does not do that\n+                        let substs = substs.shift_bound_vars(ctx.in_binders);\n                         // FIXME handle type parameters on the segment\n                         return Some(Ty::Projection(ProjectionTy {\n                             associated_ty,"}, {"sha": "4da2e972bd2ed3ee89fe0d52c03250041b4adc3e", "filename": "crates/ra_hir_ty/src/tests/regression.rs", "status": "modified", "additions": 91, "deletions": 0, "changes": 91, "blob_url": "https://github.com/rust-lang/rust/blob/0f7961d5570f17d6c2098ab11d2a3bcbbfb84ff6/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fregression.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0f7961d5570f17d6c2098ab11d2a3bcbbfb84ff6/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fregression.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fregression.rs?ref=0f7961d5570f17d6c2098ab11d2a3bcbbfb84ff6", "patch": "@@ -693,3 +693,94 @@ fn check<T: PrimInt>(i: T) {\n     \"###\n     );\n }\n+\n+#[test]\n+fn issue_4885() {\n+    assert_snapshot!(\n+        infer(r#\"\n+#[lang = \"coerce_unsized\"]\n+pub trait CoerceUnsized<T> {}\n+\n+trait Future {\n+    type Output;\n+}\n+trait Foo<R> {\n+    type Bar;\n+}\n+fn foo<R, K>(key: &K) -> impl Future<Output = K::Bar>\n+where\n+    K: Foo<R>,\n+{\n+    bar(key)\n+}\n+fn bar<R, K>(key: &K) -> impl Future<Output = K::Bar>\n+where\n+    K: Foo<R>,\n+{\n+}\n+\"#),\n+        @r###\"\n+    137..140 'key': &K\n+    199..215 '{     ...key) }': impl Future<Output = <K as Foo<R>>::Bar>\n+    205..208 'bar': fn bar<R, K>(&K) -> impl Future<Output = <K as Foo<R>>::Bar>\n+    205..213 'bar(key)': impl Future<Output = <K as Foo<R>>::Bar>\n+    209..212 'key': &K\n+    229..232 'key': &K\n+    291..294 '{ }': ()\n+    \"###\n+    );\n+}\n+\n+#[test]\n+fn issue_4800() {\n+    assert_snapshot!(\n+        infer(r#\"\n+trait Debug {}\n+\n+struct Foo<T>;\n+\n+type E1<T> = (T, T, T);\n+type E2<T> = E1<E1<E1<(T, T, T)>>>;\n+\n+impl Debug for Foo<E2<()>> {}\n+\n+struct Request;\n+\n+pub trait Future {\n+    type Output;\n+}\n+\n+pub struct PeerSet<D>;\n+\n+impl<D> Service<Request> for PeerSet<D>\n+where\n+    D: Discover,\n+    D::Key: Debug,\n+{\n+    type Error = ();\n+    type Future = dyn Future<Output = Self::Error>;\n+\n+    fn call(&mut self) -> Self::Future {\n+        loop {}\n+    }\n+}\n+\n+pub trait Discover {\n+    type Key;\n+}\n+\n+pub trait Service<Request> {\n+    type Error;\n+    type Future: Future<Output = Self::Error>;\n+    fn call(&mut self) -> Self::Future;\n+}\n+\"#),\n+        @r###\"\n+    380..384 'self': &mut PeerSet<D>\n+    402..425 '{     ...     }': dyn Future<Output = ()>\n+    412..419 'loop {}': !\n+    417..419 '{}': ()\n+    576..580 'self': &mut Self\n+    \"###\n+    );\n+}"}]}