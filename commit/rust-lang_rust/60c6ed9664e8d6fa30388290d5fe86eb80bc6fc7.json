{"sha": "60c6ed9664e8d6fa30388290d5fe86eb80bc6fc7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYwYzZlZDk2NjRlOGQ2ZmEzMDM4ODI5MGQ1ZmU4NmViODBiYzZmYzc=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2019-04-20T10:31:38Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2019-04-20T10:36:04Z"}, "message": "Fix fn front matter parsing ICE from invalid code.\n\nThis commit fixes an \"unreachable code\" ICE that results from parsing\ninvalid code where the compiler is expecting the next trait item\ndeclaration in the middle of the previous trait item due to extra\nclosing braces.", "tree": {"sha": "54080badf103398e605f4f6dc8a7e767c2890dbe", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/54080badf103398e605f4f6dc8a7e767c2890dbe"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/60c6ed9664e8d6fa30388290d5fe86eb80bc6fc7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEWwgxPGhT5b/6kagXAXYLT59T8VQFAly69hQACgkQAXYLT59T\n8VRf5xAAruRlFdwCaM8clXZk04TjI6FX+/3CpbNjXq8iRxjaohRtUD/jilEWUyHE\n0oFSACwSVmaJixcJa0U0hd0jgrScv5xwAWIaM+zHE3QYlkERRNA6CIG5K95cFYxo\nJbK/BGJMzCFX/XK3GZ1dAHr/02EX8Kine91oz7/SwZBjJJ4aFgyTc37KTh413KQ3\n0Q8wPT8CqaLdlCyJ80Lo08JDKJe/o0g9l8kSUihzIUqy3COWIhgi9EMCgYCsGm3g\nDCb6Lquy31I0/yJPNX/YSdKON+QpOFBC1Ad1i7p9b/vqkDaw/SFiTe69sHI164MK\na7gaGwRy8PBg8sEZBKSba6b5YDFWeijm9cvb+lOk4CXL7SrIEkKBWzYMnDfiZkzZ\nONV70n8VHLo9WvvOLEkWE74zygx8/g0hy4iqj4Tc+f3STgkQXGcr7i3gfm509wJJ\nSg2NoRW+cRyNVEm9JC9NkzGEy1VhsDxo52T0qCQYDfjUPmNH1LQ+1X6pTS259WDo\n5QQFZ1Z9XuMty5prxHxXXt6bbmrShswwCx6blJXQk0pyA25W0OxBb3Tbhqknwdc6\nOAGNoQBFVhCl4Wz3Oqn0eO5G4xM5XsoSWEgQME/UXd7hJg25Lcr3rcVB/2DwEyB/\nyQCJn6PW5ADLSXJck7W0BNmhWx0KwE7yGi9JD0vR1kYAzrFdn5Q=\n=QKvV\n-----END PGP SIGNATURE-----", "payload": "tree 54080badf103398e605f4f6dc8a7e767c2890dbe\nparent d6f513ec7d1e83c8689f94fb48686dd11f1d1c80\nauthor David Wood <david@davidtw.co> 1555756298 +0100\ncommitter David Wood <david@davidtw.co> 1555756564 +0100\n\nFix fn front matter parsing ICE from invalid code.\n\nThis commit fixes an \"unreachable code\" ICE that results from parsing\ninvalid code where the compiler is expecting the next trait item\ndeclaration in the middle of the previous trait item due to extra\nclosing braces.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/60c6ed9664e8d6fa30388290d5fe86eb80bc6fc7", "html_url": "https://github.com/rust-lang/rust/commit/60c6ed9664e8d6fa30388290d5fe86eb80bc6fc7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/60c6ed9664e8d6fa30388290d5fe86eb80bc6fc7/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d6f513ec7d1e83c8689f94fb48686dd11f1d1c80", "url": "https://api.github.com/repos/rust-lang/rust/commits/d6f513ec7d1e83c8689f94fb48686dd11f1d1c80", "html_url": "https://github.com/rust-lang/rust/commit/d6f513ec7d1e83c8689f94fb48686dd11f1d1c80"}], "stats": {"total": 56, "additions": 55, "deletions": 1}, "files": [{"sha": "8e6db8a541a6d4329e4964a37df5f86571444ab6", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/60c6ed9664e8d6fa30388290d5fe86eb80bc6fc7/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/60c6ed9664e8d6fa30388290d5fe86eb80bc6fc7/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=60c6ed9664e8d6fa30388290d5fe86eb80bc6fc7", "patch": "@@ -6575,7 +6575,12 @@ impl<'a> Parser<'a> {\n             };\n             (respan(self.prev_span, Constness::NotConst), unsafety, abi)\n         };\n-        self.expect_keyword(keywords::Fn)?;\n+        if !self.eat_keyword(keywords::Fn) {\n+            // It is possible for `expect_one_of` to recover given the contents of\n+            // `self.expected_tokens`, therefore, do not use `self.unexpected()` which doesn't\n+            // account for this.\n+            if !self.expect_one_of(&[], &[])? { unreachable!() }\n+        }\n         Ok((constness, unsafety, asyncness, abi))\n     }\n "}, {"sha": "5788716a52629bba22af262129cb35db60dc6360", "filename": "src/test/ui/issue-60075.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/60c6ed9664e8d6fa30388290d5fe86eb80bc6fc7/src%2Ftest%2Fui%2Fissue-60075.rs", "raw_url": "https://github.com/rust-lang/rust/raw/60c6ed9664e8d6fa30388290d5fe86eb80bc6fc7/src%2Ftest%2Fui%2Fissue-60075.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-60075.rs?ref=60c6ed9664e8d6fa30388290d5fe86eb80bc6fc7", "patch": "@@ -0,0 +1,12 @@\n+fn main() {}\n+\n+trait T {\n+    fn qux() -> Option<usize> {\n+        let _ = if true {\n+        });\n+//~^ ERROR expected one of `async`, `const`, `extern`, `fn`, `type`, `unsafe`, or `}`, found `;`\n+//~^^ ERROR expected one of `.`, `;`, `?`, `else`, or an operator, found `}`\n+//~^^^ ERROR 6:11: 6:12: expected identifier, found `;`\n+//~^^^^ ERROR missing `fn`, `type`, or `const` for trait-item declaration\n+        Some(4)\n+    }"}, {"sha": "244aef2d1f0f5aad7d4706be7a4167cb0e943d9c", "filename": "src/test/ui/issue-60075.stderr", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/60c6ed9664e8d6fa30388290d5fe86eb80bc6fc7/src%2Ftest%2Fui%2Fissue-60075.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/60c6ed9664e8d6fa30388290d5fe86eb80bc6fc7/src%2Ftest%2Fui%2Fissue-60075.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-60075.stderr?ref=60c6ed9664e8d6fa30388290d5fe86eb80bc6fc7", "patch": "@@ -0,0 +1,37 @@\n+error: expected one of `.`, `;`, `?`, `else`, or an operator, found `}`\n+  --> $DIR/issue-60075.rs:6:10\n+   |\n+LL |         });\n+   |          ^ expected one of `.`, `;`, `?`, `else`, or an operator here\n+\n+error: expected one of `async`, `const`, `extern`, `fn`, `type`, `unsafe`, or `}`, found `;`\n+  --> $DIR/issue-60075.rs:6:11\n+   |\n+LL |     fn qux() -> Option<usize> {\n+   |                               - unclosed delimiter\n+LL |         let _ = if true {\n+LL |         });\n+   |           ^\n+   |           |\n+   |           help: `}` may belong here\n+\n+error: expected identifier, found `;`\n+  --> $DIR/issue-60075.rs:6:11\n+   |\n+LL |         });\n+   |           ^ expected identifier\n+\n+error: missing `fn`, `type`, or `const` for trait-item declaration\n+  --> $DIR/issue-60075.rs:6:12\n+   |\n+LL |           });\n+   |  ____________^\n+LL | |\n+LL | |\n+LL | |\n+LL | |\n+LL | |         Some(4)\n+   | |________^ missing `fn`, `type`, or `const`\n+\n+error: aborting due to 4 previous errors\n+"}]}