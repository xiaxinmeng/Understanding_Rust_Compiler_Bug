{"sha": "312e67633313836ef89bc1f6b299f43e2fa7c155", "node_id": "C_kwDOAAsO6NoAKDMxMmU2NzYzMzMxMzgzNmVmODliYzFmNmIyOTlmNDNlMmZhN2MxNTU", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-06-10T13:24:44Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-06-10T13:24:44Z"}, "message": "Rollup merge of #112413 - jieyouxu:fix-hidden-glob-reexports-span-order, r=petrochenkov\n\nAdjust span labels for `HIDDEN_GLOB_REEXPORTS`\n\nAddresses https://github.com/rust-lang/rust/pull/111378#issuecomment-1581226063.\n\n### Before This PR\n\nThe possibility that the private item comes before the glob re-export was not account for, causing the span label messages to say \"but private item here shadows it\" before \"the name `Foo` in the type namespace is supposed to be publicly re-exported here\".\n\n### After This PR\n\n```rust\nwarning: private item shadows public glob re-export\n  --> $DIR/hidden_glob_reexports.rs:9:5\n   |\nLL |     struct Foo;\n   |     ^^^^^^^^^^^ the private item here shadows the name `Foo` in the type namespace\n...\nLL |     pub use self::inner::*;\n   |             -------------- but it is supposed to be publicly re-exported here\n   |\n   = note: `#[warn(hidden_glob_reexports)]` on by default\n\nwarning: private item shadows public glob re-export\n  --> $DIR/hidden_glob_reexports.rs:27:9\n   |\nLL |     pub use self::inner::*;\n   |             -------------- the name `Foo` in the type namespace is supposed to be publicly re-exported here\nLL |\nLL |     use self::other::Foo;\n   |         ^^^^^^^^^^^^^^^^ but the private item here shadows it\n```", "tree": {"sha": "a351bfef54051cd508970ec410bd7ab542f8d80a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a351bfef54051cd508970ec410bd7ab542f8d80a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/312e67633313836ef89bc1f6b299f43e2fa7c155", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkhHmcCRBK7hj4Ov3rIwAAwCYIAJCwqDsF31dLKvfIwq+13hwn\nWndyw3xd9IOMHcaY9HeGejcr1UpN//FKh6EmRGxA+IlsXWvR7QG0eQ3qMFQWtv5Z\n6Ff4KitxeEL6m0M6vo7nBE3yc7TzF55e9iUk0lubGrJX3JxkuUaqPtkXv/zImaCG\nkMM+lLOsk5vxpYEe0iH8X9u69KR1a2ETNrNgWfhWLwD5A+AiIX4jPdXghJp/oRLI\n11XCXNjsxIkbeXNLczjawh24h5vbF4rOEaL35s81uP9sNF5TMX4aFj1SSAkQ0R2v\nMZS5W5DMjDme78ollGVuEH+jLCQzHA2lWscjQLgjmxxAshb2X3uv5jxJPxFJ5h0=\n=/bjM\n-----END PGP SIGNATURE-----\n", "payload": "tree a351bfef54051cd508970ec410bd7ab542f8d80a\nparent 8744b1a5752ce0277ff1484e8e64b3810a0cdad6\nparent 80176a120e90bb9f8e7b9e8fedda9ac857f434f3\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1686403484 +0200\ncommitter GitHub <noreply@github.com> 1686403484 +0200\n\nRollup merge of #112413 - jieyouxu:fix-hidden-glob-reexports-span-order, r=petrochenkov\n\nAdjust span labels for `HIDDEN_GLOB_REEXPORTS`\n\nAddresses https://github.com/rust-lang/rust/pull/111378#issuecomment-1581226063.\n\n### Before This PR\n\nThe possibility that the private item comes before the glob re-export was not account for, causing the span label messages to say \"but private item here shadows it\" before \"the name `Foo` in the type namespace is supposed to be publicly re-exported here\".\n\n### After This PR\n\n```rust\nwarning: private item shadows public glob re-export\n  --> $DIR/hidden_glob_reexports.rs:9:5\n   |\nLL |     struct Foo;\n   |     ^^^^^^^^^^^ the private item here shadows the name `Foo` in the type namespace\n...\nLL |     pub use self::inner::*;\n   |             -------------- but it is supposed to be publicly re-exported here\n   |\n   = note: `#[warn(hidden_glob_reexports)]` on by default\n\nwarning: private item shadows public glob re-export\n  --> $DIR/hidden_glob_reexports.rs:27:9\n   |\nLL |     pub use self::inner::*;\n   |             -------------- the name `Foo` in the type namespace is supposed to be publicly re-exported here\nLL |\nLL |     use self::other::Foo;\n   |         ^^^^^^^^^^^^^^^^ but the private item here shadows it\n```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/312e67633313836ef89bc1f6b299f43e2fa7c155", "html_url": "https://github.com/rust-lang/rust/commit/312e67633313836ef89bc1f6b299f43e2fa7c155", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/312e67633313836ef89bc1f6b299f43e2fa7c155/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8744b1a5752ce0277ff1484e8e64b3810a0cdad6", "url": "https://api.github.com/repos/rust-lang/rust/commits/8744b1a5752ce0277ff1484e8e64b3810a0cdad6", "html_url": "https://github.com/rust-lang/rust/commit/8744b1a5752ce0277ff1484e8e64b3810a0cdad6"}, {"sha": "80176a120e90bb9f8e7b9e8fedda9ac857f434f3", "url": "https://api.github.com/repos/rust-lang/rust/commits/80176a120e90bb9f8e7b9e8fedda9ac857f434f3", "html_url": "https://github.com/rust-lang/rust/commit/80176a120e90bb9f8e7b9e8fedda9ac857f434f3"}], "stats": {"total": 53, "additions": 38, "deletions": 15}, "files": [{"sha": "13164b0b339a35b08a6f44524f30db0c6a54cb2e", "filename": "compiler/rustc_lint/src/context.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/312e67633313836ef89bc1f6b299f43e2fa7c155/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/312e67633313836ef89bc1f6b299f43e2fa7c155/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fcontext.rs?ref=312e67633313836ef89bc1f6b299f43e2fa7c155", "patch": "@@ -953,8 +953,8 @@ pub trait LintContext: Sized {\n                     db.span_label(duplicate_reexport_span, format!(\"but the name `{}` in the {} namespace is also re-exported here\", name, namespace));\n                 }\n                 BuiltinLintDiagnostics::HiddenGlobReexports { name, namespace, glob_reexport_span, private_item_span } => {\n-                    db.span_label(glob_reexport_span, format!(\"the name `{}` in the {} namespace is supposed to be publicly re-exported here\", name, namespace));\n-                    db.span_label(private_item_span, \"but the private item here shadows it\");\n+                    db.span_note(glob_reexport_span, format!(\"the name `{}` in the {} namespace is supposed to be publicly re-exported here\", name, namespace));\n+                    db.span_note(private_item_span, \"but the private item here shadows it\".to_owned());\n                 }\n             }\n             // Rewrap `db`, and pass control to the user."}, {"sha": "102b5656245268f786c2896ded96db576f6291ef", "filename": "tests/ui/resolve/hidden_glob_reexports.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/312e67633313836ef89bc1f6b299f43e2fa7c155/tests%2Fui%2Fresolve%2Fhidden_glob_reexports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/312e67633313836ef89bc1f6b299f43e2fa7c155/tests%2Fui%2Fresolve%2Fhidden_glob_reexports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fresolve%2Fhidden_glob_reexports.rs?ref=312e67633313836ef89bc1f6b299f43e2fa7c155", "patch": "@@ -6,10 +6,10 @@ pub mod upstream_a {\n         pub struct Bar {}\n     }\n \n-    pub use self::inner::*;\n-\n     struct Foo;\n     //~^ WARN private item shadows public glob re-export\n+\n+    pub use self::inner::*;\n }\n \n pub mod upstream_b {"}, {"sha": "11fa94d6fee987f8160edc4f615063d7eacfc6e5", "filename": "tests/ui/resolve/hidden_glob_reexports.stderr", "status": "modified", "additions": 34, "deletions": 11, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/312e67633313836ef89bc1f6b299f43e2fa7c155/tests%2Fui%2Fresolve%2Fhidden_glob_reexports.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/312e67633313836ef89bc1f6b299f43e2fa7c155/tests%2Fui%2Fresolve%2Fhidden_glob_reexports.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fresolve%2Fhidden_glob_reexports.stderr?ref=312e67633313836ef89bc1f6b299f43e2fa7c155", "patch": "@@ -1,31 +1,54 @@\n warning: private item shadows public glob re-export\n-  --> $DIR/hidden_glob_reexports.rs:11:5\n+  --> $DIR/hidden_glob_reexports.rs:9:5\n    |\n-LL |     pub use self::inner::*;\n-   |             -------------- the name `Foo` in the type namespace is supposed to be publicly re-exported here\n-LL |\n LL |     struct Foo;\n-   |     ^^^^^^^^^^^ but the private item here shadows it\n+   |     ^^^^^^^^^^^\n+   |\n+note: the name `Foo` in the type namespace is supposed to be publicly re-exported here\n+  --> $DIR/hidden_glob_reexports.rs:12:13\n+   |\n+LL |     pub use self::inner::*;\n+   |             ^^^^^^^^^^^^^^\n+note: but the private item here shadows it\n+  --> $DIR/hidden_glob_reexports.rs:9:5\n    |\n+LL |     struct Foo;\n+   |     ^^^^^^^^^^^\n    = note: `#[warn(hidden_glob_reexports)]` on by default\n \n warning: private item shadows public glob re-export\n   --> $DIR/hidden_glob_reexports.rs:27:9\n    |\n+LL |     use self::other::Foo;\n+   |         ^^^^^^^^^^^^^^^^\n+   |\n+note: the name `Foo` in the type namespace is supposed to be publicly re-exported here\n+  --> $DIR/hidden_glob_reexports.rs:25:13\n+   |\n LL |     pub use self::inner::*;\n-   |             -------------- the name `Foo` in the type namespace is supposed to be publicly re-exported here\n-LL |\n+   |             ^^^^^^^^^^^^^^\n+note: but the private item here shadows it\n+  --> $DIR/hidden_glob_reexports.rs:27:9\n+   |\n LL |     use self::other::Foo;\n-   |         ^^^^^^^^^^^^^^^^ but the private item here shadows it\n+   |         ^^^^^^^^^^^^^^^^\n \n warning: private item shadows public glob re-export\n   --> $DIR/hidden_glob_reexports.rs:40:9\n    |\n+LL |     use std::primitive::u8;\n+   |         ^^^^^^^^^^^^^^^^^^\n+   |\n+note: the name `u8` in the type namespace is supposed to be publicly re-exported here\n+  --> $DIR/hidden_glob_reexports.rs:38:13\n+   |\n LL |     pub use self::no_def_id::*;\n-   |             ------------------ the name `u8` in the type namespace is supposed to be publicly re-exported here\n-LL |\n+   |             ^^^^^^^^^^^^^^^^^^\n+note: but the private item here shadows it\n+  --> $DIR/hidden_glob_reexports.rs:40:9\n+   |\n LL |     use std::primitive::u8;\n-   |         ^^^^^^^^^^^^^^^^^^ but the private item here shadows it\n+   |         ^^^^^^^^^^^^^^^^^^\n \n warning: 3 warnings emitted\n "}]}