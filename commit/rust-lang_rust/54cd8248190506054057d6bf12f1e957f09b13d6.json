{"sha": "54cd8248190506054057d6bf12f1e957f09b13d6", "node_id": "C_kwDOAAsO6NoAKDU0Y2Q4MjQ4MTkwNTA2MDU0MDU3ZDZiZjEyZjFlOTU3ZjA5YjEzZDY", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2021-12-17T11:16:16Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2021-12-17T12:14:30Z"}, "message": "Remove effect of `#[no_link]` attribute on name resolution\n\nPreviously it hid all non-macro names from other crates.\nThis has no relation to linking and can change name resolution behavior in some cases (e.g. glob conflicts), in addition to just producing the \"unresolved name\" errors", "tree": {"sha": "ffdd698d76ae61c3d64b6171f5f955276166cbb7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ffdd698d76ae61c3d64b6171f5f955276166cbb7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/54cd8248190506054057d6bf12f1e957f09b13d6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/54cd8248190506054057d6bf12f1e957f09b13d6", "html_url": "https://github.com/rust-lang/rust/commit/54cd8248190506054057d6bf12f1e957f09b13d6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/54cd8248190506054057d6bf12f1e957f09b13d6/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "16d8a91d511b0e90391bcb20b8c67036071d9392", "url": "https://api.github.com/repos/rust-lang/rust/commits/16d8a91d511b0e90391bcb20b8c67036071d9392", "html_url": "https://github.com/rust-lang/rust/commit/16d8a91d511b0e90391bcb20b8c67036071d9392"}], "stats": {"total": 22, "additions": 3, "deletions": 19}, "files": [{"sha": "153899b3526d9b5b9c67e71cf7cce3a7b5d0451a", "filename": "compiler/rustc_metadata/src/rmeta/decoder.rs", "status": "modified", "additions": 1, "deletions": 9, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/54cd8248190506054057d6bf12f1e957f09b13d6/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54cd8248190506054057d6bf12f1e957f09b13d6/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder.rs?ref=54cd8248190506054057d6bf12f1e957f09b13d6", "patch": "@@ -1099,10 +1099,7 @@ impl<'a, 'tcx> CrateMetadataRef<'a> {\n         };\n \n         // Iterate over all children.\n-        let macros_only = self.dep_kind.lock().macros_only();\n-        if !macros_only {\n-            let children = self.root.tables.children.get(self, id).unwrap_or_else(Lazy::empty);\n-\n+        if let Some(children) = self.root.tables.children.get(self, id) {\n             for child_index in children.decode((self, sess)) {\n                 // Get the item.\n                 let child_kind = match self.maybe_kind(child_index) {\n@@ -1200,11 +1197,6 @@ impl<'a, 'tcx> CrateMetadataRef<'a> {\n \n         if let EntryKind::Mod(exports) = kind {\n             for exp in exports.decode((self, sess)) {\n-                match exp.res {\n-                    Res::Def(DefKind::Macro(..), _) => {}\n-                    _ if macros_only => continue,\n-                    _ => {}\n-                }\n                 callback(exp);\n             }\n         }"}, {"sha": "c80e61b451116b7e45cd140bb377aec86fc9470e", "filename": "src/test/ui/no-link.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/54cd8248190506054057d6bf12f1e957f09b13d6/src%2Ftest%2Fui%2Fno-link.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54cd8248190506054057d6bf12f1e957f09b13d6/src%2Ftest%2Fui%2Fno-link.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fno-link.rs?ref=54cd8248190506054057d6bf12f1e957f09b13d6", "patch": "@@ -1,8 +1,9 @@\n+// check-pass\n // aux-build:empty-struct.rs\n \n #[no_link]\n extern crate empty_struct;\n \n fn main() {\n-    empty_struct::XEmpty1; //~ ERROR cannot find value `XEmpty1` in crate `empty_struct`\n+    empty_struct::XEmpty1 {};\n }"}, {"sha": "66a74ff65601b20ad552ea2c38327c25559b98b6", "filename": "src/test/ui/no-link.stderr", "status": "removed", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/16d8a91d511b0e90391bcb20b8c67036071d9392/src%2Ftest%2Fui%2Fno-link.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/16d8a91d511b0e90391bcb20b8c67036071d9392/src%2Ftest%2Fui%2Fno-link.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fno-link.stderr?ref=16d8a91d511b0e90391bcb20b8c67036071d9392", "patch": "@@ -1,9 +0,0 @@\n-error[E0425]: cannot find value `XEmpty1` in crate `empty_struct`\n-  --> $DIR/no-link.rs:7:19\n-   |\n-LL |     empty_struct::XEmpty1;\n-   |                   ^^^^^^^ not found in `empty_struct`\n-\n-error: aborting due to previous error\n-\n-For more information about this error, try `rustc --explain E0425`."}]}