{"sha": "2852443f4877115c1c629d462cd83dae0baa7109", "node_id": "C_kwDOAAsO6NoAKDI4NTI0NDNmNDg3NzExNWMxYzYyOWQ0NjJjZDgzZGFlMGJhYTcxMDk", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-07-01T17:33:06Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-07-01T19:01:36Z"}, "message": "rustdoc: use <details> tag for the source code sidebar\n\nThis fixes the extremely poor accessibility of the old system, making it\npossible to navigate the sidebar by keyboard, and also implicitly gives the\nsidebar items the correct ARIA roles.", "tree": {"sha": "c2993fd4f60ff27f00b86d467ccd5056a1d81d51", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c2993fd4f60ff27f00b86d467ccd5056a1d81d51"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2852443f4877115c1c629d462cd83dae0baa7109", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2852443f4877115c1c629d462cd83dae0baa7109", "html_url": "https://github.com/rust-lang/rust/commit/2852443f4877115c1c629d462cd83dae0baa7109", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2852443f4877115c1c629d462cd83dae0baa7109/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5b9775fe17893cba641a071de7e0a7c8f478c41b", "url": "https://api.github.com/repos/rust-lang/rust/commits/5b9775fe17893cba641a071de7e0a7c8f478c41b", "html_url": "https://github.com/rust-lang/rust/commit/5b9775fe17893cba641a071de7e0a7c8f478c41b"}], "stats": {"total": 135, "additions": 53, "deletions": 82}, "files": [{"sha": "7d5318a194c7d1c4b01b22c2003db55c72f16c60", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 8, "deletions": 27, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/2852443f4877115c1c629d462cd83dae0baa7109/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/2852443f4877115c1c629d462cd83dae0baa7109/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=2852443f4877115c1c629d462cd83dae0baa7109", "patch": "@@ -1528,38 +1528,19 @@ kbd {\n \tmargin-bottom: 1em;\n }\n \n-div.children {\n-\tpadding-left: 27px;\n-\tdisplay: none;\n-}\n-div.name {\n+details.dir-entry > summary {\n+\tmargin: 0 0 0 13px;\n+\tlist-style-position: outside;\n \tcursor: pointer;\n-\tposition: relative;\n-\tmargin-left: 16px;\n }\n-div.files > a {\n-\tdisplay: block;\n-\tpadding: 0 3px;\n-}\n-div.files > a:hover, div.name:hover {\n-\tbackground-color: #a14b4b;\n+\n+details.dir-entry div.folders, details.dir-entry div.files {\n+\tpadding-left: 27px;\n }\n-div.name.expand + .children {\n+\n+details.dir-entry a {\n \tdisplay: block;\n }\n-div.name::before {\n-\tcontent: \"\\25B6\";\n-\tpadding-left: 4px;\n-\tfont-size: 0.625rem;\n-\tposition: absolute;\n-\tleft: -16px;\n-\ttop: 4px;\n-}\n-div.name.expand::before {\n-\ttransform: rotate(90deg);\n-\tleft: -15px;\n-\ttop: 2px;\n-}\n \n /* The hideme class is used on summary tags that contain a span with\n \tplaceholder text shown only when the toggle is closed. For instance,"}, {"sha": "a78ac5da7490b2b2aa23420b617dc31da026fb19", "filename": "src/librustdoc/html/static/css/themes/ayu.css", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2852443f4877115c1c629d462cd83dae0baa7109/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "raw_url": "https://github.com/rust-lang/rust/raw/2852443f4877115c1c629d462cd83dae0baa7109/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css?ref=2852443f4877115c1c629d462cd83dae0baa7109", "patch": "@@ -630,7 +630,8 @@ kbd {\n \tcolor: #fff;\n \tborder-bottom-color: #5c6773;\n }\n-#source-sidebar div.files > a:hover, div.name:hover {\n+#source-sidebar div.files > a:hover, details.dir-entry summary:hover,\n+#source-sidebar div.files > a:focus, details.dir-entry summary:focus {\n \tbackground-color: #14191f;\n \tcolor: #ffb44c;\n }"}, {"sha": "a2abd53fa02bc41d0880ce4d33854aa141b3a3db", "filename": "src/librustdoc/html/static/css/themes/dark.css", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2852443f4877115c1c629d462cd83dae0baa7109/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/2852443f4877115c1c629d462cd83dae0baa7109/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css?ref=2852443f4877115c1c629d462cd83dae0baa7109", "patch": "@@ -500,7 +500,8 @@ kbd {\n #source-sidebar > .title {\n \tborder-bottom-color: #ccc;\n }\n-#source-sidebar div.files > a:hover, div.name:hover {\n+#source-sidebar div.files > a:hover, details.dir-entry summary:hover,\n+#source-sidebar div.files > a:focus, details.dir-entry summary:focus {\n \tbackground-color: #444;\n }\n #source-sidebar div.files > .selected {"}, {"sha": "c4510ad6ae66b9e96d2942f0c6b0f0793b594a13", "filename": "src/librustdoc/html/static/css/themes/light.css", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2852443f4877115c1c629d462cd83dae0baa7109/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "raw_url": "https://github.com/rust-lang/rust/raw/2852443f4877115c1c629d462cd83dae0baa7109/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css?ref=2852443f4877115c1c629d462cd83dae0baa7109", "patch": "@@ -484,7 +484,8 @@ kbd {\n #source-sidebar > .title {\n \tborder-bottom-color: #ccc;\n }\n-#source-sidebar div.files > a:hover, div.name:hover {\n+#source-sidebar div.files > a:hover, details.dir-entry summary:hover,\n+#source-sidebar div.files > a:focus, details.dir-entry summary:focus {\n \tbackground-color: #E0E0E0;\n }\n #source-sidebar div.files > .selected {"}, {"sha": "21c36092790751ad175e85932be7fda5a27022ec", "filename": "src/librustdoc/html/static/js/source-script.js", "status": "modified", "additions": 11, "deletions": 18, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/2852443f4877115c1c629d462cd83dae0baa7109/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js", "raw_url": "https://github.com/rust-lang/rust/raw/2852443f4877115c1c629d462cd83dae0baa7109/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsource-script.js?ref=2852443f4877115c1c629d462cd83dae0baa7109", "patch": "@@ -13,33 +13,27 @@ const rootPath = document.getElementById(\"rustdoc-vars\").attributes[\"data-root-p\n let oldScrollPosition = 0;\n \n function createDirEntry(elem, parent, fullPath, hasFoundFile) {\n-    const name = document.createElement(\"div\");\n-    name.className = \"name\";\n+    const dirEntry = document.createElement(\"details\");\n+    const summary = document.createElement(\"summary\");\n+\n+    dirEntry.className = \"dir-entry\";\n \n     fullPath += elem[\"name\"] + \"/\";\n \n-    name.onclick = ev => {\n-        if (hasClass(ev.target, \"expand\")) {\n-            removeClass(ev.target, \"expand\");\n-        } else {\n-            addClass(ev.target, \"expand\");\n-        }\n-    };\n-    name.innerText = elem[\"name\"];\n+    summary.innerText = elem[\"name\"];\n+    dirEntry.appendChild(summary);\n \n-    const children = document.createElement(\"div\");\n-    children.className = \"children\";\n     const folders = document.createElement(\"div\");\n     folders.className = \"folders\";\n     if (elem.dirs) {\n         for (const dir of elem.dirs) {\n             if (createDirEntry(dir, folders, fullPath, hasFoundFile)) {\n-                addClass(name, \"expand\");\n+                dirEntry.open = true;\n                 hasFoundFile = true;\n             }\n         }\n     }\n-    children.appendChild(folders);\n+    dirEntry.appendChild(folders);\n \n     const files = document.createElement(\"div\");\n     files.className = \"files\";\n@@ -51,15 +45,14 @@ function createDirEntry(elem, parent, fullPath, hasFoundFile) {\n             const w = window.location.href.split(\"#\")[0];\n             if (!hasFoundFile && w === file.href) {\n                 file.className = \"selected\";\n-                addClass(name, \"expand\");\n+                dirEntry.open = true;\n                 hasFoundFile = true;\n             }\n             files.appendChild(file);\n         }\n     }\n-    children.appendChild(files);\n-    parent.appendChild(name);\n-    parent.appendChild(children);\n+    dirEntry.appendChild(files);\n+    parent.appendChild(dirEntry);\n     return hasFoundFile;\n }\n "}, {"sha": "1d8cc22100c3db9e1401b17d82ec44633fa2f7cf", "filename": "src/test/rustdoc-gui/sidebar-source-code-display.goml", "status": "modified", "additions": 21, "deletions": 21, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/2852443f4877115c1c629d462cd83dae0baa7109/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code-display.goml", "raw_url": "https://github.com/rust-lang/rust/raw/2852443f4877115c1c629d462cd83dae0baa7109/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code-display.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsidebar-source-code-display.goml?ref=2852443f4877115c1c629d462cd83dae0baa7109", "patch": "@@ -27,29 +27,29 @@ reload:\n // Waiting for the sidebar to be displayed...\n wait-for-css: (\"#sidebar-toggle\", {\"visibility\": \"visible\", \"opacity\": 1})\n assert-css: (\n-    \"#source-sidebar .expand + .children a.selected\",\n+    \"#source-sidebar details[open] > .files a.selected\",\n     {\"color\": \"rgb(0, 0, 0)\", \"background-color\": \"rgb(255, 255, 255)\"},\n )\n // Without hover.\n assert-css: (\n-    \"#source-sidebar .expand + .children > .files a:not(.selected)\",\n+    \"#source-sidebar details[open] > .files a:not(.selected)\",\n     {\"color\": \"rgb(0, 0, 0)\", \"background-color\": \"rgba(0, 0, 0, 0)\"},\n )\n // With hover.\n-move-cursor-to: \"#source-sidebar .expand + .children > .files a:not(.selected)\"\n+move-cursor-to: \"#source-sidebar details[open] > .files a:not(.selected)\"\n assert-css: (\n-    \"#source-sidebar .expand + .children > .files a:not(.selected)\",\n+    \"#source-sidebar details[open] > .files a:not(.selected)\",\n     {\"color\": \"rgb(0, 0, 0)\", \"background-color\": \"rgb(224, 224, 224)\"},\n )\n // Without hover.\n assert-css: (\n-    \"#source-sidebar .expand + .children .folders .name\",\n+    \"#source-sidebar details[open] > .folders > details > summary\",\n     {\"color\": \"rgb(0, 0, 0)\", \"background-color\": \"rgba(0, 0, 0, 0)\"},\n )\n // With hover.\n-move-cursor-to: \"#source-sidebar .expand + .children .folders .name\"\n+move-cursor-to: \"#source-sidebar details[open] > .folders > details > summary\"\n assert-css: (\n-    \"#source-sidebar .expand + .children .folders .name\",\n+    \"#source-sidebar details[open] > .folders > details > summary\",\n     {\"color\": \"rgb(0, 0, 0)\", \"background-color\": \"rgb(224, 224, 224)\"},\n )\n \n@@ -59,29 +59,29 @@ reload:\n // Waiting for the sidebar to be displayed...\n wait-for-css: (\"#sidebar-toggle\", {\"visibility\": \"visible\", \"opacity\": 1})\n assert-css: (\n-    \"#source-sidebar .expand + .children a.selected\",\n+    \"#source-sidebar details[open] > .files > a.selected\",\n     {\"color\": \"rgb(221, 221, 221)\", \"background-color\": \"rgb(51, 51, 51)\"},\n )\n // Without hover.\n assert-css: (\n-    \"#source-sidebar .expand + .children > .files a:not(.selected)\",\n+    \"#source-sidebar details[open] > .files > a:not(.selected)\",\n     {\"color\": \"rgb(221, 221, 221)\", \"background-color\": \"rgba(0, 0, 0, 0)\"},\n )\n // With hover.\n-move-cursor-to: \"#source-sidebar .expand + .children > .files a:not(.selected)\"\n+move-cursor-to: \"#source-sidebar details[open] > .files a:not(.selected)\"\n assert-css: (\n-    \"#source-sidebar .expand + .children > .files a:not(.selected)\",\n+    \"#source-sidebar details[open] > .files a:not(.selected)\",\n     {\"color\": \"rgb(221, 221, 221)\", \"background-color\": \"rgb(68, 68, 68)\"},\n )\n // Without hover.\n assert-css: (\n-    \"#source-sidebar .expand + .children .folders .name\",\n+    \"#source-sidebar details[open] > .folders > details > summary\",\n     {\"color\": \"rgb(221, 221, 221)\", \"background-color\": \"rgba(0, 0, 0, 0)\"},\n )\n // With hover.\n-move-cursor-to: \"#source-sidebar .expand + .children .folders .name\"\n+move-cursor-to: \"#source-sidebar details[open] > .folders > details > summary\"\n assert-css: (\n-    \"#source-sidebar .expand + .children .folders .name\",\n+    \"#source-sidebar details[open] > .folders > details > summary\",\n     {\"color\": \"rgb(221, 221, 221)\", \"background-color\": \"rgb(68, 68, 68)\"},\n )\n \n@@ -91,29 +91,29 @@ reload:\n // Waiting for the sidebar to be displayed...\n wait-for-css: (\"#sidebar-toggle\", {\"visibility\": \"visible\", \"opacity\": 1})\n assert-css: (\n-    \"#source-sidebar .expand + .children a.selected\",\n+    \"#source-sidebar details[open] > .files a.selected\",\n     {\"color\": \"rgb(255, 180, 76)\", \"background-color\": \"rgb(20, 25, 31)\"},\n )\n // Without hover.\n assert-css: (\n-    \"#source-sidebar .expand + .children > .files a:not(.selected)\",\n+    \"#source-sidebar details[open] > .files a:not(.selected)\",\n     {\"color\": \"rgb(197, 197, 197)\", \"background-color\": \"rgba(0, 0, 0, 0)\"},\n )\n // With hover.\n-move-cursor-to: \"#source-sidebar .expand + .children > .files a:not(.selected)\"\n+move-cursor-to: \"#source-sidebar details[open] > .files a:not(.selected)\"\n assert-css: (\n-    \"#source-sidebar .expand + .children > .files a:not(.selected)\",\n+    \"#source-sidebar details[open] > .files a:not(.selected)\",\n     {\"color\": \"rgb(255, 180, 76)\", \"background-color\": \"rgb(20, 25, 31)\"},\n )\n // Without hover.\n assert-css: (\n-    \"#source-sidebar .expand + .children .folders .name\",\n+    \"#source-sidebar details[open] > .folders > details > summary\",\n     {\"color\": \"rgb(197, 197, 197)\", \"background-color\": \"rgba(0, 0, 0, 0)\"},\n )\n // With hover.\n-move-cursor-to: \"#source-sidebar .expand + .children .folders .name\"\n+move-cursor-to: \"#source-sidebar details[open] > .folders > details > summary\"\n assert-css: (\n-    \"#source-sidebar .expand + .children .folders .name\",\n+    \"#source-sidebar details[open] > .folders > details > summary\",\n     {\"color\": \"rgb(255, 180, 76)\", \"background-color\": \"rgb(20, 25, 31)\"},\n )\n "}, {"sha": "05b0e809bca69a8e885822b4be24848620b6c805", "filename": "src/test/rustdoc-gui/source-code-page.goml", "status": "modified", "additions": 7, "deletions": 13, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/2852443f4877115c1c629d462cd83dae0baa7109/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "raw_url": "https://github.com/rust-lang/rust/raw/2852443f4877115c1c629d462cd83dae0baa7109/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml?ref=2852443f4877115c1c629d462cd83dae0baa7109", "patch": "@@ -34,19 +34,13 @@ assert-document-property: ({\"URL\": \"/lib.rs.html\"}, ENDS_WITH)\n click: \"#sidebar-toggle\"\n assert: \".source-sidebar-expanded\"\n \n-// We check that the first entry of the sidebar is collapsed (which, for whatever reason,\n-// is number 2 and not 1...).\n-assert-attribute: (\"#source-sidebar .name:nth-child(2)\", {\"class\": \"name\"})\n-assert-text: (\"#source-sidebar .name:nth-child(2)\", \"implementors\")\n-// We also check its children are hidden too.\n-assert-css: (\"#source-sidebar .name:nth-child(2) + .children\", {\"display\": \"none\"})\n+// We check that the first entry of the sidebar is collapsed\n+assert-property: (\"#source-sidebar details:first-of-type\", {\"open\": \"false\"})\n+assert-text: (\"#source-sidebar details:first-of-type > summary\", \"implementors\")\n // We now click on it.\n-click: \"#source-sidebar .name:nth-child(2)\"\n-assert-attribute: (\"#source-sidebar .name:nth-child(2)\", {\"class\": \"name expand\"})\n-// Checking that its children are displayed as well.\n-assert-css: (\"#source-sidebar .name:nth-child(2) + .children\", {\"display\": \"block\"})\n+click: \"#source-sidebar details:first-of-type > summary\"\n+assert-property: (\"#source-sidebar details:first-of-type\", {\"open\": \"true\"})\n \n // And now we collapse it again.\n-click: \"#source-sidebar .name:nth-child(2)\"\n-assert-attribute: (\"#source-sidebar .name:nth-child(2)\", {\"class\": \"name\"})\n-assert-css: (\"#source-sidebar .name:nth-child(2) + .children\", {\"display\": \"none\"})\n+click: \"#source-sidebar details:first-of-type > summary\"\n+assert-property: (\"#source-sidebar details:first-of-type\", {\"open\": \"false\"})"}]}