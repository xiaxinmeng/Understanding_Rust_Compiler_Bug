{"sha": "325b7111c2bcb9c44ed4c1ea7348a7357de23fa0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMyNWI3MTExYzJiY2I5YzQ0ZWQ0YzFlYTczNDhhNzM1N2RlMjNmYTA=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2016-08-30T08:39:06Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-08-30T08:39:06Z"}, "message": "Rollup merge of #35895 - F001:patch-1, r=steveklabnik\n\nFix documentation in cell mod\n\nThe implementation of Rc type in this doc is outdated.", "tree": {"sha": "82752c4bb4bc91fb371096fd0777a909cf2077e5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/82752c4bb4bc91fb371096fd0777a909cf2077e5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/325b7111c2bcb9c44ed4c1ea7348a7357de23fa0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/325b7111c2bcb9c44ed4c1ea7348a7357de23fa0", "html_url": "https://github.com/rust-lang/rust/commit/325b7111c2bcb9c44ed4c1ea7348a7357de23fa0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/325b7111c2bcb9c44ed4c1ea7348a7357de23fa0/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b4a6b6bd9e144fc80167dc7a4f284a9d2b4f1c45", "url": "https://api.github.com/repos/rust-lang/rust/commits/b4a6b6bd9e144fc80167dc7a4f284a9d2b4f1c45", "html_url": "https://github.com/rust-lang/rust/commit/b4a6b6bd9e144fc80167dc7a4f284a9d2b4f1c45"}, {"sha": "f4c55dd08f8e02145d28f2ccdc07cf3e9d9ffc1b", "url": "https://api.github.com/repos/rust-lang/rust/commits/f4c55dd08f8e02145d28f2ccdc07cf3e9d9ffc1b", "html_url": "https://github.com/rust-lang/rust/commit/f4c55dd08f8e02145d28f2ccdc07cf3e9d9ffc1b"}], "stats": {"total": 49, "additions": 39, "deletions": 10}, "files": [{"sha": "f0710a1d93578495eeb0ccc3c0365d34df675674", "filename": "src/libcore/cell.rs", "status": "modified", "additions": 39, "deletions": 10, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/325b7111c2bcb9c44ed4c1ea7348a7357de23fa0/src%2Flibcore%2Fcell.rs", "raw_url": "https://github.com/rust-lang/rust/raw/325b7111c2bcb9c44ed4c1ea7348a7357de23fa0/src%2Flibcore%2Fcell.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fcell.rs?ref=325b7111c2bcb9c44ed4c1ea7348a7357de23fa0", "patch": "@@ -119,26 +119,55 @@\n //! `Cell<T>`.\n //!\n //! ```\n+//! #![feature(core_intrinsics)]\n+//! #![feature(shared)]\n //! use std::cell::Cell;\n+//! use std::ptr::Shared;\n+//! use std::intrinsics::abort;\n+//! use std::intrinsics::assume;\n //!\n-//! struct Rc<T> {\n-//!     ptr: *mut RcBox<T>\n+//! struct Rc<T: ?Sized> {\n+//!     ptr: Shared<RcBox<T>>\n //! }\n //!\n-//! struct RcBox<T> {\n-//! # #[allow(dead_code)]\n+//! struct RcBox<T: ?Sized> {\n+//!     strong: Cell<usize>,\n+//!     refcount: Cell<usize>,\n //!     value: T,\n-//!     refcount: Cell<usize>\n //! }\n //!\n-//! impl<T> Clone for Rc<T> {\n+//! impl<T: ?Sized> Clone for Rc<T> {\n //!     fn clone(&self) -> Rc<T> {\n-//!         unsafe {\n-//!             (*self.ptr).refcount.set((*self.ptr).refcount.get() + 1);\n-//!             Rc { ptr: self.ptr }\n-//!         }\n+//!         self.inc_strong();\n+//!         Rc { ptr: self.ptr }\n+//!     }\n+//! }\n+//!\n+//! trait RcBoxPtr<T: ?Sized> {\n+//!\n+//!     fn inner(&self) -> &RcBox<T>;\n+//!\n+//!     fn strong(&self) -> usize {\n+//!         self.inner().strong.get()\n+//!     }\n+//!\n+//!     fn inc_strong(&self) {\n+//!         self.inner()\n+//!             .strong\n+//!             .set(self.strong()\n+//!                      .checked_add(1)\n+//!                      .unwrap_or_else(|| unsafe { abort() }));\n //!     }\n //! }\n+//!\n+//! impl<T: ?Sized> RcBoxPtr<T> for Rc<T> {\n+//!    fn inner(&self) -> &RcBox<T> {\n+//!        unsafe {\n+//!            assume(!(*(&self.ptr as *const _ as *const *const ())).is_null());\n+//!            &(**self.ptr)\n+//!        }\n+//!    }\n+//! }\n //! ```\n //!\n "}]}