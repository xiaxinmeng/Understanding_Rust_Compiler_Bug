{"sha": "edfcd3a723366cd4afd1f4f44a5a958da34e6c58", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVkZmNkM2E3MjMzNjZjZDRhZmQxZjRmNDRhNWE5NThkYTM0ZTZjNTg=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-07-01T04:00:09Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-07-01T04:00:09Z"}, "message": "Add relaxed init-context in which we're willing to auto-deref.", "tree": {"sha": "afa2a6c8f4172e7a116d53986e8ec7b0cc490662", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/afa2a6c8f4172e7a116d53986e8ec7b0cc490662"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/edfcd3a723366cd4afd1f4f44a5a958da34e6c58", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/edfcd3a723366cd4afd1f4f44a5a958da34e6c58", "html_url": "https://github.com/rust-lang/rust/commit/edfcd3a723366cd4afd1f4f44a5a958da34e6c58", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/edfcd3a723366cd4afd1f4f44a5a958da34e6c58/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f6fda46020915fdece18a3446071fa3be960432a", "url": "https://api.github.com/repos/rust-lang/rust/commits/f6fda46020915fdece18a3446071fa3be960432a", "html_url": "https://github.com/rust-lang/rust/commit/f6fda46020915fdece18a3446071fa3be960432a"}], "stats": {"total": 15, "additions": 10, "deletions": 5}, "files": [{"sha": "9b09bf790dd7dc170e19b3aa94a4f5b9a5dadeda", "filename": "src/boot/me/type.ml", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/edfcd3a723366cd4afd1f4f44a5a958da34e6c58/src%2Fboot%2Fme%2Ftype.ml", "raw_url": "https://github.com/rust-lang/rust/raw/edfcd3a723366cd4afd1f4f44a5a958da34e6c58/src%2Fboot%2Fme%2Ftype.ml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fboot%2Fme%2Ftype.ml?ref=edfcd3a723366cd4afd1f4f44a5a958da34e6c58", "patch": "@@ -191,6 +191,11 @@ let lval_ctx =\n     mut_ok = true }\n ;;\n \n+let init_ctx =\n+  { ext_ok = true;\n+    mut_ok = true }\n+;;\n+\n let strict_ctx =\n   { ext_ok = false;\n     mut_ok = false }\n@@ -1150,7 +1155,7 @@ let process_crate (cx:ctxt) (crate:Ast.crate) : unit =\n               let tvbase = any() in\n                 unify_lval rval_ctx base tvbase;\n                 unify_tyvars rval_ctx tvrec tvbase;\n-                unify_lval lval_ctx dst tvrec\n+                unify_lval init_ctx dst tvrec\n \n         | Ast.STMT_init_rec (dst, fields, None) ->\n             let dct = Hashtbl.create 10 in\n@@ -1160,7 +1165,7 @@ let process_crate (cx:ctxt) (crate:Ast.crate) : unit =\n                 Hashtbl.add dct ident tv\n             in\n               Array.iter add_field fields;\n-              unify_lval lval_ctx dst (ref (TYSPEC_record dct))\n+              unify_lval init_ctx dst (ref (TYSPEC_record dct))\n \n         | Ast.STMT_init_tup (dst, members) ->\n             let member_to_tv atom =\n@@ -1169,16 +1174,16 @@ let process_crate (cx:ctxt) (crate:Ast.crate) : unit =\n                 tv\n             in\n             let member_tvs = Array.map member_to_tv members in\n-              unify_lval lval_ctx dst (ref (TYSPEC_tuple member_tvs))\n+              unify_lval init_ctx dst (ref (TYSPEC_tuple member_tvs))\n \n         | Ast.STMT_init_vec (dst, atoms) ->\n             let tv = any() in\n             let unify_with_tv atom = unify_atom rval_ctx atom tv in\n               Array.iter unify_with_tv atoms;\n-              unify_lval lval_ctx dst (ref (TYSPEC_vector tv))\n+              unify_lval init_ctx dst (ref (TYSPEC_vector tv))\n \n         | Ast.STMT_init_str (dst, _) ->\n-            unify_lval lval_ctx dst (ty Ast.TY_str)\n+            unify_lval init_ctx dst (ty Ast.TY_str)\n \n         | Ast.STMT_copy (dst, expr) ->\n             let tv = any() in"}]}