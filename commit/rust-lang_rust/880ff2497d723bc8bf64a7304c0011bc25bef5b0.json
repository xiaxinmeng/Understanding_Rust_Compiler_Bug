{"sha": "880ff2497d723bc8bf64a7304c0011bc25bef5b0", "node_id": "C_kwDOAAsO6NoAKDg4MGZmMjQ5N2Q3MjNiYzhiZjY0YTczMDRjMDAxMWJjMjViZWY1YjA", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-04-06T08:27:03Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-04-06T08:27:03Z"}, "message": "Auto merge of #8596 - Jaic1:unnecessary_cast, r=flip1995\n\nFix unnecessary_cast suggestion for type aliasses\n\nFix #6923. The [`unnecessary_cast`] lint now will skip casting to non-primitive type.\n\nchangelog: fix lint [`unnecessary_cast `]", "tree": {"sha": "03dde27c4a442c9babbbf23d5eaca6a6d8edcd21", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/03dde27c4a442c9babbbf23d5eaca6a6d8edcd21"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/880ff2497d723bc8bf64a7304c0011bc25bef5b0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/880ff2497d723bc8bf64a7304c0011bc25bef5b0", "html_url": "https://github.com/rust-lang/rust/commit/880ff2497d723bc8bf64a7304c0011bc25bef5b0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/880ff2497d723bc8bf64a7304c0011bc25bef5b0/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "41f2eccf92c54337b727d891e42ba66105c56d0d", "url": "https://api.github.com/repos/rust-lang/rust/commits/41f2eccf92c54337b727d891e42ba66105c56d0d", "html_url": "https://github.com/rust-lang/rust/commit/41f2eccf92c54337b727d891e42ba66105c56d0d"}, {"sha": "ec851b870b59848bdbf531928a7cf38225d3a12e", "url": "https://api.github.com/repos/rust-lang/rust/commits/ec851b870b59848bdbf531928a7cf38225d3a12e", "html_url": "https://github.com/rust-lang/rust/commit/ec851b870b59848bdbf531928a7cf38225d3a12e"}], "stats": {"total": 30, "additions": 29, "deletions": 1}, "files": [{"sha": "af56ec11ef8acd741ec4a8a45926d8fd2656e36a", "filename": "clippy_lints/src/casts/unnecessary_cast.rs", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/880ff2497d723bc8bf64a7304c0011bc25bef5b0/clippy_lints%2Fsrc%2Fcasts%2Funnecessary_cast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/880ff2497d723bc8bf64a7304c0011bc25bef5b0/clippy_lints%2Fsrc%2Fcasts%2Funnecessary_cast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fcasts%2Funnecessary_cast.rs?ref=880ff2497d723bc8bf64a7304c0011bc25bef5b0", "patch": "@@ -4,7 +4,8 @@ use clippy_utils::source::snippet_opt;\n use if_chain::if_chain;\n use rustc_ast::{LitFloatType, LitIntType, LitKind};\n use rustc_errors::Applicability;\n-use rustc_hir::{Expr, ExprKind, Lit, UnOp};\n+use rustc_hir::def::Res;\n+use rustc_hir::{Expr, ExprKind, Lit, QPath, TyKind, UnOp};\n use rustc_lint::{LateContext, LintContext};\n use rustc_middle::lint::in_external_macro;\n use rustc_middle::ty::{self, FloatTy, InferTy, Ty};\n@@ -18,6 +19,17 @@ pub(super) fn check(\n     cast_from: Ty<'_>,\n     cast_to: Ty<'_>,\n ) -> bool {\n+    // skip non-primitive type cast\n+    if_chain! {\n+        if let ExprKind::Cast(_, cast_to) = expr.kind;\n+        if let TyKind::Path(QPath::Resolved(_, path)) = &cast_to.kind;\n+        if let Res::PrimTy(_) = path.res;\n+        then {}\n+        else {\n+            return false\n+        }\n+    }\n+\n     if let Some(lit) = get_numeric_literal(cast_expr) {\n         let literal_str = snippet_opt(cx, cast_expr.span).unwrap_or_default();\n "}, {"sha": "62c3e9636866a5a67492f339ca706b97aea73c31", "filename": "tests/ui/unnecessary_cast.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/880ff2497d723bc8bf64a7304c0011bc25bef5b0/tests%2Fui%2Funnecessary_cast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/880ff2497d723bc8bf64a7304c0011bc25bef5b0/tests%2Fui%2Funnecessary_cast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funnecessary_cast.rs?ref=880ff2497d723bc8bf64a7304c0011bc25bef5b0", "patch": "@@ -30,4 +30,10 @@ fn main() {\n \n     // do not lint cast to cfg-dependant type\n     1 as std::os::raw::c_char;\n+\n+    // do not lint cast to alias type\n+    1 as I32Alias;\n+    &1 as &I32Alias;\n }\n+\n+type I32Alias = i32;"}, {"sha": "36800c5340db21d665070b288040e00958bd612a", "filename": "tests/ui/unnecessary_cast_fixable.fixed", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/880ff2497d723bc8bf64a7304c0011bc25bef5b0/tests%2Fui%2Funnecessary_cast_fixable.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/880ff2497d723bc8bf64a7304c0011bc25bef5b0/tests%2Fui%2Funnecessary_cast_fixable.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funnecessary_cast_fixable.fixed?ref=880ff2497d723bc8bf64a7304c0011bc25bef5b0", "patch": "@@ -42,4 +42,9 @@ fn main() {\n \n     let _ = -1_i32;\n     let _ = -1.0_f32;\n+\n+    let _ = 1 as I32Alias;\n+    let _ = &1 as &I32Alias;\n }\n+\n+type I32Alias = i32;"}, {"sha": "d4b6bb952ab3508261198212ba394d20b5cd3d4c", "filename": "tests/ui/unnecessary_cast_fixable.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/880ff2497d723bc8bf64a7304c0011bc25bef5b0/tests%2Fui%2Funnecessary_cast_fixable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/880ff2497d723bc8bf64a7304c0011bc25bef5b0/tests%2Fui%2Funnecessary_cast_fixable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funnecessary_cast_fixable.rs?ref=880ff2497d723bc8bf64a7304c0011bc25bef5b0", "patch": "@@ -42,4 +42,9 @@ fn main() {\n \n     let _ = -1 as i32;\n     let _ = -1.0 as f32;\n+\n+    let _ = 1 as I32Alias;\n+    let _ = &1 as &I32Alias;\n }\n+\n+type I32Alias = i32;"}]}