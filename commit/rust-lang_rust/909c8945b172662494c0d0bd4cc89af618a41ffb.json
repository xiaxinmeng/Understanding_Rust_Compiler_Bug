{"sha": "909c8945b172662494c0d0bd4cc89af618a41ffb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkwOWM4OTQ1YjE3MjY2MjQ5NGMwZDBiZDRjYzg5YWY2MThhNDFmZmI=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2020-11-12T19:29:52Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2020-11-12T19:53:42Z"}, "message": "stability: More precise location for deprecation lint on macros", "tree": {"sha": "09477293dbdc3f0e2e4b8066c32fa6763e2c03bf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/09477293dbdc3f0e2e4b8066c32fa6763e2c03bf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/909c8945b172662494c0d0bd4cc89af618a41ffb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/909c8945b172662494c0d0bd4cc89af618a41ffb", "html_url": "https://github.com/rust-lang/rust/commit/909c8945b172662494c0d0bd4cc89af618a41ffb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/909c8945b172662494c0d0bd4cc89af618a41ffb/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9722952f0bed5815cb22cb4878be09fb39f92804", "url": "https://api.github.com/repos/rust-lang/rust/commits/9722952f0bed5815cb22cb4878be09fb39f92804", "html_url": "https://github.com/rust-lang/rust/commit/9722952f0bed5815cb22cb4878be09fb39f92804"}], "stats": {"total": 18, "additions": 15, "deletions": 3}, "files": [{"sha": "47c140e0b18829b4e82b051f1dbd9000edda2e7f", "filename": "compiler/rustc_middle/src/middle/stability.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/909c8945b172662494c0d0bd4cc89af618a41ffb/compiler%2Frustc_middle%2Fsrc%2Fmiddle%2Fstability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/909c8945b172662494c0d0bd4cc89af618a41ffb/compiler%2Frustc_middle%2Fsrc%2Fmiddle%2Fstability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmiddle%2Fstability.rs?ref=909c8945b172662494c0d0bd4cc89af618a41ffb", "patch": "@@ -4,7 +4,7 @@\n pub use self::StabilityLevel::*;\n \n use crate::ty::{self, TyCtxt};\n-use rustc_ast::CRATE_NODE_ID;\n+use rustc_ast::NodeId;\n use rustc_attr::{self as attr, ConstStability, Deprecation, Stability};\n use rustc_data_structures::fx::{FxHashMap, FxHashSet};\n use rustc_errors::{Applicability, DiagnosticBuilder};\n@@ -211,13 +211,14 @@ pub fn early_report_deprecation(\n     suggestion: Option<Symbol>,\n     lint: &'static Lint,\n     span: Span,\n+    node_id: NodeId,\n ) {\n     if span.in_derive_expansion() {\n         return;\n     }\n \n     let diag = BuiltinLintDiagnostics::DeprecatedMacro(suggestion, span);\n-    lint_buffer.buffer_lint_with_diagnostic(lint, CRATE_NODE_ID, span, message, diag);\n+    lint_buffer.buffer_lint_with_diagnostic(lint, node_id, span, message, diag);\n }\n \n fn late_report_deprecation("}, {"sha": "2fe2a499bcf20f17571bc20a9ce88b07badc2c77", "filename": "compiler/rustc_resolve/src/macros.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/909c8945b172662494c0d0bd4cc89af618a41ffb/compiler%2Frustc_resolve%2Fsrc%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/909c8945b172662494c0d0bd4cc89af618a41ffb/compiler%2Frustc_resolve%2Fsrc%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fmacros.rs?ref=909c8945b172662494c0d0bd4cc89af618a41ffb", "patch": "@@ -1028,6 +1028,7 @@ impl<'a> Resolver<'a> {\n                 depr.suggestion,\n                 lint,\n                 span,\n+                node_id,\n             );\n         }\n     }"}, {"sha": "a9c7ac363b0b31261b0993c550d84dc99c5badb7", "filename": "src/test/ui/lint/expansion-time.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/909c8945b172662494c0d0bd4cc89af618a41ffb/src%2Ftest%2Fui%2Flint%2Fexpansion-time.rs", "raw_url": "https://github.com/rust-lang/rust/raw/909c8945b172662494c0d0bd4cc89af618a41ffb/src%2Ftest%2Fui%2Flint%2Fexpansion-time.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fexpansion-time.rs?ref=909c8945b172662494c0d0bd4cc89af618a41ffb", "patch": "@@ -12,6 +12,16 @@ mod benches {\n     fn foo() {}\n }\n \n+#[deprecated = \"reason\"]\n+macro_rules! deprecated {\n+    () => {}\n+}\n+\n+#[allow(deprecated)]\n+mod deprecated {\n+    deprecated!(); // No warning\n+}\n+\n #[warn(incomplete_include)]\n fn main() {\n     // WARN see in the stderr file, the warning points to the included file."}, {"sha": "24e2733064e48029f0be9f6eab9977db04e861b3", "filename": "src/test/ui/lint/expansion-time.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/909c8945b172662494c0d0bd4cc89af618a41ffb/src%2Ftest%2Fui%2Flint%2Fexpansion-time.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/909c8945b172662494c0d0bd4cc89af618a41ffb/src%2Ftest%2Fui%2Flint%2Fexpansion-time.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fexpansion-time.stderr?ref=909c8945b172662494c0d0bd4cc89af618a41ffb", "patch": "@@ -33,7 +33,7 @@ LL | 2\n    | ^\n    |\n note: the lint level is defined here\n-  --> $DIR/expansion-time.rs:15:8\n+  --> $DIR/expansion-time.rs:25:8\n    |\n LL | #[warn(incomplete_include)]\n    |        ^^^^^^^^^^^^^^^^^^"}]}