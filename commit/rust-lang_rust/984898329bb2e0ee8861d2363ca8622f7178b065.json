{"sha": "984898329bb2e0ee8861d2363ca8622f7178b065", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk4NDg5ODMyOWJiMmUwZWU4ODYxZDIzNjNjYTg2MjJmNzE3OGIwNjU=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-02-08T04:38:34Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-02-08T04:38:34Z"}, "message": "Merge #7549\n\n7549:  Documentation: Explain how initial configuration is sent over LSP and document vim-lsp r=ilya-bobyr a=ilya-bobyr\n\nThis request contains two related but independent changes.\r\nThe first explains `rust-analyzer` initial configuration over LSP.\r\nThe second - adds documentation on `vim-lsp` Vim plugin and provides an example of the initial configuration for `rust-analyzer` when using this particular LSP client.\r\n\r\nLet me know if you would prefer the changes to be reviewed in two separate pull requests.\n\nCo-authored-by: Ilya Bobyr <ilya.bobyr@gmail.com>", "tree": {"sha": "150b02bc54dd0eb8e273ee7b88708a970fbdf896", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/150b02bc54dd0eb8e273ee7b88708a970fbdf896"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/984898329bb2e0ee8861d2363ca8622f7178b065", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgIMBKCRBK7hj4Ov3rIwAAdHIIAJFwX0fyMb3x54ljOvULt9A1\nQ0zkt2Mp8pF92R4kb3cfNrJHBDLjoLaoVMp/JVXYvZ4xn4cKorQZNEMkGSdd8jqe\nRI8fHrkWtOgNxcjqLexPbT5zbzNVrxytgYanavHukyH0eXmGLwToOzcTJ6Bw2KIC\nS+EnC/znugDJV6zscyjxXergs0on5vsechqAyKlgzP/6uxiqC09lesQTYfm/SrzU\nbS4iIM0uqqe3TsL92PV+Sm51BacFdfQv78KeMUzJ4L9W0YhupHlj6CPLqDBF3Qlo\nXVICeCiEk6O4SLkeUb4y1gvFaB7qfVn5pSZPXa8Bwg12ekp7/Drld6CTPzf+Eco=\n=yTjK\n-----END PGP SIGNATURE-----\n", "payload": "tree 150b02bc54dd0eb8e273ee7b88708a970fbdf896\nparent 336909b63a14b801520c6627d90d750babcfe280\nparent 9ffe4ca26ce473d165e2fb925c6dedf7abad1591\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1612759114 +0000\ncommitter GitHub <noreply@github.com> 1612759114 +0000\n\nMerge #7549\n\n7549:  Documentation: Explain how initial configuration is sent over LSP and document vim-lsp r=ilya-bobyr a=ilya-bobyr\n\nThis request contains two related but independent changes.\r\nThe first explains `rust-analyzer` initial configuration over LSP.\r\nThe second - adds documentation on `vim-lsp` Vim plugin and provides an example of the initial configuration for `rust-analyzer` when using this particular LSP client.\r\n\r\nLet me know if you would prefer the changes to be reviewed in two separate pull requests.\n\nCo-authored-by: Ilya Bobyr <ilya.bobyr@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/984898329bb2e0ee8861d2363ca8622f7178b065", "html_url": "https://github.com/rust-lang/rust/commit/984898329bb2e0ee8861d2363ca8622f7178b065", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/984898329bb2e0ee8861d2363ca8622f7178b065/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "336909b63a14b801520c6627d90d750babcfe280", "url": "https://api.github.com/repos/rust-lang/rust/commits/336909b63a14b801520c6627d90d750babcfe280", "html_url": "https://github.com/rust-lang/rust/commit/336909b63a14b801520c6627d90d750babcfe280"}, {"sha": "9ffe4ca26ce473d165e2fb925c6dedf7abad1591", "url": "https://api.github.com/repos/rust-lang/rust/commits/9ffe4ca26ce473d165e2fb925c6dedf7abad1591", "html_url": "https://github.com/rust-lang/rust/commit/9ffe4ca26ce473d165e2fb925c6dedf7abad1591"}], "stats": {"total": 78, "additions": 73, "deletions": 5}, "files": [{"sha": "a1018b0cb7f3e2e92a2e71451fdbefdda2ae4b82", "filename": "docs/user/manual.adoc", "status": "modified", "additions": 73, "deletions": 5, "changes": 78, "blob_url": "https://github.com/rust-lang/rust/blob/984898329bb2e0ee8861d2363ca8622f7178b065/docs%2Fuser%2Fmanual.adoc", "raw_url": "https://github.com/rust-lang/rust/raw/984898329bb2e0ee8861d2363ca8622f7178b065/docs%2Fuser%2Fmanual.adoc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fuser%2Fmanual.adoc?ref=984898329bb2e0ee8861d2363ca8622f7178b065", "patch": "@@ -307,6 +307,52 @@ EOF\n \n See https://sharksforarms.dev/posts/neovim-rust/ for more tips on getting started.\n \n+==== vim-lsp\n+\n+vim-lsp is installed by following https://github.com/prabirshrestha/vim-lsp[the plugin instructions].\n+It can be as simple as adding this line to your `.vimrc`:\n+\n+[source,vim]\n+----\n+Plug 'prabirshrestha/vim-lsp'\n+----\n+\n+Next you need to register the `rust-analyzer` binary.\n+If it is available in `$PATH`, you may want to add this to your `.vimrc`:\n+\n+[source,vim]\n+----\n+if executable('rust-analyzer')\n+  au User lsp_setup call lsp#register_server({\n+        \\   'name': 'Rust Language Server',\n+        \\   'cmd': {server_info->['rust-analyzer']},\n+        \\   'whitelist': ['rust'],\n+        \\ })\n+endif\n+----\n+\n+There is no dedicated UI for the server configuration, so you would need to send any options as a value of the `initialization_options` field, as described in the <<_configuration,Configuration>> section.\n+Here is an example of how to enable the proc-macro support:\n+\n+[source,vim]\n+----\n+if executable('rust-analyzer')\n+  au User lsp_setup call lsp#register_server({\n+        \\   'name': 'Rust Language Server',\n+        \\   'cmd': {server_info->['rust-analyzer']},\n+        \\   'whitelist': ['rust'],\n+        \\   'initialization_options': {\n+        \\     'cargo': {\n+        \\       'loadOutDirsFromCheck': v:true,\n+        \\     },\n+        \\     'procMacro': {\n+        \\       'enable': v:true,\n+        \\     },\n+        \\   },\n+        \\ })\n+endif\n+----\n+\n === Sublime Text 3\n \n Prerequisites: You have installed the <<rust-analyzer-language-server-binary,`rust-analyzer` binary>>.\n@@ -335,13 +381,35 @@ If the LSP binary is not available, GNOME Builder can install it when opening a\n \n **Source:** https://github.com/rust-analyzer/rust-analyzer/blob/master/crates/rust-analyzer/src/config.rs[config.rs]\n \n-rust-analyzer is configured via LSP messages, which means that it's up to the editor to decide on the exact format and location of configuration files.\n-Please consult your editor's documentation to learn how to configure LSP servers.\n+The <<_installation,Installation>> section contains details on configuration for some of the editors.\n+In general `rust-analyzer` is configured via LSP messages, which means that it's up to the editor to decide on the exact format and location of configuration files.\n+\n+Some clients, such as <<vs-code,VS Code>> or <<coc-rust-analyzer,COC plugin in Vim>> provide `rust-analyzer` specific configuration UIs. Others may require you to know a bit more about the interaction with `rust-analyzer`.\n+\n+For the later category, it might help to know that the initial configuration is specified as a value of the `intializationOptions` field of the https://microsoft.github.io/language-server-protocol/specifications/specification-current/#initialize[`InitializeParams` message, in the LSP protocol].\n+The spec says that the field type is `any?`, but `rust-analyzer` is looking for a JSON object that is constructed using settings from the list below.\n+Name of the setting, ignoring the `rust-analyzer.` prefix, is used as a path, and value of the setting becomes the JSON property value.\n+\n+For example, a very common configuration is to enable proc-macro support, can be achieved by sending this JSON:\n+\n+[source,json]\n+----\n+{\n+  \"cargo\": {\n+    \"loadOutDirsFromCheck\": true,\n+  },\n+  \"procMacro\": {\n+    \"enable\": true,\n+  }\n+}\n+----\n+\n+Please consult your editor's documentation to learn more about how to configure https://microsoft.github.io/language-server-protocol/[LSP servers].\n \n-To verify which configuration is actually used by rust-analyzer, set `RA_LOG` environment variable to `rust_analyzer=info` and look for config-related messages.\n-Logs should show both the JSON that rust-analyzer sees as well as the updated config.\n+To verify which configuration is actually used by `rust-analyzer`, set `RA_LOG` environment variable to `rust_analyzer=info` and look for config-related messages.\n+Logs should show both the JSON that `rust-analyzer` sees as well as the updated config.\n \n-This is the list of config options rust-analyzer supports:\n+This is the list of config options `rust-analyzer` supports:\n \n include::./generated_config.adoc[]\n "}]}