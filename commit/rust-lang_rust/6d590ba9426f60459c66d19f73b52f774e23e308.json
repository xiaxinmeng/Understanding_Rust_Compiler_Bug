{"sha": "6d590ba9426f60459c66d19f73b52f774e23e308", "node_id": "C_kwDOAAsO6NoAKDZkNTkwYmE5NDI2ZjYwNDU5YzY2ZDE5ZjczYjUyZjc3NGUyM2UzMDg", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2022-04-26T18:33:17Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2022-04-26T18:36:46Z"}, "message": "rustdoc: Resolve doc links on fields during early resolution", "tree": {"sha": "1bc65e4777cecd80799926120020acb5ff70c2ae", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1bc65e4777cecd80799926120020acb5ff70c2ae"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6d590ba9426f60459c66d19f73b52f774e23e308", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6d590ba9426f60459c66d19f73b52f774e23e308", "html_url": "https://github.com/rust-lang/rust/commit/6d590ba9426f60459c66d19f73b52f774e23e308", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6d590ba9426f60459c66d19f73b52f774e23e308/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3d237ab52920924694f6fc3e47ee8588514bfa70", "url": "https://api.github.com/repos/rust-lang/rust/commits/3d237ab52920924694f6fc3e47ee8588514bfa70", "html_url": "https://github.com/rust-lang/rust/commit/3d237ab52920924694f6fc3e47ee8588514bfa70"}], "stats": {"total": 58, "additions": 57, "deletions": 1}, "files": [{"sha": "1b80f6b93dc7831c79eccfafbdd7f8e98c6b93bb", "filename": "src/librustdoc/passes/collect_intra_doc_links/early.rs", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6d590ba9426f60459c66d19f73b52f774e23e308/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links%2Fearly.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d590ba9426f60459c66d19f73b52f774e23e308/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links%2Fearly.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links%2Fearly.rs?ref=6d590ba9426f60459c66d19f73b52f774e23e308", "patch": "@@ -260,10 +260,22 @@ impl EarlyDocLinkResolver<'_, '_> {\n                     if let Res::Def(DefKind::Mod, ..) = child.res {\n                         self.resolve_doc_links_extern_inner(def_id); // Inner attribute scope\n                     }\n-                    // Traits are processed in `add_extern_traits_in_scope`.\n+                    // `DefKind::Trait`s are processed in `process_extern_impls`.\n                     if let Res::Def(DefKind::Mod | DefKind::Enum, ..) = child.res {\n                         self.process_module_children_or_reexports(def_id);\n                     }\n+                    if let Res::Def(DefKind::Struct | DefKind::Union | DefKind::Variant, _) =\n+                        child.res\n+                    {\n+                        let field_def_ids = Vec::from_iter(\n+                            self.resolver\n+                                .cstore()\n+                                .associated_item_def_ids_untracked(def_id, self.sess),\n+                        );\n+                        for field_def_id in field_def_ids {\n+                            self.resolve_doc_links_extern_outer(field_def_id, scope_id);\n+                        }\n+                    }\n                 }\n             }\n         }"}, {"sha": "e18404e44306e56e709bea357120b92281a53e3b", "filename": "src/test/rustdoc-ui/intra-doc/assoc-field.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/6d590ba9426f60459c66d19f73b52f774e23e308/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Fassoc-field.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d590ba9426f60459c66d19f73b52f774e23e308/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Fassoc-field.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Fassoc-field.rs?ref=6d590ba9426f60459c66d19f73b52f774e23e308", "patch": "@@ -0,0 +1,26 @@\n+// Traits in scope are collected for doc links in field attributes.\n+\n+// check-pass\n+// aux-build: assoc-field-dep.rs\n+\n+extern crate assoc_field_dep;\n+pub use assoc_field_dep::*;\n+\n+#[derive(Clone)]\n+pub struct Struct;\n+\n+pub mod mod1 {\n+    pub struct Fields {\n+        /// [crate::Struct::clone]\n+        pub field: u8,\n+    }\n+}\n+\n+pub mod mod2 {\n+    pub enum Fields {\n+        V {\n+            /// [crate::Struct::clone]\n+            field: u8,\n+        },\n+    }\n+}"}, {"sha": "cfb24fc2c665c04166b5fe998db5256d6a06451f", "filename": "src/test/rustdoc-ui/intra-doc/auxiliary/assoc-field-dep.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/6d590ba9426f60459c66d19f73b52f774e23e308/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Fauxiliary%2Fassoc-field-dep.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6d590ba9426f60459c66d19f73b52f774e23e308/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Fauxiliary%2Fassoc-field-dep.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Fauxiliary%2Fassoc-field-dep.rs?ref=6d590ba9426f60459c66d19f73b52f774e23e308", "patch": "@@ -0,0 +1,18 @@\n+#[derive(Clone)]\n+pub struct Struct;\n+\n+pub mod dep_mod1 {\n+    pub struct Fields {\n+        /// [crate::Struct::clone]\n+        pub field: u8,\n+    }\n+}\n+\n+pub mod dep_mod2 {\n+    pub enum Fields {\n+        V {\n+            /// [crate::Struct::clone]\n+            field: u8,\n+        },\n+    }\n+}"}]}