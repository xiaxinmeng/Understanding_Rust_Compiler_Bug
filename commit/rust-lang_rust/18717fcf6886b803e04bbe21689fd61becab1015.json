{"sha": "18717fcf6886b803e04bbe21689fd61becab1015", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE4NzE3ZmNmNjg4NmI4MDNlMDRiYmUyMTY4OWZkNjFiZWNhYjEwMTU=", "commit": {"author": {"name": "Jonas Hietala", "email": "tradet.h@gmail.com", "date": "2014-07-18T16:34:49Z"}, "committer": {"name": "Jonas Hietala", "email": "tradet.h@gmail.com", "date": "2014-07-18T17:25:46Z"}, "message": "Correct plural of arguments in format_args!", "tree": {"sha": "99b341f42cdb989fa2dd88b3c71908a34ef4ffa1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/99b341f42cdb989fa2dd88b3c71908a34ef4ffa1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/18717fcf6886b803e04bbe21689fd61becab1015", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/18717fcf6886b803e04bbe21689fd61becab1015", "html_url": "https://github.com/rust-lang/rust/commit/18717fcf6886b803e04bbe21689fd61becab1015", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/18717fcf6886b803e04bbe21689fd61becab1015/comments", "author": {"login": "treeman", "id": 162027, "node_id": "MDQ6VXNlcjE2MjAyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/162027?v=4", "gravatar_id": "", "url": "https://api.github.com/users/treeman", "html_url": "https://github.com/treeman", "followers_url": "https://api.github.com/users/treeman/followers", "following_url": "https://api.github.com/users/treeman/following{/other_user}", "gists_url": "https://api.github.com/users/treeman/gists{/gist_id}", "starred_url": "https://api.github.com/users/treeman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/treeman/subscriptions", "organizations_url": "https://api.github.com/users/treeman/orgs", "repos_url": "https://api.github.com/users/treeman/repos", "events_url": "https://api.github.com/users/treeman/events{/privacy}", "received_events_url": "https://api.github.com/users/treeman/received_events", "type": "User", "site_admin": false}, "committer": {"login": "treeman", "id": 162027, "node_id": "MDQ6VXNlcjE2MjAyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/162027?v=4", "gravatar_id": "", "url": "https://api.github.com/users/treeman", "html_url": "https://github.com/treeman", "followers_url": "https://api.github.com/users/treeman/followers", "following_url": "https://api.github.com/users/treeman/following{/other_user}", "gists_url": "https://api.github.com/users/treeman/gists{/gist_id}", "starred_url": "https://api.github.com/users/treeman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/treeman/subscriptions", "organizations_url": "https://api.github.com/users/treeman/orgs", "repos_url": "https://api.github.com/users/treeman/repos", "events_url": "https://api.github.com/users/treeman/events{/privacy}", "received_events_url": "https://api.github.com/users/treeman/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5ddc7b4a252fbebee5f2ac87ed755139816d6823", "url": "https://api.github.com/repos/rust-lang/rust/commits/5ddc7b4a252fbebee5f2ac87ed755139816d6823", "html_url": "https://github.com/rust-lang/rust/commit/5ddc7b4a252fbebee5f2ac87ed755139816d6823"}], "stats": {"total": 24, "additions": 22, "deletions": 2}, "files": [{"sha": "d629bafe2b16daa75ddf6556b3d170cc42f98045", "filename": "src/libsyntax/ext/format.rs", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/18717fcf6886b803e04bbe21689fd61becab1015/src%2Flibsyntax%2Fext%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/18717fcf6886b803e04bbe21689fd61becab1015/src%2Flibsyntax%2Fext%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fformat.rs?ref=18717fcf6886b803e04bbe21689fd61becab1015", "patch": "@@ -215,12 +215,21 @@ impl<'a, 'b> Context<'a, 'b> {\n         }\n     }\n \n+    fn describe_num_args(&self) -> String {\n+        if self.args.len() == 1 {\n+            \"there is 1 argument\".to_string()\n+        } else {\n+            format!(\"there are {} arguments\", self.args.len())\n+        }\n+    }\n+\n     fn verify_arg_type(&mut self, arg: Position, ty: ArgumentType) {\n         match arg {\n             Exact(arg) => {\n                 if self.args.len() <= arg {\n-                    let msg = format!(\"invalid reference to argument `{}` (there \\\n-                                    are {} arguments)\", arg, self.args.len());\n+                    let msg = format!(\"invalid reference to argument `{}` ({:s})\",\n+                                      arg, self.describe_num_args());\n+\n                     self.ecx.span_err(self.fmtsp, msg.as_slice());\n                     return;\n                 }"}, {"sha": "08df96d74e60e3e0f38d26bc837bfa25a729c6b3", "filename": "src/test/compile-fail/ifmt-bad-arg.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/18717fcf6886b803e04bbe21689fd61becab1015/src%2Ftest%2Fcompile-fail%2Fifmt-bad-arg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/18717fcf6886b803e04bbe21689fd61becab1015/src%2Ftest%2Fcompile-fail%2Fifmt-bad-arg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fifmt-bad-arg.rs?ref=18717fcf6886b803e04bbe21689fd61becab1015", "patch": "@@ -29,6 +29,17 @@ fn main() {\n     format!(\"{foo}\", foo=1, foo=2);    //~ ERROR: duplicate argument\n     format!(\"\", foo=1, 2);             //~ ERROR: positional arguments cannot follow\n \n+    // bad number of arguments, see #15780\n+\n+    format!(\"{0}\");\n+    //^~ ERROR invalid reference to argument `0` (there are 0 arguments)\n+\n+    format!(\"{0} {1}\", 1);\n+    //^~ ERROR invalid reference to argument `1` (there is 1 argument)\n+\n+    format!(\"{0} {1} {2}\", 1, 2);\n+    //^~ ERROR invalid reference to argument `2` (there are 2 arguments)\n+\n     // bad syntax of the format string\n \n     format!(\"{\"); //~ ERROR: expected `}` but string was terminated"}]}