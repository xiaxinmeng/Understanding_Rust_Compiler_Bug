{"sha": "9e3cbbb60a2a00a5fcce8c150c3e8fe5f3209e26", "node_id": "MDY6Q29tbWl0NzI0NzEyOjllM2NiYmI2MGEyYTAwYTVmY2NlOGMxNTBjM2U4ZmU1ZjMyMDllMjY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-05-03T02:01:04Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-05-03T02:01:04Z"}, "message": "Auto merge of #50369 - pftbest:unicode, r=SimonSapin\n\nFix a warning in libcore on 16bit targets.\n\nThis code is assuming that usize >= 32bits, but it is not the case on\n16bit targets. It is producing a warning that can fail the compilation\non MSP430 if deny(warnings) is enabled.\nIt is very unlikely that someone would actually use this code on\na microcontroller, but since unicode was merged into libcore we\nhave to compile it on 16bit targets.\n\nI've tried to make sure that the code stays the same on x86,\nhere is an assembly comparison: https://godbolt.org/g/wFw7dZ\n\nr? @SimonSapin", "tree": {"sha": "d2d26032b5739c7cb14763084c3370a6ee36c26f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d2d26032b5739c7cb14763084c3370a6ee36c26f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9e3cbbb60a2a00a5fcce8c150c3e8fe5f3209e26", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9e3cbbb60a2a00a5fcce8c150c3e8fe5f3209e26", "html_url": "https://github.com/rust-lang/rust/commit/9e3cbbb60a2a00a5fcce8c150c3e8fe5f3209e26", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9e3cbbb60a2a00a5fcce8c150c3e8fe5f3209e26/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8a37c75a3a661385cc607d934c70e86a9eaf5fd7", "url": "https://api.github.com/repos/rust-lang/rust/commits/8a37c75a3a661385cc607d934c70e86a9eaf5fd7", "html_url": "https://github.com/rust-lang/rust/commit/8a37c75a3a661385cc607d934c70e86a9eaf5fd7"}, {"sha": "f29e62aadf9efa961b3da9d960fb35f748aed0d5", "url": "https://api.github.com/repos/rust-lang/rust/commits/f29e62aadf9efa961b3da9d960fb35f748aed0d5", "html_url": "https://github.com/rust-lang/rust/commit/f29e62aadf9efa961b3da9d960fb35f748aed0d5"}], "stats": {"total": 16, "additions": 8, "deletions": 8}, "files": [{"sha": "0e6437fded594c3a18a8a5a5ed6b0fc474026ab3", "filename": "src/libcore/unicode/bool_trie.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/9e3cbbb60a2a00a5fcce8c150c3e8fe5f3209e26/src%2Flibcore%2Funicode%2Fbool_trie.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e3cbbb60a2a00a5fcce8c150c3e8fe5f3209e26/src%2Flibcore%2Funicode%2Fbool_trie.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Funicode%2Fbool_trie.rs?ref=9e3cbbb60a2a00a5fcce8c150c3e8fe5f3209e26", "patch": "@@ -42,15 +42,15 @@ pub struct BoolTrie {\n }\n impl BoolTrie {\n     pub fn lookup(&self, c: char) -> bool {\n-        let c = c as usize;\n+        let c = c as u32;\n         if c < 0x800 {\n-            trie_range_leaf(c, self.r1[c >> 6])\n+            trie_range_leaf(c, self.r1[(c >> 6) as usize])\n         } else if c < 0x10000 {\n-            let child = self.r2[(c >> 6) - 0x20];\n+            let child = self.r2[(c >> 6) as usize - 0x20];\n             trie_range_leaf(c, self.r3[child as usize])\n         } else {\n-            let child = self.r4[(c >> 12) - 0x10];\n-            let leaf = self.r5[((child as usize) << 6) + ((c >> 6) & 0x3f)];\n+            let child = self.r4[(c >> 12) as usize - 0x10];\n+            let leaf = self.r5[((child as usize) << 6) + ((c >> 6) as usize & 0x3f)];\n             trie_range_leaf(c, self.r6[leaf as usize])\n         }\n     }\n@@ -63,14 +63,14 @@ pub struct SmallBoolTrie {\n \n impl SmallBoolTrie {\n     pub fn lookup(&self, c: char) -> bool {\n-        let c = c as usize;\n-        match self.r1.get(c >> 6) {\n+        let c = c as u32;\n+        match self.r1.get((c >> 6) as usize) {\n             Some(&child) => trie_range_leaf(c, self.r2[child as usize]),\n             None => false,\n         }\n     }\n }\n \n-fn trie_range_leaf(c: usize, bitmap_chunk: u64) -> bool {\n+fn trie_range_leaf(c: u32, bitmap_chunk: u64) -> bool {\n     ((bitmap_chunk >> (c & 63)) & 1) != 0\n }"}]}