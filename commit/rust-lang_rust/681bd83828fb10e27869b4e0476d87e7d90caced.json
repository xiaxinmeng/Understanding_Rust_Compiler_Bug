{"sha": "681bd83828fb10e27869b4e0476d87e7d90caced", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY4MWJkODM4MjhmYjEwZTI3ODY5YjRlMDQ3NmQ4N2U3ZDkwY2FjZWQ=", "commit": {"author": {"name": "Christian Poveda", "email": "cpovedar@fnal.gov", "date": "2019-06-12T18:08:09Z"}, "committer": {"name": "Christian Poveda", "email": "christianpoveda@protonmail.com", "date": "2019-06-16T07:33:00Z"}, "message": "Change to_ptr by force_ptr", "tree": {"sha": "2971302c437fbe17e4b9c9ad04718676206e8ae6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2971302c437fbe17e4b9c9ad04718676206e8ae6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/681bd83828fb10e27869b4e0476d87e7d90caced", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/681bd83828fb10e27869b4e0476d87e7d90caced", "html_url": "https://github.com/rust-lang/rust/commit/681bd83828fb10e27869b4e0476d87e7d90caced", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/681bd83828fb10e27869b4e0476d87e7d90caced/comments", "author": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3bd1734ea28b837238806dc0970a52c7148112cc", "url": "https://api.github.com/repos/rust-lang/rust/commits/3bd1734ea28b837238806dc0970a52c7148112cc", "html_url": "https://github.com/rust-lang/rust/commit/3bd1734ea28b837238806dc0970a52c7148112cc"}], "stats": {"total": 14, "additions": 7, "deletions": 7}, "files": [{"sha": "fdea9b99da0be2e2862086e121720c3ec757378b", "filename": "src/librustc_mir/interpret/memory.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/681bd83828fb10e27869b4e0476d87e7d90caced/src%2Flibrustc_mir%2Finterpret%2Fmemory.rs", "raw_url": "https://github.com/rust-lang/rust/raw/681bd83828fb10e27869b4e0476d87e7d90caced/src%2Flibrustc_mir%2Finterpret%2Fmemory.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Finterpret%2Fmemory.rs?ref=681bd83828fb10e27869b4e0476d87e7d90caced", "patch": "@@ -627,7 +627,7 @@ impl<'mir, 'tcx, M: Machine<'mir, 'tcx>> Memory<'mir, 'tcx, M> {\n         if size.bytes() == 0 {\n             Ok(&[])\n         } else {\n-            let ptr = ptr.to_ptr()?;\n+            let ptr = self.force_ptr(ptr)?;\n             self.get(ptr.alloc_id)?.get_bytes(self, ptr, size)\n         }\n     }\n@@ -714,8 +714,8 @@ impl<'mir, 'tcx, M: Machine<'mir, 'tcx>> Memory<'mir, 'tcx, M> {\n             // non-NULLness which already happened.\n             return Ok(());\n         }\n-        let src = src.to_ptr()?;\n-        let dest = dest.to_ptr()?;\n+        let src = self.force_ptr(src)?;\n+        let dest = self.force_ptr(dest)?;\n \n         // first copy the relocations to a temporary buffer, because\n         // `get_bytes_mut` will clear the relocations, which is correct,"}, {"sha": "4b1e782ba1a456abba0d24fd46c22c50bd0c7140", "filename": "src/librustc_mir/interpret/operand.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/681bd83828fb10e27869b4e0476d87e7d90caced/src%2Flibrustc_mir%2Finterpret%2Foperand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/681bd83828fb10e27869b4e0476d87e7d90caced/src%2Flibrustc_mir%2Finterpret%2Foperand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Finterpret%2Foperand.rs?ref=681bd83828fb10e27869b4e0476d87e7d90caced", "patch": "@@ -232,7 +232,7 @@ impl<'mir, 'tcx, M: Machine<'mir, 'tcx>> InterpretCx<'mir, 'tcx, M> {\n         }\n \n         // check for integer pointers before alignment to report better errors\n-        let ptr = ptr.to_ptr()?;\n+        let ptr = self.force_ptr(ptr)?;\n         self.memory.check_align(ptr.into(), ptr_align)?;\n         match mplace.layout.abi {\n             layout::Abi::Scalar(..) => {"}, {"sha": "7b8408f8808c057e8c0fe7551038e91868ab74e9", "filename": "src/librustc_mir/interpret/place.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/681bd83828fb10e27869b4e0476d87e7d90caced/src%2Flibrustc_mir%2Finterpret%2Fplace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/681bd83828fb10e27869b4e0476d87e7d90caced/src%2Flibrustc_mir%2Finterpret%2Fplace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Finterpret%2Fplace.rs?ref=681bd83828fb10e27869b4e0476d87e7d90caced", "patch": "@@ -753,7 +753,7 @@ where\n         }\n \n         // check for integer pointers before alignment to report better errors\n-        let ptr = ptr.to_ptr()?;\n+        let ptr = self.force_ptr(ptr)?;\n         self.memory.check_align(ptr.into(), ptr_align)?;\n         let tcx = &*self.tcx;\n         // FIXME: We should check that there are dest.layout.size many bytes available in"}, {"sha": "190f7818ddb037ea67e0c74783cad0458ff730e8", "filename": "src/librustc_mir/interpret/terminator.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/681bd83828fb10e27869b4e0476d87e7d90caced/src%2Flibrustc_mir%2Finterpret%2Fterminator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/681bd83828fb10e27869b4e0476d87e7d90caced/src%2Flibrustc_mir%2Finterpret%2Fterminator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Finterpret%2Fterminator.rs?ref=681bd83828fb10e27869b4e0476d87e7d90caced", "patch": "@@ -79,7 +79,7 @@ impl<'mir, 'tcx, M: Machine<'mir, 'tcx>> InterpretCx<'mir, 'tcx, M> {\n                 let (fn_def, abi) = match func.layout.ty.sty {\n                     ty::FnPtr(sig) => {\n                         let caller_abi = sig.abi();\n-                        let fn_ptr = self.read_scalar(func)?.to_ptr()?;\n+                        let fn_ptr = self.force_ptr(self.read_scalar(func)?.not_undef()?)?;\n                         let instance = self.memory.get_fn(fn_ptr)?;\n                         (instance, caller_abi)\n                     }"}, {"sha": "0ce72721186a1fd65a57757ea495c1a4ad6eda1c", "filename": "src/librustc_mir/interpret/validity.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/681bd83828fb10e27869b4e0476d87e7d90caced/src%2Flibrustc_mir%2Finterpret%2Fvalidity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/681bd83828fb10e27869b4e0476d87e7d90caced/src%2Flibrustc_mir%2Finterpret%2Fvalidity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Finterpret%2Fvalidity.rs?ref=681bd83828fb10e27869b4e0476d87e7d90caced", "patch": "@@ -559,7 +559,7 @@ impl<'rt, 'mir, 'tcx, M: Machine<'mir, 'tcx>> ValueVisitor<'mir, 'tcx, M>\n                 // This is the size in bytes of the whole array.\n                 let size = ty_size * len;\n \n-                let ptr = mplace.ptr.to_ptr()?;\n+                let ptr = self.ecx.force_ptr(mplace.ptr)?;\n \n                 // NOTE: Keep this in sync with the handling of integer and float\n                 // types above, in `visit_primitive`."}]}