{"sha": "ed6c958ee4bf081deec951996ace9c508360c1d9", "node_id": "C_kwDOAAsO6NoAKGVkNmM5NThlZTRiZjA4MWRlZWM5NTE5OTZhY2U5YzUwODM2MGMxZDk", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-04-07T09:50:11Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-04-07T09:50:11Z"}, "message": "Auto merge of #95760 - Dylan-DPC:rollup-uskzggh, r=Dylan-DPC\n\nRollup of 4 pull requests\n\nSuccessful merges:\n\n - #95189 (Stop flagging unexpected inner attributes as outer ones in certain diagnostics)\n - #95752 (Regression test for #82866)\n - #95753 (Correct safety reasoning in `str::make_ascii_{lower,upper}case()`)\n - #95757 (Use gender neutral terms)\n\nFailed merges:\n\nr? `@ghost`\n`@rustbot` modify labels: rollup", "tree": {"sha": "9ea8170c85d8d50b23a67fd890a1cd9f79e6f019", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9ea8170c85d8d50b23a67fd890a1cd9f79e6f019"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ed6c958ee4bf081deec951996ace9c508360c1d9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ed6c958ee4bf081deec951996ace9c508360c1d9", "html_url": "https://github.com/rust-lang/rust/commit/ed6c958ee4bf081deec951996ace9c508360c1d9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ed6c958ee4bf081deec951996ace9c508360c1d9/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f565016eddc3cb812e647d54b06cfe74bdee2900", "url": "https://api.github.com/repos/rust-lang/rust/commits/f565016eddc3cb812e647d54b06cfe74bdee2900", "html_url": "https://github.com/rust-lang/rust/commit/f565016eddc3cb812e647d54b06cfe74bdee2900"}, {"sha": "d907ab87a08d2cd7f21f9ba1deae6a5e4cc732ff", "url": "https://api.github.com/repos/rust-lang/rust/commits/d907ab87a08d2cd7f21f9ba1deae6a5e4cc732ff", "html_url": "https://github.com/rust-lang/rust/commit/d907ab87a08d2cd7f21f9ba1deae6a5e4cc732ff"}], "stats": {"total": 120, "additions": 86, "deletions": 34}, "files": [{"sha": "ece250f61d54f4b710edb29e3f57d6fa99235cbf", "filename": "compiler/rustc_builtin_macros/src/source_util.rs", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/ed6c958ee4bf081deec951996ace9c508360c1d9/compiler%2Frustc_builtin_macros%2Fsrc%2Fsource_util.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed6c958ee4bf081deec951996ace9c508360c1d9/compiler%2Frustc_builtin_macros%2Fsrc%2Fsource_util.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_builtin_macros%2Fsrc%2Fsource_util.rs?ref=ed6c958ee4bf081deec951996ace9c508360c1d9", "patch": "@@ -141,17 +141,20 @@ pub fn expand_include<'cx>(\n \n         fn make_items(mut self: Box<ExpandResult<'a>>) -> Option<SmallVec<[P<ast::Item>; 1]>> {\n             let mut ret = SmallVec::new();\n-            while self.p.token != token::Eof {\n+            loop {\n                 match self.p.parse_item(ForceCollect::No) {\n                     Err(mut err) => {\n                         err.emit();\n                         break;\n                     }\n                     Ok(Some(item)) => ret.push(item),\n                     Ok(None) => {\n-                        let token = pprust::token_to_string(&self.p.token);\n-                        let msg = format!(\"expected item, found `{}`\", token);\n-                        self.p.struct_span_err(self.p.token.span, &msg).emit();\n+                        if self.p.token != token::Eof {\n+                            let token = pprust::token_to_string(&self.p.token);\n+                            let msg = format!(\"expected item, found `{}`\", token);\n+                            self.p.struct_span_err(self.p.token.span, &msg).emit();\n+                        }\n+\n                         break;\n                     }\n                 }"}, {"sha": "604e25a14e6be55f17828f9a26da6603f42f5c2d", "filename": "compiler/rustc_expand/src/mbe/macro_parser.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ed6c958ee4bf081deec951996ace9c508360c1d9/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fmacro_parser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed6c958ee4bf081deec951996ace9c508360c1d9/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fmacro_parser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_expand%2Fsrc%2Fmbe%2Fmacro_parser.rs?ref=ed6c958ee4bf081deec951996ace9c508360c1d9", "patch": "@@ -315,7 +315,7 @@ pub(super) fn count_metavar_decls(matcher: &[TokenTree]) -> usize {\n /// only on the nesting depth of repetitions in the originating token tree it\n /// was derived from.\n ///\n-/// In layman's terms: `NamedMatch` will form a tree representing nested matches of a particular\n+/// In layperson's terms: `NamedMatch` will form a tree representing nested matches of a particular\n /// meta variable. For example, if we are matching the following macro against the following\n /// invocation...\n ///"}, {"sha": "1724bab5caa430f7d64a34ccecf0190d2260c1bb", "filename": "compiler/rustc_parse/src/parser/attr.rs", "status": "modified", "additions": 15, "deletions": 11, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/ed6c958ee4bf081deec951996ace9c508360c1d9/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed6c958ee4bf081deec951996ace9c508360c1d9/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fattr.rs?ref=ed6c958ee4bf081deec951996ace9c508360c1d9", "patch": "@@ -13,7 +13,7 @@ use tracing::debug;\n #[derive(Debug)]\n pub enum InnerAttrPolicy<'a> {\n     Permitted,\n-    Forbidden { reason: &'a str, saw_doc_comment: bool, prev_attr_sp: Option<Span> },\n+    Forbidden { reason: &'a str, saw_doc_comment: bool, prev_outer_attr_sp: Option<Span> },\n }\n \n const DEFAULT_UNEXPECTED_INNER_ATTR_ERR_MSG: &str = \"an inner attribute is not \\\n@@ -22,7 +22,7 @@ const DEFAULT_UNEXPECTED_INNER_ATTR_ERR_MSG: &str = \"an inner attribute is not \\\n pub(super) const DEFAULT_INNER_ATTR_FORBIDDEN: InnerAttrPolicy<'_> = InnerAttrPolicy::Forbidden {\n     reason: DEFAULT_UNEXPECTED_INNER_ATTR_ERR_MSG,\n     saw_doc_comment: false,\n-    prev_attr_sp: None,\n+    prev_outer_attr_sp: None,\n };\n \n enum OuterAttributeType {\n@@ -34,22 +34,24 @@ enum OuterAttributeType {\n impl<'a> Parser<'a> {\n     /// Parses attributes that appear before an item.\n     pub(super) fn parse_outer_attributes(&mut self) -> PResult<'a, AttrWrapper> {\n-        let mut attrs: Vec<ast::Attribute> = Vec::new();\n+        let mut outer_attrs: Vec<ast::Attribute> = Vec::new();\n         let mut just_parsed_doc_comment = false;\n         let start_pos = self.token_cursor.num_next_calls;\n         loop {\n             let attr = if self.check(&token::Pound) {\n+                let prev_outer_attr_sp = outer_attrs.last().map(|attr| attr.span);\n+\n                 let inner_error_reason = if just_parsed_doc_comment {\n                     \"an inner attribute is not permitted following an outer doc comment\"\n-                } else if !attrs.is_empty() {\n+                } else if prev_outer_attr_sp.is_some() {\n                     \"an inner attribute is not permitted following an outer attribute\"\n                 } else {\n                     DEFAULT_UNEXPECTED_INNER_ATTR_ERR_MSG\n                 };\n                 let inner_parse_policy = InnerAttrPolicy::Forbidden {\n                     reason: inner_error_reason,\n                     saw_doc_comment: just_parsed_doc_comment,\n-                    prev_attr_sp: attrs.last().map(|a| a.span),\n+                    prev_outer_attr_sp,\n                 };\n                 just_parsed_doc_comment = false;\n                 Some(self.parse_attribute(inner_parse_policy)?)\n@@ -97,12 +99,14 @@ impl<'a> Parser<'a> {\n             };\n \n             if let Some(attr) = attr {\n-                attrs.push(attr);\n+                if attr.style == ast::AttrStyle::Outer {\n+                    outer_attrs.push(attr);\n+                }\n             } else {\n                 break;\n             }\n         }\n-        Ok(AttrWrapper::new(attrs.into(), start_pos))\n+        Ok(AttrWrapper::new(outer_attrs.into(), start_pos))\n     }\n \n     /// Matches `attribute = # ! [ meta_item ]`.\n@@ -215,15 +219,15 @@ impl<'a> Parser<'a> {\n     }\n \n     pub(super) fn error_on_forbidden_inner_attr(&self, attr_sp: Span, policy: InnerAttrPolicy<'_>) {\n-        if let InnerAttrPolicy::Forbidden { reason, saw_doc_comment, prev_attr_sp } = policy {\n-            let prev_attr_note =\n+        if let InnerAttrPolicy::Forbidden { reason, saw_doc_comment, prev_outer_attr_sp } = policy {\n+            let prev_outer_attr_note =\n                 if saw_doc_comment { \"previous doc comment\" } else { \"previous outer attribute\" };\n \n             let mut diag = self.struct_span_err(attr_sp, reason);\n \n-            if let Some(prev_attr_sp) = prev_attr_sp {\n+            if let Some(prev_outer_attr_sp) = prev_outer_attr_sp {\n                 diag.span_label(attr_sp, \"not permitted following an outer attribute\")\n-                    .span_label(prev_attr_sp, prev_attr_note);\n+                    .span_label(prev_outer_attr_sp, prev_outer_attr_note);\n             }\n \n             diag.note("}, {"sha": "b2be70e707dab235e331d17fe357c505f3ae1154", "filename": "compiler/rustc_typeck/src/check/wfcheck.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ed6c958ee4bf081deec951996ace9c508360c1d9/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fwfcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed6c958ee4bf081deec951996ace9c508360c1d9/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fwfcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fwfcheck.rs?ref=ed6c958ee4bf081deec951996ace9c508360c1d9", "patch": "@@ -1657,7 +1657,7 @@ fn receiver_is_valid<'fcx, 'tcx>(\n             }\n         } else {\n             debug!(\"receiver_is_valid: type `{:?}` does not deref to `{:?}`\", receiver_ty, self_ty);\n-            // If he receiver already has errors reported due to it, consider it valid to avoid\n+            // If the receiver already has errors reported due to it, consider it valid to avoid\n             // unnecessary errors (#58712).\n             return receiver_ty.references_error();\n         }"}, {"sha": "ec783a16ef73fa6fb1cbea3f96961355358703a5", "filename": "compiler/rustc_typeck/src/collect.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ed6c958ee4bf081deec951996ace9c508360c1d9/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed6c958ee4bf081deec951996ace9c508360c1d9/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs?ref=ed6c958ee4bf081deec951996ace9c508360c1d9", "patch": "@@ -2700,7 +2700,7 @@ fn linkage_by_name(tcx: TyCtxt<'_>, def_id: DefId, name: &str) -> Linkage {\n     // Use the names from src/llvm/docs/LangRef.rst here. Most types are only\n     // applicable to variable declarations and may not really make sense for\n     // Rust code in the first place but allow them anyway and trust that the\n-    // user knows what s/he's doing. Who knows, unanticipated use cases may pop\n+    // user knows what they're doing. Who knows, unanticipated use cases may pop\n     // up in the future.\n     //\n     // ghost, dllimport, dllexport and linkonce_odr_autohide are not supported"}, {"sha": "86e1afa288535e8fcb468eb27d006b3a21c485a6", "filename": "library/core/src/str/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ed6c958ee4bf081deec951996ace9c508360c1d9/library%2Fcore%2Fsrc%2Fstr%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed6c958ee4bf081deec951996ace9c508360c1d9/library%2Fcore%2Fsrc%2Fstr%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fstr%2Fmod.rs?ref=ed6c958ee4bf081deec951996ace9c508360c1d9", "patch": "@@ -2406,7 +2406,7 @@ impl str {\n     #[stable(feature = \"ascii_methods_on_intrinsics\", since = \"1.23.0\")]\n     #[inline]\n     pub fn make_ascii_uppercase(&mut self) {\n-        // SAFETY: safe because we transmute two types with the same layout.\n+        // SAFETY: changing ASCII letters only does not invalidate UTF-8.\n         let me = unsafe { self.as_bytes_mut() };\n         me.make_ascii_uppercase()\n     }\n@@ -2433,7 +2433,7 @@ impl str {\n     #[stable(feature = \"ascii_methods_on_intrinsics\", since = \"1.23.0\")]\n     #[inline]\n     pub fn make_ascii_lowercase(&mut self) {\n-        // SAFETY: safe because we transmute two types with the same layout.\n+        // SAFETY: changing ASCII letters only does not invalidate UTF-8.\n         let me = unsafe { self.as_bytes_mut() };\n         me.make_ascii_lowercase()\n     }"}, {"sha": "e8d0132f4b98c57c954c0a67eb9ad6b69b83755b", "filename": "library/std/src/fs/tests.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ed6c958ee4bf081deec951996ace9c508360c1d9/library%2Fstd%2Fsrc%2Ffs%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed6c958ee4bf081deec951996ace9c508360c1d9/library%2Fstd%2Fsrc%2Ffs%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Ffs%2Ftests.rs?ref=ed6c958ee4bf081deec951996ace9c508360c1d9", "patch": "@@ -644,9 +644,9 @@ fn recursive_rmdir_toctou() {\n     // Test for time-of-check to time-of-use issues.\n     //\n     // Scenario:\n-    // The attacker wants to get directory contents deleted, to which he does not have access.\n-    // He has a way to get a privileged Rust binary call `std::fs::remove_dir_all()` on a\n-    // directory he controls, e.g. in his home directory.\n+    // The attacker wants to get directory contents deleted, to which they do not have access.\n+    // They have a way to get a privileged Rust binary call `std::fs::remove_dir_all()` on a\n+    // directory they control, e.g. in their home directory.\n     //\n     // The POC sets up the `attack_dest/attack_file` which the attacker wants to have deleted.\n     // The attacker repeatedly creates a directory and replaces it with a symlink from"}, {"sha": "fc307c5666d630a07639d92a184d7d8fbbd07ae7", "filename": "library/std/src/thread/local.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ed6c958ee4bf081deec951996ace9c508360c1d9/library%2Fstd%2Fsrc%2Fthread%2Flocal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed6c958ee4bf081deec951996ace9c508360c1d9/library%2Fstd%2Fsrc%2Fthread%2Flocal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fthread%2Flocal.rs?ref=ed6c958ee4bf081deec951996ace9c508360c1d9", "patch": "@@ -980,7 +980,7 @@ pub mod fast {\n         unsafe fn try_initialize<F: FnOnce() -> T>(&self, init: F) -> Option<&'static T> {\n             // SAFETY: See comment above (this function doc).\n             if !mem::needs_drop::<T>() || unsafe { self.try_register_dtor() } {\n-                // SAFETY: See comment above (his function doc).\n+                // SAFETY: See comment above (this function doc).\n                 Some(unsafe { self.inner.initialize(init) })\n             } else {\n                 None"}, {"sha": "95cd62261f10975d80933de888bffde161044fd7", "filename": "src/test/ui/match/issue-82866.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/ed6c958ee4bf081deec951996ace9c508360c1d9/src%2Ftest%2Fui%2Fmatch%2Fissue-82866.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed6c958ee4bf081deec951996ace9c508360c1d9/src%2Ftest%2Fui%2Fmatch%2Fissue-82866.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmatch%2Fissue-82866.rs?ref=ed6c958ee4bf081deec951996ace9c508360c1d9", "patch": "@@ -0,0 +1,7 @@\n+fn main() {\n+    match x {\n+        //~^ ERROR cannot find value `x` in this scope\n+        Some::<v>(v) => (),\n+        //~^ ERROR cannot find type `v` in this scope\n+    }\n+}"}, {"sha": "f9e3360a525ff0e778def0e87af883a30cb2873c", "filename": "src/test/ui/match/issue-82866.stderr", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/ed6c958ee4bf081deec951996ace9c508360c1d9/src%2Ftest%2Fui%2Fmatch%2Fissue-82866.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ed6c958ee4bf081deec951996ace9c508360c1d9/src%2Ftest%2Fui%2Fmatch%2Fissue-82866.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmatch%2Fissue-82866.stderr?ref=ed6c958ee4bf081deec951996ace9c508360c1d9", "patch": "@@ -0,0 +1,16 @@\n+error[E0425]: cannot find value `x` in this scope\n+  --> $DIR/issue-82866.rs:2:11\n+   |\n+LL |     match x {\n+   |           ^ not found in this scope\n+\n+error[E0412]: cannot find type `v` in this scope\n+  --> $DIR/issue-82866.rs:4:16\n+   |\n+LL |         Some::<v>(v) => (),\n+   |                ^ not found in this scope\n+\n+error: aborting due to 2 previous errors\n+\n+Some errors have detailed explanations: E0412, E0425.\n+For more information about an error, try `rustc --explain E0412`."}, {"sha": "42b2dfde85577e4beacf75be3b8ddf2887a129b1", "filename": "src/test/ui/parser/attr.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ed6c958ee4bf081deec951996ace9c508360c1d9/src%2Ftest%2Fui%2Fparser%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed6c958ee4bf081deec951996ace9c508360c1d9/src%2Ftest%2Fui%2Fparser%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fattr.rs?ref=ed6c958ee4bf081deec951996ace9c508360c1d9", "patch": "@@ -3,5 +3,4 @@\n fn main() {}\n \n #![lang = \"foo\"] //~ ERROR an inner attribute is not permitted in this context\n-                 //~| ERROR definition of an unknown language item: `foo`\n fn foo() {}"}, {"sha": "3527274bd0f8c954f79f05de405f4bb6059cdda1", "filename": "src/test/ui/parser/attr.stderr", "status": "modified", "additions": 1, "deletions": 9, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ed6c958ee4bf081deec951996ace9c508360c1d9/src%2Ftest%2Fui%2Fparser%2Fattr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ed6c958ee4bf081deec951996ace9c508360c1d9/src%2Ftest%2Fui%2Fparser%2Fattr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fattr.stderr?ref=ed6c958ee4bf081deec951996ace9c508360c1d9", "patch": "@@ -3,7 +3,6 @@ error: an inner attribute is not permitted in this context\n    |\n LL | #![lang = \"foo\"]\n    | ^^^^^^^^^^^^^^^^\n-LL |\n LL | fn foo() {}\n    | ----------- the inner attribute doesn't annotate this function\n    |\n@@ -14,12 +13,5 @@ LL - #![lang = \"foo\"]\n LL + #[lang = \"foo\"]\n    | \n \n-error[E0522]: definition of an unknown language item: `foo`\n-  --> $DIR/attr.rs:5:1\n-   |\n-LL | #![lang = \"foo\"]\n-   | ^^^^^^^^^^^^^^^^ definition of unknown language item `foo`\n-\n-error: aborting due to 2 previous errors\n+error: aborting due to previous error\n \n-For more information about this error, try `rustc --explain E0522`."}, {"sha": "9429e514339cf5deb38393ca14d549e70978eb2f", "filename": "src/test/ui/parser/issues/auxiliary/issue-94340-inc.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/ed6c958ee4bf081deec951996ace9c508360c1d9/src%2Ftest%2Fui%2Fparser%2Fissues%2Fauxiliary%2Fissue-94340-inc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed6c958ee4bf081deec951996ace9c508360c1d9/src%2Ftest%2Fui%2Fparser%2Fissues%2Fauxiliary%2Fissue-94340-inc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissues%2Fauxiliary%2Fissue-94340-inc.rs?ref=ed6c958ee4bf081deec951996ace9c508360c1d9", "patch": "@@ -0,0 +1,3 @@\n+// include file for issue-94340.rs\n+#![deny(rust_2018_idioms)]\n+#![deny(unused_must_use)]"}, {"sha": "d0fb84a689a33a6449c8dc7f7d5f1870bfeee3ad", "filename": "src/test/ui/parser/issues/issue-94340.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ed6c958ee4bf081deec951996ace9c508360c1d9/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-94340.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed6c958ee4bf081deec951996ace9c508360c1d9/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-94340.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-94340.rs?ref=ed6c958ee4bf081deec951996ace9c508360c1d9", "patch": "@@ -0,0 +1,8 @@\n+// Make sure that unexpected inner attributes are not labeled as outer ones in diagnostics when\n+// trying to parse an item and that they are subsequently ignored not triggering confusing extra\n+// diagnostics like \"expected item after attributes\" which is not true for `include!` which can\n+// include empty files.\n+\n+include!(\"auxiliary/issue-94340-inc.rs\");\n+\n+fn main() {}"}, {"sha": "9fd7c38a80b77baa627f95375613d5c3d879207c", "filename": "src/test/ui/parser/issues/issue-94340.stderr", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/ed6c958ee4bf081deec951996ace9c508360c1d9/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-94340.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ed6c958ee4bf081deec951996ace9c508360c1d9/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-94340.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissues%2Fissue-94340.stderr?ref=ed6c958ee4bf081deec951996ace9c508360c1d9", "patch": "@@ -0,0 +1,20 @@\n+error: an inner attribute is not permitted in this context\n+  --> $DIR/auxiliary/issue-94340-inc.rs:2:1\n+   |\n+LL | #![deny(rust_2018_idioms)]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: inner attributes, like `#![no_std]`, annotate the item enclosing them, and are usually found at the beginning of source files\n+   = note: outer attributes, like `#[test]`, annotate the item following them\n+\n+error: an inner attribute is not permitted in this context\n+  --> $DIR/auxiliary/issue-94340-inc.rs:3:1\n+   |\n+LL | #![deny(unused_must_use)]\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: inner attributes, like `#![no_std]`, annotate the item enclosing them, and are usually found at the beginning of source files\n+   = note: outer attributes, like `#[test]`, annotate the item following them\n+\n+error: aborting due to 2 previous errors\n+"}]}