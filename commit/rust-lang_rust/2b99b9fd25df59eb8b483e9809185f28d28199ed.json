{"sha": "2b99b9fd25df59eb8b483e9809185f28d28199ed", "node_id": "C_kwDOAAsO6NoAKDJiOTliOWZkMjVkZjU5ZWI4YjQ4M2U5ODA5MTg1ZjI4ZDI4MTk5ZWQ", "commit": {"author": {"name": "Kyle Huey", "email": "khuey@kylehuey.com", "date": "2023-01-15T17:40:46Z"}, "committer": {"name": "Kyle Huey", "email": "khuey@kylehuey.com", "date": "2023-01-15T17:40:46Z"}, "message": "Preserve split DWARF files when building archives.\n\nThe optimization that removes artifacts when building libraries is correct\nfrom the compiler's perspective but not from a debugger's perspective.\nUnpacked split debuginfo is referred to by filename and debuggers need\nthe artifact that contains debuginfo to continue to exist at that path.\n\nIronically the test expects the correct behavior but it was not running.", "tree": {"sha": "c204a950a3063fddaa2c4e9da94e3a1f91ba9d67", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c204a950a3063fddaa2c4e9da94e3a1f91ba9d67"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2b99b9fd25df59eb8b483e9809185f28d28199ed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2b99b9fd25df59eb8b483e9809185f28d28199ed", "html_url": "https://github.com/rust-lang/rust/commit/2b99b9fd25df59eb8b483e9809185f28d28199ed", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2b99b9fd25df59eb8b483e9809185f28d28199ed/comments", "author": {"login": "khuey", "id": 325892, "node_id": "MDQ6VXNlcjMyNTg5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/325892?v=4", "gravatar_id": "", "url": "https://api.github.com/users/khuey", "html_url": "https://github.com/khuey", "followers_url": "https://api.github.com/users/khuey/followers", "following_url": "https://api.github.com/users/khuey/following{/other_user}", "gists_url": "https://api.github.com/users/khuey/gists{/gist_id}", "starred_url": "https://api.github.com/users/khuey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/khuey/subscriptions", "organizations_url": "https://api.github.com/users/khuey/orgs", "repos_url": "https://api.github.com/users/khuey/repos", "events_url": "https://api.github.com/users/khuey/events{/privacy}", "received_events_url": "https://api.github.com/users/khuey/received_events", "type": "User", "site_admin": false}, "committer": {"login": "khuey", "id": 325892, "node_id": "MDQ6VXNlcjMyNTg5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/325892?v=4", "gravatar_id": "", "url": "https://api.github.com/users/khuey", "html_url": "https://github.com/khuey", "followers_url": "https://api.github.com/users/khuey/followers", "following_url": "https://api.github.com/users/khuey/following{/other_user}", "gists_url": "https://api.github.com/users/khuey/gists{/gist_id}", "starred_url": "https://api.github.com/users/khuey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/khuey/subscriptions", "organizations_url": "https://api.github.com/users/khuey/orgs", "repos_url": "https://api.github.com/users/khuey/repos", "events_url": "https://api.github.com/users/khuey/events{/privacy}", "received_events_url": "https://api.github.com/users/khuey/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "754f6d4a8cf1963a3446b20b20fd10f42df1ee41", "url": "https://api.github.com/repos/rust-lang/rust/commits/754f6d4a8cf1963a3446b20b20fd10f42df1ee41", "html_url": "https://github.com/rust-lang/rust/commit/754f6d4a8cf1963a3446b20b20fd10f42df1ee41"}], "stats": {"total": 22, "additions": 2, "deletions": 20}, "files": [{"sha": "5715bcf1f11d59541f0ef609ec1a2adc4e9e65a5", "filename": "compiler/rustc_codegen_ssa/src/back/link.rs", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2b99b9fd25df59eb8b483e9809185f28d28199ed/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2b99b9fd25df59eb8b483e9809185f28d28199ed/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs?ref=2b99b9fd25df59eb8b483e9809185f28d28199ed", "patch": "@@ -1300,12 +1300,6 @@ fn preserve_objects_for_their_debuginfo(sess: &Session) -> (bool, bool) {\n         return (false, false);\n     }\n \n-    // If we're only producing artifacts that are archives, no need to preserve\n-    // the objects as they're losslessly contained inside the archives.\n-    if sess.crate_types().iter().all(|&x| x.is_archive()) {\n-        return (false, false);\n-    }\n-\n     match (sess.split_debuginfo(), sess.opts.unstable_opts.split_dwarf_kind) {\n         // If there is no split debuginfo then do not preserve objects.\n         (SplitDebuginfo::Off, _) => (false, false),"}, {"sha": "46ae9b56a48f9680fe792ee288ba84b6f222d369", "filename": "compiler/rustc_session/src/config.rs", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/2b99b9fd25df59eb8b483e9809185f28d28199ed/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2b99b9fd25df59eb8b483e9809185f28d28199ed/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Fconfig.rs?ref=2b99b9fd25df59eb8b483e9809185f28d28199ed", "patch": "@@ -846,18 +846,6 @@ pub enum CrateType {\n     ProcMacro,\n }\n \n-impl CrateType {\n-    /// When generated, is this crate type an archive?\n-    pub fn is_archive(&self) -> bool {\n-        match *self {\n-            CrateType::Rlib | CrateType::Staticlib => true,\n-            CrateType::Executable | CrateType::Dylib | CrateType::Cdylib | CrateType::ProcMacro => {\n-                false\n-            }\n-        }\n-    }\n-}\n-\n #[derive(Clone, Hash, Debug, PartialEq, Eq)]\n pub enum Passes {\n     Some(Vec<String>),"}, {"sha": "44cda0d3d117f8bfec9ff71bea889ee811153ba2", "filename": "tests/run-make-fulldeps/split-debuginfo/Makefile", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2b99b9fd25df59eb8b483e9809185f28d28199ed/tests%2Frun-make-fulldeps%2Fsplit-debuginfo%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/2b99b9fd25df59eb8b483e9809185f28d28199ed/tests%2Frun-make-fulldeps%2Fsplit-debuginfo%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-make-fulldeps%2Fsplit-debuginfo%2FMakefile?ref=2b99b9fd25df59eb8b483e9809185f28d28199ed", "patch": "@@ -254,12 +254,12 @@ unpacked-remapped-single:\n \t$(RUSTC) $(UNSTABLEOPTS) -C split-debuginfo=unpacked -C debuginfo=2 \\\n \t\t-Z split-dwarf-kind=single --remap-path-prefix $(TMPDIR)=/a foo.rs -g\n \tobjdump -Wi $(TMPDIR)/foo | grep DW_AT_GNU_dwo_name | (! grep $(TMPDIR)) || exit 1\n-\tls $(TMPDIR)/*.o\n+\trm $(TMPDIR)/*.o\n \tls $(TMPDIR)/*.dwo && exit 1 || exit 0\n \tls $(TMPDIR)/*.dwp && exit 1 || exit 0\n \trm $(TMPDIR)/$(call BIN,foo)\n \n-unpacked-crosscrate: packed-crosscrate-split packed-crosscrate-single\n+unpacked-crosscrate: unpacked-crosscrate-split unpacked-crosscrate-single\n \n # - Debuginfo in `.dwo` files\n # - (bar) `.rlib` file created, contains `.dwo`"}]}