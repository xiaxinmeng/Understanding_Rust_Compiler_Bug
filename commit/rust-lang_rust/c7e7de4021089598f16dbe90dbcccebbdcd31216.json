{"sha": "c7e7de4021089598f16dbe90dbcccebbdcd31216", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM3ZTdkZTQwMjEwODk1OThmMTZkYmU5MGRiY2NjZWJiZGNkMzEyMTY=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-05-10T18:05:25Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-05-10T18:05:25Z"}, "message": "Rollup merge of #85118 - GuillaumeGomez:clipboard-svg, r=Nemo157\n\nUse an SVG image for clipboard instead of unicode character\n\nLinked to https://github.com/rust-lang/docs.rs/pull/1394.\n\ncc `@jsha`\nr? `@Nemo157`", "tree": {"sha": "7d5628f79b1d1d5ac4fdfd3ec9c0d8fe8f4162fd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7d5628f79b1d1d5ac4fdfd3ec9c0d8fe8f4162fd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c7e7de4021089598f16dbe90dbcccebbdcd31216", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgmXXmCRBK7hj4Ov3rIwAA/EoIACFxTrFUKyMvLBb5Gu6/aGh9\nYo2Sjt1VnUOg3R9gXeDjWtFHnnSlaKYH+c83Tyop5bxSi/Eh+mepeXwCs8sMSd1+\noQYRHaRhm83kapJi3NwBMazjxATIKbnqZnF0IKV7to7+Ennip9snNPkUSYKdwOz1\n2X7cZqR5H0BWpafuF3PyU6ZGmRNav1GONy0l8jYHDHR031Q3c+kMrUpPa/F1gGXS\nNWA1uqwCMjP8+jvUKMccottghDS0SR8ii6+8Tpe5sRGUwFNP2Ub2Gie5uycIb/5g\nTyRu187GhkOQsEDIBrHKv/VOYkRp8CJYmTP2eAPw5RVTedD8iHsr+RkIJekS5Cc=\n=Z5Ie\n-----END PGP SIGNATURE-----\n", "payload": "tree 7d5628f79b1d1d5ac4fdfd3ec9c0d8fe8f4162fd\nparent 205a0d3a27ed0a8772a192602821c36438e31703\nparent 7450f70ae2fecdbf36152815addc7c3af3a6c022\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1620669925 +0200\ncommitter GitHub <noreply@github.com> 1620669925 +0200\n\nRollup merge of #85118 - GuillaumeGomez:clipboard-svg, r=Nemo157\n\nUse an SVG image for clipboard instead of unicode character\n\nLinked to https://github.com/rust-lang/docs.rs/pull/1394.\n\ncc `@jsha`\nr? `@Nemo157`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c7e7de4021089598f16dbe90dbcccebbdcd31216", "html_url": "https://github.com/rust-lang/rust/commit/c7e7de4021089598f16dbe90dbcccebbdcd31216", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c7e7de4021089598f16dbe90dbcccebbdcd31216/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "205a0d3a27ed0a8772a192602821c36438e31703", "url": "https://api.github.com/repos/rust-lang/rust/commits/205a0d3a27ed0a8772a192602821c36438e31703", "html_url": "https://github.com/rust-lang/rust/commit/205a0d3a27ed0a8772a192602821c36438e31703"}, {"sha": "7450f70ae2fecdbf36152815addc7c3af3a6c022", "url": "https://api.github.com/repos/rust-lang/rust/commits/7450f70ae2fecdbf36152815addc7c3af3a6c022", "html_url": "https://github.com/rust-lang/rust/commit/7450f70ae2fecdbf36152815addc7c3af3a6c022"}], "stats": {"total": 60, "additions": 49, "deletions": 11}, "files": [{"sha": "99e96fdcf1eb4e91404e7d65b6ba30f91c59f515", "filename": "src/librustdoc/html/layout.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Flayout.rs?ref=c7e7de4021089598f16dbe90dbcccebbdcd31216", "patch": "@@ -34,14 +34,20 @@ crate struct Page<'a> {\n     crate static_extra_scripts: &'a [&'a str],\n }\n \n+impl<'a> Page<'a> {\n+    crate fn get_static_root_path(&self) -> &str {\n+        self.static_root_path.unwrap_or(self.root_path)\n+    }\n+}\n+\n crate fn render<T: Print, S: Print>(\n     layout: &Layout,\n     page: &Page<'_>,\n     sidebar: S,\n     t: T,\n     style_files: &[StylePath],\n ) -> String {\n-    let static_root_path = page.static_root_path.unwrap_or(page.root_path);\n+    let static_root_path = page.get_static_root_path();\n     format!(\n         \"<!DOCTYPE html>\\\n <html lang=\\\"en\\\">\\"}, {"sha": "4e17dc8d3a7d0121f2b9d8f3be38699c0912807d", "filename": "src/librustdoc/html/render/context.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs?ref=c7e7de4021089598f16dbe90dbcccebbdcd31216", "patch": "@@ -215,7 +215,7 @@ impl<'tcx> Context<'tcx> {\n                 &self.shared.layout,\n                 &page,\n                 |buf: &mut _| print_sidebar(self, it, buf),\n-                |buf: &mut _| print_item(self, it, buf),\n+                |buf: &mut _| print_item(self, it, buf, &page),\n                 &self.shared.style_files,\n             )\n         } else {"}, {"sha": "a08a340e3a999a72559dc03ee5cac9bcd4572126", "filename": "src/librustdoc/html/render/print_item.rs", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs?ref=c7e7de4021089598f16dbe90dbcccebbdcd31216", "patch": "@@ -22,9 +22,10 @@ use crate::formats::{AssocItemRender, Impl, RenderMode};\n use crate::html::escape::Escape;\n use crate::html::format::{print_abi_with_space, print_where_clause, Buffer, PrintWithSpace};\n use crate::html::highlight;\n+use crate::html::layout::Page;\n use crate::html::markdown::MarkdownSummaryLine;\n \n-pub(super) fn print_item(cx: &Context<'_>, item: &clean::Item, buf: &mut Buffer) {\n+pub(super) fn print_item(cx: &Context<'_>, item: &clean::Item, buf: &mut Buffer, page: &Page<'_>) {\n     debug_assert!(!item.is_stripped());\n     // Write the breadcrumb trail header for the top\n     buf.write_str(\"<h1 class=\\\"fqn\\\"><span class=\\\"in-band\\\">\");\n@@ -74,7 +75,16 @@ pub(super) fn print_item(cx: &Context<'_>, item: &clean::Item, buf: &mut Buffer)\n         }\n     }\n     write!(buf, \"<a class=\\\"{}\\\" href=\\\"\\\">{}</a>\", item.type_(), item.name.as_ref().unwrap());\n-    write!(buf, \"<button id=\\\"copy-path\\\" onclick=\\\"copy_path(this)\\\">\u2398</button>\");\n+    write!(\n+        buf,\n+        \"<button id=\\\"copy-path\\\" onclick=\\\"copy_path(this)\\\">\\\n+            <img src=\\\"{static_root_path}clipboard{suffix}.svg\\\" \\\n+                width=\\\"19\\\" height=\\\"18\\\" \\\n+                alt=\\\"Copy item import\\\">\\\n+         </button>\",\n+        static_root_path = page.get_static_root_path(),\n+        suffix = page.resource_suffix,\n+    );\n \n     buf.write_str(\"</span>\"); // in-band\n     buf.write_str(\"<span class=\\\"out-of-band\\\">\");"}, {"sha": "d0518cb6862fe3987e4015712bf510e1a6c8a397", "filename": "src/librustdoc/html/render/write_shared.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Frender%2Fwrite_shared.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Frender%2Fwrite_shared.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fwrite_shared.rs?ref=c7e7de4021089598f16dbe90dbcccebbdcd31216", "patch": "@@ -207,6 +207,7 @@ pub(super) fn write_shared(\n     }\n     write_toolchain(\"brush.svg\", static_files::BRUSH_SVG)?;\n     write_toolchain(\"wheel.svg\", static_files::WHEEL_SVG)?;\n+    write_toolchain(\"clipboard.svg\", static_files::CLIPBOARD_SVG)?;\n     write_toolchain(\"down-arrow.svg\", static_files::DOWN_ARROW_SVG)?;\n \n     let mut themes: Vec<&String> = themes.iter().collect();"}, {"sha": "8adbd99630488f9a325a99362aa59c9b235ac737", "filename": "src/librustdoc/html/static/clipboard.svg", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fclipboard.svg", "raw_url": "https://github.com/rust-lang/rust/raw/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fclipboard.svg", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fclipboard.svg?ref=c7e7de4021089598f16dbe90dbcccebbdcd31216", "patch": "@@ -0,0 +1 @@\n+<svg width=\"24\" height=\"25\" viewBox=\"0 0 24 25\" xmlns=\"http://www.w3.org/2000/svg\" aria-label=\"Copy to clipboard\"><path d=\"M18 20h2v3c0 1-1 2-2 2H2c-.998 0-2-1-2-2V5c0-.911.755-1.667 1.667-1.667h5A3.323 3.323 0 0110 0a3.323 3.323 0 013.333 3.333h5C19.245 3.333 20 4.09 20 5v8.333h-2V9H2v14h16v-3zM3 7h14c0-.911-.793-1.667-1.75-1.667H13.5c-.957 0-1.75-.755-1.75-1.666C11.75 2.755 10.957 2 10 2s-1.75.755-1.75 1.667c0 .911-.793 1.666-1.75 1.666H4.75C3.793 5.333 3 6.09 3 7z\"/><path d=\"M4 19h6v2H4zM12 11H4v2h8zM4 17h4v-2H4zM15 15v-3l-4.5 4.5L15 21v-3l8.027-.032L23 15z\"/></svg>"}, {"sha": "dc65e14ab37b83cee273fb8b41710b66e1da45f6", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 18, "deletions": 2, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=c7e7de4021089598f16dbe90dbcccebbdcd31216", "patch": "@@ -1252,15 +1252,31 @@ function hideThemeButtonState() {\n         document.execCommand('copy');\n         document.body.removeChild(el);\n \n-        but.textContent = '\u2713';\n+        // There is always one children, but multiple childNodes.\n+        but.children[0].style.display = 'none';\n+\n+        var tmp;\n+        if (but.childNodes.length < 2) {\n+            tmp = document.createTextNode('\u2713');\n+            but.appendChild(tmp);\n+        } else {\n+            onEachLazy(but.childNodes, function(e) {\n+                if (e.nodeType === Node.TEXT_NODE) {\n+                    tmp = e;\n+                    return true;\n+                }\n+            });\n+            tmp.textContent = '\u2713';\n+        }\n \n         if (reset_button_timeout !== null) {\n             window.clearTimeout(reset_button_timeout);\n         }\n \n         function reset_button() {\n-            but.textContent = '\u2398';\n+            tmp.textContent = '';\n             reset_button_timeout = null;\n+            but.children[0].style.display = \"\";\n         }\n \n         reset_button_timeout = window.setTimeout(reset_button, 1000);"}, {"sha": "9e776f83c8d1b62654894eac71d4c8c88673ec39", "filename": "src/librustdoc/html/static/rustdoc.css", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css?ref=c7e7de4021089598f16dbe90dbcccebbdcd31216", "patch": "@@ -1321,11 +1321,12 @@ h4 > .notable-traits {\n }\n \n #copy-path {\n-\theight: 30px;\n-\tfont-size: 18px;\n \tmargin-left: 10px;\n-\tpadding: 0 6px;\n-\twidth: 28px;\n+\tpadding: 0;\n+\tpadding-left: 2px;\n+}\n+#copy-path> img {\n+\tmargin-bottom: 2px;\n }\n \n #theme-choices {"}, {"sha": "63d42264f76cf95a71f63833614cca2c84f52827", "filename": "src/librustdoc/html/static/themes/ayu.css", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fayu.css", "raw_url": "https://github.com/rust-lang/rust/raw/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fayu.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fthemes%2Fayu.css?ref=c7e7de4021089598f16dbe90dbcccebbdcd31216", "patch": "@@ -509,7 +509,7 @@ kbd {\n \tcolor: #fff;\n }\n \n-#theme-picker > img, #settings-menu > img {\n+#theme-picker > img, #settings-menu > img, #copy-path > img {\n \tfilter: invert(100);\n }\n "}, {"sha": "1abb1f7294a18f9eb04898cee963e22f6074003d", "filename": "src/librustdoc/html/static_files.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Fstatic_files.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7e7de4021089598f16dbe90dbcccebbdcd31216/src%2Flibrustdoc%2Fhtml%2Fstatic_files.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic_files.rs?ref=c7e7de4021089598f16dbe90dbcccebbdcd31216", "patch": "@@ -41,6 +41,9 @@ crate static BRUSH_SVG: &[u8] = include_bytes!(\"static/brush.svg\");\n /// The file contents of `wheel.svg`, the icon used for the settings button.\n crate static WHEEL_SVG: &[u8] = include_bytes!(\"static/wheel.svg\");\n \n+/// The file contents of `clipboard.svg`, the icon used for the \"copy path\" button.\n+crate static CLIPBOARD_SVG: &[u8] = include_bytes!(\"static/clipboard.svg\");\n+\n /// The file contents of `down-arrow.svg`, the icon used for the crate choice combobox.\n crate static DOWN_ARROW_SVG: &[u8] = include_bytes!(\"static/down-arrow.svg\");\n "}]}