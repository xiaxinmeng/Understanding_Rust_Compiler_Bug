{"sha": "77a8e60dd7285423815002a747ce24602936f59b", "node_id": "C_kwDOAAsO6NoAKDc3YThlNjBkZDcyODU0MjM4MTUwMDJhNzQ3Y2UyNDYwMjkzNmY1OWI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-02-24T06:48:04Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-02-24T06:48:04Z"}, "message": "Rollup merge of #89887 - arlosi:char-debug, r=wesleywiser\n\nChange `char` type in debuginfo to DW_ATE_UTF\n\nRust previously encoded the `char` type as DW_ATE_unsigned_char. The more appropriate encoding is `DW_ATE_UTF`.\n\nClang also uses the DW_ATE_UTF for `char32_t` in C++.\n\nThis fixes the display of the `char` type in the Windows debuggers. Without this change, the variable did not show in the locals window.\n![image](https://user-images.githubusercontent.com/704597/137368067-9b3e4dc8-a075-44ba-a687-bf3810a44e5a.png)\n\nLLDB 13 is also able to display the char value, when before it failed with `need to add support for DW_TAG_base_type 'char' encoded with DW_ATE = 0x8, bit_size = 32`\n\nr? `@wesleywiser`", "tree": {"sha": "7ed35c936798446ac900c90d70c4de7abf15fad2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7ed35c936798446ac900c90d70c4de7abf15fad2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/77a8e60dd7285423815002a747ce24602936f59b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiFyokCRBK7hj4Ov3rIwAAAQ0IAG7oF1r6tYeMsx6lbt+AlZ3O\n0rqQlfd8EqmTfFK9nRutqGtOykV5ADt4bhEdpVJyxqMuZXlztVL72EQAZFliz+TM\nfC06tGVsZOtxZwFWa/FHF4XJnij83qsBa9hEAMs75hioYpm8agCFPcRETRXnI80Q\nDQWeBQc0bodQZ9t5YMW755PX9yUA5Q9Zk3ONkh5TNg4BknwCi3pUXNFX+H665OEQ\nasw+AtLnW6c8g+JH0GmMHUBB01Qk+z8iSze8xc/0kuA6Cd7nvSagLKUld2YhsbUH\nX2TzJBC8mkvOleUAdXvVkzqvBxWMvfjOpWj6o9EwxEaVBucn5dmuWrG7N2SX/jk=\n=FuvH\n-----END PGP SIGNATURE-----\n", "payload": "tree 7ed35c936798446ac900c90d70c4de7abf15fad2\nparent e780264e1e5c1efa6ab76c7b17a9677f16add5e0\nparent be454f056fc7637da6d1922c532d73831dc072db\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1645685284 +0100\ncommitter GitHub <noreply@github.com> 1645685284 +0100\n\nRollup merge of #89887 - arlosi:char-debug, r=wesleywiser\n\nChange `char` type in debuginfo to DW_ATE_UTF\n\nRust previously encoded the `char` type as DW_ATE_unsigned_char. The more appropriate encoding is `DW_ATE_UTF`.\n\nClang also uses the DW_ATE_UTF for `char32_t` in C++.\n\nThis fixes the display of the `char` type in the Windows debuggers. Without this change, the variable did not show in the locals window.\n![image](https://user-images.githubusercontent.com/704597/137368067-9b3e4dc8-a075-44ba-a687-bf3810a44e5a.png)\n\nLLDB 13 is also able to display the char value, when before it failed with `need to add support for DW_TAG_base_type 'char' encoded with DW_ATE = 0x8, bit_size = 32`\n\nr? `@wesleywiser`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/77a8e60dd7285423815002a747ce24602936f59b", "html_url": "https://github.com/rust-lang/rust/commit/77a8e60dd7285423815002a747ce24602936f59b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/77a8e60dd7285423815002a747ce24602936f59b/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e780264e1e5c1efa6ab76c7b17a9677f16add5e0", "url": "https://api.github.com/repos/rust-lang/rust/commits/e780264e1e5c1efa6ab76c7b17a9677f16add5e0", "html_url": "https://github.com/rust-lang/rust/commit/e780264e1e5c1efa6ab76c7b17a9677f16add5e0"}, {"sha": "be454f056fc7637da6d1922c532d73831dc072db", "url": "https://api.github.com/repos/rust-lang/rust/commits/be454f056fc7637da6d1922c532d73831dc072db", "html_url": "https://github.com/rust-lang/rust/commit/be454f056fc7637da6d1922c532d73831dc072db"}], "stats": {"total": 13, "additions": 6, "deletions": 7}, "files": [{"sha": "4ca92b3efe098fc167698b59f2d7c5c0b04128fc", "filename": "compiler/rustc_codegen_llvm/src/debuginfo/metadata.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/77a8e60dd7285423815002a747ce24602936f59b/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77a8e60dd7285423815002a747ce24602936f59b/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fdebuginfo%2Fmetadata.rs?ref=77a8e60dd7285423815002a747ce24602936f59b", "patch": "@@ -87,7 +87,7 @@ const DW_ATE_signed: c_uint = 0x05;\n #[allow(non_upper_case_globals)]\n const DW_ATE_unsigned: c_uint = 0x07;\n #[allow(non_upper_case_globals)]\n-const DW_ATE_unsigned_char: c_uint = 0x08;\n+const DW_ATE_UTF: c_uint = 0x10;\n \n pub const UNKNOWN_LINE_NUMBER: c_uint = 0;\n pub const UNKNOWN_COLUMN_NUMBER: c_uint = 0;\n@@ -933,7 +933,7 @@ fn basic_type_metadata<'ll, 'tcx>(cx: &CodegenCx<'ll, 'tcx>, t: Ty<'tcx>) -> &'l\n         ty::Never => (\"!\", DW_ATE_unsigned),\n         ty::Tuple(elements) if elements.is_empty() => (\"()\", DW_ATE_unsigned),\n         ty::Bool => (\"bool\", DW_ATE_boolean),\n-        ty::Char => (\"char\", DW_ATE_unsigned_char),\n+        ty::Char => (\"char\", DW_ATE_UTF),\n         ty::Int(int_ty) if cpp_like_debuginfo => (int_ty.msvc_basic_name(), DW_ATE_signed),\n         ty::Uint(uint_ty) if cpp_like_debuginfo => (uint_ty.msvc_basic_name(), DW_ATE_unsigned),\n         ty::Float(float_ty) if cpp_like_debuginfo => (float_ty.msvc_basic_name(), DW_ATE_float),"}, {"sha": "07d33be2a071f29904ce79662fcf49e740769dd3", "filename": "src/test/debuginfo/basic-types.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/77a8e60dd7285423815002a747ce24602936f59b/src%2Ftest%2Fdebuginfo%2Fbasic-types.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77a8e60dd7285423815002a747ce24602936f59b/src%2Ftest%2Fdebuginfo%2Fbasic-types.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fbasic-types.rs?ref=77a8e60dd7285423815002a747ce24602936f59b", "patch": "@@ -104,7 +104,8 @@\n // cdb-check:b                : false [Type: bool]\n // cdb-command:dx i\n // cdb-check:i                : -1 [Type: [...]]\n-// The variable 'c' doesn't appear for some reason...\n+// cdb-command:dx c\n+// cdb-check:c                : 0x61 'a' [Type: char32_t]\n // cdb-command:dx i8\n // cdb-check:i8               : 68 [Type: char]\n // cdb-command:dx i16"}, {"sha": "b4bb7c146d9df20acde2dcf6fd463823d8d0b046", "filename": "src/test/debuginfo/borrowed-basic.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/77a8e60dd7285423815002a747ce24602936f59b/src%2Ftest%2Fdebuginfo%2Fborrowed-basic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77a8e60dd7285423815002a747ce24602936f59b/src%2Ftest%2Fdebuginfo%2Fborrowed-basic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fborrowed-basic.rs?ref=77a8e60dd7285423815002a747ce24602936f59b", "patch": "@@ -14,8 +14,7 @@\n // gdb-check:$2 = -1\n \n // gdb-command:print *char_ref\n-// gdbg-check:$3 = 97\n-// gdbr-check:$3 = 97 'a'\n+// gdb-check:$3 = 97\n \n // gdb-command:print *i8_ref\n // gdbg-check:$4 = 68 'D'"}, {"sha": "f38cbc10dd3acf8ca94194cf9a0d62c8cf4d4a6f", "filename": "src/test/debuginfo/borrowed-unique-basic.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/77a8e60dd7285423815002a747ce24602936f59b/src%2Ftest%2Fdebuginfo%2Fborrowed-unique-basic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77a8e60dd7285423815002a747ce24602936f59b/src%2Ftest%2Fdebuginfo%2Fborrowed-unique-basic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Fborrowed-unique-basic.rs?ref=77a8e60dd7285423815002a747ce24602936f59b", "patch": "@@ -16,8 +16,7 @@\n // gdb-check:$2 = -1\n \n // gdb-command:print *char_ref\n-// gdbg-check:$3 = 97\n-// gdbr-check:$3 = 97 'a'\n+// gdb-check:$3 = 97\n \n // gdb-command:print/d *i8_ref\n // gdb-check:$4 = 68"}]}