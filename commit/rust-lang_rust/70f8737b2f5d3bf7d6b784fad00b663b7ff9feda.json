{"sha": "70f8737b2f5d3bf7d6b784fad00b663b7ff9feda", "node_id": "C_kwDOAAsO6NoAKDcwZjg3MzdiMmY1ZDNiZjdkNmI3ODRmYWQwMGI2NjNiN2ZmOWZlZGE", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-11-23T19:52:43Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-11-23T19:52:43Z"}, "message": "Auto merge of #104410 - WaffleLapkin:unregress, r=estebank\n\nFix perf regression by correctly matching keywords\n\nThis should (hopefully) fix regression from #99918\n\nr? `@estebank`", "tree": {"sha": "86976d729b0d3bb9a879e89b6ca26c3f7865ef64", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/86976d729b0d3bb9a879e89b6ca26c3f7865ef64"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/70f8737b2f5d3bf7d6b784fad00b663b7ff9feda", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/70f8737b2f5d3bf7d6b784fad00b663b7ff9feda", "html_url": "https://github.com/rust-lang/rust/commit/70f8737b2f5d3bf7d6b784fad00b663b7ff9feda", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/70f8737b2f5d3bf7d6b784fad00b663b7ff9feda/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d121aa3b5584eb919a4aaf64dbae0ea1e8e30231", "url": "https://api.github.com/repos/rust-lang/rust/commits/d121aa3b5584eb919a4aaf64dbae0ea1e8e30231", "html_url": "https://github.com/rust-lang/rust/commit/d121aa3b5584eb919a4aaf64dbae0ea1e8e30231"}, {"sha": "e2a28165a336aacd3f6227fa5bddcddb8cd7bf94", "url": "https://api.github.com/repos/rust-lang/rust/commits/e2a28165a336aacd3f6227fa5bddcddb8cd7bf94", "html_url": "https://github.com/rust-lang/rust/commit/e2a28165a336aacd3f6227fa5bddcddb8cd7bf94"}], "stats": {"total": 32, "additions": 22, "deletions": 10}, "files": [{"sha": "767fb9378bef1795c386db908821b7f20e9cdf7d", "filename": "compiler/rustc_parse/src/parser/item.rs", "status": "modified", "additions": 21, "deletions": 9, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/70f8737b2f5d3bf7d6b784fad00b663b7ff9feda/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/70f8737b2f5d3bf7d6b784fad00b663b7ff9feda/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs?ref=70f8737b2f5d3bf7d6b784fad00b663b7ff9feda", "patch": "@@ -222,7 +222,8 @@ impl<'a> Parser<'a> {\n             self.parse_use_item()?\n         } else if self.check_fn_front_matter(def_final, case) {\n             // FUNCTION ITEM\n-            let (ident, sig, generics, body) = self.parse_fn(attrs, fn_parse_mode, lo, vis)?;\n+            let (ident, sig, generics, body) =\n+                self.parse_fn(attrs, fn_parse_mode, lo, vis, case)?;\n             (ident, ItemKind::Fn(Box::new(Fn { defaultness: def_(), sig, generics, body })))\n         } else if self.eat_keyword(kw::Extern) {\n             if self.eat_keyword(kw::Crate) {\n@@ -1793,7 +1794,13 @@ impl<'a> Parser<'a> {\n                 };\n                 // We use `parse_fn` to get a span for the function\n                 let fn_parse_mode = FnParseMode { req_name: |_| true, req_body: true };\n-                match self.parse_fn(&mut AttrVec::new(), fn_parse_mode, lo, &inherited_vis) {\n+                match self.parse_fn(\n+                    &mut AttrVec::new(),\n+                    fn_parse_mode,\n+                    lo,\n+                    &inherited_vis,\n+                    Case::Insensitive,\n+                ) {\n                     Ok(_) => {\n                         let mut err = self.struct_span_err(\n                             lo.to(self.prev_token.span),\n@@ -2114,8 +2121,9 @@ impl<'a> Parser<'a> {\n         fn_parse_mode: FnParseMode,\n         sig_lo: Span,\n         vis: &Visibility,\n+        case: Case,\n     ) -> PResult<'a, (Ident, FnSig, Generics, Option<P<Block>>)> {\n-        let header = self.parse_fn_front_matter(vis)?; // `const ... fn`\n+        let header = self.parse_fn_front_matter(vis, case)?; // `const ... fn`\n         let ident = self.parse_ident()?; // `foo`\n         let mut generics = self.parse_generics()?; // `<'a, T, ...>`\n         let decl =\n@@ -2239,24 +2247,28 @@ impl<'a> Parser<'a> {\n     ///\n     /// `vis` represents the visibility that was already parsed, if any. Use\n     /// `Visibility::Inherited` when no visibility is known.\n-    pub(super) fn parse_fn_front_matter(&mut self, orig_vis: &Visibility) -> PResult<'a, FnHeader> {\n+    pub(super) fn parse_fn_front_matter(\n+        &mut self,\n+        orig_vis: &Visibility,\n+        case: Case,\n+    ) -> PResult<'a, FnHeader> {\n         let sp_start = self.token.span;\n-        let constness = self.parse_constness(Case::Insensitive);\n+        let constness = self.parse_constness(case);\n \n         let async_start_sp = self.token.span;\n-        let asyncness = self.parse_asyncness(Case::Insensitive);\n+        let asyncness = self.parse_asyncness(case);\n \n         let unsafe_start_sp = self.token.span;\n-        let unsafety = self.parse_unsafety(Case::Insensitive);\n+        let unsafety = self.parse_unsafety(case);\n \n         let ext_start_sp = self.token.span;\n-        let ext = self.parse_extern(Case::Insensitive);\n+        let ext = self.parse_extern(case);\n \n         if let Async::Yes { span, .. } = asyncness {\n             self.ban_async_in_2015(span);\n         }\n \n-        if !self.eat_keyword_case(kw::Fn, Case::Insensitive) {\n+        if !self.eat_keyword_case(kw::Fn, case) {\n             // It is possible for `expect_one_of` to recover given the contents of\n             // `self.expected_tokens`, therefore, do not use `self.unexpected()` which doesn't\n             // account for this."}, {"sha": "b7206b57642fcfaca4bc55feb3fafe2ae727f438", "filename": "compiler/rustc_parse/src/parser/ty.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/70f8737b2f5d3bf7d6b784fad00b663b7ff9feda/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/70f8737b2f5d3bf7d6b784fad00b663b7ff9feda/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fty.rs?ref=70f8737b2f5d3bf7d6b784fad00b663b7ff9feda", "patch": "@@ -536,7 +536,7 @@ impl<'a> Parser<'a> {\n         };\n         let span_start = self.token.span;\n         let ast::FnHeader { ext, unsafety, constness, asyncness } =\n-            self.parse_fn_front_matter(&inherited_vis)?;\n+            self.parse_fn_front_matter(&inherited_vis, Case::Sensitive)?;\n         if self.may_recover() && self.token.kind == TokenKind::Lt {\n             self.recover_fn_ptr_with_generics(lo, &mut params, param_insertion_point)?;\n         }"}]}