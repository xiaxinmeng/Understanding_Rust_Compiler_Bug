{"sha": "87d01d11e17e497b3ec43559cbeee3ad704603ee", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg3ZDAxZDExZTE3ZTQ5N2IzZWM0MzU1OWNiZWVlM2FkNzA0NjAzZWU=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2020-07-17T21:09:22Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-07-17T21:09:22Z"}, "message": "Rollup merge of #74411 - jonas-schievink:unbreak-mir, r=matthewjasper\n\nDon't assign `()` to `!` MIR locals\n\nImplements the fix described in https://github.com/rust-lang/rust/issues/73860#issuecomment-651731893.\n\nFixes https://github.com/rust-lang/rust/issues/73860\n\nr? @matthewjasper", "tree": {"sha": "b63befeb92c5078c4d1bb6be6fb3ca7d98fdfd73", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b63befeb92c5078c4d1bb6be6fb3ca7d98fdfd73"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/87d01d11e17e497b3ec43559cbeee3ad704603ee", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfEhOCCRBK7hj4Ov3rIwAAdHIIAJB2MR/Ju9T3FBgxRrhdiCcu\nhi30JQPn3NKbwwYU6BbSSjQF36N595VO3HPHFkX/hO3DxWZKUOseYFKbyopGFu51\nviV6hjq+VrW4pK8z/0aF+Xm/ybH/NOOn/TpyDAMeAsaCu1q5JPtjAhs/bt7ndXiU\nHPzAD2ByO4WpCFKjFoZLJ8lpL6lpRiKdmBEGIZsM0mOTHogE+S/GZlAucFRqkK8H\n4jxcVvvw6EBv9tUWf4i5RYomS8WWM/FuUbJ0/AsZ/hyxMyD1JxhqPi38Am+WC03t\nBTZCSEQD1vp+I70/qkQ8u6OkpcFmYNhzdMIcVnk4unPLaVMZUkr3JSlYKV+gSTg=\n=zDFb\n-----END PGP SIGNATURE-----\n", "payload": "tree b63befeb92c5078c4d1bb6be6fb3ca7d98fdfd73\nparent 105cd4b21eaef2e68227eb5b58c910de574af0cd\nparent 209991f8b29698f0dba9baa5e31d501bc7931229\nauthor Manish Goregaokar <manishsmail@gmail.com> 1595020162 -0700\ncommitter GitHub <noreply@github.com> 1595020162 -0700\n\nRollup merge of #74411 - jonas-schievink:unbreak-mir, r=matthewjasper\n\nDon't assign `()` to `!` MIR locals\n\nImplements the fix described in https://github.com/rust-lang/rust/issues/73860#issuecomment-651731893.\n\nFixes https://github.com/rust-lang/rust/issues/73860\n\nr? @matthewjasper\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/87d01d11e17e497b3ec43559cbeee3ad704603ee", "html_url": "https://github.com/rust-lang/rust/commit/87d01d11e17e497b3ec43559cbeee3ad704603ee", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/87d01d11e17e497b3ec43559cbeee3ad704603ee/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "105cd4b21eaef2e68227eb5b58c910de574af0cd", "url": "https://api.github.com/repos/rust-lang/rust/commits/105cd4b21eaef2e68227eb5b58c910de574af0cd", "html_url": "https://github.com/rust-lang/rust/commit/105cd4b21eaef2e68227eb5b58c910de574af0cd"}, {"sha": "209991f8b29698f0dba9baa5e31d501bc7931229", "url": "https://api.github.com/repos/rust-lang/rust/commits/209991f8b29698f0dba9baa5e31d501bc7931229", "html_url": "https://github.com/rust-lang/rust/commit/209991f8b29698f0dba9baa5e31d501bc7931229"}], "stats": {"total": 27, "additions": 11, "deletions": 16}, "files": [{"sha": "eaef6bb37faa591a40ee9b4e4bafbeabe52eb474", "filename": "src/librustc_mir_build/build/expr/into.rs", "status": "modified", "additions": 11, "deletions": 9, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/87d01d11e17e497b3ec43559cbeee3ad704603ee/src%2Flibrustc_mir_build%2Fbuild%2Fexpr%2Finto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87d01d11e17e497b3ec43559cbeee3ad704603ee/src%2Flibrustc_mir_build%2Fbuild%2Fexpr%2Finto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir_build%2Fbuild%2Fexpr%2Finto.rs?ref=87d01d11e17e497b3ec43559cbeee3ad704603ee", "patch": "@@ -188,10 +188,9 @@ impl<'a, 'tcx> Builder<'a, 'tcx> {\n                     let ptr_ty = ptr.ty;\n                     // Create an *internal* temp for the pointer, so that unsafety\n                     // checking won't complain about the raw pointer assignment.\n-                    let ptr_temp = this.local_decls.push(LocalDecl::with_source_info(\n-                        ptr_ty,\n-                        source_info,\n-                    ).internal());\n+                    let ptr_temp = this\n+                        .local_decls\n+                        .push(LocalDecl::with_source_info(ptr_ty, source_info).internal());\n                     let ptr_temp = Place::from(ptr_temp);\n                     let block = unpack!(this.into(ptr_temp, block, ptr));\n                     this.into(this.hir.tcx().mk_place_deref(ptr_temp), block, val)\n@@ -224,7 +223,7 @@ impl<'a, 'tcx> Builder<'a, 'tcx> {\n                                 Some((destination, success))\n                             },\n                             from_hir_call,\n-                            fn_span\n+                            fn_span,\n                         },\n                     );\n                     success.unit()\n@@ -387,15 +386,18 @@ impl<'a, 'tcx> Builder<'a, 'tcx> {\n             // These cases don't actually need a destination\n             ExprKind::Assign { .. }\n             | ExprKind::AssignOp { .. }\n-            | ExprKind::Continue { .. }\n-            | ExprKind::Break { .. }\n-            | ExprKind::LlvmInlineAsm { .. }\n-            | ExprKind::Return { .. } => {\n+            | ExprKind::LlvmInlineAsm { .. } => {\n                 unpack!(block = this.stmt_expr(block, expr, None));\n                 this.cfg.push_assign_unit(block, source_info, destination, this.hir.tcx());\n                 block.unit()\n             }\n \n+            ExprKind::Continue { .. } | ExprKind::Break { .. } | ExprKind::Return { .. } => {\n+                unpack!(block = this.stmt_expr(block, expr, None));\n+                // No assign, as these have type `!`.\n+                block.unit()\n+            }\n+\n             // Avoid creating a temporary\n             ExprKind::VarRef { .. }\n             | ExprKind::SelfRef"}, {"sha": "918dc5ec38701789962880be5ce27c1919b049c6", "filename": "src/test/mir-opt/issue-49232/rustc.main.mir_map.0.mir", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/87d01d11e17e497b3ec43559cbeee3ad704603ee/src%2Ftest%2Fmir-opt%2Fissue-49232%2Frustc.main.mir_map.0.mir", "raw_url": "https://github.com/rust-lang/rust/raw/87d01d11e17e497b3ec43559cbeee3ad704603ee/src%2Ftest%2Fmir-opt%2Fissue-49232%2Frustc.main.mir_map.0.mir", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fissue-49232%2Frustc.main.mir_map.0.mir?ref=87d01d11e17e497b3ec43559cbeee3ad704603ee", "patch": "@@ -79,13 +79,6 @@ fn main() -> () {\n     }\n \n     bb10: {\n-        _4 = const ();                   // scope 0 at $DIR/issue-49232.rs:10:25: 10:30\n-                                         // ty::Const\n-                                         // + ty: ()\n-                                         // + val: Value(Scalar(<ZST>))\n-                                         // mir::Constant\n-                                         // + span: $DIR/issue-49232.rs:10:25: 10:30\n-                                         // + literal: Const { ty: (), val: Value(Scalar(<ZST>)) }\n         unreachable;                     // scope 0 at $DIR/issue-49232.rs:10:25: 10:30\n     }\n "}]}