{"sha": "04fdb44f5ccb6f909cf0f768781afa483e97097c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA0ZmRiNDRmNWNjYjZmOTA5Y2YwZjc2ODc4MWFmYTQ4M2U5NzA5N2M=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-11-03T20:13:47Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-11-03T20:13:47Z"}, "message": "Auto merge of #55661 - kennytm:fix-exclude, r=alexcrichton\n\nFixed the bug in bootstrap where --exclude was ignored for run-pass test\n\nThis should fix the 3 hour timeout on AppVeyor which happened a lot recently.\n\nAdditionally, further rebalanced the AppVeyor subsets by moving \"ui\" and \"linkchecker\" into Set 2.", "tree": {"sha": "43eba9bd21bb59d8fa9e6ccf86ea7b3c2ec12ddc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/43eba9bd21bb59d8fa9e6ccf86ea7b3c2ec12ddc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/04fdb44f5ccb6f909cf0f768781afa483e97097c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/04fdb44f5ccb6f909cf0f768781afa483e97097c", "html_url": "https://github.com/rust-lang/rust/commit/04fdb44f5ccb6f909cf0f768781afa483e97097c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/04fdb44f5ccb6f909cf0f768781afa483e97097c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a3f0f5107e48d47936a604325a1af325033901d0", "url": "https://api.github.com/repos/rust-lang/rust/commits/a3f0f5107e48d47936a604325a1af325033901d0", "html_url": "https://github.com/rust-lang/rust/commit/a3f0f5107e48d47936a604325a1af325033901d0"}, {"sha": "2bde4e7c057d7ebfd5902ef4e2d4c9f460d99b17", "url": "https://api.github.com/repos/rust-lang/rust/commits/2bde4e7c057d7ebfd5902ef4e2d4c9f460d99b17", "html_url": "https://github.com/rust-lang/rust/commit/2bde4e7c057d7ebfd5902ef4e2d4c9f460d99b17"}], "stats": {"total": 46, "additions": 43, "deletions": 3}, "files": [{"sha": "900f336ef8cdc1dd06f8c9bc1dd42c7f225ecf6e", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 32, "deletions": 2, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/04fdb44f5ccb6f909cf0f768781afa483e97097c/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04fdb44f5ccb6f909cf0f768781afa483e97097c/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=04fdb44f5ccb6f909cf0f768781afa483e97097c", "patch": "@@ -130,7 +130,7 @@ impl PathSet {\n     fn has(&self, needle: &Path) -> bool {\n         match self {\n             PathSet::Set(set) => set.iter().any(|p| p.ends_with(needle)),\n-            PathSet::Suite(_) => false,\n+            PathSet::Suite(suite) => suite.ends_with(needle),\n         }\n     }\n \n@@ -1849,7 +1849,7 @@ mod __test {\n         );\n \n         // Ensure we don't build any compiler artifacts.\n-        assert!(builder.cache.all::<compile::Rustc>().is_empty());\n+        assert!(!builder.cache.contains::<compile::Rustc>());\n         assert_eq!(\n             first(builder.cache.all::<test::Crate>()),\n             &[test::Crate {\n@@ -1861,4 +1861,34 @@ mod __test {\n             },]\n         );\n     }\n+\n+    #[test]\n+    fn test_exclude() {\n+        let mut config = configure(&[], &[]);\n+        config.exclude = vec![\n+            \"src/test/run-pass\".into(),\n+            \"src/tools/tidy\".into(),\n+        ];\n+        config.cmd = Subcommand::Test {\n+            paths: Vec::new(),\n+            test_args: Vec::new(),\n+            rustc_args: Vec::new(),\n+            fail_fast: true,\n+            doc_tests: DocTests::No,\n+            bless: false,\n+            compare_mode: None,\n+        };\n+\n+        let build = Build::new(config);\n+        let builder = Builder::new(&build);\n+        builder.run_step_descriptions(&Builder::get_step_descriptions(Kind::Test), &[]);\n+\n+        // Ensure we have really excluded run-pass & tidy\n+        assert!(!builder.cache.contains::<test::RunPass>());\n+        assert!(!builder.cache.contains::<test::Tidy>());\n+\n+        // Ensure other tests are not affected.\n+        assert!(builder.cache.contains::<test::RunPassFullDeps>());\n+        assert!(builder.cache.contains::<test::RustdocUi>());\n+    }\n }"}, {"sha": "0b561a3523f2b483460d8549b75f4913d7a6bcd0", "filename": "src/bootstrap/cache.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/04fdb44f5ccb6f909cf0f768781afa483e97097c/src%2Fbootstrap%2Fcache.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04fdb44f5ccb6f909cf0f768781afa483e97097c/src%2Fbootstrap%2Fcache.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcache.rs?ref=04fdb44f5ccb6f909cf0f768781afa483e97097c", "patch": "@@ -286,4 +286,9 @@ impl Cache {\n         v.sort_by_key(|&(a, _)| a);\n         v\n     }\n+\n+    #[cfg(test)]\n+    pub fn contains<S: Step>(&self) -> bool {\n+        self.0.borrow().contains_key(&TypeId::of::<S>())\n+    }\n }"}, {"sha": "862fbbf1f286bce28a9d4e65415e3e7b3aeceed0", "filename": "src/bootstrap/mk/Makefile.in", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/04fdb44f5ccb6f909cf0f768781afa483e97097c/src%2Fbootstrap%2Fmk%2FMakefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/04fdb44f5ccb6f909cf0f768781afa483e97097c/src%2Fbootstrap%2Fmk%2FMakefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fmk%2FMakefile.in?ref=04fdb44f5ccb6f909cf0f768781afa483e97097c", "patch": "@@ -85,7 +85,12 @@ check-stage2-T-arm-linux-androideabi-H-x86_64-unknown-linux-gnu:\n check-stage2-T-x86_64-unknown-linux-musl-H-x86_64-unknown-linux-gnu:\n \t$(Q)$(BOOTSTRAP) test --target x86_64-unknown-linux-musl\n \n-TESTS_IN_2 := src/test/run-pass src/test/compile-fail src/test/run-pass-fulldeps\n+TESTS_IN_2 := \\\n+\tsrc/test/ui \\\n+\tsrc/test/run-pass \\\n+\tsrc/test/compile-fail \\\n+\tsrc/test/run-pass-fulldeps \\\n+\tsrc/tools/linkchecker\n \n appveyor-subset-1:\n \t$(Q)$(BOOTSTRAP) test $(TESTS_IN_2:%=--exclude %)"}]}