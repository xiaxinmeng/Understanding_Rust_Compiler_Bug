{"sha": "503c03c5584bb697071f3585953ed6e5b16d2e10", "node_id": "C_kwDOAAsO6NoAKDUwM2MwM2M1NTg0YmI2OTcwNzFmMzU4NTk1M2VkNmU1YjE2ZDJlMTA", "commit": {"author": {"name": "Daniel Macovei", "email": "djmacovei@gmail.com", "date": "2022-08-02T17:06:22Z"}, "committer": {"name": "Daniel Macovei", "email": "djmacovei@gmail.com", "date": "2022-08-02T17:06:22Z"}, "message": "clean up", "tree": {"sha": "5b9705da257dc7b2035ca0915236e2fc36e5bf20", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5b9705da257dc7b2035ca0915236e2fc36e5bf20"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/503c03c5584bb697071f3585953ed6e5b16d2e10", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/503c03c5584bb697071f3585953ed6e5b16d2e10", "html_url": "https://github.com/rust-lang/rust/commit/503c03c5584bb697071f3585953ed6e5b16d2e10", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/503c03c5584bb697071f3585953ed6e5b16d2e10/comments", "author": {"login": "macovedj", "id": 20097860, "node_id": "MDQ6VXNlcjIwMDk3ODYw", "avatar_url": "https://avatars.githubusercontent.com/u/20097860?v=4", "gravatar_id": "", "url": "https://api.github.com/users/macovedj", "html_url": "https://github.com/macovedj", "followers_url": "https://api.github.com/users/macovedj/followers", "following_url": "https://api.github.com/users/macovedj/following{/other_user}", "gists_url": "https://api.github.com/users/macovedj/gists{/gist_id}", "starred_url": "https://api.github.com/users/macovedj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/macovedj/subscriptions", "organizations_url": "https://api.github.com/users/macovedj/orgs", "repos_url": "https://api.github.com/users/macovedj/repos", "events_url": "https://api.github.com/users/macovedj/events{/privacy}", "received_events_url": "https://api.github.com/users/macovedj/received_events", "type": "User", "site_admin": false}, "committer": {"login": "macovedj", "id": 20097860, "node_id": "MDQ6VXNlcjIwMDk3ODYw", "avatar_url": "https://avatars.githubusercontent.com/u/20097860?v=4", "gravatar_id": "", "url": "https://api.github.com/users/macovedj", "html_url": "https://github.com/macovedj", "followers_url": "https://api.github.com/users/macovedj/followers", "following_url": "https://api.github.com/users/macovedj/following{/other_user}", "gists_url": "https://api.github.com/users/macovedj/gists{/gist_id}", "starred_url": "https://api.github.com/users/macovedj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/macovedj/subscriptions", "organizations_url": "https://api.github.com/users/macovedj/orgs", "repos_url": "https://api.github.com/users/macovedj/repos", "events_url": "https://api.github.com/users/macovedj/events{/privacy}", "received_events_url": "https://api.github.com/users/macovedj/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "145ebb1cd723e34dc5a940ec3e498de814e6293d", "url": "https://api.github.com/repos/rust-lang/rust/commits/145ebb1cd723e34dc5a940ec3e498de814e6293d", "html_url": "https://github.com/rust-lang/rust/commit/145ebb1cd723e34dc5a940ec3e498de814e6293d"}], "stats": {"total": 19, "additions": 11, "deletions": 8}, "files": [{"sha": "60e1355f9b92d889036ae7b2c67e4d510e4305c0", "filename": "clippy_lints/src/methods/clone_on_copy.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/503c03c5584bb697071f3585953ed6e5b16d2e10/clippy_lints%2Fsrc%2Fmethods%2Fclone_on_copy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/503c03c5584bb697071f3585953ed6e5b16d2e10/clippy_lints%2Fsrc%2Fmethods%2Fclone_on_copy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fclone_on_copy.rs?ref=503c03c5584bb697071f3585953ed6e5b16d2e10", "patch": "@@ -86,10 +86,11 @@ pub(super) fn check(cx: &LateContext<'_>, expr: &Expr<'_>, method_name: Symbol,\n                 {\n                     return;\n                 },\n-                ExprKind::Call(hir_callee, _) => match hir_callee.kind {\n-                    ExprKind::Path(QPath::LangItem(rustc_hir::LangItem::TryTraitBranch, _, _)) => true,\n-                    _ => false,\n-                },\n+                // ? is a Call, makes sure not to rec *x?, but rather (*x)?\n+                ExprKind::Call(hir_callee, _) => matches!(\n+                    hir_callee.kind,\n+                    ExprKind::Path(QPath::LangItem(rustc_hir::LangItem::TryTraitBranch, _, _))\n+                ),\n                 ExprKind::MethodCall(_, [self_arg, ..], _) if expr.hir_id == self_arg.hir_id => true,\n                 ExprKind::Match(_, _, MatchSource::TryDesugar | MatchSource::AwaitDesugar)\n                 | ExprKind::Field(..)"}, {"sha": "72b1222709819447cd8a4589f6e9c92a7dbc546a", "filename": "tests/ui/clone_on_copy.fixed", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/503c03c5584bb697071f3585953ed6e5b16d2e10/tests%2Fui%2Fclone_on_copy.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/503c03c5584bb697071f3585953ed6e5b16d2e10/tests%2Fui%2Fclone_on_copy.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fclone_on_copy.fixed?ref=503c03c5584bb697071f3585953ed6e5b16d2e10", "patch": "@@ -72,7 +72,8 @@ fn clone_on_copy() -> Option<(i32)> {\n     let mut vec = Vec::new();\n     vec.push(42);\n \n+    //  Issue #9277\n     let opt: &Option<i32> = &None;\n-    let value = (*opt)?;\n+    let value = (*opt)?; // operator precedence needed (*opt)?\n     None\n }"}, {"sha": "03e210ebad98c302819ab8b8ed9c5426fa9a6a34", "filename": "tests/ui/clone_on_copy.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/503c03c5584bb697071f3585953ed6e5b16d2e10/tests%2Fui%2Fclone_on_copy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/503c03c5584bb697071f3585953ed6e5b16d2e10/tests%2Fui%2Fclone_on_copy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fclone_on_copy.rs?ref=503c03c5584bb697071f3585953ed6e5b16d2e10", "patch": "@@ -72,7 +72,8 @@ fn clone_on_copy() -> Option<(i32)> {\n     let mut vec = Vec::new();\n     vec.push(42.clone());\n \n+    //  Issue #9277\n     let opt: &Option<i32> = &None;\n-    let value = opt.clone()?;\n+    let value = opt.clone()?; // operator precedence needed (*opt)?\n     None\n }"}, {"sha": "42ae227777c7082a20849bfb489b2332850a6ac9", "filename": "tests/ui/clone_on_copy.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/503c03c5584bb697071f3585953ed6e5b16d2e10/tests%2Fui%2Fclone_on_copy.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/503c03c5584bb697071f3585953ed6e5b16d2e10/tests%2Fui%2Fclone_on_copy.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fclone_on_copy.stderr?ref=503c03c5584bb697071f3585953ed6e5b16d2e10", "patch": "@@ -49,9 +49,9 @@ LL |     vec.push(42.clone());\n    |              ^^^^^^^^^^ help: try removing the `clone` call: `42`\n \n error: using `clone` on type `std::option::Option<i32>` which implements the `Copy` trait\n-  --> $DIR/clone_on_copy.rs:76:17\n+  --> $DIR/clone_on_copy.rs:77:17\n    |\n-LL |     let value = opt.clone()?;\n+LL |     let value = opt.clone()?; // operator precedence needed (*opt)?\n    |                 ^^^^^^^^^^^ help: try dereferencing it: `(*opt)`\n \n error: aborting due to 9 previous errors"}]}