{"sha": "955e7fbb16e5015a493427dd2ab54aef97f2e23d", "node_id": "C_kwDOAAsO6NoAKDk1NWU3ZmJiMTZlNTAxNWE0OTM0MjdkZDJhYjU0YWVmOTdmMmUyM2Q", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2023-01-20T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2023-01-21T11:15:02Z"}, "message": "Consistently use dominates instead of is_dominated_by\n\nThere is a number of APIs that answer dominance queries. Previously they\nwere named either \"dominates\" or \"is_dominated_by\". Consistently use the\n\"dominates\" form.\n\nNo functional changes.", "tree": {"sha": "b3d508747592213ad5b32a41196d65dd98be3ded", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b3d508747592213ad5b32a41196d65dd98be3ded"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/955e7fbb16e5015a493427dd2ab54aef97f2e23d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/955e7fbb16e5015a493427dd2ab54aef97f2e23d", "html_url": "https://github.com/rust-lang/rust/commit/955e7fbb16e5015a493427dd2ab54aef97f2e23d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/955e7fbb16e5015a493427dd2ab54aef97f2e23d/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b22aa57fd54c240131c9a31b78213de9f3bee64b", "url": "https://api.github.com/repos/rust-lang/rust/commits/b22aa57fd54c240131c9a31b78213de9f3bee64b", "html_url": "https://github.com/rust-lang/rust/commit/b22aa57fd54c240131c9a31b78213de9f3bee64b"}], "stats": {"total": 36, "additions": 18, "deletions": 18}, "files": [{"sha": "6398e8360c0a28e5db63c31518160526b707a673", "filename": "compiler/rustc_data_structures/src/graph/dominators/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/955e7fbb16e5015a493427dd2ab54aef97f2e23d/compiler%2Frustc_data_structures%2Fsrc%2Fgraph%2Fdominators%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/955e7fbb16e5015a493427dd2ab54aef97f2e23d/compiler%2Frustc_data_structures%2Fsrc%2Fgraph%2Fdominators%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_data_structures%2Fsrc%2Fgraph%2Fdominators%2Fmod.rs?ref=955e7fbb16e5015a493427dd2ab54aef97f2e23d", "patch": "@@ -289,7 +289,7 @@ impl<Node: Idx> Dominators<Node> {\n         Iter { dominators: self, node: Some(node) }\n     }\n \n-    pub fn is_dominated_by(&self, node: Node, dom: Node) -> bool {\n+    pub fn dominates(&self, dom: Node, node: Node) -> bool {\n         // FIXME -- could be optimized by using post-order-rank\n         self.dominators(node).any(|n| n == dom)\n     }"}, {"sha": "3f43e2311abc169269d4e1e095318304d01acbb0", "filename": "compiler/rustc_middle/src/mir/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/955e7fbb16e5015a493427dd2ab54aef97f2e23d/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/955e7fbb16e5015a493427dd2ab54aef97f2e23d/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fmod.rs?ref=955e7fbb16e5015a493427dd2ab54aef97f2e23d", "patch": "@@ -3049,7 +3049,7 @@ impl Location {\n         if self.block == other.block {\n             self.statement_index <= other.statement_index\n         } else {\n-            dominators.is_dominated_by(other.block, self.block)\n+            dominators.dominates(self.block, other.block)\n         }\n     }\n }"}, {"sha": "658e01d9310317d4bf955b528a0b662d3b1eb6a3", "filename": "compiler/rustc_mir_transform/src/coverage/counters.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/955e7fbb16e5015a493427dd2ab54aef97f2e23d/compiler%2Frustc_mir_transform%2Fsrc%2Fcoverage%2Fcounters.rs", "raw_url": "https://github.com/rust-lang/rust/raw/955e7fbb16e5015a493427dd2ab54aef97f2e23d/compiler%2Frustc_mir_transform%2Fsrc%2Fcoverage%2Fcounters.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fcoverage%2Fcounters.rs?ref=955e7fbb16e5015a493427dd2ab54aef97f2e23d", "patch": "@@ -520,7 +520,7 @@ impl<'a> BcbCounters<'a> {\n                 let mut found_loop_exit = false;\n                 for &branch in branches.iter() {\n                     if backedge_from_bcbs.iter().any(|&backedge_from_bcb| {\n-                        self.bcb_is_dominated_by(backedge_from_bcb, branch.target_bcb)\n+                        self.bcb_dominates(branch.target_bcb, backedge_from_bcb)\n                     }) {\n                         if let Some(reloop_branch) = some_reloop_branch {\n                             if reloop_branch.counter(&self.basic_coverage_blocks).is_none() {\n@@ -603,8 +603,8 @@ impl<'a> BcbCounters<'a> {\n     }\n \n     #[inline]\n-    fn bcb_is_dominated_by(&self, node: BasicCoverageBlock, dom: BasicCoverageBlock) -> bool {\n-        self.basic_coverage_blocks.is_dominated_by(node, dom)\n+    fn bcb_dominates(&self, dom: BasicCoverageBlock, node: BasicCoverageBlock) -> bool {\n+        self.basic_coverage_blocks.dominates(dom, node)\n     }\n \n     #[inline]"}, {"sha": "a2671eef2e940ef09ae4170ee8deea7b3298cf60", "filename": "compiler/rustc_mir_transform/src/coverage/graph.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/955e7fbb16e5015a493427dd2ab54aef97f2e23d/compiler%2Frustc_mir_transform%2Fsrc%2Fcoverage%2Fgraph.rs", "raw_url": "https://github.com/rust-lang/rust/raw/955e7fbb16e5015a493427dd2ab54aef97f2e23d/compiler%2Frustc_mir_transform%2Fsrc%2Fcoverage%2Fgraph.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fcoverage%2Fgraph.rs?ref=955e7fbb16e5015a493427dd2ab54aef97f2e23d", "patch": "@@ -209,8 +209,8 @@ impl CoverageGraph {\n     }\n \n     #[inline(always)]\n-    pub fn is_dominated_by(&self, node: BasicCoverageBlock, dom: BasicCoverageBlock) -> bool {\n-        self.dominators.as_ref().unwrap().is_dominated_by(node, dom)\n+    pub fn dominates(&self, dom: BasicCoverageBlock, node: BasicCoverageBlock) -> bool {\n+        self.dominators.as_ref().unwrap().dominates(dom, node)\n     }\n \n     #[inline(always)]\n@@ -312,7 +312,7 @@ rustc_index::newtype_index! {\n /// to the BCB's primary counter or expression).\n ///\n /// The BCB CFG is critical to simplifying the coverage analysis by ensuring graph path-based\n-/// queries (`is_dominated_by()`, `predecessors`, `successors`, etc.) have branch (control flow)\n+/// queries (`dominates()`, `predecessors`, `successors`, etc.) have branch (control flow)\n /// significance.\n #[derive(Debug, Clone)]\n pub(super) struct BasicCoverageBlockData {\n@@ -594,7 +594,7 @@ impl TraverseCoverageGraphWithLoops {\n                 // branching block would have given an `Expression` (or vice versa).\n                 let (some_successor_to_add, some_loop_header) =\n                     if let Some((_, loop_header)) = context.loop_backedges {\n-                        if basic_coverage_blocks.is_dominated_by(successor, loop_header) {\n+                        if basic_coverage_blocks.dominates(loop_header, successor) {\n                             (Some(successor), Some(loop_header))\n                         } else {\n                             (None, None)\n@@ -666,15 +666,15 @@ pub(super) fn find_loop_backedges(\n     //\n     // The overall complexity appears to be comparable to many other MIR transform algorithms, and I\n     // don't expect that this function is creating a performance hot spot, but if this becomes an\n-    // issue, there may be ways to optimize the `is_dominated_by` algorithm (as indicated by an\n+    // issue, there may be ways to optimize the `dominates` algorithm (as indicated by an\n     // existing `FIXME` comment in that code), or possibly ways to optimize it's usage here, perhaps\n     // by keeping track of results for visited `BasicCoverageBlock`s if they can be used to short\n-    // circuit downstream `is_dominated_by` checks.\n+    // circuit downstream `dominates` checks.\n     //\n     // For now, that kind of optimization seems unnecessarily complicated.\n     for (bcb, _) in basic_coverage_blocks.iter_enumerated() {\n         for &successor in &basic_coverage_blocks.successors[bcb] {\n-            if basic_coverage_blocks.is_dominated_by(bcb, successor) {\n+            if basic_coverage_blocks.dominates(successor, bcb) {\n                 let loop_header = successor;\n                 let backedge_from_bcb = bcb;\n                 debug!("}, {"sha": "31d5541a31b6b7a26c95d44ab7a3fb0b53f9e9d9", "filename": "compiler/rustc_mir_transform/src/coverage/spans.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/955e7fbb16e5015a493427dd2ab54aef97f2e23d/compiler%2Frustc_mir_transform%2Fsrc%2Fcoverage%2Fspans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/955e7fbb16e5015a493427dd2ab54aef97f2e23d/compiler%2Frustc_mir_transform%2Fsrc%2Fcoverage%2Fspans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fcoverage%2Fspans.rs?ref=955e7fbb16e5015a493427dd2ab54aef97f2e23d", "patch": "@@ -63,7 +63,7 @@ impl CoverageStatement {\n /// Note: A `CoverageStatement` merged into another CoverageSpan may come from a `BasicBlock` that\n /// is not part of the `CoverageSpan` bcb if the statement was included because it's `Span` matches\n /// or is subsumed by the `Span` associated with this `CoverageSpan`, and it's `BasicBlock`\n-/// `is_dominated_by()` the `BasicBlock`s in this `CoverageSpan`.\n+/// `dominates()` the `BasicBlock`s in this `CoverageSpan`.\n #[derive(Debug, Clone)]\n pub(super) struct CoverageSpan {\n     pub span: Span,\n@@ -705,12 +705,12 @@ impl<'a, 'tcx> CoverageSpans<'a, 'tcx> {\n     fn hold_pending_dups_unless_dominated(&mut self) {\n         // Equal coverage spans are ordered by dominators before dominated (if any), so it should be\n         // impossible for `curr` to dominate any previous `CoverageSpan`.\n-        debug_assert!(!self.span_bcb_is_dominated_by(self.prev(), self.curr()));\n+        debug_assert!(!self.span_bcb_dominates(self.curr(), self.prev()));\n \n         let initial_pending_count = self.pending_dups.len();\n         if initial_pending_count > 0 {\n             let mut pending_dups = self.pending_dups.split_off(0);\n-            pending_dups.retain(|dup| !self.span_bcb_is_dominated_by(self.curr(), dup));\n+            pending_dups.retain(|dup| !self.span_bcb_dominates(dup, self.curr()));\n             self.pending_dups.append(&mut pending_dups);\n             if self.pending_dups.len() < initial_pending_count {\n                 debug!(\n@@ -721,7 +721,7 @@ impl<'a, 'tcx> CoverageSpans<'a, 'tcx> {\n             }\n         }\n \n-        if self.span_bcb_is_dominated_by(self.curr(), self.prev()) {\n+        if self.span_bcb_dominates(self.prev(), self.curr()) {\n             debug!(\n                 \"  different bcbs but SAME spans, and prev dominates curr. Discard prev={:?}\",\n                 self.prev()\n@@ -787,8 +787,8 @@ impl<'a, 'tcx> CoverageSpans<'a, 'tcx> {\n         }\n     }\n \n-    fn span_bcb_is_dominated_by(&self, covspan: &CoverageSpan, dom_covspan: &CoverageSpan) -> bool {\n-        self.basic_coverage_blocks.is_dominated_by(covspan.bcb, dom_covspan.bcb)\n+    fn span_bcb_dominates(&self, dom_covspan: &CoverageSpan, covspan: &CoverageSpan) -> bool {\n+        self.basic_coverage_blocks.dominates(dom_covspan.bcb, covspan.bcb)\n     }\n }\n "}]}