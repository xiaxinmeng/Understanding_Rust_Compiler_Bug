{"sha": "ec49234f44adbaf858efa646df67a41055fc905d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVjNDkyMzRmNDRhZGJhZjg1OGVmYTY0NmRmNjdhNDEwNTVmYzkwNWQ=", "commit": {"author": {"name": "comex", "email": "comexk@gmail.com", "date": "2018-03-11T23:44:05Z"}, "committer": {"name": "Nicholas Allegra", "email": "comex@Nicholass-iMac-7.local", "date": "2018-03-16T00:17:10Z"}, "message": "Support extra-verbose builds:\n\n- The bootstrap crate currently passes -v to Cargo if itself invoked\nwith -vv.  But Cargo supports -vv (to show build script output), so make\nbootstrap pass that if itself invoked with -vvv.  (More specifically,\npass N '-v's to Cargo if invoked with N+1 of them.)\n\n- bootstrap.py currently tries to pass on up to two '-v's to cargo when\nbuilding bootstrap, but incorrectly ('-v' is marked as 'store_true', so\nargparse stores either False or True, ignoring multiple '-v's).  Fix\nthis, allow passing any number of '-v's, and make it consistent with\nbootstrap's invocation of Cargo (i.e. subtract one from the number of\n'-v's).\n\n- Also improve bootstrap.py's config.toml 'parsing' to support arbitrary\nverbosity levels, + allow command line to override it.", "tree": {"sha": "3576c87e7bc7ceee63ce5cb10537d65c69759fba", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3576c87e7bc7ceee63ce5cb10537d65c69759fba"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ec49234f44adbaf858efa646df67a41055fc905d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ec49234f44adbaf858efa646df67a41055fc905d", "html_url": "https://github.com/rust-lang/rust/commit/ec49234f44adbaf858efa646df67a41055fc905d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ec49234f44adbaf858efa646df67a41055fc905d/comments", "author": {"login": "comex", "id": 47517, "node_id": "MDQ6VXNlcjQ3NTE3", "avatar_url": "https://avatars.githubusercontent.com/u/47517?v=4", "gravatar_id": "", "url": "https://api.github.com/users/comex", "html_url": "https://github.com/comex", "followers_url": "https://api.github.com/users/comex/followers", "following_url": "https://api.github.com/users/comex/following{/other_user}", "gists_url": "https://api.github.com/users/comex/gists{/gist_id}", "starred_url": "https://api.github.com/users/comex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/comex/subscriptions", "organizations_url": "https://api.github.com/users/comex/orgs", "repos_url": "https://api.github.com/users/comex/repos", "events_url": "https://api.github.com/users/comex/events{/privacy}", "received_events_url": "https://api.github.com/users/comex/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "178becdd7c86d87b24951af18e4b7d45f3e1e7bc", "url": "https://api.github.com/repos/rust-lang/rust/commits/178becdd7c86d87b24951af18e4b7d45f3e1e7bc", "html_url": "https://github.com/rust-lang/rust/commit/178becdd7c86d87b24951af18e4b7d45f3e1e7bc"}], "stats": {"total": 21, "additions": 7, "deletions": 14}, "files": [{"sha": "11f174a52a6316a0b88f16ad14649d6674396d6f", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 5, "deletions": 8, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/ec49234f44adbaf858efa646df67a41055fc905d/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/ec49234f44adbaf858efa646df67a41055fc905d/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=ec49234f44adbaf858efa646df67a41055fc905d", "patch": "@@ -597,10 +597,8 @@ def build_bootstrap(self):\n                 self.cargo()))\n         args = [self.cargo(), \"build\", \"--manifest-path\",\n                 os.path.join(self.rust_root, \"src/bootstrap/Cargo.toml\")]\n-        if self.verbose:\n+        for _ in range(1, self.verbose):\n             args.append(\"--verbose\")\n-            if self.verbose > 1:\n-                args.append(\"--verbose\")\n         if self.use_locked_deps:\n             args.append(\"--locked\")\n         if self.use_vendored_sources:\n@@ -675,7 +673,7 @@ def bootstrap(help_triggered):\n     parser.add_argument('--config')\n     parser.add_argument('--build')\n     parser.add_argument('--clean', action='store_true')\n-    parser.add_argument('-v', '--verbose', action='store_true')\n+    parser.add_argument('-v', '--verbose', action='count', default=0)\n \n     args = [a for a in sys.argv if a != '-h' and a != '--help']\n     args, _ = parser.parse_known_args(args)\n@@ -691,10 +689,9 @@ def bootstrap(help_triggered):\n     except (OSError, IOError):\n         pass\n \n-    if '\\nverbose = 2' in build.config_toml:\n-        build.verbose = 2\n-    elif '\\nverbose = 1' in build.config_toml:\n-        build.verbose = 1\n+    match = re.search(r'\\nverbose = (\\d+)', build.config_toml)\n+    if match is not None:\n+        build.verbose = max(build.verbose, int(match.group(1)))\n \n     build.use_vendored_sources = '\\nvendor = true' in build.config_toml\n "}, {"sha": "4185384cf499d8db7bb771fd371d15c0d1665643", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ec49234f44adbaf858efa646df67a41055fc905d/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ec49234f44adbaf858efa646df67a41055fc905d/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=ec49234f44adbaf858efa646df67a41055fc905d", "patch": "@@ -763,7 +763,7 @@ impl<'a> Builder<'a> {\n             cargo.env(\"WINAPI_NO_BUNDLED_LIBRARIES\", \"1\");\n         }\n \n-        if self.is_very_verbose() {\n+        for _ in 1..self.verbosity {\n             cargo.arg(\"-v\");\n         }\n "}, {"sha": "c5af0f8e2e15331cc45fbf779b471731cde82149", "filename": "src/bootstrap/flags.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ec49234f44adbaf858efa646df67a41055fc905d/src%2Fbootstrap%2Fflags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ec49234f44adbaf858efa646df67a41055fc905d/src%2Fbootstrap%2Fflags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fflags.rs?ref=ec49234f44adbaf858efa646df67a41055fc905d", "patch": "@@ -29,7 +29,7 @@ use cache::{Interned, INTERNER};\n \n /// Deserialized version of all flags for this compile.\n pub struct Flags {\n-    pub verbose: usize, // verbosity level: 0 == not verbose, 1 == verbose, 2 == very verbose\n+    pub verbose: usize, // number of -v args; each extra -v after the first is passed to Cargo\n     pub on_fail: Option<String>,\n     pub stage: Option<u32>,\n     pub keep_stage: Option<u32>,"}, {"sha": "8b3fbf56d594ba601fd785f5950952c8cc470d30", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ec49234f44adbaf858efa646df67a41055fc905d/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ec49234f44adbaf858efa646df67a41055fc905d/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=ec49234f44adbaf858efa646df67a41055fc905d", "patch": "@@ -605,10 +605,6 @@ impl Build {\n         self.verbosity > 0\n     }\n \n-    pub fn is_very_verbose(&self) -> bool {\n-        self.verbosity > 1\n-    }\n-\n     /// Prints a message if this build is configured in verbose mode.\n     fn verbose(&self, msg: &str) {\n         if self.is_verbose() {"}]}