{"sha": "0d1f4f9b273ebefbba18f9746d5d4dd7672c4820", "node_id": "C_kwDOAAsO6NoAKDBkMWY0ZjliMjczZWJlZmJiYTE4Zjk3NDZkNWQ0ZGQ3NjcyYzQ4MjA", "commit": {"author": {"name": "Aleksei Trifonov", "email": "avrong@avrong.me", "date": "2022-03-30T23:27:33Z"}, "committer": {"name": "Aleksei Trifonov", "email": "avrong@avrong.me", "date": "2022-03-30T23:27:33Z"}, "message": "Lower postfix suggestions in completions list", "tree": {"sha": "82036aa2dca64777d75741ce7f50256c90f38c60", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/82036aa2dca64777d75741ce7f50256c90f38c60"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0d1f4f9b273ebefbba18f9746d5d4dd7672c4820", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0d1f4f9b273ebefbba18f9746d5d4dd7672c4820", "html_url": "https://github.com/rust-lang/rust/commit/0d1f4f9b273ebefbba18f9746d5d4dd7672c4820", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0d1f4f9b273ebefbba18f9746d5d4dd7672c4820/comments", "author": {"login": "avrong", "id": 6342851, "node_id": "MDQ6VXNlcjYzNDI4NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/6342851?v=4", "gravatar_id": "", "url": "https://api.github.com/users/avrong", "html_url": "https://github.com/avrong", "followers_url": "https://api.github.com/users/avrong/followers", "following_url": "https://api.github.com/users/avrong/following{/other_user}", "gists_url": "https://api.github.com/users/avrong/gists{/gist_id}", "starred_url": "https://api.github.com/users/avrong/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/avrong/subscriptions", "organizations_url": "https://api.github.com/users/avrong/orgs", "repos_url": "https://api.github.com/users/avrong/repos", "events_url": "https://api.github.com/users/avrong/events{/privacy}", "received_events_url": "https://api.github.com/users/avrong/received_events", "type": "User", "site_admin": false}, "committer": {"login": "avrong", "id": 6342851, "node_id": "MDQ6VXNlcjYzNDI4NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/6342851?v=4", "gravatar_id": "", "url": "https://api.github.com/users/avrong", "html_url": "https://github.com/avrong", "followers_url": "https://api.github.com/users/avrong/followers", "following_url": "https://api.github.com/users/avrong/following{/other_user}", "gists_url": "https://api.github.com/users/avrong/gists{/gist_id}", "starred_url": "https://api.github.com/users/avrong/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/avrong/subscriptions", "organizations_url": "https://api.github.com/users/avrong/orgs", "repos_url": "https://api.github.com/users/avrong/repos", "events_url": "https://api.github.com/users/avrong/events{/privacy}", "received_events_url": "https://api.github.com/users/avrong/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "259182b50b131647975926e8c94aad4c47d33747", "url": "https://api.github.com/repos/rust-lang/rust/commits/259182b50b131647975926e8c94aad4c47d33747", "html_url": "https://github.com/rust-lang/rust/commit/259182b50b131647975926e8c94aad4c47d33747"}], "stats": {"total": 27, "additions": 20, "deletions": 7}, "files": [{"sha": "45ae590405ec8316f51edbb47ec14ad7dc894945", "filename": "crates/ide_completion/src/completions/postfix.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/0d1f4f9b273ebefbba18f9746d5d4dd7672c4820/crates%2Fide_completion%2Fsrc%2Fcompletions%2Fpostfix.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0d1f4f9b273ebefbba18f9746d5d4dd7672c4820/crates%2Fide_completion%2Fsrc%2Fcompletions%2Fpostfix.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Fcompletions%2Fpostfix.rs?ref=0d1f4f9b273ebefbba18f9746d5d4dd7672c4820", "patch": "@@ -240,12 +240,12 @@ fn build_postfix_snippet_builder<'ctx>(\n             let mut item =\n                 CompletionItem::new(CompletionItemKind::Snippet, ctx.source_range(), label);\n             item.detail(detail).snippet_edit(cap, edit);\n-            if ctx.original_token.text() == label {\n-                let relevance =\n-                    CompletionRelevance { exact_postfix_snippet_match: true, ..Default::default() };\n-                item.set_relevance(relevance);\n-            }\n-\n+            let relevance = if ctx.original_token.text() == label {\n+                CompletionRelevance { exact_postfix_snippet_match: true, ..Default::default() }\n+            } else {\n+                CompletionRelevance { is_postfix: true, ..Default::default() }\n+            };\n+            item.set_relevance(relevance);\n             item\n         }\n     }"}, {"sha": "e86a1af8ae0066e9f1333532e32f2d0177fc93fb", "filename": "crates/ide_completion/src/item.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/0d1f4f9b273ebefbba18f9746d5d4dd7672c4820/crates%2Fide_completion%2Fsrc%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0d1f4f9b273ebefbba18f9746d5d4dd7672c4820/crates%2Fide_completion%2Fsrc%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Fitem.rs?ref=0d1f4f9b273ebefbba18f9746d5d4dd7672c4820", "patch": "@@ -152,6 +152,8 @@ pub struct CompletionRelevance {\n     /// Basically, we want to guarantee that postfix snippets always takes\n     /// precedence over everything else.\n     pub exact_postfix_snippet_match: bool,\n+    /// Set in cases when item is postfix, but not exact\n+    pub is_postfix: bool,\n }\n \n #[derive(Debug, Clone, Copy, Eq, PartialEq)]\n@@ -179,7 +181,7 @@ pub enum CompletionRelevanceTypeMatch {\n }\n \n impl CompletionRelevance {\n-    const BASE_LINE: u32 = 2;\n+    const BASE_LINE: u32 = 3;\n     /// Provides a relevance score. Higher values are more relevant.\n     ///\n     /// The absolute value of the relevance score is not meaningful, for\n@@ -199,6 +201,9 @@ impl CompletionRelevance {\n         if self.is_private_editable {\n             score -= 1;\n         }\n+        if self.is_postfix {\n+            score -= 3;\n+        }\n \n         // score increases\n         if self.exact_name_match {\n@@ -215,6 +220,7 @@ impl CompletionRelevance {\n         if self.exact_postfix_snippet_match {\n             score += 100;\n         }\n+\n         score\n     }\n \n@@ -573,6 +579,10 @@ mod tests {\n         // This test asserts that the relevance score for these items is ascending, and\n         // that any items in the same vec have the same score.\n         let expected_relevance_order = vec![\n+            vec![CompletionRelevance {\n+                is_postfix: true,\n+                ..CompletionRelevance::default()\n+            }],\n             vec![CompletionRelevance {\n                 is_op_method: true,\n                 is_private_editable: true,"}, {"sha": "652cd52f808fc74b7278799511981d673fcc5ef8", "filename": "crates/ide_completion/src/render.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/0d1f4f9b273ebefbba18f9746d5d4dd7672c4820/crates%2Fide_completion%2Fsrc%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0d1f4f9b273ebefbba18f9746d5d4dd7672c4820/crates%2Fide_completion%2Fsrc%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Frender.rs?ref=0d1f4f9b273ebefbba18f9746d5d4dd7672c4820", "patch": "@@ -615,6 +615,7 @@ fn main() { let _: m::Spam = S$0 }\n                             is_op_method: false,\n                             is_private_editable: false,\n                             exact_postfix_snippet_match: false,\n+                            is_postfix: false,\n                         },\n                     },\n                     CompletionItem {\n@@ -636,6 +637,7 @@ fn main() { let _: m::Spam = S$0 }\n                             is_op_method: false,\n                             is_private_editable: false,\n                             exact_postfix_snippet_match: false,\n+                            is_postfix: false,\n                         },\n                     },\n                 ]\n@@ -723,6 +725,7 @@ fn foo() { A { the$0 } }\n                             is_op_method: false,\n                             is_private_editable: false,\n                             exact_postfix_snippet_match: false,\n+                            is_postfix: false,\n                         },\n                     },\n                 ]"}]}