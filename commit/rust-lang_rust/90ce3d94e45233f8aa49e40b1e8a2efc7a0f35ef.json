{"sha": "90ce3d94e45233f8aa49e40b1e8a2efc7a0f35ef", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkwY2UzZDk0ZTQ1MjMzZjhhYTQ5ZTQwYjFlOGEyZWZjN2EwZjM1ZWY=", "commit": {"author": {"name": "Ben Blum", "email": "bblum@andrew.cmu.edu", "date": "2012-08-01T23:04:43Z"}, "committer": {"name": "Ben Blum", "email": "bblum@andrew.cmu.edu", "date": "2012-08-01T23:07:28Z"}, "message": "Add core::util, with swap, replace, and noncopyable", "tree": {"sha": "efd0d921ebf95bf98ac75116315aa167e7ab60d4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/efd0d921ebf95bf98ac75116315aa167e7ab60d4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/90ce3d94e45233f8aa49e40b1e8a2efc7a0f35ef", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/90ce3d94e45233f8aa49e40b1e8a2efc7a0f35ef", "html_url": "https://github.com/rust-lang/rust/commit/90ce3d94e45233f8aa49e40b1e8a2efc7a0f35ef", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/90ce3d94e45233f8aa49e40b1e8a2efc7a0f35ef/comments", "author": {"login": "bblum", "id": 1820515, "node_id": "MDQ6VXNlcjE4MjA1MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bblum", "html_url": "https://github.com/bblum", "followers_url": "https://api.github.com/users/bblum/followers", "following_url": "https://api.github.com/users/bblum/following{/other_user}", "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}", "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bblum/subscriptions", "organizations_url": "https://api.github.com/users/bblum/orgs", "repos_url": "https://api.github.com/users/bblum/repos", "events_url": "https://api.github.com/users/bblum/events{/privacy}", "received_events_url": "https://api.github.com/users/bblum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bblum", "id": 1820515, "node_id": "MDQ6VXNlcjE4MjA1MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bblum", "html_url": "https://github.com/bblum", "followers_url": "https://api.github.com/users/bblum/followers", "following_url": "https://api.github.com/users/bblum/following{/other_user}", "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}", "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bblum/subscriptions", "organizations_url": "https://api.github.com/users/bblum/orgs", "repos_url": "https://api.github.com/users/bblum/repos", "events_url": "https://api.github.com/users/bblum/events{/privacy}", "received_events_url": "https://api.github.com/users/bblum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6fdd1ef9b18039eb29d8c8ba322883a565e94e43", "url": "https://api.github.com/repos/rust-lang/rust/commits/6fdd1ef9b18039eb29d8c8ba322883a565e94e43", "html_url": "https://github.com/rust-lang/rust/commit/6fdd1ef9b18039eb29d8c8ba322883a565e94e43"}], "stats": {"total": 50, "additions": 50, "deletions": 0}, "files": [{"sha": "ed9f642cc96c98348560ac99a58241a4d9ea9b92", "filename": "src/libcore/core.rc", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/90ce3d94e45233f8aa49e40b1e8a2efc7a0f35ef/src%2Flibcore%2Fcore.rc", "raw_url": "https://github.com/rust-lang/rust/raw/90ce3d94e45233f8aa49e40b1e8a2efc7a0f35ef/src%2Flibcore%2Fcore.rc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fcore.rc?ref=90ce3d94e45233f8aa49e40b1e8a2efc7a0f35ef", "patch": "@@ -179,6 +179,10 @@ mod option_iter {\n mod result;\n mod to_str;\n mod to_bytes;\n+mod util;\n+\n+// Data structure modules\n+\n mod dvec;\n #[path=\"iter-trait\"]\n mod dvec_iter {"}, {"sha": "0c7a54053b254eaa4dd3ea0f778125aca4f56887", "filename": "src/libcore/util.rs", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/90ce3d94e45233f8aa49e40b1e8a2efc7a0f35ef/src%2Flibcore%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/90ce3d94e45233f8aa49e40b1e8a2efc7a0f35ef/src%2Flibcore%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Futil.rs?ref=90ce3d94e45233f8aa49e40b1e8a2efc7a0f35ef", "patch": "@@ -0,0 +1,46 @@\n+/**\n+ * Miscellaneous helpers for common patterns.\n+ */\n+\n+/**\n+ * Swap the values at two mutable locations of the same type, without\n+ * deinitialising or copying either one.\n+ */\n+fn swap<T>(x: &mut T, y: &mut T) {\n+    *x <-> *y;\n+}\n+\n+/**\n+ * Replace the value at a mutable location with a new one, returning the old\n+ * value, without deinitialising or copying either one.\n+ */\n+fn replace<T>(dest: &mut T, +src: T) -> T {\n+    let mut tmp = src;\n+    swap(dest, &mut tmp);\n+    tmp\n+}\n+\n+/// A non-copyable dummy type.\n+class noncopyable {\n+    i: ();\n+    new() { self.i = (); }\n+    drop { }\n+}\n+\n+mod tests {\n+    #[test]\n+    fn test_swap() {\n+        let mut x = 31337;\n+        let mut y = 42;\n+        swap(&mut x, &mut y);\n+        assert x == 42;\n+        assert y == 31337;\n+    }\n+    #[test]\n+    fn test_replace() {\n+        let mut x = some(noncopyable());\n+        let y = replace(&mut x, none);\n+        assert x.is_none();\n+        assert y.is_some();\n+    }\n+}"}]}