{"sha": "77562f2350c4dbe2d19a253f70046fb3edd9baa6", "node_id": "C_kwDOAAsO6NoAKDc3NTYyZjIzNTBjNGRiZTJkMTlhMjUzZjcwMDQ2ZmIzZWRkOWJhYTY", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-03-07T17:39:03Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-03-07T17:39:03Z"}, "message": "Rollup merge of #94696 - GuillaumeGomez:align-line-numbers-right, r=notriddle\n\nRemove whitespaces and use CSS to align line numbers to the right instead\n\nInstead of generating whitespaces to create padding, we simply use the CSS rule: `text-align: right`.\n\nNice side-effect: it reduces the generated HTML size from **75.004** to **74.828** (MegaBytes) on the std source pages (it's not much but it's always a nice plus :laughing: ).\n\nThere are no changes in the generated UI.\n\nr? `@notriddle`", "tree": {"sha": "063d5758a165688040a6314398ffe8f2ac48f75d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/063d5758a165688040a6314398ffe8f2ac48f75d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/77562f2350c4dbe2d19a253f70046fb3edd9baa6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiJkM4CRBK7hj4Ov3rIwAAaekIAKnmJUp8ucYw+wxIP2aTHcYo\nLfWuEVemNfAuo9rGP0ROnjCUOe6sinb26WBPT6hkxaybnA/g5NBrXybWzkiQzSLM\nzwzVrcUqKniuGUpVN70QJrfa/lR9JMAR+loDAYspl/kBhIrklKmUFMbyI2p78613\nNFPi9CUnzprCeGzA00wLIiyfTLvdQ6q3eQJBDxcGW6wc3FKUiGpVJaewST5P3hnt\nn6nr8X0BTpVRr3AHShNVfb1Rr5SFCtUfMlO98cGSQnkwnaI3qmG0y2eO1575xyjh\nYVInWmX2qxyIEYtaxQ2IupTyKnsjcbsdBwcqDg82gF80H9WlceuM2NNbIsOnxMA=\n=TySx\n-----END PGP SIGNATURE-----\n", "payload": "tree 063d5758a165688040a6314398ffe8f2ac48f75d\nparent 9d7166c66f7d2cd7d2e51abae3e42a520fb359e0\nparent f23d6d3a47c15bc0fc3fbf2abdd318c3a2c09c7c\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1646674743 +0100\ncommitter GitHub <noreply@github.com> 1646674743 +0100\n\nRollup merge of #94696 - GuillaumeGomez:align-line-numbers-right, r=notriddle\n\nRemove whitespaces and use CSS to align line numbers to the right instead\n\nInstead of generating whitespaces to create padding, we simply use the CSS rule: `text-align: right`.\n\nNice side-effect: it reduces the generated HTML size from **75.004** to **74.828** (MegaBytes) on the std source pages (it's not much but it's always a nice plus :laughing: ).\n\nThere are no changes in the generated UI.\n\nr? `@notriddle`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/77562f2350c4dbe2d19a253f70046fb3edd9baa6", "html_url": "https://github.com/rust-lang/rust/commit/77562f2350c4dbe2d19a253f70046fb3edd9baa6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/77562f2350c4dbe2d19a253f70046fb3edd9baa6/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9d7166c66f7d2cd7d2e51abae3e42a520fb359e0", "url": "https://api.github.com/repos/rust-lang/rust/commits/9d7166c66f7d2cd7d2e51abae3e42a520fb359e0", "html_url": "https://github.com/rust-lang/rust/commit/9d7166c66f7d2cd7d2e51abae3e42a520fb359e0"}, {"sha": "f23d6d3a47c15bc0fc3fbf2abdd318c3a2c09c7c", "url": "https://api.github.com/repos/rust-lang/rust/commits/f23d6d3a47c15bc0fc3fbf2abdd318c3a2c09c7c", "html_url": "https://github.com/rust-lang/rust/commit/f23d6d3a47c15bc0fc3fbf2abdd318c3a2c09c7c"}], "stats": {"total": 16, "additions": 8, "deletions": 8}, "files": [{"sha": "9fba6e911628229f8ed8632581ea9916ba96a56c", "filename": "src/librustdoc/html/sources.rs", "status": "modified", "additions": 2, "deletions": 8, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/77562f2350c4dbe2d19a253f70046fb3edd9baa6/src%2Flibrustdoc%2Fhtml%2Fsources.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77562f2350c4dbe2d19a253f70046fb3edd9baa6/src%2Flibrustdoc%2Fhtml%2Fsources.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fsources.rs?ref=77562f2350c4dbe2d19a253f70046fb3edd9baa6", "patch": "@@ -272,22 +272,16 @@ crate fn print_src(\n ) {\n     let lines = s.lines().count();\n     let mut line_numbers = Buffer::empty_from(buf);\n-    let mut cols = 0;\n-    let mut tmp = lines;\n-    while tmp > 0 {\n-        cols += 1;\n-        tmp /= 10;\n-    }\n     line_numbers.write_str(\"<pre class=\\\"line-numbers\\\">\");\n     match source_context {\n         SourceContext::Standalone => {\n             for line in 1..=lines {\n-                writeln!(line_numbers, \"<span id=\\\"{0}\\\">{0:1$}</span>\", line, cols)\n+                writeln!(line_numbers, \"<span id=\\\"{0}\\\">{0}</span>\", line)\n             }\n         }\n         SourceContext::Embedded { offset } => {\n             for line in 1..=lines {\n-                writeln!(line_numbers, \"<span>{0:1$}</span>\", line + offset, cols)\n+                writeln!(line_numbers, \"<span>{0}</span>\", line + offset)\n             }\n         }\n     }"}, {"sha": "9a4b382a304ff9b899dafbb83719dc5763ea7ba9", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/77562f2350c4dbe2d19a253f70046fb3edd9baa6/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/77562f2350c4dbe2d19a253f70046fb3edd9baa6/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=77562f2350c4dbe2d19a253f70046fb3edd9baa6", "patch": "@@ -541,6 +541,9 @@ h2.location a {\n \ttext-decoration: underline;\n }\n \n+.line-numbers {\n+\ttext-align: right;\n+}\n .rustdoc:not(.source) .example-wrap > pre:not(.line-number) {\n \twidth: 100%;\n \toverflow-x: auto;"}, {"sha": "ad7080c39b842cc44b7ae0827950634c8b0008f6", "filename": "src/test/rustdoc-gui/source-code-page.goml", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/77562f2350c4dbe2d19a253f70046fb3edd9baa6/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "raw_url": "https://github.com/rust-lang/rust/raw/77562f2350c4dbe2d19a253f70046fb3edd9baa6/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml?ref=77562f2350c4dbe2d19a253f70046fb3edd9baa6", "patch": "@@ -14,3 +14,6 @@ assert-attribute: (\".line-numbers > span:nth-child(6)\", {\"class\": \"line-highligh\n assert-attribute-false: (\".line-numbers > span:nth-child(7)\", {\"class\": \"line-highlighted\"})\n // This is to ensure that the content is correctly align with the line numbers.\n compare-elements-position: (\"//*[@id='1']\", \".rust > code > span\", (\"y\"))\n+\n+// Assert that the line numbers text is aligned to the right.\n+assert-css: (\".line-numbers\", {\"text-align\": \"right\"})"}]}