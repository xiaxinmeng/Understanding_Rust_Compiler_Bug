{"sha": "ad26dab27cd314d13e64fe5b49cfa5260a57ab53", "node_id": "C_kwDOAAsO6NoAKGFkMjZkYWIyN2NkMzE0ZDEzZTY0ZmU1YjQ5Y2ZhNTI2MGE1N2FiNTM", "commit": {"author": {"name": "zhaixiaojuan", "email": "zhaixiaojuan@loongson.cn", "date": "2022-05-12T13:17:31Z"}, "committer": {"name": "wangrui", "email": "wangrui@loongson.cn", "date": "2023-04-04T09:05:07Z"}, "message": "Initial support for loongarch64-unknown-linux-gnu", "tree": {"sha": "b252b7e80429b6493d727af4b671fe2d209833fe", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b252b7e80429b6493d727af4b671fe2d209833fe"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ad26dab27cd314d13e64fe5b49cfa5260a57ab53", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ad26dab27cd314d13e64fe5b49cfa5260a57ab53", "html_url": "https://github.com/rust-lang/rust/commit/ad26dab27cd314d13e64fe5b49cfa5260a57ab53", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ad26dab27cd314d13e64fe5b49cfa5260a57ab53/comments", "author": {"login": "zhaixiaojuan", "id": 67671683, "node_id": "MDQ6VXNlcjY3NjcxNjgz", "avatar_url": "https://avatars.githubusercontent.com/u/67671683?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhaixiaojuan", "html_url": "https://github.com/zhaixiaojuan", "followers_url": "https://api.github.com/users/zhaixiaojuan/followers", "following_url": "https://api.github.com/users/zhaixiaojuan/following{/other_user}", "gists_url": "https://api.github.com/users/zhaixiaojuan/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhaixiaojuan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhaixiaojuan/subscriptions", "organizations_url": "https://api.github.com/users/zhaixiaojuan/orgs", "repos_url": "https://api.github.com/users/zhaixiaojuan/repos", "events_url": "https://api.github.com/users/zhaixiaojuan/events{/privacy}", "received_events_url": "https://api.github.com/users/zhaixiaojuan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "heiher", "id": 1407733, "node_id": "MDQ6VXNlcjE0MDc3MzM=", "avatar_url": "https://avatars.githubusercontent.com/u/1407733?v=4", "gravatar_id": "", "url": "https://api.github.com/users/heiher", "html_url": "https://github.com/heiher", "followers_url": "https://api.github.com/users/heiher/followers", "following_url": "https://api.github.com/users/heiher/following{/other_user}", "gists_url": "https://api.github.com/users/heiher/gists{/gist_id}", "starred_url": "https://api.github.com/users/heiher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/heiher/subscriptions", "organizations_url": "https://api.github.com/users/heiher/orgs", "repos_url": "https://api.github.com/users/heiher/repos", "events_url": "https://api.github.com/users/heiher/events{/privacy}", "received_events_url": "https://api.github.com/users/heiher/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5ce70ed8dafeb3029cc7b493570a6f3e1c2f422b", "url": "https://api.github.com/repos/rust-lang/rust/commits/5ce70ed8dafeb3029cc7b493570a6f3e1c2f422b", "html_url": "https://github.com/rust-lang/rust/commit/5ce70ed8dafeb3029cc7b493570a6f3e1c2f422b"}], "stats": {"total": 114, "additions": 113, "deletions": 1}, "files": [{"sha": "db8b9c70e67023fdb2a2427e473e2ef144a14889", "filename": "compiler/rustc_target/src/spec/loongarch64_unknown_linux_gnu.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/ad26dab27cd314d13e64fe5b49cfa5260a57ab53/compiler%2Frustc_target%2Fsrc%2Fspec%2Floongarch64_unknown_linux_gnu.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad26dab27cd314d13e64fe5b49cfa5260a57ab53/compiler%2Frustc_target%2Fsrc%2Fspec%2Floongarch64_unknown_linux_gnu.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Floongarch64_unknown_linux_gnu.rs?ref=ad26dab27cd314d13e64fe5b49cfa5260a57ab53", "patch": "@@ -0,0 +1,17 @@\n+use crate::spec::{Target, TargetOptions};\n+\n+pub fn target() -> Target {\n+    Target {\n+        llvm_target: \"loongarch64-unknown-linux-gnu\".into(),\n+        pointer_width: 64,\n+        data_layout: \"e-m:e-p:64:64-i64:64-i128:128-n64-S128\".into(),\n+        arch: \"loongarch64\".into(),\n+        options: TargetOptions {\n+            cpu: \"generic\".into(),\n+            features: \"+f,+d\".into(),\n+            llvm_abiname: \"lp64d\".into(),\n+            max_atomic_width: Some(64),\n+            ..super::linux_gnu_base::opts()\n+        },\n+    }\n+}"}, {"sha": "c92a796c70e0daf395639686815fa5cf6bb798f3", "filename": "compiler/rustc_target/src/spec/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ad26dab27cd314d13e64fe5b49cfa5260a57ab53/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad26dab27cd314d13e64fe5b49cfa5260a57ab53/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs?ref=ad26dab27cd314d13e64fe5b49cfa5260a57ab53", "patch": "@@ -1021,6 +1021,7 @@ supported_targets! {\n     (\"x86_64-unknown-linux-gnux32\", x86_64_unknown_linux_gnux32),\n     (\"i686-unknown-linux-gnu\", i686_unknown_linux_gnu),\n     (\"i586-unknown-linux-gnu\", i586_unknown_linux_gnu),\n+    (\"loongarch64-unknown-linux-gnu\", loongarch64_unknown_linux_gnu),\n     (\"m68k-unknown-linux-gnu\", m68k_unknown_linux_gnu),\n     (\"mips-unknown-linux-gnu\", mips_unknown_linux_gnu),\n     (\"mips64-unknown-linux-gnuabi64\", mips64_unknown_linux_gnuabi64),"}, {"sha": "bbf53a09ce897e7cc177f96696381c9a5e085591", "filename": "src/doc/rustc/src/SUMMARY.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ad26dab27cd314d13e64fe5b49cfa5260a57ab53/src%2Fdoc%2Frustc%2Fsrc%2FSUMMARY.md", "raw_url": "https://github.com/rust-lang/rust/raw/ad26dab27cd314d13e64fe5b49cfa5260a57ab53/src%2Fdoc%2Frustc%2Fsrc%2FSUMMARY.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2FSUMMARY.md?ref=ad26dab27cd314d13e64fe5b49cfa5260a57ab53", "patch": "@@ -28,6 +28,7 @@\n     - [\\*-android and \\*-androideabi](platform-support/android.md)\n     - [\\*-unknown-fuchsia](platform-support/fuchsia.md)\n     - [\\*-kmc-solid_\\*](platform-support/kmc-solid.md)\n+    - [loongarch\\*-unknown-linux-\\*](platform-support/loongarch-linux.md)\n     - [m68k-unknown-linux-gnu](platform-support/m68k-unknown-linux-gnu.md)\n     - [mips64-openwrt-linux-musl](platform-support/mips64-openwrt-linux-musl.md)\n     - [mipsel-sony-psx](platform-support/mipsel-sony-psx.md)"}, {"sha": "f9de456d17e5b7d051b430972a618ae4a4b50454", "filename": "src/doc/rustc/src/platform-support.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ad26dab27cd314d13e64fe5b49cfa5260a57ab53/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md", "raw_url": "https://github.com/rust-lang/rust/raw/ad26dab27cd314d13e64fe5b49cfa5260a57ab53/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md?ref=ad26dab27cd314d13e64fe5b49cfa5260a57ab53", "patch": "@@ -263,6 +263,7 @@ target | std | host | notes\n `i686-uwp-windows-gnu` | ? |  |\n `i686-uwp-windows-msvc` | ? |  |\n `i686-wrs-vxworks` | ? |  |\n+[`loongarch64-unknown-linux-gnu`](platform-support/loongarch-linux.md) | ? |  | LoongArch64 Linux (LP64D ABI)\n [`m68k-unknown-linux-gnu`](platform-support/m68k-unknown-linux-gnu.md) | ? |  | Motorola 680x0 Linux\n `mips-unknown-linux-uclibc` | \u2713 |  | MIPS Linux with uClibc\n [`mips64-openwrt-linux-musl`](platform-support/mips64-openwrt-linux-musl.md) | ? |  | MIPS64 for OpenWrt Linux MUSL"}, {"sha": "e046ec244ece98073a1227ddb30871f1344fb3df", "filename": "src/doc/rustc/src/platform-support/loongarch-linux.md", "status": "added", "additions": 92, "deletions": 0, "changes": 92, "blob_url": "https://github.com/rust-lang/rust/blob/ad26dab27cd314d13e64fe5b49cfa5260a57ab53/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Floongarch-linux.md", "raw_url": "https://github.com/rust-lang/rust/raw/ad26dab27cd314d13e64fe5b49cfa5260a57ab53/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Floongarch-linux.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support%2Floongarch-linux.md?ref=ad26dab27cd314d13e64fe5b49cfa5260a57ab53", "patch": "@@ -0,0 +1,92 @@\n+# loongarch\\*-unknown-linux-\\*\n+\n+**Tier: 3**\n+\n+[LoongArch] is a new RISC ISA developed by Loongson Technology Corporation Limited.\n+\n+[LoongArch]: https://loongson.github.io/LoongArch-Documentation/README-EN.html\n+\n+The target name follow this format: `<machine>-<vendor>-<os><fabi_suffix>, where `<machine>` specifies the CPU family/model, `<vendor>` specifies the vendor and `<os>` the operating system name.\n+While the integer base ABI is\u00a0implied by the\u2002machine\u2002field, the floating point base ABI type is encoded into the os field of the specifier using the string suffix `<fabi-suffix>`.\n+\n+|    `<fabi-suffix>`     |                           `Description`                            |\n+|------------------------|--------------------------------------------------------------------|\n+|          f64           | The base ABI use 64-bits FPRs for parameter passing.(lp64d)|\n+|          f32           | The base ABI uses 32-bit FPRs for parameter passing. (lp64f)|\n+|          sf            | The base ABI uses no FPR for parameter passing. (lp64s)     |\n+\n+|`ABI type(Base ABI/ABI extension)`| `C library` | `kernel` |          `target tuple`          |\n+|----------------------------------|-------------|----------|----------------------------------|\n+|           lp64d/base             |   glibc     |  linux   | loongarch64-unknown-linux-gnu |\n+|           lp64f/base             |   glibc     |  linux   | loongarch64-unknown-linux-gnuf32 |\n+|           lp64s/base             |   glibc     |  linux   | loongarch64-unknown-linux-gnusf  |\n+|           lp64d/base             |  musl libc  |  linux   | loongarch64-unknown-linux-musl|\n+|           lp64f/base             |  musl libc  |  linux   | loongarch64-unknown-linux-muslf32|\n+|           lp64s/base             |  musl libc  |  linux   | loongarch64-unknown-linux-muslsf |\n+\n+## Target maintainers\n+\n+- [ZHAI xiaojuan](https://github.com/zhaixiaojuan) `zhaixiaojuan@loongson.cn`\n+- [WANG rui](https://github.com/heiher) `wangrui@loongson.cn`\n+- [ZHAI xiang](https://github.com/xiangzhai) `zhaixiang@loongson.cn`\n+- [WANG Xuerui](https://github.com/xen0n) `git@xen0n.name`\n+\n+## Requirements\n+\n+This target is cross-compiled.\n+A GNU toolchain for LoongArch target is required.  It can be downloaded from https://github.com/loongson/build-tools/releases, or built from the source code of GCC (12.1.0 or later) and Binutils (2.40 or later).\n+\n+## Building the target\n+\n+The target can be built by enabling it for a `rustc` build.\n+\n+```toml\n+[build]\n+target = [\"loongarch64-unknown-linux-gnu\"]\n+```\n+\n+Make sure `loongarch64-unknown-linux-gnu-gcc` can be searched from the directories specified in`$PATH`. Alternatively, you can use GNU LoongArch Toolchain by adding the following to `config.toml`:\n+\n+```toml\n+[target.loongarch64-unknown-linux-gnu]\n+# ADJUST THIS PATH TO POINT AT YOUR TOOLCHAIN\n+cc = \"/TOOLCHAIN_PATH/bin/loongarch64-unknown-linux-gnu-gcc\"\n+cxx = \"/TOOLCHAIN_PATH/bin/loongarch64-unknown-linux-gnu-g++\"\n+ar = \"/TOOLCHAIN_PATH/bin/loongarch64-unknown-linux-gnu-ar\"\n+ranlib = \"/TOOLCHAIN_PATH/bin/loongarch64-unknown-linux-gnu-ranlib\"\n+linker = \"/TOOLCHAIN_PATH/bin/loongarch64-unknown-linux-gnu-gcc\"\n+```\n+\n+## Cross-compilation\n+\n+This target can be cross-compiled on a `x86_64-unknown-linux-gnu` host. Cross-compilation on other hosts may work but is not tested.\n+\n+## Testing\n+To test a cross-compiled binary on your build system, install the qemu binary that supports the LoongArch architecture and execute the following commands.\n+```text\n+CC_loongarch64_unknown_linux_gnu=/TOOLCHAIN_PATH/bin/loongarch64-unknown-linux-gnu-gcc \\\n+CXX_loongarch64_unknown_linux_gnu=/TOOLCHAIN_PATH/bin/loongarch64-unknown-linux-gnu-g++ \\\n+AR_loongarch64_unknown_linux_gnu=/TOOLCHAIN_PATH/bin/loongarch64-unknown-linux-gnu-gcc-ar \\\n+CARGO_TARGET_LOONGARCH64_UNKNOWN_LINUX_GNUN_LINKER=/TOOLCHAIN_PATH/bin/loongarch64-unknown-linux-gnu-gcc \\\n+# SET TARGET SYSTEM LIBRARY PATH\n+CARGO_TARGET_LOONGARCH64_UNKNOWN_LINUX_GNUN_RUNNER=\"qemu-loongarch64 -L /TOOLCHAIN_PATH/TARGET_LIBRAY_PATH\" \\\n+cargo run --target loongarch64-unknown-linux-gnu --release\n+```\n+Tested on x86 architecture, other architectures not tested.\n+\n+## Building Rust programs\n+\n+Rust does not yet ship pre-compiled artifacts for this target. To compile for this target, you will either need to build Rust with the target enabled (see \"Building the target\" above), or build your own copy of `std` by using `build-std` or similar.\n+\n+If `rustc` has support for that target and the library artifacts are available, then Rust static libraries can be built for that target:\n+\n+```shell\n+$ rustc --target loongarch64-unknown-linux-gnu your-code.rs --crate-type staticlib\n+$ ls libyour_code.a\n+```\n+\n+On Rust Nightly it's possible to build without the target artifacts available:\n+\n+```text\n+cargo build -Z build-std --target loongarch64-unknown-linux-gnu\n+```"}, {"sha": "5ca4d3b3de741a2b7d01e522cc3c65501ea33929", "filename": "tests/ui/check-cfg/compact-values.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ad26dab27cd314d13e64fe5b49cfa5260a57ab53/tests%2Fui%2Fcheck-cfg%2Fcompact-values.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ad26dab27cd314d13e64fe5b49cfa5260a57ab53/tests%2Fui%2Fcheck-cfg%2Fcompact-values.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcheck-cfg%2Fcompact-values.stderr?ref=ad26dab27cd314d13e64fe5b49cfa5260a57ab53", "patch": "@@ -4,7 +4,7 @@ warning: unexpected `cfg` condition value\n LL | #[cfg(target(os = \"linux\", arch = \"X\"))]\n    |                            ^^^^^^^^^^\n    |\n-   = note: expected values for `target_arch` are: aarch64, arm, avr, bpf, hexagon, m68k, mips, mips64, msp430, nvptx64, powerpc, powerpc64, riscv32, riscv64, s390x, sparc, sparc64, wasm32, wasm64, x86, x86_64\n+   = note: expected values for `target_arch` are: aarch64, arm, avr, bpf, hexagon, loongarch64, m68k, mips, mips64, msp430, nvptx64, powerpc, powerpc64, riscv32, riscv64, s390x, sparc, sparc64, wasm32, wasm64, x86, x86_64\n    = note: `#[warn(unexpected_cfgs)]` on by default\n \n warning: 1 warning emitted"}]}