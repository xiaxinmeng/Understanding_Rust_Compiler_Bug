{"sha": "a8f68240d391dd885c13766e6152a79d758c1440", "node_id": "C_kwDOAAsO6NoAKGE4ZjY4MjQwZDM5MWRkODg1YzEzNzY2ZTYxNTJhNzlkNzU4YzE0NDA", "commit": {"author": {"name": "dswij", "email": "dswijj@gmail.com", "date": "2022-06-24T10:00:06Z"}, "committer": {"name": "dswij", "email": "dswijj@gmail.com", "date": "2022-06-24T10:07:59Z"}, "message": "Add test for `extra_unused_lifetimes` FP on derive\n\nThis commit adds test for a `extra_unused_lifetimes` false positive from derive (#9014).\n\nThe fix for the FP is introduced in #9037.", "tree": {"sha": "4421a6c4eb329e466512605a704343f0a1f0abe0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4421a6c4eb329e466512605a704343f0a1f0abe0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a8f68240d391dd885c13766e6152a79d758c1440", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a8f68240d391dd885c13766e6152a79d758c1440", "html_url": "https://github.com/rust-lang/rust/commit/a8f68240d391dd885c13766e6152a79d758c1440", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a8f68240d391dd885c13766e6152a79d758c1440/comments", "author": {"login": "dswij", "id": 44697459, "node_id": "MDQ6VXNlcjQ0Njk3NDU5", "avatar_url": "https://avatars.githubusercontent.com/u/44697459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dswij", "html_url": "https://github.com/dswij", "followers_url": "https://api.github.com/users/dswij/followers", "following_url": "https://api.github.com/users/dswij/following{/other_user}", "gists_url": "https://api.github.com/users/dswij/gists{/gist_id}", "starred_url": "https://api.github.com/users/dswij/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dswij/subscriptions", "organizations_url": "https://api.github.com/users/dswij/orgs", "repos_url": "https://api.github.com/users/dswij/repos", "events_url": "https://api.github.com/users/dswij/events{/privacy}", "received_events_url": "https://api.github.com/users/dswij/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dswij", "id": 44697459, "node_id": "MDQ6VXNlcjQ0Njk3NDU5", "avatar_url": "https://avatars.githubusercontent.com/u/44697459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dswij", "html_url": "https://github.com/dswij", "followers_url": "https://api.github.com/users/dswij/followers", "following_url": "https://api.github.com/users/dswij/following{/other_user}", "gists_url": "https://api.github.com/users/dswij/gists{/gist_id}", "starred_url": "https://api.github.com/users/dswij/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dswij/subscriptions", "organizations_url": "https://api.github.com/users/dswij/orgs", "repos_url": "https://api.github.com/users/dswij/repos", "events_url": "https://api.github.com/users/dswij/events{/privacy}", "received_events_url": "https://api.github.com/users/dswij/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1d1ae10876d3eaa5c982dd3daa083b7c2fc363b9", "url": "https://api.github.com/repos/rust-lang/rust/commits/1d1ae10876d3eaa5c982dd3daa083b7c2fc363b9", "html_url": "https://github.com/rust-lang/rust/commit/1d1ae10876d3eaa5c982dd3daa083b7c2fc363b9"}], "stats": {"total": 38, "additions": 32, "deletions": 6}, "files": [{"sha": "a89a06308d093a6e7cfef00df57ce43992ec9210", "filename": "tests/ui/auxiliary/proc_macro_derive.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/a8f68240d391dd885c13766e6152a79d758c1440/tests%2Fui%2Fauxiliary%2Fproc_macro_derive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a8f68240d391dd885c13766e6152a79d758c1440/tests%2Fui%2Fauxiliary%2Fproc_macro_derive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fauxiliary%2Fproc_macro_derive.rs?ref=a8f68240d391dd885c13766e6152a79d758c1440", "patch": "@@ -72,3 +72,17 @@ pub fn mini_macro(_: TokenStream) -> TokenStream {\n         }\n     )\n }\n+\n+#[proc_macro_derive(ExtraLifetimeDerive)]\n+#[allow(unused)]\n+pub fn extra_lifetime(_input: TokenStream) -> TokenStream {\n+    quote!(\n+        pub struct ExtraLifetime;\n+\n+        impl<'b> ExtraLifetime {\n+            pub fn something<'c>() -> Self {\n+                Self\n+            }\n+        }\n+    )\n+}"}, {"sha": "d6631e01290009feee27ded294e324031b763be7", "filename": "tests/ui/extra_unused_lifetimes.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/a8f68240d391dd885c13766e6152a79d758c1440/tests%2Fui%2Fextra_unused_lifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a8f68240d391dd885c13766e6152a79d758c1440/tests%2Fui%2Fextra_unused_lifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fextra_unused_lifetimes.rs?ref=a8f68240d391dd885c13766e6152a79d758c1440", "patch": "@@ -1,3 +1,5 @@\n+// aux-build:proc_macro_derive.rs\n+\n #![allow(\n     unused,\n     dead_code,\n@@ -7,6 +9,9 @@\n )]\n #![warn(clippy::extra_unused_lifetimes)]\n \n+#[macro_use]\n+extern crate proc_macro_derive;\n+\n fn empty() {}\n \n fn used_lt<'a>(x: &'a u8) {}\n@@ -114,4 +119,11 @@ mod second_case {\n     }\n }\n \n+// Should not lint\n+#[derive(ExtraLifetimeDerive)]\n+struct Human<'a> {\n+    pub bones: i32,\n+    pub name: &'a str,\n+}\n+\n fn main() {}"}, {"sha": "26ebc3976dfca222642cc1557c89a2ad1c3e0da0", "filename": "tests/ui/extra_unused_lifetimes.stderr", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/a8f68240d391dd885c13766e6152a79d758c1440/tests%2Fui%2Fextra_unused_lifetimes.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a8f68240d391dd885c13766e6152a79d758c1440/tests%2Fui%2Fextra_unused_lifetimes.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fextra_unused_lifetimes.stderr?ref=a8f68240d391dd885c13766e6152a79d758c1440", "patch": "@@ -1,37 +1,37 @@\n error: this lifetime isn't used in the function definition\n-  --> $DIR/extra_unused_lifetimes.rs:14:14\n+  --> $DIR/extra_unused_lifetimes.rs:19:14\n    |\n LL | fn unused_lt<'a>(x: u8) {}\n    |              ^^\n    |\n    = note: `-D clippy::extra-unused-lifetimes` implied by `-D warnings`\n \n error: this lifetime isn't used in the function definition\n-  --> $DIR/extra_unused_lifetimes.rs:41:10\n+  --> $DIR/extra_unused_lifetimes.rs:46:10\n    |\n LL |     fn x<'a>(&self) {}\n    |          ^^\n \n error: this lifetime isn't used in the function definition\n-  --> $DIR/extra_unused_lifetimes.rs:67:22\n+  --> $DIR/extra_unused_lifetimes.rs:72:22\n    |\n LL |         fn unused_lt<'a>(x: u8) {}\n    |                      ^^\n \n error: this lifetime isn't used in the impl\n-  --> $DIR/extra_unused_lifetimes.rs:78:10\n+  --> $DIR/extra_unused_lifetimes.rs:83:10\n    |\n LL |     impl<'a> std::ops::AddAssign<&Scalar> for &mut Scalar {\n    |          ^^\n \n error: this lifetime isn't used in the impl\n-  --> $DIR/extra_unused_lifetimes.rs:84:10\n+  --> $DIR/extra_unused_lifetimes.rs:89:10\n    |\n LL |     impl<'b> Scalar {\n    |          ^^\n \n error: this lifetime isn't used in the function definition\n-  --> $DIR/extra_unused_lifetimes.rs:85:26\n+  --> $DIR/extra_unused_lifetimes.rs:90:26\n    |\n LL |         pub fn something<'c>() -> Self {\n    |                          ^^"}]}