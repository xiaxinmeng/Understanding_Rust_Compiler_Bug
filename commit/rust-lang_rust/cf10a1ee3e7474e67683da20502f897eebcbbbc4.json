{"sha": "cf10a1ee3e7474e67683da20502f897eebcbbbc4", "node_id": "C_kwDOAAsO6NoAKGNmMTBhMWVlM2U3NDc0ZTY3NjgzZGEyMDUwMmY4OTdlZWJjYmJiYzQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-06-01T14:31:14Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-06-01T14:31:14Z"}, "message": "Auto merge of #12440 - Maan2003:empty-msg-diag, r=jonas-schievink\n\nfix(diagnostic): Don't remove diagnostic with empty message\n\nUse \" \" as message if it is empty\n\n[discussion on zulip](https://rust-lang.zulipchat.com/#narrow/stream/185405-t-compiler.2Frust-analyzer/topic/empty.20diagnostic.20message)\n\n![image](https://user-images.githubusercontent.com/49202620/171412661-9b9575e9-e71b-4b84-a5c0-00271548d50c.png)", "tree": {"sha": "82f2ff982985427a3f08b17152ef925f12aeed39", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/82f2ff982985427a3f08b17152ef925f12aeed39"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cf10a1ee3e7474e67683da20502f897eebcbbbc4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cf10a1ee3e7474e67683da20502f897eebcbbbc4", "html_url": "https://github.com/rust-lang/rust/commit/cf10a1ee3e7474e67683da20502f897eebcbbbc4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cf10a1ee3e7474e67683da20502f897eebcbbbc4/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4f5c7aafffa5a424302275677da39f666f498d3e", "url": "https://api.github.com/repos/rust-lang/rust/commits/4f5c7aafffa5a424302275677da39f666f498d3e", "html_url": "https://github.com/rust-lang/rust/commit/4f5c7aafffa5a424302275677da39f666f498d3e"}, {"sha": "bad931116ef40e237185c0b57ab4d6f138a4aad2", "url": "https://api.github.com/repos/rust-lang/rust/commits/bad931116ef40e237185c0b57ab4d6f138a4aad2", "html_url": "https://github.com/rust-lang/rust/commit/bad931116ef40e237185c0b57ab4d6f138a4aad2"}], "stats": {"total": 9, "additions": 5, "deletions": 4}, "files": [{"sha": "8f779df18d3553ff21b3562f866727200be5dcd1", "filename": "crates/rust-analyzer/src/diagnostics/to_proto.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/cf10a1ee3e7474e67683da20502f897eebcbbbc4/crates%2Frust-analyzer%2Fsrc%2Fdiagnostics%2Fto_proto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf10a1ee3e7474e67683da20502f897eebcbbbc4/crates%2Frust-analyzer%2Fsrc%2Fdiagnostics%2Fto_proto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fdiagnostics%2Fto_proto.rs?ref=cf10a1ee3e7474e67683da20502f897eebcbbbc4", "patch": "@@ -462,9 +462,10 @@ pub(crate) fn map_rust_diagnostic_to_lsp(\n                 message: \"original diagnostic\".to_string(),\n             };\n             for sub in &subdiagnostics {\n-                // Filter out empty/non-existent messages, as they greatly confuse VS Code.\n-                if sub.related.message.is_empty() {\n-                    continue;\n+                let mut message = sub.related.message.clone();\n+                // Change empty message to \" \", as they greatly confuse VS Code.\n+                if message.is_empty() {\n+                    message = String::from(\" \");\n                 }\n                 diagnostics.push(MappedRustDiagnostic {\n                     url: sub.related.location.uri.clone(),\n@@ -475,7 +476,7 @@ pub(crate) fn map_rust_diagnostic_to_lsp(\n                         code: code.clone().map(lsp_types::NumberOrString::String),\n                         code_description: code_description.clone(),\n                         source: Some(source.clone()),\n-                        message: sub.related.message.clone(),\n+                        message,\n                         related_information: Some(vec![back_ref.clone()]),\n                         tags: None, // don't apply modifiers again\n                         data: None,"}]}