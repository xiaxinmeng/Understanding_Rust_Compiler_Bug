{"sha": "6eba66532c305973da2a3dc0648365150ba886b8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZlYmE2NjUzMmMzMDU5NzNkYTJhM2RjMDY0ODM2NTE1MGJhODg2Yjg=", "commit": {"author": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-01-08T16:31:27Z"}, "committer": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-01-08T16:47:01Z"}, "message": "Add regression test for useless_attribute lint", "tree": {"sha": "eedf2132f7bb64ed859d5800690ed9d0e397e7b6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eedf2132f7bb64ed859d5800690ed9d0e397e7b6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6eba66532c305973da2a3dc0648365150ba886b8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZxoS6lESXlRGMHWcaTCGhp1QZjcFAl4WB4UACgkQaTCGhp1Q\nZjdVIQ/8CFIS+FsPhvdHLHa3aNeT07o3N+W+aevAbfZNdlLu6YhEqeaczLDaTX6w\nNFzpmg3z3PWzgJHQ2oufmsbuSki2asMDcqtppVHyzbzj8WICbKgR+PFNaYT4ypiH\ngBMkUTUsj3qv8h6/ke2oTAke8+y8FqCYvIeoB12N1jnz37Yb33PUg7ZObM1JEVQd\n6/rK+NYoxVVxM6GxPKT68ojWmDlnOZA9Ez9r/mPzx/1qk9gDhThSB9gNyTAIq5s4\nesmPdd1/RHl0GaEW4HAEG46DtYa2uxJ+7VgJvH54pv42pkuOfWVbzAUyM/sKYkoR\n0uFj6T4LXytJ0N1CiJsLSfTozSlbZWWuLjTRxL1RmXvK+hTyEOxdvNhb5yHPbR5E\n5GeL/DdzbyxdnlcKXFwtV624JwRZRQEJ8wU4vHIKa/FfyiG8sENo5IYXnBCxHKmR\nswQggLq8of8SWDFa7w+mvOscmNeXIqqLm9CMBfBxpezxop9Myhh9MrCkU/M82Kbl\nNgnekMP3gEmBNfPI+EUmTaT8dnjOL8EOGmzAHn8nzcBArwkaBJWkmYXsSgbDVcDn\nx0WiGS3YmCDjmjMgnH3p7QvDWizUuW+u3sboqApZz9k4VRO+oO1VGQYDrB6Bp+IJ\nLauMif0b+vs9ULspdGfh4+Dqjo/WquEO/jbkROAu1tipPo5XeTU=\n=OVxY\n-----END PGP SIGNATURE-----", "payload": "tree eedf2132f7bb64ed859d5800690ed9d0e397e7b6\nparent 9ea17d42a7c5f089143e8b4ed37ee9de268a3bbb\nauthor flip1995 <hello@philkrones.com> 1578501087 +0100\ncommitter flip1995 <hello@philkrones.com> 1578502021 +0100\n\nAdd regression test for useless_attribute lint\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6eba66532c305973da2a3dc0648365150ba886b8", "html_url": "https://github.com/rust-lang/rust/commit/6eba66532c305973da2a3dc0648365150ba886b8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6eba66532c305973da2a3dc0648365150ba886b8/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9ea17d42a7c5f089143e8b4ed37ee9de268a3bbb", "url": "https://api.github.com/repos/rust-lang/rust/commits/9ea17d42a7c5f089143e8b4ed37ee9de268a3bbb", "html_url": "https://github.com/rust-lang/rust/commit/9ea17d42a7c5f089143e8b4ed37ee9de268a3bbb"}], "stats": {"total": 81, "additions": 77, "deletions": 4}, "files": [{"sha": "56811a998728c51a61d7e5f0a3371fc86bef432a", "filename": "tests/ui/useless_attribute.fixed", "status": "added", "additions": 57, "deletions": 0, "changes": 57, "blob_url": "https://github.com/rust-lang/rust/blob/6eba66532c305973da2a3dc0648365150ba886b8/tests%2Fui%2Fuseless_attribute.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/6eba66532c305973da2a3dc0648365150ba886b8/tests%2Fui%2Fuseless_attribute.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuseless_attribute.fixed?ref=6eba66532c305973da2a3dc0648365150ba886b8", "patch": "@@ -0,0 +1,57 @@\n+// run-rustfix\n+// aux-build:proc_macro_derive.rs\n+\n+#![warn(clippy::useless_attribute)]\n+#![warn(unreachable_pub)]\n+#![feature(rustc_private)]\n+\n+#![allow(dead_code)]\n+#![cfg_attr(feature = \"cargo-clippy\", allow(dead_code))]\n+#[rustfmt::skip]\n+#[allow(unused_imports)]\n+#[allow(unused_extern_crates)]\n+#[macro_use]\n+extern crate rustc;\n+\n+#[macro_use]\n+extern crate proc_macro_derive;\n+\n+// don't lint on unused_import for `use` items\n+#[allow(unused_imports)]\n+use std::collections;\n+\n+// don't lint on deprecated for `use` items\n+mod foo {\n+    #[deprecated]\n+    pub struct Bar;\n+}\n+#[allow(deprecated)]\n+pub use foo::Bar;\n+\n+// This should not trigger the lint. There's lint level definitions inside the external derive\n+// that would trigger the useless_attribute lint.\n+#[derive(DeriveSomething)]\n+struct Baz;\n+\n+// don't lint on unreachable_pub for `use` items\n+mod a {\n+    mod b {\n+        #[allow(dead_code)]\n+        #[allow(unreachable_pub)]\n+        pub struct C {}\n+    }\n+\n+    #[allow(unreachable_pub)]\n+    pub use self::b::C;\n+}\n+\n+fn test_indented_attr() {\n+    #![allow(clippy::almost_swapped)]\n+    use std::collections::HashSet;\n+\n+    let _ = HashSet::<u32>::default();\n+}\n+\n+fn main() {\n+    test_indented_attr();\n+}"}, {"sha": "bbf5e495db4a775e3f7fb8132522ad7bde5d3cf2", "filename": "tests/ui/useless_attribute.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/6eba66532c305973da2a3dc0648365150ba886b8/tests%2Fui%2Fuseless_attribute.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6eba66532c305973da2a3dc0648365150ba886b8/tests%2Fui%2Fuseless_attribute.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuseless_attribute.rs?ref=6eba66532c305973da2a3dc0648365150ba886b8", "patch": "@@ -1,3 +1,4 @@\n+// run-rustfix\n // aux-build:proc_macro_derive.rs\n \n #![warn(clippy::useless_attribute)]\n@@ -44,4 +45,13 @@ mod a {\n     pub use self::b::C;\n }\n \n-fn main() {}\n+fn test_indented_attr() {\n+    #[allow(clippy::almost_swapped)]\n+    use std::collections::HashSet;\n+\n+    let _ = HashSet::<u32>::default();\n+}\n+\n+fn main() {\n+    test_indented_attr();\n+}"}, {"sha": "08a211b41a9133064000c2fb049bb87dbd498ea0", "filename": "tests/ui/useless_attribute.stderr", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/6eba66532c305973da2a3dc0648365150ba886b8/tests%2Fui%2Fuseless_attribute.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6eba66532c305973da2a3dc0648365150ba886b8/tests%2Fui%2Fuseless_attribute.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuseless_attribute.stderr?ref=6eba66532c305973da2a3dc0648365150ba886b8", "patch": "@@ -1,16 +1,22 @@\n error: useless lint attribute\n-  --> $DIR/useless_attribute.rs:7:1\n+  --> $DIR/useless_attribute.rs:8:1\n    |\n LL | #[allow(dead_code)]\n    | ^^^^^^^^^^^^^^^^^^^ help: if you just forgot a `!`, use: `#![allow(dead_code)]`\n    |\n    = note: `-D clippy::useless-attribute` implied by `-D warnings`\n \n error: useless lint attribute\n-  --> $DIR/useless_attribute.rs:8:1\n+  --> $DIR/useless_attribute.rs:9:1\n    |\n LL | #[cfg_attr(feature = \"cargo-clippy\", allow(dead_code))]\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: if you just forgot a `!`, use: `#![cfg_attr(feature = \"cargo-clippy\", allow(dead_code)`\n \n-error: aborting due to 2 previous errors\n+error: useless lint attribute\n+  --> $DIR/useless_attribute.rs:49:5\n+   |\n+LL |     #[allow(clippy::almost_swapped)]\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: if you just forgot a `!`, use: `#![allow(clippy::almost_swapped)]`\n+\n+error: aborting due to 3 previous errors\n "}]}