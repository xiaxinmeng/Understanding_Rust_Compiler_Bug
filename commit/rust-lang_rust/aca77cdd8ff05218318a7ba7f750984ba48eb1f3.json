{"sha": "aca77cdd8ff05218318a7ba7f750984ba48eb1f3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFjYTc3Y2RkOGZmMDUyMTgzMThhN2JhN2Y3NTA5ODRiYTQ4ZWIxZjM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-07-21T23:29:22Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-07-21T23:29:22Z"}, "message": "Auto merge of #74565 - pietroalbini:build-on-gha, r=Mark-Simulacrum\n\nUpload builds from GHA instead of Azure Pipelines\n\nThis PR does two things:\n\n* Enables RLA comments on PRs (needed after the switch to GHA in RLA).\n* Switches GitHub Actions as the CI authorized to upload non-macOS builds.\n\nNote that Docker/LLVM caches will likely be busted.\n\nr? @Mark-Simulacrum", "tree": {"sha": "793303f051db5359a2f749c557e6662bf5835b2c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/793303f051db5359a2f749c557e6662bf5835b2c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aca77cdd8ff05218318a7ba7f750984ba48eb1f3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aca77cdd8ff05218318a7ba7f750984ba48eb1f3", "html_url": "https://github.com/rust-lang/rust/commit/aca77cdd8ff05218318a7ba7f750984ba48eb1f3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aca77cdd8ff05218318a7ba7f750984ba48eb1f3/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8ad7bc3f428300aee6764f6e23527e19eb235e81", "url": "https://api.github.com/repos/rust-lang/rust/commits/8ad7bc3f428300aee6764f6e23527e19eb235e81", "html_url": "https://github.com/rust-lang/rust/commit/8ad7bc3f428300aee6764f6e23527e19eb235e81"}, {"sha": "750ad2097e8b4126484cd4600bfe8e8453da04fc", "url": "https://api.github.com/repos/rust-lang/rust/commits/750ad2097e8b4126484cd4600bfe8e8453da04fc", "html_url": "https://github.com/rust-lang/rust/commit/750ad2097e8b4126484cd4600bfe8e8453da04fc"}], "stats": {"total": 109, "additions": 78, "deletions": 31}, "files": [{"sha": "6e0808c0d58969089975d8f2f2f2868881a96712", "filename": ".github/workflows/ci.yml", "status": "modified", "additions": 44, "deletions": 24, "changes": 68, "blob_url": "https://github.com/rust-lang/rust/blob/aca77cdd8ff05218318a7ba7f750984ba48eb1f3/.github%2Fworkflows%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/aca77cdd8ff05218318a7ba7f750984ba48eb1f3/.github%2Fworkflows%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fci.yml?ref=aca77cdd8ff05218318a7ba7f750984ba48eb1f3", "patch": "@@ -32,9 +32,9 @@ jobs:\n     name: PR\n     env:\n       CI_JOB_NAME: \"${{ matrix.name }}\"\n-      SCCACHE_BUCKET: rust-lang-gha-caches\n-      TOOLSTATE_REPO: \"https://github.com/pietroalbini/rust-toolstate\"\n-      CACHE_DOMAIN: ci-caches-gha.rust-lang.org\n+      SCCACHE_BUCKET: rust-lang-ci-sccache2\n+      TOOLSTATE_REPO: \"https://github.com/rust-lang-nursery/rust-toolstate\"\n+      CACHE_DOMAIN: ci-caches.rust-lang.org\n     if: \"github.event_name == 'pull_request'\"\n     strategy:\n       matrix:\n@@ -63,6 +63,11 @@ jobs:\n         with:\n           github_token: \"${{ secrets.github_token }}\"\n         if: \"success() && !env.SKIP_JOB && github.ref != 'refs/heads/try'\"\n+      - name: configure the PR in which the error message will be posted\n+        run: \"echo \\\"[CI_PR_NUMBER=$num]\\\"\"\n+        env:\n+          num: \"${{ github.event.number }}\"\n+        if: \"success() && !env.SKIP_JOBS && github.event_name == 'pull_request'\"\n       - name: add extra environment variables\n         run: src/ci/scripts/setup-environment.sh\n         env:\n@@ -133,14 +138,14 @@ jobs:\n     name: try\n     env:\n       CI_JOB_NAME: \"${{ matrix.name }}\"\n-      SCCACHE_BUCKET: rust-lang-gha-caches\n-      DEPLOY_BUCKET: rust-lang-gha\n-      TOOLSTATE_REPO: \"https://github.com/pietroalbini/rust-toolstate\"\n-      TOOLSTATE_ISSUES_API_URL: \"https://api.github.com/repos/pietroalbini/rust-toolstate/issues\"\n+      SCCACHE_BUCKET: rust-lang-ci-sccache2\n+      DEPLOY_BUCKET: rust-lang-ci2\n+      TOOLSTATE_REPO: \"https://github.com/rust-lang-nursery/rust-toolstate\"\n+      TOOLSTATE_ISSUES_API_URL: \"https://api.github.com/repos/rust-lang/rust/issues\"\n       TOOLSTATE_PUBLISH: 1\n-      CACHES_AWS_ACCESS_KEY_ID: AKIA46X5W6CZOMUQATD5\n-      ARTIFACTS_AWS_ACCESS_KEY_ID: AKIA46X5W6CZH5AYXDVF\n-      CACHE_DOMAIN: ci-caches-gha.rust-lang.org\n+      CACHES_AWS_ACCESS_KEY_ID: AKIA46X5W6CZI5DHEBFL\n+      ARTIFACTS_AWS_ACCESS_KEY_ID: AKIA46X5W6CZN24CBO55\n+      CACHE_DOMAIN: ci-caches.rust-lang.org\n     if: \"github.event_name == 'push' && github.ref == 'refs/heads/try' && github.repository == 'rust-lang-ci/rust'\"\n     strategy:\n       matrix:\n@@ -162,6 +167,11 @@ jobs:\n         with:\n           github_token: \"${{ secrets.github_token }}\"\n         if: \"success() && !env.SKIP_JOB && github.ref != 'refs/heads/try'\"\n+      - name: configure the PR in which the error message will be posted\n+        run: \"echo \\\"[CI_PR_NUMBER=$num]\\\"\"\n+        env:\n+          num: \"${{ github.event.number }}\"\n+        if: \"success() && !env.SKIP_JOBS && github.event_name == 'pull_request'\"\n       - name: add extra environment variables\n         run: src/ci/scripts/setup-environment.sh\n         env:\n@@ -232,14 +242,14 @@ jobs:\n     name: auto\n     env:\n       CI_JOB_NAME: \"${{ matrix.name }}\"\n-      SCCACHE_BUCKET: rust-lang-gha-caches\n-      DEPLOY_BUCKET: rust-lang-gha\n-      TOOLSTATE_REPO: \"https://github.com/pietroalbini/rust-toolstate\"\n-      TOOLSTATE_ISSUES_API_URL: \"https://api.github.com/repos/pietroalbini/rust-toolstate/issues\"\n+      SCCACHE_BUCKET: rust-lang-ci-sccache2\n+      DEPLOY_BUCKET: rust-lang-ci2\n+      TOOLSTATE_REPO: \"https://github.com/rust-lang-nursery/rust-toolstate\"\n+      TOOLSTATE_ISSUES_API_URL: \"https://api.github.com/repos/rust-lang/rust/issues\"\n       TOOLSTATE_PUBLISH: 1\n-      CACHES_AWS_ACCESS_KEY_ID: AKIA46X5W6CZOMUQATD5\n-      ARTIFACTS_AWS_ACCESS_KEY_ID: AKIA46X5W6CZH5AYXDVF\n-      CACHE_DOMAIN: ci-caches-gha.rust-lang.org\n+      CACHES_AWS_ACCESS_KEY_ID: AKIA46X5W6CZI5DHEBFL\n+      ARTIFACTS_AWS_ACCESS_KEY_ID: AKIA46X5W6CZN24CBO55\n+      CACHE_DOMAIN: ci-caches.rust-lang.org\n     if: \"github.event_name == 'push' && github.ref == 'refs/heads/auto' && github.repository == 'rust-lang-ci/rust'\"\n     strategy:\n       matrix:\n@@ -479,6 +489,11 @@ jobs:\n         with:\n           github_token: \"${{ secrets.github_token }}\"\n         if: \"success() && !env.SKIP_JOB && github.ref != 'refs/heads/try'\"\n+      - name: configure the PR in which the error message will be posted\n+        run: \"echo \\\"[CI_PR_NUMBER=$num]\\\"\"\n+        env:\n+          num: \"${{ github.event.number }}\"\n+        if: \"success() && !env.SKIP_JOBS && github.event_name == 'pull_request'\"\n       - name: add extra environment variables\n         run: src/ci/scripts/setup-environment.sh\n         env:\n@@ -604,6 +619,11 @@ jobs:\n         with:\n           github_token: \"${{ secrets.github_token }}\"\n         if: \"success() && !env.SKIP_JOB && github.ref != 'refs/heads/try'\"\n+      - name: configure the PR in which the error message will be posted\n+        run: \"echo \\\"[CI_PR_NUMBER=$num]\\\"\"\n+        env:\n+          num: \"${{ github.event.number }}\"\n+        if: \"success() && !env.SKIP_JOBS && github.event_name == 'pull_request'\"\n       - name: add extra environment variables\n         run: src/ci/scripts/setup-environment.sh\n         env:\n@@ -674,14 +694,14 @@ jobs:\n     name: master\n     runs-on: ubuntu-latest\n     env:\n-      SCCACHE_BUCKET: rust-lang-gha-caches\n-      DEPLOY_BUCKET: rust-lang-gha\n-      TOOLSTATE_REPO: \"https://github.com/pietroalbini/rust-toolstate\"\n-      TOOLSTATE_ISSUES_API_URL: \"https://api.github.com/repos/pietroalbini/rust-toolstate/issues\"\n+      SCCACHE_BUCKET: rust-lang-ci-sccache2\n+      DEPLOY_BUCKET: rust-lang-ci2\n+      TOOLSTATE_REPO: \"https://github.com/rust-lang-nursery/rust-toolstate\"\n+      TOOLSTATE_ISSUES_API_URL: \"https://api.github.com/repos/rust-lang/rust/issues\"\n       TOOLSTATE_PUBLISH: 1\n-      CACHES_AWS_ACCESS_KEY_ID: AKIA46X5W6CZOMUQATD5\n-      ARTIFACTS_AWS_ACCESS_KEY_ID: AKIA46X5W6CZH5AYXDVF\n-      CACHE_DOMAIN: ci-caches-gha.rust-lang.org\n+      CACHES_AWS_ACCESS_KEY_ID: AKIA46X5W6CZI5DHEBFL\n+      ARTIFACTS_AWS_ACCESS_KEY_ID: AKIA46X5W6CZN24CBO55\n+      CACHE_DOMAIN: ci-caches.rust-lang.org\n     if: \"github.event_name == 'push' && github.ref == 'refs/heads/master' && github.repository == 'rust-lang-ci/rust'\"\n     steps:\n       - name: checkout the source code"}, {"sha": "63c3d44020f0cd3032bae382aefef2b8a0f04bf1", "filename": "src/ci/azure-pipelines/auto.yml", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/aca77cdd8ff05218318a7ba7f750984ba48eb1f3/src%2Fci%2Fazure-pipelines%2Fauto.yml", "raw_url": "https://github.com/rust-lang/rust/raw/aca77cdd8ff05218318a7ba7f750984ba48eb1f3/src%2Fci%2Fazure-pipelines%2Fauto.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fauto.yml?ref=aca77cdd8ff05218318a7ba7f750984ba48eb1f3", "patch": "@@ -18,7 +18,7 @@ trigger:\n   - auto\n \n variables:\n-- group: prod-credentials\n+- group: dummy-credentials\n \n jobs:\n - job: Linux\n@@ -79,6 +79,9 @@ jobs:\n     vmImage: macos-10.15\n   steps:\n   - template: steps/run.yml\n+  variables:\n+    # We're still uploading macOS builds from Azure Pipelines.\n+    - group: prod-credentials\n   strategy:\n     matrix:\n       # OSX builders running tests, these run the full test suite."}, {"sha": "13c55610e1a46afb6fecf64c2a6c4ff93df36c64", "filename": "src/ci/azure-pipelines/master.yml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aca77cdd8ff05218318a7ba7f750984ba48eb1f3/src%2Fci%2Fazure-pipelines%2Fmaster.yml", "raw_url": "https://github.com/rust-lang/rust/raw/aca77cdd8ff05218318a7ba7f750984ba48eb1f3/src%2Fci%2Fazure-pipelines%2Fmaster.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fmaster.yml?ref=aca77cdd8ff05218318a7ba7f750984ba48eb1f3", "patch": "@@ -18,7 +18,7 @@ trigger:\n   - master\n \n variables:\n-- group: prod-credentials\n+- group: dummy-credentials\n \n pool:\n   vmImage: ubuntu-16.04"}, {"sha": "eebc5ccdaf69cfbf4476286513c14af2843c0bc1", "filename": "src/ci/azure-pipelines/try.yml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/aca77cdd8ff05218318a7ba7f750984ba48eb1f3/src%2Fci%2Fazure-pipelines%2Ftry.yml", "raw_url": "https://github.com/rust-lang/rust/raw/aca77cdd8ff05218318a7ba7f750984ba48eb1f3/src%2Fci%2Fazure-pipelines%2Ftry.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Ftry.yml?ref=aca77cdd8ff05218318a7ba7f750984ba48eb1f3", "patch": "@@ -14,7 +14,7 @@ trigger:\n - try\n \n variables:\n-- group: prod-credentials\n+- group: dummy-credentials\n \n jobs:\n - job: Linux"}, {"sha": "425e34f1af624b91f89d594c0dbd34205b6d41a3", "filename": "src/ci/github-actions/ci.yml", "status": "modified", "additions": 28, "deletions": 4, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/aca77cdd8ff05218318a7ba7f750984ba48eb1f3/src%2Fci%2Fgithub-actions%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/aca77cdd8ff05218318a7ba7f750984ba48eb1f3/src%2Fci%2Fgithub-actions%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fgithub-actions%2Fci.yml?ref=aca77cdd8ff05218318a7ba7f750984ba48eb1f3", "patch": "@@ -35,11 +35,26 @@ x--expand-yaml-anchors--remove:\n     CI_JOB_NAME: ${{ matrix.name }}\n \n   - &public-variables\n-    SCCACHE_BUCKET: rust-lang-gha-caches\n-    TOOLSTATE_REPO: https://github.com/pietroalbini/rust-toolstate\n-    CACHE_DOMAIN: ci-caches-gha.rust-lang.org\n+    SCCACHE_BUCKET: rust-lang-ci-sccache2\n+    TOOLSTATE_REPO: https://github.com/rust-lang-nursery/rust-toolstate\n+    CACHE_DOMAIN: ci-caches.rust-lang.org\n \n   - &prod-variables\n+    SCCACHE_BUCKET: rust-lang-ci-sccache2\n+    DEPLOY_BUCKET: rust-lang-ci2\n+    TOOLSTATE_REPO: https://github.com/rust-lang-nursery/rust-toolstate\n+    TOOLSTATE_ISSUES_API_URL: https://api.github.com/repos/rust-lang/rust/issues\n+    TOOLSTATE_PUBLISH: 1\n+    # AWS_SECRET_ACCESS_KEYs are stored in GitHub's secrets storage, named\n+    # AWS_SECRET_ACCESS_KEY_<keyid>. Including the key id in the name allows to\n+    # rotate them in a single branch while keeping the old key in another\n+    # branch, which wouldn't be possible if the key was named with the kind\n+    # (caches, artifacts...).\n+    CACHES_AWS_ACCESS_KEY_ID: AKIA46X5W6CZI5DHEBFL\n+    ARTIFACTS_AWS_ACCESS_KEY_ID: AKIA46X5W6CZN24CBO55\n+    CACHE_DOMAIN: ci-caches.rust-lang.org\n+\n+  - &dummy-variables\n     SCCACHE_BUCKET: rust-lang-gha-caches\n     DEPLOY_BUCKET: rust-lang-gha\n     TOOLSTATE_REPO: https://github.com/pietroalbini/rust-toolstate\n@@ -92,6 +107,15 @@ x--expand-yaml-anchors--remove:\n         if: success() && !env.SKIP_JOB && github.ref != 'refs/heads/try'\n         <<: *step\n \n+      # Rust Log Analyzer can't currently detect the PR number of a GitHub\n+      # Actions build on its own, so a hint in the log message is needed to\n+      # point it in the right direction.\n+      - name: configure the PR in which the error message will be posted\n+        run: echo \"[CI_PR_NUMBER=$num]\"\n+        env:\n+          num: ${{ github.event.number }}\n+        if: success() && !env.SKIP_JOBS && github.event_name == 'pull_request'\n+\n       - name: add extra environment variables\n         run: src/ci/scripts/setup-environment.sh\n         env:\n@@ -556,7 +580,7 @@ jobs:\n     <<: *base-ci-job\n     name: auto-fallible\n     env:\n-      <<: [*shared-ci-variables, *prod-variables]\n+      <<: [*shared-ci-variables, *dummy-variables]\n     if: github.event_name == 'push' && github.ref == 'refs/heads/auto' && github.repository == 'rust-lang-ci/rust'\n     strategy:\n       matrix:"}]}