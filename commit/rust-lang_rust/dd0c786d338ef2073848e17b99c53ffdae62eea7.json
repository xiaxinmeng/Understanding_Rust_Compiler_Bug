{"sha": "dd0c786d338ef2073848e17b99c53ffdae62eea7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRkMGM3ODZkMzM4ZWYyMDczODQ4ZTE3Yjk5YzUzZmZkYWU2MmVlYTc=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-10-02T21:50:18Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-10-02T21:50:18Z"}, "message": "rollup merge of #17682 : nodakai/librustc-handy-version", "tree": {"sha": "5007ff9138fb9ef7f41393950dd6205e907aa0a8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5007ff9138fb9ef7f41393950dd6205e907aa0a8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dd0c786d338ef2073848e17b99c53ffdae62eea7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dd0c786d338ef2073848e17b99c53ffdae62eea7", "html_url": "https://github.com/rust-lang/rust/commit/dd0c786d338ef2073848e17b99c53ffdae62eea7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dd0c786d338ef2073848e17b99c53ffdae62eea7/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "51820b610e6147b737bbb8a6c9de810aea839148", "url": "https://api.github.com/repos/rust-lang/rust/commits/51820b610e6147b737bbb8a6c9de810aea839148", "html_url": "https://github.com/rust-lang/rust/commit/51820b610e6147b737bbb8a6c9de810aea839148"}, {"sha": "1dfb23f4cf5c8a7224cf9d71a0d0b74f22ad252d", "url": "https://api.github.com/repos/rust-lang/rust/commits/1dfb23f4cf5c8a7224cf9d71a0d0b74f22ad252d", "html_url": "https://github.com/rust-lang/rust/commit/1dfb23f4cf5c8a7224cf9d71a0d0b74f22ad252d"}], "stats": {"total": 24, "additions": 20, "deletions": 4}, "files": [{"sha": "cb671d6e85f6147a0f937140167e34f873937db1", "filename": "src/librustc/driver/mod.rs", "status": "modified", "additions": 20, "deletions": 4, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/dd0c786d338ef2073848e17b99c53ffdae62eea7/src%2Flibrustc%2Fdriver%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dd0c786d338ef2073848e17b99c53ffdae62eea7/src%2Flibrustc%2Fdriver%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdriver%2Fmod.rs?ref=dd0c786d338ef2073848e17b99c53ffdae62eea7", "patch": "@@ -125,6 +125,21 @@ fn run_compiler(args: &[String]) {\n     driver::compile_input(sess, cfg, &input, &odir, &ofile, None);\n }\n \n+/// Returns a version string such as \"0.12.0-dev\".\n+pub fn release_str() -> Option<&'static str> {\n+    option_env!(\"CFG_RELEASE\")\n+}\n+\n+/// Returns the full SHA1 hash of HEAD of the Git repo from which rustc was built.\n+pub fn commit_hash_str() -> Option<&'static str> {\n+    option_env!(\"CFG_VER_HASH\")\n+}\n+\n+/// Returns the \"commit date\" of HEAD of the Git repo from which rustc was built as a static string.\n+pub fn commit_date_str() -> Option<&'static str> {\n+    option_env!(\"CFG_VER_DATE\")\n+}\n+\n /// Prints version information and returns None on success or an error\n /// message on failure.\n pub fn version(binary: &str, matches: &getopts::Matches) -> Option<String> {\n@@ -134,13 +149,14 @@ pub fn version(binary: &str, matches: &getopts::Matches) -> Option<String> {\n         Some(s) => return Some(format!(\"Unrecognized argument: {}\", s))\n     };\n \n-    println!(\"{} {}\", binary, env!(\"CFG_VERSION\"));\n+    println!(\"{} {}\", binary, option_env!(\"CFG_VERSION\").unwrap_or(\"unknown version\"));\n     if verbose {\n+        fn unw(x: Option<&str>) -> &str { x.unwrap_or(\"unknown\") }\n         println!(\"binary: {}\", binary);\n-        println!(\"commit-hash: {}\", option_env!(\"CFG_VER_HASH\").unwrap_or(\"unknown\"));\n-        println!(\"commit-date: {}\", option_env!(\"CFG_VER_DATE\").unwrap_or(\"unknown\"));\n+        println!(\"commit-hash: {}\", unw(commit_hash_str()));\n+        println!(\"commit-date: {}\", unw(commit_date_str()));\n         println!(\"host: {}\", driver::host_triple());\n-        println!(\"release: {}\", env!(\"CFG_RELEASE\"));\n+        println!(\"release: {}\", unw(release_str()));\n     }\n     None\n }"}]}