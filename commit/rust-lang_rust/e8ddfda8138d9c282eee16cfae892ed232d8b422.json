{"sha": "e8ddfda8138d9c282eee16cfae892ed232d8b422", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU4ZGRmZGE4MTM4ZDljMjgyZWVlMTZjZmFlODkyZWQyMzJkOGI0MjI=", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-01-17T23:52:19Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-03-02T00:29:15Z"}, "message": "Improve error messages\n\n- Use `register_renamed` when rustdoc is running so the lint will still\n  be active and use a structured suggestion\n- Test the behavior for rustc, not just for rustdoc (because it differs)", "tree": {"sha": "2798e32cae0c9acbbc16e8e22a6c674b9eb5040d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2798e32cae0c9acbbc16e8e22a6c674b9eb5040d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e8ddfda8138d9c282eee16cfae892ed232d8b422", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e8ddfda8138d9c282eee16cfae892ed232d8b422", "html_url": "https://github.com/rust-lang/rust/commit/e8ddfda8138d9c282eee16cfae892ed232d8b422", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e8ddfda8138d9c282eee16cfae892ed232d8b422/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "719535576738ee97a866ce7fbf76a42d6399627b", "url": "https://api.github.com/repos/rust-lang/rust/commits/719535576738ee97a866ce7fbf76a42d6399627b", "html_url": "https://github.com/rust-lang/rust/commit/719535576738ee97a866ce7fbf76a42d6399627b"}], "stats": {"total": 58, "additions": 49, "deletions": 9}, "files": [{"sha": "86ad73d482f24e6b01440d333a7e7155800efe87", "filename": "compiler/rustc_lint/src/lib.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e8ddfda8138d9c282eee16cfae892ed232d8b422/compiler%2Frustc_lint%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e8ddfda8138d9c282eee16cfae892ed232d8b422/compiler%2Frustc_lint%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Flib.rs?ref=e8ddfda8138d9c282eee16cfae892ed232d8b422", "patch": "@@ -339,6 +339,10 @@ fn register_builtins(store: &mut LintStore, no_interleave_lints: bool) {\n         // FIXME: maybe we could get `register_renamed` to work for tool lints?\n         store.register_removed(rustdoc_lint, &format!(\"use `rustdoc::{}` instead\", rustdoc_lint));\n     }\n+    store.register_removed(\n+        \"intra_doc_link_resolution_failure\",\n+        \"use `rustdoc::broken_intra_doc_links` instead\",\n+    );\n \n     store.register_removed(\"unknown_features\", \"replaced by an error\");\n     store.register_removed(\"unsigned_negation\", \"replaced by negate_unsigned feature gate\");"}, {"sha": "7d95561d039f92916447794544a637a8f8336c87", "filename": "src/librustdoc/lint.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e8ddfda8138d9c282eee16cfae892ed232d8b422/src%2Flibrustdoc%2Flint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e8ddfda8138d9c282eee16cfae892ed232d8b422/src%2Flibrustdoc%2Flint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flint.rs?ref=e8ddfda8138d9c282eee16cfae892ed232d8b422", "patch": "@@ -167,6 +167,10 @@ crate fn register_lints(_sess: &Session, lint_store: &mut LintStore) {\n         None,\n         RUSTDOC_LINTS.iter().map(|&lint| LintId::of(lint)).collect(),\n     );\n+    for lint in &*RUSTDOC_LINTS {\n+        let name = lint.name_lower();\n+        lint_store.register_renamed(&name.replace(\"rustdoc::\", \"\"), &name);\n+    }\n     lint_store\n         .register_renamed(\"intra_doc_link_resolution_failure\", \"rustdoc::broken_intra_doc_links\");\n }"}, {"sha": "d2c78bc477410489814fa631bab847f78a8362e3", "filename": "src/test/rustdoc-ui/unknown-renamed-lints.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e8ddfda8138d9c282eee16cfae892ed232d8b422/src%2Ftest%2Frustdoc-ui%2Funknown-renamed-lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e8ddfda8138d9c282eee16cfae892ed232d8b422/src%2Ftest%2Frustdoc-ui%2Funknown-renamed-lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Funknown-renamed-lints.rs?ref=e8ddfda8138d9c282eee16cfae892ed232d8b422", "patch": "@@ -7,13 +7,11 @@\n #![deny(rustdoc::x)]\n //~^ ERROR unknown lint: `rustdoc::x`\n #![deny(intra_doc_link_resolution_failure)]\n-//~^ ERROR has been renamed\n+//~^ ERROR renamed to `rustdoc::broken_intra_doc_links`\n \n-// This would ideally say 'renamed to rustdoc::non_autolinks', but this is close enough.\n #![deny(non_autolinks)]\n-//~^ ERROR has been removed: use `rustdoc::non_autolinks` instead [renamed_and_removed_lints]\n+//~^ ERROR renamed to `rustdoc::non_autolinks`\n \n-// This doesn't give you the right code directly, but at least points you on the\n-// right path.\n+// Explicitly don't try to handle this case, it was never valid\n #![deny(rustdoc::intra_doc_link_resolution_failure)]\n //~^ ERROR unknown lint"}, {"sha": "0f31673fb47f27512e0dac0eab2de3b54c81ee55", "filename": "src/test/rustdoc-ui/unknown-renamed-lints.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/e8ddfda8138d9c282eee16cfae892ed232d8b422/src%2Ftest%2Frustdoc-ui%2Funknown-renamed-lints.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e8ddfda8138d9c282eee16cfae892ed232d8b422/src%2Ftest%2Frustdoc-ui%2Funknown-renamed-lints.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Funknown-renamed-lints.stderr?ref=e8ddfda8138d9c282eee16cfae892ed232d8b422", "patch": "@@ -28,14 +28,14 @@ note: the lint level is defined here\n LL | #![deny(renamed_and_removed_lints)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-error: lint `non_autolinks` has been removed: use `rustdoc::non_autolinks` instead\n-  --> $DIR/unknown-renamed-lints.rs:13:9\n+error: lint `non_autolinks` has been renamed to `rustdoc::non_autolinks`\n+  --> $DIR/unknown-renamed-lints.rs:12:9\n    |\n LL | #![deny(non_autolinks)]\n-   |         ^^^^^^^^^^^^^\n+   |         ^^^^^^^^^^^^^ help: use the new name: `rustdoc::non_autolinks`\n \n error: unknown lint: `rustdoc::intra_doc_link_resolution_failure`\n-  --> $DIR/unknown-renamed-lints.rs:18:9\n+  --> $DIR/unknown-renamed-lints.rs:16:9\n    |\n LL | #![deny(rustdoc::intra_doc_link_resolution_failure)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^"}, {"sha": "71e88bd7f54a5a65dd09d2dd0eb55f8e4a5862d4", "filename": "src/test/ui/lint/rustdoc-renamed.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/e8ddfda8138d9c282eee16cfae892ed232d8b422/src%2Ftest%2Fui%2Flint%2Frustdoc-renamed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e8ddfda8138d9c282eee16cfae892ed232d8b422/src%2Ftest%2Fui%2Flint%2Frustdoc-renamed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Frustdoc-renamed.rs?ref=e8ddfda8138d9c282eee16cfae892ed232d8b422", "patch": "@@ -0,0 +1,14 @@\n+#![crate_type = \"lib\"]\n+\n+#![deny(unknown_lints)]\n+#![deny(renamed_and_removed_lints)]\n+//~^ NOTE lint level is defined\n+\n+// both allowed, since the compiler doesn't yet know what rustdoc lints are valid\n+#![deny(rustdoc::x)]\n+#![deny(rustdoc::intra_doc_link_resolution_failure)]\n+\n+#![deny(intra_doc_link_resolution_failure)]\n+//~^ ERROR removed: use `rustdoc::broken_intra_doc_links`\n+#![deny(non_autolinks)]\n+//~^ ERROR removed: use `rustdoc::non_autolinks`"}, {"sha": "a7fe3e29d5be08a463ec60f3acb484eb609a744a", "filename": "src/test/ui/lint/rustdoc-renamed.stderr", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/e8ddfda8138d9c282eee16cfae892ed232d8b422/src%2Ftest%2Fui%2Flint%2Frustdoc-renamed.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e8ddfda8138d9c282eee16cfae892ed232d8b422/src%2Ftest%2Fui%2Flint%2Frustdoc-renamed.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Frustdoc-renamed.stderr?ref=e8ddfda8138d9c282eee16cfae892ed232d8b422", "patch": "@@ -0,0 +1,20 @@\n+error: lint `intra_doc_link_resolution_failure` has been removed: use `rustdoc::broken_intra_doc_links` instead\n+  --> $DIR/rustdoc-renamed.rs:11:9\n+   |\n+LL | #![deny(intra_doc_link_resolution_failure)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+note: the lint level is defined here\n+  --> $DIR/rustdoc-renamed.rs:4:9\n+   |\n+LL | #![deny(renamed_and_removed_lints)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: lint `non_autolinks` has been removed: use `rustdoc::non_autolinks` instead\n+  --> $DIR/rustdoc-renamed.rs:13:9\n+   |\n+LL | #![deny(non_autolinks)]\n+   |         ^^^^^^^^^^^^^\n+\n+error: aborting due to 2 previous errors\n+"}]}