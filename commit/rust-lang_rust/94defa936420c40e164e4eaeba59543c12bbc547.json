{"sha": "94defa936420c40e164e4eaeba59543c12bbc547", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk0ZGVmYTkzNjQyMGM0MGUxNjRlNGVhZWJhNTk1NDNjMTJiYmM1NDc=", "commit": {"author": {"name": "gnzlbg", "email": "gonzalobg88@gmail.com", "date": "2019-02-08T14:23:48Z"}, "committer": {"name": "gnzlbg", "email": "gonzalobg88@gmail.com", "date": "2019-02-08T15:53:53Z"}, "message": "Add simd_saturating_{add,sub} intrinsics", "tree": {"sha": "81ec947bb9c31c0f19163a2010e3709032648638", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/81ec947bb9c31c0f19163a2010e3709032648638"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/94defa936420c40e164e4eaeba59543c12bbc547", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/94defa936420c40e164e4eaeba59543c12bbc547", "html_url": "https://github.com/rust-lang/rust/commit/94defa936420c40e164e4eaeba59543c12bbc547", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/94defa936420c40e164e4eaeba59543c12bbc547/comments", "author": {"login": "gnzlbg", "id": 904614, "node_id": "MDQ6VXNlcjkwNDYxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/904614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gnzlbg", "html_url": "https://github.com/gnzlbg", "followers_url": "https://api.github.com/users/gnzlbg/followers", "following_url": "https://api.github.com/users/gnzlbg/following{/other_user}", "gists_url": "https://api.github.com/users/gnzlbg/gists{/gist_id}", "starred_url": "https://api.github.com/users/gnzlbg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gnzlbg/subscriptions", "organizations_url": "https://api.github.com/users/gnzlbg/orgs", "repos_url": "https://api.github.com/users/gnzlbg/repos", "events_url": "https://api.github.com/users/gnzlbg/events{/privacy}", "received_events_url": "https://api.github.com/users/gnzlbg/received_events", "type": "User", "site_admin": false}, "committer": {"login": "gnzlbg", "id": 904614, "node_id": "MDQ6VXNlcjkwNDYxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/904614?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gnzlbg", "html_url": "https://github.com/gnzlbg", "followers_url": "https://api.github.com/users/gnzlbg/followers", "following_url": "https://api.github.com/users/gnzlbg/following{/other_user}", "gists_url": "https://api.github.com/users/gnzlbg/gists{/gist_id}", "starred_url": "https://api.github.com/users/gnzlbg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gnzlbg/subscriptions", "organizations_url": "https://api.github.com/users/gnzlbg/orgs", "repos_url": "https://api.github.com/users/gnzlbg/repos", "events_url": "https://api.github.com/users/gnzlbg/events{/privacy}", "received_events_url": "https://api.github.com/users/gnzlbg/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d1731801163df1d3a8d4ddfa68adac2ec833ef7f", "url": "https://api.github.com/repos/rust-lang/rust/commits/d1731801163df1d3a8d4ddfa68adac2ec833ef7f", "html_url": "https://github.com/rust-lang/rust/commit/d1731801163df1d3a8d4ddfa68adac2ec833ef7f"}], "stats": {"total": 904, "additions": 895, "deletions": 9}, "files": [{"sha": "2ed338f491add7be9139fa790cf36b5dc2ae4607", "filename": "src/librustc_codegen_llvm/context.rs", "status": "modified", "additions": 18, "deletions": 8, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/94defa936420c40e164e4eaeba59543c12bbc547/src%2Flibrustc_codegen_llvm%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94defa936420c40e164e4eaeba59543c12bbc547/src%2Flibrustc_codegen_llvm%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fcontext.rs?ref=94defa936420c40e164e4eaeba59543c12bbc547", "patch": "@@ -510,14 +510,24 @@ impl CodegenCx<'b, 'tcx> {\n         let t_f32 = self.type_f32();\n         let t_f64 = self.type_f64();\n \n-        let t_v2f32 = self.type_vector(t_f32, 2);\n-        let t_v4f32 = self.type_vector(t_f32, 4);\n-        let t_v8f32 = self.type_vector(t_f32, 8);\n-        let t_v16f32 = self.type_vector(t_f32, 16);\n-\n-        let t_v2f64 = self.type_vector(t_f64, 2);\n-        let t_v4f64 = self.type_vector(t_f64, 4);\n-        let t_v8f64 = self.type_vector(t_f64, 8);\n+        macro_rules! vector_types {\n+            ($id_out:ident: $elem_ty:ident, $len:expr) => {\n+                let $id_out = self.type_vector($elem_ty, $len);\n+            };\n+            ($($id_out:ident: $elem_ty:ident, $len:expr;)*) => {\n+                $(vector_types!($id_out: $elem_ty, $len);)*\n+            }\n+        }\n+        vector_types! {\n+            t_v2f32: t_f32, 2;\n+            t_v4f32: t_f32, 4;\n+            t_v8f32: t_f32, 8;\n+            t_v16f32: t_f32, 16;\n+\n+            t_v2f64: t_f64, 2;\n+            t_v4f64: t_f64, 4;\n+            t_v8f64: t_f64, 8;\n+        }\n \n         ifn!(\"llvm.memset.p0i8.i16\", fn(i8p, t_i8, t_i16, t_i32, i1) -> void);\n         ifn!(\"llvm.memset.p0i8.i32\", fn(i8p, t_i8, t_i32, t_i32, i1) -> void);"}, {"sha": "161cd7170c502e50d649eb2e1103567a144e5c0d", "filename": "src/librustc_codegen_llvm/intrinsic.rs", "status": "modified", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/94defa936420c40e164e4eaeba59543c12bbc547/src%2Flibrustc_codegen_llvm%2Fintrinsic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94defa936420c40e164e4eaeba59543c12bbc547/src%2Flibrustc_codegen_llvm%2Fintrinsic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fintrinsic.rs?ref=94defa936420c40e164e4eaeba59543c12bbc547", "patch": "@@ -1850,7 +1850,52 @@ unsupported {} from `{}` with element `{}` of size `{}` to `{}`\"#,\n         simd_xor: Uint, Int => xor;\n         simd_fmax: Float => maxnum;\n         simd_fmin: Float => minnum;\n+\n+    }\n+\n+    if name == \"simd_saturating_add\" || name == \"simd_saturating_sub\" {\n+        let lhs = args[0].immediate();\n+        let rhs = args[1].immediate();\n+        let is_add = name == \"simd_saturating_add\";\n+        let ptr_bits = bx.tcx().data_layout.pointer_size.bits() as _;\n+        let (signed, elem_width, elem_ty) = match in_elem.sty {\n+            ty::Int(i) =>\n+                (\n+                    true,\n+                    i.bit_width().unwrap_or(ptr_bits),\n+                    bx.cx.type_int_from_ty(i)\n+                ),\n+            ty::Uint(i) =>\n+                (\n+                    false,\n+                    i.bit_width().unwrap_or(ptr_bits),\n+                    bx.cx.type_uint_from_ty(i)\n+                ),\n+            _ => {\n+                return_error!(\n+                    \"expected element type `{}` of vector type `{}` \\\n+                     to be a signed or unsigned integer type\",\n+                    arg_tys[0].simd_type(tcx).sty, arg_tys[0]\n+                );\n+            }\n+        };\n+        let llvm_intrinsic = &format!(\n+            \"llvm.{}{}.sat.v{}i{}\",\n+            if signed { 's' } else { 'u' },\n+            if is_add { \"add\" } else { \"sub\" },\n+            in_len, elem_width\n+        );\n+        let vec_ty = bx.cx.type_vector(elem_ty, in_len as u64);\n+\n+        let f = bx.declare_cfn(\n+            &llvm_intrinsic,\n+            bx.type_func(&[vec_ty, vec_ty], vec_ty)\n+        );\n+        llvm::SetUnnamedAddr(f, false);\n+        let v = bx.call(f, &[lhs, rhs], None);\n+        return Ok(v);\n     }\n+\n     span_bug!(span, \"unknown SIMD intrinsic\");\n }\n "}, {"sha": "037527f82f6bc77fa8bdbb3a931f9529cd3538ad", "filename": "src/librustc_typeck/check/intrinsic.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/94defa936420c40e164e4eaeba59543c12bbc547/src%2Flibrustc_typeck%2Fcheck%2Fintrinsic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94defa936420c40e164e4eaeba59543c12bbc547/src%2Flibrustc_typeck%2Fcheck%2Fintrinsic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fintrinsic.rs?ref=94defa936420c40e164e4eaeba59543c12bbc547", "patch": "@@ -410,7 +410,8 @@ pub fn check_platform_intrinsic_type<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n         \"simd_add\" | \"simd_sub\" | \"simd_mul\" | \"simd_rem\" |\n         \"simd_div\" | \"simd_shl\" | \"simd_shr\" |\n         \"simd_and\" | \"simd_or\" | \"simd_xor\" |\n-        \"simd_fmin\" | \"simd_fmax\" | \"simd_fpow\" => {\n+        \"simd_fmin\" | \"simd_fmax\" | \"simd_fpow\" |\n+        \"simd_saturating_add\" | \"simd_saturating_sub\" => {\n             (1, vec![param(0), param(0)], param(0))\n         }\n         \"simd_fsqrt\" | \"simd_fsin\" | \"simd_fcos\" | \"simd_fexp\" | \"simd_fexp2\" |"}, {"sha": "adee796d2475a19302082318c19a93dfef86bf48", "filename": "src/test/codegen/simd-intrinsic/simd-intrinsic-generic-arithmetic-saturating.rs", "status": "added", "additions": 685, "deletions": 0, "changes": 685, "blob_url": "https://github.com/rust-lang/rust/blob/94defa936420c40e164e4eaeba59543c12bbc547/src%2Ftest%2Fcodegen%2Fsimd-intrinsic%2Fsimd-intrinsic-generic-arithmetic-saturating.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94defa936420c40e164e4eaeba59543c12bbc547/src%2Ftest%2Fcodegen%2Fsimd-intrinsic%2Fsimd-intrinsic-generic-arithmetic-saturating.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fsimd-intrinsic%2Fsimd-intrinsic-generic-arithmetic-saturating.rs?ref=94defa936420c40e164e4eaeba59543c12bbc547", "patch": "@@ -0,0 +1,685 @@\n+// compile-flags: -C no-prepopulate-passes\n+// ignore-tidy-linelength\n+\n+#![crate_type = \"lib\"]\n+\n+#![feature(repr_simd, platform_intrinsics)]\n+#![allow(non_camel_case_types)]\n+#![deny(unused)]\n+\n+// signed integer types\n+\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i8x2(i8, i8);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i8x4(i8, i8, i8, i8);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i8x8(\n+    i8, i8, i8, i8, i8, i8, i8, i8,\n+);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i8x16(\n+    i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8,\n+);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i8x32(\n+    i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8,\n+    i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8,\n+);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i8x64(\n+    i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8,\n+    i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8,\n+    i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8,\n+    i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8, i8,\n+);\n+\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i16x2(i16, i16);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i16x4(i16, i16, i16, i16);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i16x8(\n+    i16, i16, i16, i16, i16, i16, i16, i16,\n+);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i16x16(\n+    i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16,\n+);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i16x32(\n+    i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16,\n+    i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16, i16,\n+);\n+\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i32x2(i32, i32);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i32x4(i32, i32, i32, i32);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i32x8(\n+    i32, i32, i32, i32, i32, i32, i32, i32,\n+);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i32x16(\n+    i32, i32, i32, i32, i32, i32, i32, i32, i32, i32, i32, i32, i32, i32, i32, i32,\n+);\n+\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i64x2(i64, i64);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i64x4(i64, i64, i64, i64);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i64x8(\n+    i64, i64, i64, i64, i64, i64, i64, i64,\n+);\n+\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i128x2(i128, i128);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct i128x4(i128, i128, i128, i128);\n+\n+// unsigned integer types\n+\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u8x2(u8, u8);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u8x4(u8, u8, u8, u8);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u8x8(\n+    u8, u8, u8, u8, u8, u8, u8, u8,\n+);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u8x16(\n+    u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8,\n+);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u8x32(\n+    u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8,\n+    u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8,\n+);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u8x64(\n+    u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8,\n+    u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8,\n+    u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8,\n+    u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8, u8,\n+);\n+\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u16x2(u16, u16);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u16x4(u16, u16, u16, u16);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u16x8(\n+    u16, u16, u16, u16, u16, u16, u16, u16,\n+);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u16x16(\n+    u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16,\n+);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u16x32(\n+    u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16,\n+    u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16, u16,\n+);\n+\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u32x2(u32, u32);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u32x4(u32, u32, u32, u32);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u32x8(\n+    u32, u32, u32, u32, u32, u32, u32, u32,\n+);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u32x16(\n+    u32, u32, u32, u32, u32, u32, u32, u32, u32, u32, u32, u32, u32, u32, u32, u32,\n+);\n+\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u64x2(u64, u64);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u64x4(u64, u64, u64, u64);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u64x8(\n+    u64, u64, u64, u64, u64, u64, u64, u64,\n+);\n+\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u128x2(u128, u128);\n+#[repr(simd)] #[derive(Copy, Clone)] pub struct u128x4(u128, u128, u128, u128);\n+\n+extern \"platform-intrinsic\" {\n+    fn simd_saturating_add<T>(x: T, y: T) -> T;\n+    fn simd_saturating_sub<T>(x: T, y: T) -> T;\n+}\n+\n+// CHECK-LABEL: @sadd_i8x2\n+#[no_mangle]\n+pub unsafe fn sadd_i8x2(x: i8x2, y: i8x2) -> i8x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i8> @llvm.sadd.sat.v2i8(<2 x i8> %{{[0-9]+}}, <2 x i8> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i8x4\n+#[no_mangle]\n+pub unsafe fn sadd_i8x4(x: i8x4, y: i8x4) -> i8x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i8> @llvm.sadd.sat.v4i8(<4 x i8> %{{[0-9]+}}, <4 x i8> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i8x8\n+#[no_mangle]\n+pub unsafe fn sadd_i8x8(x: i8x8, y: i8x8) -> i8x8 {\n+    // CHECK: %{{[0-9]+}} = call <8 x i8> @llvm.sadd.sat.v8i8(<8 x i8> %{{[0-9]+}}, <8 x i8> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i8x16\n+#[no_mangle]\n+pub unsafe fn sadd_i8x16(x: i8x16, y: i8x16) -> i8x16 {\n+    // CHECK: %{{[0-9]+}} = call <16 x i8> @llvm.sadd.sat.v16i8(<16 x i8> %{{[0-9]+}}, <16 x i8> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i8x32\n+#[no_mangle]\n+pub unsafe fn sadd_i8x32(x: i8x32, y: i8x32) -> i8x32 {\n+    // CHECK: %{{[0-9]+}} = call <32 x i8> @llvm.sadd.sat.v32i8(<32 x i8> %{{[0-9]+}}, <32 x i8> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i8x64\n+#[no_mangle]\n+pub unsafe fn sadd_i8x64(x: i8x64, y: i8x64) -> i8x64 {\n+    // CHECK: %{{[0-9]+}} = call <64 x i8> @llvm.sadd.sat.v64i8(<64 x i8> %{{[0-9]+}}, <64 x i8> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i16x2\n+#[no_mangle]\n+pub unsafe fn sadd_i16x2(x: i16x2, y: i16x2) -> i16x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i16> @llvm.sadd.sat.v2i16(<2 x i16> %{{[0-9]+}}, <2 x i16> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i16x4\n+#[no_mangle]\n+pub unsafe fn sadd_i16x4(x: i16x4, y: i16x4) -> i16x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i16> @llvm.sadd.sat.v4i16(<4 x i16> %{{[0-9]+}}, <4 x i16> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i16x8\n+#[no_mangle]\n+pub unsafe fn sadd_i16x8(x: i16x8, y: i16x8) -> i16x8 {\n+    // CHECK: %{{[0-9]+}} = call <8 x i16> @llvm.sadd.sat.v8i16(<8 x i16> %{{[0-9]+}}, <8 x i16> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i16x16\n+#[no_mangle]\n+pub unsafe fn sadd_i16x16(x: i16x16, y: i16x16) -> i16x16 {\n+    // CHECK: %{{[0-9]+}} = call <16 x i16> @llvm.sadd.sat.v16i16(<16 x i16> %{{[0-9]+}}, <16 x i16> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i16x32\n+#[no_mangle]\n+pub unsafe fn sadd_i16x32(x: i16x32, y: i16x32) -> i16x32 {\n+    // CHECK: %{{[0-9]+}} = call <32 x i16> @llvm.sadd.sat.v32i16(<32 x i16> %{{[0-9]+}}, <32 x i16> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i32x2\n+#[no_mangle]\n+pub unsafe fn sadd_i32x2(x: i32x2, y: i32x2) -> i32x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i32> @llvm.sadd.sat.v2i32(<2 x i32> %{{[0-9]+}}, <2 x i32> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i32x4\n+#[no_mangle]\n+pub unsafe fn sadd_i32x4(x: i32x4, y: i32x4) -> i32x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i32> @llvm.sadd.sat.v4i32(<4 x i32> %{{[0-9]+}}, <4 x i32> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i32x8\n+#[no_mangle]\n+pub unsafe fn sadd_i32x8(x: i32x8, y: i32x8) -> i32x8 {\n+    // CHECK: %{{[0-9]+}} = call <8 x i32> @llvm.sadd.sat.v8i32(<8 x i32> %{{[0-9]+}}, <8 x i32> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i32x16\n+#[no_mangle]\n+pub unsafe fn sadd_i32x16(x: i32x16, y: i32x16) -> i32x16 {\n+    // CHECK: %{{[0-9]+}} = call <16 x i32> @llvm.sadd.sat.v16i32(<16 x i32> %{{[0-9]+}}, <16 x i32> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i64x2\n+#[no_mangle]\n+pub unsafe fn sadd_i64x2(x: i64x2, y: i64x2) -> i64x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i64> @llvm.sadd.sat.v2i64(<2 x i64> %{{[0-9]+}}, <2 x i64> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i64x4\n+#[no_mangle]\n+pub unsafe fn sadd_i64x4(x: i64x4, y: i64x4) -> i64x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i64> @llvm.sadd.sat.v4i64(<4 x i64> %{{[0-9]+}}, <4 x i64> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i64x8\n+#[no_mangle]\n+pub unsafe fn sadd_i64x8(x: i64x8, y: i64x8) -> i64x8 {\n+    // CHECK: %{{[0-9]+}} = call <8 x i64> @llvm.sadd.sat.v8i64(<8 x i64> %{{[0-9]+}}, <8 x i64> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i128x2\n+#[no_mangle]\n+pub unsafe fn sadd_i128x2(x: i128x2, y: i128x2) -> i128x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i128> @llvm.sadd.sat.v2i128(<2 x i128> %{{[0-9]+}}, <2 x i128> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @sadd_i128x4\n+#[no_mangle]\n+pub unsafe fn sadd_i128x4(x: i128x4, y: i128x4) -> i128x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i128> @llvm.sadd.sat.v4i128(<4 x i128> %{{[0-9]+}}, <4 x i128> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+\n+\n+// CHECK-LABEL: @uadd_u8x2\n+#[no_mangle]\n+pub unsafe fn uadd_u8x2(x: u8x2, y: u8x2) -> u8x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i8> @llvm.uadd.sat.v2i8(<2 x i8> %{{[0-9]+}}, <2 x i8> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u8x4\n+#[no_mangle]\n+pub unsafe fn uadd_u8x4(x: u8x4, y: u8x4) -> u8x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i8> @llvm.uadd.sat.v4i8(<4 x i8> %{{[0-9]+}}, <4 x i8> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u8x8\n+#[no_mangle]\n+pub unsafe fn uadd_u8x8(x: u8x8, y: u8x8) -> u8x8 {\n+    // CHECK: %{{[0-9]+}} = call <8 x i8> @llvm.uadd.sat.v8i8(<8 x i8> %{{[0-9]+}}, <8 x i8> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u8x16\n+#[no_mangle]\n+pub unsafe fn uadd_u8x16(x: u8x16, y: u8x16) -> u8x16 {\n+    // CHECK: %{{[0-9]+}} = call <16 x i8> @llvm.uadd.sat.v16i8(<16 x i8> %{{[0-9]+}}, <16 x i8> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u8x32\n+#[no_mangle]\n+pub unsafe fn uadd_u8x32(x: u8x32, y: u8x32) -> u8x32 {\n+    // CHECK: %{{[0-9]+}} = call <32 x i8> @llvm.uadd.sat.v32i8(<32 x i8> %{{[0-9]+}}, <32 x i8> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u8x64\n+#[no_mangle]\n+pub unsafe fn uadd_u8x64(x: u8x64, y: u8x64) -> u8x64 {\n+    // CHECK: %{{[0-9]+}} = call <64 x i8> @llvm.uadd.sat.v64i8(<64 x i8> %{{[0-9]+}}, <64 x i8> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u16x2\n+#[no_mangle]\n+pub unsafe fn uadd_u16x2(x: u16x2, y: u16x2) -> u16x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i16> @llvm.uadd.sat.v2i16(<2 x i16> %{{[0-9]+}}, <2 x i16> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u16x4\n+#[no_mangle]\n+pub unsafe fn uadd_u16x4(x: u16x4, y: u16x4) -> u16x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i16> @llvm.uadd.sat.v4i16(<4 x i16> %{{[0-9]+}}, <4 x i16> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u16x8\n+#[no_mangle]\n+pub unsafe fn uadd_u16x8(x: u16x8, y: u16x8) -> u16x8 {\n+    // CHECK: %{{[0-9]+}} = call <8 x i16> @llvm.uadd.sat.v8i16(<8 x i16> %{{[0-9]+}}, <8 x i16> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u16x16\n+#[no_mangle]\n+pub unsafe fn uadd_u16x16(x: u16x16, y: u16x16) -> u16x16 {\n+    // CHECK: %{{[0-9]+}} = call <16 x i16> @llvm.uadd.sat.v16i16(<16 x i16> %{{[0-9]+}}, <16 x i16> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u16x32\n+#[no_mangle]\n+pub unsafe fn uadd_u16x32(x: u16x32, y: u16x32) -> u16x32 {\n+    // CHECK: %{{[0-9]+}} = call <32 x i16> @llvm.uadd.sat.v32i16(<32 x i16> %{{[0-9]+}}, <32 x i16> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u32x2\n+#[no_mangle]\n+pub unsafe fn uadd_u32x2(x: u32x2, y: u32x2) -> u32x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i32> @llvm.uadd.sat.v2i32(<2 x i32> %{{[0-9]+}}, <2 x i32> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u32x4\n+#[no_mangle]\n+pub unsafe fn uadd_u32x4(x: u32x4, y: u32x4) -> u32x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i32> @llvm.uadd.sat.v4i32(<4 x i32> %{{[0-9]+}}, <4 x i32> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u32x8\n+#[no_mangle]\n+pub unsafe fn uadd_u32x8(x: u32x8, y: u32x8) -> u32x8 {\n+    // CHECK: %{{[0-9]+}} = call <8 x i32> @llvm.uadd.sat.v8i32(<8 x i32> %{{[0-9]+}}, <8 x i32> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u32x16\n+#[no_mangle]\n+pub unsafe fn uadd_u32x16(x: u32x16, y: u32x16) -> u32x16 {\n+    // CHECK: %{{[0-9]+}} = call <16 x i32> @llvm.uadd.sat.v16i32(<16 x i32> %{{[0-9]+}}, <16 x i32> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u64x2\n+#[no_mangle]\n+pub unsafe fn uadd_u64x2(x: u64x2, y: u64x2) -> u64x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i64> @llvm.uadd.sat.v2i64(<2 x i64> %{{[0-9]+}}, <2 x i64> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u64x4\n+#[no_mangle]\n+pub unsafe fn uadd_u64x4(x: u64x4, y: u64x4) -> u64x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i64> @llvm.uadd.sat.v4i64(<4 x i64> %{{[0-9]+}}, <4 x i64> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u64x8\n+#[no_mangle]\n+pub unsafe fn uadd_u64x8(x: u64x8, y: u64x8) -> u64x8 {\n+    // CHECK: %{{[0-9]+}} = call <8 x i64> @llvm.uadd.sat.v8i64(<8 x i64> %{{[0-9]+}}, <8 x i64> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u128x2\n+#[no_mangle]\n+pub unsafe fn uadd_u128x2(x: u128x2, y: u128x2) -> u128x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i128> @llvm.uadd.sat.v2i128(<2 x i128> %{{[0-9]+}}, <2 x i128> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+// CHECK-LABEL: @uadd_u128x4\n+#[no_mangle]\n+pub unsafe fn uadd_u128x4(x: u128x4, y: u128x4) -> u128x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i128> @llvm.uadd.sat.v4i128(<4 x i128> %{{[0-9]+}}, <4 x i128> %{{[0-9]+}})\n+    simd_saturating_add(x, y)\n+}\n+\n+\n+\n+\n+\n+// CHECK-LABEL: @ssub_i8x2\n+#[no_mangle]\n+pub unsafe fn ssub_i8x2(x: i8x2, y: i8x2) -> i8x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i8> @llvm.ssub.sat.v2i8(<2 x i8> %{{[0-9]+}}, <2 x i8> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i8x4\n+#[no_mangle]\n+pub unsafe fn ssub_i8x4(x: i8x4, y: i8x4) -> i8x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i8> @llvm.ssub.sat.v4i8(<4 x i8> %{{[0-9]+}}, <4 x i8> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i8x8\n+#[no_mangle]\n+pub unsafe fn ssub_i8x8(x: i8x8, y: i8x8) -> i8x8 {\n+    // CHECK: %{{[0-9]+}} = call <8 x i8> @llvm.ssub.sat.v8i8(<8 x i8> %{{[0-9]+}}, <8 x i8> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i8x16\n+#[no_mangle]\n+pub unsafe fn ssub_i8x16(x: i8x16, y: i8x16) -> i8x16 {\n+    // CHECK: %{{[0-9]+}} = call <16 x i8> @llvm.ssub.sat.v16i8(<16 x i8> %{{[0-9]+}}, <16 x i8> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i8x32\n+#[no_mangle]\n+pub unsafe fn ssub_i8x32(x: i8x32, y: i8x32) -> i8x32 {\n+    // CHECK: %{{[0-9]+}} = call <32 x i8> @llvm.ssub.sat.v32i8(<32 x i8> %{{[0-9]+}}, <32 x i8> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i8x64\n+#[no_mangle]\n+pub unsafe fn ssub_i8x64(x: i8x64, y: i8x64) -> i8x64 {\n+    // CHECK: %{{[0-9]+}} = call <64 x i8> @llvm.ssub.sat.v64i8(<64 x i8> %{{[0-9]+}}, <64 x i8> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i16x2\n+#[no_mangle]\n+pub unsafe fn ssub_i16x2(x: i16x2, y: i16x2) -> i16x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i16> @llvm.ssub.sat.v2i16(<2 x i16> %{{[0-9]+}}, <2 x i16> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i16x4\n+#[no_mangle]\n+pub unsafe fn ssub_i16x4(x: i16x4, y: i16x4) -> i16x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i16> @llvm.ssub.sat.v4i16(<4 x i16> %{{[0-9]+}}, <4 x i16> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i16x8\n+#[no_mangle]\n+pub unsafe fn ssub_i16x8(x: i16x8, y: i16x8) -> i16x8 {\n+    // CHECK: %{{[0-9]+}} = call <8 x i16> @llvm.ssub.sat.v8i16(<8 x i16> %{{[0-9]+}}, <8 x i16> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i16x16\n+#[no_mangle]\n+pub unsafe fn ssub_i16x16(x: i16x16, y: i16x16) -> i16x16 {\n+    // CHECK: %{{[0-9]+}} = call <16 x i16> @llvm.ssub.sat.v16i16(<16 x i16> %{{[0-9]+}}, <16 x i16> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i16x32\n+#[no_mangle]\n+pub unsafe fn ssub_i16x32(x: i16x32, y: i16x32) -> i16x32 {\n+    // CHECK: %{{[0-9]+}} = call <32 x i16> @llvm.ssub.sat.v32i16(<32 x i16> %{{[0-9]+}}, <32 x i16> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i32x2\n+#[no_mangle]\n+pub unsafe fn ssub_i32x2(x: i32x2, y: i32x2) -> i32x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i32> @llvm.ssub.sat.v2i32(<2 x i32> %{{[0-9]+}}, <2 x i32> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i32x4\n+#[no_mangle]\n+pub unsafe fn ssub_i32x4(x: i32x4, y: i32x4) -> i32x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i32> @llvm.ssub.sat.v4i32(<4 x i32> %{{[0-9]+}}, <4 x i32> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i32x8\n+#[no_mangle]\n+pub unsafe fn ssub_i32x8(x: i32x8, y: i32x8) -> i32x8 {\n+    // CHECK: %{{[0-9]+}} = call <8 x i32> @llvm.ssub.sat.v8i32(<8 x i32> %{{[0-9]+}}, <8 x i32> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i32x16\n+#[no_mangle]\n+pub unsafe fn ssub_i32x16(x: i32x16, y: i32x16) -> i32x16 {\n+    // CHECK: %{{[0-9]+}} = call <16 x i32> @llvm.ssub.sat.v16i32(<16 x i32> %{{[0-9]+}}, <16 x i32> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i64x2\n+#[no_mangle]\n+pub unsafe fn ssub_i64x2(x: i64x2, y: i64x2) -> i64x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i64> @llvm.ssub.sat.v2i64(<2 x i64> %{{[0-9]+}}, <2 x i64> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i64x4\n+#[no_mangle]\n+pub unsafe fn ssub_i64x4(x: i64x4, y: i64x4) -> i64x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i64> @llvm.ssub.sat.v4i64(<4 x i64> %{{[0-9]+}}, <4 x i64> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i64x8\n+#[no_mangle]\n+pub unsafe fn ssub_i64x8(x: i64x8, y: i64x8) -> i64x8 {\n+    // CHECK: %{{[0-9]+}} = call <8 x i64> @llvm.ssub.sat.v8i64(<8 x i64> %{{[0-9]+}}, <8 x i64> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i128x2\n+#[no_mangle]\n+pub unsafe fn ssub_i128x2(x: i128x2, y: i128x2) -> i128x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i128> @llvm.ssub.sat.v2i128(<2 x i128> %{{[0-9]+}}, <2 x i128> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @ssub_i128x4\n+#[no_mangle]\n+pub unsafe fn ssub_i128x4(x: i128x4, y: i128x4) -> i128x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i128> @llvm.ssub.sat.v4i128(<4 x i128> %{{[0-9]+}}, <4 x i128> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+\n+\n+// CHECK-LABEL: @usub_u8x2\n+#[no_mangle]\n+pub unsafe fn usub_u8x2(x: u8x2, y: u8x2) -> u8x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i8> @llvm.usub.sat.v2i8(<2 x i8> %{{[0-9]+}}, <2 x i8> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u8x4\n+#[no_mangle]\n+pub unsafe fn usub_u8x4(x: u8x4, y: u8x4) -> u8x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i8> @llvm.usub.sat.v4i8(<4 x i8> %{{[0-9]+}}, <4 x i8> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u8x8\n+#[no_mangle]\n+pub unsafe fn usub_u8x8(x: u8x8, y: u8x8) -> u8x8 {\n+    // CHECK: %{{[0-9]+}} = call <8 x i8> @llvm.usub.sat.v8i8(<8 x i8> %{{[0-9]+}}, <8 x i8> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u8x16\n+#[no_mangle]\n+pub unsafe fn usub_u8x16(x: u8x16, y: u8x16) -> u8x16 {\n+    // CHECK: %{{[0-9]+}} = call <16 x i8> @llvm.usub.sat.v16i8(<16 x i8> %{{[0-9]+}}, <16 x i8> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u8x32\n+#[no_mangle]\n+pub unsafe fn usub_u8x32(x: u8x32, y: u8x32) -> u8x32 {\n+    // CHECK: %{{[0-9]+}} = call <32 x i8> @llvm.usub.sat.v32i8(<32 x i8> %{{[0-9]+}}, <32 x i8> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u8x64\n+#[no_mangle]\n+pub unsafe fn usub_u8x64(x: u8x64, y: u8x64) -> u8x64 {\n+    // CHECK: %{{[0-9]+}} = call <64 x i8> @llvm.usub.sat.v64i8(<64 x i8> %{{[0-9]+}}, <64 x i8> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u16x2\n+#[no_mangle]\n+pub unsafe fn usub_u16x2(x: u16x2, y: u16x2) -> u16x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i16> @llvm.usub.sat.v2i16(<2 x i16> %{{[0-9]+}}, <2 x i16> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u16x4\n+#[no_mangle]\n+pub unsafe fn usub_u16x4(x: u16x4, y: u16x4) -> u16x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i16> @llvm.usub.sat.v4i16(<4 x i16> %{{[0-9]+}}, <4 x i16> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u16x8\n+#[no_mangle]\n+pub unsafe fn usub_u16x8(x: u16x8, y: u16x8) -> u16x8 {\n+    // CHECK: %{{[0-9]+}} = call <8 x i16> @llvm.usub.sat.v8i16(<8 x i16> %{{[0-9]+}}, <8 x i16> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u16x16\n+#[no_mangle]\n+pub unsafe fn usub_u16x16(x: u16x16, y: u16x16) -> u16x16 {\n+    // CHECK: %{{[0-9]+}} = call <16 x i16> @llvm.usub.sat.v16i16(<16 x i16> %{{[0-9]+}}, <16 x i16> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u16x32\n+#[no_mangle]\n+pub unsafe fn usub_u16x32(x: u16x32, y: u16x32) -> u16x32 {\n+    // CHECK: %{{[0-9]+}} = call <32 x i16> @llvm.usub.sat.v32i16(<32 x i16> %{{[0-9]+}}, <32 x i16> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u32x2\n+#[no_mangle]\n+pub unsafe fn usub_u32x2(x: u32x2, y: u32x2) -> u32x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i32> @llvm.usub.sat.v2i32(<2 x i32> %{{[0-9]+}}, <2 x i32> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u32x4\n+#[no_mangle]\n+pub unsafe fn usub_u32x4(x: u32x4, y: u32x4) -> u32x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i32> @llvm.usub.sat.v4i32(<4 x i32> %{{[0-9]+}}, <4 x i32> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u32x8\n+#[no_mangle]\n+pub unsafe fn usub_u32x8(x: u32x8, y: u32x8) -> u32x8 {\n+    // CHECK: %{{[0-9]+}} = call <8 x i32> @llvm.usub.sat.v8i32(<8 x i32> %{{[0-9]+}}, <8 x i32> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u32x16\n+#[no_mangle]\n+pub unsafe fn usub_u32x16(x: u32x16, y: u32x16) -> u32x16 {\n+    // CHECK: %{{[0-9]+}} = call <16 x i32> @llvm.usub.sat.v16i32(<16 x i32> %{{[0-9]+}}, <16 x i32> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u64x2\n+#[no_mangle]\n+pub unsafe fn usub_u64x2(x: u64x2, y: u64x2) -> u64x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i64> @llvm.usub.sat.v2i64(<2 x i64> %{{[0-9]+}}, <2 x i64> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u64x4\n+#[no_mangle]\n+pub unsafe fn usub_u64x4(x: u64x4, y: u64x4) -> u64x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i64> @llvm.usub.sat.v4i64(<4 x i64> %{{[0-9]+}}, <4 x i64> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u64x8\n+#[no_mangle]\n+pub unsafe fn usub_u64x8(x: u64x8, y: u64x8) -> u64x8 {\n+    // CHECK: %{{[0-9]+}} = call <8 x i64> @llvm.usub.sat.v8i64(<8 x i64> %{{[0-9]+}}, <8 x i64> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u128x2\n+#[no_mangle]\n+pub unsafe fn usub_u128x2(x: u128x2, y: u128x2) -> u128x2 {\n+    // CHECK: %{{[0-9]+}} = call <2 x i128> @llvm.usub.sat.v2i128(<2 x i128> %{{[0-9]+}}, <2 x i128> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}\n+\n+// CHECK-LABEL: @usub_u128x4\n+#[no_mangle]\n+pub unsafe fn usub_u128x4(x: u128x4, y: u128x4) -> u128x4 {\n+    // CHECK: %{{[0-9]+}} = call <4 x i128> @llvm.usub.sat.v4i128(<4 x i128> %{{[0-9]+}}, <4 x i128> %{{[0-9]+}})\n+    simd_saturating_sub(x, y)\n+}"}, {"sha": "bfd78e0a5cc8dfa01445cae72687fa2c175d3319", "filename": "src/test/run-pass/simd/simd-intrinsic-generic-arithmetic-saturating.rs", "status": "added", "additions": 92, "deletions": 0, "changes": 92, "blob_url": "https://github.com/rust-lang/rust/blob/94defa936420c40e164e4eaeba59543c12bbc547/src%2Ftest%2Frun-pass%2Fsimd%2Fsimd-intrinsic-generic-arithmetic-saturating.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94defa936420c40e164e4eaeba59543c12bbc547/src%2Ftest%2Frun-pass%2Fsimd%2Fsimd-intrinsic-generic-arithmetic-saturating.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fsimd%2Fsimd-intrinsic-generic-arithmetic-saturating.rs?ref=94defa936420c40e164e4eaeba59543c12bbc547", "patch": "@@ -0,0 +1,92 @@\n+// run-pass\n+#![allow(non_camel_case_types)]\n+\n+// ignore-emscripten FIXME(#45351) hits an LLVM assert\n+\n+#![feature(repr_simd, platform_intrinsics)]\n+\n+#[repr(simd)]\n+#[derive(Copy, Clone, PartialEq, Debug)]\n+struct u32x4(pub u32, pub u32, pub u32, pub u32);\n+\n+#[repr(simd)]\n+#[derive(Copy, Clone, PartialEq, Debug)]\n+struct i32x4(pub i32, pub i32, pub i32, pub i32);\n+\n+extern \"platform-intrinsic\" {\n+    fn simd_saturating_add<T>(x: T, y: T) -> T;\n+    fn simd_saturating_sub<T>(x: T, y: T) -> T;\n+}\n+\n+fn main() {\n+    // unsigned\n+    {\n+        const M: u32 = u32::max_value();\n+\n+        let a = u32x4(1, 2, 3, 4);\n+        let b = u32x4(2, 4, 6, 8);\n+        let m = u32x4(M, M, M, M);\n+        let m1 = u32x4(M - 1, M - 1, M - 1, M - 1);\n+        let z = u32x4(0, 0, 0, 0);\n+\n+        unsafe {\n+            assert_eq!(simd_saturating_add(z, z), z);\n+            assert_eq!(simd_saturating_add(z, a), a);\n+            assert_eq!(simd_saturating_add(b, z), b);\n+            assert_eq!(simd_saturating_add(a, a), b);\n+            assert_eq!(simd_saturating_add(a, m), m);\n+            assert_eq!(simd_saturating_add(m, b), m);\n+            assert_eq!(simd_saturating_add(m1, a), m);\n+\n+            assert_eq!(simd_saturating_sub(b, z), b);\n+            assert_eq!(simd_saturating_sub(b, a), a);\n+            assert_eq!(simd_saturating_sub(a, a), z);\n+            assert_eq!(simd_saturating_sub(a, b), z);\n+            assert_eq!(simd_saturating_sub(a, m1), z);\n+            assert_eq!(simd_saturating_sub(b, m1), z);\n+        }\n+    }\n+\n+    // signed\n+    {\n+        const MIN: i32 = i32::min_value();\n+        const MAX: i32 = i32::max_value();\n+\n+        let a = i32x4(1, 2, 3, 4);\n+        let b = i32x4(2, 4, 6, 8);\n+        let c = i32x4(-1, -2, -3, -4);\n+        let d = i32x4(-2, -4, -6, -8);\n+\n+        let max = i32x4(MAX, MAX, MAX, MAX);\n+        let max1 = i32x4(MAX - 1, MAX - 1, MAX - 1, MAX - 1);\n+        let min = i32x4(MIN, MIN, MIN, MIN);\n+        let min1 = i32x4(MIN + 1, MIN + 1, MIN + 1, MIN + 1);\n+\n+        let z = i32x4(0, 0, 0, 0);\n+\n+        unsafe {\n+            assert_eq!(simd_saturating_add(z, z), z);\n+            assert_eq!(simd_saturating_add(z, a), a);\n+            assert_eq!(simd_saturating_add(b, z), b);\n+            assert_eq!(simd_saturating_add(a, a), b);\n+            assert_eq!(simd_saturating_add(a, max), max);\n+            assert_eq!(simd_saturating_add(max, b), max);\n+            assert_eq!(simd_saturating_add(max1, a), max);\n+            assert_eq!(simd_saturating_add(min1, z), min1);\n+            assert_eq!(simd_saturating_add(min, z), min);\n+            assert_eq!(simd_saturating_add(min1, c), min);\n+            assert_eq!(simd_saturating_add(min, c), min);\n+            assert_eq!(simd_saturating_add(min1, d), min);\n+            assert_eq!(simd_saturating_add(min, d), min);\n+\n+            assert_eq!(simd_saturating_sub(b, z), b);\n+            assert_eq!(simd_saturating_sub(b, a), a);\n+            assert_eq!(simd_saturating_sub(a, a), z);\n+            assert_eq!(simd_saturating_sub(a, b), c);\n+            assert_eq!(simd_saturating_sub(z, max), min1);\n+            assert_eq!(simd_saturating_sub(min1, z), min1);\n+            assert_eq!(simd_saturating_sub(min1, a), min);\n+            assert_eq!(simd_saturating_sub(min1, b), min);\n+        }\n+    }\n+}"}, {"sha": "65cf31f2f1fa6f0da7c4fd77a241eea239fbbf9b", "filename": "src/test/ui/simd-intrinsic/simd-intrinsic-generic-arithmetic-saturating.rs", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/94defa936420c40e164e4eaeba59543c12bbc547/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-generic-arithmetic-saturating.rs", "raw_url": "https://github.com/rust-lang/rust/raw/94defa936420c40e164e4eaeba59543c12bbc547/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-generic-arithmetic-saturating.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-generic-arithmetic-saturating.rs?ref=94defa936420c40e164e4eaeba59543c12bbc547", "patch": "@@ -0,0 +1,38 @@\n+// ignore-emscripten\n+// ignore-tidy-linelength\n+#![feature(repr_simd, platform_intrinsics)]\n+#![allow(non_camel_case_types)]\n+#[repr(simd)]\n+#[derive(Copy, Clone)]\n+pub struct i32x4(pub i32, pub i32, pub i32, pub i32);\n+\n+#[repr(simd)]\n+#[derive(Copy, Clone)]\n+pub struct x4<T>(pub T, pub T, pub T, pub T);\n+\n+#[repr(simd)]\n+#[derive(Copy, Clone)]\n+pub struct f32x4(pub f32, pub f32, pub f32, pub f32);\n+\n+extern \"platform-intrinsic\" {\n+    fn simd_saturating_add<T>(x: T, y: T) -> T;\n+    fn simd_saturating_sub<T>(x: T, y: T) -> T;\n+}\n+\n+fn main() {\n+    let x = i32x4(0, 0, 0, 0);\n+    let y = x4(0_usize, 0, 0, 0);\n+    let z = f32x4(0.0, 0.0, 0.0, 0.0);\n+\n+    unsafe {\n+        simd_saturating_add(x, x);\n+        simd_saturating_add(y, y);\n+        simd_saturating_sub(x, x);\n+        simd_saturating_sub(y, y);\n+\n+        simd_saturating_add(z, z);\n+        //~^ ERROR expected element type `f32` of vector type `f32x4` to be a signed or unsigned integer type\n+        simd_saturating_sub(z, z);\n+        //~^ ERROR expected element type `f32` of vector type `f32x4` to be a signed or unsigned integer type\n+    }\n+}"}, {"sha": "0e88540bcc8e509def586b61793f79569d419900", "filename": "src/test/ui/simd-intrinsic/simd-intrinsic-generic-arithmetic-saturating.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/94defa936420c40e164e4eaeba59543c12bbc547/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-generic-arithmetic-saturating.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/94defa936420c40e164e4eaeba59543c12bbc547/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-generic-arithmetic-saturating.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimd-intrinsic%2Fsimd-intrinsic-generic-arithmetic-saturating.stderr?ref=94defa936420c40e164e4eaeba59543c12bbc547", "patch": "@@ -0,0 +1,15 @@\n+error[E0511]: invalid monomorphization of `simd_saturating_add` intrinsic: expected element type `f32` of vector type `f32x4` to be a signed or unsigned integer type\n+  --> $DIR/simd-intrinsic-generic-arithmetic-saturating.rs:33:9\n+   |\n+LL |         simd_saturating_add(z, z);\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error[E0511]: invalid monomorphization of `simd_saturating_sub` intrinsic: expected element type `f32` of vector type `f32x4` to be a signed or unsigned integer type\n+  --> $DIR/simd-intrinsic-generic-arithmetic-saturating.rs:35:9\n+   |\n+LL |         simd_saturating_sub(z, z);\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0511`."}]}