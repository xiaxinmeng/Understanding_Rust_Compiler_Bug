{"sha": "0d8e9cd4df6d2a5e059168fac16d4de9e6eb62fe", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBkOGU5Y2Q0ZGY2ZDJhNWUwNTkxNjhmYWMxNmQ0ZGU5ZTZlYjYyZmU=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-10-04T10:41:58Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2018-10-05T07:46:12Z"}, "message": "Reapply the macro_rules disambiguation changes from master", "tree": {"sha": "3a9bef4548268adf538ac9ce0858832bfcc427ce", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3a9bef4548268adf538ac9ce0858832bfcc427ce"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0d8e9cd4df6d2a5e059168fac16d4de9e6eb62fe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0d8e9cd4df6d2a5e059168fac16d4de9e6eb62fe", "html_url": "https://github.com/rust-lang/rust/commit/0d8e9cd4df6d2a5e059168fac16d4de9e6eb62fe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0d8e9cd4df6d2a5e059168fac16d4de9e6eb62fe/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c29fb80c05a83def4eff6cfd32154e13bbb08341", "url": "https://api.github.com/repos/rust-lang/rust/commits/c29fb80c05a83def4eff6cfd32154e13bbb08341", "html_url": "https://github.com/rust-lang/rust/commit/c29fb80c05a83def4eff6cfd32154e13bbb08341"}], "stats": {"total": 27, "additions": 7, "deletions": 20}, "files": [{"sha": "6a9488226b1bdc61a35479268dcce8fee9cfaf16", "filename": "src/Cargo.lock", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0d8e9cd4df6d2a5e059168fac16d4de9e6eb62fe/src%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/0d8e9cd4df6d2a5e059168fac16d4de9e6eb62fe/src%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2FCargo.lock?ref=0d8e9cd4df6d2a5e059168fac16d4de9e6eb62fe", "patch": "@@ -2388,6 +2388,7 @@ name = \"rustc_resolve\"\n version = \"0.0.0\"\n dependencies = [\n  \"arena 0.0.0\",\n+ \"bitflags 1.0.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.4.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc 0.0.0\",\n  \"rustc_data_structures 0.0.0\","}, {"sha": "c31b558dedea03452bebb1a0010ec62f01465332", "filename": "src/librustc_resolve/macros.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/0d8e9cd4df6d2a5e059168fac16d4de9e6eb62fe/src%2Flibrustc_resolve%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0d8e9cd4df6d2a5e059168fac16d4de9e6eb62fe/src%2Flibrustc_resolve%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fmacros.rs?ref=0d8e9cd4df6d2a5e059168fac16d4de9e6eb62fe", "patch": "@@ -642,7 +642,7 @@ impl<'a, 'cl> Resolver<'a, 'cl> {\n                 }\n                 WhereToResolve::MacroRules(legacy_scope) => match legacy_scope {\n                     LegacyScope::Binding(legacy_binding) if ident == legacy_binding.ident =>\n-                        Ok((legacy_binding.binding, Flags::MACRO_RULES, Flags::MODULE)),\n+                        Ok((legacy_binding.binding, Flags::MACRO_RULES, Flags::empty())),\n                     _ => Err(Determinacy::Determined),\n                 }\n                 WhereToResolve::Module(module) => {\n@@ -804,7 +804,10 @@ impl<'a, 'cl> Resolver<'a, 'cl> {\n                            (innermost_binding.is_glob_import() ||\n                             innermost_binding.may_appear_after(parent_scope.expansion, binding) ||\n                             innermost_flags.intersects(ambig_flags) ||\n-                            flags.intersects(innermost_ambig_flags)) {\n+                            flags.intersects(innermost_ambig_flags) ||\n+                            (innermost_flags.contains(Flags::MACRO_RULES) &&\n+                             flags.contains(Flags::MODULE) &&\n+                             !self.disambiguate_legacy_vs_modern(innermost_binding, binding))) {\n                             self.ambiguity_errors.push(AmbiguityError {\n                                 ident,\n                                 b1: innermost_binding,"}, {"sha": "209d449dfd84016acb13a3417fe0293c86ccf6b6", "filename": "src/test/ui/imports/macros.stderr", "status": "modified", "additions": 1, "deletions": 18, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/0d8e9cd4df6d2a5e059168fac16d4de9e6eb62fe/src%2Ftest%2Fui%2Fimports%2Fmacros.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0d8e9cd4df6d2a5e059168fac16d4de9e6eb62fe/src%2Ftest%2Fui%2Fimports%2Fmacros.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fmacros.stderr?ref=0d8e9cd4df6d2a5e059168fac16d4de9e6eb62fe", "patch": "@@ -34,23 +34,6 @@ LL |     use two_macros::m;\n    |         ^^^^^^^^^^^^^\n    = note: macro-expanded macro imports do not shadow\n \n-error[E0659]: `m` is ambiguous\n-  --> $DIR/macros.rs:48:5\n-   |\n-LL |     m!(); //~ ERROR ambiguous\n-   |     ^ ambiguous name\n-   |\n-note: `m` could refer to the name defined here\n-  --> $DIR/macros.rs:46:5\n-   |\n-LL |     macro_rules! m { () => {} }\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-note: `m` could also refer to the name imported here\n-  --> $DIR/macros.rs:47:9\n-   |\n-LL |     use two_macros::m;\n-   |         ^^^^^^^^^^^^^\n-\n-error: aborting due to 3 previous errors\n+error: aborting due to 2 previous errors\n \n For more information about this error, try `rustc --explain E0659`."}]}