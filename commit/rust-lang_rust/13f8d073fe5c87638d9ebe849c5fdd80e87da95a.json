{"sha": "13f8d073fe5c87638d9ebe849c5fdd80e87da95a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjEzZjhkMDczZmU1Yzg3NjM4ZDllYmU4NDljNWZkZDgwZTg3ZGE5NWE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-06-11T10:43:20Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-06-11T10:43:20Z"}, "message": "Auto merge of #51480 - dtolnay:lifetime, r=kennytm\n\nEnable fall through past $:lifetime matcher\n\n```rust\nmacro_rules! is_lifetime {\n    ($lifetime:lifetime) => { true };\n    ($other:tt) => { false };\n}\n\nfn main() {\n    println!(\"{}\", is_lifetime!('lifetime));\n    println!(\"{}\", is_lifetime!(@));\n}\n```\n\nBefore this fix, the `is_lifetime!` invocation would fail to compile with:\n\n```\nerror: expected a lifetime, found `@`\n --> src/main.rs:8:33\n  |\n8 |     println!(\"{}\", is_lifetime!(@));\n  |                                 ^\n```\n\nFixes #50903.\nFixes #51477.\n\nr? @kennytm", "tree": {"sha": "0d0471bcb122e2d35c2ad951a2555c6f08e3da20", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0d0471bcb122e2d35c2ad951a2555c6f08e3da20"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/13f8d073fe5c87638d9ebe849c5fdd80e87da95a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/13f8d073fe5c87638d9ebe849c5fdd80e87da95a", "html_url": "https://github.com/rust-lang/rust/commit/13f8d073fe5c87638d9ebe849c5fdd80e87da95a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/13f8d073fe5c87638d9ebe849c5fdd80e87da95a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "18a00bd9855421a74f40a29fcb4dd2e0c8bea59f", "url": "https://api.github.com/repos/rust-lang/rust/commits/18a00bd9855421a74f40a29fcb4dd2e0c8bea59f", "html_url": "https://github.com/rust-lang/rust/commit/18a00bd9855421a74f40a29fcb4dd2e0c8bea59f"}, {"sha": "987020846ce40ce479df3d62adc47ca4609a5317", "url": "https://api.github.com/repos/rust-lang/rust/commits/987020846ce40ce479df3d62adc47ca4609a5317", "html_url": "https://github.com/rust-lang/rust/commit/987020846ce40ce479df3d62adc47ca4609a5317"}], "stats": {"total": 53, "additions": 52, "deletions": 1}, "files": [{"sha": "fe458fa9977a5552f6c1d6f6f9f862dbf614e8df", "filename": "src/libsyntax/ext/tt/macro_parser.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/13f8d073fe5c87638d9ebe849c5fdd80e87da95a/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_parser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/13f8d073fe5c87638d9ebe849c5fdd80e87da95a/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_parser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Ftt%2Fmacro_parser.rs?ref=13f8d073fe5c87638d9ebe849c5fdd80e87da95a", "patch": "@@ -827,6 +827,14 @@ fn may_begin_with(name: &str, token: &Token) -> bool {\n             Token::Interpolated(ref nt) => may_be_ident(&nt.0),\n             _ => false,\n         },\n+        \"lifetime\" => match *token {\n+            Token::Lifetime(_) => true,\n+            Token::Interpolated(ref nt) => match nt.0 {\n+                token::NtLifetime(_) | token::NtTT(_) => true,\n+                _ => false,\n+            },\n+            _ => false,\n+        },\n         _ => match *token {\n             token::CloseDelim(_) => false,\n             _ => true,"}, {"sha": "647d7aaa759c31969232fbf5d7a60223e6619c2f", "filename": "src/test/compile-fail/macro-non-lifetime.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/13f8d073fe5c87638d9ebe849c5fdd80e87da95a/src%2Ftest%2Fcompile-fail%2Fmacro-non-lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/13f8d073fe5c87638d9ebe849c5fdd80e87da95a/src%2Ftest%2Fcompile-fail%2Fmacro-non-lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fmacro-non-lifetime.rs?ref=13f8d073fe5c87638d9ebe849c5fdd80e87da95a", "patch": "@@ -16,5 +16,5 @@ macro_rules! m { ($x:lifetime) => { } }\n \n fn main() {\n     m!(a);\n-    //~^ ERROR expected a lifetime, found `a`\n+    //~^ ERROR no rules expected the token `a`\n }"}, {"sha": "c371a33257f4e3fe373e81a9b6b78dd232d8d263", "filename": "src/test/run-pass/macro-first-set.rs", "status": "modified", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/13f8d073fe5c87638d9ebe849c5fdd80e87da95a/src%2Ftest%2Frun-pass%2Fmacro-first-set.rs", "raw_url": "https://github.com/rust-lang/rust/raw/13f8d073fe5c87638d9ebe849c5fdd80e87da95a/src%2Ftest%2Frun-pass%2Fmacro-first-set.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fmacro-first-set.rs?ref=13f8d073fe5c87638d9ebe849c5fdd80e87da95a", "patch": "@@ -199,6 +199,40 @@ fn test_24189() {\n \n //}}}\n \n+//{{{ issue 50903 ==============================================================\n+\n+macro_rules! foo_50903 {\n+    ($($lif:lifetime ,)* #) => {};\n+}\n+\n+foo_50903!('a, 'b, #);\n+foo_50903!('a, #);\n+foo_50903!(#);\n+\n+//}}}\n+\n+//{{{ issue 51477 ==============================================================\n+\n+macro_rules! foo_51477 {\n+    ($lifetime:lifetime) => {\n+        \"last token is lifetime\"\n+    };\n+    ($other:tt) => {\n+        \"last token is other\"\n+    };\n+    ($first:tt $($rest:tt)*) => {\n+        foo_51477!($($rest)*)\n+    };\n+}\n+\n+fn test_51477() {\n+    assert_eq!(\"last token is lifetime\", foo_51477!('a));\n+    assert_eq!(\"last token is other\", foo_51477!(@));\n+    assert_eq!(\"last token is lifetime\", foo_51477!(@ {} 'a));\n+}\n+\n+//}}}\n+\n //{{{ some more tests ==========================================================\n \n macro_rules! test_block {\n@@ -234,12 +268,21 @@ macro_rules! test_meta_block {\n \n test_meta_block!(windows {});\n \n+macro_rules! test_lifetime {\n+    (1. $($l:lifetime)* $($b:block)*) => {};\n+    (2. $($b:block)* $($l:lifetime)*) => {};\n+}\n+\n+test_lifetime!(1. 'a 'b {} {});\n+test_lifetime!(2. {} {} 'a 'b);\n+\n //}}}\n \n fn main() {\n     test_26444();\n     test_40569();\n     test_35650();\n     test_24189();\n+    test_51477();\n }\n "}]}