{"sha": "b5be09564188b39aa2fbc73b057c1e35e99ee99f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI1YmUwOTU2NDE4OGIzOWFhMmZiYzczYjA1N2MxZTM1ZTk5ZWU5OWY=", "commit": {"author": {"name": "Devon Hollowood", "email": "devonhollowood@gmail.com", "date": "2016-03-07T20:26:00Z"}, "committer": {"name": "Devon Hollowood", "email": "devonhollowood@gmail.com", "date": "2016-03-07T20:26:00Z"}, "message": "Improve tests for #26114", "tree": {"sha": "5ff26f26300841497cbfae158fb657f39b2da054", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5ff26f26300841497cbfae158fb657f39b2da054"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b5be09564188b39aa2fbc73b057c1e35e99ee99f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b5be09564188b39aa2fbc73b057c1e35e99ee99f", "html_url": "https://github.com/rust-lang/rust/commit/b5be09564188b39aa2fbc73b057c1e35e99ee99f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b5be09564188b39aa2fbc73b057c1e35e99ee99f/comments", "author": {"login": "devonhollowood", "id": 7864326, "node_id": "MDQ6VXNlcjc4NjQzMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/7864326?v=4", "gravatar_id": "", "url": "https://api.github.com/users/devonhollowood", "html_url": "https://github.com/devonhollowood", "followers_url": "https://api.github.com/users/devonhollowood/followers", "following_url": "https://api.github.com/users/devonhollowood/following{/other_user}", "gists_url": "https://api.github.com/users/devonhollowood/gists{/gist_id}", "starred_url": "https://api.github.com/users/devonhollowood/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/devonhollowood/subscriptions", "organizations_url": "https://api.github.com/users/devonhollowood/orgs", "repos_url": "https://api.github.com/users/devonhollowood/repos", "events_url": "https://api.github.com/users/devonhollowood/events{/privacy}", "received_events_url": "https://api.github.com/users/devonhollowood/received_events", "type": "User", "site_admin": false}, "committer": {"login": "devonhollowood", "id": 7864326, "node_id": "MDQ6VXNlcjc4NjQzMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/7864326?v=4", "gravatar_id": "", "url": "https://api.github.com/users/devonhollowood", "html_url": "https://github.com/devonhollowood", "followers_url": "https://api.github.com/users/devonhollowood/followers", "following_url": "https://api.github.com/users/devonhollowood/following{/other_user}", "gists_url": "https://api.github.com/users/devonhollowood/gists{/gist_id}", "starred_url": "https://api.github.com/users/devonhollowood/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/devonhollowood/subscriptions", "organizations_url": "https://api.github.com/users/devonhollowood/orgs", "repos_url": "https://api.github.com/users/devonhollowood/repos", "events_url": "https://api.github.com/users/devonhollowood/events{/privacy}", "received_events_url": "https://api.github.com/users/devonhollowood/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ffe5162cd1605228a1dae798953a5ea6b8f2e97f", "url": "https://api.github.com/repos/rust-lang/rust/commits/ffe5162cd1605228a1dae798953a5ea6b8f2e97f", "html_url": "https://github.com/rust-lang/rust/commit/ffe5162cd1605228a1dae798953a5ea6b8f2e97f"}], "stats": {"total": 27, "additions": 22, "deletions": 5}, "files": [{"sha": "3bbc107e0b99e20bdbc227f0bbdad29aaecd4d95", "filename": "src/test/run-pass/enum-discrim-manual-sizing.rs", "status": "modified", "additions": 22, "deletions": 5, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/b5be09564188b39aa2fbc73b057c1e35e99ee99f/src%2Ftest%2Frun-pass%2Fenum-discrim-manual-sizing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b5be09564188b39aa2fbc73b057c1e35e99ee99f/src%2Ftest%2Frun-pass%2Fenum-discrim-manual-sizing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fenum-discrim-manual-sizing.rs?ref=b5be09564188b39aa2fbc73b057c1e35e99ee99f", "patch": "@@ -9,7 +9,7 @@\n // except according to those terms.\n \n \n-use std::mem::size_of;\n+use std::mem::{size_of, align_of};\n \n #[repr(i8)]\n enum Ei8 {\n@@ -71,14 +71,20 @@ enum Euint {\n     Buint = 1\n }\n \n+#[repr(u8)]\n+enum Eu8NonCLike<T> {\n+    _None,\n+    _Some(T),\n+}\n+\n #[repr(i64)]\n-enum Ei64_non_c_like<T> {\n+enum Ei64NonCLike<T> {\n     _None,\n     _Some(T),\n }\n \n #[repr(u64)]\n-enum Eu64_non_c_like<T> {\n+enum Eu64NonCLike<T> {\n     _None,\n     _Some(T),\n }\n@@ -94,6 +100,17 @@ pub fn main() {\n     assert_eq!(size_of::<Eu64>(), 8);\n     assert_eq!(size_of::<Eint>(), size_of::<isize>());\n     assert_eq!(size_of::<Euint>(), size_of::<usize>());\n-    assert_eq!(size_of::<Ei64_non_c_like<()>>(), 8);\n-    assert_eq!(size_of::<Eu64_non_c_like<()>>(), 8);\n+    assert_eq!(size_of::<Eu8NonCLike<()>>(), 1);\n+    assert_eq!(size_of::<Ei64NonCLike<()>>(), 8);\n+    assert_eq!(size_of::<Eu64NonCLike<()>>(), 8);\n+    let u8_expected_size = round_up(9, align_of::<Eu64NonCLike<u8>>());\n+    assert_eq!(size_of::<Eu64NonCLike<u8>>(), u8_expected_size);\n+    let array_expected_size = round_up(28, align_of::<Eu64NonCLike<[u32; 5]>>());\n+    assert_eq!(size_of::<Eu64NonCLike<[u32; 5]>>(), array_expected_size);\n+    assert_eq!(size_of::<Eu64NonCLike<[u32; 6]>>(), 32);\n+}\n+\n+// Rounds x up to the next multiple of a\n+fn round_up(x: usize, a: usize) -> usize {\n+    ((x + (a - 1)) / a) * a\n }"}]}