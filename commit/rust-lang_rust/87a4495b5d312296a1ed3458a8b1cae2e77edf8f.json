{"sha": "87a4495b5d312296a1ed3458a8b1cae2e77edf8f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg3YTQ0OTViNWQzMTIyOTZhMWVkMzQ1OGE4YjFjYWUyZTc3ZWRmOGY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-09-10T13:25:39Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-09-10T13:25:39Z"}, "message": "Auto merge of #6027 - flip1995:rustup, r=flip1995\n\nRustup\n\nr? `@ghost`\n\nchangelog: none", "tree": {"sha": "605641694373308a81ceeca2a976b79800498d35", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/605641694373308a81ceeca2a976b79800498d35"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/87a4495b5d312296a1ed3458a8b1cae2e77edf8f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/87a4495b5d312296a1ed3458a8b1cae2e77edf8f", "html_url": "https://github.com/rust-lang/rust/commit/87a4495b5d312296a1ed3458a8b1cae2e77edf8f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/87a4495b5d312296a1ed3458a8b1cae2e77edf8f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e0f46a19bc97261bb896d0c00a6986740739e409", "url": "https://api.github.com/repos/rust-lang/rust/commits/e0f46a19bc97261bb896d0c00a6986740739e409", "html_url": "https://github.com/rust-lang/rust/commit/e0f46a19bc97261bb896d0c00a6986740739e409"}, {"sha": "2d56512580919483268c3e3bf2e028c8614805f2", "url": "https://api.github.com/repos/rust-lang/rust/commits/2d56512580919483268c3e3bf2e028c8614805f2", "html_url": "https://github.com/rust-lang/rust/commit/2d56512580919483268c3e3bf2e028c8614805f2"}], "stats": {"total": 75, "additions": 21, "deletions": 54}, "files": [{"sha": "fb891866364ccbc9730697e739d923681d9b8094", "filename": "clippy_lints/src/temporary_assignment.rs", "status": "modified", "additions": 3, "deletions": 8, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/87a4495b5d312296a1ed3458a8b1cae2e77edf8f/clippy_lints%2Fsrc%2Ftemporary_assignment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87a4495b5d312296a1ed3458a8b1cae2e77edf8f/clippy_lints%2Fsrc%2Ftemporary_assignment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftemporary_assignment.rs?ref=87a4495b5d312296a1ed3458a8b1cae2e77edf8f", "patch": "@@ -1,5 +1,4 @@\n use crate::utils::{is_adjusted, span_lint};\n-use rustc_hir::def::{DefKind, Res};\n use rustc_hir::{Expr, ExprKind};\n use rustc_lint::{LateContext, LateLintPass};\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n@@ -22,12 +21,8 @@ declare_clippy_lint! {\n     \"assignments to temporaries\"\n }\n \n-fn is_temporary(cx: &LateContext<'_>, expr: &Expr<'_>) -> bool {\n-    match &expr.kind {\n-        ExprKind::Struct(..) | ExprKind::Tup(..) => true,\n-        ExprKind::Path(qpath) => matches!(cx.qpath_res(qpath, expr.hir_id), Res::Def(DefKind::Const, ..)),\n-        _ => false,\n-    }\n+fn is_temporary(expr: &Expr<'_>) -> bool {\n+    matches!(&expr.kind, ExprKind::Struct(..) | ExprKind::Tup(..))\n }\n \n declare_lint_pass!(TemporaryAssignment => [TEMPORARY_ASSIGNMENT]);\n@@ -39,7 +34,7 @@ impl<'tcx> LateLintPass<'tcx> for TemporaryAssignment {\n             while let ExprKind::Field(f, _) | ExprKind::Index(f, _) = &base.kind {\n                 base = f;\n             }\n-            if is_temporary(cx, base) && !is_adjusted(cx, base) {\n+            if is_temporary(base) && !is_adjusted(cx, base) {\n                 span_lint(cx, TEMPORARY_ASSIGNMENT, expr.span, \"assignment to temporary\");\n             }\n         }"}, {"sha": "39f87510548503654c7a610837fed55c9ebc64de", "filename": "tests/ui/borrow_interior_mutable_const.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/87a4495b5d312296a1ed3458a8b1cae2e77edf8f/tests%2Fui%2Fborrow_interior_mutable_const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87a4495b5d312296a1ed3458a8b1cae2e77edf8f/tests%2Fui%2Fborrow_interior_mutable_const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fborrow_interior_mutable_const.rs?ref=87a4495b5d312296a1ed3458a8b1cae2e77edf8f", "patch": "@@ -1,5 +1,6 @@\n #![warn(clippy::borrow_interior_mutable_const)]\n #![allow(clippy::declare_interior_mutable_const, clippy::ref_in_deref)]\n+#![allow(const_item_mutation)]\n \n use std::borrow::Cow;\n use std::cell::{Cell, UnsafeCell};"}, {"sha": "5800af7e960f4da7247f652d0685bcaf3af32093", "filename": "tests/ui/borrow_interior_mutable_const.stderr", "status": "modified", "additions": 16, "deletions": 16, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/87a4495b5d312296a1ed3458a8b1cae2e77edf8f/tests%2Fui%2Fborrow_interior_mutable_const.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/87a4495b5d312296a1ed3458a8b1cae2e77edf8f/tests%2Fui%2Fborrow_interior_mutable_const.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fborrow_interior_mutable_const.stderr?ref=87a4495b5d312296a1ed3458a8b1cae2e77edf8f", "patch": "@@ -1,5 +1,5 @@\n error: a `const` item with interior mutability should not be borrowed\n-  --> $DIR/borrow_interior_mutable_const.rs:65:5\n+  --> $DIR/borrow_interior_mutable_const.rs:66:5\n    |\n LL |     ATOMIC.store(1, Ordering::SeqCst); //~ ERROR interior mutability\n    |     ^^^^^^\n@@ -8,119 +8,119 @@ LL |     ATOMIC.store(1, Ordering::SeqCst); //~ ERROR interior mutability\n    = help: assign this const to a local or static variable, and use the variable here\n \n error: a `const` item with interior mutability should not be borrowed\n-  --> $DIR/borrow_interior_mutable_const.rs:66:16\n+  --> $DIR/borrow_interior_mutable_const.rs:67:16\n    |\n LL |     assert_eq!(ATOMIC.load(Ordering::SeqCst), 5); //~ ERROR interior mutability\n    |                ^^^^^^\n    |\n    = help: assign this const to a local or static variable, and use the variable here\n \n error: a `const` item with interior mutability should not be borrowed\n-  --> $DIR/borrow_interior_mutable_const.rs:69:22\n+  --> $DIR/borrow_interior_mutable_const.rs:70:22\n    |\n LL |     let _once_ref = &ONCE_INIT; //~ ERROR interior mutability\n    |                      ^^^^^^^^^\n    |\n    = help: assign this const to a local or static variable, and use the variable here\n \n error: a `const` item with interior mutability should not be borrowed\n-  --> $DIR/borrow_interior_mutable_const.rs:70:25\n+  --> $DIR/borrow_interior_mutable_const.rs:71:25\n    |\n LL |     let _once_ref_2 = &&ONCE_INIT; //~ ERROR interior mutability\n    |                         ^^^^^^^^^\n    |\n    = help: assign this const to a local or static variable, and use the variable here\n \n error: a `const` item with interior mutability should not be borrowed\n-  --> $DIR/borrow_interior_mutable_const.rs:71:27\n+  --> $DIR/borrow_interior_mutable_const.rs:72:27\n    |\n LL |     let _once_ref_4 = &&&&ONCE_INIT; //~ ERROR interior mutability\n    |                           ^^^^^^^^^\n    |\n    = help: assign this const to a local or static variable, and use the variable here\n \n error: a `const` item with interior mutability should not be borrowed\n-  --> $DIR/borrow_interior_mutable_const.rs:72:26\n+  --> $DIR/borrow_interior_mutable_const.rs:73:26\n    |\n LL |     let _once_mut = &mut ONCE_INIT; //~ ERROR interior mutability\n    |                          ^^^^^^^^^\n    |\n    = help: assign this const to a local or static variable, and use the variable here\n \n error: a `const` item with interior mutability should not be borrowed\n-  --> $DIR/borrow_interior_mutable_const.rs:83:14\n+  --> $DIR/borrow_interior_mutable_const.rs:84:14\n    |\n LL |     let _ = &ATOMIC_TUPLE; //~ ERROR interior mutability\n    |              ^^^^^^^^^^^^\n    |\n    = help: assign this const to a local or static variable, and use the variable here\n \n error: a `const` item with interior mutability should not be borrowed\n-  --> $DIR/borrow_interior_mutable_const.rs:84:14\n+  --> $DIR/borrow_interior_mutable_const.rs:85:14\n    |\n LL |     let _ = &ATOMIC_TUPLE.0; //~ ERROR interior mutability\n    |              ^^^^^^^^^^^^\n    |\n    = help: assign this const to a local or static variable, and use the variable here\n \n error: a `const` item with interior mutability should not be borrowed\n-  --> $DIR/borrow_interior_mutable_const.rs:85:19\n+  --> $DIR/borrow_interior_mutable_const.rs:86:19\n    |\n LL |     let _ = &(&&&&ATOMIC_TUPLE).0; //~ ERROR interior mutability\n    |                   ^^^^^^^^^^^^\n    |\n    = help: assign this const to a local or static variable, and use the variable here\n \n error: a `const` item with interior mutability should not be borrowed\n-  --> $DIR/borrow_interior_mutable_const.rs:86:14\n+  --> $DIR/borrow_interior_mutable_const.rs:87:14\n    |\n LL |     let _ = &ATOMIC_TUPLE.0[0]; //~ ERROR interior mutability\n    |              ^^^^^^^^^^^^\n    |\n    = help: assign this const to a local or static variable, and use the variable here\n \n error: a `const` item with interior mutability should not be borrowed\n-  --> $DIR/borrow_interior_mutable_const.rs:87:13\n+  --> $DIR/borrow_interior_mutable_const.rs:88:13\n    |\n LL |     let _ = ATOMIC_TUPLE.0[0].load(Ordering::SeqCst); //~ ERROR interior mutability\n    |             ^^^^^^^^^^^^\n    |\n    = help: assign this const to a local or static variable, and use the variable here\n \n error: a `const` item with interior mutability should not be borrowed\n-  --> $DIR/borrow_interior_mutable_const.rs:93:13\n+  --> $DIR/borrow_interior_mutable_const.rs:94:13\n    |\n LL |     let _ = ATOMIC_TUPLE.0[0]; //~ ERROR interior mutability\n    |             ^^^^^^^^^^^^\n    |\n    = help: assign this const to a local or static variable, and use the variable here\n \n error: a `const` item with interior mutability should not be borrowed\n-  --> $DIR/borrow_interior_mutable_const.rs:98:5\n+  --> $DIR/borrow_interior_mutable_const.rs:99:5\n    |\n LL |     CELL.set(2); //~ ERROR interior mutability\n    |     ^^^^\n    |\n    = help: assign this const to a local or static variable, and use the variable here\n \n error: a `const` item with interior mutability should not be borrowed\n-  --> $DIR/borrow_interior_mutable_const.rs:99:16\n+  --> $DIR/borrow_interior_mutable_const.rs:100:16\n    |\n LL |     assert_eq!(CELL.get(), 6); //~ ERROR interior mutability\n    |                ^^^^\n    |\n    = help: assign this const to a local or static variable, and use the variable here\n \n error: a `const` item with interior mutability should not be borrowed\n-  --> $DIR/borrow_interior_mutable_const.rs:112:5\n+  --> $DIR/borrow_interior_mutable_const.rs:113:5\n    |\n LL |     u64::ATOMIC.store(5, Ordering::SeqCst); //~ ERROR interior mutability\n    |     ^^^^^^^^^^^\n    |\n    = help: assign this const to a local or static variable, and use the variable here\n \n error: a `const` item with interior mutability should not be borrowed\n-  --> $DIR/borrow_interior_mutable_const.rs:113:16\n+  --> $DIR/borrow_interior_mutable_const.rs:114:16\n    |\n LL |     assert_eq!(u64::ATOMIC.load(Ordering::SeqCst), 9); //~ ERROR interior mutability\n    |                ^^^^^^^^^^^"}, {"sha": "ac4c1bc65979fb5f38661d3f8ac37487ef802e89", "filename": "tests/ui/temporary_assignment.rs", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/87a4495b5d312296a1ed3458a8b1cae2e77edf8f/tests%2Fui%2Ftemporary_assignment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87a4495b5d312296a1ed3458a8b1cae2e77edf8f/tests%2Fui%2Ftemporary_assignment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftemporary_assignment.rs?ref=87a4495b5d312296a1ed3458a8b1cae2e77edf8f", "patch": "@@ -53,11 +53,6 @@ fn main() {\n     ArrayStruct { array: [0] }.array[0] = 1;\n     (0, 0).0 = 1;\n \n-    A.0 = 2;\n-    B.field = 2;\n-    C.structure.field = 2;\n-    D.array[0] = 2;\n-\n     // no error\n     s.field = 1;\n     t.0 = 1;"}, {"sha": "7d79901a28d1be70a17f22f33806278c09b0e340", "filename": "tests/ui/temporary_assignment.stderr", "status": "modified", "additions": 1, "deletions": 25, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/87a4495b5d312296a1ed3458a8b1cae2e77edf8f/tests%2Fui%2Ftemporary_assignment.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/87a4495b5d312296a1ed3458a8b1cae2e77edf8f/tests%2Fui%2Ftemporary_assignment.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftemporary_assignment.stderr?ref=87a4495b5d312296a1ed3458a8b1cae2e77edf8f", "patch": "@@ -28,29 +28,5 @@ error: assignment to temporary\n LL |     (0, 0).0 = 1;\n    |     ^^^^^^^^^^^^\n \n-error: assignment to temporary\n-  --> $DIR/temporary_assignment.rs:56:5\n-   |\n-LL |     A.0 = 2;\n-   |     ^^^^^^^\n-\n-error: assignment to temporary\n-  --> $DIR/temporary_assignment.rs:57:5\n-   |\n-LL |     B.field = 2;\n-   |     ^^^^^^^^^^^\n-\n-error: assignment to temporary\n-  --> $DIR/temporary_assignment.rs:58:5\n-   |\n-LL |     C.structure.field = 2;\n-   |     ^^^^^^^^^^^^^^^^^^^^^\n-\n-error: assignment to temporary\n-  --> $DIR/temporary_assignment.rs:59:5\n-   |\n-LL |     D.array[0] = 2;\n-   |     ^^^^^^^^^^^^^^\n-\n-error: aborting due to 8 previous errors\n+error: aborting due to 4 previous errors\n "}]}