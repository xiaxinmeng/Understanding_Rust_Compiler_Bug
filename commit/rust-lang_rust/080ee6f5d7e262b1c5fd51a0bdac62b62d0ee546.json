{"sha": "080ee6f5d7e262b1c5fd51a0bdac62b62d0ee546", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA4MGVlNmY1ZDdlMjYyYjFjNWZkNTFhMGJkYWM2MmI2MmQwZWU1NDY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-01-10T17:58:38Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-01-10T17:58:38Z"}, "message": "Auto merge of #80789 - Aaron1011:fix/stmt-empty, r=petrochenkov\n\nSynthesize a `TokenStream` for `StmtKind::Empty`\n\nFixes #80760", "tree": {"sha": "94a61a9f300670b5671ff038877416ae48e8a626", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/94a61a9f300670b5671ff038877416ae48e8a626"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/080ee6f5d7e262b1c5fd51a0bdac62b62d0ee546", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/080ee6f5d7e262b1c5fd51a0bdac62b62d0ee546", "html_url": "https://github.com/rust-lang/rust/commit/080ee6f5d7e262b1c5fd51a0bdac62b62d0ee546", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/080ee6f5d7e262b1c5fd51a0bdac62b62d0ee546/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fd34606ddf02d1e9364e459b373a6ad665c3d8a4", "url": "https://api.github.com/repos/rust-lang/rust/commits/fd34606ddf02d1e9364e459b373a6ad665c3d8a4", "html_url": "https://github.com/rust-lang/rust/commit/fd34606ddf02d1e9364e459b373a6ad665c3d8a4"}, {"sha": "3ed6caae60794c6fade76486b2fbe2a173eb1943", "url": "https://api.github.com/repos/rust-lang/rust/commits/3ed6caae60794c6fade76486b2fbe2a173eb1943", "html_url": "https://github.com/rust-lang/rust/commit/3ed6caae60794c6fade76486b2fbe2a173eb1943"}], "stats": {"total": 51, "additions": 50, "deletions": 1}, "files": [{"sha": "62fd6936d210d70c306ae37e9f3a91c6266cb692", "filename": "compiler/rustc_parse/src/lib.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/080ee6f5d7e262b1c5fd51a0bdac62b62d0ee546/compiler%2Frustc_parse%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/080ee6f5d7e262b1c5fd51a0bdac62b62d0ee546/compiler%2Frustc_parse%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Flib.rs?ref=080ee6f5d7e262b1c5fd51a0bdac62b62d0ee546", "patch": "@@ -257,7 +257,16 @@ pub fn nt_to_tokenstream(\n     let tokens = match *nt {\n         Nonterminal::NtItem(ref item) => prepend_attrs(sess, &item.attrs, nt, item.tokens.as_ref()),\n         Nonterminal::NtBlock(ref block) => convert_tokens(block.tokens.as_ref()),\n-        Nonterminal::NtStmt(ref stmt) => prepend_attrs(sess, stmt.attrs(), nt, stmt.tokens()),\n+        Nonterminal::NtStmt(ref stmt) => {\n+            let do_prepend = |tokens| prepend_attrs(sess, stmt.attrs(), nt, tokens);\n+            if let ast::StmtKind::Empty = stmt.kind {\n+                let tokens: TokenStream =\n+                    tokenstream::TokenTree::token(token::Semi, stmt.span).into();\n+                do_prepend(Some(&LazyTokenStream::new(tokens)))\n+            } else {\n+                do_prepend(stmt.tokens())\n+            }\n+        }\n         Nonterminal::NtPat(ref pat) => convert_tokens(pat.tokens.as_ref()),\n         Nonterminal::NtTy(ref ty) => convert_tokens(ty.tokens.as_ref()),\n         Nonterminal::NtIdent(ident, is_raw) => {"}, {"sha": "86865af0b5298c84ee94de2b23ffb378c60b8446", "filename": "src/test/ui/proc-macro/issue-80760-empty-stmt.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/080ee6f5d7e262b1c5fd51a0bdac62b62d0ee546/src%2Ftest%2Fui%2Fproc-macro%2Fissue-80760-empty-stmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/080ee6f5d7e262b1c5fd51a0bdac62b62d0ee546/src%2Ftest%2Fui%2Fproc-macro%2Fissue-80760-empty-stmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fissue-80760-empty-stmt.rs?ref=080ee6f5d7e262b1c5fd51a0bdac62b62d0ee546", "patch": "@@ -0,0 +1,26 @@\n+// check-pass\n+// aux-build:test-macros.rs\n+// compile-flags: -Z span-debug\n+\n+#![no_std] // Don't load unnecessary hygiene information from std\n+extern crate std;\n+\n+#[macro_use]\n+extern crate test_macros;\n+\n+macro_rules! empty_stmt {\n+    ($s:stmt) => {\n+        print_bang!($s);\n+\n+        // Currently, all attributes are ignored\n+        // on an empty statement\n+        #[print_attr]\n+        #[rustc_dummy(first)]\n+        #[rustc_dummy(second)]\n+        $s\n+    }\n+}\n+\n+fn main() {\n+    empty_stmt!(;);\n+}"}, {"sha": "4b7ed874307d8f6c65dc8ad6cfb139945c6e0876", "filename": "src/test/ui/proc-macro/issue-80760-empty-stmt.stdout", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/080ee6f5d7e262b1c5fd51a0bdac62b62d0ee546/src%2Ftest%2Fui%2Fproc-macro%2Fissue-80760-empty-stmt.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/080ee6f5d7e262b1c5fd51a0bdac62b62d0ee546/src%2Ftest%2Fui%2Fproc-macro%2Fissue-80760-empty-stmt.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fissue-80760-empty-stmt.stdout?ref=080ee6f5d7e262b1c5fd51a0bdac62b62d0ee546", "patch": "@@ -0,0 +1,14 @@\n+PRINT-BANG INPUT (DISPLAY): ;\n+PRINT-BANG INPUT (DEBUG): TokenStream [\n+    Group {\n+        delimiter: None,\n+        stream: TokenStream [\n+            Punct {\n+                ch: ';',\n+                spacing: Alone,\n+                span: $DIR/issue-80760-empty-stmt.rs:25:17: 25:18 (#0),\n+            },\n+        ],\n+        span: $DIR/issue-80760-empty-stmt.rs:13:21: 13:23 (#4),\n+    },\n+]"}]}