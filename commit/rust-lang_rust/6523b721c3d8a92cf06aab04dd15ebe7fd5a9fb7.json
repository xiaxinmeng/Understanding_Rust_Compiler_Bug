{"sha": "6523b721c3d8a92cf06aab04dd15ebe7fd5a9fb7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY1MjNiNzIxYzNkOGE5MmNmMDZhYWIwNGRkMTVlYmU3ZmQ1YTlmYjc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-02-10T07:10:43Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-02-10T07:10:43Z"}, "message": "Auto merge of #81929 - pietroalbini:pgo-bootstrap, r=Mark-Simulacrum\n\nAllow unstable features in some PGO benchmarks\n\nSome of the benchmarks we're using for PGO require unstable features (such as compiling the standard library and some rustc-perf benchmarks), breaking CI on the beta and stable branches. For the past two releases we cherry-picked a commit directly onto the beta branch that unconditionally sets `RUSTC_BOOTSTRAP=1`, and this PR backports a similar change to the master branch.\n\nThe difference between this commit and the one we backported previously (483c1a83ca7cf53fd8f3432edb32cbe70ba39d45) is that this is more scoped in which benchmarks we allow unstable features, to prevent unintentionally enabling unstable features.\n\nr? `@Mark-Simulacrum`", "tree": {"sha": "90bfedcf3c3674553fb3fd729b5ab1a759fc491d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/90bfedcf3c3674553fb3fd729b5ab1a759fc491d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6523b721c3d8a92cf06aab04dd15ebe7fd5a9fb7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6523b721c3d8a92cf06aab04dd15ebe7fd5a9fb7", "html_url": "https://github.com/rust-lang/rust/commit/6523b721c3d8a92cf06aab04dd15ebe7fd5a9fb7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6523b721c3d8a92cf06aab04dd15ebe7fd5a9fb7/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f7534b566c850f860e11735b27a988dd9eec454a", "url": "https://api.github.com/repos/rust-lang/rust/commits/f7534b566c850f860e11735b27a988dd9eec454a", "html_url": "https://github.com/rust-lang/rust/commit/f7534b566c850f860e11735b27a988dd9eec454a"}, {"sha": "7ecc995f0906f16c277c57206e17d2ae810b5476", "url": "https://api.github.com/repos/rust-lang/rust/commits/7ecc995f0906f16c277c57206e17d2ae810b5476", "html_url": "https://github.com/rust-lang/rust/commit/7ecc995f0906f16c277c57206e17d2ae810b5476"}], "stats": {"total": 6, "additions": 4, "deletions": 2}, "files": [{"sha": "95cf1183fc17a0a52300fbfbc40ed9c7ef8385d7", "filename": "src/ci/pgo.sh", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6523b721c3d8a92cf06aab04dd15ebe7fd5a9fb7/src%2Fci%2Fpgo.sh", "raw_url": "https://github.com/rust-lang/rust/raw/6523b721c3d8a92cf06aab04dd15ebe7fd5a9fb7/src%2Fci%2Fpgo.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fpgo.sh?ref=6523b721c3d8a92cf06aab04dd15ebe7fd5a9fb7", "patch": "@@ -7,7 +7,7 @@ rm -rf /tmp/rustc-pgo\n python2.7 ../x.py build --target=$PGO_HOST --host=$PGO_HOST \\\n     --stage 2 library/std --rust-profile-generate=/tmp/rustc-pgo\n \n-./build/$PGO_HOST/stage2/bin/rustc --edition=2018 \\\n+RUSTC_BOOTSTRAP=1 ./build/$PGO_HOST/stage2/bin/rustc --edition=2018 \\\n     --crate-type=lib ../library/core/src/lib.rs\n \n # Download and build a single-file stress test benchmark on perf.rust-lang.org.\n@@ -16,7 +16,9 @@ function pgo_perf_benchmark {\n     local github_prefix=https://raw.githubusercontent.com/rust-lang/rustc-perf/$PERF\n     local name=$1\n     curl -o /tmp/$name.rs $github_prefix/collector/benchmarks/$name/src/lib.rs\n-    ./build/$PGO_HOST/stage2/bin/rustc --edition=2018 --crate-type=lib /tmp/$name.rs\n+\n+    RUSTC_BOOTSTRAP=1 ./build/$PGO_HOST/stage2/bin/rustc --edition=2018 \\\n+        --crate-type=lib /tmp/$name.rs\n }\n \n pgo_perf_benchmark externs"}]}