{"sha": "85bfe2d99d191d385ecb1ac4660692e9de5c4fbe", "node_id": "C_kwDOAAsO6NoAKDg1YmZlMmQ5OWQxOTFkMzg1ZWNiMWFjNDY2MDY5MmU5ZGU1YzRmYmU", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-03-31T17:10:53Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-03-31T17:11:44Z"}, "message": "make utf8_char_counts test faster in Miri", "tree": {"sha": "999083b4387872f39d56f7a99d00af0415fde16e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/999083b4387872f39d56f7a99d00af0415fde16e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/85bfe2d99d191d385ecb1ac4660692e9de5c4fbe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/85bfe2d99d191d385ecb1ac4660692e9de5c4fbe", "html_url": "https://github.com/rust-lang/rust/commit/85bfe2d99d191d385ecb1ac4660692e9de5c4fbe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/85bfe2d99d191d385ecb1ac4660692e9de5c4fbe/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "df20355fa9fa5e9fb89be4e4bfee8a643bb7a23e", "url": "https://api.github.com/repos/rust-lang/rust/commits/df20355fa9fa5e9fb89be4e4bfee8a643bb7a23e", "html_url": "https://github.com/rust-lang/rust/commit/df20355fa9fa5e9fb89be4e4bfee8a643bb7a23e"}], "stats": {"total": 11, "additions": 7, "deletions": 4}, "files": [{"sha": "273b39aa45a48ea831244d3ed9d2a7fb3e865704", "filename": "library/alloc/tests/str.rs", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/85bfe2d99d191d385ecb1ac4660692e9de5c4fbe/library%2Falloc%2Ftests%2Fstr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/85bfe2d99d191d385ecb1ac4660692e9de5c4fbe/library%2Falloc%2Ftests%2Fstr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Ftests%2Fstr.rs?ref=85bfe2d99d191d385ecb1ac4660692e9de5c4fbe", "patch": "@@ -2234,11 +2234,14 @@ fn utf8_chars() {\n #[test]\n fn utf8_char_counts() {\n     let strs = [(\"e\", 1), (\"\u00e9\", 1), (\"\u20ac\", 1), (\"\\u{10000}\", 1), (\"e\u00e9\u20ac\\u{10000}\", 4)];\n-    let mut reps =\n-        [8, 64, 256, 512, 1024].iter().copied().flat_map(|n| n - 8..=n + 8).collect::<Vec<usize>>();\n+    let spread = if cfg!(miri) { 4 } else { 8 };\n+    let mut reps = [8, 64, 256, 512]\n+        .iter()\n+        .copied()\n+        .flat_map(|n| n - spread..=n + spread)\n+        .collect::<Vec<usize>>();\n     if cfg!(not(miri)) {\n-        let big = 1 << 16;\n-        reps.extend(big - 8..=big + 8);\n+        reps.extend([1024, 1 << 16].iter().copied().flat_map(|n| n - spread..=n + spread));\n     }\n     let counts = if cfg!(miri) { 0..1 } else { 0..8 };\n     let padding = counts.map(|len| \" \".repeat(len)).collect::<Vec<String>>();"}]}