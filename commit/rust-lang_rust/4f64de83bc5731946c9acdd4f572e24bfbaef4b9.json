{"sha": "4f64de83bc5731946c9acdd4f572e24bfbaef4b9", "node_id": "C_kwDOAAsO6NoAKDRmNjRkZTgzYmM1NzMxOTQ2YzlhY2RkNGY1NzJlMjRiZmJhZWY0Yjk", "commit": {"author": {"name": "clubby789", "email": "jamie@hill-daniel.co.uk", "date": "2023-01-07T15:41:32Z"}, "committer": {"name": "clubby789", "email": "jamie@hill-daniel.co.uk", "date": "2023-01-14T15:49:08Z"}, "message": "Fix `unused_braces` on generic const expr macro call", "tree": {"sha": "98fd0c6fa226f00fa5d10c14facc378aa94e54cb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/98fd0c6fa226f00fa5d10c14facc378aa94e54cb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4f64de83bc5731946c9acdd4f572e24bfbaef4b9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4f64de83bc5731946c9acdd4f572e24bfbaef4b9", "html_url": "https://github.com/rust-lang/rust/commit/4f64de83bc5731946c9acdd4f572e24bfbaef4b9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4f64de83bc5731946c9acdd4f572e24bfbaef4b9/comments", "author": {"login": "clubby789", "id": 13556931, "node_id": "MDQ6VXNlcjEzNTU2OTMx", "avatar_url": "https://avatars.githubusercontent.com/u/13556931?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clubby789", "html_url": "https://github.com/clubby789", "followers_url": "https://api.github.com/users/clubby789/followers", "following_url": "https://api.github.com/users/clubby789/following{/other_user}", "gists_url": "https://api.github.com/users/clubby789/gists{/gist_id}", "starred_url": "https://api.github.com/users/clubby789/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clubby789/subscriptions", "organizations_url": "https://api.github.com/users/clubby789/orgs", "repos_url": "https://api.github.com/users/clubby789/repos", "events_url": "https://api.github.com/users/clubby789/events{/privacy}", "received_events_url": "https://api.github.com/users/clubby789/received_events", "type": "User", "site_admin": false}, "committer": {"login": "clubby789", "id": 13556931, "node_id": "MDQ6VXNlcjEzNTU2OTMx", "avatar_url": "https://avatars.githubusercontent.com/u/13556931?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clubby789", "html_url": "https://github.com/clubby789", "followers_url": "https://api.github.com/users/clubby789/followers", "following_url": "https://api.github.com/users/clubby789/following{/other_user}", "gists_url": "https://api.github.com/users/clubby789/gists{/gist_id}", "starred_url": "https://api.github.com/users/clubby789/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clubby789/subscriptions", "organizations_url": "https://api.github.com/users/clubby789/orgs", "repos_url": "https://api.github.com/users/clubby789/repos", "events_url": "https://api.github.com/users/clubby789/events{/privacy}", "received_events_url": "https://api.github.com/users/clubby789/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "44a500c8c187b245638684748f54bd6ec67e0b25", "url": "https://api.github.com/repos/rust-lang/rust/commits/44a500c8c187b245638684748f54bd6ec67e0b25", "html_url": "https://github.com/rust-lang/rust/commit/44a500c8c187b245638684748f54bd6ec67e0b25"}], "stats": {"total": 17, "additions": 16, "deletions": 1}, "files": [{"sha": "f2ee9ab1a19873cfac16b3e6f2c29c253a5267a5", "filename": "compiler/rustc_lint/src/unused.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4f64de83bc5731946c9acdd4f572e24bfbaef4b9/compiler%2Frustc_lint%2Fsrc%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f64de83bc5731946c9acdd4f572e24bfbaef4b9/compiler%2Frustc_lint%2Fsrc%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Funused.rs?ref=4f64de83bc5731946c9acdd4f572e24bfbaef4b9", "patch": "@@ -1105,6 +1105,7 @@ impl UnusedDelimLint for UnusedBraces {\n                                 || matches!(expr.kind, ast::ExprKind::Lit(_)))\n                             && !cx.sess().source_map().is_multiline(value.span)\n                             && value.attrs.is_empty()\n+                            && !expr.span.from_expansion()\n                             && !value.span.from_expansion()\n                             && !inner.span.from_expansion()\n                         {"}, {"sha": "4c1926387b926a4e843b3e6c5176af7d0b964c95", "filename": "tests/ui/const-generics/unused_braces.fixed", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/4f64de83bc5731946c9acdd4f572e24bfbaef4b9/tests%2Fui%2Fconst-generics%2Funused_braces.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/4f64de83bc5731946c9acdd4f572e24bfbaef4b9/tests%2Fui%2Fconst-generics%2Funused_braces.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fconst-generics%2Funused_braces.fixed?ref=4f64de83bc5731946c9acdd4f572e24bfbaef4b9", "patch": "@@ -2,10 +2,17 @@\n // run-rustfix\n #![warn(unused_braces)]\n \n+macro_rules! make_1 {\n+    () => {\n+        1\n+    }\n+}\n+\n struct A<const N: usize>;\n \n fn main() {\n     let _: A<7>; // ok\n     let _: A<7>; //~ WARN unnecessary braces\n     let _: A<{ 3 + 5 }>; // ok\n+    let _: A<{make_1!()}>; // ok\n }"}, {"sha": "e9f15b401807915c0f85cf7893e8e14d67d60ab0", "filename": "tests/ui/const-generics/unused_braces.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/4f64de83bc5731946c9acdd4f572e24bfbaef4b9/tests%2Fui%2Fconst-generics%2Funused_braces.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f64de83bc5731946c9acdd4f572e24bfbaef4b9/tests%2Fui%2Fconst-generics%2Funused_braces.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fconst-generics%2Funused_braces.rs?ref=4f64de83bc5731946c9acdd4f572e24bfbaef4b9", "patch": "@@ -2,10 +2,17 @@\n // run-rustfix\n #![warn(unused_braces)]\n \n+macro_rules! make_1 {\n+    () => {\n+        1\n+    }\n+}\n+\n struct A<const N: usize>;\n \n fn main() {\n     let _: A<7>; // ok\n     let _: A<{ 7 }>; //~ WARN unnecessary braces\n     let _: A<{ 3 + 5 }>; // ok\n+    let _: A<{make_1!()}>; // ok\n }"}, {"sha": "2c8031c430020b8f86e38ab53137ab02c3783e30", "filename": "tests/ui/const-generics/unused_braces.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4f64de83bc5731946c9acdd4f572e24bfbaef4b9/tests%2Fui%2Fconst-generics%2Funused_braces.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4f64de83bc5731946c9acdd4f572e24bfbaef4b9/tests%2Fui%2Fconst-generics%2Funused_braces.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fconst-generics%2Funused_braces.stderr?ref=4f64de83bc5731946c9acdd4f572e24bfbaef4b9", "patch": "@@ -1,5 +1,5 @@\n warning: unnecessary braces around const expression\n-  --> $DIR/unused_braces.rs:9:14\n+  --> $DIR/unused_braces.rs:15:14\n    |\n LL |     let _: A<{ 7 }>;\n    |              ^^ ^^"}]}