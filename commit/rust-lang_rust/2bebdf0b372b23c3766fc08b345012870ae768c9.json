{"sha": "2bebdf0b372b23c3766fc08b345012870ae768c9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJiZWJkZjBiMzcyYjIzYzM3NjZmYzA4YjM0NTAxMjg3MGFlNzY4Yzk=", "commit": {"author": {"name": "bravomikekilo", "email": "bmk1221@126.com", "date": "2019-08-14T03:55:21Z"}, "committer": {"name": "bravomikekilo", "email": "bmk1221@126.com", "date": "2019-08-14T03:55:21Z"}, "message": "fix error of RangeFrom in for-loop", "tree": {"sha": "7d242e820b9757e8c9b49f81a0d8ae2d2ae0d5f1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7d242e820b9757e8c9b49f81a0d8ae2d2ae0d5f1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2bebdf0b372b23c3766fc08b345012870ae768c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2bebdf0b372b23c3766fc08b345012870ae768c9", "html_url": "https://github.com/rust-lang/rust/commit/2bebdf0b372b23c3766fc08b345012870ae768c9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2bebdf0b372b23c3766fc08b345012870ae768c9/comments", "author": {"login": "bravomikekilo", "id": 17548436, "node_id": "MDQ6VXNlcjE3NTQ4NDM2", "avatar_url": "https://avatars.githubusercontent.com/u/17548436?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bravomikekilo", "html_url": "https://github.com/bravomikekilo", "followers_url": "https://api.github.com/users/bravomikekilo/followers", "following_url": "https://api.github.com/users/bravomikekilo/following{/other_user}", "gists_url": "https://api.github.com/users/bravomikekilo/gists{/gist_id}", "starred_url": "https://api.github.com/users/bravomikekilo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bravomikekilo/subscriptions", "organizations_url": "https://api.github.com/users/bravomikekilo/orgs", "repos_url": "https://api.github.com/users/bravomikekilo/repos", "events_url": "https://api.github.com/users/bravomikekilo/events{/privacy}", "received_events_url": "https://api.github.com/users/bravomikekilo/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bravomikekilo", "id": 17548436, "node_id": "MDQ6VXNlcjE3NTQ4NDM2", "avatar_url": "https://avatars.githubusercontent.com/u/17548436?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bravomikekilo", "html_url": "https://github.com/bravomikekilo", "followers_url": "https://api.github.com/users/bravomikekilo/followers", "following_url": "https://api.github.com/users/bravomikekilo/following{/other_user}", "gists_url": "https://api.github.com/users/bravomikekilo/gists{/gist_id}", "starred_url": "https://api.github.com/users/bravomikekilo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bravomikekilo/subscriptions", "organizations_url": "https://api.github.com/users/bravomikekilo/orgs", "repos_url": "https://api.github.com/users/bravomikekilo/repos", "events_url": "https://api.github.com/users/bravomikekilo/events{/privacy}", "received_events_url": "https://api.github.com/users/bravomikekilo/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "978e3e384b045ea72ba952e7f94a2a4c82297e66", "url": "https://api.github.com/repos/rust-lang/rust/commits/978e3e384b045ea72ba952e7f94a2a4c82297e66", "html_url": "https://github.com/rust-lang/rust/commit/978e3e384b045ea72ba952e7f94a2a4c82297e66"}], "stats": {"total": 131, "additions": 130, "deletions": 1}, "files": [{"sha": "6e25e3cb4ec5917a2242c4b011537dfb9ef9c03f", "filename": "crates/ra_parser/src/grammar/expressions/atom.rs", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/2bebdf0b372b23c3766fc08b345012870ae768c9/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2bebdf0b372b23c3766fc08b345012870ae768c9/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions%2Fatom.rs?ref=2bebdf0b372b23c3766fc08b345012870ae768c9", "patch": "@@ -110,7 +110,13 @@ pub(super) fn atom_expr(p: &mut Parser, r: Restrictions) -> Option<(CompletedMar\n             p.bump();\n             block_expr(p, Some(m))\n         }\n-        T!['{'] => block_expr(p, None),\n+        T!['{'] => {\n+            if r.forbid_structs {\n+                return None;\n+            } else {\n+                block_expr(p, None)\n+            }\n+        }\n         T![return] => return_expr(p),\n         T![continue] => continue_expr(p),\n         T![break] => break_expr(p, r),\n@@ -307,6 +313,16 @@ fn while_expr(p: &mut Parser, m: Option<Marker>) -> CompletedMarker {\n // fn foo() {\n //     for x in [] {};\n // }\n+\n+// test for_range_block\n+// fn foo() {\n+//    for x in 0 .. {\n+//        break;\n+//    }\n+//    for _x in 0 .. (0 .. {1 + 2}).sum::<u32>() {\n+//        break;\n+//    }\n+// }\n fn for_expr(p: &mut Parser, m: Option<Marker>) -> CompletedMarker {\n     assert!(p.at(T![for]));\n     let m = m.unwrap_or_else(|| p.start());"}, {"sha": "33af7002630c0241a660534bc424d8feb6794ad7", "filename": "crates/ra_syntax/test_data/parser/inline/ok/0142_for_range_block.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/2bebdf0b372b23c3766fc08b345012870ae768c9/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0142_for_range_block.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2bebdf0b372b23c3766fc08b345012870ae768c9/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0142_for_range_block.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0142_for_range_block.rs?ref=2bebdf0b372b23c3766fc08b345012870ae768c9", "patch": "@@ -0,0 +1,8 @@\n+fn foo() {\n+   for x in 0 .. {\n+       break;\n+   };\n+   for _x in 0 .. (0 .. {1 + 2}).sum::<u32>() {\n+       break;\n+   };\n+}"}, {"sha": "7da4dbb8b38638291827840fe90f444d12c7c104", "filename": "crates/ra_syntax/test_data/parser/inline/ok/0142_for_range_block.txt", "status": "added", "additions": 105, "deletions": 0, "changes": 105, "blob_url": "https://github.com/rust-lang/rust/blob/2bebdf0b372b23c3766fc08b345012870ae768c9/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0142_for_range_block.txt", "raw_url": "https://github.com/rust-lang/rust/raw/2bebdf0b372b23c3766fc08b345012870ae768c9/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0142_for_range_block.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0142_for_range_block.txt?ref=2bebdf0b372b23c3766fc08b345012870ae768c9", "patch": "@@ -0,0 +1,105 @@\n+SOURCE_FILE@[0; 118)\n+  FN_DEF@[0; 117)\n+    FN_KW@[0; 2) \"fn\"\n+    WHITESPACE@[2; 3) \" \"\n+    NAME@[3; 6)\n+      IDENT@[3; 6) \"foo\"\n+    PARAM_LIST@[6; 8)\n+      L_PAREN@[6; 7) \"(\"\n+      R_PAREN@[7; 8) \")\"\n+    WHITESPACE@[8; 9) \" \"\n+    BLOCK@[9; 117)\n+      L_CURLY@[9; 10) \"{\"\n+      WHITESPACE@[10; 14) \"\\n   \"\n+      EXPR_STMT@[14; 48)\n+        FOR_EXPR@[14; 48)\n+          FOR_KW@[14; 17) \"for\"\n+          WHITESPACE@[17; 18) \" \"\n+          BIND_PAT@[18; 19)\n+            NAME@[18; 19)\n+              IDENT@[18; 19) \"x\"\n+          WHITESPACE@[19; 20) \" \"\n+          IN_KW@[20; 22) \"in\"\n+          WHITESPACE@[22; 23) \" \"\n+          RANGE_EXPR@[23; 27)\n+            LITERAL@[23; 24)\n+              INT_NUMBER@[23; 24) \"0\"\n+            WHITESPACE@[24; 25) \" \"\n+            DOTDOT@[25; 27) \"..\"\n+          WHITESPACE@[27; 28) \" \"\n+          BLOCK@[28; 48)\n+            L_CURLY@[28; 29) \"{\"\n+            WHITESPACE@[29; 37) \"\\n       \"\n+            EXPR_STMT@[37; 43)\n+              BREAK_EXPR@[37; 42)\n+                BREAK_KW@[37; 42) \"break\"\n+              SEMI@[42; 43) \";\"\n+            WHITESPACE@[43; 47) \"\\n   \"\n+            R_CURLY@[47; 48) \"}\"\n+      WHITESPACE@[48; 52) \"\\n   \"\n+      FOR_EXPR@[52; 115)\n+        FOR_KW@[52; 55) \"for\"\n+        WHITESPACE@[55; 56) \" \"\n+        BIND_PAT@[56; 58)\n+          NAME@[56; 58)\n+            IDENT@[56; 58) \"_x\"\n+        WHITESPACE@[58; 59) \" \"\n+        IN_KW@[59; 61) \"in\"\n+        WHITESPACE@[61; 62) \" \"\n+        RANGE_EXPR@[62; 94)\n+          LITERAL@[62; 63)\n+            INT_NUMBER@[62; 63) \"0\"\n+          WHITESPACE@[63; 64) \" \"\n+          DOTDOT@[64; 66) \"..\"\n+          WHITESPACE@[66; 67) \" \"\n+          METHOD_CALL_EXPR@[67; 94)\n+            PAREN_EXPR@[67; 81)\n+              L_PAREN@[67; 68) \"(\"\n+              RANGE_EXPR@[68; 80)\n+                LITERAL@[68; 69)\n+                  INT_NUMBER@[68; 69) \"0\"\n+                WHITESPACE@[69; 70) \" \"\n+                DOTDOT@[70; 72) \"..\"\n+                WHITESPACE@[72; 73) \" \"\n+                BLOCK_EXPR@[73; 80)\n+                  BLOCK@[73; 80)\n+                    L_CURLY@[73; 74) \"{\"\n+                    BIN_EXPR@[74; 79)\n+                      LITERAL@[74; 75)\n+                        INT_NUMBER@[74; 75) \"1\"\n+                      WHITESPACE@[75; 76) \" \"\n+                      PLUS@[76; 77) \"+\"\n+                      WHITESPACE@[77; 78) \" \"\n+                      LITERAL@[78; 79)\n+                        INT_NUMBER@[78; 79) \"2\"\n+                    R_CURLY@[79; 80) \"}\"\n+              R_PAREN@[80; 81) \")\"\n+            DOT@[81; 82) \".\"\n+            NAME_REF@[82; 85)\n+              IDENT@[82; 85) \"sum\"\n+            TYPE_ARG_LIST@[85; 92)\n+              COLONCOLON@[85; 87) \"::\"\n+              L_ANGLE@[87; 88) \"<\"\n+              TYPE_ARG@[88; 91)\n+                PATH_TYPE@[88; 91)\n+                  PATH@[88; 91)\n+                    PATH_SEGMENT@[88; 91)\n+                      NAME_REF@[88; 91)\n+                        IDENT@[88; 91) \"u32\"\n+              R_ANGLE@[91; 92) \">\"\n+            ARG_LIST@[92; 94)\n+              L_PAREN@[92; 93) \"(\"\n+              R_PAREN@[93; 94) \")\"\n+        WHITESPACE@[94; 95) \" \"\n+        BLOCK@[95; 115)\n+          L_CURLY@[95; 96) \"{\"\n+          WHITESPACE@[96; 104) \"\\n       \"\n+          EXPR_STMT@[104; 110)\n+            BREAK_EXPR@[104; 109)\n+              BREAK_KW@[104; 109) \"break\"\n+            SEMI@[109; 110) \";\"\n+          WHITESPACE@[110; 114) \"\\n   \"\n+          R_CURLY@[114; 115) \"}\"\n+      WHITESPACE@[115; 116) \"\\n\"\n+      R_CURLY@[116; 117) \"}\"\n+  WHITESPACE@[117; 118) \"\\n\""}]}