{"sha": "cf470197addb37146eb2e0d16f14dd14293d91f0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNmNDcwMTk3YWRkYjM3MTQ2ZWIyZTBkMTZmMTRkZDE0MjkzZDkxZjA=", "commit": {"author": {"name": "Christiaan Dirkx", "email": "christiaan@dirkx.email", "date": "2021-04-11T21:20:01Z"}, "committer": {"name": "Christiaan Dirkx", "email": "christiaan@dirkx.email", "date": "2021-04-22T08:44:44Z"}, "message": "Move all cleanup to `sys::cleanup`", "tree": {"sha": "d6cb9c36275d7d3269b8704ed52c2cc713c8681d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d6cb9c36275d7d3269b8704ed52c2cc713c8681d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cf470197addb37146eb2e0d16f14dd14293d91f0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cf470197addb37146eb2e0d16f14dd14293d91f0", "html_url": "https://github.com/rust-lang/rust/commit/cf470197addb37146eb2e0d16f14dd14293d91f0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cf470197addb37146eb2e0d16f14dd14293d91f0/comments", "author": {"login": "CDirkx", "id": 11176562, "node_id": "MDQ6VXNlcjExMTc2NTYy", "avatar_url": "https://avatars.githubusercontent.com/u/11176562?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CDirkx", "html_url": "https://github.com/CDirkx", "followers_url": "https://api.github.com/users/CDirkx/followers", "following_url": "https://api.github.com/users/CDirkx/following{/other_user}", "gists_url": "https://api.github.com/users/CDirkx/gists{/gist_id}", "starred_url": "https://api.github.com/users/CDirkx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CDirkx/subscriptions", "organizations_url": "https://api.github.com/users/CDirkx/orgs", "repos_url": "https://api.github.com/users/CDirkx/repos", "events_url": "https://api.github.com/users/CDirkx/events{/privacy}", "received_events_url": "https://api.github.com/users/CDirkx/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CDirkx", "id": 11176562, "node_id": "MDQ6VXNlcjExMTc2NTYy", "avatar_url": "https://avatars.githubusercontent.com/u/11176562?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CDirkx", "html_url": "https://github.com/CDirkx", "followers_url": "https://api.github.com/users/CDirkx/followers", "following_url": "https://api.github.com/users/CDirkx/following{/other_user}", "gists_url": "https://api.github.com/users/CDirkx/gists{/gist_id}", "starred_url": "https://api.github.com/users/CDirkx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CDirkx/subscriptions", "organizations_url": "https://api.github.com/users/CDirkx/orgs", "repos_url": "https://api.github.com/users/CDirkx/repos", "events_url": "https://api.github.com/users/CDirkx/events{/privacy}", "received_events_url": "https://api.github.com/users/CDirkx/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5b30662741afdb59865ecefe3026fcaf1f853c7d", "url": "https://api.github.com/repos/rust-lang/rust/commits/5b30662741afdb59865ecefe3026fcaf1f853c7d", "html_url": "https://github.com/rust-lang/rust/commit/5b30662741afdb59865ecefe3026fcaf1f853c7d"}], "stats": {"total": 31, "additions": 7, "deletions": 24}, "files": [{"sha": "3da865021f35e7f0cad62e8b884bc1148f85e47c", "filename": "library/std/src/sys/hermit/mod.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fmod.rs?ref=cf470197addb37146eb2e0d16f14dd14293d91f0", "patch": "@@ -102,7 +102,9 @@ pub unsafe fn init() {\n }\n \n // SAFETY: must be called only once during runtime cleanup.\n-pub unsafe fn cleanup() {}\n+pub unsafe fn cleanup() {\n+    args::cleanup();\n+}\n \n #[cfg(not(test))]\n #[no_mangle]"}, {"sha": "f276799661eb721034f93238c0beef8669747ef2", "filename": "library/std/src/sys/hermit/stack_overflow.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fstack_overflow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fstack_overflow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fhermit%2Fstack_overflow.rs?ref=cf470197addb37146eb2e0d16f14dd14293d91f0", "patch": "@@ -1,5 +1,2 @@\n #[inline]\n pub unsafe fn init() {}\n-\n-#[inline]\n-pub unsafe fn cleanup() {}"}, {"sha": "7f484b6d136fc3c8066a738cb78ebe211a91cb81", "filename": "library/std/src/sys/sgx/args.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fsgx%2Fargs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fsgx%2Fargs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fsgx%2Fargs.rs?ref=cf470197addb37146eb2e0d16f14dd14293d91f0", "patch": "@@ -22,8 +22,6 @@ pub unsafe fn init(argc: isize, argv: *const *const u8) {\n     }\n }\n \n-pub unsafe fn cleanup() {}\n-\n pub fn args() -> Args {\n     let args = unsafe { (ARGS.load(Ordering::Relaxed) as *const ArgsStore).as_ref() };\n     if let Some(args) = args { Args(args.iter()) } else { Args([].iter()) }"}, {"sha": "1ca5810e61b3dc991eb883b90ef776064f30a515", "filename": "library/std/src/sys/sgx/stack_overflow.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fsgx%2Fstack_overflow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fsgx%2Fstack_overflow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fsgx%2Fstack_overflow.rs?ref=cf470197addb37146eb2e0d16f14dd14293d91f0", "patch": "@@ -1,4 +1,2 @@\n #[cfg_attr(test, allow(dead_code))]\n pub unsafe fn init() {}\n-\n-pub unsafe fn cleanup() {}"}, {"sha": "fd74c10ecd7d0b6f5b358e6b95993479b5e420be", "filename": "library/std/src/sys/unix/mod.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fmod.rs?ref=cf470197addb37146eb2e0d16f14dd14293d91f0", "patch": "@@ -126,7 +126,10 @@ pub unsafe fn init() {\n }\n \n // SAFETY: must be called only once during runtime cleanup.\n-pub unsafe fn cleanup() {}\n+pub unsafe fn cleanup() {\n+    args::cleanup();\n+    stack_overflow::cleanup();\n+}\n \n #[cfg(target_os = \"android\")]\n pub use crate::sys::android::signal;"}, {"sha": "f9d41c6cda65685bbf5eb690f2990e653e1ce8d2", "filename": "library/std/src/sys/unsupported/args.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Funsupported%2Fargs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Funsupported%2Fargs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funsupported%2Fargs.rs?ref=cf470197addb37146eb2e0d16f14dd14293d91f0", "patch": "@@ -1,7 +1,6 @@\n use crate::ffi::OsString;\n \n pub unsafe fn init(_argc: isize, _argv: *const *const u8) {}\n-pub unsafe fn cleanup() {}\n \n pub struct Args {}\n "}, {"sha": "2461fc2dad7e9baea5c90a372af5d23aeb32d2df", "filename": "library/std/src/sys/unsupported/stack_overflow.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Funsupported%2Fstack_overflow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Funsupported%2Fstack_overflow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funsupported%2Fstack_overflow.rs?ref=cf470197addb37146eb2e0d16f14dd14293d91f0", "patch": "@@ -1,3 +1 @@\n pub unsafe fn init() {}\n-\n-pub unsafe fn cleanup() {}"}, {"sha": "7f7f989e2aebc841432daa253e0438f70406de28", "filename": "library/std/src/sys/wasi/args.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fwasi%2Fargs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fwasi%2Fargs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwasi%2Fargs.rs?ref=cf470197addb37146eb2e0d16f14dd14293d91f0", "patch": "@@ -7,8 +7,6 @@ use crate::vec;\n \n pub unsafe fn init(_argc: isize, _argv: *const *const u8) {}\n \n-pub unsafe fn cleanup() {}\n-\n pub struct Args {\n     iter: vec::IntoIter<OsString>,\n     _dont_send_or_sync_me: PhantomData<*mut ()>,"}, {"sha": "987585af2d5b128a7e45e3a54d83214e2c424f5a", "filename": "library/std/src/sys/wasm/args.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fwasm%2Fargs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fwasm%2Fargs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwasm%2Fargs.rs?ref=cf470197addb37146eb2e0d16f14dd14293d91f0", "patch": "@@ -6,8 +6,6 @@ pub unsafe fn init(_argc: isize, _argv: *const *const u8) {\n     // On wasm these should always be null, so there's nothing for us to do here\n }\n \n-pub unsafe fn cleanup() {}\n-\n pub fn args() -> Args {\n     Args { iter: Vec::new().into_iter(), _dont_send_or_sync_me: PhantomData }\n }"}, {"sha": "7ec3c592adab5f48ee2ed9c3daabea2d7c9d8628", "filename": "library/std/src/sys/windows/args.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fargs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fargs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fargs.rs?ref=cf470197addb37146eb2e0d16f14dd14293d91f0", "patch": "@@ -16,8 +16,6 @@ use core::iter;\n \n pub unsafe fn init(_argc: isize, _argv: *const *const u8) {}\n \n-pub unsafe fn cleanup() {}\n-\n pub fn args() -> Args {\n     unsafe {\n         let lp_cmd_line = c::GetCommandLineW();"}, {"sha": "39efb778207fc5386729b34ce9d4d8fecd7a6e7c", "filename": "library/std/src/sys/windows/stack_overflow.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fstack_overflow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fstack_overflow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fstack_overflow.rs?ref=cf470197addb37146eb2e0d16f14dd14293d91f0", "patch": "@@ -37,5 +37,3 @@ pub unsafe fn init() {\n     // Set the thread stack guarantee for the main thread.\n     let _h = Handler::new();\n }\n-\n-pub unsafe fn cleanup() {}"}, {"sha": "afdf7f566ae515eb38b3a3c13ef56839a53c5a4b", "filename": "library/std/src/sys/windows/stack_overflow_uwp.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fstack_overflow_uwp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fstack_overflow_uwp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fstack_overflow_uwp.rs?ref=cf470197addb37146eb2e0d16f14dd14293d91f0", "patch": "@@ -9,5 +9,3 @@ impl Handler {\n }\n \n pub unsafe fn init() {}\n-\n-pub unsafe fn cleanup() {}"}, {"sha": "515e754b4167a20c2661b0f19e8a1f2ed5f5aea1", "filename": "library/std/src/sys_common/rt.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys_common%2Frt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf470197addb37146eb2e0d16f14dd14293d91f0/library%2Fstd%2Fsrc%2Fsys_common%2Frt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys_common%2Frt.rs?ref=cf470197addb37146eb2e0d16f14dd14293d91f0", "patch": "@@ -36,8 +36,6 @@ pub fn cleanup() {\n     CLEANUP.call_once(|| unsafe {\n         // SAFETY: Only called once during runtime cleanup.\n         sys::cleanup();\n-        sys::args::cleanup();\n-        sys::stack_overflow::cleanup();\n         // Flush stdout and disable buffering.\n         crate::io::cleanup();\n     });"}]}