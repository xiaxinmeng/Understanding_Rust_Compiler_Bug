{"sha": "738a41b363c27942944705fab16094704bab4e7d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjczOGE0MWIzNjNjMjc5NDI5NDQ3MDVmYWIxNjA5NDcwNGJhYjRlN2Q=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-10-08T21:23:08Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-10-08T21:23:08Z"}, "message": "Rollup merge of #77449 - ssomers:btree_drain_filter_size_hint, r=Mark-Simulacrum\n\nBTreeMap: comment why drain_filter's size_hint is somewhat pessimistic\n\nThe `size_hint` of the `DrainFilter` iterator doesn't adjust as you iterate. This hardly seems important to me, but there has been a comparable PR #64383 in the past. I guess a scenario is that you first iterate half the map manually and keep most of the key/value pairs in the map, and then tell the predicate to drain most of the key/value pairs and `.collect` the iterator over the remaining half of the map.\n\nI am totally ambivalent whether this is better or not.\n\nr? @Mark-Simulacrum", "tree": {"sha": "06f9a77251e54d2052ec9755208a5b625cf731f4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/06f9a77251e54d2052ec9755208a5b625cf731f4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/738a41b363c27942944705fab16094704bab4e7d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJff4M9CRBK7hj4Ov3rIwAAdHIIAKdxsqyrJY9C0jfeU3FhlF5d\nfJUJAvTETLbDARVajb56Fz3Y7i4bsvq5t5DZ5JbPCBLpfg3OHAX/CfqDaX+gR8la\ngHg/Ekcb7NtdDeTS9baE0cHfjwRujD37KWqfjQbgfz4XpUqhyGC8y/M06V3qbU/o\nZdcnWgQhr7jwZDMKLOwa4oGYBWozJamoJ4HDdj42zJyB2YZ4D1lXBOv80sj9lRWx\nundahhybFslLiNAqyk1UdfVwiv6fadNkdTI7M8/c7XvyIPa3vfuQBdoYx4HZThXr\nZP1e7q+yGAf8m2WqT3LKNQhHLJ5HCzZYVZO1pec+5uCs75H3AyF5yhU922E2dGA=\n=lQWG\n-----END PGP SIGNATURE-----\n", "payload": "tree 06f9a77251e54d2052ec9755208a5b625cf731f4\nparent 2766b725d3aabee4788943d25b60413b34db570b\nparent 3b051d0171b4e15aff4d2ecacf7659f7278e8e09\nauthor Jonas Schievink <jonasschievink@gmail.com> 1602192188 +0200\ncommitter GitHub <noreply@github.com> 1602192188 +0200\n\nRollup merge of #77449 - ssomers:btree_drain_filter_size_hint, r=Mark-Simulacrum\n\nBTreeMap: comment why drain_filter's size_hint is somewhat pessimistic\n\nThe `size_hint` of the `DrainFilter` iterator doesn't adjust as you iterate. This hardly seems important to me, but there has been a comparable PR #64383 in the past. I guess a scenario is that you first iterate half the map manually and keep most of the key/value pairs in the map, and then tell the predicate to drain most of the key/value pairs and `.collect` the iterator over the remaining half of the map.\n\nI am totally ambivalent whether this is better or not.\n\nr? @Mark-Simulacrum\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/738a41b363c27942944705fab16094704bab4e7d", "html_url": "https://github.com/rust-lang/rust/commit/738a41b363c27942944705fab16094704bab4e7d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/738a41b363c27942944705fab16094704bab4e7d/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2766b725d3aabee4788943d25b60413b34db570b", "url": "https://api.github.com/repos/rust-lang/rust/commits/2766b725d3aabee4788943d25b60413b34db570b", "html_url": "https://github.com/rust-lang/rust/commit/2766b725d3aabee4788943d25b60413b34db570b"}, {"sha": "3b051d0171b4e15aff4d2ecacf7659f7278e8e09", "url": "https://api.github.com/repos/rust-lang/rust/commits/3b051d0171b4e15aff4d2ecacf7659f7278e8e09", "html_url": "https://github.com/rust-lang/rust/commit/3b051d0171b4e15aff4d2ecacf7659f7278e8e09"}], "stats": {"total": 4, "additions": 4, "deletions": 0}, "files": [{"sha": "606bf94f99867fe7d38e7b3074ced5820c68c8d8", "filename": "library/alloc/src/collections/btree/map.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/738a41b363c27942944705fab16094704bab4e7d/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/738a41b363c27942944705fab16094704bab4e7d/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs?ref=738a41b363c27942944705fab16094704bab4e7d", "patch": "@@ -1783,6 +1783,10 @@ impl<'a, K: 'a, V: 'a> DrainFilterInner<'a, K, V> {\n \n     /// Implementation of a typical `DrainFilter::size_hint` method.\n     pub(super) fn size_hint(&self) -> (usize, Option<usize>) {\n+        // In most of the btree iterators, `self.length` is the number of elements\n+        // yet to be visited. Here, it includes elements that were visited and that\n+        // the predicate decided not to drain. Making this upper bound more accurate\n+        // requires maintaining an extra field and is not worth while.\n         (0, Some(*self.length))\n     }\n }"}]}