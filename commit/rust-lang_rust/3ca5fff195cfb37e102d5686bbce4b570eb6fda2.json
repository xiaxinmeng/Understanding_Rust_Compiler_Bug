{"sha": "3ca5fff195cfb37e102d5686bbce4b570eb6fda2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNjYTVmZmYxOTVjZmIzN2UxMDJkNTY4NmJiY2U0YjU3MGViNmZkYTI=", "commit": {"author": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2011-06-04T21:08:50Z"}, "committer": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2011-06-04T21:14:32Z"}, "message": "rustc: Use spans for #env errors\n\nIssue #444", "tree": {"sha": "4de1c7c6dda9cdb2396f040e24aeb2d486fa404c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4de1c7c6dda9cdb2396f040e24aeb2d486fa404c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3ca5fff195cfb37e102d5686bbce4b570eb6fda2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3ca5fff195cfb37e102d5686bbce4b570eb6fda2", "html_url": "https://github.com/rust-lang/rust/commit/3ca5fff195cfb37e102d5686bbce4b570eb6fda2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3ca5fff195cfb37e102d5686bbce4b570eb6fda2/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ac83e34dc6c2bb3b5f181f923560d810dcdb558c", "url": "https://api.github.com/repos/rust-lang/rust/commits/ac83e34dc6c2bb3b5f181f923560d810dcdb558c", "html_url": "https://github.com/rust-lang/rust/commit/ac83e34dc6c2bb3b5f181f923560d810dcdb558c"}], "stats": {"total": 29, "additions": 24, "deletions": 5}, "files": [{"sha": "d92c5eb7dbd681f2a54f7b520443916a9bacde39", "filename": "src/comp/front/extenv.rs", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/3ca5fff195cfb37e102d5686bbce4b570eb6fda2/src%2Fcomp%2Ffront%2Fextenv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ca5fff195cfb37e102d5686bbce4b570eb6fda2/src%2Fcomp%2Ffront%2Fextenv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Ffront%2Fextenv.rs?ref=3ca5fff195cfb37e102d5686bbce4b570eb6fda2", "patch": "@@ -23,13 +23,13 @@ fn expand_syntax_ext(&ext_ctxt cx,\n                      option::t[str] body) -> @ast::expr {\n \n     if (vec::len[@ast::expr](args) != 1u) {\n-        p.err(\"malformed #env call\");\n+        cx.span_err(sp, \"malformed #env call\");\n     }\n \n     // FIXME: if this was more thorough it would manufacture an\n     // option::t[str] rather than just an maybe-empty string.\n \n-    auto var = expr_to_str(p, args.(0));\n+    auto var = expr_to_str(cx, p, args.(0));\n     alt (generic_os::getenv(var)) {\n         case (option::none) {\n             ret make_new_str(p, sp, \"\");\n@@ -42,19 +42,23 @@ fn expand_syntax_ext(&ext_ctxt cx,\n \n // FIXME: duplicate code copied from extfmt:\n \n-fn expr_to_str(parser::parser p,\n+fn expr_to_str(&ext_ctxt cx, parser::parser p,\n                @ast::expr expr) -> str {\n     alt (expr.node) {\n         case (ast::expr_lit(?l, _)) {\n             alt (l.node) {\n                 case (ast::lit_str(?s)) {\n                     ret s;\n                 }\n+                case (_) {\n+                    cx.span_err(l.span, \"malformed #env call\");\n+                }\n             }\n         }\n+        case (_) {\n+            cx.span_err(expr.span, \"malformed #env call\");\n+        }\n     }\n-    p.err(\"malformed #env call\");\n-    fail;\n }\n \n fn make_new_lit(parser::parser p, common::span sp, ast::lit_ lit)"}, {"sha": "2503a631c048a19976f352d3cdf242a483d97182", "filename": "src/test/compile-fail/extenv-no-args.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3ca5fff195cfb37e102d5686bbce4b570eb6fda2/src%2Ftest%2Fcompile-fail%2Fextenv-no-args.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ca5fff195cfb37e102d5686bbce4b570eb6fda2/src%2Ftest%2Fcompile-fail%2Fextenv-no-args.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fextenv-no-args.rs?ref=3ca5fff195cfb37e102d5686bbce4b570eb6fda2", "patch": "@@ -0,0 +1,5 @@\n+// error-pattern:malformed #env call\n+\n+fn main() {\n+  #env();\n+}"}, {"sha": "885924c83781ecb5e52004ccd256c356ca0e41af", "filename": "src/test/compile-fail/extenv-not-string-literal.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3ca5fff195cfb37e102d5686bbce4b570eb6fda2/src%2Ftest%2Fcompile-fail%2Fextenv-not-string-literal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ca5fff195cfb37e102d5686bbce4b570eb6fda2/src%2Ftest%2Fcompile-fail%2Fextenv-not-string-literal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fextenv-not-string-literal.rs?ref=3ca5fff195cfb37e102d5686bbce4b570eb6fda2", "patch": "@@ -0,0 +1,5 @@\n+// error-pattern:malformed #env call\n+\n+fn main() {\n+  #env(10);\n+}"}, {"sha": "e71d0ec3c724ebb683242c4ac2881e31b4679365", "filename": "src/test/compile-fail/extenv-too-many-args.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3ca5fff195cfb37e102d5686bbce4b570eb6fda2/src%2Ftest%2Fcompile-fail%2Fextenv-too-many-args.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ca5fff195cfb37e102d5686bbce4b570eb6fda2/src%2Ftest%2Fcompile-fail%2Fextenv-too-many-args.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fextenv-too-many-args.rs?ref=3ca5fff195cfb37e102d5686bbce4b570eb6fda2", "patch": "@@ -0,0 +1,5 @@\n+// error-pattern:malformed #env call\n+\n+fn main() {\n+  #env(\"one\", \"two\");\n+}"}]}