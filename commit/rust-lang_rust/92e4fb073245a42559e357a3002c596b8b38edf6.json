{"sha": "92e4fb073245a42559e357a3002c596b8b38edf6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkyZTRmYjA3MzI0NWE0MjU1OWUzNTdhMzAwMmM1OTZiOGIzOGVkZjY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-12-02T04:12:33Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-12-02T04:12:33Z"}, "message": "Auto merge of #79235 - ortem:fix-btreemap-gdb-pretty-printer, r=Mark-Simulacrum\n\nFix zero-sized BTreeMap gdb pretty-printer\n\n`gdb.parse_and_eval(\"()\")` is needed because GDB treats \"()\" as a Rust array of two characters, not as a unit\n\nBased on https://github.com/intellij-rust/intellij-rust/pull/6356", "tree": {"sha": "a2487afa8d78ed9397f56bb36727162b2d195a41", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a2487afa8d78ed9397f56bb36727162b2d195a41"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/92e4fb073245a42559e357a3002c596b8b38edf6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/92e4fb073245a42559e357a3002c596b8b38edf6", "html_url": "https://github.com/rust-lang/rust/commit/92e4fb073245a42559e357a3002c596b8b38edf6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/92e4fb073245a42559e357a3002c596b8b38edf6/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eb4860c7e1e4109d94e84adc2794f720120604e3", "url": "https://api.github.com/repos/rust-lang/rust/commits/eb4860c7e1e4109d94e84adc2794f720120604e3", "html_url": "https://github.com/rust-lang/rust/commit/eb4860c7e1e4109d94e84adc2794f720120604e3"}, {"sha": "685e1f3e45ef1ffa881be13b6af1867209c294c7", "url": "https://api.github.com/repos/rust-lang/rust/commits/685e1f3e45ef1ffa881be13b6af1867209c294c7", "html_url": "https://github.com/rust-lang/rust/commit/685e1f3e45ef1ffa881be13b6af1867209c294c7"}], "stats": {"total": 9, "additions": 5, "deletions": 4}, "files": [{"sha": "2d902a9b6e08e72afed5dbb6ee5be5251894953d", "filename": "src/etc/gdb_providers.py", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/92e4fb073245a42559e357a3002c596b8b38edf6/src%2Fetc%2Fgdb_providers.py", "raw_url": "https://github.com/rust-lang/rust/raw/92e4fb073245a42559e357a3002c596b8b38edf6/src%2Fetc%2Fgdb_providers.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fgdb_providers.py?ref=92e4fb073245a42559e357a3002c596b8b38edf6", "patch": "@@ -1,7 +1,6 @@\n from sys import version_info\n \n import gdb\n-from gdb import lookup_type\n \n if version_info[0] >= 3:\n     xrange = range\n@@ -213,7 +212,7 @@ def children_of_btree_map(map):\n     def children_of_node(node_ptr, height):\n         def cast_to_internal(node):\n             internal_type_name = node.type.target().name.replace(\"LeafNode\", \"InternalNode\", 1)\n-            internal_type = lookup_type(internal_type_name)\n+            internal_type = gdb.lookup_type(internal_type_name)\n             return node.cast(internal_type.pointer())\n \n         if node_ptr.type.name.startswith(\"alloc::collections::btree::node::BoxedNode<\"):\n@@ -233,8 +232,10 @@ def cast_to_internal(node):\n                     yield child\n             if i < length:\n                 # Avoid \"Cannot perform pointer math on incomplete type\" on zero-sized arrays.\n-                key = keys[i][\"value\"][\"value\"] if keys.type.sizeof > 0 else \"()\"\n-                val = vals[i][\"value\"][\"value\"] if vals.type.sizeof > 0 else \"()\"\n+                key_type_size = keys.type.sizeof\n+                val_type_size = vals.type.sizeof\n+                key = keys[i][\"value\"][\"value\"] if key_type_size > 0 else gdb.parse_and_eval(\"()\")\n+                val = vals[i][\"value\"][\"value\"] if val_type_size > 0 else gdb.parse_and_eval(\"()\")\n                 yield key, val\n \n     if map[\"length\"] > 0:"}]}