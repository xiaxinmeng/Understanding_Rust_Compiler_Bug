{"sha": "6244625cb47f810cd457643ae6eafe76a4f4da76", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYyNDQ2MjVjYjQ3ZjgxMGNkNDU3NjQzYWU2ZWFmZTc2YTRmNGRhNzY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-08-30T00:07:15Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-08-30T00:07:15Z"}, "message": "Auto merge of #53479 - joshtriplett:underscore-means-unused, r=eddyb\n\nDon't emit \"unused extern crate\" warnings for `extern crate foo as _;`\n\nWhen importing a crate and renaming it to an underscore-prefixed name,\nsuppress \"unused extern crate\" warnings (but not idiom lints).", "tree": {"sha": "b7aa12352c75a7161a4d883afd9197397a9ab01b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b7aa12352c75a7161a4d883afd9197397a9ab01b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6244625cb47f810cd457643ae6eafe76a4f4da76", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6244625cb47f810cd457643ae6eafe76a4f4da76", "html_url": "https://github.com/rust-lang/rust/commit/6244625cb47f810cd457643ae6eafe76a4f4da76", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6244625cb47f810cd457643ae6eafe76a4f4da76/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "02cb8f2a4f078025abe6ddba3cff81b383a23973", "url": "https://api.github.com/repos/rust-lang/rust/commits/02cb8f2a4f078025abe6ddba3cff81b383a23973", "html_url": "https://github.com/rust-lang/rust/commit/02cb8f2a4f078025abe6ddba3cff81b383a23973"}, {"sha": "7cec516ef9a60aec740725ca35050b5345d95818", "url": "https://api.github.com/repos/rust-lang/rust/commits/7cec516ef9a60aec740725ca35050b5345d95818", "html_url": "https://github.com/rust-lang/rust/commit/7cec516ef9a60aec740725ca35050b5345d95818"}], "stats": {"total": 47, "additions": 21, "deletions": 26}, "files": [{"sha": "fa152b386a8257fff3851f8040bc08e2f3171f56", "filename": "src/librustc_typeck/check_unused.rs", "status": "modified", "additions": 20, "deletions": 13, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/6244625cb47f810cd457643ae6eafe76a4f4da76/src%2Flibrustc_typeck%2Fcheck_unused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6244625cb47f810cd457643ae6eafe76a4f4da76/src%2Flibrustc_typeck%2Fcheck_unused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck_unused.rs?ref=6244625cb47f810cd457643ae6eafe76a4f4da76", "patch": "@@ -133,19 +133,21 @@ fn unused_crates_lint<'tcx>(tcx: TyCtxt<'_, 'tcx, 'tcx>) {\n \n         // If the crate is fully unused, we suggest removing it altogether.\n         // We do this in any edition.\n-        if let Some(&span) = unused_extern_crates.get(&extern_crate.def_id) {\n-            assert_eq!(extern_crate.def_id.krate, LOCAL_CRATE);\n-            let hir_id = tcx.hir.definitions().def_index_to_hir_id(extern_crate.def_id.index);\n-            let id = tcx.hir.hir_to_node_id(hir_id);\n-            let msg = \"unused extern crate\";\n-            tcx.struct_span_lint_node(lint, id, span, msg)\n-                .span_suggestion_short_with_applicability(\n-                    span,\n-                    \"remove it\",\n-                    String::new(),\n-                    Applicability::MachineApplicable)\n-                .emit();\n-            continue;\n+        if extern_crate.warn_if_unused {\n+            if let Some(&span) = unused_extern_crates.get(&extern_crate.def_id) {\n+                assert_eq!(extern_crate.def_id.krate, LOCAL_CRATE);\n+                let hir_id = tcx.hir.definitions().def_index_to_hir_id(extern_crate.def_id.index);\n+                let id = tcx.hir.hir_to_node_id(hir_id);\n+                let msg = \"unused extern crate\";\n+                tcx.struct_span_lint_node(lint, id, span, msg)\n+                    .span_suggestion_short_with_applicability(\n+                        span,\n+                        \"remove it\",\n+                        String::new(),\n+                        Applicability::MachineApplicable)\n+                    .emit();\n+                continue;\n+            }\n         }\n \n         // If we are not in Rust 2018 edition, then we don't make any further\n@@ -202,6 +204,10 @@ struct ExternCrateToLint {\n     /// crate_name`), and -- perhaps surprisingly -- this stores the\n     /// *original* name (`item.name` will contain the new name)\n     orig_name: Option<ast::Name>,\n+\n+    /// if `false`, the original name started with `_`, so we shouldn't lint\n+    /// about it going unused (but we should still emit idiom lints).\n+    warn_if_unused: bool,\n }\n \n impl<'a, 'tcx, 'v> ItemLikeVisitor<'v> for CollectExternCrateVisitor<'a, 'tcx> {\n@@ -213,6 +219,7 @@ impl<'a, 'tcx, 'v> ItemLikeVisitor<'v> for CollectExternCrateVisitor<'a, 'tcx> {\n                     def_id: extern_crate_def_id,\n                     span: item.span,\n                     orig_name,\n+                    warn_if_unused: !item.name.as_str().starts_with('_'),\n                 }\n             );\n         }"}, {"sha": "104bd9e166c791318a07ac847a553c6ce975b12f", "filename": "src/test/ui/rfc-2166-underscore-imports/basic.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/6244625cb47f810cd457643ae6eafe76a4f4da76/src%2Ftest%2Fui%2Frfc-2166-underscore-imports%2Fbasic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6244625cb47f810cd457643ae6eafe76a4f4da76/src%2Ftest%2Fui%2Frfc-2166-underscore-imports%2Fbasic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2166-underscore-imports%2Fbasic.rs?ref=6244625cb47f810cd457643ae6eafe76a4f4da76", "patch": "@@ -30,7 +30,7 @@ mod m {\n mod unused {\n     use m::Tr1 as _; //~ WARN unused import\n     use S as _; //~ WARN unused import\n-    extern crate core as _; //~ WARN unused extern crate\n+    extern crate core as _; // OK\n }\n \n mod outer {"}, {"sha": "2be0317019d3c0c558d90b96322fcec02df15487", "filename": "src/test/ui/rfc-2166-underscore-imports/basic.stderr", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/6244625cb47f810cd457643ae6eafe76a4f4da76/src%2Ftest%2Fui%2Frfc-2166-underscore-imports%2Fbasic.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6244625cb47f810cd457643ae6eafe76a4f4da76/src%2Ftest%2Fui%2Frfc-2166-underscore-imports%2Fbasic.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2166-underscore-imports%2Fbasic.stderr?ref=6244625cb47f810cd457643ae6eafe76a4f4da76", "patch": "@@ -16,15 +16,3 @@ warning: unused import: `S as _`\n LL |     use S as _; //~ WARN unused import\n    |         ^^^^^^\n \n-warning: unused extern crate\n-  --> $DIR/basic.rs:33:5\n-   |\n-LL |     extern crate core as _; //~ WARN unused extern crate\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^ help: remove it\n-   |\n-note: lint level defined here\n-  --> $DIR/basic.rs:14:25\n-   |\n-LL | #![warn(unused_imports, unused_extern_crates)]\n-   |                         ^^^^^^^^^^^^^^^^^^^^\n-"}]}