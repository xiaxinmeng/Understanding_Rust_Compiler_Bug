{"sha": "49a8f002a017a324bd3419950d26244cfe949e2f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ5YThmMDAyYTAxN2EzMjRiZDM0MTk5NTBkMjYyNDRjZmU5NDllMmY=", "commit": {"author": {"name": "hyd-dev", "email": "yd-huang@outlook.com", "date": "2021-06-11T07:53:01Z"}, "committer": {"name": "hyd-dev", "email": "yd-huang@outlook.com", "date": "2021-06-11T07:53:58Z"}, "message": "`let`-bind `exp_abi` of `\"exit\" | \"ExitProcess\"`", "tree": {"sha": "497f1a3fcdb6b0284013fb95f46ff25e30480a49", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/497f1a3fcdb6b0284013fb95f46ff25e30480a49"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/49a8f002a017a324bd3419950d26244cfe949e2f", "comment_count": 0, "verification": {"verified": false, "reason": "no_user", "signature": "-----BEGIN PGP SIGNATURE-----\n\niIsEABYIADMWIQRJ2jPMDdiQ+U4U42Z0+n/VuNoUuAUCYMMWlhUceWQtaHVhbmdA\nb3V0bG9vay5jb20ACgkQdPp/1bjaFLgE6gEAhwD0tJ/emyCyBPTFv4Okguqz06N9\nr0mvidE/CIeG1MQBAN/sViAy2D5/3QaMJwNSekeBbqv1kZw4g9jnv117W8UH\n=jndG\n-----END PGP SIGNATURE-----", "payload": "tree 497f1a3fcdb6b0284013fb95f46ff25e30480a49\nparent e46aab5816e32316c33962939aa6e2bbcebd4c8c\nauthor hyd-dev <yd-huang@outlook.com> 1623397981 +0800\ncommitter hyd-dev <yd-huang@outlook.com> 1623398038 +0800\n\n`let`-bind `exp_abi` of `\"exit\" | \"ExitProcess\"`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/49a8f002a017a324bd3419950d26244cfe949e2f", "html_url": "https://github.com/rust-lang/rust/commit/49a8f002a017a324bd3419950d26244cfe949e2f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/49a8f002a017a324bd3419950d26244cfe949e2f/comments", "author": null, "committer": null, "parents": [{"sha": "e46aab5816e32316c33962939aa6e2bbcebd4c8c", "url": "https://api.github.com/repos/rust-lang/rust/commits/e46aab5816e32316c33962939aa6e2bbcebd4c8c", "html_url": "https://github.com/rust-lang/rust/commit/e46aab5816e32316c33962939aa6e2bbcebd4c8c"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "96edfcc9cf7486cec28b73c7204b4a1262dbf84e", "filename": "src/shims/foreign_items.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/49a8f002a017a324bd3419950d26244cfe949e2f/src%2Fshims%2Fforeign_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/49a8f002a017a324bd3419950d26244cfe949e2f/src%2Fshims%2Fforeign_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fshims%2Fforeign_items.rs?ref=49a8f002a017a324bd3419950d26244cfe949e2f", "patch": "@@ -238,7 +238,12 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n                 | \"exit\"\n                 | \"ExitProcess\"\n                 => {\n-                    let &[ref code] = this.check_shim(abi, if link_name == \"exit\" { Abi::C { unwind: false } } else { Abi::System { unwind: false } }, link_name_sym, args)?;\n+                    let exp_abi = if link_name == \"exit\" {\n+                        Abi::C { unwind: false }\n+                    } else {\n+                        Abi::System { unwind: false }\n+                    };\n+                    let &[ref code] = this.check_shim(abi, exp_abi, link_name_sym, args)?;\n                     // it's really u32 for ExitProcess, but we have to put it into the `Exit` variant anyway\n                     let code = this.read_scalar(code)?.to_i32()?;\n                     throw_machine_stop!(TerminationInfo::Exit(code.into()));"}]}