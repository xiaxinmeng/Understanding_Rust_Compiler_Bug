{"sha": "d0ddbb9d0d0d6b9b6adb51b259819ec270421642", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQwZGRiYjlkMGQwZDZiOWI2YWRiNTFiMjU5ODE5ZWMyNzA0MjE2NDI=", "commit": {"author": {"name": "Robin Schoonover", "email": "robin@cornhooves.org", "date": "2020-09-16T03:10:50Z"}, "committer": {"name": "Robin Schoonover", "email": "robin@cornhooves.org", "date": "2020-09-16T03:11:28Z"}, "message": "Extend testing of rc_buffer lint", "tree": {"sha": "8f55ce1701af7be997033ccb4259a1e61ea5acc6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8f55ce1701af7be997033ccb4259a1e61ea5acc6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d0ddbb9d0d0d6b9b6adb51b259819ec270421642", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d0ddbb9d0d0d6b9b6adb51b259819ec270421642", "html_url": "https://github.com/rust-lang/rust/commit/d0ddbb9d0d0d6b9b6adb51b259819ec270421642", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d0ddbb9d0d0d6b9b6adb51b259819ec270421642/comments", "author": {"login": "rschoon", "id": 507274, "node_id": "MDQ6VXNlcjUwNzI3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/507274?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rschoon", "html_url": "https://github.com/rschoon", "followers_url": "https://api.github.com/users/rschoon/followers", "following_url": "https://api.github.com/users/rschoon/following{/other_user}", "gists_url": "https://api.github.com/users/rschoon/gists{/gist_id}", "starred_url": "https://api.github.com/users/rschoon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rschoon/subscriptions", "organizations_url": "https://api.github.com/users/rschoon/orgs", "repos_url": "https://api.github.com/users/rschoon/repos", "events_url": "https://api.github.com/users/rschoon/events{/privacy}", "received_events_url": "https://api.github.com/users/rschoon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rschoon", "id": 507274, "node_id": "MDQ6VXNlcjUwNzI3NA==", "avatar_url": "https://avatars.githubusercontent.com/u/507274?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rschoon", "html_url": "https://github.com/rschoon", "followers_url": "https://api.github.com/users/rschoon/followers", "following_url": "https://api.github.com/users/rschoon/following{/other_user}", "gists_url": "https://api.github.com/users/rschoon/gists{/gist_id}", "starred_url": "https://api.github.com/users/rschoon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rschoon/subscriptions", "organizations_url": "https://api.github.com/users/rschoon/orgs", "repos_url": "https://api.github.com/users/rschoon/repos", "events_url": "https://api.github.com/users/rschoon/events{/privacy}", "received_events_url": "https://api.github.com/users/rschoon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2dd7175d60e070c7ee2b4609bdb17eae16e381f0", "url": "https://api.github.com/repos/rust-lang/rust/commits/2dd7175d60e070c7ee2b4609bdb17eae16e381f0", "html_url": "https://github.com/rust-lang/rust/commit/2dd7175d60e070c7ee2b4609bdb17eae16e381f0"}], "stats": {"total": 159, "additions": 122, "deletions": 37}, "files": [{"sha": "1fa986439368782b94c053be0a0b850e2e4fac9a", "filename": "tests/ui/rc_buffer.rs", "status": "modified", "additions": 18, "deletions": 5, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/d0ddbb9d0d0d6b9b6adb51b259819ec270421642/tests%2Fui%2Frc_buffer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d0ddbb9d0d0d6b9b6adb51b259819ec270421642/tests%2Fui%2Frc_buffer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frc_buffer.rs?ref=d0ddbb9d0d0d6b9b6adb51b259819ec270421642", "patch": "@@ -1,13 +1,26 @@\n+#![warn(clippy::rc_buffer)]\n+\n+use std::cell::RefCell;\n use std::ffi::OsString;\n use std::path::PathBuf;\n use std::rc::Rc;\n \n-#[warn(clippy::rc_buffer)]\n struct S {\n-    a: Rc<String>,\n-    b: Rc<PathBuf>,\n-    c: Rc<Vec<u8>>,\n-    d: Rc<OsString>,\n+    // triggers lint\n+    bad1: Rc<String>,\n+    bad2: Rc<PathBuf>,\n+    bad3: Rc<Vec<u8>>,\n+    bad4: Rc<OsString>,\n+    // does not trigger lint\n+    good1: Rc<RefCell<String>>,\n }\n \n+// triggers lint\n+fn func_bad1(_: Rc<String>) {}\n+fn func_bad2(_: Rc<PathBuf>) {}\n+fn func_bad3(_: Rc<Vec<u8>>) {}\n+fn func_bad4(_: Rc<OsString>) {}\n+// does not trigger lint\n+fn func_good1(_: Rc<RefCell<String>>) {}\n+\n fn main() {}"}, {"sha": "e4cc169af07b96f0dbbbf1490e153881d77526ca", "filename": "tests/ui/rc_buffer.stderr", "status": "modified", "additions": 37, "deletions": 13, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/d0ddbb9d0d0d6b9b6adb51b259819ec270421642/tests%2Fui%2Frc_buffer.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d0ddbb9d0d0d6b9b6adb51b259819ec270421642/tests%2Fui%2Frc_buffer.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frc_buffer.stderr?ref=d0ddbb9d0d0d6b9b6adb51b259819ec270421642", "patch": "@@ -1,28 +1,52 @@\n error: usage of `Rc<T>` when T is a buffer type\n-  --> $DIR/rc_buffer.rs:7:8\n+  --> $DIR/rc_buffer.rs:10:11\n    |\n-LL |     a: Rc<String>,\n-   |        ^^^^^^^^^^ help: try: `Rc<str>`\n+LL |     bad1: Rc<String>,\n+   |           ^^^^^^^^^^ help: try: `Rc<str>`\n    |\n    = note: `-D clippy::rc-buffer` implied by `-D warnings`\n \n error: usage of `Rc<T>` when T is a buffer type\n-  --> $DIR/rc_buffer.rs:8:8\n+  --> $DIR/rc_buffer.rs:11:11\n    |\n-LL |     b: Rc<PathBuf>,\n-   |        ^^^^^^^^^^^ help: try: `Rc<std::path::Path>`\n+LL |     bad2: Rc<PathBuf>,\n+   |           ^^^^^^^^^^^ help: try: `Rc<std::path::Path>`\n \n error: usage of `Rc<T>` when T is a buffer type\n-  --> $DIR/rc_buffer.rs:9:8\n+  --> $DIR/rc_buffer.rs:12:11\n    |\n-LL |     c: Rc<Vec<u8>>,\n-   |        ^^^^^^^^^^^ help: try: `Rc<[u8]>`\n+LL |     bad3: Rc<Vec<u8>>,\n+   |           ^^^^^^^^^^^ help: try: `Rc<[u8]>`\n \n error: usage of `Rc<T>` when T is a buffer type\n-  --> $DIR/rc_buffer.rs:10:8\n+  --> $DIR/rc_buffer.rs:13:11\n    |\n-LL |     d: Rc<OsString>,\n-   |        ^^^^^^^^^^^^ help: try: `Rc<std::ffi::OsStr>`\n+LL |     bad4: Rc<OsString>,\n+   |           ^^^^^^^^^^^^ help: try: `Rc<std::ffi::OsStr>`\n \n-error: aborting due to 4 previous errors\n+error: usage of `Rc<T>` when T is a buffer type\n+  --> $DIR/rc_buffer.rs:19:17\n+   |\n+LL | fn func_bad1(_: Rc<String>) {}\n+   |                 ^^^^^^^^^^ help: try: `Rc<str>`\n+\n+error: usage of `Rc<T>` when T is a buffer type\n+  --> $DIR/rc_buffer.rs:20:17\n+   |\n+LL | fn func_bad2(_: Rc<PathBuf>) {}\n+   |                 ^^^^^^^^^^^ help: try: `Rc<std::path::Path>`\n+\n+error: usage of `Rc<T>` when T is a buffer type\n+  --> $DIR/rc_buffer.rs:21:17\n+   |\n+LL | fn func_bad3(_: Rc<Vec<u8>>) {}\n+   |                 ^^^^^^^^^^^ help: try: `Rc<[u8]>`\n+\n+error: usage of `Rc<T>` when T is a buffer type\n+  --> $DIR/rc_buffer.rs:22:17\n+   |\n+LL | fn func_bad4(_: Rc<OsString>) {}\n+   |                 ^^^^^^^^^^^^ help: try: `Rc<std::ffi::OsStr>`\n+\n+error: aborting due to 8 previous errors\n "}, {"sha": "5d586584817bd26d70e7e6f75a90750242ba17b1", "filename": "tests/ui/rc_buffer_arc.rs", "status": "modified", "additions": 18, "deletions": 6, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/d0ddbb9d0d0d6b9b6adb51b259819ec270421642/tests%2Fui%2Frc_buffer_arc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d0ddbb9d0d0d6b9b6adb51b259819ec270421642/tests%2Fui%2Frc_buffer_arc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frc_buffer_arc.rs?ref=d0ddbb9d0d0d6b9b6adb51b259819ec270421642", "patch": "@@ -1,13 +1,25 @@\n+#![warn(clippy::rc_buffer)]\n+\n use std::ffi::OsString;\n use std::path::PathBuf;\n-use std::sync::Arc;\n+use std::sync::{Arc, Mutex};\n \n-#[warn(clippy::rc_buffer)]\n struct S {\n-    a: Arc<String>,\n-    b: Arc<PathBuf>,\n-    c: Arc<Vec<u8>>,\n-    d: Arc<OsString>,\n+    // triggers lint\n+    bad1: Arc<String>,\n+    bad2: Arc<PathBuf>,\n+    bad3: Arc<Vec<u8>>,\n+    bad4: Arc<OsString>,\n+    // does not trigger lint\n+    good1: Arc<Mutex<String>>,\n }\n \n+// triggers lint\n+fn func_bad1(_: Arc<String>) {}\n+fn func_bad2(_: Arc<PathBuf>) {}\n+fn func_bad3(_: Arc<Vec<u8>>) {}\n+fn func_bad4(_: Arc<OsString>) {}\n+// does not trigger lint\n+fn func_good1(_: Arc<Mutex<String>>) {}\n+\n fn main() {}"}, {"sha": "8252270d2ac7491ba1a7653e85388eb0ce432eea", "filename": "tests/ui/rc_buffer_arc.stderr", "status": "modified", "additions": 37, "deletions": 13, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/d0ddbb9d0d0d6b9b6adb51b259819ec270421642/tests%2Fui%2Frc_buffer_arc.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d0ddbb9d0d0d6b9b6adb51b259819ec270421642/tests%2Fui%2Frc_buffer_arc.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frc_buffer_arc.stderr?ref=d0ddbb9d0d0d6b9b6adb51b259819ec270421642", "patch": "@@ -1,28 +1,52 @@\n error: usage of `Arc<T>` when T is a buffer type\n-  --> $DIR/rc_buffer_arc.rs:7:8\n+  --> $DIR/rc_buffer_arc.rs:9:11\n    |\n-LL |     a: Arc<String>,\n-   |        ^^^^^^^^^^^ help: try: `Arc<str>`\n+LL |     bad1: Arc<String>,\n+   |           ^^^^^^^^^^^ help: try: `Arc<str>`\n    |\n    = note: `-D clippy::rc-buffer` implied by `-D warnings`\n \n error: usage of `Arc<T>` when T is a buffer type\n-  --> $DIR/rc_buffer_arc.rs:8:8\n+  --> $DIR/rc_buffer_arc.rs:10:11\n    |\n-LL |     b: Arc<PathBuf>,\n-   |        ^^^^^^^^^^^^ help: try: `Arc<std::path::Path>`\n+LL |     bad2: Arc<PathBuf>,\n+   |           ^^^^^^^^^^^^ help: try: `Arc<std::path::Path>`\n \n error: usage of `Arc<T>` when T is a buffer type\n-  --> $DIR/rc_buffer_arc.rs:9:8\n+  --> $DIR/rc_buffer_arc.rs:11:11\n    |\n-LL |     c: Arc<Vec<u8>>,\n-   |        ^^^^^^^^^^^^ help: try: `Arc<[u8]>`\n+LL |     bad3: Arc<Vec<u8>>,\n+   |           ^^^^^^^^^^^^ help: try: `Arc<[u8]>`\n \n error: usage of `Arc<T>` when T is a buffer type\n-  --> $DIR/rc_buffer_arc.rs:10:8\n+  --> $DIR/rc_buffer_arc.rs:12:11\n    |\n-LL |     d: Arc<OsString>,\n-   |        ^^^^^^^^^^^^^ help: try: `Arc<std::ffi::OsStr>`\n+LL |     bad4: Arc<OsString>,\n+   |           ^^^^^^^^^^^^^ help: try: `Arc<std::ffi::OsStr>`\n \n-error: aborting due to 4 previous errors\n+error: usage of `Arc<T>` when T is a buffer type\n+  --> $DIR/rc_buffer_arc.rs:18:17\n+   |\n+LL | fn func_bad1(_: Arc<String>) {}\n+   |                 ^^^^^^^^^^^ help: try: `Arc<str>`\n+\n+error: usage of `Arc<T>` when T is a buffer type\n+  --> $DIR/rc_buffer_arc.rs:19:17\n+   |\n+LL | fn func_bad2(_: Arc<PathBuf>) {}\n+   |                 ^^^^^^^^^^^^ help: try: `Arc<std::path::Path>`\n+\n+error: usage of `Arc<T>` when T is a buffer type\n+  --> $DIR/rc_buffer_arc.rs:20:17\n+   |\n+LL | fn func_bad3(_: Arc<Vec<u8>>) {}\n+   |                 ^^^^^^^^^^^^ help: try: `Arc<[u8]>`\n+\n+error: usage of `Arc<T>` when T is a buffer type\n+  --> $DIR/rc_buffer_arc.rs:21:17\n+   |\n+LL | fn func_bad4(_: Arc<OsString>) {}\n+   |                 ^^^^^^^^^^^^^ help: try: `Arc<std::ffi::OsStr>`\n+\n+error: aborting due to 8 previous errors\n "}, {"sha": "5d31a848cf72c0166b889f4ffe83b00a14cd36b1", "filename": "tests/ui/rc_buffer_redefined_string.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/d0ddbb9d0d0d6b9b6adb51b259819ec270421642/tests%2Fui%2Frc_buffer_redefined_string.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d0ddbb9d0d0d6b9b6adb51b259819ec270421642/tests%2Fui%2Frc_buffer_redefined_string.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frc_buffer_redefined_string.rs?ref=d0ddbb9d0d0d6b9b6adb51b259819ec270421642", "patch": "@@ -0,0 +1,12 @@\n+#![warn(clippy::rc_buffer)]\n+\n+use std::rc::Rc;\n+\n+struct String;\n+\n+struct S {\n+    // does not trigger lint\n+    good1: Rc<String>,\n+}\n+\n+fn main() {}"}, {"sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391", "filename": "tests/ui/rc_buffer_redefined_string.stderr", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/d0ddbb9d0d0d6b9b6adb51b259819ec270421642/tests%2Fui%2Frc_buffer_redefined_string.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d0ddbb9d0d0d6b9b6adb51b259819ec270421642/tests%2Fui%2Frc_buffer_redefined_string.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frc_buffer_redefined_string.stderr?ref=d0ddbb9d0d0d6b9b6adb51b259819ec270421642"}]}