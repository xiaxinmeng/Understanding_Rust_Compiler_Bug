{"sha": "747643ff3a5b880a1a979bd8e7cbe33e966a3e00", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc0NzY0M2ZmM2E1Yjg4MGExYTk3OWJkOGU3Y2JlMzNlOTY2YTNlMDA=", "commit": {"author": {"name": "Mark Simulacrum", "email": "mark.simulacrum@gmail.com", "date": "2017-06-23T12:02:14Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-06-23T12:02:14Z"}, "message": "Rollup merge of #42829 - ids1024:cxx, r=alexcrichton\n\nSet CXX_<target> in bootstrap\n\nI came across this trying to cross-compile rustc for Redox. It was also mentioned in a comment on https://github.com/rust-lang/rust/pull/42206, but doesn't seem to have been corrected.", "tree": {"sha": "d676f777d416659e46238a11b85422bdd8bd5f15", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d676f777d416659e46238a11b85422bdd8bd5f15"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/747643ff3a5b880a1a979bd8e7cbe33e966a3e00", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/747643ff3a5b880a1a979bd8e7cbe33e966a3e00", "html_url": "https://github.com/rust-lang/rust/commit/747643ff3a5b880a1a979bd8e7cbe33e966a3e00", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/747643ff3a5b880a1a979bd8e7cbe33e966a3e00/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "97b77833335796b0970086590e8a29ca825d4622", "url": "https://api.github.com/repos/rust-lang/rust/commits/97b77833335796b0970086590e8a29ca825d4622", "html_url": "https://github.com/rust-lang/rust/commit/97b77833335796b0970086590e8a29ca825d4622"}, {"sha": "f98ffb5bc348d1b11f10ebd5f4c5e2fe2813e167", "url": "https://api.github.com/repos/rust-lang/rust/commits/f98ffb5bc348d1b11f10ebd5f4c5e2fe2813e167", "html_url": "https://github.com/rust-lang/rust/commit/f98ffb5bc348d1b11f10ebd5f4c5e2fe2813e167"}], "stats": {"total": 24, "additions": 14, "deletions": 10}, "files": [{"sha": "277728b90b763c0b0381512653ecdb332ac0a5b2", "filename": "src/bootstrap/check.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/747643ff3a5b880a1a979bd8e7cbe33e966a3e00/src%2Fbootstrap%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/747643ff3a5b880a1a979bd8e7cbe33e966a3e00/src%2Fbootstrap%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcheck.rs?ref=747643ff3a5b880a1a979bd8e7cbe33e966a3e00", "patch": "@@ -265,7 +265,7 @@ pub fn compiletest(build: &Build,\n         let llvm_components = output(Command::new(&llvm_config).arg(\"--components\"));\n         let llvm_cxxflags = output(Command::new(&llvm_config).arg(\"--cxxflags\"));\n         cmd.arg(\"--cc\").arg(build.cc(target))\n-           .arg(\"--cxx\").arg(build.cxx(target))\n+           .arg(\"--cxx\").arg(build.cxx(target).unwrap())\n            .arg(\"--cflags\").arg(build.cflags(target).join(\" \"))\n            .arg(\"--llvm-components\").arg(llvm_components.trim())\n            .arg(\"--llvm-cxxflags\").arg(llvm_cxxflags.trim());"}, {"sha": "c8ab3a8fc1d9947ddf4f47460fa8a597fc8afd0d", "filename": "src/bootstrap/compile.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/747643ff3a5b880a1a979bd8e7cbe33e966a3e00/src%2Fbootstrap%2Fcompile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/747643ff3a5b880a1a979bd8e7cbe33e966a3e00/src%2Fbootstrap%2Fcompile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcompile.rs?ref=747643ff3a5b880a1a979bd8e7cbe33e966a3e00", "patch": "@@ -291,7 +291,7 @@ pub fn rustc(build: &Build, target: &str, compiler: &Compiler) {\n        !target.contains(\"windows\") &&\n        !target.contains(\"apple\") {\n         cargo.env(\"LLVM_STATIC_STDCPP\",\n-                  compiler_file(build.cxx(target), \"libstdc++.a\"));\n+                  compiler_file(build.cxx(target).unwrap(), \"libstdc++.a\"));\n     }\n     if build.config.llvm_link_shared {\n         cargo.env(\"LLVM_LINK_SHARED\", \"1\");"}, {"sha": "ce7cde8fc9494b6eec53118d5bc0f4c312e8845c", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/747643ff3a5b880a1a979bd8e7cbe33e966a3e00/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/747643ff3a5b880a1a979bd8e7cbe33e966a3e00/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=747643ff3a5b880a1a979bd8e7cbe33e966a3e00", "patch": "@@ -452,6 +452,10 @@ impl Build {\n             cargo.env(format!(\"CC_{}\", target), self.cc(target))\n                  .env(format!(\"AR_{}\", target), self.ar(target).unwrap()) // only msvc is None\n                  .env(format!(\"CFLAGS_{}\", target), self.cflags(target).join(\" \"));\n+\n+            if let Ok(cxx) = self.cxx(target) {\n+                 cargo.env(format!(\"CXX_{}\", target), cxx);\n+            }\n         }\n \n         if self.config.extended && compiler.is_final_stage(self) {\n@@ -838,13 +842,13 @@ impl Build {\n         self.cc[target].1.as_ref().map(|p| &**p)\n     }\n \n-    /// Returns the path to the C++ compiler for the target specified, may panic\n-    /// if no C++ compiler was configured for the target.\n-    fn cxx(&self, target: &str) -> &Path {\n+    /// Returns the path to the C++ compiler for the target specified.\n+    fn cxx(&self, target: &str) -> Result<&Path, String> {\n         match self.cxx.get(target) {\n-            Some(p) => p.path(),\n-            None => panic!(\"\\n\\ntarget `{}` is not configured as a host,\n-                            only as a target\\n\\n\", target),\n+            Some(p) => Ok(p.path()),\n+            None => Err(format!(\n+                    \"target `{}` is not configured as a host, only as a target\",\n+                    target))\n         }\n     }\n "}, {"sha": "f150df6cdcdb0aa9745c450808ab47618ad09564", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/747643ff3a5b880a1a979bd8e7cbe33e966a3e00/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/747643ff3a5b880a1a979bd8e7cbe33e966a3e00/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=747643ff3a5b880a1a979bd8e7cbe33e966a3e00", "patch": "@@ -155,7 +155,7 @@ pub fn llvm(build: &Build, target: &str) {\n         }\n \n         let cc = build.cc(target);\n-        let cxx = build.cxx(target);\n+        let cxx = build.cxx(target).unwrap();\n \n         // Handle msvc + ninja + ccache specially (this is what the bots use)\n         if target.contains(\"msvc\") &&"}, {"sha": "46d047bb015e51134c279dff2fbd5e5acd77671e", "filename": "src/bootstrap/sanity.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/747643ff3a5b880a1a979bd8e7cbe33e966a3e00/src%2Fbootstrap%2Fsanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/747643ff3a5b880a1a979bd8e7cbe33e966a3e00/src%2Fbootstrap%2Fsanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fsanity.rs?ref=747643ff3a5b880a1a979bd8e7cbe33e966a3e00", "patch": "@@ -139,7 +139,7 @@ pub fn check(build: &mut Build) {\n         }\n     }\n     for host in build.config.host.iter() {\n-        need_cmd(build.cxx(host).as_ref());\n+        need_cmd(build.cxx(host).unwrap().as_ref());\n     }\n \n     // The msvc hosts don't use jemalloc, turn it off globally to"}]}