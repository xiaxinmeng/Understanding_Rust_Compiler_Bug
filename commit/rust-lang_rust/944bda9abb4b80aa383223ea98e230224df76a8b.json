{"sha": "944bda9abb4b80aa383223ea98e230224df76a8b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk0NGJkYTlhYmI0YjgwYWEzODMyMjNlYTk4ZTIzMDIyNGRmNzZhOGI=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-07-03T23:38:47Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-07-03T23:38:47Z"}, "message": "Rollup merge of #62252 - czipperz:change-mem-replace-doc-example, r=dtolnay\n\nUpdate mem::replace example to not be identical to mem::take\n\nThis also adds assertions that the operations work as expected.", "tree": {"sha": "e226984551cc9de33c2bd734caeaf911856efea0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e226984551cc9de33c2bd734caeaf911856efea0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/944bda9abb4b80aa383223ea98e230224df76a8b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdHTyHCRBK7hj4Ov3rIwAAdHIIABrzm1wa3pgOr/opK05eHKus\nyK1P2ZWnvRQM3lr27GNnW/PKFdihv3lBgDp1RqDxdSrsI51oRVJAbOmUaAX9sVas\nOGDE10cQ+N9r1YCovpRGRtWQrUpZFc05yQdMYDhBfo/pFcppZXlX7zwAM4aovIGz\nhH+Zjy16/ElFLGj2Dnr13t7LM79ZmhKMMA1FwlN6Cxzi/npToD4TqRlPqQr4/7da\n5UnSn3FW9XDxlAGRy2iqrm3gFxLm0KFJO4D8yVFR037So1JJsnWUI661CWIV+VZE\nZZNRxeTwk9ZFhGNV1qSXBThljAW6spVtxwxPnPEiTWbhJmA+nBUNaliwm7weupA=\n=nKl9\n-----END PGP SIGNATURE-----\n", "payload": "tree e226984551cc9de33c2bd734caeaf911856efea0\nparent 88c007cd0418e92bbacb8a46d9f9b23422da0d56\nparent f7061db7e96bb88f85ed0e85175f4f338ed86b15\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1562197127 +0200\ncommitter GitHub <noreply@github.com> 1562197127 +0200\n\nRollup merge of #62252 - czipperz:change-mem-replace-doc-example, r=dtolnay\n\nUpdate mem::replace example to not be identical to mem::take\n\nThis also adds assertions that the operations work as expected.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/944bda9abb4b80aa383223ea98e230224df76a8b", "html_url": "https://github.com/rust-lang/rust/commit/944bda9abb4b80aa383223ea98e230224df76a8b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/944bda9abb4b80aa383223ea98e230224df76a8b/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "88c007cd0418e92bbacb8a46d9f9b23422da0d56", "url": "https://api.github.com/repos/rust-lang/rust/commits/88c007cd0418e92bbacb8a46d9f9b23422da0d56", "html_url": "https://github.com/rust-lang/rust/commit/88c007cd0418e92bbacb8a46d9f9b23422da0d56"}, {"sha": "f7061db7e96bb88f85ed0e85175f4f338ed86b15", "url": "https://api.github.com/repos/rust-lang/rust/commits/f7061db7e96bb88f85ed0e85175f4f338ed86b15", "html_url": "https://github.com/rust-lang/rust/commit/f7061db7e96bb88f85ed0e85175f4f338ed86b15"}], "stats": {"total": 28, "additions": 20, "deletions": 8}, "files": [{"sha": "b31522db474b7613d98757b92a151e39fa37ca27", "filename": "src/libcore/mem/mod.rs", "status": "modified", "additions": 20, "deletions": 8, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/944bda9abb4b80aa383223ea98e230224df76a8b/src%2Flibcore%2Fmem%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/944bda9abb4b80aa383223ea98e230224df76a8b/src%2Flibcore%2Fmem%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fmem%2Fmod.rs?ref=944bda9abb4b80aa383223ea98e230224df76a8b", "patch": "@@ -552,6 +552,12 @@ pub fn swap<T>(x: &mut T, y: &mut T) {\n ///         mem::take(&mut self.buf)\n ///     }\n /// }\n+///\n+/// let mut buffer = Buffer { buf: vec![0, 1] };\n+/// assert_eq!(buffer.buf.len(), 2);\n+///\n+/// assert_eq!(buffer.get_and_reset(), vec![0, 1]);\n+/// assert_eq!(buffer.buf.len(), 0);\n /// ```\n ///\n /// [`Clone`]: ../../std/clone/trait.Clone.html\n@@ -586,17 +592,17 @@ pub fn take<T: Default>(dest: &mut T) -> T {\n /// struct Buffer<T> { buf: Vec<T> }\n ///\n /// impl<T> Buffer<T> {\n-///     fn get_and_reset(&mut self) -> Vec<T> {\n+///     fn replace_index(&mut self, i: usize, v: T) -> T {\n ///         // error: cannot move out of dereference of `&mut`-pointer\n-///         let buf = self.buf;\n-///         self.buf = Vec::new();\n-///         buf\n+///         let t = self.buf[i];\n+///         self.buf[i] = v;\n+///         t\n ///     }\n /// }\n /// ```\n ///\n-/// Note that `T` does not necessarily implement [`Clone`], so it can't even clone and reset\n-/// `self.buf`. But `replace` can be used to disassociate the original value of `self.buf` from\n+/// Note that `T` does not necessarily implement [`Clone`], so we can't even clone `self.buf[i]` to\n+/// avoid the move. But `replace` can be used to disassociate the original value at that index from\n /// `self`, allowing it to be returned:\n ///\n /// ```\n@@ -605,10 +611,16 @@ pub fn take<T: Default>(dest: &mut T) -> T {\n ///\n /// # struct Buffer<T> { buf: Vec<T> }\n /// impl<T> Buffer<T> {\n-///     fn get_and_reset(&mut self) -> Vec<T> {\n-///         mem::replace(&mut self.buf, Vec::new())\n+///     fn replace_index(&mut self, i: usize, v: T) -> T {\n+///         mem::replace(&mut self.buf[i], v)\n ///     }\n /// }\n+///\n+/// let mut buffer = Buffer { buf: vec![0, 1] };\n+/// assert_eq!(buffer.buf[0], 0);\n+///\n+/// assert_eq!(buffer.replace_index(0, 2), 0);\n+/// assert_eq!(buffer.buf[0], 2);\n /// ```\n ///\n /// [`Clone`]: ../../std/clone/trait.Clone.html"}]}