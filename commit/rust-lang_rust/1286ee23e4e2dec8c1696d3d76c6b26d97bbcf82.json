{"sha": "1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82", "node_id": "C_kwDOAAsO6NoAKDEyODZlZTIzZTRlMmRlYzhjMTY5NmQzZDc2YzZiMjZkOTdiYmNmODI", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-11-05T20:39:06Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-11-05T20:39:06Z"}, "message": "Auto merge of #102458 - JohnTitor:stabilize-instruction-set, r=oli-obk\n\nStabilize the `instruction_set` feature\n\nCloses https://github.com/rust-lang/rust/issues/74727\nFCP is complete on https://github.com/rust-lang/rust/issues/74727#issuecomment-1242773253\nr? `@pnkfelix` and/or `@nikomatsakis`\ncc `@xd009642`\n\nSigned-off-by: Yuki Okushi <jtitor@2k36.org>", "tree": {"sha": "f54f08c1654e30f16ab2c2f3569b90ca1330a45d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f54f08c1654e30f16ab2c2f3569b90ca1330a45d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82", "html_url": "https://github.com/rust-lang/rust/commit/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "371100b1fb811e604f7451eff3b06960587fe1af", "url": "https://api.github.com/repos/rust-lang/rust/commits/371100b1fb811e604f7451eff3b06960587fe1af", "html_url": "https://github.com/rust-lang/rust/commit/371100b1fb811e604f7451eff3b06960587fe1af"}, {"sha": "7874976762bc531fa6330854e35ec4db2182164d", "url": "https://api.github.com/repos/rust-lang/rust/commits/7874976762bc531fa6330854e35ec4db2182164d", "html_url": "https://github.com/rust-lang/rust/commit/7874976762bc531fa6330854e35ec4db2182164d"}], "stats": {"total": 61, "additions": 9, "deletions": 52}, "files": [{"sha": "c2aa096a993154a399c38820345c03d4a9ae51e1", "filename": "compiler/rustc_feature/src/accepted.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82/compiler%2Frustc_feature%2Fsrc%2Faccepted.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82/compiler%2Frustc_feature%2Fsrc%2Faccepted.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Faccepted.rs?ref=1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82", "patch": "@@ -191,6 +191,8 @@ declare_features! (\n     (accepted, infer_outlives_requirements, \"1.30.0\", Some(44493), None),\n     /// Allows irrefutable patterns in `if let` and `while let` statements (RFC 2086).\n     (accepted, irrefutable_let_patterns, \"1.33.0\", Some(44495), None),\n+    /// Allows `#[instruction_set(_)]` attribute.\n+    (accepted, isa_attribute, \"CURRENT_RUSTC_VERSION\", Some(74727), None),\n     /// Allows some increased flexibility in the name resolution rules,\n     /// especially around globs and shadowing (RFC 1560).\n     (accepted, item_like_imports, \"1.15.0\", Some(35120), None),"}, {"sha": "09a747662e2669e8a9d995e6a555ca9984af2bab", "filename": "compiler/rustc_feature/src/active.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Factive.rs?ref=1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82", "patch": "@@ -427,8 +427,6 @@ declare_features! (\n     (incomplete, inline_const_pat, \"1.58.0\", Some(76001), None),\n     /// Allows using `pointer` and `reference` in intra-doc links\n     (active, intra_doc_pointers, \"1.51.0\", Some(80896), None),\n-    /// Allows `#[instruction_set(_)]` attribute\n-    (active, isa_attribute, \"1.48.0\", Some(74727), None),\n     // Allows setting the threshold for the `large_assignments` lint.\n     (active, large_assignments, \"1.52.0\", Some(83518), None),\n     /// Allows `if/while p && let q = r && ...` chains."}, {"sha": "4ff3b3f2a38b35860985486a174bdccdd898a154", "filename": "compiler/rustc_feature/src/builtin_attrs.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Fbuiltin_attrs.rs?ref=1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82", "patch": "@@ -391,6 +391,7 @@ pub const BUILTIN_ATTRIBUTES: &[BuiltinAttribute] = &[\n         DuplicatesOk, @only_local: true,\n     ),\n     ungated!(track_caller, Normal, template!(Word), WarnFollowing),\n+    ungated!(instruction_set, Normal, template!(List: \"set\"), ErrorPreceding),\n     gated!(\n         no_sanitize, Normal,\n         template!(List: \"address, memory, thread\"), DuplicatesOk,\n@@ -452,11 +453,6 @@ pub const BUILTIN_ATTRIBUTES: &[BuiltinAttribute] = &[\n         optimize, Normal, template!(List: \"size|speed\"), ErrorPreceding, optimize_attribute,\n         experimental!(optimize),\n     ),\n-    // RFC 2867\n-    gated!(\n-        instruction_set, Normal, template!(List: \"set\"), ErrorPreceding,\n-        isa_attribute, experimental!(instruction_set)\n-    ),\n \n     gated!(\n         ffi_returns_twice, Normal, template!(Word), WarnFollowing, experimental!(ffi_returns_twice)"}, {"sha": "809b0d1555ae476cc1c1d631f9b18ec32450db19", "filename": "src/test/ui/asm/issue-92378.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82/src%2Ftest%2Fui%2Fasm%2Fissue-92378.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82/src%2Ftest%2Fui%2Fasm%2Fissue-92378.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fissue-92378.rs?ref=1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82", "patch": "@@ -3,7 +3,7 @@\n // needs-asm-support\n // build-pass\n \n-#![feature(no_core, lang_items, rustc_attrs, isa_attribute)]\n+#![feature(no_core, lang_items, rustc_attrs)]\n #![no_core]\n #![crate_type = \"rlib\"]\n "}, {"sha": "74653886d4154d3066607874a8fbb88f427ffed1", "filename": "src/test/ui/error-codes/E0778.rs", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82/src%2Ftest%2Fui%2Ferror-codes%2FE0778.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82/src%2Ftest%2Fui%2Ferror-codes%2FE0778.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0778.rs?ref=1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82", "patch": "@@ -1,8 +1,4 @@\n-#![feature(isa_attribute)]\n-\n #[instruction_set()] //~ ERROR\n-fn no_isa_defined() {\n-}\n+fn no_isa_defined() {}\n \n-fn main() {\n-}\n+fn main() {}"}, {"sha": "42647e5c6a1b9f57d7d6092960eefd2e49a4023f", "filename": "src/test/ui/error-codes/E0778.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82/src%2Ftest%2Fui%2Ferror-codes%2FE0778.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82/src%2Ftest%2Fui%2Ferror-codes%2FE0778.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0778.stderr?ref=1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82", "patch": "@@ -1,5 +1,5 @@\n error[E0778]: `#[instruction_set]` requires an argument\n-  --> $DIR/E0778.rs:3:1\n+  --> $DIR/E0778.rs:1:1\n    |\n LL | #[instruction_set()]\n    | ^^^^^^^^^^^^^^^^^^^^"}, {"sha": "c32dae12c9cbfefa33b65480df076c7c926541dc", "filename": "src/test/ui/error-codes/E0779.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82/src%2Ftest%2Fui%2Ferror-codes%2FE0779.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82/src%2Ftest%2Fui%2Ferror-codes%2FE0779.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0779.rs?ref=1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82", "patch": "@@ -1,6 +1,2 @@\n-#![feature(isa_attribute)]\n-\n #[instruction_set(arm::magic)] //~ ERROR\n-fn main() {\n-\n-}\n+fn main() {}"}, {"sha": "7c6a119a09615ba5a8224df897c99bd773f4395b", "filename": "src/test/ui/error-codes/E0779.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82/src%2Ftest%2Fui%2Ferror-codes%2FE0779.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82/src%2Ftest%2Fui%2Ferror-codes%2FE0779.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0779.stderr?ref=1286ee23e4e2dec8c1696d3d76c6b26d97bbcf82", "patch": "@@ -1,5 +1,5 @@\n error[E0779]: invalid instruction set specified\n-  --> $DIR/E0779.rs:3:1\n+  --> $DIR/E0779.rs:1:1\n    |\n LL | #[instruction_set(arm::magic)]\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^"}, {"sha": "cb02a0955e913ea2846d2670de69f496fd9b0856", "filename": "src/test/ui/feature-gates/feature-gate-isa_attribute.rs", "status": "removed", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/371100b1fb811e604f7451eff3b06960587fe1af/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-isa_attribute.rs", "raw_url": "https://github.com/rust-lang/rust/raw/371100b1fb811e604f7451eff3b06960587fe1af/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-isa_attribute.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-isa_attribute.rs?ref=371100b1fb811e604f7451eff3b06960587fe1af", "patch": "@@ -1,6 +0,0 @@\n-#[instruction_set]\n-//~^ ERROR the `#[instruction_set]` attribute is an experimental feature [E0658]\n-//~| ERROR malformed `instruction_set` attribute input\n-//~| ERROR must specify an instruction set [E0778]\n-fn main() {\n-}"}, {"sha": "2a95a80ca6178235e8b82c55125dec5c2be24461", "filename": "src/test/ui/feature-gates/feature-gate-isa_attribute.stderr", "status": "removed", "additions": 0, "deletions": 25, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/371100b1fb811e604f7451eff3b06960587fe1af/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-isa_attribute.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/371100b1fb811e604f7451eff3b06960587fe1af/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-isa_attribute.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-isa_attribute.stderr?ref=371100b1fb811e604f7451eff3b06960587fe1af", "patch": "@@ -1,25 +0,0 @@\n-error: malformed `instruction_set` attribute input\n-  --> $DIR/feature-gate-isa_attribute.rs:1:1\n-   |\n-LL | #[instruction_set]\n-   | ^^^^^^^^^^^^^^^^^^ help: must be of the form: `#[instruction_set(set)]`\n-\n-error[E0658]: the `#[instruction_set]` attribute is an experimental feature\n-  --> $DIR/feature-gate-isa_attribute.rs:1:1\n-   |\n-LL | #[instruction_set]\n-   | ^^^^^^^^^^^^^^^^^^\n-   |\n-   = note: see issue #74727 <https://github.com/rust-lang/rust/issues/74727> for more information\n-   = help: add `#![feature(isa_attribute)]` to the crate attributes to enable\n-\n-error[E0778]: must specify an instruction set\n-  --> $DIR/feature-gate-isa_attribute.rs:1:1\n-   |\n-LL | #[instruction_set]\n-   | ^^^^^^^^^^^^^^^^^^\n-\n-error: aborting due to 3 previous errors\n-\n-Some errors have detailed explanations: E0658, E0778.\n-For more information about an error, try `rustc --explain E0658`."}]}