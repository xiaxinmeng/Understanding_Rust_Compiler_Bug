{"sha": "3a6209cd706179f7cb639f5688adad5b0dd3ad1c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNhNjIwOWNkNzA2MTc5ZjdjYjYzOWY1Njg4YWRhZDViMGRkM2FkMWM=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2020-07-11T06:26:38Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-07-11T06:26:38Z"}, "message": "Rollup merge of #74100 - lzutao:strip-bootstrap, r=Mark-Simulacrum\n\nUse str::strip* in bootstrap\n\nThis is technically a breaking change, replacing the use of `trim_start_matches` with `strip_prefix`. However, because in `rustc -Vv` output there are no lines starting with multiple \"release:\", this should go unnoticed in practice.", "tree": {"sha": "5016fb491c336b82ba9f19960fbfec92088c1e0e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5016fb491c336b82ba9f19960fbfec92088c1e0e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3a6209cd706179f7cb639f5688adad5b0dd3ad1c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfCVueCRBK7hj4Ov3rIwAAdHIIAGGUJM/KO347W1g9baP/V38r\nB8I+iRprfzHumCUtH9ysrmiaVsYQS7bcAE+CN7tRvEsGJRQAK3WSuyBR77TRseRh\nGONhi48hLYUG0/z/9YAQfTrwr8WJnPdEkbgai9yR9HpkhRgeIVd16n06H4n5jiHD\nt8d+k/lT0G7bXZkbW6GM60cFhDOxLAxy5LRUimGdLi3DVkf26LmD3kPBZcViKdH6\n02t9tYN1EFuoXOdOdAsuTZJbKIo2lFPrU5Xe8G5ENygRDUPd4twvDVF6oJYfhrBj\ngCaJpZvyPzYwQQYf+WyyoWjM+/7aoMVZCGTIBxzC+rxDtYjVSkvEbkLH8jnxDTk=\n=FiP+\n-----END PGP SIGNATURE-----\n", "payload": "tree 5016fb491c336b82ba9f19960fbfec92088c1e0e\nparent 2da709ea212871674800c3808e548d756cdca249\nparent 481988b0832de4b28fd1f4a52f0df2801f62bda8\nauthor Manish Goregaokar <manishsmail@gmail.com> 1594448798 -0700\ncommitter GitHub <noreply@github.com> 1594448798 -0700\n\nRollup merge of #74100 - lzutao:strip-bootstrap, r=Mark-Simulacrum\n\nUse str::strip* in bootstrap\n\nThis is technically a breaking change, replacing the use of `trim_start_matches` with `strip_prefix`. However, because in `rustc -Vv` output there are no lines starting with multiple \"release:\", this should go unnoticed in practice.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3a6209cd706179f7cb639f5688adad5b0dd3ad1c", "html_url": "https://github.com/rust-lang/rust/commit/3a6209cd706179f7cb639f5688adad5b0dd3ad1c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3a6209cd706179f7cb639f5688adad5b0dd3ad1c/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2da709ea212871674800c3808e548d756cdca249", "url": "https://api.github.com/repos/rust-lang/rust/commits/2da709ea212871674800c3808e548d756cdca249", "html_url": "https://github.com/rust-lang/rust/commit/2da709ea212871674800c3808e548d756cdca249"}, {"sha": "481988b0832de4b28fd1f4a52f0df2801f62bda8", "url": "https://api.github.com/repos/rust-lang/rust/commits/481988b0832de4b28fd1f4a52f0df2801f62bda8", "html_url": "https://github.com/rust-lang/rust/commit/481988b0832de4b28fd1f4a52f0df2801f62bda8"}], "stats": {"total": 20, "additions": 10, "deletions": 10}, "files": [{"sha": "9b4926f28d4edb320d50b6efc3a1069215113f32", "filename": "src/bootstrap/compile.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/3a6209cd706179f7cb639f5688adad5b0dd3ad1c/src%2Fbootstrap%2Fcompile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a6209cd706179f7cb639f5688adad5b0dd3ad1c/src%2Fbootstrap%2Fcompile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcompile.rs?ref=3a6209cd706179f7cb639f5688adad5b0dd3ad1c", "patch": "@@ -963,10 +963,11 @@ pub fn run_cargo(\n         .collect::<Vec<_>>();\n     for (prefix, extension, expected_len) in toplevel {\n         let candidates = contents.iter().filter(|&&(_, ref filename, ref meta)| {\n-            filename.starts_with(&prefix[..])\n-                && filename[prefix.len()..].starts_with('-')\n-                && filename.ends_with(&extension[..])\n-                && meta.len() == expected_len\n+            meta.len() == expected_len\n+                && filename\n+                    .strip_prefix(&prefix[..])\n+                    .map(|s| s.starts_with('-') && s.ends_with(&extension[..]))\n+                    .unwrap_or(false)\n         });\n         let max = candidates\n             .max_by_key(|&&(_, _, ref metadata)| FileTime::from_last_modification_time(metadata));"}, {"sha": "783a64c3581f96a43b6b106bcebff0bdce9ec3ec", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/3a6209cd706179f7cb639f5688adad5b0dd3ad1c/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a6209cd706179f7cb639f5688adad5b0dd3ad1c/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=3a6209cd706179f7cb639f5688adad5b0dd3ad1c", "patch": "@@ -436,10 +436,9 @@ impl Build {\n             output(Command::new(&build.initial_rustc).arg(\"--version\").arg(\"--verbose\"));\n         let local_release = local_version_verbose\n             .lines()\n-            .filter(|x| x.starts_with(\"release:\"))\n+            .filter_map(|x| x.strip_prefix(\"release:\"))\n             .next()\n             .unwrap()\n-            .trim_start_matches(\"release:\")\n             .trim();\n         let my_version = channel::CFG_RELEASE_NUM;\n         if local_release.split('.').take(2).eq(my_version.split('.').take(2)) {\n@@ -1089,10 +1088,10 @@ impl Build {\n         let toml_file_name = self.src.join(&format!(\"src/tools/{}/Cargo.toml\", package));\n         let toml = t!(fs::read_to_string(&toml_file_name));\n         for line in toml.lines() {\n-            let prefix = \"version = \\\"\";\n-            let suffix = \"\\\"\";\n-            if line.starts_with(prefix) && line.ends_with(suffix) {\n-                return line[prefix.len()..line.len() - suffix.len()].to_string();\n+            if let Some(stripped) =\n+                line.strip_prefix(\"version = \\\"\").and_then(|s| s.strip_suffix(\"\\\"\"))\n+            {\n+                return stripped.to_owned();\n             }\n         }\n "}]}