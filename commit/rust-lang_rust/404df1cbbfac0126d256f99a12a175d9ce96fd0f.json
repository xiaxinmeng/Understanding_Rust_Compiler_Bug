{"sha": "404df1cbbfac0126d256f99a12a175d9ce96fd0f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQwNGRmMWNiYmZhYzAxMjZkMjU2Zjk5YTEyYTE3NWQ5Y2U5NmZkMGY=", "commit": {"author": {"name": "Dan Aloni", "email": "alonid@gmail.com", "date": "2020-06-21T16:31:49Z"}, "committer": {"name": "Dan Aloni", "email": "alonid@gmail.com", "date": "2020-06-23T10:37:50Z"}, "message": "Add re-exports to use suggestions\n\nIn the following example, an inaccessible path is suggested via\n`use foo::bar::X;` whereas an accessible public exported path can\nbe suggested instead.\n\n```\nmod foo {\n    mod bar {\n        pub struct X;\n    }\n    pub use self::bar::X;\n}\n\nfn main() { X; }\n```\n\nThis fixes the issue.", "tree": {"sha": "c8b1f492ebfb7c6c22a0d2e0625fe96dd65f2d6f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c8b1f492ebfb7c6c22a0d2e0625fe96dd65f2d6f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/404df1cbbfac0126d256f99a12a175d9ce96fd0f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/404df1cbbfac0126d256f99a12a175d9ce96fd0f", "html_url": "https://github.com/rust-lang/rust/commit/404df1cbbfac0126d256f99a12a175d9ce96fd0f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/404df1cbbfac0126d256f99a12a175d9ce96fd0f/comments", "author": {"login": "da-x", "id": 321273, "node_id": "MDQ6VXNlcjMyMTI3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/321273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/da-x", "html_url": "https://github.com/da-x", "followers_url": "https://api.github.com/users/da-x/followers", "following_url": "https://api.github.com/users/da-x/following{/other_user}", "gists_url": "https://api.github.com/users/da-x/gists{/gist_id}", "starred_url": "https://api.github.com/users/da-x/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/da-x/subscriptions", "organizations_url": "https://api.github.com/users/da-x/orgs", "repos_url": "https://api.github.com/users/da-x/repos", "events_url": "https://api.github.com/users/da-x/events{/privacy}", "received_events_url": "https://api.github.com/users/da-x/received_events", "type": "User", "site_admin": false}, "committer": {"login": "da-x", "id": 321273, "node_id": "MDQ6VXNlcjMyMTI3Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/321273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/da-x", "html_url": "https://github.com/da-x", "followers_url": "https://api.github.com/users/da-x/followers", "following_url": "https://api.github.com/users/da-x/following{/other_user}", "gists_url": "https://api.github.com/users/da-x/gists{/gist_id}", "starred_url": "https://api.github.com/users/da-x/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/da-x/subscriptions", "organizations_url": "https://api.github.com/users/da-x/orgs", "repos_url": "https://api.github.com/users/da-x/repos", "events_url": "https://api.github.com/users/da-x/events{/privacy}", "received_events_url": "https://api.github.com/users/da-x/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3b1c08c68ccc2c222f84384c836b5e167e2bc241", "url": "https://api.github.com/repos/rust-lang/rust/commits/3b1c08c68ccc2c222f84384c836b5e167e2bc241", "html_url": "https://github.com/rust-lang/rust/commit/3b1c08c68ccc2c222f84384c836b5e167e2bc241"}], "stats": {"total": 59, "additions": 42, "deletions": 17}, "files": [{"sha": "ea4a84a9c3bd442b2199262165ae0c6f00e7fa8d", "filename": "src/librustc_resolve/diagnostics.rs", "status": "modified", "additions": 15, "deletions": 8, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/404df1cbbfac0126d256f99a12a175d9ce96fd0f/src%2Flibrustc_resolve%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/404df1cbbfac0126d256f99a12a175d9ce96fd0f/src%2Flibrustc_resolve%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fdiagnostics.rs?ref=404df1cbbfac0126d256f99a12a175d9ce96fd0f", "patch": "@@ -643,22 +643,24 @@ impl<'a> Resolver<'a> {\n         let not_local_module = crate_name.name != kw::Crate;\n         let mut worklist =\n             vec![(start_module, Vec::<ast::PathSegment>::new(), true, not_local_module)];\n+        let mut worklist_via_import = vec![];\n \n-        while let Some((in_module, path_segments, accessible, in_module_is_extern)) = worklist.pop()\n+        while let Some((in_module, path_segments, accessible, in_module_is_extern)) =\n+            match worklist.pop() {\n+                None => worklist_via_import.pop(),\n+                Some(x) => Some(x),\n+            }\n         {\n             // We have to visit module children in deterministic order to avoid\n             // instabilities in reported imports (#43552).\n             in_module.for_each_child(self, |this, ident, ns, name_binding| {\n-                // avoid imports entirely\n-                if name_binding.is_import() && !name_binding.is_extern_crate() {\n-                    return;\n-                }\n-\n-                // avoid non-importable candidates as well\n+                // avoid non-importable candidates\n                 if !name_binding.is_importable() {\n                     return;\n                 }\n \n+                let via_import = name_binding.is_import() && !name_binding.is_extern_crate();\n+\n                 let child_accessible =\n                     accessible && this.is_accessible_from(name_binding.vis, parent_scope.module);\n \n@@ -667,6 +669,10 @@ impl<'a> Resolver<'a> {\n                     return;\n                 }\n \n+                if via_import && name_binding.is_possibly_imported_variant() {\n+                    return;\n+                }\n+\n                 // collect results based on the filter function\n                 // avoid suggesting anything from the same module in which we are resolving\n                 if ident.name == lookup_ident.name\n@@ -724,7 +730,8 @@ impl<'a> Resolver<'a> {\n                         let is_extern = in_module_is_extern || name_binding.is_extern_crate();\n                         // add the module to the lookup\n                         if seen_modules.insert(module.def_id().unwrap()) {\n-                            worklist.push((module, path_segments, child_accessible, is_extern));\n+                            if via_import { &mut worklist_via_import } else { &mut worklist }\n+                                .push((module, path_segments, child_accessible, is_extern));\n                         }\n                     }\n                 }"}, {"sha": "9aa0be0a71e1fa16f6f0d41811acbc43130e3eca", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/404df1cbbfac0126d256f99a12a175d9ce96fd0f/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/404df1cbbfac0126d256f99a12a175d9ce96fd0f/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=404df1cbbfac0126d256f99a12a175d9ce96fd0f", "patch": "@@ -711,6 +711,13 @@ impl<'a> NameBinding<'a> {\n             }\n     }\n \n+    fn is_possibly_imported_variant(&self) -> bool {\n+        match self.kind {\n+            NameBindingKind::Import { binding, .. } => binding.is_possibly_imported_variant(),\n+            _ => self.is_variant(),\n+        }\n+    }\n+\n     // We sometimes need to treat variants as `pub` for backwards compatibility.\n     fn pseudo_vis(&self) -> ty::Visibility {\n         if self.is_variant() && self.res().def_id().is_local() {"}, {"sha": "32660fdb41876158f95f34860e837cefd8c052cc", "filename": "src/test/ui/glob-resolve1.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/404df1cbbfac0126d256f99a12a175d9ce96fd0f/src%2Ftest%2Fui%2Fglob-resolve1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/404df1cbbfac0126d256f99a12a175d9ce96fd0f/src%2Ftest%2Fui%2Fglob-resolve1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fglob-resolve1.rs?ref=404df1cbbfac0126d256f99a12a175d9ce96fd0f", "patch": "@@ -29,3 +29,7 @@ fn main() {\n     foo::<C>(); //~ ERROR: cannot find type `C` in this scope\n     foo::<D>(); //~ ERROR: cannot find type `D` in this scope\n }\n+\n+mod other {\n+    pub fn import() {}\n+}"}, {"sha": "3c818f3ae48ea4634db7720946b065247e97b3a5", "filename": "src/test/ui/glob-resolve1.stderr", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/404df1cbbfac0126d256f99a12a175d9ce96fd0f/src%2Ftest%2Fui%2Fglob-resolve1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/404df1cbbfac0126d256f99a12a175d9ce96fd0f/src%2Ftest%2Fui%2Fglob-resolve1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fglob-resolve1.stderr?ref=404df1cbbfac0126d256f99a12a175d9ce96fd0f", "patch": "@@ -42,6 +42,11 @@ error[E0425]: cannot find function `import` in this scope\n    |\n LL |     import();\n    |     ^^^^^^ not found in this scope\n+   |\n+help: consider importing this function\n+   |\n+LL | use other::import;\n+   |\n \n error[E0412]: cannot find type `A` in this scope\n   --> $DIR/glob-resolve1.rs:28:11"}, {"sha": "ee730910ee44153be90e0c503aaa40b825cfacd0", "filename": "src/test/ui/namespace/namespace-mix.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/404df1cbbfac0126d256f99a12a175d9ce96fd0f/src%2Ftest%2Fui%2Fnamespace%2Fnamespace-mix.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/404df1cbbfac0126d256f99a12a175d9ce96fd0f/src%2Ftest%2Fui%2Fnamespace%2Fnamespace-mix.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnamespace%2Fnamespace-mix.stderr?ref=404df1cbbfac0126d256f99a12a175d9ce96fd0f", "patch": "@@ -16,7 +16,7 @@ help: consider importing one of these items instead\n    |\n LL | use m2::S;\n    |\n-LL | use namespace_mix::xm2::S;\n+LL | use xm2::S;\n    |\n \n error[E0423]: expected value, found type alias `xm1::S`\n@@ -39,7 +39,7 @@ help: consider importing one of these items instead\n    |\n LL | use m2::S;\n    |\n-LL | use namespace_mix::xm2::S;\n+LL | use xm2::S;\n    |\n \n error[E0423]: expected value, found struct variant `m7::V`\n@@ -61,7 +61,7 @@ help: consider importing one of these items instead\n    |\n LL | use m8::V;\n    |\n-LL | use namespace_mix::xm8::V;\n+LL | use xm8::V;\n    |\n \n error[E0423]: expected value, found struct variant `xm7::V`\n@@ -83,7 +83,7 @@ help: consider importing one of these items instead\n    |\n LL | use m8::V;\n    |\n-LL | use namespace_mix::xm8::V;\n+LL | use xm8::V;\n    |\n \n error[E0277]: the trait bound `c::Item: Impossible` is not satisfied"}, {"sha": "d4fd7cb1257e051469f95a879c2fd1ab4e1f7547", "filename": "src/test/ui/resolve/issue-21221-2.stderr", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/404df1cbbfac0126d256f99a12a175d9ce96fd0f/src%2Ftest%2Fui%2Fresolve%2Fissue-21221-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/404df1cbbfac0126d256f99a12a175d9ce96fd0f/src%2Ftest%2Fui%2Fresolve%2Fissue-21221-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Fissue-21221-2.stderr?ref=404df1cbbfac0126d256f99a12a175d9ce96fd0f", "patch": "@@ -4,7 +4,9 @@ error[E0405]: cannot find trait `T` in this scope\n LL | impl T for Foo { }\n    |      ^ not found in this scope\n    |\n-help: consider importing this trait\n+help: consider importing one of these items\n+   |\n+LL | use baz::T;\n    |\n LL | use foo::bar::T;\n    |"}, {"sha": "16baa6c9b623311e58b0b4b6168b412118466e8c", "filename": "src/test/ui/resolve/privacy-enum-ctor.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/404df1cbbfac0126d256f99a12a175d9ce96fd0f/src%2Ftest%2Fui%2Fresolve%2Fprivacy-enum-ctor.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/404df1cbbfac0126d256f99a12a175d9ce96fd0f/src%2Ftest%2Fui%2Fresolve%2Fprivacy-enum-ctor.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fresolve%2Fprivacy-enum-ctor.stderr?ref=404df1cbbfac0126d256f99a12a175d9ce96fd0f", "patch": "@@ -132,7 +132,7 @@ LL |     let _: E = m::n::Z;\n    |            ^\n help: consider importing this enum\n    |\n-LL | use m::n::Z;\n+LL | use m::Z;\n    |\n \n error[E0423]: expected value, found enum `m::n::Z`\n@@ -165,7 +165,7 @@ LL |     let _: E = m::n::Z::Fn;\n    |            ^\n help: consider importing this enum\n    |\n-LL | use m::n::Z;\n+LL | use m::Z;\n    |\n \n error[E0412]: cannot find type `Z` in this scope\n@@ -183,7 +183,7 @@ LL |     let _: E = m::n::Z::Struct;\n    |            ^\n help: consider importing this enum\n    |\n-LL | use m::n::Z;\n+LL | use m::Z;\n    |\n \n error[E0423]: expected value, found struct variant `m::n::Z::Struct`\n@@ -212,7 +212,7 @@ LL |     let _: E = m::n::Z::Unit {};\n    |            ^\n help: consider importing this enum\n    |\n-LL | use m::n::Z;\n+LL | use m::Z;\n    |\n \n error[E0603]: enum `Z` is private"}]}