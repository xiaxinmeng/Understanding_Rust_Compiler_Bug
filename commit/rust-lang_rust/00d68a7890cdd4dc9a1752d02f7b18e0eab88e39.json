{"sha": "00d68a7890cdd4dc9a1752d02f7b18e0eab88e39", "node_id": "C_kwDOAAsO6NoAKDAwZDY4YTc4OTBjZGQ0ZGM5YTE3NTJkMDJmN2IxOGUwZWFiODhlMzk", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2022-07-01T21:39:10Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-07-01T21:39:10Z"}, "message": "Rollup merge of #98708 - pinkforest:rustdoc-fix-98690, r=GuillaumeGomez\n\nrustdoc: fix 98690 Panic if invalid path for -Z persist-doctests\n\nCloses #98690 for rustdoc panic\n\nI changed this to do eprintln and orderly panic instead of unwrap doing unhandled panic\n\n~/gg/rust/build/x86_64-unknown-linux-gnu/stage2/bin/rustdoc --test -Z unstable-options --persist-doctests /tmp/foobar main.rs\nCouldn't create directory for doctest executables: Permission denied (os error 13)", "tree": {"sha": "84b89c05133d25353aff7d19f9b2b3a242cb10ea", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/84b89c05133d25353aff7d19f9b2b3a242cb10ea"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/00d68a7890cdd4dc9a1752d02f7b18e0eab88e39", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiv2l+CRBK7hj4Ov3rIwAAiq0IAH2He2E+BvjKEbSIthoO3Sxw\nA3VF7DChMLHFaWt8tJRdDE66DLIrkyPYPs3tXRl2DNKatYquDmYJH3lS+P5ejxxG\niwTHKqrPZp+DykRM9nmryjPHxPitPP6xWdj/+9FXD2DOjowJf2iADQCAnLM2mESA\nsbbTWlrA5qCOswBUqLZ9ulwg2ky54h6hM0LuVq+DudGyxvBpq59Nr1OcKTZNep44\nWSDQj6F+g+YUEkBZnjIQcC7PgeVX7rCzuZESPd4bNIcBTzBrMIIBve7DtSHsxb0u\n+6o7zr+GNu4U0mpps1+CGluIXfQOqbRCD6/l/Kb3u2FxOAqIxyQM9VWhRl0RVwE=\n=Au9q\n-----END PGP SIGNATURE-----\n", "payload": "tree 84b89c05133d25353aff7d19f9b2b3a242cb10ea\nparent b0935b1ddf12f96546df32d805b7dd874459f4cb\nparent 6565509c19ec3f143c917335aa0f23b073ad1f0a\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1656711550 +0200\ncommitter GitHub <noreply@github.com> 1656711550 +0200\n\nRollup merge of #98708 - pinkforest:rustdoc-fix-98690, r=GuillaumeGomez\n\nrustdoc: fix 98690 Panic if invalid path for -Z persist-doctests\n\nCloses #98690 for rustdoc panic\n\nI changed this to do eprintln and orderly panic instead of unwrap doing unhandled panic\n\n~/gg/rust/build/x86_64-unknown-linux-gnu/stage2/bin/rustdoc --test -Z unstable-options --persist-doctests /tmp/foobar main.rs\nCouldn't create directory for doctest executables: Permission denied (os error 13)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/00d68a7890cdd4dc9a1752d02f7b18e0eab88e39", "html_url": "https://github.com/rust-lang/rust/commit/00d68a7890cdd4dc9a1752d02f7b18e0eab88e39", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/00d68a7890cdd4dc9a1752d02f7b18e0eab88e39/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b0935b1ddf12f96546df32d805b7dd874459f4cb", "url": "https://api.github.com/repos/rust-lang/rust/commits/b0935b1ddf12f96546df32d805b7dd874459f4cb", "html_url": "https://github.com/rust-lang/rust/commit/b0935b1ddf12f96546df32d805b7dd874459f4cb"}, {"sha": "6565509c19ec3f143c917335aa0f23b073ad1f0a", "url": "https://api.github.com/repos/rust-lang/rust/commits/6565509c19ec3f143c917335aa0f23b073ad1f0a", "html_url": "https://github.com/rust-lang/rust/commit/6565509c19ec3f143c917335aa0f23b073ad1f0a"}], "stats": {"total": 17, "additions": 15, "deletions": 2}, "files": [{"sha": "509c4253f0f76427c2f476483732ef8efb0f31d9", "filename": "src/librustdoc/doctest.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/00d68a7890cdd4dc9a1752d02f7b18e0eab88e39/src%2Flibrustdoc%2Fdoctest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/00d68a7890cdd4dc9a1752d02f7b18e0eab88e39/src%2Flibrustdoc%2Fdoctest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fdoctest.rs?ref=00d68a7890cdd4dc9a1752d02f7b18e0eab88e39", "patch": "@@ -1003,8 +1003,10 @@ impl Tester for Collector {\n         let outdir = if let Some(mut path) = rustdoc_options.persist_doctests.clone() {\n             path.push(&test_id);\n \n-            std::fs::create_dir_all(&path)\n-                .expect(\"Couldn't create directory for doctest executables\");\n+            if let Err(err) = std::fs::create_dir_all(&path) {\n+                eprintln!(\"Couldn't create directory for doctest executables: {}\", err);\n+                panic::resume_unwind(box ());\n+            }\n \n             DirState::Perm(path)\n         } else {"}, {"sha": "fe9bd87ab28e6452601fe462369a15b16a31f348", "filename": "src/test/rustdoc-ui/issue-98690.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/00d68a7890cdd4dc9a1752d02f7b18e0eab88e39/src%2Ftest%2Frustdoc-ui%2Fissue-98690.rs", "raw_url": "https://github.com/rust-lang/rust/raw/00d68a7890cdd4dc9a1752d02f7b18e0eab88e39/src%2Ftest%2Frustdoc-ui%2Fissue-98690.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fissue-98690.rs?ref=00d68a7890cdd4dc9a1752d02f7b18e0eab88e39", "patch": "@@ -0,0 +1,10 @@\n+// compile-flags: --test --persist-doctests /../../ -Z unstable-options\n+// failure-status: 101\n+// only-linux\n+\n+#![crate_name = \"foo\"]\n+\n+//! ```rust\n+//! use foo::dummy;\n+//! dummy();\n+//! ```"}, {"sha": "47d94f99a4563e2064a1cfb4d4e3cd60357e06f0", "filename": "src/test/rustdoc-ui/issue-98690.stderr", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/00d68a7890cdd4dc9a1752d02f7b18e0eab88e39/src%2Ftest%2Frustdoc-ui%2Fissue-98690.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/00d68a7890cdd4dc9a1752d02f7b18e0eab88e39/src%2Ftest%2Frustdoc-ui%2Fissue-98690.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fissue-98690.stderr?ref=00d68a7890cdd4dc9a1752d02f7b18e0eab88e39", "patch": "@@ -0,0 +1 @@\n+Couldn't create directory for doctest executables: Permission denied (os error 13)"}]}