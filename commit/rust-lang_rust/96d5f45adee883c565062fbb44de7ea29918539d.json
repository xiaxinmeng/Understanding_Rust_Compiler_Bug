{"sha": "96d5f45adee883c565062fbb44de7ea29918539d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk2ZDVmNDVhZGVlODgzYzU2NTA2MmZiYjQ0ZGU3ZWEyOTkxODUzOWQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-11-08T01:28:27Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-11-08T01:28:27Z"}, "message": "Auto merge of #6301 - alex-700:fix-map-clone, r=matthiaskrgr\n\ndo not trigger map_clone in the case of &mut\n\nfixes #6299\nchangelog: do not trigger map_clone in the case of &mut", "tree": {"sha": "2687e95aee0eacd93e9233377b4015a1a72351e5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2687e95aee0eacd93e9233377b4015a1a72351e5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/96d5f45adee883c565062fbb44de7ea29918539d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/96d5f45adee883c565062fbb44de7ea29918539d", "html_url": "https://github.com/rust-lang/rust/commit/96d5f45adee883c565062fbb44de7ea29918539d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/96d5f45adee883c565062fbb44de7ea29918539d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c015622568f03cbd6931e073c95de89040e95434", "url": "https://api.github.com/repos/rust-lang/rust/commits/c015622568f03cbd6931e073c95de89040e95434", "html_url": "https://github.com/rust-lang/rust/commit/c015622568f03cbd6931e073c95de89040e95434"}, {"sha": "5f57608604bd35bd11c1f33cbd7202250e072b54", "url": "https://api.github.com/repos/rust-lang/rust/commits/5f57608604bd35bd11c1f33cbd7202250e072b54", "html_url": "https://github.com/rust-lang/rust/commit/5f57608604bd35bd11c1f33cbd7202250e072b54"}], "stats": {"total": 24, "additions": 21, "deletions": 3}, "files": [{"sha": "9a00608ce3947842bfcf0a1657da3d2b1774c18f", "filename": "clippy_lints/src/map_clone.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/96d5f45adee883c565062fbb44de7ea29918539d/clippy_lints%2Fsrc%2Fmap_clone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96d5f45adee883c565062fbb44de7ea29918539d/clippy_lints%2Fsrc%2Fmap_clone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmap_clone.rs?ref=96d5f45adee883c565062fbb44de7ea29918539d", "patch": "@@ -80,9 +80,11 @@ impl<'tcx> LateLintPass<'tcx> for MapClone {\n                                     && match_trait_method(cx, closure_expr, &paths::CLONE_TRAIT) {\n \n                                     let obj_ty = cx.typeck_results().expr_ty(&obj[0]);\n-                                    if let ty::Ref(_, ty, _) = obj_ty.kind() {\n-                                        let copy = is_copy(cx, ty);\n-                                        lint(cx, e.span, args[0].span, copy);\n+                                    if let ty::Ref(_, ty, mutability) = obj_ty.kind() {\n+                                        if matches!(mutability, Mutability::Not) {\n+                                            let copy = is_copy(cx, ty);\n+                                            lint(cx, e.span, args[0].span, copy);\n+                                        }\n                                     } else {\n                                         lint_needless_cloning(cx, e.span, args[0].span);\n                                     }"}, {"sha": "6e3a8e67e811ebeb5cf99f4add616fcf816dd516", "filename": "tests/ui/map_clone.fixed", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/96d5f45adee883c565062fbb44de7ea29918539d/tests%2Fui%2Fmap_clone.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/96d5f45adee883c565062fbb44de7ea29918539d/tests%2Fui%2Fmap_clone.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmap_clone.fixed?ref=96d5f45adee883c565062fbb44de7ea29918539d", "patch": "@@ -44,4 +44,12 @@ fn main() {\n         let v = vec![&mut d];\n         let _: Vec<u32> = v.into_iter().map(|&mut x| x).collect();\n     }\n+\n+    // Issue #6299\n+    {\n+        let mut aa = 5;\n+        let mut bb = 3;\n+        let items = vec![&mut aa, &mut bb];\n+        let _: Vec<_> = items.into_iter().map(|x| x.clone()).collect();\n+    }\n }"}, {"sha": "6fd395710d4ba9d91ec44cb8b92666435eac78be", "filename": "tests/ui/map_clone.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/96d5f45adee883c565062fbb44de7ea29918539d/tests%2Fui%2Fmap_clone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96d5f45adee883c565062fbb44de7ea29918539d/tests%2Fui%2Fmap_clone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fmap_clone.rs?ref=96d5f45adee883c565062fbb44de7ea29918539d", "patch": "@@ -44,4 +44,12 @@ fn main() {\n         let v = vec![&mut d];\n         let _: Vec<u32> = v.into_iter().map(|&mut x| x).collect();\n     }\n+\n+    // Issue #6299\n+    {\n+        let mut aa = 5;\n+        let mut bb = 3;\n+        let items = vec![&mut aa, &mut bb];\n+        let _: Vec<_> = items.into_iter().map(|x| x.clone()).collect();\n+    }\n }"}]}