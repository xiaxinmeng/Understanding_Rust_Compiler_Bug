{"sha": "c28c495414d8d5bec83ca4c7e2781c1a7cc8d489", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMyOGM0OTU0MTRkOGQ1YmVjODNjYTRjN2UyNzgxYzFhN2NjOGQ0ODk=", "commit": {"author": {"name": "Young-il Choi", "email": "duddlf.choi@samsung.com", "date": "2013-06-01T08:27:05Z"}, "committer": {"name": "Young-il Choi", "email": "duddlf.choi@samsung.com", "date": "2013-06-01T08:28:58Z"}, "message": "etc: adb_run_wrapper.sh - fix to clean test (not produce Text File Busy)", "tree": {"sha": "cc877772843ae458b30824d0e9e6d13b50c3b2d9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cc877772843ae458b30824d0e9e6d13b50c3b2d9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c28c495414d8d5bec83ca4c7e2781c1a7cc8d489", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c28c495414d8d5bec83ca4c7e2781c1a7cc8d489", "html_url": "https://github.com/rust-lang/rust/commit/c28c495414d8d5bec83ca4c7e2781c1a7cc8d489", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c28c495414d8d5bec83ca4c7e2781c1a7cc8d489/comments", "author": {"login": "yichoi", "id": 3222276, "node_id": "MDQ6VXNlcjMyMjIyNzY=", "avatar_url": "https://avatars.githubusercontent.com/u/3222276?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yichoi", "html_url": "https://github.com/yichoi", "followers_url": "https://api.github.com/users/yichoi/followers", "following_url": "https://api.github.com/users/yichoi/following{/other_user}", "gists_url": "https://api.github.com/users/yichoi/gists{/gist_id}", "starred_url": "https://api.github.com/users/yichoi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yichoi/subscriptions", "organizations_url": "https://api.github.com/users/yichoi/orgs", "repos_url": "https://api.github.com/users/yichoi/repos", "events_url": "https://api.github.com/users/yichoi/events{/privacy}", "received_events_url": "https://api.github.com/users/yichoi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "yichoi", "id": 3222276, "node_id": "MDQ6VXNlcjMyMjIyNzY=", "avatar_url": "https://avatars.githubusercontent.com/u/3222276?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yichoi", "html_url": "https://github.com/yichoi", "followers_url": "https://api.github.com/users/yichoi/followers", "following_url": "https://api.github.com/users/yichoi/following{/other_user}", "gists_url": "https://api.github.com/users/yichoi/gists{/gist_id}", "starred_url": "https://api.github.com/users/yichoi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yichoi/subscriptions", "organizations_url": "https://api.github.com/users/yichoi/orgs", "repos_url": "https://api.github.com/users/yichoi/repos", "events_url": "https://api.github.com/users/yichoi/events{/privacy}", "received_events_url": "https://api.github.com/users/yichoi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0521d54ca1e194ba8564f4a000c50b7f708022ba", "url": "https://api.github.com/repos/rust-lang/rust/commits/0521d54ca1e194ba8564f4a000c50b7f708022ba", "html_url": "https://github.com/rust-lang/rust/commit/0521d54ca1e194ba8564f4a000c50b7f708022ba"}], "stats": {"total": 26, "additions": 19, "deletions": 7}, "files": [{"sha": "68ac6b4242c3e9f4610279195d147b128eca7e58", "filename": "src/etc/adb_run_wrapper.sh", "status": "modified", "additions": 19, "deletions": 7, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/c28c495414d8d5bec83ca4c7e2781c1a7cc8d489/src%2Fetc%2Fadb_run_wrapper.sh", "raw_url": "https://github.com/rust-lang/rust/raw/c28c495414d8d5bec83ca4c7e2781c1a7cc8d489/src%2Fetc%2Fadb_run_wrapper.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fadb_run_wrapper.sh?ref=c28c495414d8d5bec83ca4c7e2781c1a7cc8d489", "patch": "@@ -1,6 +1,10 @@\n #\n # usage : adb_run_wrapper [test dir - where test executables exist] [test executable]\n #\n+\n+# Sometimes android shell produce exitcode \"1 : Text File Busy\" \n+# Retry after $WAIT seconds, expecting resource cleaned-up\n+WAIT=10\n PATH=$1\n if [ -d \"$PATH\" ]\n then\n@@ -10,14 +14,22 @@ then\n     if [ ! -z \"$RUN\" ]\n     then\n         shift\n-        while [ -f $PATH/lock ]\n+\n+        L_RET=1\n+        L_COUNT=0\n+        while [ $L_RET -eq 1 ]\n         do\n-            /system/bin/sleep 1\n+            LD_LIBRARY_PATH=$PATH $PATH/$RUN $@ 1>$PATH/$RUN.stdout 2>$PATH/$RUN.stderr\n+            L_RET=$? \n+            if [ $L_COUNT -gt 0 ]\n+            then\n+               /system/bin/sleep $WAIT\n+               /system/bin/sync\n+            fi\n+            L_COUNT=`expr $L_COUNT+1`\n         done\n-        /system/bin/touch $PATH/lock\n-        LD_LIBRARY_PATH=$PATH $PATH/$RUN $@ 1>$PATH/$RUN.stdout 2>$PATH/$RUN.stderr\n-        echo $? > $PATH/$RUN.exitcode\n-        /system/bin/rm $PATH/lock\n-        /system/bin/sync\n+        \n+        echo $L_RET > $PATH/$RUN.exitcode\n+\n     fi\n fi"}]}