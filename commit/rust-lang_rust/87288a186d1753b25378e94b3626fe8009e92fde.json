{"sha": "87288a186d1753b25378e94b3626fe8009e92fde", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg3Mjg4YTE4NmQxNzUzYjI1Mzc4ZTk0YjM2MjZmZTgwMDllOTJmZGU=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-05-18T02:13:16Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-05-18T02:13:16Z"}, "message": "rustc: Make check_const() not rebuild the AST (although it's not called at the moment!)", "tree": {"sha": "dde5b53eda95fc3a578b307b47d9b352c9f20801", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dde5b53eda95fc3a578b307b47d9b352c9f20801"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/87288a186d1753b25378e94b3626fe8009e92fde", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/87288a186d1753b25378e94b3626fe8009e92fde", "html_url": "https://github.com/rust-lang/rust/commit/87288a186d1753b25378e94b3626fe8009e92fde", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/87288a186d1753b25378e94b3626fe8009e92fde/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d21741843c4c4af2d6fed4fc1d9824fbfd960579", "url": "https://api.github.com/repos/rust-lang/rust/commits/d21741843c4c4af2d6fed4fc1d9824fbfd960579", "html_url": "https://github.com/rust-lang/rust/commit/d21741843c4c4af2d6fed4fc1d9824fbfd960579"}], "stats": {"total": 5, "additions": 1, "deletions": 4}, "files": [{"sha": "ce39632e1ef07b461adce0c702799a5f7fa1e27f", "filename": "src/comp/middle/typeck.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/87288a186d1753b25378e94b3626fe8009e92fde/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87288a186d1753b25378e94b3626fe8009e92fde/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftypeck.rs?ref=87288a186d1753b25378e94b3626fe8009e92fde", "patch": "@@ -2662,7 +2662,7 @@ fn check_block(&@fn_ctxt fcx, &ast::block block) {\n }\n \n fn check_const(&@crate_ctxt ccx, &span sp, &ast::ident ident, &@ast::ty t,\n-               &@ast::expr e, &ast::def_id id, &ast::ann ann) -> @ast::item {\n+               &@ast::expr e, &ast::def_id id, &ast::ann ann) {\n     // FIXME: this is kinda a kludge; we manufacture a fake \"function context\"\n     // for checking the initializer expression.\n     auto rty = ann_to_type(ccx.node_types, ann);\n@@ -2671,10 +2671,7 @@ fn check_const(&@crate_ctxt ccx, &span sp, &ast::ident ident, &@ast::ty t,\n                             locals = @common::new_def_hash[ty::t](),\n                             ccx = ccx);\n     check_expr(fcx, e);\n-    // FIXME: necessary? Correct sequence?\n     Pushdown::pushdown_expr(fcx, rty, e);\n-    auto item = ast::item_const(ident, t, e, id, ann);\n-    ret @fold::respan[ast::item_](sp, item);\n }\n \n fn check_fn(&@crate_ctxt ccx, &ast::fn_decl decl, ast::proto proto,"}]}