{"sha": "5008e5682159965c6f3b174aed3523c0b5e2fc08", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUwMDhlNTY4MjE1OTk2NWM2ZjNiMTc0YWVkMzUyM2MwYjVlMmZjMDg=", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-03-14T12:34:28Z"}, "committer": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-03-14T12:36:45Z"}, "message": "xtask: replace \"lint\" command by a simply cargo alias\n\nThis strips the run_clippy implementation out of xtask and replaces it by\na simple \"cargo lint\" alias which runs clippy with the corresponding flags.\n\nUnfortunately  I could not name the alias \"clippy\" because that would lead to infinite recursion.", "tree": {"sha": "717c195e1ea7894c25d62cdab0b6c4526585eba1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/717c195e1ea7894c25d62cdab0b6c4526585eba1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5008e5682159965c6f3b174aed3523c0b5e2fc08", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5008e5682159965c6f3b174aed3523c0b5e2fc08", "html_url": "https://github.com/rust-lang/rust/commit/5008e5682159965c6f3b174aed3523c0b5e2fc08", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5008e5682159965c6f3b174aed3523c0b5e2fc08/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a8a7fa834726eb763fe872b02db821f99098a498", "url": "https://api.github.com/repos/rust-lang/rust/commits/a8a7fa834726eb763fe872b02db821f99098a498", "html_url": "https://github.com/rust-lang/rust/commit/a8a7fa834726eb763fe872b02db821f99098a498"}], "stats": {"total": 23, "additions": 1, "deletions": 22}, "files": [{"sha": "1447614b76363d6cd61b64c0a1678fcdd3988e64", "filename": ".cargo/config", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5008e5682159965c6f3b174aed3523c0b5e2fc08/.cargo%2Fconfig", "raw_url": "https://github.com/rust-lang/rust/raw/5008e5682159965c6f3b174aed3523c0b5e2fc08/.cargo%2Fconfig", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.cargo%2Fconfig?ref=5008e5682159965c6f3b174aed3523c0b5e2fc08", "patch": "@@ -3,6 +3,7 @@ xtask = \"run --package xtask --bin xtask --\"\n install-ra = \"run --package xtask --bin xtask -- install\" # for backwards compat\n tq = \"test -- -q\"\n qt = \"tq\"\n+lint = \"clippy --all-targets -- -Aclippy::collapsible_if -Aclippy::needless_pass_by_value -Aclippy::nonminimal_bool -Aclippy::redundant_pattern_matching --cap-lints warn\"\n \n [target.x86_64-pc-windows-msvc]\n linker = \"rust-lld\""}, {"sha": "4cd2b1ddbf1ae30c756ecc1ad19ae5e44f88d07a", "filename": "xtask/src/flags.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5008e5682159965c6f3b174aed3523c0b5e2fc08/xtask%2Fsrc%2Fflags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5008e5682159965c6f3b174aed3523c0b5e2fc08/xtask%2Fsrc%2Fflags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Fflags.rs?ref=5008e5682159965c6f3b174aed3523c0b5e2fc08", "patch": "@@ -27,7 +27,6 @@ xflags::xflags! {\n             optional --jemalloc\n         }\n \n-        cmd lint {}\n         cmd fuzz-tests {}\n         cmd pre-cache {}\n \n@@ -63,7 +62,6 @@ pub struct Xtask {\n pub enum XtaskCmd {\n     Help(Help),\n     Install(Install),\n-    Lint(Lint),\n     FuzzTests(FuzzTests),\n     PreCache(PreCache),\n     Release(Release),"}, {"sha": "915aae71a3149579b468ca2fb73ab5eea1192878", "filename": "xtask/src/main.rs", "status": "modified", "additions": 0, "deletions": 20, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/5008e5682159965c6f3b174aed3523c0b5e2fc08/xtask%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5008e5682159965c6f3b174aed3523c0b5e2fc08/xtask%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Fmain.rs?ref=5008e5682159965c6f3b174aed3523c0b5e2fc08", "patch": "@@ -40,7 +40,6 @@ fn main() -> Result<()> {\n             return Ok(());\n         }\n         flags::XtaskCmd::Install(cmd) => cmd.run(),\n-        flags::XtaskCmd::Lint(_) => run_clippy(),\n         flags::XtaskCmd::FuzzTests(_) => run_fuzzer(),\n         flags::XtaskCmd::PreCache(cmd) => cmd.run(),\n         flags::XtaskCmd::Release(cmd) => cmd.run(),\n@@ -95,25 +94,6 @@ fn ensure_rustfmt() -> Result<()> {\n     Ok(())\n }\n \n-fn run_clippy() -> Result<()> {\n-    if cmd!(\"cargo clippy --version\").read().is_err() {\n-        bail!(\n-            \"Failed run cargo clippy. \\\n-            Please run `rustup component add clippy` to install it.\",\n-        )\n-    }\n-\n-    let allowed_lints = \"\n-        -A clippy::collapsible_if\n-        -A clippy::needless_pass_by_value\n-        -A clippy::nonminimal_bool\n-        -A clippy::redundant_pattern_matching\n-    \"\n-    .split_ascii_whitespace();\n-    cmd!(\"cargo clippy --all-features --all-targets -- {allowed_lints...}\").run()?;\n-    Ok(())\n-}\n-\n fn run_fuzzer() -> Result<()> {\n     let _d = pushd(\"./crates/syntax\")?;\n     let _e = pushenv(\"RUSTUP_TOOLCHAIN\", \"nightly\");"}]}