{"sha": "668dac477eeb8b7d7bf0556c77bbc3292e5c7cc2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY2OGRhYzQ3N2VlYjhiN2Q3YmYwNTU2Yzc3YmJjMzI5MmU1YzdjYzI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-09-04T17:58:35Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-09-04T17:58:35Z"}, "message": "Auto merge of #28035 - Diggsey:msvc-escaping, r=alexcrichton\n\nThis fixes #28018 with the exception of the point about cmake, but that's really a limitation of `./configure` builds.", "tree": {"sha": "bc43846800f52b209a3d6c1b16f3b12bd4c81da3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bc43846800f52b209a3d6c1b16f3b12bd4c81da3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/668dac477eeb8b7d7bf0556c77bbc3292e5c7cc2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/668dac477eeb8b7d7bf0556c77bbc3292e5c7cc2", "html_url": "https://github.com/rust-lang/rust/commit/668dac477eeb8b7d7bf0556c77bbc3292e5c7cc2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/668dac477eeb8b7d7bf0556c77bbc3292e5c7cc2/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "62c45f4f25129af3708b7f5509d4503f5cce5b64", "url": "https://api.github.com/repos/rust-lang/rust/commits/62c45f4f25129af3708b7f5509d4503f5cce5b64", "html_url": "https://github.com/rust-lang/rust/commit/62c45f4f25129af3708b7f5509d4503f5cce5b64"}, {"sha": "f86c853fee203eed36cd41aa656def49e9614d00", "url": "https://api.github.com/repos/rust-lang/rust/commits/f86c853fee203eed36cd41aa656def49e9614d00", "html_url": "https://github.com/rust-lang/rust/commit/f86c853fee203eed36cd41aa656def49e9614d00"}], "stats": {"total": 19, "additions": 15, "deletions": 4}, "files": [{"sha": "45e137d4a9f41ce4ddc392a94e8354a2381d936e", "filename": "configure", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/668dac477eeb8b7d7bf0556c77bbc3292e5c7cc2/configure", "raw_url": "https://github.com/rust-lang/rust/raw/668dac477eeb8b7d7bf0556c77bbc3292e5c7cc2/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=668dac477eeb8b7d7bf0556c77bbc3292e5c7cc2", "patch": "@@ -1180,16 +1180,27 @@ do\n             # MSVC requires cmake because that's how we're going to build LLVM\n             probe_need CFG_CMAKE cmake\n \n+            # There are three builds of cmake on windows: MSVC, MinGW and Cygwin\n+            # The Cygwin build does not have generators for Visual Studio, so\n+            # detect that here and error.\n+            if ! \"$CFG_CMAKE\" --help | sed -n '/^Generators/,$p' | grep 'Visual Studio' > /dev/null\n+            then\n+                err \"cmake does not support Visual Studio generators.\\n\\n \\\n+                     This is likely due to it being an msys/cygwin build of cmake, \\\n+                     rather than the required windows version, built using MinGW \\\n+                     or Visual Studio.\"\n+            fi\n+\n             # Use the REG program to figure out where VS is installed\n             # We need to figure out where cl.exe and link.exe are, so we do some\n             # munging and some probing here. We also look for the default\n             # INCLUDE and LIB variables for MSVC so we can set those in the\n             # build system as well.\n-            install=$(reg QUERY \\\n+            install=$(cmd //c reg QUERY \\\n                        'HKLM\\SOFTWARE\\Wow6432Node\\Microsoft\\VisualStudio\\14.0' \\\n                        -v InstallDir)\n             if [ -z \"$install\" ]; then\n-              install=$(reg QUERY \\\n+              install=$(cmd //c reg QUERY \\\n                          'HKLM\\SOFTWARE\\Wow6432Node\\Microsoft\\VisualStudio\\12.0' \\\n                          -v InstallDir)\n             fi\n@@ -1222,9 +1233,9 @@ do\n             eval CFG_MSVC_LINK_$bits=\"\\\"$bindir/link.exe\\\"\"\n \n             vcvarsall=\"${CFG_MSVC_ROOT}/VC/vcvarsall.bat\"\n-            include_path=$(cmd /c \"\\\"$vcvarsall\\\" $msvc_part && cmd /c echo %INCLUDE%\")\n+            include_path=$(cmd //V:ON //c \"$vcvarsall\" $msvc_part \\& echo !INCLUDE!)\n             need_ok \"failed to learn about MSVC's INCLUDE\"\n-            lib_path=$(cmd /c \"\\\"$vcvarsall\\\" $msvc_part && cmd /c echo %LIB%\")\n+            lib_path=$(cmd //V:ON //c \"$vcvarsall\" $msvc_part \\& echo !LIB!)\n             need_ok \"failed to learn about MSVC's LIB\"\n \n             eval CFG_MSVC_INCLUDE_PATH_${bits}=\"\\\"$include_path\\\"\""}]}