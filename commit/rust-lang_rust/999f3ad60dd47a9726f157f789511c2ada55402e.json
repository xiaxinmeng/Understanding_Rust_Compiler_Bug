{"sha": "999f3ad60dd47a9726f157f789511c2ada55402e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk5OWYzYWQ2MGRkNDdhOTcyNmYxNTdmNzg5NTExYzJhZGE1NTQwMmU=", "commit": {"author": {"name": "Corey Farwell", "email": "coreyf@rwell.org", "date": "2017-06-16T04:32:45Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-06-16T04:32:45Z"}, "message": "Rollup merge of #42656 - VBChunguk:struct-field-attributes, r=nikomatsakis\n\nRemove struct_field_attributes feature gate\n\nPart of #41681. ~This PR only removes the feature gate; this *does not* update any documentations.~ This PR removes the feature gate and the corresponding chapter of the Unstable Book.\n\nI'm not very sure about the changes I made though... Just followed the stabilization guideline.\n\nr? @nikomatsakis", "tree": {"sha": "c997d7ba33b803914be46821fcf78aa90fcd00d8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c997d7ba33b803914be46821fcf78aa90fcd00d8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/999f3ad60dd47a9726f157f789511c2ada55402e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/999f3ad60dd47a9726f157f789511c2ada55402e", "html_url": "https://github.com/rust-lang/rust/commit/999f3ad60dd47a9726f157f789511c2ada55402e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/999f3ad60dd47a9726f157f789511c2ada55402e/comments", "author": {"login": "frewsxcv", "id": 416575, "node_id": "MDQ6VXNlcjQxNjU3NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/416575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/frewsxcv", "html_url": "https://github.com/frewsxcv", "followers_url": "https://api.github.com/users/frewsxcv/followers", "following_url": "https://api.github.com/users/frewsxcv/following{/other_user}", "gists_url": "https://api.github.com/users/frewsxcv/gists{/gist_id}", "starred_url": "https://api.github.com/users/frewsxcv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/frewsxcv/subscriptions", "organizations_url": "https://api.github.com/users/frewsxcv/orgs", "repos_url": "https://api.github.com/users/frewsxcv/repos", "events_url": "https://api.github.com/users/frewsxcv/events{/privacy}", "received_events_url": "https://api.github.com/users/frewsxcv/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f05afa09a8906adab3a27621437465cb26a36ceb", "url": "https://api.github.com/repos/rust-lang/rust/commits/f05afa09a8906adab3a27621437465cb26a36ceb", "html_url": "https://github.com/rust-lang/rust/commit/f05afa09a8906adab3a27621437465cb26a36ceb"}, {"sha": "65288f4026b7cb0c269bdc43bbacfdc37ddae92f", "url": "https://api.github.com/repos/rust-lang/rust/commits/65288f4026b7cb0c269bdc43bbacfdc37ddae92f", "html_url": "https://github.com/rust-lang/rust/commit/65288f4026b7cb0c269bdc43bbacfdc37ddae92f"}], "stats": {"total": 70, "additions": 3, "deletions": 67}, "files": [{"sha": "d8f742735a8d5ac4d5507535501801c849a81e2d", "filename": "src/doc/unstable-book/src/SUMMARY.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/999f3ad60dd47a9726f157f789511c2ada55402e/src%2Fdoc%2Funstable-book%2Fsrc%2FSUMMARY.md", "raw_url": "https://github.com/rust-lang/rust/raw/999f3ad60dd47a9726f157f789511c2ada55402e/src%2Fdoc%2Funstable-book%2Fsrc%2FSUMMARY.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2FSUMMARY.md?ref=999f3ad60dd47a9726f157f789511c2ada55402e", "patch": "@@ -87,7 +87,6 @@\n     - [start](language-features/start.md)\n     - [static_nobundle](language-features/static-nobundle.md)\n     - [stmt_expr_attributes](language-features/stmt-expr-attributes.md)\n-    - [struct_field_attributes](language-features/struct-field-attributes.md)\n     - [structural_match](language-features/structural-match.md)\n     - [target_feature](language-features/target-feature.md)\n     - [thread_local](language-features/thread-local.md)"}, {"sha": "1a94562968d192a11db9be21bda24c6f2e7f081e", "filename": "src/doc/unstable-book/src/language-features/struct-field-attributes.md", "status": "removed", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f05afa09a8906adab3a27621437465cb26a36ceb/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fstruct-field-attributes.md", "raw_url": "https://github.com/rust-lang/rust/raw/f05afa09a8906adab3a27621437465cb26a36ceb/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fstruct-field-attributes.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flanguage-features%2Fstruct-field-attributes.md?ref=f05afa09a8906adab3a27621437465cb26a36ceb", "patch": "@@ -1,10 +0,0 @@\n-# `struct_field_attributes`\n-\n-The tracking issue for this feature is: [#38814]\n-\n-[#38814]: https://github.com/rust-lang/rust/issues/38814\n-\n-------------------------\n-\n-\n-"}, {"sha": "cc0e5dec266db868ed0b4032dded7e59635bca31", "filename": "src/librustc_data_structures/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/999f3ad60dd47a9726f157f789511c2ada55402e/src%2Flibrustc_data_structures%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/999f3ad60dd47a9726f157f789511c2ada55402e/src%2Flibrustc_data_structures%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_data_structures%2Flib.rs?ref=999f3ad60dd47a9726f157f789511c2ada55402e", "patch": "@@ -36,11 +36,11 @@\n #![feature(discriminant_value)]\n #![feature(specialization)]\n #![feature(manually_drop)]\n-#![feature(struct_field_attributes)]\n \n #![cfg_attr(stage0, unstable(feature = \"rustc_private\", issue = \"27812\"))]\n #![cfg_attr(stage0, feature(rustc_private))]\n #![cfg_attr(stage0, feature(staged_api))]\n+#![cfg_attr(stage0, feature(struct_field_attributes))]\n \n #![cfg_attr(unix, feature(libc))]\n #![cfg_attr(test, feature(test))]"}, {"sha": "54e6dde41e6d48cacd63c1187cf55e1a91f74a57", "filename": "src/libsyntax/config.rs", "status": "modified", "additions": 0, "deletions": 28, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/999f3ad60dd47a9726f157f789511c2ada55402e/src%2Flibsyntax%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/999f3ad60dd47a9726f157f789511c2ada55402e/src%2Flibsyntax%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fconfig.rs?ref=999f3ad60dd47a9726f157f789511c2ada55402e", "patch": "@@ -223,7 +223,6 @@ impl<'a> StripUnconfigured<'a> {\n             ast::ExprKind::Struct(path, fields, base) => {\n                 let fields = fields.into_iter()\n                     .filter_map(|field| {\n-                        self.visit_struct_field_attrs(field.attrs());\n                         self.configure(field)\n                     })\n                     .collect();\n@@ -256,17 +255,6 @@ impl<'a> StripUnconfigured<'a> {\n     }\n \n     pub fn configure_struct_expr_field(&mut self, field: ast::Field) -> Option<ast::Field> {\n-        if !self.features.map(|features| features.struct_field_attributes).unwrap_or(true) {\n-            if !field.attrs.is_empty() {\n-                let mut err = feature_err(self.sess,\n-                                          \"struct_field_attributes\",\n-                                          field.span,\n-                                          GateIssue::Language,\n-                                          \"attributes on struct literal fields are unstable\");\n-                err.emit();\n-            }\n-        }\n-\n         self.configure(field)\n     }\n \n@@ -275,7 +263,6 @@ impl<'a> StripUnconfigured<'a> {\n             if let ast::PatKind::Struct(path, fields, etc) = pattern.node {\n                 let fields = fields.into_iter()\n                     .filter_map(|field| {\n-                        self.visit_struct_field_attrs(field.attrs());\n                         self.configure(field)\n                     })\n                     .collect();\n@@ -284,21 +271,6 @@ impl<'a> StripUnconfigured<'a> {\n             pattern\n         })\n     }\n-\n-    fn visit_struct_field_attrs(&mut self, attrs: &[ast::Attribute]) {\n-        // flag the offending attributes\n-        for attr in attrs.iter() {\n-            if !self.features.map(|features| features.struct_field_attributes).unwrap_or(true) {\n-                let mut err = feature_err(\n-                    self.sess,\n-                    \"struct_field_attributes\",\n-                    attr.span,\n-                    GateIssue::Language,\n-                    \"attributes on struct pattern or literal fields are unstable\");\n-                err.emit();\n-            }\n-        }\n-    }\n }\n \n impl<'a> fold::Folder for StripUnconfigured<'a> {"}, {"sha": "4543378789dfea8782e25f833ca1ee0a151c9779", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/999f3ad60dd47a9726f157f789511c2ada55402e/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/999f3ad60dd47a9726f157f789511c2ada55402e/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=999f3ad60dd47a9726f157f789511c2ada55402e", "patch": "@@ -312,9 +312,6 @@ declare_features! (\n     // Declarative macros 2.0 (`macro`).\n     (active, decl_macro, \"1.17.0\", Some(39412)),\n \n-    // Allows attributes on struct literal fields.\n-    (active, struct_field_attributes, \"1.16.0\", Some(38814)),\n-\n     // Allows #[link(kind=\"static-nobundle\"...]\n     (active, static_nobundle, \"1.16.0\", Some(37403)),\n \n@@ -430,6 +427,8 @@ declare_features! (\n     (accepted, relaxed_adts, \"1.19.0\", Some(35626)),\n     // Coerces non capturing closures to function pointers\n     (accepted, closure_to_fn_coercion, \"1.19.0\", Some(39817)),\n+    // Allows attributes on struct literal fields.\n+    (accepted, struct_field_attributes, \"1.20.0\", Some(38814)),\n );\n \n // If you change this, please modify src/doc/unstable-book as well. You must"}, {"sha": "47495be4ad2c9c67b7aa60cf86b317d22ec59d9b", "filename": "src/test/compile-fail/struct-field-attr-feature-gate.rs", "status": "removed", "additions": 0, "deletions": 22, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/f05afa09a8906adab3a27621437465cb26a36ceb/src%2Ftest%2Fcompile-fail%2Fstruct-field-attr-feature-gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f05afa09a8906adab3a27621437465cb26a36ceb/src%2Ftest%2Fcompile-fail%2Fstruct-field-attr-feature-gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fstruct-field-attr-feature-gate.rs?ref=f05afa09a8906adab3a27621437465cb26a36ceb", "patch": "@@ -1,22 +0,0 @@\n-// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-// gate-test-struct_field_attributes\n-\n-struct Foo {\n-    present: (),\n-}\n-\n-fn main() {\n-    let foo = Foo { #[cfg(all())] present: () };\n-    //~^ ERROR attributes on struct pattern or literal fields are unstable\n-    let Foo { #[cfg(all())] present: () } = foo;\n-    //~^ ERROR attributes on struct pattern or literal fields are unstable\n-}"}, {"sha": "974d500d9cbdbdcfe9f56aaebc9ca5434cb45d73", "filename": "src/test/compile-fail/struct-field-cfg.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/999f3ad60dd47a9726f157f789511c2ada55402e/src%2Ftest%2Fcompile-fail%2Fstruct-field-cfg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/999f3ad60dd47a9726f157f789511c2ada55402e/src%2Ftest%2Fcompile-fail%2Fstruct-field-cfg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fstruct-field-cfg.rs?ref=999f3ad60dd47a9726f157f789511c2ada55402e", "patch": "@@ -8,8 +8,6 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-#![feature(struct_field_attributes)]\n-\n struct Foo {\n     present: (),\n }"}]}