{"sha": "99c1b2953d5429fd78121b4fd7e698e79791ecf4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk5YzFiMjk1M2Q1NDI5ZmQ3ODEyMWI0ZmQ3ZTY5OGU3OTc5MWVjZjQ=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-05-22T21:55:39Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-05-23T01:07:36Z"}, "message": "syntax: Add diagnostic::expect", "tree": {"sha": "5ae02f67375632231474fca882df580a82eb22bc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5ae02f67375632231474fca882df580a82eb22bc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/99c1b2953d5429fd78121b4fd7e698e79791ecf4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/99c1b2953d5429fd78121b4fd7e698e79791ecf4", "html_url": "https://github.com/rust-lang/rust/commit/99c1b2953d5429fd78121b4fd7e698e79791ecf4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/99c1b2953d5429fd78121b4fd7e698e79791ecf4/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a32392d032435bf3cf05d2c70671f5076b4da3ee", "url": "https://api.github.com/repos/rust-lang/rust/commits/a32392d032435bf3cf05d2c70671f5076b4da3ee", "html_url": "https://github.com/rust-lang/rust/commit/a32392d032435bf3cf05d2c70671f5076b4da3ee"}], "stats": {"total": 14, "additions": 10, "deletions": 4}, "files": [{"sha": "64904d612ced92dbc379917d5c79e917ef7305af", "filename": "src/librustsyntax/diagnostic.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/99c1b2953d5429fd78121b4fd7e698e79791ecf4/src%2Flibrustsyntax%2Fdiagnostic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/99c1b2953d5429fd78121b4fd7e698e79791ecf4/src%2Flibrustsyntax%2Fdiagnostic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustsyntax%2Fdiagnostic.rs?ref=99c1b2953d5429fd78121b4fd7e698e79791ecf4", "patch": "@@ -7,6 +7,7 @@ export level, fatal, error, warning, note;\n export span_handler, handler, mk_span_handler, mk_handler;\n export codemap_span_handler, codemap_handler;\n export ice_msg;\n+export expect;\n \n type emitter = fn@(cmsp: option<(codemap::codemap, span)>,\n                    msg: str, lvl: level);\n@@ -253,3 +254,11 @@ fn print_macro_backtrace(cm: codemap::codemap, sp: span) {\n         print_macro_backtrace(cm, ei.call_site);\n     }\n }\n+\n+fn expect<T: copy>(diag: span_handler,\n+                   opt: option<T>, msg: fn() -> str) -> T {\n+    alt opt {\n+       some(t) { t }\n+       none { diag.handler().bug(msg()); }\n+    }\n+}"}, {"sha": "deecce66b304333e596355b750a610d18cd113e1", "filename": "src/rustc/driver/session.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/99c1b2953d5429fd78121b4fd7e698e79791ecf4/src%2Frustc%2Fdriver%2Fsession.rs", "raw_url": "https://github.com/rust-lang/rust/raw/99c1b2953d5429fd78121b4fd7e698e79791ecf4/src%2Frustc%2Fdriver%2Fsession.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Fdriver%2Fsession.rs?ref=99c1b2953d5429fd78121b4fd7e698e79791ecf4", "patch": "@@ -171,10 +171,7 @@ fn basic_options() -> @options {\n \n // Seems out of place, but it uses session, so I'm putting it here\n fn expect<T: copy>(sess: session, opt: option<T>, msg: fn() -> str) -> T {\n-    alt opt {\n-       some(t) { t }\n-       none { sess.bug(msg()); }\n-    }\n+    diagnostic::expect(sess.diagnostic(), opt, msg)\n }\n \n fn building_library(req_crate_type: crate_type, crate: @ast::crate,"}]}