{"sha": "6a730246617d7c40ed8fe71e50654cbef3d379c2", "node_id": "C_kwDOAAsO6NoAKDZhNzMwMjQ2NjE3ZDdjNDBlZDhmZTcxZTUwNjU0Y2JlZjNkMzc5YzI", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-03-19T13:50:25Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-03-19T13:50:25Z"}, "message": "Rollup merge of #94991 - CAD97:const-weak-new, r=dtolnay\n\nMake Weak::new const\n\nSimple enough. This is const creation of an allocating container, but no actual allocation is done, because it's defined to.", "tree": {"sha": "be2a5332f56ca0d0011b20f84fd2a7092d3243f9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/be2a5332f56ca0d0011b20f84fd2a7092d3243f9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6a730246617d7c40ed8fe71e50654cbef3d379c2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiNd+iCRBK7hj4Ov3rIwAAbAkIAE2SzHUnmAIZvmj74eJ1lFW5\nbfTp9hux4SWkxfFVv/MmQO1DQ5lFvu5jc7xgkRXmHgjT4QW0RcNcok6Lt0Vlg58b\n6dch5PestWO+htIAZqy59PpVPfSsrNewls2IUf6HNx/U5Elw3xMajT/MWAxSsLBd\nUI422LphDMice6oAqg42RttozG5i9Inno2C2S0HsK9SpBFw73f/XAxZt3j8WaDfO\nZ6A/OimN9D/PSrzr8FtQweow6s2Ers2Zzgwtd0SMg+Lv8qd9qkuczCsbQNgLLycO\nWJjUS7nStkJG2vCrIaTwoOyLPMjfoyZGJ7dAFr8lQpaoxbgT1yi2NPh+5bnYwaU=\n=5IYe\n-----END PGP SIGNATURE-----\n", "payload": "tree be2a5332f56ca0d0011b20f84fd2a7092d3243f9\nparent d1ef570a2f24d70bccf274934a8fd0d63de7073f\nparent a358ad2aff788bf21cf9c17662da7e962d75fc83\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1647697825 +0100\ncommitter GitHub <noreply@github.com> 1647697825 +0100\n\nRollup merge of #94991 - CAD97:const-weak-new, r=dtolnay\n\nMake Weak::new const\n\nSimple enough. This is const creation of an allocating container, but no actual allocation is done, because it's defined to.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6a730246617d7c40ed8fe71e50654cbef3d379c2", "html_url": "https://github.com/rust-lang/rust/commit/6a730246617d7c40ed8fe71e50654cbef3d379c2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6a730246617d7c40ed8fe71e50654cbef3d379c2/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d1ef570a2f24d70bccf274934a8fd0d63de7073f", "url": "https://api.github.com/repos/rust-lang/rust/commits/d1ef570a2f24d70bccf274934a8fd0d63de7073f", "html_url": "https://github.com/rust-lang/rust/commit/d1ef570a2f24d70bccf274934a8fd0d63de7073f"}, {"sha": "a358ad2aff788bf21cf9c17662da7e962d75fc83", "url": "https://api.github.com/repos/rust-lang/rust/commits/a358ad2aff788bf21cf9c17662da7e962d75fc83", "html_url": "https://github.com/rust-lang/rust/commit/a358ad2aff788bf21cf9c17662da7e962d75fc83"}], "stats": {"total": 10, "additions": 6, "deletions": 4}, "files": [{"sha": "ea651c075d9682639327ab40a1e4d44a544d5881", "filename": "library/alloc/src/rc.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6a730246617d7c40ed8fe71e50654cbef3d379c2/library%2Falloc%2Fsrc%2Frc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6a730246617d7c40ed8fe71e50654cbef3d379c2/library%2Falloc%2Fsrc%2Frc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Frc.rs?ref=6a730246617d7c40ed8fe71e50654cbef3d379c2", "patch": "@@ -2112,9 +2112,10 @@ impl<T> Weak<T> {\n     /// assert!(empty.upgrade().is_none());\n     /// ```\n     #[stable(feature = \"downgraded_weak\", since = \"1.10.0\")]\n+    #[rustc_const_unstable(feature = \"const_weak_new\", issue = \"95091\", reason = \"recently added\")]\n     #[must_use]\n-    pub fn new() -> Weak<T> {\n-        Weak { ptr: NonNull::new(usize::MAX as *mut RcBox<T>).expect(\"MAX is not 0\") }\n+    pub const fn new() -> Weak<T> {\n+        Weak { ptr: unsafe { NonNull::new_unchecked(usize::MAX as *mut RcBox<T>) } }\n     }\n }\n "}, {"sha": "ba3187294e6543f4b8e4a4060d91ba9fd213457d", "filename": "library/alloc/src/sync.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/6a730246617d7c40ed8fe71e50654cbef3d379c2/library%2Falloc%2Fsrc%2Fsync.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6a730246617d7c40ed8fe71e50654cbef3d379c2/library%2Falloc%2Fsrc%2Fsync.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fsync.rs?ref=6a730246617d7c40ed8fe71e50654cbef3d379c2", "patch": "@@ -1742,9 +1742,10 @@ impl<T> Weak<T> {\n     /// assert!(empty.upgrade().is_none());\n     /// ```\n     #[stable(feature = \"downgraded_weak\", since = \"1.10.0\")]\n+    #[rustc_const_unstable(feature = \"const_weak_new\", issue = \"95091\", reason = \"recently added\")]\n     #[must_use]\n-    pub fn new() -> Weak<T> {\n-        Weak { ptr: NonNull::new(usize::MAX as *mut ArcInner<T>).expect(\"MAX is not 0\") }\n+    pub const fn new() -> Weak<T> {\n+        Weak { ptr: unsafe { NonNull::new_unchecked(usize::MAX as *mut ArcInner<T>) } }\n     }\n }\n "}]}