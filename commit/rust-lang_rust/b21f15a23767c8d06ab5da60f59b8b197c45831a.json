{"sha": "b21f15a23767c8d06ab5da60f59b8b197c45831a", "node_id": "C_kwDOAAsO6NoAKGIyMWYxNWEyMzc2N2M4ZDA2YWI1ZGE2MGY1OWI4YjE5N2M0NTgzMWE", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-09-29T19:20:12Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-09-29T19:20:12Z"}, "message": "Merge #10389\n\n10389: fix: use the right `HirFileId` when expanding macros in fn parameters r=Veykril a=SkiFire13\n\nFixes #10388\n\nCo-authored-by: Giacomo Stevanato <giaco.stevanato@gmail.com>", "tree": {"sha": "f448c79bb3d4fc39d8b8e947d1cebca28c9972f5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f448c79bb3d4fc39d8b8e947d1cebca28c9972f5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b21f15a23767c8d06ab5da60f59b8b197c45831a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhVLxsCRBK7hj4Ov3rIwAA0e4IAFE/fRBONtkdDCSfx3J1bMK3\nA4o2jpQrt/xvPoABUbcFy0Jv2Vied4VBDFW+E+9YTebLYVFLEYhuCCC4mh8uATkW\nxKhThdTgHpa6qpdKZoOlo2+kOfFYzUnju7cWPa/XobxtzM6xTVjst6eTEPrecENJ\nak8/rMesnV4/RayKRGyN45d9Mqgx+Z1fX3UmKVIq6DqfK4IpyB3lfm5MocjOrPZj\nqJ7uUEAKj5zqyAhNgkOgXnZfUKSqlv8K8h6IiERP5NuCpJS4ZbhV/4k/smb17SQY\nFzyQNt65WtUA0F+8WKTITK8MlEjzPfbuvB8POCwKl8z+8a1HFwlFFqfkBk87Jvo=\n=Ull0\n-----END PGP SIGNATURE-----\n", "payload": "tree f448c79bb3d4fc39d8b8e947d1cebca28c9972f5\nparent 9e3e98db8ac9374916e76de42e6710dc23caacbc\nparent 034dd41ea81264a6cb3f4e84d49a99ecd4a96406\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1632943212 +0000\ncommitter GitHub <noreply@github.com> 1632943212 +0000\n\nMerge #10389\n\n10389: fix: use the right `HirFileId` when expanding macros in fn parameters r=Veykril a=SkiFire13\n\nFixes #10388\n\nCo-authored-by: Giacomo Stevanato <giaco.stevanato@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b21f15a23767c8d06ab5da60f59b8b197c45831a", "html_url": "https://github.com/rust-lang/rust/commit/b21f15a23767c8d06ab5da60f59b8b197c45831a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b21f15a23767c8d06ab5da60f59b8b197c45831a/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9e3e98db8ac9374916e76de42e6710dc23caacbc", "url": "https://api.github.com/repos/rust-lang/rust/commits/9e3e98db8ac9374916e76de42e6710dc23caacbc", "html_url": "https://github.com/rust-lang/rust/commit/9e3e98db8ac9374916e76de42e6710dc23caacbc"}, {"sha": "034dd41ea81264a6cb3f4e84d49a99ecd4a96406", "url": "https://api.github.com/repos/rust-lang/rust/commits/034dd41ea81264a6cb3f4e84d49a99ecd4a96406", "html_url": "https://github.com/rust-lang/rust/commit/034dd41ea81264a6cb3f4e84d49a99ecd4a96406"}], "stats": {"total": 25, "additions": 24, "deletions": 1}, "files": [{"sha": "8622357cd42d3fdd31d51945b7de59ec8ecaabbb", "filename": "crates/hir_def/src/generics.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b21f15a23767c8d06ab5da60f59b8b197c45831a/crates%2Fhir_def%2Fsrc%2Fgenerics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b21f15a23767c8d06ab5da60f59b8b197c45831a/crates%2Fhir_def%2Fsrc%2Fgenerics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fgenerics.rs?ref=b21f15a23767c8d06ab5da60f59b8b197c45831a", "patch": "@@ -299,7 +299,7 @@ impl GenericParams {\n                 let macro_call = mc.to_node(db.upcast());\n                 match expander.enter_expand::<ast::Type>(db, macro_call) {\n                     Ok(ExpandResult { value: Some((mark, expanded)), .. }) => {\n-                        let ctx = LowerCtx::new(db, mc.file_id);\n+                        let ctx = LowerCtx::new(db, expander.current_file_id());\n                         let type_ref = TypeRef::from_ast(&ctx, expanded);\n                         self.fill_implicit_impl_trait_args(db, expander, &type_ref);\n                         expander.exit(db, mark);"}, {"sha": "67952edca389d548b54c6dc5341ab2f37afb68e9", "filename": "crates/hir_ty/src/tests/regression.rs", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/b21f15a23767c8d06ab5da60f59b8b197c45831a/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b21f15a23767c8d06ab5da60f59b8b197c45831a/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs?ref=b21f15a23767c8d06ab5da60f59b8b197c45831a", "patch": "@@ -1198,3 +1198,26 @@ fn bar() {\n     \"#,\n     )\n }\n+\n+#[test]\n+fn nested_macro_in_fn_params() {\n+    check_no_mismatches(\n+        r#\"\n+macro_rules! U32Inner {\n+    () => {\n+        u32\n+    };\n+}\n+\n+macro_rules! U32 {\n+    () => {\n+        U32Inner!()\n+    };\n+}\n+\n+fn mamba(a: U32!(), p: u32) -> u32 {\n+    a\n+}\n+    \"#,\n+    )\n+}"}]}