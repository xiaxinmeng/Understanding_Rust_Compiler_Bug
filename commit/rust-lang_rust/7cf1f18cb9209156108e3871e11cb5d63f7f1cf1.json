{"sha": "7cf1f18cb9209156108e3871e11cb5d63f7f1cf1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdjZjFmMThjYjkyMDkxNTYxMDhlMzg3MWUxMWNiNWQ2M2Y3ZjFjZjE=", "commit": {"author": {"name": "Simon Sapin", "email": "simon.sapin@exyr.org", "date": "2018-02-16T18:28:13Z"}, "committer": {"name": "Simon Sapin", "email": "simon.sapin@exyr.org", "date": "2018-03-17T22:07:40Z"}, "message": "Test NonZero in a const item in a pattern.\n\n(This was buggy before https://github.com/rust-lang/rust/pull/46882)", "tree": {"sha": "1665a029ff20f72d7ba0ad42294ccb600cac48bf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1665a029ff20f72d7ba0ad42294ccb600cac48bf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7cf1f18cb9209156108e3871e11cb5d63f7f1cf1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7cf1f18cb9209156108e3871e11cb5d63f7f1cf1", "html_url": "https://github.com/rust-lang/rust/commit/7cf1f18cb9209156108e3871e11cb5d63f7f1cf1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7cf1f18cb9209156108e3871e11cb5d63f7f1cf1/comments", "author": {"login": "SimonSapin", "id": 291359, "node_id": "MDQ6VXNlcjI5MTM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/291359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SimonSapin", "html_url": "https://github.com/SimonSapin", "followers_url": "https://api.github.com/users/SimonSapin/followers", "following_url": "https://api.github.com/users/SimonSapin/following{/other_user}", "gists_url": "https://api.github.com/users/SimonSapin/gists{/gist_id}", "starred_url": "https://api.github.com/users/SimonSapin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SimonSapin/subscriptions", "organizations_url": "https://api.github.com/users/SimonSapin/orgs", "repos_url": "https://api.github.com/users/SimonSapin/repos", "events_url": "https://api.github.com/users/SimonSapin/events{/privacy}", "received_events_url": "https://api.github.com/users/SimonSapin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "SimonSapin", "id": 291359, "node_id": "MDQ6VXNlcjI5MTM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/291359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SimonSapin", "html_url": "https://github.com/SimonSapin", "followers_url": "https://api.github.com/users/SimonSapin/followers", "following_url": "https://api.github.com/users/SimonSapin/following{/other_user}", "gists_url": "https://api.github.com/users/SimonSapin/gists{/gist_id}", "starred_url": "https://api.github.com/users/SimonSapin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SimonSapin/subscriptions", "organizations_url": "https://api.github.com/users/SimonSapin/orgs", "repos_url": "https://api.github.com/users/SimonSapin/repos", "events_url": "https://api.github.com/users/SimonSapin/events{/privacy}", "received_events_url": "https://api.github.com/users/SimonSapin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6d682c9adc12c5aee1bac37afa15f01b420be8ee", "url": "https://api.github.com/repos/rust-lang/rust/commits/6d682c9adc12c5aee1bac37afa15f01b420be8ee", "html_url": "https://github.com/rust-lang/rust/commit/6d682c9adc12c5aee1bac37afa15f01b420be8ee"}], "stats": {"total": 23, "additions": 23, "deletions": 0}, "files": [{"sha": "8d39298bac3d1b1b3cd13210987fac5e94a1bf71", "filename": "src/libcore/tests/nonzero.rs", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/7cf1f18cb9209156108e3871e11cb5d63f7f1cf1/src%2Flibcore%2Ftests%2Fnonzero.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7cf1f18cb9209156108e3871e11cb5d63f7f1cf1/src%2Flibcore%2Ftests%2Fnonzero.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftests%2Fnonzero.rs?ref=7cf1f18cb9209156108e3871e11cb5d63f7f1cf1", "patch": "@@ -98,3 +98,26 @@ fn test_match_option_string() {\n         None => panic!(\"unexpected None while matching on Some(String { ... })\")\n     }\n }\n+\n+mod atom {\n+    use core::num::NonZeroU32;\n+\n+    #[derive(PartialEq, Eq)]\n+    pub struct Atom {\n+        index: NonZeroU32, // private\n+    }\n+    pub const FOO_ATOM: Atom = Atom { index: unsafe { NonZeroU32::new_unchecked(7) } };\n+}\n+\n+macro_rules! atom {\n+    (\"foo\") => { atom::FOO_ATOM }\n+}\n+\n+#[test]\n+fn test_match_nonzero_const_pattern() {\n+    match atom!(\"foo\") {\n+        // Using as a pattern is supported by the compiler:\n+        atom!(\"foo\") => {}\n+        _ => panic!(\"Expected the const item as a pattern to match.\")\n+    }\n+}"}]}