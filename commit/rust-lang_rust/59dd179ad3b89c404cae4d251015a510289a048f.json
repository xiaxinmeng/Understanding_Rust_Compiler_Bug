{"sha": "59dd179ad3b89c404cae4d251015a510289a048f", "node_id": "C_kwDOAAsO6NoAKDU5ZGQxNzlhZDNiODljNDA0Y2FlNGQyNTEwMTVhNTEwMjg5YTA0OGY", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-03-17T21:55:02Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-03-17T21:55:02Z"}, "message": "Rollup merge of #94309 - eholk:issue-57017, r=tmandry\n\n[generator_interior] Be more precise with scopes of borrowed places\n\nPreviously the generator interior type checking analysis would use the nearest temporary scope as the scope of a borrowed value. This ends up being overly broad for cases such as:\n\n```rust\nfn status(_client_status: &Client) -> i16 {\n    200\n}\n\nfn main() {\n    let client = Client;\n    let g = move || match status(&client) {\n        _status => yield,\n    };\n    assert_send(g);\n}\n```\n\nIn this case, the borrow `&client` could be considered in scope for the entirety of the `match` expression, meaning it would be viewed as live across the `yield`, therefore making the generator not `Send`.\n\nIn most cases, we want to use the enclosing expression as the scope for a borrowed value which will be less than or equal to the nearest temporary scope. This PR changes the analysis to use the enclosing expression as the scope for most borrows, with the exception of borrowed RValues which are true temporary values that should have the temporary scope. There's one further exception where borrows of a copy such as happens in autoref cases also should be ignored despite being RValues.\n\nJoint work with `@nikomatsakis`\n\nFixes #57017\n\nr? `@tmandry`", "tree": {"sha": "7d0a395c7709e24da035afa1ea02b7745568b4a1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7d0a395c7709e24da035afa1ea02b7745568b4a1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/59dd179ad3b89c404cae4d251015a510289a048f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/59dd179ad3b89c404cae4d251015a510289a048f", "html_url": "https://github.com/rust-lang/rust/commit/59dd179ad3b89c404cae4d251015a510289a048f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/59dd179ad3b89c404cae4d251015a510289a048f/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5ed40229acb46d11b6c37ac53bf85eea3af9bf1d", "url": "https://api.github.com/repos/rust-lang/rust/commits/5ed40229acb46d11b6c37ac53bf85eea3af9bf1d", "html_url": "https://github.com/rust-lang/rust/commit/5ed40229acb46d11b6c37ac53bf85eea3af9bf1d"}, {"sha": "05008fe1272942e07f819e526b1cfb85d431dcbd", "url": "https://api.github.com/repos/rust-lang/rust/commits/05008fe1272942e07f819e526b1cfb85d431dcbd", "html_url": "https://github.com/rust-lang/rust/commit/05008fe1272942e07f819e526b1cfb85d431dcbd"}], "stats": {"total": 0, "additions": 0, "deletions": 0}, "files": []}