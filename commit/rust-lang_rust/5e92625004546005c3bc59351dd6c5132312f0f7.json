{"sha": "5e92625004546005c3bc59351dd6c5132312f0f7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVlOTI2MjUwMDQ1NDYwMDVjM2JjNTkzNTFkZDZjNTEzMjMxMmYwZjc=", "commit": {"author": {"name": "Matthew Jasper", "email": "mjjasper1@gmail.com", "date": "2020-01-04T13:08:17Z"}, "committer": {"name": "Matthew Jasper", "email": "mjjasper1@gmail.com", "date": "2020-01-05T18:13:01Z"}, "message": "Correctly check for opaque types in `assoc_ty_def`", "tree": {"sha": "670312e3dd9915f8f88a3040506d4fb5f03f961c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/670312e3dd9915f8f88a3040506d4fb5f03f961c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5e92625004546005c3bc59351dd6c5132312f0f7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5e92625004546005c3bc59351dd6c5132312f0f7", "html_url": "https://github.com/rust-lang/rust/commit/5e92625004546005c3bc59351dd6c5132312f0f7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5e92625004546005c3bc59351dd6c5132312f0f7/comments", "author": {"login": "matthewjasper", "id": 20113453, "node_id": "MDQ6VXNlcjIwMTEzNDUz", "avatar_url": "https://avatars.githubusercontent.com/u/20113453?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewjasper", "html_url": "https://github.com/matthewjasper", "followers_url": "https://api.github.com/users/matthewjasper/followers", "following_url": "https://api.github.com/users/matthewjasper/following{/other_user}", "gists_url": "https://api.github.com/users/matthewjasper/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewjasper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewjasper/subscriptions", "organizations_url": "https://api.github.com/users/matthewjasper/orgs", "repos_url": "https://api.github.com/users/matthewjasper/repos", "events_url": "https://api.github.com/users/matthewjasper/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewjasper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matthewjasper", "id": 20113453, "node_id": "MDQ6VXNlcjIwMTEzNDUz", "avatar_url": "https://avatars.githubusercontent.com/u/20113453?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewjasper", "html_url": "https://github.com/matthewjasper", "followers_url": "https://api.github.com/users/matthewjasper/followers", "following_url": "https://api.github.com/users/matthewjasper/following{/other_user}", "gists_url": "https://api.github.com/users/matthewjasper/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewjasper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewjasper/subscriptions", "organizations_url": "https://api.github.com/users/matthewjasper/orgs", "repos_url": "https://api.github.com/users/matthewjasper/repos", "events_url": "https://api.github.com/users/matthewjasper/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewjasper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c5840f9d252c2f5cc16698dbf385a29c5de3ca07", "url": "https://api.github.com/repos/rust-lang/rust/commits/c5840f9d252c2f5cc16698dbf385a29c5de3ca07", "html_url": "https://github.com/rust-lang/rust/commit/c5840f9d252c2f5cc16698dbf385a29c5de3ca07"}], "stats": {"total": 41, "additions": 40, "deletions": 1}, "files": [{"sha": "5ac31fafd9f34f77c9e7462de5511840c9382b13", "filename": "src/librustc/traits/project.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5e92625004546005c3bc59351dd6c5132312f0f7/src%2Flibrustc%2Ftraits%2Fproject.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e92625004546005c3bc59351dd6c5132312f0f7/src%2Flibrustc%2Ftraits%2Fproject.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fproject.rs?ref=5e92625004546005c3bc59351dd6c5132312f0f7", "patch": "@@ -1461,7 +1461,7 @@ fn assoc_ty_def(\n     // cycle error if the specialization graph is currently being built.\n     let impl_node = specialization_graph::Node::Impl(impl_def_id);\n     for item in impl_node.items(tcx) {\n-        if item.kind == ty::AssocKind::Type\n+        if matches!(item.kind, ty::AssocKind::Type | ty::AssocKind::OpaqueTy)\n             && tcx.hygienic_eq(item.ident, assoc_ty_name, trait_def_id)\n         {\n             return specialization_graph::NodeItem {"}, {"sha": "c46c4715924e59439ba11f562da9504b1d4e606f", "filename": "src/test/ui/type-alias-impl-trait/incoherent-assoc-imp-trait.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/5e92625004546005c3bc59351dd6c5132312f0f7/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fincoherent-assoc-imp-trait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e92625004546005c3bc59351dd6c5132312f0f7/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fincoherent-assoc-imp-trait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fincoherent-assoc-imp-trait.rs?ref=5e92625004546005c3bc59351dd6c5132312f0f7", "patch": "@@ -0,0 +1,16 @@\n+// Regression test for issue 67856\n+\n+#![feature(unboxed_closures)]\n+#![feature(type_alias_impl_trait)]\n+#![feature(fn_traits)]\n+\n+trait MyTrait {}\n+impl MyTrait for () {}\n+\n+impl<F> FnOnce<()> for &F {\n+    //~^ ERROR conflicting implementations\n+    //~| ERROR type parameter `F` must be used\n+    type Output = impl MyTrait;\n+    extern \"rust-call\" fn call_once(self, _: ()) -> Self::Output {}\n+}\n+fn main() {}"}, {"sha": "f8e1e55f23f9a38cb99f3b4e0ea55f7f67936d9d", "filename": "src/test/ui/type-alias-impl-trait/incoherent-assoc-imp-trait.stderr", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/5e92625004546005c3bc59351dd6c5132312f0f7/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fincoherent-assoc-imp-trait.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5e92625004546005c3bc59351dd6c5132312f0f7/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fincoherent-assoc-imp-trait.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fincoherent-assoc-imp-trait.stderr?ref=5e92625004546005c3bc59351dd6c5132312f0f7", "patch": "@@ -0,0 +1,23 @@\n+error[E0119]: conflicting implementations of trait `std::ops::FnOnce<()>` for type `&_`:\n+  --> $DIR/incoherent-assoc-imp-trait.rs:10:1\n+   |\n+LL | impl<F> FnOnce<()> for &F {\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: conflicting implementation in crate `core`:\n+           - impl<A, F> std::ops::FnOnce<A> for &F\n+             where F: std::ops::Fn<A>, F: ?Sized;\n+\n+error[E0210]: type parameter `F` must be used as the type parameter for some local type (e.g., `MyStruct<F>`)\n+  --> $DIR/incoherent-assoc-imp-trait.rs:10:6\n+   |\n+LL | impl<F> FnOnce<()> for &F {\n+   |      ^ type parameter `F` must be used as the type parameter for some local type\n+   |\n+   = note: implementing a foreign trait is only possible if at least one of the types for which is it implemented is local\n+   = note: only traits defined in the current crate can be implemented for a type parameter\n+\n+error: aborting due to 2 previous errors\n+\n+Some errors have detailed explanations: E0119, E0210.\n+For more information about an error, try `rustc --explain E0119`."}]}