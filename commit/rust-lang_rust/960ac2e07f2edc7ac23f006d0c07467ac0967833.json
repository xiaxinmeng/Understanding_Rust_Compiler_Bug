{"sha": "960ac2e07f2edc7ac23f006d0c07467ac0967833", "node_id": "C_kwDOAAsO6NoAKDk2MGFjMmUwN2YyZWRjN2FjMjNmMDA2ZDBjMDc0NjdhYzA5Njc4MzM", "commit": {"author": {"name": "lionelllohcd", "email": "lionellloh@gmail.com", "date": "2023-02-19T07:34:06Z"}, "committer": {"name": "lionelllohcd", "email": "lionellloh@gmail.com", "date": "2023-02-19T07:36:51Z"}, "message": "[107049] Recognise top level keys in config.toml.example", "tree": {"sha": "e2b6eb1a28b63e82535d35874d226b730c4ff734", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e2b6eb1a28b63e82535d35874d226b730c4ff734"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/960ac2e07f2edc7ac23f006d0c07467ac0967833", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/960ac2e07f2edc7ac23f006d0c07467ac0967833", "html_url": "https://github.com/rust-lang/rust/commit/960ac2e07f2edc7ac23f006d0c07467ac0967833", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/960ac2e07f2edc7ac23f006d0c07467ac0967833/comments", "author": {"login": "lionellloh", "id": 29104062, "node_id": "MDQ6VXNlcjI5MTA0MDYy", "avatar_url": "https://avatars.githubusercontent.com/u/29104062?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lionellloh", "html_url": "https://github.com/lionellloh", "followers_url": "https://api.github.com/users/lionellloh/followers", "following_url": "https://api.github.com/users/lionellloh/following{/other_user}", "gists_url": "https://api.github.com/users/lionellloh/gists{/gist_id}", "starred_url": "https://api.github.com/users/lionellloh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lionellloh/subscriptions", "organizations_url": "https://api.github.com/users/lionellloh/orgs", "repos_url": "https://api.github.com/users/lionellloh/repos", "events_url": "https://api.github.com/users/lionellloh/events{/privacy}", "received_events_url": "https://api.github.com/users/lionellloh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lionellloh", "id": 29104062, "node_id": "MDQ6VXNlcjI5MTA0MDYy", "avatar_url": "https://avatars.githubusercontent.com/u/29104062?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lionellloh", "html_url": "https://github.com/lionellloh", "followers_url": "https://api.github.com/users/lionellloh/followers", "following_url": "https://api.github.com/users/lionellloh/following{/other_user}", "gists_url": "https://api.github.com/users/lionellloh/gists{/gist_id}", "starred_url": "https://api.github.com/users/lionellloh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lionellloh/subscriptions", "organizations_url": "https://api.github.com/users/lionellloh/orgs", "repos_url": "https://api.github.com/users/lionellloh/repos", "events_url": "https://api.github.com/users/lionellloh/events{/privacy}", "received_events_url": "https://api.github.com/users/lionellloh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3eb5c4581a386b13c414e8c8bd73846ef37236d1", "url": "https://api.github.com/repos/rust-lang/rust/commits/3eb5c4581a386b13c414e8c8bd73846ef37236d1", "html_url": "https://github.com/rust-lang/rust/commit/3eb5c4581a386b13c414e8c8bd73846ef37236d1"}], "stats": {"total": 27, "additions": 22, "deletions": 5}, "files": [{"sha": "91af36d9070ff292bbee662322345402db3f6a1c", "filename": "src/bootstrap/configure.py", "status": "modified", "additions": 22, "deletions": 5, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/960ac2e07f2edc7ac23f006d0c07467ac0967833/src%2Fbootstrap%2Fconfigure.py", "raw_url": "https://github.com/rust-lang/rust/raw/960ac2e07f2edc7ac23f006d0c07467ac0967833/src%2Fbootstrap%2Fconfigure.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfigure.py?ref=960ac2e07f2edc7ac23f006d0c07467ac0967833", "patch": "@@ -379,8 +379,14 @@ def set(key, value):\n sections[None] = []\n section_order = [None]\n targets = {}\n+top_level_keys = []\n \n for line in open(rust_dir + '/config.toml.example').read().split(\"\\n\"):\n+    if cur_section == None: \n+        if line.count('=') == 1: \n+            top_level_key = line.split('=')[0]\n+            top_level_key = top_level_key.strip(' #')\n+            top_level_keys.append(top_level_key)\n     if line.startswith('['):\n         cur_section = line[1:-1]\n         if cur_section.startswith('target'):\n@@ -459,12 +465,23 @@ def configure_section(lines, config):\n                 raise RuntimeError(\"failed to find config line for {}\".format(key))\n \n \n-for section_key in config:\n-    section_config = config[section_key]\n-    if section_key not in sections:\n-        raise RuntimeError(\"config key {} not in sections\".format(section_key))\n+def configure_top_level_key(lines, top_level_key, value): \n+    for i, line in enumerate(lines): \n+        if line.startswith('#' + top_level_key + ' = ') or line.startswith(top_level_key + ' = '): \n+            lines[i] = \"{} = {}\".format(top_level_key, value)\n+            return \n+        \n+    raise RuntimeError(\"failed to find config line for {}\".format(top_level_key))\n \n-    if section_key == 'target':\n+      \n+for section_key, section_config in config.items():\n+    if section_key not in sections and section_key not in top_level_keys: \n+        raise RuntimeError(\"config key {} not in sections or top_level_keys\".format(section_key))\n+    \n+    if section_key in top_level_keys: \n+        configure_top_level_key(sections[None], section_key, section_config)\n+\n+    elif  section_key == 'target':\n         for target in section_config:\n             configure_section(targets[target], section_config[target])\n     else:"}]}