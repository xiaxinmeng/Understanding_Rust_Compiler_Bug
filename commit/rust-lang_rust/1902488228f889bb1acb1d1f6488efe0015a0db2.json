{"sha": "1902488228f889bb1acb1d1f6488efe0015a0db2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE5MDI0ODgyMjhmODg5YmIxYWNiMWQxZjY0ODhlZmUwMDE1YTBkYjI=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-02-14T17:54:58Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-02-16T02:07:16Z"}, "message": "travis: Disable source tarballs on most builders\n\nCurrently we create a source tarball on almost all of the `DEPLOY=1` builders\nbut this has the adverse side effect of all source tarballs overriding\nthemselves in the S3 bucket. Normally this is ok but unfortunately a source\ntarball created on Windows is not buildable on Unix.\n\nOn Windows the vendored sources contain paths with `\\` characters in them which\nwhen interpreted on Unix end up in \"file not found\" errors.\n\nInstead of this overwriting behavior, whitelist just one linux builder for\nproducing tarballs and avoid producing tarballs on all other hosts.", "tree": {"sha": "e221c04a160e7d2292c4c751f7421d5f121d83cc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e221c04a160e7d2292c4c751f7421d5f121d83cc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1902488228f889bb1acb1d1f6488efe0015a0db2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1902488228f889bb1acb1d1f6488efe0015a0db2", "html_url": "https://github.com/rust-lang/rust/commit/1902488228f889bb1acb1d1f6488efe0015a0db2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1902488228f889bb1acb1d1f6488efe0015a0db2/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "48bc08247a7b4a5579437df54ca3f4a3fb25ce8d", "url": "https://api.github.com/repos/rust-lang/rust/commits/48bc08247a7b4a5579437df54ca3f4a3fb25ce8d", "html_url": "https://github.com/rust-lang/rust/commit/48bc08247a7b4a5579437df54ca3f4a3fb25ce8d"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "70952438a35598c8fa897d25caf9185de94919da", "filename": "configure", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1902488228f889bb1acb1d1f6488efe0015a0db2/configure", "raw_url": "https://github.com/rust-lang/rust/raw/1902488228f889bb1acb1d1f6488efe0015a0db2/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=1902488228f889bb1acb1d1f6488efe0015a0db2", "patch": "@@ -650,6 +650,7 @@ opt ninja 0 \"build LLVM using the Ninja generator (for MSVC, requires building i\n opt locked-deps 0 \"force Cargo.lock to be up to date\"\n opt vendor 0 \"enable usage of vendored Rust crates\"\n opt sanitizers 0 \"build the sanitizer runtimes (asan, lsan, msan, tsan)\"\n+opt dist-src 1 \"when building tarballs enables building a source tarball\"\n \n # Optimization and debugging options. These may be overridden by the release channel, etc.\n opt_nosave optimize 1 \"build optimized rust code\""}, {"sha": "8308dc3202fff505f70796eafa844f5695446aa9", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/1902488228f889bb1acb1d1f6488efe0015a0db2/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1902488228f889bb1acb1d1f6488efe0015a0db2/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=1902488228f889bb1acb1d1f6488efe0015a0db2", "patch": "@@ -72,6 +72,7 @@ pub struct Config {\n     pub rustc_default_ar: Option<String>,\n     pub rust_optimize_tests: bool,\n     pub rust_debuginfo_tests: bool,\n+    pub rust_dist_src: bool,\n \n     pub build: String,\n     pub host: Vec<String>,\n@@ -183,6 +184,7 @@ struct Dist {\n     sign_folder: Option<String>,\n     gpg_password_file: Option<String>,\n     upload_addr: Option<String>,\n+    src_tarball: Option<bool>,\n }\n \n #[derive(RustcDecodable)]\n@@ -246,6 +248,7 @@ impl Config {\n         config.build = build.to_string();\n         config.channel = \"dev\".to_string();\n         config.codegen_tests = true;\n+        config.rust_dist_src = true;\n \n         let toml = file.map(|file| {\n             let mut f = t!(File::open(&file));\n@@ -380,6 +383,7 @@ impl Config {\n             config.dist_sign_folder = t.sign_folder.clone().map(PathBuf::from);\n             config.dist_gpg_password_file = t.gpg_password_file.clone().map(PathBuf::from);\n             config.dist_upload_addr = t.upload_addr.clone();\n+            set(&mut config.rust_dist_src, t.src_tarball);\n         }\n \n         return config\n@@ -448,6 +452,7 @@ impl Config {\n                 (\"FULL_BOOTSTRAP\", self.full_bootstrap),\n                 (\"EXTENDED\", self.extended),\n                 (\"SANITIZERS\", self.sanitizers),\n+                (\"DIST_SRC\", self.rust_dist_src),\n             }\n \n             match key {"}, {"sha": "8463a175bcb3e7b013afe05f2de89c083aba2d63", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1902488228f889bb1acb1d1f6488efe0015a0db2/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1902488228f889bb1acb1d1f6488efe0015a0db2/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=1902488228f889bb1acb1d1f6488efe0015a0db2", "patch": "@@ -364,6 +364,10 @@ const CARGO_VENDOR_VERSION: &'static str = \"0.1.4\";\n \n /// Creates the `rust-src` installer component and the plain source tarball\n pub fn rust_src(build: &Build) {\n+    if !build.config.rust_dist_src {\n+        return\n+    }\n+\n     println!(\"Dist src\");\n \n     let name = pkgname(build, \"rust-src\");"}, {"sha": "f9324991aa06d12abb0db31603c218c1e8b49d28", "filename": "src/ci/docker/dist-x86-linux/Dockerfile", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/1902488228f889bb1acb1d1f6488efe0015a0db2/src%2Fci%2Fdocker%2Fdist-x86-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1902488228f889bb1acb1d1f6488efe0015a0db2/src%2Fci%2Fdocker%2Fdist-x86-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-x86-linux%2FDockerfile?ref=1902488228f889bb1acb1d1f6488efe0015a0db2", "patch": "@@ -82,5 +82,9 @@ RUN curl -L https://api.pub.build.mozilla.org/tooltool/sha512/$SCCACHE_DIGEST |\n ENV HOSTS=i686-unknown-linux-gnu\n ENV HOSTS=$HOSTS,x86_64-unknown-linux-gnu\n \n-ENV RUST_CONFIGURE_ARGS --host=$HOSTS --enable-extended --enable-sanitizers\n+ENV RUST_CONFIGURE_ARGS \\\n+      --host=$HOSTS \\\n+      --enable-extended \\\n+      --enable-sanitizers\n ENV SCRIPT python2.7 ../x.py dist --host $HOSTS --target $HOSTS\n+ENV DIST_SRC 1"}, {"sha": "afa99ca2b8640e438bc4179b6a03e852930afc97", "filename": "src/ci/docker/x86_64-gnu-distcheck/Dockerfile", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/1902488228f889bb1acb1d1f6488efe0015a0db2/src%2Fci%2Fdocker%2Fx86_64-gnu-distcheck%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/1902488228f889bb1acb1d1f6488efe0015a0db2/src%2Fci%2Fdocker%2Fx86_64-gnu-distcheck%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-distcheck%2FDockerfile?ref=1902488228f889bb1acb1d1f6488efe0015a0db2", "patch": "@@ -26,3 +26,4 @@ ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu\n ENV SCRIPT python2.7 ../x.py test distcheck\n+ENV DIST_SRC 1"}, {"sha": "04db99ef2780eaa7947c706fe30f8eb002509478", "filename": "src/ci/run.sh", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1902488228f889bb1acb1d1f6488efe0015a0db2/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/1902488228f889bb1acb1d1f6488efe0015a0db2/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=1902488228f889bb1acb1d1f6488efe0015a0db2", "patch": "@@ -25,6 +25,10 @@ RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --enable-quiet-tests\"\n RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --disable-manage-submodules\"\n RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --enable-locked-deps\"\n \n+if [ \"$DIST_SRC\" = \"\" ]; then\n+  RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --disable-dist-src\"\n+fi\n+\n # If we're deploying artifacts then we set the release channel, otherwise if\n # we're not deploying then we want to be sure to enable all assertions becauase\n # we'll be running tests"}]}