{"sha": "b71f6364d22e1e9cea597003e4c563c32e5f651c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI3MWY2MzY0ZDIyZTFlOWNlYTU5NzAwM2U0YzU2M2MzMmU1ZjY1MWM=", "commit": {"author": {"name": "Harm Berntsen", "email": "harm.berntsen@nedap.com", "date": "2018-05-03T12:35:59Z"}, "committer": {"name": "Harm Berntsen", "email": "harm.berntsen@nedap.com", "date": "2018-05-03T14:53:04Z"}, "message": "Add armv5te-unknown-linux-musl target", "tree": {"sha": "356942f68fc4810f198363faa4a0b44d74f65ba0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/356942f68fc4810f198363faa4a0b44d74f65ba0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b71f6364d22e1e9cea597003e4c563c32e5f651c", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJMBAABCAA2FiEEiF+uLp/Dqc3l0uG3fSuP11GmHNcFAlrrIlUYHGhhcm0uYmVy\nbnRzZW5AbmVkYXAuY29tAAoJEH0rj9dRphzXE78P/jpBalH80tqDUIXbFMOl8SsY\nzlDfE7jgX23YvWNSkzqxlUDRVHhT/Bt5mMPsJxQj3iFN/UeLOluCZeoqnLoEaWif\naJPpkowjs7LOMqgx8C6yMf/t0Vv7+eAaIrG2LQuh3S8YuM3y0hTpx4RgmF7fM6e4\nm2+Ed3RTHMaQDiUuLM3BtR3BMsfWS4QkgSsnA02gieIRqjO24rHJwnv4yF2zQGf0\nE6Sms2HvRoBLIqpDZa747wKTZeCsWa2/qkpK1+3A2VZhT5IcmUtNlGo3XkkGnPUu\nAfxiTuQVsQHcPMwLRNO9c55U3M6MVbhRht/QSzCLiwwBuhecE+KboV2jgJygiFMk\n+c8RUNlElKFLceLmdC/XNOqF+Vw4k+Exunc0V8ORRt6VF1B/vCp+lqy1/rdX6fTg\nXE2TncKNqsFOL1rWNVw+AncRp+TE3qnua1baur00YBKTvl1VCdZ4Y6xjfl9ZLueS\nMVz+ZB2Y4pB2qZX94sxgANqMYQS3ek+l/zUAZCtr7rOojlHhCpITYb4Rwe6qNn+P\n/ijY6QTZADG7hIPFr+E6iyemD/4SWBvLnEc4m3a3byvcMUXglMPjuempl3fMgu8h\n5RDOBw82B9dt1O/7TlUZH1k9WpnbGfrWRBUmFG8SQjcbUfdOKQ1h7qpUJms5pdnY\nzAyFCkAGrT9DNeqhnLJz\n=upXx\n-----END PGP SIGNATURE-----", "payload": "tree 356942f68fc4810f198363faa4a0b44d74f65ba0\nparent 698b956a9fca9688632d617dd6d73cae834237a3\nauthor Harm Berntsen <harm.berntsen@nedap.com> 1525350959 +0200\ncommitter Harm Berntsen <harm.berntsen@nedap.com> 1525359184 +0200\n\nAdd armv5te-unknown-linux-musl target\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b71f6364d22e1e9cea597003e4c563c32e5f651c", "html_url": "https://github.com/rust-lang/rust/commit/b71f6364d22e1e9cea597003e4c563c32e5f651c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b71f6364d22e1e9cea597003e4c563c32e5f651c/comments", "author": {"login": "harm-nedap", "id": 36404260, "node_id": "MDQ6VXNlcjM2NDA0MjYw", "avatar_url": "https://avatars.githubusercontent.com/u/36404260?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harm-nedap", "html_url": "https://github.com/harm-nedap", "followers_url": "https://api.github.com/users/harm-nedap/followers", "following_url": "https://api.github.com/users/harm-nedap/following{/other_user}", "gists_url": "https://api.github.com/users/harm-nedap/gists{/gist_id}", "starred_url": "https://api.github.com/users/harm-nedap/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harm-nedap/subscriptions", "organizations_url": "https://api.github.com/users/harm-nedap/orgs", "repos_url": "https://api.github.com/users/harm-nedap/repos", "events_url": "https://api.github.com/users/harm-nedap/events{/privacy}", "received_events_url": "https://api.github.com/users/harm-nedap/received_events", "type": "User", "site_admin": false}, "committer": {"login": "harm-nedap", "id": 36404260, "node_id": "MDQ6VXNlcjM2NDA0MjYw", "avatar_url": "https://avatars.githubusercontent.com/u/36404260?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harm-nedap", "html_url": "https://github.com/harm-nedap", "followers_url": "https://api.github.com/users/harm-nedap/followers", "following_url": "https://api.github.com/users/harm-nedap/following{/other_user}", "gists_url": "https://api.github.com/users/harm-nedap/gists{/gist_id}", "starred_url": "https://api.github.com/users/harm-nedap/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harm-nedap/subscriptions", "organizations_url": "https://api.github.com/users/harm-nedap/orgs", "repos_url": "https://api.github.com/users/harm-nedap/repos", "events_url": "https://api.github.com/users/harm-nedap/events{/privacy}", "received_events_url": "https://api.github.com/users/harm-nedap/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "698b956a9fca9688632d617dd6d73cae834237a3", "url": "https://api.github.com/repos/rust-lang/rust/commits/698b956a9fca9688632d617dd6d73cae834237a3", "html_url": "https://github.com/rust-lang/rust/commit/698b956a9fca9688632d617dd6d73cae834237a3"}], "stats": {"total": 89, "additions": 89, "deletions": 0}, "files": [{"sha": "54b6526c5c81f6459f95d4cce2b4345813d16a9a", "filename": "src/bootstrap/configure.py", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b71f6364d22e1e9cea597003e4c563c32e5f651c/src%2Fbootstrap%2Fconfigure.py", "raw_url": "https://github.com/rust-lang/rust/raw/b71f6364d22e1e9cea597003e4c563c32e5f651c/src%2Fbootstrap%2Fconfigure.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfigure.py?ref=b71f6364d22e1e9cea597003e4c563c32e5f651c", "patch": "@@ -120,6 +120,8 @@ def v(*args):\n   \"arm-unknown-linux-musleabi install directory\")\n v(\"musl-root-armhf\", \"target.arm-unknown-linux-musleabihf.musl-root\",\n   \"arm-unknown-linux-musleabihf install directory\")\n+v(\"musl-root-armv5te\", \"target.armv5te-unknown-linux-musl.musl-root\",\n+  \"armv5te-unknown-linux-musleabi install directory\")\n v(\"musl-root-armv7\", \"target.armv7-unknown-linux-musleabihf.musl-root\",\n   \"armv7-unknown-linux-musleabihf install directory\")\n v(\"musl-root-aarch64\", \"target.aarch64-unknown-linux-musl.musl-root\","}, {"sha": "42eaebcc3dbbde8f7a42e79c54a72613010bd120", "filename": "src/ci/docker/dist-armv5te-linux-musl/Dockerfile", "status": "added", "additions": 47, "deletions": 0, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/b71f6364d22e1e9cea597003e4c563c32e5f651c/src%2Fci%2Fdocker%2Fdist-armv5te-linux-musl%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/b71f6364d22e1e9cea597003e4c563c32e5f651c/src%2Fci%2Fdocker%2Fdist-armv5te-linux-musl%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-armv5te-linux-musl%2FDockerfile?ref=b71f6364d22e1e9cea597003e4c563c32e5f651c", "patch": "@@ -0,0 +1,47 @@\n+FROM ubuntu:16.04\n+\n+RUN apt-get update && apt-get install -y --no-install-recommends \\\n+  g++ \\\n+  make \\\n+  file \\\n+  curl \\\n+  ca-certificates \\\n+  python2.7 \\\n+  git \\\n+  cmake \\\n+  sudo \\\n+  xz-utils \\\n+  zlib1g-dev \\\n+  g++-arm-linux-gnueabi \\\n+  bzip2 \\\n+  patch \\\n+  pkg-config\n+\n+WORKDIR /build\n+\n+# Suppress some warnings in the openwrt toolchains we downloaded\n+ENV STAGING_DIR=/tmp\n+\n+COPY scripts/musl.sh /build\n+RUN env \\\n+    CC=arm-linux-gnueabi-gcc CFLAGS=\"-march=armv5te -marm -mfloat-abi=soft\" \\\n+    CXX=arm-linux-gnueabi-g++ CXXFLAGS=\"-march=armv5te -marm -mfloat-abi=soft\" \\\n+    bash musl.sh armv5te && \\\n+    rm -rf /build/*\n+\n+ENV TARGETS=armv5te-unknown-linux-musl\n+\n+# FIXME: remove armv5te vars after https://github.com/alexcrichton/cc-rs/issues/271\n+#        get fixed and cc update\n+ENV CC_armv5te_unknown_linux_musl=arm-linux-gnueabi-gcc \\\n+    CFLAGS_armv5te_unknown_linux_musl=\"-march=armv5te -marm -mfloat-abi=soft\"\n+\n+ENV RUST_CONFIGURE_ARGS \\\n+      --musl-root-armv5te=/musl-armv5te \\\n+      --disable-docs\n+\n+ENV SCRIPT python2.7 ../x.py dist --target $TARGETS\n+\n+# sccache\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh"}, {"sha": "2d4e95ab01d6f58bff6db92fb0b641af53340412", "filename": "src/librustc_target/spec/armv5te_unknown_linux_musl.rs", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/b71f6364d22e1e9cea597003e4c563c32e5f651c/src%2Flibrustc_target%2Fspec%2Farmv5te_unknown_linux_musl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b71f6364d22e1e9cea597003e4c563c32e5f651c/src%2Flibrustc_target%2Fspec%2Farmv5te_unknown_linux_musl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fspec%2Farmv5te_unknown_linux_musl.rs?ref=b71f6364d22e1e9cea597003e4c563c32e5f651c", "patch": "@@ -0,0 +1,38 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+use spec::{LinkerFlavor, Target, TargetOptions, TargetResult};\n+\n+pub fn target() -> TargetResult {\n+    let base = super::linux_musl_base::opts();\n+    Ok(Target {\n+        // It's important we use \"gnueabihf\" and not \"musleabihf\" here. LLVM\n+        // uses it to determine the calling convention and float ABI, and LLVM\n+        // doesn't support the \"musleabihf\" value.\n+        llvm_target: \"armv5te-unknown-linux-gnueabi\".to_string(),\n+        target_endian: \"little\".to_string(),\n+        target_pointer_width: \"32\".to_string(),\n+        target_c_int_width: \"32\".to_string(),\n+        data_layout: \"e-m:e-p:32:32-i64:64-v128:64:128-a:0:32-n32-S64\".to_string(),\n+        arch: \"arm\".to_string(),\n+        target_os: \"linux\".to_string(),\n+        target_env: \"musl\".to_string(),\n+        target_vendor: \"unknown\".to_string(),\n+        linker_flavor: LinkerFlavor::Gcc,\n+\n+        options: TargetOptions {\n+            features: \"+soft-float,+strict-align\".to_string(),\n+            // Atomic operations provided by compiler-builtins\n+            max_atomic_width: Some(32),\n+            abi_blacklist: super::arm_base::abi_blacklist(),\n+            .. base\n+        }\n+    })\n+}"}, {"sha": "e4071b316c1204256206b219234c20afc3d7239c", "filename": "src/librustc_target/spec/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b71f6364d22e1e9cea597003e4c563c32e5f651c/src%2Flibrustc_target%2Fspec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b71f6364d22e1e9cea597003e4c563c32e5f651c/src%2Flibrustc_target%2Fspec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_target%2Fspec%2Fmod.rs?ref=b71f6364d22e1e9cea597003e4c563c32e5f651c", "patch": "@@ -283,6 +283,7 @@ supported_targets! {\n     (\"arm-unknown-linux-musleabihf\", arm_unknown_linux_musleabihf),\n     (\"armv4t-unknown-linux-gnueabi\", armv4t_unknown_linux_gnueabi),\n     (\"armv5te-unknown-linux-gnueabi\", armv5te_unknown_linux_gnueabi),\n+    (\"armv5te-unknown-linux-musl\", armv5te_unknown_linux_musl),\n     (\"armv7-unknown-linux-gnueabihf\", armv7_unknown_linux_gnueabihf),\n     (\"armv7-unknown-linux-musleabihf\", armv7_unknown_linux_musleabihf),\n     (\"aarch64-unknown-linux-gnu\", aarch64_unknown_linux_gnu),"}, {"sha": "ba5bb45d7679849c097d56330ce9a31a484c4266", "filename": "src/tools/build-manifest/src/main.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b71f6364d22e1e9cea597003e4c563c32e5f651c/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b71f6364d22e1e9cea597003e4c563c32e5f651c/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs?ref=b71f6364d22e1e9cea597003e4c563c32e5f651c", "patch": "@@ -57,6 +57,7 @@ static TARGETS: &'static [&'static str] = &[\n     \"arm-unknown-linux-musleabi\",\n     \"arm-unknown-linux-musleabihf\",\n     \"armv5te-unknown-linux-gnueabi\",\n+    \"armv5te-unknown-linux-musl\",\n     \"armv7-apple-ios\",\n     \"armv7-linux-androideabi\",\n     \"armv7-unknown-cloudabi-eabihf\","}]}