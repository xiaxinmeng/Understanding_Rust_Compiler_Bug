{"sha": "1a1afd74a643cead4794094e286adc9cf5ae2009", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFhMWFmZDc0YTY0M2NlYWQ0Nzk0MDk0ZTI4NmFkYzljZjVhZTIwMDk=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-01-04T17:55:15Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-01-15T15:04:39Z"}, "message": "Handle case of moving into vec with uninferred lifetime", "tree": {"sha": "ce32ae9bffeea3942ba529c8784ccb3f3e33819c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ce32ae9bffeea3942ba529c8784ccb3f3e33819c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1a1afd74a643cead4794094e286adc9cf5ae2009", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1a1afd74a643cead4794094e286adc9cf5ae2009", "html_url": "https://github.com/rust-lang/rust/commit/1a1afd74a643cead4794094e286adc9cf5ae2009", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1a1afd74a643cead4794094e286adc9cf5ae2009/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2c5f2df201c65bbea0c0d3abe1190049093eb7b6", "url": "https://api.github.com/repos/rust-lang/rust/commits/2c5f2df201c65bbea0c0d3abe1190049093eb7b6", "html_url": "https://github.com/rust-lang/rust/commit/2c5f2df201c65bbea0c0d3abe1190049093eb7b6"}], "stats": {"total": 27, "additions": 19, "deletions": 8}, "files": [{"sha": "630a2d857a014de54b0fd84e0d22a4461d362259", "filename": "src/librustc/infer/error_reporting/mod.rs", "status": "modified", "additions": 15, "deletions": 7, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/1a1afd74a643cead4794094e286adc9cf5ae2009/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a1afd74a643cead4794094e286adc9cf5ae2009/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fmod.rs?ref=1a1afd74a643cead4794094e286adc9cf5ae2009", "patch": "@@ -1079,15 +1079,23 @@ impl<'a, 'gcx, 'tcx> InferCtxt<'a, 'gcx, 'tcx> {\n                         node: hir::ExprClosure(_, _, _, closure_span, false),\n                         ..\n                     }) => {\n-                        let sp = var_origin.span();\n+                        let sup_sp = sup_origin.span();\n+                        let origin_sp = var_origin.span();\n                         let mut err = self.tcx.sess.struct_span_err(\n-                            sp,\n+                            sup_sp,\n                             \"borrowed data cannot be moved outside of its closure\");\n-                        err.span_label(sp, \"cannot be moved outside of its closure\");\n-                        err.span_label(*external_span,\n-                                       \"borrowed data cannot be moved into here...\");\n-                        err.span_label(*closure_span,\n-                                       \"...because it cannot outlive this closure\");\n+                        err.span_label(sup_sp, \"cannot be moved outside of its closure\");\n+                        if sup_sp == origin_sp {\n+                            err.span_label(*external_span,\n+                                           \"borrowed data cannot be moved into here...\");\n+                            err.span_label(*closure_span,\n+                                           \"...because it cannot outlive this closure\");\n+                        } else {\n+                            err.span_label(*closure_span,\n+                                           \"borrowed data cannot outlive this closure\");\n+                            err.span_label(origin_sp,\n+                                           \"cannot infer an appropriate lifetime\");\n+                        }\n                         err.emit();\n                         return;\n                     }"}, {"sha": "e41d25c17ead25b8b2e0ac68f724b421eda959db", "filename": "src/test/compile-fail/issue-7573.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/1a1afd74a643cead4794094e286adc9cf5ae2009/src%2Ftest%2Fcompile-fail%2Fissue-7573.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a1afd74a643cead4794094e286adc9cf5ae2009/src%2Ftest%2Fcompile-fail%2Fissue-7573.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-7573.rs?ref=1a1afd74a643cead4794094e286adc9cf5ae2009", "patch": "@@ -25,9 +25,12 @@ impl CrateId {\n \n pub fn remove_package_from_database() {\n     let mut lines_to_use: Vec<&CrateId> = Vec::new();\n-    //~^ ERROR borrowed data cannot be moved outside of its closure\n+        //~^ NOTE cannot infer an appropriate lifetime\n     let push_id = |installed_id: &CrateId| {\n+        //~^ NOTE borrowed data cannot outlive this closure\n         lines_to_use.push(installed_id);\n+        //~^ ERROR borrowed data cannot be moved outside of its closure\n+        //~| NOTE cannot be moved outside of its closure\n     };\n     list_database(push_id);\n "}]}