{"sha": "8b24644c42c0b6a0a3a3e561af2049001e82c9a4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhiMjQ2NDRjNDJjMGI2YTBhM2EzZTU2MWFmMjA0OTAwMWU4MmM5YTQ=", "commit": {"author": {"name": "Keith Yeung", "email": "kungfukeith11@gmail.com", "date": "2018-05-12T21:32:11Z"}, "committer": {"name": "Keith Yeung", "email": "kungfukeith11@gmail.com", "date": "2018-05-17T19:09:29Z"}, "message": "Use EverInit instead of MaybeInit to determine initialization", "tree": {"sha": "66a45bafefcf206a095a5c8f499043d22f322c92", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/66a45bafefcf206a095a5c8f499043d22f322c92"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8b24644c42c0b6a0a3a3e561af2049001e82c9a4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8b24644c42c0b6a0a3a3e561af2049001e82c9a4", "html_url": "https://github.com/rust-lang/rust/commit/8b24644c42c0b6a0a3a3e561af2049001e82c9a4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8b24644c42c0b6a0a3a3e561af2049001e82c9a4/comments", "author": {"login": "KiChjang", "id": 3248587, "node_id": "MDQ6VXNlcjMyNDg1ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/3248587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KiChjang", "html_url": "https://github.com/KiChjang", "followers_url": "https://api.github.com/users/KiChjang/followers", "following_url": "https://api.github.com/users/KiChjang/following{/other_user}", "gists_url": "https://api.github.com/users/KiChjang/gists{/gist_id}", "starred_url": "https://api.github.com/users/KiChjang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KiChjang/subscriptions", "organizations_url": "https://api.github.com/users/KiChjang/orgs", "repos_url": "https://api.github.com/users/KiChjang/repos", "events_url": "https://api.github.com/users/KiChjang/events{/privacy}", "received_events_url": "https://api.github.com/users/KiChjang/received_events", "type": "User", "site_admin": false}, "committer": {"login": "KiChjang", "id": 3248587, "node_id": "MDQ6VXNlcjMyNDg1ODc=", "avatar_url": "https://avatars.githubusercontent.com/u/3248587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KiChjang", "html_url": "https://github.com/KiChjang", "followers_url": "https://api.github.com/users/KiChjang/followers", "following_url": "https://api.github.com/users/KiChjang/following{/other_user}", "gists_url": "https://api.github.com/users/KiChjang/gists{/gist_id}", "starred_url": "https://api.github.com/users/KiChjang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KiChjang/subscriptions", "organizations_url": "https://api.github.com/users/KiChjang/orgs", "repos_url": "https://api.github.com/users/KiChjang/repos", "events_url": "https://api.github.com/users/KiChjang/events{/privacy}", "received_events_url": "https://api.github.com/users/KiChjang/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dbd10f81758381339f98994b8d31814cf5e98707", "url": "https://api.github.com/repos/rust-lang/rust/commits/dbd10f81758381339f98994b8d31814cf5e98707", "html_url": "https://github.com/rust-lang/rust/commit/dbd10f81758381339f98994b8d31814cf5e98707"}], "stats": {"total": 34, "additions": 31, "deletions": 3}, "files": [{"sha": "f797bf1c3f6f92dd0e524b31759c05e775d1c3fd", "filename": "src/librustc_mir/borrow_check/mod.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/8b24644c42c0b6a0a3a3e561af2049001e82c9a4/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8b24644c42c0b6a0a3a3e561af2049001e82c9a4/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs?ref=8b24644c42c0b6a0a3a3e561af2049001e82c9a4", "patch": "@@ -1810,9 +1810,9 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n                 }\n             }\n             Reservation(WriteKind::Move)\n+            | Write(WriteKind::Move)\n             | Reservation(WriteKind::StorageDeadOrDrop)\n             | Reservation(WriteKind::MutableBorrow(BorrowKind::Shared))\n-            | Write(WriteKind::Move)\n             | Write(WriteKind::StorageDeadOrDrop)\n             | Write(WriteKind::MutableBorrow(BorrowKind::Shared)) => {\n                 if let Err(_place_err) = self.is_mutable(place, is_local_mutation_allowed) {\n@@ -1851,8 +1851,11 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n                     // mutated, then it is justified to be annotated with the `mut`\n                     // keyword, since the mutation may be a possible reassignment.\n                     let mpi = self.move_data.rev_lookup.find_local(*local);\n-                    if flow_state.inits.contains(&mpi) {\n-                        self.used_mut.insert(*local);\n+                    let ii = &self.move_data.init_path_map[mpi];\n+                    for index in ii {\n+                        if flow_state.ever_inits.contains(index) {\n+                            self.used_mut.insert(*local);\n+                        }\n                     }\n                 }\n             }"}, {"sha": "d5cf122bf3b336e4fdeb6a9ec3ebf61f221045ee", "filename": "src/test/run-pass/nll/issue-50461-used-mut-from-moves.rs", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/8b24644c42c0b6a0a3a3e561af2049001e82c9a4/src%2Ftest%2Frun-pass%2Fnll%2Fissue-50461-used-mut-from-moves.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8b24644c42c0b6a0a3a3e561af2049001e82c9a4/src%2Ftest%2Frun-pass%2Fnll%2Fissue-50461-used-mut-from-moves.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fnll%2Fissue-50461-used-mut-from-moves.rs?ref=8b24644c42c0b6a0a3a3e561af2049001e82c9a4", "patch": "@@ -0,0 +1,25 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![feature(nll)]\n+#![deny(unused_mut)]\n+\n+struct Foo {\n+    pub value: i32\n+}\n+\n+fn use_foo_mut(mut foo: Foo) {\n+    foo = foo;\n+    println!(\"{}\", foo.value);\n+}\n+\n+fn main() {\n+    use_foo_mut(Foo { value: 413 });\n+}"}]}