{"sha": "2c456b5123d3546732683c4fe6dce5be822e15d1", "node_id": "C_kwDOAAsO6NoAKDJjNDU2YjUxMjNkMzU0NjczMjY4M2M0ZmU2ZGNlNWJlODIyZTE1ZDE", "commit": {"author": {"name": "Nilstrieb", "email": "48135649+Nilstrieb@users.noreply.github.com", "date": "2022-11-24T20:22:12Z"}, "committer": {"name": "Nilstrieb", "email": "48135649+Nilstrieb@users.noreply.github.com", "date": "2022-11-25T17:28:35Z"}, "message": "Test a small cargo-miri smoke test even in `run_tests_minimal`\n\nThis makes sure that cargo-miri works on all targets.", "tree": {"sha": "034a9968aebfba070344fe99a249c45a2110541f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/034a9968aebfba070344fe99a249c45a2110541f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2c456b5123d3546732683c4fe6dce5be822e15d1", "comment_count": 0, "verification": {"verified": false, "reason": "invalid", "signature": "-----BEGIN SSH SIGNATURE-----\nU1NIU0lHAAAAAQAAADMAAAALc3NoLWVkMjU1MTkAAAAgbSfWKRQb2tiqhuHtakDJeupmrF\nChDbM0msU+PXaBOk8AAAADZ2l0AAAAAAAAAAZzaGE1MTIAAABTAAAAC3NzaC1lZDI1NTE5\nAAAAQCjlRZ5WGhAerPxJHRcP+njpITHC9JaUYaRgW5APVUQcPH8RLOlPrnUP63EZYjxKhX\nx+a6jIU1b5iS2lQldCPQ8=\n-----END SSH SIGNATURE-----", "payload": "tree 034a9968aebfba070344fe99a249c45a2110541f\nparent 8b0b2d136eb2db9ab0248e791e2db0228189dde2\nauthor Nilstrieb <48135649+Nilstrieb@users.noreply.github.com> 1669321332 +0100\ncommitter Nilstrieb <48135649+Nilstrieb@users.noreply.github.com> 1669397315 +0100\n\nTest a small cargo-miri smoke test even in `run_tests_minimal`\n\nThis makes sure that cargo-miri works on all targets.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2c456b5123d3546732683c4fe6dce5be822e15d1", "html_url": "https://github.com/rust-lang/rust/commit/2c456b5123d3546732683c4fe6dce5be822e15d1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2c456b5123d3546732683c4fe6dce5be822e15d1/comments", "author": {"login": "Nilstrieb", "id": 48135649, "node_id": "MDQ6VXNlcjQ4MTM1NjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/48135649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nilstrieb", "html_url": "https://github.com/Nilstrieb", "followers_url": "https://api.github.com/users/Nilstrieb/followers", "following_url": "https://api.github.com/users/Nilstrieb/following{/other_user}", "gists_url": "https://api.github.com/users/Nilstrieb/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nilstrieb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nilstrieb/subscriptions", "organizations_url": "https://api.github.com/users/Nilstrieb/orgs", "repos_url": "https://api.github.com/users/Nilstrieb/repos", "events_url": "https://api.github.com/users/Nilstrieb/events{/privacy}", "received_events_url": "https://api.github.com/users/Nilstrieb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Nilstrieb", "id": 48135649, "node_id": "MDQ6VXNlcjQ4MTM1NjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/48135649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nilstrieb", "html_url": "https://github.com/Nilstrieb", "followers_url": "https://api.github.com/users/Nilstrieb/followers", "following_url": "https://api.github.com/users/Nilstrieb/following{/other_user}", "gists_url": "https://api.github.com/users/Nilstrieb/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nilstrieb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nilstrieb/subscriptions", "organizations_url": "https://api.github.com/users/Nilstrieb/orgs", "repos_url": "https://api.github.com/users/Nilstrieb/repos", "events_url": "https://api.github.com/users/Nilstrieb/events{/privacy}", "received_events_url": "https://api.github.com/users/Nilstrieb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8b0b2d136eb2db9ab0248e791e2db0228189dde2", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b0b2d136eb2db9ab0248e791e2db0228189dde2", "html_url": "https://github.com/rust-lang/rust/commit/8b0b2d136eb2db9ab0248e791e2db0228189dde2"}], "stats": {"total": 64, "additions": 64, "deletions": 0}, "files": [{"sha": "bf9e986bdc7918c3217d2224c8614ac255ee643b", "filename": "src/tools/miri/ci.sh", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2c456b5123d3546732683c4fe6dce5be822e15d1/src%2Ftools%2Fmiri%2Fci.sh", "raw_url": "https://github.com/rust-lang/rust/raw/2c456b5123d3546732683c4fe6dce5be822e15d1/src%2Ftools%2Fmiri%2Fci.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Fci.sh?ref=2c456b5123d3546732683c4fe6dce5be822e15d1", "patch": "@@ -73,6 +73,10 @@ function run_tests_minimal {\n   fi\n \n   ./miri test -- \"$@\"\n+\n+  # Ensure that a small smoke test of cargo-miri works.\n+  # Note: This doesn't work on windows because of TLS.\n+  cargo miri run --manifest-path test-cargo-miri/no-std-smoke/Cargo.toml\n }\n \n # host"}, {"sha": "d037a37e0f677f9cfea5c70de5580877f5d67e29", "filename": "src/tools/miri/test-cargo-miri/Cargo.lock", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2c456b5123d3546732683c4fe6dce5be822e15d1/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/2c456b5123d3546732683c4fe6dce5be822e15d1/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2FCargo.lock?ref=2c456b5123d3546732683c4fe6dce5be822e15d1", "patch": "@@ -81,6 +81,10 @@ version = \"0.1.0\"\n name = \"issue_rust_86261\"\n version = \"0.1.0\"\n \n+[[package]]\n+name = \"no-std-smoke\"\n+version = \"0.1.0\"\n+\n [[package]]\n name = \"proc-macro2\"\n version = \"1.0.44\""}, {"sha": "37c996de6623c7e24c4e80a848b050586d644635", "filename": "src/tools/miri/test-cargo-miri/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2c456b5123d3546732683c4fe6dce5be822e15d1/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/2c456b5123d3546732683c4fe6dce5be822e15d1/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2FCargo.toml?ref=2c456b5123d3546732683c4fe6dce5be822e15d1", "patch": "@@ -1,5 +1,6 @@\n [workspace]\n members = [\"subcrate\", \"issue-1567\", \"exported-symbol-dep\"]\n+exclude = [\"no-std-smoke\"] # it wants to be panic=\"abort\"\n \n [package]\n name = \"cargo-miri-test\""}, {"sha": "b92a05fccf80fe32fe04dbf169c617ef9373eaf9", "filename": "src/tools/miri/test-cargo-miri/no-std-smoke/Cargo.lock", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2c456b5123d3546732683c4fe6dce5be822e15d1/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2Fno-std-smoke%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/2c456b5123d3546732683c4fe6dce5be822e15d1/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2Fno-std-smoke%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2Fno-std-smoke%2FCargo.lock?ref=2c456b5123d3546732683c4fe6dce5be822e15d1", "patch": "@@ -0,0 +1,7 @@\n+# This file is automatically @generated by Cargo.\n+# It is not intended for manual editing.\n+version = 3\n+\n+[[package]]\n+name = \"no-std-smoke\"\n+version = \"0.1.0\""}, {"sha": "3a056bedaa0034d831e5e943a7aa8f7517083bb4", "filename": "src/tools/miri/test-cargo-miri/no-std-smoke/Cargo.toml", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/2c456b5123d3546732683c4fe6dce5be822e15d1/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2Fno-std-smoke%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/2c456b5123d3546732683c4fe6dce5be822e15d1/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2Fno-std-smoke%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2Fno-std-smoke%2FCargo.toml?ref=2c456b5123d3546732683c4fe6dce5be822e15d1", "patch": "@@ -0,0 +1,14 @@\n+[package]\n+name = \"no-std-smoke\"\n+version = \"0.1.0\"\n+edition = \"2021\"\n+\n+# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html\n+\n+[dependencies]\n+\n+[profile.dev]\n+panic = 'abort'\n+\n+[profile.release]\n+panic = 'abort'"}, {"sha": "3a207b7d50aa2294dcb23fdfcac53a8a15e675fb", "filename": "src/tools/miri/test-cargo-miri/no-std-smoke/src/main.rs", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/2c456b5123d3546732683c4fe6dce5be822e15d1/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2Fno-std-smoke%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2c456b5123d3546732683c4fe6dce5be822e15d1/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2Fno-std-smoke%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2Ftest-cargo-miri%2Fno-std-smoke%2Fsrc%2Fmain.rs?ref=2c456b5123d3546732683c4fe6dce5be822e15d1", "patch": "@@ -0,0 +1,34 @@\n+// Copied from tests/pass/no-std.rs\n+\n+#![feature(start)]\n+#![no_std]\n+\n+// Plumbing to let us use `writeln!` to host stdout:\n+\n+extern \"Rust\" {\n+    fn miri_write_to_stdout(bytes: &[u8]);\n+}\n+\n+struct Host;\n+\n+use core::fmt::Write;\n+\n+impl Write for Host {\n+    fn write_str(&mut self, s: &str) -> core::fmt::Result {\n+        unsafe {\n+            miri_write_to_stdout(s.as_bytes());\n+        }\n+        Ok(())\n+    }\n+}\n+\n+#[start]\n+fn start(_: isize, _: *const *const u8) -> isize {\n+    writeln!(Host, \"hello, world!\").unwrap();\n+    0\n+}\n+\n+#[panic_handler]\n+fn panic_handler(_: &core::panic::PanicInfo) -> ! {\n+    loop {}\n+}"}]}