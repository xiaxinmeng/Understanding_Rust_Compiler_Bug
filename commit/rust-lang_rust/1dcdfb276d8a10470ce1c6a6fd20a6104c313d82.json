{"sha": "1dcdfb276d8a10470ce1c6a6fd20a6104c313d82", "node_id": "C_kwDOAAsO6NoAKDFkY2RmYjI3NmQ4YTEwNDcwY2UxYzZhNmZkMjBhNjEwNGMzMTNkODI", "commit": {"author": {"name": "Tharun Rajendran", "email": "rajendrantharun@live.com", "date": "2022-04-02T00:00:53Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-04-02T00:00:53Z"}, "message": "fix(rustfmt): fix struct field formatting with doc comments present (#5217)\n\n* fix(rustfmt): fix struct field formatting with doc comments present\r\n\r\nFixes #5215\r\n\r\n* fix review feedbacks\r\n\r\n* add unit test without doc comment\r\n\r\n* move tests to a seperate file\r\n\r\n* add additional test cases\r\n\r\n* reintroduce a newline at the of test/souce/structs.rs", "tree": {"sha": "4a9f6546eca132a52238d5c239a41ad57668bd67", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4a9f6546eca132a52238d5c239a41ad57668bd67"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1dcdfb276d8a10470ce1c6a6fd20a6104c313d82", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiR5I1CRBK7hj4Ov3rIwAAye8IABUhiHdDMvyX7Dz0us5EYTNd\nUCZ8AMQ4oyrR9dycFELd1ZDJ3A4sF8rSsGtTI4deQv1eABAaI5jTWCAUeASc+Kqb\nH5XeRyCMt1nEy2GwYaIdF8hzyz6FQgwIV5eLrvximP8ZWZUbv07JQsC6rftqCTkG\nN/UDf2l7BrNTTcBTdFq+/N8XIidGrtmrBVPzkiRn2o1+OB1999DghOGRztEufwOI\niWHZq4ck7JkeEcIAIweBrAs41qdpbVCrYMp+I2/LFPfsZ/hP/3Ytgj1kc2WT3vJ+\nCwgCDrBYfXwM676b3i20JkwywRSasD/SRX7cBhIXJ/cuaGwnJY0k5diYtjeIbD8=\n=bZOt\n-----END PGP SIGNATURE-----\n", "payload": "tree 4a9f6546eca132a52238d5c239a41ad57668bd67\nparent 5ff7b632a95bac6955611d85040859128902c580\nauthor Tharun Rajendran <rajendrantharun@live.com> 1648857653 +0530\ncommitter GitHub <noreply@github.com> 1648857653 -0500\n\nfix(rustfmt): fix struct field formatting with doc comments present (#5217)\n\n* fix(rustfmt): fix struct field formatting with doc comments present\r\n\r\nFixes #5215\r\n\r\n* fix review feedbacks\r\n\r\n* add unit test without doc comment\r\n\r\n* move tests to a seperate file\r\n\r\n* add additional test cases\r\n\r\n* reintroduce a newline at the of test/souce/structs.rs"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1dcdfb276d8a10470ce1c6a6fd20a6104c313d82", "html_url": "https://github.com/rust-lang/rust/commit/1dcdfb276d8a10470ce1c6a6fd20a6104c313d82", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1dcdfb276d8a10470ce1c6a6fd20a6104c313d82/comments", "author": {"login": "tharun208", "id": 14926492, "node_id": "MDQ6VXNlcjE0OTI2NDky", "avatar_url": "https://avatars.githubusercontent.com/u/14926492?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tharun208", "html_url": "https://github.com/tharun208", "followers_url": "https://api.github.com/users/tharun208/followers", "following_url": "https://api.github.com/users/tharun208/following{/other_user}", "gists_url": "https://api.github.com/users/tharun208/gists{/gist_id}", "starred_url": "https://api.github.com/users/tharun208/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tharun208/subscriptions", "organizations_url": "https://api.github.com/users/tharun208/orgs", "repos_url": "https://api.github.com/users/tharun208/repos", "events_url": "https://api.github.com/users/tharun208/events{/privacy}", "received_events_url": "https://api.github.com/users/tharun208/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5ff7b632a95bac6955611d85040859128902c580", "url": "https://api.github.com/repos/rust-lang/rust/commits/5ff7b632a95bac6955611d85040859128902c580", "html_url": "https://github.com/rust-lang/rust/commit/5ff7b632a95bac6955611d85040859128902c580"}], "stats": {"total": 143, "additions": 142, "deletions": 1}, "files": [{"sha": "79f6ff69aa92162cefff93afb8a23c7cbf6d1530", "filename": "src/items.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1dcdfb276d8a10470ce1c6a6fd20a6104c313d82/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1dcdfb276d8a10470ce1c6a6fd20a6104c313d82/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=1dcdfb276d8a10470ce1c6a6fd20a6104c313d82", "patch": "@@ -1771,7 +1771,7 @@ pub(crate) fn rewrite_struct_field(\n         .offset_left(overhead + spacing.len())\n         .and_then(|ty_shape| field.ty.rewrite(context, ty_shape));\n     if let Some(ref ty) = orig_ty {\n-        if !ty.contains('\\n') {\n+        if !ty.contains('\\n') && !contains_comment(context.snippet(missing_span)) {\n             return Some(attr_prefix + &spacing + ty);\n         }\n     }"}, {"sha": "191a621004593a42711affddb1941db393602576", "filename": "tests/source/struct_field_doc_comment.rs", "status": "added", "additions": 72, "deletions": 0, "changes": 72, "blob_url": "https://github.com/rust-lang/rust/blob/1dcdfb276d8a10470ce1c6a6fd20a6104c313d82/tests%2Fsource%2Fstruct_field_doc_comment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1dcdfb276d8a10470ce1c6a6fd20a6104c313d82/tests%2Fsource%2Fstruct_field_doc_comment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fstruct_field_doc_comment.rs?ref=1dcdfb276d8a10470ce1c6a6fd20a6104c313d82", "patch": "@@ -0,0 +1,72 @@\n+// #5215\n+struct MyTuple(\n+    /// Doc Comments\n+    /* TODO note to add more to Doc Comments */ u32,\n+    /// Doc Comments\n+    // TODO note\n+    u64,\n+);\n+\n+struct MyTuple(\n+    #[cfg(unix)] // some comment\n+    u64,\n+    #[cfg(not(unix))] /*block comment */\n+    u32,\n+);\n+\n+struct MyTuple(\n+    #[cfg(unix)]\n+    // some comment\n+    u64,\n+    #[cfg(not(unix))]\n+    /*block comment */\n+    u32,\n+);\n+\n+struct MyTuple(\n+    #[cfg(unix)] // some comment\n+    pub u64,\n+    #[cfg(not(unix))] /*block comment */\n+    pub(crate) u32,\n+);\n+\n+struct MyTuple(\n+    /// Doc Comments\n+    /* TODO note to add more to Doc Comments */\n+    pub u32,\n+    /// Doc Comments\n+    // TODO note\n+    pub(crate) u64,\n+);\n+\n+struct MyStruct {\n+    #[cfg(unix)] // some comment\n+    a: u64,\n+    #[cfg(not(unix))] /*block comment */\n+    b: u32,\n+}\n+\n+struct MyStruct {\n+    #[cfg(unix)] // some comment\n+    pub a: u64,\n+    #[cfg(not(unix))] /*block comment */\n+    pub(crate) b: u32,\n+}\n+\n+struct MyStruct {\n+    /// Doc Comments\n+    /* TODO note to add more to Doc Comments */\n+    a: u32,\n+    /// Doc Comments\n+    // TODO note\n+    b: u64,\n+}\n+\n+struct MyStruct {\n+    /// Doc Comments\n+    /* TODO note to add more to Doc Comments */\n+    pub a: u32,\n+    /// Doc Comments\n+    // TODO note\n+    pub(crate) b: u64,\n+}"}, {"sha": "ebb01a668f4c93d668fd9173e234953aef967f9b", "filename": "tests/target/struct_field_doc_comment.rs", "status": "added", "additions": 69, "deletions": 0, "changes": 69, "blob_url": "https://github.com/rust-lang/rust/blob/1dcdfb276d8a10470ce1c6a6fd20a6104c313d82/tests%2Ftarget%2Fstruct_field_doc_comment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1dcdfb276d8a10470ce1c6a6fd20a6104c313d82/tests%2Ftarget%2Fstruct_field_doc_comment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fstruct_field_doc_comment.rs?ref=1dcdfb276d8a10470ce1c6a6fd20a6104c313d82", "patch": "@@ -0,0 +1,69 @@\n+// #5215\n+struct MyTuple(\n+    /// Doc Comments\n+    /* TODO note to add more to Doc Comments */\n+    u32,\n+    /// Doc Comments\n+    // TODO note\n+    u64,\n+);\n+\n+struct MyTuple(\n+    #[cfg(unix)] // some comment\n+    u64,\n+    #[cfg(not(unix))] /*block comment */ u32,\n+);\n+\n+struct MyTuple(\n+    #[cfg(unix)]\n+    // some comment\n+    u64,\n+    #[cfg(not(unix))]\n+    /*block comment */\n+    u32,\n+);\n+\n+struct MyTuple(\n+    #[cfg(unix)] // some comment\n+    pub  u64,\n+    #[cfg(not(unix))] /*block comment */ pub(crate)  u32,\n+);\n+\n+struct MyTuple(\n+    /// Doc Comments\n+    /* TODO note to add more to Doc Comments */\n+    pub  u32,\n+    /// Doc Comments\n+    // TODO note\n+    pub(crate)  u64,\n+);\n+\n+struct MyStruct {\n+    #[cfg(unix)] // some comment\n+    a: u64,\n+    #[cfg(not(unix))] /*block comment */ b: u32,\n+}\n+\n+struct MyStruct {\n+    #[cfg(unix)] // some comment\n+    pub a: u64,\n+    #[cfg(not(unix))] /*block comment */ pub(crate) b: u32,\n+}\n+\n+struct MyStruct {\n+    /// Doc Comments\n+    /* TODO note to add more to Doc Comments */\n+    a: u32,\n+    /// Doc Comments\n+    // TODO note\n+    b: u64,\n+}\n+\n+struct MyStruct {\n+    /// Doc Comments\n+    /* TODO note to add more to Doc Comments */\n+    pub a: u32,\n+    /// Doc Comments\n+    // TODO note\n+    pub(crate) b: u64,\n+}"}]}