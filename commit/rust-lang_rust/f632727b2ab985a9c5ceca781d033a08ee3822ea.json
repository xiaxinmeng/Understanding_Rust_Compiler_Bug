{"sha": "f632727b2ab985a9c5ceca781d033a08ee3822ea", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY2MzI3MjdiMmFiOTg1YTljNWNlY2E3ODFkMDMzYTA4ZWUzODIyZWE=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-06-10T10:37:27Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-06-10T10:37:27Z"}, "message": "Merge #4834\n\n4834: In field patterns, don't highlight local binding as a field r=matklad a=matklad\n\n\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "b209cdea80c80c96c75ea2ded1f12ebc79d107fb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b209cdea80c80c96c75ea2ded1f12ebc79d107fb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f632727b2ab985a9c5ceca781d033a08ee3822ea", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJe4LfnCRBK7hj4Ov3rIwAAdHIIAJ8PsCoPrwHTlLkXFRUMpKJv\nz82qhH+CDGpDzZLxSLLVov+Oz3kZgFUGmRwsVu8Ry2X545PvvYR0bWuqPXIBkq3y\nUwQ21NZgJAlJdGIoQy4XQVWRhISBZRp1nDfzZNW6fsWOkTz4scspxLC4zmvHrN9g\nqT5+ylacXAFPQqe48b+cfP/Wpz6f+WLL5ZxEwhJow3f9DYQqb3hoJkm8NJ4bZeGh\nKOIj0CKaQ+32/46CXsHbO+vsr1nPdesJo98FD6EYraFatOBEepCtkMvVPXZDOoL8\nJT7i9T+ypb6z4CXbQnfQm3qIS9cj8hUqrlaQHFzT+8SmN37kk0UIgBbGBSdXIds=\n=YpF9\n-----END PGP SIGNATURE-----\n", "payload": "tree b209cdea80c80c96c75ea2ded1f12ebc79d107fb\nparent 9251f181de92c64b51e34980e591d2611b030140\nparent db1cadd4447f7c580c5436a4368a4de3c67fa37a\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1591785447 +0000\ncommitter GitHub <noreply@github.com> 1591785447 +0000\n\nMerge #4834\n\n4834: In field patterns, don't highlight local binding as a field r=matklad a=matklad\n\n\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f632727b2ab985a9c5ceca781d033a08ee3822ea", "html_url": "https://github.com/rust-lang/rust/commit/f632727b2ab985a9c5ceca781d033a08ee3822ea", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f632727b2ab985a9c5ceca781d033a08ee3822ea/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9251f181de92c64b51e34980e591d2611b030140", "url": "https://api.github.com/repos/rust-lang/rust/commits/9251f181de92c64b51e34980e591d2611b030140", "html_url": "https://github.com/rust-lang/rust/commit/9251f181de92c64b51e34980e591d2611b030140"}, {"sha": "db1cadd4447f7c580c5436a4368a4de3c67fa37a", "url": "https://api.github.com/repos/rust-lang/rust/commits/db1cadd4447f7c580c5436a4368a4de3c67fa37a", "html_url": "https://github.com/rust-lang/rust/commit/db1cadd4447f7c580c5436a4368a4de3c67fa37a"}], "stats": {"total": 39, "additions": 23, "deletions": 16}, "files": [{"sha": "33548d43ccd581921f4ebb8deb04d44751f35eba", "filename": "crates/ra_ide/src/snapshots/highlighting.html", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f632727b2ab985a9c5ceca781d033a08ee3822ea/crates%2Fra_ide%2Fsrc%2Fsnapshots%2Fhighlighting.html", "raw_url": "https://github.com/rust-lang/rust/raw/f632727b2ab985a9c5ceca781d033a08ee3822ea/crates%2Fra_ide%2Fsrc%2Fsnapshots%2Fhighlighting.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fsnapshots%2Fhighlighting.html?ref=f632727b2ab985a9c5ceca781d033a08ee3822ea", "patch": "@@ -84,7 +84,9 @@\n     <span class=\"keyword\">let</span> <span class=\"variable declaration mutable\">y</span> = &<span class=\"keyword\">mut</span> <span class=\"variable mutable\">x</span>;\n     <span class=\"keyword\">let</span> <span class=\"variable declaration\">z</span> = &<span class=\"variable mutable\">y</span>;\n \n-    <span class=\"variable mutable\">y</span>;\n+    <span class=\"keyword\">let</span> <span class=\"struct\">Foo</span> { <span class=\"field\">x</span>: <span class=\"variable declaration\">z</span>, <span class=\"field\">y</span> } = <span class=\"struct\">Foo</span> { <span class=\"field\">x</span>: <span class=\"variable\">z</span>, <span class=\"field\">y</span> };\n+\n+    <span class=\"variable\">y</span>;\n }\n \n <span class=\"keyword\">enum</span> <span class=\"enum declaration\">Option</span>&lt;<span class=\"type_param declaration\">T</span>&gt; {"}, {"sha": "949bf59a0d24a8437cf63c0bd99a24ddb94a903e", "filename": "crates/ra_ide/src/syntax_highlighting/tests.rs", "status": "modified", "additions": 14, "deletions": 12, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/f632727b2ab985a9c5ceca781d033a08ee3822ea/crates%2Fra_ide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f632727b2ab985a9c5ceca781d033a08ee3822ea/crates%2Fra_ide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs?ref=f632727b2ab985a9c5ceca781d033a08ee3822ea", "patch": "@@ -7,18 +7,6 @@ use crate::{\n     FileRange, TextRange,\n };\n \n-/// Highlights the code given by the `ra_fixture` argument, renders the\n-/// result as HTML, and compares it with the HTML file given as `snapshot`.\n-/// Note that the `snapshot` file is overwritten by the rendered HTML.\n-fn check_highlighting(ra_fixture: &str, snapshot: &str, rainbow: bool) {\n-    let (analysis, file_id) = single_file(ra_fixture);\n-    let dst_file = project_dir().join(snapshot);\n-    let actual_html = &analysis.highlight_as_html(file_id, rainbow).unwrap();\n-    let expected_html = &read_text(&dst_file);\n-    fs::write(dst_file, &actual_html).unwrap();\n-    assert_eq_text!(expected_html, actual_html);\n-}\n-\n #[test]\n fn test_highlighting() {\n     check_highlighting(\n@@ -77,6 +65,8 @@ fn main() {\n     let y = &mut x;\n     let z = &y;\n \n+    let Foo { x: z, y } = Foo { x: z, y };\n+\n     y;\n }\n \n@@ -334,3 +324,15 @@ impl Foo {\n         false,\n     )\n }\n+\n+/// Highlights the code given by the `ra_fixture` argument, renders the\n+/// result as HTML, and compares it with the HTML file given as `snapshot`.\n+/// Note that the `snapshot` file is overwritten by the rendered HTML.\n+fn check_highlighting(ra_fixture: &str, snapshot: &str, rainbow: bool) {\n+    let (analysis, file_id) = single_file(ra_fixture);\n+    let dst_file = project_dir().join(snapshot);\n+    let actual_html = &analysis.highlight_as_html(file_id, rainbow).unwrap();\n+    let expected_html = &read_text(&dst_file);\n+    fs::write(dst_file, &actual_html).unwrap();\n+    assert_eq_text!(expected_html, actual_html);\n+}"}, {"sha": "3ef5e74b6997c07d9cad2606ba7486a69ca476ab", "filename": "crates/ra_ide_db/src/defs.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/f632727b2ab985a9c5ceca781d033a08ee3822ea/crates%2Fra_ide_db%2Fsrc%2Fdefs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f632727b2ab985a9c5ceca781d033a08ee3822ea/crates%2Fra_ide_db%2Fsrc%2Fdefs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_db%2Fsrc%2Fdefs.rs?ref=f632727b2ab985a9c5ceca781d033a08ee3822ea", "patch": "@@ -78,6 +78,7 @@ impl Definition {\n     }\n }\n \n+#[derive(Debug)]\n pub enum NameClass {\n     Definition(Definition),\n     /// `None` in `if let None = Some(82) {}`\n@@ -131,9 +132,11 @@ pub fn classify_name(sema: &Semantics<RootDatabase>, name: &ast::Name) -> Option\n                 let local = sema.to_def(&it)?;\n \n                 if let Some(record_field_pat) = it.syntax().parent().and_then(ast::RecordFieldPat::cast) {\n-                    if let Some(field) = sema.resolve_record_field_pat(&record_field_pat) {\n-                        let field = Definition::Field(field);\n-                        return Some(NameClass::FieldShorthand { local, field });\n+                    if record_field_pat.name_ref().is_none() {\n+                        if let Some(field) = sema.resolve_record_field_pat(&record_field_pat) {\n+                            let field = Definition::Field(field);\n+                            return Some(NameClass::FieldShorthand { local, field });\n+                        }\n                     }\n                 }\n "}]}