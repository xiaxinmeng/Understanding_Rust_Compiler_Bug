{"sha": "70156fbb752d5c8726c6c47104922575164a92e3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcwMTU2ZmJiNzUyZDVjODcyNmM2YzQ3MTA0OTIyNTc1MTY0YTkyZTM=", "commit": {"author": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2019-01-28T22:40:14Z"}, "committer": {"name": "John K\u00e5re Alsaker", "email": "john.kare.alsaker@gmail.com", "date": "2019-03-04T23:36:25Z"}, "message": "Encode proc macro stability", "tree": {"sha": "22c62473468a697cd08edf29183f8bef271ce755", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/22c62473468a697cd08edf29183f8bef271ce755"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/70156fbb752d5c8726c6c47104922575164a92e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/70156fbb752d5c8726c6c47104922575164a92e3", "html_url": "https://github.com/rust-lang/rust/commit/70156fbb752d5c8726c6c47104922575164a92e3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/70156fbb752d5c8726c6c47104922575164a92e3/comments", "author": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Zoxc", "id": 25784, "node_id": "MDQ6VXNlcjI1Nzg0", "avatar_url": "https://avatars.githubusercontent.com/u/25784?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zoxc", "html_url": "https://github.com/Zoxc", "followers_url": "https://api.github.com/users/Zoxc/followers", "following_url": "https://api.github.com/users/Zoxc/following{/other_user}", "gists_url": "https://api.github.com/users/Zoxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zoxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zoxc/subscriptions", "organizations_url": "https://api.github.com/users/Zoxc/orgs", "repos_url": "https://api.github.com/users/Zoxc/repos", "events_url": "https://api.github.com/users/Zoxc/events{/privacy}", "received_events_url": "https://api.github.com/users/Zoxc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e501a87e895221dfe7475c6739feffe4bbca04eb", "url": "https://api.github.com/repos/rust-lang/rust/commits/e501a87e895221dfe7475c6739feffe4bbca04eb", "html_url": "https://github.com/rust-lang/rust/commit/e501a87e895221dfe7475c6739feffe4bbca04eb"}], "stats": {"total": 9, "additions": 7, "deletions": 2}, "files": [{"sha": "6fe00a4ad2ff2607090912870fbc4bc2875e4aac", "filename": "src/librustc_metadata/decoder.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/70156fbb752d5c8726c6c47104922575164a92e3/src%2Flibrustc_metadata%2Fdecoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/70156fbb752d5c8726c6c47104922575164a92e3/src%2Flibrustc_metadata%2Fdecoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fdecoder.rs?ref=70156fbb752d5c8726c6c47104922575164a92e3", "patch": "@@ -648,7 +648,7 @@ impl<'a, 'tcx> CrateMetadata {\n \n     pub fn get_stability(&self, id: DefIndex) -> Option<attr::Stability> {\n         match self.is_proc_macro(id) {\n-            true => None,\n+            true => self.root.proc_macro_stability.clone(),\n             false => self.entry(id).stability.map(|stab| stab.decode(self)),\n         }\n     }"}, {"sha": "683056c9b33a0348b4e4b000aaa2d7f68bface94", "filename": "src/librustc_metadata/encoder.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/70156fbb752d5c8726c6c47104922575164a92e3/src%2Flibrustc_metadata%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/70156fbb752d5c8726c6c47104922575164a92e3/src%2Flibrustc_metadata%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fencoder.rs?ref=70156fbb752d5c8726c6c47104922575164a92e3", "patch": "@@ -490,7 +490,11 @@ impl<'a, 'tcx> EncodeContext<'a, 'tcx> {\n             } else {\n                 None\n             },\n-\n+            proc_macro_stability: if is_proc_macro {\n+                tcx.lookup_stability(DefId::local(CRATE_DEF_INDEX)).map(|stab| stab.clone())\n+            } else {\n+                None\n+            },\n             compiler_builtins: attr::contains_name(&attrs, \"compiler_builtins\"),\n             needs_allocator: attr::contains_name(&attrs, \"needs_allocator\"),\n             needs_panic_runtime: attr::contains_name(&attrs, \"needs_panic_runtime\"),"}, {"sha": "afeea9947b5e3ecb149f9f42ecc1c0f7cdd13410", "filename": "src/librustc_metadata/schema.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/70156fbb752d5c8726c6c47104922575164a92e3/src%2Flibrustc_metadata%2Fschema.rs", "raw_url": "https://github.com/rust-lang/rust/raw/70156fbb752d5c8726c6c47104922575164a92e3/src%2Flibrustc_metadata%2Fschema.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fschema.rs?ref=70156fbb752d5c8726c6c47104922575164a92e3", "patch": "@@ -187,6 +187,7 @@ pub struct CrateRoot {\n     pub has_default_lib_allocator: bool,\n     pub plugin_registrar_fn: Option<DefIndex>,\n     pub proc_macro_decls_static: Option<DefIndex>,\n+    pub proc_macro_stability: Option<attr::Stability>,\n \n     pub crate_deps: LazySeq<CrateDep>,\n     pub dylib_dependency_formats: LazySeq<Option<LinkagePreference>>,"}]}