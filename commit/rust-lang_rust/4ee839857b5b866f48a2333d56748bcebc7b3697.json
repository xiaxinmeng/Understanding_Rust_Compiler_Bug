{"sha": "4ee839857b5b866f48a2333d56748bcebc7b3697", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRlZTgzOTg1N2I1Yjg2NmY0OGEyMzMzZDU2NzQ4YmNlYmM3YjM2OTc=", "commit": {"author": {"name": "Martin Carton", "email": "cartonmartin+github@gmail.com", "date": "2017-02-07T17:56:38Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-02-07T17:56:38Z"}, "message": "Merge pull request #1506 from bood/master\n\nLint for possible missing comma in an array #1177", "tree": {"sha": "ba2c9d8cbfb371d12dc19ba21040b757c06bc7f3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ba2c9d8cbfb371d12dc19ba21040b757c06bc7f3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4ee839857b5b866f48a2333d56748bcebc7b3697", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4ee839857b5b866f48a2333d56748bcebc7b3697", "html_url": "https://github.com/rust-lang/rust/commit/4ee839857b5b866f48a2333d56748bcebc7b3697", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4ee839857b5b866f48a2333d56748bcebc7b3697/comments", "author": {"login": "mcarton", "id": 3751788, "node_id": "MDQ6VXNlcjM3NTE3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/3751788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarton", "html_url": "https://github.com/mcarton", "followers_url": "https://api.github.com/users/mcarton/followers", "following_url": "https://api.github.com/users/mcarton/following{/other_user}", "gists_url": "https://api.github.com/users/mcarton/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarton/subscriptions", "organizations_url": "https://api.github.com/users/mcarton/orgs", "repos_url": "https://api.github.com/users/mcarton/repos", "events_url": "https://api.github.com/users/mcarton/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8c9019dcadf3273ed23f5e716a96ebd15d595268", "url": "https://api.github.com/repos/rust-lang/rust/commits/8c9019dcadf3273ed23f5e716a96ebd15d595268", "html_url": "https://github.com/rust-lang/rust/commit/8c9019dcadf3273ed23f5e716a96ebd15d595268"}, {"sha": "4b4dc0a4d3cacf11baa0b4dd1207d13465261868", "url": "https://api.github.com/repos/rust-lang/rust/commits/4b4dc0a4d3cacf11baa0b4dd1207d13465261868", "html_url": "https://github.com/rust-lang/rust/commit/4b4dc0a4d3cacf11baa0b4dd1207d13465261868"}], "stats": {"total": 79, "additions": 78, "deletions": 1}, "files": [{"sha": "42df561a6e12c9c56984fc994444592693506f81", "filename": "CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4ee839857b5b866f48a2333d56748bcebc7b3697/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/4ee839857b5b866f48a2333d56748bcebc7b3697/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=4ee839857b5b866f48a2333d56748bcebc7b3697", "patch": "@@ -392,6 +392,7 @@ All notable changes to this project will be documented in this file.\n [`overflow_check_conditional`]: https://github.com/Manishearth/rust-clippy/wiki#overflow_check_conditional\n [`panic_params`]: https://github.com/Manishearth/rust-clippy/wiki#panic_params\n [`partialeq_ne_impl`]: https://github.com/Manishearth/rust-clippy/wiki#partialeq_ne_impl\n+[`possible_missing_comma`]: https://github.com/Manishearth/rust-clippy/wiki#possible_missing_comma\n [`precedence`]: https://github.com/Manishearth/rust-clippy/wiki#precedence\n [`print_stdout`]: https://github.com/Manishearth/rust-clippy/wiki#print_stdout\n [`print_with_newline`]: https://github.com/Manishearth/rust-clippy/wiki#print_with_newline"}, {"sha": "bb4b596a049ebce685adbfa967d97436734f8f63", "filename": "README.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4ee839857b5b866f48a2333d56748bcebc7b3697/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/4ee839857b5b866f48a2333d56748bcebc7b3697/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=4ee839857b5b866f48a2333d56748bcebc7b3697", "patch": "@@ -305,6 +305,7 @@ name\n [overflow_check_conditional](https://github.com/Manishearth/rust-clippy/wiki#overflow_check_conditional)               | warn    | overflow checks inspired by C which are likely to panic\n [panic_params](https://github.com/Manishearth/rust-clippy/wiki#panic_params)                                           | warn    | missing parameters in `panic!` calls\n [partialeq_ne_impl](https://github.com/Manishearth/rust-clippy/wiki#partialeq_ne_impl)                                 | warn    | re-implementing `PartialEq::ne`\n+[possible_missing_comma](https://github.com/Manishearth/rust-clippy/wiki#possible_missing_comma)                       | warn    | possible missing comma in array\n [precedence](https://github.com/Manishearth/rust-clippy/wiki#precedence)                                               | warn    | operations where precedence may be unclear\n [print_stdout](https://github.com/Manishearth/rust-clippy/wiki#print_stdout)                                           | allow   | printing on stdout\n [print_with_newline](https://github.com/Manishearth/rust-clippy/wiki#print_with_newline)                               | warn    | using `print!()` with a format string that ends in a newline"}, {"sha": "f3374ccb5ea166088926c0d40d3d5a8887581a5e", "filename": "clippy_lints/src/formatting.rs", "status": "modified", "additions": 47, "deletions": 1, "changes": 48, "blob_url": "https://github.com/rust-lang/rust/blob/4ee839857b5b866f48a2333d56748bcebc7b3697/clippy_lints%2Fsrc%2Fformatting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4ee839857b5b866f48a2333d56748bcebc7b3697/clippy_lints%2Fsrc%2Fformatting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fformatting.rs?ref=4ee839857b5b866f48a2333d56748bcebc7b3697", "patch": "@@ -46,12 +46,33 @@ declare_lint! {\n     \"suspicious formatting of `else if`\"\n }\n \n+/// **What it does:** Checks for possible missing comma in an array. It lints if\n+/// an array element is a binary operator expression and it lies on two lines.\n+///\n+/// **Why is this bad?** This could lead to unexpected results.\n+///\n+/// **Known problems:** None.\n+///\n+/// **Example:**\n+/// ```rust,ignore\n+/// let a = &[\n+///     -1, -2, -3 // <= no coma here\n+///     -4, -5, -6\n+/// ];\n+/// ```\n+declare_lint! {\n+    pub POSSIBLE_MISSING_COMMA,\n+    Warn,\n+    \"possible missing comma in array\"\n+}\n+\n+\n #[derive(Copy,Clone)]\n pub struct Formatting;\n \n impl LintPass for Formatting {\n     fn get_lints(&self) -> LintArray {\n-        lint_array![SUSPICIOUS_ASSIGNMENT_FORMATTING, SUSPICIOUS_ELSE_FORMATTING]\n+        lint_array![SUSPICIOUS_ASSIGNMENT_FORMATTING, SUSPICIOUS_ELSE_FORMATTING, POSSIBLE_MISSING_COMMA]\n     }\n }\n \n@@ -71,6 +92,7 @@ impl EarlyLintPass for Formatting {\n     fn check_expr(&mut self, cx: &EarlyContext, expr: &ast::Expr) {\n         check_assign(cx, expr);\n         check_else_if(cx, expr);\n+        check_array(cx, expr);\n     }\n }\n \n@@ -127,6 +149,30 @@ fn check_else_if(cx: &EarlyContext, expr: &ast::Expr) {\n     }\n }\n \n+/// Implementation of the `POSSIBLE_MISSING_COMMA` lint for array\n+fn check_array(cx: &EarlyContext, expr: &ast::Expr) {\n+    if let ast::ExprKind::Array(ref array) = expr.node {\n+        for element in array {\n+            if let ast::ExprKind::Binary(ref op, ref lhs, _) = element.node {\n+                if !differing_macro_contexts(lhs.span, op.span) {\n+                    let space_span = mk_sp(lhs.span.hi, op.span.lo);\n+                    if let Some(space_snippet) = snippet_opt(cx, space_span) {\n+                        let lint_span = mk_sp(lhs.span.hi, lhs.span.hi);\n+                        if space_snippet.contains('\\n') {\n+                            span_note_and_lint(cx,\n+                                               POSSIBLE_MISSING_COMMA,\n+                                               lint_span,\n+                                               \"possibly missing a comma here\",\n+                                               lint_span,\n+                                               \"to remove this lint, add a comma or write the expr in a single line\");\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+    }\n+}\n+\n /// Implementation of the `SUSPICIOUS_ELSE_FORMATTING` lint for consecutive ifs.\n fn check_consecutive_ifs(cx: &EarlyContext, first: &ast::Expr, second: &ast::Expr) {\n     if !differing_macro_contexts(first.span, second.span) && !in_macro(cx, first.span) &&"}, {"sha": "1099738d7995077129ad4bfbc1ea08e895bfafa8", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4ee839857b5b866f48a2333d56748bcebc7b3697/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4ee839857b5b866f48a2333d56748bcebc7b3697/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=4ee839857b5b866f48a2333d56748bcebc7b3697", "patch": "@@ -382,6 +382,7 @@ pub fn register_plugins(reg: &mut rustc_plugin::Registry) {\n         eval_order_dependence::DIVERGING_SUB_EXPRESSION,\n         eval_order_dependence::EVAL_ORDER_DEPENDENCE,\n         format::USELESS_FORMAT,\n+        formatting::POSSIBLE_MISSING_COMMA,\n         formatting::SUSPICIOUS_ASSIGNMENT_FORMATTING,\n         formatting::SUSPICIOUS_ELSE_FORMATTING,\n         functions::NOT_UNSAFE_PTR_ARG_DEREF,"}, {"sha": "6c6671b0aa40ef186e09a6f125e3fb888c39667d", "filename": "tests/compile-fail/formatting.rs", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/4ee839857b5b866f48a2333d56748bcebc7b3697/tests%2Fcompile-fail%2Fformatting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4ee839857b5b866f48a2333d56748bcebc7b3697/tests%2Fcompile-fail%2Fformatting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fformatting.rs?ref=4ee839857b5b866f48a2333d56748bcebc7b3697", "patch": "@@ -96,4 +96,32 @@ fn main() {\n     a = -35;\n     a = *&191;\n     b = !false;\n+\n+    // possible missing comma in an array\n+    let _ = &[\n+        -1, -2, -3 // <= no coma here\n+        //~^ ERROR possibly missing a comma here\n+        //~| NOTE to remove this lint, add a comma or write the expr in a single line\n+        -4, -5, -6\n+    ];\n+    let _ = &[\n+        -1, -2, -3 // <= no coma here\n+        //~^ ERROR possibly missing a comma here\n+        //~| NOTE to remove this lint, add a comma or write the expr in a single line\n+        *4, -5, -6\n+    ];\n+\n+    // those are ok:\n+    let _ = &[\n+        -1, -2, -3,\n+        -4, -5, -6\n+    ];\n+    let _ = &[\n+        -1, -2, -3,\n+        -4, -5, -6,\n+    ];\n+    let _ = &[\n+        1 + 2, 3 +\n+        4, 5 + 6,\n+    ];\n }"}]}