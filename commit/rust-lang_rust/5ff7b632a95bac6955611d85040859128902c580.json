{"sha": "5ff7b632a95bac6955611d85040859128902c580", "node_id": "C_kwDOAAsO6NoAKDVmZjdiNjMyYTk1YmFjNjk1NTYxMWQ4NTA0MDg1OTEyODkwMmM1ODA", "commit": {"author": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-03-29T19:59:07Z"}, "committer": {"name": "Caleb Cartwright", "email": "calebcartwright@users.noreply.github.com", "date": "2022-03-30T03:20:11Z"}, "message": "Preserve semicolon after macro call inside foreign mod", "tree": {"sha": "da1822f715af4d601fe24169d66ecc9db81e4985", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/da1822f715af4d601fe24169d66ecc9db81e4985"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5ff7b632a95bac6955611d85040859128902c580", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5ff7b632a95bac6955611d85040859128902c580", "html_url": "https://github.com/rust-lang/rust/commit/5ff7b632a95bac6955611d85040859128902c580", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5ff7b632a95bac6955611d85040859128902c580/comments", "author": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "committer": {"login": "calebcartwright", "id": 13042488, "node_id": "MDQ6VXNlcjEzMDQyNDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13042488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebcartwright", "html_url": "https://github.com/calebcartwright", "followers_url": "https://api.github.com/users/calebcartwright/followers", "following_url": "https://api.github.com/users/calebcartwright/following{/other_user}", "gists_url": "https://api.github.com/users/calebcartwright/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebcartwright/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebcartwright/subscriptions", "organizations_url": "https://api.github.com/users/calebcartwright/orgs", "repos_url": "https://api.github.com/users/calebcartwright/repos", "events_url": "https://api.github.com/users/calebcartwright/events{/privacy}", "received_events_url": "https://api.github.com/users/calebcartwright/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8e94761a94162f43e6c3e9bfbbc5005da3dbeea5", "url": "https://api.github.com/repos/rust-lang/rust/commits/8e94761a94162f43e6c3e9bfbbc5005da3dbeea5", "html_url": "https://github.com/rust-lang/rust/commit/8e94761a94162f43e6c3e9bfbbc5005da3dbeea5"}], "stats": {"total": 22, "additions": 16, "deletions": 6}, "files": [{"sha": "664f152e8be1d3ba2e7586b1acdbc6afcdcc42af", "filename": "src/macros.rs", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/5ff7b632a95bac6955611d85040859128902c580/src%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ff7b632a95bac6955611d85040859128902c580/src%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmacros.rs?ref=5ff7b632a95bac6955611d85040859128902c580", "patch": "@@ -112,6 +112,7 @@ fn rewrite_macro_name(\n fn return_macro_parse_failure_fallback(\n     context: &RewriteContext<'_>,\n     indent: Indent,\n+    position: MacroPosition,\n     span: Span,\n ) -> Option<String> {\n     // Mark this as a failure however we format it\n@@ -140,7 +141,11 @@ fn return_macro_parse_failure_fallback(\n     ));\n \n     // Return the snippet unmodified if the macro is not block-like\n-    Some(context.snippet(span).to_owned())\n+    let mut snippet = context.snippet(span).to_owned();\n+    if position == MacroPosition::Item {\n+        snippet.push(';');\n+    }\n+    Some(snippet)\n }\n \n pub(crate) fn rewrite_macro(\n@@ -233,7 +238,12 @@ fn rewrite_macro_inner(\n     } = match parse_macro_args(context, ts, style, is_forced_bracket) {\n         Some(args) => args,\n         None => {\n-            return return_macro_parse_failure_fallback(context, shape.indent, mac.span());\n+            return return_macro_parse_failure_fallback(\n+                context,\n+                shape.indent,\n+                position,\n+                mac.span(),\n+            );\n         }\n     };\n "}, {"sha": "f51ba6e98c9f597d7f0c4a080c3269eb11c9e682", "filename": "tests/source/extern.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5ff7b632a95bac6955611d85040859128902c580/tests%2Fsource%2Fextern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ff7b632a95bac6955611d85040859128902c580/tests%2Fsource%2Fextern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fextern.rs?ref=5ff7b632a95bac6955611d85040859128902c580", "patch": "@@ -84,9 +84,9 @@ macro_rules! x {\n \n extern \"macros\" {\n     x!(ident);\n-    // x!(#); FIXME\n+    x!(#);\n     x![ident];\n-    // x![#]; FIXME\n+    x![#];\n     x! {ident}\n     x! {#}\n }"}, {"sha": "d1741360cfd6437878535bb9bd840517ebab4282", "filename": "tests/target/extern.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5ff7b632a95bac6955611d85040859128902c580/tests%2Ftarget%2Fextern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ff7b632a95bac6955611d85040859128902c580/tests%2Ftarget%2Fextern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fextern.rs?ref=5ff7b632a95bac6955611d85040859128902c580", "patch": "@@ -89,9 +89,9 @@ macro_rules! x {\n \n extern \"macros\" {\n     x!(ident);\n-    // x!(#); FIXME\n+    x!(#);\n     x![ident];\n-    // x![#]; FIXME\n+    x![#];\n     x! {ident}\n     x! {#}\n }"}]}