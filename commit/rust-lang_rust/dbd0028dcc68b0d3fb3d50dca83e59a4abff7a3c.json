{"sha": "dbd0028dcc68b0d3fb3d50dca83e59a4abff7a3c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRiZDAwMjhkY2M2OGIwZDNmYjNkNTBkY2E4M2U1OWE0YWJmZjdhM2M=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-07-25T21:20:54Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-07-25T21:20:54Z"}, "message": "Rollup merge of #61890 - golddranks:fix_sanity_check_llvm, r=Dylan-DPC\n\nFix some sanity checks\n\nUpdate: Changes that made it not to work dropped.\n\n* Fix `building_llvm` in sanity check\n  * This was subtly broken: we build LLVM if any of the hosts builds LLVM, and not setting the config meant that LLVM is built for that target. Because of filtering away the targets not configured and the semantics of `Iterator::any`, it currently didn't set the `building_llvm` flag even if we indeed build it.\n* Add `swig` sanity check\n  * This checks whether there is a `swig` executable needed for LLDB.", "tree": {"sha": "ed7b250f6849f1f85f6bb4e65f6cb0c5e5e56f27", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ed7b250f6849f1f85f6bb4e65f6cb0c5e5e56f27"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dbd0028dcc68b0d3fb3d50dca83e59a4abff7a3c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdOh02CRBK7hj4Ov3rIwAAdHIIAFakBm8WDR8jDSx19FWH8sq4\nM7qKwQhfftxQfDtG9AhkgYQn+SwrtjFfamedr3A69cqRfZ7aI1ZqC5VoRh2jMGsA\n7CmLReHS023vABV4E+kMkaTcQDWudxHDeJ0SIsgaLnUflFUiQTUvWIobj8C+iW1H\nABhFmWyG5D9POLDxzj4EEkOQ44v7Ji+h1H8P6sXp5FdB8isqLRJzIqvmLgEVZEom\nm5SwIK92hf4+UfGl5De3HZXLpp3EcQ/VmX+NDSxPffqufVo4dM6ZFct8Pqy3hgWe\nKy9/+ge5QnL7bPOVrt5UwI6BKkdTwM/hLYz6EDLMEH9M6/dtyNOnEJEStXmHN+k=\n=s2z0\n-----END PGP SIGNATURE-----\n", "payload": "tree ed7b250f6849f1f85f6bb4e65f6cb0c5e5e56f27\nparent a57c4f6297876c570af86b455e92e050a22328ad\nparent f78cd4de454c4b55c95137f2db07b4f36b86c3af\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1564089654 +0200\ncommitter GitHub <noreply@github.com> 1564089654 +0200\n\nRollup merge of #61890 - golddranks:fix_sanity_check_llvm, r=Dylan-DPC\n\nFix some sanity checks\n\nUpdate: Changes that made it not to work dropped.\n\n* Fix `building_llvm` in sanity check\n  * This was subtly broken: we build LLVM if any of the hosts builds LLVM, and not setting the config meant that LLVM is built for that target. Because of filtering away the targets not configured and the semantics of `Iterator::any`, it currently didn't set the `building_llvm` flag even if we indeed build it.\n* Add `swig` sanity check\n  * This checks whether there is a `swig` executable needed for LLDB.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dbd0028dcc68b0d3fb3d50dca83e59a4abff7a3c", "html_url": "https://github.com/rust-lang/rust/commit/dbd0028dcc68b0d3fb3d50dca83e59a4abff7a3c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dbd0028dcc68b0d3fb3d50dca83e59a4abff7a3c/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a57c4f6297876c570af86b455e92e050a22328ad", "url": "https://api.github.com/repos/rust-lang/rust/commits/a57c4f6297876c570af86b455e92e050a22328ad", "html_url": "https://github.com/rust-lang/rust/commit/a57c4f6297876c570af86b455e92e050a22328ad"}, {"sha": "f78cd4de454c4b55c95137f2db07b4f36b86c3af", "url": "https://api.github.com/repos/rust-lang/rust/commits/f78cd4de454c4b55c95137f2db07b4f36b86c3af", "html_url": "https://github.com/rust-lang/rust/commit/f78cd4de454c4b55c95137f2db07b4f36b86c3af"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "4e3930c8da7fc5b2b48e9ee771655b46bfb70dc7", "filename": "src/bootstrap/sanity.rs", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/dbd0028dcc68b0d3fb3d50dca83e59a4abff7a3c/src%2Fbootstrap%2Fsanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dbd0028dcc68b0d3fb3d50dca83e59a4abff7a3c/src%2Fbootstrap%2Fsanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fsanity.rs?ref=dbd0028dcc68b0d3fb3d50dca83e59a4abff7a3c", "patch": "@@ -78,8 +78,11 @@ pub fn check(build: &mut Build) {\n \n     // We need cmake, but only if we're actually building LLVM or sanitizers.\n     let building_llvm = build.hosts.iter()\n-        .filter_map(|host| build.config.target_config.get(host))\n-        .any(|config| config.llvm_config.is_none());\n+        .map(|host| build.config.target_config\n+            .get(host)\n+            .map(|config| config.llvm_config.is_none())\n+            .unwrap_or(true))\n+        .any(|build_llvm_ourselves| build_llvm_ourselves);\n     if building_llvm || build.config.sanitizers {\n         cmd_finder.must_have(\"cmake\");\n     }\n@@ -106,6 +109,14 @@ pub fn check(build: &mut Build) {\n                 build.config.ninja = true;\n             }\n         }\n+\n+        if build.config.lldb_enabled {\n+            cmd_finder.must_have(\"swig\");\n+            let out = output(Command::new(\"swig\").arg(\"-version\"));\n+            if !out.contains(\"SWIG Version 3\") && !out.contains(\"SWIG Version 4\") {\n+                panic!(\"Ensure that Swig 3.x.x or 4.x.x is installed.\");\n+            }\n+        }\n     }\n \n     build.config.python = build.config.python.take().map(|p| cmd_finder.must_have(p))"}]}