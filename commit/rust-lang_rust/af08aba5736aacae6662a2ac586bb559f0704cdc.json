{"sha": "af08aba5736aacae6662a2ac586bb559f0704cdc", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFmMDhhYmE1NzM2YWFjYWU2NjYyYTJhYzU4NmJiNTU5ZjA3MDRjZGM=", "commit": {"author": {"name": "Jeff Olson", "email": "olson.jeffery@gmail.com", "date": "2012-03-21T15:56:05Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-04-06T22:35:48Z"}, "message": "some more stuff for libuv dealing w/ 1402.. should go away soon", "tree": {"sha": "7aba98465ba24a42cfb0cd5ce54aeed1f3a3dadd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7aba98465ba24a42cfb0cd5ce54aeed1f3a3dadd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/af08aba5736aacae6662a2ac586bb559f0704cdc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/af08aba5736aacae6662a2ac586bb559f0704cdc", "html_url": "https://github.com/rust-lang/rust/commit/af08aba5736aacae6662a2ac586bb559f0704cdc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/af08aba5736aacae6662a2ac586bb559f0704cdc/comments", "author": {"login": "olsonjeffery", "id": 10408, "node_id": "MDQ6VXNlcjEwNDA4", "avatar_url": "https://avatars.githubusercontent.com/u/10408?v=4", "gravatar_id": "", "url": "https://api.github.com/users/olsonjeffery", "html_url": "https://github.com/olsonjeffery", "followers_url": "https://api.github.com/users/olsonjeffery/followers", "following_url": "https://api.github.com/users/olsonjeffery/following{/other_user}", "gists_url": "https://api.github.com/users/olsonjeffery/gists{/gist_id}", "starred_url": "https://api.github.com/users/olsonjeffery/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/olsonjeffery/subscriptions", "organizations_url": "https://api.github.com/users/olsonjeffery/orgs", "repos_url": "https://api.github.com/users/olsonjeffery/repos", "events_url": "https://api.github.com/users/olsonjeffery/events{/privacy}", "received_events_url": "https://api.github.com/users/olsonjeffery/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3817ba7578a5044a5572f35de367b6ca31a35bc0", "url": "https://api.github.com/repos/rust-lang/rust/commits/3817ba7578a5044a5572f35de367b6ca31a35bc0", "html_url": "https://github.com/rust-lang/rust/commit/3817ba7578a5044a5572f35de367b6ca31a35bc0"}], "stats": {"total": 32, "additions": 22, "deletions": 10}, "files": [{"sha": "c280caf0372da1ab8638846cbc06ca9b2eb39f82", "filename": "src/libstd/uv.rs", "status": "modified", "additions": 7, "deletions": 8, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/af08aba5736aacae6662a2ac586bb559f0704cdc/src%2Flibstd%2Fuv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af08aba5736aacae6662a2ac586bb559f0704cdc/src%2Flibstd%2Fuv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fuv.rs?ref=af08aba5736aacae6662a2ac586bb559f0704cdc", "patch": "@@ -273,7 +273,7 @@ native mod rustrt {\n         loop_handle: *ctypes::void,\n         handle_ptr: *uv_tcp_t) -> ctypes::c_int;\n     fn rust_uv_buf_init(base: *u8, len: ctypes::size_t)\n-        -> uv_buf_t;\n+        -> *ctypes::void;\n     fn rust_uv_last_error(loop_handle: *ctypes::void) -> uv_err_t;\n     fn rust_uv_ip4_addr(ip: *u8, port: ctypes::c_int)\n         -> *ctypes::void;\n@@ -352,10 +352,6 @@ mod direct {\n     unsafe fn write_t() -> uv_write_t {\n         ret gen_stub_uv_write_t();\n     }\n-    // FIXME: see github issue #1402\n-    unsafe fn buf_init(input: *u8, len: uint) -> *ctypes::void {\n-        ret rustrt::rust_uv_buf_init(input, len);\n-    }\n     unsafe fn get_loop_for_uv_handle(handle: *ctypes::void)\n         -> *ctypes::void {\n         ret rustrt::rust_uv_get_loop_for_uv_handle(handle);\n@@ -373,6 +369,10 @@ mod direct {\n         rustrt::rust_uv_set_data_for_req(req, data);\n     }\n     // FIXME: see github issue #1402\n+    unsafe fn buf_init(input: *u8, len: uint) -> *ctypes::void {\n+        ret rustrt::rust_uv_buf_init(input, len);\n+    }\n+    // FIXME: see github issue #1402\n     unsafe fn ip4_addr(ip: str, port: ctypes::c_int)\n     -> *ctypes::void {\n         let addr_vec = str::bytes(ip);\n@@ -382,10 +382,9 @@ mod direct {\n         io::println(#fmt(\"vec val: '%s' length: %u\",ip_back, vec::len(addr_vec)));\n         ret rustrt::rust_uv_ip4_addr(addr_vec_ptr, port);\n     }\n-\n     // this is lame.\n     // FIXME: see github issue #1402\n-    unsafe fn ip4_addr_free(ptr: *ctypes::void) {\n+    unsafe fn free_1402(ptr: *ctypes::void) {\n         rustrt::rust_uv_free(ptr);\n     }\n }\n@@ -1033,7 +1032,7 @@ fn impl_uv_tcp_request() unsafe {\n             direct::run(test_loop);\n             io::println(\"after run tcp req loop\");\n             // FIXME: see github issue #1402\n-            direct::ip4_addr_free(addr);\n+            direct::free_1402(addr);\n         }\n         else {\n            io::println(\"direct::tcp_connect() failure\");"}, {"sha": "4735abdedcde2bd2ec65512022b43d40dfe2994e", "filename": "src/rt/rust_uv.cpp", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/af08aba5736aacae6662a2ac586bb559f0704cdc/src%2Frt%2Frust_uv.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/af08aba5736aacae6662a2ac586bb559f0704cdc/src%2Frt%2Frust_uv.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_uv.cpp?ref=af08aba5736aacae6662a2ac586bb559f0704cdc", "patch": "@@ -234,9 +234,22 @@ rust_uv_get_stream_handle_for_connect(uv_connect_t* connect) {\n   return connect->handle;\n }\n \n-extern \"C\" uv_buf_t\n+static uv_buf_t\n+current_kernel_malloc_alloc_cb(uv_handle_t* handle,\n+\t\t\t\t\t\t\t   size_t suggested_size) {\n+  char* base_ptr = (char*)current_kernel_malloc(sizeof(char)\n+\t\t\t\t\t\t\t\t\t\t\t* suggested_size,\n+\t\t\t\t\t\t\t\t\t\t \"uv_buf_t_base_val\");\n+  return uv_buf_init(base_ptr, suggested_size);\n+}\n+\n+// FIXME see issue #1402\n+extern \"C\" void*\n rust_uv_buf_init(char* base, size_t len) {\n-  return uv_buf_init(base, len);\n+  uv_buf_t* buf_ptr = current_kernel_malloc(sizeof(uv_buf_t),\n+\t\t\t\t\t\t\t\t\t\t\t\"uv_buf_t_1402\");\n+  *buf_ptr = uv_buf_init(base, len);\n+  return buf_ptr;\n }\n \n extern \"C\" uv_loop_t*"}]}