{"sha": "53aca553ec08e62a0591806fcf0f706ee9f53778", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUzYWNhNTUzZWMwOGU2MmEwNTkxODA2ZmNmMGY3MDZlZTlmNTM3Nzg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-10-16T12:49:49Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-10-16T12:49:49Z"}, "message": "Auto merge of #65172 - tanriol:explain_borrow-use-context-dominators, r=nagisa\n\nuse precalculated dominators in explain_borrow\n\nThis looks like the only place calculating dominators from the MIR body every time instead of using the ones stored on the `MirBorrowckCtxt`. For example, in rust-lang/rust#65131 a big generated function with a number of borrowck errors takes a few hours(!) recalculating the dominators while explaining the errors.\n\nI don't know enough about this part of rustc codebase to know for sure that this change is correct, but no tests seem to fail as a result of this change in local testing.", "tree": {"sha": "c28baad6b2d8c9f854bf5f046027f4d7483bc7c7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c28baad6b2d8c9f854bf5f046027f4d7483bc7c7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/53aca553ec08e62a0591806fcf0f706ee9f53778", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/53aca553ec08e62a0591806fcf0f706ee9f53778", "html_url": "https://github.com/rust-lang/rust/commit/53aca553ec08e62a0591806fcf0f706ee9f53778", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/53aca553ec08e62a0591806fcf0f706ee9f53778/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bfc58789a4d08519e93aef517d5ffe17c113ba8e", "url": "https://api.github.com/repos/rust-lang/rust/commits/bfc58789a4d08519e93aef517d5ffe17c113ba8e", "html_url": "https://github.com/rust-lang/rust/commit/bfc58789a4d08519e93aef517d5ffe17c113ba8e"}, {"sha": "4cc707cb7846c2a136daa42ea3498c5a92903189", "url": "https://api.github.com/repos/rust-lang/rust/commits/4cc707cb7846c2a136daa42ea3498c5a92903189", "html_url": "https://github.com/rust-lang/rust/commit/4cc707cb7846c2a136daa42ea3498c5a92903189"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "59b2796db7abe2c6f9fded0e539a41d97612720c", "filename": "src/librustc_mir/borrow_check/nll/explain_borrow/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/53aca553ec08e62a0591806fcf0f706ee9f53778/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fexplain_borrow%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/53aca553ec08e62a0591806fcf0f706ee9f53778/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fexplain_borrow%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fexplain_borrow%2Fmod.rs?ref=53aca553ec08e62a0591806fcf0f706ee9f53778", "patch": "@@ -458,7 +458,7 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n     /// True if an edge `source -> target` is a backedge -- in other words, if the target\n     /// dominates the source.\n     fn is_back_edge(&self, source: Location, target: Location) -> bool {\n-        target.dominates(source, &self.body.dominators())\n+        target.dominates(source, &self.dominators)\n     }\n \n     /// Determine how the borrow was later used."}]}