{"sha": "13076f90d2febedd44d395561b0ec844cac64f8b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjEzMDc2ZjkwZDJmZWJlZGQ0NGQzOTU1NjFiMGVjODQ0Y2FjNjRmOGI=", "commit": {"author": {"name": "Camelid", "email": "camelidcamel@gmail.com", "date": "2021-03-14T21:00:02Z"}, "committer": {"name": "Camelid", "email": "camelidcamel@gmail.com", "date": "2021-03-14T21:00:02Z"}, "message": "Tweak diagnostics\n\n- Tweak lint message\n- Display multi-segment paths correctly", "tree": {"sha": "951f89bbd21411243441fd76362ae3b05e182ee5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/951f89bbd21411243441fd76362ae3b05e182ee5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/13076f90d2febedd44d395561b0ec844cac64f8b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/13076f90d2febedd44d395561b0ec844cac64f8b", "html_url": "https://github.com/rust-lang/rust/commit/13076f90d2febedd44d395561b0ec844cac64f8b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/13076f90d2febedd44d395561b0ec844cac64f8b/comments", "author": {"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}, "committer": {"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "13884dc2af3d993629eec4a5489dc99bd0a00a71", "url": "https://api.github.com/repos/rust-lang/rust/commits/13884dc2af3d993629eec4a5489dc99bd0a00a71", "html_url": "https://github.com/rust-lang/rust/commit/13884dc2af3d993629eec4a5489dc99bd0a00a71"}], "stats": {"total": 47, "additions": 25, "deletions": 22}, "files": [{"sha": "2edc2315f057541b13d8e7d64fa522ef176679d5", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/13076f90d2febedd44d395561b0ec844cac64f8b/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/13076f90d2febedd44d395561b0ec844cac64f8b/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=13076f90d2febedd44d395561b0ec844cac64f8b", "patch": "@@ -597,11 +597,14 @@ impl CheckAttrVisitor<'tcx> {\n                                 hir_id,\n                                 i_meta.span,\n                                 |lint| {\n-                                    lint.build(&format!(\n-                                        \"unknown `doc` attribute `{}`\",\n-                                        i_meta.name_or_empty()\n-                                    ))\n-                                    .emit();\n+                                    let msg = if let Ok(snippet) =\n+                                        self.tcx.sess.source_map().span_to_snippet(i_meta.path.span)\n+                                    {\n+                                        format!(\"unknown `doc` attribute `{}`\", snippet,)\n+                                    } else {\n+                                        String::from(\"unknown `doc` attribute\")\n+                                    };\n+                                    lint.build(&msg).emit();\n                                 },\n                             );\n                             is_valid = false;\n@@ -613,7 +616,7 @@ impl CheckAttrVisitor<'tcx> {\n                         hir_id,\n                         meta.span(),\n                         |lint| {\n-                            lint.build(&format!(\"unknown `doc` attribute\")).emit();\n+                            lint.build(&format!(\"invalid `doc` attribute\")).emit();\n                         },\n                     );\n                     is_valid = false;"}, {"sha": "980d1c0e2077d272406075d834928dcf265e7ed3", "filename": "src/test/rustdoc-ui/doc-attr.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/13076f90d2febedd44d395561b0ec844cac64f8b/src%2Ftest%2Frustdoc-ui%2Fdoc-attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/13076f90d2febedd44d395561b0ec844cac64f8b/src%2Ftest%2Frustdoc-ui%2Fdoc-attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdoc-attr.rs?ref=13076f90d2febedd44d395561b0ec844cac64f8b", "patch": "@@ -10,12 +10,12 @@\n pub fn foo() {}\n \n #[doc(123)]\n-//~^ ERROR unknown `doc` attribute\n+//~^ ERROR invalid `doc` attribute\n //~| WARN\n #[doc(\"hello\", \"bar\")]\n-//~^ ERROR unknown `doc` attribute\n+//~^ ERROR invalid `doc` attribute\n //~| WARN\n-//~| ERROR unknown `doc` attribute\n+//~| ERROR invalid `doc` attribute\n //~| WARN\n #[doc(foo::bar, crate::bar::baz = \"bye\")]\n //~^ ERROR unknown `doc` attribute"}, {"sha": "cc2494c92e64951c25c674a21469c6974d53489d", "filename": "src/test/rustdoc-ui/doc-attr.stderr", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/13076f90d2febedd44d395561b0ec844cac64f8b/src%2Ftest%2Frustdoc-ui%2Fdoc-attr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/13076f90d2febedd44d395561b0ec844cac64f8b/src%2Ftest%2Frustdoc-ui%2Fdoc-attr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdoc-attr.stderr?ref=13076f90d2febedd44d395561b0ec844cac64f8b", "patch": "@@ -13,7 +13,7 @@ LL | #![deny(warnings)]\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n    = note: for more information, see issue #82730 <https://github.com/rust-lang/rust/issues/82730>\n \n-error: unknown `doc` attribute\n+error: invalid `doc` attribute\n   --> $DIR/doc-attr.rs:12:7\n    |\n LL | #[doc(123)]\n@@ -22,7 +22,7 @@ LL | #[doc(123)]\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n    = note: for more information, see issue #82730 <https://github.com/rust-lang/rust/issues/82730>\n \n-error: unknown `doc` attribute\n+error: invalid `doc` attribute\n   --> $DIR/doc-attr.rs:15:7\n    |\n LL | #[doc(\"hello\", \"bar\")]\n@@ -31,7 +31,7 @@ LL | #[doc(\"hello\", \"bar\")]\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n    = note: for more information, see issue #82730 <https://github.com/rust-lang/rust/issues/82730>\n \n-error: unknown `doc` attribute\n+error: invalid `doc` attribute\n   --> $DIR/doc-attr.rs:15:16\n    |\n LL | #[doc(\"hello\", \"bar\")]\n@@ -40,7 +40,7 @@ LL | #[doc(\"hello\", \"bar\")]\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n    = note: for more information, see issue #82730 <https://github.com/rust-lang/rust/issues/82730>\n \n-error: unknown `doc` attribute ``\n+error: unknown `doc` attribute `foo::bar`\n   --> $DIR/doc-attr.rs:20:7\n    |\n LL | #[doc(foo::bar, crate::bar::baz = \"bye\")]\n@@ -49,7 +49,7 @@ LL | #[doc(foo::bar, crate::bar::baz = \"bye\")]\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n    = note: for more information, see issue #82730 <https://github.com/rust-lang/rust/issues/82730>\n \n-error: unknown `doc` attribute ``\n+error: unknown `doc` attribute `crate::bar::baz`\n   --> $DIR/doc-attr.rs:20:17\n    |\n LL | #[doc(foo::bar, crate::bar::baz = \"bye\")]"}, {"sha": "980d1c0e2077d272406075d834928dcf265e7ed3", "filename": "src/test/ui/attributes/doc-attr.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/13076f90d2febedd44d395561b0ec844cac64f8b/src%2Ftest%2Fui%2Fattributes%2Fdoc-attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/13076f90d2febedd44d395561b0ec844cac64f8b/src%2Ftest%2Fui%2Fattributes%2Fdoc-attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattributes%2Fdoc-attr.rs?ref=13076f90d2febedd44d395561b0ec844cac64f8b", "patch": "@@ -10,12 +10,12 @@\n pub fn foo() {}\n \n #[doc(123)]\n-//~^ ERROR unknown `doc` attribute\n+//~^ ERROR invalid `doc` attribute\n //~| WARN\n #[doc(\"hello\", \"bar\")]\n-//~^ ERROR unknown `doc` attribute\n+//~^ ERROR invalid `doc` attribute\n //~| WARN\n-//~| ERROR unknown `doc` attribute\n+//~| ERROR invalid `doc` attribute\n //~| WARN\n #[doc(foo::bar, crate::bar::baz = \"bye\")]\n //~^ ERROR unknown `doc` attribute"}, {"sha": "cc2494c92e64951c25c674a21469c6974d53489d", "filename": "src/test/ui/attributes/doc-attr.stderr", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/13076f90d2febedd44d395561b0ec844cac64f8b/src%2Ftest%2Fui%2Fattributes%2Fdoc-attr.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/13076f90d2febedd44d395561b0ec844cac64f8b/src%2Ftest%2Fui%2Fattributes%2Fdoc-attr.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fattributes%2Fdoc-attr.stderr?ref=13076f90d2febedd44d395561b0ec844cac64f8b", "patch": "@@ -13,7 +13,7 @@ LL | #![deny(warnings)]\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n    = note: for more information, see issue #82730 <https://github.com/rust-lang/rust/issues/82730>\n \n-error: unknown `doc` attribute\n+error: invalid `doc` attribute\n   --> $DIR/doc-attr.rs:12:7\n    |\n LL | #[doc(123)]\n@@ -22,7 +22,7 @@ LL | #[doc(123)]\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n    = note: for more information, see issue #82730 <https://github.com/rust-lang/rust/issues/82730>\n \n-error: unknown `doc` attribute\n+error: invalid `doc` attribute\n   --> $DIR/doc-attr.rs:15:7\n    |\n LL | #[doc(\"hello\", \"bar\")]\n@@ -31,7 +31,7 @@ LL | #[doc(\"hello\", \"bar\")]\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n    = note: for more information, see issue #82730 <https://github.com/rust-lang/rust/issues/82730>\n \n-error: unknown `doc` attribute\n+error: invalid `doc` attribute\n   --> $DIR/doc-attr.rs:15:16\n    |\n LL | #[doc(\"hello\", \"bar\")]\n@@ -40,7 +40,7 @@ LL | #[doc(\"hello\", \"bar\")]\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n    = note: for more information, see issue #82730 <https://github.com/rust-lang/rust/issues/82730>\n \n-error: unknown `doc` attribute ``\n+error: unknown `doc` attribute `foo::bar`\n   --> $DIR/doc-attr.rs:20:7\n    |\n LL | #[doc(foo::bar, crate::bar::baz = \"bye\")]\n@@ -49,7 +49,7 @@ LL | #[doc(foo::bar, crate::bar::baz = \"bye\")]\n    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n    = note: for more information, see issue #82730 <https://github.com/rust-lang/rust/issues/82730>\n \n-error: unknown `doc` attribute ``\n+error: unknown `doc` attribute `crate::bar::baz`\n   --> $DIR/doc-attr.rs:20:17\n    |\n LL | #[doc(foo::bar, crate::bar::baz = \"bye\")]"}]}