{"sha": "ebea2ea34faf85688daeee703b925d25e63024fb", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViZWEyZWEzNGZhZjg1Njg4ZGFlZWU3MDNiOTI1ZDI1ZTYzMDI0ZmI=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-12-30T01:28:19Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-12-30T01:28:19Z"}, "message": "Merge branch 'rustbuild-llvm-targets' of https://github.com/xen0n/rust into rollup", "tree": {"sha": "8386d020cafd2ccac0e61c23ea8fc142821aaeac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8386d020cafd2ccac0e61c23ea8fc142821aaeac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ebea2ea34faf85688daeee703b925d25e63024fb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ebea2ea34faf85688daeee703b925d25e63024fb", "html_url": "https://github.com/rust-lang/rust/commit/ebea2ea34faf85688daeee703b925d25e63024fb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ebea2ea34faf85688daeee703b925d25e63024fb/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "334af886589f2854d9027d60fa79a62b6e5b4980", "url": "https://api.github.com/repos/rust-lang/rust/commits/334af886589f2854d9027d60fa79a62b6e5b4980", "html_url": "https://github.com/rust-lang/rust/commit/334af886589f2854d9027d60fa79a62b6e5b4980"}, {"sha": "0f8e931475b1f7864504f509b389d28e1ffbc93a", "url": "https://api.github.com/repos/rust-lang/rust/commits/0f8e931475b1f7864504f509b389d28e1ffbc93a", "html_url": "https://github.com/rust-lang/rust/commit/0f8e931475b1f7864504f509b389d28e1ffbc93a"}], "stats": {"total": 23, "additions": 21, "deletions": 2}, "files": [{"sha": "9767afd73ca5d3f5e16957a0a850165af4730eb0", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/ebea2ea34faf85688daeee703b925d25e63024fb/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebea2ea34faf85688daeee703b925d25e63024fb/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=ebea2ea34faf85688daeee703b925d25e63024fb", "patch": "@@ -55,6 +55,7 @@ pub struct Config {\n     pub llvm_version_check: bool,\n     pub llvm_static_stdcpp: bool,\n     pub llvm_link_shared: bool,\n+    pub llvm_targets: Option<String>,\n \n     // rust codegen options\n     pub rust_optimize: bool,\n@@ -154,6 +155,7 @@ struct Llvm {\n     release_debuginfo: Option<bool>,\n     version_check: Option<bool>,\n     static_libstdcpp: Option<bool>,\n+    targets: Option<String>,\n }\n \n #[derive(RustcDecodable)]\n@@ -288,6 +290,7 @@ impl Config {\n             set(&mut config.llvm_release_debuginfo, llvm.release_debuginfo);\n             set(&mut config.llvm_version_check, llvm.version_check);\n             set(&mut config.llvm_static_stdcpp, llvm.static_libstdcpp);\n+            config.llvm_targets = llvm.targets.clone();\n         }\n \n         if let Some(ref rust) = toml.rust {"}, {"sha": "b476478fdd1c318b64cd2662ed4cf6fe9d0babf2", "filename": "src/bootstrap/config.toml.example", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/ebea2ea34faf85688daeee703b925d25e63024fb/src%2Fbootstrap%2Fconfig.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/ebea2ea34faf85688daeee703b925d25e63024fb/src%2Fbootstrap%2Fconfig.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.toml.example?ref=ebea2ea34faf85688daeee703b925d25e63024fb", "patch": "@@ -42,6 +42,17 @@\n # example.\n #ninja = false\n \n+# LLVM targets to build support for.\n+# Note: this is NOT related to Rust compilation targets. However, as Rust is\n+# dependent on LLVM for code generation, turning targets off here WILL lead to\n+# the resulting rustc being unable to compile for the disabled architectures.\n+# Also worth pointing out is that, in case support for new targets are added to\n+# LLVM, enabling them here doesn't mean Rust is automatically gaining said\n+# support. You'll need to write a target specification at least, and most\n+# likely, teach rustc about the C ABI of the target. Get in touch with the\n+# Rust team and file an issue if you need assistance in porting!\n+#targets = \"X86;ARM;AArch64;Mips;PowerPC;SystemZ;JSBackend;MSP430;Sparc\"\n+\n # =============================================================================\n # General build configuration options\n # ============================================================================="}, {"sha": "4b6fef8edc17f9e4465bbc549cb4ccacfafc9037", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/ebea2ea34faf85688daeee703b925d25e63024fb/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebea2ea34faf85688daeee703b925d25e63024fb/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=ebea2ea34faf85688daeee703b925d25e63024fb", "patch": "@@ -75,13 +75,18 @@ pub fn llvm(build: &Build, target: &str) {\n         (true, true) => \"RelWithDebInfo\",\n     };\n \n+    // NOTE: remember to also update `config.toml.example` when changing the defaults!\n+    let llvm_targets = match build.config.llvm_targets {\n+        Some(ref s) => s,\n+        None => \"X86;ARM;AArch64;Mips;PowerPC;SystemZ;JSBackend;MSP430;Sparc;NVPTX\",\n+    };\n+\n     cfg.target(target)\n        .host(&build.config.build)\n        .out_dir(&dst)\n        .profile(profile)\n        .define(\"LLVM_ENABLE_ASSERTIONS\", assertions)\n-       .define(\"LLVM_TARGETS_TO_BUILD\",\n-               \"X86;ARM;AArch64;Mips;PowerPC;SystemZ;JSBackend;MSP430;Sparc;NVPTX\")\n+       .define(\"LLVM_TARGETS_TO_BUILD\", llvm_targets)\n        .define(\"LLVM_INCLUDE_EXAMPLES\", \"OFF\")\n        .define(\"LLVM_INCLUDE_TESTS\", \"OFF\")\n        .define(\"LLVM_INCLUDE_DOCS\", \"OFF\")"}]}