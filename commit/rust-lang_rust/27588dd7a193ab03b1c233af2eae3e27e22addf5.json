{"sha": "27588dd7a193ab03b1c233af2eae3e27e22addf5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI3NTg4ZGQ3YTE5M2FiMDNiMWMyMzNhZjJlYWUzZTI3ZTIyYWRkZjU=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2016-09-28T14:56:37Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2016-09-28T16:05:19Z"}, "message": "Move nodejs detection into bootstrap\n\nThis avoids issues with mingw path conversions.", "tree": {"sha": "5ce9efd7f55c8708006f6af9d67e882dfc310c37", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5ce9efd7f55c8708006f6af9d67e882dfc310c37"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/27588dd7a193ab03b1c233af2eae3e27e22addf5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/27588dd7a193ab03b1c233af2eae3e27e22addf5", "html_url": "https://github.com/rust-lang/rust/commit/27588dd7a193ab03b1c233af2eae3e27e22addf5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/27588dd7a193ab03b1c233af2eae3e27e22addf5/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c772948b687488a087356cb91432425662e034b9", "url": "https://api.github.com/repos/rust-lang/rust/commits/c772948b687488a087356cb91432425662e034b9", "html_url": "https://github.com/rust-lang/rust/commit/c772948b687488a087356cb91432425662e034b9"}], "stats": {"total": 34, "additions": 19, "deletions": 15}, "files": [{"sha": "121012a56008ac1951229446aec1ef6b6a81acc8", "filename": "configure", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/27588dd7a193ab03b1c233af2eae3e27e22addf5/configure", "raw_url": "https://github.com/rust-lang/rust/raw/27588dd7a193ab03b1c233af2eae3e27e22addf5/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=27588dd7a193ab03b1c233af2eae3e27e22addf5", "patch": "@@ -637,7 +637,6 @@ valopt datadir \"${CFG_PREFIX}/share\" \"install data\"\n valopt infodir \"${CFG_PREFIX}/share/info\" \"install additional info\"\n valopt llvm-root \"\" \"set LLVM root\"\n valopt python \"\" \"set path to python\"\n-valopt nodejs \"\" \"set path to nodejs\"\n valopt jemalloc-root \"\" \"set directory where libjemalloc_pic.a is located\"\n valopt build \"${DEFAULT_BUILD}\" \"GNUs ./configure syntax LLVM build triple\"\n valopt android-cross-path \"\" \"Android NDK standalone path (deprecated)\"\n@@ -754,9 +753,6 @@ if [ $(echo $python_version | grep -c '^Python 2\\.7') -ne 1 ]; then\n     err \"Found $python_version, but Python 2.7 is required\"\n fi\n \n-# Checking for node, but not required\n-probe CFG_NODEJS nodejs node\n-\n # If we have no git directory then we are probably a tarball distribution\n # and shouldn't attempt to load submodules\n if [ ! -e ${CFG_SRC_DIR}.git ]"}, {"sha": "a8434c3efb3589d256639129fe0d605a2796fab9", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/27588dd7a193ab03b1c233af2eae3e27e22addf5/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/27588dd7a193ab03b1c233af2eae3e27e22addf5/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=27588dd7a193ab03b1c233af2eae3e27e22addf5", "patch": "@@ -396,9 +396,6 @@ impl Config {\n                     self.rustc = Some(PathBuf::from(value).join(\"bin/rustc\"));\n                     self.cargo = Some(PathBuf::from(value).join(\"bin/cargo\"));\n                 }\n-                \"CFG_NODEJS\" if value.len() > 0 => {\n-                    self.nodejs = Some(PathBuf::from(value));\n-                }\n                 _ => {}\n             }\n         }"}, {"sha": "962d0666f69f192f8fbb8a37a54fb7ee40ccad92", "filename": "src/bootstrap/sanity.rs", "status": "modified", "additions": 19, "deletions": 8, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/27588dd7a193ab03b1c233af2eae3e27e22addf5/src%2Fbootstrap%2Fsanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/27588dd7a193ab03b1c233af2eae3e27e22addf5/src%2Fbootstrap%2Fsanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fsanity.rs?ref=27588dd7a193ab03b1c233af2eae3e27e22addf5", "patch": "@@ -40,17 +40,23 @@ pub fn check(build: &mut Build) {\n             panic!(\"PATH contains invalid character '\\\"'\");\n         }\n     }\n-    let mut need_cmd = |cmd: &OsStr| {\n-        if !checked.insert(cmd.to_owned()) {\n-            return\n-        }\n+    let have_cmd = |cmd: &OsStr| {\n         for path in env::split_paths(&path).map(|p| p.join(cmd)) {\n             if fs::metadata(&path).is_ok() ||\n                fs::metadata(path.with_extension(\"exe\")).is_ok() {\n-                return\n+                return Some(path);\n             }\n         }\n-        panic!(\"\\n\\ncouldn't find required command: {:?}\\n\\n\", cmd);\n+        return None;\n+    };\n+\n+    let mut need_cmd = |cmd: &OsStr| {\n+        if !checked.insert(cmd.to_owned()) {\n+            return\n+        }\n+        if have_cmd(cmd).is_none() {\n+            panic!(\"\\n\\ncouldn't find required command: {:?}\\n\\n\", cmd);\n+        }\n     };\n \n     // If we've got a git directory we're gona need git to update\n@@ -75,8 +81,13 @@ pub fn check(build: &mut Build) {\n \n     need_cmd(\"python\".as_ref());\n \n-    // If a manual nodejs was added to the config,\n-    // of if a nodejs install is detected through config, use it.\n+    // Look for the nodejs command, needed for emscripten testing\n+    if let Some(node) = have_cmd(\"node\".as_ref()) {\n+        build.config.nodejs = Some(node);\n+    } else if let Some(node) = have_cmd(\"nodejs\".as_ref()) {\n+        build.config.nodejs = Some(node);\n+    }\n+\n     if let Some(ref s) = build.config.nodejs {\n         need_cmd(s.as_ref());\n     }"}]}