{"sha": "a8a7fa834726eb763fe872b02db821f99098a498", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE4YTdmYTgzNDcyNmViNzYzZmU4NzJiMDJkYjgyMWY5OTA5OGE0OTg=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-03-14T10:50:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-14T10:50:59Z"}, "message": "Merge #8011\n\n8011: Add no-sysroot flag for analysis-stats r=edwin0cheng a=edwin0cheng\n\nAdd `no-sysroot` flag for `rust-analyzer analysis-stats`. It is very useful for debugging propose. \r\n\r\nbors r+\n\nCo-authored-by: Edwin Cheng <edwin0cheng@gmail.com>", "tree": {"sha": "460dc2884d6f644762aee55bc191a4707b977f82", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/460dc2884d6f644762aee55bc191a4707b977f82"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a8a7fa834726eb763fe872b02db821f99098a498", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgTeqUCRBK7hj4Ov3rIwAAdHIIAG89LhuNLYEMrplNpDR/HwE9\n+usDlVsKia6mMj4eWPVAjVEawIZg6Mko4WfnZrmY90U9d+fKC1CcybU+dZ5//HOI\niQJpYqWSo8+UzdkSl/WfDoowHwajTAD5UUpiJA8Gap54fgqsxFp6WCL++MzSvpZk\nMLcSoCryUXs3IshhijaT86nUGG3v9AzaorDnjKKBrzU8NQ2MtldvUK1uXLzXx2lo\nBEmE0d2LhOc10YtJBomivRXjNL3EH1oD22iKMgI4a329OjTninC+oKDuC7wDmPrP\nCi2gayh512NykS3bJGLnvIeFKkjZML76E+c/Cp9F3BpSfiZyrg+n7QypPmesACM=\n=sBHj\n-----END PGP SIGNATURE-----\n", "payload": "tree 460dc2884d6f644762aee55bc191a4707b977f82\nparent 48adf6b697a0103307e3f5fca7aa60a80bf73776\nparent 8cc0c7f420d7d59a4fd162d893eaad54aa4b7f22\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1615719059 +0000\ncommitter GitHub <noreply@github.com> 1615719059 +0000\n\nMerge #8011\n\n8011: Add no-sysroot flag for analysis-stats r=edwin0cheng a=edwin0cheng\n\nAdd `no-sysroot` flag for `rust-analyzer analysis-stats`. It is very useful for debugging propose. \r\n\r\nbors r+\n\nCo-authored-by: Edwin Cheng <edwin0cheng@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a8a7fa834726eb763fe872b02db821f99098a498", "html_url": "https://github.com/rust-lang/rust/commit/a8a7fa834726eb763fe872b02db821f99098a498", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a8a7fa834726eb763fe872b02db821f99098a498/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "48adf6b697a0103307e3f5fca7aa60a80bf73776", "url": "https://api.github.com/repos/rust-lang/rust/commits/48adf6b697a0103307e3f5fca7aa60a80bf73776", "html_url": "https://github.com/rust-lang/rust/commit/48adf6b697a0103307e3f5fca7aa60a80bf73776"}, {"sha": "8cc0c7f420d7d59a4fd162d893eaad54aa4b7f22", "url": "https://api.github.com/repos/rust-lang/rust/commits/8cc0c7f420d7d59a4fd162d893eaad54aa4b7f22", "html_url": "https://github.com/rust-lang/rust/commit/8cc0c7f420d7d59a4fd162d893eaad54aa4b7f22"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "d8987633d12b0c0313bfc6205cce9650db311e54", "filename": "crates/rust-analyzer/src/bin/flags.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/a8a7fa834726eb763fe872b02db821f99098a498/crates%2Frust-analyzer%2Fsrc%2Fbin%2Fflags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a8a7fa834726eb763fe872b02db821f99098a498/crates%2Frust-analyzer%2Fsrc%2Fbin%2Fflags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fbin%2Fflags.rs?ref=a8a7fa834726eb763fe872b02db821f99098a498", "patch": "@@ -65,6 +65,8 @@ xflags::xflags! {\n             optional -o, --only path: String\n             /// Also analyze all dependencies.\n             optional --with-deps\n+            /// Don't load sysroot crates (`std`, `core` & friends).\n+            optional --no-sysroot\n \n             /// Load OUT_DIR values by running `cargo check` before analysis.\n             optional --load-output-dirs\n@@ -176,6 +178,7 @@ pub struct AnalysisStats {\n     pub memory_usage: bool,\n     pub only: Option<String>,\n     pub with_deps: bool,\n+    pub no_sysroot: bool,\n     pub load_output_dirs: bool,\n     pub with_proc_macro: bool,\n }"}, {"sha": "a0b611bffcffa6e59ef6762c6371aad5bc396417", "filename": "crates/rust-analyzer/src/bin/main.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a8a7fa834726eb763fe872b02db821f99098a498/crates%2Frust-analyzer%2Fsrc%2Fbin%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a8a7fa834726eb763fe872b02db821f99098a498/crates%2Frust-analyzer%2Fsrc%2Fbin%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fbin%2Fmain.rs?ref=a8a7fa834726eb763fe872b02db821f99098a498", "patch": "@@ -74,6 +74,7 @@ fn try_main() -> Result<()> {\n             memory_usage: cmd.memory_usage,\n             only: cmd.only,\n             with_deps: cmd.with_deps,\n+            no_sysroot: cmd.no_sysroot,\n             path: cmd.path,\n             load_output_dirs: cmd.load_output_dirs,\n             with_proc_macro: cmd.with_proc_macro,"}, {"sha": "9c59e7ee44771e3170c5a4c94d96dbca3f9fa171", "filename": "crates/rust-analyzer/src/cli/analysis_stats.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a8a7fa834726eb763fe872b02db821f99098a498/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fanalysis_stats.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a8a7fa834726eb763fe872b02db821f99098a498/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fanalysis_stats.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fcli%2Fanalysis_stats.rs?ref=a8a7fa834726eb763fe872b02db821f99098a498", "patch": "@@ -19,6 +19,7 @@ use ide_db::base_db::{\n };\n use itertools::Itertools;\n use oorandom::Rand32;\n+use project_model::CargoConfig;\n use rayon::prelude::*;\n use rustc_hash::FxHashSet;\n use stdx::format_to;\n@@ -46,6 +47,7 @@ pub struct AnalysisStatsCmd {\n     pub memory_usage: bool,\n     pub only: Option<String>,\n     pub with_deps: bool,\n+    pub no_sysroot: bool,\n     pub path: PathBuf,\n     pub load_output_dirs: bool,\n     pub with_proc_macro: bool,\n@@ -59,7 +61,8 @@ impl AnalysisStatsCmd {\n         };\n \n         let mut db_load_sw = self.stop_watch();\n-        let cargo_config = Default::default();\n+        let mut cargo_config = CargoConfig::default();\n+        cargo_config.no_sysroot = self.no_sysroot;\n         let load_cargo_config = LoadCargoConfig {\n             load_out_dirs_from_check: self.load_output_dirs,\n             with_proc_macro: self.with_proc_macro,"}]}