{"sha": "e563359396928453db81141bf12dae04a567f2e9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU1NjMzNTkzOTY5Mjg0NTNkYjgxMTQxYmYxMmRhZTA0YTU2N2YyZTk=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2016-04-15T19:46:45Z"}, "committer": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2016-04-15T19:48:14Z"}, "message": "Rollup merge of #32997 - alexcrichton:fix-alloc-system-how-did-this-land, r=nagisa\n\nalloc_system: Handle failure properly\n\nThe Unix implementation was incorrectly handling failure for reallocation of\nover-aligned types by not checking for NULL.\n\nCloses #32993", "tree": {"sha": "1ed06a5b72b212d39c38d2607f9631bb466c17b1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1ed06a5b72b212d39c38d2607f9631bb466c17b1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e563359396928453db81141bf12dae04a567f2e9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJXEUV+AAoJEDu/TT4u95+YbocP/1KWmqJwhxvY2FvDOQY5CK4E\npvEQkSGCdPvGEgy6WDcL3xUV5zSuoOxhPyL9bmNr+ESC1TZ5Oa85ZbuLAHK6vjKi\niGpBHxeR9yGCm5qA7xLx4jiNY3TDpq5USfSx8dsBATfepFngM8rdo/9Y8aww4vks\nZuI3MrFBd2s8ccLExq4f8Lla13RO8XlpdN4nelb5rRt8vqncxMPgqj4GwDbqyL75\n5JNga9RrDYoLfx0xZYyPv1684fYSQsXQbs2cIq7GCQhCwVDgBcSzyhPutlua8uWW\nVKIUExBv2QMi64GhaiK9aZMKkwOS5VAQKeWdStyLIXeoo9qnSdgTVjARo/F/flHw\nBlcXAdK9Vec2IH89xBcee/b9cEdesBIp7il4Kw8o434XzIz3dxGjTLNDPPnxnGxj\nOEbWu/Puo1asvhnxFB/HrwIbGKazIufpde/E1BKBUfeVipGXcmymxa5o3jep+Kiv\nFNCUGwCyEkveeLQnqCY0Mxr2Fq5CHl802xiK0M7utYzNt9GxaEk4VUkt+p8Oto06\n4HXGzD2FyEVq/OwfjiprmiL7MqMzyFh5/Zi/fBpmyKjqoBETwWB8vZ4SzGnmoF3L\nY22h+4wk4XyNukM9SCrvYpnOgD+Z9OE07DoOUh30/Y4cX85BntoDaP213z5vyMk7\nO62xjQbDRt2aQexdiPWG\n=XjMA\n-----END PGP SIGNATURE-----", "payload": "tree 1ed06a5b72b212d39c38d2607f9631bb466c17b1\nparent eba80558d7223900549786207fad4791e1f01d88\nparent 99c05478542c6624d537f587ce34f84d09fd0627\nauthor Manish Goregaokar <manishsmail@gmail.com> 1460749605 +0530\ncommitter Manish Goregaokar <manishsmail@gmail.com> 1460749694 +0530\n\nRollup merge of #32997 - alexcrichton:fix-alloc-system-how-did-this-land, r=nagisa\n\nalloc_system: Handle failure properly\n\nThe Unix implementation was incorrectly handling failure for reallocation of\nover-aligned types by not checking for NULL.\n\nCloses #32993\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e563359396928453db81141bf12dae04a567f2e9", "html_url": "https://github.com/rust-lang/rust/commit/e563359396928453db81141bf12dae04a567f2e9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e563359396928453db81141bf12dae04a567f2e9/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eba80558d7223900549786207fad4791e1f01d88", "url": "https://api.github.com/repos/rust-lang/rust/commits/eba80558d7223900549786207fad4791e1f01d88", "html_url": "https://github.com/rust-lang/rust/commit/eba80558d7223900549786207fad4791e1f01d88"}, {"sha": "99c05478542c6624d537f587ce34f84d09fd0627", "url": "https://api.github.com/repos/rust-lang/rust/commits/99c05478542c6624d537f587ce34f84d09fd0627", "html_url": "https://github.com/rust-lang/rust/commit/99c05478542c6624d537f587ce34f84d09fd0627"}], "stats": {"total": 6, "additions": 4, "deletions": 2}, "files": [{"sha": "ca4c9bfd9544cbde5b57c512818b1df19b140f4e", "filename": "src/liballoc_system/lib.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e563359396928453db81141bf12dae04a567f2e9/src%2Fliballoc_system%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e563359396928453db81141bf12dae04a567f2e9/src%2Fliballoc_system%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc_system%2Flib.rs?ref=e563359396928453db81141bf12dae04a567f2e9", "patch": "@@ -96,8 +96,10 @@ mod imp {\n             libc::realloc(ptr as *mut libc::c_void, size as libc::size_t) as *mut u8\n         } else {\n             let new_ptr = allocate(size, align);\n-            ptr::copy(ptr, new_ptr, cmp::min(size, old_size));\n-            deallocate(ptr, old_size, align);\n+            if !new_ptr.is_null() {\n+                ptr::copy(ptr, new_ptr, cmp::min(size, old_size));\n+                deallocate(ptr, old_size, align);\n+            }\n             new_ptr\n         }\n     }"}]}