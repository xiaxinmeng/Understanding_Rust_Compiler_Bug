{"sha": "b1e856ad43d9044349987dc692652f90ec075d7d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIxZTg1NmFkNDNkOTA0NDM0OTk4N2RjNjkyNjUyZjkwZWMwNzVkN2Q=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-10-08T21:23:12Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-10-08T21:23:12Z"}, "message": "Rollup merge of #77663 - HeroicKatora:regression-tests-27675-object-safe, r=Aaron1011\n\nAdd compile fail test for issue 27675\n\nA recently merged PR (#73905) strengthened the checks on bounds of associated items. This rejects the attack path of #27675 which consisted of constructing a `dyn Trait<Item=T>` where `T` would not fulfill the bounds required on `Item` of the `Trait` behind the dyn object.\n\nThis regression test, extracted from [the weaponized instance](https://github.com/rust-lang/rust/issues/27675#issuecomment-696956878), checks that this is rejected.", "tree": {"sha": "88c8d272f6e10ac4ab5c8da19b998d7c187cba13", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/88c8d272f6e10ac4ab5c8da19b998d7c187cba13"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b1e856ad43d9044349987dc692652f90ec075d7d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJff4NACRBK7hj4Ov3rIwAAdHIIAGx25QnHhXy7CxmFWd4tIUzU\n/ZmtAe+K6Z/JfwKNWBOVBaQc8oA41m+753uTJFpx4WS5EdjTbuAw/J3///7qRzfS\nsJ2NoiWcujxLLh/wHZ3kdIxomNJTqvHmFK9Wv1mGSGisW3jHEWoF/7YSIwwGrC8y\nYrqpwdHqBt6GFSdcFvBqaaAOZ6vR6Agfk0L4DWUXDgouIcxoDrfHjcLNP8MlJiG3\nVTGFXs+6V+8oHyrNvNSHj5zT26ooJem1jplwj5/nA/lp6RWXkc+ODRySDUpI0SpG\nwOanjyGSW2KIOiNAQaZ81E9gdFL1y/kigUxZmmgSkwbSMG+fONnDxe5VQ19eKnY=\n=rxix\n-----END PGP SIGNATURE-----\n", "payload": "tree 88c8d272f6e10ac4ab5c8da19b998d7c187cba13\nparent 7edb7e7ec00df6793ea9d231b3b40f6b680a0bcd\nparent ea206f2c5af8597771347ecc95e76c258b710181\nauthor Jonas Schievink <jonasschievink@gmail.com> 1602192192 +0200\ncommitter GitHub <noreply@github.com> 1602192192 +0200\n\nRollup merge of #77663 - HeroicKatora:regression-tests-27675-object-safe, r=Aaron1011\n\nAdd compile fail test for issue 27675\n\nA recently merged PR (#73905) strengthened the checks on bounds of associated items. This rejects the attack path of #27675 which consisted of constructing a `dyn Trait<Item=T>` where `T` would not fulfill the bounds required on `Item` of the `Trait` behind the dyn object.\n\nThis regression test, extracted from [the weaponized instance](https://github.com/rust-lang/rust/issues/27675#issuecomment-696956878), checks that this is rejected.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b1e856ad43d9044349987dc692652f90ec075d7d", "html_url": "https://github.com/rust-lang/rust/commit/b1e856ad43d9044349987dc692652f90ec075d7d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b1e856ad43d9044349987dc692652f90ec075d7d/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7edb7e7ec00df6793ea9d231b3b40f6b680a0bcd", "url": "https://api.github.com/repos/rust-lang/rust/commits/7edb7e7ec00df6793ea9d231b3b40f6b680a0bcd", "html_url": "https://github.com/rust-lang/rust/commit/7edb7e7ec00df6793ea9d231b3b40f6b680a0bcd"}, {"sha": "ea206f2c5af8597771347ecc95e76c258b710181", "url": "https://api.github.com/repos/rust-lang/rust/commits/ea206f2c5af8597771347ecc95e76c258b710181", "html_url": "https://github.com/rust-lang/rust/commit/ea206f2c5af8597771347ecc95e76c258b710181"}], "stats": {"total": 19, "additions": 19, "deletions": 0}, "files": [{"sha": "1cfc230453120a7ea7e790e6612565c8e9dc5346", "filename": "src/test/compile-fail/issue-27675-unchecked-bounds.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/b1e856ad43d9044349987dc692652f90ec075d7d/src%2Ftest%2Fcompile-fail%2Fissue-27675-unchecked-bounds.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b1e856ad43d9044349987dc692652f90ec075d7d/src%2Ftest%2Fcompile-fail%2Fissue-27675-unchecked-bounds.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-27675-unchecked-bounds.rs?ref=b1e856ad43d9044349987dc692652f90ec075d7d", "patch": "@@ -0,0 +1,19 @@\n+/// The compiler previously did not properly check the bound of `From` when it was used from type\n+/// of the dyn trait object (use in `copy_any` below). Since the associated type is under user\n+/// control in this usage, the compiler could be tricked to believe any type implemented any trait.\n+/// This would ICE, except for pure marker traits like `Copy`. It did not require providing an\n+/// instance of the dyn trait type, only name said type.\n+trait Setup {\n+    type From: Copy;\n+}\n+\n+fn copy<U: Setup + ?Sized>(from: &U::From) -> U::From {\n+    *from\n+}\n+\n+pub fn copy_any<T>(t: &T) -> T {\n+    copy::<dyn Setup<From=T>>(t)\n+    //~^ ERROR the trait bound `T: Copy` is not satisfied\n+}\n+\n+fn main() {}"}]}