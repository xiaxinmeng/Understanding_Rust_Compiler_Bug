{"sha": "5eea93af39df1b9b64cace3c3afc78671a71ff8c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVlZWE5M2FmMzlkZjFiOWI2NGNhY2UzYzNhZmM3ODY3MWE3MWZmOGM=", "commit": {"author": {"name": "Robert Gawdzik \u2622", "email": "rgawdzik@hotmail.com", "date": "2014-08-26T07:42:58Z"}, "committer": {"name": "Robert Gawdzik \u2622", "email": "robertgawdzik@gmail.com", "date": "2014-09-05T18:59:39Z"}, "message": "Fixes type range issue during linting (#16684)\n\n - Ensures the propagated negation sign is properly utilized during type\n   checking.\n - Removed redundant type checking, specifically regarding the out of bounds checking\n   on a bounded type.\n - Closes #16684", "tree": {"sha": "00625b10c4a6de214ba2f4710b79989caf483eb9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/00625b10c4a6de214ba2f4710b79989caf483eb9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5eea93af39df1b9b64cace3c3afc78671a71ff8c", "comment_count": 4, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5eea93af39df1b9b64cace3c3afc78671a71ff8c", "html_url": "https://github.com/rust-lang/rust/commit/5eea93af39df1b9b64cace3c3afc78671a71ff8c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5eea93af39df1b9b64cace3c3afc78671a71ff8c/comments", "author": null, "committer": {"login": "robertg", "id": 2405472, "node_id": "MDQ6VXNlcjI0MDU0NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/2405472?v=4", "gravatar_id": "", "url": "https://api.github.com/users/robertg", "html_url": "https://github.com/robertg", "followers_url": "https://api.github.com/users/robertg/followers", "following_url": "https://api.github.com/users/robertg/following{/other_user}", "gists_url": "https://api.github.com/users/robertg/gists{/gist_id}", "starred_url": "https://api.github.com/users/robertg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/robertg/subscriptions", "organizations_url": "https://api.github.com/users/robertg/orgs", "repos_url": "https://api.github.com/users/robertg/repos", "events_url": "https://api.github.com/users/robertg/events{/privacy}", "received_events_url": "https://api.github.com/users/robertg/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e024017f60c93b6ff4f37bd4bd580f30deafb107", "url": "https://api.github.com/repos/rust-lang/rust/commits/e024017f60c93b6ff4f37bd4bd580f30deafb107", "html_url": "https://github.com/rust-lang/rust/commit/e024017f60c93b6ff4f37bd4bd580f30deafb107"}], "stats": {"total": 28, "additions": 10, "deletions": 18}, "files": [{"sha": "af0145edff907cc0a9f824facd3e07ff302a5e59", "filename": "src/librustc/lint/builtin.rs", "status": "modified", "additions": 9, "deletions": 18, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/5eea93af39df1b9b64cace3c3afc78671a71ff8c/src%2Flibrustc%2Flint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5eea93af39df1b9b64cace3c3afc78671a71ff8c/src%2Flibrustc%2Flint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fbuiltin.rs?ref=5eea93af39df1b9b64cace3c3afc78671a71ff8c", "patch": "@@ -172,33 +172,24 @@ impl LintPass for TypeLimits {\n             ast::ExprLit(lit) => {\n                 match ty::get(ty::expr_ty(cx.tcx, e)).sty {\n                     ty::ty_int(t) => {\n-                        let int_type = if t == ast::TyI {\n-                            cx.sess().targ_cfg.int_type\n-                        } else { t };\n-                        let (min, max) = int_ty_range(int_type);\n-                        let mut lit_val: i64 = match lit.node {\n+                        match lit.node {\n                             ast::LitInt(v, ast::SignedIntLit(_, ast::Plus)) |\n                             ast::LitInt(v, ast::UnsuffixedIntLit(ast::Plus)) => {\n-                                if v > i64::MAX as u64{\n+                                let int_type = if t == ast::TyI {\n+                                    cx.sess().targ_cfg.int_type\n+                                } else { t };\n+                                let (min, max) = int_ty_range(int_type);\n+                                let negative = self.negated_expr_id == e.id;\n+\n+                                if (negative && v > (min.abs() as u64)) ||\n+                                   (!negative && v > (max.abs() as u64)) {\n                                     cx.span_lint(TYPE_OVERFLOW, e.span,\n                                                  \"literal out of range for its type\");\n                                     return;\n                                 }\n-                                v as i64\n-                            }\n-                            ast::LitInt(v, ast::SignedIntLit(_, ast::Minus)) |\n-                            ast::LitInt(v, ast::UnsuffixedIntLit(ast::Minus)) => {\n-                                -(v as i64)\n                             }\n                             _ => fail!()\n                         };\n-                        if self.negated_expr_id == e.id {\n-                            lit_val *= -1;\n-                        }\n-                        if lit_val < min || lit_val > max {\n-                            cx.span_lint(TYPE_OVERFLOW, e.span,\n-                                         \"literal out of range for its type\");\n-                        }\n                     },\n                     ty::ty_uint(t) => {\n                         let uint_type = if t == ast::TyU {"}, {"sha": "81b186a2998a83c00be2bdcf17af837ee44c074e", "filename": "src/test/compile-fail/lint-type-overflow.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5eea93af39df1b9b64cace3c3afc78671a71ff8c/src%2Ftest%2Fcompile-fail%2Flint-type-overflow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5eea93af39df1b9b64cace3c3afc78671a71ff8c/src%2Ftest%2Fcompile-fail%2Flint-type-overflow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-type-overflow.rs?ref=5eea93af39df1b9b64cace3c3afc78671a71ff8c", "patch": "@@ -49,6 +49,7 @@ fn main() {\n     let x = -2147483649_i32; //~ error: literal out of range for its type\n \n     let x = 9223372036854775808_i64; //~ error: literal out of range for its type\n+    let x = -9223372036854775808_i64; // should be OK\n     let x = 18446744073709551615_i64; //~ error: literal out of range for its type\n \n     let x = -3.40282348e+38_f32; //~ error: literal out of range for its type"}]}