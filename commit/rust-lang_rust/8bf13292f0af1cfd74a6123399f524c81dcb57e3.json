{"sha": "8bf13292f0af1cfd74a6123399f524c81dcb57e3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhiZjEzMjkyZjBhZjFjZmQ3NGE2MTIzMzk5ZjUyNGM4MWRjYjU3ZTM=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-10-06T13:28:03Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-10-06T13:28:03Z"}, "message": "Merge #6148\n\n6148: Fix trait object hir formatting behind pointer and references r=matklad a=Veykril\n\nFixes #6064\n\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>", "tree": {"sha": "e67eb1208af99849f5e58f093ea5af337caf8ad9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e67eb1208af99849f5e58f093ea5af337caf8ad9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8bf13292f0af1cfd74a6123399f524c81dcb57e3", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJffHDjCRBK7hj4Ov3rIwAAdHIIAG0+m/JdqYXUV/F7aLszHXlF\nzUcmjnnSw3zDWi83Y9zpVaUm/R04VIaErNGYkHQ1adOnrSQzVFRDwrqILorACk8+\nG84ddjU4Udrbvbe2+nN+cRlZ/3S2AronMHFbeQ1SITvIYKBs3yTFlyOyWJOIA+HC\nBStSfZmR13MLJ/f4aDY7zfhgl4Uak8syDA2BuXI5Xorf/xXXWyekAAvl3l3bbBoL\nxF3C6Oq+Pm9a8aXY66D7IaG7H6+8/sX6P3D4XKv+hyElh5KtqJ6VIOZZzDmZg+dg\nvV0aBZjLd+U6g67ZcZaIR5cCfvt9LRg3u5sP5HSEcIk0Tb1C6tr7x11uwCluqFw=\n=a8BI\n-----END PGP SIGNATURE-----\n", "payload": "tree e67eb1208af99849f5e58f093ea5af337caf8ad9\nparent 9507a01e9e76afca9f6f8d460089fc199703b820\nparent 643bbf15a2a76e7241156249261bf0d060deecd4\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1601990883 +0000\ncommitter GitHub <noreply@github.com> 1601990883 +0000\n\nMerge #6148\n\n6148: Fix trait object hir formatting behind pointer and references r=matklad a=Veykril\n\nFixes #6064\n\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8bf13292f0af1cfd74a6123399f524c81dcb57e3", "html_url": "https://github.com/rust-lang/rust/commit/8bf13292f0af1cfd74a6123399f524c81dcb57e3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8bf13292f0af1cfd74a6123399f524c81dcb57e3/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9507a01e9e76afca9f6f8d460089fc199703b820", "url": "https://api.github.com/repos/rust-lang/rust/commits/9507a01e9e76afca9f6f8d460089fc199703b820", "html_url": "https://github.com/rust-lang/rust/commit/9507a01e9e76afca9f6f8d460089fc199703b820"}, {"sha": "643bbf15a2a76e7241156249261bf0d060deecd4", "url": "https://api.github.com/repos/rust-lang/rust/commits/643bbf15a2a76e7241156249261bf0d060deecd4", "html_url": "https://github.com/rust-lang/rust/commit/643bbf15a2a76e7241156249261bf0d060deecd4"}], "stats": {"total": 63, "additions": 57, "deletions": 6}, "files": [{"sha": "d2e151f25247ec8684fe8ccaafce6487f7d10706", "filename": "crates/hir_ty/src/display.rs", "status": "modified", "additions": 23, "deletions": 6, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/8bf13292f0af1cfd74a6123399f524c81dcb57e3/crates%2Fhir_ty%2Fsrc%2Fdisplay.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8bf13292f0af1cfd74a6123399f524c81dcb57e3/crates%2Fhir_ty%2Fsrc%2Fdisplay.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Fdisplay.rs?ref=8bf13292f0af1cfd74a6123399f524c81dcb57e3", "patch": "@@ -221,7 +221,16 @@ impl HirDisplay for ApplicationTy {\n             }\n             TypeCtor::RawPtr(m) => {\n                 let t = self.parameters.as_single();\n-                write!(f, \"*{}{}\", m.as_keyword_for_ptr(), t.display(f.db))?;\n+                let ty_display = t.display(f.db);\n+\n+                write!(f, \"*{}\", m.as_keyword_for_ptr())?;\n+                if matches!(t, Ty::Dyn(predicates) if predicates.len() > 1) {\n+                    write!(f, \"(\")?;\n+                    write!(f, \"{}\", ty_display)?;\n+                    write!(f, \")\")?;\n+                } else {\n+                    write!(f, \"{}\", ty_display)?;\n+                }\n             }\n             TypeCtor::Ref(m) => {\n                 let t = self.parameters.as_single();\n@@ -230,7 +239,15 @@ impl HirDisplay for ApplicationTy {\n                 } else {\n                     t.display(f.db)\n                 };\n-                write!(f, \"&{}{}\", m.as_keyword_for_ref(), ty_display)?;\n+\n+                write!(f, \"&{}\", m.as_keyword_for_ref())?;\n+                if matches!(t, Ty::Dyn(predicates) if predicates.len() > 1) {\n+                    write!(f, \"(\")?;\n+                    write!(f, \"{}\", ty_display)?;\n+                    write!(f, \")\")?;\n+                } else {\n+                    write!(f, \"{}\", ty_display)?;\n+                }\n             }\n             TypeCtor::Never => write!(f, \"!\")?,\n             TypeCtor::Tuple { .. } => {\n@@ -636,14 +653,14 @@ impl HirDisplay for GenericPredicate {\n \n impl HirDisplay for Obligation {\n     fn hir_fmt(&self, f: &mut HirFormatter) -> Result<(), HirDisplayError> {\n-        Ok(match self {\n-            Obligation::Trait(tr) => write!(f, \"Implements({})\", tr.display(f.db))?,\n+        match self {\n+            Obligation::Trait(tr) => write!(f, \"Implements({})\", tr.display(f.db)),\n             Obligation::Projection(proj) => write!(\n                 f,\n                 \"Normalize({} => {})\",\n                 proj.projection_ty.display(f.db),\n                 proj.ty.display(f.db)\n-            )?,\n-        })\n+            ),\n+        }\n     }\n }"}, {"sha": "3a4dc6a841c52c1974d37f4cd2e1cb912bf70d53", "filename": "crates/ide/src/inlay_hints.rs", "status": "modified", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/8bf13292f0af1cfd74a6123399f524c81dcb57e3/crates%2Fide%2Fsrc%2Finlay_hints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8bf13292f0af1cfd74a6123399f524c81dcb57e3/crates%2Fide%2Fsrc%2Finlay_hints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints.rs?ref=8bf13292f0af1cfd74a6123399f524c81dcb57e3", "patch": "@@ -1023,6 +1023,40 @@ mod collections {\n         type Item=T;\n     }\n }\n+\"#,\n+        );\n+    }\n+\n+    #[test]\n+    fn multi_dyn_trait_bounds() {\n+        check_with_config(\n+            InlayHintsConfig {\n+                type_hints: true,\n+                parameter_hints: false,\n+                chaining_hints: false,\n+                max_length: None,\n+            },\n+            r#\"\n+//- /main.rs crate:main\n+pub struct Vec<T> {}\n+\n+impl<T> Vec<T> {\n+    pub fn new() -> Self { Vec {} }\n+}\n+\n+pub struct Box<T> {}\n+\n+trait Display {}\n+trait Sync {}\n+\n+fn main() {\n+    let _v = Vec::<Box<&(dyn Display + Sync)>>::new();\n+      //^^ Vec<Box<&(dyn Display + Sync)>>\n+    let _v = Vec::<Box<*const (dyn Display + Sync)>>::new();\n+      //^^ Vec<Box<*const (dyn Display + Sync)>>\n+    let _v = Vec::<Box<dyn Display + Sync>>::new();\n+      //^^ Vec<Box<dyn Display + Sync>>\n+}\n \"#,\n         );\n     }"}]}