{"sha": "61972e733df048b8ecda2b4fe1db6fec84ca418a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYxOTcyZTczM2RmMDQ4YjhlY2RhMmI0ZmUxZGI2ZmVjODRjYTQxOGE=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-01-31T18:29:38Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-01-31T18:29:38Z"}, "message": "Rollup merge of #47893 - alexcrichton:move-codegen-backends, r=alexcrichton\n\nrustc: Move location of `codegen-backends` dir\n\nRight now this directory is located under:\n\n```\n$sysroot/lib/rustlib/$target/lib/codegen-backends\n```\n\nbut after seeing what we do in a few other places it seems that a more\nappropriate location would be:\n\n```\n$sysroot/lib/rustlib/$target/codegen-backends\n```\n\nso this commit moves it!", "tree": {"sha": "f696d7efcec889250c0757c95c7e2a11473423a6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f696d7efcec889250c0757c95c7e2a11473423a6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/61972e733df048b8ecda2b4fe1db6fec84ca418a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlpyCzYACgkQ/vbIBR0O\nATxpiBAAxdXq9fIpA9gN1g6baRMFUjTFQGqDhTdWZ1DSgZ8h4Pc7wlSoNmO3YEpB\nRtbEJa4FO4hoPEIz6IKr1jYZ1knFOT4Mn5RSjvuPLhwkes0/KYXfWpbTosPScDZJ\n8xEHLZE0la4GSr5i4yVJNGXqNR1VmqLdca0W8rzbTcgr9H9YJXpE3zh1BX+2BMkw\nUOC4XBMQb0/qrq6mYcQmteNGcXbWAG3Q7PX0JAMWjyPHBjaQYFX42aCLEy1Bp+q+\negnGVVSz7FARENoY3gwYm91HnrhHEIQpczrhU+7iAW8b7TKYYQRPOL0U0GJ3TI42\nRhhEJTY/M7Je0oyWnuBr30/pvV15b+CQnsPs1NnXDPM3grC7y3y+t8SV+dVQBs+Y\nT+Iz6pwucGEAPoLXj13f0H0amkJxEq3XDQjqnO2B3xnNJv08xLJKMipqNfxeWdjD\nDYns5nLEMUa3qRu/z9QvBpwNAY9ub7mNdEM7650UQLt1d9xshP5CEr0k013Qi7I/\nOI7D+nofXZzRFEZCoDrpMMcMbtLCJAl/gh1AjY+H7FAhGZa5annhXDAuljjX0Zth\nHf/ymat2c5vWz/o8q7PdWPz2iVeEHKDQeCVj2uIx9RD/1HLoi3c4IOdiooXWevXi\nOCxlx4Rx61KSktmkGP6Ypzh9OxzrigvqZ0x4GohNVrP5UcG0yVU=\n=2hk9\n-----END PGP SIGNATURE-----", "payload": "tree f696d7efcec889250c0757c95c7e2a11473423a6\nparent 68135d1936f6c19529136d1de3515412a1056fb2\nparent 8ebe5424809a517a9e74984a32e79e0ff9d612f9\nauthor kennytm <kennytm@gmail.com> 1517423378 +0800\ncommitter kennytm <kennytm@gmail.com> 1517423378 +0800\n\nRollup merge of #47893 - alexcrichton:move-codegen-backends, r=alexcrichton\n\nrustc: Move location of `codegen-backends` dir\n\nRight now this directory is located under:\n\n```\n$sysroot/lib/rustlib/$target/lib/codegen-backends\n```\n\nbut after seeing what we do in a few other places it seems that a more\nappropriate location would be:\n\n```\n$sysroot/lib/rustlib/$target/codegen-backends\n```\n\nso this commit moves it!\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/61972e733df048b8ecda2b4fe1db6fec84ca418a", "html_url": "https://github.com/rust-lang/rust/commit/61972e733df048b8ecda2b4fe1db6fec84ca418a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/61972e733df048b8ecda2b4fe1db6fec84ca418a/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "68135d1936f6c19529136d1de3515412a1056fb2", "url": "https://api.github.com/repos/rust-lang/rust/commits/68135d1936f6c19529136d1de3515412a1056fb2", "html_url": "https://github.com/rust-lang/rust/commit/68135d1936f6c19529136d1de3515412a1056fb2"}, {"sha": "8ebe5424809a517a9e74984a32e79e0ff9d612f9", "url": "https://api.github.com/repos/rust-lang/rust/commits/8ebe5424809a517a9e74984a32e79e0ff9d612f9", "html_url": "https://github.com/rust-lang/rust/commit/8ebe5424809a517a9e74984a32e79e0ff9d612f9"}], "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "780513dd943946853c7085980219fd85c5778729", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/61972e733df048b8ecda2b4fe1db6fec84ca418a/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61972e733df048b8ecda2b4fe1db6fec84ca418a/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=61972e733df048b8ecda2b4fe1db6fec84ca418a", "patch": "@@ -377,6 +377,11 @@ impl<'a> Builder<'a> {\n         self.ensure(Libdir { compiler, target })\n     }\n \n+    pub fn sysroot_codegen_backends(&self, compiler: Compiler) -> PathBuf {\n+        self.sysroot_libdir(compiler, compiler.host)\n+            .with_file_name(\"codegen-backends\")\n+    }\n+\n     /// Returns the compiler's libdir where it stores the dynamic libraries that\n     /// it itself links against.\n     ///"}, {"sha": "1d5e11c5d6d41c06f55d088a82b6be93914928e1", "filename": "src/bootstrap/compile.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/61972e733df048b8ecda2b4fe1db6fec84ca418a/src%2Fbootstrap%2Fcompile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61972e733df048b8ecda2b4fe1db6fec84ca418a/src%2Fbootstrap%2Fcompile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcompile.rs?ref=61972e733df048b8ecda2b4fe1db6fec84ca418a", "patch": "@@ -724,8 +724,7 @@ fn copy_codegen_backends_to_sysroot(builder: &Builder,\n     //\n     // Here we're looking for the output dylib of the `CodegenBackend` step and\n     // we're copying that into the `codegen-backends` folder.\n-    let libdir = builder.sysroot_libdir(target_compiler, target);\n-    let dst = libdir.join(\"codegen-backends\");\n+    let dst = builder.sysroot_codegen_backends(target_compiler);\n     t!(fs::create_dir_all(&dst));\n \n     for backend in builder.config.rust_codegen_backends.iter() {"}, {"sha": "dbb7d19e43285089515cb0c0878214ccc7181b13", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/61972e733df048b8ecda2b4fe1db6fec84ca418a/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61972e733df048b8ecda2b4fe1db6fec84ca418a/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=61972e733df048b8ecda2b4fe1db6fec84ca418a", "patch": "@@ -435,11 +435,9 @@ impl Step for Rustc {\n             }\n \n             // Copy over the codegen backends\n-            let backends_src = builder.sysroot_libdir(compiler, host)\n-                .join(\"codegen-backends\");\n-            let backends_dst = image.join(\"lib/rustlib\")\n-                .join(&*host)\n-                .join(\"lib/codegen-backends\");\n+            let backends_src = builder.sysroot_codegen_backends(compiler);\n+            let backends_rel = backends_src.strip_prefix(&src).unwrap();\n+            let backends_dst = image.join(&backends_rel);\n             t!(fs::create_dir_all(&backends_dst));\n             cp_r(&backends_src, &backends_dst);\n "}, {"sha": "2bf91f79b2bbe6729c798c962eadd0a846612cc8", "filename": "src/librustc_driver/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/61972e733df048b8ecda2b4fe1db6fec84ca418a/src%2Flibrustc_driver%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/61972e733df048b8ecda2b4fe1db6fec84ca418a/src%2Flibrustc_driver%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Flib.rs?ref=61972e733df048b8ecda2b4fe1db6fec84ca418a", "patch": "@@ -289,7 +289,7 @@ fn get_trans_sysroot(backend_name: &str) -> fn() -> Box<TransCrate> {\n     let sysroot = sysroot_candidates.iter()\n         .map(|sysroot| {\n             let libdir = filesearch::relative_target_lib_path(&sysroot, &target);\n-            sysroot.join(&libdir).join(\"codegen-backends\")\n+            sysroot.join(libdir).with_file_name(\"codegen-backends\")\n         })\n         .filter(|f| {\n             info!(\"codegen backend candidate: {}\", f.display());"}]}