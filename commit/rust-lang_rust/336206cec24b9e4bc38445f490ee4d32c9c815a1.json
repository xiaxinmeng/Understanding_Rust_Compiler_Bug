{"sha": "336206cec24b9e4bc38445f490ee4d32c9c815a1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMzNjIwNmNlYzI0YjllNGJjMzg0NDVmNDkwZWU0ZDMyYzljODE1YTE=", "commit": {"author": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2016-06-09T15:23:58Z"}, "committer": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2016-06-09T15:23:58Z"}, "message": "the `type_size` method's `substs` argument allows computing the locals before pushing the stack frame", "tree": {"sha": "c1eaab614d9564f4a8ac215293a4e3a520115c72", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c1eaab614d9564f4a8ac215293a4e3a520115c72"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/336206cec24b9e4bc38445f490ee4d32c9c815a1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJXWYoOAAoJEFbW7qD8Z6xGoLkP/jPTKBj3hqE3C3Rp8uKtDDUL\n7aIkXalmG9ZP0cpbBzhJfOxcd5GxuRFC2dkjlCBr3RlfPcS3GBh7jQhcUnYkrd9q\ng0XTKNqyzRaCP2jB8Bfc4WxVCnwVdam2ssXRmtF03ta51W2PeIF67puZXlXevuh1\nmbyAgnp4qDKKvFPAds3VJ37OAYrdtAfhVlD8f00L9xY5VOD3zLIx9k3beux096Yq\nk/3ORg1qmp6ei3pN/06D5bbgKNul92lg0KStZQ2gjVr0NWqARYaFfMN8fanTXBUm\nqoCWav79sImM9Oh6XGSIER+zAYA9hDwoH5JUxG6g69BW0Sb11UNHxaUam2WlmLJX\newL/FMdgBx6N8PjTbykW47fXkQo/ErKZwBLzMPOmXzHlei/T3sSw2IrNZ9PABxNp\nceN2IA/JZ4QhL8mstJr5g0wNmlPKmLc9xbR0YsK142CzBSgsag//igy3dQslHSDU\nKITBDqIv4R0wdiozv1wKap2JxRAjt9Pcg2W4NjQNWVj7tpAW1tKCZT2q4nWvLyl1\n+jt8oyMfS1AHq4J0zzUw0BAv+ZJdB/hYGi8WAXe8Jx6b/YdqjnP7g/57IGxpulf5\nc2KZJrFE5qsc7dnyRArdTH753aRP9Jl8gUX924S70SBjNVZ29fHx5E45xairfU0g\nzXAYGYUF/gPvqeo2D8hH\n=qw8U\n-----END PGP SIGNATURE-----", "payload": "tree c1eaab614d9564f4a8ac215293a4e3a520115c72\nparent 2dbd82d29667480600846ec62bb0782056330c0e\nauthor Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1465485838 +0200\ncommitter Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1465485838 +0200\n\nthe `type_size` method's `substs` argument allows computing the locals before pushing the stack frame"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/336206cec24b9e4bc38445f490ee4d32c9c815a1", "html_url": "https://github.com/rust-lang/rust/commit/336206cec24b9e4bc38445f490ee4d32c9c815a1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/336206cec24b9e4bc38445f490ee4d32c9c815a1/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2dbd82d29667480600846ec62bb0782056330c0e", "url": "https://api.github.com/repos/rust-lang/rust/commits/2dbd82d29667480600846ec62bb0782056330c0e", "html_url": "https://github.com/rust-lang/rust/commit/2dbd82d29667480600846ec62bb0782056330c0e"}], "stats": {"total": 14, "additions": 6, "deletions": 8}, "files": [{"sha": "a7a57a79601707928213c4e3fbb84b75cff90bd5", "filename": "src/interpreter/mod.rs", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/336206cec24b9e4bc38445f490ee4d32c9c815a1/src%2Finterpreter%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/336206cec24b9e4bc38445f490ee4d32c9c815a1/src%2Finterpreter%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Finterpreter%2Fmod.rs?ref=336206cec24b9e4bc38445f490ee4d32c9c815a1", "patch": "@@ -353,25 +353,23 @@ impl<'a, 'tcx> GlobalEvalContext<'a, 'tcx> {\n \n         ::log_settings::settings().indentation += 1;\n \n+        let locals: Vec<Pointer> = arg_tys.chain(var_tys).chain(temp_tys).map(|ty| {\n+            let size = self.type_size(ty, substs);\n+            self.memory.allocate(size)\n+        }).collect();\n+\n         self.stack.push(Frame {\n             mir: mir.clone(),\n             next_block: mir::START_BLOCK,\n             return_ptr: return_ptr,\n-            locals: Vec::new(),\n+            locals: locals,\n             var_offset: num_args,\n             temp_offset: num_args + num_vars,\n             span: span,\n             def_id: def_id,\n             substs: substs,\n             stmt: 0,\n         });\n-\n-        let locals: Vec<Pointer> = arg_tys.chain(var_tys).chain(temp_tys).map(|ty| {\n-            let size = self.type_size(ty, self.substs());\n-            self.memory.allocate(size)\n-        }).collect();\n-\n-        self.frame_mut().locals = locals;\n     }\n \n     fn pop_stack_frame(&mut self) {"}]}