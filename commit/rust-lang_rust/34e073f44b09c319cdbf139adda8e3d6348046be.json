{"sha": "34e073f44b09c319cdbf139adda8e3d6348046be", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM0ZTA3M2Y0NGIwOWMzMTljZGJmMTM5YWRkYThlM2Q2MzQ4MDQ2YmU=", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2021-01-17T12:24:58Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-01-17T12:24:58Z"}, "message": "Rollup merge of #81084 - LingMan:map, r=oli-obk\n\nUse Option::map instead of open-coding it\n\nr? ```@oli-obk```\n```@rustbot``` modify labels +C-cleanup +T-compiler", "tree": {"sha": "7447b6430957bada75d75c379d8c50446ce70e96", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7447b6430957bada75d75c379d8c50446ce70e96"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/34e073f44b09c319cdbf139adda8e3d6348046be", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgBCyaCRBK7hj4Ov3rIwAAdHIIAIfvQqxe4HyNZLbWmXJAAiJr\nE9aZGggPwvyPTCLmhhdaoowYw6KgjJnsUxIowFgwY1KkEWtaEDWcHXkQFUFGLe4n\n5TQR1im8ZhhLrE1Hkgxv4/YQaOUDydYU6I1pXJvbGS9Eyo+zfjyLk+IrGMFSfNBF\nIfP2zS0X7Kldh6l0+kvk/YmyDjwyObhJ3en8v2YhwpQr9Li2m2+ldUffiqX3Lw92\nGFypBkxwjqAEq3lDAgzqXysA+BATlKgdbkZxe8azlUcoH/+Uc0BYRvNrwvXcprqk\n9HZNnofty/XmrfoISjWwIFTK94oaLjPXHs8WMlj9jLLPKJXamBImva4fMPN189I=\n=v5YG\n-----END PGP SIGNATURE-----\n", "payload": "tree 7447b6430957bada75d75c379d8c50446ce70e96\nparent 366f97bf8cb6268ae5624c6422f05fd7e8eaf698\nparent 76003f31f100b96b7c5f6d2414dde5088394b5bd\nauthor Mara Bos <m-ou.se@m-ou.se> 1610886298 +0000\ncommitter GitHub <noreply@github.com> 1610886298 +0000\n\nRollup merge of #81084 - LingMan:map, r=oli-obk\n\nUse Option::map instead of open-coding it\n\nr? ```@oli-obk```\n```@rustbot``` modify labels +C-cleanup +T-compiler\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/34e073f44b09c319cdbf139adda8e3d6348046be", "html_url": "https://github.com/rust-lang/rust/commit/34e073f44b09c319cdbf139adda8e3d6348046be", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/34e073f44b09c319cdbf139adda8e3d6348046be/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "366f97bf8cb6268ae5624c6422f05fd7e8eaf698", "url": "https://api.github.com/repos/rust-lang/rust/commits/366f97bf8cb6268ae5624c6422f05fd7e8eaf698", "html_url": "https://github.com/rust-lang/rust/commit/366f97bf8cb6268ae5624c6422f05fd7e8eaf698"}, {"sha": "76003f31f100b96b7c5f6d2414dde5088394b5bd", "url": "https://api.github.com/repos/rust-lang/rust/commits/76003f31f100b96b7c5f6d2414dde5088394b5bd", "html_url": "https://github.com/rust-lang/rust/commit/76003f31f100b96b7c5f6d2414dde5088394b5bd"}], "stats": {"total": 42, "additions": 17, "deletions": 25}, "files": [{"sha": "26843670131b8d57909ec7415c8f4a4440e2f907", "filename": "compiler/rustc_codegen_llvm/src/llvm_util.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/34e073f44b09c319cdbf139adda8e3d6348046be/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm_util.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34e073f44b09c319cdbf139adda8e3d6348046be/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm_util.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm_util.rs?ref=34e073f44b09c319cdbf139adda8e3d6348046be", "patch": "@@ -254,8 +254,6 @@ pub fn handle_native_features(sess: &Session) -> Vec<String> {\n }\n \n pub fn tune_cpu(sess: &Session) -> Option<&str> {\n-    match sess.opts.debugging_opts.tune_cpu {\n-        Some(ref s) => Some(handle_native(&**s)),\n-        None => None,\n-    }\n+    let name = sess.opts.debugging_opts.tune_cpu.as_ref()?;\n+    Some(handle_native(name))\n }"}, {"sha": "157959b115947fad19da82cdff593fa8f92bf937", "filename": "compiler/rustc_mir/src/borrow_check/type_check/input_output.rs", "status": "modified", "additions": 12, "deletions": 16, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/34e073f44b09c319cdbf139adda8e3d6348046be/compiler%2Frustc_mir%2Fsrc%2Fborrow_check%2Ftype_check%2Finput_output.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34e073f44b09c319cdbf139adda8e3d6348046be/compiler%2Frustc_mir%2Fsrc%2Fborrow_check%2Ftype_check%2Finput_output.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Fborrow_check%2Ftype_check%2Finput_output.rs?ref=34e073f44b09c319cdbf139adda8e3d6348046be", "patch": "@@ -39,10 +39,8 @@ impl<'a, 'tcx> TypeChecker<'a, 'tcx> {\n             user_provided_sig = None;\n         } else {\n             let typeck_results = self.tcx().typeck(mir_def_id);\n-            user_provided_sig = match typeck_results.user_provided_sigs.get(&mir_def_id.to_def_id())\n-            {\n-                None => None,\n-                Some(user_provided_poly_sig) => {\n+            user_provided_sig = typeck_results.user_provided_sigs.get(&mir_def_id.to_def_id()).map(\n+                |user_provided_poly_sig| {\n                     // Instantiate the canonicalized variables from\n                     // user-provided signature (e.g., the `_` in the code\n                     // above) with fresh variables.\n@@ -54,18 +52,16 @@ impl<'a, 'tcx> TypeChecker<'a, 'tcx> {\n                     // Replace the bound items in the fn sig with fresh\n                     // variables, so that they represent the view from\n                     // \"inside\" the closure.\n-                    Some(\n-                        self.infcx\n-                            .replace_bound_vars_with_fresh_vars(\n-                                body.span,\n-                                LateBoundRegionConversionTime::FnCall,\n-                                poly_sig,\n-                            )\n-                            .0,\n-                    )\n-                }\n-            }\n-        };\n+                    self.infcx\n+                        .replace_bound_vars_with_fresh_vars(\n+                            body.span,\n+                            LateBoundRegionConversionTime::FnCall,\n+                            poly_sig,\n+                        )\n+                        .0\n+                },\n+            );\n+        }\n \n         debug!(\n             \"equate_inputs_and_outputs: normalized_input_tys = {:?}, local_decls = {:?}\","}, {"sha": "d37d6bc4f2df657465a80a083abdbb90cfa1a4b6", "filename": "compiler/rustc_typeck/src/check/compare_method.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/34e073f44b09c319cdbf139adda8e3d6348046be/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34e073f44b09c319cdbf139adda8e3d6348046be/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs?ref=34e073f44b09c319cdbf139adda8e3d6348046be", "patch": "@@ -365,12 +365,10 @@ fn check_region_bounds_on_impl_item<'tcx>(\n         let item_kind = assoc_item_kind_str(impl_m);\n         let def_span = tcx.sess.source_map().guess_head_span(span);\n         let span = tcx.hir().get_generics(impl_m.def_id).map_or(def_span, |g| g.span);\n-        let generics_span = if let Some(sp) = tcx.hir().span_if_local(trait_m.def_id) {\n+        let generics_span = tcx.hir().span_if_local(trait_m.def_id).map(|sp| {\n             let def_sp = tcx.sess.source_map().guess_head_span(sp);\n-            Some(tcx.hir().get_generics(trait_m.def_id).map_or(def_sp, |g| g.span))\n-        } else {\n-            None\n-        };\n+            tcx.hir().get_generics(trait_m.def_id).map_or(def_sp, |g| g.span)\n+        });\n \n         tcx.sess.emit_err(LifetimesOrBoundsMismatchOnTrait {\n             span,"}]}