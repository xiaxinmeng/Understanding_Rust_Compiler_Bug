{"sha": "9ed9618f1cabcfff5871887feb8b7871b027a744", "node_id": "MDY6Q29tbWl0NzI0NzEyOjllZDk2MThmMWNhYmNmZmY1ODcxODg3ZmViOGI3ODcxYjAyN2E3NDQ=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2016-08-10T06:12:16Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-08-10T06:12:16Z"}, "message": "Merge pull request #1122 from studoot/add-test-for-1111\n\nAdd test case for issue #1111", "tree": {"sha": "6399ba8ce65c77c6851b5b4bceb678223db4afaf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6399ba8ce65c77c6851b5b4bceb678223db4afaf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9ed9618f1cabcfff5871887feb8b7871b027a744", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9ed9618f1cabcfff5871887feb8b7871b027a744", "html_url": "https://github.com/rust-lang/rust/commit/9ed9618f1cabcfff5871887feb8b7871b027a744", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9ed9618f1cabcfff5871887feb8b7871b027a744/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "69f647b9f1bc53b97577137da11c37213a44d1fd", "url": "https://api.github.com/repos/rust-lang/rust/commits/69f647b9f1bc53b97577137da11c37213a44d1fd", "html_url": "https://github.com/rust-lang/rust/commit/69f647b9f1bc53b97577137da11c37213a44d1fd"}, {"sha": "5dda986a2c6bd7e16f4f5a874de7bd7455d06c63", "url": "https://api.github.com/repos/rust-lang/rust/commits/5dda986a2c6bd7e16f4f5a874de7bd7455d06c63", "html_url": "https://github.com/rust-lang/rust/commit/5dda986a2c6bd7e16f4f5a874de7bd7455d06c63"}], "stats": {"total": 38, "additions": 31, "deletions": 7}, "files": [{"sha": "7c66d27da410442ecc74b22acd2db65cd235b4e2", "filename": "Contributing.md", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/9ed9618f1cabcfff5871887feb8b7871b027a744/Contributing.md", "raw_url": "https://github.com/rust-lang/rust/raw/9ed9618f1cabcfff5871887feb8b7871b027a744/Contributing.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Contributing.md?ref=9ed9618f1cabcfff5871887feb8b7871b027a744", "patch": "@@ -44,17 +44,23 @@ colourised diff will be printed so that the offending line(s) can quickly be\n identified.\n \n Without explicit settings, the tests will be run using rustfmt's default\n-configuration. It is possible to run a test using non-default settings by\n-including configuration parameters in comments at the top of the file. For\n-example: to use 3 spaces per tab, start your test with\n+configuration. It is possible to run a test using non-default settings in several \n+ways. Firstly, you can include configuration parameters in comments at the top\n+of the file. For example: to use 3 spaces per tab, start your test with\n `// rustfmt-tab_spaces: 3`. Just remember that the comment is part of the input,\n so include in both the source and target files! It is also possible to\n explicitly specify the name of the expected output file in the target directory.\n-Use `// rustfmt-target: filename.rs` for this. Finally, you can use a custom\n+Use `// rustfmt-target: filename.rs` for this. You can also specify a custom\n configuration by using the `rustfmt-config` directive. Rustfmt will then use\n that toml file located in `./tests/config/` for its configuration. Including\n `// rustfmt-config: small_tabs.toml` will run your test with the configuration\n-file found at `./tests/config/small_tabs.toml`.\n+file found at `./tests/config/small_tabs.toml`. The final option is used when the\n+test source file contains no configuration parameter comments. In this case, the\n+test harness looks for a configuration file with the same filename as the test\n+file in the `./tests/config/` directory, so a test source file named `test-indent.rs`\n+would need a configuration file named `test-indent.toml` in that directory. As an\n+example, the `issue-1111.rs` test file is configured by the file\n+`./tests/config/issue-1111.toml`.\n \n \n ## Hack!"}, {"sha": "44148a2d3c3ed6bc75e28e1c55eec63f4d720698", "filename": "tests/config/issue-1111.toml", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9ed9618f1cabcfff5871887feb8b7871b027a744/tests%2Fconfig%2Fissue-1111.toml", "raw_url": "https://github.com/rust-lang/rust/raw/9ed9618f1cabcfff5871887feb8b7871b027a744/tests%2Fconfig%2Fissue-1111.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fconfig%2Fissue-1111.toml?ref=9ed9618f1cabcfff5871887feb8b7871b027a744", "patch": "@@ -0,0 +1 @@\n+reorder_imports = true"}, {"sha": "2e1a89ad78eb93ae5e9217779e8acbffe172dced", "filename": "tests/source/issue-1111.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9ed9618f1cabcfff5871887feb8b7871b027a744/tests%2Fsource%2Fissue-1111.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ed9618f1cabcfff5871887feb8b7871b027a744/tests%2Fsource%2Fissue-1111.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-1111.rs?ref=9ed9618f1cabcfff5871887feb8b7871b027a744", "patch": "@@ -0,0 +1 @@\n+use bar;"}, {"sha": "ce52bf5fd697cde77df2022e26a92c77a288b944", "filename": "tests/system.rs", "status": "modified", "additions": 17, "deletions": 2, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/9ed9618f1cabcfff5871887feb8b7871b027a744/tests%2Fsystem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ed9618f1cabcfff5871887feb8b7871b027a744/tests%2Fsystem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsystem.rs?ref=9ed9618f1cabcfff5871887feb8b7871b027a744", "patch": "@@ -205,7 +205,17 @@ fn print_mismatches(result: HashMap<String, Vec<Mismatch>>) {\n \n fn read_config(filename: &str) -> Config {\n     let sig_comments = read_significant_comments(&filename);\n-    let mut config = get_config(sig_comments.get(\"config\").map(|x| &(*x)[..]));\n+    // Look for a config file... If there is a 'config' property in the significant comments, use\n+    // that. Otherwise, if there are no significant comments at all, look for a config file with\n+    // the same name as the test file.\n+    let mut config = if !sig_comments.is_empty() {\n+        get_config(sig_comments.get(\"config\").map(|x| &(*x)[..]))\n+    } else {\n+        get_config(Path::new(filename)\n+            .with_extension(\"toml\")\n+            .file_name()\n+            .and_then(std::ffi::OsStr::to_str))\n+    };\n \n     for (key, val) in &sig_comments {\n         if key != \"target\" && key != \"config\" {\n@@ -246,13 +256,18 @@ pub fn idempotent_check(filename: String) -> Result<FormatReport, HashMap<String\n     handle_result(write_result, target).map(|_| format_report)\n }\n \n-// Reads test config file from comments and reads its contents.\n+// Reads test config file using the supplied (optional) file name. If there's no file name or the\n+// file doesn't exist, just return the default config. Otherwise, the file must be read\n+// successfully.\n fn get_config(config_file: Option<&str>) -> Config {\n     let config_file_name = match config_file {\n         None => return Default::default(),\n         Some(file_name) => {\n             let mut full_path = \"tests/config/\".to_owned();\n             full_path.push_str(&file_name);\n+            if !Path::new(&full_path).exists() {\n+                return Default::default();\n+            };\n             full_path\n         }\n     };"}, {"sha": "2e1a89ad78eb93ae5e9217779e8acbffe172dced", "filename": "tests/target/issue-1111.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9ed9618f1cabcfff5871887feb8b7871b027a744/tests%2Ftarget%2Fissue-1111.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ed9618f1cabcfff5871887feb8b7871b027a744/tests%2Ftarget%2Fissue-1111.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-1111.rs?ref=9ed9618f1cabcfff5871887feb8b7871b027a744", "patch": "@@ -0,0 +1 @@\n+use bar;"}]}