{"sha": "90a562c7ff728d75ba76bdc68aea53d6d0c75ec9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkwYTU2MmM3ZmY3MjhkNzViYTc2YmRjNjhhZWE1M2Q2ZDBjNzVlYzk=", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2020-12-07T21:46:35Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-03-09T18:28:00Z"}, "message": "Deduplicate unchecked_attrs errors.", "tree": {"sha": "ae1497cda724534cd6591eab25129383ae7f6931", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ae1497cda724534cd6591eab25129383ae7f6931"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/90a562c7ff728d75ba76bdc68aea53d6d0c75ec9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/90a562c7ff728d75ba76bdc68aea53d6d0c75ec9", "html_url": "https://github.com/rust-lang/rust/commit/90a562c7ff728d75ba76bdc68aea53d6d0c75ec9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/90a562c7ff728d75ba76bdc68aea53d6d0c75ec9/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2658fb7783271fd093017d64b6417868802fec05", "url": "https://api.github.com/repos/rust-lang/rust/commits/2658fb7783271fd093017d64b6417868802fec05", "html_url": "https://github.com/rust-lang/rust/commit/2658fb7783271fd093017d64b6417868802fec05"}], "stats": {"total": 5, "additions": 3, "deletions": 2}, "files": [{"sha": "0b544b8ab415e4458d4907ff2644b1bcedd6bbc0", "filename": "compiler/rustc_incremental/src/persist/dirty_clean.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/90a562c7ff728d75ba76bdc68aea53d6d0c75ec9/compiler%2Frustc_incremental%2Fsrc%2Fpersist%2Fdirty_clean.rs", "raw_url": "https://github.com/rust-lang/rust/raw/90a562c7ff728d75ba76bdc68aea53d6d0c75ec9/compiler%2Frustc_incremental%2Fsrc%2Fpersist%2Fdirty_clean.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_incremental%2Fsrc%2Fpersist%2Fdirty_clean.rs?ref=90a562c7ff728d75ba76bdc68aea53d6d0c75ec9", "patch": "@@ -168,7 +168,7 @@ pub fn check_dirty_clean_annotations(tcx: TyCtxt<'_>) {\n         // Note that we cannot use the existing \"unused attribute\"-infrastructure\n         // here, since that is running before codegen. This is also the reason why\n         // all codegen-specific attributes are `AssumedUsed` in rustc_ast::feature_gate.\n-        all_attrs.report_unchecked_attrs(&dirty_clean_visitor.checked_attrs);\n+        all_attrs.report_unchecked_attrs(dirty_clean_visitor.checked_attrs);\n     })\n }\n \n@@ -535,13 +535,14 @@ impl FindAllAttrs<'_, 'tcx> {\n         false\n     }\n \n-    fn report_unchecked_attrs(&self, checked_attrs: &FxHashSet<ast::AttrId>) {\n+    fn report_unchecked_attrs(&self, mut checked_attrs: FxHashSet<ast::AttrId>) {\n         for attr in &self.found_attrs {\n             if !checked_attrs.contains(&attr.id) {\n                 self.tcx.sess.span_err(\n                     attr.span,\n                     \"found unchecked `#[rustc_dirty]` / `#[rustc_clean]` attribute\",\n                 );\n+                checked_attrs.insert(attr.id);\n             }\n         }\n     }"}]}