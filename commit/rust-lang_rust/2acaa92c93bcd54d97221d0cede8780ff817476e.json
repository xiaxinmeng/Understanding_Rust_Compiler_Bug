{"sha": "2acaa92c93bcd54d97221d0cede8780ff817476e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJhY2FhOTJjOTNiY2Q1NGQ5NzIyMWQwY2VkZTg3ODBmZjgxNzQ3NmU=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-01-26T10:23:28Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-01-26T10:23:28Z"}, "message": "Merge #660\n\n660: Support macro calls in type position r=matklad a=regiontog\n\nA [playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=fdc6dd4ddaece92a72fa2a292b75e27c) demonstrating the syntax in question.\n\nCo-authored-by: Erlend Tobiassen <erlend.tobiassen@gmail.com>", "tree": {"sha": "cb92ecad2475f772d3e392d6cb43ccb84fa50acf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cb92ecad2475f772d3e392d6cb43ccb84fa50acf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2acaa92c93bcd54d97221d0cede8780ff817476e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2acaa92c93bcd54d97221d0cede8780ff817476e", "html_url": "https://github.com/rust-lang/rust/commit/2acaa92c93bcd54d97221d0cede8780ff817476e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2acaa92c93bcd54d97221d0cede8780ff817476e/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "8b6dea348fa02a7ce8107a1e73917f0597f2a91d", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b6dea348fa02a7ce8107a1e73917f0597f2a91d", "html_url": "https://github.com/rust-lang/rust/commit/8b6dea348fa02a7ce8107a1e73917f0597f2a91d"}, {"sha": "e28bd099d68ee124280eeadefe48c1f2e0ff6c17", "url": "https://api.github.com/repos/rust-lang/rust/commits/e28bd099d68ee124280eeadefe48c1f2e0ff6c17", "html_url": "https://github.com/rust-lang/rust/commit/e28bd099d68ee124280eeadefe48c1f2e0ff6c17"}], "stats": {"total": 69, "additions": 68, "deletions": 1}, "files": [{"sha": "adc189a292d5d319c32734a771d6c4010435724f", "filename": "crates/ra_syntax/src/grammar/types.rs", "status": "modified", "additions": 23, "deletions": 1, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/2acaa92c93bcd54d97221d0cede8780ff817476e/crates%2Fra_syntax%2Fsrc%2Fgrammar%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2acaa92c93bcd54d97221d0cede8780ff817476e/crates%2Fra_syntax%2Fsrc%2Fgrammar%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fgrammar%2Ftypes.rs?ref=2acaa92c93bcd54d97221d0cede8780ff817476e", "patch": "@@ -29,7 +29,7 @@ fn type_with_bounds_cond(p: &mut Parser, allow_bounds: bool) {\n         DYN_KW => dyn_trait_type(p),\n         // Some path types are not allowed to have bounds (no plus)\n         L_ANGLE => path_type_(p, allow_bounds),\n-        _ if paths::is_path_start(p) => path_type_(p, allow_bounds),\n+        _ if paths::is_path_start(p) => path_or_macro_type_(p, allow_bounds),\n         _ => {\n             p.err_recover(\"expected type\", TYPE_RECOVERY_SET);\n         }\n@@ -243,6 +243,28 @@ pub(super) fn path_type(p: &mut Parser) {\n     path_type_(p, true)\n }\n \n+// test macro_call_type\n+// type A = foo!();\n+// type B = crate::foo!();\n+fn path_or_macro_type_(p: &mut Parser, allow_bounds: bool) {\n+    assert!(paths::is_path_start(p) || p.at(L_ANGLE));\n+    let m = p.start();\n+    paths::type_path(p);\n+\n+    let kind = if p.at(EXCL) {\n+        items::macro_call_after_excl(p);\n+        MACRO_CALL\n+    } else {\n+        PATH_TYPE\n+    };\n+\n+    if allow_bounds && p.eat(PLUS) {\n+        type_params::bounds_without_colon(p);\n+    }\n+\n+    m.complete(p, kind);\n+}\n+\n pub(super) fn path_type_(p: &mut Parser, allow_bounds: bool) {\n     assert!(paths::is_path_start(p) || p.at(L_ANGLE));\n     let m = p.start();"}, {"sha": "edb470c899972b7689dcb7b3f15fe33d857b0dad", "filename": "crates/ra_syntax/tests/data/parser/inline/ok/0117_macro_call_type.rs", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2acaa92c93bcd54d97221d0cede8780ff817476e/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0117_macro_call_type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2acaa92c93bcd54d97221d0cede8780ff817476e/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0117_macro_call_type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0117_macro_call_type.rs?ref=2acaa92c93bcd54d97221d0cede8780ff817476e", "patch": "@@ -0,0 +1,2 @@\n+type A = foo!();\n+type B = crate::foo!();"}, {"sha": "b2d95451c97f23ff4a5ae91ec16750cfe91601fc", "filename": "crates/ra_syntax/tests/data/parser/inline/ok/0117_macro_call_type.txt", "status": "added", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/2acaa92c93bcd54d97221d0cede8780ff817476e/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0117_macro_call_type.txt", "raw_url": "https://github.com/rust-lang/rust/raw/2acaa92c93bcd54d97221d0cede8780ff817476e/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0117_macro_call_type.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftests%2Fdata%2Fparser%2Finline%2Fok%2F0117_macro_call_type.txt?ref=2acaa92c93bcd54d97221d0cede8780ff817476e", "patch": "@@ -0,0 +1,43 @@\n+SOURCE_FILE@[0; 41)\n+  TYPE_DEF@[0; 16)\n+    TYPE_KW@[0; 4)\n+    WHITESPACE@[4; 5)\n+    NAME@[5; 6)\n+      IDENT@[5; 6) \"A\"\n+    WHITESPACE@[6; 7)\n+    EQ@[7; 8)\n+    WHITESPACE@[8; 9)\n+    MACRO_CALL@[9; 15)\n+      PATH@[9; 12)\n+        PATH_SEGMENT@[9; 12)\n+          NAME_REF@[9; 12)\n+            IDENT@[9; 12) \"foo\"\n+      EXCL@[12; 13)\n+      TOKEN_TREE@[13; 15)\n+        L_PAREN@[13; 14)\n+        R_PAREN@[14; 15)\n+    SEMI@[15; 16)\n+  WHITESPACE@[16; 17)\n+  TYPE_DEF@[17; 40)\n+    TYPE_KW@[17; 21)\n+    WHITESPACE@[21; 22)\n+    NAME@[22; 23)\n+      IDENT@[22; 23) \"B\"\n+    WHITESPACE@[23; 24)\n+    EQ@[24; 25)\n+    WHITESPACE@[25; 26)\n+    MACRO_CALL@[26; 39)\n+      PATH@[26; 36)\n+        PATH@[26; 31)\n+          PATH_SEGMENT@[26; 31)\n+            CRATE_KW@[26; 31)\n+        COLONCOLON@[31; 33)\n+        PATH_SEGMENT@[33; 36)\n+          NAME_REF@[33; 36)\n+            IDENT@[33; 36) \"foo\"\n+      EXCL@[36; 37)\n+      TOKEN_TREE@[37; 39)\n+        L_PAREN@[37; 38)\n+        R_PAREN@[38; 39)\n+    SEMI@[39; 40)\n+  WHITESPACE@[40; 41)"}]}