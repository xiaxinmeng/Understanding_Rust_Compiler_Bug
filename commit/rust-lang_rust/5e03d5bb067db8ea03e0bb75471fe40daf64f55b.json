{"sha": "5e03d5bb067db8ea03e0bb75471fe40daf64f55b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVlMDNkNWJiMDY3ZGI4ZWEwM2UwYmI3NTQ3MWZlNDBkYWY2NGY1NWI=", "commit": {"author": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-02-13T16:29:40Z"}, "committer": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-02-13T16:59:37Z"}, "message": "Sort versions in json output", "tree": {"sha": "c467db065e8ddffc5566b7eacf37fb61c45fd740", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c467db065e8ddffc5566b7eacf37fb61c45fd740"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5e03d5bb067db8ea03e0bb75471fe40daf64f55b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZxoS6lESXlRGMHWcaTCGhp1QZjcFAl5FgHkACgkQaTCGhp1Q\nZjdrGw/8CAkUx1hpbiBJf1uGWQZq2UohBZbA1srWKlh2063iPbFbbIHXv7iFl0E2\nglTjQkte7Sc796LCYH4IFoZfqwa2IjOMrRMehCokRaG8OxL5ka9nx75BnCq778cQ\nwmeuIU/30oN8ijA1t0S9IyLx8seXyf8uehxhscohjyPfBKJNJUvCb3/IRHM//3SW\nGhIEZ7AOKdZGqTFI1/D/xCCaRYtMwnP+ivObN0Katlr7zQjGv4VKLa0GN7BFcIAm\naspMYvAyIzCHyQ/LVYueqPpwM7aISG/MKe7miw/VXEpd8pjfL0PMyMwoPn7cJAwc\nieQ25RrW6RUjmOgWY3y/XvQn+aojDM1Q2jrIND0z7uVSRQhgfSk9ybEu1Zy8H0nm\nxk0455/BCWEnPTYvxCLHP1/5vhQtSJVdD4HPOgw0V1vaKP6L+HunIVmJLDXimQXB\nYfKwHZ2AfGqLljiGNnnmmjPjL+Dalhy3ZBOvpDKICWNUDgAzT9ym/cTl+NDOODlP\nFRIn8kTKTwzZXXyWWe1tFTK1Tue6RHJzgcYf4a+4QkRckCNxU8cz/XoKDpcm6qeK\ndiFnwmmWSl+GbPqR07X2UJGCI8DTNN5fzCAwh+5aZLdvZRmdZFo+Zuygk2ktaAjl\nrNEIckvHJPu/MextDvZISt5fRqkbKQp06pbqp3i5agzmgvHs7HU=\n=XV8B\n-----END PGP SIGNATURE-----", "payload": "tree c467db065e8ddffc5566b7eacf37fb61c45fd740\nparent 96c2e62d5700a811f479d984cf57ffc0675ab44a\nauthor flip1995 <hello@philkrones.com> 1581611380 +0100\ncommitter flip1995 <hello@philkrones.com> 1581613177 +0100\n\nSort versions in json output\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5e03d5bb067db8ea03e0bb75471fe40daf64f55b", "html_url": "https://github.com/rust-lang/rust/commit/5e03d5bb067db8ea03e0bb75471fe40daf64f55b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5e03d5bb067db8ea03e0bb75471fe40daf64f55b/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "96c2e62d5700a811f479d984cf57ffc0675ab44a", "url": "https://api.github.com/repos/rust-lang/rust/commits/96c2e62d5700a811f479d984cf57ffc0675ab44a", "html_url": "https://github.com/rust-lang/rust/commit/96c2e62d5700a811f479d984cf57ffc0675ab44a"}], "stats": {"total": 52, "additions": 45, "deletions": 7}, "files": [{"sha": "59a7cdae866ef9e7047c247401e080557852d34b", "filename": ".github/deploy.sh", "status": "modified", "additions": 3, "deletions": 7, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/5e03d5bb067db8ea03e0bb75471fe40daf64f55b/.github%2Fdeploy.sh", "raw_url": "https://github.com/rust-lang/rust/raw/5e03d5bb067db8ea03e0bb75471fe40daf64f55b/.github%2Fdeploy.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fdeploy.sh?ref=5e03d5bb067db8ea03e0bb75471fe40daf64f55b", "patch": "@@ -20,14 +20,10 @@ fi\n # Generate version index that is shown as root index page\n cp util/gh-pages/versions.html out/index.html\n \n-cd out\n-cat <<-EOF | python - > versions.json\n-import os, json\n-print json.dumps([\n-    dir for dir in os.listdir(\".\") if not dir.startswith(\".\") and os.path.isdir(dir)\n-])\n-EOF\n+echo \"Making the versions.json file\"\n+python ./util/versions.py out\n \n+cd out\n # Now let's go have some fun with the cloned repo\n git config user.name \"GHA CI\"\n git config user.email \"gha@ci.invalid\""}, {"sha": "2c9bb5fe40a9960465d36026fb542fea57f30f57", "filename": "util/versions.py", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/5e03d5bb067db8ea03e0bb75471fe40daf64f55b/util%2Fversions.py", "raw_url": "https://github.com/rust-lang/rust/raw/5e03d5bb067db8ea03e0bb75471fe40daf64f55b/util%2Fversions.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/util%2Fversions.py?ref=5e03d5bb067db8ea03e0bb75471fe40daf64f55b", "patch": "@@ -0,0 +1,42 @@\n+#!/usr/bin/env python\n+\n+import json\n+import os\n+import sys\n+\n+from lintlib import log\n+\n+\n+def key(v):\n+    if v == 'master':\n+        return float('inf')\n+    if v == 'current':\n+        return sys.maxsize\n+\n+    v = v.replace('v', '').replace('rust-', '')\n+\n+    s = 0\n+    for i, val in enumerate(v.split('.')[::-1]):\n+        s += int(val) * 100**i\n+\n+    return s\n+\n+\n+def main():\n+    if len(sys.argv) < 2:\n+        print(\"Error: specify output directory\")\n+        return\n+\n+    outdir = sys.argv[1]\n+    versions = [\n+        dir for dir in os.listdir(outdir) if not dir.startswith(\".\") and os.path.isdir(os.path.join(outdir, dir))\n+    ]\n+    versions.sort(key=key)\n+\n+    with open(os.path.join(outdir, \"versions.json\"), \"w\") as fp:\n+        json.dump(versions, fp, indent=2)\n+        log.info(\"wrote JSON for great justice\")\n+\n+\n+if __name__ == \"__main__\":\n+    main()"}]}