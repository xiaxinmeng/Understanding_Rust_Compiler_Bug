{"sha": "f3240e22c6de69b408a83b59e85f40fb913acfab", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYzMjQwZTIyYzZkZTY5YjQwOGE4M2I1OWU4NWY0MGZiOTEzYWNmYWI=", "commit": {"author": {"name": "Veetaha", "email": "gerzoh1@gmail.com", "date": "2020-02-09T12:18:05Z"}, "committer": {"name": "Veetaha", "email": "gerzoh1@gmail.com", "date": "2020-02-09T12:18:05Z"}, "message": "vscode: move throtting of download progress to call site", "tree": {"sha": "25c9a71ec7a98efe33209fcd370668610c61aa1e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/25c9a71ec7a98efe33209fcd370668610c61aa1e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f3240e22c6de69b408a83b59e85f40fb913acfab", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f3240e22c6de69b408a83b59e85f40fb913acfab", "html_url": "https://github.com/rust-lang/rust/commit/f3240e22c6de69b408a83b59e85f40fb913acfab", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f3240e22c6de69b408a83b59e85f40fb913acfab/comments", "author": null, "committer": null, "parents": [{"sha": "a63659badb75d22ad834b7524e77505790c10dd0", "url": "https://api.github.com/repos/rust-lang/rust/commits/a63659badb75d22ad834b7524e77505790c10dd0", "html_url": "https://github.com/rust-lang/rust/commit/a63659badb75d22ad834b7524e77505790c10dd0"}], "stats": {"total": 35, "additions": 19, "deletions": 16}, "files": [{"sha": "53bf46d78935ad3af0bee5b07682b5b7fe447d19", "filename": "editors/code/src/installation/download_file.ts", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f3240e22c6de69b408a83b59e85f40fb913acfab/editors%2Fcode%2Fsrc%2Finstallation%2Fdownload_file.ts", "raw_url": "https://github.com/rust-lang/rust/raw/f3240e22c6de69b408a83b59e85f40fb913acfab/editors%2Fcode%2Fsrc%2Finstallation%2Fdownload_file.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Finstallation%2Fdownload_file.ts?ref=f3240e22c6de69b408a83b59e85f40fb913acfab", "patch": "@@ -1,20 +1,18 @@\n import fetch from \"node-fetch\";\n-import { throttle } from \"throttle-debounce\";\n import * as fs from \"fs\";\n import { strict as assert } from \"assert\";\n \n /**\n  * Downloads file from `url` and stores it at `destFilePath`.\n- * `onProgress` callback is periodically called to track the progress of downloading,\n- * it gets the already read and total amount of bytes to read as its parameters.\n+ * `onProgress` callback is called on recieveing each chunk of bytes\n+ * to track the progress of downloading, it gets the already read and total\n+ * amount of bytes to read as its parameters.\n  */\n export async function downloadFile(\n     url: string,\n     destFilePath: fs.PathLike,\n     onProgress: (readBytes: number, totalBytes: number) => void\n ): Promise<void> {\n-    onProgress = throttle(200, /* noTrailing: */ true, onProgress);\n-\n     const response = await fetch(url);\n \n     const totalBytes = Number(response.headers.get('content-length'));"}, {"sha": "c1f37f978634ec0dcc10cef2f4de33e8b297d098", "filename": "editors/code/src/installation/language_server.ts", "status": "modified", "additions": 16, "deletions": 11, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/f3240e22c6de69b408a83b59e85f40fb913acfab/editors%2Fcode%2Fsrc%2Finstallation%2Flanguage_server.ts", "raw_url": "https://github.com/rust-lang/rust/raw/f3240e22c6de69b408a83b59e85f40fb913acfab/editors%2Fcode%2Fsrc%2Finstallation%2Flanguage_server.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Finstallation%2Flanguage_server.ts?ref=f3240e22c6de69b408a83b59e85f40fb913acfab", "patch": "@@ -1,8 +1,9 @@\n-import { spawnSync } from \"child_process\";\n import * as vscode from \"vscode\";\n import * as path from \"path\";\n import { strict as assert } from \"assert\";\n import { promises as fs } from \"fs\";\n+import { spawnSync } from \"child_process\";\n+import { throttle } from \"throttle-debounce\";\n \n import { BinarySource } from \"./interfaces\";\n import { fetchLatestArtifactMetadata } from \"./fetch_latest_artifact_metadata\";\n@@ -28,19 +29,23 @@ export async function downloadLatestLanguageServer(\n         {\n             location: vscode.ProgressLocation.Notification,\n             cancellable: false, // FIXME: add support for canceling download?\n-            title: `Downloading language server ${releaseName}`\n+            title: `Downloading language server (${releaseName})`\n         },\n         async (progress, _cancellationToken) => {\n             let lastPrecentage = 0;\n-            await downloadFile(downloadUrl, installationPath, (readBytes, totalBytes) => {\n-                const newPercentage = (readBytes / totalBytes) * 100;\n-                progress.report({\n-                    message: newPercentage.toFixed(0) + \"%\",\n-                    increment: newPercentage - lastPrecentage\n-                });\n-\n-                lastPrecentage = newPercentage;\n-            });\n+            await downloadFile(downloadUrl, installationPath, throttle(\n+                200,\n+                /* noTrailing: */ true,\n+                (readBytes, totalBytes) => {\n+                    const newPercentage = (readBytes / totalBytes) * 100;\n+                    progress.report({\n+                        message: newPercentage.toFixed(0) + \"%\",\n+                        increment: newPercentage - lastPrecentage\n+                    });\n+\n+                    lastPrecentage = newPercentage;\n+                })\n+            );\n         }\n     );\n "}]}