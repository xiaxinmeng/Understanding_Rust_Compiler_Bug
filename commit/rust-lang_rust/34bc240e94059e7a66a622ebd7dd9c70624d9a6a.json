{"sha": "34bc240e94059e7a66a622ebd7dd9c70624d9a6a", "node_id": "C_kwDOAAsO6NoAKDM0YmMyNDBlOTQwNTllN2E2NmE2MjJlYmQ3ZGQ5YzcwNjI0ZDlhNmE", "commit": {"author": {"name": "Lauren\u021biu Nicola", "email": "lnicola@dend.ro", "date": "2023-01-01T16:52:47Z"}, "committer": {"name": "Lauren\u021biu Nicola", "email": "lnicola@dend.ro", "date": "2023-01-01T18:45:08Z"}, "message": "Package release artifacts as ZIP", "tree": {"sha": "1ec895926a92add3aa3748f74abcfea53b7ca7e0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1ec895926a92add3aa3748f74abcfea53b7ca7e0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/34bc240e94059e7a66a622ebd7dd9c70624d9a6a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/34bc240e94059e7a66a622ebd7dd9c70624d9a6a", "html_url": "https://github.com/rust-lang/rust/commit/34bc240e94059e7a66a622ebd7dd9c70624d9a6a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/34bc240e94059e7a66a622ebd7dd9c70624d9a6a/comments", "author": {"login": "lnicola", "id": 308347, "node_id": "MDQ6VXNlcjMwODM0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/308347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lnicola", "html_url": "https://github.com/lnicola", "followers_url": "https://api.github.com/users/lnicola/followers", "following_url": "https://api.github.com/users/lnicola/following{/other_user}", "gists_url": "https://api.github.com/users/lnicola/gists{/gist_id}", "starred_url": "https://api.github.com/users/lnicola/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lnicola/subscriptions", "organizations_url": "https://api.github.com/users/lnicola/orgs", "repos_url": "https://api.github.com/users/lnicola/repos", "events_url": "https://api.github.com/users/lnicola/events{/privacy}", "received_events_url": "https://api.github.com/users/lnicola/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lnicola", "id": 308347, "node_id": "MDQ6VXNlcjMwODM0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/308347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lnicola", "html_url": "https://github.com/lnicola", "followers_url": "https://api.github.com/users/lnicola/followers", "following_url": "https://api.github.com/users/lnicola/following{/other_user}", "gists_url": "https://api.github.com/users/lnicola/gists{/gist_id}", "starred_url": "https://api.github.com/users/lnicola/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lnicola/subscriptions", "organizations_url": "https://api.github.com/users/lnicola/orgs", "repos_url": "https://api.github.com/users/lnicola/repos", "events_url": "https://api.github.com/users/lnicola/events{/privacy}", "received_events_url": "https://api.github.com/users/lnicola/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "643bc02ded7141a462bc0c9357c8914f9d50fb06", "url": "https://api.github.com/repos/rust-lang/rust/commits/643bc02ded7141a462bc0c9357c8914f9d50fb06", "html_url": "https://github.com/rust-lang/rust/commit/643bc02ded7141a462bc0c9357c8914f9d50fb06"}], "stats": {"total": 87, "additions": 86, "deletions": 1}, "files": [{"sha": "24dcacdd72f0a5e01916f5fdbbb0f08be4da7de0", "filename": "Cargo.lock", "status": "modified", "additions": 47, "deletions": 0, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/34bc240e94059e7a66a622ebd7dd9c70624d9a6a/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/34bc240e94059e7a66a622ebd7dd9c70624d9a6a/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=34bc240e94059e7a66a622ebd7dd9c70624d9a6a", "patch": "@@ -112,6 +112,12 @@ version = \"1.3.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"bef38d45163c2f1dde094a7dfd33ccf595c92905c8f8f4fdc18d06fb1037718a\"\n \n+[[package]]\n+name = \"byteorder\"\n+version = \"1.4.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"14c189c53d098945499cdfa7ecc63567cf3886b3332b312a5b4585d8d3a6a610\"\n+\n [[package]]\n name = \"camino\"\n version = \"1.1.1\"\n@@ -1775,6 +1781,33 @@ dependencies = [\n  \"tikv-jemalloc-sys\",\n ]\n \n+[[package]]\n+name = \"time\"\n+version = \"0.3.17\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"a561bf4617eebd33bca6434b988f39ed798e527f51a1e797d0ee4f61c0a38376\"\n+dependencies = [\n+ \"itoa\",\n+ \"serde\",\n+ \"time-core\",\n+ \"time-macros\",\n+]\n+\n+[[package]]\n+name = \"time-core\"\n+version = \"0.1.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"2e153e1f1acaef8acc537e68b44906d2db6436e2b35ac2c6b42640fff91f00fd\"\n+\n+[[package]]\n+name = \"time-macros\"\n+version = \"0.2.6\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"d967f99f534ca7e495c575c62638eebc2898a8c84c119b89e250477bc4ba16b2\"\n+dependencies = [\n+ \"time-core\",\n+]\n+\n [[package]]\n name = \"tinyvec\"\n version = \"1.6.0\"\n@@ -2173,4 +2206,18 @@ dependencies = [\n  \"write-json\",\n  \"xflags\",\n  \"xshell\",\n+ \"zip\",\n+]\n+\n+[[package]]\n+name = \"zip\"\n+version = \"0.6.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"537ce7411d25e54e8ae21a7ce0b15840e7bfcff15b51d697ec3266cc76bdf080\"\n+dependencies = [\n+ \"byteorder\",\n+ \"crc32fast\",\n+ \"crossbeam-utils\",\n+ \"flate2\",\n+ \"time\",\n ]"}, {"sha": "a72c7eb91d7f5748859891654baa429648c7b4ef", "filename": "crates/rust-analyzer/tests/slow-tests/tidy.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/34bc240e94059e7a66a622ebd7dd9c70624d9a6a/crates%2Frust-analyzer%2Ftests%2Fslow-tests%2Ftidy.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34bc240e94059e7a66a622ebd7dd9c70624d9a6a/crates%2Frust-analyzer%2Ftests%2Fslow-tests%2Ftidy.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Ftests%2Fslow-tests%2Ftidy.rs?ref=34bc240e94059e7a66a622ebd7dd9c70624d9a6a", "patch": "@@ -194,6 +194,7 @@ MIT OR Apache-2.0\n MIT OR Apache-2.0 OR Zlib\n MIT OR Zlib OR Apache-2.0\n MIT/Apache-2.0\n+Unlicense OR MIT\n Unlicense/MIT\n Zlib OR Apache-2.0 OR MIT\n \""}, {"sha": "2dd01796c6e41b8b277f7f4f4b6a9743680c74ea", "filename": "xtask/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/34bc240e94059e7a66a622ebd7dd9c70624d9a6a/xtask%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/34bc240e94059e7a66a622ebd7dd9c70624d9a6a/xtask%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2FCargo.toml?ref=34bc240e94059e7a66a622ebd7dd9c70624d9a6a", "patch": "@@ -12,4 +12,5 @@ flate2 = \"1.0.24\"\n write-json = \"0.1.2\"\n xshell = \"0.2.2\"\n xflags = \"0.3.0\"\n+zip = { version = \"0.6\", default-features = false, features = [\"deflate\", \"time\"] }\n # Avoid adding more dependencies to this crate"}, {"sha": "74715c53eaac51b499b96531d371e055a4664830", "filename": "xtask/src/dist.rs", "status": "modified", "additions": 37, "deletions": 1, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/34bc240e94059e7a66a622ebd7dd9c70624d9a6a/xtask%2Fsrc%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34bc240e94059e7a66a622ebd7dd9c70624d9a6a/xtask%2Fsrc%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Fdist.rs?ref=34bc240e94059e7a66a622ebd7dd9c70624d9a6a", "patch": "@@ -1,12 +1,13 @@\n use std::{\n     env,\n     fs::File,\n-    io,\n+    io::{self, BufWriter},\n     path::{Path, PathBuf},\n };\n \n use flate2::{write::GzEncoder, Compression};\n use xshell::{cmd, Shell};\n+use zip::{write::FileOptions, DateTime, ZipWriter};\n \n use crate::{date_iso, flags, project_root};\n \n@@ -89,6 +90,9 @@ fn dist_server(sh: &Shell, release: &str, target: &Target) -> anyhow::Result<()>\n \n     let dst = Path::new(\"dist\").join(&target.artifact_name);\n     gzip(&target.server_path, &dst.with_extension(\"gz\"))?;\n+    if target_name.contains(\"-windows-\") {\n+        zip(&target.server_path, target.symbols_path.as_ref(), &dst.with_extension(\"zip\"))?;\n+    }\n \n     Ok(())\n }\n@@ -101,6 +105,38 @@ fn gzip(src_path: &Path, dest_path: &Path) -> anyhow::Result<()> {\n     Ok(())\n }\n \n+fn zip(src_path: &Path, symbols_path: Option<&PathBuf>, dest_path: &Path) -> anyhow::Result<()> {\n+    let file = File::create(dest_path)?;\n+    let mut writer = ZipWriter::new(BufWriter::new(file));\n+    writer.start_file(\n+        src_path.file_name().unwrap().to_str().unwrap(),\n+        FileOptions::default()\n+            .last_modified_time(\n+                DateTime::from_time(std::fs::metadata(src_path)?.modified()?.into()).unwrap(),\n+            )\n+            .unix_permissions(0o755)\n+            .compression_method(zip::CompressionMethod::Deflated)\n+            .compression_level(Some(9)),\n+    )?;\n+    let mut input = io::BufReader::new(File::open(src_path)?);\n+    io::copy(&mut input, &mut writer)?;\n+    if let Some(symbols_path) = symbols_path {\n+        writer.start_file(\n+            symbols_path.file_name().unwrap().to_str().unwrap(),\n+            FileOptions::default()\n+                .last_modified_time(\n+                    DateTime::from_time(std::fs::metadata(src_path)?.modified()?.into()).unwrap(),\n+                )\n+                .compression_method(zip::CompressionMethod::Deflated)\n+                .compression_level(Some(9)),\n+        )?;\n+        let mut input = io::BufReader::new(File::open(symbols_path)?);\n+        io::copy(&mut input, &mut writer)?;\n+    }\n+    writer.finish()?;\n+    Ok(())\n+}\n+\n struct Target {\n     name: String,\n     server_path: PathBuf,"}]}