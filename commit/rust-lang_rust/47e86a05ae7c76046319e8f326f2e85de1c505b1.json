{"sha": "47e86a05ae7c76046319e8f326f2e85de1c505b1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ3ZTg2YTA1YWU3Yzc2MDQ2MzE5ZThmMzI2ZjJlODVkZTFjNTA1YjE=", "commit": {"author": {"name": "Roy Frostig", "email": "rfrostig@mozilla.com", "date": "2010-08-31T20:01:51Z"}, "committer": {"name": "Roy Frostig", "email": "rfrostig@mozilla.com", "date": "2010-08-31T20:01:57Z"}, "message": "Fix rust_vec constructor assertion failure caused by slow path of upcall_vec_grow.  Add testcase.", "tree": {"sha": "fbd7ba67c002e7d4b9546504968ed0c967b876d9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fbd7ba67c002e7d4b9546504968ed0c967b876d9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/47e86a05ae7c76046319e8f326f2e85de1c505b1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/47e86a05ae7c76046319e8f326f2e85de1c505b1", "html_url": "https://github.com/rust-lang/rust/commit/47e86a05ae7c76046319e8f326f2e85de1c505b1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/47e86a05ae7c76046319e8f326f2e85de1c505b1/comments", "author": {"login": "froystig", "id": 123903, "node_id": "MDQ6VXNlcjEyMzkwMw==", "avatar_url": "https://avatars.githubusercontent.com/u/123903?v=4", "gravatar_id": "", "url": "https://api.github.com/users/froystig", "html_url": "https://github.com/froystig", "followers_url": "https://api.github.com/users/froystig/followers", "following_url": "https://api.github.com/users/froystig/following{/other_user}", "gists_url": "https://api.github.com/users/froystig/gists{/gist_id}", "starred_url": "https://api.github.com/users/froystig/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/froystig/subscriptions", "organizations_url": "https://api.github.com/users/froystig/orgs", "repos_url": "https://api.github.com/users/froystig/repos", "events_url": "https://api.github.com/users/froystig/events{/privacy}", "received_events_url": "https://api.github.com/users/froystig/received_events", "type": "User", "site_admin": false}, "committer": {"login": "froystig", "id": 123903, "node_id": "MDQ6VXNlcjEyMzkwMw==", "avatar_url": "https://avatars.githubusercontent.com/u/123903?v=4", "gravatar_id": "", "url": "https://api.github.com/users/froystig", "html_url": "https://github.com/froystig", "followers_url": "https://api.github.com/users/froystig/followers", "following_url": "https://api.github.com/users/froystig/following{/other_user}", "gists_url": "https://api.github.com/users/froystig/gists{/gist_id}", "starred_url": "https://api.github.com/users/froystig/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/froystig/subscriptions", "organizations_url": "https://api.github.com/users/froystig/orgs", "repos_url": "https://api.github.com/users/froystig/repos", "events_url": "https://api.github.com/users/froystig/events{/privacy}", "received_events_url": "https://api.github.com/users/froystig/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "11e747fc5835680ba2a78b3cbc277f93e07362a4", "url": "https://api.github.com/repos/rust-lang/rust/commits/11e747fc5835680ba2a78b3cbc277f93e07362a4", "html_url": "https://github.com/rust-lang/rust/commit/11e747fc5835680ba2a78b3cbc277f93e07362a4"}], "stats": {"total": 22, "additions": 19, "deletions": 3}, "files": [{"sha": "6f12b24d36113d18c08807490165d1dad321372b", "filename": "src/rt/rust_upcall.cpp", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/47e86a05ae7c76046319e8f326f2e85de1c505b1/src%2Frt%2Frust_upcall.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/47e86a05ae7c76046319e8f326f2e85de1c505b1/src%2Frt%2Frust_upcall.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_upcall.cpp?ref=47e86a05ae7c76046319e8f326f2e85de1c505b1", "patch": "@@ -381,7 +381,7 @@ upcall_vec_grow(rust_task *task, rust_vec *v, size_t n_bytes, uintptr_t is_gc)\n     LOG_UPCALL_ENTRY(task);\n     rust_dom *dom = task->dom;\n     task->log(rust_log::UPCALL|rust_log::MEM,\n-             \"upcall vec_grow(%\" PRIxPTR \", %\" PRIdPTR\n+             \"upcall vec_grow(0x%\" PRIxPTR \", %\" PRIdPTR\n              \"), alloc=%\" PRIdPTR \", fill=%\" PRIdPTR,\n              v, n_bytes, v->alloc, v->fill);\n     size_t alloc = next_power_of_two(sizeof(rust_vec) + v->fill + n_bytes);\n@@ -411,7 +411,8 @@ upcall_vec_grow(rust_task *task, rust_vec *v, size_t n_bytes, uintptr_t is_gc)\n             return NULL;\n         }\n         v->deref();\n-        v = new (mem) rust_vec(dom, alloc, v->fill, &v->data[0]);\n+        v = new (mem) rust_vec(dom, alloc, v->fill,\n+                               v->fill ? &v->data[0] : NULL);\n     }\n     I(dom, sizeof(rust_vec) + v->fill <= v->alloc);\n     return v;"}, {"sha": "e52c628337ae6ddb291db0f9311557e03171cbb8", "filename": "src/test/run-pass/vec-append.rs", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/47e86a05ae7c76046319e8f326f2e85de1c505b1/src%2Ftest%2Frun-pass%2Fvec-append.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47e86a05ae7c76046319e8f326f2e85de1c505b1/src%2Ftest%2Frun-pass%2Fvec-append.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fvec-append.rs?ref=47e86a05ae7c76046319e8f326f2e85de1c505b1", "patch": "@@ -1,10 +1,25 @@\n // -*- rust -*-\n \n-fn main() {\n+fn fast_growth() {\n   let vec[int] v = vec(1,2,3,4,5);\n   v += vec(6,7,8,9,0);\n+\n   log v.(9);\n   check(v.(0) == 1);\n   check(v.(7) == 8);\n   check(v.(9) == 0);\n }\n+\n+fn slow_growth() {\n+  let vec[int] v = vec();\n+  let vec[int] u = v;\n+  v += vec(17);\n+\n+  log v.(0);\n+  check (v.(0) == 17);\n+}\n+\n+fn main() {\n+  fast_growth();\n+  slow_growth();\n+}"}]}