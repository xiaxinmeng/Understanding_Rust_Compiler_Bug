{"sha": "891fffef0ced6a62406db1b9c7742cc064af96ba", "node_id": "C_kwDOAAsO6NoAKDg5MWZmZmVmMGNlZDZhNjI0MDZkYjFiOWM3NzQyY2MwNjRhZjk2YmE", "commit": {"author": {"name": "Caio", "email": "c410.f3r@gmail.com", "date": "2023-05-14T02:24:33Z"}, "committer": {"name": "Caio", "email": "c410.f3r@gmail.com", "date": "2023-05-14T02:24:33Z"}, "message": "Consider referenced allowed or hard-coded types", "tree": {"sha": "0e6d6037a301c4bda4dd7c549396422a57908218", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0e6d6037a301c4bda4dd7c549396422a57908218"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/891fffef0ced6a62406db1b9c7742cc064af96ba", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/891fffef0ced6a62406db1b9c7742cc064af96ba", "html_url": "https://github.com/rust-lang/rust/commit/891fffef0ced6a62406db1b9c7742cc064af96ba", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/891fffef0ced6a62406db1b9c7742cc064af96ba/comments", "author": {"login": "c410-f3r", "id": 17877264, "node_id": "MDQ6VXNlcjE3ODc3MjY0", "avatar_url": "https://avatars.githubusercontent.com/u/17877264?v=4", "gravatar_id": "", "url": "https://api.github.com/users/c410-f3r", "html_url": "https://github.com/c410-f3r", "followers_url": "https://api.github.com/users/c410-f3r/followers", "following_url": "https://api.github.com/users/c410-f3r/following{/other_user}", "gists_url": "https://api.github.com/users/c410-f3r/gists{/gist_id}", "starred_url": "https://api.github.com/users/c410-f3r/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/c410-f3r/subscriptions", "organizations_url": "https://api.github.com/users/c410-f3r/orgs", "repos_url": "https://api.github.com/users/c410-f3r/repos", "events_url": "https://api.github.com/users/c410-f3r/events{/privacy}", "received_events_url": "https://api.github.com/users/c410-f3r/received_events", "type": "User", "site_admin": false}, "committer": {"login": "c410-f3r", "id": 17877264, "node_id": "MDQ6VXNlcjE3ODc3MjY0", "avatar_url": "https://avatars.githubusercontent.com/u/17877264?v=4", "gravatar_id": "", "url": "https://api.github.com/users/c410-f3r", "html_url": "https://github.com/c410-f3r", "followers_url": "https://api.github.com/users/c410-f3r/followers", "following_url": "https://api.github.com/users/c410-f3r/following{/other_user}", "gists_url": "https://api.github.com/users/c410-f3r/gists{/gist_id}", "starred_url": "https://api.github.com/users/c410-f3r/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/c410-f3r/subscriptions", "organizations_url": "https://api.github.com/users/c410-f3r/orgs", "repos_url": "https://api.github.com/users/c410-f3r/repos", "events_url": "https://api.github.com/users/c410-f3r/events{/privacy}", "received_events_url": "https://api.github.com/users/c410-f3r/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1407c7627e91e8d4472749ac9ea45d9f8a3aaab6", "url": "https://api.github.com/repos/rust-lang/rust/commits/1407c7627e91e8d4472749ac9ea45d9f8a3aaab6", "html_url": "https://github.com/rust-lang/rust/commit/1407c7627e91e8d4472749ac9ea45d9f8a3aaab6"}], "stats": {"total": 18, "additions": 13, "deletions": 5}, "files": [{"sha": "c80e2ff7057e3aa92fee3526db97b07db1a84c53", "filename": "clippy_lints/src/operators/arithmetic_side_effects.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/891fffef0ced6a62406db1b9c7742cc064af96ba/clippy_lints%2Fsrc%2Foperators%2Farithmetic_side_effects.rs", "raw_url": "https://github.com/rust-lang/rust/raw/891fffef0ced6a62406db1b9c7742cc064af96ba/clippy_lints%2Fsrc%2Foperators%2Farithmetic_side_effects.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Foperators%2Farithmetic_side_effects.rs?ref=891fffef0ced6a62406db1b9c7742cc064af96ba", "patch": "@@ -21,7 +21,7 @@ const HARD_CODED_ALLOWED_BINARY: &[[&str; 2]] = &[\n     [\"f64\", \"f64\"],\n     [\"std::num::Saturating\", \"std::num::Saturating\"],\n     [\"std::num::Wrapping\", \"std::num::Wrapping\"],\n-    [\"std::string::String\", \"&str\"],\n+    [\"std::string::String\", \"str\"],\n ];\n const HARD_CODED_ALLOWED_UNARY: &[&str] = &[\"f32\", \"f64\", \"std::num::Saturating\", \"std::num::Wrapping\"];\n const INTEGER_METHODS: &[&str] = &[\"saturating_div\", \"wrapping_div\", \"wrapping_rem\", \"wrapping_rem_euclid\"];\n@@ -144,8 +144,10 @@ impl ArithmeticSideEffects {\n         ) {\n             return;\n         };\n-        let lhs_ty = cx.typeck_results().expr_ty(lhs);\n-        let rhs_ty = cx.typeck_results().expr_ty(rhs);\n+        let (actual_lhs, lhs_ref_counter) = peel_hir_expr_refs(lhs);\n+        let (actual_rhs, rhs_ref_counter) = peel_hir_expr_refs(rhs);\n+        let lhs_ty = cx.typeck_results().expr_ty(actual_lhs).peel_refs();\n+        let rhs_ty = cx.typeck_results().expr_ty(actual_rhs).peel_refs();\n         if self.has_allowed_binary(lhs_ty, rhs_ty) {\n             return;\n         }\n@@ -154,8 +156,6 @@ impl ArithmeticSideEffects {\n                 // At least for integers, shifts are already handled by the CTFE\n                 return;\n             }\n-            let (actual_lhs, lhs_ref_counter) = peel_hir_expr_refs(lhs);\n-            let (actual_rhs, rhs_ref_counter) = peel_hir_expr_refs(rhs);\n             match (\n                 Self::literal_integer(cx, actual_lhs),\n                 Self::literal_integer(cx, actual_rhs),"}, {"sha": "f95af1017bcbbfc01efcd64fa1466a0dd915d6ac", "filename": "tests/ui/arithmetic_side_effects.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/891fffef0ced6a62406db1b9c7742cc064af96ba/tests%2Fui%2Farithmetic_side_effects.rs", "raw_url": "https://github.com/rust-lang/rust/raw/891fffef0ced6a62406db1b9c7742cc064af96ba/tests%2Fui%2Farithmetic_side_effects.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Farithmetic_side_effects.rs?ref=891fffef0ced6a62406db1b9c7742cc064af96ba", "patch": "@@ -458,4 +458,12 @@ pub fn issue_10583(a: u16) -> u16 {\n     10 / a\n }\n \n+pub fn issue_10767() {\n+    let n = &1.0;\n+    n + n;\n+    3.1_f32 + &1.2_f32;\n+    &3.4_f32 + 1.5_f32;\n+    &3.5_f32 + &1.3_f32;\n+}\n+\n fn main() {}"}]}