{"sha": "5656510eed663b5d5be6b6df3d033b836da5f759", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU2NTY1MTBlZWQ2NjNiNWQ1YmU2YjZkZjNkMDMzYjgzNmRhNWY3NTk=", "commit": {"author": {"name": "daxpedda", "email": "daxpedda@gmail.com", "date": "2021-03-03T16:32:49Z"}, "committer": {"name": "daxpedda", "email": "daxpedda@gmail.com", "date": "2021-03-03T16:32:49Z"}, "message": "Fix false-positive in `use_self`", "tree": {"sha": "9432952ac9168e9d1fb34516f3636ac7c7bb62c8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9432952ac9168e9d1fb34516f3636ac7c7bb62c8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5656510eed663b5d5be6b6df3d033b836da5f759", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE3qx/rJh59vdc2+v9Q9YqPqOI5G8FAmA/ujEACgkQQ9YqPqOI\n5G92gA//QnyDgN43IdQJcHMBUbkmlIyapJAZS7Ts6A7YCS+dgO3CZcZFtCbfRPZ8\ngnaQhKz/TSB/xQyEJWUDEuc5dFyZnqq1Yq77Idychd+WN5EXnqGc0UgBkCTcCRKl\nYSK7J5jjV0UbCZy0BpbBjBzpTC/aiPEeaTVWzBV0nt7P9ZBsYWf8ZRLvIVlJwpdJ\nAJtFAhyrNm7rx/+ncIPJ94ITeXRj++FMSgayg+WzVH1OggECMiPtml6s8j9bg2rj\nc+m2byQXtVMQkCCztQRuhl4pPLRTA/ifaVZ7+4QXQw12+3k9RMWrx0LzIoaNqzzD\n1wcYREGY55rndbwbgcTZOEI0GXRQ5axF0gx0Q8KKZ+Ac968oYe2vG4xFRWtYZSdO\nBN+tB02mVE4apshNPj0tu5d42clI4h/7zJYLvbmAJZSCPAqajWlG4WiGOtL4k5VW\nAFwA91DjJ6iZrA/SUpA+Hk1UQpZEk70adsPhuvYqCFlrXj1OMAKpkCXbnLPhcA7D\nzZtbjhMlgGYEzvOZvosSM+7/Q3KfaFG0lXic9ehuYTzmqzztrLN5Nc5vdZoH19Pw\nOpTiSSMo5pzbXEdOt3SIgvW/mL7/UEZzR5ZFtxmDrqwdrCOGPG7JNeuJoZtmowsx\ngtLxlWF2e+3SHPKRNMw83dVNYlV31o7jGo1J/p26ZpBEjYsyQ9I=\n=9nzX\n-----END PGP SIGNATURE-----", "payload": "tree 9432952ac9168e9d1fb34516f3636ac7c7bb62c8\nparent 43d19f63f7c6007284387e76cfe0fe8b74e98a59\nauthor daxpedda <daxpedda@gmail.com> 1614789169 +0100\ncommitter daxpedda <daxpedda@gmail.com> 1614789169 +0100\n\nFix false-positive in `use_self`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5656510eed663b5d5be6b6df3d033b836da5f759", "html_url": "https://github.com/rust-lang/rust/commit/5656510eed663b5d5be6b6df3d033b836da5f759", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5656510eed663b5d5be6b6df3d033b836da5f759/comments", "author": {"login": "daxpedda", "id": 1645124, "node_id": "MDQ6VXNlcjE2NDUxMjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1645124?v=4", "gravatar_id": "", "url": "https://api.github.com/users/daxpedda", "html_url": "https://github.com/daxpedda", "followers_url": "https://api.github.com/users/daxpedda/followers", "following_url": "https://api.github.com/users/daxpedda/following{/other_user}", "gists_url": "https://api.github.com/users/daxpedda/gists{/gist_id}", "starred_url": "https://api.github.com/users/daxpedda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/daxpedda/subscriptions", "organizations_url": "https://api.github.com/users/daxpedda/orgs", "repos_url": "https://api.github.com/users/daxpedda/repos", "events_url": "https://api.github.com/users/daxpedda/events{/privacy}", "received_events_url": "https://api.github.com/users/daxpedda/received_events", "type": "User", "site_admin": false}, "committer": {"login": "daxpedda", "id": 1645124, "node_id": "MDQ6VXNlcjE2NDUxMjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1645124?v=4", "gravatar_id": "", "url": "https://api.github.com/users/daxpedda", "html_url": "https://github.com/daxpedda", "followers_url": "https://api.github.com/users/daxpedda/followers", "following_url": "https://api.github.com/users/daxpedda/following{/other_user}", "gists_url": "https://api.github.com/users/daxpedda/gists{/gist_id}", "starred_url": "https://api.github.com/users/daxpedda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/daxpedda/subscriptions", "organizations_url": "https://api.github.com/users/daxpedda/orgs", "repos_url": "https://api.github.com/users/daxpedda/repos", "events_url": "https://api.github.com/users/daxpedda/events{/privacy}", "received_events_url": "https://api.github.com/users/daxpedda/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "43d19f63f7c6007284387e76cfe0fe8b74e98a59", "url": "https://api.github.com/repos/rust-lang/rust/commits/43d19f63f7c6007284387e76cfe0fe8b74e98a59", "html_url": "https://github.com/rust-lang/rust/commit/43d19f63f7c6007284387e76cfe0fe8b74e98a59"}], "stats": {"total": 31, "additions": 25, "deletions": 6}, "files": [{"sha": "c262ec993b1f41ece5e4cf4dd2340ea88e33079d", "filename": "clippy_lints/src/use_self.rs", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/5656510eed663b5d5be6b6df3d033b836da5f759/clippy_lints%2Fsrc%2Fuse_self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5656510eed663b5d5be6b6df3d033b836da5f759/clippy_lints%2Fsrc%2Fuse_self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fuse_self.rs?ref=5656510eed663b5d5be6b6df3d033b836da5f759", "patch": "@@ -262,12 +262,17 @@ impl<'tcx> LateLintPass<'tcx> for UseSelf {\n             // FIXME: this span manipulation should not be necessary\n             // @flip1995 found an ast lowering issue in\n             // https://github.com/rust-lang/rust/blob/master/src/librustc_ast_lowering/path.rs#l142-l162\n-            match cx.tcx.hir().find(cx.tcx.hir().get_parent_node(hir_ty.hir_id)) {\n-                Some(Node::Expr(Expr {\n-                    kind: ExprKind::Path(QPath::TypeRelative(_, segment)),\n-                    ..\n-                })) => span_lint_until_last_segment(cx, hir_ty.span, segment),\n-                _ => span_lint(cx, hir_ty.span),\n+            let hir = cx.tcx.hir();\n+            let id = hir.get_parent_node(hir_ty.hir_id);\n+\n+            if !hir.opt_span(id).map(in_macro).unwrap_or(false) {\n+                match hir.find(id) {\n+                    Some(Node::Expr(Expr {\n+                        kind: ExprKind::Path(QPath::TypeRelative(_, segment)),\n+                        ..\n+                    })) => span_lint_until_last_segment(cx, hir_ty.span, segment),\n+                    _ => span_lint(cx, hir_ty.span),\n+                }\n             }\n         }\n     }"}, {"sha": "a630936e3b1d01ecd6b1d048146ad42e709a8741", "filename": "tests/ui/use_self.fixed", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/5656510eed663b5d5be6b6df3d033b836da5f759/tests%2Fui%2Fuse_self.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/5656510eed663b5d5be6b6df3d033b836da5f759/tests%2Fui%2Fuse_self.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuse_self.fixed?ref=5656510eed663b5d5be6b6df3d033b836da5f759", "patch": "@@ -454,3 +454,10 @@ mod nested_paths {\n         }\n     }\n }\n+\n+mod issue6818 {\n+    #[derive(serde::Deserialize)]\n+    struct A {\n+        a: i32,\n+    }\n+}"}, {"sha": "f3e081dd2032856984d394b41cf2ce84d6896c77", "filename": "tests/ui/use_self.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/5656510eed663b5d5be6b6df3d033b836da5f759/tests%2Fui%2Fuse_self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5656510eed663b5d5be6b6df3d033b836da5f759/tests%2Fui%2Fuse_self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuse_self.rs?ref=5656510eed663b5d5be6b6df3d033b836da5f759", "patch": "@@ -454,3 +454,10 @@ mod nested_paths {\n         }\n     }\n }\n+\n+mod issue6818 {\n+    #[derive(serde::Deserialize)]\n+    struct A {\n+        a: i32,\n+    }\n+}"}]}