{"sha": "f986d78c5e6d401ea3c57c7d00d24d1890675f0c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY5ODZkNzhjNWU2ZDQwMWVhM2M1N2M3ZDAwZDI0ZDE4OTA2NzVmMGM=", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2020-12-23T00:21:31Z"}, "committer": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-01-23T01:18:11Z"}, "message": "cargo dev crater: support multiple versions per crate", "tree": {"sha": "af31baa3df2967f8a256e23d23004a9a0c4a4875", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/af31baa3df2967f8a256e23d23004a9a0c4a4875"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f986d78c5e6d401ea3c57c7d00d24d1890675f0c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f986d78c5e6d401ea3c57c7d00d24d1890675f0c", "html_url": "https://github.com/rust-lang/rust/commit/f986d78c5e6d401ea3c57c7d00d24d1890675f0c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f986d78c5e6d401ea3c57c7d00d24d1890675f0c/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "588efa7da9af41e79f51935efeb9919ccef97f44", "url": "https://api.github.com/repos/rust-lang/rust/commits/588efa7da9af41e79f51935efeb9919ccef97f44", "html_url": "https://github.com/rust-lang/rust/commit/588efa7da9af41e79f51935efeb9919ccef97f44"}], "stats": {"total": 66, "additions": 43, "deletions": 23}, "files": [{"sha": "1fbf7930d3ecf4a9da72573335cdace66a1bf697", "filename": "clippy_dev/crater_crates.toml", "status": "modified", "additions": 17, "deletions": 17, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/f986d78c5e6d401ea3c57c7d00d24d1890675f0c/clippy_dev%2Fcrater_crates.toml", "raw_url": "https://github.com/rust-lang/rust/raw/f986d78c5e6d401ea3c57c7d00d24d1890675f0c/clippy_dev%2Fcrater_crates.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fcrater_crates.toml?ref=f986d78c5e6d401ea3c57c7d00d24d1890675f0c", "patch": "@@ -1,20 +1,20 @@\n [crates]\n # some of these are from cargotest\n-cargo = '0.49.0'\n-iron = '0.6.1'\n-ripgrep = '12.1.1'\n-xsv = '0.13.0'\n-#tokei = '12.0.4'\n-rayon = '1.5.0'\n-serde = '1.0.118'\n+cargo = ['0.49.0']\n+iron = ['0.6.1']\n+ripgrep = ['12.1.1']\n+xsv = ['0.13.0']\n+#tokei = ['12.0.4']\n+rayon = ['1.5.0']\n+serde = ['1.0.118']\n # top 10 crates.io dls\n-bitflags = '1.2.1'\n-libc = '0.2.81'\n-log = '0.4.11'\n-proc-macro2 = '1.0.24'\n-quote = '1.0.7'\n-rand = '0.7.3'\n-rand_core = '0.6.0'\n-regex = '1.3.2'\n-syn = '1.0.54'\n-unicode-xid = '0.2.1'\n+bitflags = ['1.2.1']\n+libc = ['0.2.81']\n+log = ['0.4.11']\n+proc-macro2 = ['1.0.24']\n+quote = ['1.0.7']\n+rand = ['0.7.3']\n+rand_core = ['0.6.0']\n+regex = ['1.3.2']\n+syn = ['1.0.54']\n+unicode-xid = ['0.2.1']"}, {"sha": "a681bf10496d83009d2c032b61537788ecb3282f", "filename": "clippy_dev/src/crater.rs", "status": "modified", "additions": 26, "deletions": 6, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/f986d78c5e6d401ea3c57c7d00d24d1890675f0c/clippy_dev%2Fsrc%2Fcrater.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f986d78c5e6d401ea3c57c7d00d24d1890675f0c/clippy_dev%2Fsrc%2Fcrater.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fcrater.rs?ref=f986d78c5e6d401ea3c57c7d00d24d1890675f0c", "patch": "@@ -6,17 +6,24 @@ use std::collections::HashMap;\n use std::process::Command;\n use std::{fs::write, path::PathBuf};\n \n+// crate data we stored in the toml, can have multiple versions.\n+// if so, one TomlKrate maps to several KrateSources\n+struct TomlKrate {\n+    name: String,\n+    versions: Vec<String>,\n+}\n+\n // represents an archive we download from crates.io\n #[derive(Debug, Serialize, Deserialize, Eq, Hash, PartialEq)]\n struct KrateSource {\n-    version: String,\n     name: String,\n+    version: String,\n }\n \n // use this to store the crates when interacting with the crates.toml file\n #[derive(Debug, Serialize, Deserialize)]\n struct CrateList {\n-    crates: HashMap<String, String>,\n+    crates: HashMap<String, Vec<String>>,\n }\n \n // represents the extracted sourcecode of a crate\n@@ -145,11 +152,24 @@ fn read_crates() -> Vec<KrateSource> {\n     let crate_list: CrateList =\n         toml::from_str(&toml_content).unwrap_or_else(|e| panic!(\"Failed to parse {}: \\n{}\", toml_path.display(), e));\n     // parse the hashmap of the toml file into a list of crates\n-    crate_list\n+    let tomlkrates: Vec<TomlKrate> = crate_list\n         .crates\n-        .iter()\n-        .map(|(name, version)| KrateSource::new(&name, &version))\n-        .collect()\n+        .into_iter()\n+        .map(|(name, versions)| TomlKrate { name, versions })\n+        .collect();\n+\n+    // flatten TomlKrates into KrateSources (one TomlKrates may represent several versions of a crate =>\n+    // multiple kratesources)\n+    let mut krate_sources = Vec::new();\n+    tomlkrates.into_iter().for_each(|tk| {\n+        tk.versions.iter().for_each(|ver| {\n+            krate_sources.push(KrateSource {\n+                name: tk.name.clone(),\n+                version: ver.to_string(),\n+            });\n+        })\n+    });\n+    krate_sources\n }\n \n // the main fn"}]}