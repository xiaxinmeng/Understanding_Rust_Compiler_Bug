{"sha": "9c495b30efd1ccbe34bf3a877df0a7a55f6444f9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjljNDk1YjMwZWZkMWNjYmUzNGJmM2E4NzdkZjBhN2E1NWY2NDQ0Zjk=", "commit": {"author": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2021-06-20T00:13:23Z"}, "committer": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2021-06-20T00:13:23Z"}, "message": "\"(const: unstable)\" for stable-but-const-unstable", "tree": {"sha": "d24e9e218b3695c80961ee895fc147265b05366f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d24e9e218b3695c80961ee895fc147265b05366f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9c495b30efd1ccbe34bf3a877df0a7a55f6444f9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEjbeLZzPb62/vY3smZSV3NIU3bZIFAmDOiEEACgkQZSV3NIU3\nbZId2BAAhpj+uUbiQd46n05j7D13NuIuUxh0f94mX4v5UD/RjzLIX24ybnV6SZyd\nvtcqbpMR7jgj5GR+Kck/MsDcOwa0Fi4JrcgBrRQstAJDJpUtjcHNyWDgj4AKTAh5\nDXRupOmrlLZdpkz3W3Dbzy1MLzSH16hbLaTrR5pQbiA68cv5/x6aIaZO7vBDyFqn\nk4sG5QLvlwdvBw9fD/9x8gGwmUKpNZXsPTcDgabyAdnxUpGcfdNY993ICRST12Nh\nrnnlzgtXDLXAJxyIr64y3vkrqoh4r0FqRelnsGAuhInYqM+Qp/uDtcBT+OJAiNu2\ngZNQEmU2fqcDTXJtp4QsllbRBZibRslw04Qs0NslDgDL9QPqVdv03Io8DbR043TC\nwQTnEtI15pLU2rgX5FyFzMjgQa+7FZiZfjzksNRvjlNm4Zteqvx9e4hfxZ2szFlh\nltFIKCK/r6vNZhwnCfBaB8wxH10zzei+CKOsMau9FXchBSY0qr6rQdFUvvTvKO8T\nDOdrvWf0Gs1/M7a9ciSyLXT2pcq1UV0Jg05LAGtmLyO38wxXVtp4zVGzKOnj8BsU\notyC0gvgETERmAz9znjrRmcfd1pD59M2lHIPFDm1yJXFJno2qoXYF7iPFSpfC+BS\nfS2gGBZDA7KGVFJpx5WXUhk3MHkKsbLxeSznxYTXoLRCqwAzraM=\n=K6TM\n-----END PGP SIGNATURE-----", "payload": "tree d24e9e218b3695c80961ee895fc147265b05366f\nparent 39260f6d4994db191f2fca9f12b4930eb3a3c122\nauthor Deadbeef <ent3rm4n@gmail.com> 1624148003 +0800\ncommitter Deadbeef <ent3rm4n@gmail.com> 1624148003 +0800\n\n\"(const: unstable)\" for stable-but-const-unstable\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9c495b30efd1ccbe34bf3a877df0a7a55f6444f9", "html_url": "https://github.com/rust-lang/rust/commit/9c495b30efd1ccbe34bf3a877df0a7a55f6444f9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9c495b30efd1ccbe34bf3a877df0a7a55f6444f9/comments", "author": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "39260f6d4994db191f2fca9f12b4930eb3a3c122", "url": "https://api.github.com/repos/rust-lang/rust/commits/39260f6d4994db191f2fca9f12b4930eb3a3c122", "html_url": "https://github.com/rust-lang/rust/commit/39260f6d4994db191f2fca9f12b4930eb3a3c122"}], "stats": {"total": 42, "additions": 33, "deletions": 9}, "files": [{"sha": "16df17372b011a9135031d936a5fa5e37ef52051", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 29, "deletions": 7, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/9c495b30efd1ccbe34bf3a877df0a7a55f6444f9/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c495b30efd1ccbe34bf3a877df0a7a55f6444f9/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=9c495b30efd1ccbe34bf3a877df0a7a55f6444f9", "patch": "@@ -42,7 +42,7 @@ use std::str;\n use std::string::ToString;\n \n use rustc_ast_pretty::pprust;\n-use rustc_attr::{Deprecation, StabilityLevel};\n+use rustc_attr::{ConstStability, Deprecation, StabilityLevel};\n use rustc_data_structures::fx::FxHashSet;\n use rustc_hir as hir;\n use rustc_hir::def::CtorKind;\n@@ -826,20 +826,42 @@ fn assoc_type(\n fn render_stability_since_raw(\n     w: &mut Buffer,\n     ver: Option<&str>,\n-    const_ver: Option<&str>,\n+    const_stability: Option<&ConstStability>,\n     containing_ver: Option<&str>,\n     containing_const_ver: Option<&str>,\n ) {\n     let ver = ver.filter(|inner| !inner.is_empty());\n-    let const_ver = const_ver.filter(|inner| !inner.is_empty());\n \n-    match (ver, const_ver) {\n-        (Some(v), Some(cv)) if const_ver != containing_const_ver => {\n+    match (ver, const_stability) {\n+        (Some(v), Some(ConstStability { level: StabilityLevel::Stable { since }, .. }))\n+            if Some(since.as_str()).as_deref() != containing_const_ver =>\n+        {\n             write!(\n                 w,\n                 \"<span class=\\\"since\\\" title=\\\"Stable since Rust version {0}, const since {1}\\\">{0} (const: {1})</span>\",\n-                v, cv\n+                v,\n+                since.as_str()\n+            );\n+        }\n+        (\n+            Some(v),\n+            Some(ConstStability { level: StabilityLevel::Unstable { issue, .. }, feature, .. }),\n+        ) => {\n+            write!(\n+                w,\n+                \"<span class=\\\"since\\\" title=\\\"Stable since Rust version {0}, const unstable\\\">{0} (const: \",\n+                v\n             );\n+            if let Some(n) = issue {\n+                write!(\n+                    w,\n+                    \"<a href=\\\"https://github.com/rust-lang/rust/issues/{}\\\" title=\\\"Tracking issue for {}\\\">unstable</a>\",\n+                    n, feature\n+                );\n+            } else {\n+                write!(w, \"unstable\");\n+            }\n+            write!(w, \")</span>\");\n         }\n         (Some(v), _) if ver != containing_ver => {\n             write!(\n@@ -1583,7 +1605,7 @@ fn render_rightside(\n     render_stability_since_raw(\n         w,\n         item.stable_since(tcx).as_deref(),\n-        item.const_stable_since(tcx).as_deref(),\n+        item.const_stability(tcx),\n         containing_item.stable_since(tcx).as_deref(),\n         containing_item.const_stable_since(tcx).as_deref(),\n     );"}, {"sha": "1340040fa8f06eb844ea7627a435e95f02d17f6c", "filename": "src/librustdoc/html/render/print_item.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9c495b30efd1ccbe34bf3a877df0a7a55f6444f9/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c495b30efd1ccbe34bf3a877df0a7a55f6444f9/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fprint_item.rs?ref=9c495b30efd1ccbe34bf3a877df0a7a55f6444f9", "patch": "@@ -94,7 +94,7 @@ pub(super) fn print_item(cx: &Context<'_>, item: &clean::Item, buf: &mut Buffer,\n     render_stability_since_raw(\n         buf,\n         item.stable_since(cx.tcx()).as_deref(),\n-        item.const_stable_since(cx.tcx()).as_deref(),\n+        item.const_stability(cx.tcx()),\n         None,\n         None,\n     );\n@@ -1291,7 +1291,7 @@ fn render_stability_since(\n     render_stability_since_raw(\n         w,\n         item.stable_since(tcx).as_deref(),\n-        item.const_stable_since(tcx).as_deref(),\n+        item.const_stability(tcx),\n         containing_item.stable_since(tcx).as_deref(),\n         containing_item.const_stable_since(tcx).as_deref(),\n     )"}, {"sha": "41a511f7165814844d155474966f4cc518b4c33f", "filename": "src/test/rustdoc/const-display.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9c495b30efd1ccbe34bf3a877df0a7a55f6444f9/src%2Ftest%2Frustdoc%2Fconst-display.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9c495b30efd1ccbe34bf3a877df0a7a55f6444f9/src%2Ftest%2Frustdoc%2Fconst-display.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fconst-display.rs?ref=9c495b30efd1ccbe34bf3a877df0a7a55f6444f9", "patch": "@@ -8,6 +8,7 @@\n #![feature(staged_api)]\n \n // @has 'foo/fn.foo.html' '//pre' 'pub unsafe fn foo() -> u32'\n+// @has - '//span[@class=\"since\"]' '1.0.0 (const: unstable)'\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n #[rustc_const_unstable(feature=\"foo\", issue = \"none\")]\n pub const unsafe fn foo() -> u32 { 42 }\n@@ -39,6 +40,7 @@ pub struct Foo;\n \n impl Foo {\n     // @has 'foo/struct.Foo.html' '//div[@id=\"method.gated\"]/code' 'pub unsafe fn gated() -> u32'\n+    // @has - '//span[@class=\"since\"]' '1.0.0 (const: unstable)'\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     #[rustc_const_unstable(feature=\"foo\", issue = \"none\")]\n     pub const unsafe fn gated() -> u32 { 42 }"}]}