{"sha": "3e482d5f69ffb56f0503e783b50599ec0d873dec", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNlNDgyZDVmNjlmZmI1NmYwNTAzZTc4M2I1MDU5OWVjMGQ4NzNkZWM=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2010-11-09T23:35:40Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2010-11-09T23:38:42Z"}, "message": "Implement a map2() function in std._vec", "tree": {"sha": "0ecf537aee28d13858d193b49cab130d8dbaa892", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0ecf537aee28d13858d193b49cab130d8dbaa892"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3e482d5f69ffb56f0503e783b50599ec0d873dec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3e482d5f69ffb56f0503e783b50599ec0d873dec", "html_url": "https://github.com/rust-lang/rust/commit/3e482d5f69ffb56f0503e783b50599ec0d873dec", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3e482d5f69ffb56f0503e783b50599ec0d873dec/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "89946609f2de815ea87df3b001fff0caf9efa0d5", "url": "https://api.github.com/repos/rust-lang/rust/commits/89946609f2de815ea87df3b001fff0caf9efa0d5", "html_url": "https://github.com/rust-lang/rust/commit/89946609f2de815ea87df3b001fff0caf9efa0d5"}], "stats": {"total": 37, "additions": 36, "deletions": 1}, "files": [{"sha": "2ffe8bad08b3e4eb1fdf2bc973282cdcb9ed431b", "filename": "src/lib/_vec.rs", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/3e482d5f69ffb56f0503e783b50599ec0d873dec/src%2Flib%2F_vec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e482d5f69ffb56f0503e783b50599ec0d873dec/src%2Flib%2F_vec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib%2F_vec.rs?ref=3e482d5f69ffb56f0503e783b50599ec0d873dec", "patch": "@@ -1,6 +1,8 @@\n import vbuf = rustrt.vbuf;\n import std.option;\n \n+type operator2[T,U,V] = fn(&T, &U) -> V;\n+\n native \"rust\" mod rustrt {\n     type vbuf;\n \n@@ -142,6 +144,22 @@ fn map[T, U](&option.operator[T,U] f, &vec[T] v) -> vec[U] {\n     ret u;\n }\n \n+fn map2[T,U,V](&operator2[T,U,V] f, &vec[T] v0, &vec[U] v1) -> vec[V] {\n+    auto v0_len = len[T](v0);\n+    if (v0_len != len[U](v1)) {\n+        fail;\n+    }\n+\n+    let vec[V] u = alloc[V](v0_len);\n+    auto i = 0u;\n+    while (i < v0_len) {\n+        u += f(v0.(i), v1.(i));\n+        i += 1u;\n+    }\n+\n+    ret u;\n+}\n+\n // Local Variables:\n // mode: rust;\n // fill-column: 78;"}, {"sha": "4d6166483bcf2cbec936c67b9a014ad832db1535", "filename": "src/test/run-pass/lib-vec.rs", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/3e482d5f69ffb56f0503e783b50599ec0d873dec/src%2Ftest%2Frun-pass%2Flib-vec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e482d5f69ffb56f0503e783b50599ec0d873dec/src%2Ftest%2Frun-pass%2Flib-vec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Flib-vec.rs?ref=3e482d5f69ffb56f0503e783b50599ec0d873dec", "patch": "@@ -37,7 +37,21 @@ fn test_map() {\n   let vec[int] s = std._vec.map[int, int](op, v);\n   let int i = 0;\n   while (i < 5) {\n-    check (v.(i) == s.(i));\n+    check (v.(i) * v.(i) == s.(i));\n+    i += 1;\n+  }\n+}\n+\n+fn test_map2() {\n+  fn times(&int x, &int y) -> int { ret x * y; }\n+  auto f = times;\n+  auto v0 = vec(1, 2, 3, 4, 5);\n+  auto v1 = vec(5, 4, 3, 2, 1);\n+  auto u = std._vec.map2[int,int,int](f, v0, v1);\n+\n+  auto i = 0;\n+  while (i < 5) {\n+    check (v0.(i) * v1.(i) == u.(i));\n     i += 1;\n   }\n }\n@@ -46,4 +60,7 @@ fn main() {\n   test_init_elt();\n   test_init_fn();\n   test_slice();\n+  test_map();\n+  test_map2();\n }\n+"}]}