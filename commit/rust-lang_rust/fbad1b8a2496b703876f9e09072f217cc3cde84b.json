{"sha": "fbad1b8a2496b703876f9e09072f217cc3cde84b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZiYWQxYjhhMjQ5NmI3MDM4NzZmOWUwOTA3MmYyMTdjYzNjZGU4NGI=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-12-13T13:54:39Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-12-13T13:54:39Z"}, "message": "Merge #6856\n\n6856: Add test for #6852 r=flodiebold a=flodiebold\n\n\n\nCo-authored-by: Florian Diebold <flodiebold@gmail.com>", "tree": {"sha": "dbe9c8211ce85e866b0d0658cfb74921f59a70a2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dbe9c8211ce85e866b0d0658cfb74921f59a70a2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fbad1b8a2496b703876f9e09072f217cc3cde84b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJf1h0fCRBK7hj4Ov3rIwAAdHIIAJcT33xgY5deY/CbWobhHTck\niY4XVgYML13o0uE9ggc1f8GNo13aOscTs2LdkMCTLSu8fNaDMqMdOZzXeT03BQK8\nZwFC0bjMIBoPKCmsQQFu7I+lio/yU4iVO3QmsFYOz3QUZtHe9jI4sRmAyRHWnyCn\n3nUXqspwqLhzcMP72K9yrM7/VWm9keriP9wNxpDCRimd2mDX7sZ5C9s2CnSSLDEC\nPJKVU1PBUHsabtsFxFm4b8c0J91MbnkNd71bc8ASwNITvSLW3DFmuC0gFS4GGzMk\nYNRhtoXDE8Ba5gyMzsGBNuLOl862cwagCOP9Vy7J88IiRJRBvNCbgJg+RKKAFpg=\n=iG10\n-----END PGP SIGNATURE-----\n", "payload": "tree dbe9c8211ce85e866b0d0658cfb74921f59a70a2\nparent 48802e54d1669c68fd27b007533dd6aa5221d089\nparent 4788aaa5f07da85707b7bf409b5d25df1682a760\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1607867679 +0000\ncommitter GitHub <noreply@github.com> 1607867679 +0000\n\nMerge #6856\n\n6856: Add test for #6852 r=flodiebold a=flodiebold\n\n\n\nCo-authored-by: Florian Diebold <flodiebold@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fbad1b8a2496b703876f9e09072f217cc3cde84b", "html_url": "https://github.com/rust-lang/rust/commit/fbad1b8a2496b703876f9e09072f217cc3cde84b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fbad1b8a2496b703876f9e09072f217cc3cde84b/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "48802e54d1669c68fd27b007533dd6aa5221d089", "url": "https://api.github.com/repos/rust-lang/rust/commits/48802e54d1669c68fd27b007533dd6aa5221d089", "html_url": "https://github.com/rust-lang/rust/commit/48802e54d1669c68fd27b007533dd6aa5221d089"}, {"sha": "4788aaa5f07da85707b7bf409b5d25df1682a760", "url": "https://api.github.com/repos/rust-lang/rust/commits/4788aaa5f07da85707b7bf409b5d25df1682a760", "html_url": "https://github.com/rust-lang/rust/commit/4788aaa5f07da85707b7bf409b5d25df1682a760"}], "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "da817041704a32ca364c1067c9b34d41914df8eb", "filename": "crates/hir_ty/src/tests/regression.rs", "status": "modified", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/fbad1b8a2496b703876f9e09072f217cc3cde84b/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fbad1b8a2496b703876f9e09072f217cc3cde84b/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Ftests%2Fregression.rs?ref=fbad1b8a2496b703876f9e09072f217cc3cde84b", "patch": "@@ -883,3 +883,40 @@ fn issue_6628() {\n         \"#]],\n     );\n }\n+\n+#[test]\n+fn issue_6852() {\n+    check_infer(\n+        r#\"\n+        #[lang = \"deref\"]\n+        pub trait Deref {\n+            type Target;\n+        }\n+\n+        struct BufWriter {}\n+\n+        struct Mutex<T> {}\n+        struct MutexGuard<'a, T> {}\n+        impl<T> Mutex<T> {\n+            fn lock(&self) -> MutexGuard<'_, T> {}\n+        }\n+        impl<'a, T: 'a> Deref for MutexGuard<'a, T> {\n+            type Target = T;\n+        }\n+        fn flush(&self) {\n+            let w: &Mutex<BufWriter>;\n+            *(w.lock());\n+        }\n+        \"#,\n+        expect![[r#\"\n+            156..160 'self': &Mutex<T>\n+            183..185 '{}': ()\n+            267..271 'self': &{unknown}\n+            273..323 '{     ...()); }': ()\n+            283..284 'w': &Mutex<BufWriter>\n+            309..320 '*(w.lock())': BufWriter\n+            311..312 'w': &Mutex<BufWriter>\n+            311..319 'w.lock()': MutexGuard<BufWriter>\n+        \"#]],\n+    );\n+}"}]}