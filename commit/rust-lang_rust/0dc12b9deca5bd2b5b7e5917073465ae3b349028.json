{"sha": "0dc12b9deca5bd2b5b7e5917073465ae3b349028", "node_id": "C_kwDOAAsO6NoAKDBkYzEyYjlkZWNhNWJkMmI1YjdlNTkxNzA3MzQ2NWFlM2IzNDkwMjg", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-03-02T22:05:29Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-03-02T22:05:29Z"}, "message": "Rollup merge of #108584 - GuillaumeGomez:rustdoc-search-background, r=notriddle\n\nPut backtick content from rustdoc search errors into a <code> elements\n\nSome screenshots of the result:\n\n![Screenshot from 2023-02-28 22-37-09](https://user-images.githubusercontent.com/3050060/221990290-fa84f1cf-5a64-4ce5-8433-ee36cedf4c00.png)\n![Screenshot from 2023-02-28 22-36-59](https://user-images.githubusercontent.com/3050060/221990298-f8177eeb-894b-4fce-a6fc-06d17c8b7ca2.png)\n![Screenshot from 2023-02-28 22-36-51](https://user-images.githubusercontent.com/3050060/221990301-41bffd64-d041-41f1-995a-983925b1fbb1.png)\n\nYou can test it [here](https://rustdoc.crud.net/imperio/rustdoc-search-background/foo/index.html?search=%22).\n\nr? ```@notriddle```", "tree": {"sha": "ddeeb5efbce107f769882d1f1beac4a2491df1d5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ddeeb5efbce107f769882d1f1beac4a2491df1d5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0dc12b9deca5bd2b5b7e5917073465ae3b349028", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkAR2pCRBK7hj4Ov3rIwAABqoIAHPfbj9W4Eg4jdQ1wKsGvJIq\nlq8LySkzs906AZwsR246WMlQyLuQafub6luUO77PlVb60ZvGG9viDughqvmVUZzo\n63FgwhqgPegUs5+AO/lQsM/PB+MVyL6/oLgFAuqR7RYiXdJ3o3X1y0kgOxmrlBzR\nE0OBMZdZFhuisOwUCbVrW9D1UV8a+KqPoBAKwPTGB/mhwq3+Lni1pGmKyoDKF8b5\nKWVmwSlZOBeCEubyc6n7Hoeb6fLnpAIzklXszxdih5TML1GhaBIbJfS3b8D9JL6r\nDDKdd0BkibAVKLVPzRt9279jSUEwEyIySubkyUjCPIJ10dSOh4CjOJBXaBUU5h8=\n=pV+U\n-----END PGP SIGNATURE-----\n", "payload": "tree ddeeb5efbce107f769882d1f1beac4a2491df1d5\nparent 13640e337a34b15167b889bf50711d1145e64805\nparent cfb4af87e30e9cfc4af01d08b45fed738d00d0ed\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1677794729 +0100\ncommitter GitHub <noreply@github.com> 1677794729 +0100\n\nRollup merge of #108584 - GuillaumeGomez:rustdoc-search-background, r=notriddle\n\nPut backtick content from rustdoc search errors into a <code> elements\n\nSome screenshots of the result:\n\n![Screenshot from 2023-02-28 22-37-09](https://user-images.githubusercontent.com/3050060/221990290-fa84f1cf-5a64-4ce5-8433-ee36cedf4c00.png)\n![Screenshot from 2023-02-28 22-36-59](https://user-images.githubusercontent.com/3050060/221990298-f8177eeb-894b-4fce-a6fc-06d17c8b7ca2.png)\n![Screenshot from 2023-02-28 22-36-51](https://user-images.githubusercontent.com/3050060/221990301-41bffd64-d041-41f1-995a-983925b1fbb1.png)\n\nYou can test it [here](https://rustdoc.crud.net/imperio/rustdoc-search-background/foo/index.html?search=%22).\n\nr? ```@notriddle```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0dc12b9deca5bd2b5b7e5917073465ae3b349028", "html_url": "https://github.com/rust-lang/rust/commit/0dc12b9deca5bd2b5b7e5917073465ae3b349028", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0dc12b9deca5bd2b5b7e5917073465ae3b349028/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "13640e337a34b15167b889bf50711d1145e64805", "url": "https://api.github.com/repos/rust-lang/rust/commits/13640e337a34b15167b889bf50711d1145e64805", "html_url": "https://github.com/rust-lang/rust/commit/13640e337a34b15167b889bf50711d1145e64805"}, {"sha": "cfb4af87e30e9cfc4af01d08b45fed738d00d0ed", "url": "https://api.github.com/repos/rust-lang/rust/commits/cfb4af87e30e9cfc4af01d08b45fed738d00d0ed", "html_url": "https://github.com/rust-lang/rust/commit/cfb4af87e30e9cfc4af01d08b45fed738d00d0ed"}], "stats": {"total": 196, "additions": 153, "deletions": 43}, "files": [{"sha": "1a34530c2d16ebf32210af00282533485659722c", "filename": "src/librustdoc/html/static/.eslintrc.js", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0dc12b9deca5bd2b5b7e5917073465ae3b349028/src%2Flibrustdoc%2Fhtml%2Fstatic%2F.eslintrc.js", "raw_url": "https://github.com/rust-lang/rust/raw/0dc12b9deca5bd2b5b7e5917073465ae3b349028/src%2Flibrustdoc%2Fhtml%2Fstatic%2F.eslintrc.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2F.eslintrc.js?ref=0dc12b9deca5bd2b5b7e5917073465ae3b349028", "patch": "@@ -90,7 +90,6 @@ module.exports = {\n         \"no-return-assign\": \"error\",\n         \"no-script-url\": \"error\",\n         \"no-sequences\": \"error\",\n-        \"no-throw-literal\": \"error\",\n         \"no-div-regex\": \"error\",\n     }\n };"}, {"sha": "95528e70e3519ef1d2821767e7f9da889aa561d7", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0dc12b9deca5bd2b5b7e5917073465ae3b349028/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/0dc12b9deca5bd2b5b7e5917073465ae3b349028/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=0dc12b9deca5bd2b5b7e5917073465ae3b349028", "patch": "@@ -1260,6 +1260,11 @@ a.tooltip:hover::after {\n \tcolor: var(--search-tab-title-count-color);\n }\n \n+#search .error code {\n+\tborder-radius: 3px;\n+\tbackground-color: var(--search-error-code-background-color);\n+}\n+\n #src-sidebar-toggle {\n \tposition: sticky;\n \ttop: 0;"}, {"sha": "90cf689ad3372923389378865e9216793a514e01", "filename": "src/librustdoc/html/static/css/themes/ayu.css", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0dc12b9deca5bd2b5b7e5917073465ae3b349028/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "raw_url": "https://github.com/rust-lang/rust/raw/0dc12b9deca5bd2b5b7e5917073465ae3b349028/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css?ref=0dc12b9deca5bd2b5b7e5917073465ae3b349028", "patch": "@@ -43,6 +43,7 @@ Original by Dempfi (https://github.com/dempfi/ayu)\n \t--search-result-link-focus-background-color: #3c3c3c;\n \t--search-result-border-color: #aaa3;\n \t--search-color: #fff;\n+\t--search-error-code-background-color: #4f4c4c;\n \t--search-results-alias-color: #c5c5c5;\n \t--search-results-grey-color: #999;\n \t--search-tab-title-count-color: #888;"}, {"sha": "e8cd06931392088859d1e0c4e8b41fff99108ec0", "filename": "src/librustdoc/html/static/css/themes/dark.css", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0dc12b9deca5bd2b5b7e5917073465ae3b349028/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/0dc12b9deca5bd2b5b7e5917073465ae3b349028/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css?ref=0dc12b9deca5bd2b5b7e5917073465ae3b349028", "patch": "@@ -38,6 +38,7 @@\n \t--search-result-link-focus-background-color: #616161;\n \t--search-result-border-color: #aaa3;\n \t--search-color: #111;\n+\t--search-error-code-background-color: #484848;\n \t--search-results-alias-color: #fff;\n \t--search-results-grey-color: #ccc;\n \t--search-tab-title-count-color: #888;"}, {"sha": "5e3f14e483faed6884b4a01d54f9c19e204dd7d6", "filename": "src/librustdoc/html/static/css/themes/light.css", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0dc12b9deca5bd2b5b7e5917073465ae3b349028/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "raw_url": "https://github.com/rust-lang/rust/raw/0dc12b9deca5bd2b5b7e5917073465ae3b349028/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css?ref=0dc12b9deca5bd2b5b7e5917073465ae3b349028", "patch": "@@ -38,6 +38,7 @@\n \t--search-result-link-focus-background-color: #ccc;\n \t--search-result-border-color: #aaa3;\n \t--search-color: #000;\n+\t--search-error-code-background-color: #d0cccc;\n \t--search-results-alias-color: #000;\n \t--search-results-grey-color: #999;\n \t--search-tab-title-count-color: #888;"}, {"sha": "5a46729156d19353c7b10b666843e96836c7f45c", "filename": "src/librustdoc/html/static/js/search.js", "status": "modified", "additions": 91, "deletions": 39, "changes": 130, "blob_url": "https://github.com/rust-lang/rust/blob/0dc12b9deca5bd2b5b7e5917073465ae3b349028/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "raw_url": "https://github.com/rust-lang/rust/raw/0dc12b9deca5bd2b5b7e5917073465ae3b349028/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsearch.js?ref=0dc12b9deca5bd2b5b7e5917073465ae3b349028", "patch": "@@ -144,7 +144,7 @@ function initSearch(rawSearchIndex) {\n     function itemTypeFromName(typename) {\n         const index = itemTypes.findIndex(i => i === typename);\n         if (index < 0) {\n-            throw new Error(\"Unknown type filter `\" + typename + \"`\");\n+            throw [\"Unknown type filter \", typename];\n         }\n         return index;\n     }\n@@ -164,21 +164,21 @@ function initSearch(rawSearchIndex) {\n      */\n     function getStringElem(query, parserState, isInGenerics) {\n         if (isInGenerics) {\n-            throw new Error(\"`\\\"` cannot be used in generics\");\n+            throw [\"Unexpected \", \"\\\"\", \" in generics\"];\n         } else if (query.literalSearch) {\n-            throw new Error(\"Cannot have more than one literal search element\");\n+            throw [\"Cannot have more than one literal search element\"];\n         } else if (parserState.totalElems - parserState.genericsElems > 0) {\n-            throw new Error(\"Cannot use literal search when there is more than one element\");\n+            throw [\"Cannot use literal search when there is more than one element\"];\n         }\n         parserState.pos += 1;\n         const start = parserState.pos;\n         const end = getIdentEndPosition(parserState);\n         if (parserState.pos >= parserState.length) {\n-            throw new Error(\"Unclosed `\\\"`\");\n+            throw [\"Unclosed \", \"\\\"\"];\n         } else if (parserState.userQuery[end] !== \"\\\"\") {\n-            throw new Error(`Unexpected \\`${parserState.userQuery[end]}\\` in a string element`);\n+            throw [\"Unexpected \", parserState.userQuery[end], \" in a string element\"];\n         } else if (start === end) {\n-            throw new Error(\"Cannot have empty string element\");\n+            throw [\"Cannot have empty string element\"];\n         }\n         // To skip the quote at the end.\n         parserState.pos += 1;\n@@ -257,7 +257,7 @@ function initSearch(rawSearchIndex) {\n             return;\n         }\n         if (query.literalSearch && parserState.totalElems - parserState.genericsElems > 0) {\n-            throw new Error(\"You cannot have more than one element if you use quotes\");\n+            throw [\"You cannot have more than one element if you use quotes\"];\n         }\n         const pathSegments = name.split(\"::\");\n         if (pathSegments.length > 1) {\n@@ -266,17 +266,17 @@ function initSearch(rawSearchIndex) {\n \n                 if (pathSegment.length === 0) {\n                     if (i === 0) {\n-                        throw new Error(\"Paths cannot start with `::`\");\n+                        throw [\"Paths cannot start with \", \"::\"];\n                     } else if (i + 1 === len) {\n-                        throw new Error(\"Paths cannot end with `::`\");\n+                        throw [\"Paths cannot end with \", \"::\"];\n                     }\n-                    throw new Error(\"Unexpected `::::`\");\n+                    throw [\"Unexpected \", \"::::\"];\n                 }\n             }\n         }\n         // In case we only have something like `<p>`, there is no name.\n         if (pathSegments.length === 0 || (pathSegments.length === 1 && pathSegments[0] === \"\")) {\n-            throw new Error(\"Found generics without a path\");\n+            throw [\"Found generics without a path\"];\n         }\n         parserState.totalElems += 1;\n         if (isInGenerics) {\n@@ -308,15 +308,15 @@ function initSearch(rawSearchIndex) {\n             if (!isIdentCharacter(c)) {\n                 if (c === \"!\") {\n                     if (foundExclamation !== -1) {\n-                        throw new Error(\"Cannot have more than one `!` in an ident\");\n+                        throw [\"Cannot have more than one \", \"!\", \" in an ident\"];\n                     } else if (parserState.pos + 1 < parserState.length &&\n                         isIdentCharacter(parserState.userQuery[parserState.pos + 1])\n                     ) {\n-                        throw new Error(\"`!` can only be at the end of an ident\");\n+                        throw [\"Unexpected \", \"!\", \": it can only be at the end of an ident\"];\n                     }\n                     foundExclamation = parserState.pos;\n                 } else if (isErrorCharacter(c)) {\n-                    throw new Error(`Unexpected \\`${c}\\``);\n+                    throw [\"Unexpected \", c];\n                 } else if (\n                     isStopCharacter(c) ||\n                     isSpecialStartCharacter(c) ||\n@@ -329,7 +329,7 @@ function initSearch(rawSearchIndex) {\n                     }\n                     if (foundExclamation !== -1) {\n                         if (start <= (end - 2)) {\n-                            throw new Error(\"Cannot have associated items in macros\");\n+                            throw [\"Cannot have associated items in macros\"];\n                         } else {\n                             // if start == end - 1, we got the never type\n                             // while the never type has no associated macros, we still\n@@ -340,7 +340,7 @@ function initSearch(rawSearchIndex) {\n                     // Skip current \":\".\n                     parserState.pos += 1;\n                 } else {\n-                    throw new Error(`Unexpected \\`${c}\\``);\n+                    throw [\"Unexpected \", c];\n                 }\n             }\n             parserState.pos += 1;\n@@ -351,8 +351,13 @@ function initSearch(rawSearchIndex) {\n             if (parserState.typeFilter === null) {\n                 parserState.typeFilter = \"macro\";\n             } else if (parserState.typeFilter !== \"macro\") {\n-                throw new Error(\"Invalid search type: macro `!` and \" +\n-                    `\\`${parserState.typeFilter}\\` both specified`);\n+                throw [\n+                    \"Invalid search type: macro \",\n+                    \"!\",\n+                    \" and \",\n+                    parserState.typeFilter,\n+                    \" both specified\",\n+                ];\n             }\n             end = foundExclamation;\n         }\n@@ -382,9 +387,9 @@ function initSearch(rawSearchIndex) {\n             parserState.userQuery[parserState.pos] === \"<\"\n         ) {\n             if (isInGenerics) {\n-                throw new Error(\"Unexpected `<` after `<`\");\n+                throw [\"Unexpected \", \"<\", \" after \", \"<\"];\n             } else if (start >= end) {\n-                throw new Error(\"Found generics without a path\");\n+                throw [\"Found generics without a path\"];\n             }\n             parserState.pos += 1;\n             getItemsBefore(query, parserState, generics, \">\");\n@@ -428,21 +433,39 @@ function initSearch(rawSearchIndex) {\n                 foundStopChar = true;\n                 continue;\n             } else if (c === \":\" && isPathStart(parserState)) {\n-                throw new Error(\"Unexpected `::`: paths cannot start with `::`\");\n+                throw [\"Unexpected \", \"::\", \": paths cannot start with \", \"::\"];\n             } else if (c === \":\" || isEndCharacter(c)) {\n                 let extra = \"\";\n                 if (endChar === \">\") {\n-                    extra = \"`<`\";\n+                    extra = \"<\";\n                 } else if (endChar === \"\") {\n-                    extra = \"`->`\";\n+                    extra = \"->\";\n+                } else {\n+                    extra = endChar;\n                 }\n-                throw new Error(\"Unexpected `\" + c + \"` after \" + extra);\n+                throw [\"Unexpected \", c, \" after \", extra];\n             }\n             if (!foundStopChar) {\n                 if (endChar !== \"\") {\n-                    throw new Error(`Expected \\`,\\`, \\` \\` or \\`${endChar}\\`, found \\`${c}\\``);\n+                    throw [\n+                        \"Expected \",\n+                        \",\", // comma\n+                        \", \",\n+                        \"&nbsp;\", // whitespace\n+                        \" or \",\n+                        endChar,\n+                        \", found \",\n+                        c,\n+                    ];\n                 }\n-                throw new Error(`Expected \\`,\\` or \\` \\`, found \\`${c}\\``);\n+                throw [\n+                    \"Expected \",\n+                    \",\", // comma\n+                    \" or \",\n+                    \"&nbsp;\", // whitespace\n+                    \", found \",\n+                    c,\n+                ];\n             }\n             const posBefore = parserState.pos;\n             getNextElem(query, parserState, elems, endChar === \">\");\n@@ -470,7 +493,7 @@ function initSearch(rawSearchIndex) {\n \n         for (let pos = 0; pos < parserState.pos; ++pos) {\n             if (!isIdentCharacter(query[pos]) && !isWhitespaceCharacter(query[pos])) {\n-                throw new Error(`Unexpected \\`${query[pos]}\\` in type filter`);\n+                throw [\"Unexpected \", query[pos], \" in type filter\"];\n             }\n         }\n     }\n@@ -496,19 +519,19 @@ function initSearch(rawSearchIndex) {\n                     if (isReturnArrow(parserState)) {\n                         break;\n                     }\n-                    throw new Error(`Unexpected \\`${c}\\` (did you mean \\`->\\`?)`);\n+                    throw [\"Unexpected \", c, \" (did you mean \", \"->\", \"?)\"];\n                 }\n-                throw new Error(`Unexpected \\`${c}\\``);\n+                throw [\"Unexpected \", c];\n             } else if (c === \":\" && !isPathStart(parserState)) {\n                 if (parserState.typeFilter !== null) {\n-                    throw new Error(\"Unexpected `:`\");\n+                    throw [\"Unexpected \", \":\"];\n                 }\n                 if (query.elems.length === 0) {\n-                    throw new Error(\"Expected type filter before `:`\");\n+                    throw [\"Expected type filter before \", \":\"];\n                 } else if (query.elems.length !== 1 || parserState.totalElems !== 1) {\n-                    throw new Error(\"Unexpected `:`\");\n+                    throw [\"Unexpected \", \":\"];\n                 } else if (query.literalSearch) {\n-                    throw new Error(\"You cannot use quotes on type filter\");\n+                    throw [\"You cannot use quotes on type filter\"];\n                 }\n                 checkExtraTypeFilterCharacters(parserState);\n                 // The type filter doesn't count as an element since it's a modifier.\n@@ -521,9 +544,29 @@ function initSearch(rawSearchIndex) {\n             }\n             if (!foundStopChar) {\n                 if (parserState.typeFilter !== null) {\n-                    throw new Error(`Expected \\`,\\`, \\` \\` or \\`->\\`, found \\`${c}\\``);\n+                    throw [\n+                        \"Expected \",\n+                        \",\", // comma\n+                        \", \",\n+                        \"&nbsp;\", // whitespace\n+                        \" or \",\n+                        \"->\", // arrow\n+                        \", found \",\n+                        c,\n+                    ];\n                 }\n-                throw new Error(`Expected \\`,\\`, \\` \\`, \\`:\\` or \\`->\\`, found \\`${c}\\``);\n+                throw [\n+                    \"Expected \",\n+                    \",\", // comma\n+                    \", \",\n+                    \"&nbsp;\", // whitespace\n+                    \", \",\n+                    \":\", // colon\n+                    \" or \",\n+                    \"->\", // arrow\n+                    \", found \",\n+                    c,\n+                ];\n             }\n             const before = query.elems.length;\n             getNextElem(query, parserState, query.elems, false);\n@@ -540,7 +583,7 @@ function initSearch(rawSearchIndex) {\n                 getItemsBefore(query, parserState, query.returned, \"\");\n                 // Nothing can come afterward!\n                 if (query.returned.length === 0) {\n-                    throw new Error(\"Expected at least one item after `->`\");\n+                    throw [\"Expected at least one item after \", \"->\"];\n                 }\n                 break;\n             } else {\n@@ -694,7 +737,7 @@ function initSearch(rawSearchIndex) {\n             }\n         } catch (err) {\n             query = newParsedQuery(userQuery);\n-            query.error = err.message;\n+            query.error = err;\n             query.typeFilter = -1;\n             return query;\n         }\n@@ -1760,7 +1803,16 @@ function initSearch(rawSearchIndex) {\n \n         let output = `<h1 class=\"search-results-title\">Results${crates}</h1>`;\n         if (results.query.error !== null) {\n-            output += `<h3>Query parser error: \"${results.query.error}\".</h3>`;\n+            const error = results.query.error;\n+            error.forEach((value, index) => {\n+                value = value.split(\"<\").join(\"&lt;\").split(\">\").join(\"&gt;\");\n+                if (index % 2 !== 0) {\n+                    error[index] = `<code>${value}</code>`;\n+                } else {\n+                    error[index] = value;\n+                }\n+            });\n+            output += `<h3 class=\"error\">Query parser error: \"${error.join(\"\")}\".</h3>`;\n             output += \"<div id=\\\"search-tabs\\\">\" +\n                 makeTabHeader(0, \"In Names\", ret_others[1]) +\n                 \"</div>\";"}, {"sha": "ea5780f66d7f71356c1b8a68ce8a9ec4a3988a18", "filename": "src/tools/rustdoc-js/tester.js", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/0dc12b9deca5bd2b5b7e5917073465ae3b349028/src%2Ftools%2Frustdoc-js%2Ftester.js", "raw_url": "https://github.com/rust-lang/rust/raw/0dc12b9deca5bd2b5b7e5917073465ae3b349028/src%2Ftools%2Frustdoc-js%2Ftester.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustdoc-js%2Ftester.js?ref=0dc12b9deca5bd2b5b7e5917073465ae3b349028", "patch": "@@ -138,8 +138,20 @@ function valueCheck(fullPath, expected, result, error_text, queryName) {\n                 error_text.push('==> Unknown key \"' + key + '\"');\n                 break;\n             }\n+            let result_v = result[key];\n+            if (result_v !== null && key === \"error\") {\n+                result_v.forEach((value, index) => {\n+                    value = value.split(\"&nbsp;\").join(\" \");\n+                    if (index % 2 === 1) {\n+                        result_v[index] = \"`\" + value + \"`\";\n+                    } else {\n+                        result_v[index] = value;\n+                    }\n+                });\n+                result_v = result_v.join(\"\");\n+            }\n             const obj_path = fullPath + (fullPath.length > 0 ? '.' : '') + key;\n-            valueCheck(obj_path, expected[key], result[key], error_text, queryName);\n+            valueCheck(obj_path, expected[key], result_v, error_text, queryName);\n         }\n     } else {\n         expectedValue = JSON.stringify(expected);"}, {"sha": "2a10a647b53c3dd8ef5a585c231f16788ff8bd3c", "filename": "tests/rustdoc-gui/search-error.goml", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/0dc12b9deca5bd2b5b7e5917073465ae3b349028/tests%2Frustdoc-gui%2Fsearch-error.goml", "raw_url": "https://github.com/rust-lang/rust/raw/0dc12b9deca5bd2b5b7e5917073465ae3b349028/tests%2Frustdoc-gui%2Fsearch-error.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc-gui%2Fsearch-error.goml?ref=0dc12b9deca5bd2b5b7e5917073465ae3b349028", "patch": "@@ -0,0 +1,39 @@\n+// Checks that the crate search filtering is handled correctly and changes the results.\n+goto: \"file://\" + |DOC_PATH| + \"/test_docs/index.html?search=sa'%3Bda'%3Bds\"\n+show-text: true\n+\n+define-function: (\n+    \"check-colors\",\n+    (theme, error_background),\n+    block {\n+        // Setting the theme.\n+        local-storage: {\"rustdoc-theme\": |theme|, \"rustdoc-use-system-theme\": \"false\"}\n+        // We reload the page so the local storage settings are being used.\n+        reload:\n+\n+        wait-for: \"#search .error code\"\n+        assert-css: (\"#search .error code\", {\"background-color\": |error_background|})\n+    }\n+)\n+\n+call-function: (\n+    \"check-colors\",\n+    {\n+        \"theme\": \"ayu\",\n+        \"error_background\": \"rgb(79, 76, 76)\",\n+    },\n+)\n+call-function: (\n+    \"check-colors\",\n+    {\n+        \"theme\": \"dark\",\n+        \"error_background\": \"rgb(72, 72, 72)\",\n+    },\n+)\n+call-function: (\n+    \"check-colors\",\n+    {\n+        \"theme\": \"light\",\n+        \"error_background\": \"rgb(208, 204, 204)\",\n+    },\n+)"}, {"sha": "6c5a777028335a66615944124889dca8ea86e64f", "filename": "tests/rustdoc-js-std/parser-errors.js", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0dc12b9deca5bd2b5b7e5917073465ae3b349028/tests%2Frustdoc-js-std%2Fparser-errors.js", "raw_url": "https://github.com/rust-lang/rust/raw/0dc12b9deca5bd2b5b7e5917073465ae3b349028/tests%2Frustdoc-js-std%2Fparser-errors.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc-js-std%2Fparser-errors.js?ref=0dc12b9deca5bd2b5b7e5917073465ae3b349028", "patch": "@@ -67,7 +67,7 @@ const PARSED = [\n         returned: [],\n         typeFilter: -1,\n         userQuery: \"a<\\\"p\\\">\",\n-        error: \"`\\\"` cannot be used in generics\",\n+        error: \"Unexpected `\\\"` in generics\",\n     },\n     {\n         elems: [],\n@@ -373,7 +373,7 @@ const PARSED = [\n         returned: [],\n         typeFilter: -1,\n         userQuery: \"a!a\",\n-        error: '`!` can only be at the end of an ident',\n+        error: 'Unexpected `!`: it can only be at the end of an ident',\n     },\n     {\n         elems: [],"}]}