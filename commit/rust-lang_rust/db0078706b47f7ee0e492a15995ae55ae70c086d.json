{"sha": "db0078706b47f7ee0e492a15995ae55ae70c086d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRiMDA3ODcwNmI0N2Y3ZWUwZTQ5MmExNTk5NWFlNTVhZTcwYzA4NmQ=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-22T14:40:54Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-25T14:47:41Z"}, "message": "ci: split install-msys2 step into two separate scripts", "tree": {"sha": "a6acc7a99dcf2536ba336d77ac361c6f1d2799a8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a6acc7a99dcf2536ba336d77ac361c6f1d2799a8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/db0078706b47f7ee0e492a15995ae55ae70c086d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl2zCw0ACgkQPgar6Auq\n8Zyscw/9EBjA5WB6Ggtx0QT89Lv/nJdrpO+mgo3sI44lczPUt5z5FnLWsWI/KrKp\ncXBzEdIPbHobYU0RPDz8Us18lN+jfwGG1C6kAhpM1su3rqzWZbGsxJ3U+JNazn8T\nZ9EAQJllT99ajAbSlSBAU/w01/6b3IQekFAEsVmrp26hT2X3ZqCmAskmDh4QyirA\nQf2Tiv3Qzx5eVSLCm1DE96ELJ2TqWQ37IwzcyeA0TK4Ogzxk4Fu3vaCcMo0q9/OP\nt933AaSFm5jdJAL851Iw32SKdcQ9ZEdXYRHXFXxB9W8wgphAbWfl/yVaWtGNupf6\n52mqG8KNuj5wLFt5fHOd4kMAb7jqaH+ITUdfTudYXpCqOQRUK5l7CCLWJJ3SJfMh\nV2PaGSRK2Ku+QF0EIjEtjtpJWVYCOQcjNLqKNUvJMlsGh6W56p8q53ku6UkeDc6R\nzOV2f72RqxXC6fEhnXp43Cyg7QdCCt/1TCctgQ5qdVzug7YanUYWk0PvAfv9njCw\n0edvQIwWFejqCyVedy1I8KauseqZNmzGchzFtcBjVfTOFEESU+LuAK6ts43C6Q2z\nB6qR/LufbtwG3DfIAFuBSn3myXtUqLw2+LFwjlq2ugnJsmcHHtEOnQBqO6cdrTzs\nmDb6/zccfWUhcch/FYdYi1z/djqK65t4YVNw2yFvLAd624HPWp0=\n=H4am\n-----END PGP SIGNATURE-----", "payload": "tree a6acc7a99dcf2536ba336d77ac361c6f1d2799a8\nparent 9d1533614949eae7154da51be8b9739fe857e3e0\nauthor Pietro Albini <pietro@pietroalbini.org> 1571755254 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1572014861 +0200\n\nci: split install-msys2 step into two separate scripts\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/db0078706b47f7ee0e492a15995ae55ae70c086d", "html_url": "https://github.com/rust-lang/rust/commit/db0078706b47f7ee0e492a15995ae55ae70c086d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/db0078706b47f7ee0e492a15995ae55ae70c086d/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9d1533614949eae7154da51be8b9739fe857e3e0", "url": "https://api.github.com/repos/rust-lang/rust/commits/9d1533614949eae7154da51be8b9739fe857e3e0", "html_url": "https://github.com/rust-lang/rust/commit/9d1533614949eae7154da51be8b9739fe857e3e0"}], "stats": {"total": 46, "additions": 32, "deletions": 14}, "files": [{"sha": "01858cca50b1cc7820446359bff8fed279857bb6", "filename": "src/ci/azure-pipelines/steps/run.yml", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/db0078706b47f7ee0e492a15995ae55ae70c086d/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "raw_url": "https://github.com/rust-lang/rust/raw/db0078706b47f7ee0e492a15995ae55ae70c086d/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml?ref=db0078706b47f7ee0e492a15995ae55ae70c086d", "patch": "@@ -98,6 +98,13 @@ steps:\n   displayName: Install msys2\n   condition: and(succeeded(), not(variables.SKIP_JOB))\n \n+- bash: src/ci/scripts/install-msys2-packages.sh\n+  env:\n+    AGENT_OS: $(Agent.OS)\n+    SYSTEM_WORKFOLDER: $(System.Workfolder)\n+  displayName: Install msys2 packages\n+  condition: and(succeeded(), not(variables.SKIP_JOB))\n+\n - bash: src/ci/scripts/install-mingw.sh\n   env:\n     AGENT_OS: $(Agent.OS)"}, {"sha": "375f13f30b3ed3b34e324c2c3c13c0d76de0c0a2", "filename": "src/ci/scripts/install-msys2-packages.sh", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/db0078706b47f7ee0e492a15995ae55ae70c086d/src%2Fci%2Fscripts%2Finstall-msys2-packages.sh", "raw_url": "https://github.com/rust-lang/rust/raw/db0078706b47f7ee0e492a15995ae55ae70c086d/src%2Fci%2Fscripts%2Finstall-msys2-packages.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Finstall-msys2-packages.sh?ref=db0078706b47f7ee0e492a15995ae55ae70c086d", "patch": "@@ -0,0 +1,25 @@\n+#!/bin/bash\n+\n+set -euo pipefail\n+IFS=$'\\n\\t'\n+\n+source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n+\n+if isWindows; then\n+    pacman -S --noconfirm --needed base-devel ca-certificates make diffutils tar\n+\n+    # FIXME(#65767): workaround msys bug, step 2\n+    arch=i686\n+    if [ \"$MSYS_BITS\" = \"64\" ]; then\n+      arch=x86_64\n+    fi\n+    pacman -U --noconfirm --noprogressbar mingw-w64-$arch-ca-certificates-20180409-1-any.pkg.tar.xz\n+    rm mingw-w64-$arch-ca-certificates-20180409-1-any.pkg.tar.xz\n+\n+    # Make sure we use the native python interpreter instead of some msys equivalent\n+    # one way or another. The msys interpreters seem to have weird path conversions\n+    # baked in which break LLVM's build system one way or another, so let's use the\n+    # native version which keeps everything as native as possible.\n+    cp C:/Python27amd64/python.exe C:/Python27amd64/python2.7.exe\n+    ciCommandAddPath \"C:\\\\Python27amd64\"\n+fi"}, {"sha": "3178d3e22e10bd2d84e4d9bfe835d211fb5971a6", "filename": "src/ci/scripts/install-msys2.sh", "status": "modified", "additions": 0, "deletions": 14, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/db0078706b47f7ee0e492a15995ae55ae70c086d/src%2Fci%2Fscripts%2Finstall-msys2.sh", "raw_url": "https://github.com/rust-lang/rust/raw/db0078706b47f7ee0e492a15995ae55ae70c086d/src%2Fci%2Fscripts%2Finstall-msys2.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Finstall-msys2.sh?ref=db0078706b47f7ee0e492a15995ae55ae70c086d", "patch": "@@ -23,18 +23,4 @@ if isWindows; then\n     mkdir -p \"${SYSTEM_WORKFOLDER}/msys2/home/${USERNAME}\"\n \n     ciCommandAddPath \"${SYSTEM_WORKFOLDER}/msys2/usr/bin\"\n-    export PATH=\"${SYSTEM_WORKFOLDER}/msys2/usr/bin:${PATH}\"\n-\n-    pacman -S --noconfirm --needed base-devel ca-certificates make diffutils tar\n-\n-    # FIXME(#65767): workaround msys bug, step 2\n-    pacman -U --noconfirm --noprogressbar mingw-w64-$arch-ca-certificates-20180409-1-any.pkg.tar.xz\n-    rm mingw-w64-$arch-ca-certificates-20180409-1-any.pkg.tar.xz\n-\n-    # Make sure we use the native python interpreter instead of some msys equivalent\n-    # one way or another. The msys interpreters seem to have weird path conversions\n-    # baked in which break LLVM's build system one way or another, so let's use the\n-    # native version which keeps everything as native as possible.\n-    cp C:/Python27amd64/python.exe C:/Python27amd64/python2.7.exe\n-    ciCommandAddPath \"C:\\\\Python27amd64\"\n fi"}]}