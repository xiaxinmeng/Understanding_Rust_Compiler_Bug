{"sha": "a5763ff8d3e67c156ebe8160de1db26a644d4c5d", "node_id": "C_kwDOAAsO6NoAKGE1NzYzZmY4ZDNlNjdjMTU2ZWJlODE2MGRlMWRiMjZhNjQ0ZDRjNWQ", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-05-10T23:00:47Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-05-15T17:14:59Z"}, "message": "Recover `impl<T ?Sized>` correctly", "tree": {"sha": "7ed43464a4909c0c7547136f7ceb4b0267ff3cef", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7ed43464a4909c0c7547136f7ceb4b0267ff3cef"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a5763ff8d3e67c156ebe8160de1db26a644d4c5d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a5763ff8d3e67c156ebe8160de1db26a644d4c5d", "html_url": "https://github.com/rust-lang/rust/commit/a5763ff8d3e67c156ebe8160de1db26a644d4c5d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a5763ff8d3e67c156ebe8160de1db26a644d4c5d/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2913ad6db0f72fed5139253faed73200c7af3535", "url": "https://api.github.com/repos/rust-lang/rust/commits/2913ad6db0f72fed5139253faed73200c7af3535", "html_url": "https://github.com/rust-lang/rust/commit/2913ad6db0f72fed5139253faed73200c7af3535"}], "stats": {"total": 19, "additions": 19, "deletions": 0}, "files": [{"sha": "cd779b0b43ebd59f83d9574896f0084ac9f04bbd", "filename": "compiler/rustc_parse/src/parser/generics.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a5763ff8d3e67c156ebe8160de1db26a644d4c5d/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fgenerics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5763ff8d3e67c156ebe8160de1db26a644d4c5d/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fgenerics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fgenerics.rs?ref=a5763ff8d3e67c156ebe8160de1db26a644d4c5d", "patch": "@@ -453,6 +453,8 @@ impl<'a> Parser<'a> {\n         //     `<` (LIFETIME|IDENT) `:` - generic parameter with bounds\n         //     `<` (LIFETIME|IDENT) `=` - generic parameter with a default\n         //     `<` const                - generic const parameter\n+        //     `<` IDENT `?`            - RECOVERY for `impl<T ?Bound` missing a `:`, meant to\n+        //                                avoid the `T?` to `Option<T>` recovery for types.\n         // The only truly ambiguous case is\n         //     `<` IDENT `>` `::` IDENT ...\n         // we disambiguate it in favor of generics (`impl<T> ::absolute::Path<T> { ... }`)\n@@ -463,6 +465,9 @@ impl<'a> Parser<'a> {\n                 || self.look_ahead(start + 1, |t| t.is_lifetime() || t.is_ident())\n                     && self.look_ahead(start + 2, |t| {\n                         matches!(t.kind, token::Gt | token::Comma | token::Colon | token::Eq)\n+                        // Recovery-only branch -- this could be removed,\n+                        // since it only affects diagnostics currently.\n+                            || matches!(t.kind, token::Question)\n                     })\n                 || self.is_keyword_ahead(start + 1, &[kw::Const]))\n     }"}, {"sha": "e09c0463045ac1f4698bf709150950120ff5d8db", "filename": "tests/ui/parser/impl-on-unsized-typo.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a5763ff8d3e67c156ebe8160de1db26a644d4c5d/tests%2Fui%2Fparser%2Fimpl-on-unsized-typo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a5763ff8d3e67c156ebe8160de1db26a644d4c5d/tests%2Fui%2Fparser%2Fimpl-on-unsized-typo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fimpl-on-unsized-typo.rs?ref=a5763ff8d3e67c156ebe8160de1db26a644d4c5d", "patch": "@@ -0,0 +1,6 @@\n+trait Tr {}\n+\n+impl<T ?Sized> Tr for T {}\n+//~^ ERROR expected one of `,`, `:`, `=`, or `>`, found `?`\n+\n+fn main() {}"}, {"sha": "23dcc1efd68b150b8f22578a41f160a1b39e5b1e", "filename": "tests/ui/parser/impl-on-unsized-typo.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a5763ff8d3e67c156ebe8160de1db26a644d4c5d/tests%2Fui%2Fparser%2Fimpl-on-unsized-typo.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a5763ff8d3e67c156ebe8160de1db26a644d4c5d/tests%2Fui%2Fparser%2Fimpl-on-unsized-typo.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fimpl-on-unsized-typo.stderr?ref=a5763ff8d3e67c156ebe8160de1db26a644d4c5d", "patch": "@@ -0,0 +1,8 @@\n+error: expected one of `,`, `:`, `=`, or `>`, found `?`\n+  --> $DIR/impl-on-unsized-typo.rs:3:8\n+   |\n+LL | impl<T ?Sized> Tr for T {}\n+   |        ^ expected one of `,`, `:`, `=`, or `>`\n+\n+error: aborting due to previous error\n+"}]}