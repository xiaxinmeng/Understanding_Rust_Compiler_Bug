{"sha": "dcdb9ad3d27aca6185af64f2e0318ed47860c6c0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRjZGI5YWQzZDI3YWNhNjE4NWFmNjRmMmUwMzE4ZWQ0Nzg2MGM2YzA=", "commit": {"author": {"name": "Augie Fackler", "email": "augie@google.com", "date": "2021-03-16T20:32:00Z"}, "committer": {"name": "Augie Fackler", "email": "augie@google.com", "date": "2021-03-16T21:13:20Z"}, "message": "llvm-wrapper: pass std::string instead of StringRef\n\nLLVM change 5fbd1a333aa1a0b70903d036b98ea56c51ae5224 modified this\nfunction to want std::string instead of StringRef, which is easily done.", "tree": {"sha": "9f0d57b6b590a6aacc4bdc799845eda39f8898c9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9f0d57b6b590a6aacc4bdc799845eda39f8898c9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dcdb9ad3d27aca6185af64f2e0318ed47860c6c0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dcdb9ad3d27aca6185af64f2e0318ed47860c6c0", "html_url": "https://github.com/rust-lang/rust/commit/dcdb9ad3d27aca6185af64f2e0318ed47860c6c0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dcdb9ad3d27aca6185af64f2e0318ed47860c6c0/comments", "author": {"login": "durin42", "id": 20269, "node_id": "MDQ6VXNlcjIwMjY5", "avatar_url": "https://avatars.githubusercontent.com/u/20269?v=4", "gravatar_id": "", "url": "https://api.github.com/users/durin42", "html_url": "https://github.com/durin42", "followers_url": "https://api.github.com/users/durin42/followers", "following_url": "https://api.github.com/users/durin42/following{/other_user}", "gists_url": "https://api.github.com/users/durin42/gists{/gist_id}", "starred_url": "https://api.github.com/users/durin42/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/durin42/subscriptions", "organizations_url": "https://api.github.com/users/durin42/orgs", "repos_url": "https://api.github.com/users/durin42/repos", "events_url": "https://api.github.com/users/durin42/events{/privacy}", "received_events_url": "https://api.github.com/users/durin42/received_events", "type": "User", "site_admin": false}, "committer": {"login": "durin42", "id": 20269, "node_id": "MDQ6VXNlcjIwMjY5", "avatar_url": "https://avatars.githubusercontent.com/u/20269?v=4", "gravatar_id": "", "url": "https://api.github.com/users/durin42", "html_url": "https://github.com/durin42", "followers_url": "https://api.github.com/users/durin42/followers", "following_url": "https://api.github.com/users/durin42/following{/other_user}", "gists_url": "https://api.github.com/users/durin42/gists{/gist_id}", "starred_url": "https://api.github.com/users/durin42/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/durin42/subscriptions", "organizations_url": "https://api.github.com/users/durin42/orgs", "repos_url": "https://api.github.com/users/durin42/repos", "events_url": "https://api.github.com/users/durin42/events{/privacy}", "received_events_url": "https://api.github.com/users/durin42/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0ed1c33ad95ab3fe983a989a8a85c4ca9052afbf", "url": "https://api.github.com/repos/rust-lang/rust/commits/0ed1c33ad95ab3fe983a989a8a85c4ca9052afbf", "html_url": "https://github.com/rust-lang/rust/commit/0ed1c33ad95ab3fe983a989a8a85c4ca9052afbf"}], "stats": {"total": 7, "additions": 7, "deletions": 0}, "files": [{"sha": "67074685cf6a451fbeb2805133d0769c891f63c6", "filename": "compiler/rustc_llvm/llvm-wrapper/CoverageMappingWrapper.cpp", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/dcdb9ad3d27aca6185af64f2e0318ed47860c6c0/compiler%2Frustc_llvm%2Fllvm-wrapper%2FCoverageMappingWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/dcdb9ad3d27aca6185af64f2e0318ed47860c6c0/compiler%2Frustc_llvm%2Fllvm-wrapper%2FCoverageMappingWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_llvm%2Fllvm-wrapper%2FCoverageMappingWrapper.cpp?ref=dcdb9ad3d27aca6185af64f2e0318ed47860c6c0", "patch": "@@ -23,10 +23,17 @@ extern \"C\" void LLVMRustCoverageWriteFilenamesSectionToBuffer(\n     const char* const Filenames[],\n     size_t FilenamesLen,\n     RustStringRef BufferOut) {\n+#if LLVM_VERSION_GE(12,0)\n+  SmallVector<std::string,32> FilenameRefs;\n+  for (size_t i = 0; i < FilenamesLen; i++) {\n+    FilenameRefs.push_back(std::string(Filenames[i]));\n+  }\n+#else\n   SmallVector<StringRef,32> FilenameRefs;\n   for (size_t i = 0; i < FilenamesLen; i++) {\n     FilenameRefs.push_back(StringRef(Filenames[i]));\n   }\n+#endif\n   auto FilenamesWriter = coverage::CoverageFilenamesSectionWriter(\n     makeArrayRef(FilenameRefs));\n   RawRustStringOstream OS(BufferOut);"}]}