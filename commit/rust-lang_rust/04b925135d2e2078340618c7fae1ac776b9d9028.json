{"sha": "04b925135d2e2078340618c7fae1ac776b9d9028", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA0YjkyNTEzNWQyZTIwNzgzNDA2MThjN2ZhZTFhYzc3NmI5ZDkwMjg=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-08-14T10:16:29Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-08-14T18:10:25Z"}, "message": "fix modulo logic", "tree": {"sha": "7094fe687f02efef0f70211b6c2cbe1db6ad8067", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7094fe687f02efef0f70211b6c2cbe1db6ad8067"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/04b925135d2e2078340618c7fae1ac776b9d9028", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/04b925135d2e2078340618c7fae1ac776b9d9028", "html_url": "https://github.com/rust-lang/rust/commit/04b925135d2e2078340618c7fae1ac776b9d9028", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/04b925135d2e2078340618c7fae1ac776b9d9028/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2b40d39c1e26c0964180fde51c5bfcf9247a70a8", "url": "https://api.github.com/repos/rust-lang/rust/commits/2b40d39c1e26c0964180fde51c5bfcf9247a70a8", "html_url": "https://github.com/rust-lang/rust/commit/2b40d39c1e26c0964180fde51c5bfcf9247a70a8"}], "stats": {"total": 7, "additions": 4, "deletions": 3}, "files": [{"sha": "ef297397fc5e1423e714e69c91d7d760bb0eca07", "filename": "src/operator.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/04b925135d2e2078340618c7fae1ac776b9d9028/src%2Foperator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04b925135d2e2078340618c7fae1ac776b9d9028/src%2Foperator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Foperator.rs?ref=04b925135d2e2078340618c7fae1ac776b9d9028", "patch": "@@ -197,14 +197,15 @@ impl<'a, 'mir, 'tcx> EvalContextExt<'tcx> for EvalContext<'a, 'mir, 'tcx, super:\n             }\n \n             Rem if !signed => {\n-                // Doing modulo a multiple of the alignment is allowed\n+                // Doing modulo a divisor of the alignment is allowed.\n+                // (Intuition: Modulo a divisor leaks less information.)\n                 let ptr_base_align = self.memory.get(left.alloc_id)?.align.abi();\n                 let right = right as u64;\n                 let ptr_size = self.memory.pointer_size().bytes() as u8;\n                 if right == 1 {\n                     // modulo 1 is always 0\n                     (Scalar::Bits { bits: 0, size: ptr_size }, false)\n-                } else if right % ptr_base_align == 0 {\n+                } else if ptr_base_align % right == 0 {\n                     // the base address would be cancelled out by the modulo operation, so we can\n                     // just take the modulo of the offset\n                     (Scalar::Bits { bits: (left.offset.bytes() % right) as u128, size: ptr_size }, false)"}, {"sha": "8a3665872f7cb4a0ff41342844c0040259bfe2c6", "filename": "tests/compile-fail/ptr_rem.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/04b925135d2e2078340618c7fae1ac776b9d9028/tests%2Fcompile-fail%2Fptr_rem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/04b925135d2e2078340618c7fae1ac776b9d9028/tests%2Fcompile-fail%2Fptr_rem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fptr_rem.rs?ref=04b925135d2e2078340618c7fae1ac776b9d9028", "patch": "@@ -1,5 +1,5 @@\n fn main() {\n     let val = 13usize;\n     let addr = &val as *const _ as usize;\n-    let _ = addr % 2; //~ ERROR access part of a pointer value as raw bytes\n+    let _ = addr % 16; //~ ERROR access part of a pointer value as raw bytes\n }"}]}