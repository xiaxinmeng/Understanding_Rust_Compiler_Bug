{"sha": "4c64c144202f6367755c476048aaaf0741af6086", "node_id": "C_kwDOAAsO6NoAKDRjNjRjMTQ0MjAyZjYzNjc3NTVjNDc2MDQ4YWFhZjA3NDFhZjYwODY", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-09-17T10:01:08Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-09-17T10:01:08Z"}, "message": "Rollup merge of #101790 - TaKO8Ki:do-not-suggest-placeholder-to-const-and-static-without-type, r=compiler-errors\n\nDo not suggest a placeholder to const and static without a type\n\nFixes #101755", "tree": {"sha": "01438396b2995a2c55e63673d3b4ded57e17965f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/01438396b2995a2c55e63673d3b4ded57e17965f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4c64c144202f6367755c476048aaaf0741af6086", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjJZrkCRBK7hj4Ov3rIwAAbhMIAFLGjgZHaufTMV0HOiSA7cPJ\n49GBqf4f7QuY/fZnxzCcs5tbhiQL8/SRJR/PGzxaX+Ed33HZd7jDtRBHcZ3fl5LG\nB8+ECSy4Wv4Jk9pAxn9QTK0k1Tr3X3VKlNLV/MEkBV8OOls9RrzjbtDW6hHdowng\no72bh4o8NDN/xuU0H2ElOdHwN4X/VXJPv2zGKvoog89hXaB6xFPj3BQUshtXNYWh\nOcNtpwF8BXyeecrqBcHmjVZ4RF2UIpZ1Ean5b0s0g8llmdhjopDIgZE6AGmzA+3j\n3KJTGHf6Gw8IZpMLC2DzUP+NcgbSknaGONW2i312IAh/416OEdpW3ZFAA/XG2mk=\n=nGiV\n-----END PGP SIGNATURE-----\n", "payload": "tree 01438396b2995a2c55e63673d3b4ded57e17965f\nparent cbd561d41f61201decae3adb45fe827d30aa96ec\nparent 527292a1a697c8831fc1ec01b1047ecebc10f809\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1663408868 +0530\ncommitter GitHub <noreply@github.com> 1663408868 +0530\n\nRollup merge of #101790 - TaKO8Ki:do-not-suggest-placeholder-to-const-and-static-without-type, r=compiler-errors\n\nDo not suggest a placeholder to const and static without a type\n\nFixes #101755\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4c64c144202f6367755c476048aaaf0741af6086", "html_url": "https://github.com/rust-lang/rust/commit/4c64c144202f6367755c476048aaaf0741af6086", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4c64c144202f6367755c476048aaaf0741af6086/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cbd561d41f61201decae3adb45fe827d30aa96ec", "url": "https://api.github.com/repos/rust-lang/rust/commits/cbd561d41f61201decae3adb45fe827d30aa96ec", "html_url": "https://github.com/rust-lang/rust/commit/cbd561d41f61201decae3adb45fe827d30aa96ec"}, {"sha": "527292a1a697c8831fc1ec01b1047ecebc10f809", "url": "https://api.github.com/repos/rust-lang/rust/commits/527292a1a697c8831fc1ec01b1047ecebc10f809", "html_url": "https://github.com/rust-lang/rust/commit/527292a1a697c8831fc1ec01b1047ecebc10f809"}], "stats": {"total": 40, "additions": 37, "deletions": 3}, "files": [{"sha": "6f969bfcc53f07f2445a93234a215bcdd9daaf5b", "filename": "compiler/rustc_errors/src/lib.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4c64c144202f6367755c476048aaaf0741af6086/compiler%2Frustc_errors%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4c64c144202f6367755c476048aaaf0741af6086/compiler%2Frustc_errors%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_errors%2Fsrc%2Flib.rs?ref=4c64c144202f6367755c476048aaaf0741af6086", "patch": "@@ -635,6 +635,10 @@ impl Handler {\n         inner.steal((span, key)).map(|diag| DiagnosticBuilder::new_diagnostic(self, diag))\n     }\n \n+    pub fn has_stashed_diagnostic(&self, span: Span, key: StashKey) -> bool {\n+        self.inner.borrow().stashed_diagnostics.get(&(span, key)).is_some()\n+    }\n+\n     /// Emit all stashed diagnostics.\n     pub fn emit_stashed_diagnostics(&self) -> Option<ErrorGuaranteed> {\n         self.inner.borrow_mut().emit_stashed_diagnostics()"}, {"sha": "189f1f7e40845a3329460404981a28277904c8d6", "filename": "compiler/rustc_typeck/src/collect.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/4c64c144202f6367755c476048aaaf0741af6086/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4c64c144202f6367755c476048aaaf0741af6086/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcollect.rs?ref=4c64c144202f6367755c476048aaaf0741af6086", "patch": "@@ -25,7 +25,7 @@ use rustc_ast::{MetaItemKind, NestedMetaItem};\n use rustc_attr::{list_contains_name, InlineAttr, InstructionSetAttr, OptimizeAttr};\n use rustc_data_structures::captures::Captures;\n use rustc_data_structures::fx::{FxHashMap, FxHashSet, FxIndexSet};\n-use rustc_errors::{struct_span_err, Applicability, DiagnosticBuilder, ErrorGuaranteed};\n+use rustc_errors::{struct_span_err, Applicability, DiagnosticBuilder, ErrorGuaranteed, StashKey};\n use rustc_hir as hir;\n use rustc_hir::def::{CtorKind, DefKind};\n use rustc_hir::def_id::{DefId, LocalDefId, CRATE_DEF_ID, LOCAL_CRATE};\n@@ -852,12 +852,14 @@ fn convert_trait_item(tcx: TyCtxt<'_>, trait_item_id: hir::TraitItemId) {\n             tcx.ensure().type_of(trait_item_id.def_id);\n         }\n \n-        hir::TraitItemKind::Const(..) => {\n+        hir::TraitItemKind::Const(hir_ty, _) => {\n             tcx.ensure().type_of(trait_item_id.def_id);\n             // Account for `const C: _;`.\n             let mut visitor = HirPlaceholderCollector::default();\n             visitor.visit_trait_item(trait_item);\n-            placeholder_type_error(tcx, None, visitor.0, false, None, \"constant\");\n+            if !tcx.sess.diagnostic().has_stashed_diagnostic(hir_ty.span, StashKey::ItemNoType) {\n+                placeholder_type_error(tcx, None, visitor.0, false, None, \"constant\");\n+            }\n         }\n \n         hir::TraitItemKind::Type(_, Some(_)) => {"}, {"sha": "97e0b213f2e7913ab6923bb5c5aaabc88b36de03", "filename": "src/test/ui/typeck/do-not-suggest-placeholder-to-const-static-without-type.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/4c64c144202f6367755c476048aaaf0741af6086/src%2Ftest%2Fui%2Ftypeck%2Fdo-not-suggest-placeholder-to-const-static-without-type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4c64c144202f6367755c476048aaaf0741af6086/src%2Ftest%2Fui%2Ftypeck%2Fdo-not-suggest-placeholder-to-const-static-without-type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fdo-not-suggest-placeholder-to-const-static-without-type.rs?ref=4c64c144202f6367755c476048aaaf0741af6086", "patch": "@@ -0,0 +1,8 @@\n+trait Foo {\n+    const A; //~ ERROR missing type for `const` item\n+    static B;\n+    //~^ ERROR associated `static` items are not allowed\n+    //~| ERROR missing type for `static` item\n+}\n+\n+fn main() {}"}, {"sha": "8982d6285617d911e962cfc2d08ecbb6ccbba4dd", "filename": "src/test/ui/typeck/do-not-suggest-placeholder-to-const-static-without-type.stderr", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/4c64c144202f6367755c476048aaaf0741af6086/src%2Ftest%2Fui%2Ftypeck%2Fdo-not-suggest-placeholder-to-const-static-without-type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4c64c144202f6367755c476048aaaf0741af6086/src%2Ftest%2Fui%2Ftypeck%2Fdo-not-suggest-placeholder-to-const-static-without-type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftypeck%2Fdo-not-suggest-placeholder-to-const-static-without-type.stderr?ref=4c64c144202f6367755c476048aaaf0741af6086", "patch": "@@ -0,0 +1,20 @@\n+error: associated `static` items are not allowed\n+  --> $DIR/do-not-suggest-placeholder-to-const-static-without-type.rs:3:5\n+   |\n+LL |     static B;\n+   |     ^^^^^^^^^\n+\n+error: missing type for `const` item\n+  --> $DIR/do-not-suggest-placeholder-to-const-static-without-type.rs:2:12\n+   |\n+LL |     const A;\n+   |            ^ help: provide a type for the item: `: <type>`\n+\n+error: missing type for `static` item\n+  --> $DIR/do-not-suggest-placeholder-to-const-static-without-type.rs:3:13\n+   |\n+LL |     static B;\n+   |             ^ help: provide a type for the item: `: <type>`\n+\n+error: aborting due to 3 previous errors\n+"}]}