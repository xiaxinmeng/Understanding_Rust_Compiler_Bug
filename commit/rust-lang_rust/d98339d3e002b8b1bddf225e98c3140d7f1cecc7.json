{"sha": "d98339d3e002b8b1bddf225e98c3140d7f1cecc7", "node_id": "C_kwDOAAsO6NoAKGQ5ODMzOWQzZTAwMmI4YjFiZGRmMjI1ZTk4YzMxNDBkN2YxY2VjYzc", "commit": {"author": {"name": "Jason Newcomb", "email": "jsnewcomb@pm.me", "date": "2022-01-05T18:57:45Z"}, "committer": {"name": "Jason Newcomb", "email": "jsnewcomb@pm.me", "date": "2022-01-05T22:19:13Z"}, "message": "Handle type projections in `iter_not_returning_iterator`", "tree": {"sha": "48492d3b193b25772f96b33cd5321faddc9ee50e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/48492d3b193b25772f96b33cd5321faddc9ee50e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d98339d3e002b8b1bddf225e98c3140d7f1cecc7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d98339d3e002b8b1bddf225e98c3140d7f1cecc7", "html_url": "https://github.com/rust-lang/rust/commit/d98339d3e002b8b1bddf225e98c3140d7f1cecc7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d98339d3e002b8b1bddf225e98c3140d7f1cecc7/comments", "author": {"login": "Jarcho", "id": 7761774, "node_id": "MDQ6VXNlcjc3NjE3NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7761774?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jarcho", "html_url": "https://github.com/Jarcho", "followers_url": "https://api.github.com/users/Jarcho/followers", "following_url": "https://api.github.com/users/Jarcho/following{/other_user}", "gists_url": "https://api.github.com/users/Jarcho/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jarcho/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jarcho/subscriptions", "organizations_url": "https://api.github.com/users/Jarcho/orgs", "repos_url": "https://api.github.com/users/Jarcho/repos", "events_url": "https://api.github.com/users/Jarcho/events{/privacy}", "received_events_url": "https://api.github.com/users/Jarcho/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Jarcho", "id": 7761774, "node_id": "MDQ6VXNlcjc3NjE3NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7761774?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jarcho", "html_url": "https://github.com/Jarcho", "followers_url": "https://api.github.com/users/Jarcho/followers", "following_url": "https://api.github.com/users/Jarcho/following{/other_user}", "gists_url": "https://api.github.com/users/Jarcho/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jarcho/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jarcho/subscriptions", "organizations_url": "https://api.github.com/users/Jarcho/orgs", "repos_url": "https://api.github.com/users/Jarcho/repos", "events_url": "https://api.github.com/users/Jarcho/events{/privacy}", "received_events_url": "https://api.github.com/users/Jarcho/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2cc38a23227e743aa24b7656ccbcee768ebef5ac", "url": "https://api.github.com/repos/rust-lang/rust/commits/2cc38a23227e743aa24b7656ccbcee768ebef5ac", "html_url": "https://github.com/rust-lang/rust/commit/2cc38a23227e743aa24b7656ccbcee768ebef5ac"}], "stats": {"total": 14, "additions": 13, "deletions": 1}, "files": [{"sha": "017a8a779d94290437e3c0655f2803c4888370b4", "filename": "clippy_lints/src/iter_not_returning_iterator.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d98339d3e002b8b1bddf225e98c3140d7f1cecc7/clippy_lints%2Fsrc%2Fiter_not_returning_iterator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d98339d3e002b8b1bddf225e98c3140d7f1cecc7/clippy_lints%2Fsrc%2Fiter_not_returning_iterator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fiter_not_returning_iterator.rs?ref=d98339d3e002b8b1bddf225e98c3140d7f1cecc7", "patch": "@@ -67,6 +67,10 @@ impl LateLintPass<'_> for IterNotReturningIterator {\n fn check_sig(cx: &LateContext<'_>, name: &str, sig: &FnSig<'_>, fn_id: LocalDefId) {\n     if sig.decl.implicit_self.has_implicit_self() {\n         let ret_ty = cx.tcx.fn_sig(fn_id).skip_binder().output();\n+        let ret_ty = cx\n+            .tcx\n+            .try_normalize_erasing_regions(cx.param_env, ret_ty)\n+            .unwrap_or(ret_ty);\n         if cx\n             .tcx\n             .get_diagnostic_item(sym::Iterator)"}, {"sha": "2c91e02e84223cd3257a4b898ac739ac9b675415", "filename": "tests/ui/iter_not_returning_iterator.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d98339d3e002b8b1bddf225e98c3140d7f1cecc7/tests%2Fui%2Fiter_not_returning_iterator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d98339d3e002b8b1bddf225e98c3140d7f1cecc7/tests%2Fui%2Fiter_not_returning_iterator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fiter_not_returning_iterator.rs?ref=d98339d3e002b8b1bddf225e98c3140d7f1cecc7", "patch": "@@ -44,6 +44,7 @@ impl Iterator for Counter {\n     }\n }\n \n+// Issue #8225\n trait Iter {\n     type I;\n     fn iter(&self) -> Self::I;\n@@ -56,4 +57,11 @@ impl Iter for () {\n     }\n }\n \n+struct S;\n+impl S {\n+    fn iter(&self) -> <() as Iter>::I {\n+        ().iter()\n+    }\n+}\n+\n fn main() {}"}, {"sha": "44f0295583695bfadd40376d53fd383c76ad0872", "filename": "tests/ui/iter_not_returning_iterator.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d98339d3e002b8b1bddf225e98c3140d7f1cecc7/tests%2Fui%2Fiter_not_returning_iterator.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d98339d3e002b8b1bddf225e98c3140d7f1cecc7/tests%2Fui%2Fiter_not_returning_iterator.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fiter_not_returning_iterator.stderr?ref=d98339d3e002b8b1bddf225e98c3140d7f1cecc7", "patch": "@@ -13,7 +13,7 @@ LL |     fn iter_mut(&self) -> Counter2 {\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: this method is named `iter` but its return type does not implement `Iterator`\n-  --> $DIR/iter_not_returning_iterator.rs:49:5\n+  --> $DIR/iter_not_returning_iterator.rs:50:5\n    |\n LL |     fn iter(&self) -> Self::I;\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^"}]}