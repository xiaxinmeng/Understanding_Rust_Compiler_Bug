{"sha": "4af36a4c6f9da83770579b0fc4c41ab17943c8bb", "node_id": "C_kwDOAAsO6NoAKDRhZjM2YTRjNmY5ZGE4Mzc3MDU3OWIwZmM0YzQxYWIxNzk0M2M4YmI", "commit": {"author": {"name": "Wesley Wiser", "email": "wesleywiser@microsoft.com", "date": "2022-10-10T15:10:26Z"}, "committer": {"name": "Wesley Wiser", "email": "wesleywiser@microsoft.com", "date": "2023-01-20T20:20:08Z"}, "message": "Upgrade to musl 1.2.3", "tree": {"sha": "71311e8805052fb0ffb32d0a9fa4c714b9db4d34", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/71311e8805052fb0ffb32d0a9fa4c714b9db4d34"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4af36a4c6f9da83770579b0fc4c41ab17943c8bb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4af36a4c6f9da83770579b0fc4c41ab17943c8bb", "html_url": "https://github.com/rust-lang/rust/commit/4af36a4c6f9da83770579b0fc4c41ab17943c8bb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4af36a4c6f9da83770579b0fc4c41ab17943c8bb/comments", "author": {"login": "wesleywiser", "id": 831192, "node_id": "MDQ6VXNlcjgzMTE5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/831192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wesleywiser", "html_url": "https://github.com/wesleywiser", "followers_url": "https://api.github.com/users/wesleywiser/followers", "following_url": "https://api.github.com/users/wesleywiser/following{/other_user}", "gists_url": "https://api.github.com/users/wesleywiser/gists{/gist_id}", "starred_url": "https://api.github.com/users/wesleywiser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wesleywiser/subscriptions", "organizations_url": "https://api.github.com/users/wesleywiser/orgs", "repos_url": "https://api.github.com/users/wesleywiser/repos", "events_url": "https://api.github.com/users/wesleywiser/events{/privacy}", "received_events_url": "https://api.github.com/users/wesleywiser/received_events", "type": "User", "site_admin": false}, "committer": {"login": "wesleywiser", "id": 831192, "node_id": "MDQ6VXNlcjgzMTE5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/831192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wesleywiser", "html_url": "https://github.com/wesleywiser", "followers_url": "https://api.github.com/users/wesleywiser/followers", "following_url": "https://api.github.com/users/wesleywiser/following{/other_user}", "gists_url": "https://api.github.com/users/wesleywiser/gists{/gist_id}", "starred_url": "https://api.github.com/users/wesleywiser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wesleywiser/subscriptions", "organizations_url": "https://api.github.com/users/wesleywiser/orgs", "repos_url": "https://api.github.com/users/wesleywiser/repos", "events_url": "https://api.github.com/users/wesleywiser/events{/privacy}", "received_events_url": "https://api.github.com/users/wesleywiser/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a6269dad38e6ede0013ba3688099544833933c63", "url": "https://api.github.com/repos/rust-lang/rust/commits/a6269dad38e6ede0013ba3688099544833933c63", "html_url": "https://github.com/rust-lang/rust/commit/a6269dad38e6ede0013ba3688099544833933c63"}], "stats": {"total": 20, "additions": 5, "deletions": 15}, "files": [{"sha": "a5b5cc491c308a7c85fe329f6e319897e999ce9a", "filename": "src/ci/docker/host-x86_64/dist-arm-linux/Dockerfile", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4af36a4c6f9da83770579b0fc4c41ab17943c8bb/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-arm-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/4af36a4c6f9da83770579b0fc4c41ab17943c8bb/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-arm-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-arm-linux%2FDockerfile?ref=4af36a4c6f9da83770579b0fc4c41ab17943c8bb", "patch": "@@ -8,7 +8,6 @@ RUN sh /scripts/crosstool-ng-1.24.sh\n \n WORKDIR /build\n \n-COPY scripts/musl-patch-configure.diff /build/\n COPY scripts/musl-toolchain.sh /build/\n # We need to mitigate rust-lang/rust#34978 when compiling musl itself as well\n RUN CFLAGS=\"-Wa,--compress-debug-sections=none -Wl,--compress-debug-sections=none\" \\"}, {"sha": "6f04dcad9a54fe44cb307e55e312aad5cb4a7123", "filename": "src/ci/docker/host-x86_64/dist-x86_64-musl/Dockerfile", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4af36a4c6f9da83770579b0fc4c41ab17943c8bb/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-musl%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/4af36a4c6f9da83770579b0fc4c41ab17943c8bb/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-musl%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-musl%2FDockerfile?ref=4af36a4c6f9da83770579b0fc4c41ab17943c8bb", "patch": "@@ -25,7 +25,6 @@ WORKDIR /build/\n COPY scripts/cmake.sh /scripts/\n RUN /scripts/cmake.sh\n \n-COPY scripts/musl-patch-configure.diff /build/\n COPY scripts/musl-toolchain.sh /build/\n # We need to mitigate rust-lang/rust#34978 when compiling musl itself as well\n RUN CFLAGS=\"-Wa,-mrelax-relocations=no -Wa,--compress-debug-sections=none -Wl,--compress-debug-sections=none\" \\"}, {"sha": "1dc7b7987243887529959bb90f94a64a4918df85", "filename": "src/ci/docker/host-x86_64/test-various/Dockerfile", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4af36a4c6f9da83770579b0fc4c41ab17943c8bb/src%2Fci%2Fdocker%2Fhost-x86_64%2Ftest-various%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/4af36a4c6f9da83770579b0fc4c41ab17943c8bb/src%2Fci%2Fdocker%2Fhost-x86_64%2Ftest-various%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Ftest-various%2FDockerfile?ref=4af36a4c6f9da83770579b0fc4c41ab17943c8bb", "patch": "@@ -33,7 +33,6 @@ RUN curl -sL --output ovmf-ia32.deb http://mirrors.kernel.org/ubuntu/pool/univer\n RUN dpkg -i ovmf-ia32.deb && rm ovmf-ia32.deb\n \n WORKDIR /build/\n-COPY scripts/musl-patch-configure.diff /build/\n COPY scripts/musl-toolchain.sh /build/\n RUN bash musl-toolchain.sh x86_64 && rm -rf build\n WORKDIR /"}, {"sha": "8a150ceeaa11680f59ecff1851ce4d52d8b1a130", "filename": "src/ci/docker/scripts/musl-toolchain.sh", "status": "modified", "additions": 4, "deletions": 11, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/4af36a4c6f9da83770579b0fc4c41ab17943c8bb/src%2Fci%2Fdocker%2Fscripts%2Fmusl-toolchain.sh", "raw_url": "https://github.com/rust-lang/rust/raw/4af36a4c6f9da83770579b0fc4c41ab17943c8bb/src%2Fci%2Fdocker%2Fscripts%2Fmusl-toolchain.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Fmusl-toolchain.sh?ref=4af36a4c6f9da83770579b0fc4c41ab17943c8bb", "patch": "@@ -4,7 +4,7 @@\n #\n # Versions of the toolchain components are configurable in `musl-cross-make/Makefile` and\n # musl unlike GLIBC is forward compatible so upgrading it shouldn't break old distributions.\n-# Right now we have: Binutils 2.31.1, GCC 9.2.0, musl 1.1.24.\n+# Right now we have: Binutils 2.31.1, GCC 9.2.0, musl 1.2.3.\n \n # ignore-tidy-linelength\n \n@@ -45,17 +45,10 @@ export CFLAGS=\"-fPIC -g1 $CFLAGS\"\n git clone https://github.com/richfelker/musl-cross-make # -b v0.9.9\n cd musl-cross-make\n # A few commits ahead of v0.9.9 to include the cowpatch fix:\n-git checkout a54eb56f33f255dfca60be045f12a5cfaf5a72a9\n+git checkout f442c9178b75cf12206113323a49f2e33ecd060b\n \n-# Fix the cfi detection script in musl's configure so cfi is generated\n-# when debug info is asked for. This patch is derived from\n-# https://git.musl-libc.org/cgit/musl/commit/?id=c4d4028dde90562f631edf559fbc42d8ec1b29de.\n-# When we upgrade to a version that includes this commit, we can remove the patch.\n-mkdir patches/musl-1.1.24\n-cp ../musl-patch-configure.diff patches/musl-1.1.24/0001-fix-cfi-detection.diff\n-\n-hide_output make -j$(nproc) TARGET=$TARGET MUSL_VER=1.1.24 LINUX_HEADERS_SITE=$LINUX_HEADERS_SITE\n-hide_output make install TARGET=$TARGET MUSL_VER=1.1.24 LINUX_HEADERS_SITE=$LINUX_HEADERS_SITE OUTPUT=$OUTPUT\n+hide_output make -j$(nproc) TARGET=$TARGET MUSL_VER=1.2.3 LINUX_HEADERS_SITE=$LINUX_HEADERS_SITE\n+hide_output make install TARGET=$TARGET MUSL_VER=1.2.3 LINUX_HEADERS_SITE=$LINUX_HEADERS_SITE OUTPUT=$OUTPUT\n \n cd -\n "}, {"sha": "ece8e6c15c0cbd3260168a228b4c376883e0bd26", "filename": "src/ci/docker/scripts/musl.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4af36a4c6f9da83770579b0fc4c41ab17943c8bb/src%2Fci%2Fdocker%2Fscripts%2Fmusl.sh", "raw_url": "https://github.com/rust-lang/rust/raw/4af36a4c6f9da83770579b0fc4c41ab17943c8bb/src%2Fci%2Fdocker%2Fscripts%2Fmusl.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fscripts%2Fmusl.sh?ref=4af36a4c6f9da83770579b0fc4c41ab17943c8bb", "patch": "@@ -25,7 +25,7 @@ shift\n # Apparently applying `-fPIC` everywhere allows them to link successfully.\n export CFLAGS=\"-fPIC $CFLAGS\"\n \n-MUSL=musl-1.1.24\n+MUSL=musl-1.2.3\n \n # may have been downloaded in a previous run\n if [ ! -d $MUSL ]; then"}]}