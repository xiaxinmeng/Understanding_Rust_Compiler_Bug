{"sha": "50985b012a6d14a1bee8ddf8d086d1741858dd3f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUwOTg1YjAxMmE2ZDE0YTFiZWU4ZGRmOGQwODZkMTc0MTg1OGRkM2Y=", "commit": {"author": {"name": "varkor", "email": "github@varkor.com", "date": "2019-10-08T22:09:36Z"}, "committer": {"name": "varkor", "email": "github@varkor.com", "date": "2019-12-06T12:23:23Z"}, "message": "Use `to_option_with` in several places", "tree": {"sha": "05552096e531ee5e338a6de1d2acfec982dcea74", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/05552096e531ee5e338a6de1d2acfec982dcea74"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/50985b012a6d14a1bee8ddf8d086d1741858dd3f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/50985b012a6d14a1bee8ddf8d086d1741858dd3f", "html_url": "https://github.com/rust-lang/rust/commit/50985b012a6d14a1bee8ddf8d086d1741858dd3f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/50985b012a6d14a1bee8ddf8d086d1741858dd3f/comments", "author": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e3a8ea4e18a50da60036d2731768a9cb78c90f5a", "url": "https://api.github.com/repos/rust-lang/rust/commits/e3a8ea4e18a50da60036d2731768a9cb78c90f5a", "html_url": "https://github.com/rust-lang/rust/commit/e3a8ea4e18a50da60036d2731768a9cb78c90f5a"}], "stats": {"total": 17, "additions": 10, "deletions": 7}, "files": [{"sha": "c61f16da26414d3602a0d345aae5d07aed45b575", "filename": "src/librustc_codegen_ssa/back/rpath.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/50985b012a6d14a1bee8ddf8d086d1741858dd3f/src%2Flibrustc_codegen_ssa%2Fback%2Frpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50985b012a6d14a1bee8ddf8d086d1741858dd3f/src%2Flibrustc_codegen_ssa%2Fback%2Frpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fback%2Frpath.rs?ref=50985b012a6d14a1bee8ddf8d086d1741858dd3f", "patch": "@@ -119,7 +119,7 @@ fn path_relative_from(path: &Path, base: &Path) -> Option<PathBuf> {\n     use std::path::Component;\n \n     if path.is_absolute() != base.is_absolute() {\n-        path.is_absolute().to_option(PathBuf::from(path))\n+        path.is_absolute().to_option_with(|| PathBuf::from(path))\n     } else {\n         let mut ita = path.components();\n         let mut itb = base.components();"}, {"sha": "2c2150e01a380302f12574229915aecd5f1a5566", "filename": "src/librustc_codegen_ssa/lib.rs", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/50985b012a6d14a1bee8ddf8d086d1741858dd3f/src%2Flibrustc_codegen_ssa%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50985b012a6d14a1bee8ddf8d086d1741858dd3f/src%2Flibrustc_codegen_ssa%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Flib.rs?ref=50985b012a6d14a1bee8ddf8d086d1741858dd3f", "patch": "@@ -69,11 +69,14 @@ impl<M> ModuleCodegen<M> {\n                             emit_bc: bool,\n                             emit_bc_compressed: bool,\n                             outputs: &OutputFilenames) -> CompiledModule {\n-        let object = emit_obj.to_option(outputs.temp_path(OutputType::Object, Some(&self.name)));\n-        let bytecode = emit_bc.to_option(outputs.temp_path(OutputType::Bitcode, Some(&self.name)));\n-        let bytecode_compressed = emit_bc_compressed.to_option(\n+        let object = emit_obj\n+            .to_option_with(|| outputs.temp_path(OutputType::Object, Some(&self.name)));\n+        let bytecode = emit_bc\n+            .to_option_with(|| outputs.temp_path(OutputType::Bitcode, Some(&self.name)));\n+        let bytecode_compressed = emit_bc_compressed.to_option_with(|| {\n             outputs.temp_path(OutputType::Bitcode, Some(&self.name))\n-                    .with_extension(RLIB_BYTECODE_EXTENSION));\n+                .with_extension(RLIB_BYTECODE_EXTENSION)\n+        });\n \n         CompiledModule {\n             name: self.name.clone(),"}, {"sha": "753d7b02ccad99509f8e701620866dade7048f6a", "filename": "src/librustc_interface/passes.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/50985b012a6d14a1bee8ddf8d086d1741858dd3f/src%2Flibrustc_interface%2Fpasses.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50985b012a6d14a1bee8ddf8d086d1741858dd3f/src%2Flibrustc_interface%2Fpasses.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_interface%2Fpasses.rs?ref=50985b012a6d14a1bee8ddf8d086d1741858dd3f", "patch": "@@ -547,7 +547,7 @@ fn output_contains_path(output_paths: &[PathBuf], input_path: &PathBuf) -> bool\n }\n \n fn output_conflicts_with_dir(output_paths: &[PathBuf]) -> Option<PathBuf> {\n-    let check = |output_path: &PathBuf| output_path.is_dir().to_option(output_path.clone());\n+    let check = |output_path: &PathBuf| output_path.is_dir().to_option_with(|| output_path.clone());\n     check_output(output_paths, check)\n }\n "}, {"sha": "9cdda56d2a2636317c1dafc694ad88a6c3b1e911", "filename": "src/librustc_session/session.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/50985b012a6d14a1bee8ddf8d086d1741858dd3f/src%2Flibrustc_session%2Fsession.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50985b012a6d14a1bee8ddf8d086d1741858dd3f/src%2Flibrustc_session%2Fsession.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_session%2Fsession.rs?ref=50985b012a6d14a1bee8ddf8d086d1741858dd3f", "patch": "@@ -752,7 +752,7 @@ impl Session {\n     }\n \n     pub fn incr_comp_session_dir_opt(&self) -> Option<cell::Ref<'_, PathBuf>> {\n-        self.opts.incremental.is_some().to_option(self.incr_comp_session_dir())\n+        self.opts.incremental.is_some().to_option_with(|| self.incr_comp_session_dir())\n     }\n \n     pub fn print_perf_stats(&self) {"}]}