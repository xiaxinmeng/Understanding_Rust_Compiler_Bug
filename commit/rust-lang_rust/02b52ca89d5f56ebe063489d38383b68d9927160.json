{"sha": "02b52ca89d5f56ebe063489d38383b68d9927160", "node_id": "C_kwDOAAsO6NoAKDAyYjUyY2E4OWQ1ZjU2ZWJlMDYzNDg5ZDM4MzgzYjY4ZDk5MjcxNjA", "commit": {"author": {"name": "Jubilee", "email": "46493976+workingjubilee@users.noreply.github.com", "date": "2021-10-05T04:12:39Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-10-05T04:12:39Z"}, "message": "Rollup merge of #89474 - camelid:better-pass-name, r=jyn514\n\nrustdoc: Improve doctest pass's name and module's name\n\nAs the docs at the top of the file say, it is an overloaded pass and\nactually runs two lints.", "tree": {"sha": "46d9da49fb68ebc931c8974937d0c9ed93ad387e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/46d9da49fb68ebc931c8974937d0c9ed93ad387e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/02b52ca89d5f56ebe063489d38383b68d9927160", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhW9C3CRBK7hj4Ov3rIwAA77AIAARMTwH2IPfQvr6p9ZFU+MJt\niNxQxq59jKJlLvhwUZJHfW6gVHOFkUkkgaQ8ecAtxU2IGQFltls2LBR3NFfTigou\nwoB6yVatAzdL1Nlg8r/7Fi2pxzK3+7p1R18cuh+AgRnNxAjoosse+VJsgaJCjaPN\nWvyPVpnvH90eVLnvdgMPKmkxJK6PVWqcpMNjq0y2egxcwAluUARmmY1QCzshVA5d\nwYBU2OyXC+VZMg/k8OV3HdJ0GliXEk1WUkCzN7E9U47G9iJVI6eoWdPaH1BOsonV\ngZeJAv2iwwETCt4gFF3UrX7DwcnMBpXdOUusQUKgX7ko26aB6ylkAiq7fNK3K4g=\n=a1If\n-----END PGP SIGNATURE-----\n", "payload": "tree 46d9da49fb68ebc931c8974937d0c9ed93ad387e\nparent c2bfe45e660b9c56cb4ef734b30c278bb0414ee7\nparent abbead78f7ab2d27ebf556970695472d1cdad44e\nauthor Jubilee <46493976+workingjubilee@users.noreply.github.com> 1633407159 -0700\ncommitter GitHub <noreply@github.com> 1633407159 -0700\n\nRollup merge of #89474 - camelid:better-pass-name, r=jyn514\n\nrustdoc: Improve doctest pass's name and module's name\n\nAs the docs at the top of the file say, it is an overloaded pass and\nactually runs two lints.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/02b52ca89d5f56ebe063489d38383b68d9927160", "html_url": "https://github.com/rust-lang/rust/commit/02b52ca89d5f56ebe063489d38383b68d9927160", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/02b52ca89d5f56ebe063489d38383b68d9927160/comments", "author": {"login": "workingjubilee", "id": 46493976, "node_id": "MDQ6VXNlcjQ2NDkzOTc2", "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/workingjubilee", "html_url": "https://github.com/workingjubilee", "followers_url": "https://api.github.com/users/workingjubilee/followers", "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}", "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}", "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions", "organizations_url": "https://api.github.com/users/workingjubilee/orgs", "repos_url": "https://api.github.com/users/workingjubilee/repos", "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}", "received_events_url": "https://api.github.com/users/workingjubilee/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c2bfe45e660b9c56cb4ef734b30c278bb0414ee7", "url": "https://api.github.com/repos/rust-lang/rust/commits/c2bfe45e660b9c56cb4ef734b30c278bb0414ee7", "html_url": "https://github.com/rust-lang/rust/commit/c2bfe45e660b9c56cb4ef734b30c278bb0414ee7"}, {"sha": "abbead78f7ab2d27ebf556970695472d1cdad44e", "url": "https://api.github.com/repos/rust-lang/rust/commits/abbead78f7ab2d27ebf556970695472d1cdad44e", "html_url": "https://github.com/rust-lang/rust/commit/abbead78f7ab2d27ebf556970695472d1cdad44e"}], "stats": {"total": 28, "additions": 14, "deletions": 14}, "files": [{"sha": "5e3bd41b85c7e060c89d94eb829a30f717f7b1c6", "filename": "src/librustdoc/passes/calculate_doc_coverage.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/02b52ca89d5f56ebe063489d38383b68d9927160/src%2Flibrustdoc%2Fpasses%2Fcalculate_doc_coverage.rs", "raw_url": "https://github.com/rust-lang/rust/raw/02b52ca89d5f56ebe063489d38383b68d9927160/src%2Flibrustdoc%2Fpasses%2Fcalculate_doc_coverage.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcalculate_doc_coverage.rs?ref=02b52ca89d5f56ebe063489d38383b68d9927160", "patch": "@@ -2,7 +2,7 @@ use crate::clean;\n use crate::core::DocContext;\n use crate::fold::{self, DocFolder};\n use crate::html::markdown::{find_testable_code, ErrorCodes};\n-use crate::passes::doc_test_lints::{should_have_doc_example, Tests};\n+use crate::passes::check_doc_test_visibility::{should_have_doc_example, Tests};\n use crate::passes::Pass;\n use rustc_hir as hir;\n use rustc_lint::builtin::MISSING_DOCS;"}, {"sha": "1f7d6054233dd987b5bb8e0f05b858d3b7791226", "filename": "src/librustdoc/passes/check_doc_test_visibility.rs", "status": "renamed", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/02b52ca89d5f56ebe063489d38383b68d9927160/src%2Flibrustdoc%2Fpasses%2Fcheck_doc_test_visibility.rs", "raw_url": "https://github.com/rust-lang/rust/raw/02b52ca89d5f56ebe063489d38383b68d9927160/src%2Flibrustdoc%2Fpasses%2Fcheck_doc_test_visibility.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcheck_doc_test_visibility.rs?ref=02b52ca89d5f56ebe063489d38383b68d9927160", "patch": "@@ -1,6 +1,6 @@\n //! This pass is overloaded and runs two different lints.\n //!\n-//! - MISSING_DOC_CODE_EXAMPLES: this lint is **UNSTABLE** and looks for public items missing doctests\n+//! - MISSING_DOC_CODE_EXAMPLES: this lint is **UNSTABLE** and looks for public items missing doctests.\n //! - PRIVATE_DOC_TESTS: this lint is **STABLE** and looks for private items with doctests.\n \n use super::Pass;\n@@ -15,23 +15,23 @@ use rustc_middle::lint::LintLevelSource;\n use rustc_session::lint;\n use rustc_span::symbol::sym;\n \n-crate const CHECK_PRIVATE_ITEMS_DOC_TESTS: Pass = Pass {\n-    name: \"check-private-items-doc-tests\",\n-    run: check_private_items_doc_tests,\n-    description: \"check private items doc tests\",\n+crate const CHECK_DOC_TEST_VISIBILITY: Pass = Pass {\n+    name: \"check_doc_test_visibility\",\n+    run: check_doc_test_visibility,\n+    description: \"run various visibility-related lints on doctests\",\n };\n \n-struct PrivateItemDocTestLinter<'a, 'tcx> {\n+struct DocTestVisibilityLinter<'a, 'tcx> {\n     cx: &'a mut DocContext<'tcx>,\n }\n \n-crate fn check_private_items_doc_tests(krate: Crate, cx: &mut DocContext<'_>) -> Crate {\n-    let mut coll = PrivateItemDocTestLinter { cx };\n+crate fn check_doc_test_visibility(krate: Crate, cx: &mut DocContext<'_>) -> Crate {\n+    let mut coll = DocTestVisibilityLinter { cx };\n \n     coll.fold_crate(krate)\n }\n \n-impl<'a, 'tcx> DocFolder for PrivateItemDocTestLinter<'a, 'tcx> {\n+impl<'a, 'tcx> DocFolder for DocTestVisibilityLinter<'a, 'tcx> {\n     fn fold_item(&mut self, item: Item) -> Option<Item> {\n         let dox = item.attrs.collapsed_doc_value().unwrap_or_else(String::new);\n ", "previous_filename": "src/librustdoc/passes/doc_test_lints.rs"}, {"sha": "99ac87db4ff3f389243515e1f58e48fae29c9f74", "filename": "src/librustdoc/passes/mod.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/02b52ca89d5f56ebe063489d38383b68d9927160/src%2Flibrustdoc%2Fpasses%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/02b52ca89d5f56ebe063489d38383b68d9927160/src%2Flibrustdoc%2Fpasses%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fmod.rs?ref=02b52ca89d5f56ebe063489d38383b68d9927160", "patch": "@@ -33,8 +33,8 @@ crate use self::propagate_doc_cfg::PROPAGATE_DOC_CFG;\n crate mod collect_intra_doc_links;\n crate use self::collect_intra_doc_links::COLLECT_INTRA_DOC_LINKS;\n \n-mod doc_test_lints;\n-crate use self::doc_test_lints::CHECK_PRIVATE_ITEMS_DOC_TESTS;\n+mod check_doc_test_visibility;\n+crate use self::check_doc_test_visibility::CHECK_DOC_TEST_VISIBILITY;\n \n mod collect_trait_impls;\n crate use self::collect_trait_impls::COLLECT_TRAIT_IMPLS;\n@@ -79,7 +79,7 @@ crate enum Condition {\n \n /// The full list of passes.\n crate const PASSES: &[Pass] = &[\n-    CHECK_PRIVATE_ITEMS_DOC_TESTS,\n+    CHECK_DOC_TEST_VISIBILITY,\n     STRIP_HIDDEN,\n     UNINDENT_COMMENTS,\n     STRIP_PRIVATE,\n@@ -97,7 +97,7 @@ crate const PASSES: &[Pass] = &[\n crate const DEFAULT_PASSES: &[ConditionalPass] = &[\n     ConditionalPass::always(COLLECT_TRAIT_IMPLS),\n     ConditionalPass::always(UNINDENT_COMMENTS),\n-    ConditionalPass::always(CHECK_PRIVATE_ITEMS_DOC_TESTS),\n+    ConditionalPass::always(CHECK_DOC_TEST_VISIBILITY),\n     ConditionalPass::new(STRIP_HIDDEN, WhenNotDocumentHidden),\n     ConditionalPass::new(STRIP_PRIVATE, WhenNotDocumentPrivate),\n     ConditionalPass::new(STRIP_PRIV_IMPORTS, WhenDocumentPrivate),"}]}