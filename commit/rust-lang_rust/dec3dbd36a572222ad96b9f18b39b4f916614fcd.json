{"sha": "dec3dbd36a572222ad96b9f18b39b4f916614fcd", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRlYzNkYmQzNmE1NzIyMjJhZDk2YjlmMThiMzliNGY5MTY2MTRmY2Q=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2021-01-08T02:11:50Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-01-08T02:11:50Z"}, "message": "Rollup merge of #80799 - jyn514:pretty-print, r=CraftSpider\n\nGet rid of custom pretty-printing in rustdoc\n\nand use rustc_hir_pretty directly instead.\n\nCloses https://github.com/rust-lang/rust/issues/79497.\n\nr? `@CraftSpider`", "tree": {"sha": "b7cc49fe9e764423866cca2722830863bb0080e5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b7cc49fe9e764423866cca2722830863bb0080e5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dec3dbd36a572222ad96b9f18b39b4f916614fcd", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJf979mCRBK7hj4Ov3rIwAAdHIIAJzLl2I+ncpDvU2NJiwSpEW3\n/p1hu0zRax5E8WyOr/3zCcyB1BbS0/nGW9h/OMak1NQlXzhrx+3+ZIL0QuadtGeQ\nR10HdX5tTz6IiLq5o7SK9F+c9AVoP64M1aOEHK3pslEDDI9LwTKTnOXSyJ1My3C9\nzO3tRCECq0MX1YEjEkH2WEQfBtNninFF4Ub3fBZdeiDlVyTkvr5WW85QO9JgdtKw\n5SamTdjdLZHDC9Ii91RSe8MwAYtJMNQbfPifXhfcixkgMEcO/kTe5M1Xm3oZoZ+b\nIWKhRai4W0rHY9TxfcuMXurn2vyuj2/Pad1xFddDT3iu95xHo078ZSEWlUgLLrE=\n=37WY\n-----END PGP SIGNATURE-----\n", "payload": "tree b7cc49fe9e764423866cca2722830863bb0080e5\nparent faf5412cd164e9ebd9a890e18e1e9ebefb42038e\nparent 31375d2074aeed0c6f173aa200f0bd3bf6d36756\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1610071910 +0900\ncommitter GitHub <noreply@github.com> 1610071910 +0900\n\nRollup merge of #80799 - jyn514:pretty-print, r=CraftSpider\n\nGet rid of custom pretty-printing in rustdoc\n\nand use rustc_hir_pretty directly instead.\n\nCloses https://github.com/rust-lang/rust/issues/79497.\n\nr? `@CraftSpider`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dec3dbd36a572222ad96b9f18b39b4f916614fcd", "html_url": "https://github.com/rust-lang/rust/commit/dec3dbd36a572222ad96b9f18b39b4f916614fcd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dec3dbd36a572222ad96b9f18b39b4f916614fcd/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "faf5412cd164e9ebd9a890e18e1e9ebefb42038e", "url": "https://api.github.com/repos/rust-lang/rust/commits/faf5412cd164e9ebd9a890e18e1e9ebefb42038e", "html_url": "https://github.com/rust-lang/rust/commit/faf5412cd164e9ebd9a890e18e1e9ebefb42038e"}, {"sha": "31375d2074aeed0c6f173aa200f0bd3bf6d36756", "url": "https://api.github.com/repos/rust-lang/rust/commits/31375d2074aeed0c6f173aa200f0bd3bf6d36756", "html_url": "https://github.com/rust-lang/rust/commit/31375d2074aeed0c6f173aa200f0bd3bf6d36756"}], "stats": {"total": 80, "additions": 9, "deletions": 71}, "files": [{"sha": "d29ca5c921a9a5576482002af4838df57edb0647", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/dec3dbd36a572222ad96b9f18b39b4f916614fcd/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dec3dbd36a572222ad96b9f18b39b4f916614fcd/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=dec3dbd36a572222ad96b9f18b39b4f916614fcd", "patch": "@@ -963,7 +963,7 @@ impl<'a> Clean<Arguments> for (&'a [hir::Ty<'a>], hir::BodyId) {\n                 .iter()\n                 .enumerate()\n                 .map(|(i, ty)| Argument {\n-                    name: name_from_pat(&body.params[i].pat),\n+                    name: Symbol::intern(&rustc_hir_pretty::param_to_string(&body.params[i])),\n                     type_: ty.clean(cx),\n                 })\n                 .collect(),"}, {"sha": "0f5495c8310580d4939477c81e0d2fa46a74a941", "filename": "src/librustdoc/clean/utils.rs", "status": "modified", "additions": 0, "deletions": 70, "changes": 70, "blob_url": "https://github.com/rust-lang/rust/blob/dec3dbd36a572222ad96b9f18b39b4f916614fcd/src%2Flibrustdoc%2Fclean%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dec3dbd36a572222ad96b9f18b39b4f916614fcd/src%2Flibrustdoc%2Fclean%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Futils.rs?ref=dec3dbd36a572222ad96b9f18b39b4f916614fcd", "patch": "@@ -314,25 +314,6 @@ crate fn strip_path(path: &Path) -> Path {\n     Path { global: path.global, res: path.res, segments }\n }\n \n-crate fn qpath_to_string(p: &hir::QPath<'_>) -> String {\n-    let segments = match *p {\n-        hir::QPath::Resolved(_, ref path) => &path.segments,\n-        hir::QPath::TypeRelative(_, ref segment) => return segment.ident.to_string(),\n-        hir::QPath::LangItem(lang_item, ..) => return lang_item.name().to_string(),\n-    };\n-\n-    let mut s = String::new();\n-    for (i, seg) in segments.iter().enumerate() {\n-        if i > 0 {\n-            s.push_str(\"::\");\n-        }\n-        if seg.ident.name != kw::PathRoot {\n-            s.push_str(&seg.ident.as_str());\n-        }\n-    }\n-    s\n-}\n-\n crate fn build_deref_target_impls(cx: &DocContext<'_>, items: &[Item], ret: &mut Vec<Item>) {\n     let tcx = cx.tcx;\n \n@@ -376,57 +357,6 @@ impl ToSource for rustc_span::Span {\n     }\n }\n \n-crate fn name_from_pat(p: &hir::Pat<'_>) -> Symbol {\n-    use rustc_hir::*;\n-    debug!(\"trying to get a name from pattern: {:?}\", p);\n-\n-    Symbol::intern(&match p.kind {\n-        PatKind::Wild => return kw::Underscore,\n-        PatKind::Binding(_, _, ident, _) => return ident.name,\n-        PatKind::TupleStruct(ref p, ..) | PatKind::Path(ref p) => qpath_to_string(p),\n-        PatKind::Struct(ref name, ref fields, etc) => format!(\n-            \"{} {{ {}{} }}\",\n-            qpath_to_string(name),\n-            fields\n-                .iter()\n-                .map(|fp| format!(\"{}: {}\", fp.ident, name_from_pat(&fp.pat)))\n-                .collect::<Vec<String>>()\n-                .join(\", \"),\n-            if etc { \", ..\" } else { \"\" }\n-        ),\n-        PatKind::Or(ref pats) => pats\n-            .iter()\n-            .map(|p| name_from_pat(&**p).to_string())\n-            .collect::<Vec<String>>()\n-            .join(\" | \"),\n-        PatKind::Tuple(ref elts, _) => format!(\n-            \"({})\",\n-            elts.iter()\n-                .map(|p| name_from_pat(&**p).to_string())\n-                .collect::<Vec<String>>()\n-                .join(\", \")\n-        ),\n-        PatKind::Box(ref p) => return name_from_pat(&**p),\n-        PatKind::Ref(ref p, _) => return name_from_pat(&**p),\n-        PatKind::Lit(..) => {\n-            warn!(\n-                \"tried to get argument name from PatKind::Lit, which is silly in function arguments\"\n-            );\n-            return Symbol::intern(\"()\");\n-        }\n-        PatKind::Range(..) => panic!(\n-            \"tried to get argument name from PatKind::Range, \\\n-             which is not allowed in function arguments\"\n-        ),\n-        PatKind::Slice(ref begin, ref mid, ref end) => {\n-            let begin = begin.iter().map(|p| name_from_pat(&**p).to_string());\n-            let mid = mid.as_ref().map(|p| format!(\"..{}\", name_from_pat(&**p))).into_iter();\n-            let end = end.iter().map(|p| name_from_pat(&**p).to_string());\n-            format!(\"[{}]\", begin.chain(mid).chain(end).collect::<Vec<_>>().join(\", \"))\n-        }\n-    })\n-}\n-\n crate fn print_const(cx: &DocContext<'_>, n: &'tcx ty::Const<'_>) -> String {\n     match n.val {\n         ty::ConstKind::Unevaluated(def, _, promoted) => {"}, {"sha": "fd255d02fcb6a2844c0de85ed090bde5ef75dbe0", "filename": "src/test/rustdoc-ui/range-pattern.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/dec3dbd36a572222ad96b9f18b39b4f916614fcd/src%2Ftest%2Frustdoc-ui%2Frange-pattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dec3dbd36a572222ad96b9f18b39b4f916614fcd/src%2Ftest%2Frustdoc-ui%2Frange-pattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Frange-pattern.rs?ref=dec3dbd36a572222ad96b9f18b39b4f916614fcd", "patch": "@@ -0,0 +1,3 @@\n+// check-pass\n+\n+fn func(0u8..=255: u8) {}"}, {"sha": "f4cc36b1055adff790168f6a8f1470500279be8a", "filename": "src/test/rustdoc/range-arg-pattern.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/dec3dbd36a572222ad96b9f18b39b4f916614fcd/src%2Ftest%2Frustdoc%2Frange-arg-pattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dec3dbd36a572222ad96b9f18b39b4f916614fcd/src%2Ftest%2Frustdoc%2Frange-arg-pattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Frange-arg-pattern.rs?ref=dec3dbd36a572222ad96b9f18b39b4f916614fcd", "patch": "@@ -0,0 +1,5 @@\n+#![crate_name = \"foo\"]\n+\n+// @has foo/fn.f.html\n+// @has - '//*[@class=\"rust fn\"]' 'pub fn f(0u8 ...255: u8)'\n+pub fn f(0u8...255: u8) {}"}]}