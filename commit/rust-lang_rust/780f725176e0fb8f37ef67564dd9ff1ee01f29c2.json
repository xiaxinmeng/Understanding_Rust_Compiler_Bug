{"sha": "780f725176e0fb8f37ef67564dd9ff1ee01f29c2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc4MGY3MjUxNzZlMGZiOGYzN2VmNjc1NjRkZDlmZjFlZTAxZjI5YzI=", "commit": {"author": {"name": "Georg Brandl", "email": "georg@python.org", "date": "2016-05-02T05:23:56Z"}, "committer": {"name": "Georg Brandl", "email": "georg@python.org", "date": "2016-05-03T06:26:00Z"}, "message": "typeck: when suggesting associated fns, do not show call site as fallback\n\nIn case we cannot produce a span for the location of the definition,\njust do not show a span at all.\n\ncc: #29121", "tree": {"sha": "20a91b9b96887c7daea078d819e6eb0a4017bb83", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/20a91b9b96887c7daea078d819e6eb0a4017bb83"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/780f725176e0fb8f37ef67564dd9ff1ee01f29c2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/780f725176e0fb8f37ef67564dd9ff1ee01f29c2", "html_url": "https://github.com/rust-lang/rust/commit/780f725176e0fb8f37ef67564dd9ff1ee01f29c2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/780f725176e0fb8f37ef67564dd9ff1ee01f29c2/comments", "author": {"login": "birkenfeld", "id": 144359, "node_id": "MDQ6VXNlcjE0NDM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/144359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/birkenfeld", "html_url": "https://github.com/birkenfeld", "followers_url": "https://api.github.com/users/birkenfeld/followers", "following_url": "https://api.github.com/users/birkenfeld/following{/other_user}", "gists_url": "https://api.github.com/users/birkenfeld/gists{/gist_id}", "starred_url": "https://api.github.com/users/birkenfeld/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/birkenfeld/subscriptions", "organizations_url": "https://api.github.com/users/birkenfeld/orgs", "repos_url": "https://api.github.com/users/birkenfeld/repos", "events_url": "https://api.github.com/users/birkenfeld/events{/privacy}", "received_events_url": "https://api.github.com/users/birkenfeld/received_events", "type": "User", "site_admin": false}, "committer": {"login": "birkenfeld", "id": 144359, "node_id": "MDQ6VXNlcjE0NDM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/144359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/birkenfeld", "html_url": "https://github.com/birkenfeld", "followers_url": "https://api.github.com/users/birkenfeld/followers", "following_url": "https://api.github.com/users/birkenfeld/following{/other_user}", "gists_url": "https://api.github.com/users/birkenfeld/gists{/gist_id}", "starred_url": "https://api.github.com/users/birkenfeld/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/birkenfeld/subscriptions", "organizations_url": "https://api.github.com/users/birkenfeld/orgs", "repos_url": "https://api.github.com/users/birkenfeld/repos", "events_url": "https://api.github.com/users/birkenfeld/events{/privacy}", "received_events_url": "https://api.github.com/users/birkenfeld/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "44b3cd8c462a420ab64a44ef8f70c007001a1f44", "url": "https://api.github.com/repos/rust-lang/rust/commits/44b3cd8c462a420ab64a44ef8f70c007001a1f44", "html_url": "https://github.com/rust-lang/rust/commit/44b3cd8c462a420ab64a44ef8f70c007001a1f44"}], "stats": {"total": 23, "additions": 15, "deletions": 8}, "files": [{"sha": "adc1972735a4702a432d80f849d99be62d551153", "filename": "src/librustc_typeck/check/method/suggest.rs", "status": "modified", "additions": 15, "deletions": 8, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/780f725176e0fb8f37ef67564dd9ff1ee01f29c2/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fsuggest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/780f725176e0fb8f37ef67564dd9ff1ee01f29c2/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fsuggest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmethod%2Fsuggest.rs?ref=780f725176e0fb8f37ef67564dd9ff1ee01f29c2", "patch": "@@ -237,7 +237,7 @@ pub fn report_error<'a, 'tcx>(fcx: &FnCtxt<'a, 'tcx>,\n             match *source {\n                 CandidateSource::ImplSource(impl_did) => {\n                     // Provide the best span we can. Use the item, if local to crate, else\n-                    // the impl, if local to crate (item may be defaulted), else the call site.\n+                    // the impl, if local to crate (item may be defaulted), else nothing.\n                     let item = impl_item(fcx.tcx(), impl_did, item_name)\n                         .or_else(|| {\n                             trait_item(\n@@ -246,8 +246,9 @@ pub fn report_error<'a, 'tcx>(fcx: &FnCtxt<'a, 'tcx>,\n                                 item_name\n                             )\n                         }).unwrap();\n-                    let impl_span = fcx.tcx().map.def_id_span(impl_did, span);\n-                    let item_span = fcx.tcx().map.def_id_span(item.def_id(), impl_span);\n+                    let note_span = fcx.tcx().map.span_if_local(item.def_id()).or_else(|| {\n+                        fcx.tcx().map.span_if_local(impl_did)\n+                    });\n \n                     let impl_ty = check::impl_self_ty(fcx, span, impl_did).ty;\n \n@@ -259,11 +260,17 @@ pub fn report_error<'a, 'tcx>(fcx: &FnCtxt<'a, 'tcx>,\n                         }\n                     };\n \n-                    span_note!(err, item_span,\n-                               \"candidate #{} is defined in an impl{} for the type `{}`\",\n-                               idx + 1,\n-                               insertion,\n-                               impl_ty);\n+                    let note_str = format!(\"candidate #{} is defined in an impl{} \\\n+                                            for the type `{}`\",\n+                                           idx + 1,\n+                                           insertion,\n+                                           impl_ty);\n+                    if let Some(note_span) = note_span {\n+                        // We have a span pointing to the method. Show note with snippet.\n+                        err.span_note(note_span, &note_str);\n+                    } else {\n+                        err.note(&note_str);\n+                    }\n                 }\n                 CandidateSource::TraitSource(trait_did) => {\n                     let item = trait_item(fcx.tcx(), trait_did, item_name).unwrap();"}]}