{"sha": "5ce5126199d0edf278ef0d9bb60534770d96f3f6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjZTUxMjYxOTlkMGVkZjI3OGVmMGQ5YmI2MDUzNDc3MGQ5NmYzZjY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-06-19T08:45:00Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-06-19T08:45:00Z"}, "message": "Auto merge of #42737 - fhahn:rust-log-crash, r=michaelwoerister\n\nrustc: Check if def_path_hash_to_def_id is populated before accessing.\n\nWithout this patch, there is an ICE when running rustc with\nRUST_LOG=debug. This patch updates extract_def_id to check if the map\nhas been populated before accessing it. This fixes the problem, but\nmaybe we do not need to compute the incremental hashes maps in the first\nplace when we are not in incremental mode?", "tree": {"sha": "5120864385a813ca8d605fbeaf3871a33a8d891d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5120864385a813ca8d605fbeaf3871a33a8d891d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5ce5126199d0edf278ef0d9bb60534770d96f3f6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5ce5126199d0edf278ef0d9bb60534770d96f3f6", "html_url": "https://github.com/rust-lang/rust/commit/5ce5126199d0edf278ef0d9bb60534770d96f3f6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5ce5126199d0edf278ef0d9bb60534770d96f3f6/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8525eb820b2449569a7fa342ffcdd6633d4383bf", "url": "https://api.github.com/repos/rust-lang/rust/commits/8525eb820b2449569a7fa342ffcdd6633d4383bf", "html_url": "https://github.com/rust-lang/rust/commit/8525eb820b2449569a7fa342ffcdd6633d4383bf"}, {"sha": "8723f287726073b43d3946838d930ce108d52988", "url": "https://api.github.com/repos/rust-lang/rust/commits/8723f287726073b43d3946838d930ce108d52988", "html_url": "https://github.com/rust-lang/rust/commit/8723f287726073b43d3946838d930ce108d52988"}], "stats": {"total": 23, "additions": 18, "deletions": 5}, "files": [{"sha": "92efeb7fd8629acf6f1e68577d8dbff8219804f0", "filename": "src/librustc/dep_graph/dep_node.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/5ce5126199d0edf278ef0d9bb60534770d96f3f6/src%2Flibrustc%2Fdep_graph%2Fdep_node.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ce5126199d0edf278ef0d9bb60534770d96f3f6/src%2Flibrustc%2Fdep_graph%2Fdep_node.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdep_graph%2Fdep_node.rs?ref=5ce5126199d0edf278ef0d9bb60534770d96f3f6", "patch": "@@ -257,11 +257,11 @@ macro_rules! define_dep_nodes {\n             pub fn extract_def_id(&self, tcx: TyCtxt) -> Option<DefId> {\n                 if self.kind.can_reconstruct_query_key() {\n                     let def_path_hash = DefPathHash(self.hash);\n-                    tcx.def_path_hash_to_def_id\n-                       .as_ref()\n-                       .unwrap()\n-                       .get(&def_path_hash)\n-                       .cloned()\n+                    if let Some(ref def_path_map) = tcx.def_path_hash_to_def_id.as_ref() {\n+                        def_path_map.get(&def_path_hash).cloned()\n+                    } else {\n+                       None\n+                    }\n                 } else {\n                     None\n                 }"}, {"sha": "629387d4cb11d554840a56c89b2f3f96ec2046f2", "filename": "src/test/run-pass/rustc-rust-log.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5ce5126199d0edf278ef0d9bb60534770d96f3f6/src%2Ftest%2Frun-pass%2Frustc-rust-log.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5ce5126199d0edf278ef0d9bb60534770d96f3f6/src%2Ftest%2Frun-pass%2Frustc-rust-log.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Frustc-rust-log.rs?ref=5ce5126199d0edf278ef0d9bb60534770d96f3f6", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// rustc-env:RUST_LOG=debug\n+\n+fn main() {}"}]}