{"sha": "2d5217dbb76593a1dba1ff3db3ca0221c457e687", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJkNTIxN2RiYjc2NTkzYTFkYmExZmYzZGIzY2EwMjIxYzQ1N2U2ODc=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2017-12-30T12:29:09Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2017-12-30T12:29:09Z"}, "message": "More readable lexer tests", "tree": {"sha": "9874ffed0e2cc39eee0c374738936954c1cee05c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9874ffed0e2cc39eee0c374738936954c1cee05c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2d5217dbb76593a1dba1ff3db3ca0221c457e687", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2d5217dbb76593a1dba1ff3db3ca0221c457e687", "html_url": "https://github.com/rust-lang/rust/commit/2d5217dbb76593a1dba1ff3db3ca0221c457e687", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2d5217dbb76593a1dba1ff3db3ca0221c457e687/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ddc637c16120fb352183698f635fc93a68580f7b", "url": "https://api.github.com/repos/rust-lang/rust/commits/ddc637c16120fb352183698f635fc93a68580f7b", "html_url": "https://github.com/rust-lang/rust/commit/ddc637c16120fb352183698f635fc93a68580f7b"}], "stats": {"total": 201, "additions": 103, "deletions": 98}, "files": [{"sha": "b380117e6317f4ecd131224cd31e4b8d242ef3f5", "filename": "src/lexer/ptr.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2d5217dbb76593a1dba1ff3db3ca0221c457e687/src%2Flexer%2Fptr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d5217dbb76593a1dba1ff3db3ca0221c457e687/src%2Flexer%2Fptr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flexer%2Fptr.rs?ref=2d5217dbb76593a1dba1ff3db3ca0221c457e687", "patch": "@@ -56,6 +56,7 @@ impl<'s> Ptr<'s> {\n     }\n \n     fn chars(&self) -> Chars {\n-        self.text[self.len.0 as usize ..].chars()\n+        let len: u32 = self.len.into();\n+        self.text[len as usize ..].chars()\n     }\n }"}, {"sha": "c3ef1ac8ea64c447c3f9130d170148ddb49b69e2", "filename": "src/text.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2d5217dbb76593a1dba1ff3db3ca0221c457e687/src%2Ftext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d5217dbb76593a1dba1ff3db3ca0221c457e687/src%2Ftext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftext.rs?ref=2d5217dbb76593a1dba1ff3db3ca0221c457e687", "patch": "@@ -2,9 +2,7 @@ use std::fmt;\n use std::ops;\n \n #[derive(Clone, Copy, PartialEq, Eq, PartialOrd, Ord, Hash)]\n-pub struct TextUnit(\n-    pub(crate) u32\n-);\n+pub struct TextUnit(u32);\n \n impl TextUnit {\n     pub fn len_of_char(c: char) -> TextUnit {"}, {"sha": "27a5940a9c1ca360e1e87ce4fb3c507cba120f70", "filename": "tests/data/lexer/0001_hello.txt", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2d5217dbb76593a1dba1ff3db3ca0221c457e687/tests%2Fdata%2Flexer%2F0001_hello.txt", "raw_url": "https://github.com/rust-lang/rust/raw/2d5217dbb76593a1dba1ff3db3ca0221c457e687/tests%2Fdata%2Flexer%2F0001_hello.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Flexer%2F0001_hello.txt?ref=2d5217dbb76593a1dba1ff3db3ca0221c457e687", "patch": "@@ -1,3 +1,3 @@\n-IDENT 5\n-WHITESPACE 1\n-IDENT 5\n+IDENT 5 \"hello\"\n+WHITESPACE 1 \" \"\n+IDENT 5 \"world\""}, {"sha": "01d260918ee57db94ad80f55696e70f6765e32fd", "filename": "tests/data/lexer/0002_whitespace.txt", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/2d5217dbb76593a1dba1ff3db3ca0221c457e687/tests%2Fdata%2Flexer%2F0002_whitespace.txt", "raw_url": "https://github.com/rust-lang/rust/raw/2d5217dbb76593a1dba1ff3db3ca0221c457e687/tests%2Fdata%2Flexer%2F0002_whitespace.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Flexer%2F0002_whitespace.txt?ref=2d5217dbb76593a1dba1ff3db3ca0221c457e687", "patch": "@@ -1,12 +1,12 @@\n-IDENT 1\n-WHITESPACE 1\n-IDENT 1\n-WHITESPACE 2\n-IDENT 1\n-WHITESPACE 1\n-IDENT 1\n-WHITESPACE 2\n-IDENT 1\n-WHITESPACE 1\n-IDENT 1\n-WHITESPACE 1\n+IDENT 1 \"a\"\n+WHITESPACE 1 \" \"\n+IDENT 1 \"b\"\n+WHITESPACE 2 \"  \"\n+IDENT 1 \"c\"\n+WHITESPACE 1 \"\\n\"\n+IDENT 1 \"d\"\n+WHITESPACE 2 \"\\n\\n\"\n+IDENT 1 \"e\"\n+WHITESPACE 1 \"\\t\"\n+IDENT 1 \"f\"\n+WHITESPACE 1 \"\\n\""}, {"sha": "4a0d5c0531205ef09d698894d4874629bc5b750f", "filename": "tests/data/lexer/0003_ident.txt", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/2d5217dbb76593a1dba1ff3db3ca0221c457e687/tests%2Fdata%2Flexer%2F0003_ident.txt", "raw_url": "https://github.com/rust-lang/rust/raw/2d5217dbb76593a1dba1ff3db3ca0221c457e687/tests%2Fdata%2Flexer%2F0003_ident.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Flexer%2F0003_ident.txt?ref=2d5217dbb76593a1dba1ff3db3ca0221c457e687", "patch": "@@ -1,14 +1,14 @@\n-IDENT 3\n-WHITESPACE 1\n-IDENT 4\n-WHITESPACE 1\n-IDENT 4\n-WHITESPACE 1\n-UNDERSCORE 1\n-WHITESPACE 1\n-IDENT 2\n-WHITESPACE 1\n-IDENT 1\n-WHITESPACE 1\n-IDENT 12\n-WHITESPACE 1\n+IDENT 3 \"foo\"\n+WHITESPACE 1 \" \"\n+IDENT 4 \"foo_\"\n+WHITESPACE 1 \" \"\n+IDENT 4 \"_foo\"\n+WHITESPACE 1 \" \"\n+UNDERSCORE 1 \"_\"\n+WHITESPACE 1 \" \"\n+IDENT 2 \"__\"\n+WHITESPACE 1 \" \"\n+IDENT 1 \"x\"\n+WHITESPACE 1 \" \"\n+IDENT 12 \"\u043f\u0440\u0438\u0432\u0435\u0442\"\n+WHITESPACE 1 \"\\n\""}, {"sha": "7dedd2cacb35e84b61d6e6b6b5c888ad4ac3de22", "filename": "tests/data/lexer/0004_number.txt", "status": "modified", "additions": 62, "deletions": 62, "changes": 124, "blob_url": "https://github.com/rust-lang/rust/blob/2d5217dbb76593a1dba1ff3db3ca0221c457e687/tests%2Fdata%2Flexer%2F0004_number.txt", "raw_url": "https://github.com/rust-lang/rust/raw/2d5217dbb76593a1dba1ff3db3ca0221c457e687/tests%2Fdata%2Flexer%2F0004_number.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdata%2Flexer%2F0004_number.txt?ref=2d5217dbb76593a1dba1ff3db3ca0221c457e687", "patch": "@@ -1,62 +1,62 @@\n-INT_NUMBER 1\n-WHITESPACE 1\n-INT_NUMBER 2\n-WHITESPACE 1\n-INT_NUMBER 2\n-WHITESPACE 1\n-INT_NUMBER 2\n-WHITESPACE 1\n-INT_NUMBER 2\n-WHITESPACE 1\n-INT_NUMBER 2\n-WHITESPACE 1\n-FLOAT_NUMBER 2\n-WHITESPACE 1\n-INT_NUMBER 2\n-WHITESPACE 1\n-INT_NUMBER 2\n-WHITESPACE 1\n-INT_NUMBER 1\n-IDENT 1\n-WHITESPACE 1\n-INT_NUMBER 5\n-WHITESPACE 1\n-INT_NUMBER 6\n-WHITESPACE 1\n-INT_NUMBER 6\n-WHITESPACE 1\n-INT_NUMBER 18\n-WHITESPACE 1\n-INT_NUMBER 6\n-WHITESPACE 1\n-INT_NUMBER 6\n-WHITESPACE 1\n-FLOAT_NUMBER 6\n-WHITESPACE 1\n-INT_NUMBER 6\n-WHITESPACE 1\n-INT_NUMBER 6\n-WHITESPACE 1\n-INT_NUMBER 1\n-ERROR 1\n-ERROR 1\n-INT_NUMBER 1\n-WHITESPACE 1\n-INT_NUMBER 1\n-ERROR 1\n-IDENT 3\n-ERROR 1\n-ERROR 1\n-WHITESPACE 1\n-INT_NUMBER 2\n-ERROR 1\n-INT_NUMBER 1\n-WHITESPACE 1\n-INT_NUMBER 1\n-ERROR 1\n-IDENT 1\n-ERROR 1\n-INT_NUMBER 1\n-WHITESPACE 1\n-FLOAT_NUMBER 6\n-WHITESPACE 1\n+INT_NUMBER 1 \"0\"\n+WHITESPACE 1 \" \"\n+INT_NUMBER 2 \"0b\"\n+WHITESPACE 1 \" \"\n+INT_NUMBER 2 \"0o\"\n+WHITESPACE 1 \" \"\n+INT_NUMBER 2 \"0x\"\n+WHITESPACE 1 \" \"\n+INT_NUMBER 2 \"00\"\n+WHITESPACE 1 \" \"\n+INT_NUMBER 2 \"0_\"\n+WHITESPACE 1 \" \"\n+FLOAT_NUMBER 2 \"0.\"\n+WHITESPACE 1 \" \"\n+INT_NUMBER 2 \"0e\"\n+WHITESPACE 1 \" \"\n+INT_NUMBER 2 \"0E\"\n+WHITESPACE 1 \" \"\n+INT_NUMBER 1 \"0\"\n+IDENT 1 \"z\"\n+WHITESPACE 1 \"\\n\"\n+INT_NUMBER 5 \"01790\"\n+WHITESPACE 1 \" \"\n+INT_NUMBER 6 \"0b1790\"\n+WHITESPACE 1 \" \"\n+INT_NUMBER 6 \"0o1790\"\n+WHITESPACE 1 \" \"\n+INT_NUMBER 18 \"0x1790aAbBcCdDeEfF\"\n+WHITESPACE 1 \" \"\n+INT_NUMBER 6 \"001279\"\n+WHITESPACE 1 \" \"\n+INT_NUMBER 6 \"0_1279\"\n+WHITESPACE 1 \" \"\n+FLOAT_NUMBER 6 \"0.1279\"\n+WHITESPACE 1 \" \"\n+INT_NUMBER 6 \"0e1279\"\n+WHITESPACE 1 \" \"\n+INT_NUMBER 6 \"0E1279\"\n+WHITESPACE 1 \"\\n\"\n+INT_NUMBER 1 \"0\"\n+ERROR 1 \".\"\n+ERROR 1 \".\"\n+INT_NUMBER 1 \"2\"\n+WHITESPACE 1 \"\\n\"\n+INT_NUMBER 1 \"0\"\n+ERROR 1 \".\"\n+IDENT 3 \"foo\"\n+ERROR 1 \"(\"\n+ERROR 1 \")\"\n+WHITESPACE 1 \"\\n\"\n+INT_NUMBER 2 \"0e\"\n+ERROR 1 \"+\"\n+INT_NUMBER 1 \"1\"\n+WHITESPACE 1 \"\\n\"\n+INT_NUMBER 1 \"0\"\n+ERROR 1 \".\"\n+IDENT 1 \"e\"\n+ERROR 1 \"+\"\n+INT_NUMBER 1 \"1\"\n+WHITESPACE 1 \"\\n\"\n+FLOAT_NUMBER 6 \"0.0E-2\"\n+WHITESPACE 1 \"\\n\""}, {"sha": "6a9bab66bd0d6c278eca313a87ed5acd2b99520b", "filename": "tests/lexer.rs", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/2d5217dbb76593a1dba1ff3db3ca0221c457e687/tests%2Flexer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d5217dbb76593a1dba1ff3db3ca0221c457e687/tests%2Flexer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Flexer.rs?ref=2d5217dbb76593a1dba1ff3db3ca0221c457e687", "patch": "@@ -31,14 +31,15 @@ fn lexer_test_cases() -> Vec<PathBuf> {\n             acc.push(path);\n         }\n     }\n+    acc.sort();\n     acc\n }\n \n fn lexer_test_case(path: &Path) {\n     let actual = {\n         let text = file::get_text(path).unwrap();\n         let tokens = tokenize(&text);\n-        dump_tokens(&tokens)\n+        dump_tokens(&tokens, &text)\n     };\n     let expected = file::get_text(&path.with_extension(\"txt\")).unwrap();\n     let expected = expected.as_str();\n@@ -64,10 +65,15 @@ fn tokenize(text: &str) -> Vec<Token> {\n     acc\n }\n \n-fn dump_tokens(tokens: &[Token]) -> String {\n+fn dump_tokens(tokens: &[Token], text: &str) -> String {\n     let mut acc = String::new();\n+    let mut offset = 0;\n     for token in tokens {\n-        write!(acc, \"{:?} {}\\n\", token.kind, token.len).unwrap()\n+        let len: u32 = token.len.into();\n+        let len = len as usize;\n+        let token_text = &text[offset..offset + len];\n+        offset += len;\n+        write!(acc, \"{:?} {} {:?}\\n\", token.kind, token.len, token_text).unwrap()\n     }\n     acc\n }\n\\ No newline at end of file"}]}