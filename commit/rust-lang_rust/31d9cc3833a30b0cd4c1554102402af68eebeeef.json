{"sha": "31d9cc3833a30b0cd4c1554102402af68eebeeef", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMxZDljYzM4MzNhMzBiMGNkNGMxNTU0MTAyNDAyYWY2OGVlYmVlZWY=", "commit": {"author": {"name": "Jeffrey Seyfried", "email": "jeffrey.seyfried@gmail.com", "date": "2016-12-23T02:16:31Z"}, "committer": {"name": "Jeffrey Seyfried", "email": "jeffrey.seyfried@gmail.com", "date": "2016-12-23T02:16:31Z"}, "message": "Fix import resolution bug and fold all idents in the AST.", "tree": {"sha": "b9633742dac484d7cbadb4366ed80e82fa5d355b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b9633742dac484d7cbadb4366ed80e82fa5d355b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/31d9cc3833a30b0cd4c1554102402af68eebeeef", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/31d9cc3833a30b0cd4c1554102402af68eebeeef", "html_url": "https://github.com/rust-lang/rust/commit/31d9cc3833a30b0cd4c1554102402af68eebeeef", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/31d9cc3833a30b0cd4c1554102402af68eebeeef/comments", "author": {"login": "jseyfried", "id": 8652869, "node_id": "MDQ6VXNlcjg2NTI4Njk=", "avatar_url": "https://avatars.githubusercontent.com/u/8652869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jseyfried", "html_url": "https://github.com/jseyfried", "followers_url": "https://api.github.com/users/jseyfried/followers", "following_url": "https://api.github.com/users/jseyfried/following{/other_user}", "gists_url": "https://api.github.com/users/jseyfried/gists{/gist_id}", "starred_url": "https://api.github.com/users/jseyfried/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jseyfried/subscriptions", "organizations_url": "https://api.github.com/users/jseyfried/orgs", "repos_url": "https://api.github.com/users/jseyfried/repos", "events_url": "https://api.github.com/users/jseyfried/events{/privacy}", "received_events_url": "https://api.github.com/users/jseyfried/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jseyfried", "id": 8652869, "node_id": "MDQ6VXNlcjg2NTI4Njk=", "avatar_url": "https://avatars.githubusercontent.com/u/8652869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jseyfried", "html_url": "https://github.com/jseyfried", "followers_url": "https://api.github.com/users/jseyfried/followers", "following_url": "https://api.github.com/users/jseyfried/following{/other_user}", "gists_url": "https://api.github.com/users/jseyfried/gists{/gist_id}", "starred_url": "https://api.github.com/users/jseyfried/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jseyfried/subscriptions", "organizations_url": "https://api.github.com/users/jseyfried/orgs", "repos_url": "https://api.github.com/users/jseyfried/repos", "events_url": "https://api.github.com/users/jseyfried/events{/privacy}", "received_events_url": "https://api.github.com/users/jseyfried/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c217ab6c8dc1a305304b00a414be5f39ea6a2c81", "url": "https://api.github.com/repos/rust-lang/rust/commits/c217ab6c8dc1a305304b00a414be5f39ea6a2c81", "html_url": "https://github.com/rust-lang/rust/commit/c217ab6c8dc1a305304b00a414be5f39ea6a2c81"}], "stats": {"total": 54, "additions": 37, "deletions": 17}, "files": [{"sha": "5972f2d87c44cae5b516367c33ac4dba55919efb", "filename": "src/librustc_resolve/resolve_imports.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/31d9cc3833a30b0cd4c1554102402af68eebeeef/src%2Flibrustc_resolve%2Fresolve_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/31d9cc3833a30b0cd4c1554102402af68eebeeef/src%2Flibrustc_resolve%2Fresolve_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fresolve_imports.rs?ref=31d9cc3833a30b0cd4c1554102402af68eebeeef", "patch": "@@ -128,6 +128,7 @@ impl<'a> NameResolution<'a> {\n impl<'a> Resolver<'a> {\n     fn resolution(&self, module: Module<'a>, ident: Ident, ns: Namespace)\n                   -> &'a RefCell<NameResolution<'a>> {\n+        let ident = ident.unhygienize();\n         *module.resolutions.borrow_mut().entry((ident, ns))\n                .or_insert_with(|| self.arenas.alloc_name_resolution())\n     }\n@@ -141,7 +142,6 @@ impl<'a> Resolver<'a> {\n                                    ignore_unresolved_invocations: bool,\n                                    record_used: Option<Span>)\n                                    -> Result<&'a NameBinding<'a>, Determinacy> {\n-        let ident = ident.unhygienize();\n         self.populate_module_if_necessary(module);\n \n         let resolution = self.resolution(module, ident, ns)\n@@ -307,7 +307,6 @@ impl<'a> Resolver<'a> {\n                       ns: Namespace,\n                       binding: &'a NameBinding<'a>)\n                       -> Result<(), &'a NameBinding<'a>> {\n-        let ident = ident.unhygienize();\n         self.update_resolution(module, ident, ns, |this, resolution| {\n             if let Some(old_binding) = resolution.binding {\n                 if binding.is_glob_import() {"}, {"sha": "6f93819727598b47d0c7a57f036a76a863d0632b", "filename": "src/libsyntax/fold.rs", "status": "modified", "additions": 14, "deletions": 15, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/31d9cc3833a30b0cd4c1554102402af68eebeeef/src%2Flibsyntax%2Ffold.rs", "raw_url": "https://github.com/rust-lang/rust/raw/31d9cc3833a30b0cd4c1554102402af68eebeeef/src%2Flibsyntax%2Ffold.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffold.rs?ref=31d9cc3833a30b0cd4c1554102402af68eebeeef", "patch": "@@ -302,23 +302,22 @@ pub fn noop_fold_view_path<T: Folder>(view_path: P<ViewPath>, fld: &mut T) -> P<\n     view_path.map(|Spanned {node, span}| Spanned {\n         node: match node {\n             ViewPathSimple(ident, path) => {\n-                ViewPathSimple(ident, fld.fold_path(path))\n+                ViewPathSimple(fld.fold_ident(ident), fld.fold_path(path))\n             }\n             ViewPathGlob(path) => {\n                 ViewPathGlob(fld.fold_path(path))\n             }\n             ViewPathList(path, path_list_idents) => {\n-                ViewPathList(fld.fold_path(path),\n-                             path_list_idents.move_map(|path_list_ident| {\n-                                Spanned {\n-                                    node: PathListItem_ {\n-                                        id: fld.new_id(path_list_ident.node.id),\n-                                        rename: path_list_ident.node.rename,\n-                                        name: path_list_ident.node.name,\n-                                    },\n-                                    span: fld.new_span(path_list_ident.span)\n-                                }\n-                             }))\n+                let path = fld.fold_path(path);\n+                let path_list_idents = path_list_idents.move_map(|path_list_ident| Spanned {\n+                    node: PathListItem_ {\n+                        id: fld.new_id(path_list_ident.node.id),\n+                        rename: path_list_ident.node.rename.map(|ident| fld.fold_ident(ident)),\n+                        name: fld.fold_ident(path_list_ident.node.name),\n+                    },\n+                    span: fld.new_span(path_list_ident.span)\n+                });\n+                ViewPathList(path, path_list_idents)\n             }\n         },\n         span: fld.new_span(span)\n@@ -345,7 +344,7 @@ pub fn noop_fold_arm<T: Folder>(Arm {attrs, pats, guard, body}: Arm, fld: &mut T\n pub fn noop_fold_ty_binding<T: Folder>(b: TypeBinding, fld: &mut T) -> TypeBinding {\n     TypeBinding {\n         id: fld.new_id(b.id),\n-        ident: b.ident,\n+        ident: fld.fold_ident(b.ident),\n         ty: fld.fold_ty(b.ty),\n         span: fld.new_span(b.span),\n     }\n@@ -673,7 +672,7 @@ pub fn noop_fold_ty_param<T: Folder>(tp: TyParam, fld: &mut T) -> TyParam {\n             .collect::<Vec<_>>()\n             .into(),\n         id: fld.new_id(id),\n-        ident: ident,\n+        ident: fld.fold_ident(ident),\n         bounds: fld.fold_bounds(bounds),\n         default: default.map(|x| fld.fold_ty(x)),\n         span: span\n@@ -1088,7 +1087,7 @@ pub fn noop_fold_pat<T: Folder>(p: P<Pat>, folder: &mut T) -> P<Pat> {\n                 let fs = fields.move_map(|f| {\n                     Spanned { span: folder.new_span(f.span),\n                               node: ast::FieldPat {\n-                                  ident: f.node.ident,\n+                                  ident: folder.fold_ident(f.node.ident),\n                                   pat: folder.fold_pat(f.node.pat),\n                                   is_shorthand: f.node.is_shorthand,\n                               }}"}, {"sha": "f6f334f650b24daa1d106cbead3e1081fab16c4c", "filename": "src/test/run-pass/issue-38556.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/31d9cc3833a30b0cd4c1554102402af68eebeeef/src%2Ftest%2Frun-pass%2Fissue-38556.rs", "raw_url": "https://github.com/rust-lang/rust/raw/31d9cc3833a30b0cd4c1554102402af68eebeeef/src%2Ftest%2Frun-pass%2Fissue-38556.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-38556.rs?ref=31d9cc3833a30b0cd4c1554102402af68eebeeef", "patch": "@@ -0,0 +1,22 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+pub struct Foo;\n+\n+macro_rules! reexport {\n+    () => { use Foo as Bar; }\n+}\n+\n+reexport!();\n+\n+fn main() {\n+    use Bar;\n+    fn f(_: Bar) {}\n+}"}]}