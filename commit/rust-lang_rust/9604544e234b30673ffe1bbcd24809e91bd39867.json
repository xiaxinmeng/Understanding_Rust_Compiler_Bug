{"sha": "9604544e234b30673ffe1bbcd24809e91bd39867", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk2MDQ1NDRlMjM0YjMwNjczZmZlMWJiY2QyNDgwOWU5MWJkMzk4Njc=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-04-19T01:43:42Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-04-19T01:45:24Z"}, "message": "rt: Don't log in the stack switching failure path\n\nThe runtime is in an uncertain state here and, instead of thinking\nabout how to make the logger work correctly, let's just avoid it.\n\nCurrently, it ends up hitting an assert saying that we can't log on\nthe rust stack.", "tree": {"sha": "e5da3c31dc858ef7e71a5c7a4ac04a73ea202b64", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e5da3c31dc858ef7e71a5c7a4ac04a73ea202b64"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9604544e234b30673ffe1bbcd24809e91bd39867", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9604544e234b30673ffe1bbcd24809e91bd39867", "html_url": "https://github.com/rust-lang/rust/commit/9604544e234b30673ffe1bbcd24809e91bd39867", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9604544e234b30673ffe1bbcd24809e91bd39867/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "75cf13ec7279ff7a56e3329ab6d6d8fc03e66e4f", "url": "https://api.github.com/repos/rust-lang/rust/commits/75cf13ec7279ff7a56e3329ab6d6d8fc03e66e4f", "html_url": "https://github.com/rust-lang/rust/commit/75cf13ec7279ff7a56e3329ab6d6d8fc03e66e4f"}], "stats": {"total": 9, "additions": 4, "deletions": 5}, "files": [{"sha": "6210b2717b6059495d33f8a5fbe033b5e4764017", "filename": "src/rt/rust_upcall.cpp", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/9604544e234b30673ffe1bbcd24809e91bd39867/src%2Frt%2Frust_upcall.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/9604544e234b30673ffe1bbcd24809e91bd39867/src%2Frt%2Frust_upcall.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_upcall.cpp?ref=9604544e234b30673ffe1bbcd24809e91bd39867", "patch": "@@ -71,8 +71,8 @@ upcall_call_shim_on_c_stack(void *args, void *fn_ptr) {\n     try {\n         task->call_on_c_stack(args, fn_ptr);\n     } catch (...) {\n-        LOG_ERR(task, task, \"Native code threw an exception\");\n-        abort();\n+        // Logging here is not reliable\n+        assert(false && \"Native code threw an exception\");\n     }\n \n     task->record_stack_limit();\n@@ -96,9 +96,8 @@ upcall_call_shim_on_rust_stack(void *args, void *fn_ptr) {\n     } catch (...) {\n         // We can't count on being able to unwind through arbitrary\n         // code. Our best option is to just fail hard.\n-        LOG_ERR(task, task,\n-                \"Rust task failed after reentering the Rust stack\");\n-        abort();\n+        // Logging here is not reliable\n+        assert(false && \"Rust task failed after reentering the Rust stack\");\n     }\n \n     // FIXME: As above"}]}