{"sha": "586629c0b607f34981a893cf856bb35279f58542", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU4NjYyOWMwYjYwN2YzNDk4MWE4OTNjZjg1NmJiMzUyNzlmNTg1NDI=", "commit": {"author": {"name": "Kristofer Rye", "email": "kristofer.rye@gmail.com", "date": "2020-07-17T13:44:14Z"}, "committer": {"name": "Kristofer Rye", "email": "kristofer.rye@gmail.com", "date": "2020-07-17T13:44:14Z"}, "message": "ci: Replace exec-with-shell wrapper with \"plain bash\"\n\nAlso, promote defaults.run.shell from inside only the primary jobs to\nthe top level.\n\nThe src/ci/exec-with-shell.py wrapper script was formerly used to change\nout the shell mid-job by intercepting a CI_OVERRIDE_SHELL environment\nvariable.  Now, instead, we just set `bash` as the global default across\nall jobs, and we also delete the exec-with-shell.py script.\n\nSigned-off-by: Kristofer Rye <kristofer.rye@gmail.com>", "tree": {"sha": "12f52efe17282324176b5153427d426a98cca381", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/12f52efe17282324176b5153427d426a98cca381"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/586629c0b607f34981a893cf856bb35279f58542", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCAAdFiEEU6YNMqS+Li/ArfueKVTGmH5nroQFAl8RrA8ACgkQKVTGmH5n\nroT+JAf9FOBQtshuS7fP4Ze76Arcl/F/anBv1B+2OFDm5X8VVU55oAabjRqDWT1T\n/SirH6735c62MsYF/ZzCyX+BNjeOs1XZ22WPYhAjur38rBdk/yRgEtUBPWW8O3mG\nL1UhQqCIFVHnMPmV0nWFmx2y8jwMxu7E+vEPukDbcpHP5KAPsgfaH2UZK5lNIWAJ\nemFjHCf8FkaiMyP9il5oDtr4xCdHZENyuThBuIMoVM1V+S+f5DhuId4vflb0qLzG\nuM81udtigWIVBOROVyCRJeDEQSdDj22yKZphQS4IqLHtLvQj07EafY4bOpsmRXtD\nS9BjyOJ0Kc3MLbjhxQCx1tezNdwHrA==\n=IYNX\n-----END PGP SIGNATURE-----", "payload": "tree 12f52efe17282324176b5153427d426a98cca381\nparent 49f50780480421e524adf6262a285003d6f8281e\nauthor Kristofer Rye <kristofer.rye@gmail.com> 1594993454 -0500\ncommitter Kristofer Rye <kristofer.rye@gmail.com> 1594993454 -0500\n\nci: Replace exec-with-shell wrapper with \"plain bash\"\n\nAlso, promote defaults.run.shell from inside only the primary jobs to\nthe top level.\n\nThe src/ci/exec-with-shell.py wrapper script was formerly used to change\nout the shell mid-job by intercepting a CI_OVERRIDE_SHELL environment\nvariable.  Now, instead, we just set `bash` as the global default across\nall jobs, and we also delete the exec-with-shell.py script.\n\nSigned-off-by: Kristofer Rye <kristofer.rye@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/586629c0b607f34981a893cf856bb35279f58542", "html_url": "https://github.com/rust-lang/rust/commit/586629c0b607f34981a893cf856bb35279f58542", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/586629c0b607f34981a893cf856bb35279f58542/comments", "author": {"login": "rye", "id": 1566689, "node_id": "MDQ6VXNlcjE1NjY2ODk=", "avatar_url": "https://avatars.githubusercontent.com/u/1566689?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rye", "html_url": "https://github.com/rye", "followers_url": "https://api.github.com/users/rye/followers", "following_url": "https://api.github.com/users/rye/following{/other_user}", "gists_url": "https://api.github.com/users/rye/gists{/gist_id}", "starred_url": "https://api.github.com/users/rye/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rye/subscriptions", "organizations_url": "https://api.github.com/users/rye/orgs", "repos_url": "https://api.github.com/users/rye/repos", "events_url": "https://api.github.com/users/rye/events{/privacy}", "received_events_url": "https://api.github.com/users/rye/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rye", "id": 1566689, "node_id": "MDQ6VXNlcjE1NjY2ODk=", "avatar_url": "https://avatars.githubusercontent.com/u/1566689?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rye", "html_url": "https://github.com/rye", "followers_url": "https://api.github.com/users/rye/followers", "following_url": "https://api.github.com/users/rye/following{/other_user}", "gists_url": "https://api.github.com/users/rye/gists{/gist_id}", "starred_url": "https://api.github.com/users/rye/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rye/subscriptions", "organizations_url": "https://api.github.com/users/rye/orgs", "repos_url": "https://api.github.com/users/rye/repos", "events_url": "https://api.github.com/users/rye/events{/privacy}", "received_events_url": "https://api.github.com/users/rye/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "49f50780480421e524adf6262a285003d6f8281e", "url": "https://api.github.com/repos/rust-lang/rust/commits/49f50780480421e524adf6262a285003d6f8281e", "html_url": "https://github.com/rust-lang/rust/commit/49f50780480421e524adf6262a285003d6f8281e"}], "stats": {"total": 49, "additions": 5, "deletions": 44}, "files": [{"sha": "86de37820003ae425f59eee735e23666f7099015", "filename": ".github/workflows/ci.yml", "status": "modified", "additions": 1, "deletions": 13, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/586629c0b607f34981a893cf856bb35279f58542/.github%2Fworkflows%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/586629c0b607f34981a893cf856bb35279f58542/.github%2Fworkflows%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fci.yml?ref=586629c0b607f34981a893cf856bb35279f58542", "patch": "@@ -26,7 +26,7 @@ name: CI\n       - \"**\"\n defaults:\n   run:\n-    shell: \"python src/ci/exec-with-shell.py {0}\"\n+    shell: bash\n jobs:\n   pr:\n     name: PR\n@@ -51,9 +51,6 @@ jobs:\n             os: ubuntu-latest-xl\n     timeout-minutes: 600\n     runs-on: \"${{ matrix.os }}\"\n-    defaults:\n-      run:\n-        shell: bash\n     steps:\n       - name: disable git crlf conversion\n         run: git config --global core.autocrlf false\n@@ -153,9 +150,6 @@ jobs:\n             env: {}\n     timeout-minutes: 600\n     runs-on: \"${{ matrix.os }}\"\n-    defaults:\n-      run:\n-        shell: bash\n     steps:\n       - name: disable git crlf conversion\n         run: git config --global core.autocrlf false\n@@ -473,9 +467,6 @@ jobs:\n             os: windows-latest-xl\n     timeout-minutes: 600\n     runs-on: \"${{ matrix.os }}\"\n-    defaults:\n-      run:\n-        shell: bash\n     steps:\n       - name: disable git crlf conversion\n         run: git config --global core.autocrlf false\n@@ -601,9 +592,6 @@ jobs:\n             os: macos-latest\n     timeout-minutes: 600\n     runs-on: \"${{ matrix.os }}\"\n-    defaults:\n-      run:\n-        shell: bash\n     steps:\n       - name: disable git crlf conversion\n         run: git config --global core.autocrlf false"}, {"sha": "26ce69e33d9c3ea14450b82061ac05a0a88874b6", "filename": "src/ci/exec-with-shell.py", "status": "removed", "additions": 0, "deletions": 16, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/49f50780480421e524adf6262a285003d6f8281e/src%2Fci%2Fexec-with-shell.py", "raw_url": "https://github.com/rust-lang/rust/raw/49f50780480421e524adf6262a285003d6f8281e/src%2Fci%2Fexec-with-shell.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fexec-with-shell.py?ref=49f50780480421e524adf6262a285003d6f8281e", "patch": "@@ -1,16 +0,0 @@\n-#!/usr/bin/env python\n-# A simple wrapper that forwards the arguments to bash, unless the\n-# CI_OVERRIDE_SHELL environment variable is present: in that case the content\n-# of that environment variable is used as the shell path.\n-\n-import os\n-import sys\n-import subprocess\n-\n-try:\n-    shell = os.environ[\"CI_OVERRIDE_SHELL\"]\n-except KeyError:\n-    shell = \"bash\"\n-\n-res = subprocess.call([shell] + sys.argv[1:])\n-sys.exit(res)"}, {"sha": "5573d87aa2e55c278399a8f0e0c1b6a12bf11600", "filename": "src/ci/github-actions/ci.yml", "status": "modified", "additions": 4, "deletions": 15, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/586629c0b607f34981a893cf856bb35279f58542/src%2Fci%2Fgithub-actions%2Fci.yml", "raw_url": "https://github.com/rust-lang/rust/raw/586629c0b607f34981a893cf856bb35279f58542/src%2Fci%2Fgithub-actions%2Fci.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fgithub-actions%2Fci.yml?ref=586629c0b607f34981a893cf856bb35279f58542", "patch": "@@ -75,9 +75,6 @@ x--expand-yaml-anchors--remove:\n   - &base-ci-job\n     timeout-minutes: 600\n     runs-on: \"${{ matrix.os }}\"\n-    defaults:\n-      run:\n-        shell: bash\n     env: *shared-ci-variables\n     steps:\n       - name: disable git crlf conversion\n@@ -233,18 +230,10 @@ on:\n \n defaults:\n   run:\n-    # While on Linux and macOS builders it just forwards the arguments to the\n-    # system bash, this wrapper allows switching from the host's bash.exe to\n-    # the one we install along with MSYS2 mid-build on Windows.\n-    #\n-    # Once the step to install MSYS2 is executed, the CI_OVERRIDE_SHELL\n-    # environment variable is set pointing to our MSYS2's bash.exe. From that\n-    # moment the host's bash.exe will not be called anymore.\n-    #\n-    # This is needed because we can't launch our own bash.exe from the host\n-    # bash.exe, as that would load two different cygwin1.dll in memory, causing\n-    # \"cygwin heap mismatch\" errors.\n-    shell: python src/ci/exec-with-shell.py {0}\n+    # On Linux, macOS, and Windows, use the system-provided bash as the default\n+    # shell. (This should only make a difference on Windows, where the default\n+    # shell is PowerShell.)\n+    shell: bash\n \n jobs:\n   pr:"}]}