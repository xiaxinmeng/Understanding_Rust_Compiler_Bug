{"sha": "9cc847d8c3cb156a2765a6be962209acd472b8aa", "node_id": "MDY6Q29tbWl0NzI0NzEyOjljYzg0N2Q4YzNjYjE1NmEyNzY1YTZiZTk2MjIwOWFjZDQ3MmI4YWE=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-01-09T21:26:21Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-01-09T21:26:21Z"}, "message": "syntax: Add #[allow(unstable)] to --test expansion\n\nThis will temporarily prevent warnings generated from expanding to code that the\ntest harness itself uses. This solution will require tweaking around the beta\ncycle, but it will prevent spurious warnings for now.\n\nCloses #20823", "tree": {"sha": "62fbd059536692b754130c8665ba0af33345aee0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/62fbd059536692b754130c8665ba0af33345aee0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9cc847d8c3cb156a2765a6be962209acd472b8aa", "comment_count": 7, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9cc847d8c3cb156a2765a6be962209acd472b8aa", "html_url": "https://github.com/rust-lang/rust/commit/9cc847d8c3cb156a2765a6be962209acd472b8aa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9cc847d8c3cb156a2765a6be962209acd472b8aa/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b5571ed71a5879c0495a982506258d5d267744ed", "url": "https://api.github.com/repos/rust-lang/rust/commits/b5571ed71a5879c0495a982506258d5d267744ed", "html_url": "https://github.com/rust-lang/rust/commit/b5571ed71a5879c0495a982506258d5d267744ed"}], "stats": {"total": 24, "additions": 23, "deletions": 1}, "files": [{"sha": "895268f96c8a8b3c666711b587277b97dd3d3f81", "filename": "src/libsyntax/test.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9cc847d8c3cb156a2765a6be962209acd472b8aa/src%2Flibsyntax%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9cc847d8c3cb156a2765a6be962209acd472b8aa/src%2Flibsyntax%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ftest.rs?ref=9cc847d8c3cb156a2765a6be962209acd472b8aa", "patch": "@@ -439,13 +439,19 @@ fn mk_test_module(cx: &mut TestCtxt) -> (P<ast::Item>, Option<ast::ViewItem>) {\n     let item_ = ast::ItemMod(testmod);\n \n     let mod_ident = token::gensym_ident(\"__test\");\n+    let allow_unstable = {\n+        let unstable = P(nospan(ast::MetaWord(InternedString::new(\"unstable\"))));\n+        let allow = P(nospan(ast::MetaList(InternedString::new(\"allow\"),\n+                                           vec![unstable])));\n+        attr::mk_attr_inner(attr::mk_attr_id(), allow)\n+    };\n     let item = ast::Item {\n         ident: mod_ident,\n-        attrs: Vec::new(),\n         id: ast::DUMMY_NODE_ID,\n         node: item_,\n         vis: ast::Public,\n         span: DUMMY_SP,\n+        attrs: vec![allow_unstable],\n     };\n     let reexport = cx.reexport_test_harness_main.as_ref().map(|s| {\n         // building `use <ident> = __test::main`"}, {"sha": "73b7fc264a529dacbd82a15d2b22d3cf337e9134", "filename": "src/test/run-pass/issue-20823.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/9cc847d8c3cb156a2765a6be962209acd472b8aa/src%2Ftest%2Frun-pass%2Fissue-20823.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9cc847d8c3cb156a2765a6be962209acd472b8aa/src%2Ftest%2Frun-pass%2Fissue-20823.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-20823.rs?ref=9cc847d8c3cb156a2765a6be962209acd472b8aa", "patch": "@@ -0,0 +1,16 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// compile-flags: --test\n+\n+#![deny(unstable)]\n+\n+#[test]\n+fn foo() {}"}]}