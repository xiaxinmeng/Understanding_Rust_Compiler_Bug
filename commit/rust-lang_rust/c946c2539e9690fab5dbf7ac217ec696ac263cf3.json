{"sha": "c946c2539e9690fab5dbf7ac217ec696ac263cf3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM5NDZjMjUzOWU5NjkwZmFiNWRiZjdhYzIxN2VjNjk2YWMyNjNjZjM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-07-12T04:12:19Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-07-12T04:12:19Z"}, "message": "Auto merge of #52194 - steveklabnik:remove-plugins, r=QuietMisdreavus,GuillaumeGomez\n\nRemove rustdoc's plugins feature\n\nThis fixes CVE-2018-1000622.\n\nhttps://cve.mitre.org/cgi-bin/cvename.cgi?name=%20CVE-2018-1000622\n\nr? @QuietMisdreavus @GuillaumeGomez", "tree": {"sha": "9238dbe8875be5b6f2cce3ec2b7445cd74c2c1c2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9238dbe8875be5b6f2cce3ec2b7445cd74c2c1c2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c946c2539e9690fab5dbf7ac217ec696ac263cf3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c946c2539e9690fab5dbf7ac217ec696ac263cf3", "html_url": "https://github.com/rust-lang/rust/commit/c946c2539e9690fab5dbf7ac217ec696ac263cf3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c946c2539e9690fab5dbf7ac217ec696ac263cf3/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3244d53c790809872c558ec5a869ea2e1e770ac8", "url": "https://api.github.com/repos/rust-lang/rust/commits/3244d53c790809872c558ec5a869ea2e1e770ac8", "html_url": "https://github.com/rust-lang/rust/commit/3244d53c790809872c558ec5a869ea2e1e770ac8"}, {"sha": "0df68d850c0f032afaebba442f0800333772503e", "url": "https://api.github.com/repos/rust-lang/rust/commits/0df68d850c0f032afaebba442f0800333772503e", "html_url": "https://github.com/rust-lang/rust/commit/0df68d850c0f032afaebba442f0800333772503e"}], "stats": {"total": 70, "additions": 12, "deletions": 58}, "files": [{"sha": "3e26ed2b97c23c893bb05f1f0857076a2e230c7f", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 11, "deletions": 10, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/c946c2539e9690fab5dbf7ac217ec696ac263cf3/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c946c2539e9690fab5dbf7ac217ec696ac263cf3/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=c946c2539e9690fab5dbf7ac217ec696ac263cf3", "patch": "@@ -165,7 +165,7 @@ pub fn opts() -> Vec<RustcOptGroup> {\n             o.optmulti(\"\", \"extern\", \"pass an --extern to rustc\", \"NAME=PATH\")\n         }),\n         stable(\"plugin-path\", |o| {\n-            o.optmulti(\"\", \"plugin-path\", \"directory to load plugins from\", \"DIR\")\n+            o.optmulti(\"\", \"plugin-path\", \"removed\", \"DIR\")\n         }),\n         stable(\"C\", |o| {\n             o.optmulti(\"C\", \"codegen\", \"pass a codegen option to rustc\", \"OPT[=VALUE]\")\n@@ -178,7 +178,7 @@ pub fn opts() -> Vec<RustcOptGroup> {\n                        \"PASSES\")\n         }),\n         stable(\"plugins\", |o| {\n-            o.optmulti(\"\", \"plugins\", \"space separated list of plugins to also load\",\n+            o.optmulti(\"\", \"plugins\", \"removed\",\n                        \"PLUGINS\")\n         }),\n         stable(\"no-default\", |o| {\n@@ -741,9 +741,16 @@ where R: 'static + Send,\n             }\n         }\n \n+        if !plugins.is_empty() {\n+            eprintln!(\"WARNING: --plugins no longer functions; see CVE-2018-1000622\");\n+        }\n+\n+        if !plugin_path.is_none() {\n+            eprintln!(\"WARNING: --plugin-path no longer functions; see CVE-2018-1000622\");\n+        }\n+\n         // Load all plugins/passes into a PluginManager\n-        let path = plugin_path.unwrap_or(\"/tmp/rustdoc/plugins\".to_string());\n-        let mut pm = plugins::PluginManager::new(PathBuf::from(path));\n+        let mut pm = plugins::PluginManager::new();\n         for pass in &passes {\n             let plugin = match passes::PASSES.iter()\n                                              .position(|&(p, ..)| {\n@@ -757,10 +764,6 @@ where R: 'static + Send,\n             };\n             pm.add_plugin(plugin);\n         }\n-        info!(\"loading plugins...\");\n-        for pname in plugins {\n-            pm.load_plugin(pname);\n-        }\n \n         // Run everything!\n         info!(\"Executing passes/plugins\");\n@@ -776,8 +779,6 @@ fn check_deprecated_options(matches: &getopts::Matches, diag: &errors::Handler)\n     let deprecated_flags = [\n        \"input-format\",\n        \"output-format\",\n-       \"plugin-path\",\n-       \"plugins\",\n        \"no-defaults\",\n        \"passes\",\n     ];"}, {"sha": "261ff728aef605aabe41a2a10cbc50134c1271f5", "filename": "src/librustdoc/plugins.rs", "status": "modified", "additions": 1, "deletions": 48, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/c946c2539e9690fab5dbf7ac217ec696ac263cf3/src%2Flibrustdoc%2Fplugins.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c946c2539e9690fab5dbf7ac217ec696ac263cf3/src%2Flibrustdoc%2Fplugins.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fplugins.rs?ref=c946c2539e9690fab5dbf7ac217ec696ac263cf3", "patch": "@@ -12,47 +12,20 @@\n \n use clean;\n \n-use std::mem;\n-use std::string::String;\n-use std::path::PathBuf;\n-\n-use rustc_metadata::dynamic_lib as dl;\n-\n pub type PluginResult = clean::Crate;\n pub type PluginCallback = fn (clean::Crate) -> PluginResult;\n \n /// Manages loading and running of plugins\n pub struct PluginManager {\n-    dylibs: Vec<dl::DynamicLibrary> ,\n     callbacks: Vec<PluginCallback> ,\n-    /// The directory plugins will be loaded from\n-    pub prefix: PathBuf,\n }\n \n impl PluginManager {\n     /// Create a new plugin manager\n-    pub fn new(prefix: PathBuf) -> PluginManager {\n+    pub fn new() -> PluginManager {\n         PluginManager {\n-            dylibs: Vec::new(),\n             callbacks: Vec::new(),\n-            prefix,\n-        }\n-    }\n-\n-    /// Load a plugin with the given name.\n-    ///\n-    /// Turns `name` into the proper dynamic library filename for the given\n-    /// platform. On windows, it turns into name.dll, on macOS, name.dylib, and\n-    /// elsewhere, libname.so.\n-    pub fn load_plugin(&mut self, name: String) {\n-        let x = self.prefix.join(libname(name));\n-        let lib_result = dl::DynamicLibrary::open(Some(&x));\n-        let lib = lib_result.unwrap();\n-        unsafe {\n-            let plugin = lib.symbol(\"rustdoc_plugin_entrypoint\").unwrap();\n-            self.callbacks.push(mem::transmute::<*mut u8,PluginCallback>(plugin));\n         }\n-        self.dylibs.push(lib);\n     }\n \n     /// Load a normal Rust function as a plugin.\n@@ -70,23 +43,3 @@ impl PluginManager {\n         krate\n     }\n }\n-\n-#[cfg(target_os = \"windows\")]\n-fn libname(mut n: String) -> String {\n-    n.push_str(\".dll\");\n-    n\n-}\n-\n-#[cfg(target_os=\"macos\")]\n-fn libname(mut n: String) -> String {\n-    n.push_str(\".dylib\");\n-    n\n-}\n-\n-#[cfg(all(not(target_os=\"windows\"), not(target_os=\"macos\")))]\n-fn libname(n: String) -> String {\n-    let mut i = String::from(\"lib\");\n-    i.push_str(&n);\n-    i.push_str(\".so\");\n-    i\n-}"}]}