{"sha": "7b9a7ef218fbdc3cbb9f7828bc9f032bcfd9a6dc", "node_id": "C_kwDOAAsO6NoAKDdiOWE3ZWYyMThmYmRjM2NiYjlmNzgyOGJjOWYwMzJiY2ZkOWE2ZGM", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-06-29T12:29:33Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-06-29T12:29:33Z"}, "message": "Rollup merge of #98499 - JulianKnodt:erase_lifetime, r=lcnr\n\nErase regions in New Abstract Consts\n\nWhen an abstract const is constructed, we previously included lifetimes in the set of substitutes, so it was not able to unify two abstract consts if their lifetimes did not match but the values did, despite the values not depending on the lifetimes. This caused code that should have compiled to not compile.\n\nFixes #98452\n\nr? ```@lcnr```", "tree": {"sha": "1a20e3c4807adcb5f5e189520416932434661241", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1a20e3c4807adcb5f5e189520416932434661241"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7b9a7ef218fbdc3cbb9f7828bc9f032bcfd9a6dc", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJivEWtCRBK7hj4Ov3rIwAAc7IIADpPqSWmUGr0Qstur/BHyZ2/\n72AEDHf7/zoimAqJRIG4xGaWX90ydxCtrqVUv66aOAE9rOPOqt92phfA1fs1q1sa\nviIS49HUJ6ynOwbkOQjKJK+o0KWBroTLHRxhn00QogWfHid+wYPMlj52Fd9rgtSO\n/qzDcMUED+e1/mH9i2QVy9XFi73L2POSyfaIA05qDuxdOE/1wg5veiyzNHXxHSzI\nDMaDNwZMDBpXkd7LPAvFU9eMUE47jfAXQZ1ZQMUNc/+gYBgKGs1UEqNKsHgAxCm3\nbD+YcLWwy83AbwLiDtfSOXUi13eR8TVTYKcksFJv3iMCBq5lpa2seTSepV28JCM=\n=kgSA\n-----END PGP SIGNATURE-----\n", "payload": "tree 1a20e3c4807adcb5f5e189520416932434661241\nparent 3f2ba251591410016a1e056c6cdafc30c965db29\nparent 1e40200b353926308a9a8a5f3349df8dc6bf8f80\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1656505773 +0530\ncommitter GitHub <noreply@github.com> 1656505773 +0530\n\nRollup merge of #98499 - JulianKnodt:erase_lifetime, r=lcnr\n\nErase regions in New Abstract Consts\n\nWhen an abstract const is constructed, we previously included lifetimes in the set of substitutes, so it was not able to unify two abstract consts if their lifetimes did not match but the values did, despite the values not depending on the lifetimes. This caused code that should have compiled to not compile.\n\nFixes #98452\n\nr? ```@lcnr```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7b9a7ef218fbdc3cbb9f7828bc9f032bcfd9a6dc", "html_url": "https://github.com/rust-lang/rust/commit/7b9a7ef218fbdc3cbb9f7828bc9f032bcfd9a6dc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7b9a7ef218fbdc3cbb9f7828bc9f032bcfd9a6dc/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3f2ba251591410016a1e056c6cdafc30c965db29", "url": "https://api.github.com/repos/rust-lang/rust/commits/3f2ba251591410016a1e056c6cdafc30c965db29", "html_url": "https://github.com/rust-lang/rust/commit/3f2ba251591410016a1e056c6cdafc30c965db29"}, {"sha": "1e40200b353926308a9a8a5f3349df8dc6bf8f80", "url": "https://api.github.com/repos/rust-lang/rust/commits/1e40200b353926308a9a8a5f3349df8dc6bf8f80", "html_url": "https://github.com/rust-lang/rust/commit/1e40200b353926308a9a8a5f3349df8dc6bf8f80"}], "stats": {"total": 36, "additions": 35, "deletions": 1}, "files": [{"sha": "424eff2f6212a6dfcb71b1792781cbae049fd05a", "filename": "compiler/rustc_trait_selection/src/traits/const_evaluatable.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7b9a7ef218fbdc3cbb9f7828bc9f032bcfd9a6dc/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fconst_evaluatable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b9a7ef218fbdc3cbb9f7828bc9f032bcfd9a6dc/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fconst_evaluatable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fconst_evaluatable.rs?ref=7b9a7ef218fbdc3cbb9f7828bc9f032bcfd9a6dc", "patch": "@@ -236,7 +236,7 @@ impl<'tcx> AbstractConst<'tcx> {\n     ) -> Result<Option<AbstractConst<'tcx>>, ErrorGuaranteed> {\n         let inner = tcx.thir_abstract_const_opt_const_arg(uv.def)?;\n         debug!(\"AbstractConst::new({:?}) = {:?}\", uv, inner);\n-        Ok(inner.map(|inner| AbstractConst { inner, substs: uv.substs }))\n+        Ok(inner.map(|inner| AbstractConst { inner, substs: tcx.erase_regions(uv.substs) }))\n     }\n \n     pub fn from_const(\n@@ -416,6 +416,7 @@ impl<'a, 'tcx> AbstractConstBuilder<'a, 'tcx> {\n                     // `AbstractConst`s should not contain any promoteds as they require references which\n                     // are not allowed.\n                     assert_eq!(ct.promoted, None);\n+                    assert_eq!(ct, self.tcx.erase_regions(ct));\n                 }\n             }\n         }"}, {"sha": "2ae0ae70dd9778971c64c7fd8af09aefd97c93bf", "filename": "src/test/ui/const-generics/try_unify_ignore_lifetimes.rs", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/7b9a7ef218fbdc3cbb9f7828bc9f032bcfd9a6dc/src%2Ftest%2Fui%2Fconst-generics%2Ftry_unify_ignore_lifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b9a7ef218fbdc3cbb9f7828bc9f032bcfd9a6dc/src%2Ftest%2Fui%2Fconst-generics%2Ftry_unify_ignore_lifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Ftry_unify_ignore_lifetimes.rs?ref=7b9a7ef218fbdc3cbb9f7828bc9f032bcfd9a6dc", "patch": "@@ -0,0 +1,33 @@\n+// check-pass\n+#![feature(generic_const_exprs)]\n+#![allow(incomplete_features)]\n+\n+struct Num<const N: usize>;\n+\n+trait NumT {\n+    const VALUE: usize;\n+}\n+\n+impl<const N: usize> NumT for Num<N> {\n+    const VALUE: usize = N;\n+}\n+\n+struct Foo<'a, N: NumT>(&'a [u32; N::VALUE]) where [(); N::VALUE]:;\n+\n+trait Bar {\n+    type Size: NumT;\n+\n+    fn bar<'a>(foo: &Foo<'a, Self::Size>) where [(); Self::Size::VALUE]: {\n+        todo!();\n+    }\n+}\n+\n+trait Baz<'a> {\n+    type Size: NumT;\n+\n+    fn baz(foo: &Foo<'a, Self::Size>) where [(); Self::Size::VALUE]: {\n+        todo!();\n+    }\n+}\n+\n+fn main() {}"}]}