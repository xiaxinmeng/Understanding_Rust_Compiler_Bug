{"sha": "1c81540206b10a2b5b709540ba5ac138eaaa5261", "node_id": "C_kwDOAAsO6NoAKDFjODE1NDAyMDZiMTBhMmI1YjcwOTU0MGJhNWFjMTM4ZWFhYTUyNjE", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-12-04T21:02:51Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-12-05T00:42:40Z"}, "message": "Unconditional check FRU expression, even if there are errors present", "tree": {"sha": "ba19a21e8d5bca358017a23c09fc38bd3edaa1a2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ba19a21e8d5bca358017a23c09fc38bd3edaa1a2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1c81540206b10a2b5b709540ba5ac138eaaa5261", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1c81540206b10a2b5b709540ba5ac138eaaa5261", "html_url": "https://github.com/rust-lang/rust/commit/1c81540206b10a2b5b709540ba5ac138eaaa5261", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1c81540206b10a2b5b709540ba5ac138eaaa5261/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d442c015d6d688460a182947e797f4bf69876044", "url": "https://api.github.com/repos/rust-lang/rust/commits/d442c015d6d688460a182947e797f4bf69876044", "html_url": "https://github.com/rust-lang/rust/commit/d442c015d6d688460a182947e797f4bf69876044"}], "stats": {"total": 36, "additions": 36, "deletions": 0}, "files": [{"sha": "2ca5b980fc83683ba0f035ac0fdc32280d74dcca", "filename": "compiler/rustc_hir_typeck/src/expr.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1c81540206b10a2b5b709540ba5ac138eaaa5261/compiler%2Frustc_hir_typeck%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c81540206b10a2b5b709540ba5ac138eaaa5261/compiler%2Frustc_hir_typeck%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fexpr.rs?ref=1c81540206b10a2b5b709540ba5ac138eaaa5261", "patch": "@@ -1646,6 +1646,9 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         // the fields with the base_expr. This could cause us to hit errors later\n         // when certain fields are assumed to exist that in fact do not.\n         if error_happened {\n+            if let Some(base_expr) = base_expr {\n+                self.check_expr(base_expr);\n+            }\n             return;\n         }\n "}, {"sha": "28ad7767583cfbd3d994c37179783ad51d8326d6", "filename": "src/test/ui/async-await/drop-track-bad-field-in-fru.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/1c81540206b10a2b5b709540ba5ac138eaaa5261/src%2Ftest%2Fui%2Fasync-await%2Fdrop-track-bad-field-in-fru.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c81540206b10a2b5b709540ba5ac138eaaa5261/src%2Ftest%2Fui%2Fasync-await%2Fdrop-track-bad-field-in-fru.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fdrop-track-bad-field-in-fru.rs?ref=1c81540206b10a2b5b709540ba5ac138eaaa5261", "patch": "@@ -0,0 +1,10 @@\n+// compile-flags: -Zdrop-tracking\n+// edition: 2021\n+\n+fn main() {}\n+\n+async fn foo() {\n+    None { value: (), ..Default::default() }.await;\n+    //~^ ERROR `Option<_>` is not a future\n+    //~| ERROR variant `Option<_>::None` has no field named `value`\n+}"}, {"sha": "819b64ad77f5dd1b1f06a51ae52fa02ba38b0aab", "filename": "src/test/ui/async-await/drop-track-bad-field-in-fru.stderr", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/1c81540206b10a2b5b709540ba5ac138eaaa5261/src%2Ftest%2Fui%2Fasync-await%2Fdrop-track-bad-field-in-fru.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1c81540206b10a2b5b709540ba5ac138eaaa5261/src%2Ftest%2Fui%2Fasync-await%2Fdrop-track-bad-field-in-fru.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fdrop-track-bad-field-in-fru.stderr?ref=1c81540206b10a2b5b709540ba5ac138eaaa5261", "patch": "@@ -0,0 +1,23 @@\n+error[E0559]: variant `Option<_>::None` has no field named `value`\n+  --> $DIR/drop-track-bad-field-in-fru.rs:7:12\n+   |\n+LL |     None { value: (), ..Default::default() }.await;\n+   |            ^^^^^ `Option<_>::None` does not have this field\n+\n+error[E0277]: `Option<_>` is not a future\n+  --> $DIR/drop-track-bad-field-in-fru.rs:7:45\n+   |\n+LL |     None { value: (), ..Default::default() }.await;\n+   |                                             ^^^^^^\n+   |                                             |\n+   |                                             `Option<_>` is not a future\n+   |                                             help: remove the `.await`\n+   |\n+   = help: the trait `Future` is not implemented for `Option<_>`\n+   = note: Option<_> must be a future or must implement `IntoFuture` to be awaited\n+   = note: required for `Option<_>` to implement `IntoFuture`\n+\n+error: aborting due to 2 previous errors\n+\n+Some errors have detailed explanations: E0277, E0559.\n+For more information about an error, try `rustc --explain E0277`."}]}