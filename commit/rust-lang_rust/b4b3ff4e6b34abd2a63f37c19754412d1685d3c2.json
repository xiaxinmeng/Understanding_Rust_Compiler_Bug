{"sha": "b4b3ff4e6b34abd2a63f37c19754412d1685d3c2", "node_id": "C_kwDOAAsO6NoAKGI0YjNmZjRlNmIzNGFiZDJhNjNmMzdjMTk3NTQ0MTJkMTY4NWQzYzI", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev+love@gmail.com", "date": "2022-10-26T23:30:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-10-26T23:30:59Z"}, "message": "Rollup merge of #103596 - RalfJung:thread-setname, r=cuviper\n\nthread::set_name: debug-assert that things went well\n\nr? `@cuviper`", "tree": {"sha": "796d34dc26ce6c8de088b8352628a2809d71a4a8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/796d34dc26ce6c8de088b8352628a2809d71a4a8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b4b3ff4e6b34abd2a63f37c19754412d1685d3c2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjWcMzCRBK7hj4Ov3rIwAAsqgIAB78aeWSqlkvOh9rm8hY5PcH\n6qp5CZ4HrZ7hR4YGI1qz/qF8NI3s4gm5rKRHXwnxQFF6tCwApEypaVtu+rIN9U5M\ncVT9B9rZ53uDC3Wq63B8Ye5zvfhRgVETajZYHXZlGauN4mgSABWCyX3QeTlRMYrn\nazs0aoS6jC01Ax95hZ8lA1ppG0oZjJaaC5nOg61Za/JlNHNBq+xzzWsjVY34SGj+\nWsbp4q2iss3gEUbSmbaNJLuZtDNLybhjMhm1+RLixqzDniBRiINlE1HATWw3Ygep\nx6DhplYwh7CgM9U8p0WsqcKZic+hZLA6vRIClDtyaK/oxl7XPQTmSXDGwUX6Spo=\n=hlJ7\n-----END PGP SIGNATURE-----\n", "payload": "tree 796d34dc26ce6c8de088b8352628a2809d71a4a8\nparent 77145c042d8a94ab2159af0b624e1297812472fb\nparent d1132fb805537bc43539e1fca7729dde1bc16048\nauthor Yuki Okushi <huyuumi.dev+love@gmail.com> 1666827059 +0900\ncommitter GitHub <noreply@github.com> 1666827059 +0900\n\nRollup merge of #103596 - RalfJung:thread-setname, r=cuviper\n\nthread::set_name: debug-assert that things went well\n\nr? `@cuviper`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b4b3ff4e6b34abd2a63f37c19754412d1685d3c2", "html_url": "https://github.com/rust-lang/rust/commit/b4b3ff4e6b34abd2a63f37c19754412d1685d3c2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b4b3ff4e6b34abd2a63f37c19754412d1685d3c2/comments", "author": null, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "77145c042d8a94ab2159af0b624e1297812472fb", "url": "https://api.github.com/repos/rust-lang/rust/commits/77145c042d8a94ab2159af0b624e1297812472fb", "html_url": "https://github.com/rust-lang/rust/commit/77145c042d8a94ab2159af0b624e1297812472fb"}, {"sha": "d1132fb805537bc43539e1fca7729dde1bc16048", "url": "https://api.github.com/repos/rust-lang/rust/commits/d1132fb805537bc43539e1fca7729dde1bc16048", "html_url": "https://github.com/rust-lang/rust/commit/d1132fb805537bc43539e1fca7729dde1bc16048"}], "stats": {"total": 16, "additions": 10, "deletions": 6}, "files": [{"sha": "c1d30dd9d521b318ed83cdf225df4ee918da1fcc", "filename": "library/std/src/sys/unix/thread.rs", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/b4b3ff4e6b34abd2a63f37c19754412d1685d3c2/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fthread.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b4b3ff4e6b34abd2a63f37c19754412d1685d3c2/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fthread.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fthread.rs?ref=b4b3ff4e6b34abd2a63f37c19754412d1685d3c2", "patch": "@@ -137,7 +137,9 @@ impl Thread {\n         unsafe {\n             // Available since glibc 2.12, musl 1.1.16, and uClibc 1.0.20.\n             let name = truncate_cstr(name, TASK_COMM_LEN);\n-            libc::pthread_setname_np(libc::pthread_self(), name.as_ptr());\n+            let res = libc::pthread_setname_np(libc::pthread_self(), name.as_ptr());\n+            // We have no good way of propagating errors here, but in debug-builds let's check that this actually worked.\n+            debug_assert_eq!(res, 0);\n         }\n     }\n \n@@ -152,19 +154,22 @@ impl Thread {\n     pub fn set_name(name: &CStr) {\n         unsafe {\n             let name = truncate_cstr(name, libc::MAXTHREADNAMESIZE);\n-            libc::pthread_setname_np(name.as_ptr());\n+            let res = libc::pthread_setname_np(name.as_ptr());\n+            // We have no good way of propagating errors here, but in debug-builds let's check that this actually worked.\n+            debug_assert_eq!(res, 0);\n         }\n     }\n \n     #[cfg(target_os = \"netbsd\")]\n     pub fn set_name(name: &CStr) {\n         unsafe {\n             let cname = CStr::from_bytes_with_nul_unchecked(b\"%s\\0\".as_slice());\n-            libc::pthread_setname_np(\n+            let res = libc::pthread_setname_np(\n                 libc::pthread_self(),\n                 cname.as_ptr(),\n                 name.as_ptr() as *mut libc::c_void,\n             );\n+            debug_assert_eq!(res, 0);\n         }\n     }\n \n@@ -177,9 +182,8 @@ impl Thread {\n         }\n \n         if let Some(f) = pthread_setname_np.get() {\n-            unsafe {\n-                f(libc::pthread_self(), name.as_ptr());\n-            }\n+            let res = unsafe { f(libc::pthread_self(), name.as_ptr()) };\n+            debug_assert_eq!(res, 0);\n         }\n     }\n "}]}