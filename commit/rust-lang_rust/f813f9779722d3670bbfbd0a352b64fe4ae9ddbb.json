{"sha": "f813f9779722d3670bbfbd0a352b64fe4ae9ddbb", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY4MTNmOTc3OTcyMmQzNjcwYmJmYmQwYTM1MmI2NGZlNGFlOWRkYmI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-06-02T02:08:17Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-06-02T02:08:17Z"}, "message": "Auto merge of #25654 - petrochenkov:encenv, r=alexcrichton\n\nFixes https://github.com/rust-lang/rust/issues/25268 and a couple of similar test errors\r\n\r\nr? @alexcrichton", "tree": {"sha": "8101f954fe1183830cc6f16ca1c9dbaca604f884", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8101f954fe1183830cc6f16ca1c9dbaca604f884"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f813f9779722d3670bbfbd0a352b64fe4ae9ddbb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f813f9779722d3670bbfbd0a352b64fe4ae9ddbb", "html_url": "https://github.com/rust-lang/rust/commit/f813f9779722d3670bbfbd0a352b64fe4ae9ddbb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f813f9779722d3670bbfbd0a352b64fe4ae9ddbb/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "613e57b448c88591b6076a8cea9799f1f3876687", "url": "https://api.github.com/repos/rust-lang/rust/commits/613e57b448c88591b6076a8cea9799f1f3876687", "html_url": "https://github.com/rust-lang/rust/commit/613e57b448c88591b6076a8cea9799f1f3876687"}, {"sha": "a40bca29a818b4cbea072a295cb80aa9a4c43d52", "url": "https://api.github.com/repos/rust-lang/rust/commits/a40bca29a818b4cbea072a295cb80aa9a4c43d52", "html_url": "https://github.com/rust-lang/rust/commit/a40bca29a818b4cbea072a295cb80aa9a4c43d52"}], "stats": {"total": 23, "additions": 14, "deletions": 9}, "files": [{"sha": "185cc9b2f4c581d0ec4ba0b8a334f0250c1e943a", "filename": "mk/tests.mk", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/f813f9779722d3670bbfbd0a352b64fe4ae9ddbb/mk%2Ftests.mk", "raw_url": "https://github.com/rust-lang/rust/raw/f813f9779722d3670bbfbd0a352b64fe4ae9ddbb/mk%2Ftests.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftests.mk?ref=f813f9779722d3670bbfbd0a352b64fe4ae9ddbb", "patch": "@@ -172,23 +172,24 @@ check: check-sanitycheck cleantmptestlogs cleantestlibs all check-stage2 tidy\n \t$(Q)$(CFG_PYTHON) $(S)src/etc/check-summary.py tmp/*.log\n \n # As above but don't bother running tidy.\n-check-notidy: cleantmptestlogs cleantestlibs all check-stage2\n+check-notidy: check-sanitycheck cleantmptestlogs cleantestlibs all check-stage2\n \t$(Q)$(CFG_PYTHON) $(S)src/etc/check-summary.py tmp/*.log\n \n # A slightly smaller set of tests for smoke testing.\n-check-lite: cleantestlibs cleantmptestlogs \\\n+check-lite: check-sanitycheck cleantestlibs cleantmptestlogs \\\n \t$(foreach crate,$(TEST_TARGET_CRATES),check-stage2-$(crate)) \\\n \tcheck-stage2-rpass check-stage2-rpass-valgrind \\\n \tcheck-stage2-rfail check-stage2-cfail check-stage2-pfail check-stage2-rmake\n \t$(Q)$(CFG_PYTHON) $(S)src/etc/check-summary.py tmp/*.log\n \n # Only check the 'reference' tests: rpass/cfail/rfail/rmake.\n-check-ref: cleantestlibs cleantmptestlogs check-stage2-rpass check-stage2-rpass-valgrind \\\n-\tcheck-stage2-rfail check-stage2-cfail check-stage2-pfail check-stage2-rmake\n+check-ref: check-sanitycheck cleantestlibs cleantmptestlogs check-stage2-rpass \\\n+\tcheck-stage2-rpass-valgrind check-stage2-rfail check-stage2-cfail check-stage2-pfail \\\n+\tcheck-stage2-rmake\n \t$(Q)$(CFG_PYTHON) $(S)src/etc/check-summary.py tmp/*.log\n \n # Only check the docs.\n-check-docs: cleantestlibs cleantmptestlogs check-stage2-docs\n+check-docs: check-sanitycheck cleantestlibs cleantmptestlogs check-stage2-docs\n \t$(Q)$(CFG_PYTHON) $(S)src/etc/check-summary.py tmp/*.log\n \n # Some less critical tests that are not prone to breakage."}, {"sha": "0e103fbcffbad6a0fb1b2f34044b0887200519c8", "filename": "src/etc/check-sanitycheck.py", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f813f9779722d3670bbfbd0a352b64fe4ae9ddbb/src%2Fetc%2Fcheck-sanitycheck.py", "raw_url": "https://github.com/rust-lang/rust/raw/f813f9779722d3670bbfbd0a352b64fe4ae9ddbb/src%2Fetc%2Fcheck-sanitycheck.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fcheck-sanitycheck.py?ref=f813f9779722d3670bbfbd0a352b64fe4ae9ddbb", "patch": "@@ -11,19 +11,18 @@\n # except according to those terms.\n \n import os\n+import subprocess\n import sys\n import functools\n \n STATUS = 0\n \n-\n def error_unless_permitted(env_var, message):\n     global STATUS\n     if not os.getenv(env_var):\n         sys.stderr.write(message)\n         STATUS = 1\n \n-\n def only_on(platforms):\n     def decorator(func):\n         @functools.wraps(func)\n@@ -33,8 +32,7 @@ def inner():\n         return inner\n     return decorator\n \n-\n-@only_on(('linux', 'darwin', 'freebsd', 'openbsd'))\n+@only_on(['linux', 'darwin', 'freebsd', 'openbsd'])\n def check_rlimit_core():\n     import resource\n     soft, hard = resource.getrlimit(resource.RLIMIT_CORE)\n@@ -45,8 +43,14 @@ def check_rlimit_core():\n set ALLOW_NONZERO_RLIMIT_CORE to ignore this warning\n \"\"\" % (soft))\n \n+@only_on(['win32'])\n+def check_console_code_page():\n+    if '65001' not in subprocess.check_output(['cmd', '/c', 'chcp']):\n+        sys.stderr.write('Warning: the console output code page is not UTF-8, \\\n+some tests may fail. Use `cmd /c \"chcp 65001\"` to setup UTF-8 code page.\\n')\n \n def main():\n+    check_console_code_page()\n     check_rlimit_core()\n \n if __name__ == '__main__':"}]}