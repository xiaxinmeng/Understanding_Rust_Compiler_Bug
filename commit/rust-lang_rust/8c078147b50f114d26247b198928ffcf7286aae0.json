{"sha": "8c078147b50f114d26247b198928ffcf7286aae0", "node_id": "C_kwDOAAsO6NoAKDhjMDc4MTQ3YjUwZjExNGQyNjI0N2IxOTg5MjhmZmNmNzI4NmFhZTA", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-10-29T16:16:13Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-10-29T16:16:13Z"}, "message": "Merge #10662\n\n10662: Fix Plaintext textDocument/hover r=Veykril a=vsrs\n\nRelates to #10028\r\n\r\nNote: the PR corrects only invalid content kind, not formatting.\n\nCo-authored-by: vsrs <vit@conrlab.com>", "tree": {"sha": "406d647540c4873624368e3323bc040eb9965148", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/406d647540c4873624368e3323bc040eb9965148"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8c078147b50f114d26247b198928ffcf7286aae0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhfB5NCRBK7hj4Ov3rIwAAZgsIAGo5LLEHD28G1/Epbx4jZWYk\nRx5zID6HbumrwgeueoW/flPQRqzGSh/eElIMvar1LC37/Zs/2J+j5I+YQ5qaUkSD\nwoxIra+dlGRwVb5q2kks4P4inqx0NjAqstsO0Qf4TeKYxgA6vwnW9eDUTvxHpdXz\nrae5HWBsv09+d/4pDo0amVle0UGp+aqhPCqIPhjfO7jzi88NnybcpKCZIfqdGPK5\nvokOuB2H92zYDgvcoeopFR8ACqle4U4W6Ypw//c5SGBwO532zkxMzyLmhNS5QFd1\nt8g4Wl+Y3v3gX5mQdvzOW5urS4ofrZhRgBWflIGAePTFE2ECd0R5TvDupWTBwOg=\n=4DiT\n-----END PGP SIGNATURE-----\n", "payload": "tree 406d647540c4873624368e3323bc040eb9965148\nparent b9fa37f5b4e452a496bd7c4baeba08cbdebf6336\nparent 2f862cd6fe6c10343f6dec4c414419db88fac32e\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1635524173 +0000\ncommitter GitHub <noreply@github.com> 1635524173 +0000\n\nMerge #10662\n\n10662: Fix Plaintext textDocument/hover r=Veykril a=vsrs\n\nRelates to #10028\r\n\r\nNote: the PR corrects only invalid content kind, not formatting.\n\nCo-authored-by: vsrs <vit@conrlab.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8c078147b50f114d26247b198928ffcf7286aae0", "html_url": "https://github.com/rust-lang/rust/commit/8c078147b50f114d26247b198928ffcf7286aae0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8c078147b50f114d26247b198928ffcf7286aae0/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b9fa37f5b4e452a496bd7c4baeba08cbdebf6336", "url": "https://api.github.com/repos/rust-lang/rust/commits/b9fa37f5b4e452a496bd7c4baeba08cbdebf6336", "html_url": "https://github.com/rust-lang/rust/commit/b9fa37f5b4e452a496bd7c4baeba08cbdebf6336"}, {"sha": "2f862cd6fe6c10343f6dec4c414419db88fac32e", "url": "https://api.github.com/repos/rust-lang/rust/commits/2f862cd6fe6c10343f6dec4c414419db88fac32e", "html_url": "https://github.com/rust-lang/rust/commit/2f862cd6fe6c10343f6dec4c414419db88fac32e"}], "stats": {"total": 19, "additions": 16, "deletions": 3}, "files": [{"sha": "f108b694c0185398d21bbf97b237240b6f636b64", "filename": "crates/rust-analyzer/src/cli/lsif.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8c078147b50f114d26247b198928ffcf7286aae0/crates%2Frust-analyzer%2Fsrc%2Fcli%2Flsif.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8c078147b50f114d26247b198928ffcf7286aae0/crates%2Frust-analyzer%2Fsrc%2Fcli%2Flsif.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fcli%2Flsif.rs?ref=8c078147b50f114d26247b198928ffcf7286aae0", "patch": "@@ -136,6 +136,7 @@ impl LsifManager<'_> {\n                 result: lsp_types::Hover {\n                     contents: lsp_types::HoverContents::Markup(to_proto::markup_content(\n                         hover.markup,\n+                        ide::HoverDocFormat::Markdown,\n                     )),\n                     range: None,\n                 },"}, {"sha": "0ddddeca6759acb0adfddc595b4caefff22774bb", "filename": "crates/rust-analyzer/src/handlers.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/8c078147b50f114d26247b198928ffcf7286aae0/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8c078147b50f114d26247b198928ffcf7286aae0/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fhandlers.rs?ref=8c078147b50f114d26247b198928ffcf7286aae0", "patch": "@@ -920,9 +920,14 @@ pub(crate) fn handle_hover(\n \n     let line_index = snap.file_line_index(file_range.file_id)?;\n     let range = to_proto::range(&line_index, info.range);\n+    let markup_kind =\n+        snap.config.hover().documentation.map_or(ide::HoverDocFormat::Markdown, |kind| kind);\n     let hover = lsp_ext::Hover {\n         hover: lsp_types::Hover {\n-            contents: HoverContents::Markup(to_proto::markup_content(info.info.markup)),\n+            contents: HoverContents::Markup(to_proto::markup_content(\n+                info.info.markup,\n+                markup_kind,\n+            )),\n             range: Some(range),\n         },\n         actions: if snap.config.hover_actions().none() {"}, {"sha": "8e77df9598286581687ce63bb1f01b32f877f51b", "filename": "crates/rust-analyzer/src/to_proto.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/8c078147b50f114d26247b198928ffcf7286aae0/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8c078147b50f114d26247b198928ffcf7286aae0/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fto_proto.rs?ref=8c078147b50f114d26247b198928ffcf7286aae0", "patch": "@@ -1202,9 +1202,16 @@ pub(crate) fn reference_title(count: usize) -> String {\n     }\n }\n \n-pub(crate) fn markup_content(markup: Markup) -> lsp_types::MarkupContent {\n+pub(crate) fn markup_content(\n+    markup: Markup,\n+    kind: ide::HoverDocFormat,\n+) -> lsp_types::MarkupContent {\n+    let kind = match kind {\n+        ide::HoverDocFormat::Markdown => lsp_types::MarkupKind::Markdown,\n+        ide::HoverDocFormat::PlainText => lsp_types::MarkupKind::PlainText,\n+    };\n     let value = crate::markdown::format_docs(markup.as_str());\n-    lsp_types::MarkupContent { kind: lsp_types::MarkupKind::Markdown, value }\n+    lsp_types::MarkupContent { kind, value }\n }\n \n pub(crate) fn rename_error(err: RenameError) -> crate::LspError {"}]}