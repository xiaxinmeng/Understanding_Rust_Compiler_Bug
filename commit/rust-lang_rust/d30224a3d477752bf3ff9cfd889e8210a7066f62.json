{"sha": "d30224a3d477752bf3ff9cfd889e8210a7066f62", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQzMDIyNGEzZDQ3Nzc1MmJmM2ZmOWNmZDg4OWU4MjEwYTcwNjZmNjI=", "commit": {"author": {"name": "Ted Horst", "email": "ted.horst@earthlink.net", "date": "2012-12-20T17:35:12Z"}, "committer": {"name": "Tim Chevalier", "email": "chevalier@alum.wellesley.edu", "date": "2012-12-25T02:29:01Z"}, "message": "update mandelbrot to pipes, a few other updates", "tree": {"sha": "fa7e6aee0bdb750907b7b85c3a54301aa7c27c97", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fa7e6aee0bdb750907b7b85c3a54301aa7c27c97"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d30224a3d477752bf3ff9cfd889e8210a7066f62", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d30224a3d477752bf3ff9cfd889e8210a7066f62", "html_url": "https://github.com/rust-lang/rust/commit/d30224a3d477752bf3ff9cfd889e8210a7066f62", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d30224a3d477752bf3ff9cfd889e8210a7066f62/comments", "author": {"login": "tedhorst", "id": 113629, "node_id": "MDQ6VXNlcjExMzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/113629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tedhorst", "html_url": "https://github.com/tedhorst", "followers_url": "https://api.github.com/users/tedhorst/followers", "following_url": "https://api.github.com/users/tedhorst/following{/other_user}", "gists_url": "https://api.github.com/users/tedhorst/gists{/gist_id}", "starred_url": "https://api.github.com/users/tedhorst/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tedhorst/subscriptions", "organizations_url": "https://api.github.com/users/tedhorst/orgs", "repos_url": "https://api.github.com/users/tedhorst/repos", "events_url": "https://api.github.com/users/tedhorst/events{/privacy}", "received_events_url": "https://api.github.com/users/tedhorst/received_events", "type": "User", "site_admin": false}, "committer": {"login": "catamorphism", "id": 427212, "node_id": "MDQ6VXNlcjQyNzIxMg==", "avatar_url": "https://avatars.githubusercontent.com/u/427212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/catamorphism", "html_url": "https://github.com/catamorphism", "followers_url": "https://api.github.com/users/catamorphism/followers", "following_url": "https://api.github.com/users/catamorphism/following{/other_user}", "gists_url": "https://api.github.com/users/catamorphism/gists{/gist_id}", "starred_url": "https://api.github.com/users/catamorphism/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/catamorphism/subscriptions", "organizations_url": "https://api.github.com/users/catamorphism/orgs", "repos_url": "https://api.github.com/users/catamorphism/repos", "events_url": "https://api.github.com/users/catamorphism/events{/privacy}", "received_events_url": "https://api.github.com/users/catamorphism/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d438747a5121159a1f2bbe10a90f57908f12c2a", "url": "https://api.github.com/repos/rust-lang/rust/commits/8d438747a5121159a1f2bbe10a90f57908f12c2a", "html_url": "https://github.com/rust-lang/rust/commit/8d438747a5121159a1f2bbe10a90f57908f12c2a"}], "stats": {"total": 33, "additions": 11, "deletions": 22}, "files": [{"sha": "b6c1baac4125030fa7fc2d865f6c330c0ef66904", "filename": "src/test/bench/shootout-mandelbrot.rs", "status": "modified", "additions": 11, "deletions": 22, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/d30224a3d477752bf3ff9cfd889e8210a7066f62/src%2Ftest%2Fbench%2Fshootout-mandelbrot.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d30224a3d477752bf3ff9cfd889e8210a7066f62/src%2Ftest%2Fbench%2Fshootout-mandelbrot.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fbench%2Fshootout-mandelbrot.rs?ref=d30224a3d477752bf3ff9cfd889e8210a7066f62", "patch": "@@ -12,18 +12,14 @@\n //  http://shootout.alioth.debian.org/\n //   u64q/program.php?test=mandelbrot&lang=python3&id=2\n //\n-//  takes 3 optional args:\n+//  takes 2 optional args:\n //   square image size, defaults to 80_u\n-//   yield frequency, defaults to 10_u (yield every 10 spawns)\n //   output path, default is \"\" (no output), \"-\" means stdout\n //\n //  in the shootout, they use 16000 as image size\n-//  yield frequency doesn't seem to have much effect\n //\n //  writes pbm image to output path\n \n-#[legacy_modes];\n-\n extern mod std;\n use io::WriterUtil;\n use std::map::HashMap;\n@@ -51,7 +47,7 @@ impl cmplx : ops::Add<cmplx,cmplx> {\n     }\n }\n \n-type line = {i: uint, b: ~[u8]};\n+struct Line {i: uint, b: ~[u8]}\n \n pure fn cabs(x: cmplx) -> f64\n {\n@@ -87,7 +83,7 @@ fn fillbyte(x: cmplx, incr: f64) -> u8 {\n     rv\n }\n \n-fn chanmb(i: uint, size: uint, ch: oldcomm::Chan<line>) -> ()\n+fn chanmb(i: uint, size: uint, ch: oldcomm::Chan<Line>) -> ()\n {\n     let mut crv = ~[];\n     let incr = 2f64/(size as f64);\n@@ -97,22 +93,22 @@ fn chanmb(i: uint, size: uint, ch: oldcomm::Chan<line>) -> ()\n         let x = cmplx {re: xincr*(j as f64) - 1.5f64, im: y};\n         crv.push(fillbyte(x, incr));\n     };\n-    oldcomm::send(ch, {i:i, b:crv});\n+    oldcomm::send(ch, Line {i:i, b: move crv});\n }\n \n type devnull = {dn: int};\n \n impl devnull: io::Writer {\n     fn write(_b: &[const u8]) {}\n-    fn seek(+_i: int, +_s: io::SeekStyle) {}\n+    fn seek(_i: int, _s: io::SeekStyle) {}\n     fn tell() -> uint {0_u}\n     fn flush() -> int {0}\n     fn get_type() -> io::WriterType { io::File }\n }\n \n-fn writer(path: ~str, writech: oldcomm::Chan<oldcomm::Chan<line>>, size: uint)\n+fn writer(path: ~str, writech: oldcomm::Chan<oldcomm::Chan<Line>>, size: uint)\n {\n-    let p: oldcomm::Port<line> = oldcomm::Port();\n+    let p: oldcomm::Port<Line> = oldcomm::Port();\n     let ch = oldcomm::Chan(&p);\n     oldcomm::send(writech, ch);\n     let cout: io::Writer = match path {\n@@ -164,16 +160,13 @@ fn writer(path: ~str, writech: oldcomm::Chan<oldcomm::Chan<line>>, size: uint)\n fn main() {\n     let args = os::args();\n     let args = if os::getenv(~\"RUST_BENCH\").is_some() {\n-        ~[~\"\", ~\"4000\", ~\"10\"]\n+        ~[~\"\", ~\"4000\"]\n     } else {\n         args\n     };\n \n-    let path = if vec::len(args) < 4_u { ~\"\" }\n-    else { copy args[3] };  // FIXME: bad for perf\n-\n-    let yieldevery = if vec::len(args) < 3_u { 10_u }\n-    else { uint::from_str(args[2]).get() };\n+    let path = if vec::len(args) < 3_u { ~\"\" }\n+    else { copy args[2] };  // FIXME: bad for perf\n \n     let size = if vec::len(args) < 2_u { 80_u }\n     else { uint::from_str(args[1]).get() };\n@@ -185,10 +178,6 @@ fn main() {\n     };\n     let ch = oldcomm::recv(writep);\n     for uint::range(0_u, size) |j| {\n-        task::spawn(|| chanmb(j, size, ch) );\n-        if j % yieldevery == 0_u {\n-            debug!(\"Y %u\", j);\n-            task::yield();\n-        };\n+        do task::spawn { chanmb(j, size, ch) };\n     };\n }"}]}