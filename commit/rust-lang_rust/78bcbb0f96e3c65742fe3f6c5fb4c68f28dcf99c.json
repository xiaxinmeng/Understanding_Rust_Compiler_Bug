{"sha": "78bcbb0f96e3c65742fe3f6c5fb4c68f28dcf99c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc4YmNiYjBmOTZlM2M2NTc0MmZlM2Y2YzVmYjRjNjhmMjhkY2Y5OWM=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-03-21T18:29:01Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-03-21T21:28:04Z"}, "message": "Download the GCC artifacts from the HTTP server instead of FTP server.\n\nThe former seems much more stable, in case the cache becomes invalidated.", "tree": {"sha": "ee85fb716812b35be668100166eedda1daa0cefc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ee85fb716812b35be668100166eedda1daa0cefc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/78bcbb0f96e3c65742fe3f6c5fb4c68f28dcf99c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlqyzmcACgkQ/vbIBR0O\nATxQbBAApsUnc7M77OAA1krIjKZ0gIIKPZ+EcuXNJE9t1rQKGuelEebih2RDQLVh\n5FR1gvUN6jHt7vlqlFGYFxgqghRHESy0lOeRZqZPsNfWB+VhHSSUoRzTfO/9uWHS\nnWKKgbNERFaoPVFj1RMopkyB6XP77ev9S65JlDz33A6QqZWE334R5rcg6RNS5Oez\n/6EYx0krbgZPzuHDS8EMqU5INlDWE3OFkWrBCwUb/SEXAo6EGoOusJBmp6EJ6ewq\nH05/JcNg1jIWnGogw9QYWLFz+4KhEbk0bwKbPnL1sEaxpr0Sk21vchRRXncIM8dm\naOn3lL+bkUBJgqLM4tyKQYSutNIWvoToznsXkr/4oRxWSP4QGEPNMZlI+Cqw7Yah\nOvze9AFRe50CY9ZbELW/Sp/434yMcerbJHlcjwvgEDVy7ZuKEF0TZWgNpT8i92C9\n8P7+soo24NF1AHwkkEMBK3K5/abkg3qkOw/WAbStKS1FYEgRKiAiCXB+1JkjAPUk\n7EZ3eSYEgsKaKXqgc5U20FehGBd3o72YR13+d1yLaiX0BMk4uUPjIuLoPw3Y189s\nd3zOq0RjTl/0YR4S0d5lO3wuKxp14VxQ+Av1b72VAyqMJYhIIXARrdIqvW8GuXM6\nIxy+tpCOsMSBMmprgswbcQXeD7i5UJFAazdOF42gQGT2VsmxSqg=\n=Jte9\n-----END PGP SIGNATURE-----", "payload": "tree ee85fb716812b35be668100166eedda1daa0cefc\nparent c19264fa835a1eca86de4fd2e86a87b3919e57cf\nauthor kennytm <kennytm@gmail.com> 1521656941 +0800\ncommitter kennytm <kennytm@gmail.com> 1521667684 +0800\n\nDownload the GCC artifacts from the HTTP server instead of FTP server.\n\nThe former seems much more stable, in case the cache becomes invalidated.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/78bcbb0f96e3c65742fe3f6c5fb4c68f28dcf99c", "html_url": "https://github.com/rust-lang/rust/commit/78bcbb0f96e3c65742fe3f6c5fb4c68f28dcf99c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/78bcbb0f96e3c65742fe3f6c5fb4c68f28dcf99c/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c19264fa835a1eca86de4fd2e86a87b3919e57cf", "url": "https://api.github.com/repos/rust-lang/rust/commits/c19264fa835a1eca86de4fd2e86a87b3919e57cf", "html_url": "https://github.com/rust-lang/rust/commit/c19264fa835a1eca86de4fd2e86a87b3919e57cf"}], "stats": {"total": 34, "additions": 34, "deletions": 0}, "files": [{"sha": "08020e533ff191ca565868062cef8f7d5ab55967", "filename": "src/ci/docker/dist-i686-linux/build-gcc.sh", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/78bcbb0f96e3c65742fe3f6c5fb4c68f28dcf99c/src%2Fci%2Fdocker%2Fdist-i686-linux%2Fbuild-gcc.sh", "raw_url": "https://github.com/rust-lang/rust/raw/78bcbb0f96e3c65742fe3f6c5fb4c68f28dcf99c/src%2Fci%2Fdocker%2Fdist-i686-linux%2Fbuild-gcc.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-i686-linux%2Fbuild-gcc.sh?ref=78bcbb0f96e3c65742fe3f6c5fb4c68f28dcf99c", "patch": "@@ -17,6 +17,23 @@ GCC=4.8.5\n \n curl https://ftp.gnu.org/gnu/gcc/gcc-$GCC/gcc-$GCC.tar.bz2 | tar xjf -\n cd gcc-$GCC\n+\n+# FIXME(#49246): Remove the `sed` below.\n+#\n+# On 2018 March 21st, two Travis builders' cache for Docker are suddenly invalidated. Normally this\n+# is fine, because we just need to rebuild the Docker image. However, it reveals a network issue:\n+# downloading from `ftp://gcc.gnu.org/` from Travis (using passive mode) often leads to \"Connection\n+# timed out\" error, and even when the download completed, the file is usually corrupted. This causes\n+# nothing to be landed that day.\n+#\n+# We observed that the `gcc-4.8.5.tar.bz2` above can be downloaded successfully, so as a stability\n+# improvement we try to download from the HTTPS mirror instead. Turns out this uncovered the third\n+# bug: the host `gcc.gnu.org` and `cygwin.com` share the same IP, and the TLS certificate of the\n+# latter host is presented to `wget`! Therefore, we choose to download from the insecure HTTP server\n+# instead here.\n+#\n+sed -i'' 's|ftp://gcc\\.gnu\\.org/|http://gcc.gnu.org/|g' ./contrib/download_prerequisites\n+\n ./contrib/download_prerequisites\n mkdir ../gcc-build\n cd ../gcc-build"}, {"sha": "08020e533ff191ca565868062cef8f7d5ab55967", "filename": "src/ci/docker/dist-x86_64-linux/build-gcc.sh", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/78bcbb0f96e3c65742fe3f6c5fb4c68f28dcf99c/src%2Fci%2Fdocker%2Fdist-x86_64-linux%2Fbuild-gcc.sh", "raw_url": "https://github.com/rust-lang/rust/raw/78bcbb0f96e3c65742fe3f6c5fb4c68f28dcf99c/src%2Fci%2Fdocker%2Fdist-x86_64-linux%2Fbuild-gcc.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-x86_64-linux%2Fbuild-gcc.sh?ref=78bcbb0f96e3c65742fe3f6c5fb4c68f28dcf99c", "patch": "@@ -17,6 +17,23 @@ GCC=4.8.5\n \n curl https://ftp.gnu.org/gnu/gcc/gcc-$GCC/gcc-$GCC.tar.bz2 | tar xjf -\n cd gcc-$GCC\n+\n+# FIXME(#49246): Remove the `sed` below.\n+#\n+# On 2018 March 21st, two Travis builders' cache for Docker are suddenly invalidated. Normally this\n+# is fine, because we just need to rebuild the Docker image. However, it reveals a network issue:\n+# downloading from `ftp://gcc.gnu.org/` from Travis (using passive mode) often leads to \"Connection\n+# timed out\" error, and even when the download completed, the file is usually corrupted. This causes\n+# nothing to be landed that day.\n+#\n+# We observed that the `gcc-4.8.5.tar.bz2` above can be downloaded successfully, so as a stability\n+# improvement we try to download from the HTTPS mirror instead. Turns out this uncovered the third\n+# bug: the host `gcc.gnu.org` and `cygwin.com` share the same IP, and the TLS certificate of the\n+# latter host is presented to `wget`! Therefore, we choose to download from the insecure HTTP server\n+# instead here.\n+#\n+sed -i'' 's|ftp://gcc\\.gnu\\.org/|http://gcc.gnu.org/|g' ./contrib/download_prerequisites\n+\n ./contrib/download_prerequisites\n mkdir ../gcc-build\n cd ../gcc-build"}]}