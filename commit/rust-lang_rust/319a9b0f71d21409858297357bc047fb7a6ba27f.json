{"sha": "319a9b0f71d21409858297357bc047fb7a6ba27f", "node_id": "C_kwDOAAsO6NoAKDMxOWE5YjBmNzFkMjE0MDk4NTgyOTczNTdiYzA0N2ZiN2E2YmEyN2Y", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2022-04-06T20:12:47Z"}, "committer": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2022-04-12T06:44:39Z"}, "message": "Move current_thread_unique_ptr to the only module that uses it.", "tree": {"sha": "dd083a859fe622eca37b05740c3a75f0ba9cb8b8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dd083a859fe622eca37b05740c3a75f0ba9cb8b8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/319a9b0f71d21409858297357bc047fb7a6ba27f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/319a9b0f71d21409858297357bc047fb7a6ba27f", "html_url": "https://github.com/rust-lang/rust/commit/319a9b0f71d21409858297357bc047fb7a6ba27f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/319a9b0f71d21409858297357bc047fb7a6ba27f/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ebebe6f837b3499efb5cf1eb95e7eeffbc5e477a", "url": "https://api.github.com/repos/rust-lang/rust/commits/ebebe6f837b3499efb5cf1eb95e7eeffbc5e477a", "html_url": "https://github.com/rust-lang/rust/commit/ebebe6f837b3499efb5cf1eb95e7eeffbc5e477a"}], "stats": {"total": 19, "additions": 9, "deletions": 10}, "files": [{"sha": "1df7b5325465494bf051837fa8ead3135fa34cc7", "filename": "library/std/src/sys/unix/locks/futex.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/319a9b0f71d21409858297357bc047fb7a6ba27f/library%2Fstd%2Fsrc%2Fsys%2Funix%2Flocks%2Ffutex.rs", "raw_url": "https://github.com/rust-lang/rust/raw/319a9b0f71d21409858297357bc047fb7a6ba27f/library%2Fstd%2Fsrc%2Fsys%2Funix%2Flocks%2Ffutex.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funix%2Flocks%2Ffutex.rs?ref=319a9b0f71d21409858297357bc047fb7a6ba27f", "patch": "@@ -4,7 +4,6 @@ use crate::sync::atomic::{\n     Ordering::{Acquire, Relaxed, Release},\n };\n use crate::sys::futex::{futex_wait, futex_wake, futex_wake_all};\n-use crate::sys_common::thread_info::current_thread_unique_ptr;\n use crate::time::Duration;\n \n pub type MovableMutex = Mutex;\n@@ -248,3 +247,12 @@ impl ReentrantMutex {\n         }\n     }\n }\n+\n+/// Get an address that is unique per running thread.\n+///\n+/// This can be used as a non-null usize-sized ID.\n+pub fn current_thread_unique_ptr() -> usize {\n+    // Use a non-drop type to make sure it's still available during thread destruction.\n+    thread_local! { static X: u8 = 0 }\n+    X.with(|x| <*const _>::addr(x))\n+}"}, {"sha": "38c9e50009af5eb98193dc559b4dac28834083d3", "filename": "library/std/src/sys_common/thread_info.rs", "status": "modified", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/319a9b0f71d21409858297357bc047fb7a6ba27f/library%2Fstd%2Fsrc%2Fsys_common%2Fthread_info.rs", "raw_url": "https://github.com/rust-lang/rust/raw/319a9b0f71d21409858297357bc047fb7a6ba27f/library%2Fstd%2Fsrc%2Fsys_common%2Fthread_info.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys_common%2Fthread_info.rs?ref=319a9b0f71d21409858297357bc047fb7a6ba27f", "patch": "@@ -30,15 +30,6 @@ impl ThreadInfo {\n     }\n }\n \n-/// Get an address that is unique per running thread.\n-///\n-/// This can be used as a non-null usize-sized ID.\n-pub fn current_thread_unique_ptr() -> usize {\n-    // Use a non-drop type to make sure it's still available during thread destruction.\n-    thread_local! { static X: u8 = 0 }\n-    X.with(|x| <*const _>::addr(x))\n-}\n-\n pub fn current_thread() -> Option<Thread> {\n     ThreadInfo::with(|info| info.thread.clone())\n }"}]}