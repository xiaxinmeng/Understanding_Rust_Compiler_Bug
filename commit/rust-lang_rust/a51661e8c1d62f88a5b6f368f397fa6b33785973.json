{"sha": "a51661e8c1d62f88a5b6f368f397fa6b33785973", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE1MTY2MWU4YzFkNjJmODhhNWI2ZjM2OGYzOTdmYTZiMzM3ODU5NzM=", "commit": {"author": {"name": "Jens Nockert", "email": "jens@nockert.se", "date": "2012-12-27T18:07:05Z"}, "committer": {"name": "Jens Nockert", "email": "jens@nockert.se", "date": "2012-12-27T18:07:05Z"}, "message": "Add support for byteswap intrinsics\n\nAdds support for the llvm.bswap.i{8,16,32} intrinsics, which swaps the\nbyte order from little endian to big endian, or the reverse.", "tree": {"sha": "86babda5383dccb7f7d2929803312d43a21e9078", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/86babda5383dccb7f7d2929803312d43a21e9078"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a51661e8c1d62f88a5b6f368f397fa6b33785973", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a51661e8c1d62f88a5b6f368f397fa6b33785973", "html_url": "https://github.com/rust-lang/rust/commit/a51661e8c1d62f88a5b6f368f397fa6b33785973", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a51661e8c1d62f88a5b6f368f397fa6b33785973/comments", "author": {"login": "auroranockert", "id": 49616, "node_id": "MDQ6VXNlcjQ5NjE2", "avatar_url": "https://avatars.githubusercontent.com/u/49616?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auroranockert", "html_url": "https://github.com/auroranockert", "followers_url": "https://api.github.com/users/auroranockert/followers", "following_url": "https://api.github.com/users/auroranockert/following{/other_user}", "gists_url": "https://api.github.com/users/auroranockert/gists{/gist_id}", "starred_url": "https://api.github.com/users/auroranockert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auroranockert/subscriptions", "organizations_url": "https://api.github.com/users/auroranockert/orgs", "repos_url": "https://api.github.com/users/auroranockert/repos", "events_url": "https://api.github.com/users/auroranockert/events{/privacy}", "received_events_url": "https://api.github.com/users/auroranockert/received_events", "type": "User", "site_admin": false}, "committer": {"login": "auroranockert", "id": 49616, "node_id": "MDQ6VXNlcjQ5NjE2", "avatar_url": "https://avatars.githubusercontent.com/u/49616?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auroranockert", "html_url": "https://github.com/auroranockert", "followers_url": "https://api.github.com/users/auroranockert/followers", "following_url": "https://api.github.com/users/auroranockert/following{/other_user}", "gists_url": "https://api.github.com/users/auroranockert/gists{/gist_id}", "starred_url": "https://api.github.com/users/auroranockert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auroranockert/subscriptions", "organizations_url": "https://api.github.com/users/auroranockert/orgs", "repos_url": "https://api.github.com/users/auroranockert/repos", "events_url": "https://api.github.com/users/auroranockert/events{/privacy}", "received_events_url": "https://api.github.com/users/auroranockert/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "efb8711f90778db1031053e3f379a8dcc92be6c6", "url": "https://api.github.com/repos/rust-lang/rust/commits/efb8711f90778db1031053e3f379a8dcc92be6c6", "html_url": "https://github.com/rust-lang/rust/commit/efb8711f90778db1031053e3f379a8dcc92be6c6"}], "stats": {"total": 46, "additions": 46, "deletions": 0}, "files": [{"sha": "2b22852b646eae2035dc739ac7ed52f796ecf25d", "filename": "src/librustc/middle/trans/base.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/a51661e8c1d62f88a5b6f368f397fa6b33785973/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a51661e8c1d62f88a5b6f368f397fa6b33785973/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs?ref=a51661e8c1d62f88a5b6f368f397fa6b33785973", "patch": "@@ -2423,6 +2423,12 @@ fn declare_intrinsics(llmod: ModuleRef) -> HashMap<~str, ValueRef> {\n                                 T_fn(~[T_i32(), T_i1()], T_i32()));\n     let cttz64 = decl_cdecl_fn(llmod, ~\"llvm.cttz.i64\",\n                                 T_fn(~[T_i64(), T_i1()], T_i64()));\n+    let bswap16 = decl_cdecl_fn(llmod, ~\"llvm.bswap.i16\",\n+                                T_fn(~[T_i16()], T_i16()));\n+    let bswap32 = decl_cdecl_fn(llmod, ~\"llvm.bswap.i32\",\n+                                T_fn(~[T_i32()], T_i32()));\n+    let bswap64 = decl_cdecl_fn(llmod, ~\"llvm.bswap.i64\",\n+                                T_fn(~[T_i64()], T_i64()));\n \n     let intrinsics = HashMap();\n     intrinsics.insert(~\"llvm.gcroot\", gcroot);\n@@ -2475,6 +2481,9 @@ fn declare_intrinsics(llmod: ModuleRef) -> HashMap<~str, ValueRef> {\n     intrinsics.insert(~\"llvm.cttz.i16\", cttz16);\n     intrinsics.insert(~\"llvm.cttz.i32\", cttz32);\n     intrinsics.insert(~\"llvm.cttz.i64\", cttz64);\n+    intrinsics.insert(~\"llvm.bswap.i16\", bswap16);\n+    intrinsics.insert(~\"llvm.bswap.i32\", bswap32);\n+    intrinsics.insert(~\"llvm.bswap.i64\", bswap64);\n \n     return intrinsics;\n }"}, {"sha": "1f12f65933d068511f56a7c86d709bbcae2150c6", "filename": "src/librustc/middle/trans/foreign.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/a51661e8c1d62f88a5b6f368f397fa6b33785973/src%2Flibrustc%2Fmiddle%2Ftrans%2Fforeign.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a51661e8c1d62f88a5b6f368f397fa6b33785973/src%2Flibrustc%2Fmiddle%2Ftrans%2Fforeign.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fforeign.rs?ref=a51661e8c1d62f88a5b6f368f397fa6b33785973", "patch": "@@ -1262,6 +1262,21 @@ fn trans_intrinsic(ccx: @crate_ctxt, decl: ValueRef, item: @ast::foreign_item,\n             let cttz = ccx.intrinsics.get(~\"llvm.cttz.i64\");\n             Store(bcx, Call(bcx, cttz, ~[x, y]), fcx.llretptr)\n         }\n+        ~\"bswap16\" => {\n+            let x = get_param(decl, first_real_arg);\n+            let cttz = ccx.intrinsics.get(~\"llvm.bswap.i16\");\n+            Store(bcx, Call(bcx, cttz, ~[x]), fcx.llretptr)\n+        }\n+        ~\"bswap32\" => {\n+            let x = get_param(decl, first_real_arg);\n+            let cttz = ccx.intrinsics.get(~\"llvm.bswap.i32\");\n+            Store(bcx, Call(bcx, cttz, ~[x]), fcx.llretptr)\n+        }\n+        ~\"bswap64\" => {\n+            let x = get_param(decl, first_real_arg);\n+            let cttz = ccx.intrinsics.get(~\"llvm.bswap.i64\");\n+            Store(bcx, Call(bcx, cttz, ~[x]), fcx.llretptr)\n+        }\n         _ => {\n             // Could we make this an enum rather than a string? does it get\n             // checked earlier?"}, {"sha": "a75cd13a1259e413937e2a1b99e4f077ff6f1845", "filename": "src/librustc/middle/trans/type_use.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a51661e8c1d62f88a5b6f368f397fa6b33785973/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_use.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a51661e8c1d62f88a5b6f368f397fa6b33785973/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_use.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Ftype_use.rs?ref=a51661e8c1d62f88a5b6f368f397fa6b33785973", "patch": "@@ -135,6 +135,8 @@ fn type_uses_for(ccx: @crate_ctxt, fn_id: def_id, n_tps: uint)\n                 ~\"ctlz8\" | ~\"ctlz16\" | ~\"ctlz32\" | ~\"ctlz64\" => 0,\n                 ~\"cttz8\" | ~\"cttz16\" | ~\"cttz32\" | ~\"cttz64\" => 0,\n \n+                ~\"bswap16\" | ~\"bswap32\" | ~\"bswap64\" => 0,\n+\n                 // would be cool to make these an enum instead of strings!\n                 _ => fail ~\"unknown intrinsic in type_use\"\n             };"}, {"sha": "0aeb9049ca29c14ad0d792bfd00da2304156297b", "filename": "src/librustc/middle/typeck/check/mod.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/a51661e8c1d62f88a5b6f368f397fa6b33785973/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a51661e8c1d62f88a5b6f368f397fa6b33785973/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs?ref=a51661e8c1d62f88a5b6f368f397fa6b33785973", "patch": "@@ -3204,6 +3204,18 @@ fn check_intrinsic_type(ccx: @crate_ctxt, it: @ast::foreign_item) {\n          (0u, ~[arg(ast::by_copy, ty::mk_i64(tcx))],\n          ty::mk_i64(tcx))\n      }\n+     ~\"bswap16\" => {\n+         (0u, ~[arg(ast::by_copy, ty::mk_i16(tcx))],\n+         ty::mk_i16(tcx))\n+     }\n+     ~\"bswap32\" => {\n+         (0u, ~[arg(ast::by_copy, ty::mk_i32(tcx))],\n+         ty::mk_i32(tcx))\n+     }\n+     ~\"bswap64\" => {\n+         (0u, ~[arg(ast::by_copy, ty::mk_i64(tcx))],\n+         ty::mk_i64(tcx))\n+     }\n      ref other => {\n         tcx.sess.span_err(it.span, ~\"unrecognized intrinsic function: `\" +\n                           (*other) + ~\"`\");"}, {"sha": "feddd0ab9cbc81f8a6c74df1e343e0d9fffe7ab1", "filename": "src/test/run-pass/intrinsics-integer.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a51661e8c1d62f88a5b6f368f397fa6b33785973/src%2Ftest%2Frun-pass%2Fintrinsics-integer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a51661e8c1d62f88a5b6f368f397fa6b33785973/src%2Ftest%2Frun-pass%2Fintrinsics-integer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fintrinsics-integer.rs?ref=a51661e8c1d62f88a5b6f368f397fa6b33785973", "patch": "@@ -28,6 +28,10 @@ extern mod rusti {\n     fn cttz16(x: i16) -> i16;\n     fn cttz32(x: i32) -> i32;\n     fn cttz64(x: i64) -> i64;\n+\n+    fn bswap16(x: i16) -> i16;\n+    fn bswap32(x: i32) -> i32;\n+    fn bswap64(x: i64) -> i64;\n }\n \n fn main() {\n@@ -109,4 +113,8 @@ fn main() {\n     assert(cttz32(-1i32) == 0i32);\n     assert(cttz64(-1i64) == 0i64);\n \n+    assert(bswap16(0x0A0Bi16) == 0x0B0Ai16);\n+    assert(bswap32(0x0ABBCC0Di32) == 0x0DCCBB0Ai32);\n+    assert(bswap64(0x0122334455667708i64) == 0x0877665544332201i64);\n+\n }"}]}