{"sha": "b0dcb862c60c87c55f4e34c2ecce8914ffe3c4c7", "node_id": "C_kwDOAAsO6NoAKGIwZGNiODYyYzYwYzg3YzU1ZjRlMzRjMmVjY2U4OTE0ZmZlM2M0Yzc", "commit": {"author": {"name": "Jason Newcomb", "email": "jsnewcomb@pm.me", "date": "2022-04-22T22:49:15Z"}, "committer": {"name": "Jason Newcomb", "email": "jsnewcomb@pm.me", "date": "2022-11-07T18:15:39Z"}, "message": "Move `needless_collect` into the `methods` lint pass", "tree": {"sha": "5f244ca576709fff2d106620edc5b0378cbdfae5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5f244ca576709fff2d106620edc5b0378cbdfae5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b0dcb862c60c87c55f4e34c2ecce8914ffe3c4c7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b0dcb862c60c87c55f4e34c2ecce8914ffe3c4c7", "html_url": "https://github.com/rust-lang/rust/commit/b0dcb862c60c87c55f4e34c2ecce8914ffe3c4c7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b0dcb862c60c87c55f4e34c2ecce8914ffe3c4c7/comments", "author": {"login": "Jarcho", "id": 7761774, "node_id": "MDQ6VXNlcjc3NjE3NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7761774?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jarcho", "html_url": "https://github.com/Jarcho", "followers_url": "https://api.github.com/users/Jarcho/followers", "following_url": "https://api.github.com/users/Jarcho/following{/other_user}", "gists_url": "https://api.github.com/users/Jarcho/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jarcho/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jarcho/subscriptions", "organizations_url": "https://api.github.com/users/Jarcho/orgs", "repos_url": "https://api.github.com/users/Jarcho/repos", "events_url": "https://api.github.com/users/Jarcho/events{/privacy}", "received_events_url": "https://api.github.com/users/Jarcho/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Jarcho", "id": 7761774, "node_id": "MDQ6VXNlcjc3NjE3NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7761774?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jarcho", "html_url": "https://github.com/Jarcho", "followers_url": "https://api.github.com/users/Jarcho/followers", "following_url": "https://api.github.com/users/Jarcho/following{/other_user}", "gists_url": "https://api.github.com/users/Jarcho/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jarcho/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jarcho/subscriptions", "organizations_url": "https://api.github.com/users/Jarcho/orgs", "repos_url": "https://api.github.com/users/Jarcho/repos", "events_url": "https://api.github.com/users/Jarcho/events{/privacy}", "received_events_url": "https://api.github.com/users/Jarcho/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "213003b8874016aadc61195f049fc2d7e773ccad", "url": "https://api.github.com/repos/rust-lang/rust/commits/213003b8874016aadc61195f049fc2d7e773ccad", "html_url": "https://github.com/rust-lang/rust/commit/213003b8874016aadc61195f049fc2d7e773ccad"}], "stats": {"total": 54, "additions": 27, "deletions": 27}, "files": [{"sha": "e9094ca3a093ec5d7e0970a7f73c9ef1c07df6bd", "filename": "clippy_lints/src/declared_lints.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b0dcb862c60c87c55f4e34c2ecce8914ffe3c4c7/clippy_lints%2Fsrc%2Fdeclared_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b0dcb862c60c87c55f4e34c2ecce8914ffe3c4c7/clippy_lints%2Fsrc%2Fdeclared_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdeclared_lints.rs?ref=b0dcb862c60c87c55f4e34c2ecce8914ffe3c4c7", "patch": "@@ -237,7 +237,6 @@ pub(crate) static LINTS: &[&crate::LintInfo] = &[\n     crate::loops::MANUAL_MEMCPY_INFO,\n     crate::loops::MISSING_SPIN_LOOP_INFO,\n     crate::loops::MUT_RANGE_BOUND_INFO,\n-    crate::loops::NEEDLESS_COLLECT_INFO,\n     crate::loops::NEEDLESS_RANGE_LOOP_INFO,\n     crate::loops::NEVER_LOOP_INFO,\n     crate::loops::SAME_ITEM_PUSH_INFO,\n@@ -346,6 +345,7 @@ pub(crate) static LINTS: &[&crate::LintInfo] = &[\n     crate::methods::MAP_UNWRAP_OR_INFO,\n     crate::methods::MUT_MUTEX_LOCK_INFO,\n     crate::methods::NAIVE_BYTECOUNT_INFO,\n+    crate::methods::NEEDLESS_COLLECT_INFO,\n     crate::methods::NEEDLESS_OPTION_AS_DEREF_INFO,\n     crate::methods::NEEDLESS_OPTION_TAKE_INFO,\n     crate::methods::NEEDLESS_SPLITN_INFO,"}, {"sha": "8e52cac4323c3102541c8e6efa238ca0b1c1bd69", "filename": "clippy_lints/src/loops/mod.rs", "status": "modified", "additions": 0, "deletions": 26, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/b0dcb862c60c87c55f4e34c2ecce8914ffe3c4c7/clippy_lints%2Fsrc%2Floops%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b0dcb862c60c87c55f4e34c2ecce8914ffe3c4c7/clippy_lints%2Fsrc%2Floops%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops%2Fmod.rs?ref=b0dcb862c60c87c55f4e34c2ecce8914ffe3c4c7", "patch": "@@ -9,7 +9,6 @@ mod manual_flatten;\n mod manual_memcpy;\n mod missing_spin_loop;\n mod mut_range_bound;\n-mod needless_collect;\n mod needless_range_loop;\n mod never_loop;\n mod same_item_push;\n@@ -205,28 +204,6 @@ declare_clippy_lint! {\n     \"`loop { if let { ... } else break }`, which can be written as a `while let` loop\"\n }\n \n-declare_clippy_lint! {\n-    /// ### What it does\n-    /// Checks for functions collecting an iterator when collect\n-    /// is not needed.\n-    ///\n-    /// ### Why is this bad?\n-    /// `collect` causes the allocation of a new data structure,\n-    /// when this allocation may not be needed.\n-    ///\n-    /// ### Example\n-    /// ```rust\n-    /// # let iterator = vec![1].into_iter();\n-    /// let len = iterator.clone().collect::<Vec<_>>().len();\n-    /// // should be\n-    /// let len = iterator.count();\n-    /// ```\n-    #[clippy::version = \"1.30.0\"]\n-    pub NEEDLESS_COLLECT,\n-    nursery,\n-    \"collecting an iterator when collect is not needed\"\n-}\n-\n declare_clippy_lint! {\n     /// ### What it does\n     /// Checks `for` loops over slices with an explicit counter\n@@ -605,7 +582,6 @@ declare_lint_pass!(Loops => [\n     EXPLICIT_INTO_ITER_LOOP,\n     ITER_NEXT_LOOP,\n     WHILE_LET_LOOP,\n-    NEEDLESS_COLLECT,\n     EXPLICIT_COUNTER_LOOP,\n     EMPTY_LOOP,\n     WHILE_LET_ON_ITERATOR,\n@@ -667,8 +643,6 @@ impl<'tcx> LateLintPass<'tcx> for Loops {\n             while_immutable_condition::check(cx, condition, body);\n             missing_spin_loop::check(cx, condition, body);\n         }\n-\n-        needless_collect::check(expr, cx);\n     }\n }\n "}, {"sha": "c413d9baf1722ce887381bfd5a65fd4efee7f9fe", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/b0dcb862c60c87c55f4e34c2ecce8914ffe3c4c7/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b0dcb862c60c87c55f4e34c2ecce8914ffe3c4c7/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=b0dcb862c60c87c55f4e34c2ecce8914ffe3c4c7", "patch": "@@ -54,6 +54,7 @@ mod map_flatten;\n mod map_identity;\n mod map_unwrap_or;\n mod mut_mutex_lock;\n+mod needless_collect;\n mod needless_option_as_deref;\n mod needless_option_take;\n mod no_effect_replace;\n@@ -3141,6 +3142,28 @@ declare_clippy_lint! {\n     \"jumping to the start of stream using `seek` method\"\n }\n \n+declare_clippy_lint! {\n+    /// ### What it does\n+    /// Checks for functions collecting an iterator when collect\n+    /// is not needed.\n+    ///\n+    /// ### Why is this bad?\n+    /// `collect` causes the allocation of a new data structure,\n+    /// when this allocation may not be needed.\n+    ///\n+    /// ### Example\n+    /// ```rust\n+    /// # let iterator = vec![1].into_iter();\n+    /// let len = iterator.clone().collect::<Vec<_>>().len();\n+    /// // should be\n+    /// let len = iterator.count();\n+    /// ```\n+    #[clippy::version = \"1.30.0\"]\n+    pub NEEDLESS_COLLECT,\n+    nursery,\n+    \"collecting an iterator when collect is not needed\"\n+}\n+\n pub struct Methods {\n     avoid_breaking_exported_api: bool,\n     msrv: Option<RustcVersion>,\n@@ -3267,6 +3290,7 @@ impl_lint_pass!(Methods => [\n     ITER_KV_MAP,\n     SEEK_FROM_CURRENT,\n     SEEK_TO_START_INSTEAD_OF_REWIND,\n+    NEEDLESS_COLLECT,\n ]);\n \n /// Extracts a method call name, args, and `Span` of the method name.\n@@ -3317,6 +3341,8 @@ impl<'tcx> LateLintPass<'tcx> for Methods {\n             },\n             _ => (),\n         }\n+\n+        needless_collect::check(expr, cx);\n     }\n \n     #[allow(clippy::too_many_lines)]"}, {"sha": "66f9e28596e87cedda9ae44c8508a19523be8341", "filename": "clippy_lints/src/methods/needless_collect.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/b0dcb862c60c87c55f4e34c2ecce8914ffe3c4c7/clippy_lints%2Fsrc%2Fmethods%2Fneedless_collect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b0dcb862c60c87c55f4e34c2ecce8914ffe3c4c7/clippy_lints%2Fsrc%2Fmethods%2Fneedless_collect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fneedless_collect.rs?ref=b0dcb862c60c87c55f4e34c2ecce8914ffe3c4c7", "previous_filename": "clippy_lints/src/loops/needless_collect.rs"}]}