{"sha": "2678765d08df633b4804d1ba03e090c3bed878bb", "node_id": "C_kwDOAAsO6NoAKDI2Nzg3NjVkMDhkZjYzM2I0ODA0ZDFiYTAzZTA5MGMzYmVkODc4YmI", "commit": {"author": {"name": "Jhonny Bill Mena", "email": "jhonnybillm@gmail.com", "date": "2022-10-31T05:51:58Z"}, "committer": {"name": "Jhonny Bill Mena", "email": "jhonnybillm@gmail.com", "date": "2022-11-04T05:17:02Z"}, "message": "FIX - Migrate missing errors in link.rs", "tree": {"sha": "23e4cfb63431f1045e9e3df93110c54d10d7f1f6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/23e4cfb63431f1045e9e3df93110c54d10d7f1f6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2678765d08df633b4804d1ba03e090c3bed878bb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2678765d08df633b4804d1ba03e090c3bed878bb", "html_url": "https://github.com/rust-lang/rust/commit/2678765d08df633b4804d1ba03e090c3bed878bb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2678765d08df633b4804d1ba03e090c3bed878bb/comments", "author": {"login": "JhonnyBillM", "id": 18747072, "node_id": "MDQ6VXNlcjE4NzQ3MDcy", "avatar_url": "https://avatars.githubusercontent.com/u/18747072?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JhonnyBillM", "html_url": "https://github.com/JhonnyBillM", "followers_url": "https://api.github.com/users/JhonnyBillM/followers", "following_url": "https://api.github.com/users/JhonnyBillM/following{/other_user}", "gists_url": "https://api.github.com/users/JhonnyBillM/gists{/gist_id}", "starred_url": "https://api.github.com/users/JhonnyBillM/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JhonnyBillM/subscriptions", "organizations_url": "https://api.github.com/users/JhonnyBillM/orgs", "repos_url": "https://api.github.com/users/JhonnyBillM/repos", "events_url": "https://api.github.com/users/JhonnyBillM/events{/privacy}", "received_events_url": "https://api.github.com/users/JhonnyBillM/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JhonnyBillM", "id": 18747072, "node_id": "MDQ6VXNlcjE4NzQ3MDcy", "avatar_url": "https://avatars.githubusercontent.com/u/18747072?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JhonnyBillM", "html_url": "https://github.com/JhonnyBillM", "followers_url": "https://api.github.com/users/JhonnyBillM/followers", "following_url": "https://api.github.com/users/JhonnyBillM/following{/other_user}", "gists_url": "https://api.github.com/users/JhonnyBillM/gists{/gist_id}", "starred_url": "https://api.github.com/users/JhonnyBillM/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JhonnyBillM/subscriptions", "organizations_url": "https://api.github.com/users/JhonnyBillM/orgs", "repos_url": "https://api.github.com/users/JhonnyBillM/repos", "events_url": "https://api.github.com/users/JhonnyBillM/events{/privacy}", "received_events_url": "https://api.github.com/users/JhonnyBillM/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1f4c5a624fd7db58b32d6d9cfa063fbfe0a340a7", "url": "https://api.github.com/repos/rust-lang/rust/commits/1f4c5a624fd7db58b32d6d9cfa063fbfe0a340a7", "html_url": "https://github.com/rust-lang/rust/commit/1f4c5a624fd7db58b32d6d9cfa063fbfe0a340a7"}], "stats": {"total": 25, "additions": 21, "deletions": 4}, "files": [{"sha": "1e6a2b6ecaa6d2ea429026de0d4fa36f18ae46a8", "filename": "compiler/rustc_codegen_ssa/src/back/link.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/2678765d08df633b4804d1ba03e090c3bed878bb/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2678765d08df633b4804d1ba03e090c3bed878bb/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs?ref=2678765d08df633b4804d1ba03e090c3bed878bb", "patch": "@@ -2776,14 +2776,14 @@ fn add_apple_sdk(cmd: &mut dyn Linker, sess: &Session, flavor: LinkerFlavor) {\n         (\"arm\", \"watchos\") => \"watchos\",\n         (_, \"macos\") => \"macosx\",\n         _ => {\n-            sess.err(&format!(\"unsupported arch `{}` for os `{}`\", arch, os));\n+            sess.emit_err(errors::UnsupportedArch { arch, os });\n             return;\n         }\n     };\n     let sdk_root = match get_apple_sdk_root(sdk_name) {\n         Ok(s) => s,\n         Err(e) => {\n-            sess.err(&e);\n+            sess.emit_err(e);\n             return;\n         }\n     };\n@@ -2799,7 +2799,7 @@ fn add_apple_sdk(cmd: &mut dyn Linker, sess: &Session, flavor: LinkerFlavor) {\n     }\n }\n \n-fn get_apple_sdk_root(sdk_name: &str) -> Result<String, String> {\n+fn get_apple_sdk_root(sdk_name: &str) -> Result<String, errors::AppleSdkRootError<'_>> {\n     // Following what clang does\n     // (https://github.com/llvm/llvm-project/blob/\n     // 296a80102a9b72c3eda80558fb78a3ed8849b341/clang/lib/Driver/ToolChains/Darwin.cpp#L1661-L1678)\n@@ -2849,7 +2849,7 @@ fn get_apple_sdk_root(sdk_name: &str) -> Result<String, String> {\n \n     match res {\n         Ok(output) => Ok(output.trim().to_string()),\n-        Err(e) => Err(format!(\"failed to get {} SDK path: {}\", sdk_name, e)),\n+        Err(error) => Err(errors::AppleSdkRootError::SdkPath { sdk_name, error }),\n     }\n }\n "}, {"sha": "35eae30c4ba9de4f579b7e7f45400dec844b3c3c", "filename": "compiler/rustc_codegen_ssa/src/errors.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/2678765d08df633b4804d1ba03e090c3bed878bb/compiler%2Frustc_codegen_ssa%2Fsrc%2Ferrors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2678765d08df633b4804d1ba03e090c3bed878bb/compiler%2Frustc_codegen_ssa%2Fsrc%2Ferrors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Ferrors.rs?ref=2678765d08df633b4804d1ba03e090c3bed878bb", "patch": "@@ -532,3 +532,16 @@ impl IntoDiagnostic<'_, !> for ExtractBundledLibsError<'_> {\n         diag\n     }\n }\n+\n+#[derive(Diagnostic)]\n+#[diag(codegen_ssa_unsupported_arch)]\n+pub struct UnsupportedArch<'a> {\n+    pub arch: &'a str,\n+    pub os: &'a str,\n+}\n+\n+#[derive(Diagnostic)]\n+pub enum AppleSdkRootError<'a> {\n+    #[diag(codegen_ssa_apple_sdk_error_sdk_path)]\n+    SdkPath { sdk_name: &'a str, error: Error },\n+}"}, {"sha": "ad0d758210175fb096eefe07f0929da10767fae6", "filename": "compiler/rustc_error_messages/locales/en-US/codegen_ssa.ftl", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2678765d08df633b4804d1ba03e090c3bed878bb/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fcodegen_ssa.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/2678765d08df633b4804d1ba03e090c3bed878bb/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fcodegen_ssa.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Fcodegen_ssa.ftl?ref=2678765d08df633b4804d1ba03e090c3bed878bb", "patch": "@@ -178,3 +178,7 @@ codegen_ssa_extract_bundled_libs_read_entry = failed to read entry '{$rlib}': {$\n codegen_ssa_extract_bundled_libs_archive_member = failed to get data from archive member '{$rlib}': {$error}\n codegen_ssa_extract_bundled_libs_convert_name = failed to convert name '{$rlib}': {$error}\n codegen_ssa_extract_bundled_libs_write_file = failed to write file '{$rlib}': {$error}\n+\n+codegen_ssa_unsupported_arch = unsupported arch `{$arch}` for os `{$os}`\n+\n+codegen_ssa_apple_sdk_error_sdk_path = failed to get {$sdk_name} SDK path: {error}"}]}