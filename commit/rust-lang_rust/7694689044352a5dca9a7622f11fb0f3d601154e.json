{"sha": "7694689044352a5dca9a7622f11fb0f3d601154e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc2OTQ2ODkwNDQzNTJhNWRjYTlhNzYyMmYxMWZiMGYzZDYwMTE1NGU=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-12-15T19:33:57Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2011-12-15T19:33:57Z"}, "message": "Fix bug in library output filename construction: /tmp/foo.rc was being linked as lib/tmp/foo-<hash>-<vers>.so not /tmp/foo-<hash>-<vers>.so", "tree": {"sha": "e9bcbf807133cdd2bd7cd8e4593fccd3758c87b2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e9bcbf807133cdd2bd7cd8e4593fccd3758c87b2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7694689044352a5dca9a7622f11fb0f3d601154e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7694689044352a5dca9a7622f11fb0f3d601154e", "html_url": "https://github.com/rust-lang/rust/commit/7694689044352a5dca9a7622f11fb0f3d601154e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7694689044352a5dca9a7622f11fb0f3d601154e/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1753607f6afdeb6e5e4fde37a449ca9bfd7ab33e", "url": "https://api.github.com/repos/rust-lang/rust/commits/1753607f6afdeb6e5e4fde37a449ca9bfd7ab33e", "html_url": "https://github.com/rust-lang/rust/commit/1753607f6afdeb6e5e4fde37a449ca9bfd7ab33e"}], "stats": {"total": 12, "additions": 11, "deletions": 1}, "files": [{"sha": "9afcc23376a50411b222fae02f7506c69629c5e3", "filename": "src/comp/back/link.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/7694689044352a5dca9a7622f11fb0f3d601154e/src%2Fcomp%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7694689044352a5dca9a7622f11fb0f3d601154e/src%2Fcomp%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fback%2Flink.rs?ref=7694689044352a5dca9a7622f11fb0f3d601154e", "patch": "@@ -588,9 +588,16 @@ fn link_binary(sess: session::session,\n         let long_libname =\n             std::os::dylib_filename(#fmt(\"%s-%s-%s\",\n                                          lm.name, lm.extras_hash, lm.vers));\n+        log \"link_meta.name: \" + lm.name;\n+        log \"long_libname: \" + long_libname;\n+        log \"out_filename: \" + out_filename;\n+        log \"dirname(out_filename): \" + fs::dirname(out_filename);\n+\n         fs::connect(fs::dirname(out_filename), long_libname)\n     } else { out_filename };\n \n+    log \"output: \" + output;\n+\n     // The default library location, we need this to find the runtime.\n     // The location of crates will be determined as needed.\n     let stage: str = \"-L\" + sess.filesearch().get_target_lib_path();"}, {"sha": "1d27600b4d9458ada379af6ce4694aa40a207ee8", "filename": "src/comp/driver/rustc.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7694689044352a5dca9a7622f11fb0f3d601154e/src%2Fcomp%2Fdriver%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7694689044352a5dca9a7622f11fb0f3d601154e/src%2Fcomp%2Fdriver%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fdriver%2Frustc.rs?ref=7694689044352a5dca9a7622f11fb0f3d601154e", "patch": "@@ -561,7 +561,10 @@ fn build_output_filenames(ifile: str, ofile: option::t<str>,\n         obj_filename = base_filename + \".\" + suffix;\n \n         if sess.building_library() {\n-            saved_out_filename = std::os::dylib_filename(base_filename);\n+            let dirname = fs::dirname(base_filename);\n+            let basename = fs::basename(base_filename);\n+            let dylibname = std::os::dylib_filename(basename);\n+            saved_out_filename = fs::connect(dirname, dylibname);\n         } else {\n             saved_out_filename = base_filename;\n         }"}]}