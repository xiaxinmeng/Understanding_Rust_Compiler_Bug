{"sha": "87d24e1fc998269d530e0fd88ba1c89d2171fb55", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg3ZDI0ZTFmYzk5ODI2OWQ1MzBlMGZkODhiYTFjODlkMjE3MWZiNTU=", "commit": {"author": {"name": "daxpedda", "email": "daxpedda@users.noreply.github.com", "date": "2019-01-21T12:59:49Z"}, "committer": {"name": "daxpedda", "email": "daxpedda@users.noreply.github.com", "date": "2019-01-21T12:59:49Z"}, "message": "Actually check for constants.", "tree": {"sha": "373309def8b49325d9a5cf7447ba518fdb1350a1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/373309def8b49325d9a5cf7447ba518fdb1350a1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/87d24e1fc998269d530e0fd88ba1c89d2171fb55", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJWBAABCABAFiEEtfVYniVMfR+YKQUSxyLctqGR7qsFAlxFwkUiHGRheHBlZGRh\nQHVzZXJzLm5vcmVwbHkuZ2l0aHViLmNvbQAKCRDHIty2oZHuqw1vEACB6LxDKMWW\nYbzY7eH2xq9K2A3tsgLqvGNRFBL4y1M5nNjGaZwt1C/L+aj5nxbm81ugIfKrWGVu\nfbG/Ce/HymUS4GwZBNq8TqC1imBhmhOEOMJ/tnvLlu4a3yOy+rnPkR2+1nQGrcR8\nDxM/c+Qc0sfpTB1Qg1h8Kll7oFJw/AQ9v0T72DyrKmvWgmy6a1Ogoh98veYejLn1\nUW4yTZtnxbGdiIYiKbtaxYUsMlcswmDFttdsFm5qjWOxtkYH7fGjNtXUZZOFXRbb\nQ6To/8E7PwWi0QysvXibBk0ZOrumzJTyiYyoR/q73W1XoPVS/46BZTTOzPXbw+Po\nNwilV9+90klMhIyG50w5I/9cIioAEiKEqjsZIf6UesE97tw4Q+iEtJ8IE5xvqdKR\nDJFvne/YdiAhbZoJtx1keiKlABL4aoezfJQ8d5CLZiMSHZeOhBsSaalgXjW2B4am\nKUwuQ6EuanmPVxvVxbQjTN66BdCO/R3BX44dBjgeaGDuNrWErVtshMvpDbDfS6TO\nzF/y27sBiAmDUo8q69W0VikYVfHmAtMxB6N6vZy/MLZE/lWaF1WsLNYuv9sDUE7a\nbS9M1uAb+TeTqf2cfMoN9l58qHvTPD7L/EZmKmOg7YZVI4urc7SRc2zeQJgr4pyT\n+GukO8NEaELBOjyjo4GLSDTTS5cJMmdzTg==\n=p/96\n-----END PGP SIGNATURE-----", "payload": "tree 373309def8b49325d9a5cf7447ba518fdb1350a1\nparent 0555ca1c2d98e74d748922c5a60d42174dab9675\nauthor daxpedda <daxpedda@users.noreply.github.com> 1548075589 +0100\ncommitter daxpedda <daxpedda@users.noreply.github.com> 1548075589 +0100\n\nActually check for constants.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/87d24e1fc998269d530e0fd88ba1c89d2171fb55", "html_url": "https://github.com/rust-lang/rust/commit/87d24e1fc998269d530e0fd88ba1c89d2171fb55", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/87d24e1fc998269d530e0fd88ba1c89d2171fb55/comments", "author": {"login": "daxpedda", "id": 1645124, "node_id": "MDQ6VXNlcjE2NDUxMjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1645124?v=4", "gravatar_id": "", "url": "https://api.github.com/users/daxpedda", "html_url": "https://github.com/daxpedda", "followers_url": "https://api.github.com/users/daxpedda/followers", "following_url": "https://api.github.com/users/daxpedda/following{/other_user}", "gists_url": "https://api.github.com/users/daxpedda/gists{/gist_id}", "starred_url": "https://api.github.com/users/daxpedda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/daxpedda/subscriptions", "organizations_url": "https://api.github.com/users/daxpedda/orgs", "repos_url": "https://api.github.com/users/daxpedda/repos", "events_url": "https://api.github.com/users/daxpedda/events{/privacy}", "received_events_url": "https://api.github.com/users/daxpedda/received_events", "type": "User", "site_admin": false}, "committer": {"login": "daxpedda", "id": 1645124, "node_id": "MDQ6VXNlcjE2NDUxMjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1645124?v=4", "gravatar_id": "", "url": "https://api.github.com/users/daxpedda", "html_url": "https://github.com/daxpedda", "followers_url": "https://api.github.com/users/daxpedda/followers", "following_url": "https://api.github.com/users/daxpedda/following{/other_user}", "gists_url": "https://api.github.com/users/daxpedda/gists{/gist_id}", "starred_url": "https://api.github.com/users/daxpedda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/daxpedda/subscriptions", "organizations_url": "https://api.github.com/users/daxpedda/orgs", "repos_url": "https://api.github.com/users/daxpedda/repos", "events_url": "https://api.github.com/users/daxpedda/events{/privacy}", "received_events_url": "https://api.github.com/users/daxpedda/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0555ca1c2d98e74d748922c5a60d42174dab9675", "url": "https://api.github.com/repos/rust-lang/rust/commits/0555ca1c2d98e74d748922c5a60d42174dab9675", "html_url": "https://github.com/rust-lang/rust/commit/0555ca1c2d98e74d748922c5a60d42174dab9675"}], "stats": {"total": 35, "additions": 26, "deletions": 9}, "files": [{"sha": "473db1869ac01090b7b46c29d357a1417b200fe1", "filename": "clippy_lints/src/arithmetic.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/87d24e1fc998269d530e0fd88ba1c89d2171fb55/clippy_lints%2Fsrc%2Farithmetic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87d24e1fc998269d530e0fd88ba1c89d2171fb55/clippy_lints%2Fsrc%2Farithmetic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Farithmetic.rs?ref=87d24e1fc998269d530e0fd88ba1c89d2171fb55", "patch": "@@ -1,3 +1,4 @@\n+use crate::consts::constant_simple;\n use crate::utils::span_lint;\n use rustc::hir;\n use rustc::lint::{LateContext, LateLintPass, LintArray, LintPass};\n@@ -92,7 +93,13 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Arithmetic {\n                 }\n             },\n             hir::ExprKind::Unary(hir::UnOp::UnNeg, arg) => {\n-                if cx.tables.expr_ty(arg).is_floating_point() {\n+                let ty = cx.tables.expr_ty(arg);\n+                if ty.is_integral() {\n+                    if constant_simple(cx, cx.tables, expr).is_none() {\n+                        span_lint(cx, INTEGER_ARITHMETIC, expr.span, \"integer arithmetic detected\");\n+                        self.expr_span = Some(expr.span);\n+                    }\n+                } else if ty.is_floating_point() {\n                     span_lint(cx, FLOAT_ARITHMETIC, expr.span, \"floating-point arithmetic detected\");\n                     self.expr_span = Some(expr.span);\n                 }"}, {"sha": "c3cea99760683ccef2b4687eb2923c3e3a5c1004", "filename": "tests/ui/arithmetic.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/87d24e1fc998269d530e0fd88ba1c89d2171fb55/tests%2Fui%2Farithmetic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87d24e1fc998269d530e0fd88ba1c89d2171fb55/tests%2Fui%2Farithmetic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Farithmetic.rs?ref=87d24e1fc998269d530e0fd88ba1c89d2171fb55", "patch": "@@ -15,7 +15,11 @@ fn main() {\n     1 %\n     i / 2; // no error, this is part of the expression in the preceding line\n     i - 2 + 2 - i;\n-    -i; // no error, overflows are checked by `overflowing_literals`\n+    -i;\n+\n+    // no error, overflows are checked by `overflowing_literals`\n+    -1;\n+    -(-1);\n \n     i & 1; // no wrapping\n     i | 1;"}, {"sha": "b21efaa849f79e0f78d2c1018cee2182a8bb54b0", "filename": "tests/ui/arithmetic.stderr", "status": "modified", "additions": 13, "deletions": 7, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/87d24e1fc998269d530e0fd88ba1c89d2171fb55/tests%2Fui%2Farithmetic.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/87d24e1fc998269d530e0fd88ba1c89d2171fb55/tests%2Fui%2Farithmetic.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Farithmetic.stderr?ref=87d24e1fc998269d530e0fd88ba1c89d2171fb55", "patch": "@@ -25,43 +25,49 @@ error: integer arithmetic detected\n LL |     i - 2 + 2 - i;\n    |     ^^^^^^^^^^^^^\n \n+error: integer arithmetic detected\n+  --> $DIR/arithmetic.rs:18:5\n+   |\n+LL |     -i;\n+   |     ^^\n+\n error: floating-point arithmetic detected\n-  --> $DIR/arithmetic.rs:28:5\n+  --> $DIR/arithmetic.rs:32:5\n    |\n LL |     f * 2.0;\n    |     ^^^^^^^\n    |\n    = note: `-D clippy::float-arithmetic` implied by `-D warnings`\n \n error: floating-point arithmetic detected\n-  --> $DIR/arithmetic.rs:30:5\n+  --> $DIR/arithmetic.rs:34:5\n    |\n LL |     1.0 + f;\n    |     ^^^^^^^\n \n error: floating-point arithmetic detected\n-  --> $DIR/arithmetic.rs:31:5\n+  --> $DIR/arithmetic.rs:35:5\n    |\n LL |     f * 2.0;\n    |     ^^^^^^^\n \n error: floating-point arithmetic detected\n-  --> $DIR/arithmetic.rs:32:5\n+  --> $DIR/arithmetic.rs:36:5\n    |\n LL |     f / 2.0;\n    |     ^^^^^^^\n \n error: floating-point arithmetic detected\n-  --> $DIR/arithmetic.rs:33:5\n+  --> $DIR/arithmetic.rs:37:5\n    |\n LL |     f - 2.0 * 4.2;\n    |     ^^^^^^^^^^^^^\n \n error: floating-point arithmetic detected\n-  --> $DIR/arithmetic.rs:34:5\n+  --> $DIR/arithmetic.rs:38:5\n    |\n LL |     -f;\n    |     ^^\n \n-error: aborting due to 10 previous errors\n+error: aborting due to 11 previous errors\n "}]}