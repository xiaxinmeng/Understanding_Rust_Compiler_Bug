{"sha": "8df7c2b0d45e1f69ead3bca145f32ca1a399513d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhkZjdjMmIwZDQ1ZTFmNjllYWQzYmNhMTQ1ZjMyY2ExYTM5OTUxM2Q=", "commit": {"author": {"name": "Jesse Ruderman", "email": "jruderman@gmail.com", "date": "2011-09-10T21:51:33Z"}, "committer": {"name": "Jesse Ruderman", "email": "jruderman@gmail.com", "date": "2011-09-10T21:51:33Z"}, "message": "Fuzzer: first steps of making steal_exprs more generic", "tree": {"sha": "1159daeccac25c17a2dc582165f083cb54a108e2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1159daeccac25c17a2dc582165f083cb54a108e2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8df7c2b0d45e1f69ead3bca145f32ca1a399513d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8df7c2b0d45e1f69ead3bca145f32ca1a399513d", "html_url": "https://github.com/rust-lang/rust/commit/8df7c2b0d45e1f69ead3bca145f32ca1a399513d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8df7c2b0d45e1f69ead3bca145f32ca1a399513d/comments", "author": {"login": "jruderman", "id": 692547, "node_id": "MDQ6VXNlcjY5MjU0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/692547?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jruderman", "html_url": "https://github.com/jruderman", "followers_url": "https://api.github.com/users/jruderman/followers", "following_url": "https://api.github.com/users/jruderman/following{/other_user}", "gists_url": "https://api.github.com/users/jruderman/gists{/gist_id}", "starred_url": "https://api.github.com/users/jruderman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jruderman/subscriptions", "organizations_url": "https://api.github.com/users/jruderman/orgs", "repos_url": "https://api.github.com/users/jruderman/repos", "events_url": "https://api.github.com/users/jruderman/events{/privacy}", "received_events_url": "https://api.github.com/users/jruderman/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jruderman", "id": 692547, "node_id": "MDQ6VXNlcjY5MjU0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/692547?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jruderman", "html_url": "https://github.com/jruderman", "followers_url": "https://api.github.com/users/jruderman/followers", "following_url": "https://api.github.com/users/jruderman/following{/other_user}", "gists_url": "https://api.github.com/users/jruderman/gists{/gist_id}", "starred_url": "https://api.github.com/users/jruderman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jruderman/subscriptions", "organizations_url": "https://api.github.com/users/jruderman/orgs", "repos_url": "https://api.github.com/users/jruderman/repos", "events_url": "https://api.github.com/users/jruderman/events{/privacy}", "received_events_url": "https://api.github.com/users/jruderman/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cdf30c2b291ab39cea00f7a60cf290fb4e1d961f", "url": "https://api.github.com/repos/rust-lang/rust/commits/cdf30c2b291ab39cea00f7a60cf290fb4e1d961f", "html_url": "https://github.com/rust-lang/rust/commit/cdf30c2b291ab39cea00f7a60cf290fb4e1d961f"}], "stats": {"total": 24, "additions": 13, "deletions": 11}, "files": [{"sha": "be21777b1e48a529c49874f0fab5a4ac9e550f22", "filename": "src/fuzzer/fuzzer.rs", "status": "modified", "additions": 13, "deletions": 11, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/8df7c2b0d45e1f69ead3bca145f32ca1a399513d/src%2Ffuzzer%2Ffuzzer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8df7c2b0d45e1f69ead3bca145f32ca1a399513d/src%2Ffuzzer%2Ffuzzer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ffuzzer%2Ffuzzer.rs?ref=8df7c2b0d45e1f69ead3bca145f32ca1a399513d", "patch": "@@ -48,8 +48,8 @@ fn find_rust_files(files: &mutable [str], path: &str) {\n     }\n }\n \n-fn safe_to_steal(e: ast::expr_) -> bool {\n-    alt e {\n+fn safe_to_steal_expr(e: &@ast::expr) -> bool {\n+    alt e.node {\n \n       // https://github.com/graydon/rust/issues/890\n       ast::expr_lit(lit) {\n@@ -89,17 +89,19 @@ fn safe_to_steal(e: ast::expr_) -> bool {\n     }\n }\n \n+// Not type-parameterized: https://github.com/graydon/rust/issues/898\n+fn stash_expr_if(c: fn(&@ast::expr)->bool, es: @mutable [ast::expr], e: &@ast::expr) {\n+    if c(e) {\n+        *es += [*e];\n+    } else {/* now my indices are wrong :( */ }\n+}\n+\n fn steal_exprs(crate: &ast::crate) -> [ast::expr] {\n     let exprs: @mutable [ast::expr] = @mutable [];\n-    // \"Stash\" is not type-parameterized because of the need for safe_to_steal\n-    fn stash_expr(es: @mutable [ast::expr], e: &@ast::expr) {\n-        if safe_to_steal(e.node) {\n-            *es += [*e];\n-        } else {/* now my indices are wrong :( */ }\n-    }\n-    let v =\n-        visit::mk_simple_visitor(@{visit_expr: bind stash_expr(exprs, _)\n-                                      with *visit::default_simple_visitor()});\n+    let v = visit::mk_simple_visitor(@{\n+        visit_expr: bind stash_expr_if(safe_to_steal_expr, exprs, _)\n+        with *visit::default_simple_visitor()\n+    });\n     visit::visit_crate(crate, (), v);;\n     *exprs\n }"}]}