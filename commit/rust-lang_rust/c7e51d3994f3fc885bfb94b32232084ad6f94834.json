{"sha": "c7e51d3994f3fc885bfb94b32232084ad6f94834", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM3ZTUxZDM5OTRmM2ZjODg1YmZiOTRiMzIyMzIwODRhZDZmOTQ4MzQ=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2016-03-28T23:37:43Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2016-03-28T23:37:43Z"}, "message": "minor: use enum instead of pair of booleans\n\nThis is a bit more typing, but statically forbids using both verbose and\nquiet", "tree": {"sha": "61d1eaf388b909cfbd8869f7d910245673fb8e8d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/61d1eaf388b909cfbd8869f7d910245673fb8e8d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c7e51d3994f3fc885bfb94b32232084ad6f94834", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c7e51d3994f3fc885bfb94b32232084ad6f94834", "html_url": "https://github.com/rust-lang/rust/commit/c7e51d3994f3fc885bfb94b32232084ad6f94834", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c7e51d3994f3fc885bfb94b32232084ad6f94834/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ac7778cc51774a96d89f1a9244d41558d7698429", "url": "https://api.github.com/repos/rust-lang/rust/commits/ac7778cc51774a96d89f1a9244d41558d7698429", "html_url": "https://github.com/rust-lang/rust/commit/ac7778cc51774a96d89f1a9244d41558d7698429"}], "stats": {"total": 37, "additions": 23, "deletions": 14}, "files": [{"sha": "c033851f98abf8af0e5d906103987b6cf18d123e", "filename": "src/bin/cargo-fmt.rs", "status": "modified", "additions": 23, "deletions": 14, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/c7e51d3994f3fc885bfb94b32232084ad6f94834/src%2Fbin%2Fcargo-fmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7e51d3994f3fc885bfb94b32232084ad6f94834/src%2Fbin%2Fcargo-fmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbin%2Fcargo-fmt.rs?ref=c7e51d3994f3fc885bfb94b32232084ad6f94834", "patch": "@@ -49,19 +49,22 @@ fn execute() -> i32 {\n         }\n     };\n \n-    let (verbose, quiet) = (matches.opt_present(\"v\"), matches.opt_present(\"q\"));\n-\n-    if verbose && quiet {\n-        print_usage(&opts, \"quiet mode and verbose mode are not compatible\");\n-        return failure;\n-    }\n+    let verbosity = match (matches.opt_present(\"v\"), matches.opt_present(\"q\")) {\n+        (false, false) => Verbosity::Normal,\n+        (false, true) => Verbosity::Quiet,\n+        (true, false) => Verbosity::Verbose,\n+        (true, true) => {\n+            print_usage(&opts, \"quiet mode and verbose mode are not compatible\");\n+            return failure;\n+        }\n+    };\n \n     if matches.opt_present(\"h\") {\n         print_usage(&opts, \"\");\n         return success;\n     }\n \n-    match format_crate(verbose, quiet) {\n+    match format_crate(verbosity) {\n         Err(e) => {\n             print_usage(&opts, &e.to_string());\n             failure\n@@ -83,21 +86,28 @@ fn print_usage(opts: &Options, reason: &str) {\n              opts.usage(&msg));\n }\n \n-fn format_crate(verbose: bool, quiet: bool) -> Result<ExitStatus, std::io::Error> {\n+#[derive(Debug, Clone, Copy, PartialEq)]\n+pub enum Verbosity {\n+    Verbose,\n+    Normal,\n+    Quiet,\n+}\n+\n+fn format_crate(verbosity: Verbosity) -> Result<ExitStatus, std::io::Error> {\n     let targets = try!(get_targets());\n \n     // Currently only bin and lib files get formatted\n     let files: Vec<_> = targets.into_iter()\n                                .filter(|t| t.kind.is_lib() | t.kind.is_bin())\n                                .inspect(|t| {\n-                                   if verbose {\n+                                   if verbosity == Verbosity::Verbose {\n                                        println!(\"[{:?}] {:?}\", t.kind, t.path)\n                                    }\n                                })\n                                .map(|t| t.path)\n                                .collect();\n \n-    format_files(&files, &get_fmt_args(), verbose, quiet)\n+    format_files(&files, &get_fmt_args(), verbosity)\n }\n \n fn get_fmt_args() -> Vec<String> {\n@@ -173,15 +183,14 @@ fn target_from_json(jtarget: &Json) -> Target {\n \n fn format_files(files: &Vec<PathBuf>,\n                 fmt_args: &Vec<String>,\n-                verbose: bool,\n-                quiet: bool)\n+                verbosity: Verbosity)\n                 -> Result<ExitStatus, std::io::Error> {\n-    let stdout = if quiet {\n+    let stdout = if verbosity == Verbosity::Quiet {\n         std::process::Stdio::null()\n     } else {\n         std::process::Stdio::inherit()\n     };\n-    if verbose {\n+    if verbosity == Verbosity::Verbose {\n         print!(\"rustfmt\");\n         for a in fmt_args.iter() {\n             print!(\" {}\", a);"}]}