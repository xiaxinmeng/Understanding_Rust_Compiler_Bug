{"sha": "26015da01497b4014fc4f2ecedee5a7090c354e6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI2MDE1ZGEwMTQ5N2I0MDE0ZmM0ZjJlY2VkZWU1YTcwOTBjMzU0ZTY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-09-23T19:16:11Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-09-23T19:16:11Z"}, "message": "Auto merge of #44765 - tamird:libc-shim, r=alexcrichton\n\nTrim and document libc shim\n\n(hopefully) easy part of #44515.\n\nr? @alexcrichton", "tree": {"sha": "d6a456fb9e2ae01f754a9743e6b9c773e0b2545f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d6a456fb9e2ae01f754a9743e6b9c773e0b2545f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/26015da01497b4014fc4f2ecedee5a7090c354e6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/26015da01497b4014fc4f2ecedee5a7090c354e6", "html_url": "https://github.com/rust-lang/rust/commit/26015da01497b4014fc4f2ecedee5a7090c354e6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/26015da01497b4014fc4f2ecedee5a7090c354e6/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a83c3e777145bd2fd127857b3b73d5a174e1f2dd", "url": "https://api.github.com/repos/rust-lang/rust/commits/a83c3e777145bd2fd127857b3b73d5a174e1f2dd", "html_url": "https://github.com/rust-lang/rust/commit/a83c3e777145bd2fd127857b3b73d5a174e1f2dd"}, {"sha": "5c82a5434b8370a9ed119577b0cf1afb995d6a17", "url": "https://api.github.com/repos/rust-lang/rust/commits/5c82a5434b8370a9ed119577b0cf1afb995d6a17", "html_url": "https://github.com/rust-lang/rust/commit/5c82a5434b8370a9ed119577b0cf1afb995d6a17"}], "stats": {"total": 52, "additions": 24, "deletions": 28}, "files": [{"sha": "136bf195dfa546a3589f414c1dfe693aa6ff1018", "filename": "src/liblibc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliblibc?ref=26015da01497b4014fc4f2ecedee5a7090c354e6", "patch": "@@ -1 +1 @@\n-Subproject commit 95848f9622deccc9cbadcd5d3a4faef01a90ead4\n+Subproject commit 136bf195dfa546a3589f414c1dfe693aa6ff1018"}, {"sha": "0c04402124a2de290c13d4c2f3b47c9083da6ea7", "filename": "src/rustc/libc_shim/Cargo.toml", "status": "modified", "additions": 23, "deletions": 9, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/26015da01497b4014fc4f2ecedee5a7090c354e6/src%2Frustc%2Flibc_shim%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/26015da01497b4014fc4f2ecedee5a7090c354e6/src%2Frustc%2Flibc_shim%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Flibc_shim%2FCargo.toml?ref=26015da01497b4014fc4f2ecedee5a7090c354e6", "patch": "@@ -1,16 +1,7 @@\n-# This is a shim Cargo.toml over the \"real Cargo.toml\" found in the libc\n-# repository itself. The purpose for this is to add a build script which prints\n-# out `--cfg stdbuild` to mirror the makefiles' build system.\n-#\n-# Note that other than that this isn't actually needed, and we should probably\n-# remove this shim in favor of just working with cargo features directly with\n-# libc. That should make everything nicer!\n-\n [package]\n name = \"libc\"\n version = \"0.0.0\"\n authors = [\"The Rust Project Developers\"]\n-build = \"build.rs\"\n \n [lib]\n name = \"libc\"\n@@ -20,4 +11,27 @@ bench = false\n doc = false\n \n [dependencies]\n+# Specify the path to libcore; at the time of writing, removing this shim in\n+# favor of using libc from git results in a compilation failure:\n+#\n+# Building stage0 std artifacts (x86_64-apple-darwin -> x86_64-apple-darwin)\n+#    Compiling libc v0.0.0 (file:///Users/tamird/src/rust/src/rustc/libc_shim)\n+# error[E0463]: can't find crate for `core`\n+#\n+# error: aborting due to previous error\n+#\n+# error: Could not compile `libc`.\n+#\n+# Caused by:\n+#   process didn't exit successfully: `/Users/tamird/src/rust/build/bootstrap/debug/rustc --crate-name libc src/rustc/libc_shim/../../liblibc/src/lib.rs --error-format json --crate-type lib --emit=dep-info,link -C opt-level=2 --cfg feature=\"default\" --cfg feature=\"no_std\" --cfg feature=\"stdbuild\" -C metadata=d758f87058112d7d -C extra-filename=-d758f87058112d7d --out-dir /Users/tamird/src/rust/build/x86_64-apple-darwin/stage0-std/x86_64-apple-darwin/release/deps --target x86_64-apple-darwin -L dependency=/Users/tamird/src/rust/build/x86_64-apple-darwin/stage0-std/x86_64-apple-darwin/release/deps -L dependency=/Users/tamird/src/rust/build/x86_64-apple-darwin/stage0-std/release/deps` (exit code: 101)\n+# thread 'main' panicked at 'command did not execute successfully: \"/Users/tamird/src/rust/build/x86_64-apple-darwin/stage0/bin/cargo\" \"build\" \"-j\" \"4\" \"--target\" \"x86_64-apple-darwin\" \"--release\" \"--features\" \"panic-unwind jemalloc backtrace\" \"--manifest-path\" \"/Users/tamird/src/rust/src/libstd/Cargo.toml\" \"--message-format\" \"json\"\n+# expected success, got: exit code: 101', src/bootstrap/compile.rs:883:8\n+#\n+# See https://github.com/rust-lang/rfcs/pull/1133.\n core = { path = \"../../libcore\" }\n+\n+[features]\n+# Certain parts of libc are conditionally compiled differently than when used\n+# outside rustc. See https://github.com/rust-lang/libc/search?l=Rust&q=stdbuild&type=&utf8=%E2%9C%93.\n+stdbuild = []\n+default = [\"stdbuild\"]"}, {"sha": "546f60482e7bcd21561227ecff7ed2b496baf2af", "filename": "src/rustc/libc_shim/build.rs", "status": "removed", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/a83c3e777145bd2fd127857b3b73d5a174e1f2dd/src%2Frustc%2Flibc_shim%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a83c3e777145bd2fd127857b3b73d5a174e1f2dd/src%2Frustc%2Flibc_shim%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2Flibc_shim%2Fbuild.rs?ref=a83c3e777145bd2fd127857b3b73d5a174e1f2dd", "patch": "@@ -1,18 +0,0 @@\n-// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\n-#![deny(warnings)]\n-\n-// See comments in Cargo.toml for why this exists\n-\n-fn main() {\n-    println!(\"cargo:rustc-cfg=stdbuild\");\n-    println!(\"cargo:rerun-if-changed=build.rs\");\n-}"}]}