{"sha": "7b4c397b73912d3c604667933fb7e64f0c1a366a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdiNGMzOTdiNzM5MTJkM2M2MDQ2Njc5MzNmYjdlNjRmMGMxYTM2NmE=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-10-23T09:00:18Z"}, "committer": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-10-25T02:19:49Z"}, "message": "Do not try to report on closures to avoid ICE", "tree": {"sha": "519da53203dc74b3c44156358a033dcd2e766f95", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/519da53203dc74b3c44156358a033dcd2e766f95"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7b4c397b73912d3c604667933fb7e64f0c1a366a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7b4c397b73912d3c604667933fb7e64f0c1a366a", "html_url": "https://github.com/rust-lang/rust/commit/7b4c397b73912d3c604667933fb7e64f0c1a366a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7b4c397b73912d3c604667933fb7e64f0c1a366a/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f58ffc93815f76576eb56df4bdeec2fe8f12b766", "url": "https://api.github.com/repos/rust-lang/rust/commits/f58ffc93815f76576eb56df4bdeec2fe8f12b766", "html_url": "https://github.com/rust-lang/rust/commit/f58ffc93815f76576eb56df4bdeec2fe8f12b766"}], "stats": {"total": 35, "additions": 35, "deletions": 0}, "files": [{"sha": "e9d5ebad7de03b4aedc103d8d425dd45936d2833", "filename": "compiler/rustc_infer/src/infer/error_reporting/nice_region_error/static_impl_trait.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/7b4c397b73912d3c604667933fb7e64f0c1a366a/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fstatic_impl_trait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b4c397b73912d3c604667933fb7e64f0c1a366a/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fstatic_impl_trait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fstatic_impl_trait.rs?ref=7b4c397b73912d3c604667933fb7e64f0c1a366a", "patch": "@@ -39,6 +39,14 @@ impl<'a, 'tcx> NiceRegionError<'a, 'tcx> {\n             ) if **sub_r == RegionKind::ReStatic => {\n                 // This is for an implicit `'static` requirement coming from `impl dyn Trait {}`.\n                 if let ObligationCauseCode::UnifyReceiver(ctxt) = &cause.code {\n+                    // This may have a closure and it would cause ICE\n+                    // through `find_param_with_region` (#78262).\n+                    let anon_reg_sup = tcx.is_suitable_region(sup_r)?;\n+                    let fn_returns = tcx.return_type_impl_or_dyn_traits(anon_reg_sup.def_id);\n+                    if fn_returns.is_empty() {\n+                        return None;\n+                    }\n+\n                     let param = self.find_param_with_region(sup_r, sub_r)?;\n                     let lifetime = if sup_r.has_name() {\n                         format!(\"lifetime `{}`\", sup_r)"}, {"sha": "2324152d2c0811ee17c0d7f895a5791fede4ca07", "filename": "src/test/ui/regions/issue-78262.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/7b4c397b73912d3c604667933fb7e64f0c1a366a/src%2Ftest%2Fui%2Fregions%2Fissue-78262.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b4c397b73912d3c604667933fb7e64f0c1a366a/src%2Ftest%2Fui%2Fregions%2Fissue-78262.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fregions%2Fissue-78262.rs?ref=7b4c397b73912d3c604667933fb7e64f0c1a366a", "patch": "@@ -0,0 +1,9 @@\n+trait TT {}\n+\n+impl dyn TT {\n+    fn func(&self) {}\n+}\n+\n+fn main() {\n+    let f = |x: &dyn TT| x.func(); //~ ERROR: mismatched types\n+}"}, {"sha": "580cea00ecd4f3b838c664c082f20f490bb0a53d", "filename": "src/test/ui/regions/issue-78262.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/7b4c397b73912d3c604667933fb7e64f0c1a366a/src%2Ftest%2Fui%2Fregions%2Fissue-78262.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7b4c397b73912d3c604667933fb7e64f0c1a366a/src%2Ftest%2Fui%2Fregions%2Fissue-78262.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fregions%2Fissue-78262.stderr?ref=7b4c397b73912d3c604667933fb7e64f0c1a366a", "patch": "@@ -0,0 +1,18 @@\n+error[E0308]: mismatched types\n+  --> $DIR/issue-78262.rs:8:28\n+   |\n+LL |     let f = |x: &dyn TT| x.func();\n+   |                            ^^^^ lifetime mismatch\n+   |\n+   = note: expected reference `&(dyn TT + 'static)`\n+              found reference `&dyn TT`\n+note: the anonymous lifetime #1 defined on the body at 8:13...\n+  --> $DIR/issue-78262.rs:8:13\n+   |\n+LL |     let f = |x: &dyn TT| x.func();\n+   |             ^^^^^^^^^^^^^^^^^^^^^\n+   = note: ...does not necessarily outlive the static lifetime\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}]}