{"sha": "26a4f461d7ddc7cae4ec7f524e21fc712657159e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI2YTRmNDYxZDdkZGM3Y2FlNGVjN2Y1MjRlMjFmYzcxMjY1NzE1OWU=", "commit": {"author": {"name": "Jack Huey", "email": "31162821+jackh726@users.noreply.github.com", "date": "2021-04-29T23:27:22Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-04-29T23:27:22Z"}, "message": "Rollup merge of #84682 - jackh726:transitive_bounds_rebind, r=nikomatsakis\n\nDon't rebind in `transitive_bounds_that_define_assoc_type`\n\nFixes #83737\nFixes #84604\n\nAlso fixes another issue that I don't have a test for, popped up in [zulip](https://rust-lang.zulipchat.com/#narrow/stream/144729-wg-traits/topic/Duplicate.20symbol.20error.20.2384604/near/236570445)\n\nr? `````@nikomatsakis`````", "tree": {"sha": "ba0134dba9e511365f729017ceb0524506d5efb3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ba0134dba9e511365f729017ceb0524506d5efb3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/26a4f461d7ddc7cae4ec7f524e21fc712657159e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgi0DaCRBK7hj4Ov3rIwAA4nQIAAfWlJPpisCCWstq/dklOvIP\n2Rgiay1l2mK18a72yrk8/iQMCaJrNomkaPztBJ8EMLEBwNGfquatTnTn9vDuULLK\ndHJl7r+iy+ouIR4AauiO7Vnalk5a19YL0vF5BgPisMGHpdMJo8RB0pWvPC4hOqks\nX4JuVCy6Vfog7Eq+ylUYSDM3eZm4OIJnCjEEi7nCcNOhyDFd6jOV/7XFH0nlXZBY\nxaL8rDcNFYMZv6tdfX9dGzpNzIbAllHqo13rAA80e2Vh7CX78k6852+GuBnGaoY+\ndumridkBCJWSkaGHIfUjGuVDTZgmcftVTuo6Dyka1A8m6Jfk5fYJxF5hWbUT/zE=\n=A+3k\n-----END PGP SIGNATURE-----\n", "payload": "tree ba0134dba9e511365f729017ceb0524506d5efb3\nparent e720df672dc88b2d6822582a644de977a889bcdb\nparent 5f82e22ba4c3a17b17fb81664e21d0baa68e3d87\nauthor Jack Huey <31162821+jackh726@users.noreply.github.com> 1619738842 -0400\ncommitter GitHub <noreply@github.com> 1619738842 -0400\n\nRollup merge of #84682 - jackh726:transitive_bounds_rebind, r=nikomatsakis\n\nDon't rebind in `transitive_bounds_that_define_assoc_type`\n\nFixes #83737\nFixes #84604\n\nAlso fixes another issue that I don't have a test for, popped up in [zulip](https://rust-lang.zulipchat.com/#narrow/stream/144729-wg-traits/topic/Duplicate.20symbol.20error.20.2384604/near/236570445)\n\nr? `````@nikomatsakis`````\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/26a4f461d7ddc7cae4ec7f524e21fc712657159e", "html_url": "https://github.com/rust-lang/rust/commit/26a4f461d7ddc7cae4ec7f524e21fc712657159e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/26a4f461d7ddc7cae4ec7f524e21fc712657159e/comments", "author": {"login": "jackh726", "id": 31162821, "node_id": "MDQ6VXNlcjMxMTYyODIx", "avatar_url": "https://avatars.githubusercontent.com/u/31162821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jackh726", "html_url": "https://github.com/jackh726", "followers_url": "https://api.github.com/users/jackh726/followers", "following_url": "https://api.github.com/users/jackh726/following{/other_user}", "gists_url": "https://api.github.com/users/jackh726/gists{/gist_id}", "starred_url": "https://api.github.com/users/jackh726/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jackh726/subscriptions", "organizations_url": "https://api.github.com/users/jackh726/orgs", "repos_url": "https://api.github.com/users/jackh726/repos", "events_url": "https://api.github.com/users/jackh726/events{/privacy}", "received_events_url": "https://api.github.com/users/jackh726/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e720df672dc88b2d6822582a644de977a889bcdb", "url": "https://api.github.com/repos/rust-lang/rust/commits/e720df672dc88b2d6822582a644de977a889bcdb", "html_url": "https://github.com/rust-lang/rust/commit/e720df672dc88b2d6822582a644de977a889bcdb"}, {"sha": "5f82e22ba4c3a17b17fb81664e21d0baa68e3d87", "url": "https://api.github.com/repos/rust-lang/rust/commits/5f82e22ba4c3a17b17fb81664e21d0baa68e3d87", "html_url": "https://github.com/rust-lang/rust/commit/5f82e22ba4c3a17b17fb81664e21d0baa68e3d87"}], "stats": {"total": 31, "additions": 28, "deletions": 3}, "files": [{"sha": "1cde4802a40b00e67a6beca539603033dca99f91", "filename": "compiler/rustc_infer/src/traits/util.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/26a4f461d7ddc7cae4ec7f524e21fc712657159e/compiler%2Frustc_infer%2Fsrc%2Ftraits%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/26a4f461d7ddc7cae4ec7f524e21fc712657159e/compiler%2Frustc_infer%2Fsrc%2Ftraits%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Ftraits%2Futil.rs?ref=26a4f461d7ddc7cae4ec7f524e21fc712657159e", "patch": "@@ -305,9 +305,7 @@ pub fn transitive_bounds_that_define_assoc_type<'tcx>(\n                     Some(assoc_name),\n                 ));\n                 for (super_predicate, _) in super_predicates.predicates {\n-                    let bound_predicate = super_predicate.kind();\n-                    let subst_predicate = super_predicate\n-                        .subst_supertrait(tcx, &bound_predicate.rebind(trait_ref.skip_binder()));\n+                    let subst_predicate = super_predicate.subst_supertrait(tcx, &trait_ref);\n                     if let Some(binder) = subst_predicate.to_opt_poly_trait_ref() {\n                         stack.push(binder.value);\n                     }"}, {"sha": "92288c89827447ef0f6158b9450da7822c127952", "filename": "compiler/rustc_middle/src/ty/flags.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/26a4f461d7ddc7cae4ec7f524e21fc712657159e/compiler%2Frustc_middle%2Fsrc%2Fty%2Fflags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/26a4f461d7ddc7cae4ec7f524e21fc712657159e/compiler%2Frustc_middle%2Fsrc%2Fty%2Fflags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fflags.rs?ref=26a4f461d7ddc7cae4ec7f524e21fc712657159e", "patch": "@@ -59,6 +59,10 @@ impl FlagComputation {\n     {\n         let mut computation = FlagComputation::new();\n \n+        if !value.bound_vars().is_empty() {\n+            computation.flags = computation.flags | TypeFlags::HAS_RE_LATE_BOUND;\n+        }\n+\n         f(&mut computation, value.skip_binder());\n \n         self.add_flags(computation.flags);"}, {"sha": "c496a3556c84e2b1647afd42d2b6250b6ceae2fc", "filename": "src/test/ui/lifetimes/issue-83737-erasing-bound-vars.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/26a4f461d7ddc7cae4ec7f524e21fc712657159e/src%2Ftest%2Fui%2Flifetimes%2Fissue-83737-erasing-bound-vars.rs", "raw_url": "https://github.com/rust-lang/rust/raw/26a4f461d7ddc7cae4ec7f524e21fc712657159e/src%2Ftest%2Fui%2Flifetimes%2Fissue-83737-erasing-bound-vars.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flifetimes%2Fissue-83737-erasing-bound-vars.rs?ref=26a4f461d7ddc7cae4ec7f524e21fc712657159e", "patch": "@@ -0,0 +1,14 @@\n+// build-pass\n+// compile-flags: --edition 2018\n+// compile-flags: --crate-type rlib\n+\n+use std::future::Future;\n+\n+async fn handle<F>(slf: &F)\n+where\n+    F: Fn(&()) -> Box<dyn for<'a> Future<Output = ()> + Unpin>,\n+{\n+    (slf)(&()).await;\n+}\n+\n+fn main() {}"}, {"sha": "df8368da0a09a0a1fcab45e6ffce638f487492cf", "filename": "src/test/ui/lifetimes/issue-84604.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/26a4f461d7ddc7cae4ec7f524e21fc712657159e/src%2Ftest%2Fui%2Flifetimes%2Fissue-84604.rs", "raw_url": "https://github.com/rust-lang/rust/raw/26a4f461d7ddc7cae4ec7f524e21fc712657159e/src%2Ftest%2Fui%2Flifetimes%2Fissue-84604.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flifetimes%2Fissue-84604.rs?ref=26a4f461d7ddc7cae4ec7f524e21fc712657159e", "patch": "@@ -0,0 +1,9 @@\n+// run-pass\n+// compile-flags: -Zsymbol-mangling-version=v0\n+\n+pub fn f<T: ?Sized>() {}\n+pub trait Frob<T: ?Sized> {}\n+fn main() {\n+    f::<dyn Frob<str>>();\n+    f::<dyn for<'a> Frob<str>>();\n+}"}]}