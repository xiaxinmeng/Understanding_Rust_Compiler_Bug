{"sha": "856541963ce95ef4f7d4a81784bb5002ccf63c93", "node_id": "C_kwDOAAsO6NoAKDg1NjU0MTk2M2NlOTVlZjRmN2Q0YTgxNzg0YmI1MDAyY2NmNjNjOTM", "commit": {"author": {"name": "est31", "email": "MTest31@outlook.com", "date": "2021-10-17T05:02:52Z"}, "committer": {"name": "est31", "email": "MTest31@outlook.com", "date": "2021-10-17T20:56:29Z"}, "message": "Nicer error message if the user attempts to do let...else if", "tree": {"sha": "cd032b60d8588dfbbe769a24512485310c062332", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cd032b60d8588dfbbe769a24512485310c062332"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/856541963ce95ef4f7d4a81784bb5002ccf63c93", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/856541963ce95ef4f7d4a81784bb5002ccf63c93", "html_url": "https://github.com/rust-lang/rust/commit/856541963ce95ef4f7d4a81784bb5002ccf63c93", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/856541963ce95ef4f7d4a81784bb5002ccf63c93/comments", "author": {"login": "est31", "id": 8872119, "node_id": "MDQ6VXNlcjg4NzIxMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8872119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/est31", "html_url": "https://github.com/est31", "followers_url": "https://api.github.com/users/est31/followers", "following_url": "https://api.github.com/users/est31/following{/other_user}", "gists_url": "https://api.github.com/users/est31/gists{/gist_id}", "starred_url": "https://api.github.com/users/est31/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/est31/subscriptions", "organizations_url": "https://api.github.com/users/est31/orgs", "repos_url": "https://api.github.com/users/est31/repos", "events_url": "https://api.github.com/users/est31/events{/privacy}", "received_events_url": "https://api.github.com/users/est31/received_events", "type": "User", "site_admin": false}, "committer": {"login": "est31", "id": 8872119, "node_id": "MDQ6VXNlcjg4NzIxMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8872119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/est31", "html_url": "https://github.com/est31", "followers_url": "https://api.github.com/users/est31/followers", "following_url": "https://api.github.com/users/est31/following{/other_user}", "gists_url": "https://api.github.com/users/est31/gists{/gist_id}", "starred_url": "https://api.github.com/users/est31/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/est31/subscriptions", "organizations_url": "https://api.github.com/users/est31/orgs", "repos_url": "https://api.github.com/users/est31/repos", "events_url": "https://api.github.com/users/est31/events{/privacy}", "received_events_url": "https://api.github.com/users/est31/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c1026539bd22e9d070988deaa47b1360cbc76436", "url": "https://api.github.com/repos/rust-lang/rust/commits/c1026539bd22e9d070988deaa47b1360cbc76436", "html_url": "https://github.com/rust-lang/rust/commit/c1026539bd22e9d070988deaa47b1360cbc76436"}], "stats": {"total": 49, "additions": 44, "deletions": 5}, "files": [{"sha": "356f4aa6d5f4e58ca473298a599499442fc17625", "filename": "compiler/rustc_parse/src/parser/stmt.rs", "status": "modified", "additions": 16, "deletions": 5, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/856541963ce95ef4f7d4a81784bb5002ccf63c93/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fstmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/856541963ce95ef4f7d4a81784bb5002ccf63c93/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fstmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fstmt.rs?ref=856541963ce95ef4f7d4a81784bb5002ccf63c93", "patch": "@@ -16,7 +16,7 @@ use rustc_ast::{\n };\n use rustc_ast::{Block, BlockCheckMode, Expr, ExprKind, Local, Stmt};\n use rustc_ast::{StmtKind, DUMMY_NODE_ID};\n-use rustc_errors::{Applicability, PResult};\n+use rustc_errors::{Applicability, DiagnosticBuilder, PResult};\n use rustc_span::source_map::{BytePos, Span};\n use rustc_span::symbol::{kw, sym};\n \n@@ -300,6 +300,12 @@ impl<'a> Parser<'a> {\n             None => LocalKind::Decl,\n             Some(init) => {\n                 if self.eat_keyword(kw::Else) {\n+                    if self.token.is_keyword(kw::If) {\n+                        // `let...else if`. Emit the same error that `parse_block()` would,\n+                        // but explicitly point out that this pattern is not allowed.\n+                        let msg = \"conditional `else if` is not supported for `let...else`\";\n+                        return Err(self.error_block_no_opening_brace_msg(msg));\n+                    }\n                     let els = self.parse_block()?;\n                     self.check_let_else_init_bool_expr(&init);\n                     self.check_let_else_init_trailing_brace(&init);\n@@ -392,10 +398,9 @@ impl<'a> Parser<'a> {\n         Ok(block)\n     }\n \n-    fn error_block_no_opening_brace<T>(&mut self) -> PResult<'a, T> {\n+    fn error_block_no_opening_brace_msg(&mut self, msg: &str) -> DiagnosticBuilder<'a> {\n         let sp = self.token.span;\n-        let tok = super::token_descr(&self.token);\n-        let mut e = self.struct_span_err(sp, &format!(\"expected `{{`, found {}\", tok));\n+        let mut e = self.struct_span_err(sp, msg);\n         let do_not_suggest_help = self.token.is_keyword(kw::In) || self.token == token::Colon;\n \n         // Check to see if the user has written something like\n@@ -435,7 +440,13 @@ impl<'a> Parser<'a> {\n             _ => {}\n         }\n         e.span_label(sp, \"expected `{`\");\n-        Err(e)\n+        e\n+    }\n+\n+    fn error_block_no_opening_brace<T>(&mut self) -> PResult<'a, T> {\n+        let tok = super::token_descr(&self.token);\n+        let msg = format!(\"expected `{{`, found {}\", tok);\n+        Err(self.error_block_no_opening_brace_msg(&msg))\n     }\n \n     /// Parses a block. Inner attributes are allowed."}, {"sha": "c3a17330d6e2fe117c8a81264c746f88b799ebb7", "filename": "src/test/ui/let-else/let-else-if.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/856541963ce95ef4f7d4a81784bb5002ccf63c93/src%2Ftest%2Fui%2Flet-else%2Flet-else-if.rs", "raw_url": "https://github.com/rust-lang/rust/raw/856541963ce95ef4f7d4a81784bb5002ccf63c93/src%2Ftest%2Fui%2Flet-else%2Flet-else-if.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flet-else%2Flet-else-if.rs?ref=856541963ce95ef4f7d4a81784bb5002ccf63c93", "patch": "@@ -0,0 +1,10 @@\n+#![feature(let_else)]\n+\n+fn main() {\n+    let Some(_) = Some(()) else if true {\n+        //~^ ERROR conditional `else if` is not supported for `let...else`\n+        return;\n+    } else {\n+        return;\n+    };\n+}"}, {"sha": "38c739fd85072d8530897ca9614695fa49a2cbcb", "filename": "src/test/ui/let-else/let-else-if.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/856541963ce95ef4f7d4a81784bb5002ccf63c93/src%2Ftest%2Fui%2Flet-else%2Flet-else-if.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/856541963ce95ef4f7d4a81784bb5002ccf63c93/src%2Ftest%2Fui%2Flet-else%2Flet-else-if.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flet-else%2Flet-else-if.stderr?ref=856541963ce95ef4f7d4a81784bb5002ccf63c93", "patch": "@@ -0,0 +1,18 @@\n+error: conditional `else if` is not supported for `let...else`\n+  --> $DIR/let-else-if.rs:4:33\n+   |\n+LL |     let Some(_) = Some(()) else if true {\n+   |                                 ^^ expected `{`\n+   |\n+help: try placing this code inside a block\n+   |\n+LL ~     let Some(_) = Some(()) else { if true {\n+LL +\n+LL +         return;\n+LL +     } else {\n+LL +         return;\n+LL ~     } };\n+   |\n+\n+error: aborting due to previous error\n+"}]}