{"sha": "d7b91c31207a1440732b01d357181c68e7e72a97", "node_id": "C_kwDOAAsO6NoAKGQ3YjkxYzMxMjA3YTE0NDA3MzJiMDFkMzU3MTgxYzY4ZTdlNzJhOTc", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2022-08-10T11:16:25Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2022-08-20T13:47:59Z"}, "message": "Add global safe.directory for CI", "tree": {"sha": "b20c940ee92fc2213a85c9f99312d8e0e0c8a575", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b20c940ee92fc2213a85c9f99312d8e0e0c8a575"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d7b91c31207a1440732b01d357181c68e7e72a97", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d7b91c31207a1440732b01d357181c68e7e72a97", "html_url": "https://github.com/rust-lang/rust/commit/d7b91c31207a1440732b01d357181c68e7e72a97", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d7b91c31207a1440732b01d357181c68e7e72a97/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6c7f30114515111c53224e2de1434a324f73c0e8", "url": "https://api.github.com/repos/rust-lang/rust/commits/6c7f30114515111c53224e2de1434a324f73c0e8", "html_url": "https://github.com/rust-lang/rust/commit/6c7f30114515111c53224e2de1434a324f73c0e8"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "69f88e4952019e6dc96fa5d2afd371895d296679", "filename": "src/ci/docker/host-x86_64/armhf-gnu/Dockerfile", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7b91c31207a1440732b01d357181c68e7e72a97/src%2Fci%2Fdocker%2Fhost-x86_64%2Farmhf-gnu%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d7b91c31207a1440732b01d357181c68e7e72a97/src%2Fci%2Fdocker%2Fhost-x86_64%2Farmhf-gnu%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Farmhf-gnu%2FDockerfile?ref=d7b91c31207a1440732b01d357181c68e7e72a97", "patch": "@@ -78,6 +78,8 @@ RUN curl -O https://ci-mirrors.rust-lang.org/rustc/vexpress-v2p-ca15-tc1.dtb\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY static/gitconfig /etc/gitconfig\n+\n ENV RUST_CONFIGURE_ARGS --qemu-armhf-rootfs=/tmp/rootfs\n ENV SCRIPT python3 ../x.py --stage 2 test --host='' --target arm-unknown-linux-gnueabihf\n "}, {"sha": "9e37c2822e8bd58d5d166c7c2bc60832f0221a76", "filename": "src/ci/docker/host-x86_64/wasm32/Dockerfile", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7b91c31207a1440732b01d357181c68e7e72a97/src%2Fci%2Fdocker%2Fhost-x86_64%2Fwasm32%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/d7b91c31207a1440732b01d357181c68e7e72a97/src%2Fci%2Fdocker%2Fhost-x86_64%2Fwasm32%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fwasm32%2FDockerfile?ref=d7b91c31207a1440732b01d357181c68e7e72a97", "patch": "@@ -48,6 +48,8 @@ ENV TARGETS=wasm32-unknown-emscripten\n # Use -O1 optimizations in the link step to reduce time spent optimizing.\n ENV EMCC_CFLAGS=-O1\n \n+COPY static/gitconfig /etc/gitconfig\n+\n # Emscripten installation is user-specific\n ENV NO_CHANGE_USER=1\n "}, {"sha": "6bad35f01ce71c03115f834d68374d1f09bda876", "filename": "src/ci/docker/static/gitconfig", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d7b91c31207a1440732b01d357181c68e7e72a97/src%2Fci%2Fdocker%2Fstatic%2Fgitconfig", "raw_url": "https://github.com/rust-lang/rust/raw/d7b91c31207a1440732b01d357181c68e7e72a97/src%2Fci%2Fdocker%2Fstatic%2Fgitconfig", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fstatic%2Fgitconfig?ref=d7b91c31207a1440732b01d357181c68e7e72a97", "patch": "@@ -0,0 +1,2 @@\n+[safe]\n+directory = *"}, {"sha": "9a247fb60a8ee0535c20ecc4d5ab0f4e135c8ab4", "filename": "src/ci/run.sh", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d7b91c31207a1440732b01d357181c68e7e72a97/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/d7b91c31207a1440732b01d357181c68e7e72a97/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=d7b91c31207a1440732b01d357181c68e7e72a97", "patch": "@@ -11,6 +11,16 @@ if [ \"$NO_CHANGE_USER\" = \"\" ]; then\n     useradd --shell /bin/bash -u $LOCAL_USER_ID -o -c \"\" -m user\n     export HOME=/home/user\n     unset LOCAL_USER_ID\n+\n+    # Ensure that runners are able to execute git commands in the worktree,\n+    # overriding the typical git protections. In our docker container we're running\n+    # as root, while the user owning the checkout is not root.\n+    # This is only necessary when we change the user, otherwise we should\n+    # already be running with the right user.\n+    #\n+    # For NO_CHANGE_USER done in the small number of Dockerfiles affected.\n+    echo -e '[safe]\\n\\tdirectory = *' > /home/user/gitconfig\n+\n     exec su --preserve-environment -c \"env PATH=$PATH \\\"$0\\\"\" user\n   fi\n fi"}]}