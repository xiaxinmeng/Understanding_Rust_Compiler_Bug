{"sha": "3a380d4b3a6bc2a3ecef1248f3f8161b09b0506b", "node_id": "C_kwDOAAsO6NoAKDNhMzgwZDRiM2E2YmMyYTNlY2VmMTI0OGYzZjgxNjFiMDliMDUwNmI", "commit": {"author": {"name": "rainy-me", "email": "github@yue.coffee", "date": "2022-05-22T09:50:40Z"}, "committer": {"name": "rainy-me", "email": "github@yue.coffee", "date": "2022-05-22T09:50:40Z"}, "message": "fix: special case base url of `BuiltinType` to core", "tree": {"sha": "6472ea57edc7935b3a515f3d943900dea924b17c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6472ea57edc7935b3a515f3d943900dea924b17c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3a380d4b3a6bc2a3ecef1248f3f8161b09b0506b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3a380d4b3a6bc2a3ecef1248f3f8161b09b0506b", "html_url": "https://github.com/rust-lang/rust/commit/3a380d4b3a6bc2a3ecef1248f3f8161b09b0506b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3a380d4b3a6bc2a3ecef1248f3f8161b09b0506b/comments", "author": {"login": "yue4u", "id": 26110087, "node_id": "MDQ6VXNlcjI2MTEwMDg3", "avatar_url": "https://avatars.githubusercontent.com/u/26110087?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yue4u", "html_url": "https://github.com/yue4u", "followers_url": "https://api.github.com/users/yue4u/followers", "following_url": "https://api.github.com/users/yue4u/following{/other_user}", "gists_url": "https://api.github.com/users/yue4u/gists{/gist_id}", "starred_url": "https://api.github.com/users/yue4u/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yue4u/subscriptions", "organizations_url": "https://api.github.com/users/yue4u/orgs", "repos_url": "https://api.github.com/users/yue4u/repos", "events_url": "https://api.github.com/users/yue4u/events{/privacy}", "received_events_url": "https://api.github.com/users/yue4u/received_events", "type": "User", "site_admin": false}, "committer": {"login": "yue4u", "id": 26110087, "node_id": "MDQ6VXNlcjI2MTEwMDg3", "avatar_url": "https://avatars.githubusercontent.com/u/26110087?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yue4u", "html_url": "https://github.com/yue4u", "followers_url": "https://api.github.com/users/yue4u/followers", "following_url": "https://api.github.com/users/yue4u/following{/other_user}", "gists_url": "https://api.github.com/users/yue4u/gists{/gist_id}", "starred_url": "https://api.github.com/users/yue4u/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yue4u/subscriptions", "organizations_url": "https://api.github.com/users/yue4u/orgs", "repos_url": "https://api.github.com/users/yue4u/repos", "events_url": "https://api.github.com/users/yue4u/events{/privacy}", "received_events_url": "https://api.github.com/users/yue4u/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3de03d4c61d2405b66337b96ea97aa21f7d04e4b", "url": "https://api.github.com/repos/rust-lang/rust/commits/3de03d4c61d2405b66337b96ea97aa21f7d04e4b", "html_url": "https://github.com/rust-lang/rust/commit/3de03d4c61d2405b66337b96ea97aa21f7d04e4b"}], "stats": {"total": 24, "additions": 15, "deletions": 9}, "files": [{"sha": "60fad2d5db2f01a4d7d9111aa7308d12f1a50370", "filename": "crates/ide/src/doc_links.rs", "status": "modified", "additions": 13, "deletions": 9, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/3a380d4b3a6bc2a3ecef1248f3f8161b09b0506b/crates%2Fide%2Fsrc%2Fdoc_links.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a380d4b3a6bc2a3ecef1248f3f8161b09b0506b/crates%2Fide%2Fsrc%2Fdoc_links.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fdoc_links.rs?ref=3a380d4b3a6bc2a3ecef1248f3f8161b09b0506b", "patch": "@@ -10,7 +10,7 @@ use pulldown_cmark_to_cmark::{cmark_resume_with_options, Options as CMarkOptions\n use stdx::format_to;\n use url::Url;\n \n-use hir::{db::HirDatabase, Adt, AsAssocItem, AssocItem, AssocItemContainer, Crate, HasAttrs};\n+use hir::{db::HirDatabase, Adt, AsAssocItem, AssocItem, AssocItemContainer, HasAttrs};\n use ide_db::{\n     base_db::{CrateOrigin, LangCrateOrigin, SourceDatabase},\n     defs::{Definition, NameClass, NameRefClass},\n@@ -293,8 +293,7 @@ fn broken_link_clone_cb<'a>(link: BrokenLink<'a>) -> Option<(CowStr<'a>, CowStr<\n fn get_doc_link(db: &RootDatabase, def: Definition) -> Option<String> {\n     let (target, file, frag) = filename_and_frag_for_def(db, def)?;\n \n-    let krate = target.krate(db)?;\n-    let mut url = get_doc_base_url(db, krate)?;\n+    let mut url = get_doc_base_url(db, target)?;\n \n     if let Some(path) = mod_path_of_def(db, target) {\n         url = url.join(&path).ok()?;\n@@ -315,8 +314,7 @@ fn rewrite_intra_doc_link(\n     let (link, ns) = parse_intra_doc_link(target);\n \n     let resolved = resolve_doc_path_for_def(db, def, link, ns)?;\n-    let krate = resolved.krate(db)?;\n-    let mut url = get_doc_base_url(db, krate)?;\n+    let mut url = get_doc_base_url(db, resolved)?;\n \n     let (_, file, frag) = filename_and_frag_for_def(db, resolved)?;\n     if let Some(path) = mod_path_of_def(db, resolved) {\n@@ -335,8 +333,7 @@ fn rewrite_url_link(db: &RootDatabase, def: Definition, target: &str) -> Option<\n         return None;\n     }\n \n-    let krate = def.krate(db)?;\n-    let mut url = get_doc_base_url(db, krate)?;\n+    let mut url = get_doc_base_url(db, def)?;\n     let (def, file, frag) = filename_and_frag_for_def(db, def)?;\n \n     if let Some(path) = mod_path_of_def(db, def) {\n@@ -401,13 +398,20 @@ fn map_links<'e>(\n     })\n }\n \n-/// Get the root URL for the documentation of a crate.\n+/// Get the root URL for the documentation of a definition.\n ///\n /// ```ignore\n /// https://doc.rust-lang.org/std/iter/trait.Iterator.html#tymethod.next\n /// ^^^^^^^^^^^^^^^^^^^^^^^^^^\n /// ```\n-fn get_doc_base_url(db: &RootDatabase, krate: Crate) -> Option<Url> {\n+fn get_doc_base_url(db: &RootDatabase, def: Definition) -> Option<Url> {\n+    // special case base url of `BuiltinType` to core\n+    // https://github.com/rust-lang/rust-analyzer/issues/12250\n+    if let Definition::BuiltinType(..) = def {\n+        return Url::parse(\"https://doc.rust-lang.org/nightly/core/\").ok();\n+    };\n+\n+    let krate = def.krate(db)?;\n     let display_name = krate.display_name(db)?;\n \n     let base = match db.crate_graph()[krate.into()].origin {"}, {"sha": "5d084ac955bb6ec6522eecd3d7f0b0ea70a2525c", "filename": "crates/ide/src/hover/tests.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3a380d4b3a6bc2a3ecef1248f3f8161b09b0506b/crates%2Fide%2Fsrc%2Fhover%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3a380d4b3a6bc2a3ecef1248f3f8161b09b0506b/crates%2Fide%2Fsrc%2Fhover%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fhover%2Ftests.rs?ref=3a380d4b3a6bc2a3ecef1248f3f8161b09b0506b", "patch": "@@ -3796,6 +3796,7 @@ cosnt _: &str$0 = \"\"; }\n \n //- /libstd.rs crate:std\n /// Docs for prim_str\n+/// [`foo`](../std/keyword.foo.html)\n mod prim_str {}\n \"#,\n         expect![[r#\"\n@@ -3808,6 +3809,7 @@ mod prim_str {}\n                 ---\n \n                 Docs for prim_str\n+                [`foo`](https://doc.rust-lang.org/nightly/std/keyword.foo.html)\n             \"#]],\n     );\n }"}]}