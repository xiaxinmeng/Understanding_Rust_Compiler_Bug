{"sha": "48d2acb297459fb06cbb49bdce2eccb4c2591714", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ4ZDJhY2IyOTc0NTlmYjA2Y2JiNDliZGNlMmVjY2I0YzI1OTE3MTQ=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-01-28T20:43:13Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-01-28T20:43:13Z"}, "message": "Merge #698\n\n698: Added support for primitive types type inference with std::ops::Not r=flodiebold a=WizardOfMenlo\n\nOn the guideline of #544 , this allows for type inference for all primitive types implementing [std::ops::Not](https://doc.rust-lang.org/beta/std/ops/trait.Not.html). I think this should be relevant #394 as well?\n\nCo-authored-by: WizardOfMenlo <giacomofenzi@outlook.com>", "tree": {"sha": "8f447c656a44f77a512f8b02d505619895b79bfc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8f447c656a44f77a512f8b02d505619895b79bfc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/48d2acb297459fb06cbb49bdce2eccb4c2591714", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/48d2acb297459fb06cbb49bdce2eccb4c2591714", "html_url": "https://github.com/rust-lang/rust/commit/48d2acb297459fb06cbb49bdce2eccb4c2591714", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/48d2acb297459fb06cbb49bdce2eccb4c2591714/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "a238cb519a96642ab03ff989783bbee5149f9334", "url": "https://api.github.com/repos/rust-lang/rust/commits/a238cb519a96642ab03ff989783bbee5149f9334", "html_url": "https://github.com/rust-lang/rust/commit/a238cb519a96642ab03ff989783bbee5149f9334"}, {"sha": "ec32b2e39cb95fc1a9015379de6fe71f230c873d", "url": "https://api.github.com/repos/rust-lang/rust/commits/ec32b2e39cb95fc1a9015379de6fe71f230c873d", "html_url": "https://github.com/rust-lang/rust/commit/ec32b2e39cb95fc1a9015379de6fe71f230c873d"}], "stats": {"total": 52, "additions": 37, "deletions": 15}, "files": [{"sha": "7a54856981490cc4913d15443b0d6328d207020b", "filename": "crates/ra_hir/src/ty.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/48d2acb297459fb06cbb49bdce2eccb4c2591714/crates%2Fra_hir%2Fsrc%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/48d2acb297459fb06cbb49bdce2eccb4c2591714/crates%2Fra_hir%2Fsrc%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty.rs?ref=48d2acb297459fb06cbb49bdce2eccb4c2591714", "patch": "@@ -1588,9 +1588,13 @@ impl<'a, D: HirDatabase> InferenceContext<'a, D> {\n                             _ => Ty::Unknown,\n                         }\n                     }\n-                    UnaryOp::Not if inner_ty == Ty::Bool => Ty::Bool,\n-                    // TODO: resolve ops::Not trait for inner_ty\n-                    UnaryOp::Not => Ty::Unknown,\n+                    UnaryOp::Not => {\n+                        match inner_ty {\n+                            Ty::Bool | Ty::Int(_) | Ty::Infer(InferTy::IntVar(..)) => inner_ty,\n+                            // TODO: resolve ops::Not trait for inner_ty\n+                            _ => Ty::Unknown,\n+                        }\n+                    }\n                 }\n             }\n             Expr::BinaryOp { lhs, rhs, op } => match op {"}, {"sha": "5021d0eeba7366553828cc6ba45845f612541406", "filename": "crates/ra_hir/src/ty/snapshots/tests__infer_unary_op.snap", "status": "modified", "additions": 25, "deletions": 12, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/48d2acb297459fb06cbb49bdce2eccb4c2591714/crates%2Fra_hir%2Fsrc%2Fty%2Fsnapshots%2Ftests__infer_unary_op.snap", "raw_url": "https://github.com/rust-lang/rust/raw/48d2acb297459fb06cbb49bdce2eccb4c2591714/crates%2Fra_hir%2Fsrc%2Fty%2Fsnapshots%2Ftests__infer_unary_op.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Fsnapshots%2Ftests__infer_unary_op.snap?ref=48d2acb297459fb06cbb49bdce2eccb4c2591714", "patch": "@@ -1,11 +1,11 @@\n ---\n-created: \"2019-01-22T14:45:00.059676600+00:00\"\n-creator: insta@0.4.0\n+created: \"2019-01-28T14:51:16.185273502+00:00\"\n+creator: insta@0.5.2\n expression: \"&result\"\n-source: \"crates\\\\ra_hir\\\\src\\\\ty\\\\tests.rs\"\n+source: crates/ra_hir/src/ty/tests.rs\n ---\n [27; 28) 'x': SomeType\n-[40; 197) '{     ...lo\"; }': ()\n+[40; 272) '{     ...lo\"; }': ()\n [50; 51) 'b': bool\n [54; 59) 'false': bool\n [69; 70) 'c': bool\n@@ -24,12 +24,25 @@ source: \"crates\\\\ra_hir\\\\src\\\\ty\\\\tests.rs\"\n [147; 153) '!!true': bool\n [148; 153) '!true': bool\n [149; 153) 'true': bool\n-[159; 164) '-3.14': f64\n-[160; 164) '3.14': f64\n-[170; 172) '-x': [unknown]\n-[171; 172) 'x': SomeType\n-[178; 180) '!x': [unknown]\n-[179; 180) 'x': SomeType\n-[186; 194) '-\"hello\"': [unknown]\n-[187; 194) '\"hello\"': &str\n+[163; 164) 'g': i32\n+[167; 170) '!42': i32\n+[168; 170) '42': i32\n+[180; 181) 'h': u32\n+[184; 190) '!10u32': u32\n+[185; 190) '10u32': u32\n+[200; 201) 'j': i128\n+[204; 206) '!a': i128\n+[205; 206) 'a': i128\n+[212; 217) '-3.14': f64\n+[213; 217) '3.14': f64\n+[223; 225) '!3': i32\n+[224; 225) '3': i32\n+[231; 233) '-x': [unknown]\n+[232; 233) 'x': SomeType\n+[239; 241) '!x': [unknown]\n+[240; 241) 'x': SomeType\n+[247; 255) '-\"hello\"': [unknown]\n+[248; 255) '\"hello\"': &str\n+[261; 269) '!\"hello\"': [unknown]\n+[262; 269) '\"hello\"': &str\n "}, {"sha": "b36e6ec47d0abddb4c1841de209931bb3b589f9a", "filename": "crates/ra_hir/src/ty/tests.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/48d2acb297459fb06cbb49bdce2eccb4c2591714/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/48d2acb297459fb06cbb49bdce2eccb4c2591714/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs?ref=48d2acb297459fb06cbb49bdce2eccb4c2591714", "patch": "@@ -166,10 +166,15 @@ fn test(x: SomeType) {\n     let d: i128 = -a;\n     let e = -100;\n     let f = !!!true;\n+    let g = !42;\n+    let h = !10u32;\n+    let j = !a;\n     -3.14;\n+    !3;\n     -x;\n     !x;\n     -\"hello\";\n+    !\"hello\";\n }\n \"#,\n     );"}]}