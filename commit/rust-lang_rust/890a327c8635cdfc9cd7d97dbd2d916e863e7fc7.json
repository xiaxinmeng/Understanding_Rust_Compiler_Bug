{"sha": "890a327c8635cdfc9cd7d97dbd2d916e863e7fc7", "node_id": "C_kwDOAAsO6NoAKDg5MGEzMjdjODYzNWNkZmM5Y2Q3ZDk3ZGJkMmQ5MTZlODYzZTdmYzc", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-10-02T15:12:22Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-10-02T15:12:22Z"}, "message": "Rollup merge of #102556 - WaffleLapkin:implied_by_btree_new, r=Mark-Simulacrum\n\nMake `feature(const_btree_len)` implied by `feature(const_btree_new)`\n\n...this should fix code that used the old feature that was changed in #102197\n\ncc ```@davidtwco``` it seems like tidy doesn't check `implied_by`, should it?", "tree": {"sha": "0b08ee9e358939158e0c52036241e7ce71f4896f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0b08ee9e358939158e0c52036241e7ce71f4896f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/890a327c8635cdfc9cd7d97dbd2d916e863e7fc7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjOapWCRBK7hj4Ov3rIwAAUioIAGX9Z/qlGYX9IM/0jQJgoraw\n3vZeXTQON/06pnh+h8qjJx+n3GneKbtmI7PusLe8FOykaIXx6Hmfn/d3zsypz+9u\nfjOsg3I/UFVaOe1BLVakjVDzZ9CkofI5bS+Bip8cZPkfui9BB7Uf5fpgwZTlvIh9\nL4sne9pMQP25u7gCf+C7TsZEsoqgWsWt4TAYYglQxhxnIU+iiuA4nK1baGMaWbTC\nsR7x9HnO9PBRuOD39rMq5nfwfT+r06WAhrnXaMVJHebOxTL4/63DFNgT6hiHT70o\nyZiCA/eAbp1PtnE42daDsUwgdOAKxVyENIp8UM6XzZsoGD/pDsCWrGmVJ8PR9vE=\n=f9h2\n-----END PGP SIGNATURE-----\n", "payload": "tree 0b08ee9e358939158e0c52036241e7ce71f4896f\nparent f3ab5a66a93d00da8764057f1503486b8a2516b3\nparent da78c1fd43c39166e09dd4b5cf93a66396841c2d\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1664723542 +0530\ncommitter GitHub <noreply@github.com> 1664723542 +0530\n\nRollup merge of #102556 - WaffleLapkin:implied_by_btree_new, r=Mark-Simulacrum\n\nMake `feature(const_btree_len)` implied by `feature(const_btree_new)`\n\n...this should fix code that used the old feature that was changed in #102197\n\ncc ```@davidtwco``` it seems like tidy doesn't check `implied_by`, should it?\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/890a327c8635cdfc9cd7d97dbd2d916e863e7fc7", "html_url": "https://github.com/rust-lang/rust/commit/890a327c8635cdfc9cd7d97dbd2d916e863e7fc7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/890a327c8635cdfc9cd7d97dbd2d916e863e7fc7/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f3ab5a66a93d00da8764057f1503486b8a2516b3", "url": "https://api.github.com/repos/rust-lang/rust/commits/f3ab5a66a93d00da8764057f1503486b8a2516b3", "html_url": "https://github.com/rust-lang/rust/commit/f3ab5a66a93d00da8764057f1503486b8a2516b3"}, {"sha": "da78c1fd43c39166e09dd4b5cf93a66396841c2d", "url": "https://api.github.com/repos/rust-lang/rust/commits/da78c1fd43c39166e09dd4b5cf93a66396841c2d", "html_url": "https://github.com/rust-lang/rust/commit/da78c1fd43c39166e09dd4b5cf93a66396841c2d"}], "stats": {"total": 28, "additions": 23, "deletions": 5}, "files": [{"sha": "3687f84b1bd46f04a74ca2baad8e799eee0c866d", "filename": "library/alloc/src/collections/btree/map.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/890a327c8635cdfc9cd7d97dbd2d916e863e7fc7/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/890a327c8635cdfc9cd7d97dbd2d916e863e7fc7/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fmap.rs?ref=890a327c8635cdfc9cd7d97dbd2d916e863e7fc7", "patch": "@@ -2392,7 +2392,11 @@ impl<K, V, A: Allocator + Clone> BTreeMap<K, V, A> {\n     /// ```\n     #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-    #[rustc_const_unstable(feature = \"const_btree_len\", issue = \"71835\")]\n+    #[rustc_const_unstable(\n+        feature = \"const_btree_len\",\n+        issue = \"71835\",\n+        implied_by = \"const_btree_new\"\n+    )]\n     pub const fn len(&self) -> usize {\n         self.length\n     }\n@@ -2413,7 +2417,11 @@ impl<K, V, A: Allocator + Clone> BTreeMap<K, V, A> {\n     /// ```\n     #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-    #[rustc_const_unstable(feature = \"const_btree_len\", issue = \"71835\")]\n+    #[rustc_const_unstable(\n+        feature = \"const_btree_len\",\n+        issue = \"71835\",\n+        implied_by = \"const_btree_new\"\n+    )]\n     pub const fn is_empty(&self) -> bool {\n         self.len() == 0\n     }"}, {"sha": "5783d836e105d42c704bba9ecffcf1f9c8f612f8", "filename": "library/alloc/src/collections/btree/set.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/890a327c8635cdfc9cd7d97dbd2d916e863e7fc7/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset.rs", "raw_url": "https://github.com/rust-lang/rust/raw/890a327c8635cdfc9cd7d97dbd2d916e863e7fc7/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbtree%2Fset.rs?ref=890a327c8635cdfc9cd7d97dbd2d916e863e7fc7", "patch": "@@ -1174,7 +1174,11 @@ impl<T, A: Allocator + Clone> BTreeSet<T, A> {\n     /// ```\n     #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-    #[rustc_const_unstable(feature = \"const_btree_len\", issue = \"71835\")]\n+    #[rustc_const_unstable(\n+        feature = \"const_btree_len\",\n+        issue = \"71835\",\n+        implied_by = \"const_btree_new\"\n+    )]\n     pub const fn len(&self) -> usize {\n         self.map.len()\n     }\n@@ -1193,7 +1197,11 @@ impl<T, A: Allocator + Clone> BTreeSet<T, A> {\n     /// ```\n     #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-    #[rustc_const_unstable(feature = \"const_btree_len\", issue = \"71835\")]\n+    #[rustc_const_unstable(\n+        feature = \"const_btree_len\",\n+        issue = \"71835\",\n+        implied_by = \"const_btree_new\"\n+    )]\n     pub const fn is_empty(&self) -> bool {\n         self.len() == 0\n     }"}, {"sha": "d8b3903b98e7c59e2202b20d5b704e02886fcefc", "filename": "src/tools/tidy/src/features.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/890a327c8635cdfc9cd7d97dbd2d916e863e7fc7/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures.rs", "raw_url": "https://github.com/rust-lang/rust/raw/890a327c8635cdfc9cd7d97dbd2d916e863e7fc7/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures.rs?ref=890a327c8635cdfc9cd7d97dbd2d916e863e7fc7", "patch": "@@ -538,7 +538,9 @@ fn map_lib_features(\n                 becoming_feature = None;\n                 if line.contains(\"rustc_const_unstable(\") {\n                     // `const fn` features are handled specially.\n-                    let feature_name = match find_attr_val(line, \"feature\") {\n+                    let feature_name = match find_attr_val(line, \"feature\").or_else(|| {\n+                        iter_lines.peek().and_then(|next| find_attr_val(next.1, \"feature\"))\n+                    }) {\n                         Some(name) => name,\n                         None => err!(\"malformed stability attribute: missing `feature` key\"),\n                     };"}]}