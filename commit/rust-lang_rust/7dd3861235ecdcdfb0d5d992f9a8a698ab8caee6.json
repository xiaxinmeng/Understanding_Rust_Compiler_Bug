{"sha": "7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6", "node_id": "C_kwDOAAsO6NoAKDdkZDM4NjEyMzVlY2RjZGZiMGQ1ZDk5MmY5YThhNjk4YWI4Y2FlZTY", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-06-02T21:28:18Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-06-02T22:02:19Z"}, "message": "rustdoc: clean up primitive.slice.html links", "tree": {"sha": "5f885197fa845fa5858cc3e6c97c83fedd97c9c4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5f885197fa845fa5858cc3e6c97c83fedd97c9c4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6", "html_url": "https://github.com/rust-lang/rust/commit/7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e71440575c930dcecac288b7c3536410d688b351", "url": "https://api.github.com/repos/rust-lang/rust/commits/e71440575c930dcecac288b7c3536410d688b351", "html_url": "https://github.com/rust-lang/rust/commit/e71440575c930dcecac288b7c3536410d688b351"}], "stats": {"total": 70, "additions": 48, "deletions": 22}, "files": [{"sha": "b7789493df647a65bcfe6acec7b55bf979559a43", "filename": "src/librustdoc/html/format.rs", "status": "modified", "additions": 16, "deletions": 22, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6/src%2Flibrustdoc%2Fhtml%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6/src%2Flibrustdoc%2Fhtml%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fformat.rs?ref=7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6", "patch": "@@ -881,11 +881,16 @@ fn fmt_type<'cx>(\n                 }\n             }\n         }\n-        clean::Slice(ref t) => {\n-            primitive_link(f, PrimitiveType::Slice, \"[\", cx)?;\n-            fmt::Display::fmt(&t.print(cx), f)?;\n-            primitive_link(f, PrimitiveType::Slice, \"]\", cx)\n-        }\n+        clean::Slice(ref t) => match **t {\n+            clean::Generic(name) => {\n+                primitive_link(f, PrimitiveType::Slice, &format!(\"[{name}]\"), cx)\n+            }\n+            _ => {\n+                primitive_link(f, PrimitiveType::Slice, \"[\", cx)?;\n+                fmt::Display::fmt(&t.print(cx), f)?;\n+                primitive_link(f, PrimitiveType::Slice, \"]\", cx)\n+            }\n+        },\n         clean::Array(ref t, ref n) => {\n             primitive_link(f, PrimitiveType::Array, \"[\", cx)?;\n             fmt::Display::fmt(&t.print(cx), f)?;\n@@ -924,23 +929,12 @@ fn fmt_type<'cx>(\n                 clean::Slice(ref bt) => {\n                     // `BorrowedRef{ ... Slice(T) }` is `&[T]`\n                     match **bt {\n-                        clean::Generic(_) => {\n-                            if f.alternate() {\n-                                primitive_link(\n-                                    f,\n-                                    PrimitiveType::Slice,\n-                                    &format!(\"{}{}{}[{:#}]\", amp, lt, m, bt.print(cx)),\n-                                    cx,\n-                                )\n-                            } else {\n-                                primitive_link(\n-                                    f,\n-                                    PrimitiveType::Slice,\n-                                    &format!(\"{}{}{}[{}]\", amp, lt, m, bt.print(cx)),\n-                                    cx,\n-                                )\n-                            }\n-                        }\n+                        clean::Generic(name) => primitive_link(\n+                            f,\n+                            PrimitiveType::Slice,\n+                            &format!(\"{amp}{lt}{m}[{name}]\"),\n+                            cx,\n+                        ),\n                         _ => {\n                             primitive_link(\n                                 f,"}, {"sha": "38aaf20808cf124e7bbd79aa869cb6a4eab2bce7", "filename": "src/test/rustdoc/slice-links.link_box_generic.html", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6/src%2Ftest%2Frustdoc%2Fslice-links.link_box_generic.html", "raw_url": "https://github.com/rust-lang/rust/raw/7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6/src%2Ftest%2Frustdoc%2Fslice-links.link_box_generic.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fslice-links.link_box_generic.html?ref=7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6", "patch": "@@ -0,0 +1 @@\n+<code>pub fn delta&lt;T&gt;() -&gt; <a class=\"struct\" href=\"struct.MyBox.html\" title=\"struct foo::MyBox\">MyBox</a>&lt;<a class=\"primitive\" href=\"{{channel}}/core/primitive.slice.html\">[T]</a>&gt;</code>\n\\ No newline at end of file"}, {"sha": "42fd721a4acf1e678496785bb585cad650d26cdf", "filename": "src/test/rustdoc/slice-links.link_box_u32.html", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6/src%2Ftest%2Frustdoc%2Fslice-links.link_box_u32.html", "raw_url": "https://github.com/rust-lang/rust/raw/7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6/src%2Ftest%2Frustdoc%2Fslice-links.link_box_u32.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fslice-links.link_box_u32.html?ref=7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6", "patch": "@@ -0,0 +1 @@\n+<code>pub fn gamma() -&gt; <a class=\"struct\" href=\"struct.MyBox.html\" title=\"struct foo::MyBox\">MyBox</a>&lt;<a class=\"primitive\" href=\"{{channel}}/core/primitive.slice.html\">[</a><a class=\"primitive\" href=\"{{channel}}/core/primitive.u32.html\">u32</a><a class=\"primitive\" href=\"{{channel}}/core/primitive.slice.html\">]</a>&gt;</code>\n\\ No newline at end of file"}, {"sha": "fe79ca7a82da30f59d57fcde30b029d63e1e5f4f", "filename": "src/test/rustdoc/slice-links.link_slice_generic.html", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6/src%2Ftest%2Frustdoc%2Fslice-links.link_slice_generic.html", "raw_url": "https://github.com/rust-lang/rust/raw/7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6/src%2Ftest%2Frustdoc%2Fslice-links.link_slice_generic.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fslice-links.link_slice_generic.html?ref=7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6", "patch": "@@ -0,0 +1 @@\n+<code>pub fn beta&lt;T&gt;() -&gt; <a class=\"primitive\" href=\"{{channel}}/core/primitive.slice.html\">&amp;'static [T]</a></code>\n\\ No newline at end of file"}, {"sha": "c7e430b0607f7039028f3734a58fa3031b6f253c", "filename": "src/test/rustdoc/slice-links.link_slice_u32.html", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6/src%2Ftest%2Frustdoc%2Fslice-links.link_slice_u32.html", "raw_url": "https://github.com/rust-lang/rust/raw/7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6/src%2Ftest%2Frustdoc%2Fslice-links.link_slice_u32.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fslice-links.link_slice_u32.html?ref=7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6", "patch": "@@ -0,0 +1 @@\n+<code>pub fn alpha() -&gt; <a class=\"primitive\" href=\"{{channel}}/core/primitive.slice.html\">&amp;'static [</a><a class=\"primitive\" href=\"{{channel}}/core/primitive.u32.html\">u32</a><a class=\"primitive\" href=\"{{channel}}/core/primitive.slice.html\">]</a></code>\n\\ No newline at end of file"}, {"sha": "9a78e963e30363a6ac195cc84c110cd5daef41a8", "filename": "src/test/rustdoc/slice-links.rs", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6/src%2Ftest%2Frustdoc%2Fslice-links.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6/src%2Ftest%2Frustdoc%2Fslice-links.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fslice-links.rs?ref=7dd3861235ecdcdfb0d5d992f9a8a698ab8caee6", "patch": "@@ -0,0 +1,28 @@\n+#![crate_name = \"foo\"]\n+#![no_std]\n+\n+pub struct MyBox<T: ?Sized>(*const T);\n+\n+// @has 'foo/fn.alpha.html'\n+// @snapshot link_slice_u32 - '//pre[@class=\"rust fn\"]/code'\n+pub fn alpha() -> &'static [u32] {\n+    loop {}\n+}\n+\n+// @has 'foo/fn.beta.html'\n+// @snapshot link_slice_generic - '//pre[@class=\"rust fn\"]/code'\n+pub fn beta<T>() -> &'static [T] {\n+    loop {}\n+}\n+\n+// @has 'foo/fn.gamma.html'\n+// @snapshot link_box_u32 - '//pre[@class=\"rust fn\"]/code'\n+pub fn gamma() -> MyBox<[u32]> {\n+    loop {}\n+}\n+\n+// @has 'foo/fn.delta.html'\n+// @snapshot link_box_generic - '//pre[@class=\"rust fn\"]/code'\n+pub fn delta<T>() -> MyBox<[T]> {\n+    loop {}\n+}"}]}