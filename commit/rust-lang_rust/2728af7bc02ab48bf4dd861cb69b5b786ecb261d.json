{"sha": "2728af7bc02ab48bf4dd861cb69b5b786ecb261d", "node_id": "C_kwDOAAsO6NoAKDI3MjhhZjdiYzAyYWI0OGJmNGRkODYxY2I2OWI1Yjc4NmVjYjI2MWQ", "commit": {"author": {"name": "Mahdi Dibaiee", "email": "mdibaiee@pm.me", "date": "2022-01-11T21:28:04Z"}, "committer": {"name": "Mahdi Dibaiee", "email": "mdibaiee@pm.me", "date": "2022-01-11T21:28:04Z"}, "message": "rustc_pass_by_value: handle inferred generic types (with _)", "tree": {"sha": "c6c482b3c60b146a018e530ebac30d649e17041a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c6c482b3c60b146a018e530ebac30d649e17041a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2728af7bc02ab48bf4dd861cb69b5b786ecb261d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEYxDoXUzfgu5d8FXXuroRW98MWYoFAmHd9okACgkQuroRW98M\nWYq9Ww/9FMo3hG79ePRX75LWWp7mYNGj8VfSUBhskcdGlvN+EQ2yHn9oYPgdOP7j\nJBZWQQh1lVYVmMZnja7xBiINDWucv4JTp7d1HvBiMhARTdhT1/iuxpR6B/NC7jcF\n0kEmiQwN0fHVpvhn4PGormB1jYh+PiAIaxodxoV9FzZtk2aaMNPR+iZ0Wm7o+7fA\nIyTR3OhMBJK3T5Gx6jRdSTnVm/fKAcWtr781vLpxw7BIQbHTaGGUL4b9vQ6aSnid\nQ0V7wsh1qAc3HIpt3ivkVfrjJc/pFVD90hgOkdfF8YyhhoQUKteePE6M6Ka7CQy3\nIhUfpMX4t392WU8zFhA7sFearXKSCpGUWdweC35CJ4LSWl4lqGci+U7V4LMVVbV9\n72Fe5JSVlNl63LcP9VrmKeEumtVsoFOQcYtC0yHli812sDdKjqhIfUCE0iKIjYGH\n64lb1j3VKtRZJQ7EpK8wFJ8JrhqE/1pzFft1QGXo1Z6LOBOEQdrPCvcjGrLXRZiJ\nvJ4Y4xjcdQs0lzW0lt1x2XwhtmrMBNKEHKJd3aJO9CEQV8LlcHZFFgnUD1qqIsU9\ndBviDMKiYYER5q2DVOD6HCd6+cwtslWo03miWZff0QPH8xAVvlnrVqjHnEhcrpyV\nnKR7LhdFhe5sra5NQ3KVubFpT4yaoF5yggSVROhD2bDoZ9YiGO0=\n=U0Ua\n-----END PGP SIGNATURE-----", "payload": "tree c6c482b3c60b146a018e530ebac30d649e17041a\nparent 959bf2bc2e79defd0fe7d3c9987a6023eb8503cd\nauthor Mahdi Dibaiee <mdibaiee@pm.me> 1641936484 +0000\ncommitter Mahdi Dibaiee <mdibaiee@pm.me> 1641936484 +0000\n\nrustc_pass_by_value: handle inferred generic types (with _)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2728af7bc02ab48bf4dd861cb69b5b786ecb261d", "html_url": "https://github.com/rust-lang/rust/commit/2728af7bc02ab48bf4dd861cb69b5b786ecb261d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2728af7bc02ab48bf4dd861cb69b5b786ecb261d/comments", "author": {"login": "mdibaiee", "id": 2807772, "node_id": "MDQ6VXNlcjI4MDc3NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/2807772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mdibaiee", "html_url": "https://github.com/mdibaiee", "followers_url": "https://api.github.com/users/mdibaiee/followers", "following_url": "https://api.github.com/users/mdibaiee/following{/other_user}", "gists_url": "https://api.github.com/users/mdibaiee/gists{/gist_id}", "starred_url": "https://api.github.com/users/mdibaiee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mdibaiee/subscriptions", "organizations_url": "https://api.github.com/users/mdibaiee/orgs", "repos_url": "https://api.github.com/users/mdibaiee/repos", "events_url": "https://api.github.com/users/mdibaiee/events{/privacy}", "received_events_url": "https://api.github.com/users/mdibaiee/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mdibaiee", "id": 2807772, "node_id": "MDQ6VXNlcjI4MDc3NzI=", "avatar_url": "https://avatars.githubusercontent.com/u/2807772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mdibaiee", "html_url": "https://github.com/mdibaiee", "followers_url": "https://api.github.com/users/mdibaiee/followers", "following_url": "https://api.github.com/users/mdibaiee/following{/other_user}", "gists_url": "https://api.github.com/users/mdibaiee/gists{/gist_id}", "starred_url": "https://api.github.com/users/mdibaiee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mdibaiee/subscriptions", "organizations_url": "https://api.github.com/users/mdibaiee/orgs", "repos_url": "https://api.github.com/users/mdibaiee/repos", "events_url": "https://api.github.com/users/mdibaiee/events{/privacy}", "received_events_url": "https://api.github.com/users/mdibaiee/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "959bf2bc2e79defd0fe7d3c9987a6023eb8503cd", "url": "https://api.github.com/repos/rust-lang/rust/commits/959bf2bc2e79defd0fe7d3c9987a6023eb8503cd", "html_url": "https://github.com/rust-lang/rust/commit/959bf2bc2e79defd0fe7d3c9987a6023eb8503cd"}], "stats": {"total": 40, "additions": 25, "deletions": 15}, "files": [{"sha": "26d0560bf89bbb692c495f01cdd807e63ea0bb98", "filename": "compiler/rustc_lint/src/pass_by_value.rs", "status": "modified", "additions": 5, "deletions": 9, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/2728af7bc02ab48bf4dd861cb69b5b786ecb261d/compiler%2Frustc_lint%2Fsrc%2Fpass_by_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2728af7bc02ab48bf4dd861cb69b5b786ecb261d/compiler%2Frustc_lint%2Fsrc%2Fpass_by_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fpass_by_value.rs?ref=2728af7bc02ab48bf4dd861cb69b5b786ecb261d", "patch": "@@ -73,19 +73,15 @@ fn gen_args(cx: &LateContext<'_>, segment: &PathSegment<'_>) -> String {\n         let params = args\n             .args\n             .iter()\n-            .filter_map(|arg| match arg {\n-                GenericArg::Lifetime(lt) => Some(lt.name.ident().to_string()),\n+            .map(|arg| match arg {\n+                GenericArg::Lifetime(lt) => lt.name.ident().to_string(),\n                 GenericArg::Type(ty) => {\n-                    let snippet =\n-                        cx.tcx.sess.source_map().span_to_snippet(ty.span).unwrap_or_default();\n-                    Some(snippet)\n+                    cx.tcx.sess.source_map().span_to_snippet(ty.span).unwrap_or_default()\n                 }\n                 GenericArg::Const(c) => {\n-                    let snippet =\n-                        cx.tcx.sess.source_map().span_to_snippet(c.span).unwrap_or_default();\n-                    Some(snippet)\n+                    cx.tcx.sess.source_map().span_to_snippet(c.span).unwrap_or_default()\n                 }\n-                _ => None,\n+                GenericArg::Infer(_) => String::from(\"_\"),\n             })\n             .collect::<Vec<_>>();\n "}, {"sha": "402c41f376602f8b07266cc732bf342aecf81468", "filename": "src/test/ui-fulldeps/internal-lints/rustc_pass_by_value.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/2728af7bc02ab48bf4dd861cb69b5b786ecb261d/src%2Ftest%2Fui-fulldeps%2Finternal-lints%2Frustc_pass_by_value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2728af7bc02ab48bf4dd861cb69b5b786ecb261d/src%2Ftest%2Fui-fulldeps%2Finternal-lints%2Frustc_pass_by_value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui-fulldeps%2Finternal-lints%2Frustc_pass_by_value.rs?ref=2728af7bc02ab48bf4dd861cb69b5b786ecb261d", "patch": "@@ -105,11 +105,13 @@ struct WithParameters<T, const N: usize, M = u32> {\n }\n \n impl<T> WithParameters<T, 1> {\n-    fn test(\n+    fn test<'a>(\n         value: WithParameters<T, 1>,\n-        reference: &WithParameters<T, 1>, //~ ERROR passing `WithParameters<T, 1>` by reference\n+        reference: &'a WithParameters<T, 1>, //~ ERROR passing `WithParameters<T, 1>` by reference\n         reference_with_m: &WithParameters<T, 1, u32>, //~ ERROR passing `WithParameters<T, 1, u32>` by reference\n-    ) {\n+    ) -> &'a WithParameters<T, 1> {\n+        //~^ ERROR passing `WithParameters<T, 1>` by reference\n+        reference as &WithParameters<_, 1> //~ ERROR passing `WithParameters<_, 1>` by reference\n     }\n }\n "}, {"sha": "7f6e57b38f38d936c37b5a9541d4cf343a9f3393", "filename": "src/test/ui-fulldeps/internal-lints/rustc_pass_by_value.stderr", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/2728af7bc02ab48bf4dd861cb69b5b786ecb261d/src%2Ftest%2Fui-fulldeps%2Finternal-lints%2Frustc_pass_by_value.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2728af7bc02ab48bf4dd861cb69b5b786ecb261d/src%2Ftest%2Fui-fulldeps%2Finternal-lints%2Frustc_pass_by_value.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui-fulldeps%2Finternal-lints%2Frustc_pass_by_value.stderr?ref=2728af7bc02ab48bf4dd861cb69b5b786ecb261d", "patch": "@@ -103,14 +103,26 @@ LL |         reference: &CustomAlias,\n error: passing `WithParameters<T, 1>` by reference\n   --> $DIR/rustc_pass_by_value.rs:110:20\n    |\n-LL |         reference: &WithParameters<T, 1>,\n-   |                    ^^^^^^^^^^^^^^^^^^^^^ help: try passing by value: `WithParameters<T, 1>`\n+LL |         reference: &'a WithParameters<T, 1>,\n+   |                    ^^^^^^^^^^^^^^^^^^^^^^^^ help: try passing by value: `WithParameters<T, 1>`\n \n error: passing `WithParameters<T, 1, u32>` by reference\n   --> $DIR/rustc_pass_by_value.rs:111:27\n    |\n LL |         reference_with_m: &WithParameters<T, 1, u32>,\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try passing by value: `WithParameters<T, 1, u32>`\n \n-error: aborting due to 18 previous errors\n+error: passing `WithParameters<T, 1>` by reference\n+  --> $DIR/rustc_pass_by_value.rs:112:10\n+   |\n+LL |     ) -> &'a WithParameters<T, 1> {\n+   |          ^^^^^^^^^^^^^^^^^^^^^^^^ help: try passing by value: `WithParameters<T, 1>`\n+\n+error: passing `WithParameters<_, 1>` by reference\n+  --> $DIR/rustc_pass_by_value.rs:114:22\n+   |\n+LL |         reference as &WithParameters<_, 1>\n+   |                      ^^^^^^^^^^^^^^^^^^^^^ help: try passing by value: `WithParameters<_, 1>`\n+\n+error: aborting due to 20 previous errors\n "}]}