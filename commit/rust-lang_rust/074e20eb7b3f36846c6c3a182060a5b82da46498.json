{"sha": "074e20eb7b3f36846c6c3a182060a5b82da46498", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA3NGUyMGViN2IzZjM2ODQ2YzZjM2ExODIwNjBhNWI4MmRhNDY0OTg=", "commit": {"author": {"name": "Christian Poveda", "email": "christianpoveda@protonmail.com", "date": "2019-06-29T18:17:15Z"}, "committer": {"name": "Christian Poveda", "email": "cpovedar@fnal.gov", "date": "2019-07-03T18:38:39Z"}, "message": "Add intptrcast test for explicit casts", "tree": {"sha": "5fe7847ae88ce09d39fcf48183f672f8cc9d864a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5fe7847ae88ce09d39fcf48183f672f8cc9d864a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/074e20eb7b3f36846c6c3a182060a5b82da46498", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/074e20eb7b3f36846c6c3a182060a5b82da46498", "html_url": "https://github.com/rust-lang/rust/commit/074e20eb7b3f36846c6c3a182060a5b82da46498", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/074e20eb7b3f36846c6c3a182060a5b82da46498/comments", "author": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pvdrz", "id": 31802960, "node_id": "MDQ6VXNlcjMxODAyOTYw", "avatar_url": "https://avatars.githubusercontent.com/u/31802960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pvdrz", "html_url": "https://github.com/pvdrz", "followers_url": "https://api.github.com/users/pvdrz/followers", "following_url": "https://api.github.com/users/pvdrz/following{/other_user}", "gists_url": "https://api.github.com/users/pvdrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/pvdrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pvdrz/subscriptions", "organizations_url": "https://api.github.com/users/pvdrz/orgs", "repos_url": "https://api.github.com/users/pvdrz/repos", "events_url": "https://api.github.com/users/pvdrz/events{/privacy}", "received_events_url": "https://api.github.com/users/pvdrz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ce5e910e602a46c7e18a6f2f731ddac971da8fdb", "url": "https://api.github.com/repos/rust-lang/rust/commits/ce5e910e602a46c7e18a6f2f731ddac971da8fdb", "html_url": "https://github.com/rust-lang/rust/commit/ce5e910e602a46c7e18a6f2f731ddac971da8fdb"}], "stats": {"total": 10, "additions": 10, "deletions": 0}, "files": [{"sha": "919083f98d3dfb24135f0dcfd20b2159b55ce61a", "filename": "tests/run-pass-noseed/intptrcast.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/074e20eb7b3f36846c6c3a182060a5b82da46498/tests%2Frun-pass-noseed%2Fintptrcast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/074e20eb7b3f36846c6c3a182060a5b82da46498/tests%2Frun-pass-noseed%2Fintptrcast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass-noseed%2Fintptrcast.rs?ref=074e20eb7b3f36846c6c3a182060a5b82da46498", "patch": "@@ -1,4 +1,7 @@\n // compile-flags: -Zmiri-seed=0000000000000000\n+fn transmute_ptr_to_int<T>(x: *const T) -> usize { \n+    unsafe { std::mem::transmute::<*const T, usize>(x) * 1 }\n+}\n \n fn main() {\n     // Some casting-to-int with arithmetic.\n@@ -11,4 +14,11 @@ fn main() {\n     // Pointer string formatting! We can't check the output as it changes when libstd changes,\n     // but we can make sure Miri does not error.\n     format!(\"{:?}\", &mut 13 as *mut _);\n+\n+    // Check that intptrcast is triggered for explicit casts and that it is consistent with\n+    // transmuting.\n+    let a: *const i32 = &42;\n+    let b = transmute_ptr_to_int(a) as u8;\n+    let c = a as usize as u8;\n+    assert_eq!(b, c);\n }"}]}