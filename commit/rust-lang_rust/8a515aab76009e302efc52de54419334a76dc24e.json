{"sha": "8a515aab76009e302efc52de54419334a76dc24e", "node_id": "C_kwDOAAsO6NoAKDhhNTE1YWFiNzYwMDllMzAyZWZjNTJkZTU0NDE5MzM0YTc2ZGMyNGU", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2023-02-09T18:46:46Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2023-04-15T07:46:46Z"}, "message": "Only enable ConstProp at mir-opt-level >= 2.", "tree": {"sha": "7cad9efc521a05293dab7c34757aebfad838f932", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7cad9efc521a05293dab7c34757aebfad838f932"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8a515aab76009e302efc52de54419334a76dc24e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8a515aab76009e302efc52de54419334a76dc24e", "html_url": "https://github.com/rust-lang/rust/commit/8a515aab76009e302efc52de54419334a76dc24e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8a515aab76009e302efc52de54419334a76dc24e/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3312a3053bb9996e56a5ed58b6b9306224ada727", "url": "https://api.github.com/repos/rust-lang/rust/commits/3312a3053bb9996e56a5ed58b6b9306224ada727", "html_url": "https://github.com/rust-lang/rust/commit/3312a3053bb9996e56a5ed58b6b9306224ada727"}], "stats": {"total": 50, "additions": 1, "deletions": 49}, "files": [{"sha": "ff12a0360aaa67fa6e2ca3b426c58bace181bb83", "filename": "compiler/rustc_mir_transform/src/const_prop.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8a515aab76009e302efc52de54419334a76dc24e/compiler%2Frustc_mir_transform%2Fsrc%2Fconst_prop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8a515aab76009e302efc52de54419334a76dc24e/compiler%2Frustc_mir_transform%2Fsrc%2Fconst_prop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fconst_prop.rs?ref=8a515aab76009e302efc52de54419334a76dc24e", "patch": "@@ -54,7 +54,7 @@ pub struct ConstProp;\n \n impl<'tcx> MirPass<'tcx> for ConstProp {\n     fn is_enabled(&self, sess: &rustc_session::Session) -> bool {\n-        sess.mir_opt_level() >= 1\n+        sess.mir_opt_level() >= 2\n     }\n \n     #[instrument(skip(self, tcx), level = \"debug\")]"}, {"sha": "9b761b00691212db60ead88331c208fb16de4030", "filename": "tests/ui/associated-consts/defaults-not-assumed-fail.stderr", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8a515aab76009e302efc52de54419334a76dc24e/tests%2Fui%2Fassociated-consts%2Fdefaults-not-assumed-fail.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8a515aab76009e302efc52de54419334a76dc24e/tests%2Fui%2Fassociated-consts%2Fdefaults-not-assumed-fail.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fassociated-consts%2Fdefaults-not-assumed-fail.stderr?ref=8a515aab76009e302efc52de54419334a76dc24e", "patch": "@@ -26,14 +26,6 @@ LL |     assert_eq!(<() as Tr>::B, 0);    // causes the error above\n    |\n    = note: this note originates in the macro `assert_eq` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n-note: erroneous constant used\n-  --> $DIR/defaults-not-assumed-fail.rs:33:5\n-   |\n-LL |     assert_eq!(<() as Tr>::B, 0);    // causes the error above\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-   = note: this note originates in the macro `assert_eq` (in Nightly builds, run with -Z macro-backtrace for more info)\n-\n error: aborting due to previous error\n \n For more information about this error, try `rustc --explain E0080`."}, {"sha": "149d3b5236b2fd622055314891d844bc690bacc9", "filename": "tests/ui/consts/const-err-late.stderr", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8a515aab76009e302efc52de54419334a76dc24e/tests%2Fui%2Fconsts%2Fconst-err-late.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8a515aab76009e302efc52de54419334a76dc24e/tests%2Fui%2Fconsts%2Fconst-err-late.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fconsts%2Fconst-err-late.stderr?ref=8a515aab76009e302efc52de54419334a76dc24e", "patch": "@@ -28,12 +28,6 @@ note: erroneous constant used\n LL |     black_box((S::<i32>::FOO, S::<u32>::FOO));\n    |                ^^^^^^^^^^^^^\n \n-note: erroneous constant used\n-  --> $DIR/const-err-late.rs:19:16\n-   |\n-LL |     black_box((S::<i32>::FOO, S::<u32>::FOO));\n-   |                ^^^^^^^^^^^^^\n-\n error: aborting due to 2 previous errors\n \n For more information about this error, try `rustc --explain E0080`."}, {"sha": "f3952809e4bb47b780ed7bd13ef68708e9ec146e", "filename": "tests/ui/consts/const-eval/issue-44578.stderr", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8a515aab76009e302efc52de54419334a76dc24e/tests%2Fui%2Fconsts%2Fconst-eval%2Fissue-44578.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8a515aab76009e302efc52de54419334a76dc24e/tests%2Fui%2Fconsts%2Fconst-eval%2Fissue-44578.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fconsts%2Fconst-eval%2Fissue-44578.stderr?ref=8a515aab76009e302efc52de54419334a76dc24e", "patch": "@@ -26,14 +26,6 @@ LL |     println!(\"{}\", <Bar<u16, u8> as Foo>::AMT);\n    |\n    = note: this note originates in the macro `$crate::format_args_nl` which comes from the expansion of the macro `println` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n-note: erroneous constant used\n-  --> $DIR/issue-44578.rs:25:20\n-   |\n-LL |     println!(\"{}\", <Bar<u16, u8> as Foo>::AMT);\n-   |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-   = note: this note originates in the macro `$crate::format_args_nl` which comes from the expansion of the macro `println` (in Nightly builds, run with -Z macro-backtrace for more info)\n-\n error: aborting due to previous error\n \n For more information about this error, try `rustc --explain E0080`."}, {"sha": "8e22cb74bf56aca7f4138f2cb24fd98e4ae3c789", "filename": "tests/ui/consts/miri_unleashed/assoc_const.stderr", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8a515aab76009e302efc52de54419334a76dc24e/tests%2Fui%2Fconsts%2Fmiri_unleashed%2Fassoc_const.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8a515aab76009e302efc52de54419334a76dc24e/tests%2Fui%2Fconsts%2Fmiri_unleashed%2Fassoc_const.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fconsts%2Fmiri_unleashed%2Fassoc_const.stderr?ref=8a515aab76009e302efc52de54419334a76dc24e", "patch": "@@ -25,12 +25,6 @@ note: erroneous constant used\n LL |     let y = <String as Bar<Vec<u32>, String>>::F;\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-note: erroneous constant used\n-  --> $DIR/assoc_const.rs:29:13\n-   |\n-LL |     let y = <String as Bar<Vec<u32>, String>>::F;\n-   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n warning: skipping const checks\n    |\n help: skipping check that does not even have a feature gate"}, {"sha": "ae7b03fc9dde3bef1e2b9f8b75a128da3008c795", "filename": "tests/ui/consts/miri_unleashed/assoc_const_2.stderr", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8a515aab76009e302efc52de54419334a76dc24e/tests%2Fui%2Fconsts%2Fmiri_unleashed%2Fassoc_const_2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8a515aab76009e302efc52de54419334a76dc24e/tests%2Fui%2Fconsts%2Fmiri_unleashed%2Fassoc_const_2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fconsts%2Fmiri_unleashed%2Fassoc_const_2.stderr?ref=8a515aab76009e302efc52de54419334a76dc24e", "patch": "@@ -16,12 +16,6 @@ note: erroneous constant used\n LL |     let y = <String as Bar<String>>::F;\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-note: erroneous constant used\n-  --> $DIR/assoc_const_2.rs:27:13\n-   |\n-LL |     let y = <String as Bar<String>>::F;\n-   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n error: aborting due to previous error\n \n For more information about this error, try `rustc --explain E0080`."}, {"sha": "adefbf336c2498be605a5d34046a28583521acd2", "filename": "tests/ui/consts/uninhabited-const-issue-61744.stderr", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8a515aab76009e302efc52de54419334a76dc24e/tests%2Fui%2Fconsts%2Funinhabited-const-issue-61744.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8a515aab76009e302efc52de54419334a76dc24e/tests%2Fui%2Fconsts%2Funinhabited-const-issue-61744.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fconsts%2Funinhabited-const-issue-61744.stderr?ref=8a515aab76009e302efc52de54419334a76dc24e", "patch": "@@ -657,12 +657,6 @@ note: erroneous constant used\n LL |     dbg!(i32::CONSTANT);\n    |          ^^^^^^^^^^^^^\n \n-note: erroneous constant used\n-  --> $DIR/uninhabited-const-issue-61744.rs:18:10\n-   |\n-LL |     dbg!(i32::CONSTANT);\n-   |          ^^^^^^^^^^^^^\n-\n error: aborting due to previous error\n \n For more information about this error, try `rustc --explain E0080`."}, {"sha": "510b36edd8f478d02baef4c31e1977c6e5c9abcf", "filename": "tests/ui/limits/issue-55878.stderr", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8a515aab76009e302efc52de54419334a76dc24e/tests%2Fui%2Flimits%2Fissue-55878.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8a515aab76009e302efc52de54419334a76dc24e/tests%2Fui%2Flimits%2Fissue-55878.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flimits%2Fissue-55878.stderr?ref=8a515aab76009e302efc52de54419334a76dc24e", "patch": "@@ -25,14 +25,6 @@ LL |     println!(\"Size: {}\", std::mem::size_of::<[u8; u64::MAX as usize]>());\n    |\n    = note: this note originates in the macro `$crate::format_args_nl` which comes from the expansion of the macro `println` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n-note: erroneous constant used\n-  --> $DIR/issue-55878.rs:7:26\n-   |\n-LL |     println!(\"Size: {}\", std::mem::size_of::<[u8; u64::MAX as usize]>());\n-   |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-   = note: this note originates in the macro `$crate::format_args_nl` which comes from the expansion of the macro `println` (in Nightly builds, run with -Z macro-backtrace for more info)\n-\n error: aborting due to previous error\n \n For more information about this error, try `rustc --explain E0080`."}]}