{"sha": "8f30179f8256142651f8e65405dc4541391405ed", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhmMzAxNzlmODI1NjE0MjY1MWY4ZTY1NDA1ZGM0NTQxMzkxNDA1ZWQ=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2018-09-05T15:28:21Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2018-09-05T15:28:21Z"}, "message": "Merge #57\n\n57: less hacky paths r=matklad a=matklad\n\n\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "09abb27e1ec29d39bc04e188bd913cec56af34ac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/09abb27e1ec29d39bc04e188bd913cec56af34ac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8f30179f8256142651f8e65405dc4541391405ed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8f30179f8256142651f8e65405dc4541391405ed", "html_url": "https://github.com/rust-lang/rust/commit/8f30179f8256142651f8e65405dc4541391405ed", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8f30179f8256142651f8e65405dc4541391405ed/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "ad451686a807cf5f86826c80ad22c04c559a8589", "url": "https://api.github.com/repos/rust-lang/rust/commits/ad451686a807cf5f86826c80ad22c04c559a8589", "html_url": "https://github.com/rust-lang/rust/commit/ad451686a807cf5f86826c80ad22c04c559a8589"}, {"sha": "d0e22d7578bc789748b784bd72f338908e10d611", "url": "https://api.github.com/repos/rust-lang/rust/commits/d0e22d7578bc789748b784bd72f338908e10d611", "html_url": "https://github.com/rust-lang/rust/commit/d0e22d7578bc789748b784bd72f338908e10d611"}], "stats": {"total": 21, "additions": 9, "deletions": 12}, "files": [{"sha": "1f210f579ee95ec4e7813e6647f17f27890085a6", "filename": "crates/libanalysis/tests/tests.rs", "status": "modified", "additions": 9, "deletions": 12, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/8f30179f8256142651f8e65405dc4541391405ed/crates%2Flibanalysis%2Ftests%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f30179f8256142651f8e65405dc4541391405ed/crates%2Flibanalysis%2Ftests%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Flibanalysis%2Ftests%2Ftests.rs?ref=8f30179f8256142651f8e65405dc4541391405ed", "patch": "@@ -7,7 +7,7 @@ use std::{\n     path::{Path},\n };\n \n-use relative_path::RelativePath;\n+use relative_path::{RelativePath, RelativePathBuf};\n use libanalysis::{AnalysisHost, FileId, FileResolver, JobHandle, CrateGraph, CrateId};\n use test_utils::assert_eq_dbg;\n \n@@ -28,18 +28,15 @@ impl FileResolver for FileMap {\n         self.path(id).file_stem().unwrap().to_str().unwrap().to_string()\n     }\n     fn resolve(&self, id: FileId, rel: &RelativePath) -> Option<FileId> {\n-        let path = {\n-            if rel.starts_with(\"..\") {\n-                rel.strip_prefix(\"..\").unwrap()\n-                    .to_path(&self.path(id).parent().unwrap())\n-            } else {\n-                rel.to_path(self.path(id))\n-            }\n-        };\n-        let path = &path.to_str().unwrap()[1..];\n-        let path = RelativePath::new(&path[0..]).normalize();\n+        let path = rel.to_path(self.path(id));\n+        let path = path.strip_prefix(\"/\").unwrap();\n+        let path = RelativePathBuf::from_path(&path).unwrap().normalize();\n         let &(id, _) = self.0.iter()\n-            .find(|it| path == RelativePath::new(&it.1[0..]).normalize())?;\n+            .find(|it| {\n+                let p = Path::new(it.1).strip_prefix(\"/\").unwrap();\n+                let p = RelativePathBuf::from_path(p).unwrap();\n+                path == p\n+            })?;\n         Some(FileId(id))\n     }\n }"}]}