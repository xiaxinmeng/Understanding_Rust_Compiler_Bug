{"sha": "47ea57feadb6d05241fad064434c28c48e31b7fc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ3ZWE1N2ZlYWRiNmQwNTI0MWZhZDA2NDQzNGMyOGM0OGUzMWI3ZmM=", "commit": {"author": {"name": "Haitao Li", "email": "lihaitao@gmail.com", "date": "2011-12-05T06:56:11Z"}, "committer": {"name": "Haitao Li", "email": "lihaitao@gmail.com", "date": "2011-12-05T09:21:20Z"}, "message": "rustc: Add suffix \".rc\" to LLVM module identifier\n\nLLVM code generator emits the \".file filename\" directive for ELF\nbackends. Value of the \"filename\" is set as the LLVM module identifier.\nDue to a LLVM MC bug[1], LLVM crashes if the module identifer is same as\nother symbols such as a function name in the module.\n\nThis patch adds a \".rc\" suffix (means crates) to LLVM module identifier\nto workaround the bug.\n\nFixes issue #1251.\n\n1. http://llvm.org/bugs/show_bug.cgi?id=11479", "tree": {"sha": "88bf76125ea5c20b1536ce024f5b15b69497bb6e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/88bf76125ea5c20b1536ce024f5b15b69497bb6e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/47ea57feadb6d05241fad064434c28c48e31b7fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/47ea57feadb6d05241fad064434c28c48e31b7fc", "html_url": "https://github.com/rust-lang/rust/commit/47ea57feadb6d05241fad064434c28c48e31b7fc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/47ea57feadb6d05241fad064434c28c48e31b7fc/comments", "author": {"login": "lht", "id": 19508, "node_id": "MDQ6VXNlcjE5NTA4", "avatar_url": "https://avatars.githubusercontent.com/u/19508?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lht", "html_url": "https://github.com/lht", "followers_url": "https://api.github.com/users/lht/followers", "following_url": "https://api.github.com/users/lht/following{/other_user}", "gists_url": "https://api.github.com/users/lht/gists{/gist_id}", "starred_url": "https://api.github.com/users/lht/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lht/subscriptions", "organizations_url": "https://api.github.com/users/lht/orgs", "repos_url": "https://api.github.com/users/lht/repos", "events_url": "https://api.github.com/users/lht/events{/privacy}", "received_events_url": "https://api.github.com/users/lht/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lht", "id": 19508, "node_id": "MDQ6VXNlcjE5NTA4", "avatar_url": "https://avatars.githubusercontent.com/u/19508?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lht", "html_url": "https://github.com/lht", "followers_url": "https://api.github.com/users/lht/followers", "following_url": "https://api.github.com/users/lht/following{/other_user}", "gists_url": "https://api.github.com/users/lht/gists{/gist_id}", "starred_url": "https://api.github.com/users/lht/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lht/subscriptions", "organizations_url": "https://api.github.com/users/lht/orgs", "repos_url": "https://api.github.com/users/lht/repos", "events_url": "https://api.github.com/users/lht/events{/privacy}", "received_events_url": "https://api.github.com/users/lht/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "52d7dc5e0a218f1495da2057ac064811853a4c9c", "url": "https://api.github.com/repos/rust-lang/rust/commits/52d7dc5e0a218f1495da2057ac064811853a4c9c", "html_url": "https://github.com/rust-lang/rust/commit/52d7dc5e0a218f1495da2057ac064811853a4c9c"}], "stats": {"total": 20, "additions": 19, "deletions": 1}, "files": [{"sha": "3ea355d2cb9dae0157ba0d6fac7e15ee7b6822b3", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/47ea57feadb6d05241fad064434c28c48e31b7fc/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47ea57feadb6d05241fad064434c28c48e31b7fc/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=47ea57feadb6d05241fad064434c28c48e31b7fc", "patch": "@@ -6059,7 +6059,18 @@ fn trans_crate(sess: session::session, crate: @ast::crate, tcx: ty::ctxt,\n     -> ModuleRef {\n     let sha = std::sha1::mk_sha1();\n     let link_meta = link::build_link_meta(sess, *crate, output, sha);\n-    let llmod = str::as_buf(link_meta.name, {|buf|\n+\n+    // Append \".rc\" to crate name as LLVM module identifier.\n+    //\n+    // LLVM code generator emits a \".file filename\" directive\n+    // for ELF backends. Value of the \"filename\" is set as the\n+    // LLVM module identifier.  Due to a LLVM MC bug[1], LLVM\n+    // crashes if the module identifer is same as other symbols\n+    // such as a function name in the module. \n+    // 1. http://llvm.org/bugs/show_bug.cgi?id=11479\n+    let llmod_id = link_meta.name + \".rc\";\n+\n+    let llmod = str::as_buf(llmod_id, {|buf|\n         llvm::LLVMModuleCreateWithNameInContext\n             (buf, llvm::LLVMGetGlobalContext())\n     });"}, {"sha": "69e54f4a95d7df3496f2b673a4cf9d3d9c814bef", "filename": "src/test/run-pass/issue-1251.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/47ea57feadb6d05241fad064434c28c48e31b7fc/src%2Ftest%2Frun-pass%2Fissue-1251.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47ea57feadb6d05241fad064434c28c48e31b7fc/src%2Ftest%2Frun-pass%2Fissue-1251.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-1251.rs?ref=47ea57feadb6d05241fad064434c28c48e31b7fc", "patch": "@@ -0,0 +1,7 @@\n+#[link(name = \"unsupervise\")];\n+\n+native mod rustrt {\n+      fn unsupervise();\n+}\n+\n+fn main() { }"}]}