{"sha": "06228d33cac6770653d6798cf5f80d1269e5482d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA2MjI4ZDMzY2FjNjc3MDY1M2Q2Nzk4Y2Y1ZjgwZDEyNjllNTQ4MmQ=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2019-07-24T15:50:48Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2019-08-28T09:56:21Z"}, "message": "Save crate filtering on rustdoc", "tree": {"sha": "5a6d0e00626d2dd4e524a27f5bc6bf78336cdf95", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5a6d0e00626d2dd4e524a27f5bc6bf78336cdf95"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/06228d33cac6770653d6798cf5f80d1269e5482d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/06228d33cac6770653d6798cf5f80d1269e5482d", "html_url": "https://github.com/rust-lang/rust/commit/06228d33cac6770653d6798cf5f80d1269e5482d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/06228d33cac6770653d6798cf5f80d1269e5482d/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f86521e0a33a2b54c4c23dbfc5250013f7a33b11", "url": "https://api.github.com/repos/rust-lang/rust/commits/f86521e0a33a2b54c4c23dbfc5250013f7a33b11", "html_url": "https://github.com/rust-lang/rust/commit/f86521e0a33a2b54c4c23dbfc5250013f7a33b11"}], "stats": {"total": 22, "additions": 19, "deletions": 3}, "files": [{"sha": "1dd8b0ad686f5a31bf6fcf124e2803451a565f56", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 18, "deletions": 2, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/06228d33cac6770653d6798cf5f80d1269e5482d/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/06228d33cac6770653d6798cf5f80d1269e5482d/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=06228d33cac6770653d6798cf5f80d1269e5482d", "patch": "@@ -445,6 +445,21 @@ if (!DOMTokenList.prototype.remove) {\n         var OUTPUT_DATA = 1;\n         var params = getQueryStringParams();\n \n+        // Set the crate filter from saved storage, if the current page has the saved crate filter.\n+        //\n+        // If not, ignore the crate filter -- we want to support filtering for crates on sites like\n+        // doc.rust-lang.org where the crates may differ from page to page while on the same domain.\n+        var savedCrate = getCurrentValue(\"rustdoc-saved-filter-crate\");\n+        if (savedCrate !== null) {\n+            onEachLazy(document.getElementById(\"crate-search\").getElementsByTagName(\"option\"),\n+                       function(e) {\n+                if (e.value === savedCrate) {\n+                    document.getElementById(\"crate-search\").value = e.value;\n+                    return true;\n+                }\n+            });\n+        }\n+\n         // Populate search bar with query string search term when provided,\n         // but only if the input bar is empty. This avoid the obnoxious issue\n         // where you start trying to do a search, and the index loads, and\n@@ -1658,9 +1673,10 @@ if (!DOMTokenList.prototype.remove) {\n             };\n             search_input.onpaste = search_input.onchange;\n \n-            var selectCrate = document.getElementById('crate-search');\n+            var selectCrate = document.getElementById(\"crate-search\");\n             if (selectCrate) {\n                 selectCrate.onchange = function() {\n+                    updateLocalStorage(\"rustdoc-saved-filter-crate\", selectCrate.value);\n                     search(undefined, true);\n                 };\n             }\n@@ -2496,7 +2512,7 @@ if (!DOMTokenList.prototype.remove) {\n     }\n \n     function addSearchOptions(crates) {\n-        var elem = document.getElementById('crate-search');\n+        var elem = document.getElementById(\"crate-search\");\n \n         if (!elem) {\n             return;"}, {"sha": "dd16664395bb2b0b623ab82d00a5270140238d94", "filename": "src/librustdoc/html/static/storage.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/06228d33cac6770653d6798cf5f80d1269e5482d/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js", "raw_url": "https://github.com/rust-lang/rust/raw/06228d33cac6770653d6798cf5f80d1269e5482d/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fstorage.js?ref=06228d33cac6770653d6798cf5f80d1269e5482d", "patch": "@@ -57,7 +57,7 @@ function onEachLazy(lazyArray, func, reversed) {\n \n function usableLocalStorage() {\n     // Check if the browser supports localStorage at all:\n-    if (typeof(Storage) === \"undefined\") {\n+    if (typeof Storage === \"undefined\") {\n         return false;\n     }\n     // Check if we can access it; this access will fail if the browser"}]}