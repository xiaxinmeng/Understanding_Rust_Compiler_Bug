{"sha": "810ed98d08158574e98b504c0955fce6c6a72ad9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgxMGVkOThkMDgxNTg1NzRlOThiNTA0YzA5NTVmY2U2YzZhNzJhZDk=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-04-28T22:28:11Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-04-28T22:28:11Z"}, "message": "Auto merge of #41542 - petrochenkov:objpars2, r=nikomatsakis\n\nsyntax: Parse trait object types starting with a lifetime bound\n\nFixes https://github.com/rust-lang/rust/issues/39085\n\nThis was originally implemented in https://github.com/rust-lang/rust/pull/40043, then reverted, then there was some [agreement](https://github.com/rust-lang/rust/issues/39318#issuecomment-289108720) that it should be supported.\n(This is hopefully the last PR related to bound parsing.)", "tree": {"sha": "afc14f78d61b4ba2404af0b25f23dd9753a020f1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/afc14f78d61b4ba2404af0b25f23dd9753a020f1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/810ed98d08158574e98b504c0955fce6c6a72ad9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/810ed98d08158574e98b504c0955fce6c6a72ad9", "html_url": "https://github.com/rust-lang/rust/commit/810ed98d08158574e98b504c0955fce6c6a72ad9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/810ed98d08158574e98b504c0955fce6c6a72ad9/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "128aa262e8fe445f5c4d5c1f15dd28a2007c0234", "url": "https://api.github.com/repos/rust-lang/rust/commits/128aa262e8fe445f5c4d5c1f15dd28a2007c0234", "html_url": "https://github.com/rust-lang/rust/commit/128aa262e8fe445f5c4d5c1f15dd28a2007c0234"}, {"sha": "d349e87d61745d402f6e38727beb62a6525a2153", "url": "https://api.github.com/repos/rust-lang/rust/commits/d349e87d61745d402f6e38727beb62a6525a2153", "html_url": "https://github.com/rust-lang/rust/commit/d349e87d61745d402f6e38727beb62a6525a2153"}], "stats": {"total": 80, "additions": 78, "deletions": 2}, "files": [{"sha": "84d53dbef7c884ae6f2b95205f646f7db8b9e4f9", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/810ed98d08158574e98b504c0955fce6c6a72ad9/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/810ed98d08158574e98b504c0955fce6c6a72ad9/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=810ed98d08158574e98b504c0955fce6c6a72ad9", "patch": "@@ -1453,9 +1453,9 @@ impl<'a> Parser<'a> {\n         } else if self.eat_keyword(keywords::Impl) {\n             // FIXME: figure out priority of `+` in `impl Trait1 + Trait2` (#34511).\n             TyKind::ImplTrait(self.parse_ty_param_bounds()?)\n-        } else if self.check(&token::Question) {\n+        } else if self.check(&token::Question) ||\n+                  self.check_lifetime() && self.look_ahead(1, |t| t == &token::BinOp(token::Plus)){\n             // Bound list (trait object type)\n-            // Bound lists starting with `'lt` are not currently supported (#40043)\n             TyKind::TraitObject(self.parse_ty_param_bounds_common(allow_plus)?)\n         } else {\n             let msg = format!(\"expected type, found {}\", self.this_token_descr());"}, {"sha": "8497a699e974c3b130b12879b482ee9fdeb95dcd", "filename": "src/test/compile-fail/trait-object-macro-matcher.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/810ed98d08158574e98b504c0955fce6c6a72ad9/src%2Ftest%2Fcompile-fail%2Ftrait-object-macro-matcher.rs", "raw_url": "https://github.com/rust-lang/rust/raw/810ed98d08158574e98b504c0955fce6c6a72ad9/src%2Ftest%2Fcompile-fail%2Ftrait-object-macro-matcher.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Ftrait-object-macro-matcher.rs?ref=810ed98d08158574e98b504c0955fce6c6a72ad9", "patch": "@@ -16,4 +16,6 @@ macro_rules! m {\n \n fn main() {\n     m!(Copy + Send + 'static); //~ ERROR the trait `std::marker::Copy` cannot be made into an object\n+    m!('static + Send);\n+    m!('static +); //~ ERROR at least one non-builtin trait is required for an object type\n }"}, {"sha": "9801cac4714434a168b2614bfadd221fe730c27c", "filename": "src/test/compile-fail/trait-object-vs-lifetime-2.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/810ed98d08158574e98b504c0955fce6c6a72ad9/src%2Ftest%2Fcompile-fail%2Ftrait-object-vs-lifetime-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/810ed98d08158574e98b504c0955fce6c6a72ad9/src%2Ftest%2Fcompile-fail%2Ftrait-object-vs-lifetime-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Ftrait-object-vs-lifetime-2.rs?ref=810ed98d08158574e98b504c0955fce6c6a72ad9", "patch": "@@ -0,0 +1,23 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// A few contrived examples where lifetime should (or should not) be parsed as an object type.\n+// Lifetimes parsed as types are still rejected later by semantic checks.\n+\n+// compile-flags: -Z continue-parse-after-error\n+\n+// `'static` is a lifetime, `'static +` is a type, `'a` is a type\n+fn g() where\n+    'static: 'static,\n+    'static +: 'static + Copy,\n+    //~^ ERROR at least one non-builtin trait is required for an object type\n+{}\n+\n+fn main() {}"}, {"sha": "a70141edc29f277922c4ada64c3306eea8f32a42", "filename": "src/test/compile-fail/trait-object-vs-lifetime.rs", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/810ed98d08158574e98b504c0955fce6c6a72ad9/src%2Ftest%2Fcompile-fail%2Ftrait-object-vs-lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/810ed98d08158574e98b504c0955fce6c6a72ad9/src%2Ftest%2Fcompile-fail%2Ftrait-object-vs-lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Ftrait-object-vs-lifetime.rs?ref=810ed98d08158574e98b504c0955fce6c6a72ad9", "patch": "@@ -0,0 +1,29 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// A few contrived examples where lifetime should (or should not) be parsed as an object type.\n+// Lifetimes parsed as types are still rejected later by semantic checks.\n+\n+// compile-flags: -Z continue-parse-after-error\n+\n+struct S<'a, T>(&'a u8, T);\n+\n+fn main() {\n+    // `'static` is a lifetime argument, `'static +` is a type argument\n+    let _: S<'static, u8>;\n+    let _: S<'static, 'static +>;\n+    //~^ at least one non-builtin trait is required for an object type\n+    let _: S<'static, 'static>;\n+    //~^ ERROR wrong number of lifetime parameters: expected 1, found 2\n+    //~| ERROR wrong number of type arguments: expected 1, found 0\n+    let _: S<'static +, 'static>;\n+    //~^ ERROR lifetime parameters must be declared prior to type parameters\n+    //~| ERROR at least one non-builtin trait is required for an object type\n+}"}, {"sha": "f269fe90d4b4e0b98b5261ae286dfc69b77e2381", "filename": "src/test/run-pass/trait-object-lifetime-first.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/810ed98d08158574e98b504c0955fce6c6a72ad9/src%2Ftest%2Frun-pass%2Ftrait-object-lifetime-first.rs", "raw_url": "https://github.com/rust-lang/rust/raw/810ed98d08158574e98b504c0955fce6c6a72ad9/src%2Ftest%2Frun-pass%2Ftrait-object-lifetime-first.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Ftrait-object-lifetime-first.rs?ref=810ed98d08158574e98b504c0955fce6c6a72ad9", "patch": "@@ -0,0 +1,22 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+use std::fmt::Display;\n+\n+static BYTE: u8 = 33;\n+\n+fn main() {\n+    let x: &('static + Display) = &BYTE;\n+    let y: Box<'static + Display> = Box::new(BYTE);\n+    let xstr = format!(\"{}\", x);\n+    let ystr = format!(\"{}\", y);\n+    assert_eq!(xstr, \"33\");\n+    assert_eq!(ystr, \"33\");\n+}"}]}