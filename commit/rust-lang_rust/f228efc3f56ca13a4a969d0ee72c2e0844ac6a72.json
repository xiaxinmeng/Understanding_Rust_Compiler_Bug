{"sha": "f228efc3f56ca13a4a969d0ee72c2e0844ac6a72", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYyMjhlZmMzZjU2Y2ExM2E0YTk2OWQwZWU3MmMyZTA4NDRhYzZhNzI=", "commit": {"author": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2020-10-18T20:29:40Z"}, "committer": {"name": "Mara Bos", "email": "m-ou.se@m-ou.se", "date": "2020-10-18T20:29:40Z"}, "message": "Make panic_fmt lint work properly for assert!(expr, msg) too.", "tree": {"sha": "82fd5a320a0030973258dfaaf0f30bdc9b3b349c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/82fd5a320a0030973258dfaaf0f30bdc9b3b349c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f228efc3f56ca13a4a969d0ee72c2e0844ac6a72", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f228efc3f56ca13a4a969d0ee72c2e0844ac6a72", "html_url": "https://github.com/rust-lang/rust/commit/f228efc3f56ca13a4a969d0ee72c2e0844ac6a72", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f228efc3f56ca13a4a969d0ee72c2e0844ac6a72/comments", "author": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "committer": {"login": "m-ou-se", "id": 783247, "node_id": "MDQ6VXNlcjc4MzI0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/783247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ou-se", "html_url": "https://github.com/m-ou-se", "followers_url": "https://api.github.com/users/m-ou-se/followers", "following_url": "https://api.github.com/users/m-ou-se/following{/other_user}", "gists_url": "https://api.github.com/users/m-ou-se/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ou-se/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ou-se/subscriptions", "organizations_url": "https://api.github.com/users/m-ou-se/orgs", "repos_url": "https://api.github.com/users/m-ou-se/repos", "events_url": "https://api.github.com/users/m-ou-se/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ou-se/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "da66a501f6423d498627453dd7d0f8bc874ee42d", "url": "https://api.github.com/repos/rust-lang/rust/commits/da66a501f6423d498627453dd7d0f8bc874ee42d", "html_url": "https://github.com/rust-lang/rust/commit/da66a501f6423d498627453dd7d0f8bc874ee42d"}], "stats": {"total": 14, "additions": 14, "deletions": 0}, "files": [{"sha": "198797974ff0ca170d9c0728a915c53114f39cf0", "filename": "compiler/rustc_lint/src/panic_fmt.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f228efc3f56ca13a4a969d0ee72c2e0844ac6a72/compiler%2Frustc_lint%2Fsrc%2Fpanic_fmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f228efc3f56ca13a4a969d0ee72c2e0844ac6a72/compiler%2Frustc_lint%2Fsrc%2Fpanic_fmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fpanic_fmt.rs?ref=f228efc3f56ca13a4a969d0ee72c2e0844ac6a72", "patch": "@@ -53,6 +53,18 @@ fn check_panic<'tcx>(cx: &LateContext<'tcx>, f: &'tcx hir::Expr<'tcx>, arg: &'tc\n                     if cx.tcx.is_diagnostic_item(sym::std_panic_macro, id)\n                         || cx.tcx.is_diagnostic_item(sym::core_panic_macro, id)\n                     {\n+                        let expn = {\n+                            // Unwrap another level of macro expansion if this\n+                            // panic!() was expanded from assert!().\n+                            let parent = expn.call_site.ctxt().outer_expn_data();\n+                            if parent.macro_def_id.map_or(false, |id| {\n+                                cx.tcx.is_diagnostic_item(sym::assert_macro, id)\n+                            }) {\n+                                parent\n+                            } else {\n+                                expn\n+                            }\n+                        };\n                         cx.struct_span_lint(PANIC_FMT, expn.call_site, |lint| {\n                             let mut l = lint.build(\"Panic message contains a brace\");\n                             l.note(\"This message is not used as a format string, but will be in a future Rust version\");"}, {"sha": "c6949d9387c20bcc1cd44ddafec4c970bf4922e9", "filename": "compiler/rustc_span/src/symbol.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f228efc3f56ca13a4a969d0ee72c2e0844ac6a72/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f228efc3f56ca13a4a969d0ee72c2e0844ac6a72/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs?ref=f228efc3f56ca13a4a969d0ee72c2e0844ac6a72", "patch": "@@ -267,6 +267,7 @@ symbols! {\n         asm,\n         assert,\n         assert_inhabited,\n+        assert_macro,\n         assert_receiver_is_total_eq,\n         assert_uninit_valid,\n         assert_zero_valid,"}, {"sha": "9f28186a33c15ada7cdf4ac5a83e85cb2f494238", "filename": "library/core/src/macros/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f228efc3f56ca13a4a969d0ee72c2e0844ac6a72/library%2Fcore%2Fsrc%2Fmacros%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f228efc3f56ca13a4a969d0ee72c2e0844ac6a72/library%2Fcore%2Fsrc%2Fmacros%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fmacros%2Fmod.rs?ref=f228efc3f56ca13a4a969d0ee72c2e0844ac6a72", "patch": "@@ -1216,6 +1216,7 @@ pub(crate) mod builtin {\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n     #[rustc_builtin_macro]\n     #[macro_export]\n+    #[rustc_diagnostic_item = \"assert_macro\"]\n     macro_rules! assert {\n         ($cond:expr $(,)?) => {{ /* compiler built-in */ }};\n         ($cond:expr, $($arg:tt)+) => {{ /* compiler built-in */ }};"}]}