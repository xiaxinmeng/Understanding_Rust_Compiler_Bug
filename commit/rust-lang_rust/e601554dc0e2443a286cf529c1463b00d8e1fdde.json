{"sha": "e601554dc0e2443a286cf529c1463b00d8e1fdde", "node_id": "C_kwDOAAsO6NoAKGU2MDE1NTRkYzBlMjQ0M2EyODZjZjUyOWMxNDYzYjAwZDhlMWZkZGU", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-09-28T18:00:15Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-09-28T18:00:15Z"}, "message": "Rollup merge of #89235 - yaahc:junit-formatting, r=kennytm\n\nmake junit output more consistent with default format\n\nThe default format of libtest includes new-lines between each section to ensure the label output from cargo is on it's own line\n\n<pre><font color=\"#A1B56C\"><b>\u276f</b></font> <font color=\"#A1B56C\">cargo</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">test</font>\n<font color=\"#A1B56C\"><b>   Compiling</b></font> test-test v0.1.0 (/home/jlusby/tmp/test-test)\n<font color=\"#A1B56C\"><b>    Finished</b></font> test [unoptimized + debuginfo] target(s) in 0.59s\n<font color=\"#A1B56C\"><b>     Running</b></font> unittests (target/debug/deps/test_test-639f369234319c09)\n\nrunning 1 test\ntest tests::it_works ... <font color=\"#A1B56C\">ok</font>\n\ntest result: <font color=\"#A1B56C\">ok</font>. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n<font color=\"#A1B56C\"><b>   Doc-tests</b></font> test-test\n\nrunning 0 tests\n\ntest result: <font color=\"#A1B56C\">ok</font>. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n</pre>\n\nBut when the junit outputter was added to libtest these newlines were omitted, resulting in some \"fun\" output when run via cargo.\n\nNote the `Doc-tests` text at the end of the first line of xml.\n\n<pre><font color=\"#A1B56C\"><b>\u276f</b></font> <font color=\"#A1B56C\">cargo</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">test</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">--</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">-Zunstable-options</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">--format</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">junit</font>\n<font color=\"#A1B56C\"><b>    Finished</b></font> test [unoptimized + debuginfo] target(s) in 0.00s\n<font color=\"#A1B56C\"><b>     Running</b></font> unittests (target/debug/deps/test_test-639f369234319c09)\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;testsuites&gt;&lt;testsuite name=&quot;test&quot; package=&quot;test&quot; id=&quot;0&quot; errors=&quot;0&quot; failures=&quot;0&quot; tests=&quot;1&quot; skipped=&quot;0&quot; &gt;&lt;testcase classname=&quot;tests&quot; name=&quot;it_works&quot; time=&quot;0&quot;/&gt;&lt;system-out/&gt;&lt;system-err/&gt;&lt;/testsuite&gt;&lt;/testsuites&gt;<font color=\"#A1B56C\"><b>   Doc-tests</b></font> test-test\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;testsuites&gt;&lt;testsuite name=&quot;test&quot; package=&quot;test&quot; id=&quot;0&quot; errors=&quot;0&quot; failures=&quot;0&quot; tests=&quot;0&quot; skipped=&quot;0&quot; &gt;&lt;system-out/&gt;&lt;system-err/&gt;&lt;/testsuite&gt;&lt;/testsuites&gt;\n\n</pre>\n\nAfter this PR the junit output includes the same style of newlines as the pretty format\n\n<pre><font color=\"#A1B56C\"><b>\u276f</b></font> <font color=\"#A1B56C\">cargo</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">test</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">--</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">-Zunstable-options</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">--format</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">junit</font>\n<font color=\"#A1B56C\"><b>   Compiling</b></font> test-test v0.1.0 (/home/jlusby/tmp/test-test)\n<font color=\"#A1B56C\"><b>    Finished</b></font> test [unoptimized + debuginfo] target(s) in 0.39s\n<font color=\"#A1B56C\"><b>     Running</b></font> unittests (target/debug/deps/test_test-42c2320bb9450c69)\n\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;testsuites&gt;&lt;testsuite name=&quot;test&quot; package=&quot;test&quot; id=&quot;0&quot; errors=&quot;0&quot; failures=&quot;0&quot; tests=&quot;1&quot; skipped=&quot;0&quot; &gt;&lt;testcase classname=&quot;tests&quot; name=&quot;it_works&quot; time=&quot;0&quot;/&gt;&lt;system-out/&gt;&lt;system-err/&gt;&lt;/testsuite&gt;&lt;/testsuites&gt;\n\n<font color=\"#A1B56C\"><b>   Doc-tests</b></font> test-test\n\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;testsuites&gt;&lt;testsuite name=&quot;test&quot; package=&quot;test&quot; id=&quot;0&quot; errors=&quot;0&quot; failures=&quot;0&quot; tests=&quot;0&quot; skipped=&quot;0&quot; &gt;&lt;system-out/&gt;&lt;system-err/&gt;&lt;/testsuite&gt;&lt;/testsuites&gt;\n\n</pre>", "tree": {"sha": "de7103745dbb021f425bfd5df1d0e6a1b4c5264c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/de7103745dbb021f425bfd5df1d0e6a1b4c5264c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e601554dc0e2443a286cf529c1463b00d8e1fdde", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhU1gvCRBK7hj4Ov3rIwAA2BAIAFVInw9SQuva2n5ZLqh5gawU\nri19WVZ2N9HjLQd4G9VdfLmaWD2ATtWPB1NdB1JrMBdJWVGj8X+VSP4unS3Cx4j5\n9lvPdMvGkKTSLK5V1YrlLEta9sWo7R0kqiON3U9unwig69cQlkWkTZe5dLNzBvUS\nS9AQor0GYH6ehBpyPhrb91cp4HVodA37X2M0fgQH0IWo7WsCi5uDxfQ1MM4RmQMQ\n3OuGQTW8c8Cblrrjm0xbfZbSOcXWuhTaP4NCI2G8OACQSR8s0nKwFN1cXzjVHmEb\niOJEfrzp1jyZtCGN/T+8knzeJDZcDv8tY6V8oZ2PR39yjjUPyKmlYWRo9MMpHj0=\n=mLD1\n-----END PGP SIGNATURE-----\n", "payload": "tree de7103745dbb021f425bfd5df1d0e6a1b4c5264c\nparent 3c60e040b29c6b9cbf0ed1df31d7469d4634ac4d\nparent 0911069febd6c247594c26e41c2e5cf8ffb8a74f\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1632852015 +0200\ncommitter GitHub <noreply@github.com> 1632852015 +0200\n\nRollup merge of #89235 - yaahc:junit-formatting, r=kennytm\n\nmake junit output more consistent with default format\n\nThe default format of libtest includes new-lines between each section to ensure the label output from cargo is on it's own line\n\n<pre><font color=\"#A1B56C\"><b>\u276f</b></font> <font color=\"#A1B56C\">cargo</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">test</font>\n<font color=\"#A1B56C\"><b>   Compiling</b></font> test-test v0.1.0 (/home/jlusby/tmp/test-test)\n<font color=\"#A1B56C\"><b>    Finished</b></font> test [unoptimized + debuginfo] target(s) in 0.59s\n<font color=\"#A1B56C\"><b>     Running</b></font> unittests (target/debug/deps/test_test-639f369234319c09)\n\nrunning 1 test\ntest tests::it_works ... <font color=\"#A1B56C\">ok</font>\n\ntest result: <font color=\"#A1B56C\">ok</font>. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n<font color=\"#A1B56C\"><b>   Doc-tests</b></font> test-test\n\nrunning 0 tests\n\ntest result: <font color=\"#A1B56C\">ok</font>. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n</pre>\n\nBut when the junit outputter was added to libtest these newlines were omitted, resulting in some \"fun\" output when run via cargo.\n\nNote the `Doc-tests` text at the end of the first line of xml.\n\n<pre><font color=\"#A1B56C\"><b>\u276f</b></font> <font color=\"#A1B56C\">cargo</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">test</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">--</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">-Zunstable-options</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">--format</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">junit</font>\n<font color=\"#A1B56C\"><b>    Finished</b></font> test [unoptimized + debuginfo] target(s) in 0.00s\n<font color=\"#A1B56C\"><b>     Running</b></font> unittests (target/debug/deps/test_test-639f369234319c09)\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;testsuites&gt;&lt;testsuite name=&quot;test&quot; package=&quot;test&quot; id=&quot;0&quot; errors=&quot;0&quot; failures=&quot;0&quot; tests=&quot;1&quot; skipped=&quot;0&quot; &gt;&lt;testcase classname=&quot;tests&quot; name=&quot;it_works&quot; time=&quot;0&quot;/&gt;&lt;system-out/&gt;&lt;system-err/&gt;&lt;/testsuite&gt;&lt;/testsuites&gt;<font color=\"#A1B56C\"><b>   Doc-tests</b></font> test-test\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;testsuites&gt;&lt;testsuite name=&quot;test&quot; package=&quot;test&quot; id=&quot;0&quot; errors=&quot;0&quot; failures=&quot;0&quot; tests=&quot;0&quot; skipped=&quot;0&quot; &gt;&lt;system-out/&gt;&lt;system-err/&gt;&lt;/testsuite&gt;&lt;/testsuites&gt;\n\n</pre>\n\nAfter this PR the junit output includes the same style of newlines as the pretty format\n\n<pre><font color=\"#A1B56C\"><b>\u276f</b></font> <font color=\"#A1B56C\">cargo</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">test</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">--</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">-Zunstable-options</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">--format</font><font color=\"#D8D8D8\"> </font><font color=\"#A1B56C\">junit</font>\n<font color=\"#A1B56C\"><b>   Compiling</b></font> test-test v0.1.0 (/home/jlusby/tmp/test-test)\n<font color=\"#A1B56C\"><b>    Finished</b></font> test [unoptimized + debuginfo] target(s) in 0.39s\n<font color=\"#A1B56C\"><b>     Running</b></font> unittests (target/debug/deps/test_test-42c2320bb9450c69)\n\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;testsuites&gt;&lt;testsuite name=&quot;test&quot; package=&quot;test&quot; id=&quot;0&quot; errors=&quot;0&quot; failures=&quot;0&quot; tests=&quot;1&quot; skipped=&quot;0&quot; &gt;&lt;testcase classname=&quot;tests&quot; name=&quot;it_works&quot; time=&quot;0&quot;/&gt;&lt;system-out/&gt;&lt;system-err/&gt;&lt;/testsuite&gt;&lt;/testsuites&gt;\n\n<font color=\"#A1B56C\"><b>   Doc-tests</b></font> test-test\n\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;testsuites&gt;&lt;testsuite name=&quot;test&quot; package=&quot;test&quot; id=&quot;0&quot; errors=&quot;0&quot; failures=&quot;0&quot; tests=&quot;0&quot; skipped=&quot;0&quot; &gt;&lt;system-out/&gt;&lt;system-err/&gt;&lt;/testsuite&gt;&lt;/testsuites&gt;\n\n</pre>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e601554dc0e2443a286cf529c1463b00d8e1fdde", "html_url": "https://github.com/rust-lang/rust/commit/e601554dc0e2443a286cf529c1463b00d8e1fdde", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e601554dc0e2443a286cf529c1463b00d8e1fdde/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3c60e040b29c6b9cbf0ed1df31d7469d4634ac4d", "url": "https://api.github.com/repos/rust-lang/rust/commits/3c60e040b29c6b9cbf0ed1df31d7469d4634ac4d", "html_url": "https://github.com/rust-lang/rust/commit/3c60e040b29c6b9cbf0ed1df31d7469d4634ac4d"}, {"sha": "0911069febd6c247594c26e41c2e5cf8ffb8a74f", "url": "https://api.github.com/repos/rust-lang/rust/commits/0911069febd6c247594c26e41c2e5cf8ffb8a74f", "html_url": "https://github.com/rust-lang/rust/commit/0911069febd6c247594c26e41c2e5cf8ffb8a74f"}], "stats": {"total": 5, "additions": 4, "deletions": 1}, "files": [{"sha": "04057906d1c3e93c2731193b73a46165bc0b83dd", "filename": "library/test/src/formatters/junit.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e601554dc0e2443a286cf529c1463b00d8e1fdde/library%2Ftest%2Fsrc%2Fformatters%2Fjunit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e601554dc0e2443a286cf529c1463b00d8e1fdde/library%2Ftest%2Fsrc%2Fformatters%2Fjunit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Ftest%2Fsrc%2Fformatters%2Fjunit.rs?ref=e601554dc0e2443a286cf529c1463b00d8e1fdde", "patch": "@@ -29,7 +29,8 @@ impl<T: Write> JunitFormatter<T> {\n impl<T: Write> OutputFormatter for JunitFormatter<T> {\n     fn write_run_start(&mut self, _test_count: usize) -> io::Result<()> {\n         // We write xml header on run start\n-        self.write_message(&\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\")\n+        self.out.write_all(b\"\\n\")?;\n+        self.write_message(\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\")\n     }\n \n     fn write_test_start(&mut self, _desc: &TestDesc) -> io::Result<()> {\n@@ -133,6 +134,8 @@ impl<T: Write> OutputFormatter for JunitFormatter<T> {\n         self.write_message(\"</testsuite>\")?;\n         self.write_message(\"</testsuites>\")?;\n \n+        self.out.write_all(b\"\\n\\n\")?;\n+\n         Ok(state.failed == 0)\n     }\n }"}]}