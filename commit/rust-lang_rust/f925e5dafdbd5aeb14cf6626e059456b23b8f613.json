{"sha": "f925e5dafdbd5aeb14cf6626e059456b23b8f613", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY5MjVlNWRhZmRiZDVhZWIxNGNmNjYyNmUwNTk0NTZiMjNiOGY2MTM=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-09-16T13:06:05Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2018-09-16T13:18:18Z"}, "message": "cargo miri: show version number", "tree": {"sha": "fa1ef2b64f6e6d1fb6a8b01892b935a36c2996d1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fa1ef2b64f6e6d1fb6a8b01892b935a36c2996d1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f925e5dafdbd5aeb14cf6626e059456b23b8f613", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f925e5dafdbd5aeb14cf6626e059456b23b8f613", "html_url": "https://github.com/rust-lang/rust/commit/f925e5dafdbd5aeb14cf6626e059456b23b8f613", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f925e5dafdbd5aeb14cf6626e059456b23b8f613/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d198400f75f82e3df4d771d7093788a33f7c85ee", "url": "https://api.github.com/repos/rust-lang/rust/commits/d198400f75f82e3df4d771d7093788a33f7c85ee", "html_url": "https://github.com/rust-lang/rust/commit/d198400f75f82e3df4d771d7093788a33f7c85ee"}], "stats": {"total": 22, "additions": 21, "deletions": 1}, "files": [{"sha": "d690f87b536c65e0984e1cb7dab3a620ec2de9fe", "filename": "Cargo.toml", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f925e5dafdbd5aeb14cf6626e059456b23b8f613/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/f925e5dafdbd5aeb14cf6626e059456b23b8f613/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=f925e5dafdbd5aeb14cf6626e059456b23b8f613", "patch": "@@ -31,6 +31,9 @@ cargo_metadata = { version = \"0.6\", optional = true }\n env_logger = \"0.5\"\n log = \"0.4\"\n \n+[build-dependencies]\n+vergen = \"2\"\n+\n [features]\n cargo_miri = [\"cargo_metadata\"]\n "}, {"sha": "73eb68359a821c6982f52c20674901d214b74806", "filename": "build.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/f925e5dafdbd5aeb14cf6626e059456b23b8f613/build.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f925e5dafdbd5aeb14cf6626e059456b23b8f613/build.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build.rs?ref=f925e5dafdbd5aeb14cf6626e059456b23b8f613", "patch": "@@ -1,8 +1,24 @@\n+extern crate vergen;\n+\n use std::env;\n \n fn main() {\n     // Forward the profile to the main compilation\n     println!(\"cargo:rustc-env=PROFILE={}\", env::var(\"PROFILE\").unwrap());\n     // Don't rebuild miri even if nothing changed\n     println!(\"cargo:rerun-if-changed=build.rs\");\n+    // vergen\n+    vergen().expect(\"Unable to generate vergen constants!\");\n+}\n+\n+fn vergen() -> vergen::Result<()> {\n+    use vergen::{ConstantsFlags, Vergen};\n+\n+    let vergen = Vergen::new(ConstantsFlags::all())?;\n+\n+    for (k, v) in vergen.build_info() {\n+        println!(\"cargo:rustc-env={}={}\", k.name(), v);\n+    }\n+\n+    Ok(())\n }"}, {"sha": "95ce9cc7ecb5f5e52ed197b9a0b1ab136d636321", "filename": "src/bin/cargo-miri.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f925e5dafdbd5aeb14cf6626e059456b23b8f613/src%2Fbin%2Fcargo-miri.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f925e5dafdbd5aeb14cf6626e059456b23b8f613/src%2Fbin%2Fcargo-miri.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbin%2Fcargo-miri.rs?ref=f925e5dafdbd5aeb14cf6626e059456b23b8f613", "patch": "@@ -30,7 +30,8 @@ fn show_help() {\n }\n \n fn show_version() {\n-    println!(\"{}\", env!(\"CARGO_PKG_VERSION\"));\n+    println!(\"miri {} ({} {})\",\n+        env!(\"CARGO_PKG_VERSION\"), env!(\"VERGEN_SHA_SHORT\"), env!(\"VERGEN_COMMIT_DATE\"));\n }\n \n fn main() {"}]}