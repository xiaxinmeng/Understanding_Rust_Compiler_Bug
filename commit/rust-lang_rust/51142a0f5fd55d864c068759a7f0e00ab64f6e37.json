{"sha": "51142a0f5fd55d864c068759a7f0e00ab64f6e37", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUxMTQyYTBmNWZkNTVkODY0YzA2ODc1OWE3ZjBlMDBhYjY0ZjZlMzc=", "commit": {"author": {"name": "Jeremy Fitzhardinge", "email": "jsgf@fb.com", "date": "2021-07-14T23:39:17Z"}, "committer": {"name": "Jeremy Fitzhardinge", "email": "jsgf@fb.com", "date": "2021-07-15T00:04:55Z"}, "message": "Make --cap-lints and related options leave crate hash alone\n\nCloses: #87144", "tree": {"sha": "9d442d57405aa3ecc73fa686b2518276a31d99c9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9d442d57405aa3ecc73fa686b2518276a31d99c9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/51142a0f5fd55d864c068759a7f0e00ab64f6e37", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/51142a0f5fd55d864c068759a7f0e00ab64f6e37", "html_url": "https://github.com/rust-lang/rust/commit/51142a0f5fd55d864c068759a7f0e00ab64f6e37", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/51142a0f5fd55d864c068759a7f0e00ab64f6e37/comments", "author": {"login": "jsgf", "id": 147966, "node_id": "MDQ6VXNlcjE0Nzk2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/147966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsgf", "html_url": "https://github.com/jsgf", "followers_url": "https://api.github.com/users/jsgf/followers", "following_url": "https://api.github.com/users/jsgf/following{/other_user}", "gists_url": "https://api.github.com/users/jsgf/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsgf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsgf/subscriptions", "organizations_url": "https://api.github.com/users/jsgf/orgs", "repos_url": "https://api.github.com/users/jsgf/repos", "events_url": "https://api.github.com/users/jsgf/events{/privacy}", "received_events_url": "https://api.github.com/users/jsgf/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsgf", "id": 147966, "node_id": "MDQ6VXNlcjE0Nzk2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/147966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsgf", "html_url": "https://github.com/jsgf", "followers_url": "https://api.github.com/users/jsgf/followers", "following_url": "https://api.github.com/users/jsgf/following{/other_user}", "gists_url": "https://api.github.com/users/jsgf/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsgf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsgf/subscriptions", "organizations_url": "https://api.github.com/users/jsgf/orgs", "repos_url": "https://api.github.com/users/jsgf/repos", "events_url": "https://api.github.com/users/jsgf/events{/privacy}", "received_events_url": "https://api.github.com/users/jsgf/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e87188c252a3b6dea8ed54d7915fbc2cfb61443b", "url": "https://api.github.com/repos/rust-lang/rust/commits/e87188c252a3b6dea8ed54d7915fbc2cfb61443b", "html_url": "https://github.com/rust-lang/rust/commit/e87188c252a3b6dea8ed54d7915fbc2cfb61443b"}], "stats": {"total": 28, "additions": 21, "deletions": 7}, "files": [{"sha": "7e9a2c1312aacda720752bae45ccfb6fe714c0ba", "filename": "compiler/rustc_interface/src/tests.rs", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/51142a0f5fd55d864c068759a7f0e00ab64f6e37/compiler%2Frustc_interface%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51142a0f5fd55d864c068759a7f0e00ab64f6e37/compiler%2Frustc_interface%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2Fsrc%2Ftests.rs?ref=51142a0f5fd55d864c068759a7f0e00ab64f6e37", "patch": "@@ -236,9 +236,9 @@ fn test_lints_tracking_hash_different_values() {\n         (String::from(\"d\"), Level::Deny),\n     ];\n \n-    assert_different_hash(&v1, &v2);\n-    assert_different_hash(&v1, &v3);\n-    assert_different_hash(&v2, &v3);\n+    assert_non_crate_hash_different(&v1, &v2);\n+    assert_non_crate_hash_different(&v1, &v3);\n+    assert_non_crate_hash_different(&v2, &v3);\n }\n \n #[test]\n@@ -261,7 +261,21 @@ fn test_lints_tracking_hash_different_construction_order() {\n     ];\n \n     // The hash should be order-dependent\n-    assert_different_hash(&v1, &v2);\n+    assert_non_crate_hash_different(&v1, &v2);\n+}\n+\n+#[test]\n+fn test_lint_cap_hash_different() {\n+    let mut v1 = Options::default();\n+    let mut v2 = Options::default();\n+    let v3 = Options::default();\n+\n+    v1.lint_cap = Some(Level::Forbid);\n+    v2.lint_cap = Some(Level::Allow);\n+\n+    assert_non_crate_hash_different(&v1, &v2);\n+    assert_non_crate_hash_different(&v1, &v3);\n+    assert_non_crate_hash_different(&v2, &v3);\n }\n \n #[test]"}, {"sha": "5d4b32b2b9e3a570dd7d6475f9ef08bf73e85126", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/51142a0f5fd55d864c068759a7f0e00ab64f6e37/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51142a0f5fd55d864c068759a7f0e00ab64f6e37/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=51142a0f5fd55d864c068759a7f0e00ab64f6e37", "patch": "@@ -133,9 +133,9 @@ top_level_options!(\n         /// can influence whether overflow checks are done or not.\n         debug_assertions: bool [TRACKED],\n         debuginfo: DebugInfo [TRACKED],\n-        lint_opts: Vec<(String, lint::Level)> [TRACKED],\n-        lint_cap: Option<lint::Level> [TRACKED],\n-        force_warns: Vec<String> [TRACKED],\n+        lint_opts: Vec<(String, lint::Level)> [TRACKED_NO_CRATE_HASH],\n+        lint_cap: Option<lint::Level> [TRACKED_NO_CRATE_HASH],\n+        force_warns: Vec<String> [TRACKED_NO_CRATE_HASH],\n         describe_lints: bool [UNTRACKED],\n         output_types: OutputTypes [TRACKED],\n         search_paths: Vec<SearchPath> [UNTRACKED],"}]}