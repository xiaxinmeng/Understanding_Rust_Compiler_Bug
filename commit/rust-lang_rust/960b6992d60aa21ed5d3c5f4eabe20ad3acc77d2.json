{"sha": "960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk2MGI2OTkyZDYwYWEyMWVkNWQzYzVmNGVhYmUyMGFkM2FjYzc3ZDI=", "commit": {"author": {"name": "JohnTitor", "email": "huyuumi.dev@gmail.com", "date": "2021-03-29T08:12:03Z"}, "committer": {"name": "JohnTitor", "email": "huyuumi.dev@gmail.com", "date": "2021-03-29T08:12:03Z"}, "message": "Do not emit the advanced diagnostics on macros", "tree": {"sha": "d2a5ef9055ec3a7fdbc9b3b87e013e9d59a4178b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d2a5ef9055ec3a7fdbc9b3b87e013e9d59a4178b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2", "html_url": "https://github.com/rust-lang/rust/commit/960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cc4103089f40a163f6d143f06359cba7043da29b", "url": "https://api.github.com/repos/rust-lang/rust/commits/cc4103089f40a163f6d143f06359cba7043da29b", "html_url": "https://github.com/rust-lang/rust/commit/cc4103089f40a163f6d143f06359cba7043da29b"}], "stats": {"total": 72, "additions": 71, "deletions": 1}, "files": [{"sha": "6fae6921fc9b2342a2e19ed3bbc38c539992b18f", "filename": "compiler/rustc_resolve/src/late/diagnostics.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs?ref=960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2", "patch": "@@ -456,12 +456,14 @@ impl<'a: 'ast, 'ast> LateResolutionVisitor<'a, '_, 'ast> {\n             }\n         }\n \n+        let is_macro = base_span.from_expansion() && base_span.desugaring_kind().is_none();\n         if !self.type_ascription_suggestion(&mut err, base_span) {\n             let mut fallback = false;\n             if let (\n                 PathSource::Trait(AliasPossibility::Maybe),\n                 Some(Res::Def(DefKind::Struct | DefKind::Enum | DefKind::Union, _)),\n-            ) = (source, res)\n+                false,\n+            ) = (source, res, is_macro)\n             {\n                 if let Some(bounds @ [_, .., _]) = self.diagnostic_metadata.current_trait_object {\n                     fallback = true;"}, {"sha": "1d6ef3914a91b0bee564d5dd8cd4158892711667", "filename": "src/test/ui/proc-macro/auxiliary/issue-83510.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fissue-83510.rs", "raw_url": "https://github.com/rust-lang/rust/raw/960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fissue-83510.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fauxiliary%2Fissue-83510.rs?ref=960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2", "patch": "@@ -0,0 +1,19 @@\n+// force-host\n+// no-prefer-dynamic\n+\n+#![crate_type = \"proc-macro\"]\n+\n+extern crate proc_macro;\n+\n+use proc_macro::TokenStream;\n+\n+#[proc_macro]\n+pub fn dance_like_you_want_to_ice(_: TokenStream) -> TokenStream {\n+    r#\"\n+    impl Foo {\n+        type Bar = Box<()> + Baz;\n+    }\n+    \"#\n+    .parse()\n+    .unwrap()\n+}"}, {"sha": "2b1aec4df0be3eb734af6133d468dd846b1548af", "filename": "src/test/ui/proc-macro/issue-83510.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2/src%2Ftest%2Fui%2Fproc-macro%2Fissue-83510.rs", "raw_url": "https://github.com/rust-lang/rust/raw/960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2/src%2Ftest%2Fui%2Fproc-macro%2Fissue-83510.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fissue-83510.rs?ref=960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2", "patch": "@@ -0,0 +1,11 @@\n+// aux-build: issue-83510.rs\n+\n+extern crate issue_83510;\n+\n+issue_83510::dance_like_you_want_to_ice!();\n+//~^ ERROR: cannot find type `Foo` in this scope\n+//~| ERROR: expected trait, found struct `Box`\n+//~| ERROR: cannot find trait `Baz` in this scope\n+//~| ERROR: inherent associated types are unstable\n+\n+fn main() {}"}, {"sha": "e0803550906db248c463ebe0f7405211297f3f0d", "filename": "src/test/ui/proc-macro/issue-83510.stderr", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2/src%2Ftest%2Fui%2Fproc-macro%2Fissue-83510.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2/src%2Ftest%2Fui%2Fproc-macro%2Fissue-83510.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fissue-83510.stderr?ref=960b6992d60aa21ed5d3c5f4eabe20ad3acc77d2", "patch": "@@ -0,0 +1,38 @@\n+error[E0412]: cannot find type `Foo` in this scope\n+  --> $DIR/issue-83510.rs:5:1\n+   |\n+LL | issue_83510::dance_like_you_want_to_ice!();\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ not found in this scope\n+   |\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n+\n+error[E0404]: expected trait, found struct `Box`\n+  --> $DIR/issue-83510.rs:5:1\n+   |\n+LL | issue_83510::dance_like_you_want_to_ice!();\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ not a trait\n+   |\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n+\n+error[E0405]: cannot find trait `Baz` in this scope\n+  --> $DIR/issue-83510.rs:5:1\n+   |\n+LL | issue_83510::dance_like_you_want_to_ice!();\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ not found in this scope\n+   |\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n+\n+error[E0658]: inherent associated types are unstable\n+  --> $DIR/issue-83510.rs:5:1\n+   |\n+LL | issue_83510::dance_like_you_want_to_ice!();\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = note: see issue #8995 <https://github.com/rust-lang/rust/issues/8995> for more information\n+   = help: add `#![feature(inherent_associated_types)]` to the crate attributes to enable\n+   = note: this error originates in a macro (in Nightly builds, run with -Z macro-backtrace for more info)\n+\n+error: aborting due to 4 previous errors\n+\n+Some errors have detailed explanations: E0404, E0405, E0412, E0658.\n+For more information about an error, try `rustc --explain E0404`."}]}