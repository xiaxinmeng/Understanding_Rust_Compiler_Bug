{"sha": "247a0d185446fb145e1e5843c44c97b9a564e135", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI0N2EwZDE4NTQ0NmZiMTQ1ZTFlNTg0M2M0NGM5N2I5YTU2NGUxMzU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-07-21T08:26:19Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-07-21T08:26:19Z"}, "message": "Auto merge of #27153 - alexcrichton:flaky-tests, r=brson\n\nThis commit ensures that the rustc thread does not leak a panic message whenever\r\na call to `fatal` happens. This already happens for the main rustc thread as\r\npart of the `rustc_driver::monitor` function, but the compiler also spawns\r\nthreads for other operations like `-C codegen-units`, and sometimes errors are\r\nemitted on these threads as well. To ensure that there's a consistent\r\nerror-handling experience across threads this unifies these two to never print\r\nthe panic message in the case of a normal and expected fatal error.\r\n\r\nThis should also fix the flaky `asm-src-loc-codegen-units.rs` test as the output\r\nis sometimes garbled if diagnostics are printed while the panic message is also\r\nbeing printed.", "tree": {"sha": "991585e1ba9f5d980f46f4a0cc0833152c522d4e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/991585e1ba9f5d980f46f4a0cc0833152c522d4e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/247a0d185446fb145e1e5843c44c97b9a564e135", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/247a0d185446fb145e1e5843c44c97b9a564e135", "html_url": "https://github.com/rust-lang/rust/commit/247a0d185446fb145e1e5843c44c97b9a564e135", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/247a0d185446fb145e1e5843c44c97b9a564e135/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "691ce23479b08a292ad106606dab347306fc381f", "url": "https://api.github.com/repos/rust-lang/rust/commits/691ce23479b08a292ad106606dab347306fc381f", "html_url": "https://github.com/rust-lang/rust/commit/691ce23479b08a292ad106606dab347306fc381f"}, {"sha": "013d47b19b25b94e9740f725425bc836bac6efde", "url": "https://api.github.com/repos/rust-lang/rust/commits/013d47b19b25b94e9740f725425bc836bac6efde", "html_url": "https://github.com/rust-lang/rust/commit/013d47b19b25b94e9740f725425bc836bac6efde"}], "stats": {"total": 5, "additions": 5, "deletions": 0}, "files": [{"sha": "e95813e44babe0b6cb636d7925728019cbc26c3d", "filename": "src/libsyntax/diagnostic.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/247a0d185446fb145e1e5843c44c97b9a564e135/src%2Flibsyntax%2Fdiagnostic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/247a0d185446fb145e1e5843c44c97b9a564e135/src%2Flibsyntax%2Fdiagnostic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fdiagnostic.rs?ref=247a0d185446fb145e1e5843c44c97b9a564e135", "patch": "@@ -208,6 +208,10 @@ impl Handler {\n     }\n     pub fn fatal(&self, msg: &str) -> ! {\n         self.emit.borrow_mut().emit(None, msg, None, Fatal);\n+\n+        // Suppress the fatal error message from the panic below as we've\n+        // already terminated in our own \"legitimate\" fashion.\n+        io::set_panic(Box::new(io::sink()));\n         panic!(FatalError);\n     }\n     pub fn err(&self, msg: &str) {"}, {"sha": "d93af5da13c1e2803a2aa263e9340d3df035a42b", "filename": "src/libsyntax/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/247a0d185446fb145e1e5843c44c97b9a564e135/src%2Flibsyntax%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/247a0d185446fb145e1e5843c44c97b9a564e135/src%2Flibsyntax%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Flib.rs?ref=247a0d185446fb145e1e5843c44c97b9a564e135", "patch": "@@ -32,6 +32,7 @@\n #![feature(libc)]\n #![feature(ref_slice)]\n #![feature(rustc_private)]\n+#![feature(set_stdio)]\n #![feature(staged_api)]\n #![feature(str_char)]\n #![feature(str_escape)]"}]}