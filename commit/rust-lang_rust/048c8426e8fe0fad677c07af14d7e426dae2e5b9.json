{"sha": "048c8426e8fe0fad677c07af14d7e426dae2e5b9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA0OGM4NDI2ZThmZTBmYWQ2NzdjMDdhZjE0ZDdlNDI2ZGFlMmU1Yjk=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-04-13T23:24:13Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-04-13T23:24:13Z"}, "message": "Rollup merge of #70654 - oli-obk:subrepo_docs, r=Mark-Simulacrum\n\nExplain how to work with subtree\n\ncc #70651\n\nr? @centril @RalfJung\n\nThis PR just contains the usage documentation, we'll do actual moves in later PRs", "tree": {"sha": "ec84b8f3d6752cdb37fb9b2cb4f46be7c94e5825", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ec84b8f3d6752cdb37fb9b2cb4f46be7c94e5825"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/048c8426e8fe0fad677c07af14d7e426dae2e5b9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJelPSdCRBK7hj4Ov3rIwAAdHIIAIuXwI9EbeC5eKV1cpED6DYi\nGqx0k8BWaUnQzIXhRxzlDxeStOPDrebcJW5zixkgfbJIOotfdfmMUz/6YZwkVhuE\nrlqwJfUshWV91AnnWZ+ewqLL+6e6DR9kTRKysJxjDkvop/qmyR4p4B0OPGZsxwdO\nAKjG591O9RYC5+KIanN6yKaBkSfYxnoegf78uifpkL/4S98sRCZ6dpmMJC6wOdfK\nfKdewOo6gu9/37E8K0anjrows9UEe7IgWEAtV4sllqMqyoF8K5IRb/sWmf107KEn\nW4V+XNBsK3exb0Az2RrDu5i9Nvd+x+O/6AamLV0+zwJsS0dMLouPQkxhe84AfiE=\n=G1wD\n-----END PGP SIGNATURE-----\n", "payload": "tree ec84b8f3d6752cdb37fb9b2cb4f46be7c94e5825\nparent 8e18e26f12b1e8b3e913b15278bf6185f0f61add\nparent 7928c45c062b330f4654faaeedac3722bb71ee3a\nauthor Dylan DPC <dylan.dpc@gmail.com> 1586820253 +0200\ncommitter GitHub <noreply@github.com> 1586820253 +0200\n\nRollup merge of #70654 - oli-obk:subrepo_docs, r=Mark-Simulacrum\n\nExplain how to work with subtree\n\ncc #70651\n\nr? @centril @RalfJung\n\nThis PR just contains the usage documentation, we'll do actual moves in later PRs\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/048c8426e8fe0fad677c07af14d7e426dae2e5b9", "html_url": "https://github.com/rust-lang/rust/commit/048c8426e8fe0fad677c07af14d7e426dae2e5b9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/048c8426e8fe0fad677c07af14d7e426dae2e5b9/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8e18e26f12b1e8b3e913b15278bf6185f0f61add", "url": "https://api.github.com/repos/rust-lang/rust/commits/8e18e26f12b1e8b3e913b15278bf6185f0f61add", "html_url": "https://github.com/rust-lang/rust/commit/8e18e26f12b1e8b3e913b15278bf6185f0f61add"}, {"sha": "7928c45c062b330f4654faaeedac3722bb71ee3a", "url": "https://api.github.com/repos/rust-lang/rust/commits/7928c45c062b330f4654faaeedac3722bb71ee3a", "html_url": "https://github.com/rust-lang/rust/commit/7928c45c062b330f4654faaeedac3722bb71ee3a"}], "stats": {"total": 66, "additions": 64, "deletions": 2}, "files": [{"sha": "051f5af7bc105cd53d393093ef45a15de27c248c", "filename": "CONTRIBUTING.md", "status": "modified", "additions": 64, "deletions": 2, "changes": 66, "blob_url": "https://github.com/rust-lang/rust/blob/048c8426e8fe0fad677c07af14d7e426dae2e5b9/CONTRIBUTING.md", "raw_url": "https://github.com/rust-lang/rust/raw/048c8426e8fe0fad677c07af14d7e426dae2e5b9/CONTRIBUTING.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CONTRIBUTING.md?ref=048c8426e8fe0fad677c07af14d7e426dae2e5b9", "patch": "@@ -188,7 +188,70 @@ with one another are rolled up.\n Speaking of tests, Rust has a comprehensive test suite. More information about\n it can be found [here][rctd].\n \n-### External Dependencies\n+### External Dependencies (subtree)\n+\n+As a developer to this repository, you don't have to treat the following external projects\n+differently from other crates that are directly in this repo:\n+\n+* none so far, see https://github.com/rust-lang/rust/issues/70651 for more info\n+\n+They are just regular files and directories. This is in contrast to `submodule` dependencies\n+(see below for those). Only tool authors will actually use any operations here.\n+\n+#### Synchronizing a subtree\n+\n+There are two synchronization directions: `subtree push` and `subtree pull`.\n+\n+```\n+git subtree push -P src/tools/clippy git@github.com:your-github-name/rust-clippy sync-from-rust\n+```\n+\n+takes all the changes that\n+happened to the copy in this repo and creates commits on the remote repo that match the local\n+changes. Every local commit that touched the subtree causes a commit on the remote repo, but is\n+modified to move the files from the specified directory to the tool repo root.\n+\n+Make sure to not pick the `master` branch on the tool repo, so you can open a normal PR to the tool\n+to merge that subrepo push.\n+\n+```\n+git subtree pull -P src/tools/clippy https://github.com/rust-lang/rust-clippy master\n+```\n+\n+takes all changes since the last `subtree pull` from the tool repo\n+repo and adds these commits to the rustc repo + a merge commit that moves the tool changes into\n+the specified directory in the rust repository.\n+\n+It is recommended that you always do a push first and get that merged to the tool master branch.\n+Then, when you do a pull, the merge works without conflicts.\n+While it's definitely possible to resolve conflicts during a pull, you may have to redo the conflict\n+resolution if your PR doesn't get merged fast enough and there are new conflicts. Do not try to\n+rebase the result of a `git subtree pull`, rebasing merge commits is a bad idea in general.\n+\n+You always need to specify the `-P` prefix to the subtree directory and the corresponding remote\n+repository. If you specify the wrong directory or repository\n+you'll get very fun merges that try to push the wrong directory to the wrong remote repository.\n+Luckily you can just abort this without any consequences by throwing away either the pulled commits\n+in rustc or the pushed branch on the remote and try again. It is usually fairly obvious\n+that this is happening because you suddenly get thousands of commits that want to be synchronized.\n+\n+#### Creating a new subtree dependency\n+\n+If you want to create a new subtree dependency from an existing repository, call (from this\n+repository's root directory!)\n+\n+```\n+git subtree add -P src/tools/clippy https://github.com/rust-lang/rust-clippy.git master\n+```\n+\n+This will create a new commit, which you may not rebase under any circumstances! Delete the commit\n+and redo the operation if you need to rebase.\n+\n+Now you're done, the `src/tools/clippy` directory behaves as if clippy were part of the rustc\n+monorepo, so no one but you (or others that synchronize subtrees) actually needs to use `git subtree`.\n+\n+\n+### External Dependencies (submodules)\n \n Currently building Rust will also build the following external projects:\n \n@@ -221,7 +284,6 @@ before the PR is merged.\n \n Rust's build system builds a number of tools that make use of the\n internals of the compiler. This includes\n-[Clippy](https://github.com/rust-lang/rust-clippy),\n [RLS](https://github.com/rust-lang/rls) and\n [rustfmt](https://github.com/rust-lang/rustfmt). If these tools\n break because of your changes, you may run into a sort of \"chicken and egg\""}]}