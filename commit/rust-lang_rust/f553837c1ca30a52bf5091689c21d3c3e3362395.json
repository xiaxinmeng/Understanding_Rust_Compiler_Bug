{"sha": "f553837c1ca30a52bf5091689c21d3c3e3362395", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY1NTM4MzdjMWNhMzBhNTJiZjUwOTE2ODljMjFkM2MzZTMzNjIzOTU=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-08T18:50:04Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-01-08T18:50:04Z"}, "message": "upstream text-utils to text_unit", "tree": {"sha": "79dbabf6137e6aaf64d494f57a7cecbf397237bc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/79dbabf6137e6aaf64d494f57a7cecbf397237bc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f553837c1ca30a52bf5091689c21d3c3e3362395", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f553837c1ca30a52bf5091689c21d3c3e3362395", "html_url": "https://github.com/rust-lang/rust/commit/f553837c1ca30a52bf5091689c21d3c3e3362395", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f553837c1ca30a52bf5091689c21d3c3e3362395/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c9e42fcf245be16958dca6571e4bccc6c29199df", "url": "https://api.github.com/repos/rust-lang/rust/commits/c9e42fcf245be16958dca6571e4bccc6c29199df", "html_url": "https://github.com/rust-lang/rust/commit/c9e42fcf245be16958dca6571e4bccc6c29199df"}], "stats": {"total": 64, "additions": 20, "deletions": 44}, "files": [{"sha": "f1d8e5462c291e4b47d956bdebca949f0ae6b0ac", "filename": "Cargo.lock", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/f553837c1ca30a52bf5091689c21d3c3e3362395/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/f553837c1ca30a52bf5091689c21d3c3e3362395/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=f553837c1ca30a52bf5091689c21d3c3e3362395", "patch": "@@ -745,7 +745,7 @@ dependencies = [\n  \"smol_str 0.1.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"tempfile 3.0.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"test_utils 0.1.0\",\n- \"text_unit 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"text_unit 0.1.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"thread_worker 0.1.0\",\n  \"threadpool 1.7.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"tools 0.1.0\",\n@@ -764,7 +764,7 @@ dependencies = [\n  \"ra_text_edit 0.1.0\",\n  \"rowan 0.2.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"test_utils 0.1.0\",\n- \"text_unit 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"text_unit 0.1.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"unicode-xid 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"walkdir 2.2.7 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n@@ -775,7 +775,7 @@ version = \"0.1.0\"\n dependencies = [\n  \"proptest 0.8.7 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"test_utils 0.1.0\",\n- \"text_unit 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"text_unit 0.1.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -972,7 +972,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"parking_lot 0.7.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"smol_str 0.1.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"text_unit 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"text_unit 0.1.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -1218,12 +1218,12 @@ dependencies = [\n  \"difference 2.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"itertools 0.8.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"serde_json 1.0.34 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"text_unit 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"text_unit 0.1.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n name = \"text_unit\"\n-version = \"0.1.5\"\n+version = \"0.1.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"serde 1.0.84 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -1597,7 +1597,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum tera 0.11.20 (registry+https://github.com/rust-lang/crates.io-index)\" = \"4b505279e19d8f7d24b1a9dc58327c9c36174b1a2c7ebdeac70792d017cb64f3\"\n \"checksum teraron 0.0.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0d89ad4617d1dec55331067fadaa041e813479e1779616f3d3ce9308bf46184e\"\n \"checksum termion 1.5.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"689a3bdfaab439fd92bc87df5c4c78417d3cbe537487274e9b0b2dce76e92096\"\n-\"checksum text_unit 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"8009d7bdbd896a7e09b595f8f9325a19047fc708653e60d0895202b82135048f\"\n+\"checksum text_unit 0.1.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"158bb1c22b638b1da3c95a8ad9f061ea40d4d39fd0301be3a520f92efeeb189e\"\n \"checksum textwrap 0.10.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"307686869c93e71f94da64286f9a9524c0f308a9e1c87a583de8e9c9039ad3f6\"\n \"checksum thread_local 0.3.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c6b53e329000edc2b34dbe8545fd20e55a333362d0a321909685a19bd28c3f1b\"\n \"checksum threadpool 1.7.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"e2f0c90a5f3459330ac8bc0d2f879c693bb7a2f59689c1083fc4ef83834da865\""}, {"sha": "d8177f245ee959a65e4a8dc611687eb7d3622efd", "filename": "crates/ra_editor/src/typing.rs", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f553837c1ca30a52bf5091689c21d3c3e3362395/crates%2Fra_editor%2Fsrc%2Ftyping.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f553837c1ca30a52bf5091689c21d3c3e3362395/crates%2Fra_editor%2Fsrc%2Ftyping.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_editor%2Fsrc%2Ftyping.rs?ref=f553837c1ca30a52bf5091689c21d3c3e3362395", "patch": "@@ -4,12 +4,10 @@ use itertools::Itertools;\n use ra_syntax::{\n     algo::{find_node_at_offset, find_covering_node, find_leaf_at_offset, LeafAtOffset},\n     ast,\n-    text_utils::intersect,\n     AstNode, Direction, SourceFile, SyntaxKind,\n     SyntaxKind::*,\n     SyntaxNode, TextRange, TextUnit,\n };\n-use ra_text_edit::text_utils::contains_offset_nonstrict;\n \n use crate::{LocalEdit, TextEditBuilder};\n \n@@ -39,7 +37,7 @@ pub fn join_lines(file: &SourceFile, range: TextRange) -> LocalEdit {\n             Some(text) => text,\n             None => continue,\n         };\n-        let range = match intersect(range, node.range()) {\n+        let range = match range.intersection(&node.range()) {\n             Some(range) => range,\n             None => continue,\n         } - node.range().start();\n@@ -112,7 +110,7 @@ pub fn on_eq_typed(file: &SourceFile, offset: TextUnit) -> Option<LocalEdit> {\n     }\n     if let Some(expr) = let_stmt.initializer() {\n         let expr_range = expr.syntax().range();\n-        if contains_offset_nonstrict(expr_range, offset) && offset != expr_range.start() {\n+        if expr_range.contains(offset) && offset != expr_range.start() {\n             return None;\n         }\n         if file"}, {"sha": "b7777bfc3931f67c297a20c81a8f400c1af67ab9", "filename": "crates/ra_lsp_server/src/main_loop/handlers.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f553837c1ca30a52bf5091689c21d3c3e3362395/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f553837c1ca30a52bf5091689c21d3c3e3362395/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop%2Fhandlers.rs?ref=f553837c1ca30a52bf5091689c21d3c3e3362395", "patch": "@@ -11,8 +11,7 @@ use languageserver_types::{\n use ra_analysis::{\n     FileId, FilePosition, FileRange, FoldKind, Query, RunnableKind, Severity, SourceChange,\n };\n-use ra_syntax::{text_utils::intersect, TextUnit, AstNode};\n-use ra_text_edit::text_utils::contains_offset_nonstrict;\n+use ra_syntax::{TextUnit, AstNode};\n use rustc_hash::FxHashMap;\n use serde_json::to_value;\n use std::io::Write;\n@@ -248,7 +247,7 @@ pub fn handle_runnables(\n     let mut res = Vec::new();\n     for runnable in world.analysis().runnables(file_id)? {\n         if let Some(offset) = offset {\n-            if !contains_offset_nonstrict(runnable.range, offset) {\n+            if !runnable.range.contains_inclusive(offset) {\n                 continue;\n             }\n         }\n@@ -650,7 +649,7 @@ pub fn handle_code_action(\n         .diagnostics(file_id)?\n         .into_iter()\n         .filter_map(|d| Some((d.range, d.fix?)))\n-        .filter(|(diag_range, _fix)| intersect(*diag_range, range).is_some())\n+        .filter(|(diag_range, _fix)| diag_range.intersection(&range).is_some())\n         .map(|(_range, fix)| fix);\n \n     let mut res = Vec::new();"}, {"sha": "7c8e5b6962cd67571c448fe9763c500a2b16974d", "filename": "crates/ra_syntax/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f553837c1ca30a52bf5091689c21d3c3e3362395/crates%2Fra_syntax%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/f553837c1ca30a52bf5091689c21d3c3e3362395/crates%2Fra_syntax%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2FCargo.toml?ref=f553837c1ca30a52bf5091689c21d3c3e3362395", "patch": "@@ -14,7 +14,7 @@ itertools = \"0.8.0\"\n drop_bomb = \"0.1.4\"\n parking_lot = \"0.7.0\"\n rowan = \"0.2.0\"\n-text_unit = \"0.1.5\"\n+text_unit = \"0.1.6\"\n ra_text_edit = { path = \"../ra_text_edit\" }\n \n [dev-dependencies]"}, {"sha": "7aaf4c22304310d39aa159a1ab2aff970d893aa5", "filename": "crates/ra_syntax/src/text_utils.rs", "status": "modified", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f553837c1ca30a52bf5091689c21d3c3e3362395/crates%2Fra_syntax%2Fsrc%2Ftext_utils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f553837c1ca30a52bf5091689c21d3c3e3362395/crates%2Fra_syntax%2Fsrc%2Ftext_utils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Ftext_utils.rs?ref=f553837c1ca30a52bf5091689c21d3c3e3362395", "patch": "@@ -1,15 +1,5 @@\n use crate::TextRange;\n \n-pub fn intersect(r1: TextRange, r2: TextRange) -> Option<TextRange> {\n-    let start = r1.start().max(r2.start());\n-    let end = r1.end().min(r2.end());\n-    if start <= end {\n-        Some(TextRange::from_to(start, end))\n-    } else {\n-        None\n-    }\n-}\n-\n pub fn replace_range(mut text: String, range: TextRange, replace_with: &str) -> String {\n     let start = u32::from(range.start()) as usize;\n     let end = u32::from(range.end()) as usize;"}, {"sha": "08dbe57a2bef182ed0958156d408e79e483cf75e", "filename": "crates/ra_syntax/src/yellow/syntax_text.rs", "status": "modified", "additions": 5, "deletions": 9, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/f553837c1ca30a52bf5091689c21d3c3e3362395/crates%2Fra_syntax%2Fsrc%2Fyellow%2Fsyntax_text.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f553837c1ca30a52bf5091689c21d3c3e3362395/crates%2Fra_syntax%2Fsrc%2Fyellow%2Fsyntax_text.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fyellow%2Fsyntax_text.rs?ref=f553837c1ca30a52bf5091689c21d3c3e3362395", "patch": "@@ -1,10 +1,6 @@\n use std::{fmt, ops};\n \n-use ra_text_edit::text_utils::contains_offset_nonstrict;\n-use crate::{\n-    text_utils::intersect,\n-    SyntaxNode, TextRange, TextUnit,\n-};\n+use crate::{SyntaxNode, TextRange, TextUnit};\n \n #[derive(Clone)]\n pub struct SyntaxText<'a> {\n@@ -23,7 +19,7 @@ impl<'a> SyntaxText<'a> {\n         let range = self.range;\n         self.node.descendants().filter_map(move |node| {\n             let text = node.leaf_text()?;\n-            let range = intersect(range, node.range())?;\n+            let range = range.intersection(&node.range())?;\n             let range = range - node.range().start();\n             Some(&text[range])\n         })\n@@ -92,13 +88,13 @@ pub trait SyntaxTextSlice: fmt::Debug {\n \n impl SyntaxTextSlice for TextRange {\n     fn restrict(&self, range: TextRange) -> Option<TextRange> {\n-        intersect(*self, range)\n+        self.intersection(&range)\n     }\n }\n \n impl SyntaxTextSlice for ops::RangeTo<TextUnit> {\n     fn restrict(&self, range: TextRange) -> Option<TextRange> {\n-        if !contains_offset_nonstrict(range, self.end) {\n+        if !range.contains_inclusive(self.end) {\n             return None;\n         }\n         Some(TextRange::from_to(range.start(), self.end))\n@@ -107,7 +103,7 @@ impl SyntaxTextSlice for ops::RangeTo<TextUnit> {\n \n impl SyntaxTextSlice for ops::RangeFrom<TextUnit> {\n     fn restrict(&self, range: TextRange) -> Option<TextRange> {\n-        if !contains_offset_nonstrict(range, self.start) {\n+        if !range.contains_inclusive(self.start) {\n             return None;\n         }\n         Some(TextRange::from_to(self.start, range.end()))"}, {"sha": "71f6ce1adc8b1add40289700cab7892b556f7ecf", "filename": "crates/ra_text_edit/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f553837c1ca30a52bf5091689c21d3c3e3362395/crates%2Fra_text_edit%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/f553837c1ca30a52bf5091689c21d3c3e3362395/crates%2Fra_text_edit%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_text_edit%2FCargo.toml?ref=f553837c1ca30a52bf5091689c21d3c3e3362395", "patch": "@@ -6,7 +6,7 @@ authors = [\"Aleksey Kladov <aleksey.kladov@gmail.com>\"]\n publish = false\n \n [dependencies]\n-text_unit = \"0.1.5\"\n+text_unit = \"0.1.6\"\n proptest = \"0.8.7\"\n \n [dev-dependencies]"}, {"sha": "22f3fdc0c78ee45c53e198d6c2bc9089e770520e", "filename": "crates/ra_text_edit/src/lib.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f553837c1ca30a52bf5091689c21d3c3e3362395/crates%2Fra_text_edit%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f553837c1ca30a52bf5091689c21d3c3e3362395/crates%2Fra_text_edit%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_text_edit%2Fsrc%2Flib.rs?ref=f553837c1ca30a52bf5091689c21d3c3e3362395", "patch": "@@ -1,5 +1,4 @@\n mod text_edit;\n-pub mod text_utils;\n pub mod test_utils;\n \n pub use crate::text_edit::{TextEdit, TextEditBuilder};"}, {"sha": "363b3d8c0506991416e17a171710f96bc0b2978f", "filename": "crates/ra_text_edit/src/text_edit.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f553837c1ca30a52bf5091689c21d3c3e3362395/crates%2Fra_text_edit%2Fsrc%2Ftext_edit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f553837c1ca30a52bf5091689c21d3c3e3362395/crates%2Fra_text_edit%2Fsrc%2Ftext_edit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_text_edit%2Fsrc%2Ftext_edit.rs?ref=f553837c1ca30a52bf5091689c21d3c3e3362395", "patch": "@@ -1,5 +1,4 @@\n use crate::AtomTextEdit;\n-use crate::text_utils::contains_offset_nonstrict;\n use text_unit::{TextRange, TextUnit};\n \n #[derive(Debug, Clone)]\n@@ -28,7 +27,7 @@ impl TextEditBuilder {\n     pub fn invalidates_offset(&self, offset: TextUnit) -> bool {\n         self.atoms\n             .iter()\n-            .any(|atom| contains_offset_nonstrict(atom.delete, offset))\n+            .any(|atom| atom.delete.contains_inclusive(offset))\n     }\n }\n "}, {"sha": "e3b4dc4fe35552b9bfce0d3eac6844a4c39af98e", "filename": "crates/ra_text_edit/src/text_utils.rs", "status": "removed", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c9e42fcf245be16958dca6571e4bccc6c29199df/crates%2Fra_text_edit%2Fsrc%2Ftext_utils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9e42fcf245be16958dca6571e4bccc6c29199df/crates%2Fra_text_edit%2Fsrc%2Ftext_utils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_text_edit%2Fsrc%2Ftext_utils.rs?ref=c9e42fcf245be16958dca6571e4bccc6c29199df", "patch": "@@ -1,5 +0,0 @@\n-use text_unit::{TextRange, TextUnit};\n-\n-pub fn contains_offset_nonstrict(range: TextRange, offset: TextUnit) -> bool {\n-    range.start() <= offset && offset <= range.end()\n-}"}]}