{"sha": "124555a69e5f65173ec7840000eb8e953d046740", "node_id": "C_kwDOAAsO6NoAKDEyNDU1NWE2OWU1ZjY1MTczZWM3ODQwMDAwZWI4ZTk1M2QwNDY3NDA", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-01-12T21:04:40Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-01-12T21:04:40Z"}, "message": "Auto merge of #92169 - In-line:no-cache-selector-lrc, r=Mark-Simulacrum\n\nRemove ArenaCacheSelector for visible_parent_map query ( + LRC)", "tree": {"sha": "14d7e0d613f2fcab4cb9d7cfbcb9d60bc5d12d4f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/14d7e0d613f2fcab4cb9d7cfbcb9d60bc5d12d4f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/124555a69e5f65173ec7840000eb8e953d046740", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/124555a69e5f65173ec7840000eb8e953d046740", "html_url": "https://github.com/rust-lang/rust/commit/124555a69e5f65173ec7840000eb8e953d046740", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/124555a69e5f65173ec7840000eb8e953d046740/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1bd4fdc943513e1004f498bbf289279c9784fc6f", "url": "https://api.github.com/repos/rust-lang/rust/commits/1bd4fdc943513e1004f498bbf289279c9784fc6f", "html_url": "https://github.com/rust-lang/rust/commit/1bd4fdc943513e1004f498bbf289279c9784fc6f"}, {"sha": "852dea89b2289fe101f2bbd807c0abdd09902e08", "url": "https://api.github.com/repos/rust-lang/rust/commits/852dea89b2289fe101f2bbd807c0abdd09902e08", "html_url": "https://github.com/rust-lang/rust/commit/852dea89b2289fe101f2bbd807c0abdd09902e08"}], "stats": {"total": 5, "additions": 2, "deletions": 3}, "files": [{"sha": "a639772fde70990f0150c60f4459d4e60cf88ea7", "filename": "compiler/rustc_metadata/src/rmeta/decoder/cstore_impl.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/124555a69e5f65173ec7840000eb8e953d046740/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/124555a69e5f65173ec7840000eb8e953d046740/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_metadata%2Fsrc%2Frmeta%2Fdecoder%2Fcstore_impl.rs?ref=124555a69e5f65173ec7840000eb8e953d046740", "patch": "@@ -352,7 +352,7 @@ pub(in crate::rmeta) fn provide(providers: &mut Providers) {\n                 visible_parent_map.entry(child).or_insert(parent);\n             }\n \n-            visible_parent_map\n+            Lrc::new(visible_parent_map)\n         },\n \n         dependency_formats: |tcx, ()| Lrc::new(crate::dependency_format::calculate(tcx)),"}, {"sha": "6dd1ee893a48bdba59b673e13e075de0b191d2da", "filename": "compiler/rustc_middle/src/query/mod.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/124555a69e5f65173ec7840000eb8e953d046740/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/124555a69e5f65173ec7840000eb8e953d046740/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs?ref=124555a69e5f65173ec7840000eb8e953d046740", "patch": "@@ -1569,8 +1569,7 @@ rustc_queries! {\n         desc { \"calculating the missing lang items in a crate\" }\n         separate_provide_extern\n     }\n-    query visible_parent_map(_: ()) -> DefIdMap<DefId> {\n-        storage(ArenaCacheSelector<'tcx>)\n+    query visible_parent_map(_: ()) -> Lrc<DefIdMap<DefId>> {\n         desc { \"calculating the visible parent map\" }\n     }\n     query trimmed_def_paths(_: ()) -> FxHashMap<DefId, Symbol> {"}]}