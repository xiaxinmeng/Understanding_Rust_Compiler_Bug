{"sha": "380afc1fac2ababb5f335c19c2d764aa8c522d32", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM4MGFmYzFmYWMyYWJhYmI1ZjMzNWMxOWMyZDc2NGFhOGM1MjJkMzI=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2019-12-19T22:53:54Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-12-19T22:53:54Z"}, "message": "Rollup merge of #67351 - Mark-Simulacrum:always-channel, r=pietroalbini\n\nSet release channel on non-dist builders\n\nToolstate publication only runs if the channel is \"nightly\" and\npreviously the toolstate builders did not know that the channel was\nnightly (since they are not dist builders).\n\nA look through bootstrap seems to indicate that nothing should directly\ndepend on the channel being set to `-dev` on the test builders, though\nthis may cause some problems with UI tests (if for some reason they're\ndumping the channel into stderr), but we cannot find evidence of such so\nhopefully this is fine.\n\nr? @pietroalbini", "tree": {"sha": "5e3fabdb8276ea4f6f734cd21a439fc77c6a5b2c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5e3fabdb8276ea4f6f734cd21a439fc77c6a5b2c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/380afc1fac2ababb5f335c19c2d764aa8c522d32", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJd+/+DCRBK7hj4Ov3rIwAAdHIIACvVPm9swv3FjsArq00QJyJC\n/V/vb9r6v9HX8PDx7F1oOK4gjB4Rphh0Ts+qG3XhSvRDYVvFC99FT+hJ3WX4UMfO\nIEd18S03MY0NFmIjZ7knmyJFh7q4r9TvrEBonlaRXGfSfFTR63aO+h17Tm1h1NuF\nGomZTn6U1ZDc7JdOrvQzwIqatb4J4MTIFTN4F9L10A/gKg80EUG+ot4FRybc23Oa\nfsBk8u6PtWLfJf59cbLEMP8nkCVVL5UXU4WhmJce1Dv6S0Cil5Zo2CY96keSo6p1\nwwVWrMbcS0bQ/YeGjxIixzpKyCizUngEm3jh02eyRkN5W4gDl9GHJFClK4x6AEQ=\n=Tt7l\n-----END PGP SIGNATURE-----\n", "payload": "tree 5e3fabdb8276ea4f6f734cd21a439fc77c6a5b2c\nparent 9d1baaf11d0469b23763b9bd878296e5728f1c26\nparent cbd1e73124dbd35cde4b5cafff127a4e54fef9fe\nauthor Mark Rousskov <mark.simulacrum@gmail.com> 1576796034 -0500\ncommitter GitHub <noreply@github.com> 1576796034 -0500\n\nRollup merge of #67351 - Mark-Simulacrum:always-channel, r=pietroalbini\n\nSet release channel on non-dist builders\n\nToolstate publication only runs if the channel is \"nightly\" and\npreviously the toolstate builders did not know that the channel was\nnightly (since they are not dist builders).\n\nA look through bootstrap seems to indicate that nothing should directly\ndepend on the channel being set to `-dev` on the test builders, though\nthis may cause some problems with UI tests (if for some reason they're\ndumping the channel into stderr), but we cannot find evidence of such so\nhopefully this is fine.\n\nr? @pietroalbini\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/380afc1fac2ababb5f335c19c2d764aa8c522d32", "html_url": "https://github.com/rust-lang/rust/commit/380afc1fac2ababb5f335c19c2d764aa8c522d32", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/380afc1fac2ababb5f335c19c2d764aa8c522d32/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9d1baaf11d0469b23763b9bd878296e5728f1c26", "url": "https://api.github.com/repos/rust-lang/rust/commits/9d1baaf11d0469b23763b9bd878296e5728f1c26", "html_url": "https://github.com/rust-lang/rust/commit/9d1baaf11d0469b23763b9bd878296e5728f1c26"}, {"sha": "cbd1e73124dbd35cde4b5cafff127a4e54fef9fe", "url": "https://api.github.com/repos/rust-lang/rust/commits/cbd1e73124dbd35cde4b5cafff127a4e54fef9fe", "html_url": "https://github.com/rust-lang/rust/commit/cbd1e73124dbd35cde4b5cafff127a4e54fef9fe"}], "stats": {"total": 13, "additions": 9, "deletions": 4}, "files": [{"sha": "b5ebf835506b842ee946d4cf791dd57c9e55d495", "filename": "src/bootstrap/toolstate.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/380afc1fac2ababb5f335c19c2d764aa8c522d32/src%2Fbootstrap%2Ftoolstate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/380afc1fac2ababb5f335c19c2d764aa8c522d32/src%2Fbootstrap%2Ftoolstate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftoolstate.rs?ref=380afc1fac2ababb5f335c19c2d764aa8c522d32", "patch": "@@ -13,13 +13,13 @@ use std::env;\n // Each cycle is 42 days long (6 weeks); the last week is 35..=42 then.\n const BETA_WEEK_START: u64 = 35;\n \n-#[cfg(linux)]\n+#[cfg(target_os = \"linux\")]\n const OS: Option<&str> = Some(\"linux\");\n \n #[cfg(windows)]\n const OS: Option<&str> = Some(\"windows\");\n \n-#[cfg(all(not(linux), not(windows)))]\n+#[cfg(all(not(target_os = \"linux\"), not(windows)))]\n const OS: Option<&str> = None;\n \n type ToolstateData = HashMap<Box<str>, ToolState>;\n@@ -379,7 +379,7 @@ fn change_toolstate(\n     let mut regressed = false;\n     for repo_state in old_toolstate {\n         let tool = &repo_state.tool;\n-        let state = if cfg!(linux) {\n+        let state = if cfg!(target_os = \"linux\") {\n             &repo_state.linux\n         } else if cfg!(windows) {\n             &repo_state.windows"}, {"sha": "73c3a964f53967d2578c5b543c70335b514a43fc", "filename": "src/ci/run.sh", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/380afc1fac2ababb5f335c19c2d764aa8c522d32/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/380afc1fac2ababb5f335c19c2d764aa8c522d32/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=380afc1fac2ababb5f335c19c2d764aa8c522d32", "patch": "@@ -44,8 +44,13 @@ fi\n # FIXME: need a scheme for changing this `nightly` value to `beta` and `stable`\n #        either automatically or manually.\n export RUST_RELEASE_CHANNEL=nightly\n+\n+# Always set the release channel for bootstrap; this is normally not important (i.e., only dist\n+# builds would seem to matter) but in practice bootstrap wants to know whether we're targeting\n+# master, beta, or stable with a build to determine whether to run some checks (notably toolstate).\n+RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --release-channel=$RUST_RELEASE_CHANNEL\"\n+\n if [ \"$DEPLOY$DEPLOY_ALT\" = \"1\" ]; then\n-  RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --release-channel=$RUST_RELEASE_CHANNEL\"\n   RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --enable-llvm-static-stdcpp\"\n   RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --set rust.remap-debuginfo\"\n   RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --debuginfo-level-std=1\""}]}