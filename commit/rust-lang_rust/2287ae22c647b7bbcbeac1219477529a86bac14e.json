{"sha": "2287ae22c647b7bbcbeac1219477529a86bac14e", "node_id": "C_kwDOAAsO6NoAKDIyODdhZTIyYzY0N2I3YmJjYmVhYzEyMTk0Nzc1MjlhODZiYWMxNGU", "commit": {"author": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2022-05-13T13:06:16Z"}, "committer": {"name": "Jonas Schievink", "email": "jonas.schievink@ferrous-systems.com", "date": "2022-05-13T13:06:16Z"}, "message": "Revert \"Skip only the `tt::Literal` when consuming float tokens\"\n\nThis reverts commit 7db55313a17a488a8e437fbd184290995f04a32d.", "tree": {"sha": "820d3752e5dd7386626c79f8e6f69a30cfc77c90", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/820d3752e5dd7386626c79f8e6f69a30cfc77c90"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2287ae22c647b7bbcbeac1219477529a86bac14e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2287ae22c647b7bbcbeac1219477529a86bac14e", "html_url": "https://github.com/rust-lang/rust/commit/2287ae22c647b7bbcbeac1219477529a86bac14e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2287ae22c647b7bbcbeac1219477529a86bac14e/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bde036b74edfe20ed879bcef97e61fcde0c0dee6", "url": "https://api.github.com/repos/rust-lang/rust/commits/bde036b74edfe20ed879bcef97e61fcde0c0dee6", "html_url": "https://github.com/rust-lang/rust/commit/bde036b74edfe20ed879bcef97e61fcde0c0dee6"}], "stats": {"total": 66, "additions": 25, "deletions": 41}, "files": [{"sha": "2de10ddbdf9bfb32fc5c52b8f8f616ce5dc63418", "filename": "crates/hir-def/src/macro_expansion_tests/mbe/meta_syntax.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2287ae22c647b7bbcbeac1219477529a86bac14e/crates%2Fhir-def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Fmeta_syntax.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2287ae22c647b7bbcbeac1219477529a86bac14e/crates%2Fhir-def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Fmeta_syntax.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Fmeta_syntax.rs?ref=2287ae22c647b7bbcbeac1219477529a86bac14e", "patch": "@@ -80,7 +80,7 @@ macro_rules! f3 { ($i:_) => () }\n \n #[test]\n fn test_rustc_issue_57597() {\n-    // <https://github.com/rust-lang/rust/blob/master/src/test/ui/macros/issue-57597.rs>\n+    // <https://github.com/rust-lang/rust/blob/master/src/test/ui/issues/issue-57597.rs>\n     check(\n         r#\"\n macro_rules! m0 { ($($($i:ident)?)+) => {}; }"}, {"sha": "0710b1ac3d6961c1fd8ec265ad24eea487974c80", "filename": "crates/hir-def/src/macro_expansion_tests/mbe/tt_conversion.rs", "status": "modified", "additions": 24, "deletions": 27, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/2287ae22c647b7bbcbeac1219477529a86bac14e/crates%2Fhir-def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Ftt_conversion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2287ae22c647b7bbcbeac1219477529a86bac14e/crates%2Fhir-def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Ftt_conversion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-def%2Fsrc%2Fmacro_expansion_tests%2Fmbe%2Ftt_conversion.rs?ref=2287ae22c647b7bbcbeac1219477529a86bac14e", "patch": "@@ -38,7 +38,6 @@ macro_rules! m {\n         let _ = 12E+99_f64;\n         let _ = \"rust1\";\n         let _ = -92;\n-        let _ = -1.3e4f32;\n     }\n }\n fn f() {\n@@ -53,7 +52,6 @@ macro_rules! m {\n         let _ = 12E+99_f64;\n         let _ = \"rust1\";\n         let _ = -92;\n-        let _ = -1.3e4f32;\n     }\n }\n fn f() {\n@@ -62,7 +60,6 @@ fn f() {\n     let _ = 12E+99_f64;\n     let _ = \"rust1\";\n     let _ = -92;\n-    let _ = -1.3e4f32;\n }\n \"#]],\n     );\n@@ -152,30 +149,6 @@ $ = ();\n     )\n }\n \n-#[test]\n-fn float_literal_in_output() {\n-    check(\n-        r#\"\n-macro_rules! constant {\n-    ($e:expr ;) => {$e};\n-}\n-\n-const _: () = constant!(0.0;);\n-const _: () = constant!(0.;);\n-const _: () = constant!(0e0;);\n-\"#,\n-        expect![[r#\"\n-macro_rules! constant {\n-    ($e:expr ;) => {$e};\n-}\n-\n-const _: () = 0.0;\n-const _: () = 0.;\n-const _: () = 0e0;\n-\"#]],\n-    );\n-}\n-\n #[test]\n fn float_literal_in_tt() {\n     check(\n@@ -201,3 +174,27 @@ constant!(0.3;\n \"#]],\n     );\n }\n+\n+#[test]\n+fn float_literal_in_output() {\n+    check(\n+        r#\"\n+macro_rules! constant {\n+    ($e:expr ;) => {$e};\n+}\n+\n+const _: () = constant!(0.0;);\n+const _: () = constant!(0.;);\n+const _: () = constant!(0e0;);\n+\"#,\n+        expect![[r#\"\n+macro_rules! constant {\n+    ($e:expr ;) => {$e};\n+}\n+\n+const _: () = 0.0;\n+const _: () = 0.;\n+const _: () = 0e0;\n+\"#]],\n+    );\n+}"}, {"sha": "79fd1250e0e302893e1e291003bd04f59f59cff5", "filename": "crates/mbe/src/syntax_bridge.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2287ae22c647b7bbcbeac1219477529a86bac14e/crates%2Fmbe%2Fsrc%2Fsyntax_bridge.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2287ae22c647b7bbcbeac1219477529a86bac14e/crates%2Fmbe%2Fsrc%2Fsyntax_bridge.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fmbe%2Fsrc%2Fsyntax_bridge.rs?ref=2287ae22c647b7bbcbeac1219477529a86bac14e", "patch": "@@ -266,13 +266,11 @@ fn convert_tokens<C: TokenConvertor>(conv: &mut C) -> tt::Subtree {\n                     let mut text = token.to_text(conv).to_string();\n                     if kind == FLOAT_NUMBER_START_1 || kind == FLOAT_NUMBER_START_2 {\n                         let (dot, dot_range) = conv.bump().unwrap();\n-                        assert_eq!(dot.kind(conv), DOT);\n                         text += &*dot.to_text(conv);\n                         range = TextRange::new(range.start(), dot_range.end());\n \n                         if kind == FLOAT_NUMBER_START_2 {\n                             let (tail, tail_range) = conv.bump().unwrap();\n-                            assert_eq!(tail.kind(conv), FLOAT_NUMBER_PART);\n                             text += &*tail.to_text(conv);\n                             range = TextRange::new(range.start(), tail_range.end());\n                         }"}, {"sha": "fc5590b71845163a92a74b122f4074217846e909", "filename": "crates/mbe/src/tt_iter.rs", "status": "modified", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/2287ae22c647b7bbcbeac1219477529a86bac14e/crates%2Fmbe%2Fsrc%2Ftt_iter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2287ae22c647b7bbcbeac1219477529a86bac14e/crates%2Fmbe%2Fsrc%2Ftt_iter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fmbe%2Fsrc%2Ftt_iter.rs?ref=2287ae22c647b7bbcbeac1219477529a86bac14e", "patch": "@@ -90,20 +90,9 @@ impl<'a> TtIter<'a> {\n \n         let mut cursor = buffer.begin();\n         let mut error = false;\n-        let mut float_fragments_to_skip = 0;\n         for step in tree_traversal.iter() {\n             match step {\n                 parser::Step::Token { kind, mut n_input_tokens } => {\n-                    if float_fragments_to_skip > 0 {\n-                        float_fragments_to_skip -= 1;\n-                        n_input_tokens = 0;\n-                    }\n-                    match kind {\n-                        SyntaxKind::LIFETIME_IDENT => n_input_tokens = 2,\n-                        SyntaxKind::FLOAT_NUMBER_START_1 => float_fragments_to_skip = 1,\n-                        SyntaxKind::FLOAT_NUMBER_START_2 => float_fragments_to_skip = 2,\n-                        _ => {}\n-                    }\n                     if kind == SyntaxKind::LIFETIME_IDENT {\n                         n_input_tokens = 2;\n                     }"}]}