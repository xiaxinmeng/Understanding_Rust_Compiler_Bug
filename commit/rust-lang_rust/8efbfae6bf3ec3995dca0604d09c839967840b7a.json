{"sha": "8efbfae6bf3ec3995dca0604d09c839967840b7a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhlZmJmYWU2YmYzZWMzOTk1ZGNhMDYwNGQwOWM4Mzk5Njc4NDBiN2E=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-04-12T00:09:55Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-04-12T00:16:32Z"}, "message": "rustbuild: Fix handling of the bootstrap key\n\nBring the calculation logic in line with the makefiles and also set the\nRUSTC_BOOTSTRAP_KEY environment variable to enable the bootstrap on the stable\ncompiler.", "tree": {"sha": "efe95e7880f36805d298b8355252f8dfd8c75a55", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/efe95e7880f36805d298b8355252f8dfd8c75a55"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8efbfae6bf3ec3995dca0604d09c839967840b7a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8efbfae6bf3ec3995dca0604d09c839967840b7a", "html_url": "https://github.com/rust-lang/rust/commit/8efbfae6bf3ec3995dca0604d09c839967840b7a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8efbfae6bf3ec3995dca0604d09c839967840b7a/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b622c3e0856767d8e53cf141e2e0a7b6d72a198b", "url": "https://api.github.com/repos/rust-lang/rust/commits/b622c3e0856767d8e53cf141e2e0a7b6d72a198b", "html_url": "https://github.com/rust-lang/rust/commit/b622c3e0856767d8e53cf141e2e0a7b6d72a198b"}], "stats": {"total": 59, "additions": 51, "deletions": 8}, "files": [{"sha": "722feab212eeb93f1ad8c6387a97986863d32882", "filename": "src/bootstrap/Cargo.lock", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8efbfae6bf3ec3995dca0604d09c839967840b7a/src%2Fbootstrap%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/8efbfae6bf3ec3995dca0604d09c839967840b7a/src%2Fbootstrap%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2FCargo.lock?ref=8efbfae6bf3ec3995dca0604d09c839967840b7a", "patch": "@@ -9,6 +9,7 @@ dependencies = [\n  \"getopts 0.2.14 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"kernel32-sys 0.2.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.9 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"md5 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"num_cpus 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-serialize 0.3.19 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"toml 0.1.28 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -59,6 +60,11 @@ name = \"libc\"\n version = \"0.2.9\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"md5\"\n+version = \"0.1.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"num_cpus\"\n version = \"0.2.11\""}, {"sha": "88dd19a7697dcfe414d9226c7a5b68eeca4eb46a", "filename": "src/bootstrap/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8efbfae6bf3ec3995dca0604d09c839967840b7a/src%2Fbootstrap%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/8efbfae6bf3ec3995dca0604d09c839967840b7a/src%2Fbootstrap%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2FCargo.toml?ref=8efbfae6bf3ec3995dca0604d09c839967840b7a", "patch": "@@ -31,3 +31,4 @@ winapi = \"0.2\"\n kernel32-sys = \"0.2\"\n gcc = \"0.3.17\"\n libc = \"0.2\"\n+md5 = \"0.1\""}, {"sha": "611e3475610a7108da9c170386de7abed36c5830", "filename": "src/bootstrap/build/channel.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/8efbfae6bf3ec3995dca0604d09c839967840b7a/src%2Fbootstrap%2Fbuild%2Fchannel.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8efbfae6bf3ec3995dca0604d09c839967840b7a/src%2Fbootstrap%2Fbuild%2Fchannel.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuild%2Fchannel.rs?ref=8efbfae6bf3ec3995dca0604d09c839967840b7a", "patch": "@@ -8,15 +8,15 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+use std::env;\n use std::fs::{self, File};\n use std::io::prelude::*;\n-use std::path::Path;\n use std::process::Command;\n \n use build_helper::output;\n+use md5;\n \n use build::Build;\n-use build::util::mtime;\n \n pub fn collect(build: &mut Build) {\n     let mut main_mk = String::new();\n@@ -80,7 +80,8 @@ pub fn collect(build: &mut Build) {\n         build.short_ver_hash = Some(short_ver_hash);\n     }\n \n-    build.bootstrap_key = mtime(Path::new(\"config.toml\")).seconds()\n-                                                        .to_string();\n+    let key = md5::compute(build.release.as_bytes());\n+    build.bootstrap_key = format!(\"{:02x}{:02x}{:02x}{:02x}\",\n+                                  key[0], key[1], key[2], key[3]);\n+    env::set_var(\"RUSTC_BOOTSTRAP_KEY\", &build.bootstrap_key);\n }\n-"}, {"sha": "bf29ac107ffbf666a8244ad0f0d7730e814f82ec", "filename": "src/bootstrap/main.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8efbfae6bf3ec3995dca0604d09c839967840b7a/src%2Fbootstrap%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8efbfae6bf3ec3995dca0604d09c839967840b7a/src%2Fbootstrap%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fmain.rs?ref=8efbfae6bf3ec3995dca0604d09c839967840b7a", "patch": "@@ -20,6 +20,7 @@ extern crate libc;\n extern crate num_cpus;\n extern crate rustc_serialize;\n extern crate toml;\n+extern crate md5;\n \n use std::env;\n "}, {"sha": "a3420d75218fb1c9fd5d1277431881f65c742790", "filename": "src/rustc/Cargo.lock", "status": "modified", "additions": 37, "deletions": 3, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/8efbfae6bf3ec3995dca0604d09c839967840b7a/src%2Frustc%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/8efbfae6bf3ec3995dca0604d09c839967840b7a/src%2Frustc%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustc%2FCargo.lock?ref=8efbfae6bf3ec3995dca0604d09c839967840b7a", "patch": "@@ -73,7 +73,7 @@ dependencies = [\n  \"rbml 0.0.0\",\n  \"rustc_back 0.0.0\",\n  \"rustc_bitflags 0.0.0\",\n- \"rustc_const_eval 0.0.0\",\n+ \"rustc_const_math 0.0.0\",\n  \"rustc_data_structures 0.0.0\",\n  \"serialize 0.0.0\",\n  \"syntax 0.0.0\",\n@@ -106,6 +106,19 @@ dependencies = [\n [[package]]\n name = \"rustc_const_eval\"\n version = \"0.0.0\"\n+dependencies = [\n+ \"graphviz 0.0.0\",\n+ \"log 0.0.0\",\n+ \"rustc 0.0.0\",\n+ \"rustc_back 0.0.0\",\n+ \"rustc_const_math 0.0.0\",\n+ \"serialize 0.0.0\",\n+ \"syntax 0.0.0\",\n+]\n+\n+[[package]]\n+name = \"rustc_const_math\"\n+version = \"0.0.0\"\n dependencies = [\n  \"log 0.0.0\",\n  \"serialize 0.0.0\",\n@@ -131,6 +144,8 @@ dependencies = [\n  \"rustc 0.0.0\",\n  \"rustc_back 0.0.0\",\n  \"rustc_borrowck 0.0.0\",\n+ \"rustc_const_eval 0.0.0\",\n+ \"rustc_incremental 0.0.0\",\n  \"rustc_lint 0.0.0\",\n  \"rustc_llvm 0.0.0\",\n  \"rustc_metadata 0.0.0\",\n@@ -147,13 +162,27 @@ dependencies = [\n  \"syntax_ext 0.0.0\",\n ]\n \n+[[package]]\n+name = \"rustc_incremental\"\n+version = \"0.0.0\"\n+dependencies = [\n+ \"graphviz 0.0.0\",\n+ \"log 0.0.0\",\n+ \"rbml 0.0.0\",\n+ \"rustc 0.0.0\",\n+ \"rustc_data_structures 0.0.0\",\n+ \"serialize 0.0.0\",\n+ \"syntax 0.0.0\",\n+]\n+\n [[package]]\n name = \"rustc_lint\"\n version = \"0.0.0\"\n dependencies = [\n  \"log 0.0.0\",\n  \"rustc 0.0.0\",\n  \"rustc_back 0.0.0\",\n+ \"rustc_const_eval 0.0.0\",\n  \"syntax 0.0.0\",\n ]\n \n@@ -176,7 +205,7 @@ dependencies = [\n  \"rustc 0.0.0\",\n  \"rustc_back 0.0.0\",\n  \"rustc_bitflags 0.0.0\",\n- \"rustc_const_eval 0.0.0\",\n+ \"rustc_const_math 0.0.0\",\n  \"rustc_llvm 0.0.0\",\n  \"serialize 0.0.0\",\n  \"syntax 0.0.0\",\n@@ -191,6 +220,7 @@ dependencies = [\n  \"rustc 0.0.0\",\n  \"rustc_back 0.0.0\",\n  \"rustc_const_eval 0.0.0\",\n+ \"rustc_const_math 0.0.0\",\n  \"rustc_data_structures 0.0.0\",\n  \"syntax 0.0.0\",\n ]\n@@ -201,6 +231,7 @@ version = \"0.0.0\"\n dependencies = [\n  \"log 0.0.0\",\n  \"rustc 0.0.0\",\n+ \"rustc_const_eval 0.0.0\",\n  \"syntax 0.0.0\",\n ]\n \n@@ -247,7 +278,6 @@ version = \"0.0.0\"\n dependencies = [\n  \"log 0.0.0\",\n  \"rustc 0.0.0\",\n- \"rustc_front 0.0.0\",\n  \"syntax 0.0.0\",\n ]\n \n@@ -262,7 +292,9 @@ dependencies = [\n  \"rustc 0.0.0\",\n  \"rustc_back 0.0.0\",\n  \"rustc_const_eval 0.0.0\",\n+ \"rustc_const_math 0.0.0\",\n  \"rustc_data_structures 0.0.0\",\n+ \"rustc_incremental 0.0.0\",\n  \"rustc_llvm 0.0.0\",\n  \"rustc_mir 0.0.0\",\n  \"rustc_platform_intrinsics 0.0.0\",\n@@ -280,6 +312,7 @@ dependencies = [\n  \"rustc 0.0.0\",\n  \"rustc_back 0.0.0\",\n  \"rustc_const_eval 0.0.0\",\n+ \"rustc_const_math 0.0.0\",\n  \"rustc_platform_intrinsics 0.0.0\",\n  \"syntax 0.0.0\",\n ]\n@@ -294,6 +327,7 @@ dependencies = [\n  \"log 0.0.0\",\n  \"rustc 0.0.0\",\n  \"rustc_back 0.0.0\",\n+ \"rustc_const_eval 0.0.0\",\n  \"rustc_driver 0.0.0\",\n  \"rustc_lint 0.0.0\",\n  \"rustc_metadata 0.0.0\","}]}