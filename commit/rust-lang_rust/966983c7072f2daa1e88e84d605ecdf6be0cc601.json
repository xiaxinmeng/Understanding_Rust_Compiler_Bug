{"sha": "966983c7072f2daa1e88e84d605ecdf6be0cc601", "node_id": "C_kwDOAAsO6NoAKDk2Njk4M2M3MDcyZjJkYWExZTg4ZTg0ZDYwNWVjZGY2YmUwY2M2MDE", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2022-01-03T13:22:41Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2022-01-03T13:22:41Z"}, "message": "simplify", "tree": {"sha": "a240299c9d4c0bb2f8d0fa516eebd90d2aa50b71", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a240299c9d4c0bb2f8d0fa516eebd90d2aa50b71"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/966983c7072f2daa1e88e84d605ecdf6be0cc601", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/966983c7072f2daa1e88e84d605ecdf6be0cc601", "html_url": "https://github.com/rust-lang/rust/commit/966983c7072f2daa1e88e84d605ecdf6be0cc601", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/966983c7072f2daa1e88e84d605ecdf6be0cc601/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8e9ccbf97a70259b6c6576e8fd7d77d28238737e", "url": "https://api.github.com/repos/rust-lang/rust/commits/8e9ccbf97a70259b6c6576e8fd7d77d28238737e", "html_url": "https://github.com/rust-lang/rust/commit/8e9ccbf97a70259b6c6576e8fd7d77d28238737e"}], "stats": {"total": 8, "additions": 2, "deletions": 6}, "files": [{"sha": "074407ea74b8471887eb5752915cafc044afefc2", "filename": "crates/mbe/src/expander/matcher.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/966983c7072f2daa1e88e84d605ecdf6be0cc601/crates%2Fmbe%2Fsrc%2Fexpander%2Fmatcher.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966983c7072f2daa1e88e84d605ecdf6be0cc601/crates%2Fmbe%2Fsrc%2Fexpander%2Fmatcher.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fmbe%2Fsrc%2Fexpander%2Fmatcher.rs?ref=966983c7072f2daa1e88e84d605ecdf6be0cc601", "patch": "@@ -697,6 +697,7 @@ fn match_meta_var(kind: &str, input: &mut TtIter) -> ExpandResult<Option<Fragmen\n         \"block\" => parser::PrefixEntryPoint::Block,\n         \"meta\" => parser::PrefixEntryPoint::MetaItem,\n         \"item\" => parser::PrefixEntryPoint::Item,\n+        \"vis\" => parser::PrefixEntryPoint::Vis,\n         \"expr\" => {\n             return input\n                 .expect_fragment(parser::PrefixEntryPoint::Expr)\n@@ -728,8 +729,6 @@ fn match_meta_var(kind: &str, input: &mut TtIter) -> ExpandResult<Option<Fragmen\n                         })\n                         .map_err(|()| err!())\n                 }\n-                // `vis` is optional\n-                \"vis\" => Ok(input.expect_fragment(parser::PrefixEntryPoint::Vis).value),\n                 _ => Err(ExpandError::UnexpectedToken),\n             };\n             return tt_result.map(|it| it.map(Fragment::Tokens)).into();"}, {"sha": "9d2b1da9abde6196b7e6d030bacc0c32c44692e2", "filename": "crates/mbe/src/tt_iter.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/966983c7072f2daa1e88e84d605ecdf6be0cc601/crates%2Fmbe%2Fsrc%2Ftt_iter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/966983c7072f2daa1e88e84d605ecdf6be0cc601/crates%2Fmbe%2Fsrc%2Ftt_iter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fmbe%2Fsrc%2Ftt_iter.rs?ref=966983c7072f2daa1e88e84d605ecdf6be0cc601", "patch": "@@ -114,7 +114,7 @@ impl<'a> TtIter<'a> {\n             }\n         }\n \n-        let mut err = if !cursor.is_root() || error {\n+        let err = if error || !cursor.is_root() {\n             Some(err!(\"expected {:?}\", entry_point))\n         } else {\n             None\n@@ -132,9 +132,6 @@ impl<'a> TtIter<'a> {\n             }\n         }\n         self.inner = self.inner.as_slice()[res.len()..].iter();\n-        if res.is_empty() && err.is_none() {\n-            err = Some(err!(\"no tokens consumed\"));\n-        }\n         let res = match res.len() {\n             1 => Some(res[0].cloned()),\n             0 => None,"}]}