{"sha": "1ea34fb463b4472d674576b1d310cd44ce40760b", "node_id": "C_kwDOAAsO6NoAKDFlYTM0ZmI0NjNiNDQ3MmQ2NzQ1NzZiMWQzMTBjZDQ0Y2U0MDc2MGI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-10-23T03:28:27Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-10-23T03:28:27Z"}, "message": "Rollup merge of #90122 - rusticstuff:ci_curl_max_time, r=Mark-Simulacrum\n\nCI: make docker cache download and `docker load` time out after 10 minutes\n\nMight help to prevent timeouts we have been seeing:\n* https://github.com/rust-lang-ci/rust/runs/3946294286?check_suite_focus=true#step:25:23\n* https://github.com/rust-lang-ci/rust/runs/3956799200?check_suite_focus=true#step:25:22\n* https://github.com/rust-lang-ci/rust/runs/3962928502?check_suite_focus=true#step:25:23\n* https://github.com/rust-lang-ci/rust/runs/3967892291?check_suite_focus=true\n* https://github.com/rust-lang-ci/rust/runs/3971202204?check_suite_focus=true\n\nIf the download or loading the images into docker times out the CI will still continue and rebuild the docker image from scratch.", "tree": {"sha": "26f7684ad4ce8f838212ea1e6c9d9149c45b9ede", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/26f7684ad4ce8f838212ea1e6c9d9149c45b9ede"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1ea34fb463b4472d674576b1d310cd44ce40760b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhc4FbCRBK7hj4Ov3rIwAACc8IAI5RH9XeNZlFYcZ//QKtpKpr\nmpcNtpe+fD1im85OuqT34ySYQtQUIgC/6miqYD1JphyZa85a5G9sBw4h4A8sNBCZ\nmJTVhMj6GHr5JOxAdVlyLNf4LVZ39HZTRQkF4nQAYRvd8RE8qHTB/exH0WjhWopU\nTUrL9Y1Or6so7DRSqND9SmHVSy13/QOa6tGu16oTXx4DSXvEEYyE8dpGrAoxB71A\n5QD/8MkEQV+LaknnpyOSNeJiGXdFJBRW6+tgpdbEO6CvujmYhCDZ8EeGu+ZtigFR\nKq/iWdwMM4McRmI4IYBVQTvTYiUr1se0by+vqCeALjgGwjMyCjcDlteLzBRzfq8=\n=UHe1\n-----END PGP SIGNATURE-----\n", "payload": "tree 26f7684ad4ce8f838212ea1e6c9d9149c45b9ede\nparent 270c800d358ee47f3aee6fe1e2ec4dc92616d55f\nparent 3e6a69534f52b08057d18643b62d0f926b80909f\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1634959707 +0200\ncommitter GitHub <noreply@github.com> 1634959707 +0200\n\nRollup merge of #90122 - rusticstuff:ci_curl_max_time, r=Mark-Simulacrum\n\nCI: make docker cache download and `docker load` time out after 10 minutes\n\nMight help to prevent timeouts we have been seeing:\n* https://github.com/rust-lang-ci/rust/runs/3946294286?check_suite_focus=true#step:25:23\n* https://github.com/rust-lang-ci/rust/runs/3956799200?check_suite_focus=true#step:25:22\n* https://github.com/rust-lang-ci/rust/runs/3962928502?check_suite_focus=true#step:25:23\n* https://github.com/rust-lang-ci/rust/runs/3967892291?check_suite_focus=true\n* https://github.com/rust-lang-ci/rust/runs/3971202204?check_suite_focus=true\n\nIf the download or loading the images into docker times out the CI will still continue and rebuild the docker image from scratch.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1ea34fb463b4472d674576b1d310cd44ce40760b", "html_url": "https://github.com/rust-lang/rust/commit/1ea34fb463b4472d674576b1d310cd44ce40760b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1ea34fb463b4472d674576b1d310cd44ce40760b/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "270c800d358ee47f3aee6fe1e2ec4dc92616d55f", "url": "https://api.github.com/repos/rust-lang/rust/commits/270c800d358ee47f3aee6fe1e2ec4dc92616d55f", "html_url": "https://github.com/rust-lang/rust/commit/270c800d358ee47f3aee6fe1e2ec4dc92616d55f"}, {"sha": "3e6a69534f52b08057d18643b62d0f926b80909f", "url": "https://api.github.com/repos/rust-lang/rust/commits/3e6a69534f52b08057d18643b62d0f926b80909f", "html_url": "https://github.com/rust-lang/rust/commit/3e6a69534f52b08057d18643b62d0f926b80909f"}], "stats": {"total": 9, "additions": 7, "deletions": 2}, "files": [{"sha": "b1dacf79d269598d593a3429f567c49b471e549c", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/1ea34fb463b4472d674576b1d310cd44ce40760b/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/1ea34fb463b4472d674576b1d310cd44ce40760b/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=1ea34fb463b4472d674576b1d310cd44ce40760b", "patch": "@@ -70,8 +70,13 @@ if [ -f \"$docker_dir/$image/Dockerfile\" ]; then\n       echo \"Attempting to download $url\"\n       rm -f /tmp/rustci_docker_cache\n       set +e\n-      retry curl -y 30 -Y 10 --connect-timeout 30 -f -L -C - -o /tmp/rustci_docker_cache \"$url\"\n-      loaded_images=$(docker load -i /tmp/rustci_docker_cache | sed 's/.* sha/sha/')\n+      retry curl --max-time 600 -y 30 -Y 10 --connect-timeout 30 -f -L -C - \\\n+        -o /tmp/rustci_docker_cache \"$url\"\n+      echo \"Loading images into docker\"\n+      # docker load sometimes hangs in the CI, so time out after 10 minutes with TERM,\n+      # KILL after 12 minutes\n+      loaded_images=$(/usr/bin/timeout -k 720 600 docker load -i /tmp/rustci_docker_cache \\\n+        | sed 's/.* sha/sha/')\n       set -e\n       echo \"Downloaded containers:\\n$loaded_images\"\n     fi"}]}