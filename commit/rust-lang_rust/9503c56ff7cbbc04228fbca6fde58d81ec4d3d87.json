{"sha": "9503c56ff7cbbc04228fbca6fde58d81ec4d3d87", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk1MDNjNTZmZjdjYmJjMDQyMjhmYmNhNmZkZTU4ZDgxZWM0ZDNkODc=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-01-05T18:56:49Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2019-01-05T20:46:19Z"}, "message": "privacy: Mark everything in a header of a reachable impl as reachable", "tree": {"sha": "d748b0cee748d1b182e1989fc3c6902dafbf1e90", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d748b0cee748d1b182e1989fc3c6902dafbf1e90"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9503c56ff7cbbc04228fbca6fde58d81ec4d3d87", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9503c56ff7cbbc04228fbca6fde58d81ec4d3d87", "html_url": "https://github.com/rust-lang/rust/commit/9503c56ff7cbbc04228fbca6fde58d81ec4d3d87", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9503c56ff7cbbc04228fbca6fde58d81ec4d3d87/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "67713f5b7f502ddeec4b41eef36bd281fea83091", "url": "https://api.github.com/repos/rust-lang/rust/commits/67713f5b7f502ddeec4b41eef36bd281fea83091", "html_url": "https://github.com/rust-lang/rust/commit/67713f5b7f502ddeec4b41eef36bd281fea83091"}], "stats": {"total": 45, "additions": 36, "deletions": 9}, "files": [{"sha": "ec97e4b8cb3fd99ae3caf22945c6d6257ca2b50a", "filename": "src/librustc_privacy/lib.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/9503c56ff7cbbc04228fbca6fde58d81ec4d3d87/src%2Flibrustc_privacy%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9503c56ff7cbbc04228fbca6fde58d81ec4d3d87/src%2Flibrustc_privacy%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_privacy%2Flib.rs?ref=9503c56ff7cbbc04228fbca6fde58d81ec4d3d87", "patch": "@@ -552,7 +552,7 @@ impl<'a, 'tcx> Visitor<'tcx> for EmbargoVisitor<'a, 'tcx> {\n             // Visit everything except for private impl items.\n             hir::ItemKind::Impl(.., ref impl_item_refs) => {\n                 if item_level.is_some() {\n-                    self.reach(item.id, item_level).generics().predicates();\n+                    self.reach(item.id, item_level).generics().predicates().ty().trait_ref();\n \n                     for impl_item_ref in impl_item_refs {\n                         let impl_item_level = self.get(impl_item_ref.id.node_id);\n@@ -711,6 +711,13 @@ impl<'a, 'tcx> ReachEverythingInTheInterfaceVisitor<'_, 'a, 'tcx> {\n         self.visit(self.ev.tcx.type_of(self.item_def_id));\n         self\n     }\n+\n+    fn trait_ref(&mut self) -> &mut Self {\n+        if let Some(trait_ref) = self.ev.tcx.impl_trait_ref(self.item_def_id) {\n+            self.visit_trait(trait_ref);\n+        }\n+        self\n+    }\n }\n \n impl<'a, 'tcx> DefIdVisitor<'a, 'tcx> for ReachEverythingInTheInterfaceVisitor<'_, 'a, 'tcx> {"}, {"sha": "9302fa0d9e8d115bda78bd1d890e12444e2e2827", "filename": "src/test/ui/privacy/auxiliary/issue-57264-1.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/9503c56ff7cbbc04228fbca6fde58d81ec4d3d87/src%2Ftest%2Fui%2Fprivacy%2Fauxiliary%2Fissue-57264-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9503c56ff7cbbc04228fbca6fde58d81ec4d3d87/src%2Ftest%2Fui%2Fprivacy%2Fauxiliary%2Fissue-57264-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fprivacy%2Fauxiliary%2Fissue-57264-1.rs?ref=9503c56ff7cbbc04228fbca6fde58d81ec4d3d87", "previous_filename": "src/test/ui/privacy/auxiliary/issue-57264.rs"}, {"sha": "416206b4f8e7b3163749191943a3d90e7e9e49b6", "filename": "src/test/ui/privacy/auxiliary/issue-57264-2.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/9503c56ff7cbbc04228fbca6fde58d81ec4d3d87/src%2Ftest%2Fui%2Fprivacy%2Fauxiliary%2Fissue-57264-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9503c56ff7cbbc04228fbca6fde58d81ec4d3d87/src%2Ftest%2Fui%2Fprivacy%2Fauxiliary%2Fissue-57264-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fprivacy%2Fauxiliary%2Fissue-57264-2.rs?ref=9503c56ff7cbbc04228fbca6fde58d81ec4d3d87", "patch": "@@ -0,0 +1,10 @@\n+mod inner {\n+    pub struct PubUnnameable;\n+\n+    impl PubUnnameable {\n+        pub fn pub_method(self) {}\n+    }\n+}\n+\n+pub trait PubTraitWithSingleImplementor {}\n+impl PubTraitWithSingleImplementor for Option<inner::PubUnnameable> {}"}, {"sha": "dcffdc3d4ef87e5a29f4d05ab125d09ab679a750", "filename": "src/test/ui/privacy/issue-57264-1.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9503c56ff7cbbc04228fbca6fde58d81ec4d3d87/src%2Ftest%2Fui%2Fprivacy%2Fissue-57264-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9503c56ff7cbbc04228fbca6fde58d81ec4d3d87/src%2Ftest%2Fui%2Fprivacy%2Fissue-57264-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fprivacy%2Fissue-57264-1.rs?ref=9503c56ff7cbbc04228fbca6fde58d81ec4d3d87", "patch": "@@ -0,0 +1,8 @@\n+// compile-pass\n+// aux-build:issue-57264-1.rs\n+\n+extern crate issue_57264_1;\n+\n+fn main() {\n+    issue_57264_1::Pub::pub_method();\n+}"}, {"sha": "79d0d2c7cd785b6e7b70ff8002e1b691cbed0101", "filename": "src/test/ui/privacy/issue-57264-2.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/9503c56ff7cbbc04228fbca6fde58d81ec4d3d87/src%2Ftest%2Fui%2Fprivacy%2Fissue-57264-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9503c56ff7cbbc04228fbca6fde58d81ec4d3d87/src%2Ftest%2Fui%2Fprivacy%2Fissue-57264-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fprivacy%2Fissue-57264-2.rs?ref=9503c56ff7cbbc04228fbca6fde58d81ec4d3d87", "patch": "@@ -0,0 +1,10 @@\n+// compile-pass\n+// aux-build:issue-57264-2.rs\n+\n+extern crate issue_57264_2;\n+\n+fn infer<T: issue_57264_2::PubTraitWithSingleImplementor>(arg: T) -> T { arg }\n+\n+fn main() {\n+    infer(None).unwrap().pub_method();\n+}"}, {"sha": "57e9960a058fe65888493200271af83376aa213c", "filename": "src/test/ui/privacy/issue-57264.rs", "status": "removed", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/67713f5b7f502ddeec4b41eef36bd281fea83091/src%2Ftest%2Fui%2Fprivacy%2Fissue-57264.rs", "raw_url": "https://github.com/rust-lang/rust/raw/67713f5b7f502ddeec4b41eef36bd281fea83091/src%2Ftest%2Fui%2Fprivacy%2Fissue-57264.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fprivacy%2Fissue-57264.rs?ref=67713f5b7f502ddeec4b41eef36bd281fea83091", "patch": "@@ -1,8 +0,0 @@\n-// compile-pass\n-// aux-build:issue-57264.rs\n-\n-extern crate issue_57264;\n-\n-fn main() {\n-    issue_57264::Pub::pub_method();\n-}"}]}