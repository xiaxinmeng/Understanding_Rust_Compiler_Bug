{"sha": "9a5d1974dc5114d6990db47cfd1d1edaabe01ce8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlhNWQxOTc0ZGM1MTE0ZDY5OTBkYjQ3Y2ZkMWQxZWRhYWJlMDFjZTg=", "commit": {"author": {"name": "Jeff Olson", "email": "olson.jeffery@gmail.com", "date": "2012-04-17T05:39:17Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-04-20T22:23:22Z"}, "message": "don't use ::malloc for initializing the global_async_handle in rust_kernel", "tree": {"sha": "cfc74999e34d73d583689b3d4eda55a021c61f42", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cfc74999e34d73d583689b3d4eda55a021c61f42"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9a5d1974dc5114d6990db47cfd1d1edaabe01ce8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9a5d1974dc5114d6990db47cfd1d1edaabe01ce8", "html_url": "https://github.com/rust-lang/rust/commit/9a5d1974dc5114d6990db47cfd1d1edaabe01ce8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9a5d1974dc5114d6990db47cfd1d1edaabe01ce8/comments", "author": {"login": "olsonjeffery", "id": 10408, "node_id": "MDQ6VXNlcjEwNDA4", "avatar_url": "https://avatars.githubusercontent.com/u/10408?v=4", "gravatar_id": "", "url": "https://api.github.com/users/olsonjeffery", "html_url": "https://github.com/olsonjeffery", "followers_url": "https://api.github.com/users/olsonjeffery/followers", "following_url": "https://api.github.com/users/olsonjeffery/following{/other_user}", "gists_url": "https://api.github.com/users/olsonjeffery/gists{/gist_id}", "starred_url": "https://api.github.com/users/olsonjeffery/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/olsonjeffery/subscriptions", "organizations_url": "https://api.github.com/users/olsonjeffery/orgs", "repos_url": "https://api.github.com/users/olsonjeffery/repos", "events_url": "https://api.github.com/users/olsonjeffery/events{/privacy}", "received_events_url": "https://api.github.com/users/olsonjeffery/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f21d25b54c4a721b609a0dbb51ec360f4e4cbcc9", "url": "https://api.github.com/repos/rust-lang/rust/commits/f21d25b54c4a721b609a0dbb51ec360f4e4cbcc9", "html_url": "https://github.com/rust-lang/rust/commit/f21d25b54c4a721b609a0dbb51ec360f4e4cbcc9"}], "stats": {"total": 11, "additions": 4, "deletions": 7}, "files": [{"sha": "7737bd49fe3c8efdf1668f943391e1befc68680f", "filename": "src/libstd/uv_hl.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9a5d1974dc5114d6990db47cfd1d1edaabe01ce8/src%2Flibstd%2Fuv_hl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a5d1974dc5114d6990db47cfd1d1edaabe01ce8/src%2Flibstd%2Fuv_hl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fuv_hl.rs?ref=9a5d1974dc5114d6990db47cfd1d1edaabe01ce8", "patch": "@@ -17,7 +17,6 @@ native mod rustrt {\n     fn rust_uv_get_kernel_global_chan_ptr() -> *libc::uintptr_t;\n     fn rust_uv_get_kernel_global_async_handle() -> **libc::c_void;\n     fn rust_uv_set_kernel_global_async_handle(handle: *ll::uv_async_t);\n-    fn rust_uv_free_kernel_global_async_handle();\n }\n \n #[doc = \""}, {"sha": "1ff6fad64ab6545a76dd6c495fc63d3f72044c77", "filename": "src/rt/rust_kernel.cpp", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9a5d1974dc5114d6990db47cfd1d1edaabe01ce8/src%2Frt%2Frust_kernel.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/9a5d1974dc5114d6990db47cfd1d1edaabe01ce8/src%2Frt%2Frust_kernel.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_kernel.cpp?ref=9a5d1974dc5114d6990db47cfd1d1edaabe01ce8", "patch": "@@ -27,8 +27,9 @@ rust_kernel::rust_kernel(rust_env *env) :\n     // set up storage of pointers needed to\n     // access the global loop.\n     global_loop_chan = 0;\n-    global_async_handle = (void**)::malloc( // FIXME--can't use this->malloc()\n-        sizeof(void*));                     // .. what do?\n+    int foo = 0;\n+    async_handle_stub = (void*)&foo;\n+    global_async_handle = &async_handle_stub;\n     *global_async_handle = (void*)0;\n \n     // Create the single threaded scheduler that will run on the platform's"}, {"sha": "b77f9850befbca07dd93e41070ebc8b6672b27c3", "filename": "src/rt/rust_kernel.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9a5d1974dc5114d6990db47cfd1d1edaabe01ce8/src%2Frt%2Frust_kernel.h", "raw_url": "https://github.com/rust-lang/rust/raw/9a5d1974dc5114d6990db47cfd1d1edaabe01ce8/src%2Frt%2Frust_kernel.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_kernel.h?ref=9a5d1974dc5114d6990db47cfd1d1edaabe01ce8", "patch": "@@ -75,6 +75,7 @@ class rust_kernel {\n \n     // Used to communicate with the process-side, global libuv loop\n     uintptr_t global_loop_chan;\n+    void* async_handle_stub;\n     void** global_async_handle;\n \n public:"}, {"sha": "01517539e7a54fb31140bede4981d771f5aeb085", "filename": "src/rt/rust_uv.cpp", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9a5d1974dc5114d6990db47cfd1d1edaabe01ce8/src%2Frt%2Frust_uv.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/9a5d1974dc5114d6990db47cfd1d1edaabe01ce8/src%2Frt%2Frust_uv.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_uv.cpp?ref=9a5d1974dc5114d6990db47cfd1d1edaabe01ce8", "patch": "@@ -454,7 +454,3 @@ extern \"C\" void\n rust_uv_set_kernel_global_async_handle(uv_async_t* handle) {\n     rust_get_current_task()->kernel->set_global_async_handle((void*)handle);\n }\n-extern \"C\" void\n-rust_uv_free_kernel_global_async_handle() {\n-    free((void*)rust_get_current_task()->kernel->get_global_async_handle());\n-}"}]}