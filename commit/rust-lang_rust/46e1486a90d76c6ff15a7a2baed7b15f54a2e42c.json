{"sha": "46e1486a90d76c6ff15a7a2baed7b15f54a2e42c", "node_id": "C_kwDOAAsO6NoAKDQ2ZTE0ODZhOTBkNzZjNmZmMTVhN2EyYmFlZDdiMTVmNTRhMmU0MmM", "commit": {"author": {"name": "Ryo Yoshida", "email": "low.ryoshida@gmail.com", "date": "2022-12-07T14:22:37Z"}, "committer": {"name": "Ryo Yoshida", "email": "low.ryoshida@gmail.com", "date": "2022-12-08T11:52:03Z"}, "message": "Disallow access to free `BoundVar`s outside `TyLoweringContext`", "tree": {"sha": "4925b4e5445481c312b1fdfa9d147e5a0d6106eb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4925b4e5445481c312b1fdfa9d147e5a0d6106eb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/46e1486a90d76c6ff15a7a2baed7b15f54a2e42c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEkSbsQIURluxz4rzf4laYqTBYYXEFAmOR0GYACgkQ4laYqTBY\nYXGFTQ/8Cr2XWD2INsLmaypxYrcv4gUN4BhbF7PaSZ7l0D4VFJsR/l34wefhyN8e\nAc6Xrlng79nrGI4TXpYoibL0ZnHuR9hzd0l8nXdDqEbeYGJNBVTyzx4rT2RrZH6k\ns5e7JjuPLEuIB7btnIL2h8sq6s41NNnRWWIW3eLHL7K8ZIn5FMdxb3HEME02d6e1\ne4ssUsGGzjh2aJ+mVxzhHgvcVbDAF1+zz/9AKpOpe2T4FFp2AX68fNvG3zz7Gxw5\ncOTQ/MCCYbkFO64xCDpKwIG+u8WGFGHldcaA9AN9NkwE/vFPPlCDLF97J7Dq2ncE\nmtA+5irLBUsEC7uWap0KB6MMqbxkB7jwRKuQf7mnSy1m4yZDShVX1i3+TW1ZduHg\nUf6OernJuiKLoDgnVEIv+CvTwl3gpkipA3A3jcFFASD2n9rPUpSSAjOke/LsURF9\n2MFeA4jm9+Y7FROOS5pyI/1pb/7WcE4RpIygbWMqxGdQVbdf6alWFFFYEpoOyGrc\nmiIFMHh04KL/PU3yqAWFtiBlZBvyRvyFpNTrNK6EfbSh0m9AznhfUoVe/l+N57X6\nFhfAOM5Q2nST9nwGpZsFNb9bCvDWHg4E3D4RoBr51CkG0fKMRcpFDtw6FQx+dRjy\n9nhfWvpVBb13SjlP2pZfAvAaAax6qc1ExQNe2cXtK4uOYE02ElI=\n=L4Iq\n-----END PGP SIGNATURE-----", "payload": "tree 4925b4e5445481c312b1fdfa9d147e5a0d6106eb\nparent f9bd48770832a8556ccd1b8e9f147d3f16bcc44a\nauthor Ryo Yoshida <low.ryoshida@gmail.com> 1670422957 +0900\ncommitter Ryo Yoshida <low.ryoshida@gmail.com> 1670500323 +0900\n\nDisallow access to free `BoundVar`s outside `TyLoweringContext`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/46e1486a90d76c6ff15a7a2baed7b15f54a2e42c", "html_url": "https://github.com/rust-lang/rust/commit/46e1486a90d76c6ff15a7a2baed7b15f54a2e42c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/46e1486a90d76c6ff15a7a2baed7b15f54a2e42c/comments", "author": {"login": "lowr", "id": 24381114, "node_id": "MDQ6VXNlcjI0MzgxMTE0", "avatar_url": "https://avatars.githubusercontent.com/u/24381114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lowr", "html_url": "https://github.com/lowr", "followers_url": "https://api.github.com/users/lowr/followers", "following_url": "https://api.github.com/users/lowr/following{/other_user}", "gists_url": "https://api.github.com/users/lowr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lowr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lowr/subscriptions", "organizations_url": "https://api.github.com/users/lowr/orgs", "repos_url": "https://api.github.com/users/lowr/repos", "events_url": "https://api.github.com/users/lowr/events{/privacy}", "received_events_url": "https://api.github.com/users/lowr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lowr", "id": 24381114, "node_id": "MDQ6VXNlcjI0MzgxMTE0", "avatar_url": "https://avatars.githubusercontent.com/u/24381114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lowr", "html_url": "https://github.com/lowr", "followers_url": "https://api.github.com/users/lowr/followers", "following_url": "https://api.github.com/users/lowr/following{/other_user}", "gists_url": "https://api.github.com/users/lowr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lowr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lowr/subscriptions", "organizations_url": "https://api.github.com/users/lowr/orgs", "repos_url": "https://api.github.com/users/lowr/repos", "events_url": "https://api.github.com/users/lowr/events{/privacy}", "received_events_url": "https://api.github.com/users/lowr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f9bd48770832a8556ccd1b8e9f147d3f16bcc44a", "url": "https://api.github.com/repos/rust-lang/rust/commits/f9bd48770832a8556ccd1b8e9f147d3f16bcc44a", "html_url": "https://github.com/rust-lang/rust/commit/f9bd48770832a8556ccd1b8e9f147d3f16bcc44a"}], "stats": {"total": 11, "additions": 7, "deletions": 4}, "files": [{"sha": "5b0c1a63752393d822317cde7c40b1730334e16b", "filename": "crates/hir-ty/src/lower.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/46e1486a90d76c6ff15a7a2baed7b15f54a2e42c/crates%2Fhir-ty%2Fsrc%2Flower.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46e1486a90d76c6ff15a7a2baed7b15f54a2e42c/crates%2Fhir-ty%2Fsrc%2Flower.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-ty%2Fsrc%2Flower.rs?ref=46e1486a90d76c6ff15a7a2baed7b15f54a2e42c", "patch": "@@ -1190,9 +1190,9 @@ pub fn associated_type_shorthand_candidates<R>(\n     db: &dyn HirDatabase,\n     def: GenericDefId,\n     res: TypeNs,\n-    cb: impl FnMut(&Name, &TraitRef, TypeAliasId) -> Option<R>,\n+    mut cb: impl FnMut(&Name, TypeAliasId) -> Option<R>,\n ) -> Option<R> {\n-    named_associated_type_shorthand_candidates(db, def, res, None, cb)\n+    named_associated_type_shorthand_candidates(db, def, res, None, |name, _, id| cb(name, id))\n }\n \n fn named_associated_type_shorthand_candidates<R>(\n@@ -1202,6 +1202,9 @@ fn named_associated_type_shorthand_candidates<R>(\n     def: GenericDefId,\n     res: TypeNs,\n     assoc_name: Option<Name>,\n+    // Do NOT let `cb` touch `TraitRef` outside of `TyLoweringContext`. Its substitution contains\n+    // free `BoundVar`s that need to be shifted and only `TyLoweringContext` knows how to do that\n+    // properly (see `TyLoweringContext::select_associated_type()`).\n     mut cb: impl FnMut(&Name, &TraitRef, TypeAliasId) -> Option<R>,\n ) -> Option<R> {\n     let mut search = |t| {"}, {"sha": "f887c759849776a9642d90e76a5ab82425270beb", "filename": "crates/hir/src/semantics.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/46e1486a90d76c6ff15a7a2baed7b15f54a2e42c/crates%2Fhir%2Fsrc%2Fsemantics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46e1486a90d76c6ff15a7a2baed7b15f54a2e42c/crates%2Fhir%2Fsrc%2Fsemantics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Fsemantics.rs?ref=46e1486a90d76c6ff15a7a2baed7b15f54a2e42c", "patch": "@@ -1600,7 +1600,7 @@ impl<'a> SemanticsScope<'a> {\n             self.db,\n             def,\n             resolution.in_type_ns()?,\n-            |name, _, id| cb(name, id.into()),\n+            |name, id| cb(name, id.into()),\n         )\n     }\n }"}, {"sha": "38950b12a116808f290dcb9b90cc38e243291143", "filename": "crates/hir/src/source_analyzer.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/46e1486a90d76c6ff15a7a2baed7b15f54a2e42c/crates%2Fhir%2Fsrc%2Fsource_analyzer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/46e1486a90d76c6ff15a7a2baed7b15f54a2e42c/crates%2Fhir%2Fsrc%2Fsource_analyzer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Fsource_analyzer.rs?ref=46e1486a90d76c6ff15a7a2baed7b15f54a2e42c", "patch": "@@ -967,7 +967,7 @@ fn resolve_hir_path_(\n                         db,\n                         def,\n                         res.in_type_ns()?,\n-                        |name, _, id| (name == unresolved.name).then(|| id),\n+                        |name, id| (name == unresolved.name).then(|| id),\n                     )\n                 })\n                 .map(TypeAlias::from)"}]}