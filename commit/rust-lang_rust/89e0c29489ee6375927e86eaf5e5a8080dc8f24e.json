{"sha": "89e0c29489ee6375927e86eaf5e5a8080dc8f24e", "node_id": "C_kwDOAAsO6NoAKDg5ZTBjMjk0ODllZTYzNzU5MjdlODZlYWY1ZTVhODA4MGRjOGYyNGU", "commit": {"author": {"name": "Joshua Nelson", "email": "github@jyn.dev", "date": "2022-05-10T15:58:52Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-05-10T15:58:52Z"}, "message": "Revert \"Make \"Assemble stage1 compiler\" orders of magnitude faster\"", "tree": {"sha": "0f9346727c0c61836bc193297d5ad0b2958ac1e0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0f9346727c0c61836bc193297d5ad0b2958ac1e0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/89e0c29489ee6375927e86eaf5e5a8080dc8f24e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJieou8CRBK7hj4Ov3rIwAA3LIIAHpFOOLisWLvyO4AHJnMZgf6\nUY+gpybJ7rCneYbZo6oGpmy65vbbgM0oQ4eWJR1eUT46vl+abUiMVyRiBpCm0RVb\nS3t6FmEmkJPz9A6wo57Rqr1LwS0VEBOjovhxMWdqBWFK/DttyrU6/40wndjmQ8k0\nZ8qzexLXHIiYc+nvsW4Y61E3HIfH8YBN9w07l7oICGbSjvi4ZpHF+STHLXvCBMvo\ng+2vUaiIhBgT7L5Dz//2BVoTUUtBSLui9Iv+tU13lQNK/l98gDX/WV5B9QcSHWu7\n2zBvSN2N1dY7PMQIgM9jHbjd9MoJw2Phn2cOFu5EjuK7WjlPYOtI9PvUbScTHfo=\n=xt6c\n-----END PGP SIGNATURE-----\n", "payload": "tree 0f9346727c0c61836bc193297d5ad0b2958ac1e0\nparent eead58e75bb3a1d9f00b5a988704328fed6bb2c9\nauthor Joshua Nelson <github@jyn.dev> 1652198332 -0500\ncommitter GitHub <noreply@github.com> 1652198332 -0500\n\nRevert \"Make \"Assemble stage1 compiler\" orders of magnitude faster\"\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/89e0c29489ee6375927e86eaf5e5a8080dc8f24e", "html_url": "https://github.com/rust-lang/rust/commit/89e0c29489ee6375927e86eaf5e5a8080dc8f24e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/89e0c29489ee6375927e86eaf5e5a8080dc8f24e/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eead58e75bb3a1d9f00b5a988704328fed6bb2c9", "url": "https://api.github.com/repos/rust-lang/rust/commits/eead58e75bb3a1d9f00b5a988704328fed6bb2c9", "html_url": "https://github.com/rust-lang/rust/commit/eead58e75bb3a1d9f00b5a988704328fed6bb2c9"}], "stats": {"total": 12, "additions": 9, "deletions": 3}, "files": [{"sha": "5d32b4f801a183fb22247e16f7bffcb99aab1d36", "filename": "src/bootstrap/lib.rs", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/89e0c29489ee6375927e86eaf5e5a8080dc8f24e/src%2Fbootstrap%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/89e0c29489ee6375927e86eaf5e5a8080dc8f24e/src%2Fbootstrap%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Flib.rs?ref=89e0c29489ee6375927e86eaf5e5a8080dc8f24e", "patch": "@@ -1497,14 +1497,20 @@ impl Build {\n         let dst = dstdir.join(src.file_name().unwrap());\n         self.verbose_than(1, &format!(\"Install {:?} to {:?}\", src, dst));\n         t!(fs::create_dir_all(dstdir));\n+        drop(fs::remove_file(&dst));\n         {\n             if !src.exists() {\n                 panic!(\"Error: File \\\"{}\\\" not found!\", src.display());\n             }\n-            self.copy(src, &dst);\n+            let metadata = t!(src.symlink_metadata());\n+            if let Err(e) = fs::copy(&src, &dst) {\n+                panic!(\"failed to copy `{}` to `{}`: {}\", src.display(), dst.display(), e)\n+            }\n+            t!(fs::set_permissions(&dst, metadata.permissions()));\n+            let atime = FileTime::from_last_access_time(&metadata);\n+            let mtime = FileTime::from_last_modification_time(&metadata);\n+            t!(filetime::set_file_times(&dst, atime, mtime));\n         }\n-        // NOTE: when using hard-links, this will also update the permissions on the original file.\n-        // We never use permissions that are more restrictive than the original, so this shouldn't cause any issues.\n         chmod(&dst, perms);\n     }\n "}]}