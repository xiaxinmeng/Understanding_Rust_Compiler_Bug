{"sha": "d926147ccbd9bda51a5f0754f62811c0699621e5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ5MjYxNDdjY2JkOWJkYTUxYTVmMDc1NGY2MjgxMWMwNjk5NjIxZTU=", "commit": {"author": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-01-19T06:59:45Z"}, "committer": {"name": "Joshua Nelson", "email": "jyn514@gmail.com", "date": "2021-01-19T07:04:18Z"}, "message": "Remove unnecessary `after_run` function\n\nIt's called at the same time and in the same place as `after_krate`, so\nthey can be combined.", "tree": {"sha": "54f49a7c15f3b1b0d229b6fc99b6ba0bfbb71574", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/54f49a7c15f3b1b0d229b6fc99b6ba0bfbb71574"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d926147ccbd9bda51a5f0754f62811c0699621e5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d926147ccbd9bda51a5f0754f62811c0699621e5", "html_url": "https://github.com/rust-lang/rust/commit/d926147ccbd9bda51a5f0754f62811c0699621e5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d926147ccbd9bda51a5f0754f62811c0699621e5/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1f0fc02cc8ab4e0d9dd3e06a6d46fcb72b2a026f", "url": "https://api.github.com/repos/rust-lang/rust/commits/1f0fc02cc8ab4e0d9dd3e06a6d46fcb72b2a026f", "html_url": "https://github.com/rust-lang/rust/commit/1f0fc02cc8ab4e0d9dd3e06a6d46fcb72b2a026f"}], "stats": {"total": 53, "additions": 30, "deletions": 23}, "files": [{"sha": "c91d6decc0b675a7ab88ab93ac0fafa299adcb67", "filename": "src/librustdoc/formats/renderer.rs", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/d926147ccbd9bda51a5f0754f62811c0699621e5/src%2Flibrustdoc%2Fformats%2Frenderer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d926147ccbd9bda51a5f0754f62811c0699621e5/src%2Flibrustdoc%2Fformats%2Frenderer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fformats%2Frenderer.rs?ref=d926147ccbd9bda51a5f0754f62811c0699621e5", "patch": "@@ -38,10 +38,14 @@ crate trait FormatRenderer<'tcx>: Clone {\n     fn mod_item_out(&mut self, item_name: &str) -> Result<(), Error>;\n \n     /// Post processing hook for cleanup and dumping output to files.\n-    fn after_krate(&mut self, krate: &clean::Crate, cache: &Cache) -> Result<(), Error>;\n-\n-    /// Called after everything else to write out errors.\n-    fn after_run(&mut self, diag: &rustc_errors::Handler) -> Result<(), Error>;\n+    ///\n+    /// A handler is available if the renderer wants to report errors.\n+    fn after_krate(\n+        &mut self,\n+        krate: &clean::Crate,\n+        cache: &Cache,\n+        diag: &rustc_errors::Handler,\n+    ) -> Result<(), Error>;\n }\n \n /// Main method for rendering a crate.\n@@ -104,6 +108,5 @@ crate fn run_format<'tcx, T: FormatRenderer<'tcx>>(\n         }\n     }\n \n-    format_renderer.after_krate(&krate, &cache)?;\n-    format_renderer.after_run(diag)\n+    format_renderer.after_krate(&krate, &cache, diag)\n }"}, {"sha": "fc6ec62c14f517e22dac1c99533a098c52df0a0a", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 15, "deletions": 12, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/d926147ccbd9bda51a5f0754f62811c0699621e5/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d926147ccbd9bda51a5f0754f62811c0699621e5/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=d926147ccbd9bda51a5f0754f62811c0699621e5", "patch": "@@ -523,17 +523,12 @@ impl<'tcx> FormatRenderer<'tcx> for Context<'tcx> {\n         Ok((cx, krate))\n     }\n \n-    fn after_run(&mut self, diag: &rustc_errors::Handler) -> Result<(), Error> {\n-        Arc::get_mut(&mut self.shared).unwrap().fs.close();\n-        let nb_errors = self.errors.iter().map(|err| diag.struct_err(&err).emit()).count();\n-        if nb_errors > 0 {\n-            Err(Error::new(io::Error::new(io::ErrorKind::Other, \"I/O error\"), \"\"))\n-        } else {\n-            Ok(())\n-        }\n-    }\n-\n-    fn after_krate(&mut self, krate: &clean::Crate, cache: &Cache) -> Result<(), Error> {\n+    fn after_krate(\n+        &mut self,\n+        krate: &clean::Crate,\n+        cache: &Cache,\n+        diag: &rustc_errors::Handler,\n+    ) -> Result<(), Error> {\n         let final_file = self.dst.join(&*krate.name.as_str()).join(\"all.html\");\n         let settings_file = self.dst.join(\"settings.html\");\n         let crate_name = krate.name;\n@@ -596,7 +591,15 @@ impl<'tcx> FormatRenderer<'tcx> for Context<'tcx> {\n             &style_files,\n         );\n         self.shared.fs.write(&settings_file, v.as_bytes())?;\n-        Ok(())\n+\n+        // Flush pending errors.\n+        Arc::get_mut(&mut self.shared).unwrap().fs.close();\n+        let nb_errors = self.errors.iter().map(|err| diag.struct_err(&err).emit()).count();\n+        if nb_errors > 0 {\n+            Err(Error::new(io::Error::new(io::ErrorKind::Other, \"I/O error\"), \"\"))\n+        } else {\n+            Ok(())\n+        }\n     }\n \n     fn mod_item_in("}, {"sha": "64500c1d911612db92cfce3cfd27226c09e12ae8", "filename": "src/librustdoc/json/mod.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/d926147ccbd9bda51a5f0754f62811c0699621e5/src%2Flibrustdoc%2Fjson%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d926147ccbd9bda51a5f0754f62811c0699621e5/src%2Flibrustdoc%2Fjson%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fjson%2Fmod.rs?ref=d926147ccbd9bda51a5f0754f62811c0699621e5", "patch": "@@ -199,7 +199,12 @@ impl<'tcx> FormatRenderer<'tcx> for JsonRenderer<'tcx> {\n         Ok(())\n     }\n \n-    fn after_krate(&mut self, krate: &clean::Crate, cache: &Cache) -> Result<(), Error> {\n+    fn after_krate(\n+        &mut self,\n+        krate: &clean::Crate,\n+        cache: &Cache,\n+        _diag: &rustc_errors::Handler,\n+    ) -> Result<(), Error> {\n         debug!(\"Done with crate\");\n         let mut index = (*self.index).clone().into_inner();\n         index.extend(self.get_trait_items(cache));\n@@ -245,8 +250,4 @@ impl<'tcx> FormatRenderer<'tcx> for JsonRenderer<'tcx> {\n         serde_json::ser::to_writer(&file, &output).unwrap();\n         Ok(())\n     }\n-\n-    fn after_run(&mut self, _diag: &rustc_errors::Handler) -> Result<(), Error> {\n-        Ok(())\n-    }\n }"}]}