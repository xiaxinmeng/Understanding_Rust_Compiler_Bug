{"sha": "d70ea7ce48b18820c99c4712ed6afec42d637f9f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ3MGVhN2NlNDhiMTg4MjBjOTljNDcxMmVkNmFmZWM0MmQ2MzdmOWY=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-07-12T20:46:44Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-07-12T20:46:44Z"}, "message": "Rollup merge of #62568 - lzutao:replace_may_dangle, r=matthewjasper\n\nReplace unsafe_destructor_blind_to_params with may_dangle\n\nThis PR will completely remove support for `#[unsafe_destructor_blind_to_params]` attribute,\nwhich is deprecated in #38970 by `[may_dangle]` unsafe  attribute.\n\nCloses #34761", "tree": {"sha": "f10497b3614be93a1bc80c43ba1b6c70e2130427", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f10497b3614be93a1bc80c43ba1b6c70e2130427"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d70ea7ce48b18820c99c4712ed6afec42d637f9f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdKPG1CRBK7hj4Ov3rIwAAdHIIAGAOK4F0zWh4j0el3UYp5V03\nSaCDiPWaAEFib44ZYYkxJUN8kpWhWqAIk8zMYKaoqpqqAyi9k9in6YNoph5v+B2q\nRY7XPaOKGIBk+f/QAkMWbx0miQb4T8unEVGZJMuNVuIts2205iaGtBFveyQUXmvn\n7UDMPLMmxbe9KVofCX1ZS+n6BoPdplGTG5KByYjlqiGyyK1t8GA/T8WsJtujKuY1\nFJgxHhHc38lDdyNy3D4pM3mSzEZQaoj9cjRXBrgqzh1vV2JyPzi69zKHZu4bswVm\n6sqYHGYyAKFtOQOEOviCI3dja1pTQIstWL3MpX/k5rQbWbg7+74ppWXVnldObsI=\n=tyhM\n-----END PGP SIGNATURE-----\n", "payload": "tree f10497b3614be93a1bc80c43ba1b6c70e2130427\nparent e706438d00f8a2de82a3fabd6777c9486e450198\nparent 8347917dd955e40c813867e0fddb52c3adb4711c\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1562964404 +0200\ncommitter GitHub <noreply@github.com> 1562964404 +0200\n\nRollup merge of #62568 - lzutao:replace_may_dangle, r=matthewjasper\n\nReplace unsafe_destructor_blind_to_params with may_dangle\n\nThis PR will completely remove support for `#[unsafe_destructor_blind_to_params]` attribute,\nwhich is deprecated in #38970 by `[may_dangle]` unsafe  attribute.\n\nCloses #34761\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d70ea7ce48b18820c99c4712ed6afec42d637f9f", "html_url": "https://github.com/rust-lang/rust/commit/d70ea7ce48b18820c99c4712ed6afec42d637f9f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d70ea7ce48b18820c99c4712ed6afec42d637f9f/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e706438d00f8a2de82a3fabd6777c9486e450198", "url": "https://api.github.com/repos/rust-lang/rust/commits/e706438d00f8a2de82a3fabd6777c9486e450198", "html_url": "https://github.com/rust-lang/rust/commit/e706438d00f8a2de82a3fabd6777c9486e450198"}, {"sha": "8347917dd955e40c813867e0fddb52c3adb4711c", "url": "https://api.github.com/repos/rust-lang/rust/commits/8347917dd955e40c813867e0fddb52c3adb4711c", "html_url": "https://github.com/rust-lang/rust/commit/8347917dd955e40c813867e0fddb52c3adb4711c"}], "stats": {"total": 182, "additions": 32, "deletions": 150}, "files": [{"sha": "56cb89b5144ac85e35f6d3948fbf87096e39ab9a", "filename": "src/librustc/ty/util.rs", "status": "modified", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Flibrustc%2Fty%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Flibrustc%2Fty%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Futil.rs?ref=d70ea7ce48b18820c99c4712ed6afec42d637f9f", "patch": "@@ -22,7 +22,6 @@ use rustc_macros::HashStable;\n use std::{cmp, fmt};\n use syntax::ast;\n use syntax::attr::{self, SignedInt, UnsignedInt};\n-use syntax::symbol::sym;\n use syntax_pos::{Span, DUMMY_SP};\n \n #[derive(Copy, Clone, Debug)]\n@@ -435,20 +434,6 @@ impl<'tcx> TyCtxt<'tcx> {\n             Some(dtor) => dtor.did\n         };\n \n-        // RFC 1238: if the destructor method is tagged with the\n-        // attribute `unsafe_destructor_blind_to_params`, then the\n-        // compiler is being instructed to *assume* that the\n-        // destructor will not access borrowed data,\n-        // even if such data is otherwise reachable.\n-        //\n-        // Such access can be in plain sight (e.g., dereferencing\n-        // `*foo.0` of `Foo<'a>(&'a u32)`) or indirectly hidden\n-        // (e.g., calling `foo.0.clone()` of `Foo<T:Clone>`).\n-        if self.has_attr(dtor, sym::unsafe_destructor_blind_to_params) {\n-            debug!(\"destructor_constraint({:?}) - blind\", def.did);\n-            return vec![];\n-        }\n-\n         let impl_def_id = self.associated_item(dtor).container.id();\n         let impl_generics = self.generics_of(impl_def_id);\n "}, {"sha": "babffe479bc2ecc0ca17ddd8daf26d3290895bad", "filename": "src/librustc_typeck/check/dropck.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Flibrustc_typeck%2Fcheck%2Fdropck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Flibrustc_typeck%2Fcheck%2Fdropck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fdropck.rs?ref=d70ea7ce48b18820c99c4712ed6afec42d637f9f", "patch": "@@ -246,7 +246,7 @@ fn ensure_drop_predicates_are_implied_by_item_defn<'tcx>(\n ///\n /// * (1.) `D` has a lifetime- or type-parametric Drop implementation,\n ///        (where that `Drop` implementation does not opt-out of\n-///         this check via the `unsafe_destructor_blind_to_params`\n+///         this check via the `may_dangle`\n ///         attribute), and\n /// * (2.) the structure of `D` can reach a reference of type `&'a _`,\n ///\n@@ -279,7 +279,7 @@ fn ensure_drop_predicates_are_implied_by_item_defn<'tcx>(\n /// instead Drop-Check now simply assumes that if a destructor has\n /// access (direct or indirect) to a lifetime parameter, then that\n /// lifetime must be forced to outlive that destructor's dynamic\n-/// extent. We then provide the `unsafe_destructor_blind_to_params`\n+/// extent. We then provide the `may_dangle`\n /// attribute as a way for destructor implementations to opt-out of\n /// this conservative assumption (and thus assume the obligation of\n /// ensuring that they do not access data nor invoke methods of"}, {"sha": "3cd520fd4b50b1273c76f71225eb9a2951624b39", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=d70ea7ce48b18820c99c4712ed6afec42d637f9f", "patch": "@@ -3809,7 +3809,6 @@ const ATTRIBUTE_WHITELIST: &'static [Symbol] = &[\n     sym::must_use,\n     sym::no_mangle,\n     sym::repr,\n-    sym::unsafe_destructor_blind_to_params,\n     sym::non_exhaustive\n ];\n "}, {"sha": "e3628d908fb1e82177f48273a43a0804b51108fd", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 2, "deletions": 12, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=d70ea7ce48b18820c99c4712ed6afec42d637f9f", "patch": "@@ -199,9 +199,6 @@ declare_features! (\n \n     // no-tracking-issue-end\n \n-    // Allows using `#[unsafe_destructor_blind_to_params]` (RFC 1238).\n-    (active, dropck_parametricity, \"1.3.0\", Some(28498), None),\n-\n     // no-tracking-issue-start\n \n     // Allows using `#[omit_gdb_pretty_printer_section]`.\n@@ -641,6 +638,8 @@ declare_features! (\n     (removed, extern_in_paths, \"1.33.0\", Some(55600), None,\n      Some(\"subsumed by `::foo::bar` paths\")),\n     (removed, quote, \"1.33.0\", Some(29601), None, None),\n+    // Allows using `#[unsafe_destructor_blind_to_params]` (RFC 1238).\n+    (removed, dropck_parametricity, \"1.38.0\", Some(28498), None, None),\n \n     // -------------------------------------------------------------------------\n     // feature-group-end: removed features\n@@ -1447,15 +1446,6 @@ pub const BUILTIN_ATTRIBUTES: &[BuiltinAttribute] = &[\n             cfg_fn!(omit_gdb_pretty_printer_section)\n         )\n     ),\n-    (sym::unsafe_destructor_blind_to_params,\n-    Normal,\n-    template!(Word),\n-    Gated(Stability::Deprecated(\"https://github.com/rust-lang/rust/issues/34761\",\n-                                Some(\"replace this attribute with `#[may_dangle]`\")),\n-        sym::dropck_parametricity,\n-        \"unsafe_destructor_blind_to_params has been replaced by \\\n-            may_dangle and will be removed in the future\",\n-        cfg_fn!(dropck_parametricity))),\n     (sym::may_dangle,\n     Normal,\n     template!(Word),"}, {"sha": "a983180ac01e16ee2c902a9ed2538e0edd6c0bf5", "filename": "src/libsyntax_pos/symbol.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Flibsyntax_pos%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Flibsyntax_pos%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_pos%2Fsymbol.rs?ref=d70ea7ce48b18820c99c4712ed6afec42d637f9f", "patch": "@@ -695,7 +695,6 @@ symbols! {\n         unmarked_api,\n         unreachable_code,\n         unrestricted_attribute_tokens,\n-        unsafe_destructor_blind_to_params,\n         unsafe_no_drop_flag,\n         unsized_locals,\n         unsized_tuple_coercion,"}, {"sha": "555eefeb3a1f8722720151ae3eaf55f6fc498fae", "filename": "src/test/run-pass/issues/issue-24805-dropck-itemless.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Frun-pass%2Fissues%2Fissue-24805-dropck-itemless.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Frun-pass%2Fissues%2Fissue-24805-dropck-itemless.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissues%2Fissue-24805-dropck-itemless.rs?ref=d70ea7ce48b18820c99c4712ed6afec42d637f9f", "patch": "@@ -1,12 +1,11 @@\n // run-pass\n-#![allow(deprecated)]\n \n // Check that item-less traits do not cause dropck to inject extra\n // region constraints.\n \n #![allow(non_camel_case_types)]\n \n-#![feature(dropck_parametricity)]\n+#![feature(dropck_eyepatch)]\n \n trait UserDefined { }\n \n@@ -20,9 +19,8 @@ impl<'a, T> UserDefined for &'a T { }\n //   ```\n macro_rules! impl_drop {\n     ($Bound:ident, $Id:ident) => {\n-        struct $Id<T:$Bound>(T);\n-        impl <T:$Bound> Drop for $Id<T> {\n-            #[unsafe_destructor_blind_to_params]\n+        struct $Id<T: $Bound>(T);\n+        unsafe impl <#[may_dangle] T: $Bound> Drop for $Id<T> {\n             fn drop(&mut self) { }\n         }\n     }"}, {"sha": "90cf2cddcf02a940f9a40d8b8aaa1c5ee33dd7e1", "filename": "src/test/run-pass/issues/issue-28498-ugeh-ex1.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Frun-pass%2Fissues%2Fissue-28498-ugeh-ex1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Frun-pass%2Fissues%2Fissue-28498-ugeh-ex1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissues%2Fissue-28498-ugeh-ex1.rs?ref=d70ea7ce48b18820c99c4712ed6afec42d637f9f", "patch": "@@ -1,21 +1,19 @@\n // run-pass\n-#![allow(deprecated)] // FIXME: switch to `#[may_dangle]` below.\n \n // Example taken from RFC 1238 text\n \n // https://github.com/rust-lang/rfcs/blob/master/text/1238-nonparametric-dropck.md\n //     #example-of-the-unguarded-escape-hatch\n \n-#![feature(dropck_parametricity)]\n+#![feature(dropck_eyepatch)]\n use std::cell::Cell;\n \n struct Concrete<'a>(u32, Cell<Option<&'a Concrete<'a>>>);\n \n struct Foo<T> { data: Vec<T> }\n \n-impl<T> Drop for Foo<T> {\n-    // Below is the UGEH attribute\n-    #[unsafe_destructor_blind_to_params]\n+// Below is the UGEH attribute\n+unsafe impl<#[may_dangle] T> Drop for Foo<T> {\n     fn drop(&mut self) { }\n }\n "}, {"sha": "aea9fde5309e24350b8a486f6283e3367ca6d8f8", "filename": "src/test/run-pass/issues/issue-28498-ugeh-with-lifetime-param.rs", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Frun-pass%2Fissues%2Fissue-28498-ugeh-with-lifetime-param.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Frun-pass%2Fissues%2Fissue-28498-ugeh-with-lifetime-param.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissues%2Fissue-28498-ugeh-with-lifetime-param.rs?ref=d70ea7ce48b18820c99c4712ed6afec42d637f9f", "patch": "@@ -1,12 +1,11 @@\n // run-pass\n-#![allow(deprecated)] // FIXME: switch to `#[may_dangle]` below.\n \n // Demonstrate the use of the unguarded escape hatch with a lifetime param\n // to assert that destructor will not access any dead data.\n //\n // Compare with compile-fail/issue28498-reject-lifetime-param.rs\n \n-#![feature(dropck_parametricity)]\n+#![feature(dropck_eyepatch)]\n \n #[derive(Debug)]\n struct ScribbleOnDrop(String);\n@@ -19,11 +18,9 @@ impl Drop for ScribbleOnDrop {\n \n struct Foo<'a>(u32, &'a ScribbleOnDrop);\n \n-impl<'a> Drop for Foo<'a> {\n-    #[unsafe_destructor_blind_to_params]\n+unsafe impl<#[may_dangle] 'a> Drop for Foo<'a> {\n     fn drop(&mut self) {\n-        // Use of `unsafe_destructor_blind_to_params` is sound,\n-        // because destructor never accesses `self.1`.\n+        // Use of `may_dangle` is sound, because destructor never accesses `self.1`.\n         println!(\"Dropping Foo({}, _)\", self.0);\n     }\n }"}, {"sha": "91ef5a7c98d6dbc7ed93ff1036453772c119b7dc", "filename": "src/test/run-pass/issues/issue-28498-ugeh-with-passed-to-fn.rs", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Frun-pass%2Fissues%2Fissue-28498-ugeh-with-passed-to-fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Frun-pass%2Fissues%2Fissue-28498-ugeh-with-passed-to-fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissues%2Fissue-28498-ugeh-with-passed-to-fn.rs?ref=d70ea7ce48b18820c99c4712ed6afec42d637f9f", "patch": "@@ -1,5 +1,4 @@\n // run-pass\n-#![allow(deprecated)] // FIXME: switch to `#[may_dangle]` below.\n \n // Demonstrate the use of the unguarded escape hatch with a type param in negative position\n // to assert that destructor will not access any dead data.\n@@ -11,7 +10,7 @@\n //\n // Compare with run-pass/issue28498-ugeh-with-passed-to-fn.rs\n \n-#![feature(dropck_parametricity)]\n+#![feature(dropck_eyepatch)]\n \n #[derive(Debug)]\n struct ScribbleOnDrop(String);\n@@ -24,12 +23,10 @@ impl Drop for ScribbleOnDrop {\n \n struct Foo<T>(u32, T, Box<for <'r> fn(&'r T) -> String>);\n \n-impl<T> Drop for Foo<T> {\n-    #[unsafe_destructor_blind_to_params]\n+unsafe impl<#[may_dangle] T> Drop for Foo<T> {\n     fn drop(&mut self) {\n-        // Use of `unsafe_destructor_blind_to_params` is sound,\n-        // because destructor never passes a `self.1` to the callback\n-        // (in `self.2`) despite having it available.\n+        // Use of `may_dangle` is sound, because destructor never passes a `self.1`\n+        // to the callback (in `self.2`) despite having it available.\n         println!(\"Dropping Foo({}, _)\", self.0);\n     }\n }"}, {"sha": "808f3b6e81e52582e32ef15d7a94e43445100768", "filename": "src/test/run-pass/issues/issue-28498-ugeh-with-trait-bound.rs", "status": "modified", "additions": 5, "deletions": 8, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Frun-pass%2Fissues%2Fissue-28498-ugeh-with-trait-bound.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Frun-pass%2Fissues%2Fissue-28498-ugeh-with-trait-bound.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissues%2Fissue-28498-ugeh-with-trait-bound.rs?ref=d70ea7ce48b18820c99c4712ed6afec42d637f9f", "patch": "@@ -1,12 +1,11 @@\n // run-pass\n-#![allow(deprecated)] // FIXME: switch to `#[may_dangle]` below.\n \n // Demonstrate the use of the unguarded escape hatch with a trait bound\n // to assert that destructor will not access any dead data.\n //\n // Compare with compile-fail/issue28498-reject-trait-bound.rs\n \n-#![feature(dropck_parametricity)]\n+#![feature(dropck_eyepatch)]\n \n use std::fmt;\n \n@@ -19,14 +18,12 @@ impl Drop for ScribbleOnDrop {\n     }\n }\n \n-struct Foo<T:fmt::Debug>(u32, T);\n+struct Foo<T: fmt::Debug>(u32, T);\n \n-impl<T:fmt::Debug> Drop for Foo<T> {\n-    #[unsafe_destructor_blind_to_params]\n+unsafe impl<#[may_dangle] T: fmt::Debug> Drop for Foo<T> {\n     fn drop(&mut self) {\n-        // Use of `unsafe_destructor_blind_to_params` is sound,\n-        // because destructor never accesses the `Debug::fmt` method\n-        // of `T`, despite having it available.\n+        // Use of `may_dangle` is sound, because destructor never accesses\n+        // the `Debug::fmt` method of `T`, despite having it available.\n         println!(\"Dropping Foo({}, _)\", self.0);\n     }\n }"}, {"sha": "33252019e71e63038a167fb0ae01b718c247b1e7", "filename": "src/test/ui/feature-gates/feature-gate-dropck-ugeh-2.rs", "status": "removed", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/e706438d00f8a2de82a3fabd6777c9486e450198/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-dropck-ugeh-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e706438d00f8a2de82a3fabd6777c9486e450198/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-dropck-ugeh-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-dropck-ugeh-2.rs?ref=e706438d00f8a2de82a3fabd6777c9486e450198", "patch": "@@ -1,12 +0,0 @@\n-#![deny(deprecated)]\n-#![feature(dropck_parametricity)]\n-\n-struct Foo;\n-\n-impl Drop for Foo {\n-    #[unsafe_destructor_blind_to_params]\n-    //~^ ERROR use of deprecated attribute `dropck_parametricity`\n-    fn drop(&mut self) {}\n-}\n-\n-fn main() {}"}, {"sha": "b6a474575c677a5ec9057501e61756e9404d3c4f", "filename": "src/test/ui/feature-gates/feature-gate-dropck-ugeh-2.stderr", "status": "removed", "additions": 0, "deletions": 14, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/e706438d00f8a2de82a3fabd6777c9486e450198/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-dropck-ugeh-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e706438d00f8a2de82a3fabd6777c9486e450198/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-dropck-ugeh-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-dropck-ugeh-2.stderr?ref=e706438d00f8a2de82a3fabd6777c9486e450198", "patch": "@@ -1,14 +0,0 @@\n-error: use of deprecated attribute `dropck_parametricity`: unsafe_destructor_blind_to_params has been replaced by may_dangle and will be removed in the future. See https://github.com/rust-lang/rust/issues/34761\n-  --> $DIR/feature-gate-dropck-ugeh-2.rs:7:5\n-   |\n-LL |     #[unsafe_destructor_blind_to_params]\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: replace this attribute with `#[may_dangle]`\n-   |\n-note: lint level defined here\n-  --> $DIR/feature-gate-dropck-ugeh-2.rs:1:9\n-   |\n-LL | #![deny(deprecated)]\n-   |         ^^^^^^^^^^\n-\n-error: aborting due to previous error\n-"}, {"sha": "a2377cda9bd66d4170ee21f89ade50c1a941b351", "filename": "src/test/ui/feature-gates/feature-gate-dropck-ugeh.rs", "status": "removed", "additions": 0, "deletions": 29, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/e706438d00f8a2de82a3fabd6777c9486e450198/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-dropck-ugeh.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e706438d00f8a2de82a3fabd6777c9486e450198/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-dropck-ugeh.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-dropck-ugeh.rs?ref=e706438d00f8a2de82a3fabd6777c9486e450198", "patch": "@@ -1,29 +0,0 @@\n-// gate-test-dropck_parametricity\n-\n-// Ensure that attempts to use the unsafe attribute are feature-gated.\n-// Example adapted from RFC 1238 text (just left out the feature gate).\n-\n-// https://github.com/rust-lang/rfcs/blob/master/text/1238-nonparametric-dropck.md\n-//     #example-of-the-unguarded-escape-hatch\n-\n-use std::cell::Cell;\n-\n-struct Concrete<'a>(u32, Cell<Option<&'a Concrete<'a>>>);\n-\n-struct Foo<T> { data: Vec<T> }\n-\n-impl<T> Drop for Foo<T> {\n-    #[unsafe_destructor_blind_to_params] // This is the UGEH attribute\n-    //~^ ERROR unsafe_destructor_blind_to_params has been replaced\n-    //~| WARN use of deprecated attribute `dropck_parametricity`\n-    fn drop(&mut self) { }\n-}\n-\n-fn main() {\n-    let mut foo = Foo {  data: Vec::new() };\n-    foo.data.push(Concrete(0, Cell::new(None)));\n-    foo.data.push(Concrete(0, Cell::new(None)));\n-\n-    foo.data[0].1.set(Some(&foo.data[1]));\n-    foo.data[1].1.set(Some(&foo.data[0]));\n-}"}, {"sha": "581b760ba4f47f30f5ab937be7122de0d04e6fcb", "filename": "src/test/ui/feature-gates/feature-gate-dropck-ugeh.stderr", "status": "removed", "additions": 0, "deletions": 20, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/e706438d00f8a2de82a3fabd6777c9486e450198/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-dropck-ugeh.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/e706438d00f8a2de82a3fabd6777c9486e450198/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-dropck-ugeh.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-dropck-ugeh.stderr?ref=e706438d00f8a2de82a3fabd6777c9486e450198", "patch": "@@ -1,20 +0,0 @@\n-error[E0658]: unsafe_destructor_blind_to_params has been replaced by may_dangle and will be removed in the future\n-  --> $DIR/feature-gate-dropck-ugeh.rs:16:5\n-   |\n-LL |     #[unsafe_destructor_blind_to_params] // This is the UGEH attribute\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   |\n-   = note: for more information, see https://github.com/rust-lang/rust/issues/28498\n-   = help: add `#![feature(dropck_parametricity)]` to the crate attributes to enable\n-\n-warning: use of deprecated attribute `dropck_parametricity`: unsafe_destructor_blind_to_params has been replaced by may_dangle and will be removed in the future. See https://github.com/rust-lang/rust/issues/34761\n-  --> $DIR/feature-gate-dropck-ugeh.rs:16:5\n-   |\n-LL |     #[unsafe_destructor_blind_to_params] // This is the UGEH attribute\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: replace this attribute with `#[may_dangle]`\n-   |\n-   = note: #[warn(deprecated)] on by default\n-\n-error: aborting due to previous error\n-\n-For more information about this error, try `rustc --explain E0658`."}, {"sha": "1e7190157856cdfca65a9590e91ac9f2c6761255", "filename": "src/test/ui/span/issue28498-reject-lifetime-param.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-lifetime-param.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-lifetime-param.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-lifetime-param.rs?ref=d70ea7ce48b18820c99c4712ed6afec42d637f9f", "patch": "@@ -16,9 +16,8 @@ struct Foo<'a>(u32, &'a ScribbleOnDrop);\n \n impl<'a> Drop for Foo<'a> {\n     fn drop(&mut self) {\n-        // Use of `unsafe_destructor_blind_to_params` is unsound,\n-        // because destructor accesses borrowed data in `self.1`\n-        // and we must force that to strictly outlive `self`.\n+        // Use of `may_dangle` is unsound, because destructor accesses borrowed data\n+        // in `self.1` and we must force that to strictly outlive `self`.\n         println!(\"Dropping Foo({}, {:?})\", self.0, self.1);\n     }\n }"}, {"sha": "3119ddd03cc26654a20e1d31d9ce559e26aeb7f3", "filename": "src/test/ui/span/issue28498-reject-lifetime-param.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-lifetime-param.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-lifetime-param.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-lifetime-param.stderr?ref=d70ea7ce48b18820c99c4712ed6afec42d637f9f", "patch": "@@ -1,5 +1,5 @@\n error[E0597]: `first_dropped` does not live long enough\n-  --> $DIR/issue28498-reject-lifetime-param.rs:33:19\n+  --> $DIR/issue28498-reject-lifetime-param.rs:32:19\n    |\n LL |     foo1 = Foo(1, &first_dropped);\n    |                   ^^^^^^^^^^^^^^ borrowed value does not live long enough"}, {"sha": "dcd2e9ad4ba980d44d06610d1bb732c327a1d833", "filename": "src/test/ui/span/issue28498-reject-passed-to-fn.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-passed-to-fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-passed-to-fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-passed-to-fn.rs?ref=d70ea7ce48b18820c99c4712ed6afec42d637f9f", "patch": "@@ -16,8 +16,7 @@ struct Foo<T>(u32, T, Box<for <'r> fn(&'r T) -> String>);\n \n impl<T> Drop for Foo<T> {\n     fn drop(&mut self) {\n-        // Use of `unsafe_destructor_blind_to_params` is unsound,\n-        // because we pass `T` to the callback in `self.2`\n+        // Use of `may_dangle` is unsound, because we pass `T` to the callback in `self.2`\n         // below, and thus potentially read from borrowed data.\n         println!(\"Dropping Foo({}, {})\", self.0, (self.2)(&self.1));\n     }"}, {"sha": "60e8a648cd5979d37f780f315fd13fb6b199cb90", "filename": "src/test/ui/span/issue28498-reject-passed-to-fn.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-passed-to-fn.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-passed-to-fn.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-passed-to-fn.stderr?ref=d70ea7ce48b18820c99c4712ed6afec42d637f9f", "patch": "@@ -1,5 +1,5 @@\n error[E0597]: `first_dropped` does not live long enough\n-  --> $DIR/issue28498-reject-passed-to-fn.rs:35:19\n+  --> $DIR/issue28498-reject-passed-to-fn.rs:34:19\n    |\n LL |     foo1 = Foo(1, &first_dropped, Box::new(callback));\n    |                   ^^^^^^^^^^^^^^ borrowed value does not live long enough"}, {"sha": "444cebb19a73d55a29e21ada15478714aab8911a", "filename": "src/test/ui/span/issue28498-reject-trait-bound.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-trait-bound.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-trait-bound.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-trait-bound.rs?ref=d70ea7ce48b18820c99c4712ed6afec42d637f9f", "patch": "@@ -14,13 +14,12 @@ impl Drop for ScribbleOnDrop {\n     }\n }\n \n-struct Foo<T:fmt::Debug>(u32, T);\n+struct Foo<T: fmt::Debug>(u32, T);\n \n-impl<T:fmt::Debug> Drop for Foo<T> {\n+impl<T: fmt::Debug> Drop for Foo<T> {\n     fn drop(&mut self) {\n-        // Use of `unsafe_destructor_blind_to_params` is unsound,\n-        // because we access `T` fmt method when we pass `self.1`\n-        // below, and thus potentially read from borrowed data.\n+        // Use of `may_dangle` is unsound, because we access `T` fmt method when we pass\n+        // `self.1` below, and thus potentially read from borrowed data.\n         println!(\"Dropping Foo({}, {:?})\", self.0, self.1);\n     }\n }"}, {"sha": "22e4a8205b617723a856dd8f7e904ce7c962c368", "filename": "src/test/ui/span/issue28498-reject-trait-bound.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-trait-bound.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d70ea7ce48b18820c99c4712ed6afec42d637f9f/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-trait-bound.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fissue28498-reject-trait-bound.stderr?ref=d70ea7ce48b18820c99c4712ed6afec42d637f9f", "patch": "@@ -1,5 +1,5 @@\n error[E0597]: `first_dropped` does not live long enough\n-  --> $DIR/issue28498-reject-trait-bound.rs:35:19\n+  --> $DIR/issue28498-reject-trait-bound.rs:34:19\n    |\n LL |     foo1 = Foo(1, &first_dropped);\n    |                   ^^^^^^^^^^^^^^ borrowed value does not live long enough"}]}