{"sha": "f995b67a4cbc32fd256dc5f26b76ab1944aa5880", "node_id": "C_kwDOAAsO6NoAKGY5OTViNjdhNGNiYzMyZmQyNTZkYzVmMjZiNzZhYjE5NDRhYTU4ODA", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-05-07T20:44:38Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-05-07T20:44:38Z"}, "message": "Rollup merge of #96667 - oli-obk:collect_hidden_types, r=Mark-Simulacrum\n\nAdd regression test\n\nfixes #69785\n\nThis issue seems to have been fixed in the meantime.", "tree": {"sha": "d2efb1e7d11fa63a7c9db3d446f4ea9333bbff3d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d2efb1e7d11fa63a7c9db3d446f4ea9333bbff3d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f995b67a4cbc32fd256dc5f26b76ab1944aa5880", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJidto2CRBK7hj4Ov3rIwAAL3sIACFHW4TSMvI+i+U8+xxZ8lZ6\nwTC7Ke7GCvlTCgU8CmLYGR6d0vQdWL5Mn8/cOpfZLImO9mZMOPi/iwbYd5wYU7T9\nyuSic16sJGgWLOv87m0NA+vSt5Yr5acxZVC7295aqgJSDCSmxW4Xa14MR3oQMjQ3\nIlG6ggPmSc/1bxTruXHt4phpWTJiMoYL5v2fkD3Cy6sWnFZoxuN6uIwkfdpfZwm5\nunckGMUWqby5hg117JqioibAHgZ9ovC6ASR6ofpnE1TleQLMuZG07BLJ8TH/hDdy\nIdWQVdXInErsrLBBH96bCPEABLUbrO7Md8HzRaAsZBO5wtu+aA7LJ9sTSSsov9Y=\n=i/c/\n-----END PGP SIGNATURE-----\n", "payload": "tree d2efb1e7d11fa63a7c9db3d446f4ea9333bbff3d\nparent eecc0469f5c6866fb89868e7bb2348ff81157422\nparent 52de679c193c249d771d84fdaa1cce0bf70404a4\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1651956278 +0200\ncommitter GitHub <noreply@github.com> 1651956278 +0200\n\nRollup merge of #96667 - oli-obk:collect_hidden_types, r=Mark-Simulacrum\n\nAdd regression test\n\nfixes #69785\n\nThis issue seems to have been fixed in the meantime.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f995b67a4cbc32fd256dc5f26b76ab1944aa5880", "html_url": "https://github.com/rust-lang/rust/commit/f995b67a4cbc32fd256dc5f26b76ab1944aa5880", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f995b67a4cbc32fd256dc5f26b76ab1944aa5880/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eecc0469f5c6866fb89868e7bb2348ff81157422", "url": "https://api.github.com/repos/rust-lang/rust/commits/eecc0469f5c6866fb89868e7bb2348ff81157422", "html_url": "https://github.com/rust-lang/rust/commit/eecc0469f5c6866fb89868e7bb2348ff81157422"}, {"sha": "52de679c193c249d771d84fdaa1cce0bf70404a4", "url": "https://api.github.com/repos/rust-lang/rust/commits/52de679c193c249d771d84fdaa1cce0bf70404a4", "html_url": "https://github.com/rust-lang/rust/commit/52de679c193c249d771d84fdaa1cce0bf70404a4"}], "stats": {"total": 43, "additions": 43, "deletions": 0}, "files": [{"sha": "75d20a6fef9fe4a9aebe801674e3591dfe982bf5", "filename": "src/test/ui/type-alias-impl-trait/auxiliary/collect_hidden_types.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/f995b67a4cbc32fd256dc5f26b76ab1944aa5880/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fauxiliary%2Fcollect_hidden_types.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f995b67a4cbc32fd256dc5f26b76ab1944aa5880/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fauxiliary%2Fcollect_hidden_types.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fauxiliary%2Fcollect_hidden_types.rs?ref=f995b67a4cbc32fd256dc5f26b76ab1944aa5880", "patch": "@@ -0,0 +1,21 @@\n+#![feature(type_alias_impl_trait)]\n+\n+// edition:2018\n+\n+use std::future::Future;\n+\n+pub trait Service<Request> {\n+    type Future: Future<Output = ()>;\n+    fn call(&mut self, req: Request) -> Self::Future;\n+}\n+\n+// NOTE: the pub(crate) here is critical\n+pub(crate) fn new() -> () {}\n+\n+pub struct A;\n+impl Service<()> for A {\n+    type Future = impl Future<Output = ()>;\n+    fn call(&mut self, _: ()) -> Self::Future {\n+        async { new() }\n+    }\n+}"}, {"sha": "e78f178e464ebe36e8988f3e4dc3bc24b4597d98", "filename": "src/test/ui/type-alias-impl-trait/collect_hidden_types.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/f995b67a4cbc32fd256dc5f26b76ab1944aa5880/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fcollect_hidden_types.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f995b67a4cbc32fd256dc5f26b76ab1944aa5880/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fcollect_hidden_types.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fcollect_hidden_types.rs?ref=f995b67a4cbc32fd256dc5f26b76ab1944aa5880", "patch": "@@ -0,0 +1,22 @@\n+// aux-build:collect_hidden_types.rs\n+use collect_hidden_types::Service;\n+use std::future::Future;\n+use std::pin::Pin;\n+use std::task::Context;\n+\n+// build-pass\n+\n+// edition:2018\n+\n+extern crate collect_hidden_types;\n+\n+fn broken(mut a: collect_hidden_types::A, cx: &mut Context<'_>) {\n+    let mut fut = a.call(());\n+    let _ = unsafe { Pin::new_unchecked(&mut fut) }.poll(cx);\n+}\n+\n+pub async fn meeb(cx: &mut Context<'_>) {\n+    broken(collect_hidden_types::A, cx);\n+}\n+\n+fn main() {}"}]}