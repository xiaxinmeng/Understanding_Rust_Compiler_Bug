{"sha": "b57115563191051f9664b993f7421578c251b092", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI1NzExNTU2MzE5MTA1MWY5NjY0Yjk5M2Y3NDIxNTc4YzI1MWIwOTI=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-02-25T07:54:45Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-02-25T07:54:45Z"}, "message": "Rollup merge of #48297 - glaubitz:sparc-linux, r=estebank\n\nAdd missing pieces for sparc-linux-gnu support\n\nI noticed that while Rust has CABI support for 32-bit SPARC, there are still some pieces missing to be able to use Rust on a 32-Bit SPARC system like Gentoo which still defaults to a 32-bit port unlike Debian's sparc64 port.\n\nThis PR is an attempt to add the missing pieces. I will send the necessary changes for libc in a separate PR.\n\nCC @jrtc27", "tree": {"sha": "211cf733e1419cbb54bdc7a124617a4d384f8bdf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/211cf733e1419cbb54bdc7a124617a4d384f8bdf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b57115563191051f9664b993f7421578c251b092", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJakmvFCRBK7hj4Ov3rIwAAdHIIAIACJcE99qIoeWuxSY97bnD7\nA4v0SW65Vsmqb7hopPaOq617VhmycAfd2SKdat/6OCmL07P6i6b+JAahVFiAsC3t\nMaf9kabVqIKOk/+H04XWFAHOwvH05rjApS9kD6IYi8FcH6ptA6uEoryEQ+Ka0Zr8\nYD9UEaS5TXZiYLCbFmKAJNhWeaWy0hFXaD6bFu/WfxvQzye9wPNrOwkZM1H0nuYd\ndUFJvaRS6Ofb5Wzq4SOIR5wSNOrTXE6G4QFkS0w+cz4q945uB9Jvte2himVjWfhT\nj/0Cn2uLLd9HYQcx9qCKm/UxxNPru9Ljk/OcIARSzhK7R4W0BASN2UFJJqwsmH0=\n=m7Ll\n-----END PGP SIGNATURE-----\n", "payload": "tree 211cf733e1419cbb54bdc7a124617a4d384f8bdf\nparent 3e2072e51d3c849421b9757c3066e0d93ab3ac22\nparent 84aae4ed12fcafb48216cd7b3f6ea448902f8c58\nauthor kennytm <kennytm@gmail.com> 1519545285 +0800\ncommitter GitHub <noreply@github.com> 1519545285 +0800\n\nRollup merge of #48297 - glaubitz:sparc-linux, r=estebank\n\nAdd missing pieces for sparc-linux-gnu support\n\nI noticed that while Rust has CABI support for 32-bit SPARC, there are still some pieces missing to be able to use Rust on a 32-Bit SPARC system like Gentoo which still defaults to a 32-bit port unlike Debian's sparc64 port.\n\nThis PR is an attempt to add the missing pieces. I will send the necessary changes for libc in a separate PR.\n\nCC @jrtc27\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b57115563191051f9664b993f7421578c251b092", "html_url": "https://github.com/rust-lang/rust/commit/b57115563191051f9664b993f7421578c251b092", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b57115563191051f9664b993f7421578c251b092/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3e2072e51d3c849421b9757c3066e0d93ab3ac22", "url": "https://api.github.com/repos/rust-lang/rust/commits/3e2072e51d3c849421b9757c3066e0d93ab3ac22", "html_url": "https://github.com/rust-lang/rust/commit/3e2072e51d3c849421b9757c3066e0d93ab3ac22"}, {"sha": "84aae4ed12fcafb48216cd7b3f6ea448902f8c58", "url": "https://api.github.com/repos/rust-lang/rust/commits/84aae4ed12fcafb48216cd7b3f6ea448902f8c58", "html_url": "https://github.com/rust-lang/rust/commit/84aae4ed12fcafb48216cd7b3f6ea448902f8c58"}], "stats": {"total": 39, "additions": 38, "deletions": 1}, "files": [{"sha": "5966bb65df9c87ebef767ac64d453f185b9ccd98", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b57115563191051f9664b993f7421578c251b092/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/b57115563191051f9664b993f7421578c251b092/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=b57115563191051f9664b993f7421578c251b092", "patch": "@@ -294,7 +294,7 @@ def default_build_triple():\n             raise ValueError('unknown byteorder: {}'.format(sys.byteorder))\n         # only the n64 ABI is supported, indicate it\n         ostype += 'abi64'\n-    elif cputype == 'sparcv9' or cputype == 'sparc64':\n+    elif cputype == 'sparc' or cputype == 'sparcv9' or cputype == 'sparc64':\n         pass\n     else:\n         err = \"unknown cpu type: {}\".format(cputype)"}, {"sha": "a4c6f397f816f5694fc946ddf2809fd40f686eb1", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b57115563191051f9664b993f7421578c251b092/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b57115563191051f9664b993f7421578c251b092/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=b57115563191051f9664b993f7421578c251b092", "patch": "@@ -484,6 +484,7 @@ impl Step for Openssl {\n             \"powerpc64-unknown-linux-gnu\" => \"linux-ppc64\",\n             \"powerpc64le-unknown-linux-gnu\" => \"linux-ppc64le\",\n             \"s390x-unknown-linux-gnu\" => \"linux64-s390x\",\n+            \"sparc-unknown-linux-gnu\" => \"linux-sparcv9\",\n             \"sparc64-unknown-linux-gnu\" => \"linux64-sparcv9\",\n             \"sparc64-unknown-netbsd\" => \"BSD-sparc64\",\n             \"x86_64-apple-darwin\" => \"darwin64-x86_64-cc\","}, {"sha": "d356105e39314c6aa7d268e67b52a9d9c14ac7e2", "filename": "src/librustc_back/target/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b57115563191051f9664b993f7421578c251b092/src%2Flibrustc_back%2Ftarget%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b57115563191051f9664b993f7421578c251b092/src%2Flibrustc_back%2Ftarget%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Ftarget%2Fmod.rs?ref=b57115563191051f9664b993f7421578c251b092", "patch": "@@ -146,6 +146,7 @@ supported_targets! {\n     (\"powerpc64-unknown-linux-gnu\", powerpc64_unknown_linux_gnu),\n     (\"powerpc64le-unknown-linux-gnu\", powerpc64le_unknown_linux_gnu),\n     (\"s390x-unknown-linux-gnu\", s390x_unknown_linux_gnu),\n+    (\"sparc-unknown-linux-gnu\", sparc_unknown_linux_gnu),\n     (\"sparc64-unknown-linux-gnu\", sparc64_unknown_linux_gnu),\n     (\"arm-unknown-linux-gnueabi\", arm_unknown_linux_gnueabi),\n     (\"arm-unknown-linux-gnueabihf\", arm_unknown_linux_gnueabihf),"}, {"sha": "a03e6937b2ca751d38dd513534941eb42ec76261", "filename": "src/librustc_back/target/sparc_unknown_linux_gnu.rs", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/b57115563191051f9664b993f7421578c251b092/src%2Flibrustc_back%2Ftarget%2Fsparc_unknown_linux_gnu.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b57115563191051f9664b993f7421578c251b092/src%2Flibrustc_back%2Ftarget%2Fsparc_unknown_linux_gnu.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_back%2Ftarget%2Fsparc_unknown_linux_gnu.rs?ref=b57115563191051f9664b993f7421578c251b092", "patch": "@@ -0,0 +1,34 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+use LinkerFlavor;\n+use target::{Target, TargetResult};\n+\n+pub fn target() -> TargetResult {\n+    let mut base = super::linux_base::opts();\n+    base.cpu = \"v9\".to_string();\n+    base.max_atomic_width = Some(64);\n+    base.pre_link_args.get_mut(&LinkerFlavor::Gcc).unwrap().push(\"-mv8plus\".to_string());\n+    base.exe_allocation_crate = None;\n+\n+    Ok(Target {\n+        llvm_target: \"sparc-unknown-linux-gnu\".to_string(),\n+        target_endian: \"big\".to_string(),\n+        target_pointer_width: \"32\".to_string(),\n+        target_c_int_width: \"32\".to_string(),\n+        data_layout: \"E-m:e-p:32:32-i64:64-f128:64-n32-S64\".to_string(),\n+        arch: \"sparc\".to_string(),\n+        target_os: \"linux\".to_string(),\n+        target_env: \"gnu\".to_string(),\n+        target_vendor: \"unknown\".to_string(),\n+        linker_flavor: LinkerFlavor::Gcc,\n+        options: base,\n+    })\n+}"}, {"sha": "0845179532224f68f7ee66160a6768620c59ea4c", "filename": "src/tools/build-manifest/src/main.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b57115563191051f9664b993f7421578c251b092/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b57115563191051f9664b993f7421578c251b092/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs?ref=b57115563191051f9664b993f7421578c251b092", "patch": "@@ -86,6 +86,7 @@ static TARGETS: &'static [&'static str] = &[\n     \"powerpc64-unknown-linux-gnu\",\n     \"powerpc64le-unknown-linux-gnu\",\n     \"s390x-unknown-linux-gnu\",\n+    \"sparc-unknown-linux-gnu\",\n     \"sparc64-unknown-linux-gnu\",\n     \"sparcv9-sun-solaris\",\n     \"wasm32-unknown-emscripten\","}]}