{"sha": "c70b35efd8ed4d2e85a468c6519300c16609cdab", "node_id": "C_kwDOAAsO6NoAKGM3MGIzNWVmZDhlZDRkMmU4NWE0NjhjNjUxOTMwMGMxNjYwOWNkYWI", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-10-03T00:41:49Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-10-03T00:41:49Z"}, "message": "Auto merge of #84267 - dtolnay:ptrunit, r=nagisa\n\nMake *const (), *mut () okay for FFI\n\nPointer-to-() is used occasionally in the standard library to mean \"pointer to none-of-your-business\". Examples:\n\n- `RawWakerVTable::new` https://doc.rust-lang.org/1.51.0/std/task/struct.RawWakerVTable.html#method.new\n- `<*const T>::to_raw_parts` https://doc.rust-lang.org/nightly/std/primitive.pointer.html#method.to_raw_parts\n\nI believe it's useful for the same purpose in FFI signatures, even while `()` itself is not FFI safe. The following should be allowed:\n\n```rust\nextern \"C\" {\n    fn demo(pc: *const (), pm: *mut ());\n}\n```\n\nPrior to this PR, those pointers were not considered okay for an extern signature.\n\n```console\nwarning: `extern` block uses type `()`, which is not FFI-safe\n --> src/main.rs:2:17\n  |\n2 |     fn demo(pc: *const (), pm: *mut ());\n  |                 ^^^^^^^^^ not FFI-safe\n  |\n  = note: `#[warn(improper_ctypes)]` on by default\n  = help: consider using a struct instead\n  = note: tuples have unspecified layout\n\nwarning: `extern` block uses type `()`, which is not FFI-safe\n --> src/main.rs:2:32\n  |\n2 |     fn demo(pc: *const (), pm: *mut ());\n  |                                ^^^^^^^ not FFI-safe\n  |\n  = help: consider using a struct instead\n  = note: tuples have unspecified layout\n```", "tree": {"sha": "00bb25b0a64bd85ee9e66c0b9b492b311d45905d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/00bb25b0a64bd85ee9e66c0b9b492b311d45905d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c70b35efd8ed4d2e85a468c6519300c16609cdab", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c70b35efd8ed4d2e85a468c6519300c16609cdab", "html_url": "https://github.com/rust-lang/rust/commit/c70b35efd8ed4d2e85a468c6519300c16609cdab", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c70b35efd8ed4d2e85a468c6519300c16609cdab/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2801a770ce3a21a53769180d9815240ac555cbef", "url": "https://api.github.com/repos/rust-lang/rust/commits/2801a770ce3a21a53769180d9815240ac555cbef", "html_url": "https://github.com/rust-lang/rust/commit/2801a770ce3a21a53769180d9815240ac555cbef"}, {"sha": "abfad74ec6326b806509a676b6527e8d645d4fdf", "url": "https://api.github.com/repos/rust-lang/rust/commits/abfad74ec6326b806509a676b6527e8d645d4fdf", "html_url": "https://github.com/rust-lang/rust/commit/abfad74ec6326b806509a676b6527e8d645d4fdf"}], "stats": {"total": 114, "additions": 69, "deletions": 45}, "files": [{"sha": "ac4bffc239b0323d6189894b6614aad37d389121", "filename": "compiler/rustc_lint/src/types.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c70b35efd8ed4d2e85a468c6519300c16609cdab/compiler%2Frustc_lint%2Fsrc%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c70b35efd8ed4d2e85a468c6519300c16609cdab/compiler%2Frustc_lint%2Fsrc%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Ftypes.rs?ref=c70b35efd8ed4d2e85a468c6519300c16609cdab", "patch": "@@ -1056,6 +1056,15 @@ impl<'a, 'tcx> ImproperCTypesVisitor<'a, 'tcx> {\n                 FfiSafe\n             }\n \n+            ty::RawPtr(ty::TypeAndMut { ty, .. })\n+                if match ty.kind() {\n+                    ty::Tuple(tuple) => tuple.is_empty(),\n+                    _ => false,\n+                } =>\n+            {\n+                FfiSafe\n+            }\n+\n             ty::RawPtr(ty::TypeAndMut { ty, .. }) | ty::Ref(_, ty, _) => {\n                 self.check_type_for_ffi(cache, ty)\n             }"}, {"sha": "d3b36a9d59c70ecac52318dd42a54ffbda8f65e9", "filename": "src/test/ui/lint/lint-ctypes-fn.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c70b35efd8ed4d2e85a468c6519300c16609cdab/src%2Ftest%2Fui%2Flint%2Flint-ctypes-fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c70b35efd8ed4d2e85a468c6519300c16609cdab/src%2Ftest%2Fui%2Flint%2Flint-ctypes-fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-ctypes-fn.rs?ref=c70b35efd8ed4d2e85a468c6519300c16609cdab", "patch": "@@ -66,6 +66,10 @@ pub extern \"C\" fn ptr_type1(size: *const Foo) { }\n \n pub extern \"C\" fn ptr_type2(size: *const Foo) { }\n \n+pub extern \"C\" fn ptr_unit(p: *const ()) { }\n+\n+pub extern \"C\" fn ptr_tuple(p: *const ((),)) { }\n+\n pub extern \"C\" fn slice_type(p: &[u32]) { }\n //~^ ERROR: uses type `[u32]`\n "}, {"sha": "740075ca7dfff3f7da4bf52d1ecc4ff2dbbd371b", "filename": "src/test/ui/lint/lint-ctypes-fn.stderr", "status": "modified", "additions": 20, "deletions": 20, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/c70b35efd8ed4d2e85a468c6519300c16609cdab/src%2Ftest%2Fui%2Flint%2Flint-ctypes-fn.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c70b35efd8ed4d2e85a468c6519300c16609cdab/src%2Ftest%2Fui%2Flint%2Flint-ctypes-fn.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-ctypes-fn.stderr?ref=c70b35efd8ed4d2e85a468c6519300c16609cdab", "patch": "@@ -1,5 +1,5 @@\n error: `extern` fn uses type `[u32]`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:69:33\n+  --> $DIR/lint-ctypes-fn.rs:73:33\n    |\n LL | pub extern \"C\" fn slice_type(p: &[u32]) { }\n    |                                 ^^^^^^ not FFI-safe\n@@ -13,7 +13,7 @@ LL | #![deny(improper_ctypes_definitions)]\n    = note: slices have no C equivalent\n \n error: `extern` fn uses type `str`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:72:31\n+  --> $DIR/lint-ctypes-fn.rs:76:31\n    |\n LL | pub extern \"C\" fn str_type(p: &str) { }\n    |                               ^^^^ not FFI-safe\n@@ -22,31 +22,31 @@ LL | pub extern \"C\" fn str_type(p: &str) { }\n    = note: string slices have no C equivalent\n \n error: `extern` fn uses type `Box<[u8]>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:79:34\n+  --> $DIR/lint-ctypes-fn.rs:83:34\n    |\n LL | pub extern \"C\" fn boxed_slice(p: Box<[u8]>) { }\n    |                                  ^^^^^^^^^ not FFI-safe\n    |\n    = note: box cannot be represented as a single pointer\n \n error: `extern` fn uses type `Box<str>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:82:35\n+  --> $DIR/lint-ctypes-fn.rs:86:35\n    |\n LL | pub extern \"C\" fn boxed_string(p: Box<str>) { }\n    |                                   ^^^^^^^^ not FFI-safe\n    |\n    = note: box cannot be represented as a single pointer\n \n error: `extern` fn uses type `Box<dyn Trait>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:85:34\n+  --> $DIR/lint-ctypes-fn.rs:89:34\n    |\n LL | pub extern \"C\" fn boxed_trait(p: Box<dyn Trait>) { }\n    |                                  ^^^^^^^^^^^^^^ not FFI-safe\n    |\n    = note: box cannot be represented as a single pointer\n \n error: `extern` fn uses type `char`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:88:32\n+  --> $DIR/lint-ctypes-fn.rs:92:32\n    |\n LL | pub extern \"C\" fn char_type(p: char) { }\n    |                                ^^^^ not FFI-safe\n@@ -55,23 +55,23 @@ LL | pub extern \"C\" fn char_type(p: char) { }\n    = note: the `char` type has no C equivalent\n \n error: `extern` fn uses type `i128`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:91:32\n+  --> $DIR/lint-ctypes-fn.rs:95:32\n    |\n LL | pub extern \"C\" fn i128_type(p: i128) { }\n    |                                ^^^^ not FFI-safe\n    |\n    = note: 128-bit integers don't currently have a known stable ABI\n \n error: `extern` fn uses type `u128`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:94:32\n+  --> $DIR/lint-ctypes-fn.rs:98:32\n    |\n LL | pub extern \"C\" fn u128_type(p: u128) { }\n    |                                ^^^^ not FFI-safe\n    |\n    = note: 128-bit integers don't currently have a known stable ABI\n \n error: `extern` fn uses type `(i32, i32)`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:97:33\n+  --> $DIR/lint-ctypes-fn.rs:101:33\n    |\n LL | pub extern \"C\" fn tuple_type(p: (i32, i32)) { }\n    |                                 ^^^^^^^^^^ not FFI-safe\n@@ -80,7 +80,7 @@ LL | pub extern \"C\" fn tuple_type(p: (i32, i32)) { }\n    = note: tuples have unspecified layout\n \n error: `extern` fn uses type `(i32, i32)`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:100:34\n+  --> $DIR/lint-ctypes-fn.rs:104:34\n    |\n LL | pub extern \"C\" fn tuple_type2(p: I32Pair) { }\n    |                                  ^^^^^^^ not FFI-safe\n@@ -89,7 +89,7 @@ LL | pub extern \"C\" fn tuple_type2(p: I32Pair) { }\n    = note: tuples have unspecified layout\n \n error: `extern` fn uses type `ZeroSize`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:103:32\n+  --> $DIR/lint-ctypes-fn.rs:107:32\n    |\n LL | pub extern \"C\" fn zero_size(p: ZeroSize) { }\n    |                                ^^^^^^^^ not FFI-safe\n@@ -103,7 +103,7 @@ LL | pub struct ZeroSize;\n    | ^^^^^^^^^^^^^^^^^^^^\n \n error: `extern` fn uses type `ZeroSizeWithPhantomData`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:106:40\n+  --> $DIR/lint-ctypes-fn.rs:110:40\n    |\n LL | pub extern \"C\" fn zero_size_phantom(p: ZeroSizeWithPhantomData) { }\n    |                                        ^^^^^^^^^^^^^^^^^^^^^^^ not FFI-safe\n@@ -116,15 +116,15 @@ LL | pub struct ZeroSizeWithPhantomData(PhantomData<i32>);\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: `extern` fn uses type `PhantomData<bool>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:109:51\n+  --> $DIR/lint-ctypes-fn.rs:113:51\n    |\n LL | pub extern \"C\" fn zero_size_phantom_toplevel() -> PhantomData<bool> {\n    |                                                   ^^^^^^^^^^^^^^^^^ not FFI-safe\n    |\n    = note: composed only of `PhantomData`\n \n error: `extern` fn uses type `fn()`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:114:30\n+  --> $DIR/lint-ctypes-fn.rs:118:30\n    |\n LL | pub extern \"C\" fn fn_type(p: RustFn) { }\n    |                              ^^^^^^ not FFI-safe\n@@ -133,7 +133,7 @@ LL | pub extern \"C\" fn fn_type(p: RustFn) { }\n    = note: this function pointer has Rust-specific calling convention\n \n error: `extern` fn uses type `fn()`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:117:31\n+  --> $DIR/lint-ctypes-fn.rs:121:31\n    |\n LL | pub extern \"C\" fn fn_type2(p: fn()) { }\n    |                               ^^^^ not FFI-safe\n@@ -142,15 +142,15 @@ LL | pub extern \"C\" fn fn_type2(p: fn()) { }\n    = note: this function pointer has Rust-specific calling convention\n \n error: `extern` fn uses type `i128`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:122:39\n+  --> $DIR/lint-ctypes-fn.rs:126:39\n    |\n LL | pub extern \"C\" fn transparent_i128(p: TransparentI128) { }\n    |                                       ^^^^^^^^^^^^^^^ not FFI-safe\n    |\n    = note: 128-bit integers don't currently have a known stable ABI\n \n error: `extern` fn uses type `str`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:125:38\n+  --> $DIR/lint-ctypes-fn.rs:129:38\n    |\n LL | pub extern \"C\" fn transparent_str(p: TransparentStr) { }\n    |                                      ^^^^^^^^^^^^^^ not FFI-safe\n@@ -159,15 +159,15 @@ LL | pub extern \"C\" fn transparent_str(p: TransparentStr) { }\n    = note: string slices have no C equivalent\n \n error: `extern` fn uses type `PhantomData<bool>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:171:43\n+  --> $DIR/lint-ctypes-fn.rs:175:43\n    |\n LL | pub extern \"C\" fn unused_generic2<T>() -> PhantomData<bool> {\n    |                                           ^^^^^^^^^^^^^^^^^ not FFI-safe\n    |\n    = note: composed only of `PhantomData`\n \n error: `extern` fn uses type `Vec<T>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:184:39\n+  --> $DIR/lint-ctypes-fn.rs:188:39\n    |\n LL | pub extern \"C\" fn used_generic4<T>(x: Vec<T>) { }\n    |                                       ^^^^^^ not FFI-safe\n@@ -176,7 +176,7 @@ LL | pub extern \"C\" fn used_generic4<T>(x: Vec<T>) { }\n    = note: this struct has unspecified layout\n \n error: `extern` fn uses type `Vec<T>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes-fn.rs:187:41\n+  --> $DIR/lint-ctypes-fn.rs:191:41\n    |\n LL | pub extern \"C\" fn used_generic5<T>() -> Vec<T> {\n    |                                         ^^^^^^ not FFI-safe"}, {"sha": "9165e14b7ffe34892fc078e9b4709756b67a5549", "filename": "src/test/ui/lint/lint-ctypes.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c70b35efd8ed4d2e85a468c6519300c16609cdab/src%2Ftest%2Fui%2Flint%2Flint-ctypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c70b35efd8ed4d2e85a468c6519300c16609cdab/src%2Ftest%2Fui%2Flint%2Flint-ctypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-ctypes.rs?ref=c70b35efd8ed4d2e85a468c6519300c16609cdab", "patch": "@@ -47,6 +47,8 @@ pub struct ZeroSizeWithPhantomData(::std::marker::PhantomData<i32>);\n extern \"C\" {\n     pub fn ptr_type1(size: *const Foo); //~ ERROR: uses type `Foo`\n     pub fn ptr_type2(size: *const Foo); //~ ERROR: uses type `Foo`\n+    pub fn ptr_unit(p: *const ());\n+    pub fn ptr_tuple(p: *const ((),)); //~ ERROR: uses type `((),)`\n     pub fn slice_type(p: &[u32]); //~ ERROR: uses type `[u32]`\n     pub fn str_type(p: &str); //~ ERROR: uses type `str`\n     pub fn box_type(p: Box<u32>); //~ ERROR uses type `Box<u32>`"}, {"sha": "342b6bfc6f87a225871d4841590504975a5107bf", "filename": "src/test/ui/lint/lint-ctypes.stderr", "status": "modified", "additions": 34, "deletions": 25, "changes": 59, "blob_url": "https://github.com/rust-lang/rust/blob/c70b35efd8ed4d2e85a468c6519300c16609cdab/src%2Ftest%2Fui%2Flint%2Flint-ctypes.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c70b35efd8ed4d2e85a468c6519300c16609cdab/src%2Ftest%2Fui%2Flint%2Flint-ctypes.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-ctypes.stderr?ref=c70b35efd8ed4d2e85a468c6519300c16609cdab", "patch": "@@ -31,8 +31,17 @@ note: the type is defined here\n LL | pub struct Foo;\n    | ^^^^^^^^^^^^^^^\n \n+error: `extern` block uses type `((),)`, which is not FFI-safe\n+  --> $DIR/lint-ctypes.rs:51:25\n+   |\n+LL |     pub fn ptr_tuple(p: *const ((),));\n+   |                         ^^^^^^^^^^^^ not FFI-safe\n+   |\n+   = help: consider using a struct instead\n+   = note: tuples have unspecified layout\n+\n error: `extern` block uses type `[u32]`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:50:26\n+  --> $DIR/lint-ctypes.rs:52:26\n    |\n LL |     pub fn slice_type(p: &[u32]);\n    |                          ^^^^^^ not FFI-safe\n@@ -41,7 +50,7 @@ LL |     pub fn slice_type(p: &[u32]);\n    = note: slices have no C equivalent\n \n error: `extern` block uses type `str`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:51:24\n+  --> $DIR/lint-ctypes.rs:53:24\n    |\n LL |     pub fn str_type(p: &str);\n    |                        ^^^^ not FFI-safe\n@@ -50,7 +59,7 @@ LL |     pub fn str_type(p: &str);\n    = note: string slices have no C equivalent\n \n error: `extern` block uses type `Box<u32>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:52:24\n+  --> $DIR/lint-ctypes.rs:54:24\n    |\n LL |     pub fn box_type(p: Box<u32>);\n    |                        ^^^^^^^^ not FFI-safe\n@@ -59,7 +68,7 @@ LL |     pub fn box_type(p: Box<u32>);\n    = note: this struct has unspecified layout\n \n error: `extern` block uses type `Option<Box<u32>>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:53:28\n+  --> $DIR/lint-ctypes.rs:55:28\n    |\n LL |     pub fn opt_box_type(p: Option<Box<u32>>);\n    |                            ^^^^^^^^^^^^^^^^ not FFI-safe\n@@ -68,7 +77,7 @@ LL |     pub fn opt_box_type(p: Option<Box<u32>>);\n    = note: enum has no representation hint\n \n error: `extern` block uses type `char`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:55:25\n+  --> $DIR/lint-ctypes.rs:57:25\n    |\n LL |     pub fn char_type(p: char);\n    |                         ^^^^ not FFI-safe\n@@ -77,31 +86,31 @@ LL |     pub fn char_type(p: char);\n    = note: the `char` type has no C equivalent\n \n error: `extern` block uses type `i128`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:56:25\n+  --> $DIR/lint-ctypes.rs:58:25\n    |\n LL |     pub fn i128_type(p: i128);\n    |                         ^^^^ not FFI-safe\n    |\n    = note: 128-bit integers don't currently have a known stable ABI\n \n error: `extern` block uses type `u128`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:57:25\n+  --> $DIR/lint-ctypes.rs:59:25\n    |\n LL |     pub fn u128_type(p: u128);\n    |                         ^^^^ not FFI-safe\n    |\n    = note: 128-bit integers don't currently have a known stable ABI\n \n error: `extern` block uses type `dyn Bar`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:58:26\n+  --> $DIR/lint-ctypes.rs:60:26\n    |\n LL |     pub fn trait_type(p: &dyn Bar);\n    |                          ^^^^^^^^ not FFI-safe\n    |\n    = note: trait objects have no C equivalent\n \n error: `extern` block uses type `(i32, i32)`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:59:26\n+  --> $DIR/lint-ctypes.rs:61:26\n    |\n LL |     pub fn tuple_type(p: (i32, i32));\n    |                          ^^^^^^^^^^ not FFI-safe\n@@ -110,7 +119,7 @@ LL |     pub fn tuple_type(p: (i32, i32));\n    = note: tuples have unspecified layout\n \n error: `extern` block uses type `(i32, i32)`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:60:27\n+  --> $DIR/lint-ctypes.rs:62:27\n    |\n LL |     pub fn tuple_type2(p: I32Pair);\n    |                           ^^^^^^^ not FFI-safe\n@@ -119,7 +128,7 @@ LL |     pub fn tuple_type2(p: I32Pair);\n    = note: tuples have unspecified layout\n \n error: `extern` block uses type `ZeroSize`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:61:25\n+  --> $DIR/lint-ctypes.rs:63:25\n    |\n LL |     pub fn zero_size(p: ZeroSize);\n    |                         ^^^^^^^^ not FFI-safe\n@@ -133,7 +142,7 @@ LL | pub struct ZeroSize;\n    | ^^^^^^^^^^^^^^^^^^^^\n \n error: `extern` block uses type `ZeroSizeWithPhantomData`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:62:33\n+  --> $DIR/lint-ctypes.rs:64:33\n    |\n LL |     pub fn zero_size_phantom(p: ZeroSizeWithPhantomData);\n    |                                 ^^^^^^^^^^^^^^^^^^^^^^^ not FFI-safe\n@@ -146,15 +155,15 @@ LL | pub struct ZeroSizeWithPhantomData(::std::marker::PhantomData<i32>);\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: `extern` block uses type `PhantomData<bool>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:65:12\n+  --> $DIR/lint-ctypes.rs:67:12\n    |\n LL |         -> ::std::marker::PhantomData<bool>;\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ not FFI-safe\n    |\n    = note: composed only of `PhantomData`\n \n error: `extern` block uses type `fn()`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:66:23\n+  --> $DIR/lint-ctypes.rs:68:23\n    |\n LL |     pub fn fn_type(p: RustFn);\n    |                       ^^^^^^ not FFI-safe\n@@ -163,7 +172,7 @@ LL |     pub fn fn_type(p: RustFn);\n    = note: this function pointer has Rust-specific calling convention\n \n error: `extern` block uses type `fn()`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:67:24\n+  --> $DIR/lint-ctypes.rs:69:24\n    |\n LL |     pub fn fn_type2(p: fn());\n    |                        ^^^^ not FFI-safe\n@@ -172,7 +181,7 @@ LL |     pub fn fn_type2(p: fn());\n    = note: this function pointer has Rust-specific calling convention\n \n error: `extern` block uses type `Box<u32>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:68:28\n+  --> $DIR/lint-ctypes.rs:70:28\n    |\n LL |     pub fn fn_contained(p: RustBadRet);\n    |                            ^^^^^^^^^^ not FFI-safe\n@@ -181,15 +190,15 @@ LL |     pub fn fn_contained(p: RustBadRet);\n    = note: this struct has unspecified layout\n \n error: `extern` block uses type `i128`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:69:32\n+  --> $DIR/lint-ctypes.rs:71:32\n    |\n LL |     pub fn transparent_i128(p: TransparentI128);\n    |                                ^^^^^^^^^^^^^^^ not FFI-safe\n    |\n    = note: 128-bit integers don't currently have a known stable ABI\n \n error: `extern` block uses type `str`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:70:31\n+  --> $DIR/lint-ctypes.rs:72:31\n    |\n LL |     pub fn transparent_str(p: TransparentStr);\n    |                               ^^^^^^^^^^^^^^ not FFI-safe\n@@ -198,7 +207,7 @@ LL |     pub fn transparent_str(p: TransparentStr);\n    = note: string slices have no C equivalent\n \n error: `extern` block uses type `Box<u32>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:71:30\n+  --> $DIR/lint-ctypes.rs:73:30\n    |\n LL |     pub fn transparent_fn(p: TransparentBadFn);\n    |                              ^^^^^^^^^^^^^^^^ not FFI-safe\n@@ -207,7 +216,7 @@ LL |     pub fn transparent_fn(p: TransparentBadFn);\n    = note: this struct has unspecified layout\n \n error: `extern` block uses type `[u8; 8]`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:72:27\n+  --> $DIR/lint-ctypes.rs:74:27\n    |\n LL |     pub fn raw_array(arr: [u8; 8]);\n    |                           ^^^^^^^ not FFI-safe\n@@ -216,7 +225,7 @@ LL |     pub fn raw_array(arr: [u8; 8]);\n    = note: passing raw arrays by value is not FFI-safe\n \n error: `extern` block uses type `Option<UnsafeCell<extern \"C\" fn()>>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:74:26\n+  --> $DIR/lint-ctypes.rs:76:26\n    |\n LL |     pub fn no_niche_a(a: Option<UnsafeCell<extern fn()>>);\n    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ not FFI-safe\n@@ -225,7 +234,7 @@ LL |     pub fn no_niche_a(a: Option<UnsafeCell<extern fn()>>);\n    = note: enum has no representation hint\n \n error: `extern` block uses type `Option<UnsafeCell<&i32>>`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:76:26\n+  --> $DIR/lint-ctypes.rs:78:26\n    |\n LL |     pub fn no_niche_b(b: Option<UnsafeCell<&i32>>);\n    |                          ^^^^^^^^^^^^^^^^^^^^^^^^ not FFI-safe\n@@ -234,20 +243,20 @@ LL |     pub fn no_niche_b(b: Option<UnsafeCell<&i32>>);\n    = note: enum has no representation hint\n \n error: `extern` block uses type `u128`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:79:34\n+  --> $DIR/lint-ctypes.rs:81:34\n    |\n LL |     pub static static_u128_type: u128;\n    |                                  ^^^^ not FFI-safe\n    |\n    = note: 128-bit integers don't currently have a known stable ABI\n \n error: `extern` block uses type `u128`, which is not FFI-safe\n-  --> $DIR/lint-ctypes.rs:80:40\n+  --> $DIR/lint-ctypes.rs:82:40\n    |\n LL |     pub static static_u128_array_type: [u128; 16];\n    |                                        ^^^^^^^^^^ not FFI-safe\n    |\n    = note: 128-bit integers don't currently have a known stable ABI\n \n-error: aborting due to 26 previous errors\n+error: aborting due to 27 previous errors\n "}]}