{"sha": "4210409f443a40c72876e5e8398e8652a47a2ba6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQyMTA0MDlmNDQzYTQwYzcyODc2ZTVlODM5OGU4NjUyYTQ3YTJiYTY=", "commit": {"author": {"name": "Aaron Green", "email": "nopsledder@users.noreply.github.com", "date": "2020-01-15T23:48:53Z"}, "committer": {"name": "Aaron Green", "email": "nopsledder@users.noreply.github.com", "date": "2020-01-22T23:19:36Z"}, "message": "Enable ASan on Fuchsia\n\nThis change adds the x86_64-fuchsia and aarch64-fuchsia LLVM targets to\nthose allowed to invoke -Zsanitizer. Currently, the only overlap between\ncompiler_rt sanitizers supported by both rustc and Fuchsia is ASan.", "tree": {"sha": "6baeb5ab72bdf609bb2ee0418a5ca084f07bff61", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6baeb5ab72bdf609bb2ee0418a5ca084f07bff61"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4210409f443a40c72876e5e8398e8652a47a2ba6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4210409f443a40c72876e5e8398e8652a47a2ba6", "html_url": "https://github.com/rust-lang/rust/commit/4210409f443a40c72876e5e8398e8652a47a2ba6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4210409f443a40c72876e5e8398e8652a47a2ba6/comments", "author": {"login": "nopsledder", "id": 116663695, "node_id": "U_kgDOBvQljw", "avatar_url": "https://avatars.githubusercontent.com/u/116663695?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nopsledder", "html_url": "https://github.com/nopsledder", "followers_url": "https://api.github.com/users/nopsledder/followers", "following_url": "https://api.github.com/users/nopsledder/following{/other_user}", "gists_url": "https://api.github.com/users/nopsledder/gists{/gist_id}", "starred_url": "https://api.github.com/users/nopsledder/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nopsledder/subscriptions", "organizations_url": "https://api.github.com/users/nopsledder/orgs", "repos_url": "https://api.github.com/users/nopsledder/repos", "events_url": "https://api.github.com/users/nopsledder/events{/privacy}", "received_events_url": "https://api.github.com/users/nopsledder/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nopsledder", "id": 116663695, "node_id": "U_kgDOBvQljw", "avatar_url": "https://avatars.githubusercontent.com/u/116663695?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nopsledder", "html_url": "https://github.com/nopsledder", "followers_url": "https://api.github.com/users/nopsledder/followers", "following_url": "https://api.github.com/users/nopsledder/following{/other_user}", "gists_url": "https://api.github.com/users/nopsledder/gists{/gist_id}", "starred_url": "https://api.github.com/users/nopsledder/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nopsledder/subscriptions", "organizations_url": "https://api.github.com/users/nopsledder/orgs", "repos_url": "https://api.github.com/users/nopsledder/repos", "events_url": "https://api.github.com/users/nopsledder/events{/privacy}", "received_events_url": "https://api.github.com/users/nopsledder/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ae66171b41b1d05128afd0d666475bc4ba617469", "url": "https://api.github.com/repos/rust-lang/rust/commits/ae66171b41b1d05128afd0d666475bc4ba617469", "html_url": "https://github.com/rust-lang/rust/commit/ae66171b41b1d05128afd0d666475bc4ba617469"}], "stats": {"total": 22, "additions": 20, "deletions": 2}, "files": [{"sha": "5bbd9f47fc907f51a3b4f45fb3ee2c447f97d268", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/4210409f443a40c72876e5e8398e8652a47a2ba6/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4210409f443a40c72876e5e8398e8652a47a2ba6/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=4210409f443a40c72876e5e8398e8652a47a2ba6", "patch": "@@ -659,6 +659,24 @@ fn supported_sanitizers(out_dir: &Path, target: Interned<String>) -> Vec<Sanitiz\n                 });\n             }\n         }\n+        \"x86_64-fuchsia\" => {\n+            for s in &[\"asan\"] {\n+                result.push(SanitizerRuntime {\n+                    cmake_target: format!(\"clang_rt.{}-x86_64\", s),\n+                    path: out_dir.join(&format!(\"build/lib/fuchsia/libclang_rt.{}-x86_64.a\", s)),\n+                    name: format!(\"librustc_rt.{}.a\", s),\n+                });\n+            }\n+        }\n+        \"aarch64-fuchsia\" => {\n+            for s in &[\"asan\"] {\n+                result.push(SanitizerRuntime {\n+                    cmake_target: format!(\"clang_rt.{}-aarch64\", s),\n+                    path: out_dir.join(&format!(\"build/lib/fuchsia/libclang_rt.{}-aarch64.a\", s)),\n+                    name: format!(\"librustc_rt.{}.a\", s),\n+                });\n+            }\n+        }\n         _ => {}\n     }\n     result"}, {"sha": "f56a4170c0a4b3b0897aa58aeffe386241be8128", "filename": "src/librustc_codegen_ssa/back/link.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4210409f443a40c72876e5e8398e8652a47a2ba6/src%2Flibrustc_codegen_ssa%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4210409f443a40c72876e5e8398e8652a47a2ba6/src%2Flibrustc_codegen_ssa%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fback%2Flink.rs?ref=4210409f443a40c72876e5e8398e8652a47a2ba6", "patch": "@@ -777,7 +777,7 @@ fn link_sanitizer_runtime(sess: &Session, crate_type: config::CrateType, linker:\n             linker.args(&[\"-Wl,-rpath\".into(), \"-Xlinker\".into(), rpath.into()]);\n             linker.link_dylib(Symbol::intern(&libname));\n         }\n-        \"x86_64-unknown-linux-gnu\" => {\n+        \"x86_64-unknown-linux-gnu\" | \"x86_64-fuchsia\" | \"aarch64-fuchsia\" => {\n             let filename = format!(\"librustc_rt.{}.a\", name);\n             let path = default_tlib.join(&filename);\n             linker.link_whole_rlib(&path);"}, {"sha": "527d85f69658c4540f083ed3db666d3ece6b2142", "filename": "src/librustc_session/session.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/4210409f443a40c72876e5e8398e8652a47a2ba6/src%2Flibrustc_session%2Fsession.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4210409f443a40c72876e5e8398e8652a47a2ba6/src%2Flibrustc_session%2Fsession.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_session%2Fsession.rs?ref=4210409f443a40c72876e5e8398e8652a47a2ba6", "patch": "@@ -1128,7 +1128,7 @@ fn validate_commandline_args_with_session_available(sess: &Session) {\n     // Sanitizers can only be used on some tested platforms.\n     if let Some(ref sanitizer) = sess.opts.debugging_opts.sanitizer {\n         const ASAN_SUPPORTED_TARGETS: &[&str] =\n-            &[\"x86_64-unknown-linux-gnu\", \"x86_64-apple-darwin\"];\n+            &[\"x86_64-unknown-linux-gnu\", \"x86_64-apple-darwin\", \"x86_64-fuchsia\", \"aarch64-fuchsia\" ];\n         const TSAN_SUPPORTED_TARGETS: &[&str] =\n             &[\"x86_64-unknown-linux-gnu\", \"x86_64-apple-darwin\"];\n         const LSAN_SUPPORTED_TARGETS: &[&str] ="}]}