{"sha": "07edf9036715bde27cc7bbc0feb3ee6e461130da", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA3ZWRmOTAzNjcxNWJkZTI3Y2M3YmJjMGZlYjNlZTZlNDYxMTMwZGE=", "commit": {"author": {"name": "Gareth Daniel Smith", "email": "garethdanielsmith@gmail.com", "date": "2012-10-06T10:11:06Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2012-10-13T12:57:13Z"}, "message": "Implement to_managed without using an upcall function, as suggested by brson.", "tree": {"sha": "5ecac7e01ee088c072f68eb88ba32cac089b3af7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5ecac7e01ee088c072f68eb88ba32cac089b3af7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/07edf9036715bde27cc7bbc0feb3ee6e461130da", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/07edf9036715bde27cc7bbc0feb3ee6e461130da", "html_url": "https://github.com/rust-lang/rust/commit/07edf9036715bde27cc7bbc0feb3ee6e461130da", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/07edf9036715bde27cc7bbc0feb3ee6e461130da/comments", "author": {"login": "Dretch", "id": 1428731, "node_id": "MDQ6VXNlcjE0Mjg3MzE=", "avatar_url": "https://avatars.githubusercontent.com/u/1428731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dretch", "html_url": "https://github.com/Dretch", "followers_url": "https://api.github.com/users/Dretch/followers", "following_url": "https://api.github.com/users/Dretch/following{/other_user}", "gists_url": "https://api.github.com/users/Dretch/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dretch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dretch/subscriptions", "organizations_url": "https://api.github.com/users/Dretch/orgs", "repos_url": "https://api.github.com/users/Dretch/repos", "events_url": "https://api.github.com/users/Dretch/events{/privacy}", "received_events_url": "https://api.github.com/users/Dretch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e9caa3fe2e291b7f2cea624bfd0dc879e95fe382", "url": "https://api.github.com/repos/rust-lang/rust/commits/e9caa3fe2e291b7f2cea624bfd0dc879e95fe382", "html_url": "https://github.com/rust-lang/rust/commit/e9caa3fe2e291b7f2cea624bfd0dc879e95fe382"}], "stats": {"total": 13, "additions": 4, "deletions": 9}, "files": [{"sha": "447cb59acf80e414fc3dc597b8469a7b2e9057d6", "filename": "src/libcore/str.rs", "status": "modified", "additions": 4, "deletions": 9, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/07edf9036715bde27cc7bbc0feb3ee6e461130da/src%2Flibcore%2Fstr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/07edf9036715bde27cc7bbc0feb3ee6e461130da/src%2Flibcore%2Fstr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fstr.rs?ref=07edf9036715bde27cc7bbc0feb3ee6e461130da", "patch": "@@ -1869,11 +1869,6 @@ pub pure fn escape_unicode(s: &str) -> ~str {\n     move out\n }\n \n-extern mod rustrt {\n-    #[rust_stack]\n-    pure fn upcall_str_new_shared(cstr: *libc::c_char, len: size_t) -> @str;\n-}\n-\n /// Unsafe operations\n pub mod raw {\n \n@@ -2221,10 +2216,10 @@ impl &str: StrSlice {\n \n     #[inline]\n     pure fn to_managed() -> @str {\n-        do str::as_buf(self) |p, _len| {\n-            rustrt::upcall_str_new_shared(p as *libc::c_char,\n-                                          self.len() as size_t)\n-        }\n+        let v = at_vec::from_fn(self.len() + 1, |i| {\n+            if i == self.len() { 0 } else { self[i] }\n+        });\n+        unsafe { ::cast::transmute(v) }\n     }\n \n     #[inline]"}]}