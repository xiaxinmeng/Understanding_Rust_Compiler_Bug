{"sha": "5132e13f137ee343a7a64649fa3795560f69216b", "node_id": "C_kwDOAAsO6NoAKDUxMzJlMTNmMTM3ZWUzNDNhN2E2NDY0OWZhMzc5NTU2MGY2OTIxNmI", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-12-24T21:30:15Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-01-09T17:27:42Z"}, "message": "No need to take opaques in check_type_bounds", "tree": {"sha": "90498aa8e71994c42eaf61faf98afbc0ff195ada", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/90498aa8e71994c42eaf61faf98afbc0ff195ada"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5132e13f137ee343a7a64649fa3795560f69216b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5132e13f137ee343a7a64649fa3795560f69216b", "html_url": "https://github.com/rust-lang/rust/commit/5132e13f137ee343a7a64649fa3795560f69216b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5132e13f137ee343a7a64649fa3795560f69216b/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "89e0576bd3aec2f1acf935b353900bd75742860b", "url": "https://api.github.com/repos/rust-lang/rust/commits/89e0576bd3aec2f1acf935b353900bd75742860b", "html_url": "https://github.com/rust-lang/rust/commit/89e0576bd3aec2f1acf935b353900bd75742860b"}], "stats": {"total": 18, "additions": 1, "deletions": 17}, "files": [{"sha": "17f9106e7e0b8d1883b2a8cbc93ef71b6141ce18", "filename": "compiler/rustc_hir_analysis/src/check/compare_impl_item.rs", "status": "modified", "additions": 1, "deletions": 17, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/5132e13f137ee343a7a64649fa3795560f69216b/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fcompare_impl_item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5132e13f137ee343a7a64649fa3795560f69216b/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fcompare_impl_item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fcheck%2Fcompare_impl_item.rs?ref=5132e13f137ee343a7a64649fa3795560f69216b", "patch": "@@ -424,7 +424,7 @@ fn compare_asyncness<'tcx>(\n             ty::Alias(ty::Opaque, ..) => {\n                 // allow both `async fn foo()` and `fn foo() -> impl Future`\n             }\n-            ty::Error(rustc_errors::ErrorGuaranteed { .. }) => {\n+            ty::Error(_) => {\n                 // We don't know if it's ok, but at least it's already an error.\n             }\n             _ => {\n@@ -1971,22 +1971,6 @@ pub(super) fn check_type_bounds<'tcx>(\n         &outlives_environment,\n     )?;\n \n-    let constraints = infcx.inner.borrow_mut().opaque_type_storage.take_opaque_types();\n-    for (key, value) in constraints {\n-        infcx\n-            .err_ctxt()\n-            .report_mismatched_types(\n-                &ObligationCause::misc(\n-                    value.hidden_type.span,\n-                    tcx.hir().local_def_id_to_hir_id(impl_ty.def_id.expect_local()),\n-                ),\n-                tcx.mk_opaque(key.def_id.to_def_id(), key.substs),\n-                value.hidden_type.ty,\n-                TypeError::Mismatch,\n-            )\n-            .emit();\n-    }\n-\n     Ok(())\n }\n "}]}