{"sha": "78e17f65cfa0013ea51d94f0142ca6d4bcc5d088", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc4ZTE3ZjY1Y2ZhMDAxM2VhNTFkOTRmMDE0MmNhNmQ0YmNjNWQwODg=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-05-31T17:52:09Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-05-31T17:53:00Z"}, "message": "use sync queries for join lines and friends", "tree": {"sha": "0ea40483691d7b9a7822149c670aeb84231a1bb2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0ea40483691d7b9a7822149c670aeb84231a1bb2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/78e17f65cfa0013ea51d94f0142ca6d4bcc5d088", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/78e17f65cfa0013ea51d94f0142ca6d4bcc5d088", "html_url": "https://github.com/rust-lang/rust/commit/78e17f65cfa0013ea51d94f0142ca6d4bcc5d088", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/78e17f65cfa0013ea51d94f0142ca6d4bcc5d088/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c6537c3280ba1c5df27c1ced9d4944a2acb02b6c", "url": "https://api.github.com/repos/rust-lang/rust/commits/c6537c3280ba1c5df27c1ced9d4944a2acb02b6c", "html_url": "https://github.com/rust-lang/rust/commit/c6537c3280ba1c5df27c1ced9d4944a2acb02b6c"}], "stats": {"total": 16, "additions": 11, "deletions": 5}, "files": [{"sha": "4524994972661d2bc56ca4d28a0f1c0539352cbd", "filename": "crates/ra_lsp_server/src/main_loop.rs", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/78e17f65cfa0013ea51d94f0142ca6d4bcc5d088/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78e17f65cfa0013ea51d94f0142ca6d4bcc5d088/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_lsp_server%2Fsrc%2Fmain_loop.rs?ref=78e17f65cfa0013ea51d94f0142ca6d4bcc5d088", "patch": "@@ -315,14 +315,18 @@ fn on_request(\n         request_received,\n     };\n     pool_dispatcher\n-        .on_sync::<req::CollectGarbage>(|state, ()| Ok(state.collect_garbage()))?\n+        .on_sync::<req::CollectGarbage>(|s, ()| Ok(s.collect_garbage()))?\n+        .on_sync::<req::JoinLines>(|s, p| handlers::handle_join_lines(s.snapshot(), p))?\n+        .on_sync::<req::OnEnter>(|s, p| handlers::handle_on_enter(s.snapshot(), p))?\n+        .on_sync::<req::SelectionRangeRequest>(|s, p| {\n+            handlers::handle_selection_range(s.snapshot(), p)\n+        })?\n+        .on_sync::<req::FindMatchingBrace>(|s, p| {\n+            handlers::handle_find_matching_brace(s.snapshot(), p)\n+        })?\n         .on::<req::AnalyzerStatus>(handlers::handle_analyzer_status)?\n         .on::<req::SyntaxTree>(handlers::handle_syntax_tree)?\n         .on::<req::ExtendSelection>(handlers::handle_extend_selection)?\n-        .on::<req::SelectionRangeRequest>(handlers::handle_selection_range)?\n-        .on::<req::FindMatchingBrace>(handlers::handle_find_matching_brace)?\n-        .on::<req::JoinLines>(handlers::handle_join_lines)?\n-        .on::<req::OnEnter>(handlers::handle_on_enter)?\n         .on::<req::OnTypeFormatting>(handlers::handle_on_type_formatting)?\n         .on::<req::DocumentSymbolRequest>(handlers::handle_document_symbol)?\n         .on::<req::WorkspaceSymbol>(handlers::handle_workspace_symbol)?\n@@ -428,6 +432,7 @@ struct PoolDispatcher<'a> {\n }\n \n impl<'a> PoolDispatcher<'a> {\n+    /// Dispatches the request onto the current thread\n     fn on_sync<R>(\n         &mut self,\n         f: fn(&mut ServerWorldState, R::Params) -> Result<R::Result>,\n@@ -449,6 +454,7 @@ impl<'a> PoolDispatcher<'a> {\n         Ok(self)\n     }\n \n+    /// Dispatches the request onto thread pool\n     fn on<R>(&mut self, f: fn(ServerWorld, R::Params) -> Result<R::Result>) -> Result<&mut Self>\n     where\n         R: req::Request + 'static,"}]}