{"sha": "ae609d7953297b355616c7862b8deefe74a8f95f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFlNjA5ZDc5NTMyOTdiMzU1NjE2Yzc4NjJiOGRlZWZlNzRhOGY5NWY=", "commit": {"author": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2019-11-03T17:44:23Z"}, "committer": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2019-11-04T17:38:20Z"}, "message": "Add parent_expansion to HirFileId", "tree": {"sha": "4f84d7f24ff59160eb318f527ecf4cf94e4d4cf8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4f84d7f24ff59160eb318f527ecf4cf94e4d4cf8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ae609d7953297b355616c7862b8deefe74a8f95f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ae609d7953297b355616c7862b8deefe74a8f95f", "html_url": "https://github.com/rust-lang/rust/commit/ae609d7953297b355616c7862b8deefe74a8f95f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ae609d7953297b355616c7862b8deefe74a8f95f/comments", "author": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "committer": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "159da285e9d8594a2cc4436b5cee7874b07806c9", "url": "https://api.github.com/repos/rust-lang/rust/commits/159da285e9d8594a2cc4436b5cee7874b07806c9", "html_url": "https://github.com/rust-lang/rust/commit/159da285e9d8594a2cc4436b5cee7874b07806c9"}], "stats": {"total": 19, "additions": 19, "deletions": 0}, "files": [{"sha": "180cd1f57281bdf43f679b0538e7e1ebfead8ce6", "filename": "crates/ra_hir_expand/src/lib.rs", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/ae609d7953297b355616c7862b8deefe74a8f95f/crates%2Fra_hir_expand%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ae609d7953297b355616c7862b8deefe74a8f95f/crates%2Fra_hir_expand%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_expand%2Fsrc%2Flib.rs?ref=ae609d7953297b355616c7862b8deefe74a8f95f", "patch": "@@ -20,6 +20,7 @@ use ra_syntax::{\n };\n \n use crate::ast_id_map::FileAstId;\n+use std::sync::Arc;\n \n /// Input to the analyzer is a set of files, where each file is identified by\n /// `FileId` and contains source code. However, another source of source code in\n@@ -66,6 +67,24 @@ impl HirFileId {\n             }\n         }\n     }\n+\n+    /// Return expansion information if it is a macro-expansion file\n+    pub fn parent_expansion(\n+        self,\n+        db: &dyn db::AstDatabase,\n+    ) -> Option<((HirFileId, HirFileId), Arc<ExpansionInfo>)> {\n+        match self.0 {\n+            HirFileIdRepr::FileId(_) => None,\n+            HirFileIdRepr::MacroFile(macro_file) => {\n+                let loc: MacroCallLoc = db.lookup_intern_macro(macro_file.macro_call_id);\n+\n+                let def_file = loc.def.ast_id.file_id;\n+                let arg_file = loc.ast_id.file_id;\n+\n+                db.macro_expansion_info(macro_file).map(|ex| ((arg_file, def_file), ex))\n+            }\n+        }\n+    }\n }\n \n #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]"}]}