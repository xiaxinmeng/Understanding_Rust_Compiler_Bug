{"sha": "9b4ceee5930e5a7118ac25a0f424a7f83d01980f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjliNGNlZWU1OTMwZTVhNzExOGFjMjVhMGY0MjRhN2Y4M2QwMTk4MGY=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2020-10-06T06:20:18Z"}, "committer": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2020-10-06T06:20:18Z"}, "message": "integration tests: Replace lazy_static with SyncLazy", "tree": {"sha": "cb83017d6612ce84c68a569bf7864de61dc680c6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cb83017d6612ce84c68a569bf7864de61dc680c6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9b4ceee5930e5a7118ac25a0f424a7f83d01980f", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEb0jkZw3AJLMiOp9wGI/nM3KGUrEFAl98DL0ACgkQGI/nM3KG\nUrFDbw/+N+XDW1fAlGV859rbHbQe5jn5JuLSBc9SbGai8EOAMOjebaGgg3vMwsio\nIuYBUeaecwsJ5WxIc1Zp+6X5qHXzaexb1r0+4u95qNd5aYGORwGvrI3qHlAdBiAB\nxnjKw4Lzd4aH6ayia8Bl0YkJh77w/wXVSoDDVl8UJSd24TX9bCgpYutnYeP91LcU\nfANa5+hmNtiGoP5E0wLGdXuCzHWwVO2fb98t/4Wo71WVaTXmZIAnXGnTa44VDsK6\nnvyRE/Nk3lJsyqCDGkCU+EynWPFuJkuf4BaAlfvpPC5AR+e7tY+Hd+ltZicJN+4J\n7vtTf0gT1sNt5vzAcg7khtYEFnUs/fMMatHQa0Mf4IEb8HbrrxXtCpbsA9YS9PP4\nz818/0pYOrQsFhDk9vR+A6uq2eTMUHmzZw9mbyiw9XSMgvqolgGRL4VoqVLR/oVU\n7f9v8k1H1e4suUjGp8OGMe8D19ZLeJ8sJ15091uPLNftT9nu3Clgfv84Y19469pa\nr/oeY6NagSqX1Swq4V9HJIalWpG5uugOxuG175SabTq43YFDasWO93xA4iIFZvKC\nWHeeRzLjYlgWfaxvCoepYeJdbJGRyogOOTYpwIIoudZauPnjYpEWv56rS4jIk4w0\ntcPJAAp+12pGH6+BFBMi9mcPElOUwcMcxqV086unXyTaBC4iuRU=\n=nI5d\n-----END PGP SIGNATURE-----", "payload": "tree cb83017d6612ce84c68a569bf7864de61dc680c6\nparent 4b459596a96a7d6f4797d4f1444311d88df60009\nauthor Philipp Hansch <dev@phansch.net> 1601965218 +0200\ncommitter Philipp Hansch <dev@phansch.net> 1601965218 +0200\n\nintegration tests: Replace lazy_static with SyncLazy\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9b4ceee5930e5a7118ac25a0f424a7f83d01980f", "html_url": "https://github.com/rust-lang/rust/commit/9b4ceee5930e5a7118ac25a0f424a7f83d01980f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9b4ceee5930e5a7118ac25a0f424a7f83d01980f/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4b459596a96a7d6f4797d4f1444311d88df60009", "url": "https://api.github.com/repos/rust-lang/rust/commits/4b459596a96a7d6f4797d4f1444311d88df60009", "html_url": "https://github.com/rust-lang/rust/commit/4b459596a96a7d6f4797d4f1444311d88df60009"}], "stats": {"total": 45, "additions": 21, "deletions": 24}, "files": [{"sha": "a8f3e3145f64d723de26b9729b5375c21fd28a0b", "filename": "tests/cargo/mod.rs", "status": "modified", "additions": 17, "deletions": 20, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/9b4ceee5930e5a7118ac25a0f424a7f83d01980f/tests%2Fcargo%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9b4ceee5930e5a7118ac25a0f424a7f83d01980f/tests%2Fcargo%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcargo%2Fmod.rs?ref=9b4ceee5930e5a7118ac25a0f424a7f83d01980f", "patch": "@@ -1,27 +1,24 @@\n-use lazy_static::lazy_static;\n use std::env;\n+use std::lazy::SyncLazy;\n use std::path::PathBuf;\n \n-lazy_static! {\n-    pub static ref CARGO_TARGET_DIR: PathBuf = {\n-        match env::var_os(\"CARGO_TARGET_DIR\") {\n-            Some(v) => v.into(),\n-            None => env::current_dir().unwrap().join(\"target\"),\n-        }\n-    };\n-    pub static ref TARGET_LIB: PathBuf = {\n-        if let Some(path) = option_env!(\"TARGET_LIBS\") {\n-            path.into()\n-        } else {\n-            let mut dir = CARGO_TARGET_DIR.clone();\n-            if let Some(target) = env::var_os(\"CARGO_BUILD_TARGET\") {\n-                dir.push(target);\n-            }\n-            dir.push(env!(\"PROFILE\"));\n-            dir\n+pub static CARGO_TARGET_DIR: SyncLazy<PathBuf> = SyncLazy::new(|| match env::var_os(\"CARGO_TARGET_DIR\") {\n+    Some(v) => v.into(),\n+    None => env::current_dir().unwrap().join(\"target\"),\n+});\n+\n+pub static TARGET_LIB: SyncLazy<PathBuf> = SyncLazy::new(|| {\n+    if let Some(path) = option_env!(\"TARGET_LIBS\") {\n+        path.into()\n+    } else {\n+        let mut dir = CARGO_TARGET_DIR.clone();\n+        if let Some(target) = env::var_os(\"CARGO_BUILD_TARGET\") {\n+            dir.push(target);\n         }\n-    };\n-}\n+        dir.push(env!(\"PROFILE\"));\n+        dir\n+    }\n+});\n \n #[must_use]\n pub fn is_rustc_test_suite() -> bool {"}, {"sha": "0e8f7683103d61296a99190414cc52ae4e3a5ec6", "filename": "tests/compile-test.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9b4ceee5930e5a7118ac25a0f424a7f83d01980f/tests%2Fcompile-test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9b4ceee5930e5a7118ac25a0f424a7f83d01980f/tests%2Fcompile-test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-test.rs?ref=9b4ceee5930e5a7118ac25a0f424a7f83d01980f", "patch": "@@ -1,4 +1,5 @@\n #![feature(test)] // compiletest_rs requires this attribute\n+#![feature(once_cell)]\n \n use compiletest_rs as compiletest;\n use compiletest_rs::common::Mode as TestMode;"}, {"sha": "48e0478f16992275309baa6505e88395c32b143c", "filename": "tests/dogfood.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/9b4ceee5930e5a7118ac25a0f424a7f83d01980f/tests%2Fdogfood.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9b4ceee5930e5a7118ac25a0f424a7f83d01980f/tests%2Fdogfood.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fdogfood.rs?ref=9b4ceee5930e5a7118ac25a0f424a7f83d01980f", "patch": "@@ -1,15 +1,14 @@\n // Dogfood cannot run on Windows\n #![cfg(not(windows))]\n+#![feature(once_cell)]\n \n-use lazy_static::lazy_static;\n+use std::lazy::SyncLazy;\n use std::path::PathBuf;\n use std::process::Command;\n \n mod cargo;\n \n-lazy_static! {\n-    static ref CLIPPY_PATH: PathBuf = cargo::TARGET_LIB.join(\"cargo-clippy\");\n-}\n+static CLIPPY_PATH: SyncLazy<PathBuf> = SyncLazy::new(|| cargo::TARGET_LIB.join(\"cargo-clippy\"));\n \n #[test]\n fn dogfood_clippy() {"}]}