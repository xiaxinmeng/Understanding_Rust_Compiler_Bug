{"sha": "039f2039a4ec06c8e52734190ceaf43a21de5e39", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAzOWYyMDM5YTRlYzA2YzhlNTI3MzQxOTBjZWFmNDNhMjFkZTVlMzk=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-02-18T13:39:24Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-02-18T13:44:52Z"}, "message": "Remove unicase dependency", "tree": {"sha": "5e34d8f684d35cf4e01d7f2b483ac242cfee7cb2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5e34d8f684d35cf4e01d7f2b483ac242cfee7cb2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/039f2039a4ec06c8e52734190ceaf43a21de5e39", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/039f2039a4ec06c8e52734190ceaf43a21de5e39", "html_url": "https://github.com/rust-lang/rust/commit/039f2039a4ec06c8e52734190ceaf43a21de5e39", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/039f2039a4ec06c8e52734190ceaf43a21de5e39/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b643ccfaeda59f642a19d87e780976b3536d7b33", "url": "https://api.github.com/repos/rust-lang/rust/commits/b643ccfaeda59f642a19d87e780976b3536d7b33", "html_url": "https://github.com/rust-lang/rust/commit/b643ccfaeda59f642a19d87e780976b3536d7b33"}], "stats": {"total": 37, "additions": 13, "deletions": 24}, "files": [{"sha": "e7b87307698bd6bc0552ead8366a332e097b3512", "filename": "Cargo.lock", "status": "modified", "additions": 0, "deletions": 16, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/039f2039a4ec06c8e52734190ceaf43a21de5e39/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/039f2039a4ec06c8e52734190ceaf43a21de5e39/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=039f2039a4ec06c8e52734190ceaf43a21de5e39", "patch": "@@ -1087,7 +1087,6 @@ dependencies = [\n  \"rustc-hash\",\n  \"superslice\",\n  \"test_utils\",\n- \"unicase\",\n ]\n \n [[package]]\n@@ -1598,15 +1597,6 @@ dependencies = [\n  \"num_cpus\",\n ]\n \n-[[package]]\n-name = \"unicase\"\n-version = \"2.6.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"50f37be617794602aabbeee0be4f259dc1778fabe05e2d67ee8f79326d5cb4f6\"\n-dependencies = [\n- \"version_check\",\n-]\n-\n [[package]]\n name = \"unicode-bidi\"\n version = \"0.3.4\"\n@@ -1649,12 +1639,6 @@ dependencies = [\n  \"serde\",\n ]\n \n-[[package]]\n-name = \"version_check\"\n-version = \"0.9.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"078775d0255232fb988e6fccf26ddc9d1ac274299aaedcedce21c6f72cc533ce\"\n-\n [[package]]\n name = \"walkdir\"\n version = \"2.3.1\""}, {"sha": "dbe98f3a0dc4262b0bfbc2cfb0411f38a0cdf341", "filename": "crates/ra_ide_db/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/039f2039a4ec06c8e52734190ceaf43a21de5e39/crates%2Fra_ide_db%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/039f2039a4ec06c8e52734190ceaf43a21de5e39/crates%2Fra_ide_db%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_db%2FCargo.toml?ref=039f2039a4ec06c8e52734190ceaf43a21de5e39", "patch": "@@ -20,7 +20,6 @@ log = \"0.4.5\"\n rayon = \"1.0.2\"\n fst = { version = \"0.3.1\", default-features = false }\n rustc-hash = \"1.0\"\n-unicase = \"2.2.0\"\n superslice = \"1.0.0\"\n once_cell = \"1.2.0\"\n "}, {"sha": "e6b3126b6469990c228b3488328fb5fa090168be", "filename": "crates/ra_ide_db/src/symbol_index.rs", "status": "modified", "additions": 13, "deletions": 7, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/039f2039a4ec06c8e52734190ceaf43a21de5e39/crates%2Fra_ide_db%2Fsrc%2Fsymbol_index.rs", "raw_url": "https://github.com/rust-lang/rust/raw/039f2039a4ec06c8e52734190ceaf43a21de5e39/crates%2Fra_ide_db%2Fsrc%2Fsymbol_index.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_db%2Fsrc%2Fsymbol_index.rs?ref=039f2039a4ec06c8e52734190ceaf43a21de5e39", "patch": "@@ -21,6 +21,7 @@\n //! those FSTs.\n \n use std::{\n+    cmp::Ordering,\n     fmt,\n     hash::{Hash, Hasher},\n     mem,\n@@ -187,29 +188,34 @@ impl Hash for SymbolIndex {\n \n impl SymbolIndex {\n     fn new(mut symbols: Vec<FileSymbol>) -> SymbolIndex {\n-        fn cmp_key<'a>(s1: &'a FileSymbol) -> impl Ord + 'a {\n-            unicase::Ascii::new(s1.name.as_str())\n+        fn cmp(lhs: &FileSymbol, rhs: &FileSymbol) -> Ordering {\n+            let lhs_chars = lhs.name.chars().map(|c| c.to_ascii_lowercase());\n+            let rhs_chars = rhs.name.chars().map(|c| c.to_ascii_lowercase());\n+            lhs_chars.cmp(rhs_chars)\n         }\n+\n         #[cfg(not(feature = \"wasm\"))]\n-        symbols.par_sort_by(|s1, s2| cmp_key(s1).cmp(&cmp_key(s2)));\n+        symbols.par_sort_by(cmp);\n \n         #[cfg(feature = \"wasm\")]\n-        symbols.sort_by(|s1, s2| cmp_key(s1).cmp(&cmp_key(s2)));\n+        symbols.sort_by(cmp);\n \n         let mut builder = fst::MapBuilder::memory();\n \n         let mut last_batch_start = 0;\n \n         for idx in 0..symbols.len() {\n-            if symbols.get(last_batch_start).map(cmp_key) == symbols.get(idx + 1).map(cmp_key) {\n-                continue;\n+            if let Some(next_symbol) = symbols.get(idx + 1) {\n+                if cmp(&symbols[last_batch_start], next_symbol) == Ordering::Equal {\n+                    continue;\n+                }\n             }\n \n             let start = last_batch_start;\n             let end = idx + 1;\n             last_batch_start = end;\n \n-            let key = symbols[start].name.as_str().to_lowercase();\n+            let key = symbols[start].name.as_str().to_ascii_lowercase();\n             let value = SymbolIndex::range_to_map_value(start, end);\n \n             builder.insert(key, value).unwrap();"}]}