{"sha": "953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk1M2Y2ZWNiNmFkYzM3YjRmOGU1MjEwMmMxZTdjYTg2Y2M1YmM5MmM=", "commit": {"author": {"name": "Mikhail Babenko", "email": "misha-babenko@yandex.ru", "date": "2020-02-07T20:38:13Z"}, "committer": {"name": "Mikhail Babenko", "email": "misha-babenko@yandex.ru", "date": "2020-02-07T22:12:41Z"}, "message": "fix lifetime shadowing check in GATs", "tree": {"sha": "dae3bce70bee2737d3e837c6a2375dbb05715037", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dae3bce70bee2737d3e837c6a2375dbb05715037"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c", "html_url": "https://github.com/rust-lang/rust/commit/953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c/comments", "author": {"login": "basil-cow", "id": 25266609, "node_id": "MDQ6VXNlcjI1MjY2NjA5", "avatar_url": "https://avatars.githubusercontent.com/u/25266609?v=4", "gravatar_id": "", "url": "https://api.github.com/users/basil-cow", "html_url": "https://github.com/basil-cow", "followers_url": "https://api.github.com/users/basil-cow/followers", "following_url": "https://api.github.com/users/basil-cow/following{/other_user}", "gists_url": "https://api.github.com/users/basil-cow/gists{/gist_id}", "starred_url": "https://api.github.com/users/basil-cow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/basil-cow/subscriptions", "organizations_url": "https://api.github.com/users/basil-cow/orgs", "repos_url": "https://api.github.com/users/basil-cow/repos", "events_url": "https://api.github.com/users/basil-cow/events{/privacy}", "received_events_url": "https://api.github.com/users/basil-cow/received_events", "type": "User", "site_admin": false}, "committer": {"login": "basil-cow", "id": 25266609, "node_id": "MDQ6VXNlcjI1MjY2NjA5", "avatar_url": "https://avatars.githubusercontent.com/u/25266609?v=4", "gravatar_id": "", "url": "https://api.github.com/users/basil-cow", "html_url": "https://github.com/basil-cow", "followers_url": "https://api.github.com/users/basil-cow/followers", "following_url": "https://api.github.com/users/basil-cow/following{/other_user}", "gists_url": "https://api.github.com/users/basil-cow/gists{/gist_id}", "starred_url": "https://api.github.com/users/basil-cow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/basil-cow/subscriptions", "organizations_url": "https://api.github.com/users/basil-cow/orgs", "repos_url": "https://api.github.com/users/basil-cow/repos", "events_url": "https://api.github.com/users/basil-cow/events{/privacy}", "received_events_url": "https://api.github.com/users/basil-cow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b5e21dbb5cabdaaadc47a4d8e3f59979dcad2871", "url": "https://api.github.com/repos/rust-lang/rust/commits/b5e21dbb5cabdaaadc47a4d8e3f59979dcad2871", "html_url": "https://github.com/rust-lang/rust/commit/b5e21dbb5cabdaaadc47a4d8e3f59979dcad2871"}], "stats": {"total": 31, "additions": 25, "deletions": 6}, "files": [{"sha": "c527d6050cabc8998f06b92e1908ab2a72283ae9", "filename": "src/librustc_resolve/lifetimes.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c/src%2Flibrustc_resolve%2Flifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c/src%2Flibrustc_resolve%2Flifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flifetimes.rs?ref=953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c", "patch": "@@ -747,7 +747,8 @@ impl<'a, 'tcx> Visitor<'tcx> for LifetimeContext<'a, 'tcx> {\n                     track_lifetime_uses: true,\n                     opaque_type_parent: true,\n                 };\n-                self.with(scope, |_old_scope, this| {\n+                self.with(scope, |old_scope, this| {\n+                    this.check_lifetime_params(old_scope, &generics.params);\n                     this.visit_generics(generics);\n                     for bound in bounds {\n                         this.visit_param_bound(bound);\n@@ -804,7 +805,8 @@ impl<'a, 'tcx> Visitor<'tcx> for LifetimeContext<'a, 'tcx> {\n                     track_lifetime_uses: true,\n                     opaque_type_parent: true,\n                 };\n-                self.with(scope, |_old_scope, this| {\n+                self.with(scope, |old_scope, this| {\n+                    this.check_lifetime_params(old_scope, &generics.params);\n                     this.visit_generics(generics);\n                     this.visit_ty(ty);\n                 });"}, {"sha": "5c308948bd3f87d2574713b0a53362618442172a", "filename": "src/test/ui/generic-associated-types/shadowing.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fshadowing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fshadowing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fshadowing.rs?ref=953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c", "patch": "@@ -2,17 +2,17 @@\n #![feature(generic_associated_types)]\n \n trait Shadow<'a> {\n-    //FIXME(#44265): The lifetime parameter shadowing should cause an error.\n     type Bar<'a>;\n+    //~^ ERROR lifetime name `'a` shadows a lifetime name that is already in scope\n }\n \n trait NoShadow<'a> {\n     type Bar<'b>; // OK\n }\n \n impl<'a> NoShadow<'a> for &'a u32 {\n-    //FIXME(#44265): The lifetime parameter shadowing should cause an error.\n     type Bar<'a> = i32;\n+    //~^ ERROR lifetime name `'a` shadows a lifetime name that is already in scope\n }\n \n trait ShadowT<T> {"}, {"sha": "1cb6f071f3a19457ffbc8d222ce96bfb95bdc03d", "filename": "src/test/ui/generic-associated-types/shadowing.stderr", "status": "modified", "additions": 19, "deletions": 2, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fshadowing.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fshadowing.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fshadowing.stderr?ref=953f6ecb6adc37b4f8e52102c1e7ca86cc5bc92c", "patch": "@@ -14,6 +14,22 @@ LL | impl<T> NoShadowT<T> for Option<T> {\n LL |     type Bar<T> = i32;\n    |              ^ already used\n \n+error[E0496]: lifetime name `'a` shadows a lifetime name that is already in scope\n+  --> $DIR/shadowing.rs:5:14\n+   |\n+LL | trait Shadow<'a> {\n+   |              -- first declared here\n+LL |     type Bar<'a>;\n+   |              ^^ lifetime 'a already in scope\n+\n+error[E0496]: lifetime name `'a` shadows a lifetime name that is already in scope\n+  --> $DIR/shadowing.rs:14:14\n+   |\n+LL | impl<'a> NoShadow<'a> for &'a u32 {\n+   |      -- first declared here\n+LL |     type Bar<'a> = i32;\n+   |              ^^ lifetime 'a already in scope\n+\n error: type-generic associated types are not yet implemented\n   --> $DIR/shadowing.rs:19:5\n    |\n@@ -30,6 +46,7 @@ LL |     type Bar<U>; // OK\n    |\n    = note: for more information, see https://github.com/rust-lang/rust/issues/44265\n \n-error: aborting due to 4 previous errors\n+error: aborting due to 6 previous errors\n \n-For more information about this error, try `rustc --explain E0403`.\n+Some errors have detailed explanations: E0403, E0496.\n+For more information about an error, try `rustc --explain E0403`."}]}