{"sha": "8e998c4aa79aab1fa0041bbc929f36b82a6c3aeb", "node_id": "C_kwDOAAsO6NoAKDhlOTk4YzRhYTc5YWFiMWZhMDA0MWJiYzkyOWYzNmI4MmE2YzNhZWI", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2023-02-03T09:38:38Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2023-02-03T09:38:38Z"}, "message": "Fail spawning proc-macro servers when their api version is newer than r-a's", "tree": {"sha": "2d1ce5d3e49ef25871a29c5cdbb3c0140b800d6d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2d1ce5d3e49ef25871a29c5cdbb3c0140b800d6d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8e998c4aa79aab1fa0041bbc929f36b82a6c3aeb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8e998c4aa79aab1fa0041bbc929f36b82a6c3aeb", "html_url": "https://github.com/rust-lang/rust/commit/8e998c4aa79aab1fa0041bbc929f36b82a6c3aeb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8e998c4aa79aab1fa0041bbc929f36b82a6c3aeb/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c40b0895f09777be72bb6e875c1c0aefb9ccf316", "url": "https://api.github.com/repos/rust-lang/rust/commits/c40b0895f09777be72bb6e875c1c0aefb9ccf316", "html_url": "https://github.com/rust-lang/rust/commit/c40b0895f09777be72bb6e875c1c0aefb9ccf316"}], "stats": {"total": 13, "additions": 10, "deletions": 3}, "files": [{"sha": "4040efe93f093fad5bd84dbc4f53c4ce076c5ff4", "filename": "crates/proc-macro-api/src/msg.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8e998c4aa79aab1fa0041bbc929f36b82a6c3aeb/crates%2Fproc-macro-api%2Fsrc%2Fmsg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e998c4aa79aab1fa0041bbc929f36b82a6c3aeb/crates%2Fproc-macro-api%2Fsrc%2Fmsg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fproc-macro-api%2Fsrc%2Fmsg.rs?ref=8e998c4aa79aab1fa0041bbc929f36b82a6c3aeb", "patch": "@@ -13,7 +13,7 @@ use crate::ProcMacroKind;\n pub use crate::msg::flat::FlatTree;\n \n pub const NO_VERSION_CHECK_VERSION: u32 = 0;\n-pub const API_VERSION: u32 = 1;\n+pub const CURRENT_API_VERSION: u32 = 1;\n \n #[derive(Debug, Serialize, Deserialize)]\n pub enum Request {"}, {"sha": "e70b3850d667d010d15eaaead5ce7c2ed68777d6", "filename": "crates/proc-macro-api/src/process.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/8e998c4aa79aab1fa0041bbc929f36b82a6c3aeb/crates%2Fproc-macro-api%2Fsrc%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e998c4aa79aab1fa0041bbc929f36b82a6c3aeb/crates%2Fproc-macro-api%2Fsrc%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fproc-macro-api%2Fsrc%2Fprocess.rs?ref=8e998c4aa79aab1fa0041bbc929f36b82a6c3aeb", "patch": "@@ -10,7 +10,7 @@ use paths::{AbsPath, AbsPathBuf};\n use stdx::JodChild;\n \n use crate::{\n-    msg::{Message, Request, Response},\n+    msg::{Message, Request, Response, CURRENT_API_VERSION},\n     ProcMacroKind, ServerError,\n };\n \n@@ -36,6 +36,13 @@ impl ProcMacroProcessSrv {\n         let mut srv = create_srv()?;\n         tracing::info!(\"sending version check\");\n         match srv.version_check() {\n+            Ok(v) if v > CURRENT_API_VERSION => Err(io::Error::new(\n+                io::ErrorKind::Other,\n+                format!(\n+                    \"proc-macro server's api version ({}) is newer than rust-analyzer's ({})\",\n+                    v, CURRENT_API_VERSION\n+                ),\n+            )),\n             Ok(v) => {\n                 tracing::info!(\"got version {v}\");\n                 srv.version = v;"}, {"sha": "05168feb629f2fc9ec05bbe58f2f8c40abcc7670", "filename": "crates/proc-macro-srv/src/cli.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8e998c4aa79aab1fa0041bbc929f36b82a6c3aeb/crates%2Fproc-macro-srv%2Fsrc%2Fcli.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e998c4aa79aab1fa0041bbc929f36b82a6c3aeb/crates%2Fproc-macro-srv%2Fsrc%2Fcli.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fproc-macro-srv%2Fsrc%2Fcli.rs?ref=8e998c4aa79aab1fa0041bbc929f36b82a6c3aeb", "patch": "@@ -16,7 +16,7 @@ pub fn run() -> io::Result<()> {\n             }\n             msg::Request::ExpandMacro(task) => msg::Response::ExpandMacro(srv.expand(task)),\n             msg::Request::ApiVersionCheck {} => {\n-                msg::Response::ApiVersionCheck(proc_macro_api::msg::API_VERSION)\n+                msg::Response::ApiVersionCheck(proc_macro_api::msg::CURRENT_API_VERSION)\n             }\n         };\n         write_response(res)?"}]}