{"sha": "c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMwY2RmZDI5NmUxZWYyZWY4YTkwNzY4NTZkMGIxYjgwZjA4YzY1NGQ=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2019-08-03T06:01:27Z"}, "committer": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2019-08-03T06:08:00Z"}, "message": "Doctests: Enable running doc tests for perf lints\n\nThis should be possible to merge independently of #4325\n\ncc #4319", "tree": {"sha": "8691c50dbf215838c09b5a4f6cdc9e4dfe12d910", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8691c50dbf215838c09b5a4f6cdc9e4dfe12d910"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJEBAABCgAuFiEEj4U0bmbiMSg/mWqvgqphyqETl+YFAl1FJQUQHGRldkBwaGFu\nc2NoLm5ldAAKCRCCqmHKoROX5tB1D/0Y9TeVkdAFBLp69ahGcD7LtanFw8AJSWSo\nD/PoH/ftVR+ML+GxzIlTd2D/oL64fkIP3+mELutkZBeIlRmUp1yzUeFmkQoqiKA/\ngLaClXCskTBDUsSdV/Lpf8J3zS/BiUy3welStQMTyg539b8EF/b/p2aTY99msVsV\nFHovtY9+xeIbsM27epPlm9m97+zLlGU5HpsH4JoHc99owJ6Uc+ntGGMw90+KnnsK\nDRtmuodTn9PAKzyUPT9w/b6Pr0ThN3cqpzMl7/VWEjKLErFijEHpE9xJsMf60IW8\n9xa7TRqkfIEorkAQDPPLDU1tF4j6BHtU4/O2ICH0GrIau/+I+OBdGKrC6OKoAAYM\nQEjDvoT6ecSmSevWWpw0rSm7k5HM8V1hilan97W9VUGigoNHBT59HAc5mOPIEN+f\n1DlECuAgksjugVXVyz3OcPwikNXnPJ3CxLyQKhmKJo0MMpGpap4iyL/Zhpl6aF7R\nl3DJO8S0mHsMkRQ34i4sS9J8+ZToMsTAKT6LErOMHFaZNQZeM/NX1vw432abW2wQ\nuXMwKSILUxpTW4TggByAeW9qaAupHkmjanCAh4ojBue/hTvrKhZHz3xXvXmmPCfM\nUSQvyYNxFj1mOYF9FXDobscJVaqqV1lFPGSU3Iu26YvBMOTdIc0N95HJrnqTU1kG\ny+8b7bbdbQ==\n=i8S+\n-----END PGP SIGNATURE-----", "payload": "tree 8691c50dbf215838c09b5a4f6cdc9e4dfe12d910\nparent 18a7dce4dac18728e03668e17fb685f43954751a\nauthor Philipp Hansch <dev@phansch.net> 1564812087 +0200\ncommitter Philipp Hansch <dev@phansch.net> 1564812480 +0200\n\nDoctests: Enable running doc tests for perf lints\n\nThis should be possible to merge independently of #4325\n\ncc #4319\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d", "html_url": "https://github.com/rust-lang/rust/commit/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "18a7dce4dac18728e03668e17fb685f43954751a", "url": "https://api.github.com/repos/rust-lang/rust/commits/18a7dce4dac18728e03668e17fb685f43954751a", "html_url": "https://github.com/rust-lang/rust/commit/18a7dce4dac18728e03668e17fb685f43954751a"}], "stats": {"total": 97, "additions": 65, "deletions": 32}, "files": [{"sha": "ab9cf951261748c0a6d816c55a4b08cf9e53b02b", "filename": "clippy_lints/src/bytecount.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Fbytecount.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Fbytecount.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fbytecount.rs?ref=c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d", "patch": "@@ -24,7 +24,8 @@ declare_clippy_lint! {\n     /// **Example:**\n     ///\n     /// ```rust\n-    /// &my_data.filter(|&x| x == 0u8).count() // use bytecount::count instead\n+    /// # let vec = vec![1_u8];\n+    /// &vec.iter().filter(|x| **x == 0u8).count(); // use bytecount::count instead\n     /// ```\n     pub NAIVE_BYTECOUNT,\n     perf,"}, {"sha": "e6b09f89b3530192962ae587c9653150325e0867", "filename": "clippy_lints/src/entry.rs", "status": "modified", "additions": 18, "deletions": 7, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Fentry.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Fentry.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fentry.rs?ref=c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d", "patch": "@@ -16,21 +16,32 @@ declare_clippy_lint! {\n     ///\n     /// **Known problems:** Some false negatives, eg.:\n     /// ```rust\n-    /// let k = &key;\n-    /// if !m.contains_key(k) {\n-    ///     m.insert(k.clone(), v);\n+    /// # use std::collections::HashMap;\n+    /// # let mut map = HashMap::new();\n+    /// # let v = 1;\n+    /// # let k = 1;\n+    /// if !map.contains_key(&k) {\n+    ///     map.insert(k.clone(), v);\n     /// }\n     /// ```\n     ///\n     /// **Example:**\n     /// ```rust\n-    /// if !m.contains_key(&k) {\n-    ///     m.insert(k, v)\n+    /// # use std::collections::HashMap;\n+    /// # let mut map = HashMap::new();\n+    /// # let k = 1;\n+    /// # let v = 1;\n+    /// if !map.contains_key(&k) {\n+    ///     map.insert(k, v);\n     /// }\n     /// ```\n-    /// can be rewritten as:\n+    /// can both be rewritten as:\n     /// ```rust\n-    /// m.entry(k).or_insert(v);\n+    /// # use std::collections::HashMap;\n+    /// # let mut map = HashMap::new();\n+    /// # let k = 1;\n+    /// # let v = 1;\n+    /// map.entry(k).or_insert(v);\n     /// ```\n     pub MAP_ENTRY,\n     perf,"}, {"sha": "c37efbd6e49dafe17f6a6072781f850c91c2247e", "filename": "clippy_lints/src/escape.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Fescape.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Fescape.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fescape.rs?ref=c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d", "patch": "@@ -28,11 +28,10 @@ declare_clippy_lint! {\n     ///\n     /// **Example:**\n     /// ```rust\n-    /// fn main() {\n-    ///     let x = Box::new(1);\n-    ///     foo(*x);\n-    ///     println!(\"{}\", *x);\n-    /// }\n+    /// # fn foo(bar: usize) {}\n+    /// let x = Box::new(1);\n+    /// foo(*x);\n+    /// println!(\"{}\", *x);\n     /// ```\n     pub BOXED_LOCAL,\n     perf,"}, {"sha": "8a29e187e4e50f77abf4afbe755af1cc2868eed5", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d", "patch": "@@ -105,7 +105,7 @@ macro_rules! declare_clippy_lint {\n     };\n     { $(#[$attr:meta])* pub $name:tt, perf, $description:tt } => {\n         declare_tool_lint! {\n-            pub clippy::$name, Warn, $description, report_in_external_macro: true\n+            $(#[$attr])* pub clippy::$name, Warn, $description, report_in_external_macro: true\n         }\n     };\n     { $(#[$attr:meta])* pub $name:tt, pedantic, $description:tt } => {\n@@ -120,7 +120,7 @@ macro_rules! declare_clippy_lint {\n     };\n     { $(#[$attr:meta])* pub $name:tt, cargo, $description:tt } => {\n         declare_tool_lint! {\n-            pub clippy::$name, Allow, $description, report_in_external_macro: true\n+            $(#[$attr])* pub clippy::$name, Allow, $description, report_in_external_macro: true\n         }\n     };\n     { $(#[$attr:meta])* pub $name:tt, nursery, $description:tt } => {"}, {"sha": "940da9b3fadc2ecb25ea74342aa30490591c9c4b", "filename": "clippy_lints/src/loops.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Floops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Floops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops.rs?ref=c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d", "patch": "@@ -41,7 +41,9 @@ declare_clippy_lint! {\n     /// **Known problems:** None.\n     ///\n     /// **Example:**\n-    /// ```ignore\n+    /// ```rust\n+    /// # let src = vec![1];\n+    /// # let mut dst = vec![0; 65];\n     /// for i in 0..src.len() {\n     ///     dst[i + 64] = src[i];\n     /// }\n@@ -264,8 +266,9 @@ declare_clippy_lint! {\n     /// None\n     ///\n     /// **Example:**\n-    /// ```ignore\n-    /// let len = iterator.collect::<Vec<_>>().len();\n+    /// ```rust\n+    /// # let iterator = vec![1].into_iter();\n+    /// let len = iterator.clone().collect::<Vec<_>>().len();\n     /// // should be\n     /// let len = iterator.count();\n     /// ```"}, {"sha": "8ae08f584b9c3170f0411f2de12297be19d8aa8d", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 18, "deletions": 6, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d", "patch": "@@ -383,15 +383,18 @@ declare_clippy_lint! {\n     ///\n     /// **Example:**\n     /// ```rust\n-    /// foo.unwrap_or(String::new())\n+    /// # let foo = Some(String::new());\n+    /// foo.unwrap_or(String::new());\n     /// ```\n     /// this can instead be written:\n     /// ```rust\n-    /// foo.unwrap_or_else(String::new)\n+    /// # let foo = Some(String::new());\n+    /// foo.unwrap_or_else(String::new);\n     /// ```\n     /// or\n     /// ```rust\n-    /// foo.unwrap_or_default()\n+    /// # let foo = Some(String::new());\n+    /// foo.unwrap_or_default();\n     /// ```\n     pub OR_FUN_CALL,\n     perf,\n@@ -409,15 +412,24 @@ declare_clippy_lint! {\n     ///\n     /// **Example:**\n     /// ```rust\n-    /// foo.expect(&format!(\"Err {}: {}\", err_code, err_msg))\n+    /// # let foo = Some(String::new());\n+    /// # let err_code = \"418\";\n+    /// # let err_msg = \"I'm a teapot\";\n+    /// foo.expect(&format!(\"Err {}: {}\", err_code, err_msg));\n     /// ```\n     /// or\n     /// ```rust\n-    /// foo.expect(format!(\"Err {}: {}\", err_code, err_msg).as_str())\n+    /// # let foo = Some(String::new());\n+    /// # let err_code = \"418\";\n+    /// # let err_msg = \"I'm a teapot\";\n+    /// foo.expect(format!(\"Err {}: {}\", err_code, err_msg).as_str());\n     /// ```\n     /// this can instead be written:\n     /// ```rust\n-    /// foo.unwrap_or_else(|_| panic!(\"Err {}: {}\", err_code, err_msg))\n+    /// # let foo = Some(String::new());\n+    /// # let err_code = \"418\";\n+    /// # let err_msg = \"I'm a teapot\";\n+    /// foo.unwrap_or_else(|| panic!(\"Err {}: {}\", err_code, err_msg));\n     /// ```\n     pub EXPECT_FUN_CALL,\n     perf,"}, {"sha": "ae339021a7e7fefad91628e755e04caf4e0d3efa", "filename": "clippy_lints/src/misc.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Fmisc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Fmisc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmisc.rs?ref=c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d", "patch": "@@ -101,7 +101,9 @@ declare_clippy_lint! {\n     ///\n     /// **Example:**\n     /// ```rust\n-    /// x.to_owned() == y\n+    /// # let x = \"foo\";\n+    /// # let y = String::from(\"foo\");\n+    /// if x.to_owned() == y {}\n     /// ```\n     pub CMP_OWNED,\n     perf,"}, {"sha": "bf76e0ff369aabf8b752d03dfa991f2e378c52ec", "filename": "clippy_lints/src/mutex_atomic.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Fmutex_atomic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Fmutex_atomic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmutex_atomic.rs?ref=c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d", "patch": "@@ -22,6 +22,8 @@ declare_clippy_lint! {\n     ///\n     /// **Example:**\n     /// ```rust\n+    /// # use std::sync::Mutex;\n+    /// # let y = 1;\n     /// let x = Mutex::new(&y);\n     /// ```\n     pub MUTEX_ATOMIC,"}, {"sha": "7e543bfe60f7239cd9ae184350b6506368a9d9aa", "filename": "clippy_lints/src/slow_vector_initialization.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Fslow_vector_initialization.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Fslow_vector_initialization.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fslow_vector_initialization.rs?ref=c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d", "patch": "@@ -19,6 +19,8 @@ declare_clippy_lint! {\n     ///\n     /// **Example:**\n     /// ```rust\n+    /// # use core::iter::repeat;\n+    /// # let len = 4;\n     /// let mut vec1 = Vec::with_capacity(len);\n     /// vec1.resize(len, 0);\n     ///"}, {"sha": "be79fc2fb81fb20852f92560659a80c1829656ca", "filename": "clippy_lints/src/trivially_copy_pass_by_ref.rs", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Ftrivially_copy_pass_by_ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d/clippy_lints%2Fsrc%2Ftrivially_copy_pass_by_ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftrivially_copy_pass_by_ref.rs?ref=c0cdfd296e1ef2ef8a9076856d0b1b80f08c654d", "patch": "@@ -39,14 +39,15 @@ declare_clippy_lint! {\n     /// each other.\n     ///\n     /// **Example:**\n+    ///\n+    /// ```rust\n+    /// // Bad\n+    /// fn foo(v: &u32) {}\n+    /// ```\n+    ///\n     /// ```rust\n-    /// fn foo(v: &u32) {\n-    ///     assert_eq!(v, 42);\n-    /// }\n-    /// // should be\n-    /// fn foo(v: u32) {\n-    ///     assert_eq!(v, 42);\n-    /// }\n+    /// // Better\n+    /// fn foo(v: u32) {}\n     /// ```\n     pub TRIVIALLY_COPY_PASS_BY_REF,\n     perf,"}]}