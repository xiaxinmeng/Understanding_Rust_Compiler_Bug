{"sha": "023e6c4be3785d0d8260b3c0d4fd87b88d9b48d9", "node_id": "C_kwDOAAsO6NoAKDAyM2U2YzRiZTM3ODVkMGQ4MjYwYjNjMGQ0ZmQ4N2I4OGQ5YjQ4ZDk", "commit": {"author": {"name": "Jakub Ber\u00e1nek", "email": "jakub.beranek@vsb.cz", "date": "2023-05-29T22:03:51Z"}, "committer": {"name": "Jakub Ber\u00e1nek", "email": "jakub.beranek@vsb.cz", "date": "2023-05-30T21:38:17Z"}, "message": "Add `--warnings warn` flag to `x.py`\n\nSo that bootstrap itself can be built with warnings not being treated as errors.", "tree": {"sha": "1b298c8f6557827949de25a829c76b7b5292865d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1b298c8f6557827949de25a829c76b7b5292865d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/023e6c4be3785d0d8260b3c0d4fd87b88d9b48d9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/023e6c4be3785d0d8260b3c0d4fd87b88d9b48d9", "html_url": "https://github.com/rust-lang/rust/commit/023e6c4be3785d0d8260b3c0d4fd87b88d9b48d9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/023e6c4be3785d0d8260b3c0d4fd87b88d9b48d9/comments", "author": {"login": "Kobzol", "id": 4539057, "node_id": "MDQ6VXNlcjQ1MzkwNTc=", "avatar_url": "https://avatars.githubusercontent.com/u/4539057?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kobzol", "html_url": "https://github.com/Kobzol", "followers_url": "https://api.github.com/users/Kobzol/followers", "following_url": "https://api.github.com/users/Kobzol/following{/other_user}", "gists_url": "https://api.github.com/users/Kobzol/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kobzol/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kobzol/subscriptions", "organizations_url": "https://api.github.com/users/Kobzol/orgs", "repos_url": "https://api.github.com/users/Kobzol/repos", "events_url": "https://api.github.com/users/Kobzol/events{/privacy}", "received_events_url": "https://api.github.com/users/Kobzol/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Kobzol", "id": 4539057, "node_id": "MDQ6VXNlcjQ1MzkwNTc=", "avatar_url": "https://avatars.githubusercontent.com/u/4539057?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Kobzol", "html_url": "https://github.com/Kobzol", "followers_url": "https://api.github.com/users/Kobzol/followers", "following_url": "https://api.github.com/users/Kobzol/following{/other_user}", "gists_url": "https://api.github.com/users/Kobzol/gists{/gist_id}", "starred_url": "https://api.github.com/users/Kobzol/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Kobzol/subscriptions", "organizations_url": "https://api.github.com/users/Kobzol/orgs", "repos_url": "https://api.github.com/users/Kobzol/repos", "events_url": "https://api.github.com/users/Kobzol/events{/privacy}", "received_events_url": "https://api.github.com/users/Kobzol/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "498553fc04f6a3fdc53412320f4e913bc53bc267", "url": "https://api.github.com/repos/rust-lang/rust/commits/498553fc04f6a3fdc53412320f4e913bc53bc267", "html_url": "https://github.com/rust-lang/rust/commit/498553fc04f6a3fdc53412320f4e913bc53bc267"}], "stats": {"total": 11, "additions": 8, "deletions": 3}, "files": [{"sha": "06c30842e173d0682bdbac4029506eb11b6d7a4c", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/023e6c4be3785d0d8260b3c0d4fd87b88d9b48d9/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/023e6c4be3785d0d8260b3c0d4fd87b88d9b48d9/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=023e6c4be3785d0d8260b3c0d4fd87b88d9b48d9", "patch": "@@ -835,7 +835,7 @@ def bootstrap_binary(self):\n         \"\"\"\n         return os.path.join(self.build_dir, \"bootstrap\", \"debug\", \"bootstrap\")\n \n-    def build_bootstrap(self, color, verbose_count):\n+    def build_bootstrap(self, color, warnings, verbose_count):\n         \"\"\"Build bootstrap\"\"\"\n         env = os.environ.copy()\n         if \"GITHUB_ACTIONS\" in env:\n@@ -888,7 +888,11 @@ def build_bootstrap(self, color, verbose_count):\n         if target_linker is not None:\n             env[\"RUSTFLAGS\"] += \" -C linker=\" + target_linker\n         env[\"RUSTFLAGS\"] += \" -Wrust_2018_idioms -Wunused_lifetimes\"\n-        if self.get_toml(\"deny-warnings\", \"rust\") != \"false\":\n+        if warnings == \"default\":\n+            deny_warnings = self.get_toml(\"deny-warnings\", \"rust\") != \"false\"\n+        else:\n+            deny_warnings = warnings == \"deny\"\n+        if deny_warnings:\n             env[\"RUSTFLAGS\"] += \" -Dwarnings\"\n \n         env[\"PATH\"] = os.path.join(self.bin_root(), \"bin\") + \\\n@@ -977,6 +981,7 @@ def parse_args():\n     parser.add_argument('--color', choices=['always', 'never', 'auto'])\n     parser.add_argument('--clean', action='store_true')\n     parser.add_argument('--json-output', action='store_true')\n+    parser.add_argument('--warnings', choices=['deny', 'warn', 'default'], default='default')\n     parser.add_argument('-v', '--verbose', action='count', default=0)\n \n     return parser.parse_known_args(sys.argv)[0]\n@@ -1042,7 +1047,7 @@ def bootstrap(args):\n     # Fetch/build the bootstrap\n     build.download_toolchain()\n     sys.stdout.flush()\n-    build.build_bootstrap(args.color, verbose_count)\n+    build.build_bootstrap(args.color, args.warnings, verbose_count)\n     sys.stdout.flush()\n \n     # Run the bootstrap"}]}