{"sha": "3ed6caae60794c6fade76486b2fbe2a173eb1943", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNlZDZjYWFlNjA3OTRjNmZhZGU3NjQ4NmIyZmJlMmExNzNlYjE5NDM=", "commit": {"author": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2021-01-07T16:43:21Z"}, "committer": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2021-01-09T19:54:14Z"}, "message": "Synthesize a `TokenStream` for `StmtKind::Empty`\n\nFixes #80760", "tree": {"sha": "c4f13443ed94774b76ddd7e54ee86f4e94e86d64", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c4f13443ed94774b76ddd7e54ee86f4e94e86d64"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3ed6caae60794c6fade76486b2fbe2a173eb1943", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7J9Gc3TfBwj2K399tAh+UQ6YsWQFAl/6CecACgkQtAh+UQ6Y\nsWQCiw//ZxEkXKBDitI65vxLji2YUAhkATR6eBlHWv5Liqbg+WR8D4NEFpTrcFrI\npZ51FE6KABtvIScl9OEOhnfI8LqAtPizlN0jEZg6vPVf8Jn/yauYm78/VMAz/HA6\nA+rhOginGFp2oaStCRxZktWT6io+WFAFbbppBSx8FyPVUkDpEQPfE87kvh8R4Jnl\nIBO12kp9A/9VqfzqV6IyFwKWPiEZNJGsmA7ztbEnn1LHivYiIBVaCdlni2oI8Ww0\nJ94a3M8PxDqPGNuOC4aIS9jMXwWy3A8IBCTWCMn2KoEgr3BG3UevxQbK8w/RiT81\nTRLT8AtkP3UuOgZ5tiH6ntHw+SrBsN7NSBF5gcgdbTYdiewFrWcOqKlMCrx5lXJN\nZeR7kjzDRd+gvS0fXGpTaZpQaG69DNzHA511Y7Rmi+W4w3Fe/UBVphdWU7CG+p6C\nG4FkYm+g+fUpDDuPsRGA3AbomiWfKUjPmxO8b5KBgW5DML+Llz28heMfAX9K7+vh\n5YmVFR9Dbgalm0OOU+AyOWmsFa1OsNRRqcFDXn5tdQCxeHcWBzz+aqxGUQCHXZ90\nrFa0ULruRsQr1uvES3+74ZB/GumB6bwtBI1860/mgntFKAhjGciKNGfuWeNrGjNs\n3XT5vx/1/M/fNz9LyX+9eoF+8TgSZ9mr0dpvEiEiIVNqAEVhCIE=\n=X26q\n-----END PGP SIGNATURE-----", "payload": "tree c4f13443ed94774b76ddd7e54ee86f4e94e86d64\nparent c8915eebeaaef9f7cc1cff6ffd97f578b03c2ac9\nauthor Aaron Hill <aa1ronham@gmail.com> 1610037801 -0500\ncommitter Aaron Hill <aa1ronham@gmail.com> 1610222054 -0500\n\nSynthesize a `TokenStream` for `StmtKind::Empty`\n\nFixes #80760\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3ed6caae60794c6fade76486b2fbe2a173eb1943", "html_url": "https://github.com/rust-lang/rust/commit/3ed6caae60794c6fade76486b2fbe2a173eb1943", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3ed6caae60794c6fade76486b2fbe2a173eb1943/comments", "author": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c8915eebeaaef9f7cc1cff6ffd97f578b03c2ac9", "url": "https://api.github.com/repos/rust-lang/rust/commits/c8915eebeaaef9f7cc1cff6ffd97f578b03c2ac9", "html_url": "https://github.com/rust-lang/rust/commit/c8915eebeaaef9f7cc1cff6ffd97f578b03c2ac9"}], "stats": {"total": 51, "additions": 50, "deletions": 1}, "files": [{"sha": "19504e5f2722c1f435ddbe75d6dc0c9dc813fe97", "filename": "compiler/rustc_parse/src/lib.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/3ed6caae60794c6fade76486b2fbe2a173eb1943/compiler%2Frustc_parse%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ed6caae60794c6fade76486b2fbe2a173eb1943/compiler%2Frustc_parse%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Flib.rs?ref=3ed6caae60794c6fade76486b2fbe2a173eb1943", "patch": "@@ -257,7 +257,16 @@ pub fn nt_to_tokenstream(\n     let tokens = match *nt {\n         Nonterminal::NtItem(ref item) => prepend_attrs(sess, &item.attrs, nt, item.tokens.as_ref()),\n         Nonterminal::NtBlock(ref block) => convert_tokens(block.tokens.as_ref()),\n-        Nonterminal::NtStmt(ref stmt) => prepend_attrs(sess, stmt.attrs(), nt, stmt.tokens()),\n+        Nonterminal::NtStmt(ref stmt) => {\n+            let do_prepend = |tokens| prepend_attrs(sess, stmt.attrs(), nt, tokens);\n+            if let ast::StmtKind::Empty = stmt.kind {\n+                let tokens: TokenStream =\n+                    tokenstream::TokenTree::token(token::Semi, stmt.span).into();\n+                do_prepend(Some(&LazyTokenStream::new(tokens)))\n+            } else {\n+                do_prepend(stmt.tokens())\n+            }\n+        }\n         Nonterminal::NtPat(ref pat) => convert_tokens(pat.tokens.as_ref()),\n         Nonterminal::NtTy(ref ty) => convert_tokens(ty.tokens.as_ref()),\n         Nonterminal::NtIdent(ident, is_raw) => {"}, {"sha": "86865af0b5298c84ee94de2b23ffb378c60b8446", "filename": "src/test/ui/proc-macro/issue-80760-empty-stmt.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/3ed6caae60794c6fade76486b2fbe2a173eb1943/src%2Ftest%2Fui%2Fproc-macro%2Fissue-80760-empty-stmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ed6caae60794c6fade76486b2fbe2a173eb1943/src%2Ftest%2Fui%2Fproc-macro%2Fissue-80760-empty-stmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fissue-80760-empty-stmt.rs?ref=3ed6caae60794c6fade76486b2fbe2a173eb1943", "patch": "@@ -0,0 +1,26 @@\n+// check-pass\n+// aux-build:test-macros.rs\n+// compile-flags: -Z span-debug\n+\n+#![no_std] // Don't load unnecessary hygiene information from std\n+extern crate std;\n+\n+#[macro_use]\n+extern crate test_macros;\n+\n+macro_rules! empty_stmt {\n+    ($s:stmt) => {\n+        print_bang!($s);\n+\n+        // Currently, all attributes are ignored\n+        // on an empty statement\n+        #[print_attr]\n+        #[rustc_dummy(first)]\n+        #[rustc_dummy(second)]\n+        $s\n+    }\n+}\n+\n+fn main() {\n+    empty_stmt!(;);\n+}"}, {"sha": "4b7ed874307d8f6c65dc8ad6cfb139945c6e0876", "filename": "src/test/ui/proc-macro/issue-80760-empty-stmt.stdout", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/3ed6caae60794c6fade76486b2fbe2a173eb1943/src%2Ftest%2Fui%2Fproc-macro%2Fissue-80760-empty-stmt.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/3ed6caae60794c6fade76486b2fbe2a173eb1943/src%2Ftest%2Fui%2Fproc-macro%2Fissue-80760-empty-stmt.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fproc-macro%2Fissue-80760-empty-stmt.stdout?ref=3ed6caae60794c6fade76486b2fbe2a173eb1943", "patch": "@@ -0,0 +1,14 @@\n+PRINT-BANG INPUT (DISPLAY): ;\n+PRINT-BANG INPUT (DEBUG): TokenStream [\n+    Group {\n+        delimiter: None,\n+        stream: TokenStream [\n+            Punct {\n+                ch: ';',\n+                spacing: Alone,\n+                span: $DIR/issue-80760-empty-stmt.rs:25:17: 25:18 (#0),\n+            },\n+        ],\n+        span: $DIR/issue-80760-empty-stmt.rs:13:21: 13:23 (#4),\n+    },\n+]"}]}