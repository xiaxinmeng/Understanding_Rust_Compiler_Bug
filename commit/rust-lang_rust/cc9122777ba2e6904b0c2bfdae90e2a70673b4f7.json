{"sha": "cc9122777ba2e6904b0c2bfdae90e2a70673b4f7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNjOTEyMjc3N2JhMmU2OTA0YjBjMmJmZGFlOTBlMmE3MDY3M2I0Zjc=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-05-16T07:10:35Z"}, "committer": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-05-16T07:10:35Z"}, "message": "Add integration tests", "tree": {"sha": "0eed8cf2e04a5d25136141d4ea02b7b9c76bd488", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0eed8cf2e04a5d25136141d4ea02b7b9c76bd488"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cc9122777ba2e6904b0c2bfdae90e2a70673b4f7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIcBAABCAAGBQJa+9l1AAoJELb6Bqbg4mZb3N0P/RTA2fRxalUtzGeFAAq6k8ao\nasg2DICRyTUBgJFaH1BEu8cEkBx2Z73rViny9ODSU7FVtm3u3l6HTVPM8WzmUEL7\nm3vKOXrIkMHklfqTbWE2vZmp+Fw20Yl2pb3bk4khEKIxMtBp1BmBQmFwRg7cr7hD\nZwtZ+D3oU5fBf4FSD9SrdQWD9mNwYaXbEOKrAVyJGLZVd7jwUbcrLOWHuqBDPMCf\nWuHvdA28YHAtXW/pKSGAm1hZIzjibbMNXuaJbS1cO6agwPU1670nGtgqFAa4/wzg\nK+SVWBe+goB6UKo6oe8QVCboK3oeOelcpYwS7M2FbKv5+Ng8AGr85CyTW5O+AYj5\nSeB6ef31C4JLLTocwQAY8LRZWp1PHPYJwdqa345rafWi0I4gLhwKahWGSbjiLh5v\nfLlv4c2Csa/3HUgDJfkAW1pi4Bsbz7B7zZzl1oAkMjExPpLMQbWST9jL66e2n9DV\nDXgRvMjcHQPMeyCXHfwJxZmBvqug6NvzyCgBqVNGcPSviQJhGRk+3Kj961Mt3Oa2\nG2IjMVWDBx23uyc4L5LBZ3xSOBYMam6qIUyffpRE6N4ynCtLQ9PgrWTF1QEJGyoL\nbjZbQG5pQRkMK5HoZEyBWbIg+ksXHOmfLddRRnX1wGxynICQ+LxlMq8RMPlZW1nb\nOker4YH5pCGnbcE8C1PC\n=zJYi\n-----END PGP SIGNATURE-----", "payload": "tree 0eed8cf2e04a5d25136141d4ea02b7b9c76bd488\nparent 1af2f20da64121a1e90a70ff635cba439bfea6e1\nauthor Philipp Hansch <dev@phansch.net> 1526454635 +0200\ncommitter Philipp Hansch <dev@phansch.net> 1526454635 +0200\n\nAdd integration tests\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cc9122777ba2e6904b0c2bfdae90e2a70673b4f7", "html_url": "https://github.com/rust-lang/rust/commit/cc9122777ba2e6904b0c2bfdae90e2a70673b4f7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cc9122777ba2e6904b0c2bfdae90e2a70673b4f7/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1af2f20da64121a1e90a70ff635cba439bfea6e1", "url": "https://api.github.com/repos/rust-lang/rust/commits/1af2f20da64121a1e90a70ff635cba439bfea6e1", "html_url": "https://github.com/rust-lang/rust/commit/1af2f20da64121a1e90a70ff635cba439bfea6e1"}], "stats": {"total": 69, "additions": 53, "deletions": 16}, "files": [{"sha": "77dc8fc4b192e94d6850d9d7cde68a99dad85332", "filename": ".travis.yml", "status": "modified", "additions": 14, "deletions": 16, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/cc9122777ba2e6904b0c2bfdae90e2a70673b4f7/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/cc9122777ba2e6904b0c2bfdae90e2a70673b4f7/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=cc9122777ba2e6904b0c2bfdae90e2a70673b4f7", "patch": "@@ -29,23 +29,21 @@ install:\n   - nvm use stable\n   - npm install remark-cli remark-lint\n \n+matrix:\n+  include:\n+    - env: INTEGRATION=rust-lang/cargo\n+    - env: INTEGRATION=rust-lang-nursery/rand\n+  allow_failures:\n+    - env: INTEGRATION=rust-lang/cargo\n+    - env: INTEGRATION=rust-lang-nursery/rand\n+\n script:\n- - PATH=$PATH:./node_modules/.bin\n- - remark -f *.md > /dev/null\n- - set -e\n- - cargo build --features debugging\n- - cargo test --features debugging\n- - mkdir -p ~/rust/cargo/bin\n- - cp target/debug/cargo-clippy ~/rust/cargo/bin/cargo-clippy\n- - cp target/debug/clippy-driver ~/rust/cargo/bin/clippy-driver\n- - PATH=$PATH:~/rust/cargo/bin cargo clippy --all -- -D clippy\n- - cd clippy_workspace_tests && PATH=$PATH:~/rust/cargo/bin cargo clippy -- -D clippy && cd ..\n- - cd clippy_workspace_tests/src && PATH=$PATH:~/rust/cargo/bin cargo clippy -- -D clippy && cd ../..\n- - cd clippy_workspace_tests/subcrate && PATH=$PATH:~/rust/cargo/bin cargo clippy -- -D clippy && cd ../..\n- - cd clippy_workspace_tests/subcrate/src && PATH=$PATH:~/rust/cargo/bin cargo clippy -- -D clippy && cd ../../..\n- - PATH=$PATH:~/rust/cargo/bin cargo clippy --manifest-path=clippy_workspace_tests/Cargo.toml -- -D clippy\n- - cd clippy_workspace_tests/subcrate && PATH=$PATH:~/rust/cargo/bin cargo clippy --manifest-path=../Cargo.toml -- -D clippy && cd ../..\n- - set +e\n+  - |\n+    if [ -z ${INTEGRATION} ]; then\n+      ./ci/base-tests.sh\n+    else\n+      ./ci/integration-tests.sh\n+    fi\n \n after_success: |\n   #!/bin/bash"}, {"sha": "fc01ce05b3b673c5563e10dc0e1f0f791ac67291", "filename": "ci/base-tests.sh", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/cc9122777ba2e6904b0c2bfdae90e2a70673b4f7/ci%2Fbase-tests.sh", "raw_url": "https://github.com/rust-lang/rust/raw/cc9122777ba2e6904b0c2bfdae90e2a70673b4f7/ci%2Fbase-tests.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/ci%2Fbase-tests.sh?ref=cc9122777ba2e6904b0c2bfdae90e2a70673b4f7", "patch": "@@ -0,0 +1,15 @@\n+PATH=$PATH:./node_modules/.bin\n+remark -f *.md > /dev/null\n+set -e\n+cargo build --features debugging\n+cargo test --features debugging\n+mkdir -p ~/rust/cargo/bin\n+cp target/debug/cargo-clippy ~/rust/cargo/bin/cargo-clippy\n+cp target/debug/clippy-driver ~/rust/cargo/bin/clippy-driver\n+PATH=$PATH:~/rust/cargo/bin cargo clippy --all -- -D clippy\n+cd clippy_workspace_tests && PATH=$PATH:~/rust/cargo/bin cargo clippy -- -D clippy && cd ..\n+cd clippy_workspace_tests/src && PATH=$PATH:~/rust/cargo/bin cargo clippy -- -D clippy && cd ../..\n+cd clippy_workspace_tests/subcrate && PATH=$PATH:~/rust/cargo/bin cargo clippy -- -D clippy && cd ../..\n+cd clippy_workspace_tests/subcrate/src && PATH=$PATH:~/rust/cargo/bin cargo clippy -- -D clippy && cd ../../..\n+PATH=$PATH:~/rust/cargo/bin cargo clippy --manifest-path=clippy_workspace_tests/Cargo.toml -- -D clippy\n+cd clippy_workspace_tests/subcrate && PATH=$PATH:~/rust/cargo/bin cargo clippy --manifest-path=../Cargo.toml -- -D clippy && cd ../.."}, {"sha": "c6c2a4a4d58603f8f8fd2558731f8b3f0a046b5a", "filename": "ci/integration-tests.sh", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/cc9122777ba2e6904b0c2bfdae90e2a70673b4f7/ci%2Fintegration-tests.sh", "raw_url": "https://github.com/rust-lang/rust/raw/cc9122777ba2e6904b0c2bfdae90e2a70673b4f7/ci%2Fintegration-tests.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/ci%2Fintegration-tests.sh?ref=cc9122777ba2e6904b0c2bfdae90e2a70673b4f7", "patch": "@@ -0,0 +1,24 @@\n+cargo install --force\n+\n+echo \"Running integration test for crate ${INTEGRATION}\"\n+\n+git clone https://github.com/${INTEGRATION}.git\n+\n+function check() {\n+  cargo clippy --all &> clippy_output\n+  cat clippy_output\n+  ! cat clippy_output | grep -q \"internal error\"\n+  if [[ $? != 0 ]]; then\n+    return 1\n+  fi\n+}\n+\n+case ${INTEGRATION} in\n+  rust-lang/cargo)\n+    check\n+    ;;\n+  *)\n+    cd ${INTEGRATION}\n+    check\n+    ;;\n+esac"}]}