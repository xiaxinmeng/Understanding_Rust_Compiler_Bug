{"sha": "40bd145cbef28d279aacc903907c3945f83a6296", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQwYmQxNDVjYmVmMjhkMjc5YWFjYzkwMzkwN2MzOTQ1ZjgzYTYyOTY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-05-05T21:11:47Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-05-05T21:11:47Z"}, "message": "Auto merge of #60567 - Manishearth:rollup-rjagqnw, r=Manishearth\n\nRollup of 5 pull requests\n\nSuccessful merges:\n\n - #60131 (Fix broken link in rustc_plugin doc)\n - #60426 (Stop `-O`/`-C opt-level` and `-g`/`-C debuginfo` conflicting)\n - #60515 (use span instead of div for since version)\n - #60530 (rustc: rename all occurences of \"freevar\" to \"upvar\".)\n - #60536 (Correct code points to match their textual description)\n\nFailed merges:\n\nr? @ghost", "tree": {"sha": "482b6a07004b00963ca608ac27e1e6d4ed1bfde0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/482b6a07004b00963ca608ac27e1e6d4ed1bfde0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/40bd145cbef28d279aacc903907c3945f83a6296", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/40bd145cbef28d279aacc903907c3945f83a6296", "html_url": "https://github.com/rust-lang/rust/commit/40bd145cbef28d279aacc903907c3945f83a6296", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/40bd145cbef28d279aacc903907c3945f83a6296/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d628c2e642c6f8f85f24dd5d7f49de89b95bf682", "url": "https://api.github.com/repos/rust-lang/rust/commits/d628c2e642c6f8f85f24dd5d7f49de89b95bf682", "html_url": "https://github.com/rust-lang/rust/commit/d628c2e642c6f8f85f24dd5d7f49de89b95bf682"}, {"sha": "ff7ef116fbe4698f9df0370021d398dc345b832b", "url": "https://api.github.com/repos/rust-lang/rust/commits/ff7ef116fbe4698f9df0370021d398dc345b832b", "html_url": "https://github.com/rust-lang/rust/commit/ff7ef116fbe4698f9df0370021d398dc345b832b"}], "stats": {"total": 359, "additions": 188, "deletions": 171}, "files": [{"sha": "c930b628f4b37cb50b49e6ffaa318c266703bf54", "filename": "Cargo.lock", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -169,7 +169,7 @@ dependencies = [\n  \"cc 1.0.35 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"cmake 0.1.38 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"filetime 0.2.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"getopts 0.2.19 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"lazy_static 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.54 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"num_cpus 1.8.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -463,7 +463,7 @@ dependencies = [\n  \"diff 0.1.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"env_logger 0.5.13 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"filetime 0.2.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"getopts 0.2.19 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"lazy_static 1.2.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.54 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -484,7 +484,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"diff 0.1.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"filetime 0.2.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"getopts 0.2.19 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.54 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"miow 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -974,7 +974,7 @@ dependencies = [\n \n [[package]]\n name = \"getopts\"\n-version = \"0.2.18\"\n+version = \"0.2.19\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"unicode-width 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -1989,7 +1989,7 @@ version = \"0.1.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"bitflags 0.9.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"getopts 0.2.19 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -2008,7 +2008,7 @@ version = \"0.5.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"bitflags 1.0.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"getopts 0.2.19 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"memchr 2.2.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"unicase 2.3.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n@@ -3095,7 +3095,7 @@ dependencies = [\n  \"dirs 1.0.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"env_logger 0.6.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"failure 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"getopts 0.2.19 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"ignore 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"itertools 0.8.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"lazy_static 1.2.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -3522,7 +3522,7 @@ dependencies = [\n name = \"test\"\n version = \"0.0.0\"\n dependencies = [\n- \"getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"getopts 0.2.19 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"proc_macro 0.0.0\",\n  \"term 0.0.0\",\n ]\n@@ -3532,7 +3532,7 @@ name = \"tester\"\n version = \"0.5.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"getopts 0.2.19 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.54 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"term 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n@@ -4132,7 +4132,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum futures 0.1.21 (registry+https://github.com/rust-lang/crates.io-index)\" = \"1a70b146671de62ec8c8ed572219ca5d594d9b06c0b364d5e67b722fc559b48c\"\n \"checksum fwdansi 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"34dd4c507af68d37ffef962063dfa1944ce0dd4d5b82043dbab1dabe088610c3\"\n \"checksum generic-array 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ef25c5683767570c2bbd7deba372926a55eaae9982d7726ee2a1050239d45b9d\"\n-\"checksum getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0a7292d30132fb5424b354f5dc02512a86e4c516fe544bb7a25e7f266951b797\"\n+\"checksum getopts 0.2.19 (registry+https://github.com/rust-lang/crates.io-index)\" = \"72327b15c228bfe31f1390f93dd5e9279587f0463836393c9df719ce62a3e450\"\n \"checksum git2 0.8.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c7339329bfa14a00223244311560d11f8f489b453fb90092af97f267a6090ab0\"\n \"checksum git2-curl 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d58551e903ed7e2d6fe3a2f3c7efa3a784ec29b19d0fbb035aaf0497c183fbdd\"\n \"checksum glob 0.3.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"9b919933a397b79c37e33b77bb2aa3dc8eb6e165ad809e58ff75bc7db2e34574\""}, {"sha": "3151b56d8e84ed86691a28de86ff8067b7e6f8f9", "filename": "src/bootstrap/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Fbootstrap%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Fbootstrap%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2FCargo.toml?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -39,7 +39,7 @@ build_helper = { path = \"../build_helper\" }\n cmake = \"0.1.38\"\n filetime = \"0.2\"\n num_cpus = \"1.0\"\n-getopts = \"0.2.18\"\n+getopts = \"0.2.19\"\n cc = \"1.0.35\"\n libc = \"0.2\"\n serde = \"1.0.8\""}, {"sha": "91256385232a9b32da2de83e6bd50e34650e9e5a", "filename": "src/librustc/hir/def.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fhir%2Fdef.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fhir%2Fdef.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fdef.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -140,7 +140,7 @@ pub enum Res<Id = hir::HirId> {\n     SelfCtor(DefId /* impl */),  // `DefId` refers to the impl\n     Local(Id),\n     Upvar(Id,           // `HirId` of closed over local\n-          usize,        // index in the `freevars` list of the closure\n+          usize,        // index in the `upvars` list of the closure\n           ast::NodeId), // expr node that creates the closure\n \n     // Macro namespace"}, {"sha": "1e357e1341710578392e22fab8e635db9cca9be9", "filename": "src/librustc/hir/mod.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fhir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fhir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fmod.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -2476,19 +2476,19 @@ impl ForeignItemKind {\n     }\n }\n \n-/// A free variable referred to in a function.\n+/// A variable captured by a closure.\n #[derive(Debug, Copy, Clone, RustcEncodable, RustcDecodable, HashStable)]\n-pub struct Freevar<Id = HirId> {\n-    /// The variable being accessed free.\n+pub struct Upvar<Id = HirId> {\n+    /// The variable being captured.\n     pub res: Res<Id>,\n \n     // First span where it is accessed (there can be multiple).\n     pub span: Span\n }\n \n-impl<Id: fmt::Debug + Copy> Freevar<Id> {\n-    pub fn map_id<R>(self, map: impl FnMut(Id) -> R) -> Freevar<R> {\n-        Freevar {\n+impl<Id: fmt::Debug + Copy> Upvar<Id> {\n+    pub fn map_id<R>(self, map: impl FnMut(Id) -> R) -> Upvar<R> {\n+        Upvar {\n             res: self.res.map_id(map),\n             span: self.span,\n         }\n@@ -2497,12 +2497,12 @@ impl<Id: fmt::Debug + Copy> Freevar<Id> {\n     pub fn var_id(&self) -> Id {\n         match self.res {\n             Res::Local(id) | Res::Upvar(id, ..) => id,\n-            _ => bug!(\"Freevar::var_id: bad res ({:?})\", self.res)\n+            _ => bug!(\"Upvar::var_id: bad res ({:?})\", self.res)\n         }\n     }\n }\n \n-pub type FreevarMap = NodeMap<Vec<Freevar<ast::NodeId>>>;\n+pub type UpvarMap = NodeMap<Vec<Upvar<ast::NodeId>>>;\n \n pub type CaptureModeMap = NodeMap<CaptureClause>;\n "}, {"sha": "9eb46aa3779d9079d398ec00912b756e773fc04f", "filename": "src/librustc/infer/error_reporting/note.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fnote.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fnote.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fnote.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -46,7 +46,7 @@ impl<'a, 'gcx, 'tcx> InferCtxt<'a, 'gcx, 'tcx> {\n                 err.span_note(span,\n                               \"...so that pointer is not dereferenced outside its lifetime\");\n             }\n-            infer::FreeVariable(span, id) => {\n+            infer::ClosureCapture(span, id) => {\n                 err.span_note(span,\n                               &format!(\"...so that captured variable `{}` does not outlive the \\\n                                         enclosing closure\",\n@@ -214,7 +214,7 @@ impl<'a, 'gcx, 'tcx> InferCtxt<'a, 'gcx, 'tcx> {\n                     \"the reference is only valid for \", sup, \"\");\n                 err\n             }\n-            infer::FreeVariable(span, id) => {\n+            infer::ClosureCapture(span, id) => {\n                 let mut err = struct_span_err!(self.tcx.sess,\n                                                span,\n                                                E0474,"}, {"sha": "5846e604cfc09b046d1f0c75a791f199572cac0d", "filename": "src/librustc/infer/mod.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Finfer%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Finfer%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Fmod.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -264,8 +264,8 @@ pub enum SubregionOrigin<'tcx> {\n     /// Dereference of reference must be within its lifetime\n     DerefPointer(Span),\n \n-    /// Closure bound must not outlive captured free variables\n-    FreeVariable(Span, ast::NodeId),\n+    /// Closure bound must not outlive captured variables\n+    ClosureCapture(Span, ast::NodeId),\n \n     /// Index into slice must be within its lifetime\n     IndexSlice(Span),\n@@ -1660,7 +1660,7 @@ impl<'tcx> SubregionOrigin<'tcx> {\n             InfStackClosure(a) => a,\n             InvokeClosure(a) => a,\n             DerefPointer(a) => a,\n-            FreeVariable(a, _) => a,\n+            ClosureCapture(a, _) => a,\n             IndexSlice(a) => a,\n             RelateObjectBound(a) => a,\n             RelateParamBound(a, _) => a,"}, {"sha": "93ba4241c472540b251a9fcabe15c804377ed336", "filename": "src/librustc/middle/expr_use_visitor.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fmiddle%2Fexpr_use_visitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fmiddle%2Fexpr_use_visitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fexpr_use_visitor.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -931,42 +931,42 @@ impl<'a, 'gcx, 'tcx> ExprUseVisitor<'a, 'gcx, 'tcx> {\n         debug!(\"walk_captures({:?})\", closure_expr);\n \n         let closure_def_id = self.tcx().hir().local_def_id_from_hir_id(closure_expr.hir_id);\n-        self.tcx().with_freevars(closure_expr.hir_id, |freevars| {\n-            for freevar in freevars {\n-                let var_hir_id = freevar.var_id();\n+        if let Some(upvars) = self.tcx().upvars(closure_def_id) {\n+            for upvar in upvars.iter() {\n+                let var_hir_id = upvar.var_id();\n                 let upvar_id = ty::UpvarId {\n                     var_path: ty::UpvarPath { hir_id: var_hir_id },\n                     closure_expr_id: closure_def_id.to_local(),\n                 };\n                 let upvar_capture = self.mc.tables.upvar_capture(upvar_id);\n                 let cmt_var = return_if_err!(self.cat_captured_var(closure_expr.hir_id,\n                                                                    fn_decl_span,\n-                                                                   freevar));\n+                                                                   upvar));\n                 match upvar_capture {\n                     ty::UpvarCapture::ByValue => {\n                         let mode = copy_or_move(&self.mc,\n                                                 self.param_env,\n                                                 &cmt_var,\n                                                 CaptureMove);\n-                        self.delegate.consume(closure_expr.hir_id, freevar.span, &cmt_var, mode);\n+                        self.delegate.consume(closure_expr.hir_id, upvar.span, &cmt_var, mode);\n                     }\n                     ty::UpvarCapture::ByRef(upvar_borrow) => {\n                         self.delegate.borrow(closure_expr.hir_id,\n                                              fn_decl_span,\n                                              &cmt_var,\n                                              upvar_borrow.region,\n                                              upvar_borrow.kind,\n-                                             ClosureCapture(freevar.span));\n+                                             ClosureCapture(upvar.span));\n                     }\n                 }\n             }\n-        });\n+        }\n     }\n \n     fn cat_captured_var(&mut self,\n                         closure_hir_id: hir::HirId,\n                         closure_span: Span,\n-                        upvar: &hir::Freevar)\n+                        upvar: &hir::Upvar)\n                         -> mc::McResult<mc::cmt_<'tcx>> {\n         // Create the cmt for the variable being borrowed, from the\n         // caller's perspective"}, {"sha": "4b458e474b299815c6fd79bff4ebbdd2bad544d7", "filename": "src/librustc/middle/liveness.rs", "status": "modified", "additions": 10, "deletions": 9, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fmiddle%2Fliveness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fmiddle%2Fliveness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fliveness.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -144,7 +144,7 @@ impl LiveNode {\n \n #[derive(Copy, Clone, PartialEq, Debug)]\n enum LiveNodeKind {\n-    FreeVarNode(Span),\n+    UpvarNode(Span),\n     ExprNode(Span),\n     VarDefNode(Span),\n     ExitNode\n@@ -153,8 +153,8 @@ enum LiveNodeKind {\n fn live_node_kind_to_string(lnk: LiveNodeKind, tcx: TyCtxt<'_, '_, '_>) -> String {\n     let cm = tcx.sess.source_map();\n     match lnk {\n-        FreeVarNode(s) => {\n-            format!(\"Free var node [{}]\", cm.span_to_string(s))\n+        UpvarNode(s) => {\n+            format!(\"Upvar node [{}]\", cm.span_to_string(s))\n         }\n         ExprNode(s) => {\n             format!(\"Expr node [{}]\", cm.span_to_string(s))\n@@ -483,16 +483,17 @@ fn visit_expr<'a, 'tcx>(ir: &mut IrMaps<'a, 'tcx>, expr: &'tcx Expr) {\n         // in better error messages than just pointing at the closure\n         // construction site.\n         let mut call_caps = Vec::new();\n-        ir.tcx.with_freevars(expr.hir_id, |freevars| {\n-            call_caps.extend(freevars.iter().filter_map(|fv| {\n-                if let Res::Local(rv) = fv.res {\n-                    let fv_ln = ir.add_live_node(FreeVarNode(fv.span));\n-                    Some(CaptureInfo { ln: fv_ln, var_hid: rv })\n+        let closure_def_id = ir.tcx.hir().local_def_id_from_hir_id(expr.hir_id);\n+        if let Some(upvars) = ir.tcx.upvars(closure_def_id) {\n+            call_caps.extend(upvars.iter().filter_map(|upvar| {\n+                if let Res::Local(rv) = upvar.res {\n+                    let upvar_ln = ir.add_live_node(UpvarNode(upvar.span));\n+                    Some(CaptureInfo { ln: upvar_ln, var_hid: rv })\n                 } else {\n                     None\n                 }\n             }));\n-        });\n+        }\n         ir.set_captures(expr.hir_id, call_caps);\n \n         intravisit::walk_expr(ir, expr);"}, {"sha": "bd67aabfe8e5f77b5688231077929dad626236f6", "filename": "src/librustc/mir/mod.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmir%2Fmod.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -2572,12 +2572,12 @@ impl<'tcx> Debug for Rvalue<'tcx> {\n                             };\n                             let mut struct_fmt = fmt.debug_struct(&name);\n \n-                            tcx.with_freevars(hir_id, |freevars| {\n-                                for (freevar, place) in freevars.iter().zip(places) {\n-                                    let var_name = tcx.hir().name_by_hir_id(freevar.var_id());\n+                            if let Some(upvars) = tcx.upvars(def_id) {\n+                                for (upvar, place) in upvars.iter().zip(places) {\n+                                    let var_name = tcx.hir().name_by_hir_id(upvar.var_id());\n                                     struct_fmt.field(&var_name.as_str(), place);\n                                 }\n-                            });\n+                            }\n \n                             struct_fmt.finish()\n                         } else {\n@@ -2591,12 +2591,12 @@ impl<'tcx> Debug for Rvalue<'tcx> {\n                                                tcx.hir().span_by_hir_id(hir_id));\n                             let mut struct_fmt = fmt.debug_struct(&name);\n \n-                            tcx.with_freevars(hir_id, |freevars| {\n-                                for (freevar, place) in freevars.iter().zip(places) {\n-                                    let var_name = tcx.hir().name_by_hir_id(freevar.var_id());\n+                            if let Some(upvars) = tcx.upvars(def_id) {\n+                                for (upvar, place) in upvars.iter().zip(places) {\n+                                    let var_name = tcx.hir().name_by_hir_id(upvar.var_id());\n                                     struct_fmt.field(&var_name.as_str(), place);\n                                 }\n-                            });\n+                            }\n \n                             struct_fmt.finish()\n                         } else {"}, {"sha": "0e7b66b744499d595d2812626b8bf0c8735f67d9", "filename": "src/librustc/query/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fquery%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fquery%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fquery%2Fmod.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -824,7 +824,7 @@ rustc_queries! {\n             desc { \"generating a postorder list of CrateNums\" }\n         }\n \n-        query freevars(_: DefId) -> Option<Lrc<Vec<hir::Freevar>>> {\n+        query upvars(_: DefId) -> Option<Lrc<Vec<hir::Upvar>>> {\n             eval_always\n         }\n         query maybe_unused_trait_import(_: DefId) -> bool {"}, {"sha": "084a5429f26fa89945b8f7596983cacd7dd1fdc5", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 25, "deletions": 6, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -2181,10 +2181,21 @@ pub fn build_session_options_and_crate_config(\n         TargetTriple::from_triple(host_triple())\n     };\n     let opt_level = {\n-        if matches.opt_present(\"O\") {\n-            if cg.opt_level.is_some() {\n-                early_error(error_format, \"-O and -C opt-level both provided\");\n+        // The `-O` and `-C opt-level` flags specify the same setting, so we want to be able\n+        // to use them interchangeably. However, because they're technically different flags,\n+        // we need to work out manually which should take precedence if both are supplied (i.e.\n+        // the rightmost flag). We do this by finding the (rightmost) position of both flags and\n+        // comparing them. Note that if a flag is not found, its position will be `None`, which\n+        // always compared less than `Some(_)`.\n+        let max_o = matches.opt_positions(\"O\").into_iter().max();\n+        let max_c = matches.opt_strs_pos(\"C\").into_iter().flat_map(|(i, s)| {\n+            if let Some(\"opt-level\") = s.splitn(2, '=').next() {\n+                Some(i)\n+            } else {\n+                None\n             }\n+        }).max();\n+        if max_o > max_c {\n             OptLevel::Default\n         } else {\n             match cg.opt_level.as_ref().map(String::as_ref) {\n@@ -2208,11 +2219,19 @@ pub fn build_session_options_and_crate_config(\n             }\n         }\n     };\n+    // The `-g` and `-C debuginfo` flags specify the same setting, so we want to be able\n+    // to use them interchangeably. See the note above (regarding `-O` and `-C opt-level`)\n+    // for more details.\n     let debug_assertions = cg.debug_assertions.unwrap_or(opt_level == OptLevel::No);\n-    let debuginfo = if matches.opt_present(\"g\") {\n-        if cg.debuginfo.is_some() {\n-            early_error(error_format, \"-g and -C debuginfo both provided\");\n+    let max_g = matches.opt_positions(\"g\").into_iter().max();\n+    let max_c = matches.opt_strs_pos(\"C\").into_iter().flat_map(|(i, s)| {\n+        if let Some(\"debuginfo\") = s.splitn(2, '=').next() {\n+            Some(i)\n+        } else {\n+            None\n         }\n+    }).max();\n+    let debuginfo = if max_g > max_c {\n         DebugInfo::Full\n     } else {\n         match cg.debuginfo {"}, {"sha": "19440d0bc64ea3456a4d5c8efeab23154034efb0", "filename": "src/librustc/ty/context.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fty%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fty%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fcontext.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -1071,10 +1071,10 @@ pub struct GlobalCtxt<'tcx> {\n \n     pub queries: query::Queries<'tcx>,\n \n-    // Records the free variables referenced by every closure\n+    // Records the captured variables referenced by every closure\n     // expression. Do not track deps for this, just recompute it from\n     // scratch every time.\n-    freevars: FxHashMap<DefId, Lrc<Vec<hir::Freevar>>>,\n+    upvars: FxHashMap<DefId, Lrc<Vec<hir::Upvar>>>,\n \n     maybe_unused_trait_imports: FxHashSet<DefId>,\n     maybe_unused_extern_crates: Vec<(DefId, Span)>,\n@@ -1317,7 +1317,7 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n                 }).collect();\n                 (k, Lrc::new(exports))\n             }).collect(),\n-            freevars: resolutions.freevars.into_iter().map(|(k, v)| {\n+            upvars: resolutions.upvars.into_iter().map(|(k, v)| {\n                 let vars: Vec<_> = v.into_iter().map(|e| {\n                     e.map_id(|id| hir.node_to_hir_id(id))\n                 }).collect();\n@@ -3055,7 +3055,7 @@ pub fn provide(providers: &mut ty::query::Providers<'_>) {\n         assert_eq!(id, LOCAL_CRATE);\n         Lrc::new(middle::lang_items::collect(tcx))\n     };\n-    providers.freevars = |tcx, id| tcx.gcx.freevars.get(&id).cloned();\n+    providers.upvars = |tcx, id| tcx.gcx.upvars.get(&id).cloned();\n     providers.maybe_unused_trait_import = |tcx, id| {\n         tcx.maybe_unused_trait_imports.contains(&id)\n     };"}, {"sha": "cb92e4b7470a58640d2625c44fd61325ea5148e7", "filename": "src/librustc/ty/mod.rs", "status": "modified", "additions": 3, "deletions": 15, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fty%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fty%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fmod.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -8,8 +8,8 @@ pub use self::BorrowKind::*;\n pub use self::IntVarValue::*;\n pub use self::fold::TypeFoldable;\n \n-use crate::hir::{map as hir_map, FreevarMap, GlobMap, TraitMap};\n-use crate::hir::{HirId, Node};\n+use crate::hir::{map as hir_map, UpvarMap, GlobMap, TraitMap};\n+use crate::hir::Node;\n use crate::hir::def::{Res, DefKind, CtorOf, CtorKind, ExportMap};\n use crate::hir::def_id::{CrateNum, DefId, LocalDefId, CRATE_DEF_INDEX, LOCAL_CRATE};\n use rustc_data_structures::svh::Svh;\n@@ -122,7 +122,7 @@ mod sty;\n \n #[derive(Clone)]\n pub struct Resolutions {\n-    pub freevars: FreevarMap,\n+    pub upvars: UpvarMap,\n     pub trait_map: TraitMap,\n     pub maybe_unused_trait_imports: NodeSet,\n     pub maybe_unused_extern_crates: Vec<(NodeId, Span)>,\n@@ -3120,18 +3120,6 @@ impl Iterator for AssociatedItemsIterator<'_, '_, '_> {\n     }\n }\n \n-impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n-    pub fn with_freevars<T, F>(self, fid: HirId, f: F) -> T where\n-        F: FnOnce(&[hir::Freevar]) -> T,\n-    {\n-        let def_id = self.hir().local_def_id_from_hir_id(fid);\n-        match self.freevars(def_id) {\n-            None => f(&[]),\n-            Some(d) => f(&d),\n-        }\n-    }\n-}\n-\n fn associated_item<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>, def_id: DefId) -> AssociatedItem {\n     let id = tcx.hir().as_local_hir_id(def_id).unwrap();\n     let parent_id = tcx.hir().get_parent_item(id);"}, {"sha": "8e98d4d85b9cc04d437fc2d24d014575ae819de4", "filename": "src/librustc/ty/print/pretty.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -582,16 +582,16 @@ pub trait PrettyPrinter<'gcx: 'tcx, 'tcx>:\n                 if let Some(hir_id) = self.tcx().hir().as_local_hir_id(did) {\n                     p!(write(\"@{:?}\", self.tcx().hir().span_by_hir_id(hir_id)));\n                     let mut sep = \" \";\n-                    for (freevar, upvar_ty) in self.tcx().freevars(did)\n+                    for (upvar, upvar_ty) in self.tcx().upvars(did)\n                         .as_ref()\n-                        .map_or(&[][..], |fv| &fv[..])\n+                        .map_or(&[][..], |v| &v[..])\n                         .iter()\n                         .zip(upvar_tys)\n                     {\n                         p!(\n                             write(\"{}{}:\",\n                                     sep,\n-                                    self.tcx().hir().name_by_hir_id(freevar.var_id())),\n+                                    self.tcx().hir().name_by_hir_id(upvar.var_id())),\n                             print(upvar_ty));\n                         sep = \", \";\n                     }\n@@ -625,16 +625,16 @@ pub trait PrettyPrinter<'gcx: 'tcx, 'tcx>:\n                         p!(write(\"@{:?}\", self.tcx().hir().span_by_hir_id(hir_id)));\n                     }\n                     let mut sep = \" \";\n-                    for (freevar, upvar_ty) in self.tcx().freevars(did)\n+                    for (upvar, upvar_ty) in self.tcx().upvars(did)\n                         .as_ref()\n-                        .map_or(&[][..], |fv| &fv[..])\n+                        .map_or(&[][..], |v| &v[..])\n                         .iter()\n                         .zip(upvar_tys)\n                     {\n                         p!(\n                             write(\"{}{}:\",\n                                     sep,\n-                                    self.tcx().hir().name_by_hir_id(freevar.var_id())),\n+                                    self.tcx().hir().name_by_hir_id(upvar.var_id())),\n                             print(upvar_ty));\n                         sep = \", \";\n                     }"}, {"sha": "8543cca1dd54502f9131521f67bf0c81d80c40c8", "filename": "src/librustc_interface/passes.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_interface%2Fpasses.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_interface%2Fpasses.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_interface%2Fpasses.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -180,7 +180,7 @@ impl ExpansionResult {\n         ExpansionResult {\n             defs: Steal::new(resolver.definitions),\n             resolutions: Steal::new(Resolutions {\n-                freevars: resolver.freevars,\n+                upvars: resolver.upvars,\n                 export_map: resolver.export_map,\n                 trait_map: resolver.trait_map,\n                 glob_map: resolver.glob_map,\n@@ -199,7 +199,7 @@ impl ExpansionResult {\n         ExpansionResult {\n             defs: Steal::new(resolver.definitions.clone()),\n             resolutions: Steal::new(Resolutions {\n-                freevars: resolver.freevars.clone(),\n+                upvars: resolver.upvars.clone(),\n                 export_map: resolver.export_map.clone(),\n                 trait_map: resolver.trait_map.clone(),\n                 glob_map: resolver.glob_map.clone(),"}, {"sha": "8aa6456ebe77b8cbeef657d92c82d7238945b26b", "filename": "src/librustc_mir/borrow_check/error_reporting.rs", "status": "modified", "additions": 14, "deletions": 27, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_mir%2Fborrow_check%2Ferror_reporting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_mir%2Fborrow_check%2Ferror_reporting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Ferror_reporting.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -1814,16 +1814,12 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n                 ty::Array(ty, _) | ty::Slice(ty) =>\n                     self.describe_field_from_ty(&ty, field, variant_index),\n                 ty::Closure(def_id, _) | ty::Generator(def_id, _, _) => {\n-                    // Convert the def-id into a node-id. node-ids are only valid for\n-                    // the local code in the current crate, so this returns an `Option` in case\n+                    // `tcx.upvars(def_id)` returns an `Option`, which is `None` in case\n                     // the closure comes from another crate. But in that case we wouldn't\n                     // be borrowck'ing it, so we can just unwrap:\n-                    let hir_id = self.infcx.tcx.hir().as_local_hir_id(def_id).unwrap();\n-                    let freevar = self.infcx\n-                        .tcx\n-                        .with_freevars(hir_id, |fv| fv[field.index()]);\n+                    let upvar = self.infcx.tcx.upvars(def_id).unwrap()[field.index()];\n \n-                    self.infcx.tcx.hir().name_by_hir_id(freevar.var_id()).to_string()\n+                    self.infcx.tcx.hir().name_by_hir_id(upvar.var_id()).to_string()\n                 }\n                 _ => {\n                     // Might need a revision when the fields in trait RFC is implemented\n@@ -2613,28 +2609,19 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n         if let hir::ExprKind::Closure(\n             .., args_span, _\n         ) = expr {\n-            let var_span = self.infcx.tcx.with_freevars(\n-                hir_id,\n-                |freevars| {\n-                    for (v, place) in freevars.iter().zip(places) {\n-                        match place {\n-                            Operand::Copy(place) |\n-                            Operand::Move(place) if target_place == place => {\n-                                debug!(\"closure_span: found captured local {:?}\", place);\n-                                return Some(v.span);\n-                            },\n-                            _ => {}\n-                        }\n-                    }\n-\n-                    None\n-                },\n-            )?;\n+            for (v, place) in self.infcx.tcx.upvars(def_id)?.iter().zip(places) {\n+                match place {\n+                    Operand::Copy(place) |\n+                    Operand::Move(place) if target_place == place => {\n+                        debug!(\"closure_span: found captured local {:?}\", place);\n+                        return Some((*args_span, v.span));\n+                    },\n+                    _ => {}\n+                }\n+            }\n \n-            Some((*args_span, var_span))\n-        } else {\n-            None\n         }\n+        None\n     }\n \n     /// Helper to retrieve span(s) of given borrow from the current MIR"}, {"sha": "5e646a49e0e4293ed3c70118f3e1e06677c7c723", "filename": "src/librustc_mir/hair/cx/expr.rs", "status": "modified", "additions": 11, "deletions": 12, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_mir%2Fhair%2Fcx%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_mir%2Fhair%2Fcx%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fhair%2Fcx%2Fexpr.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -516,12 +516,11 @@ fn make_mirror_unadjusted<'a, 'gcx, 'tcx>(cx: &mut Cx<'a, 'gcx, 'tcx>,\n                     span_bug!(expr.span, \"closure expr w/o closure type: {:?}\", closure_ty);\n                 }\n             };\n-            let upvars = cx.tcx.with_freevars(expr.hir_id, |freevars| {\n-                freevars.iter()\n-                    .zip(substs.upvar_tys(def_id, cx.tcx))\n-                    .map(|(fv, ty)| capture_freevar(cx, expr, fv, ty))\n-                    .collect()\n-            });\n+            let upvars = cx.tcx.upvars(def_id).iter()\n+                .flat_map(|upvars| upvars.iter())\n+                .zip(substs.upvar_tys(def_id, cx.tcx))\n+                .map(|(upvar, ty)| capture_upvar(cx, expr, upvar, ty))\n+                .collect();\n             ExprKind::Closure {\n                 closure_id: def_id,\n                 substs,\n@@ -1185,12 +1184,12 @@ fn overloaded_place<'a, 'gcx, 'tcx>(\n     ExprKind::Deref { arg: ref_expr.to_ref() }\n }\n \n-fn capture_freevar<'a, 'gcx, 'tcx>(cx: &mut Cx<'a, 'gcx, 'tcx>,\n+fn capture_upvar<'a, 'gcx, 'tcx>(cx: &mut Cx<'a, 'gcx, 'tcx>,\n                                    closure_expr: &'tcx hir::Expr,\n-                                   freevar: &hir::Freevar,\n-                                   freevar_ty: Ty<'tcx>)\n+                                   upvar: &hir::Upvar,\n+                                   upvar_ty: Ty<'tcx>)\n                                    -> ExprRef<'tcx> {\n-    let var_hir_id = freevar.var_id();\n+    let var_hir_id = upvar.var_id();\n     let upvar_id = ty::UpvarId {\n         var_path: ty::UpvarPath { hir_id: var_hir_id },\n         closure_expr_id: cx.tcx.hir().local_def_id_from_hir_id(closure_expr.hir_id).to_local(),\n@@ -1202,7 +1201,7 @@ fn capture_freevar<'a, 'gcx, 'tcx>(cx: &mut Cx<'a, 'gcx, 'tcx>,\n         temp_lifetime,\n         ty: var_ty,\n         span: closure_expr.span,\n-        kind: convert_var(cx, closure_expr, freevar.res),\n+        kind: convert_var(cx, closure_expr, upvar.res),\n     };\n     match upvar_capture {\n         ty::UpvarCapture::ByValue => captured_var.to_ref(),\n@@ -1214,7 +1213,7 @@ fn capture_freevar<'a, 'gcx, 'tcx>(cx: &mut Cx<'a, 'gcx, 'tcx>,\n             };\n             Expr {\n                 temp_lifetime,\n-                ty: freevar_ty,\n+                ty: upvar_ty,\n                 span: closure_expr.span,\n                 kind: ExprKind::Borrow {\n                     borrow_kind,"}, {"sha": "1ab612a2f7dd7d5e546986f158e6a4a6bd683e39", "filename": "src/librustc_mir/interpret/validity.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_mir%2Finterpret%2Fvalidity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_mir%2Finterpret%2Fvalidity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Finterpret%2Fvalidity.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -172,7 +172,7 @@ impl<'rt, 'a, 'mir, 'tcx, M: Machine<'a, 'mir, 'tcx>> ValidityVisitor<'rt, 'a, '\n                 if def_id.is_local() {\n                     let tables = self.ecx.tcx.typeck_tables_of(def_id);\n                     if let Some(upvars) = tables.upvar_list.get(&def_id) {\n-                        // Sometimes the index is beyond the number of freevars (seen\n+                        // Sometimes the index is beyond the number of upvars (seen\n                         // for a generator).\n                         if let Some(upvar_id) = upvars.get(field) {\n                             let var_hir_id = upvar_id.var_path.hir_id;"}, {"sha": "0f651fafcd2ac487bf92d6871e3854dacb34fce5", "filename": "src/librustc_passes/rvalue_promotion.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_passes%2Frvalue_promotion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_passes%2Frvalue_promotion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_passes%2Frvalue_promotion.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -449,7 +449,8 @@ fn check_expr_kind<'a, 'tcx>(\n             let nested_body_promotable = v.check_nested_body(body_id);\n             // Paths in constant contexts cannot refer to local variables,\n             // as there are none, and thus closures can't have upvars there.\n-            if v.tcx.with_freevars(e.hir_id, |fv| !fv.is_empty()) {\n+            let closure_def_id = v.tcx.hir().local_def_id_from_hir_id(e.hir_id);\n+            if !v.tcx.upvars(closure_def_id).map_or(true, |v| v.is_empty()) {\n                 NotPromotable\n             } else {\n                 nested_body_promotable"}, {"sha": "cb6f8ebd82e4eb7a620b550e52b01353848cc26b", "filename": "src/librustc_plugin/lib.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_plugin%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_plugin%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_plugin%2Flib.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -47,8 +47,9 @@\n //! #![plugin(myplugin)]\n //! ```\n //!\n-//! See the [`plugin` feature](../unstable-book/language-features/plugin.html) of\n-//! the Unstable Book for more examples.\n+//! See the [`plugin`\n+//! feature](https://doc.rust-lang.org/nightly/unstable-book/language-features/plugin.html)\n+//! of the Unstable Book for more examples.\n \n #![doc(html_root_url = \"https://doc.rust-lang.org/nightly/\")]\n "}, {"sha": "f8f6e5b1cd012f2d338f9d891108e5ef1f7164cd", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -29,7 +29,7 @@ use rustc::hir::def::{\n };\n use rustc::hir::def::Namespace::*;\n use rustc::hir::def_id::{CRATE_DEF_INDEX, LOCAL_CRATE, DefId};\n-use rustc::hir::{Freevar, FreevarMap, TraitCandidate, TraitMap, GlobMap};\n+use rustc::hir::{Upvar, UpvarMap, TraitCandidate, TraitMap, GlobMap};\n use rustc::ty::{self, DefIdTree};\n use rustc::util::nodemap::{NodeMap, NodeSet, FxHashMap, FxHashSet, DefIdMap};\n use rustc::{bug, span_bug};\n@@ -1668,8 +1668,8 @@ pub struct Resolver<'a> {\n     /// Resolutions for labels (node IDs of their corresponding blocks or loops).\n     label_res_map: NodeMap<NodeId>,\n \n-    pub freevars: FreevarMap,\n-    freevars_seen: NodeMap<NodeMap<usize>>,\n+    pub upvars: UpvarMap,\n+    upvars_seen: NodeMap<NodeMap<usize>>,\n     pub export_map: ExportMap<NodeId>,\n     pub trait_map: TraitMap,\n \n@@ -2033,8 +2033,8 @@ impl<'a> Resolver<'a> {\n             partial_res_map: Default::default(),\n             import_res_map: Default::default(),\n             label_res_map: Default::default(),\n-            freevars: Default::default(),\n-            freevars_seen: Default::default(),\n+            upvars: Default::default(),\n+            upvars_seen: Default::default(),\n             export_map: FxHashMap::default(),\n             trait_map: Default::default(),\n             module_map,\n@@ -4054,21 +4054,21 @@ impl<'a> Resolver<'a> {\n                         ClosureRibKind(function_id) => {\n                             let prev_res = res;\n \n-                            let seen = self.freevars_seen\n+                            let seen = self.upvars_seen\n                                            .entry(function_id)\n                                            .or_default();\n                             if let Some(&index) = seen.get(&node_id) {\n                                 res = Res::Upvar(node_id, index, function_id);\n                                 continue;\n                             }\n-                            let vec = self.freevars\n+                            let vec = self.upvars\n                                           .entry(function_id)\n                                           .or_default();\n                             let depth = vec.len();\n                             res = Res::Upvar(node_id, depth, function_id);\n \n                             if record_used {\n-                                vec.push(Freevar {\n+                                vec.push(Upvar {\n                                     res: prev_res,\n                                     span,\n                                 });"}, {"sha": "d21ceb983f8f4cf6f2ef0843a2199ef68270a822", "filename": "src/librustc_typeck/check/coercion.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_typeck%2Fcheck%2Fcoercion.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_typeck%2Fcheck%2Fcoercion.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fcoercion.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -721,9 +721,8 @@ impl<'f, 'gcx, 'tcx> Coerce<'f, 'gcx, 'tcx> {\n \n         let b = self.shallow_resolve(b);\n \n-        let hir_id_a = self.tcx.hir().as_local_hir_id(def_id_a).unwrap();\n         match b.sty {\n-            ty::FnPtr(fn_ty) if self.tcx.with_freevars(hir_id_a, |v| v.is_empty()) => {\n+            ty::FnPtr(fn_ty) if self.tcx.upvars(def_id_a).map_or(true, |v| v.is_empty()) => {\n                 // We coerce the closure, which has fn type\n                 //     `extern \"rust-call\" fn((arg0,arg1,...)) -> _`\n                 // to"}, {"sha": "c3861f964e4534dfe39e7363ea07a2ec73ed0463", "filename": "src/librustc_typeck/check/upvar.rs", "status": "modified", "additions": 24, "deletions": 24, "changes": 48, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_typeck%2Fcheck%2Fupvar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_typeck%2Fcheck%2Fupvar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fupvar.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -121,28 +121,28 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n             None\n         };\n \n-        self.tcx.with_freevars(closure_hir_id, |freevars| {\n-            let mut freevar_list: Vec<ty::UpvarId> = Vec::with_capacity(freevars.len());\n-            for freevar in freevars {\n+        if let Some(upvars) = self.tcx.upvars(closure_def_id) {\n+            let mut upvar_list: Vec<ty::UpvarId> = Vec::with_capacity(upvars.len());\n+            for upvar in upvars.iter() {\n                 let upvar_id = ty::UpvarId {\n                     var_path: ty::UpvarPath {\n-                        hir_id: freevar.var_id(),\n+                        hir_id: upvar.var_id(),\n                     },\n                     closure_expr_id: LocalDefId::from_def_id(closure_def_id),\n                 };\n                 debug!(\"seed upvar_id {:?}\", upvar_id);\n                 // Adding the upvar Id to the list of Upvars, which will be added\n                 // to the map for the closure at the end of the for loop.\n-                freevar_list.push(upvar_id);\n+                upvar_list.push(upvar_id);\n \n                 let capture_kind = match capture_clause {\n                     hir::CaptureByValue => ty::UpvarCapture::ByValue,\n                     hir::CaptureByRef => {\n                         let origin = UpvarRegion(upvar_id, span);\n-                        let freevar_region = self.next_region_var(origin);\n+                        let upvar_region = self.next_region_var(origin);\n                         let upvar_borrow = ty::UpvarBorrow {\n                             kind: ty::ImmBorrow,\n-                            region: freevar_region,\n+                            region: upvar_region,\n                         };\n                         ty::UpvarCapture::ByRef(upvar_borrow)\n                     }\n@@ -153,16 +153,16 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n                     .upvar_capture_map\n                     .insert(upvar_id, capture_kind);\n             }\n-            // Add the vector of freevars to the map keyed with the closure id.\n+            // Add the vector of upvars to the map keyed with the closure id.\n             // This gives us an easier access to them without having to call\n-            // with_freevars again..\n-            if !freevar_list.is_empty() {\n+            // tcx.upvars again..\n+            if !upvar_list.is_empty() {\n                 self.tables\n                     .borrow_mut()\n                     .upvar_list\n-                    .insert(closure_def_id, freevar_list);\n+                    .insert(closure_def_id, upvar_list);\n             }\n-        });\n+        }\n \n         let body_owner_def_id = self.tcx.hir().body_owner_def_id(body.id());\n         let region_scope_tree = &self.tcx.region_scope_tree(body_owner_def_id);\n@@ -244,38 +244,38 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n         // This may change if abstract return types of some sort are\n         // implemented.\n         let tcx = self.tcx;\n-        let closure_def_index = tcx.hir().local_def_id_from_hir_id(closure_id);\n+        let closure_def_id = tcx.hir().local_def_id_from_hir_id(closure_id);\n \n-        tcx.with_freevars(closure_id, |freevars| {\n-            freevars\n+        tcx.upvars(closure_def_id).iter().flat_map(|upvars| {\n+            upvars\n                 .iter()\n-                .map(|freevar| {\n-                    let var_hir_id = freevar.var_id();\n-                    let freevar_ty = self.node_ty(var_hir_id);\n+                .map(|upvar| {\n+                    let var_hir_id = upvar.var_id();\n+                    let upvar_ty = self.node_ty(var_hir_id);\n                     let upvar_id = ty::UpvarId {\n                         var_path: ty::UpvarPath { hir_id: var_hir_id },\n-                        closure_expr_id: LocalDefId::from_def_id(closure_def_index),\n+                        closure_expr_id: LocalDefId::from_def_id(closure_def_id),\n                     };\n                     let capture = self.tables.borrow().upvar_capture(upvar_id);\n \n                     debug!(\n-                        \"var_id={:?} freevar_ty={:?} capture={:?}\",\n-                        var_hir_id, freevar_ty, capture\n+                        \"var_id={:?} upvar_ty={:?} capture={:?}\",\n+                        var_hir_id, upvar_ty, capture\n                     );\n \n                     match capture {\n-                        ty::UpvarCapture::ByValue => freevar_ty,\n+                        ty::UpvarCapture::ByValue => upvar_ty,\n                         ty::UpvarCapture::ByRef(borrow) => tcx.mk_ref(\n                             borrow.region,\n                             ty::TypeAndMut {\n-                                ty: freevar_ty,\n+                                ty: upvar_ty,\n                                 mutbl: borrow.kind.to_mutbl_lossy(),\n                             },\n                         ),\n                     }\n                 })\n-                .collect()\n         })\n+            .collect()\n     }\n }\n "}, {"sha": "4185999fdd6d734e8c9acae0ff4d1df9dbb4826d", "filename": "src/librustc_typeck/collect.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_typeck%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustc_typeck%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcollect.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -1093,8 +1093,8 @@ fn generics_of<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>, def_id: DefId) -> &'tcx ty\n                 }),\n         );\n \n-        tcx.with_freevars(hir_id, |fv| {\n-            params.extend(fv.iter().zip((dummy_args.len() as u32)..).map(|(_, i)| {\n+        if let Some(upvars) = tcx.upvars(def_id) {\n+            params.extend(upvars.iter().zip((dummy_args.len() as u32)..).map(|(_, i)| {\n                 ty::GenericParamDef {\n                     index: type_start + i,\n                     name: Symbol::intern(\"<upvar>\").as_interned_str(),\n@@ -1107,7 +1107,7 @@ fn generics_of<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>, def_id: DefId) -> &'tcx ty\n                     },\n                 }\n             }));\n-        });\n+        }\n     }\n \n     let param_def_id_to_index = params"}, {"sha": "472192a6464921a69b5da6e044a625d16790ce6d", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -3410,7 +3410,7 @@ fn render_stability_since_raw<'a, T: fmt::Write>(\n ) -> fmt::Result {\n     if let Some(v) = ver {\n         if containing_ver != ver && v.len() > 0 {\n-            write!(w, \"<div class='since' title='Stable since Rust version {0}'>{0}</div>\", v)?\n+            write!(w, \"<span class='since' title='Stable since Rust version {0}'>{0}</span>\", v)?\n         }\n     }\n     Ok(())"}, {"sha": "4204d20498d701a5f74a76ded3bdb18c50ac2809", "filename": "src/librustdoc/html/static/rustdoc.css", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Frustdoc.css?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -914,7 +914,7 @@ h3 > .collapse-toggle, h4 > .collapse-toggle {\n \theight: 12px;\n }\n \n-span.since {\n+.out-of-band > span.since {\n \tposition: initial;\n \tfont-size: 20px;\n \tmargin-right: 5px;"}, {"sha": "24f728158c47260e85cdbaa3ef80094ac328c86b", "filename": "src/libstd/primitive_docs.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibstd%2Fprimitive_docs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibstd%2Fprimitive_docs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fprimitive_docs.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -279,7 +279,7 @@ mod prim_never { }\n ///\n /// As always, remember that a human intuition for 'character' may not map to\n /// Unicode's definitions. For example, despite looking similar, the '\u00e9'\n-/// character is one Unicode code point while '\u00e9' is two Unicode code points:\n+/// character is one Unicode code point while 'e\u0301' is two Unicode code points:\n ///\n /// ```\n /// let mut chars = \"\u00e9\".chars();"}, {"sha": "a72e4c70502896df7782754e4dad0ee8aec8b9b6", "filename": "src/libtest/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibtest%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Flibtest%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibtest%2FCargo.toml?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -10,7 +10,7 @@ path = \"lib.rs\"\n crate-type = [\"dylib\", \"rlib\"]\n \n [dependencies]\n-getopts = \"0.2.18\"\n+getopts = \"0.2.19\"\n term = { path = \"../libterm\" }\n \n # not actually used but needed to always have proc_macro in the sysroot"}, {"sha": "bea610eeb9fd1b8b8de1e919b5d211a0d0e5b11f", "filename": "src/test/run-make-fulldeps/override-aliased-flags/Makefile", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Ftest%2Frun-make-fulldeps%2Foverride-aliased-flags%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Ftest%2Frun-make-fulldeps%2Foverride-aliased-flags%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Foverride-aliased-flags%2FMakefile?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -0,0 +1,22 @@\n+-include ../tools.mk\n+\n+# FIXME: it would be good to check that it's actually the rightmost flags\n+# that are used when multiple flags are specified, but I can't think of a\n+# reliable way to check this.\n+\n+all:\n+\t# Test that `-O` and `-C opt-level` can be specified multiple times.\n+\t# The rightmost flag will be used over any previous flags.\n+\t$(RUSTC) -O -O main.rs\n+\t$(RUSTC) -O -C opt-level=0 main.rs\n+\t$(RUSTC) -C opt-level=0 -O main.rs\n+\t$(RUSTC) -C opt-level=0 -C opt-level=2 main.rs\n+\t$(RUSTC) -C opt-level=2 -C opt-level=0 main.rs\n+\n+\t# Test that `-g` and `-C debuginfo` can be specified multiple times.\n+\t# The rightmost flag will be used over any previous flags.\n+\t$(RUSTC) -g -g main.rs\n+\t$(RUSTC) -g -C debuginfo=0 main.rs\n+\t$(RUSTC) -C debuginfo=0 -g main.rs\n+\t$(RUSTC) -C debuginfo=0 -C debuginfo=2 main.rs\n+\t$(RUSTC) -C debuginfo=2 -C debuginfo=0 main.rs"}, {"sha": "f328e4d9d04c31d0d70d16d21a07d1613be9d577", "filename": "src/test/run-make-fulldeps/override-aliased-flags/main.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Ftest%2Frun-make-fulldeps%2Foverride-aliased-flags%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Ftest%2Frun-make-fulldeps%2Foverride-aliased-flags%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Foverride-aliased-flags%2Fmain.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -0,0 +1 @@\n+fn main() {}"}, {"sha": "6060bc0a6fd5c4d62b70a3b35f691fbe1d5f8a7e", "filename": "src/test/rustdoc/assoc-consts-version.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/40bd145cbef28d279aacc903907c3945f83a6296/src%2Ftest%2Frustdoc%2Fassoc-consts-version.rs", "raw_url": "https://github.com/rust-lang/rust/raw/40bd145cbef28d279aacc903907c3945f83a6296/src%2Ftest%2Frustdoc%2Fassoc-consts-version.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fassoc-consts-version.rs?ref=40bd145cbef28d279aacc903907c3945f83a6296", "patch": "@@ -1,5 +1,3 @@\n-// ignore-tidy-linelength\n-\n #![crate_name = \"foo\"]\n \n #![feature(staged_api)]\n@@ -10,7 +8,8 @@\n pub struct SomeStruct;\n \n impl SomeStruct {\n-    // @has 'foo/struct.SomeStruct.html' '//*[@id=\"associatedconstant.SOME_CONST\"]//div[@class=\"since\"]' '1.1.2'\n+    // @has 'foo/struct.SomeStruct.html' \\\n+    //   '//*[@id=\"associatedconstant.SOME_CONST\"]//span[@class=\"since\"]' '1.1.2'\n     #[stable(since=\"1.1.2\", feature=\"rust2\")]\n     pub const SOME_CONST: usize = 0;\n }"}]}