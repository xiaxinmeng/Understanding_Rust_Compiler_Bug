{"sha": "8f34a50cc5bb94f7d3381ec00ed273af68724a4b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhmMzRhNTBjYzViYjk0ZjdkMzM4MWVjMDBlZDI3M2FmNjg3MjRhNGI=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2019-05-31T06:09:04Z"}, "committer": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2019-05-31T06:09:04Z"}, "message": "Remove ty::BrFresh and new_bound", "tree": {"sha": "455d64d34f632aa040b60ecb429fdccb2eccc094", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/455d64d34f632aa040b60ecb429fdccb2eccc094"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8f34a50cc5bb94f7d3381ec00ed273af68724a4b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8f34a50cc5bb94f7d3381ec00ed273af68724a4b", "html_url": "https://github.com/rust-lang/rust/commit/8f34a50cc5bb94f7d3381ec00ed273af68724a4b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8f34a50cc5bb94f7d3381ec00ed273af68724a4b/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c28084ac16af4ab594b6860958df140e7c876a13", "url": "https://api.github.com/repos/rust-lang/rust/commits/c28084ac16af4ab594b6860958df140e7c876a13", "html_url": "https://github.com/rust-lang/rust/commit/c28084ac16af4ab594b6860958df140e7c876a13"}], "stats": {"total": 56, "additions": 4, "deletions": 52}, "files": [{"sha": "563948a63514b300eb4c01a23398aa988ffb452c", "filename": "src/librustc/ich/impls_ty.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8f34a50cc5bb94f7d3381ec00ed273af68724a4b/src%2Flibrustc%2Fich%2Fimpls_ty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f34a50cc5bb94f7d3381ec00ed273af68724a4b/src%2Flibrustc%2Fich%2Fimpls_ty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fich%2Fimpls_ty.rs?ref=8f34a50cc5bb94f7d3381ec00ed273af68724a4b", "patch": "@@ -100,7 +100,6 @@ for ty::RegionKind {\n             ty::ReClosureBound(vid) => {\n                 vid.hash_stable(hcx, hasher);\n             }\n-            ty::ReLateBound(..) |\n             ty::ReVar(..) |\n             ty::RePlaceholder(..) => {\n                 bug!(\"StableHasher: unexpected region {:?}\", *self)"}, {"sha": "b1eba7d5934f91fed1f45662b46200870ac28307", "filename": "src/librustc/infer/error_reporting/mod.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/8f34a50cc5bb94f7d3381ec00ed273af68724a4b/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f34a50cc5bb94f7d3381ec00ed273af68724a4b/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fmod.rs?ref=8f34a50cc5bb94f7d3381ec00ed273af68724a4b", "patch": "@@ -218,10 +218,6 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n                     format!(\"the anonymous lifetime #{} defined on\", idx + 1),\n                     self.hir().span_by_hir_id(node),\n                 ),\n-                ty::BrFresh(_) => (\n-                    \"an anonymous lifetime defined on\".to_owned(),\n-                    self.hir().span_by_hir_id(node),\n-                ),\n                 _ => (\n                     format!(\"the lifetime {} as defined on\", region),\n                     cm.def_span(self.hir().span_by_hir_id(node)),"}, {"sha": "ca766ea724f3db02379a4a398aeccf8c3496157d", "filename": "src/librustc/infer/region_constraints/mod.rs", "status": "modified", "additions": 2, "deletions": 40, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/8f34a50cc5bb94f7d3381ec00ed273af68724a4b/src%2Flibrustc%2Finfer%2Fregion_constraints%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f34a50cc5bb94f7d3381ec00ed273af68724a4b/src%2Flibrustc%2Finfer%2Fregion_constraints%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Fregion_constraints%2Fmod.rs?ref=8f34a50cc5bb94f7d3381ec00ed273af68724a4b", "patch": "@@ -11,11 +11,11 @@ use rustc_data_structures::indexed_vec::IndexVec;\n use rustc_data_structures::unify as ut;\n use crate::ty::ReStatic;\n use crate::ty::{self, Ty, TyCtxt};\n-use crate::ty::{BrFresh, ReLateBound, ReVar};\n+use crate::ty::{ReLateBound, ReVar};\n use crate::ty::{Region, RegionVid};\n \n use std::collections::BTreeMap;\n-use std::{cmp, fmt, mem, u32};\n+use std::{cmp, fmt, mem};\n use std::ops::Range;\n \n mod leak_check;\n@@ -37,10 +37,6 @@ pub struct RegionConstraintCollector<'tcx> {\n     /// exist). This prevents us from making many such regions.\n     glbs: CombineMap<'tcx>,\n \n-    /// Global counter used during the GLB algorithm to create unique\n-    /// names for fresh bound regions\n-    bound_count: u32,\n-\n     /// The undo log records actions that might later be undone.\n     ///\n     /// Note: `num_open_snapshots` is used to track if we are actively\n@@ -392,7 +388,6 @@ impl<'tcx> RegionConstraintCollector<'tcx> {\n             data,\n             lubs,\n             glbs,\n-            bound_count: _,\n             undo_log: _,\n             num_open_snapshots: _,\n             unification_table,\n@@ -579,39 +574,6 @@ impl<'tcx> RegionConstraintCollector<'tcx> {\n         }\n     }\n \n-    pub fn new_bound(\n-        &mut self,\n-        tcx: TyCtxt<'_, '_, 'tcx>,\n-        debruijn: ty::DebruijnIndex,\n-    ) -> Region<'tcx> {\n-        // Creates a fresh bound variable for use in GLB computations.\n-        // See discussion of GLB computation in the large comment at\n-        // the top of this file for more details.\n-        //\n-        // This computation is potentially wrong in the face of\n-        // rollover.  It's conceivable, if unlikely, that one might\n-        // wind up with accidental capture for nested functions in\n-        // that case, if the outer function had bound regions created\n-        // a very long time before and the inner function somehow\n-        // wound up rolling over such that supposedly fresh\n-        // identifiers were in fact shadowed. For now, we just assert\n-        // that there is no rollover -- eventually we should try to be\n-        // robust against this possibility, either by checking the set\n-        // of bound identifiers that appear in a given expression and\n-        // ensure that we generate one that is distinct, or by\n-        // changing the representation of bound regions in a fn\n-        // declaration\n-\n-        let sc = self.bound_count;\n-        self.bound_count = sc + 1;\n-\n-        if sc >= self.bound_count {\n-            bug!(\"rollover in RegionInference new_bound()\");\n-        }\n-\n-        tcx.mk_region(ReLateBound(debruijn, BrFresh(sc)))\n-    }\n-\n     fn add_constraint(&mut self, constraint: Constraint<'tcx>, origin: SubregionOrigin<'tcx>) {\n         // cannot add constraints once regions are resolved\n         debug!("}, {"sha": "300ea9bb49785177baf8a763cd64aa5e23b0cb4c", "filename": "src/librustc/ty/print/pretty.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8f34a50cc5bb94f7d3381ec00ed273af68724a4b/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f34a50cc5bb94f7d3381ec00ed273af68724a4b/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs?ref=8f34a50cc5bb94f7d3381ec00ed273af68724a4b", "patch": "@@ -1441,7 +1441,6 @@ impl<F: fmt::Write> FmtPrinter<'_, 'gcx, 'tcx, F> {\n                     br\n                 }\n                 ty::BrAnon(_) |\n-                ty::BrFresh(_) |\n                 ty::BrEnv => {\n                     let name = loop {\n                         let name = name_by_region_index(region_index);"}, {"sha": "56d47a7f849cf6eec7c8888087bb29abb881ee67", "filename": "src/librustc/ty/structural_impls.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/8f34a50cc5bb94f7d3381ec00ed273af68724a4b/src%2Flibrustc%2Fty%2Fstructural_impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f34a50cc5bb94f7d3381ec00ed273af68724a4b/src%2Flibrustc%2Fty%2Fstructural_impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fstructural_impls.rs?ref=8f34a50cc5bb94f7d3381ec00ed273af68724a4b", "patch": "@@ -94,7 +94,6 @@ impl fmt::Debug for ty::BoundRegion {\n     fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {\n         match *self {\n             ty::BrAnon(n) => write!(f, \"BrAnon({:?})\", n),\n-            ty::BrFresh(n) => write!(f, \"BrFresh({:?})\", n),\n             ty::BrNamed(did, name) => {\n                 write!(f, \"BrNamed({:?}:{:?}, {})\",\n                         did.krate, did.index, name)"}, {"sha": "ddc4bd3f9f6c3c057cd918147a6eef1937be875e", "filename": "src/librustc/ty/sty.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/8f34a50cc5bb94f7d3381ec00ed273af68724a4b/src%2Flibrustc%2Fty%2Fsty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f34a50cc5bb94f7d3381ec00ed273af68724a4b/src%2Flibrustc%2Fty%2Fsty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fsty.rs?ref=8f34a50cc5bb94f7d3381ec00ed273af68724a4b", "patch": "@@ -56,9 +56,6 @@ pub enum BoundRegion {\n     /// the event of shadowing.\n     BrNamed(DefId, InternedString),\n \n-    /// Fresh bound identifiers created during GLB computations.\n-    BrFresh(u32),\n-\n     /// Anonymous region for the implicit env pointer parameter\n     /// to a closure\n     BrEnv,"}, {"sha": "0d452c99ea16853776aa04db9b3b9e42ebd16ca2", "filename": "src/librustc_mir/borrow_check/nll/region_infer/error_reporting/region_name.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8f34a50cc5bb94f7d3381ec00ed273af68724a4b/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fregion_infer%2Ferror_reporting%2Fregion_name.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f34a50cc5bb94f7d3381ec00ed273af68724a4b/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fregion_infer%2Ferror_reporting%2Fregion_name.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fregion_infer%2Ferror_reporting%2Fregion_name.rs?ref=8f34a50cc5bb94f7d3381ec00ed273af68724a4b", "patch": "@@ -274,7 +274,7 @@ impl<'tcx> RegionInferenceContext<'tcx> {\n                     }\n                 }\n \n-                ty::BoundRegion::BrAnon(_) | ty::BoundRegion::BrFresh(_) => None,\n+                ty::BoundRegion::BrAnon(_) => None,\n             },\n \n             ty::ReLateBound(..)"}, {"sha": "bd272c08b4d30716ee2414b4008231a31824bb37", "filename": "src/librustc_typeck/astconv.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8f34a50cc5bb94f7d3381ec00ed273af68724a4b/src%2Flibrustc_typeck%2Fastconv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f34a50cc5bb94f7d3381ec00ed273af68724a4b/src%2Flibrustc_typeck%2Fastconv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fastconv.rs?ref=8f34a50cc5bb94f7d3381ec00ed273af68724a4b", "patch": "@@ -2048,7 +2048,7 @@ impl<'o, 'gcx: 'tcx, 'tcx> dyn AstConv<'gcx, 'tcx> + 'o {\n         for br in late_bound_in_ret.difference(&late_bound_in_args) {\n             let lifetime_name = match *br {\n                 ty::BrNamed(_, name) => format!(\"lifetime `{}`,\", name),\n-                ty::BrAnon(_) | ty::BrFresh(_) | ty::BrEnv => \"an anonymous lifetime\".to_string(),\n+                ty::BrAnon(_) | ty::BrEnv => \"an anonymous lifetime\".to_string(),\n             };\n             let mut err = struct_span_err!(tcx.sess,\n                                            decl.output.span(),"}]}