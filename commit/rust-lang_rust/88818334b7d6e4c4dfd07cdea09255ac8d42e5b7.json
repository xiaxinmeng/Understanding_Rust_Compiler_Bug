{"sha": "88818334b7d6e4c4dfd07cdea09255ac8d42e5b7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg4ODE4MzM0YjdkNmU0YzRkZmQwN2NkZWEwOTI1NWFjOGQ0MmU1Yjc=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2011-12-16T16:06:13Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2011-12-16T16:06:45Z"}, "message": "update to not look at descs[], which is not necessarily valid\nif the input is a statically allocated type_desc", "tree": {"sha": "560919d1132cbc5e463056ad1070ca6f60562592", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/560919d1132cbc5e463056ad1070ca6f60562592"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/88818334b7d6e4c4dfd07cdea09255ac8d42e5b7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/88818334b7d6e4c4dfd07cdea09255ac8d42e5b7", "html_url": "https://github.com/rust-lang/rust/commit/88818334b7d6e4c4dfd07cdea09255ac8d42e5b7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/88818334b7d6e4c4dfd07cdea09255ac8d42e5b7/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "34283c6a7863d5d69641f5c39422db70fe6c862a", "url": "https://api.github.com/repos/rust-lang/rust/commits/34283c6a7863d5d69641f5c39422db70fe6c862a", "html_url": "https://github.com/rust-lang/rust/commit/34283c6a7863d5d69641f5c39422db70fe6c862a"}], "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "97e1321c02d933d0d79f4bec6cf97e161a974292", "filename": "src/rt/rust_upcall.cpp", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/88818334b7d6e4c4dfd07cdea09255ac8d42e5b7/src%2Frt%2Frust_upcall.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/88818334b7d6e4c4dfd07cdea09255ac8d42e5b7/src%2Frt%2Frust_upcall.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_upcall.cpp?ref=88818334b7d6e4c4dfd07cdea09255ac8d42e5b7", "patch": "@@ -224,21 +224,23 @@ void upcall_s_create_shared_type_desc(s_create_shared_type_desc_args *args)\n \n     // Copy the main part of the type descriptor:\n     const type_desc *td = args->td;\n-    int n_descs = td->n_descs;\n-    size_t sz = sizeof(type_desc) + sizeof(type_desc*) * n_descs;\n+    int n_params = td->n_params;\n+    size_t sz = sizeof(type_desc) + sizeof(type_desc*) * n_params;\n     args->res = (type_desc*) task->kernel->malloc(sz, \"create_shared_type_desc\");\n     memcpy(args->res, td, sizeof(type_desc));\n \n     // Recursively copy any referenced descriptors:\n-    if (n_descs == 0) {\n+    if (n_params == 0) {\n         args->res->first_param = NULL;\n     } else {\n         args->res->first_param = &args->res->descs[1];\n         args->res->descs[0] = args->res;\n-        for (int i = 1; i < n_descs; i++) {\n-            s_create_shared_type_desc_args rec_args = { td->descs[i], 0 };\n+        for (int i = 0; i < n_params; i++) {\n+            s_create_shared_type_desc_args rec_args = {\n+                td->first_param[i], 0\n+            };\n             upcall_s_create_shared_type_desc(&rec_args);\n-            args->res->descs[i] = rec_args.res;\n+            args->res->first_param[i] = rec_args.res;\n         }\n     }\n }\n@@ -260,8 +262,8 @@ void upcall_s_free_shared_type_desc(type_desc *td)\n     LOG_UPCALL_ENTRY(task);\n \n     // Recursively free any referenced descriptors:\n-    for (unsigned i = 1; i < td->n_descs; i++) {\n-        upcall_s_free_shared_type_desc((type_desc*) td->descs[i]);\n+    for (unsigned i = 0; i < td->n_params; i++) {\n+        upcall_s_free_shared_type_desc((type_desc*) td->first_param[i]);\n     }\n \n     task->kernel->free(td);"}]}