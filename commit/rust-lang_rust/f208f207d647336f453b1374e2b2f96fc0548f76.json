{"sha": "f208f207d647336f453b1374e2b2f96fc0548f76", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYyMDhmMjA3ZDY0NzMzNmY0NTNiMTM3NGUyYjJmOTZmYzA1NDhmNzY=", "commit": {"author": {"name": "Ellen", "email": "supbscripter@gmail.com", "date": "2021-05-29T02:54:32Z"}, "committer": {"name": "Ellen", "email": "supbscripter@gmail.com", "date": "2021-05-29T02:54:32Z"}, "message": "Make lifetime ordering error pretty print const param defaults", "tree": {"sha": "4b06fc8866ecb0af89ff3f26f41de09f01ef6fd2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4b06fc8866ecb0af89ff3f26f41de09f01ef6fd2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f208f207d647336f453b1374e2b2f96fc0548f76", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f208f207d647336f453b1374e2b2f96fc0548f76", "html_url": "https://github.com/rust-lang/rust/commit/f208f207d647336f453b1374e2b2f96fc0548f76", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f208f207d647336f453b1374e2b2f96fc0548f76/comments", "author": {"login": "BoxyUwU", "id": 21149742, "node_id": "MDQ6VXNlcjIxMTQ5NzQy", "avatar_url": "https://avatars.githubusercontent.com/u/21149742?v=4", "gravatar_id": "", "url": "https://api.github.com/users/BoxyUwU", "html_url": "https://github.com/BoxyUwU", "followers_url": "https://api.github.com/users/BoxyUwU/followers", "following_url": "https://api.github.com/users/BoxyUwU/following{/other_user}", "gists_url": "https://api.github.com/users/BoxyUwU/gists{/gist_id}", "starred_url": "https://api.github.com/users/BoxyUwU/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/BoxyUwU/subscriptions", "organizations_url": "https://api.github.com/users/BoxyUwU/orgs", "repos_url": "https://api.github.com/users/BoxyUwU/repos", "events_url": "https://api.github.com/users/BoxyUwU/events{/privacy}", "received_events_url": "https://api.github.com/users/BoxyUwU/received_events", "type": "User", "site_admin": false}, "committer": {"login": "BoxyUwU", "id": 21149742, "node_id": "MDQ6VXNlcjIxMTQ5NzQy", "avatar_url": "https://avatars.githubusercontent.com/u/21149742?v=4", "gravatar_id": "", "url": "https://api.github.com/users/BoxyUwU", "html_url": "https://github.com/BoxyUwU", "followers_url": "https://api.github.com/users/BoxyUwU/followers", "following_url": "https://api.github.com/users/BoxyUwU/following{/other_user}", "gists_url": "https://api.github.com/users/BoxyUwU/gists{/gist_id}", "starred_url": "https://api.github.com/users/BoxyUwU/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/BoxyUwU/subscriptions", "organizations_url": "https://api.github.com/users/BoxyUwU/orgs", "repos_url": "https://api.github.com/users/BoxyUwU/repos", "events_url": "https://api.github.com/users/BoxyUwU/events{/privacy}", "received_events_url": "https://api.github.com/users/BoxyUwU/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f58631b4503b5cd34163cf9c3ff19dc3e0c8a09e", "url": "https://api.github.com/repos/rust-lang/rust/commits/f58631b4503b5cd34163cf9c3ff19dc3e0c8a09e", "html_url": "https://github.com/rust-lang/rust/commit/f58631b4503b5cd34163cf9c3ff19dc3e0c8a09e"}], "stats": {"total": 26, "additions": 21, "deletions": 5}, "files": [{"sha": "30aa51a121a80edfb2e45d05f680dfb98b750a3f", "filename": "compiler/rustc_ast_passes/src/ast_validation.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/f208f207d647336f453b1374e2b2f96fc0548f76/compiler%2Frustc_ast_passes%2Fsrc%2Fast_validation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f208f207d647336f453b1374e2b2f96fc0548f76/compiler%2Frustc_ast_passes%2Fsrc%2Fast_validation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_passes%2Fsrc%2Fast_validation.rs?ref=f208f207d647336f453b1374e2b2f96fc0548f76", "patch": "@@ -938,8 +938,11 @@ fn validate_generic_param_order(\n                 }\n                 GenericParamKind::Type { default: None } => (),\n                 GenericParamKind::Lifetime => (),\n-                // FIXME(const_generics_defaults)\n-                GenericParamKind::Const { ty: _, kw_span: _, default: _ } => (),\n+                GenericParamKind::Const { ty: _, kw_span: _, default: Some(default) } => {\n+                    ordered_params += \" = \";\n+                    ordered_params += &pprust::expr_to_string(&*default.value);\n+                }\n+                GenericParamKind::Const { ty: _, kw_span: _, default: None } => (),\n             }\n             first = false;\n         }\n@@ -959,7 +962,7 @@ fn validate_generic_param_order(\n             span,\n             &format!(\n                 \"reorder the parameters: lifetimes, {}\",\n-                if sess.features_untracked().const_generics {\n+                if sess.features_untracked().unordered_const_ty_params() {\n                     \"then consts and types\"\n                 } else {\n                     \"then types, then consts\""}, {"sha": "29d835e36c6eb74d9830d0cb2bcc25494235b0a3", "filename": "src/test/ui/const-generics/defaults/intermixed-lifetime.min.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f208f207d647336f453b1374e2b2f96fc0548f76/src%2Ftest%2Fui%2Fconst-generics%2Fdefaults%2Fintermixed-lifetime.min.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f208f207d647336f453b1374e2b2f96fc0548f76/src%2Ftest%2Fui%2Fconst-generics%2Fdefaults%2Fintermixed-lifetime.min.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fdefaults%2Fintermixed-lifetime.min.stderr?ref=f208f207d647336f453b1374e2b2f96fc0548f76", "patch": "@@ -2,13 +2,13 @@ error: lifetime parameters must be declared prior to const parameters\n   --> $DIR/intermixed-lifetime.rs:7:28\n    |\n LL | struct Foo<const N: usize, 'a, T = u32>(&'a (), T);\n-   |           -----------------^^---------- help: reorder the parameters: lifetimes, then types, then consts: `<'a, const N: usize, T = u32>`\n+   |           -----------------^^---------- help: reorder the parameters: lifetimes, then consts and types: `<'a, const N: usize, T = u32>`\n \n error: lifetime parameters must be declared prior to type parameters\n   --> $DIR/intermixed-lifetime.rs:10:37\n    |\n LL | struct Bar<const N: usize, T = u32, 'a>(&'a (), T);\n-   |           --------------------------^^- help: reorder the parameters: lifetimes, then types, then consts: `<'a, const N: usize, T = u32>`\n+   |           --------------------------^^- help: reorder the parameters: lifetimes, then consts and types: `<'a, const N: usize, T = u32>`\n \n error: aborting due to 2 previous errors\n "}, {"sha": "933eacb312dbf9a4c204b790bc8790fcba4e66d6", "filename": "src/test/ui/const-generics/defaults/param-order-err-pretty-prints-default.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f208f207d647336f453b1374e2b2f96fc0548f76/src%2Ftest%2Fui%2Fconst-generics%2Fdefaults%2Fparam-order-err-pretty-prints-default.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f208f207d647336f453b1374e2b2f96fc0548f76/src%2Ftest%2Fui%2Fconst-generics%2Fdefaults%2Fparam-order-err-pretty-prints-default.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fdefaults%2Fparam-order-err-pretty-prints-default.rs?ref=f208f207d647336f453b1374e2b2f96fc0548f76", "patch": "@@ -0,0 +1,5 @@\n+#![feature(const_generics_defaults)]\n+struct Foo<const M: usize = 10, 'a>(&'a u32);\n+//~^ Error lifetime parameters must be declared prior to const parameters\n+\n+fn main() {}"}, {"sha": "f50653fe9a19f6f322e614f198365ce6e1054e9c", "filename": "src/test/ui/const-generics/defaults/param-order-err-pretty-prints-default.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f208f207d647336f453b1374e2b2f96fc0548f76/src%2Ftest%2Fui%2Fconst-generics%2Fdefaults%2Fparam-order-err-pretty-prints-default.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f208f207d647336f453b1374e2b2f96fc0548f76/src%2Ftest%2Fui%2Fconst-generics%2Fdefaults%2Fparam-order-err-pretty-prints-default.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconst-generics%2Fdefaults%2Fparam-order-err-pretty-prints-default.stderr?ref=f208f207d647336f453b1374e2b2f96fc0548f76", "patch": "@@ -0,0 +1,8 @@\n+error: lifetime parameters must be declared prior to const parameters\n+  --> $DIR/param-order-err-pretty-prints-default.rs:2:33\n+   |\n+LL | struct Foo<const M: usize = 10, 'a>(&'a u32);\n+   |           ----------------------^^- help: reorder the parameters: lifetimes, then consts and types: `<'a, const M: usize = 10>`\n+\n+error: aborting due to previous error\n+"}]}