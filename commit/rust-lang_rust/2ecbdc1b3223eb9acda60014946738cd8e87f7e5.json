{"sha": "2ecbdc1b3223eb9acda60014946738cd8e87f7e5", "node_id": "C_kwDOAAsO6NoAKDJlY2JkYzFiMzIyM2ViOWFjZGE2MDAxNDk0NjczOGNkOGU4N2Y3ZTU", "commit": {"author": {"name": "Hood Chatham", "email": "roberthoodchatham@gmail.com", "date": "2022-06-08T17:04:02Z"}, "committer": {"name": "Hood Chatham", "email": "roberthoodchatham@gmail.com", "date": "2022-06-08T17:04:02Z"}, "message": "Don't use __gxx_personality_v0 in panic_unwind on emscripten target\n\nThis resolves #85821. See also the discussion here:\nhttps://github.com/emscripten-core/emscripten/issues/17128\n\nThe consensus seems to be that rust_eh_personality is never invoked.\nI patched __gxx_personality_v0 to log invocations and then ran\nvarious panic tests and it was never called, so this analysis matches\nwhat seems to happen in practice. This replaces the definition with\nan abort, modeled on the structured exception handling implementation.", "tree": {"sha": "d345239c8dece3fc5663005b82ad9a6bf4ec25d7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d345239c8dece3fc5663005b82ad9a6bf4ec25d7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2ecbdc1b3223eb9acda60014946738cd8e87f7e5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2ecbdc1b3223eb9acda60014946738cd8e87f7e5", "html_url": "https://github.com/rust-lang/rust/commit/2ecbdc1b3223eb9acda60014946738cd8e87f7e5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2ecbdc1b3223eb9acda60014946738cd8e87f7e5/comments", "author": {"login": "hoodmane", "id": 8739626, "node_id": "MDQ6VXNlcjg3Mzk2MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/8739626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hoodmane", "html_url": "https://github.com/hoodmane", "followers_url": "https://api.github.com/users/hoodmane/followers", "following_url": "https://api.github.com/users/hoodmane/following{/other_user}", "gists_url": "https://api.github.com/users/hoodmane/gists{/gist_id}", "starred_url": "https://api.github.com/users/hoodmane/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hoodmane/subscriptions", "organizations_url": "https://api.github.com/users/hoodmane/orgs", "repos_url": "https://api.github.com/users/hoodmane/repos", "events_url": "https://api.github.com/users/hoodmane/events{/privacy}", "received_events_url": "https://api.github.com/users/hoodmane/received_events", "type": "User", "site_admin": false}, "committer": {"login": "hoodmane", "id": 8739626, "node_id": "MDQ6VXNlcjg3Mzk2MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/8739626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hoodmane", "html_url": "https://github.com/hoodmane", "followers_url": "https://api.github.com/users/hoodmane/followers", "following_url": "https://api.github.com/users/hoodmane/following{/other_user}", "gists_url": "https://api.github.com/users/hoodmane/gists{/gist_id}", "starred_url": "https://api.github.com/users/hoodmane/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hoodmane/subscriptions", "organizations_url": "https://api.github.com/users/hoodmane/orgs", "repos_url": "https://api.github.com/users/hoodmane/repos", "events_url": "https://api.github.com/users/hoodmane/events{/privacy}", "received_events_url": "https://api.github.com/users/hoodmane/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1a97162cb245b5e2c7458c28859e3df779908c02", "url": "https://api.github.com/repos/rust-lang/rust/commits/1a97162cb245b5e2c7458c28859e3df779908c02", "html_url": "https://github.com/rust-lang/rust/commit/1a97162cb245b5e2c7458c28859e3df779908c02"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "e3a32a5581eaf519903c25f51b2e1e98ddd27f4d", "filename": "library/panic_unwind/src/emcc.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/2ecbdc1b3223eb9acda60014946738cd8e87f7e5/library%2Fpanic_unwind%2Fsrc%2Femcc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2ecbdc1b3223eb9acda60014946738cd8e87f7e5/library%2Fpanic_unwind%2Fsrc%2Femcc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fpanic_unwind%2Fsrc%2Femcc.rs?ref=2ecbdc1b3223eb9acda60014946738cd8e87f7e5", "patch": "@@ -105,6 +105,11 @@ extern \"C\" fn exception_cleanup(ptr: *mut libc::c_void) -> *mut libc::c_void {\n     }\n }\n \n+\n+// This is required by the compiler to exist (e.g., it's a lang item), but it's\n+// never actually called by the compiler.  Emscripten EH doesn't use a\n+// personality function at all, it instead uses __cxa_find_matching_catch.\n+// Wasm error handling would use __gxx_personality_wasm0.\n #[lang = \"eh_personality\"]\n unsafe extern \"C\" fn rust_eh_personality(\n     version: c_int,\n@@ -113,7 +118,7 @@ unsafe extern \"C\" fn rust_eh_personality(\n     exception_object: *mut uw::_Unwind_Exception,\n     context: *mut uw::_Unwind_Context,\n ) -> uw::_Unwind_Reason_Code {\n-    __gxx_personality_v0(version, actions, exception_class, exception_object, context)\n+    core::intrinsics::abort()\n }\n \n extern \"C\" {"}]}