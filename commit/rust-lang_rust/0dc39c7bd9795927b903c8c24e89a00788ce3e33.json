{"sha": "0dc39c7bd9795927b903c8c24e89a00788ce3e33", "node_id": "C_kwDOAAsO6NoAKDBkYzM5YzdiZDk3OTU5MjdiOTAzYzhjMjRlODlhMDA3ODhjZTNlMzM", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-08-09T22:00:24Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-08-09T22:00:24Z"}, "message": "Rollup merge of #99479 - Enselic:import-can-be-without-id, r=camelid\n\nrustdoc-json: Remove doc FIXME for Import::id and explain\n\nAlso add some test and refactor related code a bit.\n\n``@rustbot`` labels +A-rustdoc-json +T-rustdoc", "tree": {"sha": "681977b4c5a31876a8ebb1a4706c57fce40ab8a2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/681977b4c5a31876a8ebb1a4706c57fce40ab8a2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0dc39c7bd9795927b903c8c24e89a00788ce3e33", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi8tj4CRBK7hj4Ov3rIwAAVJ8IAEpi+pKpl+BmTpyiNuEPfh53\n4OxrBIkXc1R4NRtGE41vuzJXL0Rsxu+1VBHjtwAPdnwPuwysF7VQJ0Sxd41JuFSF\nR7DFnlftYBNWvfXl/LGirNJ7shuxxDIimWGSMz+wt6YxfdaF0n9XaDeSR+BGu46e\nKjYHxhmslGLtPD3NO9OJ97MECWrZKJRbTzFdTVMhygczO/srfepq5eAoozjQy7Yb\n0vn5qUXNjYpBsCPHqVQJ3EOxDPPQeUN4wPQ/KGLVavpwNZRIYMdyufUM2dfpX4Tx\nF6ztPGt4e/kpYjCEMDe955T9eq4R8xIFmu7yLCCNivrVeFWa94bjptk+Qxdx+8c=\n=U1+p\n-----END PGP SIGNATURE-----\n", "payload": "tree 681977b4c5a31876a8ebb1a4706c57fce40ab8a2\nparent 02fc0faa9a9165d8ac73385a765a33945cbb8641\nparent 1b6f6296e9a5d8881983c11115aa9e31ae80a512\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1660082424 +0200\ncommitter GitHub <noreply@github.com> 1660082424 +0200\n\nRollup merge of #99479 - Enselic:import-can-be-without-id, r=camelid\n\nrustdoc-json: Remove doc FIXME for Import::id and explain\n\nAlso add some test and refactor related code a bit.\n\n``@rustbot`` labels +A-rustdoc-json +T-rustdoc\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0dc39c7bd9795927b903c8c24e89a00788ce3e33", "html_url": "https://github.com/rust-lang/rust/commit/0dc39c7bd9795927b903c8c24e89a00788ce3e33", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0dc39c7bd9795927b903c8c24e89a00788ce3e33/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "02fc0faa9a9165d8ac73385a765a33945cbb8641", "url": "https://api.github.com/repos/rust-lang/rust/commits/02fc0faa9a9165d8ac73385a765a33945cbb8641", "html_url": "https://github.com/rust-lang/rust/commit/02fc0faa9a9165d8ac73385a765a33945cbb8641"}, {"sha": "1b6f6296e9a5d8881983c11115aa9e31ae80a512", "url": "https://api.github.com/repos/rust-lang/rust/commits/1b6f6296e9a5d8881983c11115aa9e31ae80a512", "html_url": "https://github.com/rust-lang/rust/commit/1b6f6296e9a5d8881983c11115aa9e31ae80a512"}], "stats": {"total": 43, "additions": 23, "deletions": 20}, "files": [{"sha": "4c21fd553289bd2a6066e8d01e86cf82b5483dbb", "filename": "src/librustdoc/json/conversions.rs", "status": "modified", "additions": 12, "deletions": 18, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/0dc39c7bd9795927b903c8c24e89a00788ce3e33/src%2Flibrustdoc%2Fjson%2Fconversions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0dc39c7bd9795927b903c8c24e89a00788ce3e33/src%2Flibrustdoc%2Fjson%2Fconversions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fjson%2Fconversions.rs?ref=0dc39c7bd9795927b903c8c24e89a00788ce3e33", "patch": "@@ -685,24 +685,18 @@ impl FromWithTcx<clean::Variant> for Variant {\n impl FromWithTcx<clean::Import> for Import {\n     fn from_tcx(import: clean::Import, tcx: TyCtxt<'_>) -> Self {\n         use clean::ImportKind::*;\n-        match import.kind {\n-            Simple(s) => Import {\n-                source: import.source.path.whole_name(),\n-                name: s.to_string(),\n-                id: import.source.did.map(ItemId::from).map(|i| from_item_id(i, tcx)),\n-                glob: false,\n-            },\n-            Glob => Import {\n-                source: import.source.path.whole_name(),\n-                name: import\n-                    .source\n-                    .path\n-                    .last_opt()\n-                    .unwrap_or_else(|| Symbol::intern(\"*\"))\n-                    .to_string(),\n-                id: import.source.did.map(ItemId::from).map(|i| from_item_id(i, tcx)),\n-                glob: true,\n-            },\n+        let (name, glob) = match import.kind {\n+            Simple(s) => (s.to_string(), false),\n+            Glob => (\n+                import.source.path.last_opt().unwrap_or_else(|| Symbol::intern(\"*\")).to_string(),\n+                true,\n+            ),\n+        };\n+        Import {\n+            source: import.source.path.whole_name(),\n+            name,\n+            id: import.source.did.map(ItemId::from).map(|i| from_item_id(i, tcx)),\n+            glob,\n         }\n     }\n }"}, {"sha": "ecdecadd2efb560833a9dc7d0bb466b4b36c9bc1", "filename": "src/rustdoc-json-types/lib.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/0dc39c7bd9795927b903c8c24e89a00788ce3e33/src%2Frustdoc-json-types%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0dc39c7bd9795927b903c8c24e89a00788ce3e33/src%2Frustdoc-json-types%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc-json-types%2Flib.rs?ref=0dc39c7bd9795927b903c8c24e89a00788ce3e33", "patch": "@@ -591,8 +591,11 @@ pub struct Import {\n     /// May be different from the last segment of `source` when renaming imports:\n     /// `use source as name;`\n     pub name: String,\n-    /// The ID of the item being imported.\n-    pub id: Option<Id>, // FIXME is this actually ever None?\n+    /// The ID of the item being imported. Will be `None` in case of re-exports of primitives:\n+    /// ```rust\n+    /// pub use i32 as my_i32;\n+    /// ```\n+    pub id: Option<Id>,\n     /// Whether this import uses a glob: `use source::*;`\n     pub glob: bool,\n }"}, {"sha": "878a1a4a79ce73ba069494d8f086993b2ecf4c7f", "filename": "src/test/rustdoc-json/primitive.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0dc39c7bd9795927b903c8c24e89a00788ce3e33/src%2Ftest%2Frustdoc-json%2Fprimitive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0dc39c7bd9795927b903c8c24e89a00788ce3e33/src%2Ftest%2Frustdoc-json%2Fprimitive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-json%2Fprimitive.rs?ref=0dc39c7bd9795927b903c8c24e89a00788ce3e33", "patch": "@@ -12,3 +12,9 @@ mod usize {}\n // @has - \"$.index[*][?(@.name=='checked_add')]\"\n // @!is - \"$.index[*][?(@.name=='checked_add')]\" $local_crate_id\n // @!has - \"$.index[*][?(@.name=='is_ascii_uppercase')]\"\n+\n+// @is - \"$.index[*][?(@.kind=='import' && @.inner.name=='my_i32')].inner.id\" null\n+pub use i32 as my_i32;\n+\n+// @is - \"$.index[*][?(@.kind=='import' && @.inner.name=='u32')].inner.id\" null\n+pub use u32;"}]}