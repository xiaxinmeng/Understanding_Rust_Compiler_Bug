{"sha": "ae33a9714e73dda15030894821b6819f781ed7ba", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFlMzNhOTcxNGU3M2RkYTE1MDMwODk0ODIxYjY4MTlmNzgxZWQ3YmE=", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2021-07-07T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2021-07-10T13:43:05Z"}, "message": "Set personality with LLVMSetPersonalityFn", "tree": {"sha": "5094a30eb1677b3791580accb761f860c78844b1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5094a30eb1677b3791580accb761f860c78844b1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ae33a9714e73dda15030894821b6819f781ed7ba", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ae33a9714e73dda15030894821b6819f781ed7ba", "html_url": "https://github.com/rust-lang/rust/commit/ae33a9714e73dda15030894821b6819f781ed7ba", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ae33a9714e73dda15030894821b6819f781ed7ba/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a84d1b21aea9863f0fc5f436b4982d145dade646", "url": "https://api.github.com/repos/rust-lang/rust/commits/a84d1b21aea9863f0fc5f436b4982d145dade646", "html_url": "https://github.com/rust-lang/rust/commit/a84d1b21aea9863f0fc5f436b4982d145dade646"}], "stats": {"total": 8, "additions": 6, "deletions": 2}, "files": [{"sha": "981ea95f2e06a832ad971d6d14f4f4a129de4a1a", "filename": "compiler/rustc_codegen_llvm/src/builder.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ae33a9714e73dda15030894821b6819f781ed7ba/compiler%2Frustc_codegen_llvm%2Fsrc%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ae33a9714e73dda15030894821b6819f781ed7ba/compiler%2Frustc_codegen_llvm%2Fsrc%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fbuilder.rs?ref=ae33a9714e73dda15030894821b6819f781ed7ba", "patch": "@@ -937,8 +937,12 @@ impl BuilderMethods<'a, 'tcx> for Builder<'a, 'll, 'tcx> {\n         pers_fn: &'ll Value,\n         num_clauses: usize,\n     ) -> &'ll Value {\n+        // Use LLVMSetPersonalityFn to set the personality. It supports arbitrary Consts while,\n+        // LLVMBuildLandingPad requires the argument to be a Function (as of LLVM 12). The\n+        // personality lives on the parent function anyway.\n+        self.set_personality_fn(pers_fn);\n         unsafe {\n-            llvm::LLVMBuildLandingPad(self.llbuilder, ty, pers_fn, num_clauses as c_uint, UNNAMED)\n+            llvm::LLVMBuildLandingPad(self.llbuilder, ty, None, num_clauses as c_uint, UNNAMED)\n         }\n     }\n "}, {"sha": "b513e83bd19941fa6d33b2790c67ab68c790ce8c", "filename": "compiler/rustc_codegen_llvm/src/llvm/ffi.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ae33a9714e73dda15030894821b6819f781ed7ba/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm%2Fffi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ae33a9714e73dda15030894821b6819f781ed7ba/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm%2Fffi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fllvm%2Fffi.rs?ref=ae33a9714e73dda15030894821b6819f781ed7ba", "patch": "@@ -1165,7 +1165,7 @@ extern \"C\" {\n     pub fn LLVMBuildLandingPad(\n         B: &Builder<'a>,\n         Ty: &'a Type,\n-        PersFn: &'a Value,\n+        PersFn: Option<&'a Value>,\n         NumClauses: c_uint,\n         Name: *const c_char,\n     ) -> &'a Value;"}]}