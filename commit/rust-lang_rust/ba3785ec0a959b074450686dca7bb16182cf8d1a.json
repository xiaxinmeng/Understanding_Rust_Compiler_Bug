{"sha": "ba3785ec0a959b074450686dca7bb16182cf8d1a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJhMzc4NWVjMGE5NTliMDc0NDUwNjg2ZGNhN2JiMTYxODJjZjhkMWE=", "commit": {"author": {"name": "Chandler Deng", "email": "chandde@microsoft.com", "date": "2019-05-16T22:05:56Z"}, "committer": {"name": "Chandler Deng", "email": "chandde@microsoft.com", "date": "2019-05-16T22:05:56Z"}, "message": "add targetarch for CodegenContext", "tree": {"sha": "3d08327db5ffd3a6bb9c4bfae8838c99381d7136", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3d08327db5ffd3a6bb9c4bfae8838c99381d7136"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ba3785ec0a959b074450686dca7bb16182cf8d1a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ba3785ec0a959b074450686dca7bb16182cf8d1a", "html_url": "https://github.com/rust-lang/rust/commit/ba3785ec0a959b074450686dca7bb16182cf8d1a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ba3785ec0a959b074450686dca7bb16182cf8d1a/comments", "author": {"login": "chandde", "id": 3334913, "node_id": "MDQ6VXNlcjMzMzQ5MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/3334913?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chandde", "html_url": "https://github.com/chandde", "followers_url": "https://api.github.com/users/chandde/followers", "following_url": "https://api.github.com/users/chandde/following{/other_user}", "gists_url": "https://api.github.com/users/chandde/gists{/gist_id}", "starred_url": "https://api.github.com/users/chandde/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chandde/subscriptions", "organizations_url": "https://api.github.com/users/chandde/orgs", "repos_url": "https://api.github.com/users/chandde/repos", "events_url": "https://api.github.com/users/chandde/events{/privacy}", "received_events_url": "https://api.github.com/users/chandde/received_events", "type": "User", "site_admin": false}, "committer": {"login": "chandde", "id": 3334913, "node_id": "MDQ6VXNlcjMzMzQ5MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/3334913?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chandde", "html_url": "https://github.com/chandde", "followers_url": "https://api.github.com/users/chandde/followers", "following_url": "https://api.github.com/users/chandde/following{/other_user}", "gists_url": "https://api.github.com/users/chandde/gists{/gist_id}", "starred_url": "https://api.github.com/users/chandde/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chandde/subscriptions", "organizations_url": "https://api.github.com/users/chandde/orgs", "repos_url": "https://api.github.com/users/chandde/repos", "events_url": "https://api.github.com/users/chandde/events{/privacy}", "received_events_url": "https://api.github.com/users/chandde/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b5febe72bbe10e3a327fa983b06d64354a0954e0", "url": "https://api.github.com/repos/rust-lang/rust/commits/b5febe72bbe10e3a327fa983b06d64354a0954e0", "html_url": "https://github.com/rust-lang/rust/commit/b5febe72bbe10e3a327fa983b06d64354a0954e0"}], "stats": {"total": 6, "additions": 4, "deletions": 2}, "files": [{"sha": "66ba95810a62516a109462f740955fed5c54afb8", "filename": "src/librustc_codegen_llvm/back/write.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ba3785ec0a959b074450686dca7bb16182cf8d1a/src%2Flibrustc_codegen_llvm%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba3785ec0a959b074450686dca7bb16182cf8d1a/src%2Flibrustc_codegen_llvm%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fback%2Fwrite.rs?ref=ba3785ec0a959b074450686dca7bb16182cf8d1a", "patch": "@@ -795,10 +795,10 @@ fn create_msvc_imps(\n         return\n     }\n     // The x86 ABI seems to require that leading underscores are added to symbol\n-    // names, so we need an extra underscore on 32-bit. There's also a leading\n+    // names, so we need an extra underscore on x86. There's also a leading\n     // '\\x01' here which disables LLVM's symbol mangling (e.g., no extra\n     // underscores added in front).\n-    let prefix = if cgcx.target_pointer_width == \"32\" {\n+    let prefix = if cgcx.target_arch == \"x86\" {\n         \"\\x01__imp__\"\n     } else {\n         \"\\x01__imp_\""}, {"sha": "1c793996c83db65cc1cc2960546f358197812253", "filename": "src/librustc_codegen_ssa/back/write.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ba3785ec0a959b074450686dca7bb16182cf8d1a/src%2Flibrustc_codegen_ssa%2Fback%2Fwrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba3785ec0a959b074450686dca7bb16182cf8d1a/src%2Flibrustc_codegen_ssa%2Fback%2Fwrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fback%2Fwrite.rs?ref=ba3785ec0a959b074450686dca7bb16182cf8d1a", "patch": "@@ -248,6 +248,7 @@ pub struct CodegenContext<B: WriteBackendMethods> {\n     pub tm_factory: TargetMachineFactory<B>,\n     pub msvc_imps_needed: bool,\n     pub target_pointer_width: String,\n+    pub target_arch: String,\n     pub debuginfo: config::DebugInfo,\n \n     // Number of cgus excluding the allocator/metadata modules\n@@ -1103,6 +1104,7 @@ fn start_executing_work<B: ExtraBackendMethods>(\n         total_cgus,\n         msvc_imps_needed: msvc_imps_needed(tcx),\n         target_pointer_width: tcx.sess.target.target.target_pointer_width.clone(),\n+        target_arch: tcx.sess.target.target.arch.clone(),\n         debuginfo: tcx.sess.opts.debuginfo,\n         assembler_cmd,\n     };"}]}