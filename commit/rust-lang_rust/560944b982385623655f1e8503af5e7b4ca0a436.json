{"sha": "560944b982385623655f1e8503af5e7b4ca0a436", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU2MDk0NGI5ODIzODU2MjM2NTVmMWU4NTAzYWY1ZTdiNGNhMGE0MzY=", "commit": {"author": {"name": "Clar Charr", "email": "clar@charr.xyz", "date": "2017-02-14T01:37:42Z"}, "committer": {"name": "Clar Charr", "email": "clar@charr.xyz", "date": "2017-03-10T19:57:57Z"}, "message": "Add From<Box<..>> implementations.", "tree": {"sha": "e633ec6c7e9789d4976b184e3e9dfd3720e2c4b4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e633ec6c7e9789d4976b184e3e9dfd3720e2c4b4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/560944b982385623655f1e8503af5e7b4ca0a436", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/560944b982385623655f1e8503af5e7b4ca0a436", "html_url": "https://github.com/rust-lang/rust/commit/560944b982385623655f1e8503af5e7b4ca0a436", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/560944b982385623655f1e8503af5e7b4ca0a436/comments", "author": {"login": "clarfonthey", "id": 15850505, "node_id": "MDQ6VXNlcjE1ODUwNTA1", "avatar_url": "https://avatars.githubusercontent.com/u/15850505?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clarfonthey", "html_url": "https://github.com/clarfonthey", "followers_url": "https://api.github.com/users/clarfonthey/followers", "following_url": "https://api.github.com/users/clarfonthey/following{/other_user}", "gists_url": "https://api.github.com/users/clarfonthey/gists{/gist_id}", "starred_url": "https://api.github.com/users/clarfonthey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clarfonthey/subscriptions", "organizations_url": "https://api.github.com/users/clarfonthey/orgs", "repos_url": "https://api.github.com/users/clarfonthey/repos", "events_url": "https://api.github.com/users/clarfonthey/events{/privacy}", "received_events_url": "https://api.github.com/users/clarfonthey/received_events", "type": "User", "site_admin": false}, "committer": {"login": "clarfonthey", "id": 15850505, "node_id": "MDQ6VXNlcjE1ODUwNTA1", "avatar_url": "https://avatars.githubusercontent.com/u/15850505?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clarfonthey", "html_url": "https://github.com/clarfonthey", "followers_url": "https://api.github.com/users/clarfonthey/followers", "following_url": "https://api.github.com/users/clarfonthey/following{/other_user}", "gists_url": "https://api.github.com/users/clarfonthey/gists{/gist_id}", "starred_url": "https://api.github.com/users/clarfonthey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clarfonthey/subscriptions", "organizations_url": "https://api.github.com/users/clarfonthey/orgs", "repos_url": "https://api.github.com/users/clarfonthey/repos", "events_url": "https://api.github.com/users/clarfonthey/events{/privacy}", "received_events_url": "https://api.github.com/users/clarfonthey/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f573db4f80c75f156df8a743f456bf087ec81dc2", "url": "https://api.github.com/repos/rust-lang/rust/commits/f573db4f80c75f156df8a743f456bf087ec81dc2", "html_url": "https://github.com/rust-lang/rust/commit/f573db4f80c75f156df8a743f456bf087ec81dc2"}], "stats": {"total": 157, "additions": 136, "deletions": 21}, "files": [{"sha": "13c99a2d59bede98379d3a78ab7d4693951dc14b", "filename": "src/libcollections/string.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibcollections%2Fstring.rs", "raw_url": "https://github.com/rust-lang/rust/raw/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibcollections%2Fstring.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fstring.rs?ref=560944b982385623655f1e8503af5e7b4ca0a436", "patch": "@@ -1974,6 +1974,22 @@ impl<'a> From<&'a str> for String {\n     }\n }\n \n+// note: test pulls in libstd, which causes errors here\n+#[cfg(not(test))]\n+#[stable(feature = \"string_from_box\", since = \"1.17.0\")]\n+impl From<Box<str>> for String {\n+    fn from(s: Box<str>) -> String {\n+        s.into_string()\n+    }\n+}\n+\n+#[stable(feature = \"box_from_str\", since = \"1.17.0\")]\n+impl Into<Box<str>> for String {\n+    fn into(self) -> Box<str> {\n+        self.into_boxed_str()\n+    }\n+}\n+\n #[stable(feature = \"string_from_cow_str\", since = \"1.14.0\")]\n impl<'a> From<Cow<'a, str>> for String {\n     fn from(s: Cow<'a, str>) -> String {"}, {"sha": "e4a6af33409e164847a9e48698e531137e8a8901", "filename": "src/libcollections/vec.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibcollections%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibcollections%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcollections%2Fvec.rs?ref=560944b982385623655f1e8503af5e7b4ca0a436", "patch": "@@ -1897,6 +1897,22 @@ impl<'a, T> From<Cow<'a, [T]>> for Vec<T> where [T]: ToOwned<Owned=Vec<T>> {\n     }\n }\n \n+// note: test pulls in libstd, which causes errors here\n+#[cfg(not(test))]\n+#[stable(feature = \"vec_from_box\", since = \"1.17.0\")]\n+impl<T> From<Box<[T]>> for Vec<T> {\n+    fn from(s: Box<[T]>) -> Vec<T> {\n+        s.into_vec()\n+    }\n+}\n+\n+#[stable(feature = \"box_from_vec\", since = \"1.17.0\")]\n+impl<T> Into<Box<[T]>> for Vec<T> {\n+    fn into(self) -> Box<[T]> {\n+        self.into_boxed_slice()\n+    }\n+}\n+\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n impl<'a> From<&'a str> for Vec<u8> {\n     fn from(s: &'a str) -> Vec<u8> {"}, {"sha": "a3f4154ba4af7a4f0d5c9e380ab0958eab209e33", "filename": "src/libstd/ffi/c_str.rs", "status": "modified", "additions": 26, "deletions": 7, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibstd%2Fffi%2Fc_str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibstd%2Fffi%2Fc_str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fffi%2Fc_str.rs?ref=560944b982385623655f1e8503af5e7b4ca0a436", "patch": "@@ -304,7 +304,7 @@ impl CString {\n     }\n \n     /// Converts this `CString` into a boxed `CStr`.\n-    #[unstable(feature = \"into_boxed_c_str\", issue = \"0\")]\n+    #[unstable(feature = \"into_boxed_c_str\", issue = \"40380\")]\n     pub fn into_boxed_c_str(self) -> Box<CStr> {\n         unsafe { mem::transmute(self.into_inner()) }\n     }\n@@ -394,6 +394,20 @@ impl<'a> From<&'a CStr> for Box<CStr> {\n     }\n }\n \n+#[stable(feature = \"c_string_from_box\", since = \"1.17.0\")]\n+impl From<Box<CStr>> for CString {\n+    fn from(s: Box<CStr>) -> CString {\n+        s.into_c_string()\n+    }\n+}\n+\n+#[stable(feature = \"box_from_c_string\", since = \"1.17.0\")]\n+impl Into<Box<CStr>> for CString {\n+    fn into(self) -> Box<CStr> {\n+        self.into_boxed_c_str()\n+    }\n+}\n+\n #[stable(feature = \"default_box_extra\", since = \"1.17.0\")]\n impl Default for Box<CStr> {\n     fn default() -> Box<CStr> {\n@@ -694,6 +708,12 @@ impl CStr {\n     pub fn to_string_lossy(&self) -> Cow<str> {\n         String::from_utf8_lossy(self.to_bytes())\n     }\n+\n+    /// Converts a `Box<CStr>` into a `CString` without copying or allocating.\n+    #[unstable(feature = \"into_boxed_c_str\", issue = \"40380\")]\n+    pub fn into_c_string(self: Box<CStr>) -> CString {\n+        unsafe { mem::transmute(self) }\n+    }\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n@@ -888,12 +908,11 @@ mod tests {\n     fn into_boxed() {\n         let orig: &[u8] = b\"Hello, world!\\0\";\n         let cstr = CStr::from_bytes_with_nul(orig).unwrap();\n-        let cstring = cstr.to_owned();\n-        let box1: Box<CStr> = Box::from(cstr);\n-        let box2 = cstring.into_boxed_c_str();\n-        assert_eq!(cstr, &*box1);\n-        assert_eq!(box1, box2);\n-        assert_eq!(&*box2, cstr);\n+        let boxed: Box<CStr> = Box::from(cstr);\n+        let cstring = cstr.to_owned().into_boxed_c_str().into_c_string();\n+        assert_eq!(cstr, &*boxed);\n+        assert_eq!(&*boxed, &*cstring);\n+        assert_eq!(&*cstring, cstr);\n     }\n \n     #[test]"}, {"sha": "c9c207d8b8eb4fcaec1259ed61a5b10e1ce0506a", "filename": "src/libstd/ffi/os_str.rs", "status": "modified", "additions": 27, "deletions": 7, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibstd%2Fffi%2Fos_str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibstd%2Fffi%2Fos_str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fffi%2Fos_str.rs?ref=560944b982385623655f1e8503af5e7b4ca0a436", "patch": "@@ -206,7 +206,7 @@ impl OsString {\n     }\n \n     /// Converts this `OsString` into a boxed `OsStr`.\n-    #[unstable(feature = \"into_boxed_os_str\", issue = \"0\")]\n+    #[unstable(feature = \"into_boxed_os_str\", issue = \"40380\")]\n     pub fn into_boxed_os_str(self) -> Box<OsStr> {\n         unsafe { mem::transmute(self.inner.into_box()) }\n     }\n@@ -442,6 +442,13 @@ impl OsStr {\n         self.inner.inner.len()\n     }\n \n+    /// Converts a `Box<OsStr>` into an `OsString` without copying or allocating.\n+    #[unstable(feature = \"into_boxed_os_str\", issue = \"40380\")]\n+    pub fn into_os_string(self: Box<OsStr>) -> OsString {\n+        let inner: Box<Slice> = unsafe { mem::transmute(self) };\n+        OsString { inner: Buf::from_box(inner) }\n+    }\n+\n     /// Gets the underlying byte representation.\n     ///\n     /// Note: it is *crucial* that this API is private, to avoid\n@@ -458,6 +465,20 @@ impl<'a> From<&'a OsStr> for Box<OsStr> {\n     }\n }\n \n+#[stable(feature = \"os_string_from_box\", since = \"1.17.0\")]\n+impl<'a> From<Box<OsStr>> for OsString {\n+    fn from(boxed: Box<OsStr>) -> OsString {\n+        boxed.into_os_string()\n+    }\n+}\n+\n+#[stable(feature = \"box_from_c_string\", since = \"1.17.0\")]\n+impl Into<Box<OsStr>> for OsString {\n+    fn into(self) -> Box<OsStr> {\n+        self.into_boxed_os_str()\n+    }\n+}\n+\n #[stable(feature = \"box_default_extra\", since = \"1.17.0\")]\n impl Default for Box<OsStr> {\n     fn default() -> Box<OsStr> {\n@@ -766,12 +787,11 @@ mod tests {\n     fn into_boxed() {\n         let orig = \"Hello, world!\";\n         let os_str = OsStr::new(orig);\n-        let os_string = os_str.to_owned();\n-        let box1: Box<OsStr> = Box::from(os_str);\n-        let box2 = os_string.into_boxed_os_str();\n-        assert_eq!(os_str, &*box1);\n-        assert_eq!(box1, box2);\n-        assert_eq!(&*box2, os_str);\n+        let boxed: Box<OsStr> = Box::from(os_str);\n+        let os_string = os_str.to_owned().into_boxed_os_str().into_os_string();\n+        assert_eq!(os_str, &*boxed);\n+        assert_eq!(&*boxed, &*os_string);\n+        assert_eq!(&*os_string, os_str);\n     }\n \n     #[test]"}, {"sha": "49b01bc0853732335af1274a22a92f45425f8157", "filename": "src/libstd/path.rs", "status": "modified", "additions": 27, "deletions": 7, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibstd%2Fpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibstd%2Fpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fpath.rs?ref=560944b982385623655f1e8503af5e7b4ca0a436", "patch": "@@ -1196,7 +1196,7 @@ impl PathBuf {\n     }\n \n     /// Converts this `PathBuf` into a boxed `Path`.\n-    #[unstable(feature = \"into_boxed_path\", issue = \"0\")]\n+    #[unstable(feature = \"into_boxed_path\", issue = \"40380\")]\n     pub fn into_boxed_path(self) -> Box<Path> {\n         unsafe { mem::transmute(self.inner.into_boxed_os_str()) }\n     }\n@@ -1210,6 +1210,20 @@ impl<'a> From<&'a Path> for Box<Path> {\n     }\n }\n \n+#[stable(feature = \"path_buf_from_box\", since = \"1.17.0\")]\n+impl<'a> From<Box<Path>> for PathBuf {\n+    fn from(boxed: Box<Path>) -> PathBuf {\n+        boxed.into_path_buf()\n+    }\n+}\n+\n+#[stable(feature = \"box_from_path_buf\", since = \"1.17.0\")]\n+impl Into<Box<Path>> for PathBuf {\n+    fn into(self) -> Box<Path> {\n+        self.into_boxed_path()\n+    }\n+}\n+\n #[stable(feature = \"box_default_extra\", since = \"1.17.0\")]\n impl Default for Box<Path> {\n     fn default() -> Box<Path> {\n@@ -2089,6 +2103,13 @@ impl Path {\n     pub fn is_dir(&self) -> bool {\n         fs::metadata(self).map(|m| m.is_dir()).unwrap_or(false)\n     }\n+\n+    /// Converts a `Box<Path>` into a `PathBuf` without copying or allocating.\n+    #[unstable(feature = \"into_boxed_path\", issue = \"40380\")]\n+    pub fn into_path_buf(self: Box<Path>) -> PathBuf {\n+        let inner: Box<OsStr> = unsafe { mem::transmute(self) };\n+        PathBuf { inner: OsString::from(inner) }\n+    }\n }\n \n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n@@ -3703,12 +3724,11 @@ mod tests {\n     fn into_boxed() {\n         let orig: &str = \"some/sort/of/path\";\n         let path = Path::new(orig);\n-        let path_buf = path.to_owned();\n-        let box1: Box<Path> = Box::from(path);\n-        let box2 = path_buf.into_boxed_path();\n-        assert_eq!(path, &*box1);\n-        assert_eq!(box1, box2);\n-        assert_eq!(&*box2, path);\n+        let boxed: Box<Path> = Box::from(path);\n+        let path_buf = path.to_owned().into_boxed_path().into_path_buf();\n+        assert_eq!(path, &*boxed);\n+        assert_eq!(&*boxed, &*path_buf);\n+        assert_eq!(&*path_buf, path);\n     }\n \n     #[test]"}, {"sha": "90b8289524e2659d4479eba7920dc7a3d12c940f", "filename": "src/libstd/sys/redox/os_str.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibstd%2Fsys%2Fredox%2Fos_str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibstd%2Fsys%2Fredox%2Fos_str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fredox%2Fos_str.rs?ref=560944b982385623655f1e8503af5e7b4ca0a436", "patch": "@@ -99,6 +99,12 @@ impl Buf {\n     pub fn into_box(self) -> Box<Slice> {\n         unsafe { mem::transmute(self.inner.into_boxed_slice()) }\n     }\n+\n+    #[inline]\n+    pub fn from_box(boxed: Box<Slice>) -> Buf {\n+        let inner: Box<[u8]> = unsafe { mem::transmute(boxed) };\n+        Buf { inner: inner.into_vec() }\n+    }\n }\n \n impl Slice {"}, {"sha": "225924168a5b20cd45037e673e87e194777d0155", "filename": "src/libstd/sys/unix/os_str.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibstd%2Fsys%2Funix%2Fos_str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibstd%2Fsys%2Funix%2Fos_str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Funix%2Fos_str.rs?ref=560944b982385623655f1e8503af5e7b4ca0a436", "patch": "@@ -99,6 +99,12 @@ impl Buf {\n     pub fn into_box(self) -> Box<Slice> {\n         unsafe { mem::transmute(self.inner.into_boxed_slice()) }\n     }\n+\n+    #[inline]\n+    pub fn from_box(boxed: Box<Slice>) -> Buf {\n+        let inner: Box<[u8]> = unsafe { mem::transmute(boxed) };\n+        Buf { inner: inner.into_vec() }\n+    }\n }\n \n impl Slice {"}, {"sha": "810b67b785b5cf8a67b8133be8794f63153b0deb", "filename": "src/libstd/sys/windows/os_str.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibstd%2Fsys%2Fwindows%2Fos_str.rs", "raw_url": "https://github.com/rust-lang/rust/raw/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibstd%2Fsys%2Fwindows%2Fos_str.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fwindows%2Fos_str.rs?ref=560944b982385623655f1e8503af5e7b4ca0a436", "patch": "@@ -93,6 +93,12 @@ impl Buf {\n     pub fn into_box(self) -> Box<Slice> {\n         unsafe { mem::transmute(self.inner.into_box()) }\n     }\n+\n+    #[inline]\n+    pub fn from_box(boxed: Box<Slice>) -> Buf {\n+        let inner: Box<Wtf8> = unsafe { mem::transmute(boxed) };\n+        Buf { inner: Wtf8Buf::from_box(inner) }\n+    }\n }\n \n impl Slice {"}, {"sha": "28cab10e8f9cc1b455ed4c93bde897277c16c29a", "filename": "src/libstd/sys_common/wtf8.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibstd%2Fsys_common%2Fwtf8.rs", "raw_url": "https://github.com/rust-lang/rust/raw/560944b982385623655f1e8503af5e7b4ca0a436/src%2Flibstd%2Fsys_common%2Fwtf8.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys_common%2Fwtf8.rs?ref=560944b982385623655f1e8503af5e7b4ca0a436", "patch": "@@ -346,6 +346,12 @@ impl Wtf8Buf {\n     pub fn into_box(self) -> Box<Wtf8> {\n         unsafe { mem::transmute(self.bytes.into_boxed_slice()) }\n     }\n+\n+    /// Converts a `Box<Wtf8>` into a `Wtf8Buf`.\n+    pub fn from_box(boxed: Box<Wtf8>) -> Wtf8Buf {\n+        let bytes: Box<[u8]> = unsafe { mem::transmute(boxed) };\n+        Wtf8Buf { bytes: bytes.into_vec() }\n+    }\n }\n \n /// Create a new WTF-8 string from an iterator of code points."}]}