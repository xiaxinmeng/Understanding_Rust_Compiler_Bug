{"sha": "e58629b990ee8ca2dc8fde0703fc7ca2b4b2a809", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU1ODYyOWI5OTBlZThjYTJkYzhmZGUwNzAzZmM3Y2EyYjRiMmE4MDk=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-04-19T21:51:59Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-04-19T21:51:59Z"}, "message": "wasm: Increase default stack size to 1MB\n\nThis commit increases the dfeault stack size allocated to the\nwasm32-unknown-unknown target to 1MB by default. Currently the default stack\nsize is one wasm page, or 64 kilobytes. This default stack is quite small and\nhas caused a stack overflow or two in the wild by accident.\n\nThe current \"best practice\" for fixing this is to pass `-Clink-args='-z\nstack-size=$bigger'` but that's not great nor always easy to do. A default of\n1MB matches more closely with other platforms where it's \"pretty big\" by\ndefault.\n\nNote that it was tested and if the users uses `-C link-args` to pass a custom\nstack size that's still resepected as lld seems to take the first argument, and\nwhere rustc is passing it will always be last.", "tree": {"sha": "9804eff0ea0b1f9c011f5fb89669d042eaa780a5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9804eff0ea0b1f9c011f5fb89669d042eaa780a5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e58629b990ee8ca2dc8fde0703fc7ca2b4b2a809", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e58629b990ee8ca2dc8fde0703fc7ca2b4b2a809", "html_url": "https://github.com/rust-lang/rust/commit/e58629b990ee8ca2dc8fde0703fc7ca2b4b2a809", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e58629b990ee8ca2dc8fde0703fc7ca2b4b2a809/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8830a0304327ba8c983555ac5d42cec0569c31bb", "url": "https://api.github.com/repos/rust-lang/rust/commits/8830a0304327ba8c983555ac5d42cec0569c31bb", "html_url": "https://github.com/rust-lang/rust/commit/8830a0304327ba8c983555ac5d42cec0569c31bb"}], "stats": {"total": 1, "additions": 1, "deletions": 0}, "files": [{"sha": "e001e809ee5f0a8d2cceb611ecc64f6664ca440b", "filename": "src/librustc_trans/back/linker.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e58629b990ee8ca2dc8fde0703fc7ca2b4b2a809/src%2Flibrustc_trans%2Fback%2Flinker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e58629b990ee8ca2dc8fde0703fc7ca2b4b2a809/src%2Flibrustc_trans%2Fback%2Flinker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Flinker.rs?ref=e58629b990ee8ca2dc8fde0703fc7ca2b4b2a809", "patch": "@@ -960,6 +960,7 @@ impl Linker for WasmLd {\n \n     fn finalize(&mut self) -> Command {\n         self.cmd.arg(\"--threads\");\n+        self.cmd.arg(\"-z\").arg(\"stack-size=1048576\");\n \n         // FIXME we probably shouldn't pass this but instead pass an explicit\n         // whitelist of symbols we'll allow to be undefined. Unfortunately"}]}