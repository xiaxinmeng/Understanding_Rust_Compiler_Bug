{"sha": "30cbdc7491bbf20958291c88cc1651409ee0eac4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMwY2JkYzc0OTFiYmYyMDk1ODI5MWM4OGNjMTY1MTQwOWVlMGVhYzQ=", "commit": {"author": {"name": "Lzu Tao", "email": "taolzu@gmail.com", "date": "2019-08-09T03:45:49Z"}, "committer": {"name": "Lzu Tao", "email": "taolzu@gmail.com", "date": "2019-08-09T03:55:30Z"}, "message": "Fix lint_single_char_pattern on raw string literal", "tree": {"sha": "5878ed52b21eb0e8277682346265e03f6645e53a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5878ed52b21eb0e8277682346265e03f6645e53a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/30cbdc7491bbf20958291c88cc1651409ee0eac4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/30cbdc7491bbf20958291c88cc1651409ee0eac4", "html_url": "https://github.com/rust-lang/rust/commit/30cbdc7491bbf20958291c88cc1651409ee0eac4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/30cbdc7491bbf20958291c88cc1651409ee0eac4/comments", "author": {"login": "tesuji", "id": 15225902, "node_id": "MDQ6VXNlcjE1MjI1OTAy", "avatar_url": "https://avatars.githubusercontent.com/u/15225902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tesuji", "html_url": "https://github.com/tesuji", "followers_url": "https://api.github.com/users/tesuji/followers", "following_url": "https://api.github.com/users/tesuji/following{/other_user}", "gists_url": "https://api.github.com/users/tesuji/gists{/gist_id}", "starred_url": "https://api.github.com/users/tesuji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tesuji/subscriptions", "organizations_url": "https://api.github.com/users/tesuji/orgs", "repos_url": "https://api.github.com/users/tesuji/repos", "events_url": "https://api.github.com/users/tesuji/events{/privacy}", "received_events_url": "https://api.github.com/users/tesuji/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tesuji", "id": 15225902, "node_id": "MDQ6VXNlcjE1MjI1OTAy", "avatar_url": "https://avatars.githubusercontent.com/u/15225902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tesuji", "html_url": "https://github.com/tesuji", "followers_url": "https://api.github.com/users/tesuji/followers", "following_url": "https://api.github.com/users/tesuji/following{/other_user}", "gists_url": "https://api.github.com/users/tesuji/gists{/gist_id}", "starred_url": "https://api.github.com/users/tesuji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tesuji/subscriptions", "organizations_url": "https://api.github.com/users/tesuji/orgs", "repos_url": "https://api.github.com/users/tesuji/repos", "events_url": "https://api.github.com/users/tesuji/events{/privacy}", "received_events_url": "https://api.github.com/users/tesuji/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d23e6b396a04475b1be6bd20a0afee3b3b0d8a31", "url": "https://api.github.com/repos/rust-lang/rust/commits/d23e6b396a04475b1be6bd20a0afee3b3b0d8a31", "html_url": "https://github.com/rust-lang/rust/commit/d23e6b396a04475b1be6bd20a0afee3b3b0d8a31"}], "stats": {"total": 35, "additions": 31, "deletions": 4}, "files": [{"sha": "19151a414c7e82d2deb759656a3bb9133d0bc8e0", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/30cbdc7491bbf20958291c88cc1651409ee0eac4/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/30cbdc7491bbf20958291c88cc1651409ee0eac4/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=30cbdc7491bbf20958291c88cc1651409ee0eac4", "patch": "@@ -2329,13 +2329,20 @@ fn lint_chars_last_cmp_with_unwrap<'a, 'tcx>(cx: &LateContext<'a, 'tcx>, info: &\n fn lint_single_char_pattern<'a, 'tcx>(cx: &LateContext<'a, 'tcx>, _expr: &'tcx hir::Expr, arg: &'tcx hir::Expr) {\n     if_chain! {\n         if let hir::ExprKind::Lit(lit) = &arg.node;\n-        if let ast::LitKind::Str(r, _) = lit.node;\n+        if let ast::LitKind::Str(r, style) = lit.node;\n         if r.as_str().len() == 1;\n         then {\n             let mut applicability = Applicability::MachineApplicable;\n             let snip = snippet_with_applicability(cx, arg.span, \"..\", &mut applicability);\n-            let c = &snip[1..snip.len() - 1];\n-            let hint = format!(\"'{}'\", if c == \"'\" { \"\\\\'\" } else { c });\n+            let ch = if let ast::StrStyle::Raw(nhash) = style {\n+                let nhash = nhash as usize;\n+                // for raw string: r##\"a\"##\n+                &snip[(nhash + 2)..(snip.len() - 1 - nhash)]\n+            } else {\n+                // for regular string: \"a\"\n+                &snip[1..(snip.len() - 1)]\n+            };\n+            let hint = format!(\"'{}'\", if ch == \"'\" { \"\\\\'\" } else { ch });\n             span_lint_and_sugg(\n                 cx,\n                 SINGLE_CHAR_PATTERN,"}, {"sha": "efbcf96665907aa833ad08d8f8b417e2ee0c4788", "filename": "tests/ui/single_char_pattern.fixed", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/30cbdc7491bbf20958291c88cc1651409ee0eac4/tests%2Fui%2Fsingle_char_pattern.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/30cbdc7491bbf20958291c88cc1651409ee0eac4/tests%2Fui%2Fsingle_char_pattern.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_char_pattern.fixed?ref=30cbdc7491bbf20958291c88cc1651409ee0eac4", "patch": "@@ -53,4 +53,8 @@ fn main() {\n     // Issue #3204\n     const S: &str = \"#\";\n     x.find(S);\n+\n+    // Raw string\n+    x.split('a');\n+    x.split('a');\n }"}, {"sha": "e71c47512b2acd6f746b0d3d3f40fd0aa9118be3", "filename": "tests/ui/single_char_pattern.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/30cbdc7491bbf20958291c88cc1651409ee0eac4/tests%2Fui%2Fsingle_char_pattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/30cbdc7491bbf20958291c88cc1651409ee0eac4/tests%2Fui%2Fsingle_char_pattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_char_pattern.rs?ref=30cbdc7491bbf20958291c88cc1651409ee0eac4", "patch": "@@ -53,4 +53,8 @@ fn main() {\n     // Issue #3204\n     const S: &str = \"#\";\n     x.find(S);\n+\n+    // Raw string\n+    x.split(r\"a\");\n+    x.split(r#\"a\"#);\n }"}, {"sha": "98d430fe0024824dc2d3bcbd66a6236cceeb9105", "filename": "tests/ui/single_char_pattern.stderr", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/30cbdc7491bbf20958291c88cc1651409ee0eac4/tests%2Fui%2Fsingle_char_pattern.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/30cbdc7491bbf20958291c88cc1651409ee0eac4/tests%2Fui%2Fsingle_char_pattern.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_char_pattern.stderr?ref=30cbdc7491bbf20958291c88cc1651409ee0eac4", "patch": "@@ -132,5 +132,17 @@ error: single-character string constant used as pattern\n LL |     x.starts_with(\"/x03\"); // issue #2996\n    |                   ^^^^^^ help: try using a char instead: `'/x03'`\n \n-error: aborting due to 22 previous errors\n+error: single-character string constant used as pattern\n+  --> $DIR/single_char_pattern.rs:58:13\n+   |\n+LL |     x.split(r\"a\");\n+   |             ^^^^ help: try using a char instead: `'a'`\n+\n+error: single-character string constant used as pattern\n+  --> $DIR/single_char_pattern.rs:59:13\n+   |\n+LL |     x.split(r#\"a\"#);\n+   |             ^^^^^^ help: try using a char instead: `'a'`\n+\n+error: aborting due to 24 previous errors\n "}]}