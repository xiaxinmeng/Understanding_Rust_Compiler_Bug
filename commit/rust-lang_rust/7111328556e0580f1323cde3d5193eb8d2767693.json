{"sha": "7111328556e0580f1323cde3d5193eb8d2767693", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcxMTEzMjg1NTZlMDU4MGYxMzIzY2RlM2Q1MTkzZWI4ZDI3Njc2OTM=", "commit": {"author": {"name": "Jonathan Goodman", "email": "goodmanjonathan@sbcglobal.net", "date": "2019-07-14T00:34:06Z"}, "committer": {"name": "Jonathan Goodman", "email": "goodmanjonathan@sbcglobal.net", "date": "2019-07-14T00:46:13Z"}, "message": "Don't drop DiagnosticBuilder if parsing fails\n\nIf the explicitly given type of a `self` parameter fails to parse correctly,\nwe need to propagate the error rather than dropping it and causing an ICE.\n\nFixes #62660.", "tree": {"sha": "c425dee1a7ec6f9f910b37d3b579e9d381774696", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c425dee1a7ec6f9f910b37d3b579e9d381774696"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7111328556e0580f1323cde3d5193eb8d2767693", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7111328556e0580f1323cde3d5193eb8d2767693", "html_url": "https://github.com/rust-lang/rust/commit/7111328556e0580f1323cde3d5193eb8d2767693", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7111328556e0580f1323cde3d5193eb8d2767693/comments", "author": {"login": "goodmanjonathan", "id": 3458868, "node_id": "MDQ6VXNlcjM0NTg4Njg=", "avatar_url": "https://avatars.githubusercontent.com/u/3458868?v=4", "gravatar_id": "", "url": "https://api.github.com/users/goodmanjonathan", "html_url": "https://github.com/goodmanjonathan", "followers_url": "https://api.github.com/users/goodmanjonathan/followers", "following_url": "https://api.github.com/users/goodmanjonathan/following{/other_user}", "gists_url": "https://api.github.com/users/goodmanjonathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/goodmanjonathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/goodmanjonathan/subscriptions", "organizations_url": "https://api.github.com/users/goodmanjonathan/orgs", "repos_url": "https://api.github.com/users/goodmanjonathan/repos", "events_url": "https://api.github.com/users/goodmanjonathan/events{/privacy}", "received_events_url": "https://api.github.com/users/goodmanjonathan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "goodmanjonathan", "id": 3458868, "node_id": "MDQ6VXNlcjM0NTg4Njg=", "avatar_url": "https://avatars.githubusercontent.com/u/3458868?v=4", "gravatar_id": "", "url": "https://api.github.com/users/goodmanjonathan", "html_url": "https://github.com/goodmanjonathan", "followers_url": "https://api.github.com/users/goodmanjonathan/followers", "following_url": "https://api.github.com/users/goodmanjonathan/following{/other_user}", "gists_url": "https://api.github.com/users/goodmanjonathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/goodmanjonathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/goodmanjonathan/subscriptions", "organizations_url": "https://api.github.com/users/goodmanjonathan/orgs", "repos_url": "https://api.github.com/users/goodmanjonathan/repos", "events_url": "https://api.github.com/users/goodmanjonathan/events{/privacy}", "received_events_url": "https://api.github.com/users/goodmanjonathan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "69656fa4cbafc378fd63f9186d93b0df3cdd9320", "url": "https://api.github.com/repos/rust-lang/rust/commits/69656fa4cbafc378fd63f9186d93b0df3cdd9320", "html_url": "https://github.com/rust-lang/rust/commit/69656fa4cbafc378fd63f9186d93b0df3cdd9320"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "aca63705f3d000370c20f61c79f182fa20756152", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7111328556e0580f1323cde3d5193eb8d2767693/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7111328556e0580f1323cde3d5193eb8d2767693/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=7111328556e0580f1323cde3d5193eb8d2767693", "patch": "@@ -1498,7 +1498,7 @@ impl<'a> Parser<'a> {\n         F: Fn(&token::Token) -> bool\n     {\n         let attrs = self.parse_arg_attributes()?;\n-        if let Ok(Some(mut arg)) = self.parse_self_arg() {\n+        if let Some(mut arg) = self.parse_self_arg()? {\n             arg.attrs = attrs.into();\n             return self.recover_bad_self_arg(arg, is_trait_item);\n         }"}, {"sha": "33c8a9fa328ca2ee696ec3e88907f6f14c1f0069", "filename": "src/test/ui/parser/issue-62660.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/7111328556e0580f1323cde3d5193eb8d2767693/src%2Ftest%2Fui%2Fparser%2Fissue-62660.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7111328556e0580f1323cde3d5193eb8d2767693/src%2Ftest%2Fui%2Fparser%2Fissue-62660.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-62660.rs?ref=7111328556e0580f1323cde3d5193eb8d2767693", "patch": "@@ -0,0 +1,11 @@\n+// Regression test for issue #62660: if a receiver's type does not\n+// successfully parse, emit the correct error instead of ICE-ing the compiler.\n+\n+struct Foo;\n+\n+impl Foo {\n+    pub fn foo(_: i32, self: Box<Self) {}\n+    //~^ ERROR expected one of `!`, `(`, `+`, `,`, `::`, `<`, or `>`, found `)`\n+}\n+\n+fn main() {}"}, {"sha": "3a8f6797b82fb7f5829ea2be7c137e147b26794b", "filename": "src/test/ui/parser/issue-62660.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/7111328556e0580f1323cde3d5193eb8d2767693/src%2Ftest%2Fui%2Fparser%2Fissue-62660.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7111328556e0580f1323cde3d5193eb8d2767693/src%2Ftest%2Fui%2Fparser%2Fissue-62660.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-62660.stderr?ref=7111328556e0580f1323cde3d5193eb8d2767693", "patch": "@@ -0,0 +1,8 @@\n+error: expected one of `!`, `(`, `+`, `,`, `::`, `<`, or `>`, found `)`\n+  --> $DIR/issue-62660.rs:7:38\n+   |\n+LL |     pub fn foo(_: i32, self: Box<Self) {}\n+   |                                      ^ expected one of 7 possible tokens here\n+\n+error: aborting due to previous error\n+"}]}