{"sha": "50ead683e9c5dbf0cd22325875e9623b5e913486", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUwZWFkNjgzZTljNWRiZjBjZDIyMzI1ODc1ZTk2MjNiNWU5MTM0ODY=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-08-05T04:32:59Z"}, "committer": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-08-05T04:32:59Z"}, "message": "Add regression test for issue-66768", "tree": {"sha": "0f3bea18e2fde3f73daf0ad9329bb67ea540957b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0f3bea18e2fde3f73daf0ad9329bb67ea540957b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/50ead683e9c5dbf0cd22325875e9623b5e913486", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEXmatGLoofN5+9u4rsJhshcDi2qEFAl8qNnsACgkQsJhshcDi\n2qEVJg/+LxOQZ53zvPbfyZ9YDNLH/SUeRNpy8lq7Up4/UU6ZJtgNy9xkjG6hMcIt\nucM8lZmvzVcIlKDHthdbtWqO5u7glgC15deQF115xPiS+YS5ZwPcdFHS+nis2htN\nMKAAbgPkY/B4xlrHJJqyV7Ub513pr61n55NOqxjI/yqVTdxWjq3HPQy2GdMd4+V1\n7OEoVVWu21S3hqD2+c4UbGiqp/ENfvL6plTMpWBG3XDQnIQmVKV6cCrMP3x9OuWg\nya+/nRao8a60mU/aPwFhcBVY+tAcKunAB1AT01jz3hukAJsKJNN+rwJq8SACAbBH\nwcE6WBMl4mv4x5Sta4qhmBb/PCO2lR5/uBhsUeZQENwZp89A9nHrXfyITUOPA12s\n1zIhlCFZEI1YmT/jnrjBLlxJTEyO/7GXsn1AoqOzJyoWQXLCM+Qi9t4zDtFyrt6A\nJ1UeAf3z1EBT1gDqNMa8WpVpgMEQ4ckg5leAKPuLjc9vbUWECsMKylaZCs2zVf9l\n8WdVgbCeji+XLBh2tyD3NJHWeqGmz9MF2VH6gcTqqlqV+NLZFRlWWcpc/j+8Ul53\niG6xhAgGbzznGGkVOQSrTWfZ3WbhFSFa5Rp8s2Vxpjdd1SilAyBj+M3XjYz5/wE+\nJ4v8Y8+GedoaQM5GXMweYWkRgqp1S7OEby5zaaOaCYlEjX4DPiI=\n=Hufx\n-----END PGP SIGNATURE-----", "payload": "tree 0f3bea18e2fde3f73daf0ad9329bb67ea540957b\nparent 32d14eba47ee8bb0b5edb04bcf652517f81c4cf5\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1596601979 +0900\ncommitter Yuki Okushi <huyuumi.dev@gmail.com> 1596601979 +0900\n\nAdd regression test for issue-66768\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/50ead683e9c5dbf0cd22325875e9623b5e913486", "html_url": "https://github.com/rust-lang/rust/commit/50ead683e9c5dbf0cd22325875e9623b5e913486", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/50ead683e9c5dbf0cd22325875e9623b5e913486/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "32d14eba47ee8bb0b5edb04bcf652517f81c4cf5", "url": "https://api.github.com/repos/rust-lang/rust/commits/32d14eba47ee8bb0b5edb04bcf652517f81c4cf5", "html_url": "https://github.com/rust-lang/rust/commit/32d14eba47ee8bb0b5edb04bcf652517f81c4cf5"}], "stats": {"total": 205, "additions": 205, "deletions": 0}, "files": [{"sha": "ce42c8b01cc322a3ea536bb4d47b2788f1a92255", "filename": "src/test/ui/issues/issue-66768.rs", "status": "added", "additions": 205, "deletions": 0, "changes": 205, "blob_url": "https://github.com/rust-lang/rust/blob/50ead683e9c5dbf0cd22325875e9623b5e913486/src%2Ftest%2Fui%2Fissues%2Fissue-66768.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50ead683e9c5dbf0cd22325875e9623b5e913486/src%2Ftest%2Fui%2Fissues%2Fissue-66768.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-66768.rs?ref=50ead683e9c5dbf0cd22325875e9623b5e913486", "patch": "@@ -0,0 +1,205 @@\n+// Regression test for #66768.\n+// check-pass\n+#![allow(dead_code)]\n+//-^ \"dead code\" is needed to reproduce the issue.\n+\n+use std::marker::PhantomData;\n+use std::ops::{Add, Mul};\n+\n+fn problematic_function<Space>(material_surface_element: Edge2dElement)\n+where\n+    DefaultAllocator: FiniteElementAllocator<DimU1, Space>,\n+{\n+    let _: Point2<f64> = material_surface_element.map_reference_coords().into();\n+}\n+\n+impl<T> ArrayLength<T> for UTerm {\n+    type ArrayType = ();\n+}\n+impl<T, N: ArrayLength<T>> ArrayLength<T> for UInt<N, B0> {\n+    type ArrayType = GenericArrayImplEven<T, N>;\n+}\n+impl<T, N: ArrayLength<T>> ArrayLength<T> for UInt<N, B1> {\n+    type ArrayType = GenericArrayImplOdd<T, N>;\n+}\n+impl<U> Add<U> for UTerm {\n+    type Output = U;\n+    fn add(self, _: U) -> Self::Output {\n+        unimplemented!()\n+    }\n+}\n+impl<Ul, Ur> Add<UInt<Ur, B1>> for UInt<Ul, B0>\n+where\n+    Ul: Add<Ur>,\n+{\n+    type Output = UInt<Sum<Ul, Ur>, B1>;\n+    fn add(self, _: UInt<Ur, B1>) -> Self::Output {\n+        unimplemented!()\n+    }\n+}\n+impl<U> Mul<U> for UTerm {\n+    type Output = UTerm;\n+    fn mul(self, _: U) -> Self {\n+        unimplemented!()\n+    }\n+}\n+impl<Ul, B, Ur> Mul<UInt<Ur, B>> for UInt<Ul, B0>\n+where\n+    Ul: Mul<UInt<Ur, B>>,\n+{\n+    type Output = UInt<Prod<Ul, UInt<Ur, B>>, B0>;\n+    fn mul(self, _: UInt<Ur, B>) -> Self::Output {\n+        unimplemented!()\n+    }\n+}\n+impl<Ul, B, Ur> Mul<UInt<Ur, B>> for UInt<Ul, B1>\n+where\n+    Ul: Mul<UInt<Ur, B>>,\n+    UInt<Prod<Ul, UInt<Ur, B>>, B0>: Add<UInt<Ur, B>>,\n+{\n+    type Output = Sum<UInt<Prod<Ul, UInt<Ur, B>>, B0>, UInt<Ur, B>>;\n+    fn mul(self, _: UInt<Ur, B>) -> Self::Output {\n+        unimplemented!()\n+    }\n+}\n+impl<N, R, C> Allocator<N, R, C> for DefaultAllocator\n+where\n+    R: DimName,\n+    C: DimName,\n+    R::Value: Mul<C::Value>,\n+    Prod<R::Value, C::Value>: ArrayLength<N>,\n+{\n+    type Buffer = ArrayStorage<N, R, C>;\n+    fn allocate_uninitialized(_: R, _: C) -> Self::Buffer {\n+        unimplemented!()\n+    }\n+    fn allocate_from_iterator<I>(_: R, _: C, _: I) -> Self::Buffer {\n+        unimplemented!()\n+    }\n+}\n+impl<N, C> Allocator<N, Dynamic, C> for DefaultAllocator {\n+    type Buffer = VecStorage<N, Dynamic, C>;\n+    fn allocate_uninitialized(_: Dynamic, _: C) -> Self::Buffer {\n+        unimplemented!()\n+    }\n+    fn allocate_from_iterator<I>(_: Dynamic, _: C, _: I) -> Self::Buffer {\n+        unimplemented!()\n+    }\n+}\n+impl DimName for DimU1 {\n+    type Value = U1;\n+    fn name() -> Self {\n+        unimplemented!()\n+    }\n+}\n+impl DimName for DimU2 {\n+    type Value = U2;\n+    fn name() -> Self {\n+        unimplemented!()\n+    }\n+}\n+impl<N, D> From<VectorN<N, D>> for Point<N, D>\n+where\n+    DefaultAllocator: Allocator<N, D>,\n+{\n+    fn from(_: VectorN<N, D>) -> Self {\n+        unimplemented!()\n+    }\n+}\n+impl<GeometryDim, NodalDim> FiniteElementAllocator<GeometryDim, NodalDim> for DefaultAllocator where\n+    DefaultAllocator: Allocator<f64, GeometryDim> + Allocator<f64, NodalDim>\n+{\n+}\n+impl ReferenceFiniteElement for Edge2dElement {\n+    type NodalDim = DimU1;\n+}\n+impl FiniteElement<DimU2> for Edge2dElement {\n+    fn map_reference_coords(&self) -> Vector2<f64> {\n+        unimplemented!()\n+    }\n+}\n+\n+type Owned<N, R, C> = <DefaultAllocator as Allocator<N, R, C>>::Buffer;\n+type MatrixMN<N, R, C> = Matrix<N, R, C, Owned<N, R, C>>;\n+type VectorN<N, D> = MatrixMN<N, D, DimU1>;\n+type Vector2<N> = VectorN<N, DimU2>;\n+type Point2<N> = Point<N, DimU2>;\n+type U1 = UInt<UTerm, B1>;\n+type U2 = UInt<UInt<UTerm, B1>, B0>;\n+type Sum<A, B> = <A as Add<B>>::Output;\n+type Prod<A, B> = <A as Mul<B>>::Output;\n+\n+struct GenericArray<T, U: ArrayLength<T>> {\n+    _data: U::ArrayType,\n+}\n+struct GenericArrayImplEven<T, U> {\n+    _parent2: U,\n+    _marker: T,\n+}\n+struct GenericArrayImplOdd<T, U> {\n+    _parent2: U,\n+    _data: T,\n+}\n+struct B0;\n+struct B1;\n+struct UTerm;\n+struct UInt<U, B> {\n+    _marker: PhantomData<(U, B)>,\n+}\n+struct DefaultAllocator;\n+struct Dynamic;\n+struct DimU1;\n+struct DimU2;\n+struct Matrix<N, R, C, S> {\n+    _data: S,\n+    _phantoms: PhantomData<(N, R, C)>,\n+}\n+struct ArrayStorage<N, R, C>\n+where\n+    R: DimName,\n+    C: DimName,\n+    R::Value: Mul<C::Value>,\n+    Prod<R::Value, C::Value>: ArrayLength<N>,\n+{\n+    _data: GenericArray<N, Prod<R::Value, C::Value>>,\n+}\n+struct VecStorage<N, R, C> {\n+    _data: N,\n+    _nrows: R,\n+    _ncols: C,\n+}\n+struct Point<N, D>\n+where\n+    DefaultAllocator: Allocator<N, D>,\n+{\n+    _coords: VectorN<N, D>,\n+}\n+struct Edge2dElement;\n+\n+trait ArrayLength<T> {\n+    type ArrayType;\n+}\n+trait Allocator<Scalar, R, C = DimU1> {\n+    type Buffer;\n+    fn allocate_uninitialized(nrows: R, ncols: C) -> Self::Buffer;\n+    fn allocate_from_iterator<I>(nrows: R, ncols: C, iter: I) -> Self::Buffer;\n+}\n+trait DimName {\n+    type Value;\n+    fn name() -> Self;\n+}\n+trait FiniteElementAllocator<GeometryDim, NodalDim>:\n+    Allocator<f64, GeometryDim> + Allocator<f64, NodalDim>\n+{\n+}\n+trait ReferenceFiniteElement {\n+    type NodalDim;\n+}\n+trait FiniteElement<GeometryDim>: ReferenceFiniteElement\n+where\n+    DefaultAllocator: FiniteElementAllocator<GeometryDim, Self::NodalDim>,\n+{\n+    fn map_reference_coords(&self) -> VectorN<f64, GeometryDim>;\n+}\n+\n+fn main() {}"}]}