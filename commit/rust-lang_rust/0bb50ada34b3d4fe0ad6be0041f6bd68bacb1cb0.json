{"sha": "0bb50ada34b3d4fe0ad6be0041f6bd68bacb1cb0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBiYjUwYWRhMzRiM2Q0ZmUwYWQ2YmUwMDQxZjZiZDY4YmFjYjFjYjA=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-06-28T08:27:19Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2019-06-29T12:31:54Z"}, "message": "make sure we catch alignment problems even with intrptrcast", "tree": {"sha": "b94022a439a4380a36b930be6fd6a17d56b4818a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b94022a439a4380a36b930be6fd6a17d56b4818a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0bb50ada34b3d4fe0ad6be0041f6bd68bacb1cb0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0bb50ada34b3d4fe0ad6be0041f6bd68bacb1cb0", "html_url": "https://github.com/rust-lang/rust/commit/0bb50ada34b3d4fe0ad6be0041f6bd68bacb1cb0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0bb50ada34b3d4fe0ad6be0041f6bd68bacb1cb0/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c1645f6c6582f6017cd8e330372bbaa21d95e3f3", "url": "https://api.github.com/repos/rust-lang/rust/commits/c1645f6c6582f6017cd8e330372bbaa21d95e3f3", "html_url": "https://github.com/rust-lang/rust/commit/c1645f6c6582f6017cd8e330372bbaa21d95e3f3"}], "stats": {"total": 18, "additions": 18, "deletions": 0}, "files": [{"sha": "5a35844d1256d98a5b5ea5326d4e68f163429c82", "filename": "tests/compile-fail/intptrcast_alignment_check.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/0bb50ada34b3d4fe0ad6be0041f6bd68bacb1cb0/tests%2Fcompile-fail%2Fintptrcast_alignment_check.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0bb50ada34b3d4fe0ad6be0041f6bd68bacb1cb0/tests%2Fcompile-fail%2Fintptrcast_alignment_check.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fintptrcast_alignment_check.rs?ref=0bb50ada34b3d4fe0ad6be0041f6bd68bacb1cb0", "patch": "@@ -0,0 +1,18 @@\n+// Validation makes this fail in the wrong place\n+// compile-flags: -Zmiri-disable-validation -Zmiri-seed=0000000000000000\n+\n+// Even with intptrcast and without validation, we want to be *sure* to catch bugs\n+// that arise from pointers being insufficiently aligned. The only way to achieve\n+// that is not not let programs exploit integer information for alignment, so here\n+// we test that this is indeed the case.\n+fn main() {\n+    let x = &mut [0u8; 3];\n+    let base_addr = x as *mut _ as usize;\n+    let u16_ref = unsafe { if base_addr % 2 == 0 {\n+        &mut *(base_addr as *mut u16)\n+    } else {\n+        &mut *((base_addr+1) as *mut u16)\n+    } };\n+    *u16_ref = 2; //~ ERROR tried to access memory with alignment 1, but alignment 2 is required\n+    println!(\"{:?}\", x);\n+}"}]}