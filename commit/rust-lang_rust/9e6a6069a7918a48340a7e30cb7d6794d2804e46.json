{"sha": "9e6a6069a7918a48340a7e30cb7d6794d2804e46", "node_id": "MDY6Q29tbWl0NzI0NzEyOjllNmE2MDY5YTc5MThhNDgzNDBhN2UzMGNiN2Q2Nzk0ZDI4MDRlNDY=", "commit": {"author": {"name": "Krishna Sai Veera Reddy", "email": "veerareddy@email.arizona.edu", "date": "2020-01-06T00:16:27Z"}, "committer": {"name": "Krishna Sai Veera Reddy", "email": "veerareddy@email.arizona.edu", "date": "2020-01-07T00:39:31Z"}, "message": "Add lint to detect usage of invalid atomic ordering\n\nDetect usage of invalid atomic ordering modes such as\n`Ordering::{Release, AcqRel}` in atomic loads and\n`Ordering::{Acquire, AcqRel}` in atomic stores.", "tree": {"sha": "b1eec855318ed83e28db1ecd660152105db64ab5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b1eec855318ed83e28db1ecd660152105db64ab5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9e6a6069a7918a48340a7e30cb7d6794d2804e46", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9e6a6069a7918a48340a7e30cb7d6794d2804e46", "html_url": "https://github.com/rust-lang/rust/commit/9e6a6069a7918a48340a7e30cb7d6794d2804e46", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9e6a6069a7918a48340a7e30cb7d6794d2804e46/comments", "author": {"login": "krishna-veerareddy", "id": 41484652, "node_id": "MDQ6VXNlcjQxNDg0NjUy", "avatar_url": "https://avatars.githubusercontent.com/u/41484652?v=4", "gravatar_id": "", "url": "https://api.github.com/users/krishna-veerareddy", "html_url": "https://github.com/krishna-veerareddy", "followers_url": "https://api.github.com/users/krishna-veerareddy/followers", "following_url": "https://api.github.com/users/krishna-veerareddy/following{/other_user}", "gists_url": "https://api.github.com/users/krishna-veerareddy/gists{/gist_id}", "starred_url": "https://api.github.com/users/krishna-veerareddy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/krishna-veerareddy/subscriptions", "organizations_url": "https://api.github.com/users/krishna-veerareddy/orgs", "repos_url": "https://api.github.com/users/krishna-veerareddy/repos", "events_url": "https://api.github.com/users/krishna-veerareddy/events{/privacy}", "received_events_url": "https://api.github.com/users/krishna-veerareddy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "krishna-veerareddy", "id": 41484652, "node_id": "MDQ6VXNlcjQxNDg0NjUy", "avatar_url": "https://avatars.githubusercontent.com/u/41484652?v=4", "gravatar_id": "", "url": "https://api.github.com/users/krishna-veerareddy", "html_url": "https://github.com/krishna-veerareddy", "followers_url": "https://api.github.com/users/krishna-veerareddy/followers", "following_url": "https://api.github.com/users/krishna-veerareddy/following{/other_user}", "gists_url": "https://api.github.com/users/krishna-veerareddy/gists{/gist_id}", "starred_url": "https://api.github.com/users/krishna-veerareddy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/krishna-veerareddy/subscriptions", "organizations_url": "https://api.github.com/users/krishna-veerareddy/orgs", "repos_url": "https://api.github.com/users/krishna-veerareddy/repos", "events_url": "https://api.github.com/users/krishna-veerareddy/events{/privacy}", "received_events_url": "https://api.github.com/users/krishna-veerareddy/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "62ff63917c96b13c6afc90bcddf0d33ea83b28d4", "url": "https://api.github.com/repos/rust-lang/rust/commits/62ff63917c96b13c6afc90bcddf0d33ea83b28d4", "html_url": "https://github.com/rust-lang/rust/commit/62ff63917c96b13c6afc90bcddf0d33ea83b28d4"}], "stats": {"total": 702, "additions": 700, "deletions": 2}, "files": [{"sha": "f60ac7d5267bef3c8180734463208c514e909c88", "filename": "CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9e6a6069a7918a48340a7e30cb7d6794d2804e46/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/9e6a6069a7918a48340a7e30cb7d6794d2804e46/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=9e6a6069a7918a48340a7e30cb7d6794d2804e46", "patch": "@@ -1134,6 +1134,7 @@ Released 2018-09-13\n [`integer_division`]: https://rust-lang.github.io/rust-clippy/master/index.html#integer_division\n [`into_iter_on_array`]: https://rust-lang.github.io/rust-clippy/master/index.html#into_iter_on_array\n [`into_iter_on_ref`]: https://rust-lang.github.io/rust-clippy/master/index.html#into_iter_on_ref\n+[`invalid_atomic_ordering`]: https://rust-lang.github.io/rust-clippy/master/index.html#invalid_atomic_ordering\n [`invalid_ref`]: https://rust-lang.github.io/rust-clippy/master/index.html#invalid_ref\n [`invalid_regex`]: https://rust-lang.github.io/rust-clippy/master/index.html#invalid_regex\n [`invalid_upcast_comparisons`]: https://rust-lang.github.io/rust-clippy/master/index.html#invalid_upcast_comparisons"}, {"sha": "c46d3e16bb17a1e3e10a2f1026dd80e557fb1935", "filename": "README.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9e6a6069a7918a48340a7e30cb7d6794d2804e46/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/9e6a6069a7918a48340a7e30cb7d6794d2804e46/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=9e6a6069a7918a48340a7e30cb7d6794d2804e46", "patch": "@@ -6,7 +6,7 @@\n \n A collection of lints to catch common mistakes and improve your [Rust](https://github.com/rust-lang/rust) code.\n \n-[There are 344 lints included in this crate!](https://rust-lang.github.io/rust-clippy/master/index.html)\n+[There are 345 lints included in this crate!](https://rust-lang.github.io/rust-clippy/master/index.html)\n \n We have a bunch of lint categories to allow you to choose how much Clippy is supposed to ~~annoy~~ help you:\n "}, {"sha": "3e7cd967f06d9816a2088ef26e6fc09a30bd22fb", "filename": "clippy_lints/src/atomic_ordering.rs", "status": "added", "additions": 102, "deletions": 0, "changes": 102, "blob_url": "https://github.com/rust-lang/rust/blob/9e6a6069a7918a48340a7e30cb7d6794d2804e46/clippy_lints%2Fsrc%2Fatomic_ordering.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e6a6069a7918a48340a7e30cb7d6794d2804e46/clippy_lints%2Fsrc%2Fatomic_ordering.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fatomic_ordering.rs?ref=9e6a6069a7918a48340a7e30cb7d6794d2804e46", "patch": "@@ -0,0 +1,102 @@\n+use crate::utils::{match_def_path, span_help_and_lint};\n+use if_chain::if_chain;\n+use rustc::declare_lint_pass;\n+use rustc::hir::def_id::DefId;\n+use rustc::hir::*;\n+use rustc::lint::{LateContext, LateLintPass, LintArray, LintPass};\n+use rustc::ty;\n+use rustc_session::declare_tool_lint;\n+\n+declare_clippy_lint! {\n+    /// **What it does:** Checks for usage of invalid atomic\n+    /// ordering in Atomic*::{load, store} calls.\n+    ///\n+    /// **Why is this bad?** Using an invalid atomic ordering\n+    /// will cause a panic at run-time.\n+    ///\n+    /// **Known problems:** None.\n+    ///\n+    /// **Example:**\n+    /// ```rust,ignore\n+    /// # use std::sync::atomic::{AtomicBool, Ordering};\n+    ///\n+    /// let x = AtomicBool::new(true);\n+    ///\n+    /// let _ = x.load(Ordering::Release);\n+    /// let _ = x.load(Ordering::AcqRel);\n+    ///\n+    /// x.store(false, Ordering::Acquire);\n+    /// x.store(false, Ordering::AcqRel);\n+    /// ```\n+    pub INVALID_ATOMIC_ORDERING,\n+    correctness,\n+    \"lint usage of invalid atomic ordering in atomic load/store calls\"\n+}\n+\n+declare_lint_pass!(AtomicOrdering => [INVALID_ATOMIC_ORDERING]);\n+\n+const ATOMIC_TYPES: [&str; 12] = [\n+    \"AtomicBool\",\n+    \"AtomicI8\",\n+    \"AtomicI16\",\n+    \"AtomicI32\",\n+    \"AtomicI64\",\n+    \"AtomicIsize\",\n+    \"AtomicPtr\",\n+    \"AtomicU8\",\n+    \"AtomicU16\",\n+    \"AtomicU32\",\n+    \"AtomicU64\",\n+    \"AtomicUsize\",\n+];\n+\n+fn type_is_atomic(cx: &LateContext<'_, '_>, expr: &Expr<'_>) -> bool {\n+    if let ty::Adt(&ty::AdtDef { did, .. }, _) = cx.tables.expr_ty(expr).kind {\n+        ATOMIC_TYPES\n+            .iter()\n+            .any(|ty| match_def_path(cx, did, &[\"core\", \"sync\", \"atomic\", ty]))\n+    } else {\n+        false\n+    }\n+}\n+\n+fn match_ordering_def_path(cx: &LateContext<'_, '_>, did: DefId, orderings: &[&str]) -> bool {\n+    orderings\n+        .iter()\n+        .any(|ordering| match_def_path(cx, did, &[\"core\", \"sync\", \"atomic\", \"Ordering\", ordering]))\n+}\n+\n+impl<'a, 'tcx> LateLintPass<'a, 'tcx> for AtomicOrdering {\n+    fn check_expr(&mut self, cx: &LateContext<'a, 'tcx>, expr: &'tcx Expr<'_>) {\n+        if_chain! {\n+            if let ExprKind::MethodCall(ref method_path, _, args) = &expr.kind;\n+            let method = method_path.ident.name.as_str();\n+            if type_is_atomic(cx, &args[0]);\n+            if method == \"load\" || method == \"store\";\n+            let ordering_arg = if method == \"load\" { &args[1] } else { &args[2] };\n+            if let ExprKind::Path(ref ordering_qpath) = ordering_arg.kind;\n+            if let Some(ordering_def_id) = cx.tables.qpath_res(ordering_qpath, ordering_arg.hir_id).opt_def_id();\n+            then {\n+                if method == \"load\" &&\n+                    match_ordering_def_path(cx, ordering_def_id, &[\"Release\", \"AcqRel\"]) {\n+                    span_help_and_lint(\n+                        cx,\n+                        INVALID_ATOMIC_ORDERING,\n+                        ordering_arg.span,\n+                        \"atomic loads cannot have `Release` and `AcqRel` ordering\",\n+                        \"consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\"\n+                    );\n+                } else if method == \"store\" &&\n+                    match_ordering_def_path(cx, ordering_def_id, &[\"Acquire\", \"AcqRel\"]) {\n+                    span_help_and_lint(\n+                        cx,\n+                        INVALID_ATOMIC_ORDERING,\n+                        ordering_arg.span,\n+                        \"atomic stores cannot have `Acquire` and `AcqRel` ordering\",\n+                        \"consider using ordering modes `Release`, `SeqCst` or `Relaxed`\"\n+                    );\n+                }\n+            }\n+        }\n+    }\n+}"}, {"sha": "6846730a41561ce5b476c0060b073315108d79c4", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9e6a6069a7918a48340a7e30cb7d6794d2804e46/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e6a6069a7918a48340a7e30cb7d6794d2804e46/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=9e6a6069a7918a48340a7e30cb7d6794d2804e46", "patch": "@@ -165,6 +165,7 @@ pub mod arithmetic;\n pub mod as_conversions;\n pub mod assertions_on_constants;\n pub mod assign_ops;\n+pub mod atomic_ordering;\n pub mod attrs;\n pub mod bit_mask;\n pub mod blacklisted_name;\n@@ -466,6 +467,7 @@ pub fn register_plugins(store: &mut lint::LintStore, sess: &Session, conf: &Conf\n         &assertions_on_constants::ASSERTIONS_ON_CONSTANTS,\n         &assign_ops::ASSIGN_OP_PATTERN,\n         &assign_ops::MISREFACTORED_ASSIGN_OP,\n+        &atomic_ordering::INVALID_ATOMIC_ORDERING,\n         &attrs::DEPRECATED_CFG_ATTR,\n         &attrs::DEPRECATED_SEMVER,\n         &attrs::EMPTY_LINE_AFTER_OUTER_ATTR,\n@@ -984,6 +986,7 @@ pub fn register_plugins(store: &mut lint::LintStore, sess: &Session, conf: &Conf\n     store.register_early_pass(|| box as_conversions::AsConversions);\n     store.register_early_pass(|| box utils::internal_lints::ProduceIce);\n     store.register_late_pass(|| box let_underscore::LetUnderscore);\n+    store.register_late_pass(|| box atomic_ordering::AtomicOrdering);\n \n     store.register_group(true, \"clippy::restriction\", Some(\"clippy_restriction\"), vec![\n         LintId::of(&arithmetic::FLOAT_ARITHMETIC),\n@@ -1089,6 +1092,7 @@ pub fn register_plugins(store: &mut lint::LintStore, sess: &Session, conf: &Conf\n         LintId::of(&assertions_on_constants::ASSERTIONS_ON_CONSTANTS),\n         LintId::of(&assign_ops::ASSIGN_OP_PATTERN),\n         LintId::of(&assign_ops::MISREFACTORED_ASSIGN_OP),\n+        LintId::of(&atomic_ordering::INVALID_ATOMIC_ORDERING),\n         LintId::of(&attrs::DEPRECATED_CFG_ATTR),\n         LintId::of(&attrs::DEPRECATED_SEMVER),\n         LintId::of(&attrs::UNKNOWN_CLIPPY_LINTS),\n@@ -1509,6 +1513,7 @@ pub fn register_plugins(store: &mut lint::LintStore, sess: &Session, conf: &Conf\n \n     store.register_group(true, \"clippy::correctness\", Some(\"clippy_correctness\"), vec![\n         LintId::of(&approx_const::APPROX_CONSTANT),\n+        LintId::of(&atomic_ordering::INVALID_ATOMIC_ORDERING),\n         LintId::of(&attrs::DEPRECATED_SEMVER),\n         LintId::of(&attrs::USELESS_ATTRIBUTE),\n         LintId::of(&bit_mask::BAD_BIT_MASK),"}, {"sha": "a69d090ca378059a29eeb348f9002366ef0da3c5", "filename": "src/lintlist/mod.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/9e6a6069a7918a48340a7e30cb7d6794d2804e46/src%2Flintlist%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e6a6069a7918a48340a7e30cb7d6794d2804e46/src%2Flintlist%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flintlist%2Fmod.rs?ref=9e6a6069a7918a48340a7e30cb7d6794d2804e46", "patch": "@@ -6,7 +6,7 @@ pub use lint::Lint;\n pub use lint::LINT_LEVELS;\n \n // begin lint list, do not remove this comment, it\u2019s used in `update_lints`\n-pub const ALL_LINTS: [Lint; 344] = [\n+pub const ALL_LINTS: [Lint; 345] = [\n     Lint {\n         name: \"absurd_extreme_comparisons\",\n         group: \"correctness\",\n@@ -833,6 +833,13 @@ pub const ALL_LINTS: [Lint; 344] = [\n         deprecation: None,\n         module: \"methods\",\n     },\n+    Lint {\n+        name: \"invalid_atomic_ordering\",\n+        group: \"correctness\",\n+        desc: \"lint usage of invalid atomic ordering in atomic load/store calls\",\n+        deprecation: None,\n+        module: \"atomic_ordering\",\n+    },\n     Lint {\n         name: \"invalid_regex\",\n         group: \"correctness\","}, {"sha": "2c354b5ef6ecb5748b01ed717636df1045deb30d", "filename": "tests/ui/atomic_ordering.rs", "status": "added", "additions": 196, "deletions": 0, "changes": 196, "blob_url": "https://github.com/rust-lang/rust/blob/9e6a6069a7918a48340a7e30cb7d6794d2804e46/tests%2Fui%2Fatomic_ordering.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e6a6069a7918a48340a7e30cb7d6794d2804e46/tests%2Fui%2Fatomic_ordering.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fatomic_ordering.rs?ref=9e6a6069a7918a48340a7e30cb7d6794d2804e46", "patch": "@@ -0,0 +1,196 @@\n+#![warn(clippy::invalid_atomic_ordering)]\n+\n+use std::sync::atomic::{\n+    AtomicBool, AtomicI16, AtomicI32, AtomicI64, AtomicI8, AtomicIsize, AtomicPtr, AtomicU16, AtomicU32, AtomicU64,\n+    AtomicU8, AtomicUsize, Ordering,\n+};\n+\n+fn main() {\n+    // `AtomicBool` test cases\n+    let x = AtomicBool::new(true);\n+\n+    // Allowed load ordering modes\n+    let _ = x.load(Ordering::Acquire);\n+    let _ = x.load(Ordering::SeqCst);\n+    let _ = x.load(Ordering::Relaxed);\n+\n+    // Disallowed load ordering modes\n+    let _ = x.load(Ordering::Release);\n+    let _ = x.load(Ordering::AcqRel);\n+\n+    // Allowed store ordering modes\n+    x.store(false, Ordering::Release);\n+    x.store(false, Ordering::SeqCst);\n+    x.store(false, Ordering::Relaxed);\n+\n+    // Disallowed store ordering modes\n+    x.store(false, Ordering::Acquire);\n+    x.store(false, Ordering::AcqRel);\n+\n+    // `AtomicI8` test cases\n+    let x = AtomicI8::new(0);\n+\n+    let _ = x.load(Ordering::Acquire);\n+    let _ = x.load(Ordering::SeqCst);\n+    let _ = x.load(Ordering::Relaxed);\n+    let _ = x.load(Ordering::Release);\n+    let _ = x.load(Ordering::AcqRel);\n+\n+    x.store(1, Ordering::Release);\n+    x.store(1, Ordering::SeqCst);\n+    x.store(1, Ordering::Relaxed);\n+    x.store(1, Ordering::Acquire);\n+    x.store(1, Ordering::AcqRel);\n+\n+    // `AtomicI16` test cases\n+    let x = AtomicI16::new(0);\n+\n+    let _ = x.load(Ordering::Acquire);\n+    let _ = x.load(Ordering::SeqCst);\n+    let _ = x.load(Ordering::Relaxed);\n+    let _ = x.load(Ordering::Release);\n+    let _ = x.load(Ordering::AcqRel);\n+\n+    x.store(1, Ordering::Release);\n+    x.store(1, Ordering::SeqCst);\n+    x.store(1, Ordering::Relaxed);\n+    x.store(1, Ordering::Acquire);\n+    x.store(1, Ordering::AcqRel);\n+\n+    // `AtomicI32` test cases\n+    let x = AtomicI32::new(0);\n+\n+    let _ = x.load(Ordering::Acquire);\n+    let _ = x.load(Ordering::SeqCst);\n+    let _ = x.load(Ordering::Relaxed);\n+    let _ = x.load(Ordering::Release);\n+    let _ = x.load(Ordering::AcqRel);\n+\n+    x.store(1, Ordering::Release);\n+    x.store(1, Ordering::SeqCst);\n+    x.store(1, Ordering::Relaxed);\n+    x.store(1, Ordering::Acquire);\n+    x.store(1, Ordering::AcqRel);\n+\n+    // `AtomicI64` test cases\n+    let x = AtomicI64::new(0);\n+\n+    let _ = x.load(Ordering::Acquire);\n+    let _ = x.load(Ordering::SeqCst);\n+    let _ = x.load(Ordering::Relaxed);\n+    let _ = x.load(Ordering::Release);\n+    let _ = x.load(Ordering::AcqRel);\n+\n+    x.store(1, Ordering::Release);\n+    x.store(1, Ordering::SeqCst);\n+    x.store(1, Ordering::Relaxed);\n+    x.store(1, Ordering::Acquire);\n+    x.store(1, Ordering::AcqRel);\n+\n+    // `AtomicIsize` test cases\n+    let x = AtomicIsize::new(0);\n+\n+    let _ = x.load(Ordering::Acquire);\n+    let _ = x.load(Ordering::SeqCst);\n+    let _ = x.load(Ordering::Relaxed);\n+    let _ = x.load(Ordering::Release);\n+    let _ = x.load(Ordering::AcqRel);\n+\n+    x.store(1, Ordering::Release);\n+    x.store(1, Ordering::SeqCst);\n+    x.store(1, Ordering::Relaxed);\n+    x.store(1, Ordering::Acquire);\n+    x.store(1, Ordering::AcqRel);\n+\n+    // `AtomicPtr` test cases\n+    let ptr = &mut 5;\n+    let other_ptr = &mut 10;\n+    let x = AtomicPtr::new(ptr);\n+\n+    let _ = x.load(Ordering::Acquire);\n+    let _ = x.load(Ordering::SeqCst);\n+    let _ = x.load(Ordering::Relaxed);\n+    let _ = x.load(Ordering::Release);\n+    let _ = x.load(Ordering::AcqRel);\n+\n+    x.store(other_ptr, Ordering::Release);\n+    x.store(other_ptr, Ordering::SeqCst);\n+    x.store(other_ptr, Ordering::Relaxed);\n+    x.store(other_ptr, Ordering::Acquire);\n+    x.store(other_ptr, Ordering::AcqRel);\n+\n+    // `AtomicU8` test cases\n+    let x = AtomicU8::new(0);\n+\n+    let _ = x.load(Ordering::Acquire);\n+    let _ = x.load(Ordering::SeqCst);\n+    let _ = x.load(Ordering::Relaxed);\n+    let _ = x.load(Ordering::Release);\n+    let _ = x.load(Ordering::AcqRel);\n+\n+    x.store(1, Ordering::Release);\n+    x.store(1, Ordering::SeqCst);\n+    x.store(1, Ordering::Relaxed);\n+    x.store(1, Ordering::Acquire);\n+    x.store(1, Ordering::AcqRel);\n+\n+    // `AtomicU16` test cases\n+    let x = AtomicU16::new(0);\n+\n+    let _ = x.load(Ordering::Acquire);\n+    let _ = x.load(Ordering::SeqCst);\n+    let _ = x.load(Ordering::Relaxed);\n+    let _ = x.load(Ordering::Release);\n+    let _ = x.load(Ordering::AcqRel);\n+\n+    x.store(1, Ordering::Release);\n+    x.store(1, Ordering::SeqCst);\n+    x.store(1, Ordering::Relaxed);\n+    x.store(1, Ordering::Acquire);\n+    x.store(1, Ordering::AcqRel);\n+\n+    // `AtomicU32` test cases\n+    let x = AtomicU32::new(0);\n+\n+    let _ = x.load(Ordering::Acquire);\n+    let _ = x.load(Ordering::SeqCst);\n+    let _ = x.load(Ordering::Relaxed);\n+    let _ = x.load(Ordering::Release);\n+    let _ = x.load(Ordering::AcqRel);\n+\n+    x.store(1, Ordering::Release);\n+    x.store(1, Ordering::SeqCst);\n+    x.store(1, Ordering::Relaxed);\n+    x.store(1, Ordering::Acquire);\n+    x.store(1, Ordering::AcqRel);\n+\n+    // `AtomicU64` test cases\n+    let x = AtomicU64::new(0);\n+\n+    let _ = x.load(Ordering::Acquire);\n+    let _ = x.load(Ordering::SeqCst);\n+    let _ = x.load(Ordering::Relaxed);\n+    let _ = x.load(Ordering::Release);\n+    let _ = x.load(Ordering::AcqRel);\n+\n+    x.store(1, Ordering::Release);\n+    x.store(1, Ordering::SeqCst);\n+    x.store(1, Ordering::Relaxed);\n+    x.store(1, Ordering::Acquire);\n+    x.store(1, Ordering::AcqRel);\n+\n+    // `AtomicUsize` test cases\n+    let x = AtomicUsize::new(0);\n+\n+    let _ = x.load(Ordering::Acquire);\n+    let _ = x.load(Ordering::SeqCst);\n+    let _ = x.load(Ordering::Relaxed);\n+    let _ = x.load(Ordering::Release);\n+    let _ = x.load(Ordering::AcqRel);\n+\n+    x.store(1, Ordering::Release);\n+    x.store(1, Ordering::SeqCst);\n+    x.store(1, Ordering::Relaxed);\n+    x.store(1, Ordering::Acquire);\n+    x.store(1, Ordering::AcqRel);\n+}"}, {"sha": "7485eef39feb3e3ce37718c0f46e6104c6165647", "filename": "tests/ui/atomic_ordering.stderr", "status": "added", "additions": 387, "deletions": 0, "changes": 387, "blob_url": "https://github.com/rust-lang/rust/blob/9e6a6069a7918a48340a7e30cb7d6794d2804e46/tests%2Fui%2Fatomic_ordering.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9e6a6069a7918a48340a7e30cb7d6794d2804e46/tests%2Fui%2Fatomic_ordering.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fatomic_ordering.stderr?ref=9e6a6069a7918a48340a7e30cb7d6794d2804e46", "patch": "@@ -0,0 +1,387 @@\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:18:20\n+   |\n+LL |     let _ = x.load(Ordering::Release);\n+   |                    ^^^^^^^^^^^^^^^^^\n+   |\n+   = note: `-D clippy::invalid-atomic-ordering` implied by `-D warnings`\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:19:20\n+   |\n+LL |     let _ = x.load(Ordering::AcqRel);\n+   |                    ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:27:20\n+   |\n+LL |     x.store(false, Ordering::Acquire);\n+   |                    ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:28:20\n+   |\n+LL |     x.store(false, Ordering::AcqRel);\n+   |                    ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:36:20\n+   |\n+LL |     let _ = x.load(Ordering::Release);\n+   |                    ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:37:20\n+   |\n+LL |     let _ = x.load(Ordering::AcqRel);\n+   |                    ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:42:16\n+   |\n+LL |     x.store(1, Ordering::Acquire);\n+   |                ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:43:16\n+   |\n+LL |     x.store(1, Ordering::AcqRel);\n+   |                ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:51:20\n+   |\n+LL |     let _ = x.load(Ordering::Release);\n+   |                    ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:52:20\n+   |\n+LL |     let _ = x.load(Ordering::AcqRel);\n+   |                    ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:57:16\n+   |\n+LL |     x.store(1, Ordering::Acquire);\n+   |                ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:58:16\n+   |\n+LL |     x.store(1, Ordering::AcqRel);\n+   |                ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:66:20\n+   |\n+LL |     let _ = x.load(Ordering::Release);\n+   |                    ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:67:20\n+   |\n+LL |     let _ = x.load(Ordering::AcqRel);\n+   |                    ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:72:16\n+   |\n+LL |     x.store(1, Ordering::Acquire);\n+   |                ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:73:16\n+   |\n+LL |     x.store(1, Ordering::AcqRel);\n+   |                ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:81:20\n+   |\n+LL |     let _ = x.load(Ordering::Release);\n+   |                    ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:82:20\n+   |\n+LL |     let _ = x.load(Ordering::AcqRel);\n+   |                    ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:87:16\n+   |\n+LL |     x.store(1, Ordering::Acquire);\n+   |                ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:88:16\n+   |\n+LL |     x.store(1, Ordering::AcqRel);\n+   |                ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:96:20\n+   |\n+LL |     let _ = x.load(Ordering::Release);\n+   |                    ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:97:20\n+   |\n+LL |     let _ = x.load(Ordering::AcqRel);\n+   |                    ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:102:16\n+   |\n+LL |     x.store(1, Ordering::Acquire);\n+   |                ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:103:16\n+   |\n+LL |     x.store(1, Ordering::AcqRel);\n+   |                ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:113:20\n+   |\n+LL |     let _ = x.load(Ordering::Release);\n+   |                    ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:114:20\n+   |\n+LL |     let _ = x.load(Ordering::AcqRel);\n+   |                    ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:119:24\n+   |\n+LL |     x.store(other_ptr, Ordering::Acquire);\n+   |                        ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:120:24\n+   |\n+LL |     x.store(other_ptr, Ordering::AcqRel);\n+   |                        ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:128:20\n+   |\n+LL |     let _ = x.load(Ordering::Release);\n+   |                    ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:129:20\n+   |\n+LL |     let _ = x.load(Ordering::AcqRel);\n+   |                    ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:134:16\n+   |\n+LL |     x.store(1, Ordering::Acquire);\n+   |                ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:135:16\n+   |\n+LL |     x.store(1, Ordering::AcqRel);\n+   |                ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:143:20\n+   |\n+LL |     let _ = x.load(Ordering::Release);\n+   |                    ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:144:20\n+   |\n+LL |     let _ = x.load(Ordering::AcqRel);\n+   |                    ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:149:16\n+   |\n+LL |     x.store(1, Ordering::Acquire);\n+   |                ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:150:16\n+   |\n+LL |     x.store(1, Ordering::AcqRel);\n+   |                ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:158:20\n+   |\n+LL |     let _ = x.load(Ordering::Release);\n+   |                    ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:159:20\n+   |\n+LL |     let _ = x.load(Ordering::AcqRel);\n+   |                    ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:164:16\n+   |\n+LL |     x.store(1, Ordering::Acquire);\n+   |                ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:165:16\n+   |\n+LL |     x.store(1, Ordering::AcqRel);\n+   |                ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:173:20\n+   |\n+LL |     let _ = x.load(Ordering::Release);\n+   |                    ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:174:20\n+   |\n+LL |     let _ = x.load(Ordering::AcqRel);\n+   |                    ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:179:16\n+   |\n+LL |     x.store(1, Ordering::Acquire);\n+   |                ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:180:16\n+   |\n+LL |     x.store(1, Ordering::AcqRel);\n+   |                ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:188:20\n+   |\n+LL |     let _ = x.load(Ordering::Release);\n+   |                    ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic loads cannot have `Release` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:189:20\n+   |\n+LL |     let _ = x.load(Ordering::AcqRel);\n+   |                    ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Acquire`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:194:16\n+   |\n+LL |     x.store(1, Ordering::Acquire);\n+   |                ^^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: atomic stores cannot have `Acquire` and `AcqRel` ordering\n+  --> $DIR/atomic_ordering.rs:195:16\n+   |\n+LL |     x.store(1, Ordering::AcqRel);\n+   |                ^^^^^^^^^^^^^^^^\n+   |\n+   = help: consider using ordering modes `Release`, `SeqCst` or `Relaxed`\n+\n+error: aborting due to 48 previous errors\n+"}]}