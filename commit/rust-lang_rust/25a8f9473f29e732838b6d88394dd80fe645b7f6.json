{"sha": "25a8f9473f29e732838b6d88394dd80fe645b7f6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI1YThmOTQ3M2YyOWU3MzI4MzhiNmQ4ODM5NGRkODBmZTY0NWI3ZjY=", "commit": {"author": {"name": "jumbatm", "email": "30644300+jumbatm@users.noreply.github.com", "date": "2019-11-23T04:52:40Z"}, "committer": {"name": "jumbatm", "email": "jumbatm@gmail.com", "date": "2020-01-16T19:57:39Z"}, "message": "Don't warn about snake case for field puns that don't introduce a new name.", "tree": {"sha": "dec0d777b5ebaec6864f03fa15c24dc57228c8b1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dec0d777b5ebaec6864f03fa15c24dc57228c8b1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/25a8f9473f29e732838b6d88394dd80fe645b7f6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/25a8f9473f29e732838b6d88394dd80fe645b7f6", "html_url": "https://github.com/rust-lang/rust/commit/25a8f9473f29e732838b6d88394dd80fe645b7f6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/25a8f9473f29e732838b6d88394dd80fe645b7f6/comments", "author": {"login": "jumbatm", "id": 30644300, "node_id": "MDQ6VXNlcjMwNjQ0MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/30644300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jumbatm", "html_url": "https://github.com/jumbatm", "followers_url": "https://api.github.com/users/jumbatm/followers", "following_url": "https://api.github.com/users/jumbatm/following{/other_user}", "gists_url": "https://api.github.com/users/jumbatm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jumbatm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jumbatm/subscriptions", "organizations_url": "https://api.github.com/users/jumbatm/orgs", "repos_url": "https://api.github.com/users/jumbatm/repos", "events_url": "https://api.github.com/users/jumbatm/events{/privacy}", "received_events_url": "https://api.github.com/users/jumbatm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jumbatm", "id": 30644300, "node_id": "MDQ6VXNlcjMwNjQ0MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/30644300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jumbatm", "html_url": "https://github.com/jumbatm", "followers_url": "https://api.github.com/users/jumbatm/followers", "following_url": "https://api.github.com/users/jumbatm/following{/other_user}", "gists_url": "https://api.github.com/users/jumbatm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jumbatm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jumbatm/subscriptions", "organizations_url": "https://api.github.com/users/jumbatm/orgs", "repos_url": "https://api.github.com/users/jumbatm/repos", "events_url": "https://api.github.com/users/jumbatm/events{/privacy}", "received_events_url": "https://api.github.com/users/jumbatm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "632387f38dfbac0f2b8b8900c840fff7f1fb888e", "url": "https://api.github.com/repos/rust-lang/rust/commits/632387f38dfbac0f2b8b8900c840fff7f1fb888e", "html_url": "https://github.com/rust-lang/rust/commit/632387f38dfbac0f2b8b8900c840fff7f1fb888e"}], "stats": {"total": 76, "additions": 75, "deletions": 1}, "files": [{"sha": "394da4a5bb0c151942a897913b39d92468a8c77d", "filename": "src/librustc_lint/nonstandard_style.rs", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/25a8f9473f29e732838b6d88394dd80fe645b7f6/src%2Flibrustc_lint%2Fnonstandard_style.rs", "raw_url": "https://github.com/rust-lang/rust/raw/25a8f9473f29e732838b6d88394dd80fe645b7f6/src%2Flibrustc_lint%2Fnonstandard_style.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Fnonstandard_style.rs?ref=25a8f9473f29e732838b6d88394dd80fe645b7f6", "patch": "@@ -350,7 +350,20 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for NonSnakeCase {\n     }\n \n     fn check_pat(&mut self, cx: &LateContext<'_, '_>, p: &hir::Pat<'_>) {\n-        if let &PatKind::Binding(_, _, ident, _) = &p.kind {\n+        if let &PatKind::Binding(_, hid, ident, _) = &p.kind {\n+            if let hir::Node::Pat(parent_pat) = cx.tcx.hir().get(cx.tcx.hir().get_parent_node(hid))\n+            {\n+                if let PatKind::Struct(_, field_pats, _) = &parent_pat.kind {\n+                    for field in field_pats.iter() {\n+                        if field.ident != ident {\n+                            // Only check if a new name has been introduced, to avoid warning\n+                            // on both the struct definition and this pattern.\n+                            self.check_snake_case(cx, \"variable\", &ident);\n+                        }\n+                    }\n+                    return;\n+                }\n+            }\n             self.check_snake_case(cx, \"variable\", &ident);\n         }\n     }"}, {"sha": "c2b81959f2cb81297184b217787b056408119655", "filename": "src/test/ui/lint/issue-66362-no-snake-case-warning-for-field-puns.rs", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/25a8f9473f29e732838b6d88394dd80fe645b7f6/src%2Ftest%2Fui%2Flint%2Fissue-66362-no-snake-case-warning-for-field-puns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/25a8f9473f29e732838b6d88394dd80fe645b7f6/src%2Ftest%2Fui%2Flint%2Fissue-66362-no-snake-case-warning-for-field-puns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fissue-66362-no-snake-case-warning-for-field-puns.rs?ref=25a8f9473f29e732838b6d88394dd80fe645b7f6", "patch": "@@ -0,0 +1,29 @@\n+#![deny(non_snake_case)]\n+#![allow(unused_variables)]\n+#![allow(dead_code)]\n+\n+enum Foo {\n+    Bad {\n+        lowerCamelCaseName: bool,\n+        //~^ ERROR structure field `lowerCamelCaseName` should have a snake case name\n+    },\n+    Good {\n+        snake_case_name: bool,\n+    },\n+}\n+\n+fn main() {\n+    let b = Foo::Bad { lowerCamelCaseName: true };\n+\n+    match b {\n+        Foo::Bad { lowerCamelCaseName } => {}\n+        Foo::Good { snake_case_name: lowerCamelCaseBinding } => { }\n+        //~^ ERROR variable `lowerCamelCaseBinding` should have a snake case name\n+    }\n+\n+    if let Foo::Good { snake_case_name: anotherLowerCamelCaseBinding } = b { }\n+    //~^ ERROR variable `anotherLowerCamelCaseBinding` should have a snake case name\n+\n+    if let Foo::Bad { lowerCamelCaseName: yetAnotherLowerCamelCaseBinding } = b { }\n+    //~^ ERROR variable `yetAnotherLowerCamelCaseBinding` should have a snake case name\n+}"}, {"sha": "68956f21e8f1b68096494deb3dc8842a0dbb83fe", "filename": "src/test/ui/lint/issue-66362-no-snake-case-warning-for-field-puns.stderr", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/25a8f9473f29e732838b6d88394dd80fe645b7f6/src%2Ftest%2Fui%2Flint%2Fissue-66362-no-snake-case-warning-for-field-puns.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/25a8f9473f29e732838b6d88394dd80fe645b7f6/src%2Ftest%2Fui%2Flint%2Fissue-66362-no-snake-case-warning-for-field-puns.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Fissue-66362-no-snake-case-warning-for-field-puns.stderr?ref=25a8f9473f29e732838b6d88394dd80fe645b7f6", "patch": "@@ -0,0 +1,32 @@\n+error: structure field `lowerCamelCaseName` should have a snake case name\n+  --> $DIR/issue-66362-no-snake-case-warning-for-field-puns.rs:7:9\n+   |\n+LL |         lowerCamelCaseName: bool,\n+   |         ^^^^^^^^^^^^^^^^^^ help: convert the identifier to snake case: `lower_camel_case_name`\n+   |\n+note: lint level defined here\n+  --> $DIR/issue-66362-no-snake-case-warning-for-field-puns.rs:1:9\n+   |\n+LL | #![deny(non_snake_case)]\n+   |         ^^^^^^^^^^^^^^\n+\n+error: variable `lowerCamelCaseBinding` should have a snake case name\n+  --> $DIR/issue-66362-no-snake-case-warning-for-field-puns.rs:20:38\n+   |\n+LL |         Foo::Good { snake_case_name: lowerCamelCaseBinding } => { }\n+   |                                      ^^^^^^^^^^^^^^^^^^^^^ help: convert the identifier to snake case: `lower_camel_case_binding`\n+\n+error: variable `anotherLowerCamelCaseBinding` should have a snake case name\n+  --> $DIR/issue-66362-no-snake-case-warning-for-field-puns.rs:24:41\n+   |\n+LL |     if let Foo::Good { snake_case_name: anotherLowerCamelCaseBinding } = b { }\n+   |                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert the identifier to snake case: `another_lower_camel_case_binding`\n+\n+error: variable `yetAnotherLowerCamelCaseBinding` should have a snake case name\n+  --> $DIR/issue-66362-no-snake-case-warning-for-field-puns.rs:27:43\n+   |\n+LL |     if let Foo::Bad { lowerCamelCaseName: yetAnotherLowerCamelCaseBinding } = b { }\n+   |                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: convert the identifier to snake case: `yet_another_lower_camel_case_binding`\n+\n+error: aborting due to 4 previous errors\n+"}]}