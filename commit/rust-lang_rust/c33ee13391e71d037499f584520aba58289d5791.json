{"sha": "c33ee13391e71d037499f584520aba58289d5791", "node_id": "C_kwDOAAsO6NoAKGMzM2VlMTMzOTFlNzFkMDM3NDk5ZjU4NDUyMGFiYTU4Mjg5ZDU3OTE", "commit": {"author": {"name": "Alex Gaynor", "email": "alex.gaynor@gmail.com", "date": "2022-11-05T16:30:28Z"}, "committer": {"name": "Alex Gaynor", "email": "alex.gaynor@gmail.com", "date": "2022-11-05T16:30:28Z"}, "message": "Remove linuxkernel targets\n\nThese are not used by the actual Rust-for-Linux project, so they're mostly just confusing.", "tree": {"sha": "8846dd6d9dc40847550d118a6b9c43acd74e546b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8846dd6d9dc40847550d118a6b9c43acd74e546b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c33ee13391e71d037499f584520aba58289d5791", "comment_count": 0, "verification": {"verified": false, "reason": "bad_cert", "signature": "-----BEGIN SIGNED MESSAGE-----\nMIIECAYJKoZIhvcNAQcCoIID+TCCA/UCAQExDTALBglghkgBZQMEAgEwCwYJKoZI\nhvcNAQcBoIICqjCCAqYwggIroAMCAQICFGniOcgT0Dwq5jIeg2bjRiW8dnihMAoG\nCCqGSM49BAMDMDcxFTATBgNVBAoTDHNpZ3N0b3JlLmRldjEeMBwGA1UEAxMVc2ln\nc3RvcmUtaW50ZXJtZWRpYXRlMB4XDTIyMTEwNTE2MzAzMloXDTIyMTEwNTE2NDAz\nMlowADBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABGGiQr/HAzIH8uYJl1A5/ucB\nfN9cLM1AAFiuWSOL/mHAa45FnWmc0RU4XHEF2dcGr0uT6VASYvtTM1TESTzaOH+j\nggFKMIIBRjAOBgNVHQ8BAf8EBAMCB4AwEwYDVR0lBAwwCgYIKwYBBQUHAwMwHQYD\nVR0OBBYEFKjUAud05ycY5vfCT48r8/3apeONMB8GA1UdIwQYMBaAFN/T6c9WJBGW\n+ajY6ShVosYuGGQ/MCMGA1UdEQEB/wQZMBeBFWFsZXguZ2F5bm9yQGdtYWlsLmNv\nbTAsBgorBgEEAYO/MAEBBB5odHRwczovL2dpdGh1Yi5jb20vbG9naW4vb2F1dGgw\ngYsGCisGAQQB1nkCBAIEfQR7AHkAdwDdPTBqxscRMmMZHhyZZzcCokpeuN48rf+H\ninKALynujgAAAYRIoSoBAAAEAwBIMEYCIQCJDDFWixq7MUbBF6hzQY4F/dSAozfJ\nWy1OIEpU8v3bkwIhAJDELZNu4M9pCHgssOzRhKbwX857VoxIvq1Z6RZC7/N0MAoG\nCCqGSM49BAMDA2kAMGYCMQDLOly5afKf8gTKrSHPIjR8jTuwBXmaAXnnRtvT1id8\nNG/OITp11fo2MzRb8VbqjS4CMQDZseDwfRgk9+ViYbqvyaZ5782fVFD152inaujq\nZ45KFb36+ep5htCKZ5lr4qXy1ssxggEkMIIBIAIBATBPMDcxFTATBgNVBAoTDHNp\nZ3N0b3JlLmRldjEeMBwGA1UEAxMVc2lnc3RvcmUtaW50ZXJtZWRpYXRlAhRp4jnI\nE9A8KuYyHoNm40YlvHZ4oTALBglghkgBZQMEAgGgaTAYBgkqhkiG9w0BCQMxCwYJ\nKoZIhvcNAQcBMBwGCSqGSIb3DQEJBTEPFw0yMjExMDUxNjMwMzJaMC8GCSqGSIb3\nDQEJBDEiBCDcF6/uBoPTjGlyUv+ogW+KvW3gpDr1N5RVq/0LksmOITAKBggqhkjO\nPQQDAgRGMEQCIF8O6ukR5UaibnCXK+YeJp3gqlW0YpNDyq6uC7/MI61+AiA4ksrP\nKn4VD16s/JWCimroiCTU4F2Fzhga8K7aDJNR7A==\n-----END SIGNED MESSAGE-----", "payload": "tree 8846dd6d9dc40847550d118a6b9c43acd74e546b\nparent b0f3940c35d565399dccf8c79f38147b40f2724a\nauthor Alex Gaynor <alex.gaynor@gmail.com> 1667665828 -0400\ncommitter Alex Gaynor <alex.gaynor@gmail.com> 1667665828 -0400\n\nRemove linuxkernel targets\n\nThese are not used by the actual Rust-for-Linux project, so they're mostly just confusing.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c33ee13391e71d037499f584520aba58289d5791", "html_url": "https://github.com/rust-lang/rust/commit/c33ee13391e71d037499f584520aba58289d5791", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c33ee13391e71d037499f584520aba58289d5791/comments", "author": {"login": "alex", "id": 772, "node_id": "MDQ6VXNlcjc3Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alex", "html_url": "https://github.com/alex", "followers_url": "https://api.github.com/users/alex/followers", "following_url": "https://api.github.com/users/alex/following{/other_user}", "gists_url": "https://api.github.com/users/alex/gists{/gist_id}", "starred_url": "https://api.github.com/users/alex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alex/subscriptions", "organizations_url": "https://api.github.com/users/alex/orgs", "repos_url": "https://api.github.com/users/alex/repos", "events_url": "https://api.github.com/users/alex/events{/privacy}", "received_events_url": "https://api.github.com/users/alex/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alex", "id": 772, "node_id": "MDQ6VXNlcjc3Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alex", "html_url": "https://github.com/alex", "followers_url": "https://api.github.com/users/alex/followers", "following_url": "https://api.github.com/users/alex/following{/other_user}", "gists_url": "https://api.github.com/users/alex/gists{/gist_id}", "starred_url": "https://api.github.com/users/alex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alex/subscriptions", "organizations_url": "https://api.github.com/users/alex/orgs", "repos_url": "https://api.github.com/users/alex/repos", "events_url": "https://api.github.com/users/alex/events{/privacy}", "received_events_url": "https://api.github.com/users/alex/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b0f3940c35d565399dccf8c79f38147b40f2724a", "url": "https://api.github.com/repos/rust-lang/rust/commits/b0f3940c35d565399dccf8c79f38147b40f2724a", "html_url": "https://github.com/rust-lang/rust/commit/b0f3940c35d565399dccf8c79f38147b40f2724a"}], "stats": {"total": 62, "additions": 5, "deletions": 57}, "files": [{"sha": "f41533a9548fe459aa0431e94a78ca210541d4af", "filename": "compiler/rustc_target/src/spec/linux_kernel_base.rs", "status": "removed", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/b0f3940c35d565399dccf8c79f38147b40f2724a/compiler%2Frustc_target%2Fsrc%2Fspec%2Flinux_kernel_base.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b0f3940c35d565399dccf8c79f38147b40f2724a/compiler%2Frustc_target%2Fsrc%2Fspec%2Flinux_kernel_base.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Flinux_kernel_base.rs?ref=b0f3940c35d565399dccf8c79f38147b40f2724a", "patch": "@@ -1,18 +0,0 @@\n-use crate::spec::TargetOptions;\n-use crate::spec::{FramePointer, PanicStrategy, RelocModel, RelroLevel, StackProbeType};\n-\n-pub fn opts() -> TargetOptions {\n-    TargetOptions {\n-        env: \"gnu\".into(),\n-        disable_redzone: true,\n-        panic_strategy: PanicStrategy::Abort,\n-        stack_probes: StackProbeType::X86,\n-        frame_pointer: FramePointer::Always,\n-        position_independent_executables: true,\n-        needs_plt: true,\n-        relro_level: RelroLevel::Full,\n-        relocation_model: RelocModel::Static,\n-\n-        ..Default::default()\n-    }\n-}"}, {"sha": "61de5d624cc9b1ff54a7ace4e2272d0af687435c", "filename": "compiler/rustc_target/src/spec/mod.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c33ee13391e71d037499f584520aba58289d5791/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c33ee13391e71d037499f584520aba58289d5791/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmod.rs?ref=c33ee13391e71d037499f584520aba58289d5791", "patch": "@@ -71,7 +71,6 @@ mod illumos_base;\n mod l4re_base;\n mod linux_base;\n mod linux_gnu_base;\n-mod linux_kernel_base;\n mod linux_musl_base;\n mod linux_uclibc_base;\n mod msvc_base;\n@@ -1003,7 +1002,7 @@ macro_rules! supported_targets {\n             $(\n                 #[test] // `#[test]`\n                 fn $module() {\n-                    tests_impl::test_target(super::$module::target(), $triple);\n+                    tests_impl::test_target(super::$module::target());\n                 }\n             )+\n         }\n@@ -1071,8 +1070,6 @@ supported_targets! {\n     (\"thumbv7neon-linux-androideabi\", thumbv7neon_linux_androideabi),\n     (\"aarch64-linux-android\", aarch64_linux_android),\n \n-    (\"x86_64-unknown-none-linuxkernel\", x86_64_unknown_none_linuxkernel),\n-\n     (\"aarch64-unknown-freebsd\", aarch64_unknown_freebsd),\n     (\"armv6-unknown-freebsd\", armv6_unknown_freebsd),\n     (\"armv7-unknown-freebsd\", armv7_unknown_freebsd),"}, {"sha": "e0ecf8037c3e59a4086582342b9a18342ae6a67c", "filename": "compiler/rustc_target/src/spec/tests/tests_impl.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c33ee13391e71d037499f584520aba58289d5791/compiler%2Frustc_target%2Fsrc%2Fspec%2Ftests%2Ftests_impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c33ee13391e71d037499f584520aba58289d5791/compiler%2Frustc_target%2Fsrc%2Fspec%2Ftests%2Ftests_impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Ftests%2Ftests_impl.rs?ref=c33ee13391e71d037499f584520aba58289d5791", "patch": "@@ -2,15 +2,15 @@ use super::super::*;\n use std::assert_matches::assert_matches;\n \n // Test target self-consistency and JSON encoding/decoding roundtrip.\n-pub(super) fn test_target(mut target: Target, triple: &str) {\n+pub(super) fn test_target(mut target: Target) {\n     let recycled_target = Target::from_json(target.to_json()).map(|(j, _)| j);\n     target.update_to_cli();\n-    target.check_consistency(triple);\n+    target.check_consistency();\n     assert_eq!(recycled_target, Ok(target));\n }\n \n impl Target {\n-    fn check_consistency(&self, triple: &str) {\n+    fn check_consistency(&self) {\n         assert_eq!(self.is_like_osx, self.vendor == \"apple\");\n         assert_eq!(self.is_like_solaris, self.os == \"solaris\" || self.os == \"illumos\");\n         assert_eq!(self.is_like_windows, self.os == \"windows\" || self.os == \"uefi\");\n@@ -129,8 +129,7 @@ impl Target {\n         if self.dynamic_linking && !(self.is_like_wasm && self.os != \"emscripten\") {\n             assert_eq!(self.relocation_model, RelocModel::Pic);\n         }\n-        // PIEs are supported but not enabled by default with linuxkernel target.\n-        if self.position_independent_executables && !triple.ends_with(\"-linuxkernel\") {\n+        if self.position_independent_executables {\n             assert_eq!(self.relocation_model, RelocModel::Pic);\n         }\n         // The UEFI targets do not support dynamic linking but still require PIC (#101377)."}, {"sha": "ebd9636ff5102094a7df96f5f1327d842f28e64e", "filename": "compiler/rustc_target/src/spec/x86_64_unknown_none_linuxkernel.rs", "status": "removed", "additions": 0, "deletions": 28, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/b0f3940c35d565399dccf8c79f38147b40f2724a/compiler%2Frustc_target%2Fsrc%2Fspec%2Fx86_64_unknown_none_linuxkernel.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b0f3940c35d565399dccf8c79f38147b40f2724a/compiler%2Frustc_target%2Fsrc%2Fspec%2Fx86_64_unknown_none_linuxkernel.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fx86_64_unknown_none_linuxkernel.rs?ref=b0f3940c35d565399dccf8c79f38147b40f2724a", "patch": "@@ -1,28 +0,0 @@\n-// This defines the amd64 target for the Linux Kernel. See the linux-kernel-base module for\n-// generic Linux kernel options.\n-\n-use crate::spec::{Cc, CodeModel, LinkerFlavor, Lld, Target};\n-\n-pub fn target() -> Target {\n-    let mut base = super::linux_kernel_base::opts();\n-    base.cpu = \"x86-64\".into();\n-    base.max_atomic_width = Some(64);\n-    base.features =\n-        \"-mmx,-sse,-sse2,-sse3,-ssse3,-sse4.1,-sse4.2,-3dnow,-3dnowa,-avx,-avx2,+soft-float\".into();\n-    base.code_model = Some(CodeModel::Kernel);\n-    base.add_pre_link_args(LinkerFlavor::Gnu(Cc::Yes, Lld::No), &[\"-m64\"]);\n-\n-    Target {\n-        // FIXME: Some dispute, the linux-on-clang folks think this should use\n-        // \"Linux\". We disagree because running *on* Linux is nothing like\n-        // running *as\" linux, and historically the \"os\" component as has always\n-        // been used to mean the \"on\" part.\n-        llvm_target: \"x86_64-unknown-none-elf\".into(),\n-        pointer_width: 64,\n-        data_layout: \"e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128\"\n-            .into(),\n-        arch: \"x86_64\".into(),\n-\n-        options: base,\n-    }\n-}"}, {"sha": "32c0ef3e11688ebff944201ee8891608eaf91939", "filename": "library/unwind/src/lib.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c33ee13391e71d037499f584520aba58289d5791/library%2Funwind%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c33ee13391e71d037499f584520aba58289d5791/library%2Funwind%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Funwind%2Fsrc%2Flib.rs?ref=c33ee13391e71d037499f584520aba58289d5791", "patch": "@@ -15,7 +15,6 @@ cfg_if::cfg_if! {\n         target_os = \"espidf\",\n     ))] {\n         // These \"unix\" family members do not have unwinder.\n-        // Note this also matches x86_64-unknown-none-linuxkernel.\n     } else if #[cfg(any(\n         unix,\n         windows,"}, {"sha": "46fee8abb23204f6ee3adf21a7c92420c5bc866f", "filename": "src/doc/rustc/src/platform-support.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c33ee13391e71d037499f584520aba58289d5791/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md", "raw_url": "https://github.com/rust-lang/rust/raw/c33ee13391e71d037499f584520aba58289d5791/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc%2Fsrc%2Fplatform-support.md?ref=c33ee13391e71d037499f584520aba58289d5791", "patch": "@@ -309,7 +309,6 @@ target | std | host | notes\n `x86_64-unknown-haiku` | \u2713 | \u2713 | 64-bit Haiku\n `x86_64-unknown-hermit` | \u2713 |  | HermitCore\n `x86_64-unknown-l4re-uclibc` | ? |  |\n-`x86_64-unknown-none-linuxkernel` | * |  | Linux kernel modules\n [`x86_64-unknown-openbsd`](platform-support/openbsd.md) | \u2713 | \u2713 | 64-bit OpenBSD\n [`x86_64-unknown-uefi`](platform-support/unknown-uefi.md) | * |  | 64-bit UEFI\n `x86_64-uwp-windows-gnu` | \u2713 |  |"}]}