{"sha": "2f5440c38ae9d6c63476e24fb9a7d8e6cf5833ae", "node_id": "C_kwDOAAsO6NoAKDJmNTQ0MGMzOGFlOWQ2YzYzNDc2ZTI0ZmI5YTdkOGU2Y2Y1ODMzYWU", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-04-12T03:28:48Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-04-12T03:28:48Z"}, "message": "Rollup merge of #110113 - jyn514:download-rustc-cross, r=albertlarsan68\n\nFix `x test ui --target foo` when download-rustc is enabled\n\nPreviously, we would never build the target std, only the host std:\n\n```\n; x t tests/ui/attributes --target wasm32-unknown-unknown\nBuilding bootstrap\n    Finished dev [unoptimized] target(s) in 0.02s\nBuilding stage0 library artifacts (x86_64-unknown-linux-gnu)\n    Finished release [optimized] target(s) in 0.08s\nBuilding tool compiletest (stage0)\n    Finished release [optimized] target(s) in 0.09s\nCheck compiletest suite=ui mode=ui (x86_64-unknown-linux-gnu -> wasm32-unknown-unknown)\nthread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: Error { depth: 0, inner: Io { path: Some(\"/home/jyn/src/rust2/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/wasm32-unknown-unknown/lib\"), err: Os { code: 2, kind: NotFound, message: \"No such file or directory\" } } }', src/tools/compiletest/src/main.rs:842:31\n```\n\nHelps with https://github.com/rust-lang/rust/issues/81930.", "tree": {"sha": "d6dd144dcca443180486af73ec18c17884b59b98", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d6dd144dcca443180486af73ec18c17884b59b98"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2f5440c38ae9d6c63476e24fb9a7d8e6cf5833ae", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkNiVwCRBK7hj4Ov3rIwAAHowIAK3YZZQ9Ahim/bu9WbjZ7pLa\nYqcLm2+pFoLUABG7x051wR6cP9HQ6HzIE+8ZOKvwX03q4S1mYMcePqXoMPzP2poj\nUh6LC2k1j/zPoqK4F1QNe1i7C18MQAYHEpmbjA781ZcUnUimdPwWE8ff3/ZnAHXW\n1PDWWBHHkrqzzH5RjTx3EzHFCRfxhoDUXTONieSGNRvUUn1/95+xeGMNH/JA6hKl\nZognUWsorMfabk5tr/xY3YWVeqRka1/eSmcDoKPmFMnZci4E8EaM72FI58/5YrQR\ndHnebpR8r1WbBtCP7lOuOJAqWQUtqWPfEveHpBhmbNWxtfHU5aZZZ8lCdf/wHSI=\n=Cj7Z\n-----END PGP SIGNATURE-----\n", "payload": "tree d6dd144dcca443180486af73ec18c17884b59b98\nparent 4f2f7fda1045645a1f750539bf16216ab4370799\nparent 47ff60dc09299b15102b4ebe0efd6a0446fe5a05\nauthor Michael Goulet <michael@errs.io> 1681270128 -0700\ncommitter GitHub <noreply@github.com> 1681270128 -0700\n\nRollup merge of #110113 - jyn514:download-rustc-cross, r=albertlarsan68\n\nFix `x test ui --target foo` when download-rustc is enabled\n\nPreviously, we would never build the target std, only the host std:\n\n```\n; x t tests/ui/attributes --target wasm32-unknown-unknown\nBuilding bootstrap\n    Finished dev [unoptimized] target(s) in 0.02s\nBuilding stage0 library artifacts (x86_64-unknown-linux-gnu)\n    Finished release [optimized] target(s) in 0.08s\nBuilding tool compiletest (stage0)\n    Finished release [optimized] target(s) in 0.09s\nCheck compiletest suite=ui mode=ui (x86_64-unknown-linux-gnu -> wasm32-unknown-unknown)\nthread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: Error { depth: 0, inner: Io { path: Some(\"/home/jyn/src/rust2/build/x86_64-unknown-linux-gnu/stage2/lib/rustlib/wasm32-unknown-unknown/lib\"), err: Os { code: 2, kind: NotFound, message: \"No such file or directory\" } } }', src/tools/compiletest/src/main.rs:842:31\n```\n\nHelps with https://github.com/rust-lang/rust/issues/81930.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2f5440c38ae9d6c63476e24fb9a7d8e6cf5833ae", "html_url": "https://github.com/rust-lang/rust/commit/2f5440c38ae9d6c63476e24fb9a7d8e6cf5833ae", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2f5440c38ae9d6c63476e24fb9a7d8e6cf5833ae/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4f2f7fda1045645a1f750539bf16216ab4370799", "url": "https://api.github.com/repos/rust-lang/rust/commits/4f2f7fda1045645a1f750539bf16216ab4370799", "html_url": "https://github.com/rust-lang/rust/commit/4f2f7fda1045645a1f750539bf16216ab4370799"}, {"sha": "47ff60dc09299b15102b4ebe0efd6a0446fe5a05", "url": "https://api.github.com/repos/rust-lang/rust/commits/47ff60dc09299b15102b4ebe0efd6a0446fe5a05", "html_url": "https://github.com/rust-lang/rust/commit/47ff60dc09299b15102b4ebe0efd6a0446fe5a05"}], "stats": {"total": 6, "additions": 3, "deletions": 3}, "files": [{"sha": "85d1c12cc6a09d936144b3b4eb70fbc42ce09b01", "filename": "src/bootstrap/compile.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/2f5440c38ae9d6c63476e24fb9a7d8e6cf5833ae/src%2Fbootstrap%2Fcompile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2f5440c38ae9d6c63476e24fb9a7d8e6cf5833ae/src%2Fbootstrap%2Fcompile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcompile.rs?ref=2f5440c38ae9d6c63476e24fb9a7d8e6cf5833ae", "patch": "@@ -83,11 +83,11 @@ impl Step for Std {\n         let target = self.target;\n         let compiler = self.compiler;\n \n-        // These artifacts were already copied (in `impl Step for Sysroot`).\n-        // Don't recompile them.\n+        // When using `download-rustc`, we already have artifacts for the host available\n+        // (they were copied in `impl Step for Sysroot`). Don't recompile them.\n         // NOTE: the ABI of the beta compiler is different from the ABI of the downloaded compiler,\n         // so its artifacts can't be reused.\n-        if builder.download_rustc() && compiler.stage != 0 {\n+        if builder.download_rustc() && compiler.stage != 0 && target == builder.build.build {\n             return;\n         }\n "}]}