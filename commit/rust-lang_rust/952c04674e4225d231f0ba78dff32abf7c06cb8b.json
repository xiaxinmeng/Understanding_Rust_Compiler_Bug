{"sha": "952c04674e4225d231f0ba78dff32abf7c06cb8b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk1MmMwNDY3NGU0MjI1ZDIzMWYwYmE3OGRmZjMyYWJmN2MwNmNiOGI=", "commit": {"author": {"name": "Takayuki Nakata", "email": "f.seasons017@gmail.com", "date": "2020-09-08T14:03:15Z"}, "committer": {"name": "Takayuki Nakata", "email": "f.seasons017@gmail.com", "date": "2020-09-08T14:03:15Z"}, "message": "Refactoring: tests in `same_item_push`", "tree": {"sha": "708bf67a3b425be71d42b8280905b8f1fff84a89", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/708bf67a3b425be71d42b8280905b8f1fff84a89"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/952c04674e4225d231f0ba78dff32abf7c06cb8b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/952c04674e4225d231f0ba78dff32abf7c06cb8b", "html_url": "https://github.com/rust-lang/rust/commit/952c04674e4225d231f0ba78dff32abf7c06cb8b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/952c04674e4225d231f0ba78dff32abf7c06cb8b/comments", "author": {"login": "giraffate", "id": 17407489, "node_id": "MDQ6VXNlcjE3NDA3NDg5", "avatar_url": "https://avatars.githubusercontent.com/u/17407489?v=4", "gravatar_id": "", "url": "https://api.github.com/users/giraffate", "html_url": "https://github.com/giraffate", "followers_url": "https://api.github.com/users/giraffate/followers", "following_url": "https://api.github.com/users/giraffate/following{/other_user}", "gists_url": "https://api.github.com/users/giraffate/gists{/gist_id}", "starred_url": "https://api.github.com/users/giraffate/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/giraffate/subscriptions", "organizations_url": "https://api.github.com/users/giraffate/orgs", "repos_url": "https://api.github.com/users/giraffate/repos", "events_url": "https://api.github.com/users/giraffate/events{/privacy}", "received_events_url": "https://api.github.com/users/giraffate/received_events", "type": "User", "site_admin": false}, "committer": {"login": "giraffate", "id": 17407489, "node_id": "MDQ6VXNlcjE3NDA3NDg5", "avatar_url": "https://avatars.githubusercontent.com/u/17407489?v=4", "gravatar_id": "", "url": "https://api.github.com/users/giraffate", "html_url": "https://github.com/giraffate", "followers_url": "https://api.github.com/users/giraffate/followers", "following_url": "https://api.github.com/users/giraffate/following{/other_user}", "gists_url": "https://api.github.com/users/giraffate/gists{/gist_id}", "starred_url": "https://api.github.com/users/giraffate/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/giraffate/subscriptions", "organizations_url": "https://api.github.com/users/giraffate/orgs", "repos_url": "https://api.github.com/users/giraffate/repos", "events_url": "https://api.github.com/users/giraffate/events{/privacy}", "received_events_url": "https://api.github.com/users/giraffate/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2c9f82e7d22a5cd3f704ed0b932a17fa53f1145b", "url": "https://api.github.com/repos/rust-lang/rust/commits/2c9f82e7d22a5cd3f704ed0b932a17fa53f1145b", "html_url": "https://github.com/rust-lang/rust/commit/2c9f82e7d22a5cd3f704ed0b932a17fa53f1145b"}], "stats": {"total": 139, "additions": 71, "deletions": 68}, "files": [{"sha": "a37c8782ec3300c58f887df041a048abf143159f", "filename": "tests/ui/same_item_push.rs", "status": "modified", "additions": 51, "deletions": 48, "changes": 99, "blob_url": "https://github.com/rust-lang/rust/blob/952c04674e4225d231f0ba78dff32abf7c06cb8b/tests%2Fui%2Fsame_item_push.rs", "raw_url": "https://github.com/rust-lang/rust/raw/952c04674e4225d231f0ba78dff32abf7c06cb8b/tests%2Fui%2Fsame_item_push.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsame_item_push.rs?ref=952c04674e4225d231f0ba78dff32abf7c06cb8b", "patch": "@@ -16,64 +16,76 @@ fn fun() -> usize {\n }\n \n fn main() {\n-    // Test for basic case\n-    let mut spaces = Vec::with_capacity(10);\n-    for _ in 0..10 {\n-        spaces.push(vec![b' ']);\n-    }\n-\n-    let mut vec2: Vec<u8> = Vec::new();\n+    // ** linted cases **\n+    let mut vec: Vec<u8> = Vec::new();\n     let item = 2;\n     for _ in 5..=20 {\n-        vec2.push(item);\n+        vec.push(item);\n     }\n \n-    let mut vec3: Vec<u8> = Vec::new();\n+    let mut vec: Vec<u8> = Vec::new();\n     for _ in 0..15 {\n         let item = 2;\n-        vec3.push(item);\n+        vec.push(item);\n     }\n \n-    let mut vec4: Vec<u8> = Vec::new();\n+    let mut vec: Vec<u8> = Vec::new();\n     for _ in 0..15 {\n-        vec4.push(13);\n+        vec.push(13);\n+    }\n+\n+    let mut vec = Vec::new();\n+    for _ in 0..20 {\n+        vec.push(VALUE);\n+    }\n+\n+    let mut vec = Vec::new();\n+    let item = VALUE;\n+    for _ in 0..20 {\n+        vec.push(item);\n+    }\n+\n+    // ** non-linted cases **\n+    let mut spaces = Vec::with_capacity(10);\n+    for _ in 0..10 {\n+        spaces.push(vec![b' ']);\n     }\n \n     // Suggestion should not be given as pushed variable can mutate\n-    let mut vec5: Vec<u8> = Vec::new();\n+    let mut vec: Vec<u8> = Vec::new();\n     let mut item: u8 = 2;\n     for _ in 0..30 {\n-        vec5.push(mutate_increment(&mut item));\n+        vec.push(mutate_increment(&mut item));\n     }\n \n-    let mut vec6: Vec<u8> = Vec::new();\n+    let mut vec: Vec<u8> = Vec::new();\n     let mut item: u8 = 2;\n     let mut item2 = &mut mutate_increment(&mut item);\n     for _ in 0..30 {\n-        vec6.push(mutate_increment(item2));\n+        vec.push(mutate_increment(item2));\n     }\n \n-    let mut vec7: Vec<usize> = Vec::new();\n+    let mut vec: Vec<usize> = Vec::new();\n     for (a, b) in [0, 1, 4, 9, 16].iter().enumerate() {\n-        vec7.push(a);\n+        vec.push(a);\n     }\n \n-    let mut vec8: Vec<u8> = Vec::new();\n+    let mut vec: Vec<u8> = Vec::new();\n     for i in 0..30 {\n-        vec8.push(increment(i));\n+        vec.push(increment(i));\n     }\n \n-    let mut vec9: Vec<u8> = Vec::new();\n+    let mut vec: Vec<u8> = Vec::new();\n     for i in 0..30 {\n-        vec9.push(i + i * i);\n+        vec.push(i + i * i);\n     }\n \n     // Suggestion should not be given as there are multiple pushes that are not the same\n-    let mut vec10: Vec<u8> = Vec::new();\n+    let mut vec: Vec<u8> = Vec::new();\n     let item: u8 = 2;\n     for _ in 0..30 {\n-        vec10.push(item);\n-        vec10.push(item * 2);\n+        vec.push(item);\n+        vec.push(item * 2);\n     }\n \n     // Suggestion should not be given as Vec is not involved\n@@ -88,23 +100,23 @@ fn main() {\n     for i in 0..30 {\n         vec_a.push(A { kind: i });\n     }\n-    let mut vec12: Vec<u8> = Vec::new();\n+    let mut vec: Vec<u8> = Vec::new();\n     for a in vec_a {\n-        vec12.push(2u8.pow(a.kind));\n+        vec.push(2u8.pow(a.kind));\n     }\n \n     // Fix #5902\n-    let mut vec13: Vec<u8> = Vec::new();\n+    let mut vec: Vec<u8> = Vec::new();\n     let mut item = 0;\n     for _ in 0..10 {\n-        vec13.push(item);\n+        vec.push(item);\n         item += 10;\n     }\n \n     // Fix #5979\n-    let mut vec14: Vec<std::fs::File> = Vec::new();\n+    let mut vec: Vec<std::fs::File> = Vec::new();\n     for _ in 0..10 {\n-        vec14.push(std::fs::File::open(\"foobar\").unwrap());\n+        vec.push(std::fs::File::open(\"foobar\").unwrap());\n     }\n     // Fix #5979\n     #[derive(Clone)]\n@@ -113,36 +125,27 @@ fn main() {\n     trait T {}\n     impl T for S {}\n \n-    let mut vec15: Vec<Box<dyn T>> = Vec::new();\n+    let mut vec: Vec<Box<dyn T>> = Vec::new();\n     for _ in 0..10 {\n-        vec15.push(Box::new(S {}));\n-    }\n-\n-    let mut vec16 = Vec::new();\n-    for _ in 0..20 {\n-        vec16.push(VALUE);\n-    }\n-\n-    let mut vec17 = Vec::new();\n-    let item = VALUE;\n-    for _ in 0..20 {\n-        vec17.push(item);\n+        vec.push(Box::new(S {}));\n     }\n \n-    let mut vec18 = Vec::new();\n+    // Fix #5985\n+    let mut vec = Vec::new();\n     let item = 42;\n     let item = fun();\n     for _ in 0..20 {\n-        vec18.push(item);\n+        vec.push(item);\n     }\n \n-    let mut vec19 = Vec::new();\n+    // Fix #5985\n+    let mut vec = Vec::new();\n     let key = 1;\n     for _ in 0..20 {\n         let item = match key {\n             1 => 10,\n             _ => 0,\n         };\n-        vec19.push(item);\n+        vec.push(item);\n     }\n }"}, {"sha": "d9ffa15780ad004b17609a48ef8e241af1992c7e", "filename": "tests/ui/same_item_push.stderr", "status": "modified", "additions": 20, "deletions": 20, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/952c04674e4225d231f0ba78dff32abf7c06cb8b/tests%2Fui%2Fsame_item_push.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/952c04674e4225d231f0ba78dff32abf7c06cb8b/tests%2Fui%2Fsame_item_push.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsame_item_push.stderr?ref=952c04674e4225d231f0ba78dff32abf7c06cb8b", "patch": "@@ -1,43 +1,43 @@\n error: it looks like the same item is being pushed into this Vec\n-  --> $DIR/same_item_push.rs:24:9\n+  --> $DIR/same_item_push.rs:23:9\n    |\n-LL |         vec2.push(item);\n-   |         ^^^^\n+LL |         vec.push(item);\n+   |         ^^^\n    |\n    = note: `-D clippy::same-item-push` implied by `-D warnings`\n-   = help: try using vec![item;SIZE] or vec2.resize(NEW_SIZE, item)\n+   = help: try using vec![item;SIZE] or vec.resize(NEW_SIZE, item)\n \n error: it looks like the same item is being pushed into this Vec\n-  --> $DIR/same_item_push.rs:30:9\n+  --> $DIR/same_item_push.rs:29:9\n    |\n-LL |         vec3.push(item);\n-   |         ^^^^\n+LL |         vec.push(item);\n+   |         ^^^\n    |\n-   = help: try using vec![item;SIZE] or vec3.resize(NEW_SIZE, item)\n+   = help: try using vec![item;SIZE] or vec.resize(NEW_SIZE, item)\n \n error: it looks like the same item is being pushed into this Vec\n-  --> $DIR/same_item_push.rs:35:9\n+  --> $DIR/same_item_push.rs:34:9\n    |\n-LL |         vec4.push(13);\n-   |         ^^^^\n+LL |         vec.push(13);\n+   |         ^^^\n    |\n-   = help: try using vec![13;SIZE] or vec4.resize(NEW_SIZE, 13)\n+   = help: try using vec![13;SIZE] or vec.resize(NEW_SIZE, 13)\n \n error: it looks like the same item is being pushed into this Vec\n-  --> $DIR/same_item_push.rs:119:9\n+  --> $DIR/same_item_push.rs:39:9\n    |\n-LL |         vec16.push(VALUE);\n-   |         ^^^^^\n+LL |         vec.push(VALUE);\n+   |         ^^^\n    |\n-   = help: try using vec![VALUE;SIZE] or vec16.resize(NEW_SIZE, VALUE)\n+   = help: try using vec![VALUE;SIZE] or vec.resize(NEW_SIZE, VALUE)\n \n error: it looks like the same item is being pushed into this Vec\n-  --> $DIR/same_item_push.rs:125:9\n+  --> $DIR/same_item_push.rs:45:9\n    |\n-LL |         vec17.push(item);\n-   |         ^^^^^\n+LL |         vec.push(item);\n+   |         ^^^\n    |\n-   = help: try using vec![item;SIZE] or vec17.resize(NEW_SIZE, item)\n+   = help: try using vec![item;SIZE] or vec.resize(NEW_SIZE, item)\n \n error: aborting due to 5 previous errors\n "}]}