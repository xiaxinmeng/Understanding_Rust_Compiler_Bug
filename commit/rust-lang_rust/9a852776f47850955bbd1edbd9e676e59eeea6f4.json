{"sha": "9a852776f47850955bbd1edbd9e676e59eeea6f4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlhODUyNzc2ZjQ3ODUwOTU1YmJkMWVkYmQ5ZTY3NmU1OWVlZWE2ZjQ=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2021-04-25T16:42:53Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2021-04-29T07:27:45Z"}, "message": "don't let const_fn feature flag affect impl-block-level trait bounds", "tree": {"sha": "cd3ff0578531edeac22d0f5474d8f837e6f716de", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cd3ff0578531edeac22d0f5474d8f837e6f716de"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9a852776f47850955bbd1edbd9e676e59eeea6f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9a852776f47850955bbd1edbd9e676e59eeea6f4", "html_url": "https://github.com/rust-lang/rust/commit/9a852776f47850955bbd1edbd9e676e59eeea6f4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9a852776f47850955bbd1edbd9e676e59eeea6f4/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ada102456de38e462b4f00473dd923f15dc3f296", "url": "https://api.github.com/repos/rust-lang/rust/commits/ada102456de38e462b4f00473dd923f15dc3f296", "html_url": "https://github.com/rust-lang/rust/commit/ada102456de38e462b4f00473dd923f15dc3f296"}], "stats": {"total": 30, "additions": 9, "deletions": 21}, "files": [{"sha": "63fc66f2b9f163421b5e731dff77a616ff2b288a", "filename": "compiler/rustc_mir/src/transform/check_consts/validation.rs", "status": "modified", "additions": 2, "deletions": 11, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/9a852776f47850955bbd1edbd9e676e59eeea6f4/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fcheck_consts%2Fvalidation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a852776f47850955bbd1edbd9e676e59eeea6f4/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fcheck_consts%2Fvalidation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir%2Fsrc%2Ftransform%2Fcheck_consts%2Fvalidation.rs?ref=9a852776f47850955bbd1edbd9e676e59eeea6f4", "patch": "@@ -426,7 +426,7 @@ impl Validator<'mir, 'tcx> {\n                     ty::PredicateKind::Subtype(_) => {\n                         bug!(\"subtype predicate on function: {:#?}\", predicate)\n                     }\n-                    ty::PredicateKind::Trait(pred, constness) => {\n+                    ty::PredicateKind::Trait(pred, _constness) => {\n                         if Some(pred.def_id()) == tcx.lang_items().sized_trait() {\n                             continue;\n                         }\n@@ -440,16 +440,7 @@ impl Validator<'mir, 'tcx> {\n                                 // arguments when determining importance.\n                                 let kind = LocalKind::Arg;\n \n-                                if constness == hir::Constness::Const {\n-                                    self.check_op_spanned(ops::ty::TraitBound(kind), span);\n-                                } else if !tcx.features().const_fn\n-                                    || self.ccx.is_const_stable_const_fn()\n-                                {\n-                                    // HACK: We shouldn't need the conditional above, but trait\n-                                    // bounds on containing impl blocks are wrongly being marked as\n-                                    // \"not-const\".\n-                                    self.check_op_spanned(ops::ty::TraitBound(kind), span);\n-                                }\n+                                self.check_op_spanned(ops::ty::TraitBound(kind), span);\n                             }\n                             // other kinds of bounds are either tautologies\n                             // or cause errors in other passes"}, {"sha": "c7f58f3615435d6043303e984514957067752457", "filename": "library/proc_macro/src/lib.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9a852776f47850955bbd1edbd9e676e59eeea6f4/library%2Fproc_macro%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a852776f47850955bbd1edbd9e676e59eeea6f4/library%2Fproc_macro%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fproc_macro%2Fsrc%2Flib.rs?ref=9a852776f47850955bbd1edbd9e676e59eeea6f4", "patch": "@@ -21,7 +21,8 @@\n #![feature(rustc_allow_const_fn_unstable)]\n #![feature(nll)]\n #![feature(staged_api)]\n-#![feature(const_fn)]\n+#![cfg_attr(bootstrap, feature(const_fn))]\n+#![cfg_attr(not(bootstrap), feature(const_fn_trait_bound))]\n #![feature(const_fn_fn_ptr_basics)]\n #![feature(allow_internal_unstable)]\n #![feature(decl_macro)]"}, {"sha": "5a66af1d29e9483039a6e61457fa68dffc8ba752", "filename": "src/test/ui/rfc-2632-const-trait-impl/assoc-type.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fassoc-type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fassoc-type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fassoc-type.rs?ref=9a852776f47850955bbd1edbd9e676e59eeea6f4", "patch": "@@ -5,7 +5,6 @@\n \n #![allow(incomplete_features)]\n #![feature(const_trait_impl)]\n-#![feature(const_fn)]\n \n struct NonConstAdd(i32);\n "}, {"sha": "fa5570d5454a05c2c0659eff12ad5772c4cb501e", "filename": "src/test/ui/rfc-2632-const-trait-impl/call-const-trait-method-fail.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-const-trait-method-fail.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-const-trait-method-fail.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-const-trait-method-fail.rs?ref=9a852776f47850955bbd1edbd9e676e59eeea6f4", "patch": "@@ -1,6 +1,5 @@\n #![allow(incomplete_features)]\n #![feature(const_trait_impl)]\n-#![feature(const_fn)]\n \n pub trait Plus {\n     fn plus(self, rhs: Self) -> Self;"}, {"sha": "d3f350e1b61db98a8c6085b3ec034c51e2076faa", "filename": "src/test/ui/rfc-2632-const-trait-impl/call-const-trait-method-fail.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-const-trait-method-fail.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-const-trait-method-fail.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-const-trait-method-fail.stderr?ref=9a852776f47850955bbd1edbd9e676e59eeea6f4", "patch": "@@ -1,5 +1,5 @@\n error[E0015]: calls in constant functions are limited to constant functions, tuple structs and tuple variants\n-  --> $DIR/call-const-trait-method-fail.rs:26:5\n+  --> $DIR/call-const-trait-method-fail.rs:25:5\n    |\n LL |     a.plus(b)\n    |     ^^^^^^^^^"}, {"sha": "ec6f45f956d75d8c77d21aacb749b3535baa965d", "filename": "src/test/ui/rfc-2632-const-trait-impl/call-const-trait-method-pass.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-const-trait-method-pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-const-trait-method-pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-const-trait-method-pass.rs?ref=9a852776f47850955bbd1edbd9e676e59eeea6f4", "patch": "@@ -2,7 +2,6 @@\n \n #![allow(incomplete_features)]\n #![feature(const_trait_impl)]\n-#![feature(const_fn)]\n \n struct Int(i32);\n "}, {"sha": "dc4d5561d47459b2b44de68aa58b3a326efe22ed", "filename": "src/test/ui/rfc-2632-const-trait-impl/call-generic-method-fail.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-generic-method-fail.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-generic-method-fail.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-generic-method-fail.rs?ref=9a852776f47850955bbd1edbd9e676e59eeea6f4", "patch": "@@ -1,4 +1,4 @@\n-#![feature(const_fn)]\n+#![feature(const_fn_trait_bound)]\n #![feature(const_trait_impl)]\n #![feature(const_trait_bound_opt_out)]\n #![allow(incomplete_features)]"}, {"sha": "1fc2c4fe4456f9100cd95e588774a8f69a1d69e9", "filename": "src/test/ui/rfc-2632-const-trait-impl/call-generic-method-nonconst-opt-out.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-generic-method-nonconst-opt-out.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-generic-method-nonconst-opt-out.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-generic-method-nonconst-opt-out.rs?ref=9a852776f47850955bbd1edbd9e676e59eeea6f4", "patch": "@@ -1,6 +1,6 @@\n // check-pass\n \n-#![feature(const_fn)]\n+#![feature(const_fn_trait_bound)]\n #![feature(const_trait_impl)]\n #![feature(const_trait_bound_opt_out)]\n #![allow(incomplete_features)]"}, {"sha": "9aefe6380cb18133109a0f588a00f070e57cf06f", "filename": "src/test/ui/rfc-2632-const-trait-impl/call-generic-method-nonconst.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-generic-method-nonconst.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-generic-method-nonconst.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fcall-generic-method-nonconst.rs?ref=9a852776f47850955bbd1edbd9e676e59eeea6f4", "patch": "@@ -1,7 +1,6 @@\n // FIXME(jschievink): this is not rejected correctly (only when the non-const impl is actually used)\n // ignore-test\n \n-#![feature(const_fn)]\n #![feature(const_trait_impl)]\n #![allow(incomplete_features)]\n "}, {"sha": "4452ad7ea239c1992fbe59e70ea382cef839c4d1", "filename": "src/test/ui/rfc-2632-const-trait-impl/const-trait-bound-opt-out/feature-gate.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fconst-trait-bound-opt-out%2Ffeature-gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fconst-trait-bound-opt-out%2Ffeature-gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fconst-trait-bound-opt-out%2Ffeature-gate.rs?ref=9a852776f47850955bbd1edbd9e676e59eeea6f4", "patch": "@@ -4,7 +4,7 @@\n #![cfg_attr(gated, feature(const_trait_bound_opt_out))]\n #![allow(incomplete_features)]\n #![feature(rustc_attrs)]\n-#![feature(const_fn)]\n+#![feature(const_fn_trait_bound)]\n \n trait T {\n     const CONST: i32;"}, {"sha": "ad14dd62bc7b5b7c021522214501e23283bd6e11", "filename": "src/test/ui/rfc-2632-const-trait-impl/hir-const-check.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fhir-const-check.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a852776f47850955bbd1edbd9e676e59eeea6f4/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fhir-const-check.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2632-const-trait-impl%2Fhir-const-check.rs?ref=9a852776f47850955bbd1edbd9e676e59eeea6f4", "patch": "@@ -1,6 +1,6 @@\n // Regression test for #69615.\n \n-#![feature(const_trait_impl, const_fn)]\n+#![feature(const_trait_impl)]\n #![allow(incomplete_features)]\n \n pub trait MyTrait {"}]}