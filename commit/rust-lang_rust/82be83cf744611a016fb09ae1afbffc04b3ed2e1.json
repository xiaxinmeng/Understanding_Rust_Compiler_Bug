{"sha": "82be83cf744611a016fb09ae1afbffc04b3ed2e1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgyYmU4M2NmNzQ0NjExYTAxNmZiMDlhZTFhZmJmZmMwNGIzZWQyZTE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-08-15T16:21:28Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-08-15T16:21:28Z"}, "message": "Auto merge of #43500 - murarth:string-retain, r=alexcrichton\n\nAdd method `String::retain`\n\nBehaves like `Vec::retain`, accepting a predicate `FnMut(char) -> bool`\nand reducing the string to only characters for which the predicate\nreturns `true`.", "tree": {"sha": "e7054196a3c1077869c05473d3ef605fb7a47b6a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e7054196a3c1077869c05473d3ef605fb7a47b6a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/82be83cf744611a016fb09ae1afbffc04b3ed2e1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/82be83cf744611a016fb09ae1afbffc04b3ed2e1", "html_url": "https://github.com/rust-lang/rust/commit/82be83cf744611a016fb09ae1afbffc04b3ed2e1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/82be83cf744611a016fb09ae1afbffc04b3ed2e1/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1b08e0f231cd30719c25a5992f1d9bb27ea02b61", "url": "https://api.github.com/repos/rust-lang/rust/commits/1b08e0f231cd30719c25a5992f1d9bb27ea02b61", "html_url": "https://github.com/rust-lang/rust/commit/1b08e0f231cd30719c25a5992f1d9bb27ea02b61"}, {"sha": "618ac89d256adca97518742db2ad2759c4f5fc72", "url": "https://api.github.com/repos/rust-lang/rust/commits/618ac89d256adca97518742db2ad2759c4f5fc72", "html_url": "https://github.com/rust-lang/rust/commit/618ac89d256adca97518742db2ad2759c4f5fc72"}], "stats": {"total": 95, "additions": 95, "deletions": 0}, "files": [{"sha": "049444aa49bdd2ef90d7316c2e6d6d41bdf16f80", "filename": "src/doc/unstable-book/src/library-features/string-retain.md", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/82be83cf744611a016fb09ae1afbffc04b3ed2e1/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fstring-retain.md", "raw_url": "https://github.com/rust-lang/rust/raw/82be83cf744611a016fb09ae1afbffc04b3ed2e1/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fstring-retain.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Flibrary-features%2Fstring-retain.md?ref=82be83cf744611a016fb09ae1afbffc04b3ed2e1", "patch": "@@ -0,0 +1,23 @@\n+# `string_retain`\n+\n+The tracking issue for this feature is: [#43874]\n+\n+[#43874]: https://github.com/rust-lang/rust/issues/43874\n+\n+------------------------\n+\n+Retains only the characters specified by the predicate.\n+\n+In other words, remove all characters `c` such that `f(c)` returns `false`.\n+This method operates in place and preserves the order of the retained\n+characters.\n+\n+```rust\n+#![feature(string_retain)]\n+\n+let mut s = String::from(\"f_o_ob_ar\");\n+\n+s.retain(|c| c != '_');\n+\n+assert_eq!(s, \"foobar\");\n+```"}, {"sha": "a913d833a90e4ac1f53e71c601c3027c6c6b8a5f", "filename": "src/liballoc/string.rs", "status": "modified", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/82be83cf744611a016fb09ae1afbffc04b3ed2e1/src%2Fliballoc%2Fstring.rs", "raw_url": "https://github.com/rust-lang/rust/raw/82be83cf744611a016fb09ae1afbffc04b3ed2e1/src%2Fliballoc%2Fstring.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fstring.rs?ref=82be83cf744611a016fb09ae1afbffc04b3ed2e1", "patch": "@@ -1061,6 +1061,57 @@ impl String {\n         ch\n     }\n \n+    /// Retains only the characters specified by the predicate.\n+    ///\n+    /// In other words, remove all characters `c` such that `f(c)` returns `false`.\n+    /// This method operates in place and preserves the order of the retained\n+    /// characters.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(string_retain)]\n+    ///\n+    /// let mut s = String::from(\"f_o_ob_ar\");\n+    ///\n+    /// s.retain(|c| c != '_');\n+    ///\n+    /// assert_eq!(s, \"foobar\");\n+    /// ```\n+    #[inline]\n+    #[unstable(feature = \"string_retain\", issue = \"43874\")]\n+    pub fn retain<F>(&mut self, mut f: F)\n+        where F: FnMut(char) -> bool\n+    {\n+        let len = self.len();\n+        let mut del_bytes = 0;\n+        let mut idx = 0;\n+\n+        while idx < len {\n+            let ch = unsafe {\n+                self.slice_unchecked(idx, len).chars().next().unwrap()\n+            };\n+            let ch_len = ch.len_utf8();\n+\n+            if !f(ch) {\n+                del_bytes += ch_len;\n+            } else if del_bytes > 0 {\n+                unsafe {\n+                    ptr::copy(self.vec.as_ptr().offset(idx as isize),\n+                              self.vec.as_mut_ptr().offset((idx - del_bytes) as isize),\n+                              ch_len);\n+                }\n+            }\n+\n+            // Point idx to the next char\n+            idx += ch_len;\n+        }\n+\n+        if del_bytes > 0 {\n+            unsafe { self.vec.set_len(len - del_bytes); }\n+        }\n+    }\n+\n     /// Inserts a character into this `String` at a byte position.\n     ///\n     /// This is an `O(n)` operation as it requires copying every element in the"}, {"sha": "34b0a137b104182c02d44093606dbffe42226465", "filename": "src/liballoc/tests/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/82be83cf744611a016fb09ae1afbffc04b3ed2e1/src%2Fliballoc%2Ftests%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/82be83cf744611a016fb09ae1afbffc04b3ed2e1/src%2Fliballoc%2Ftests%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Ftests%2Flib.rs?ref=82be83cf744611a016fb09ae1afbffc04b3ed2e1", "patch": "@@ -25,6 +25,7 @@\n #![feature(slice_rotate)]\n #![feature(splice)]\n #![feature(str_escape)]\n+#![feature(string_retain)]\n #![feature(test)]\n #![feature(unboxed_closures)]\n #![feature(unicode)]"}, {"sha": "f5c124c6b4458b3a666273daec3b88f3d5a8851f", "filename": "src/liballoc/tests/string.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/82be83cf744611a016fb09ae1afbffc04b3ed2e1/src%2Fliballoc%2Ftests%2Fstring.rs", "raw_url": "https://github.com/rust-lang/rust/raw/82be83cf744611a016fb09ae1afbffc04b3ed2e1/src%2Fliballoc%2Ftests%2Fstring.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Ftests%2Fstring.rs?ref=82be83cf744611a016fb09ae1afbffc04b3ed2e1", "patch": "@@ -332,6 +332,26 @@ fn remove_bad() {\n     \"\u0e28\".to_string().remove(1);\n }\n \n+#[test]\n+fn test_retain() {\n+    let mut s = String::from(\"\u03b1_\u03b2_\u03b3\");\n+\n+    s.retain(|_| true);\n+    assert_eq!(s, \"\u03b1_\u03b2_\u03b3\");\n+\n+    s.retain(|c| c != '_');\n+    assert_eq!(s, \"\u03b1\u03b2\u03b3\");\n+\n+    s.retain(|c| c != '\u03b2');\n+    assert_eq!(s, \"\u03b1\u03b3\");\n+\n+    s.retain(|c| c == '\u03b1');\n+    assert_eq!(s, \"\u03b1\");\n+\n+    s.retain(|_| false);\n+    assert_eq!(s, \"\");\n+}\n+\n #[test]\n fn insert() {\n     let mut s = \"foobar\".to_string();"}]}