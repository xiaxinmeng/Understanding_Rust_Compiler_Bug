{"sha": "be76526707a0b7ba73e7bf47dcf060559ed352b1", "node_id": "C_kwDOAAsO6NoAKGJlNzY1MjY3MDdhMGI3YmE3M2U3YmY0N2RjZjA2MDU1OWVkMzUyYjE", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-01-12T05:52:39Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-01-12T05:52:39Z"}, "message": "Rollup merge of #106733 - DebugSteven:revert-104552-warn-newer-x, r=jyn514\n\nRevert \"warn newer available version of the x tool\"\n\nReverts rust-lang/rust#104552\n\nRunning the x executable directly created an [issue](https://github.com/rust-lang/rust/issues/106469) here. There are other options for warning a user that a newer version of x exists in the issue's discussion as well.\n\nr? `@jyn514`", "tree": {"sha": "b774e4ea45467b5e2bdcf12d1b7ca80dbd852ed0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b774e4ea45467b5e2bdcf12d1b7ca80dbd852ed0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/be76526707a0b7ba73e7bf47dcf060559ed352b1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjv6AnCRBK7hj4Ov3rIwAAqXwIACM1N0zakREuIKztRahigOkL\nq6XbHhlFO+PdS9ITasOruCiMQoVRAlm1gR8Rdvk9efRua/GzRkkNbghQXOfmofpk\n9XWhxopDlSkyAzJAbMWK6SUI880mrinqIaWhozAU1MyDIEGdfVMXF71IJ1QDuZNb\n/Gk246cjzCMskj4tByDpCx8XLqkgE9LZ+8rLwq09rfXW15zw9QhWk8F4kFvjuCyH\nf64pp+BMXL+Mjhd445JRJHZJdXbtqrF5ZyZrgDfEZHLkbIF/12Qs1qWZdUXtOnWH\nWtE9pbi3vzz2rdibu6JYwz+141F77lJRVksg6YGS8rxUYjxfkCkrbmxj655i1sY=\n=Y8uH\n-----END PGP SIGNATURE-----\n", "payload": "tree b774e4ea45467b5e2bdcf12d1b7ca80dbd852ed0\nparent a90742ac98dee241d910eb0f3a7188313e14c91b\nparent 0d834d9523930293e4d9755e82f064b835791785\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1673502759 +0100\ncommitter GitHub <noreply@github.com> 1673502759 +0100\n\nRollup merge of #106733 - DebugSteven:revert-104552-warn-newer-x, r=jyn514\n\nRevert \"warn newer available version of the x tool\"\n\nReverts rust-lang/rust#104552\n\nRunning the x executable directly created an [issue](https://github.com/rust-lang/rust/issues/106469) here. There are other options for warning a user that a newer version of x exists in the issue's discussion as well.\n\nr? `@jyn514`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/be76526707a0b7ba73e7bf47dcf060559ed352b1", "html_url": "https://github.com/rust-lang/rust/commit/be76526707a0b7ba73e7bf47dcf060559ed352b1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/be76526707a0b7ba73e7bf47dcf060559ed352b1/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a90742ac98dee241d910eb0f3a7188313e14c91b", "url": "https://api.github.com/repos/rust-lang/rust/commits/a90742ac98dee241d910eb0f3a7188313e14c91b", "html_url": "https://github.com/rust-lang/rust/commit/a90742ac98dee241d910eb0f3a7188313e14c91b"}, {"sha": "0d834d9523930293e4d9755e82f064b835791785", "url": "https://api.github.com/repos/rust-lang/rust/commits/0d834d9523930293e4d9755e82f064b835791785", "html_url": "https://github.com/rust-lang/rust/commit/0d834d9523930293e4d9755e82f064b835791785"}], "stats": {"total": 95, "additions": 13, "deletions": 82}, "files": [{"sha": "4bea3af7f3bfa111809d367b6a651d37d2e51910", "filename": "Cargo.lock", "status": "modified", "additions": 10, "deletions": 11, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/be76526707a0b7ba73e7bf47dcf060559ed352b1/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/be76526707a0b7ba73e7bf47dcf060559ed352b1/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=be76526707a0b7ba73e7bf47dcf060559ed352b1", "patch": "@@ -5034,18 +5034,18 @@ checksum = \"1ef965a420fe14fdac7dd018862966a4c14094f900e1650bbc71ddd7d580c8af\"\n \n [[package]]\n name = \"semver\"\n-version = \"1.0.14\"\n+version = \"1.0.12\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"e25dfac463d778e353db5be2449d1cce89bd6fd23c9f1ea21310ce6e5a1b29c4\"\n+checksum = \"a2333e6df6d6598f2b1974829f853c2b4c5f4a6e503c10af918081aa6f8564e1\"\n dependencies = [\n  \"serde\",\n ]\n \n [[package]]\n name = \"serde\"\n-version = \"1.0.152\"\n+version = \"1.0.147\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"bb7d1f0d3021d347a83e556fc4683dea2ea09d87bccdf88ff5c12545d89d5efb\"\n+checksum = \"d193d69bae983fc11a79df82342761dfbf28a99fc8d203dca4c3c1b590948965\"\n dependencies = [\n  \"serde_derive\",\n ]\n@@ -5062,9 +5062,9 @@ dependencies = [\n \n [[package]]\n name = \"serde_derive\"\n-version = \"1.0.152\"\n+version = \"1.0.147\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"af487d118eecd09402d70a5d72551860e788df87b464af30e5ea6a38c75c541e\"\n+checksum = \"4f1d362ca8fc9c3e3a7484440752472d68a6caa98f1ab81d99b5dfe517cec852\"\n dependencies = [\n  \"proc-macro2\",\n  \"quote\",\n@@ -5082,9 +5082,9 @@ dependencies = [\n \n [[package]]\n name = \"serde_json\"\n-version = \"1.0.91\"\n+version = \"1.0.85\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"877c235533714907a8c2464236f5c4b2a17262ef1bd71f38f35ea592c8da6883\"\n+checksum = \"e55a28e3aaef9d5ce0506d0a14dbba8054ddc7e499ef522dd8b26859ec9d4a44\"\n dependencies = [\n  \"indexmap\",\n  \"itoa\",\n@@ -5400,9 +5400,9 @@ checksum = \"6bdef32e8150c2a081110b42772ffe7d7c9032b606bc226c8260fd97e0976601\"\n \n [[package]]\n name = \"syn\"\n-version = \"1.0.107\"\n+version = \"1.0.102\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"1f4064b5b16e03ae50984a5a8ed5d4f8803e6bc1fd170a3cda91a1be4b18e3f5\"\n+checksum = \"3fcd952facd492f9be3ef0d0b7032a6e442ee9b361d4acc2b1d0c4aaa5f613a1\"\n dependencies = [\n  \"proc-macro2\",\n  \"quote\",\n@@ -5576,7 +5576,6 @@ dependencies = [\n  \"lazy_static\",\n  \"miropt-test-tools\",\n  \"regex\",\n- \"semver\",\n  \"termcolor\",\n  \"walkdir\",\n ]"}, {"sha": "9cf43fc7a2193f1b67c5cd51e2927e98dff7b941", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/be76526707a0b7ba73e7bf47dcf060559ed352b1/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/be76526707a0b7ba73e7bf47dcf060559ed352b1/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=be76526707a0b7ba73e7bf47dcf060559ed352b1", "patch": "@@ -934,7 +934,8 @@ def main():\n     if len(sys.argv) > 1 and sys.argv[1] == 'help':\n         sys.argv = [sys.argv[0], '-h'] + sys.argv[2:]\n \n-    help_triggered = len(sys.argv) == 1 or any(x in [\"-h\", \"--help\", \"--version\"] for x in sys.argv)\n+    help_triggered = (\n+        '-h' in sys.argv) or ('--help' in sys.argv) or (len(sys.argv) == 1)\n     try:\n         bootstrap(help_triggered)\n         if not help_triggered:"}, {"sha": "fff83a1d097b3f6364c180781b8bfdb6ec886dc6", "filename": "src/tools/tidy/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/be76526707a0b7ba73e7bf47dcf060559ed352b1/src%2Ftools%2Ftidy%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/be76526707a0b7ba73e7bf47dcf060559ed352b1/src%2Ftools%2Ftidy%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2FCargo.toml?ref=be76526707a0b7ba73e7bf47dcf060559ed352b1", "patch": "@@ -11,7 +11,6 @@ miropt-test-tools = { path = \"../miropt-test-tools\" }\n lazy_static = \"1\"\n walkdir = \"2\"\n ignore = \"0.4.18\"\n-semver = \"1.0.14\"\n termcolor = \"1.1.3\"\n \n [[bin]]"}, {"sha": "40375f1306d629700f41b8e81369de264d843636", "filename": "src/tools/tidy/src/lib.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/be76526707a0b7ba73e7bf47dcf060559ed352b1/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be76526707a0b7ba73e7bf47dcf060559ed352b1/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Flib.rs?ref=be76526707a0b7ba73e7bf47dcf060559ed352b1", "patch": "@@ -69,4 +69,3 @@ pub mod ui_tests;\n pub mod unit_tests;\n pub mod unstable_book;\n pub mod walk;\n-pub mod x_version;"}, {"sha": "ea2886a3c2f8fda013abaf1c581a466939f36694", "filename": "src/tools/tidy/src/main.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/be76526707a0b7ba73e7bf47dcf060559ed352b1/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/be76526707a0b7ba73e7bf47dcf060559ed352b1/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fmain.rs?ref=be76526707a0b7ba73e7bf47dcf060559ed352b1", "patch": "@@ -60,7 +60,7 @@ fn main() {\n \n                 let handle = s.spawn(|| {\n                     let mut flag = false;\n-                    $p::check($($args, )* &mut flag);\n+                    $p::check($($args),* , &mut flag);\n                     if (flag) {\n                         bad.store(true, Ordering::Relaxed);\n                     }\n@@ -113,8 +113,6 @@ fn main() {\n         check!(alphabetical, &compiler_path);\n         check!(alphabetical, &library_path);\n \n-        check!(x_version, &root_path, &cargo);\n-\n         let collected = {\n             drain_handles(&mut handles);\n "}, {"sha": "5dc6a0588c32bc1dc10a9fba6ab0664db9699f66", "filename": "src/tools/tidy/src/x_version.rs", "status": "removed", "additions": 0, "deletions": 65, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/a90742ac98dee241d910eb0f3a7188313e14c91b/src%2Ftools%2Ftidy%2Fsrc%2Fx_version.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a90742ac98dee241d910eb0f3a7188313e14c91b/src%2Ftools%2Ftidy%2Fsrc%2Fx_version.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fx_version.rs?ref=a90742ac98dee241d910eb0f3a7188313e14c91b", "patch": "@@ -1,65 +0,0 @@\n-use semver::Version;\n-use std::io::ErrorKind;\n-use std::path::Path;\n-use std::process::{Command, Stdio};\n-\n-pub fn check(root: &Path, cargo: &Path, bad: &mut bool) {\n-    let result = Command::new(\"x\").arg(\"--wrapper-version\").stdout(Stdio::piped()).spawn();\n-    // This runs the command inside a temporary directory.\n-    // This allows us to compare output of result to see if `--wrapper-version` is not a recognized argument to x.\n-    let temp_result = Command::new(\"x\")\n-        .arg(\"--wrapper-version\")\n-        .current_dir(std::env::temp_dir())\n-        .stdout(Stdio::piped())\n-        .spawn();\n-\n-    let (child, temp_child) = match (result, temp_result) {\n-        (Ok(child), Ok(temp_child)) => (child, temp_child),\n-        (Err(e), _) | (_, Err(e)) => match e.kind() {\n-            ErrorKind::NotFound => return,\n-            _ => return tidy_error!(bad, \"failed to run `x`: {}\", e),\n-        },\n-    };\n-\n-    let output = child.wait_with_output().unwrap();\n-    let temp_output = temp_child.wait_with_output().unwrap();\n-\n-    if output != temp_output {\n-        return tidy_error!(\n-            bad,\n-            \"Current version of x does not support the `--wrapper-version` argument\\nConsider updating to the newer version of x by running `cargo install --path src/tools/x`\"\n-        );\n-    }\n-\n-    if output.status.success() {\n-        let version = String::from_utf8_lossy(&output.stdout);\n-        let version = Version::parse(version.trim_end()).unwrap();\n-\n-        if let Some(expected) = get_x_wrapper_version(root, cargo) {\n-            if version < expected {\n-                return tidy_error!(\n-                    bad,\n-                    \"Current version of x is {version}, but the latest version is {expected}\\nConsider updating to the newer version of x by running `cargo install --path src/tools/x`\"\n-                );\n-            }\n-        } else {\n-            return tidy_error!(\n-                bad,\n-                \"Unable to parse the latest version of `x` at `src/tools/x/Cargo.toml`\"\n-            );\n-        }\n-    } else {\n-        return tidy_error!(bad, \"failed to check version of `x`: {}\", output.status);\n-    }\n-}\n-\n-// Parse latest version out of `x` Cargo.toml\n-fn get_x_wrapper_version(root: &Path, cargo: &Path) -> Option<Version> {\n-    let mut cmd = cargo_metadata::MetadataCommand::new();\n-    cmd.cargo_path(cargo)\n-        .manifest_path(root.join(\"src/tools/x/Cargo.toml\"))\n-        .no_deps()\n-        .features(cargo_metadata::CargoOpt::AllFeatures);\n-    let mut metadata = t!(cmd.exec());\n-    metadata.packages.pop().map(|x| x.version)\n-}"}]}