{"sha": "9f8f97b88ba64e247c222b05498bf389e74a6103", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmOGY5N2I4OGJhNjRlMjQ3YzIyMmIwNTQ5OGJmMzg5ZTc0YTYxMDM=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-01-08T15:29:06Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-01-08T15:29:06Z"}, "message": "Rollup merge of #67774 - oxalica:more-statx, r=alexcrichton\n\nTry statx for all linux-gnu target.\n\nAfter https://github.com/rust-lang/libc/pull/1577, which is contained in `libc` 0.2.66,  provides `SYS_statx` for all Linux platform, so we can try to use `statx` for ~all Linux target~ all linux-gnu targets.\n\nUnfortunately, `struct statx` and `fn statx` is not a part of public interface of musl (currently), ~we still need to invoke it through `syscall`~ we does **not** support statx for musl or other libc impls currently.\n\nPrevious PR: #65094\n\ncc @alexcrichton", "tree": {"sha": "c6c232749d39ffef2a19cde7a3359d6abee984d7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c6c232749d39ffef2a19cde7a3359d6abee984d7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9f8f97b88ba64e247c222b05498bf389e74a6103", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeFfVDCRBK7hj4Ov3rIwAAdHIIABkLspAgW3Zk9SyRW6ZzjCnZ\nQUmbwu5xy6WaQan3sIJhLE9Z+8COPf6hNhvmD1JhR5azTHD6wVW5enZY5VYwx7k0\nhLp18stsJN23UlZ0z+aZA9qLO5blXR7WUezJKPHFp5dgI4f4NBL7TLWQBe5PXlhm\nugKy4paATTos6xu3IuyRDkavDMKjLvYQ5AWDGWx2m+WFqDGm+ZLamSGWvkGpgLLO\n4wAAvTmrP6yiTTXd05EigwmH3VEDjNOZFRLkjkZLVPCHievM5Tfd6//TbvLH084G\n/Mnv775oYmDcmR+3LAJviAQSBnyZ+L35NOza/fPY8AeSR6zrpjChCHvPZ4q6S4c=\n=E9Zm\n-----END PGP SIGNATURE-----\n", "payload": "tree c6c232749d39ffef2a19cde7a3359d6abee984d7\nparent ed6468da160bd67a2ce0573427f09a98daff8c07\nparent f5baa03af0da7aa565190ae563291cd268998c83\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1578497346 +0900\ncommitter GitHub <noreply@github.com> 1578497346 +0900\n\nRollup merge of #67774 - oxalica:more-statx, r=alexcrichton\n\nTry statx for all linux-gnu target.\n\nAfter https://github.com/rust-lang/libc/pull/1577, which is contained in `libc` 0.2.66,  provides `SYS_statx` for all Linux platform, so we can try to use `statx` for ~all Linux target~ all linux-gnu targets.\n\nUnfortunately, `struct statx` and `fn statx` is not a part of public interface of musl (currently), ~we still need to invoke it through `syscall`~ we does **not** support statx for musl or other libc impls currently.\n\nPrevious PR: #65094\n\ncc @alexcrichton\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9f8f97b88ba64e247c222b05498bf389e74a6103", "html_url": "https://github.com/rust-lang/rust/commit/9f8f97b88ba64e247c222b05498bf389e74a6103", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9f8f97b88ba64e247c222b05498bf389e74a6103/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ed6468da160bd67a2ce0573427f09a98daff8c07", "url": "https://api.github.com/repos/rust-lang/rust/commits/ed6468da160bd67a2ce0573427f09a98daff8c07", "html_url": "https://github.com/rust-lang/rust/commit/ed6468da160bd67a2ce0573427f09a98daff8c07"}, {"sha": "f5baa03af0da7aa565190ae563291cd268998c83", "url": "https://api.github.com/repos/rust-lang/rust/commits/f5baa03af0da7aa565190ae563291cd268998c83", "html_url": "https://github.com/rust-lang/rust/commit/f5baa03af0da7aa565190ae563291cd268998c83"}], "stats": {"total": 34, "additions": 6, "deletions": 28}, "files": [{"sha": "ab2a871b92df45f846d73d74432ddada4729a582", "filename": "src/libstd/sys/unix/fs.rs", "status": "modified", "additions": 6, "deletions": 28, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/9f8f97b88ba64e247c222b05498bf389e74a6103/src%2Flibstd%2Fsys%2Funix%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f8f97b88ba64e247c222b05498bf389e74a6103/src%2Flibstd%2Fsys%2Funix%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Funix%2Ffs.rs?ref=9f8f97b88ba64e247c222b05498bf389e74a6103", "patch": "@@ -51,44 +51,22 @@ pub use crate::sys_common::fs::remove_dir_all;\n \n pub struct File(FileDesc);\n \n-// FIXME: This should be available on Linux with all `target_arch` and `target_env`.\n-// https://github.com/rust-lang/libc/issues/1545\n+// FIXME: This should be available on Linux with all `target_env`.\n+// But currently only glibc exposes `statx` fn and structs.\n+// We don't want to import unverified raw C structs here directly.\n+// https://github.com/rust-lang/rust/pull/67774\n macro_rules! cfg_has_statx {\n     ({ $($then_tt:tt)* } else { $($else_tt:tt)* }) => {\n         cfg_if::cfg_if! {\n-            if #[cfg(all(target_os = \"linux\", target_env = \"gnu\", any(\n-                target_arch = \"x86\",\n-                target_arch = \"arm\",\n-                // target_arch = \"mips\",\n-                target_arch = \"powerpc\",\n-                target_arch = \"x86_64\",\n-                // target_arch = \"aarch64\",\n-                target_arch = \"powerpc64\",\n-                // target_arch = \"mips64\",\n-                // target_arch = \"s390x\",\n-                target_arch = \"sparc64\",\n-                target_arch = \"riscv64\",\n-            )))] {\n+            if #[cfg(all(target_os = \"linux\", target_env = \"gnu\"))] {\n                 $($then_tt)*\n             } else {\n                 $($else_tt)*\n             }\n         }\n     };\n     ($($block_inner:tt)*) => {\n-        #[cfg(all(target_os = \"linux\", target_env = \"gnu\", any(\n-            target_arch = \"x86\",\n-            target_arch = \"arm\",\n-            // target_arch = \"mips\",\n-            target_arch = \"powerpc\",\n-            target_arch = \"x86_64\",\n-            // target_arch = \"aarch64\",\n-            target_arch = \"powerpc64\",\n-            // target_arch = \"mips64\",\n-            // target_arch = \"s390x\",\n-            target_arch = \"sparc64\",\n-            target_arch = \"riscv64\",\n-        )))]\n+        #[cfg(all(target_os = \"linux\", target_env = \"gnu\"))]\n         {\n             $($block_inner)*\n         }"}]}