{"sha": "8d0ad26b955f21643bebe71518a74d1ecb3016ae", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhkMGFkMjZiOTU1ZjIxNjQzYmViZTcxNTE4YTc0ZDFlY2IzMDE2YWU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-07-29T06:13:55Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-07-29T06:13:55Z"}, "message": "Auto merge of #43527 - alexcrichton:different-llvm-cross, r=Mark-Simulacrum\n\nrustbuild: Tweak how we cross-compile LLVM\n\nIn preparation for upgrading to LLVM 5.0 it looks like we need to tweak how we\ncross compile LLVM slightly. It's using `CMAKE_SYSTEM_NAME` to infer whether to\nbuild libFuzzer which only works on some platforms, and then once we configure\nthat it needs to apparently reach into the host build area to try to compile\n`llvm-config` as well. Once these are both configured, though, it looks like we\ncan successfully cross-compile LLVM.", "tree": {"sha": "de70bd5786fed2683a886079496431bf7465f348", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/de70bd5786fed2683a886079496431bf7465f348"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8d0ad26b955f21643bebe71518a74d1ecb3016ae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8d0ad26b955f21643bebe71518a74d1ecb3016ae", "html_url": "https://github.com/rust-lang/rust/commit/8d0ad26b955f21643bebe71518a74d1ecb3016ae", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8d0ad26b955f21643bebe71518a74d1ecb3016ae/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6dd8744a11393f4969e6525e313070b34783b2e0", "url": "https://api.github.com/repos/rust-lang/rust/commits/6dd8744a11393f4969e6525e313070b34783b2e0", "html_url": "https://github.com/rust-lang/rust/commit/6dd8744a11393f4969e6525e313070b34783b2e0"}, {"sha": "069a1b3c8f514b04251788108ecebfa672e942ae", "url": "https://api.github.com/repos/rust-lang/rust/commits/069a1b3c8f514b04251788108ecebfa672e942ae", "html_url": "https://github.com/rust-lang/rust/commit/069a1b3c8f514b04251788108ecebfa672e942ae"}], "stats": {"total": 8, "additions": 8, "deletions": 0}, "files": [{"sha": "bb80674c8877f695364915c8ec62e7c265dde5e8", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8d0ad26b955f21643bebe71518a74d1ecb3016ae/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8d0ad26b955f21643bebe71518a74d1ecb3016ae/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=8d0ad26b955f21643bebe71518a74d1ecb3016ae", "patch": "@@ -154,6 +154,14 @@ impl Step for Llvm {\n             let host = build.llvm_out(build.build).join(\"bin/llvm-tblgen\");\n             cfg.define(\"CMAKE_CROSSCOMPILING\", \"True\")\n                .define(\"LLVM_TABLEGEN\", &host);\n+\n+            if target.contains(\"netbsd\") {\n+               cfg.define(\"CMAKE_SYSTEM_NAME\", \"NetBSD\");\n+            } else if target.contains(\"freebsd\") {\n+               cfg.define(\"CMAKE_SYSTEM_NAME\", \"FreeBSD\");\n+            }\n+\n+            cfg.define(\"LLVM_NATIVE_BUILD\", build.llvm_out(build.build).join(\"build\"));\n         }\n \n         let sanitize_cc = |cc: &Path| {"}]}