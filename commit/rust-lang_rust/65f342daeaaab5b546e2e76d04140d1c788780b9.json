{"sha": "65f342daeaaab5b546e2e76d04140d1c788780b9", "node_id": "C_kwDOAAsO6NoAKDY1ZjM0MmRhZWFhYWI1YjU0NmUyZTc2ZDA0MTQwZDFjNzg4NzgwYjk", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-06-10T18:34:42Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2022-12-25T18:48:31Z"}, "message": "Enable relative span hashing.", "tree": {"sha": "732af8ee70974edd670833ffd93c353648132994", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/732af8ee70974edd670833ffd93c353648132994"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/65f342daeaaab5b546e2e76d04140d1c788780b9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/65f342daeaaab5b546e2e76d04140d1c788780b9", "html_url": "https://github.com/rust-lang/rust/commit/65f342daeaaab5b546e2e76d04140d1c788780b9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/65f342daeaaab5b546e2e76d04140d1c788780b9/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "66e0316414072908e23d65edb8ae3f8bcdcf5bac", "url": "https://api.github.com/repos/rust-lang/rust/commits/66e0316414072908e23d65edb8ae3f8bcdcf5bac", "html_url": "https://github.com/rust-lang/rust/commit/66e0316414072908e23d65edb8ae3f8bcdcf5bac"}], "stats": {"total": 8, "additions": 3, "deletions": 5}, "files": [{"sha": "bff48a6d0a1b36aae1179220bbe0c41e438154a4", "filename": "compiler/rustc_ast_lowering/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/65f342daeaaab5b546e2e76d04140d1c788780b9/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/65f342daeaaab5b546e2e76d04140d1c788780b9/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs?ref=65f342daeaaab5b546e2e76d04140d1c788780b9", "patch": "@@ -776,7 +776,7 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n     /// Intercept all spans entering HIR.\n     /// Mark a span as relative to the current owning item.\n     fn lower_span(&self, span: Span) -> Span {\n-        if self.tcx.sess.opts.unstable_opts.incremental_relative_spans {\n+        if self.tcx.sess.opts.incremental.is_some() {\n             span.with_parent(Some(self.current_hir_id_owner.def_id))\n         } else {\n             // Do not make spans relative when not using incremental compilation."}, {"sha": "32dbe579fb47bb5278b26bdedd0ba2183076b385", "filename": "compiler/rustc_expand/src/expand.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/65f342daeaaab5b546e2e76d04140d1c788780b9/compiler%2Frustc_expand%2Fsrc%2Fexpand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/65f342daeaaab5b546e2e76d04140d1c788780b9/compiler%2Frustc_expand%2Fsrc%2Fexpand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_expand%2Fsrc%2Fexpand.rs?ref=65f342daeaaab5b546e2e76d04140d1c788780b9", "patch": "@@ -587,7 +587,7 @@ impl<'a, 'b> MacroExpander<'a, 'b> {\n                 .resolver\n                 .visit_ast_fragment_with_placeholders(self.cx.current_expansion.id, &fragment);\n \n-            if self.cx.sess.opts.unstable_opts.incremental_relative_spans {\n+            if self.cx.sess.opts.incremental.is_some() {\n                 for (invoc, _) in invocations.iter_mut() {\n                     let expn_id = invoc.expansion_data.id;\n                     let parent_def = self.cx.resolver.invocation_parent(expn_id);"}, {"sha": "ec5f7f7917b6a56e2f0782055bb9ccda1a602033", "filename": "compiler/rustc_middle/src/hir/map/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/65f342daeaaab5b546e2e76d04140d1c788780b9/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/65f342daeaaab5b546e2e76d04140d1c788780b9/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs?ref=65f342daeaaab5b546e2e76d04140d1c788780b9", "patch": "@@ -1162,7 +1162,7 @@ pub(super) fn crate_hash(tcx: TyCtxt<'_>, crate_num: CrateNum) -> Svh {\n         hir_body_hash.hash_stable(&mut hcx, &mut stable_hasher);\n         upstream_crates.hash_stable(&mut hcx, &mut stable_hasher);\n         source_file_names.hash_stable(&mut hcx, &mut stable_hasher);\n-        if tcx.sess.opts.unstable_opts.incremental_relative_spans {\n+        if tcx.sess.opts.incremental.is_some() {\n             let definitions = tcx.definitions_untracked();\n             let mut owner_spans: Vec<_> = krate\n                 .owners"}, {"sha": "cd2c9f4d0eaa4dc9050810f1a3b774115805190d", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/65f342daeaaab5b546e2e76d04140d1c788780b9/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/65f342daeaaab5b546e2e76d04140d1c788780b9/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=65f342daeaaab5b546e2e76d04140d1c788780b9", "patch": "@@ -1338,8 +1338,6 @@ options! {\n     incremental_info: bool = (false, parse_bool, [UNTRACKED],\n         \"print high-level information about incremental reuse (or the lack thereof) \\\n         (default: no)\"),\n-    incremental_relative_spans: bool = (false, parse_bool, [TRACKED],\n-        \"hash spans relative to their parent item for incr. comp. (default: no)\"),\n     incremental_verify_ich: bool = (false, parse_bool, [UNTRACKED],\n         \"verify incr. comp. hashes of green query instances (default: no)\"),\n     inline_in_all_cgus: Option<bool> = (None, parse_opt_bool, [TRACKED],"}]}