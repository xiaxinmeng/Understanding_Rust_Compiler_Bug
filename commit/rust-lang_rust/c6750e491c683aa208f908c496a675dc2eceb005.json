{"sha": "c6750e491c683aa208f908c496a675dc2eceb005", "node_id": "C_kwDOAAsO6NoAKGM2NzUwZTQ5MWM2ODNhYTIwOGY5MDhjNDk2YTY3NWRjMmVjZWIwMDU", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-04-01T04:59:45Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-04-01T04:59:45Z"}, "message": "Rollup merge of #95530 - notriddle:notriddle/private-kw-prim, r=jsha\n\nrustdoc: do not show primitives and keywords as private\n\nFixes this:\n\n![image](https://user-images.githubusercontent.com/1593513/161102430-f1f0301e-3e7f-453f-9c0a-bc87a12b893d.png)", "tree": {"sha": "db62c00a36ded1946a02b6070477630547180371", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/db62c00a36ded1946a02b6070477630547180371"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c6750e491c683aa208f908c496a675dc2eceb005", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiRobBCRBK7hj4Ov3rIwAAuacIADEManu/bnRLu97LvA6AJq07\ncgHR2buMgtTSU0I+tDEEAK8gB+K+dIrTDeGibu99tZB7F+6ybvAyGH1MqENq1cX4\neyWQRbTjqFaAVego17UayiJ+Kk1D4F+EfM+8gCy+/yzma8DLDWVfTRgMCkx4fkGc\nxa0u+DVHbdFeghSjRd2QF/VUrtf1lZGeMzixZcuopiAbhSXTS1Fh+HuilkaVIz5a\nKAU7J6mH1G6vnJjghuqUYzaOirI0A973imzXgosVfoBqUE31o8zDaSdhzhH7GSIf\nXCdnmdE0BBz9VMEY5TEG9ZUZ+N8DzP9+m1D/Il/RykaRLwhkjUvmtFAJ4HbRCkM=\n=jIyz\n-----END PGP SIGNATURE-----\n", "payload": "tree db62c00a36ded1946a02b6070477630547180371\nparent cdf178f776371bb0320769f95810c3c4fa668404\nparent 2983698b203d32a5c59234c022e8ff8dc532b515\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1648789185 +0200\ncommitter GitHub <noreply@github.com> 1648789185 +0200\n\nRollup merge of #95530 - notriddle:notriddle/private-kw-prim, r=jsha\n\nrustdoc: do not show primitives and keywords as private\n\nFixes this:\n\n![image](https://user-images.githubusercontent.com/1593513/161102430-f1f0301e-3e7f-453f-9c0a-bc87a12b893d.png)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c6750e491c683aa208f908c496a675dc2eceb005", "html_url": "https://github.com/rust-lang/rust/commit/c6750e491c683aa208f908c496a675dc2eceb005", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c6750e491c683aa208f908c496a675dc2eceb005/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cdf178f776371bb0320769f95810c3c4fa668404", "url": "https://api.github.com/repos/rust-lang/rust/commits/cdf178f776371bb0320769f95810c3c4fa668404", "html_url": "https://github.com/rust-lang/rust/commit/cdf178f776371bb0320769f95810c3c4fa668404"}, {"sha": "2983698b203d32a5c59234c022e8ff8dc532b515", "url": "https://api.github.com/repos/rust-lang/rust/commits/2983698b203d32a5c59234c022e8ff8dc532b515", "html_url": "https://github.com/rust-lang/rust/commit/2983698b203d32a5c59234c022e8ff8dc532b515"}], "stats": {"total": 41, "additions": 33, "deletions": 8}, "files": [{"sha": "7698c2de24d5c8d9e3b21b6c2d02a07aec0b1252", "filename": "src/librustdoc/clean/types.rs", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/c6750e491c683aa208f908c496a675dc2eceb005/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6750e491c683aa208f908c496a675dc2eceb005/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Ftypes.rs?ref=c6750e491c683aa208f908c496a675dc2eceb005", "patch": "@@ -493,14 +493,17 @@ impl Item {\n     ) -> Item {\n         trace!(\"name={:?}, def_id={:?}\", name, def_id);\n \n-        Item {\n-            def_id: def_id.into(),\n-            kind: box kind,\n-            name,\n-            attrs,\n-            visibility: cx.tcx.visibility(def_id).clean(cx),\n-            cfg,\n-        }\n+        // Primitives and Keywords are written in the source code as private modules.\n+        // The modules need to be private so that nobody actually uses them, but the\n+        // keywords and primitives that they are documenting are public.\n+        let visibility = if matches!(&kind, ItemKind::KeywordItem(..) | ItemKind::PrimitiveItem(..))\n+        {\n+            Visibility::Public\n+        } else {\n+            cx.tcx.visibility(def_id).clean(cx)\n+        };\n+\n+        Item { def_id: def_id.into(), kind: box kind, name, attrs, visibility, cfg }\n     }\n \n     /// Finds all `doc` attributes as NameValues and returns their corresponding values, joined"}, {"sha": "1cebe4c6797703667ec1f944bc2e92a71da3fd85", "filename": "src/test/rustdoc/keyword.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c6750e491c683aa208f908c496a675dc2eceb005/src%2Ftest%2Frustdoc%2Fkeyword.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6750e491c683aa208f908c496a675dc2eceb005/src%2Ftest%2Frustdoc%2Fkeyword.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fkeyword.rs?ref=c6750e491c683aa208f908c496a675dc2eceb005", "patch": "@@ -12,6 +12,7 @@\n // @has foo/index.html '//a/@href' '../foo/index.html'\n // @!has foo/foo/index.html\n // @!has-dir foo/foo\n+// @!has foo/index.html '//span' '\ud83d\udd12'\n #[doc(keyword = \"match\")]\n /// this is a test!\n mod foo{}"}, {"sha": "605ca4d170b39d7088f1c9d41951e22c9ef09888", "filename": "src/test/rustdoc/primitive.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/c6750e491c683aa208f908c496a675dc2eceb005/src%2Ftest%2Frustdoc%2Fprimitive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6750e491c683aa208f908c496a675dc2eceb005/src%2Ftest%2Frustdoc%2Fprimitive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fprimitive.rs?ref=c6750e491c683aa208f908c496a675dc2eceb005", "patch": "@@ -0,0 +1,21 @@\n+#![crate_name = \"foo\"]\n+\n+#![feature(rustdoc_internals)]\n+\n+// @has foo/index.html '//h2[@id=\"primitives\"]' 'Primitive Types'\n+// @has foo/index.html '//a[@href=\"primitive.i32.html\"]' 'i32'\n+// @has foo/index.html '//div[@class=\"sidebar-elems\"]//li/a' 'Primitive Types'\n+// @has foo/index.html '//div[@class=\"sidebar-elems\"]//li/a/@href' '#primitives'\n+// @has foo/primitive.i32.html '//a[@class=\"primitive\"]' 'i32'\n+// @has foo/primitive.i32.html '//span[@class=\"in-band\"]' 'Primitive Type i32'\n+// @has foo/primitive.i32.html '//section[@id=\"main-content\"]//div[@class=\"docblock\"]//p' 'this is a test!'\n+// @has foo/index.html '//a/@href' '../foo/index.html'\n+// @!has foo/index.html '//span' '\ud83d\udd12'\n+#[doc(primitive = \"i32\")]\n+/// this is a test!\n+mod i32{}\n+\n+// @has foo/primitive.bool.html '//section[@id=\"main-content\"]//div[@class=\"docblock\"]//p' 'hello'\n+#[doc(primitive = \"bool\")]\n+/// hello\n+mod bool {}"}]}