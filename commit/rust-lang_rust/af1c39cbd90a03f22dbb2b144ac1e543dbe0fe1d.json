{"sha": "af1c39cbd90a03f22dbb2b144ac1e543dbe0fe1d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFmMWMzOWNiZDkwYTAzZjIyZGJiMmIxNDRhYzFlNTQzZGJlMGZlMWQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-04-15T06:18:51Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-04-15T06:18:51Z"}, "message": "Auto merge of #24211 - alexcrichton:windows-wsa-flag-overlapped, r=aturon\n\nThis commit modifies the socket creation functions on windows to always specify\r\nthe `WSA_FLAG_OVERLAPPED` and `WSA_FLAG_NO_HANDLE_INHERIT` flags by default. The\r\noverlapped flag enables IOCP APIs on Windows to be used with the socket at no\r\ncost, enabling better interoperation with external libraries. The no handle\r\ninherit flag mirrors the upcoming change to Unix to set CLOEXEC by default for\r\nall handles.\r\n\r\nCloses #24206", "tree": {"sha": "6ee70a29945bc68db8021b29c314421faea89a48", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6ee70a29945bc68db8021b29c314421faea89a48"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/af1c39cbd90a03f22dbb2b144ac1e543dbe0fe1d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/af1c39cbd90a03f22dbb2b144ac1e543dbe0fe1d", "html_url": "https://github.com/rust-lang/rust/commit/af1c39cbd90a03f22dbb2b144ac1e543dbe0fe1d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/af1c39cbd90a03f22dbb2b144ac1e543dbe0fe1d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c7734429ea97098a92951965bff3c56e566d2a95", "url": "https://api.github.com/repos/rust-lang/rust/commits/c7734429ea97098a92951965bff3c56e566d2a95", "html_url": "https://github.com/rust-lang/rust/commit/c7734429ea97098a92951965bff3c56e566d2a95"}, {"sha": "433f0e8d1fbd25693172f71e5a577bb9625b45b0", "url": "https://api.github.com/repos/rust-lang/rust/commits/433f0e8d1fbd25693172f71e5a577bb9625b45b0", "html_url": "https://github.com/rust-lang/rust/commit/433f0e8d1fbd25693172f71e5a577bb9625b45b0"}], "stats": {"total": 12, "additions": 10, "deletions": 2}, "files": [{"sha": "dcab2ace5b214709f7d1f9b7c04f2dff58ef0420", "filename": "src/libstd/sys/windows/c.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/af1c39cbd90a03f22dbb2b144ac1e543dbe0fe1d/src%2Flibstd%2Fsys%2Fwindows%2Fc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af1c39cbd90a03f22dbb2b144ac1e543dbe0fe1d/src%2Flibstd%2Fsys%2Fwindows%2Fc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fwindows%2Fc.rs?ref=af1c39cbd90a03f22dbb2b144ac1e543dbe0fe1d", "patch": "@@ -44,6 +44,8 @@ pub const WSA_WAIT_TIMEOUT: libc::DWORD = libc::consts::os::extra::WAIT_TIMEOUT;\n pub const WSA_WAIT_EVENT_0: libc::DWORD = libc::consts::os::extra::WAIT_OBJECT_0;\n pub const WSA_WAIT_FAILED: libc::DWORD = libc::consts::os::extra::WAIT_FAILED;\n pub const WSAESHUTDOWN: libc::c_int = 10058;\n+pub const WSA_FLAG_OVERLAPPED: libc::DWORD = 0x01;\n+pub const WSA_FLAG_NO_HANDLE_INHERIT: libc::DWORD = 0x80;\n \n pub const ERROR_NO_MORE_FILES: libc::DWORD = 18;\n pub const TOKEN_READ: libc::DWORD = 0x20008;"}, {"sha": "cbc3876dbb116d7971ed37cccdeaa2b32b3a6a9b", "filename": "src/libstd/sys/windows/net.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/af1c39cbd90a03f22dbb2b144ac1e543dbe0fe1d/src%2Flibstd%2Fsys%2Fwindows%2Fnet.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af1c39cbd90a03f22dbb2b144ac1e543dbe0fe1d/src%2Flibstd%2Fsys%2Fwindows%2Fnet.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fwindows%2Fnet.rs?ref=af1c39cbd90a03f22dbb2b144ac1e543dbe0fe1d", "patch": "@@ -80,7 +80,11 @@ impl Socket {\n             SocketAddr::V4(..) => libc::AF_INET,\n             SocketAddr::V6(..) => libc::AF_INET6,\n         };\n-        match unsafe { libc::socket(fam, ty, 0) } {\n+        let socket = unsafe {\n+            c::WSASocketW(fam, ty, 0, 0 as *mut _, 0,\n+                          c::WSA_FLAG_OVERLAPPED | c::WSA_FLAG_NO_HANDLE_INHERIT)\n+        };\n+        match socket {\n             INVALID_SOCKET => Err(last_error()),\n             n => Ok(Socket(n)),\n         }\n@@ -103,7 +107,9 @@ impl Socket {\n             match c::WSASocketW(info.iAddressFamily,\n                                 info.iSocketType,\n                                 info.iProtocol,\n-                                &mut info, 0, 0) {\n+                                &mut info, 0,\n+                                c::WSA_FLAG_OVERLAPPED |\n+                                    c::WSA_FLAG_NO_HANDLE_INHERIT) {\n                 INVALID_SOCKET => Err(last_error()),\n                 n => Ok(Socket(n)),\n             }"}]}