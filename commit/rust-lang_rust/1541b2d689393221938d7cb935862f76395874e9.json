{"sha": "1541b2d689393221938d7cb935862f76395874e9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE1NDFiMmQ2ODkzOTMyMjE5MzhkN2NiOTM1ODYyZjc2Mzk1ODc0ZTk=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-06-16T19:58:33Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-06-16T19:58:33Z"}, "message": "Merge #1409\n\n1409: The Fall down of failures r=matklad a=mominul\n\n:grin:\r\nReplaced all the uses of `failure` crate with `std::error::Error`.\r\n\r\nCloses #1400 \r\nDepends on rust-analyzer/teraron#1\n\nCo-authored-by: Muhammad Mominul Huque <mominul2082@gmail.com>", "tree": {"sha": "5f9c9c4dc33f2ad7a1350ffb7b0459abcd7fbc41", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5f9c9c4dc33f2ad7a1350ffb7b0459abcd7fbc41"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1541b2d689393221938d7cb935862f76395874e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1541b2d689393221938d7cb935862f76395874e9", "html_url": "https://github.com/rust-lang/rust/commit/1541b2d689393221938d7cb935862f76395874e9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1541b2d689393221938d7cb935862f76395874e9/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "924d4d7ca8bce948b8cbb30ef6da17354e48bad3", "url": "https://api.github.com/repos/rust-lang/rust/commits/924d4d7ca8bce948b8cbb30ef6da17354e48bad3", "html_url": "https://github.com/rust-lang/rust/commit/924d4d7ca8bce948b8cbb30ef6da17354e48bad3"}, {"sha": "d3e74bfd2c1f7dca2054e1cfdc7aa312c9d12c98", "url": "https://api.github.com/repos/rust-lang/rust/commits/d3e74bfd2c1f7dca2054e1cfdc7aa312c9d12c98", "html_url": "https://github.com/rust-lang/rust/commit/d3e74bfd2c1f7dca2054e1cfdc7aa312c9d12c98"}], "stats": {"total": 43, "additions": 19, "deletions": 24}, "files": [{"sha": "b7489fda5e73e8d077d7a83a116ac10c4746063d", "filename": "Cargo.lock", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/1541b2d689393221938d7cb935862f76395874e9/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/1541b2d689393221938d7cb935862f76395874e9/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=1541b2d689393221938d7cb935862f76395874e9", "patch": "@@ -1227,9 +1227,8 @@ name = \"ra_tools\"\n version = \"0.1.0\"\n dependencies = [\n  \"clap 2.33.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"failure 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"itertools 0.8.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"teraron 0.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"teraron 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"walkdir 2.2.7 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n@@ -1684,10 +1683,9 @@ dependencies = [\n \n [[package]]\n name = \"teraron\"\n-version = \"0.0.1\"\n+version = \"0.1.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"failure 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"heck 0.3.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"ron 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"tera 0.11.20 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -2145,7 +2143,7 @@ dependencies = [\n \"checksum synstructure 0.10.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"02353edf96d6e4dc81aea2d8490a7e9db177bf8acb0e951c24940bf866cb313f\"\n \"checksum tempfile 3.0.8 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7dc4738f2e68ed2855de5ac9cdbe05c9216773ecde4739b2f095002ab03a13ef\"\n \"checksum tera 0.11.20 (registry+https://github.com/rust-lang/crates.io-index)\" = \"4b505279e19d8f7d24b1a9dc58327c9c36174b1a2c7ebdeac70792d017cb64f3\"\n-\"checksum teraron 0.0.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0d89ad4617d1dec55331067fadaa041e813479e1779616f3d3ce9308bf46184e\"\n+\"checksum teraron 0.1.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"9a447d012fef5c222f4b11a98fcef2a7e347a57f28be9957c5c390ac9a0e41e0\"\n \"checksum termion 1.5.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"dde0593aeb8d47accea5392b39350015b5eccb12c0d98044d856983d89548dea\"\n \"checksum termios 0.3.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"72b620c5ea021d75a735c943269bb07d30c9b77d6ac6b236bc8b5c496ef05625\"\n \"checksum text_unit 0.1.9 (registry+https://github.com/rust-lang/crates.io-index)\" = \"e08bbcb7a3adbda0eb23431206b653bdad3d8dea311e72d36bf2215e27a42579\""}, {"sha": "9c543099298cfe122d77aee45ae5e2f71d7d0993", "filename": "crates/ra_tools/Cargo.toml", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1541b2d689393221938d7cb935862f76395874e9/crates%2Fra_tools%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/1541b2d689393221938d7cb935862f76395874e9/crates%2Fra_tools%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_tools%2FCargo.toml?ref=1541b2d689393221938d7cb935862f76395874e9", "patch": "@@ -6,8 +6,7 @@ authors = [\"rust-analyzer developers\"]\n publish = false\n \n [dependencies]\n-teraron = \"0.0.1\"\n+teraron = \"0.1.0\"\n walkdir = \"2.1.3\"\n itertools = \"0.8.0\"\n clap = \"2.32.0\"\n-failure = \"0.1.4\""}, {"sha": "95bb55cae98a7f5a489ccbaf3c66374fb3cf1b27", "filename": "crates/ra_tools/src/bin/pre-commit.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/1541b2d689393221938d7cb935862f76395874e9/crates%2Fra_tools%2Fsrc%2Fbin%2Fpre-commit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1541b2d689393221938d7cb935862f76395874e9/crates%2Fra_tools%2Fsrc%2Fbin%2Fpre-commit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_tools%2Fsrc%2Fbin%2Fpre-commit.rs?ref=1541b2d689393221938d7cb935862f76395874e9", "patch": "@@ -1,7 +1,5 @@\n use std::process::Command;\n \n-use failure::bail;\n-\n use ra_tools::{Result, run_rustfmt, run, project_root, Overwrite};\n \n fn main() -> Result<()> {\n@@ -19,7 +17,10 @@ fn update_staged() -> Result<()> {\n         .current_dir(&root)\n         .output()?;\n     if !output.status.success() {\n-        bail!(\"`git diff --diff-filter=MAR --name-only --cached` exited with {}\", output.status);\n+        Err(format!(\n+            \"`git diff --diff-filter=MAR --name-only --cached` exited with {}\",\n+            output.status\n+        ))?;\n     }\n     for line in String::from_utf8(output.stdout)?.lines() {\n         run(&format!(\"git update-index --add {}\", root.join(line).to_string_lossy()), \".\")?;"}, {"sha": "821209567db7735f6ab8446c4efd978e0ed45664", "filename": "crates/ra_tools/src/lib.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/1541b2d689393221938d7cb935862f76395874e9/crates%2Fra_tools%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1541b2d689393221938d7cb935862f76395874e9/crates%2Fra_tools%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_tools%2Fsrc%2Flib.rs?ref=1541b2d689393221938d7cb935862f76395874e9", "patch": "@@ -3,15 +3,15 @@ use std::{\n     collections::HashMap,\n     path::{Path, PathBuf},\n     process::{Command, Output, Stdio},\n-    io::{Error, ErrorKind}\n+    io::{Error as IoError, ErrorKind},\n+    error::Error\n };\n \n-use failure::bail;\n use itertools::Itertools;\n \n pub use teraron::{Mode, Overwrite, Verify};\n \n-pub type Result<T> = std::result::Result<T, failure::Error>;\n+pub type Result<T> = std::result::Result<T, Box<dyn Error>>;\n \n pub const GRAMMAR: &str = \"crates/ra_syntax/src/grammar.ron\";\n const GRAMMAR_DIR: &str = \"crates/ra_parser/src/grammar\";\n@@ -128,7 +128,7 @@ pub fn install_format_hook() -> Result<()> {\n             fs::copy(\"./target/debug/pre-commit\", result_path)?;\n         }\n     } else {\n-        return Err(Error::new(ErrorKind::AlreadyExists, \"Git hook already created\").into());\n+        Err(IoError::new(ErrorKind::AlreadyExists, \"Git hook already created\"))?;\n     }\n     Ok(())\n }\n@@ -224,7 +224,7 @@ where\n     f(cmd.args(args).current_dir(proj_dir).stderr(Stdio::inherit()));\n     let output = cmd.output()?;\n     if !output.status.success() {\n-        bail!(\"`{}` exited with {}\", cmdline, output.status);\n+        Err(format!(\"`{}` exited with {}\", cmdline, output.status))?;\n     }\n     Ok(output)\n }\n@@ -256,11 +256,11 @@ fn tests_from_dir(dir: &Path) -> Result<Tests> {\n         for (_, test) in collect_tests(&text) {\n             if test.ok {\n                 if let Some(old_test) = res.ok.insert(test.name.clone(), test) {\n-                    bail!(\"Duplicate test: {}\", old_test.name)\n+                    Err(format!(\"Duplicate test: {}\", old_test.name))?\n                 }\n             } else {\n                 if let Some(old_test) = res.err.insert(test.name.clone(), test) {\n-                    bail!(\"Duplicate test: {}\", old_test.name)\n+                    Err(format!(\"Duplicate test: {}\", old_test.name))?\n                 }\n             }\n         }"}, {"sha": "846e0223e0c44721d3de81e6c29f7c7078ba6683", "filename": "crates/ra_tools/src/main.rs", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/1541b2d689393221938d7cb935862f76395874e9/crates%2Fra_tools%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1541b2d689393221938d7cb935862f76395874e9/crates%2Fra_tools%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_tools%2Fsrc%2Fmain.rs?ref=1541b2d689393221938d7cb935862f76395874e9", "patch": "@@ -1,6 +1,5 @@\n use clap::{App, SubCommand};\n use core::str;\n-use failure::bail;\n use ra_tools::{\n     generate, gen_tests, install_format_hook, run, run_with_output, run_rustfmt,\n     Overwrite, Result, run_fuzzer, run_clippy,\n@@ -64,10 +63,8 @@ fn verify_installed_extensions() -> Result<()> {\n         run_with_output(r\"code --list-extensions\", \".\")?\n     };\n     if !str::from_utf8(&exts.stdout)?.contains(\"ra-lsp\") {\n-        bail!(\n-            \"Could not install the Visual Studio Code extension. Please make sure you \\\n-             have at least NodeJS 10.x installed and try again.\"\n-        );\n+        Err(\"Could not install the Visual Studio Code extension. Please make sure you \\\n+             have at least NodeJS 10.x installed and try again.\")?;\n     }\n     Ok(())\n }\n@@ -79,7 +76,7 @@ fn fix_path_for_mac() -> Result<()> {\n         const ROOT_DIR: &str = \"\";\n         let home_dir = match env::var(\"HOME\") {\n             Ok(home) => home,\n-            Err(e) => bail!(\"Failed getting HOME from environment with error: {}.\", e),\n+            Err(e) => Err(format!(\"Failed getting HOME from environment with error: {}.\", e))?,\n         };\n \n         [ROOT_DIR, &home_dir]\n@@ -93,7 +90,7 @@ fn fix_path_for_mac() -> Result<()> {\n     if !vscode_path.is_empty() {\n         let vars = match env::var_os(\"PATH\") {\n             Some(path) => path,\n-            None => bail!(\"Could not get PATH variable from env.\"),\n+            None => Err(\"Could not get PATH variable from env.\")?,\n         };\n \n         let mut paths = env::split_paths(&vars).collect::<Vec<_>>();"}]}