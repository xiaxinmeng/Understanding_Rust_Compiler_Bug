{"sha": "4c8c0fc1e2145b520ef31d1bf5e4d3fa1050c579", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRjOGMwZmMxZTIxNDViNTIwZWYzMWQxYmY1ZTRkM2ZhMTA1MGM1Nzk=", "commit": {"author": {"name": "Jethro Beekman", "email": "jethro@fortanix.com", "date": "2019-02-05T10:49:05Z"}, "committer": {"name": "Jethro Beekman", "email": "jethro@fortanix.com", "date": "2019-02-05T10:49:05Z"}, "message": "SGX target: handle empty user buffers correctly", "tree": {"sha": "68f806b3d510ed824444521170753029aa88fef7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/68f806b3d510ed824444521170753029aa88fef7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4c8c0fc1e2145b520ef31d1bf5e4d3fa1050c579", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4c8c0fc1e2145b520ef31d1bf5e4d3fa1050c579", "html_url": "https://github.com/rust-lang/rust/commit/4c8c0fc1e2145b520ef31d1bf5e4d3fa1050c579", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4c8c0fc1e2145b520ef31d1bf5e4d3fa1050c579/comments", "author": null, "committer": null, "parents": [{"sha": "147311c5fc62537da8eb9c6f69536bec6719d534", "url": "https://api.github.com/repos/rust-lang/rust/commits/147311c5fc62537da8eb9c6f69536bec6719d534", "html_url": "https://github.com/rust-lang/rust/commit/147311c5fc62537da8eb9c6f69536bec6719d534"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "2efbaa9b1487ae2ce779f3ff9f57094482dbc005", "filename": "src/libstd/sys/sgx/abi/usercalls/alloc.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/4c8c0fc1e2145b520ef31d1bf5e4d3fa1050c579/src%2Flibstd%2Fsys%2Fsgx%2Fabi%2Fusercalls%2Falloc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4c8c0fc1e2145b520ef31d1bf5e4d3fa1050c579/src%2Flibstd%2Fsys%2Fsgx%2Fabi%2Fusercalls%2Falloc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fsgx%2Fabi%2Fusercalls%2Falloc.rs?ref=4c8c0fc1e2145b520ef31d1bf5e4d3fa1050c579", "patch": "@@ -537,7 +537,12 @@ impl UserRef<super::raw::ByteBuffer> {\n     pub fn copy_user_buffer(&self) -> Vec<u8> {\n         unsafe {\n             let buf = self.to_enclave();\n-            User::from_raw_parts(buf.data as _, buf.len).to_enclave()\n+            if buf.len > 0 {\n+                User::from_raw_parts(buf.data as _, buf.len).to_enclave()\n+            } else {\n+                // Mustn't look at `data` or call `free` if `len` is `0`.\n+                Vec::with_capacity(0)\n+            }\n         }\n     }\n }"}, {"sha": "511d6e9e9273ab870cfbf9ca839438b49c9830a4", "filename": "src/libstd/sys/sgx/abi/usercalls/mod.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/4c8c0fc1e2145b520ef31d1bf5e4d3fa1050c579/src%2Flibstd%2Fsys%2Fsgx%2Fabi%2Fusercalls%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4c8c0fc1e2145b520ef31d1bf5e4d3fa1050c579/src%2Flibstd%2Fsys%2Fsgx%2Fabi%2Fusercalls%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fsgx%2Fabi%2Fusercalls%2Fmod.rs?ref=4c8c0fc1e2145b520ef31d1bf5e4d3fa1050c579", "patch": "@@ -22,7 +22,8 @@ pub fn read(fd: Fd, buf: &mut [u8]) -> IoResult<usize> {\n #[unstable(feature = \"sgx_platform\", issue = \"56975\")]\n pub fn read_alloc(fd: Fd) -> IoResult<Vec<u8>> {\n     unsafe {\n-        let mut userbuf = alloc::User::<ByteBuffer>::uninitialized();\n+        let userbuf = ByteBuffer { data: ::ptr::null_mut(), len: 0 };\n+        let mut userbuf = alloc::User::new_from_enclave(&userbuf);\n         raw::read_alloc(fd, userbuf.as_raw_mut_ptr()).from_sgx_result()?;\n         Ok(userbuf.copy_user_buffer())\n     }"}]}