{"sha": "4bbda68d56f68161517742bf9fe8298a9a3c9c78", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRiYmRhNjhkNTZmNjgxNjE1MTc3NDJiZjlmZTgyOThhOWEzYzljNzg=", "commit": {"author": {"name": "Paul Florence", "email": "florencepaul@hotmail.fr", "date": "2017-10-20T14:00:44Z"}, "committer": {"name": "Paul Florence", "email": "florencepaul@hotmail.fr", "date": "2017-10-20T14:17:41Z"}, "message": "Better linting : use of span_lint_and_then.", "tree": {"sha": "f02ac9748bd468e9a08ad4040f7d1e200eea0117", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f02ac9748bd468e9a08ad4040f7d1e200eea0117"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4bbda68d56f68161517742bf9fe8298a9a3c9c78", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4bbda68d56f68161517742bf9fe8298a9a3c9c78", "html_url": "https://github.com/rust-lang/rust/commit/4bbda68d56f68161517742bf9fe8298a9a3c9c78", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4bbda68d56f68161517742bf9fe8298a9a3c9c78/comments", "author": {"login": "gbip", "id": 15819864, "node_id": "MDQ6VXNlcjE1ODE5ODY0", "avatar_url": "https://avatars.githubusercontent.com/u/15819864?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gbip", "html_url": "https://github.com/gbip", "followers_url": "https://api.github.com/users/gbip/followers", "following_url": "https://api.github.com/users/gbip/following{/other_user}", "gists_url": "https://api.github.com/users/gbip/gists{/gist_id}", "starred_url": "https://api.github.com/users/gbip/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gbip/subscriptions", "organizations_url": "https://api.github.com/users/gbip/orgs", "repos_url": "https://api.github.com/users/gbip/repos", "events_url": "https://api.github.com/users/gbip/events{/privacy}", "received_events_url": "https://api.github.com/users/gbip/received_events", "type": "User", "site_admin": false}, "committer": {"login": "gbip", "id": 15819864, "node_id": "MDQ6VXNlcjE1ODE5ODY0", "avatar_url": "https://avatars.githubusercontent.com/u/15819864?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gbip", "html_url": "https://github.com/gbip", "followers_url": "https://api.github.com/users/gbip/followers", "following_url": "https://api.github.com/users/gbip/following{/other_user}", "gists_url": "https://api.github.com/users/gbip/gists{/gist_id}", "starred_url": "https://api.github.com/users/gbip/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gbip/subscriptions", "organizations_url": "https://api.github.com/users/gbip/orgs", "repos_url": "https://api.github.com/users/gbip/repos", "events_url": "https://api.github.com/users/gbip/events{/privacy}", "received_events_url": "https://api.github.com/users/gbip/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fbce5046640e27db2502bec603e67ca3c430daae", "url": "https://api.github.com/repos/rust-lang/rust/commits/fbce5046640e27db2502bec603e67ca3c430daae", "html_url": "https://github.com/rust-lang/rust/commit/fbce5046640e27db2502bec603e67ca3c430daae"}], "stats": {"total": 78, "additions": 34, "deletions": 44}, "files": [{"sha": "4f2d86565329acedf1cde55d1525948d969e3277", "filename": "clippy_lints/src/const_static_lifetime.rs", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/4bbda68d56f68161517742bf9fe8298a9a3c9c78/clippy_lints%2Fsrc%2Fconst_static_lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4bbda68d56f68161517742bf9fe8298a9a3c9c78/clippy_lints%2Fsrc%2Fconst_static_lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fconst_static_lifetime.rs?ref=4bbda68d56f68161517742bf9fe8298a9a3c9c78", "patch": "@@ -1,16 +1,18 @@\n use syntax::ast::{Item, ItemKind, TyKind, Ty};\n use rustc::lint::{LintPass, EarlyLintPass, LintArray, EarlyContext};\n-use utils::{span_help_and_lint, in_macro};\n+use utils::{span_lint_and_then, in_macro};\n \n /// **What it does:** Checks for constants with an explicit `'static` lifetime.\n ///\n-/// **Why is this bad?** Adding `'static` to every reference can create very complicated types.\n+/// **Why is this bad?** Adding `'static` to every reference can create very\n+/// complicated types.\n ///\n /// **Known problems:** None.\n ///\n /// **Example:**\n /// ```rust\n-///  const FOO: &'static [(&'static str, &'static str, fn(&Bar) -> bool)] = &[..]\n+/// const FOO: &'static [(&'static str, &'static str, fn(&Bar) -> bool)] =\n+/// &[...]\n /// ```\n /// This code can be rewritten as\n /// ```rust\n@@ -52,11 +54,12 @@ impl StaticConst {\n                     if let TyKind::Path(_, _) = borrow_type.ty.node {\n                         // Verify that the path is a str\n                         if lifetime.ident.name == \"'static\" {\n-                            span_help_and_lint(cx,\n+                            let mut sug: String = String::new();\n+                            span_lint_and_then(cx,\n                                                CONST_STATIC_LIFETIME,\n                                                lifetime.span,\n                                                \"Constants have by default a `'static` lifetime\",\n-                                               \"consider removing `'static`\");\n+                                               |db| {db.span_suggestion(lifetime.span,\"consider removing `'static`\",sug);});\n                         }\n                     }\n                 }"}, {"sha": "a6fed5f58d29670a2f7d3177b6b17359d864aa57", "filename": "tests/ui/const_static_lifetime.stderr", "status": "modified", "additions": 26, "deletions": 39, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/4bbda68d56f68161517742bf9fe8298a9a3c9c78/tests%2Fui%2Fconst_static_lifetime.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4bbda68d56f68161517742bf9fe8298a9a3c9c78/tests%2Fui%2Fconst_static_lifetime.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fconst_static_lifetime.stderr?ref=4bbda68d56f68161517742bf9fe8298a9a3c9c78", "patch": "@@ -1,65 +1,52 @@\n+warning: running cargo clippy on a crate that also imports the clippy plugin\n+\n error: Constants have by default a `'static` lifetime\n- --> $DIR/const_static_lifetime.rs:6:17\n+ --> $DIR/const_static_lifetime.rs:7:17\n   |\n-6 | const VAR_ONE: &'static str = \"Test constant #1\"; // ERROR Consider removing 'static.\n-  |                 ^^^^^^^\n+7 | const VAR_ONE: &'static str = \"Test constant #1\"; // ERROR Consider removing 'static.\n+  |                 ^^^^^^^ help: consider removing `'static`: `&str`\n   |\n   = note: `-D const-static-lifetime` implied by `-D warnings`\n-  = help: consider removing `'static`\n \n error: Constants have by default a `'static` lifetime\n-  --> $DIR/const_static_lifetime.rs:10:21\n-   |\n-10 | const VAR_THREE: &[&'static str] = &[\"one\", \"two\"]; // ERROR Consider removing 'static\n-   |                     ^^^^^^^\n+  --> $DIR/const_static_lifetime.rs:11:21\n    |\n-   = help: consider removing `'static`\n+11 | const VAR_THREE: &[&'static str] = &[\"one\", \"two\"]; // ERROR Consider removing 'static\n+   |                     ^^^^^^^ help: consider removing `'static`: `&str`\n \n error: Constants have by default a `'static` lifetime\n-  --> $DIR/const_static_lifetime.rs:12:32\n+  --> $DIR/const_static_lifetime.rs:13:32\n    |\n-12 | const VAR_FOUR: (&str, (&str, &'static str), &'static str) = (\"on\", (\"th\", \"th\"), \"on\"); // ERROR Consider removing 'static\n-   |                                ^^^^^^^\n-   |\n-   = help: consider removing `'static`\n+13 | const VAR_FOUR: (&str, (&str, &'static str), &'static str) = (\"on\", (\"th\", \"th\"), \"on\"); // ERROR Consider removing 'static\n+   |                                ^^^^^^^ help: consider removing `'static`: `&str`\n \n error: Constants have by default a `'static` lifetime\n-  --> $DIR/const_static_lifetime.rs:12:47\n-   |\n-12 | const VAR_FOUR: (&str, (&str, &'static str), &'static str) = (\"on\", (\"th\", \"th\"), \"on\"); // ERROR Consider removing 'static\n-   |                                               ^^^^^^^\n+  --> $DIR/const_static_lifetime.rs:13:47\n    |\n-   = help: consider removing `'static`\n+13 | const VAR_FOUR: (&str, (&str, &'static str), &'static str) = (\"on\", (\"th\", \"th\"), \"on\"); // ERROR Consider removing 'static\n+   |                                               ^^^^^^^ help: consider removing `'static`: `&str`\n \n error: Constants have by default a `'static` lifetime\n-  --> $DIR/const_static_lifetime.rs:14:30\n+  --> $DIR/const_static_lifetime.rs:15:30\n    |\n-14 | const VAR_FIVE: &'static [&[&'static str]] = &[&[\"test\"], &[\"other one\"]]; // ERROR Consider removing 'static\n-   |                              ^^^^^^^\n-   |\n-   = help: consider removing `'static`\n+15 | const VAR_FIVE: &'static [&[&'static str]] = &[&[\"test\"], &[\"other one\"]]; // ERROR Consider removing 'static\n+   |                              ^^^^^^^ help: consider removing `'static`: `&str`\n \n error: Constants have by default a `'static` lifetime\n-  --> $DIR/const_static_lifetime.rs:16:17\n-   |\n-16 | const VAR_SIX: &'static u8 = &5;\n-   |                 ^^^^^^^\n+  --> $DIR/const_static_lifetime.rs:17:17\n    |\n-   = help: consider removing `'static`\n+17 | const VAR_SIX: &'static u8 = &5;\n+   |                 ^^^^^^^ help: consider removing `'static`: `&u8`\n \n error: Constants have by default a `'static` lifetime\n-  --> $DIR/const_static_lifetime.rs:18:39\n+  --> $DIR/const_static_lifetime.rs:19:39\n    |\n-18 | const VAR_SEVEN: &[&(&str, &'static [&'static str])] = &[&(\"one\", &[\"other one\"])];\n-   |                                       ^^^^^^^\n-   |\n-   = help: consider removing `'static`\n+19 | const VAR_SEVEN: &[&(&str, &'static [&'static str])] = &[&(\"one\", &[\"other one\"])];\n+   |                                       ^^^^^^^ help: consider removing `'static`: `&str`\n \n error: Constants have by default a `'static` lifetime\n-  --> $DIR/const_static_lifetime.rs:20:20\n-   |\n-20 | const VAR_HEIGHT: &'static Foo = &Foo {};\n-   |                    ^^^^^^^\n+  --> $DIR/const_static_lifetime.rs:21:20\n    |\n-   = help: consider removing `'static`\n+21 | const VAR_HEIGHT: &'static Foo = &Foo {};\n+   |                    ^^^^^^^ help: consider removing `'static`: `&Foo`\n "}]}