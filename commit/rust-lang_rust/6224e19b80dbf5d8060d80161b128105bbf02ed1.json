{"sha": "6224e19b80dbf5d8060d80161b128105bbf02ed1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYyMjRlMTliODBkYmY1ZDgwNjBkODAxNjFiMTI4MTA1YmJmMDJlZDE=", "commit": {"author": {"name": "flip1995", "email": "9744647+flip1995@users.noreply.github.com", "date": "2018-06-21T12:43:13Z"}, "committer": {"name": "flip1995", "email": "9744647+flip1995@users.noreply.github.com", "date": "2018-06-21T13:46:24Z"}, "message": "Check for arguments before accessing the first arg", "tree": {"sha": "67a15061c72751e22e08935d15ac6ecaed4ed0a2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/67a15061c72751e22e08935d15ac6ecaed4ed0a2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6224e19b80dbf5d8060d80161b128105bbf02ed1", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE8rLaPclMjvVJWRZHnxhOEWSDEYEFAlsrrDAACgkQnxhOEWSD\nEYEf0Q/+JmWC5lC51EfkjLDYVn/yz8zV5m+GD4nM4BYwN7Z5xxQc4rwuCinoZoya\n7uhhTp2el3vR2ZhWmTFJRCE6Hb0n1oAjwTKizKmCE3/hv9iPevmRjGgLZw9IHuhm\nMBL2v4OyQEdg6n1M4xPvsVanWSMEwTeGOVZCqPkSHygYLdxgU8AnO7hOBC0hb0cz\nCOt7E5ozDA/AonSPtkd9iMlY6YdyGI7q8pM2+BJOqxX9+uezj+NtXPdLMBAwWuR/\nrq3IFjEKp9zZTrvbugc747joGfqeUt2EEnXgq+yMtSI8J2Y1jNkNDVgtLe3hoK9Y\nU+LWEG1FHz0ESsDFsx/s2+QTJsgSLxVOnvrS3pFNqzpja3tUbyGawojKnBcs8/Xw\nyOcQHcon5uKVoWDdwkDOvG07jWONNfSQDETvXBgR9gY5tnOw96vFnebLj/Dn6uNm\nVZOvszU4bcRYzPAE20tCrRCi7W85kWlr5JBjYL7lnx+7yX7LTkKMYRcBJ/GXu6L0\nxvcB+DzZ4QFaxwt20f2drhj5vZtQMS6egb95kiC2rOgS0n7sqsj4LNdM1s/Il3yH\n21Jtc9ZdHFrzdndowYWQZZ8s4hVj+pIROZ2XxRKWofdqn+BtGUJzaSrto6ZqLBfo\n4BYtOHJRAAstAFrBdBgUHUzCxIHjEvIGYBHS0725Ie7Qt18sf/g=\n=1Ckf\n-----END PGP SIGNATURE-----", "payload": "tree 67a15061c72751e22e08935d15ac6ecaed4ed0a2\nparent 25510cfb13c374d98ab0171b530d0bd887eac2c6\nauthor flip1995 <9744647+flip1995@users.noreply.github.com> 1529584993 +0200\ncommitter flip1995 <9744647+flip1995@users.noreply.github.com> 1529588784 +0200\n\nCheck for arguments before accessing the first arg\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6224e19b80dbf5d8060d80161b128105bbf02ed1", "html_url": "https://github.com/rust-lang/rust/commit/6224e19b80dbf5d8060d80161b128105bbf02ed1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6224e19b80dbf5d8060d80161b128105bbf02ed1/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "25510cfb13c374d98ab0171b530d0bd887eac2c6", "url": "https://api.github.com/repos/rust-lang/rust/commits/25510cfb13c374d98ab0171b530d0bd887eac2c6", "html_url": "https://github.com/rust-lang/rust/commit/25510cfb13c374d98ab0171b530d0bd887eac2c6"}], "stats": {"total": 17, "additions": 16, "deletions": 1}, "files": [{"sha": "2befba5767d7a4e16bee62b6c9d1e0b367dad098", "filename": "clippy_lints/src/map_clone.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6224e19b80dbf5d8060d80161b128105bbf02ed1/clippy_lints%2Fsrc%2Fmap_clone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6224e19b80dbf5d8060d80161b128105bbf02ed1/clippy_lints%2Fsrc%2Fmap_clone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmap_clone.rs?ref=6224e19b80dbf5d8060d80161b128105bbf02ed1", "patch": "@@ -36,7 +36,6 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Pass {\n                     ExprClosure(_, ref decl, closure_eid, _, _) => {\n                         let body = cx.tcx.hir.body(closure_eid);\n                         let closure_expr = remove_blocks(&body.value);\n-                        let ty = cx.tables.pat_ty(&body.arguments[0].pat);\n                         if_chain! {\n                             // nothing special in the argument, besides reference bindings\n                             // (e.g. .map(|&x| x) )\n@@ -45,6 +44,8 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Pass {\n                             // the method is being called on a known type (option or iterator)\n                             if let Some(type_name) = get_type_name(cx, expr, &args[0]);\n                             then {\n+                                // We know that body.arguments is not empty at this point\n+                                let ty = cx.tables.pat_ty(&body.arguments[0].pat);\n                                 // look for derefs, for .map(|x| *x)\n                                 if only_derefs(cx, &*closure_expr, arg_ident) &&\n                                     // .cloned() only removes one level of indirection, don't lint on more"}, {"sha": "b35df667f27ab45540a8054dc2adbdc93ace661f", "filename": "tests/run-pass/issue-2862.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6224e19b80dbf5d8060d80161b128105bbf02ed1/tests%2Frun-pass%2Fissue-2862.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6224e19b80dbf5d8060d80161b128105bbf02ed1/tests%2Frun-pass%2Fissue-2862.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Fissue-2862.rs?ref=6224e19b80dbf5d8060d80161b128105bbf02ed1", "patch": "@@ -0,0 +1,14 @@\n+pub trait FooMap {\n+    fn map<B, F: Fn() -> B>(&self, f: F) -> B;\n+}\n+\n+impl FooMap for bool {\n+    fn map<B, F: Fn() -> B>(&self, f: F) -> B {\n+        f()\n+    }\n+}\n+\n+fn main() {\n+    let a = true;\n+    a.map(|| false);\n+}"}]}