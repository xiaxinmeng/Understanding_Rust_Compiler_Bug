{"sha": "c868414dcd50bbfe433cc93f8319d41e6742542c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM4Njg0MTRkY2Q1MGJiZmU0MzNjYzkzZjgzMTlkNDFlNjc0MjU0MmM=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2021-05-11T22:57:41Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2021-05-11T22:57:41Z"}, "message": "Revert \"Strip delimiter from fn-like proc macro input\"\n\nThis reverts commit bda68e23328ca62a71da348a13c4d13cc8f991f3.", "tree": {"sha": "852aceb23512b159e24316f58ef32c2f09ed8eb7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/852aceb23512b159e24316f58ef32c2f09ed8eb7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c868414dcd50bbfe433cc93f8319d41e6742542c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c868414dcd50bbfe433cc93f8319d41e6742542c", "html_url": "https://github.com/rust-lang/rust/commit/c868414dcd50bbfe433cc93f8319d41e6742542c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c868414dcd50bbfe433cc93f8319d41e6742542c/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c6e2ba43bbfef80d4ecabbc9edd5be9d058f6db9", "url": "https://api.github.com/repos/rust-lang/rust/commits/c6e2ba43bbfef80d4ecabbc9edd5be9d058f6db9", "html_url": "https://github.com/rust-lang/rust/commit/c6e2ba43bbfef80d4ecabbc9edd5be9d058f6db9"}], "stats": {"total": 35, "additions": 2, "deletions": 33}, "files": [{"sha": "112216859cf23f3a771191ba9835f864a484b913", "filename": "crates/hir_expand/src/input.rs", "status": "modified", "additions": 2, "deletions": 29, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/c868414dcd50bbfe433cc93f8319d41e6742542c/crates%2Fhir_expand%2Fsrc%2Finput.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c868414dcd50bbfe433cc93f8319d41e6742542c/crates%2Fhir_expand%2Fsrc%2Finput.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_expand%2Fsrc%2Finput.rs?ref=c868414dcd50bbfe433cc93f8319d41e6742542c", "patch": "@@ -1,9 +1,8 @@\n //! Macro input conditioning.\n \n-use parser::SyntaxKind;\n use syntax::{\n     ast::{self, AttrsOwner},\n-    AstNode, SyntaxElement, SyntaxNode,\n+    AstNode, SyntaxNode,\n };\n \n use crate::{\n@@ -20,33 +19,7 @@ pub(crate) fn process_macro_input(\n     let loc: MacroCallLoc = db.lookup_intern_macro(id);\n \n     match loc.kind {\n-        MacroCallKind::FnLike { .. } => {\n-            if !loc.def.is_proc_macro() {\n-                // MBE macros expect the parentheses as part of their input.\n-                return node;\n-            }\n-\n-            // The input includes the `(` + `)` delimiter tokens, so remove them before passing this\n-            // to the macro.\n-            let node = node.clone_for_update();\n-            if let Some(SyntaxElement::Token(tkn)) = node.first_child_or_token() {\n-                if matches!(\n-                    tkn.kind(),\n-                    SyntaxKind::L_BRACK | SyntaxKind::L_PAREN | SyntaxKind::L_CURLY\n-                ) {\n-                    tkn.detach();\n-                }\n-            }\n-            if let Some(SyntaxElement::Token(tkn)) = node.last_child_or_token() {\n-                if matches!(\n-                    tkn.kind(),\n-                    SyntaxKind::R_BRACK | SyntaxKind::R_PAREN | SyntaxKind::R_CURLY\n-                ) {\n-                    tkn.detach();\n-                }\n-            }\n-            node\n-        }\n+        MacroCallKind::FnLike { .. } => node,\n         MacroCallKind::Derive { derive_attr_index, .. } => {\n             let item = match ast::Item::cast(node.clone()) {\n                 Some(item) => item,"}, {"sha": "5df11856e90c366059826f05396b23c8de561ef5", "filename": "crates/hir_expand/src/lib.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c868414dcd50bbfe433cc93f8319d41e6742542c/crates%2Fhir_expand%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c868414dcd50bbfe433cc93f8319d41e6742542c/crates%2Fhir_expand%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_expand%2Fsrc%2Flib.rs?ref=c868414dcd50bbfe433cc93f8319d41e6742542c", "patch": "@@ -272,10 +272,6 @@ impl MacroDefId {\n         };\n         Either::Left(*id)\n     }\n-\n-    pub fn is_proc_macro(&self) -> bool {\n-        matches!(self.kind, MacroDefKind::ProcMacro(..))\n-    }\n }\n \n #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]"}]}