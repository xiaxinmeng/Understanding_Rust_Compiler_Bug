{"sha": "0d5264a03c2d873d9e23a22def748b9c6937c537", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBkNTI2NGEwM2MyZDg3M2Q5ZTIzYTIyZGVmNzQ4YjljNjkzN2M1Mzc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-11-03T21:55:48Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-11-03T21:55:48Z"}, "message": "Auto merge of #65780 - GuillaumeGomez:move-help-popup-generation-code, r=Mark-Simulacrum\n\nMove help popup generation code\n\nThe first commit is just a small cleanup.\n\nThe idea behind this PR is to reduce a bit more the generated HTML files by moving the duplicated code into one place instead.\n\nr? @kinnison", "tree": {"sha": "9dfe6a38637009b88ab6608bb3f6ab02dc9f67af", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9dfe6a38637009b88ab6608bb3f6ab02dc9f67af"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0d5264a03c2d873d9e23a22def748b9c6937c537", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0d5264a03c2d873d9e23a22def748b9c6937c537", "html_url": "https://github.com/rust-lang/rust/commit/0d5264a03c2d873d9e23a22def748b9c6937c537", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0d5264a03c2d873d9e23a22def748b9c6937c537/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b520af6fd515b186caed436d75162a42aa183d95", "url": "https://api.github.com/repos/rust-lang/rust/commits/b520af6fd515b186caed436d75162a42aa183d95", "html_url": "https://github.com/rust-lang/rust/commit/b520af6fd515b186caed436d75162a42aa183d95"}, {"sha": "91ef9600db47e4e91a57909077a60ebec1122d1b", "url": "https://api.github.com/repos/rust-lang/rust/commits/91ef9600db47e4e91a57909077a60ebec1122d1b", "html_url": "https://github.com/rust-lang/rust/commit/91ef9600db47e4e91a57909077a60ebec1122d1b"}], "stats": {"total": 106, "additions": 49, "deletions": 57}, "files": [{"sha": "697dee0216e3bfbcc1af550036f18dfb8c194e3a", "filename": "src/librustdoc/html/layout.rs", "status": "modified", "additions": 0, "deletions": 55, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/0d5264a03c2d873d9e23a22def748b9c6937c537/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0d5264a03c2d873d9e23a22def748b9c6937c537/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Flayout.rs?ref=0d5264a03c2d873d9e23a22def748b9c6937c537", "patch": "@@ -106,61 +106,6 @@ pub fn render<T: Print, S: Print>(\n     <section id=\\\"main\\\" class=\\\"content\\\">{content}</section>\\\n     <section id=\\\"search\\\" class=\\\"content hidden\\\"></section>\\\n     <section class=\\\"footer\\\"></section>\\\n-    <aside id=\\\"help\\\" class=\\\"hidden\\\">\\\n-        <div>\\\n-            <h1 class=\\\"hidden\\\">Help</h1>\\\n-            <div class=\\\"shortcuts\\\">\\\n-                <h2>Keyboard Shortcuts</h2>\\\n-                <dl>\\\n-                    <dt><kbd>?</kbd></dt>\\\n-                    <dd>Show this help dialog</dd>\\\n-                    <dt><kbd>S</kbd></dt>\\\n-                    <dd>Focus the search field</dd>\\\n-                    <dt><kbd>\u2191</kbd></dt>\\\n-                    <dd>Move up in search results</dd>\\\n-                    <dt><kbd>\u2193</kbd></dt>\\\n-                    <dd>Move down in search results</dd>\\\n-                    <dt><kbd>\u21b9</kbd></dt>\\\n-                    <dd>Switch tab</dd>\\\n-                    <dt><kbd>&#9166;</kbd></dt>\\\n-                    <dd>Go to active search result</dd>\\\n-                    <dt><kbd>+</kbd></dt>\\\n-                    <dd>Expand all sections</dd>\\\n-                    <dt><kbd>-</kbd></dt>\\\n-                    <dd>Collapse all sections</dd>\\\n-                </dl>\\\n-            </div>\\\n-            <div class=\\\"infos\\\">\\\n-                <h2>Search Tricks</h2>\\\n-                <p>\\\n-                    Prefix searches with a type followed by a colon (e.g., \\\n-                    <code>fn:</code>) to restrict the search to a given type.\\\n-                </p>\\\n-                <p>\\\n-                    Accepted types are: <code>fn</code>, <code>mod</code>, \\\n-                    <code>struct</code>, <code>enum</code>, \\\n-                    <code>trait</code>, <code>type</code>, <code>macro</code>, \\\n-                    and <code>const</code>.\\\n-                </p>\\\n-                <p>\\\n-                    Search functions by type signature (e.g., \\\n-                    <code>vec -> usize</code> or <code>* -> vec</code>)\\\n-                </p>\\\n-                <p>\\\n-                    Search multiple things at once by splitting your query with comma (e.g., \\\n-                    <code>str,u8</code> or <code>String,struct:Vec,test</code>)\\\n-                </p>\\\n-                <p>\\\n-                    You can look for items with an exact name by putting double quotes around \\\n-                    your request: <code>\\\"string\\\"</code>\\\n-                </p>\\\n-                <p>\\\n-                    Look for items inside another one by searching for a path: \\\n-                    <code>vec::Vec</code>\\\n-                </p>\\\n-            </div>\\\n-        </div>\\\n-    </aside>\\\n     {after_content}\\\n     <script>\\\n         window.rootPath = \\\"{root_path}\\\";\\"}, {"sha": "de19ca3ed333a1676498549e98e803f3c86654a7", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 49, "deletions": 2, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/0d5264a03c2d873d9e23a22def748b9c6937c537/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/0d5264a03c2d873d9e23a22def748b9c6937c537/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=0d5264a03c2d873d9e23a22def748b9c6937c537", "patch": "@@ -1222,7 +1222,7 @@ function getSearchElement() {\n                 }\n                 dst = dst[0];\n                 if (window.location.pathname === dst.pathname) {\n-                    addClass(document.getElementById(\"search\"), \"hidden\");\n+                    addClass(getSearchElement(), \"hidden\");\n                     removeClass(main, \"hidden\");\n                     document.location.href = dst.href;\n                 }\n@@ -2458,7 +2458,7 @@ function getSearchElement() {\n     function putBackSearch(search_input) {\n         if (search_input.value !== \"\") {\n             addClass(main, \"hidden\");\n-            removeClass(document.getElementById(\"search\"), \"hidden\");\n+            removeClass(getSearchElement(), \"hidden\");\n             if (browserSupportsHistoryApi()) {\n                 history.replaceState(search_input.value,\n                                      \"\",\n@@ -2557,6 +2557,53 @@ function getSearchElement() {\n     }\n \n     window.addSearchOptions = addSearchOptions;\n+\n+    function buildHelperPopup() {\n+        var popup = document.createElement(\"aside\");\n+        addClass(popup, \"hidden\");\n+        popup.id = \"help\";\n+\n+        var container = document.createElement(\"div\");\n+        var shortcuts = [\n+            [\"?\", \"Show this help dialog\"],\n+            [\"S\", \"Focus the search field\"],\n+            [\"\u2191\", \"Move up in search results\"],\n+            [\"\u2193\", \"Move down in search results\"],\n+            [\"\u21b9\", \"Switch tab\"],\n+            [\"&#9166;\", \"Go to active search result\"],\n+            [\"+\", \"Expand all sections\"],\n+            [\"-\", \"Collapse all sections\"],\n+        ].map(x => \"<dt><kbd>\" + x[0] + \"</kbd></dt><dd>\" + x[1] + \"</dd>\").join(\"\");\n+        var div_shortcuts = document.createElement(\"div\");\n+        addClass(div_shortcuts, \"shortcuts\");\n+        div_shortcuts.innerHTML = \"<h2>Keyboard Shortcuts</h2><dl>\" + shortcuts + \"</dl></div>\";\n+\n+        var infos = [\n+            \"Prefix searches with a type followed by a colon (e.g., <code>fn:</code>) to \\\n+             restrict the search to a given type.\",\n+            \"Accepted types are: <code>fn</code>, <code>mod</code>, <code>struct</code>, \\\n+             <code>enum</code>, <code>trait</code>, <code>type</code>, <code>macro</code>, \\\n+             and <code>const</code>.\",\n+            \"Search functions by type signature (e.g., <code>vec -> usize</code> or \\\n+             <code>* -> vec</code>)\",\n+            \"Search multiple things at once by splitting your query with comma (e.g., \\\n+             <code>str,u8</code> or <code>String,struct:Vec,test</code>)\",\n+            \"You can look for items with an exact name by putting double quotes around \\\n+             your request: <code>\\\"string\\\"</code>\",\n+            \"Look for items inside another one by searching for a path: <code>vec::Vec</code>\",\n+        ].map(x => \"<p>\" + x + \"</p>\").join(\"\");\n+        var div_infos = document.createElement(\"div\");\n+        addClass(div_infos, \"infos\");\n+        div_infos.innerHTML = \"<h2>Search Tricks</h2>\" + infos;\n+\n+        container.appendChild(div_shortcuts);\n+        container.appendChild(div_infos);\n+\n+        popup.appendChild(container);\n+        insertAfter(popup, getSearchElement());\n+    }\n+\n+    buildHelperPopup();\n }());\n \n // Sets the focus on the search bar at the top of the page"}]}