{"sha": "9f671698e6ac2666293298eb5234237a8033683f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmNjcxNjk4ZTZhYzI2NjYyOTMyOThlYjUyMzQyMzdhODAzMzY4M2Y=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-05-19T15:13:30Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-05-19T15:13:30Z"}, "message": "auto merge of #6106 : thestinger/rust/iter, r=bstrie\n\nI don't have a strong opinion on the function vs. method, but there's no point in having both. I'd like to make a `repeat` adaptor like Python/Haskell for turning a value into an infinite stream of the value, so this has to at least be renamed.", "tree": {"sha": "d1e295337ede3a4b68fb26e2392e1c4c56c0cda8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d1e295337ede3a4b68fb26e2392e1c4c56c0cda8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9f671698e6ac2666293298eb5234237a8033683f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9f671698e6ac2666293298eb5234237a8033683f", "html_url": "https://github.com/rust-lang/rust/commit/9f671698e6ac2666293298eb5234237a8033683f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9f671698e6ac2666293298eb5234237a8033683f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5cbdc53f89a95f410140c10c3ef80c2685772186", "url": "https://api.github.com/repos/rust-lang/rust/commits/5cbdc53f89a95f410140c10c3ef80c2685772186", "html_url": "https://github.com/rust-lang/rust/commit/5cbdc53f89a95f410140c10c3ef80c2685772186"}, {"sha": "d953a5ce43ba2adecb50780c7debd3fea6248996", "url": "https://api.github.com/repos/rust-lang/rust/commits/d953a5ce43ba2adecb50780c7debd3fea6248996", "html_url": "https://github.com/rust-lang/rust/commit/d953a5ce43ba2adecb50780c7debd3fea6248996"}], "stats": {"total": 82, "additions": 28, "deletions": 54}, "files": [{"sha": "cb7caeeb8109f1c290498a165439bd1dcb32dd22", "filename": "doc/tutorial.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9f671698e6ac2666293298eb5234237a8033683f/doc%2Ftutorial.md", "raw_url": "https://github.com/rust-lang/rust/raw/9f671698e6ac2666293298eb5234237a8033683f/doc%2Ftutorial.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/doc%2Ftutorial.md?ref=9f671698e6ac2666293298eb5234237a8033683f", "patch": "@@ -1977,7 +1977,7 @@ struct TimeBomb {\n \n impl Drop for TimeBomb {\n     fn finalize(&self) {\n-        for old_iter::repeat(self.explosivity) {\n+        for self.explosivity.times {\n             println(\"blam!\");\n         }\n     }"}, {"sha": "12b7ce1eb6ebb4071d18fe8bb0eea3a996436d0e", "filename": "src/libcore/old_iter.rs", "status": "modified", "additions": 0, "deletions": 20, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/9f671698e6ac2666293298eb5234237a8033683f/src%2Flibcore%2Fold_iter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f671698e6ac2666293298eb5234237a8033683f/src%2Flibcore%2Fold_iter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fold_iter.rs?ref=9f671698e6ac2666293298eb5234237a8033683f", "patch": "@@ -238,26 +238,6 @@ pub fn position<A,IA:BaseIter<A>>(this: &IA, f: &fn(&A) -> bool)\n // iter interface, such as would provide \"reach\" in addition to \"each\". As is,\n // it would have to be implemented with foldr, which is too inefficient.\n \n-#[inline(always)]\n-#[cfg(stage0)]\n-pub fn repeat(times: uint, blk: &fn() -> bool) {\n-    let mut i = 0;\n-    while i < times {\n-        if !blk() { break }\n-        i += 1;\n-    }\n-}\n-#[inline(always)]\n-#[cfg(not(stage0))]\n-pub fn repeat(times: uint, blk: &fn() -> bool) -> bool {\n-    let mut i = 0;\n-    while i < times {\n-        if !blk() { return false; }\n-        i += 1;\n-    }\n-    return true;\n-}\n-\n #[inline(always)]\n pub fn min<A:Copy + Ord,IA:BaseIter<A>>(this: &IA) -> A {\n     match do foldl::<A,Option<A>,IA>(this, None) |a, b| {"}, {"sha": "f06b5abf04f01c7529f3e642b425640d578838bb", "filename": "src/libcore/task/mod.rs", "status": "modified", "additions": 9, "deletions": 10, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/9f671698e6ac2666293298eb5234237a8033683f/src%2Flibcore%2Ftask%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f671698e6ac2666293298eb5234237a8033683f/src%2Flibcore%2Ftask%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftask%2Fmod.rs?ref=9f671698e6ac2666293298eb5234237a8033683f", "patch": "@@ -635,7 +635,7 @@ fn test_spawn_unlinked_unsup_no_fail_down() { // grandchild sends on a port\n         let ch = ch.clone();\n         do spawn_unlinked {\n             // Give middle task a chance to fail-but-not-kill-us.\n-            for old_iter::repeat(16) { task::yield(); }\n+            for 16.times { task::yield(); }\n             ch.send(()); // If killed first, grandparent hangs.\n         }\n         fail!(); // Shouldn't kill either (grand)parent or (grand)child.\n@@ -650,7 +650,7 @@ fn test_spawn_unlinked_unsup_no_fail_up() { // child unlinked fails\n fn test_spawn_unlinked_sup_no_fail_up() { // child unlinked fails\n     do spawn_supervised { fail!(); }\n     // Give child a chance to fail-but-not-kill-us.\n-    for old_iter::repeat(16) { task::yield(); }\n+    for 16.times { task::yield(); }\n }\n #[test] #[should_fail] #[ignore(cfg(windows))]\n fn test_spawn_unlinked_sup_fail_down() {\n@@ -725,7 +725,7 @@ fn test_spawn_failure_propagate_grandchild() {\n             loop { task::yield(); }\n         }\n     }\n-    for old_iter::repeat(16) { task::yield(); }\n+    for 16.times { task::yield(); }\n     fail!();\n }\n \n@@ -737,7 +737,7 @@ fn test_spawn_failure_propagate_secondborn() {\n             loop { task::yield(); }\n         }\n     }\n-    for old_iter::repeat(16) { task::yield(); }\n+    for 16.times { task::yield(); }\n     fail!();\n }\n \n@@ -749,7 +749,7 @@ fn test_spawn_failure_propagate_nephew_or_niece() {\n             loop { task::yield(); }\n         }\n     }\n-    for old_iter::repeat(16) { task::yield(); }\n+    for 16.times { task::yield(); }\n     fail!();\n }\n \n@@ -761,7 +761,7 @@ fn test_spawn_linked_sup_propagate_sibling() {\n             loop { task::yield(); }\n         }\n     }\n-    for old_iter::repeat(16) { task::yield(); }\n+    for 16.times { task::yield(); }\n     fail!();\n }\n \n@@ -920,8 +920,7 @@ fn test_spawn_sched_blocking() {\n \n         // Testing that a task in one scheduler can block in foreign code\n         // without affecting other schedulers\n-        for old_iter::repeat(20u) {\n-\n+        for 20u.times {\n             let (start_po, start_ch) = stream();\n             let (fin_po, fin_ch) = stream();\n \n@@ -1040,7 +1039,7 @@ fn test_unkillable() {\n \n     // We want to do this after failing\n     do spawn_unlinked {\n-        for old_iter::repeat(10) { yield() }\n+        for 10.times { yield() }\n         ch.send(());\n     }\n \n@@ -1075,7 +1074,7 @@ fn test_unkillable_nested() {\n \n     // We want to do this after failing\n     do spawn_unlinked || {\n-        for old_iter::repeat(10) { yield() }\n+        for 10.times { yield() }\n         ch.send(());\n     }\n "}, {"sha": "1eac09ea2056f85cfc9b0c8dfd816354a76ae97f", "filename": "src/librustdoc/markdown_pass.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9f671698e6ac2666293298eb5234237a8033683f/src%2Flibrustdoc%2Fmarkdown_pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f671698e6ac2666293298eb5234237a8033683f/src%2Flibrustdoc%2Fmarkdown_pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fmarkdown_pass.rs?ref=9f671698e6ac2666293298eb5234237a8033683f", "patch": "@@ -629,7 +629,7 @@ mod test {\n         let doc = (page_pass::mk_pass(config::DocPerMod).f)(srv, doc);\n         write_markdown(doc, writer_factory);\n         // We expect two pages to have been written\n-        for old_iter::repeat(2) {\n+        for 2.times {\n             po.recv();\n         }\n     }\n@@ -641,7 +641,7 @@ mod test {\n             ~\"#[link(name = \\\"core\\\")]; mod a { }\");\n         let doc = (page_pass::mk_pass(config::DocPerMod).f)(srv, doc);\n         write_markdown(doc, writer_factory);\n-        for old_iter::repeat(2) {\n+        for 2.times {\n             let (page, markdown) = po.recv();\n             match page {\n                 doc::CratePage(_) => {"}, {"sha": "a820862ef4c7a50e8ae4b5ec3710bb917b403957", "filename": "src/libstd/base64.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9f671698e6ac2666293298eb5234237a8033683f/src%2Flibstd%2Fbase64.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f671698e6ac2666293298eb5234237a8033683f/src%2Flibstd%2Fbase64.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fbase64.rs?ref=9f671698e6ac2666293298eb5234237a8033683f", "patch": "@@ -10,10 +10,6 @@\n \n //! Base64 binary-to-text encoding\n \n-use core::old_iter;\n-use core::str;\n-use core::vec;\n-\n pub trait ToBase64 {\n     fn to_base64(&self) -> ~str;\n }\n@@ -152,7 +148,7 @@ impl FromBase64 for ~[u8] {\n         while i < len {\n             let mut n = 0u;\n \n-            for old_iter::repeat(4u) {\n+            for 4u.times {\n                 let ch = self[i] as char;\n                 n <<= 6u;\n "}, {"sha": "092c718f1ced3c60dbd0585bebf91fe521b59f2d", "filename": "src/libstd/timer.rs", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/9f671698e6ac2666293298eb5234237a8033683f/src%2Flibstd%2Ftimer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f671698e6ac2666293298eb5234237a8033683f/src%2Flibstd%2Ftimer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Ftimer.rs?ref=9f671698e6ac2666293298eb5234237a8033683f", "patch": "@@ -188,7 +188,7 @@ mod test {\n     #[test]\n     fn test_gl_timer_sleep_stress1() {\n         let hl_loop = &uv::global_loop::get();\n-        for old_iter::repeat(50u) {\n+        for 50u.times {\n             sleep(hl_loop, 1u);\n         }\n     }\n@@ -208,8 +208,7 @@ mod test {\n \n         };\n \n-        for old_iter::repeat(repeat) {\n-\n+        for repeat.times {\n             let ch = ch.clone();\n             for spec.each |spec| {\n                 let (times, maxms) = *spec;\n@@ -218,15 +217,15 @@ mod test {\n                 do task::spawn {\n                     use core::rand::*;\n                     let mut rng = rng();\n-                    for old_iter::repeat(times) {\n+                    for times.times {\n                         sleep(&hl_loop_clone, rng.next() as uint % maxms);\n                     }\n                     ch.send(());\n                 }\n             }\n         }\n \n-        for old_iter::repeat(repeat * spec.len()) {\n+        for (repeat * spec.len()).times {\n             po.recv()\n         }\n     }\n@@ -244,7 +243,7 @@ mod test {\n         let mut failures = 0;\n         let hl_loop = uv::global_loop::get();\n \n-        for old_iter::repeat(times as uint) {\n+        for (times as uint).times {\n             task::yield();\n \n             let expected = rand::rng().gen_str(16u);\n@@ -273,7 +272,7 @@ mod test {\n         let mut failures = 0;\n         let hl_loop = uv::global_loop::get();\n \n-        for old_iter::repeat(times as uint) {\n+        for (times as uint).times {\n             let mut rng = rand::rng();\n             let expected = Cell(rng.gen_str(16u));\n             let (test_po, test_ch) = stream::<~str>();"}, {"sha": "d1471ba1e7705809cd502541f12c5bb2cf8fbe96", "filename": "src/libstd/uv_global_loop.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9f671698e6ac2666293298eb5234237a8033683f/src%2Flibstd%2Fuv_global_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f671698e6ac2666293298eb5234237a8033683f/src%2Flibstd%2Fuv_global_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fuv_global_loop.rs?ref=9f671698e6ac2666293298eb5234237a8033683f", "patch": "@@ -215,15 +215,15 @@ mod test {\n         let (exit_po, exit_ch) = stream::<()>();\n         let exit_ch = SharedChan::new(exit_ch);\n         let cycles = 5000u;\n-        for old_iter::repeat(cycles) {\n+        for cycles.times {\n             let exit_ch_clone = exit_ch.clone();\n             task::spawn_sched(task::ManualThreads(1u), || {\n                 let hl_loop = &get_gl();\n                 impl_uv_hl_simple_timer(hl_loop);\n                 exit_ch_clone.send(());\n             });\n         };\n-        for old_iter::repeat(cycles) {\n+        for cycles.times {\n             exit_po.recv();\n         };\n         debug!(~\"test_stress_gl_uv_global_loop_high_level_global_timer\"+"}, {"sha": "371eb338de30305053c55fa17d7fca49eada04c6", "filename": "src/libstd/uv_iotask.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9f671698e6ac2666293298eb5234237a8033683f/src%2Flibstd%2Fuv_iotask.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f671698e6ac2666293298eb5234237a8033683f/src%2Flibstd%2Fuv_iotask.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fuv_iotask.rs?ref=9f671698e6ac2666293298eb5234237a8033683f", "patch": "@@ -284,7 +284,7 @@ fn test_uv_iotask_async() {\n     // impl_uv_hl_async() runs have been called, at least.\n     let (work_exit_po, work_exit_ch) = stream::<()>();\n     let work_exit_ch = SharedChan::new(work_exit_ch);\n-    for old_iter::repeat(7u) {\n+    for 7u.times {\n         let iotask_clone = iotask.clone();\n         let work_exit_ch_clone = work_exit_ch.clone();\n         do task::spawn_sched(task::ManualThreads(1u)) {\n@@ -294,7 +294,7 @@ fn test_uv_iotask_async() {\n             work_exit_ch_clone.send(());\n         };\n     };\n-    for old_iter::repeat(7u) {\n+    for 7u.times {\n         debug!(\"waiting\");\n         work_exit_po.recv();\n     };"}, {"sha": "4a07193d8cd1d63e44a3b1b3d6f81bc47f6d1968", "filename": "src/test/bench/task-perf-alloc-unwind.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9f671698e6ac2666293298eb5234237a8033683f/src%2Ftest%2Fbench%2Ftask-perf-alloc-unwind.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f671698e6ac2666293298eb5234237a8033683f/src%2Ftest%2Fbench%2Ftask-perf-alloc-unwind.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fbench%2Ftask-perf-alloc-unwind.rs?ref=9f671698e6ac2666293298eb5234237a8033683f", "patch": "@@ -30,7 +30,7 @@ fn main() {\n }\n \n fn run(repeat: int, depth: int) {\n-    for old_iter::repeat(repeat as uint) {\n+    for (repeat as uint).times {\n         debug!(\"starting %.4f\", precise_time_s());\n         do task::try {\n             recurse_or_fail(depth, None)"}, {"sha": "d7ec9f088653f0c3c62890eff331b14dd6bdc4fa", "filename": "src/test/run-fail/extern-fail.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9f671698e6ac2666293298eb5234237a8033683f/src%2Ftest%2Frun-fail%2Fextern-fail.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f671698e6ac2666293298eb5234237a8033683f/src%2Ftest%2Frun-fail%2Fextern-fail.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-fail%2Fextern-fail.rs?ref=9f671698e6ac2666293298eb5234237a8033683f", "patch": "@@ -37,7 +37,7 @@ fn count(n: uint) -> uint {\n }\n \n fn main() {\n-    for old_iter::repeat(10u) {\n+    for 10u.times {\n         do task::spawn {\n             let result = count(5u);\n             debug!(\"result = %?\", result);"}, {"sha": "2d47916d05040f5e90b71e16a2566319567fd78f", "filename": "src/test/run-pass/bitv-perf-test.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9f671698e6ac2666293298eb5234237a8033683f/src%2Ftest%2Frun-pass%2Fbitv-perf-test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f671698e6ac2666293298eb5234237a8033683f/src%2Ftest%2Frun-pass%2Fbitv-perf-test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fbitv-perf-test.rs?ref=9f671698e6ac2666293298eb5234237a8033683f", "patch": "@@ -21,5 +21,5 @@ fn bitv_test() -> bool {\n }\n \n pub fn main() {\n-    do old_iter::repeat(10000) || {bitv_test()};\n+    do 10000.times || {bitv_test()};\n }"}, {"sha": "1a1e0ca7b6d9bc42e123d526928a9c4862b57dcb", "filename": "src/test/run-pass/extern-stress.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9f671698e6ac2666293298eb5234237a8033683f/src%2Ftest%2Frun-pass%2Fextern-stress.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f671698e6ac2666293298eb5234237a8033683f/src%2Ftest%2Frun-pass%2Fextern-stress.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fextern-stress.rs?ref=9f671698e6ac2666293298eb5234237a8033683f", "patch": "@@ -34,7 +34,7 @@ fn count(n: uint) -> uint {\n }\n \n pub fn main() {\n-    for old_iter::repeat(100u) {\n+    for 100u.times {\n         do task::spawn {\n             assert_eq!(count(5u), 16u);\n         };"}, {"sha": "067968ddb9f9e07d32b09f7441c73c9aec9cc66b", "filename": "src/test/run-pass/extern-yield.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9f671698e6ac2666293298eb5234237a8033683f/src%2Ftest%2Frun-pass%2Fextern-yield.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f671698e6ac2666293298eb5234237a8033683f/src%2Ftest%2Frun-pass%2Fextern-yield.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fextern-yield.rs?ref=9f671698e6ac2666293298eb5234237a8033683f", "patch": "@@ -31,7 +31,7 @@ fn count(n: uint) -> uint {\n }\n \n pub fn main() {\n-    for old_iter::repeat(10u) {\n+    for 10u.times {\n         do task::spawn {\n             let result = count(5u);\n             debug!(\"result = %?\", result);"}]}