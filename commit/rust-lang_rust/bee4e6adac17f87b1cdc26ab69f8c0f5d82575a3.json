{"sha": "bee4e6adac17f87b1cdc26ab69f8c0f5d82575a3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJlZTRlNmFkYWMxN2Y4N2IxY2RjMjZhYjY5ZjhjMGY1ZDgyNTc1YTM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-05-29T13:11:39Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-05-29T13:11:39Z"}, "message": "auto merge of #14487 : arielb1/rust/fix-13933, r=alexcrichton\n\nFix issue #13933 in a few files. A more complete fix would require core::raw::MutSlice.", "tree": {"sha": "9b0ef364d66b855094a3a390f7d38095c042f9a9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9b0ef364d66b855094a3a390f7d38095c042f9a9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bee4e6adac17f87b1cdc26ab69f8c0f5d82575a3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bee4e6adac17f87b1cdc26ab69f8c0f5d82575a3", "html_url": "https://github.com/rust-lang/rust/commit/bee4e6adac17f87b1cdc26ab69f8c0f5d82575a3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bee4e6adac17f87b1cdc26ab69f8c0f5d82575a3/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ff2bf58e9e0c1e7b154b88fc7ba8c52584e9f768", "url": "https://api.github.com/repos/rust-lang/rust/commits/ff2bf58e9e0c1e7b154b88fc7ba8c52584e9f768", "html_url": "https://github.com/rust-lang/rust/commit/ff2bf58e9e0c1e7b154b88fc7ba8c52584e9f768"}, {"sha": "2e8bc9924c096cb8f889d3f46ecce7ebe622b964", "url": "https://api.github.com/repos/rust-lang/rust/commits/2e8bc9924c096cb8f889d3f46ecce7ebe622b964", "html_url": "https://github.com/rust-lang/rust/commit/2e8bc9924c096cb8f889d3f46ecce7ebe622b964"}], "stats": {"total": 51, "additions": 28, "deletions": 23}, "files": [{"sha": "546e4e5269979c27e773823d76beb39fd064a0ff", "filename": "src/liballoc/arc.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/bee4e6adac17f87b1cdc26ab69f8c0f5d82575a3/src%2Fliballoc%2Farc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bee4e6adac17f87b1cdc26ab69f8c0f5d82575a3/src%2Fliballoc%2Farc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Farc.rs?ref=bee4e6adac17f87b1cdc26ab69f8c0f5d82575a3", "patch": "@@ -160,7 +160,8 @@ impl<T: Send + Share + Clone> Arc<T> {\n         // reference count is guaranteed to be 1 at this point, and we required\n         // the Arc itself to be `mut`, so we're returning the only possible\n         // reference to the inner data.\n-        unsafe { mem::transmute::<&_, &mut _>(self.deref()) }\n+        let inner = unsafe { &mut *self._ptr };\n+        &mut inner.data\n     }\n }\n "}, {"sha": "4f1f3b3ca26f726374cbc7e3fcaaf57085da0389", "filename": "src/libnative/io/file_win32.rs", "status": "modified", "additions": 23, "deletions": 17, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/bee4e6adac17f87b1cdc26ab69f8c0f5d82575a3/src%2Flibnative%2Fio%2Ffile_win32.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bee4e6adac17f87b1cdc26ab69f8c0f5d82575a3/src%2Flibnative%2Fio%2Ffile_win32.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibnative%2Fio%2Ffile_win32.rs?ref=bee4e6adac17f87b1cdc26ab69f8c0f5d82575a3", "patch": "@@ -90,6 +90,25 @@ impl FileDesc {\n     pub fn handle(&self) -> libc::HANDLE {\n         unsafe { libc::get_osfhandle(self.fd()) as libc::HANDLE }\n     }\n+\n+    // A version of seek that takes &self so that tell can call it\n+    //   - the private seek should of course take &mut self.\n+    fn seek_common(&self, pos: i64, style: io::SeekStyle) -> Result<u64, IoError> {\n+        let whence = match style {\n+            io::SeekSet => libc::FILE_BEGIN,\n+            io::SeekEnd => libc::FILE_END,\n+            io::SeekCur => libc::FILE_CURRENT,\n+        };\n+        unsafe {\n+            let mut newpos = 0;\n+            match libc::SetFilePointerEx(self.handle(), pos, &mut newpos,\n+                                         whence) {\n+                0 => Err(super::last_error()),\n+                _ => Ok(newpos as u64),\n+            }\n+        }\n+    }\n+\n }\n \n impl io::Reader for FileDesc {\n@@ -151,26 +170,13 @@ impl rtio::RtioFileStream for FileDesc {\n         }\n         Ok(())\n     }\n+\n     fn seek(&mut self, pos: i64, style: io::SeekStyle) -> Result<u64, IoError> {\n-        let whence = match style {\n-            io::SeekSet => libc::FILE_BEGIN,\n-            io::SeekEnd => libc::FILE_END,\n-            io::SeekCur => libc::FILE_CURRENT,\n-        };\n-        unsafe {\n-            let mut newpos = 0;\n-            match libc::SetFilePointerEx(self.handle(), pos, &mut newpos,\n-                                         whence) {\n-                0 => Err(super::last_error()),\n-                _ => Ok(newpos as u64),\n-            }\n-        }\n+        self.seek_common(pos, style)\n     }\n+\n     fn tell(&self) -> Result<u64, IoError> {\n-        // This transmute is fine because our seek implementation doesn't\n-        // actually use the mutable self at all.\n-        // FIXME #13933: Remove/justify all `&T` to `&mut T` transmutes\n-        unsafe { mem::transmute::<&_, &mut FileDesc>(self).seek(0, io::SeekCur) }\n+        self.seek_common(0, io::SeekCur)\n     }\n \n     fn fsync(&mut self) -> Result<(), IoError> {"}, {"sha": "7143f420b08a1b8c5bce0d685f0b1598da356f1c", "filename": "src/librustuv/file.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/bee4e6adac17f87b1cdc26ab69f8c0f5d82575a3/src%2Flibrustuv%2Ffile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bee4e6adac17f87b1cdc26ab69f8c0f5d82575a3/src%2Flibrustuv%2Ffile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustuv%2Ffile.rs?ref=bee4e6adac17f87b1cdc26ab69f8c0f5d82575a3", "patch": "@@ -377,7 +377,7 @@ impl FileWatcher {\n         let r = FsRequest::write(&self.loop_, self.fd, buf, offset);\n         r.map_err(uv_error_to_io_error)\n     }\n-    fn seek_common(&mut self, pos: i64, whence: c_int) ->\n+    fn seek_common(&self, pos: i64, whence: c_int) ->\n         Result<u64, IoError>{\n         unsafe {\n             match libc::lseek(self.fd, pos as libc::off_t, whence) {\n@@ -446,10 +446,8 @@ impl rtio::RtioFileStream for FileWatcher {\n     }\n     fn tell(&self) -> Result<u64, IoError> {\n         use libc::SEEK_CUR;\n-        // this is temporary\n-        // FIXME #13933: Remove/justify all `&T` to `&mut T` transmutes\n-        let self_ = unsafe { mem::transmute::<&_, &mut FileWatcher>(self) };\n-        self_.seek_common(0, SEEK_CUR)\n+\n+        self.seek_common(0, SEEK_CUR)\n     }\n     fn fsync(&mut self) -> Result<(), IoError> {\n         let _m = self.fire_homing_missile();"}]}