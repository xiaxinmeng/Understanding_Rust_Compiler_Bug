{"sha": "bb08ffbaf436e291b4be5cf7a471dda9744bfade", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJiMDhmZmJhZjQzNmUyOTFiNGJlNWNmN2E0NzFkZGE5NzQ0YmZhZGU=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-09-04T22:48:09Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-09-07T17:32:58Z"}, "message": "Refactor task failure a bit\n\nIssue #236", "tree": {"sha": "ef998da66d33aefec9c39c6a5f146ab216c8555e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ef998da66d33aefec9c39c6a5f146ab216c8555e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bb08ffbaf436e291b4be5cf7a471dda9744bfade", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bb08ffbaf436e291b4be5cf7a471dda9744bfade", "html_url": "https://github.com/rust-lang/rust/commit/bb08ffbaf436e291b4be5cf7a471dda9744bfade", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bb08ffbaf436e291b4be5cf7a471dda9744bfade/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1339d0543407d653842503704642fb34f8e6a82d", "url": "https://api.github.com/repos/rust-lang/rust/commits/1339d0543407d653842503704642fb34f8e6a82d", "html_url": "https://github.com/rust-lang/rust/commit/1339d0543407d653842503704642fb34f8e6a82d"}], "stats": {"total": 6, "additions": 3, "deletions": 3}, "files": [{"sha": "993a6b25cfbde3c469fb701b745d960578f9beed", "filename": "src/rt/rust_task.cpp", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/bb08ffbaf436e291b4be5cf7a471dda9744bfade/src%2Frt%2Frust_task.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/bb08ffbaf436e291b4be5cf7a471dda9744bfade/src%2Frt%2Frust_task.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_task.cpp?ref=bb08ffbaf436e291b4be5cf7a471dda9744bfade", "patch": "@@ -244,6 +244,7 @@ rust_task::fail() {\n     // See note in ::kill() regarding who should call this.\n     DLOG(sched, task, \"task %s @0x%\" PRIxPTR \" failing\", name, this);\n     backtrace();\n+    die();\n     // Unblock the task so it can unwind.\n     unblock();\n     if (supervisor) {\n@@ -257,6 +258,8 @@ rust_task::fail() {\n     if (NULL == supervisor && propagate_failure)\n         sched->fail();\n     failed = true;\n+    notify_tasks_waiting_to_join();\n+    yield(4);\n }\n \n void"}, {"sha": "cf8537ad6d0c49c829d6b4f3c78112c0910bb9c8", "filename": "src/rt/rust_upcall.cpp", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/bb08ffbaf436e291b4be5cf7a471dda9744bfade/src%2Frt%2Frust_upcall.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/bb08ffbaf436e291b4be5cf7a471dda9744bfade/src%2Frt%2Frust_upcall.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_upcall.cpp?ref=bb08ffbaf436e291b4be5cf7a471dda9744bfade", "patch": "@@ -92,10 +92,7 @@ upcall_fail(rust_task *task,\n             size_t line) {\n     LOG_UPCALL_ENTRY(task);\n     LOG_ERR(task, upcall, \"upcall fail '%s', %s:%\" PRIdPTR, expr, file, line);\n-    task->die();\n     task->fail();\n-    task->notify_tasks_waiting_to_join();\n-    task->yield(4);\n }\n \n /**"}]}