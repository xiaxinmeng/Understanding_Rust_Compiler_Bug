{"sha": "cbc9031fbc235aae7e4b8776ad7801141600dd86", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNiYzkwMzFmYmMyMzVhYWU3ZTRiODc3NmFkNzgwMTE0MTYwMGRkODY=", "commit": {"author": {"name": "Jessica Hamilton", "email": "jessica.l.hamilton@gmail.com", "date": "2017-09-06T17:07:05Z"}, "committer": {"name": "Jessica Hamilton", "email": "jessica.l.hamilton@gmail.com", "date": "2017-09-07T01:05:00Z"}, "message": "ci: introduce haiku x86_64 builder", "tree": {"sha": "ea22ec74753905325b70e4a6272a1fa07fbab991", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ea22ec74753905325b70e4a6272a1fa07fbab991"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cbc9031fbc235aae7e4b8776ad7801141600dd86", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cbc9031fbc235aae7e4b8776ad7801141600dd86", "html_url": "https://github.com/rust-lang/rust/commit/cbc9031fbc235aae7e4b8776ad7801141600dd86", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cbc9031fbc235aae7e4b8776ad7801141600dd86/comments", "author": {"login": "jessicah", "id": 274082, "node_id": "MDQ6VXNlcjI3NDA4Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/274082?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jessicah", "html_url": "https://github.com/jessicah", "followers_url": "https://api.github.com/users/jessicah/followers", "following_url": "https://api.github.com/users/jessicah/following{/other_user}", "gists_url": "https://api.github.com/users/jessicah/gists{/gist_id}", "starred_url": "https://api.github.com/users/jessicah/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jessicah/subscriptions", "organizations_url": "https://api.github.com/users/jessicah/orgs", "repos_url": "https://api.github.com/users/jessicah/repos", "events_url": "https://api.github.com/users/jessicah/events{/privacy}", "received_events_url": "https://api.github.com/users/jessicah/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jessicah", "id": 274082, "node_id": "MDQ6VXNlcjI3NDA4Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/274082?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jessicah", "html_url": "https://github.com/jessicah", "followers_url": "https://api.github.com/users/jessicah/followers", "following_url": "https://api.github.com/users/jessicah/following{/other_user}", "gists_url": "https://api.github.com/users/jessicah/gists{/gist_id}", "starred_url": "https://api.github.com/users/jessicah/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jessicah/subscriptions", "organizations_url": "https://api.github.com/users/jessicah/orgs", "repos_url": "https://api.github.com/users/jessicah/repos", "events_url": "https://api.github.com/users/jessicah/events{/privacy}", "received_events_url": "https://api.github.com/users/jessicah/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a20953906056f85f71896795e762ac242e1891aa", "url": "https://api.github.com/repos/rust-lang/rust/commits/a20953906056f85f71896795e762ac242e1891aa", "html_url": "https://github.com/rust-lang/rust/commit/a20953906056f85f71896795e762ac242e1891aa"}], "stats": {"total": 171, "additions": 171, "deletions": 0}, "files": [{"sha": "98f2776596c4759b86cfc412ff6b0d4a522f7c2b", "filename": "src/ci/docker/dist-x86_64-haiku/Dockerfile", "status": "added", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/cbc9031fbc235aae7e4b8776ad7801141600dd86/src%2Fci%2Fdocker%2Fdist-x86_64-haiku%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/cbc9031fbc235aae7e4b8776ad7801141600dd86/src%2Fci%2Fdocker%2Fdist-x86_64-haiku%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-x86_64-haiku%2FDockerfile?ref=cbc9031fbc235aae7e4b8776ad7801141600dd86", "patch": "@@ -0,0 +1,49 @@\n+FROM ubuntu:16.04\n+\n+RUN apt-get update && apt-get install -y --no-install-recommends \\\n+  autoconf \\\n+  automake \\\n+  bison \\\n+  bzip2 \\\n+  ca-certificates \\\n+  cmake \\\n+  curl \\\n+  file \\\n+  flex \\\n+  g++ \\\n+  gawk \\\n+  git \\\n+  libcurl4-openssl-dev \\\n+  libssl-dev \\\n+  make \\\n+  nasm \\\n+  pkg-config \\\n+  python2.7 \\\n+  sudo \\\n+  texinfo \\\n+  wget \\\n+  xz-utils \\\n+  zlib1g-dev\n+\n+COPY dist-x86_64-haiku/llvm-config /bin/llvm-config-haiku\n+\n+ENV ARCH=x86_64\n+\n+WORKDIR /tmp\n+COPY dist-x86_64-haiku/build-toolchain.sh /tmp/\n+RUN /tmp/build-toolchain.sh $ARCH\n+\n+COPY dist-x86_64-haiku/fetch-packages.sh /tmp/\n+RUN /tmp/fetch-packages.sh\n+\n+COPY scripts/sccache.sh /scripts/\n+RUN sh /scripts/sccache.sh\n+\n+ENV HOST=x86_64-unknown-haiku\n+ENV TARGET=target.$HOST\n+\n+ENV RUST_CONFIGURE_ARGS --host=$HOST --target=$HOST --disable-jemalloc \\\n+  --set=$TARGET.cc=x86_64-unknown-haiku-gcc \\\n+  --set=$TARGET.cxx=x86_64-unknown-haiku-g++ \\\n+  --set=$TARGET.llvm-config=/bin/llvm-config-haiku\n+ENV SCRIPT python2.7 ../x.py dist"}, {"sha": "0776d448984eed7bb3b3e6a7da18b97976be0de8", "filename": "src/ci/docker/dist-x86_64-haiku/build-toolchain.sh", "status": "added", "additions": 74, "deletions": 0, "changes": 74, "blob_url": "https://github.com/rust-lang/rust/blob/cbc9031fbc235aae7e4b8776ad7801141600dd86/src%2Fci%2Fdocker%2Fdist-x86_64-haiku%2Fbuild-toolchain.sh", "raw_url": "https://github.com/rust-lang/rust/raw/cbc9031fbc235aae7e4b8776ad7801141600dd86/src%2Fci%2Fdocker%2Fdist-x86_64-haiku%2Fbuild-toolchain.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-x86_64-haiku%2Fbuild-toolchain.sh?ref=cbc9031fbc235aae7e4b8776ad7801141600dd86", "patch": "@@ -0,0 +1,74 @@\n+#!/bin/bash\n+# Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+# file at the top-level directory of this distribution and at\n+# http://rust-lang.org/COPYRIGHT.\n+#\n+# Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+# http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+# <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+# option. This file may not be copied, modified, or distributed\n+# except according to those terms.\n+\n+set -ex\n+\n+ARCH=$1\n+\n+TOP=$(pwd)\n+\n+BUILDTOOLS=$TOP/buildtools\n+HAIKU=$TOP/haiku\n+OUTPUT=/tools\n+SYSROOT=$OUTPUT/cross-tools-$ARCH/sysroot\n+PACKAGE_ROOT=/system\n+\n+hide_output() {\n+  set +x\n+  on_err=\"\n+echo ERROR: An error was encountered with the build.\n+cat /tmp/build.log\n+exit 1\n+\"\n+  trap \"$on_err\" ERR\n+  bash -c \"while true; do sleep 30; echo \\$(date) - building ...; done\" &\n+  PING_LOOP_PID=$!\n+  $@ &> /tmp/build.log\n+  trap - ERR\n+  kill $PING_LOOP_PID\n+  set -x\n+}\n+\n+# First up, build a cross-compiler\n+git clone --depth=1 https://git.haiku-os.org/haiku\n+git clone --depth=1 https://git.haiku-os.org/buildtools\n+cd $BUILDTOOLS/jam\n+hide_output make\n+hide_output ./jam0 install\n+mkdir -p $OUTPUT\n+cd $OUTPUT\n+hide_output $HAIKU/configure --build-cross-tools $ARCH $TOP/buildtools\n+\n+# Set up sysroot to redirect to /system\n+mkdir -p $SYSROOT/boot\n+mkdir -p $PACKAGE_ROOT\n+ln -s $PACKAGE_ROOT $SYSROOT/boot/system\n+\n+# Build needed packages and tools for the cross-compiler\n+hide_output jam -q haiku.hpkg haiku_devel.hpkg '<build>package'\n+\n+# Set up our sysroot\n+cp $OUTPUT/objects/linux/lib/*.so /lib/x86_64-linux-gnu\n+cp $OUTPUT/objects/linux/x86_64/release/tools/package/package /bin/\n+find $SYSROOT/../bin/ -type f -exec ln -s {} /bin/ \\;\n+\n+# Extract packages\n+package extract -C $PACKAGE_ROOT $OUTPUT/objects/haiku/$ARCH/packaging/packages/haiku.hpkg\n+package extract -C $PACKAGE_ROOT $OUTPUT/objects/haiku/$ARCH/packaging/packages/haiku_devel.hpkg\n+find $OUTPUT/download/ -name '*.hpkg' -exec package extract -C $PACKAGE_ROOT {} \\;\n+\n+# Fix libgcc_s so we can link to it\n+cd $PACKAGE_ROOT/develop/lib\n+ln -s ../../lib/libgcc_s.so libgcc_s.so\n+\n+# Clean up\n+rm -rf $BUILDTOOLS $HAIKU $OUTPUT/Jamfile $OUTPUT/attributes $OUTPUT/build \\\n+  $OUTPUT/build_packages $OUTPUT/download $OUTPUT/objects"}, {"sha": "0f6034cdb8620949f3b9244f2bfda6a5eb35b352", "filename": "src/ci/docker/dist-x86_64-haiku/fetch-packages.sh", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/cbc9031fbc235aae7e4b8776ad7801141600dd86/src%2Fci%2Fdocker%2Fdist-x86_64-haiku%2Ffetch-packages.sh", "raw_url": "https://github.com/rust-lang/rust/raw/cbc9031fbc235aae7e4b8776ad7801141600dd86/src%2Fci%2Fdocker%2Fdist-x86_64-haiku%2Ffetch-packages.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-x86_64-haiku%2Ffetch-packages.sh?ref=cbc9031fbc235aae7e4b8776ad7801141600dd86", "patch": "@@ -0,0 +1,18 @@\n+#!/bin/bash\n+# Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+# file at the top-level directory of this distribution and at\n+# http://rust-lang.org/COPYRIGHT.\n+#\n+# Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+# http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+# <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+# option. This file may not be copied, modified, or distributed\n+# except according to those terms.\n+\n+wget http://packages.haiku-os.org/haikuports/master/hpkg/llvm-4.0.1-2-x86_64.hpkg\n+wget http://packages.haiku-os.org/haikuports/master/hpkg/llvm_libs-4.0.1-2-x86_64.hpkg\n+\n+package extract -C /system llvm-4.0.1-2-x86_64.hpkg\n+package extract -C /system llvm_libs-4.0.1-2-x86_64.hpkg\n+\n+rm -f *.hpkg"}, {"sha": "3e785a959097fe509371105262fc85387d89623b", "filename": "src/ci/docker/dist-x86_64-haiku/llvm-config", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/cbc9031fbc235aae7e4b8776ad7801141600dd86/src%2Fci%2Fdocker%2Fdist-x86_64-haiku%2Fllvm-config", "raw_url": "https://github.com/rust-lang/rust/raw/cbc9031fbc235aae7e4b8776ad7801141600dd86/src%2Fci%2Fdocker%2Fdist-x86_64-haiku%2Fllvm-config", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-x86_64-haiku%2Fllvm-config?ref=cbc9031fbc235aae7e4b8776ad7801141600dd86", "patch": "@@ -0,0 +1,30 @@\n+#!/bin/sh\n+# Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+# file at the top-level directory of this distribution and at\n+# http://rust-lang.org/COPYRIGHT.\n+#\n+# Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+# http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+# <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+# option. This file may not be copied, modified, or distributed\n+# except according to those terms.\n+\n+case $1 in\n+--version) echo  4.0.1;;\n+--prefix) echo  $SCRATCH/haiku-cross/sysroot/boot/system;;\n+--bindir) echo  $SCRATCH/haiku-cross/sysroot/boot/system/bin;;\n+--includedir) echo  $SCRATCH/haiku-cross/sysroot/boot/system/develop/headers;;\n+--libdir) echo  $SCRATCH/haiku-/cross/sysroot/boot/system/develop/lib;;\n+--cmakedir) echo  $SCRATCH/haiku-/cross/sysroot/boot/system/develop/lib/cmake/llvm;;\n+--cppflags) echo  -I$SCRATCH/haiku-/cross/sysroot/boot/system/develop/headers   -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS;;\n+--cflags) echo  -I$SCRATCH/haiku-cross/sysroot/boot/system/develop/headers  -fPIC -Wall -W -Wno-unused-parameter -Wwrite-strings -Wno-missing-field-initializers -pedantic -Wno-long-long -Wno-comment -Werror=date-time -ffunction-sections -fdata-sections -O3 -DNDEBUG -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS;;\n+--cxxflags) echo  -I/$SCRATCH/haiku-cross/sysroot/boot/system/develop/headers  -fPIC -fvisibility-inlines-hidden -Wall -W -Wno-unused-parameter -Wwrite-strings -Wcast-qual -Wno-missing-field-initializers -pedantic -Wno-long-long -Wno-maybe-uninitialized -Wdelete-non-virtual-dtor -Wno-comment -Werror=date-time -std=c++11 -ffunction-sections -fdata-sections -O3 -DNDEBUG  -fno-exceptions -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS;;\n+--ldflags) echo  -L$SCRATCH/haiku-cross/sysroot/boot/system/develop/lib ;;\n+--system-libs) echo ;;\n+--libs) echo  -lLLVM-4.0;;\n+--libfiles) echo  $SCRATCH/haiku-cross/sysroot/boot/system/develop/lib/libLLVM-4.0.so;;\n+--components) echo  aarch64 aarch64asmparser aarch64asmprinter aarch64codegen aarch64desc aarch64disassembler aarch64info aarch64utils all all-targets amdgpu amdgpuasmparser amdgpuasmprinter amdgpucodegen amdgpudesc amdgpudisassembler amdgpuinfo amdgpuutils analysis arm armasmparser armasmprinter armcodegen armdesc armdisassembler arminfo asmparser asmprinter bitreader bitwriter bpf bpfasmprinter bpfcodegen bpfdesc bpfdisassembler bpfinfo codegen core coroutines coverage debuginfocodeview debuginfodwarf debuginfomsf debuginfopdb demangle engine executionengine globalisel hexagon hexagonasmparser hexagoncodegen hexagondesc hexagondisassembler hexagoninfo instcombine instrumentation interpreter ipo irreader lanai lanaiasmparser lanaicodegen lanaidesc lanaidisassembler lanaiinfo lanaiinstprinter libdriver lineeditor linker lto mc mcdisassembler mcjit mcparser mips mipsasmparser mipsasmprinter mipscodegen mipsdesc mipsdisassembler mipsinfo mirparser msp430 msp430asmprinter msp430codegen msp430desc msp430info native nativecodegen nvptx nvptxasmprinter nvptxcodegen nvptxdesc nvptxinfo objcarcopts object objectyaml option orcjit passes powerpc powerpcasmparser powerpcasmprinter powerpccodegen powerpcdesc powerpcdisassembler powerpcinfo profiledata riscv riscvcodegen riscvdesc riscvinfo runtimedyld scalaropts selectiondag sparc sparcasmparser sparcasmprinter sparccodegen sparcdesc sparcdisassembler sparcinfo support symbolize systemz systemzasmparser systemzasmprinter systemzcodegen systemzdesc systemzdisassembler systemzinfo tablegen target transformutils vectorize x86 x86asmparser x86asmprinter x86codegen x86desc x86disassembler x86info x86utils xcore xcoreasmprinter xcorecodegen xcoredesc xcoredisassembler xcoreinfo;;\n+--host-target) echo  x86_64-unknown-haiku;;\n+--has-rtti) echo  YES;;\n+--shared-mode) echo  shared;;\n+esac"}]}