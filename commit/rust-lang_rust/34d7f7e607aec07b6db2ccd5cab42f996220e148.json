{"sha": "34d7f7e607aec07b6db2ccd5cab42f996220e148", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM0ZDdmN2U2MDdhZWMwN2I2ZGIyY2NkNWNhYjQyZjk5NjIyMGUxNDg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-07-17T04:09:15Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-07-17T04:09:15Z"}, "message": "Auto merge of #34606 - mathstuf:llvm-with-ninja, r=alexcrichton\n\nllvm, rt: build using the Ninja generator if available\n\nThe Ninja generator generally builds much faster than make. It may also\nbe used on Windows to have a vast speed improvement over the Visual\nStudio generators.\n\nCurrently hidden behind an `--enable-ninja` flag because it does not\nobey the top-level `-j` or `-l` flags given to `make`.", "tree": {"sha": "949e0e5f4e415ba9dc569508796e052e1f7bdddf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/949e0e5f4e415ba9dc569508796e052e1f7bdddf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/34d7f7e607aec07b6db2ccd5cab42f996220e148", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/34d7f7e607aec07b6db2ccd5cab42f996220e148", "html_url": "https://github.com/rust-lang/rust/commit/34d7f7e607aec07b6db2ccd5cab42f996220e148", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/34d7f7e607aec07b6db2ccd5cab42f996220e148/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "103e5c9b37d6cdc4552b353cdf3fd2772dae760c", "url": "https://api.github.com/repos/rust-lang/rust/commits/103e5c9b37d6cdc4552b353cdf3fd2772dae760c", "html_url": "https://github.com/rust-lang/rust/commit/103e5c9b37d6cdc4552b353cdf3fd2772dae760c"}, {"sha": "b9a35902a20f264aa0b516f7f3a4ff2490a3cf06", "url": "https://api.github.com/repos/rust-lang/rust/commits/b9a35902a20f264aa0b516f7f3a4ff2490a3cf06", "html_url": "https://github.com/rust-lang/rust/commit/b9a35902a20f264aa0b516f7f3a4ff2490a3cf06"}], "stats": {"total": 39, "additions": 36, "deletions": 3}, "files": [{"sha": "d2ec457a1c8bccd43e60fe13f0f0b3ae9236ff71", "filename": "configure", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/34d7f7e607aec07b6db2ccd5cab42f996220e148/configure", "raw_url": "https://github.com/rust-lang/rust/raw/34d7f7e607aec07b6db2ccd5cab42f996220e148/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=34d7f7e607aec07b6db2ccd5cab42f996220e148", "patch": "@@ -612,6 +612,7 @@ opt rustbuild 0 \"use the rust and cargo based build system\"\n opt orbit 0 \"get MIR where it belongs - everywhere; most importantly, in orbit\"\n opt codegen-tests 1 \"run the src/test/codegen tests\"\n opt option-checking 1 \"complain about unrecognized options in this configure script\"\n+opt ninja 0 \"build LLVM using the Ninja generator (for MSVC, requires building in the correct environment)\"\n \n # Optimization and debugging options. These may be overridden by the release channel, etc.\n opt_nosave optimize 1 \"build optimized rust code\"\n@@ -785,6 +786,17 @@ probe CFG_BISON            bison\n probe CFG_GDB              gdb\n probe CFG_LLDB             lldb\n \n+if [ -n \"$CFG_ENABLE_NINJA\" ]\n+then\n+  probe CFG_NINJA            ninja\n+  if [ -z \"$CFG_NINJA\" ]\n+  then\n+    # On Debian and Fedora, the `ninja` binary is an IRC bot, so the build tool was\n+    # renamed. Handle this case.\n+    probe CFG_NINJA            ninja-build\n+  fi\n+fi\n+\n # For building LLVM\n probe_need CFG_CMAKE cmake\n \n@@ -1534,7 +1546,10 @@ do\n     fi\n \n     # We need the generator later on for compiler-rt even if LLVM's not built\n-    if [ ${is_msvc} -ne 0 ]\n+    if [ -n \"$CFG_NINJA\" ]\n+    then\n+        generator=\"Ninja\"\n+    elif [ ${is_msvc} -ne 0 ]\n     then\n         case \"$CFG_MSVC_ROOT\" in\n             *14.0*)"}, {"sha": "d6f812049e03cad1b0892f5f44153e28685a457e", "filename": "mk/llvm.mk", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/34d7f7e607aec07b6db2ccd5cab42f996220e148/mk%2Fllvm.mk", "raw_url": "https://github.com/rust-lang/rust/raw/34d7f7e607aec07b6db2ccd5cab42f996220e148/mk%2Fllvm.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fllvm.mk?ref=34d7f7e607aec07b6db2ccd5cab42f996220e148", "patch": "@@ -43,16 +43,26 @@ $$(LLVM_CONFIG_$(1)): $$(LLVM_DONE_$(1))\n \n $$(LLVM_DONE_$(1)): $$(LLVM_DEPS_TARGET_$(1)) $$(LLVM_STAMP_$(1))\n \t@$$(call E, cmake: llvm)\n-ifeq ($$(findstring msvc,$(1)),msvc)\n+ifneq ($$(CFG_NINJA),)\n+\t$$(Q)$$(CFG_NINJA) -C $$(CFG_LLVM_BUILD_DIR_$(1))\n+else ifeq ($$(findstring msvc,$(1)),msvc)\n \t$$(Q)$$(CFG_CMAKE) --build $$(CFG_LLVM_BUILD_DIR_$(1)) \\\n \t\t--config $$(LLVM_BUILD_CONFIG_MODE)\n else\n \t$$(Q)$$(MAKE) -C $$(CFG_LLVM_BUILD_DIR_$(1))\n endif\n \t$$(Q)touch $$@\n \n-ifeq ($$(findstring msvc,$(1)),msvc)\n+ifneq ($$(CFG_NINJA),)\n clean-llvm$(1):\n+\t@$$(call E, clean: llvm)\n+\t$$(Q)$$(CFG_NINJA) -C $$(CFG_LLVM_BUILD_DIR_$(1)) -t clean\n+else ifeq ($$(findstring msvc,$(1)),msvc)\n+clean-llvm$(1):\n+\t@$$(call E, clean: llvm)\n+\t$$(Q)$$(CFG_CMAKE) --build $$(CFG_LLVM_BUILD_DIR_$(1)) \\\n+\t\t--config $$(LLVM_BUILD_CONFIG_MODE) \\\n+\t\t--target clean\n else\n clean-llvm$(1):\n \t@$$(call E, clean: llvm)"}, {"sha": "8113b68380744dcc837ad9ae920c434840a98c1c", "filename": "mk/rt.mk", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/34d7f7e607aec07b6db2ccd5cab42f996220e148/mk%2Frt.mk", "raw_url": "https://github.com/rust-lang/rust/raw/34d7f7e607aec07b6db2ccd5cab42f996220e148/mk%2Frt.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Frt.mk?ref=34d7f7e607aec07b6db2ccd5cab42f996220e148", "patch": "@@ -350,10 +350,17 @@ $$(COMPRT_LIB_$(1)): $$(COMPRT_DEPS) $$(MKFILE_DEPS) $$(LLVM_CONFIG_$$(CFG_BUILD\n \t\t$$(COMPRT_DEFINES_$(1)) \\\n \t\t$$(COMPRT_BUILD_CC_$(1)) \\\n \t\t-G\"$$(CFG_CMAKE_GENERATOR)\"\n+ifneq ($$(CFG_NINJA),)\n+\t$$(CFG_CMAKE) --build \"$$(COMPRT_BUILD_DIR_$(1))\" \\\n+\t\t--target $$(COMPRT_BUILD_TARGET_$(1)) \\\n+\t\t--config $$(LLVM_BUILD_CONFIG_MODE) \\\n+\t\t-- $$(COMPRT_BUILD_ARGS_$(1))\n+else\n \t$$(Q)$$(CFG_CMAKE) --build \"$$(COMPRT_BUILD_DIR_$(1))\" \\\n \t\t--target $$(COMPRT_BUILD_TARGET_$(1)) \\\n \t\t--config $$(LLVM_BUILD_CONFIG_MODE) \\\n \t\t-- $$(COMPRT_BUILD_ARGS_$(1)) $$(MFLAGS)\n+endif\n \t$$(Q)cp \"$$(COMPRT_OUTPUT_$(1))\" $$@\n \n endif"}, {"sha": "e64d7e5a437e6103b13f7b5a471c90fa1f9b7c5b", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/34d7f7e607aec07b6db2ccd5cab42f996220e148/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/34d7f7e607aec07b6db2ccd5cab42f996220e148/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=34d7f7e607aec07b6db2ccd5cab42f996220e148", "patch": "@@ -317,6 +317,7 @@ impl Config {\n                 (\"OPTIMIZE_TESTS\", self.rust_optimize_tests),\n                 (\"DEBUGINFO_TESTS\", self.rust_debuginfo_tests),\n                 (\"LOCAL_REBUILD\", self.local_rebuild),\n+                (\"NINJA\", self.ninja),\n             }\n \n             match key {"}]}