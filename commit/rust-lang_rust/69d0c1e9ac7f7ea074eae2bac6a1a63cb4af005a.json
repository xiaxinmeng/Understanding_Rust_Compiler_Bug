{"sha": "69d0c1e9ac7f7ea074eae2bac6a1a63cb4af005a", "node_id": "C_kwDOAAsO6NoAKDY5ZDBjMWU5YWM3ZjdlYTA3NGVhZTJiYWM2YTFhNjNjYjRhZjAwNWE", "commit": {"author": {"name": "David Wood", "email": "david.wood@huawei.com", "date": "2022-07-04T13:38:42Z"}, "committer": {"name": "David Wood", "email": "david.wood@huawei.com", "date": "2022-07-06T10:15:13Z"}, "message": "incr: cache dwarf objects in work products\n\nCache DWARF objects alongside object files in work products when those\nexist so that DWARF object files are available for thorin in packed mode\nin incremental scenarios.\n\nSigned-off-by: David Wood <david.wood@huawei.com>", "tree": {"sha": "ef3f5f7a7f5e8d63741b4340b175a2811c695833", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ef3f5f7a7f5e8d63741b4340b175a2811c695833"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/69d0c1e9ac7f7ea074eae2bac6a1a63cb4af005a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/69d0c1e9ac7f7ea074eae2bac6a1a63cb4af005a", "html_url": "https://github.com/rust-lang/rust/commit/69d0c1e9ac7f7ea074eae2bac6a1a63cb4af005a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/69d0c1e9ac7f7ea074eae2bac6a1a63cb4af005a/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "44c2558504f79c3f30b484c51df1b202696cd42c", "url": "https://api.github.com/repos/rust-lang/rust/commits/44c2558504f79c3f30b484c51df1b202696cd42c", "html_url": "https://github.com/rust-lang/rust/commit/44c2558504f79c3f30b484c51df1b202696cd42c"}], "stats": {"total": 11, "additions": 9, "deletions": 2}, "files": [{"sha": "50d8fc30d7d7cabe13275e9a3c099834abb37c69", "filename": "src/driver/aot.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/69d0c1e9ac7f7ea074eae2bac6a1a63cb4af005a/src%2Fdriver%2Faot.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69d0c1e9ac7f7ea074eae2bac6a1a63cb4af005a/src%2Fdriver%2Faot.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdriver%2Faot.rs?ref=69d0c1e9ac7f7ea074eae2bac6a1a63cb4af005a", "patch": "@@ -66,7 +66,11 @@ fn emit_module(\n     let work_product = if backend_config.disable_incr_cache {\n         None\n     } else {\n-        rustc_incremental::copy_cgu_workproduct_to_incr_comp_cache_dir(tcx.sess, &name, &tmp_file)\n+        rustc_incremental::copy_cgu_workproduct_to_incr_comp_cache_dir(\n+            tcx.sess,\n+            &name,\n+            &[(\"o\", &tmp_file)],\n+        )\n     };\n \n     ModuleCodegenResult(\n@@ -82,7 +86,10 @@ fn reuse_workproduct_for_cgu(\n ) -> CompiledModule {\n     let work_product = cgu.previous_work_product(tcx);\n     let obj_out = tcx.output_filenames(()).temp_path(OutputType::Object, Some(cgu.name().as_str()));\n-    let source_file = rustc_incremental::in_incr_comp_dir_sess(&tcx.sess, &work_product.saved_file);\n+    let source_file = rustc_incremental::in_incr_comp_dir_sess(\n+        &tcx.sess,\n+        &work_product.saved_files.get(\"o\").expect(\"no saved object file in work product\"),\n+    );\n     if let Err(err) = rustc_fs_util::link_or_copy(&source_file, &obj_out) {\n         tcx.sess.err(&format!(\n             \"unable to copy {} to {}: {}\","}]}