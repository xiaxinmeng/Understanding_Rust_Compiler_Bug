{"sha": "87a0cd9a41c535aac1c8227da06e61f73a5a7f27", "node_id": "C_kwDOAAsO6NoAKDg3YTBjZDlhNDFjNTM1YWFjMWM4MjI3ZGEwNmU2MWY3M2E1YTdmMjc", "commit": {"author": {"name": "Nilstrieb", "email": "48135649+Nilstrieb@users.noreply.github.com", "date": "2023-05-16T09:39:38Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-05-16T09:39:38Z"}, "message": "Rollup merge of #111449 - compiler-errors:recover-impl-generics-correctly, r=Nilstrieb\n\nRecover `impl<T ?Sized>` correctly\n\nFixes #111327\n\nr? ````@Nilstrieb```` but you can re-roll\n\nAlternatively, happy to close this if we're okay with just saying \"sorry #111327 is just a poor side-effect of parser ambiguity\" \ud83e\udd37", "tree": {"sha": "6d2dfbb4ef0f86fe5e26ce3c177d52fc38946b0d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6d2dfbb4ef0f86fe5e26ce3c177d52fc38946b0d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/87a0cd9a41c535aac1c8227da06e61f73a5a7f27", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkY09aCRBK7hj4Ov3rIwAAwHQIACFPg+5hXOBNUqHCb3kQ1C/J\n3oJspqzNrJyniIsMb1mNzrVU9ZwP1Mk+OmSOUEXoOH/r3NMf07k6Exy2/fpUyjyx\niaTHPCQu0FbmFGm9BrrMyJfuAHVPizHDizVvBqoBx5FcxTkJdPRZw7VNqZ8flK9w\nMXLT86Cy2oQLlguihnXWn2/LeC2N+m16YT+2GrO66aEuoFQMIUxlfsxcMT63RJea\nP6lzMW1eIcDVs7Hu93J8sE971aI6ZVvVvSsmOH0LKRKl+010saNyFnq0NsSwFFZU\nyTwnhJwr6aTEb3GR837GAc70FOpiwzNdtao4BeJ34jhPacd9xCxcnBfuxX5vDf4=\n=HHW0\n-----END PGP SIGNATURE-----\n", "payload": "tree 6d2dfbb4ef0f86fe5e26ce3c177d52fc38946b0d\nparent f65281534f99754d94388e705cdc40c047093dee\nparent a5763ff8d3e67c156ebe8160de1db26a644d4c5d\nauthor Nilstrieb <48135649+Nilstrieb@users.noreply.github.com> 1684229978 +0200\ncommitter GitHub <noreply@github.com> 1684229978 +0200\n\nRollup merge of #111449 - compiler-errors:recover-impl-generics-correctly, r=Nilstrieb\n\nRecover `impl<T ?Sized>` correctly\n\nFixes #111327\n\nr? ````@Nilstrieb```` but you can re-roll\n\nAlternatively, happy to close this if we're okay with just saying \"sorry #111327 is just a poor side-effect of parser ambiguity\" \ud83e\udd37\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/87a0cd9a41c535aac1c8227da06e61f73a5a7f27", "html_url": "https://github.com/rust-lang/rust/commit/87a0cd9a41c535aac1c8227da06e61f73a5a7f27", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/87a0cd9a41c535aac1c8227da06e61f73a5a7f27/comments", "author": {"login": "Nilstrieb", "id": 48135649, "node_id": "MDQ6VXNlcjQ4MTM1NjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/48135649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nilstrieb", "html_url": "https://github.com/Nilstrieb", "followers_url": "https://api.github.com/users/Nilstrieb/followers", "following_url": "https://api.github.com/users/Nilstrieb/following{/other_user}", "gists_url": "https://api.github.com/users/Nilstrieb/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nilstrieb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nilstrieb/subscriptions", "organizations_url": "https://api.github.com/users/Nilstrieb/orgs", "repos_url": "https://api.github.com/users/Nilstrieb/repos", "events_url": "https://api.github.com/users/Nilstrieb/events{/privacy}", "received_events_url": "https://api.github.com/users/Nilstrieb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f65281534f99754d94388e705cdc40c047093dee", "url": "https://api.github.com/repos/rust-lang/rust/commits/f65281534f99754d94388e705cdc40c047093dee", "html_url": "https://github.com/rust-lang/rust/commit/f65281534f99754d94388e705cdc40c047093dee"}, {"sha": "a5763ff8d3e67c156ebe8160de1db26a644d4c5d", "url": "https://api.github.com/repos/rust-lang/rust/commits/a5763ff8d3e67c156ebe8160de1db26a644d4c5d", "html_url": "https://github.com/rust-lang/rust/commit/a5763ff8d3e67c156ebe8160de1db26a644d4c5d"}], "stats": {"total": 19, "additions": 19, "deletions": 0}, "files": [{"sha": "cd779b0b43ebd59f83d9574896f0084ac9f04bbd", "filename": "compiler/rustc_parse/src/parser/generics.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/87a0cd9a41c535aac1c8227da06e61f73a5a7f27/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fgenerics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87a0cd9a41c535aac1c8227da06e61f73a5a7f27/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fgenerics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fgenerics.rs?ref=87a0cd9a41c535aac1c8227da06e61f73a5a7f27", "patch": "@@ -453,6 +453,8 @@ impl<'a> Parser<'a> {\n         //     `<` (LIFETIME|IDENT) `:` - generic parameter with bounds\n         //     `<` (LIFETIME|IDENT) `=` - generic parameter with a default\n         //     `<` const                - generic const parameter\n+        //     `<` IDENT `?`            - RECOVERY for `impl<T ?Bound` missing a `:`, meant to\n+        //                                avoid the `T?` to `Option<T>` recovery for types.\n         // The only truly ambiguous case is\n         //     `<` IDENT `>` `::` IDENT ...\n         // we disambiguate it in favor of generics (`impl<T> ::absolute::Path<T> { ... }`)\n@@ -463,6 +465,9 @@ impl<'a> Parser<'a> {\n                 || self.look_ahead(start + 1, |t| t.is_lifetime() || t.is_ident())\n                     && self.look_ahead(start + 2, |t| {\n                         matches!(t.kind, token::Gt | token::Comma | token::Colon | token::Eq)\n+                        // Recovery-only branch -- this could be removed,\n+                        // since it only affects diagnostics currently.\n+                            || matches!(t.kind, token::Question)\n                     })\n                 || self.is_keyword_ahead(start + 1, &[kw::Const]))\n     }"}, {"sha": "e09c0463045ac1f4698bf709150950120ff5d8db", "filename": "tests/ui/parser/impl-on-unsized-typo.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/87a0cd9a41c535aac1c8227da06e61f73a5a7f27/tests%2Fui%2Fparser%2Fimpl-on-unsized-typo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87a0cd9a41c535aac1c8227da06e61f73a5a7f27/tests%2Fui%2Fparser%2Fimpl-on-unsized-typo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fimpl-on-unsized-typo.rs?ref=87a0cd9a41c535aac1c8227da06e61f73a5a7f27", "patch": "@@ -0,0 +1,6 @@\n+trait Tr {}\n+\n+impl<T ?Sized> Tr for T {}\n+//~^ ERROR expected one of `,`, `:`, `=`, or `>`, found `?`\n+\n+fn main() {}"}, {"sha": "23dcc1efd68b150b8f22578a41f160a1b39e5b1e", "filename": "tests/ui/parser/impl-on-unsized-typo.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/87a0cd9a41c535aac1c8227da06e61f73a5a7f27/tests%2Fui%2Fparser%2Fimpl-on-unsized-typo.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/87a0cd9a41c535aac1c8227da06e61f73a5a7f27/tests%2Fui%2Fparser%2Fimpl-on-unsized-typo.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fimpl-on-unsized-typo.stderr?ref=87a0cd9a41c535aac1c8227da06e61f73a5a7f27", "patch": "@@ -0,0 +1,8 @@\n+error: expected one of `,`, `:`, `=`, or `>`, found `?`\n+  --> $DIR/impl-on-unsized-typo.rs:3:8\n+   |\n+LL | impl<T ?Sized> Tr for T {}\n+   |        ^ expected one of `,`, `:`, `=`, or `>`\n+\n+error: aborting due to previous error\n+"}]}