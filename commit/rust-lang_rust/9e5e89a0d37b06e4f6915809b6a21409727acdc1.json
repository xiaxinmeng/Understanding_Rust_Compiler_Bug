{"sha": "9e5e89a0d37b06e4f6915809b6a21409727acdc1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjllNWU4OWEwZDM3YjA2ZTRmNjkxNTgwOWI2YTIxNDA5NzI3YWNkYzE=", "commit": {"author": {"name": "Linus F\u00e4rnstrand", "email": "faern@faern.net", "date": "2018-12-13T14:24:50Z"}, "committer": {"name": "Linus F\u00e4rnstrand", "email": "faern@faern.net", "date": "2018-12-13T17:49:54Z"}, "message": "Fix dur2intervals import on cloudabi", "tree": {"sha": "120d2d64a32ea7d7566cb1054fc3960f0f2d30f3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/120d2d64a32ea7d7566cb1054fc3960f0f2d30f3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9e5e89a0d37b06e4f6915809b6a21409727acdc1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9e5e89a0d37b06e4f6915809b6a21409727acdc1", "html_url": "https://github.com/rust-lang/rust/commit/9e5e89a0d37b06e4f6915809b6a21409727acdc1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9e5e89a0d37b06e4f6915809b6a21409727acdc1/comments", "author": {"login": "faern", "id": 332294, "node_id": "MDQ6VXNlcjMzMjI5NA==", "avatar_url": "https://avatars.githubusercontent.com/u/332294?v=4", "gravatar_id": "", "url": "https://api.github.com/users/faern", "html_url": "https://github.com/faern", "followers_url": "https://api.github.com/users/faern/followers", "following_url": "https://api.github.com/users/faern/following{/other_user}", "gists_url": "https://api.github.com/users/faern/gists{/gist_id}", "starred_url": "https://api.github.com/users/faern/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/faern/subscriptions", "organizations_url": "https://api.github.com/users/faern/orgs", "repos_url": "https://api.github.com/users/faern/repos", "events_url": "https://api.github.com/users/faern/events{/privacy}", "received_events_url": "https://api.github.com/users/faern/received_events", "type": "User", "site_admin": false}, "committer": {"login": "faern", "id": 332294, "node_id": "MDQ6VXNlcjMzMjI5NA==", "avatar_url": "https://avatars.githubusercontent.com/u/332294?v=4", "gravatar_id": "", "url": "https://api.github.com/users/faern", "html_url": "https://github.com/faern", "followers_url": "https://api.github.com/users/faern/followers", "following_url": "https://api.github.com/users/faern/following{/other_user}", "gists_url": "https://api.github.com/users/faern/gists{/gist_id}", "starred_url": "https://api.github.com/users/faern/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/faern/subscriptions", "organizations_url": "https://api.github.com/users/faern/orgs", "repos_url": "https://api.github.com/users/faern/repos", "events_url": "https://api.github.com/users/faern/events{/privacy}", "received_events_url": "https://api.github.com/users/faern/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9511fc7845f108e2af47f9c2b07544a63c2f1ec1", "url": "https://api.github.com/repos/rust-lang/rust/commits/9511fc7845f108e2af47f9c2b07544a63c2f1ec1", "html_url": "https://github.com/rust-lang/rust/commit/9511fc7845f108e2af47f9c2b07544a63c2f1ec1"}], "stats": {"total": 14, "additions": 9, "deletions": 5}, "files": [{"sha": "3229d98624e17930c35c66be4c64922395bcb1ce", "filename": "src/libstd/sys/cloudabi/condvar.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9e5e89a0d37b06e4f6915809b6a21409727acdc1/src%2Flibstd%2Fsys%2Fcloudabi%2Fcondvar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e5e89a0d37b06e4f6915809b6a21409727acdc1/src%2Flibstd%2Fsys%2Fcloudabi%2Fcondvar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fcloudabi%2Fcondvar.rs?ref=9e5e89a0d37b06e4f6915809b6a21409727acdc1", "patch": "@@ -13,7 +13,7 @@ use mem;\n use sync::atomic::{AtomicU32, Ordering};\n use sys::cloudabi::abi;\n use sys::mutex::{self, Mutex};\n-use sys::time::dur2intervals;\n+use sys::time::checked_dur2intervals;\n use time::Duration;\n \n extern \"C\" {\n@@ -114,6 +114,8 @@ impl Condvar {\n \n         // Call into the kernel to wait on the condition variable.\n         let condvar = self.condvar.get();\n+        let timeout = checked_dur2intervals(&dur)\n+            .expect(\"overflow converting duration to nanoseconds\");\n         let subscriptions = [\n             abi::subscription {\n                 type_: abi::eventtype::CONDVAR,\n@@ -132,7 +134,7 @@ impl Condvar {\n                 union: abi::subscription_union {\n                     clock: abi::subscription_clock {\n                         clock_id: abi::clockid::MONOTONIC,\n-                        timeout: dur2intervals(&dur),\n+                        timeout,\n                         ..mem::zeroed()\n                     },\n                 },"}, {"sha": "177321439d83cec4940e0c41dd22083a028db4b2", "filename": "src/libstd/sys/cloudabi/thread.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9e5e89a0d37b06e4f6915809b6a21409727acdc1/src%2Flibstd%2Fsys%2Fcloudabi%2Fthread.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e5e89a0d37b06e4f6915809b6a21409727acdc1/src%2Flibstd%2Fsys%2Fcloudabi%2Fthread.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fcloudabi%2Fthread.rs?ref=9e5e89a0d37b06e4f6915809b6a21409727acdc1", "patch": "@@ -16,7 +16,7 @@ use libc;\n use mem;\n use ptr;\n use sys::cloudabi::abi;\n-use sys::time::dur2intervals;\n+use sys::time::checked_dur2intervals;\n use sys_common::thread::*;\n use time::Duration;\n \n@@ -70,13 +70,15 @@ impl Thread {\n     }\n \n     pub fn sleep(dur: Duration) {\n+        let timeout = checked_dur2intervals(&dur)\n+            .expect(\"overflow converting duration to nanoseconds\");\n         unsafe {\n             let subscription = abi::subscription {\n                 type_: abi::eventtype::CLOCK,\n                 union: abi::subscription_union {\n                     clock: abi::subscription_clock {\n                         clock_id: abi::clockid::MONOTONIC,\n-                        timeout: dur2intervals(&dur),\n+                        timeout,\n                         ..mem::zeroed()\n                     },\n                 },"}, {"sha": "c9fea18fda6ec011404d7137722232f8d7922f1f", "filename": "src/libstd/sys/cloudabi/time.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9e5e89a0d37b06e4f6915809b6a21409727acdc1/src%2Flibstd%2Fsys%2Fcloudabi%2Ftime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9e5e89a0d37b06e4f6915809b6a21409727acdc1/src%2Flibstd%2Fsys%2Fcloudabi%2Ftime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fcloudabi%2Ftime.rs?ref=9e5e89a0d37b06e4f6915809b6a21409727acdc1", "patch": "@@ -19,7 +19,7 @@ pub struct Instant {\n     t: abi::timestamp,\n }\n \n-fn checked_dur2intervals(dur: &Duration) -> Option<abi::timestamp> {\n+pub fn checked_dur2intervals(dur: &Duration) -> Option<abi::timestamp> {\n     dur.as_secs()\n         .checked_mul(NSEC_PER_SEC)?\n         .checked_add(dur.subsec_nanos() as abi::timestamp)"}]}