{"sha": "fe68b1ab327297fea9ed2fb273fe0a7ac5aedfdd", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZlNjhiMWFiMzI3Mjk3ZmVhOWVkMmZiMjczZmUwYTdhYzVhZWRmZGQ=", "commit": {"author": {"name": "Daniel Silverman", "email": "iladin@gmail.com", "date": "2021-04-30T22:53:14Z"}, "committer": {"name": "Daniel Silverman", "email": "iladin@gmail.com", "date": "2021-04-30T22:53:14Z"}, "message": "Fix linker_args with --target=sparcv9-sun-solaris\n\nMoved -z ignore to add_as_needed\n\nTrying to cross-compile for sparcv9-sun-solaris\ngetting an error message for -zignore\n\nIntroduced when -z -ignore was separated here\n22d0ab0\n\nNo formatting done\n\nReproduce\n\n``` bash\nrustup target add sparcv9-sun-solaris\ncargo new --bin hello && cd hello && cargo run --target=sparcv9-sun-solaris\n```\n\nconfig.toml\n\n[target.sparcv9-sun-solaris]\nlinker = \"gcc\"", "tree": {"sha": "a4a8d0fd537bb759627f6e422207937acc34641a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a4a8d0fd537bb759627f6e422207937acc34641a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fe68b1ab327297fea9ed2fb273fe0a7ac5aedfdd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fe68b1ab327297fea9ed2fb273fe0a7ac5aedfdd", "html_url": "https://github.com/rust-lang/rust/commit/fe68b1ab327297fea9ed2fb273fe0a7ac5aedfdd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fe68b1ab327297fea9ed2fb273fe0a7ac5aedfdd/comments", "author": {"login": "iladin", "id": 3768247, "node_id": "MDQ6VXNlcjM3NjgyNDc=", "avatar_url": "https://avatars.githubusercontent.com/u/3768247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iladin", "html_url": "https://github.com/iladin", "followers_url": "https://api.github.com/users/iladin/followers", "following_url": "https://api.github.com/users/iladin/following{/other_user}", "gists_url": "https://api.github.com/users/iladin/gists{/gist_id}", "starred_url": "https://api.github.com/users/iladin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iladin/subscriptions", "organizations_url": "https://api.github.com/users/iladin/orgs", "repos_url": "https://api.github.com/users/iladin/repos", "events_url": "https://api.github.com/users/iladin/events{/privacy}", "received_events_url": "https://api.github.com/users/iladin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iladin", "id": 3768247, "node_id": "MDQ6VXNlcjM3NjgyNDc=", "avatar_url": "https://avatars.githubusercontent.com/u/3768247?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iladin", "html_url": "https://github.com/iladin", "followers_url": "https://api.github.com/users/iladin/followers", "following_url": "https://api.github.com/users/iladin/following{/other_user}", "gists_url": "https://api.github.com/users/iladin/gists{/gist_id}", "starred_url": "https://api.github.com/users/iladin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iladin/subscriptions", "organizations_url": "https://api.github.com/users/iladin/orgs", "repos_url": "https://api.github.com/users/iladin/repos", "events_url": "https://api.github.com/users/iladin/events{/privacy}", "received_events_url": "https://api.github.com/users/iladin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a45f0d724ed7116ed475fb0d628bc118418e7cbf", "url": "https://api.github.com/repos/rust-lang/rust/commits/a45f0d724ed7116ed475fb0d628bc118418e7cbf", "html_url": "https://github.com/rust-lang/rust/commit/a45f0d724ed7116ed475fb0d628bc118418e7cbf"}], "stats": {"total": 6, "additions": 4, "deletions": 2}, "files": [{"sha": "8ba124a1fa88c789271ddbd2c32af2b0c7b05c27", "filename": "compiler/rustc_codegen_ssa/src/back/linker.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/fe68b1ab327297fea9ed2fb273fe0a7ac5aedfdd/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flinker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe68b1ab327297fea9ed2fb273fe0a7ac5aedfdd/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flinker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flinker.rs?ref=fe68b1ab327297fea9ed2fb273fe0a7ac5aedfdd", "patch": "@@ -432,8 +432,6 @@ impl<'a> Linker for GccLinker<'a> {\n         // insert it here.\n         if self.sess.target.is_like_osx {\n             self.linker_arg(\"-dead_strip\");\n-        } else if self.sess.target.is_like_solaris {\n-            self.linker_arg(\"-zignore\");\n \n         // If we're building a dylib, we don't use --gc-sections because LLVM\n         // has already done the best it can do, and we also don't want to\n@@ -655,6 +653,10 @@ impl<'a> Linker for GccLinker<'a> {\n     fn add_as_needed(&mut self) {\n         if self.sess.target.linker_is_gnu {\n             self.linker_arg(\"--as-needed\");\n+        } else if self.sess.target.is_like_solaris {\n+            // -z ignore is the Solaris equivalent to the GNU ld --as-needed option\n+            self.linker_arg(\"-z\");\n+            self.linker_arg(\"ignore\");\n         }\n     }\n }"}]}