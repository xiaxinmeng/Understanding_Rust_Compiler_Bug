{"sha": "628605e07a2a9a546ba698f1a50311b16832f227", "node_id": "C_kwDOAAsO6NoAKDYyODYwNWUwN2EyYTlhNTQ2YmE2OThmMWE1MDMxMWIxNjgzMmYyMjc", "commit": {"author": {"name": "Renato Lochetti", "email": "renato.lochetti@gmail.com", "date": "2023-04-22T19:28:08Z"}, "committer": {"name": "Renato Lochetti", "email": "renato.lochetti@gmail.com", "date": "2023-04-22T19:28:08Z"}, "message": "Ignore `shadow` warns in code from macro expansions", "tree": {"sha": "0e57573d3dbd99e93106798c18ae9acec71d7fd0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0e57573d3dbd99e93106798c18ae9acec71d7fd0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/628605e07a2a9a546ba698f1a50311b16832f227", "comment_count": 0, "verification": {"verified": false, "reason": "bad_email", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYKAB0WIQSUUq9F5en84QJ6JSz95O9WxHnTCAUCZEQ1SAAKCRD95O9WxHnT\nCJ35AP9DHYLH7wOT9zBTedSK5P4jUKmdxRlVCWef40CT5gCGLwEAxGI3SDVnC3xb\nc44HG8H+rLPLYJVnsRTsFJzVuH4VPQA=\n=zb7R\n-----END PGP SIGNATURE-----", "payload": "tree 0e57573d3dbd99e93106798c18ae9acec71d7fd0\nparent c976ad07ee5ce330b612caff8d49397e8ddcdc28\nauthor Renato Lochetti <renato.lochetti@gmail.com> 1682191688 +0100\ncommitter Renato Lochetti <renato.lochetti@gmail.com> 1682191688 +0100\n\nIgnore `shadow` warns in code from macro expansions\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/628605e07a2a9a546ba698f1a50311b16832f227", "html_url": "https://github.com/rust-lang/rust/commit/628605e07a2a9a546ba698f1a50311b16832f227", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/628605e07a2a9a546ba698f1a50311b16832f227/comments", "author": {"login": "lochetti", "id": 2541422, "node_id": "MDQ6VXNlcjI1NDE0MjI=", "avatar_url": "https://avatars.githubusercontent.com/u/2541422?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lochetti", "html_url": "https://github.com/lochetti", "followers_url": "https://api.github.com/users/lochetti/followers", "following_url": "https://api.github.com/users/lochetti/following{/other_user}", "gists_url": "https://api.github.com/users/lochetti/gists{/gist_id}", "starred_url": "https://api.github.com/users/lochetti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lochetti/subscriptions", "organizations_url": "https://api.github.com/users/lochetti/orgs", "repos_url": "https://api.github.com/users/lochetti/repos", "events_url": "https://api.github.com/users/lochetti/events{/privacy}", "received_events_url": "https://api.github.com/users/lochetti/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lochetti", "id": 2541422, "node_id": "MDQ6VXNlcjI1NDE0MjI=", "avatar_url": "https://avatars.githubusercontent.com/u/2541422?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lochetti", "html_url": "https://github.com/lochetti", "followers_url": "https://api.github.com/users/lochetti/followers", "following_url": "https://api.github.com/users/lochetti/following{/other_user}", "gists_url": "https://api.github.com/users/lochetti/gists{/gist_id}", "starred_url": "https://api.github.com/users/lochetti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lochetti/subscriptions", "organizations_url": "https://api.github.com/users/lochetti/orgs", "repos_url": "https://api.github.com/users/lochetti/repos", "events_url": "https://api.github.com/users/lochetti/events{/privacy}", "received_events_url": "https://api.github.com/users/lochetti/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c976ad07ee5ce330b612caff8d49397e8ddcdc28", "url": "https://api.github.com/repos/rust-lang/rust/commits/c976ad07ee5ce330b612caff8d49397e8ddcdc28", "html_url": "https://github.com/rust-lang/rust/commit/c976ad07ee5ce330b612caff8d49397e8ddcdc28"}], "stats": {"total": 106, "additions": 59, "deletions": 47}, "files": [{"sha": "993f9373d85d351ff8f2e4931c764fcc2554d4eb", "filename": "clippy_lints/src/shadow.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/628605e07a2a9a546ba698f1a50311b16832f227/clippy_lints%2Fsrc%2Fshadow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/628605e07a2a9a546ba698f1a50311b16832f227/clippy_lints%2Fsrc%2Fshadow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fshadow.rs?ref=628605e07a2a9a546ba698f1a50311b16832f227", "patch": "@@ -108,7 +108,7 @@ impl<'tcx> LateLintPass<'tcx> for Shadow {\n     fn check_pat(&mut self, cx: &LateContext<'tcx>, pat: &'tcx Pat<'_>) {\n         let PatKind::Binding(_, id, ident, _) = pat.kind else { return };\n \n-        if pat.span.desugaring_kind().is_some() {\n+        if pat.span.desugaring_kind().is_some() || pat.span.from_expansion() {\n             return;\n         }\n "}, {"sha": "2c0fc3e3fd83ffb8bdd090599162478abb36c01f", "filename": "tests/ui/shadow.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/628605e07a2a9a546ba698f1a50311b16832f227/tests%2Fui%2Fshadow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/628605e07a2a9a546ba698f1a50311b16832f227/tests%2Fui%2Fshadow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fshadow.rs?ref=628605e07a2a9a546ba698f1a50311b16832f227", "patch": "@@ -8,6 +8,12 @@ extern crate proc_macro_derive;\n #[derive(proc_macro_derive::ShadowDerive)]\n pub struct Nothing;\n \n+macro_rules! reuse {\n+    ($v:ident) => {\n+        let $v = $v + 1;\n+    };\n+}\n+\n fn shadow_same() {\n     let x = 1;\n     let x = x;\n@@ -33,6 +39,12 @@ fn shadow_reuse() -> Option<()> {\n     None\n }\n \n+fn shadow_reuse_macro() {\n+    let x = 1;\n+    // this should not warn\n+    reuse!(x);\n+}\n+\n fn shadow_unrelated() {\n     let x = 1;\n     let x = 2;"}, {"sha": "8321f6df224cf8444d39605c81ee3b8b122225a1", "filename": "tests/ui/shadow.stderr", "status": "modified", "additions": 46, "deletions": 46, "changes": 92, "blob_url": "https://github.com/rust-lang/rust/blob/628605e07a2a9a546ba698f1a50311b16832f227/tests%2Fui%2Fshadow.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/628605e07a2a9a546ba698f1a50311b16832f227/tests%2Fui%2Fshadow.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fshadow.stderr?ref=628605e07a2a9a546ba698f1a50311b16832f227", "patch": "@@ -1,278 +1,278 @@\n error: `x` is shadowed by itself in `x`\n-  --> $DIR/shadow.rs:13:9\n+  --> $DIR/shadow.rs:19:9\n    |\n LL |     let x = x;\n    |         ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:12:9\n+  --> $DIR/shadow.rs:18:9\n    |\n LL |     let x = 1;\n    |         ^\n    = note: `-D clippy::shadow-same` implied by `-D warnings`\n \n error: `mut x` is shadowed by itself in `&x`\n-  --> $DIR/shadow.rs:14:13\n+  --> $DIR/shadow.rs:20:13\n    |\n LL |     let mut x = &x;\n    |             ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:13:9\n+  --> $DIR/shadow.rs:19:9\n    |\n LL |     let x = x;\n    |         ^\n \n error: `x` is shadowed by itself in `&mut x`\n-  --> $DIR/shadow.rs:15:9\n+  --> $DIR/shadow.rs:21:9\n    |\n LL |     let x = &mut x;\n    |         ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:14:9\n+  --> $DIR/shadow.rs:20:9\n    |\n LL |     let mut x = &x;\n    |         ^^^^^\n \n error: `x` is shadowed by itself in `*x`\n-  --> $DIR/shadow.rs:16:9\n+  --> $DIR/shadow.rs:22:9\n    |\n LL |     let x = *x;\n    |         ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:15:9\n+  --> $DIR/shadow.rs:21:9\n    |\n LL |     let x = &mut x;\n    |         ^\n \n error: `x` is shadowed\n-  --> $DIR/shadow.rs:21:9\n+  --> $DIR/shadow.rs:27:9\n    |\n LL |     let x = x.0;\n    |         ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:20:9\n+  --> $DIR/shadow.rs:26:9\n    |\n LL |     let x = ([[0]], ());\n    |         ^\n    = note: `-D clippy::shadow-reuse` implied by `-D warnings`\n \n error: `x` is shadowed\n-  --> $DIR/shadow.rs:22:9\n+  --> $DIR/shadow.rs:28:9\n    |\n LL |     let x = x[0];\n    |         ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:21:9\n+  --> $DIR/shadow.rs:27:9\n    |\n LL |     let x = x.0;\n    |         ^\n \n error: `x` is shadowed\n-  --> $DIR/shadow.rs:23:10\n+  --> $DIR/shadow.rs:29:10\n    |\n LL |     let [x] = x;\n    |          ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:22:9\n+  --> $DIR/shadow.rs:28:9\n    |\n LL |     let x = x[0];\n    |         ^\n \n error: `x` is shadowed\n-  --> $DIR/shadow.rs:24:9\n+  --> $DIR/shadow.rs:30:9\n    |\n LL |     let x = Some(x);\n    |         ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:23:10\n+  --> $DIR/shadow.rs:29:10\n    |\n LL |     let [x] = x;\n    |          ^\n \n error: `x` is shadowed\n-  --> $DIR/shadow.rs:25:9\n+  --> $DIR/shadow.rs:31:9\n    |\n LL |     let x = foo(x);\n    |         ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:24:9\n+  --> $DIR/shadow.rs:30:9\n    |\n LL |     let x = Some(x);\n    |         ^\n \n error: `x` is shadowed\n-  --> $DIR/shadow.rs:26:9\n+  --> $DIR/shadow.rs:32:9\n    |\n LL |     let x = || x;\n    |         ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:25:9\n+  --> $DIR/shadow.rs:31:9\n    |\n LL |     let x = foo(x);\n    |         ^\n \n error: `x` is shadowed\n-  --> $DIR/shadow.rs:27:9\n+  --> $DIR/shadow.rs:33:9\n    |\n LL |     let x = Some(1).map(|_| x)?;\n    |         ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:26:9\n+  --> $DIR/shadow.rs:32:9\n    |\n LL |     let x = || x;\n    |         ^\n \n error: `y` is shadowed\n-  --> $DIR/shadow.rs:29:9\n+  --> $DIR/shadow.rs:35:9\n    |\n LL |     let y = match y {\n    |         ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:28:9\n+  --> $DIR/shadow.rs:34:9\n    |\n LL |     let y = 1;\n    |         ^\n \n error: `x` shadows a previous, unrelated binding\n-  --> $DIR/shadow.rs:38:9\n+  --> $DIR/shadow.rs:50:9\n    |\n LL |     let x = 2;\n    |         ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:37:9\n+  --> $DIR/shadow.rs:49:9\n    |\n LL |     let x = 1;\n    |         ^\n    = note: `-D clippy::shadow-unrelated` implied by `-D warnings`\n \n error: `x` shadows a previous, unrelated binding\n-  --> $DIR/shadow.rs:43:13\n+  --> $DIR/shadow.rs:55:13\n    |\n LL |         let x = 1;\n    |             ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:42:10\n+  --> $DIR/shadow.rs:54:10\n    |\n LL |     fn f(x: u32) {\n    |          ^\n \n error: `x` shadows a previous, unrelated binding\n-  --> $DIR/shadow.rs:48:14\n+  --> $DIR/shadow.rs:60:14\n    |\n LL |         Some(x) => {\n    |              ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:45:9\n+  --> $DIR/shadow.rs:57:9\n    |\n LL |     let x = 1;\n    |         ^\n \n error: `x` shadows a previous, unrelated binding\n-  --> $DIR/shadow.rs:49:17\n+  --> $DIR/shadow.rs:61:17\n    |\n LL |             let x = 1;\n    |                 ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:48:14\n+  --> $DIR/shadow.rs:60:14\n    |\n LL |         Some(x) => {\n    |              ^\n \n error: `x` shadows a previous, unrelated binding\n-  --> $DIR/shadow.rs:53:17\n+  --> $DIR/shadow.rs:65:17\n    |\n LL |     if let Some(x) = Some(1) {}\n    |                 ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:45:9\n+  --> $DIR/shadow.rs:57:9\n    |\n LL |     let x = 1;\n    |         ^\n \n error: `x` shadows a previous, unrelated binding\n-  --> $DIR/shadow.rs:54:20\n+  --> $DIR/shadow.rs:66:20\n    |\n LL |     while let Some(x) = Some(1) {}\n    |                    ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:45:9\n+  --> $DIR/shadow.rs:57:9\n    |\n LL |     let x = 1;\n    |         ^\n \n error: `x` shadows a previous, unrelated binding\n-  --> $DIR/shadow.rs:55:15\n+  --> $DIR/shadow.rs:67:15\n    |\n LL |     let _ = |[x]: [u32; 1]| {\n    |               ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:45:9\n+  --> $DIR/shadow.rs:57:9\n    |\n LL |     let x = 1;\n    |         ^\n \n error: `x` shadows a previous, unrelated binding\n-  --> $DIR/shadow.rs:56:13\n+  --> $DIR/shadow.rs:68:13\n    |\n LL |         let x = 1;\n    |             ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:55:15\n+  --> $DIR/shadow.rs:67:15\n    |\n LL |     let _ = |[x]: [u32; 1]| {\n    |               ^\n \n error: `y` is shadowed\n-  --> $DIR/shadow.rs:59:17\n+  --> $DIR/shadow.rs:71:17\n    |\n LL |     if let Some(y) = y {}\n    |                 ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:58:9\n+  --> $DIR/shadow.rs:70:9\n    |\n LL |     let y = Some(1);\n    |         ^\n \n error: `_b` shadows a previous, unrelated binding\n-  --> $DIR/shadow.rs:95:9\n+  --> $DIR/shadow.rs:107:9\n    |\n LL |     let _b = _a;\n    |         ^^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:94:28\n+  --> $DIR/shadow.rs:106:28\n    |\n LL | pub async fn foo2(_a: i32, _b: i64) {\n    |                            ^^\n \n error: `x` shadows a previous, unrelated binding\n-  --> $DIR/shadow.rs:101:21\n+  --> $DIR/shadow.rs:113:21\n    |\n LL |         if let Some(x) = Some(1) { x } else { 1 }\n    |                     ^\n    |\n note: previous binding is here\n-  --> $DIR/shadow.rs:100:13\n+  --> $DIR/shadow.rs:112:13\n    |\n LL |         let x = 1;\n    |             ^"}]}