{"sha": "f1c8accf90d797ef32a56ee08ed7705a4b500c17", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYxYzhhY2NmOTBkNzk3ZWYzMmE1NmVlMDhlZDc3MDVhNGI1MDBjMTc=", "commit": {"author": {"name": "Fabian Wolff", "email": "fabian.wolff@alumni.ethz.ch", "date": "2021-09-10T17:36:51Z"}, "committer": {"name": "Fabian Wolff", "email": "fabian.wolff@alumni.ethz.ch", "date": "2021-09-10T19:02:41Z"}, "message": "Use `libc::sigaction()` instead of `sys::signal()` to prevent a deadlock", "tree": {"sha": "7e951973cc8e28ec319df3fc1c2a1855e6eaf2f7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7e951973cc8e28ec319df3fc1c2a1855e6eaf2f7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f1c8accf90d797ef32a56ee08ed7705a4b500c17", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f1c8accf90d797ef32a56ee08ed7705a4b500c17", "html_url": "https://github.com/rust-lang/rust/commit/f1c8accf90d797ef32a56ee08ed7705a4b500c17", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f1c8accf90d797ef32a56ee08ed7705a4b500c17/comments", "author": {"login": "FabianWolff", "id": 16052130, "node_id": "MDQ6VXNlcjE2MDUyMTMw", "avatar_url": "https://avatars.githubusercontent.com/u/16052130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FabianWolff", "html_url": "https://github.com/FabianWolff", "followers_url": "https://api.github.com/users/FabianWolff/followers", "following_url": "https://api.github.com/users/FabianWolff/following{/other_user}", "gists_url": "https://api.github.com/users/FabianWolff/gists{/gist_id}", "starred_url": "https://api.github.com/users/FabianWolff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FabianWolff/subscriptions", "organizations_url": "https://api.github.com/users/FabianWolff/orgs", "repos_url": "https://api.github.com/users/FabianWolff/repos", "events_url": "https://api.github.com/users/FabianWolff/events{/privacy}", "received_events_url": "https://api.github.com/users/FabianWolff/received_events", "type": "User", "site_admin": false}, "committer": {"login": "FabianWolff", "id": 16052130, "node_id": "MDQ6VXNlcjE2MDUyMTMw", "avatar_url": "https://avatars.githubusercontent.com/u/16052130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FabianWolff", "html_url": "https://github.com/FabianWolff", "followers_url": "https://api.github.com/users/FabianWolff/followers", "following_url": "https://api.github.com/users/FabianWolff/following{/other_user}", "gists_url": "https://api.github.com/users/FabianWolff/gists{/gist_id}", "starred_url": "https://api.github.com/users/FabianWolff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FabianWolff/subscriptions", "organizations_url": "https://api.github.com/users/FabianWolff/orgs", "repos_url": "https://api.github.com/users/FabianWolff/repos", "events_url": "https://api.github.com/users/FabianWolff/events{/privacy}", "received_events_url": "https://api.github.com/users/FabianWolff/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "497ee321af3b8496eaccd7af7b437f18bab81abf", "url": "https://api.github.com/repos/rust-lang/rust/commits/497ee321af3b8496eaccd7af7b437f18bab81abf", "html_url": "https://github.com/rust-lang/rust/commit/497ee321af3b8496eaccd7af7b437f18bab81abf"}], "stats": {"total": 7, "additions": 3, "deletions": 4}, "files": [{"sha": "13b384d8899f83cb4a7dc6c41fd6f6cc6bea8c70", "filename": "library/std/src/sys/unix/process/process_unix.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f1c8accf90d797ef32a56ee08ed7705a4b500c17/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fprocess%2Fprocess_unix.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f1c8accf90d797ef32a56ee08ed7705a4b500c17/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fprocess%2Fprocess_unix.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Funix%2Fprocess%2Fprocess_unix.rs?ref=f1c8accf90d797ef32a56ee08ed7705a4b500c17", "patch": "@@ -333,10 +333,9 @@ impl Command {\n             let mut set = MaybeUninit::<libc::sigset_t>::uninit();\n             cvt(sigemptyset(set.as_mut_ptr()))?;\n             cvt(libc::pthread_sigmask(libc::SIG_SETMASK, set.as_ptr(), ptr::null_mut()))?;\n-            let ret = sys::signal(libc::SIGPIPE, libc::SIG_DFL);\n-            if ret == libc::SIG_ERR {\n-                return Err(io::Error::last_os_error());\n-            }\n+            let mut action: libc::sigaction = mem::zeroed();\n+            action.sa_sigaction = libc::SIG_DFL;\n+            cvt(libc::sigaction(libc::SIGPIPE, &action as *const _, ptr::null_mut()))?;\n         }\n \n         for callback in self.get_closures().iter_mut() {"}]}