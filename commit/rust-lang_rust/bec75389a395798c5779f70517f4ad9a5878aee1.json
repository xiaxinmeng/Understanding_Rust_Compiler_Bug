{"sha": "bec75389a395798c5779f70517f4ad9a5878aee1", "node_id": "C_kwDOAAsO6NoAKGJlYzc1Mzg5YTM5NTc5OGM1Nzc5ZjcwNTE3ZjRhZDlhNTg3OGFlZTE", "commit": {"author": {"name": "Oli Scherer", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2022-06-02T10:07:25Z"}, "committer": {"name": "Oli Scherer", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2022-06-02T10:07:25Z"}, "message": "Add 'compiler/rustc_smir/' from commit '9abcb5c7b574cf316eb23d3f469187bb86ba3019'\n\ngit-subtree-dir: compiler/rustc_smir\ngit-subtree-mainline: fb1976011e3df96b5d3eccd6b2f4e51ef7dc8f16\ngit-subtree-split: 9abcb5c7b574cf316eb23d3f469187bb86ba3019", "tree": {"sha": "ea85ab91b5c18485e594c43895f7849cdb53a418", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ea85ab91b5c18485e594c43895f7849cdb53a418"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bec75389a395798c5779f70517f4ad9a5878aee1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bec75389a395798c5779f70517f4ad9a5878aee1", "html_url": "https://github.com/rust-lang/rust/commit/bec75389a395798c5779f70517f4ad9a5878aee1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bec75389a395798c5779f70517f4ad9a5878aee1/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fb1976011e3df96b5d3eccd6b2f4e51ef7dc8f16", "url": "https://api.github.com/repos/rust-lang/rust/commits/fb1976011e3df96b5d3eccd6b2f4e51ef7dc8f16", "html_url": "https://github.com/rust-lang/rust/commit/fb1976011e3df96b5d3eccd6b2f4e51ef7dc8f16"}, {"sha": "9abcb5c7b574cf316eb23d3f469187bb86ba3019", "url": "https://api.github.com/repos/rust-lang/rust/commits/9abcb5c7b574cf316eb23d3f469187bb86ba3019", "html_url": "https://github.com/rust-lang/rust/commit/9abcb5c7b574cf316eb23d3f469187bb86ba3019"}], "stats": {"total": 147, "additions": 147, "deletions": 0}, "files": [{"sha": "eb5a316cbd195d26e3f768c7dd8e1b47299e17f8", "filename": "compiler/rustc_smir/.gitignore", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/bec75389a395798c5779f70517f4ad9a5878aee1/compiler%2Frustc_smir%2F.gitignore", "raw_url": "https://github.com/rust-lang/rust/raw/bec75389a395798c5779f70517f4ad9a5878aee1/compiler%2Frustc_smir%2F.gitignore", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_smir%2F.gitignore?ref=bec75389a395798c5779f70517f4ad9a5878aee1", "patch": "@@ -0,0 +1 @@\n+target"}, {"sha": "bc0cac5a0bcef267027f80f8d18befe0a9818da7", "filename": "compiler/rustc_smir/Cargo.toml", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/bec75389a395798c5779f70517f4ad9a5878aee1/compiler%2Frustc_smir%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/bec75389a395798c5779f70517f4ad9a5878aee1/compiler%2Frustc_smir%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_smir%2FCargo.toml?ref=bec75389a395798c5779f70517f4ad9a5878aee1", "patch": "@@ -0,0 +1,13 @@\n+[package]\n+name = \"rustc_smir\"\n+version = \"0.0.0\"\n+edition = \"2021\"\n+\n+[dependencies]\n+rustc_middle = { path = \"../rustc_middle\", optional = true }\n+rustc_driver = { path = \"../rustc_driver\", optional = true }\n+rustc_borrowck = { path = \"../rustc_borrowck\", optional = true }\n+rustc_interface = { path = \"../rustc_interface\", optional = true }\n+\n+[features]\n+default = [\"rustc_middle\", \"rustc_driver\", \"rustc_borrowck\", \"rustc_interface\"]"}, {"sha": "ae49098dd0ce65095f859f79eb069c4e0b39befa", "filename": "compiler/rustc_smir/README.md", "status": "added", "additions": 75, "deletions": 0, "changes": 75, "blob_url": "https://github.com/rust-lang/rust/blob/bec75389a395798c5779f70517f4ad9a5878aee1/compiler%2Frustc_smir%2FREADME.md", "raw_url": "https://github.com/rust-lang/rust/raw/bec75389a395798c5779f70517f4ad9a5878aee1/compiler%2Frustc_smir%2FREADME.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_smir%2FREADME.md?ref=bec75389a395798c5779f70517f4ad9a5878aee1", "patch": "@@ -0,0 +1,75 @@\n+This crate is regularly synced with its mirror in the rustc repo at `compiler/rustc_smir`.\n+\n+We use `git subtree` for this to preserve commits and allow the rustc repo to\n+edit these crates without having to touch this repo. This keeps the crates compiling\n+while allowing us to independently work on them here. The effort of keeping them in\n+sync is pushed entirely onto us, without affecting rustc workflows negatively.\n+This may change in the future, but changes to policy should only be done via a\n+compiler team MCP.\n+\n+## Instructions for working on this crate locally\n+\n+Since the crate is the same in the rustc repo and here, the dependencies on rustc_* crates\n+will only either work here or there, but never in both places at the same time. Thus we use\n+optional dependencies on the rustc_* crates, requiring local development to use\n+\n+```\n+cargo build --no-default-features -Zavoid-dev-deps\n+```\n+\n+in order to compile successfully.\n+\n+## Instructions for syncing\n+\n+### Updating this repository\n+\n+In the rustc repo, execute\n+\n+```\n+git subtree push --prefix=compiler/rustc_smir url_to_your_fork_of_project_stable_mir some_feature_branch\n+```\n+\n+and then open a PR of your `some_feature_branch` against https://github.com/rust-lang/project-stable-mir\n+\n+### Updating the rustc library\n+\n+First we need to bump our stack limit, as the rustc repo otherwise quickly hits that:\n+\n+```\n+ulimit -s 60000\n+```\n+\n+#### Maximum function recursion depth (1000) reached\n+\n+Then we need to disable `dash` as the default shell for sh scripts, as otherwise we run into a\n+hard limit of a recursion depth of 1000:\n+\n+```\n+sudo dpkg-reconfigure dash\n+```\n+\n+and then select `No` to disable dash.\n+\n+\n+#### Patching your `git worktree`\n+\n+The regular git worktree does not scale to repos of the size of the rustc repo.\n+So download the `git-subtree.sh` from https://github.com/gitgitgadget/git/pull/493/files and run\n+\n+```\n+sudo cp --backup /path/to/patched/git-subtree.sh /usr/lib/git-core/git-subtree\n+sudo chmod --reference=/usr/lib/git-core/git-subtree~ /usr/lib/git-core/git-subtree\n+sudo chown --reference=/usr/lib/git-core/git-subtree~ /usr/lib/git-core/git-subtree\n+```\n+\n+#### Actually doing a sync\n+\n+In the rustc repo, execute\n+\n+```\n+git subtree pull --prefix=compiler/rustc_smir https://github.com/rust-lang/project-stable-mir smir\n+```\n+\n+Note: only ever sync to rustc from the project-stable-mir's `smir` branch. Do not sync with your own forks.\n+\n+Then open a PR against rustc just like a regular PR."}, {"sha": "7b696fc1f5cecba18def14414c85a39ef4e64716", "filename": "compiler/rustc_smir/rust-toolchain.toml", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/bec75389a395798c5779f70517f4ad9a5878aee1/compiler%2Frustc_smir%2Frust-toolchain.toml", "raw_url": "https://github.com/rust-lang/rust/raw/bec75389a395798c5779f70517f4ad9a5878aee1/compiler%2Frustc_smir%2Frust-toolchain.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_smir%2Frust-toolchain.toml?ref=bec75389a395798c5779f70517f4ad9a5878aee1", "patch": "@@ -0,0 +1,3 @@\n+[toolchain]\n+channel = \"nightly-2022-06-01\"\n+components = [ \"rustfmt\", \"rustc-dev\" ]"}, {"sha": "decdae953d95bec992a4b0520271e4451ff9d790", "filename": "compiler/rustc_smir/src/lib.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/bec75389a395798c5779f70517f4ad9a5878aee1/compiler%2Frustc_smir%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bec75389a395798c5779f70517f4ad9a5878aee1/compiler%2Frustc_smir%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_smir%2Fsrc%2Flib.rs?ref=bec75389a395798c5779f70517f4ad9a5878aee1", "patch": "@@ -0,0 +1,18 @@\n+//! The WIP stable interface to rustc internals.\n+//!\n+//! For more information see https://github.com/rust-lang/project-stable-mir\n+//!\n+//! # Note\n+//!\n+//! This API is still completely unstable and subject to change.\n+\n+#![doc(\n+    html_root_url = \"https://doc.rust-lang.org/nightly/nightly-rustc/\",\n+    test(attr(allow(unused_variables), deny(warnings)))\n+)]\n+\n+#![cfg_attr(not(feature = \"default\"), feature(rustc_private))]\n+\n+pub mod mir;\n+\n+pub mod very_unstable;"}, {"sha": "855605b1a4f9d449a761c55a531080fb8807b2f0", "filename": "compiler/rustc_smir/src/mir.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/bec75389a395798c5779f70517f4ad9a5878aee1/compiler%2Frustc_smir%2Fsrc%2Fmir.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bec75389a395798c5779f70517f4ad9a5878aee1/compiler%2Frustc_smir%2Fsrc%2Fmir.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_smir%2Fsrc%2Fmir.rs?ref=bec75389a395798c5779f70517f4ad9a5878aee1", "patch": "@@ -0,0 +1,10 @@\n+pub use crate::very_unstable::middle::mir::{\n+    visit::MutVisitor, AggregateKind, AssertKind, BasicBlock, BasicBlockData, BinOp, BindingForm,\n+    BlockTailInfo, Body, BorrowKind, CastKind, ClearCrossCrate, Constant, ConstantKind,\n+    CopyNonOverlapping, Coverage, FakeReadCause, Field, GeneratorInfo, ImplicitSelfKind,\n+    InlineAsmOperand, Local, LocalDecl, LocalInfo, LocalKind, Location, MirPhase, MirSource,\n+    NullOp, Operand, Place, PlaceRef, ProjectionElem, ProjectionKind, Promoted, RetagKind, Rvalue,\n+    Safety, SourceInfo, SourceScope, SourceScopeData, SourceScopeLocalData, Statement,\n+    StatementKind, UnOp, UserTypeProjection, UserTypeProjections, VarBindingForm, VarDebugInfo,\n+    VarDebugInfoContents,\n+};"}, {"sha": "12ba133dbb169403305825f59f39eba7cff394a6", "filename": "compiler/rustc_smir/src/very_unstable.rs", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/bec75389a395798c5779f70517f4ad9a5878aee1/compiler%2Frustc_smir%2Fsrc%2Fvery_unstable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bec75389a395798c5779f70517f4ad9a5878aee1/compiler%2Frustc_smir%2Fsrc%2Fvery_unstable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_smir%2Fsrc%2Fvery_unstable.rs?ref=bec75389a395798c5779f70517f4ad9a5878aee1", "patch": "@@ -0,0 +1,27 @@\n+//! This module reexports various crates and modules from unstable rustc APIs.\n+//! Add anything you need here and it will get slowly transferred to a stable API.\n+//! Only use rustc_smir in your dependencies and use the reexports here instead of\n+//! directly referring to the unstable crates.\n+\n+macro_rules! crates {\n+    ($($rustc_name:ident -> $name:ident,)*) => {\n+        $(\n+            #[cfg(not(feature = \"default\"))]\n+            pub extern crate $rustc_name as $name;\n+            #[cfg(feature = \"default\")]\n+            pub use $rustc_name as $name;\n+        )*\n+    }\n+}\n+\n+crates! {\n+    rustc_borrowck -> borrowck,\n+    rustc_driver -> driver,\n+    rustc_hir -> hir,\n+    rustc_interface -> interface,\n+    rustc_middle -> middle,\n+    rustc_mir_dataflow -> dataflow,\n+    rustc_mir_transform -> transform,\n+    rustc_serialize -> serialize,\n+    rustc_trait_selection -> trait_selection,\n+}"}]}