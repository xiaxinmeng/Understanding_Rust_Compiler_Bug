{"sha": "b6ed20648421bcb1d6da1392597dd67e978f2a11", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI2ZWQyMDY0ODQyMWJjYjFkNmRhMTM5MjU5N2RkNjdlOTc4ZjJhMTE=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-02-14T01:41:19Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-02-14T01:41:19Z"}, "message": "Rollup merge of #58258 - nnethercote:shrink-hir-Expr, r=michaelwoerister\n\nReduce the size of `hir::Expr`.\n\nFrom 104 bytes to 72 bytes on x86-64. This slightly reduces instruction\ncounts.\n\nAlso add an assertion about the size.", "tree": {"sha": "c0f76fbefcc6b8e898ba88ebca770928ece252cc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c0f76fbefcc6b8e898ba88ebca770928ece252cc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b6ed20648421bcb1d6da1392597dd67e978f2a11", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcZMc/CRBK7hj4Ov3rIwAAdHIIAJol0DRN/hsPIe0zhP02sWDt\nn0Fy4D0UGg5036ZdWzWm/t1eD8ow9KoQCnFbD/C3Q391/Jcsxeee83SlCI3qCcBH\nxiWRuhhIcExCisGMFJA7u/go0ustcFh8+sPBP/E0T4/LX2mrZg9yfBu0m/KxEWHf\nvWAkoLuN9h2mqjqzSBNSEduOD09CcG3lLOtGy5NIQyhWc4JhWy1jc1522iVMsX1Q\n2/neQEcQaXXZ1r4ZbcIgMfKwMIKpWWRKoCAwlcI7WwLOLKzextFPabLosd83eLo5\n/sGBy1FyM16mdT6afboKpf52lRBkEBnh/9Q7JbwHRjgKxx6ZJmQ5ZmBin2mAUHg=\n=gt6Z\n-----END PGP SIGNATURE-----\n", "payload": "tree c0f76fbefcc6b8e898ba88ebca770928ece252cc\nparent 919cf42feb30238fc5d0a74e7a576551f3468bba\nparent 5d65e8cc7aec3cdcd99367c58367a16c99a8ae22\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1550108479 +0100\ncommitter GitHub <noreply@github.com> 1550108479 +0100\n\nRollup merge of #58258 - nnethercote:shrink-hir-Expr, r=michaelwoerister\n\nReduce the size of `hir::Expr`.\n\nFrom 104 bytes to 72 bytes on x86-64. This slightly reduces instruction\ncounts.\n\nAlso add an assertion about the size.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b6ed20648421bcb1d6da1392597dd67e978f2a11", "html_url": "https://github.com/rust-lang/rust/commit/b6ed20648421bcb1d6da1392597dd67e978f2a11", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b6ed20648421bcb1d6da1392597dd67e978f2a11/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "919cf42feb30238fc5d0a74e7a576551f3468bba", "url": "https://api.github.com/repos/rust-lang/rust/commits/919cf42feb30238fc5d0a74e7a576551f3468bba", "html_url": "https://github.com/rust-lang/rust/commit/919cf42feb30238fc5d0a74e7a576551f3468bba"}, {"sha": "5d65e8cc7aec3cdcd99367c58367a16c99a8ae22", "url": "https://api.github.com/repos/rust-lang/rust/commits/5d65e8cc7aec3cdcd99367c58367a16c99a8ae22", "html_url": "https://github.com/rust-lang/rust/commit/5d65e8cc7aec3cdcd99367c58367a16c99a8ae22"}], "stats": {"total": 33, "additions": 23, "deletions": 10}, "files": [{"sha": "84487c40f874508f4d6ad469d941139d1109266f", "filename": "src/librustc/hir/lowering.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b6ed20648421bcb1d6da1392597dd67e978f2a11/src%2Flibrustc%2Fhir%2Flowering.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b6ed20648421bcb1d6da1392597dd67e978f2a11/src%2Flibrustc%2Fhir%2Flowering.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Flowering.rs?ref=b6ed20648421bcb1d6da1392597dd67e978f2a11", "patch": "@@ -3859,15 +3859,15 @@ impl<'a> LoweringContext<'a> {\n                 hir::ExprKind::Call(f, args.iter().map(|x| self.lower_expr(x)).collect())\n             }\n             ExprKind::MethodCall(ref seg, ref args) => {\n-                let hir_seg = self.lower_path_segment(\n+                let hir_seg = P(self.lower_path_segment(\n                     e.span,\n                     seg,\n                     ParamMode::Optional,\n                     0,\n                     ParenthesizedGenericArgs::Err,\n                     ImplTraitContext::disallowed(),\n                     None,\n-                );\n+                ));\n                 let args = args.iter().map(|x| self.lower_expr(x)).collect();\n                 hir::ExprKind::MethodCall(hir_seg, seg.ident.span, args)\n             }\n@@ -4148,7 +4148,7 @@ impl<'a> LoweringContext<'a> {\n                     node: if is_unit {\n                         hir::ExprKind::Path(struct_path)\n                     } else {\n-                        hir::ExprKind::Struct(struct_path, fields, None)\n+                        hir::ExprKind::Struct(P(struct_path), fields, None)\n                     },\n                     span: e.span,\n                     attrs: e.attrs.clone(),\n@@ -4220,13 +4220,13 @@ impl<'a> LoweringContext<'a> {\n                 hir::ExprKind::InlineAsm(P(hir_asm), outputs, inputs)\n             }\n             ExprKind::Struct(ref path, ref fields, ref maybe_expr) => hir::ExprKind::Struct(\n-                self.lower_qpath(\n+                P(self.lower_qpath(\n                     e.id,\n                     &None,\n                     path,\n                     ParamMode::Optional,\n                     ImplTraitContext::disallowed(),\n-                ),\n+                )),\n                 fields.iter().map(|x| self.lower_field(x)).collect(),\n                 maybe_expr.as_ref().map(|x| P(self.lower_expr(x))),\n             ),"}, {"sha": "d774359fa79ec2fb8f9b242cab2416ddd6d79943", "filename": "src/librustc/hir/mod.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b6ed20648421bcb1d6da1392597dd67e978f2a11/src%2Flibrustc%2Fhir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b6ed20648421bcb1d6da1392597dd67e978f2a11/src%2Flibrustc%2Fhir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fmod.rs?ref=b6ed20648421bcb1d6da1392597dd67e978f2a11", "patch": "@@ -1319,6 +1319,10 @@ pub struct Expr {\n     pub hir_id: HirId,\n }\n \n+// `Expr` is used a lot. Make sure it doesn't unintentionally get bigger.\n+#[cfg(target_arch = \"x86_64\")]\n+static_assert!(MEM_SIZE_OF_EXPR: std::mem::size_of::<Expr>() == 72);\n+\n impl Expr {\n     pub fn precedence(&self) -> ExprPrecedence {\n         match self.node {\n@@ -1438,7 +1442,7 @@ pub enum ExprKind {\n     /// and the remaining elements are the rest of the arguments.\n     /// Thus, `x.foo::<Bar, Baz>(a, b, c, d)` is represented as\n     /// `ExprKind::MethodCall(PathSegment { foo, [Bar, Baz] }, [x, a, b, c, d])`.\n-    MethodCall(PathSegment, Span, HirVec<Expr>),\n+    MethodCall(P<PathSegment>, Span, HirVec<Expr>),\n     /// A tuple (e.g., `(a, b, c ,d)`).\n     Tup(HirVec<Expr>),\n     /// A binary operation (e.g., `a + b`, `a * b`).\n@@ -1506,7 +1510,7 @@ pub enum ExprKind {\n     ///\n     /// For example, `Foo {x: 1, y: 2}`, or\n     /// `Foo {x: 1, .. base}`, where `base` is the `Option<Expr>`.\n-    Struct(QPath, HirVec<Field>, Option<P<Expr>>),\n+    Struct(P<QPath>, HirVec<Field>, Option<P<Expr>>),\n \n     /// An array literal constructed from one repeated element.\n     ///"}, {"sha": "8ab9a8e8dda86484356ea118ca322675e466888b", "filename": "src/librustc_save_analysis/lib.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/b6ed20648421bcb1d6da1392597dd67e978f2a11/src%2Flibrustc_save_analysis%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b6ed20648421bcb1d6da1392597dd67e978f2a11/src%2Flibrustc_save_analysis%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_save_analysis%2Flib.rs?ref=b6ed20648421bcb1d6da1392597dd67e978f2a11", "patch": "@@ -614,11 +614,16 @@ impl<'l, 'tcx: 'l> SaveContext<'l, 'tcx> {\n                     Some(def) if def != HirDef::Err => def,\n                     _ => self.get_path_def(self.tcx.hir().get_parent_node(id)),\n                 }\n-            },\n+            }\n+\n             Node::Expr(&hir::Expr {\n                 node: hir::ExprKind::Struct(ref qpath, ..),\n                 ..\n-            }) |\n+            }) => {\n+                let hir_id = self.tcx.hir().node_to_hir_id(id);\n+                self.tables.qpath_def(qpath, hir_id)\n+            }\n+\n             Node::Expr(&hir::Expr {\n                 node: hir::ExprKind::Path(ref qpath),\n                 .."}, {"sha": "8b80fba4d19d01e096b72c3d5a033a5f9c442f09", "filename": "src/librustc_typeck/check/demand.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b6ed20648421bcb1d6da1392597dd67e978f2a11/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b6ed20648421bcb1d6da1392597dd67e978f2a11/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs?ref=b6ed20648421bcb1d6da1392597dd67e978f2a11", "patch": "@@ -435,7 +435,11 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n \n         match expr.node {\n             // All built-in range literals but `..=` and `..` desugar to Structs\n-            ExprKind::Struct(QPath::Resolved(None, ref path), _, _) |\n+            ExprKind::Struct(ref qpath, _, _) => {\n+                if let QPath::Resolved(None, ref path) = **qpath {\n+                    return is_range_path(&path) && span_is_range_literal(&expr.span);\n+                }\n+            }\n             // `..` desugars to its struct path\n             ExprKind::Path(QPath::Resolved(None, ref path)) => {\n                 return is_range_path(&path) && span_is_range_literal(&expr.span);"}]}