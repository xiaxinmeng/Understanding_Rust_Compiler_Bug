{"sha": "3ce6f0d022014ba13ed328a372c1ac1f37d9045e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNjZTZmMGQwMjIwMTRiYTEzZWQzMjhhMzcyYzFhYzFmMzdkOTA0NWU=", "commit": {"author": {"name": "ThibsG", "email": "thibsg@pm.me", "date": "2021-04-11T11:29:08Z"}, "committer": {"name": "ThibsG", "email": "thibsg@pm.me", "date": "2021-04-11T11:29:08Z"}, "message": "Fix FP in `wrong_self_convention` lint", "tree": {"sha": "9cccb11db9ea21c9f9efeabd9f1f59b545648d5a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9cccb11db9ea21c9f9efeabd9f1f59b545648d5a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3ce6f0d022014ba13ed328a372c1ac1f37d9045e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3ce6f0d022014ba13ed328a372c1ac1f37d9045e", "html_url": "https://github.com/rust-lang/rust/commit/3ce6f0d022014ba13ed328a372c1ac1f37d9045e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3ce6f0d022014ba13ed328a372c1ac1f37d9045e/comments", "author": {"login": "ThibsG", "id": 12683889, "node_id": "MDQ6VXNlcjEyNjgzODg5", "avatar_url": "https://avatars.githubusercontent.com/u/12683889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThibsG", "html_url": "https://github.com/ThibsG", "followers_url": "https://api.github.com/users/ThibsG/followers", "following_url": "https://api.github.com/users/ThibsG/following{/other_user}", "gists_url": "https://api.github.com/users/ThibsG/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThibsG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThibsG/subscriptions", "organizations_url": "https://api.github.com/users/ThibsG/orgs", "repos_url": "https://api.github.com/users/ThibsG/repos", "events_url": "https://api.github.com/users/ThibsG/events{/privacy}", "received_events_url": "https://api.github.com/users/ThibsG/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ThibsG", "id": 12683889, "node_id": "MDQ6VXNlcjEyNjgzODg5", "avatar_url": "https://avatars.githubusercontent.com/u/12683889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThibsG", "html_url": "https://github.com/ThibsG", "followers_url": "https://api.github.com/users/ThibsG/followers", "following_url": "https://api.github.com/users/ThibsG/following{/other_user}", "gists_url": "https://api.github.com/users/ThibsG/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThibsG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThibsG/subscriptions", "organizations_url": "https://api.github.com/users/ThibsG/orgs", "repos_url": "https://api.github.com/users/ThibsG/repos", "events_url": "https://api.github.com/users/ThibsG/events{/privacy}", "received_events_url": "https://api.github.com/users/ThibsG/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f7c2c44e76c626afcd594ecc193ed446729152db", "url": "https://api.github.com/repos/rust-lang/rust/commits/f7c2c44e76c626afcd594ecc193ed446729152db", "html_url": "https://github.com/rust-lang/rust/commit/f7c2c44e76c626afcd594ecc193ed446729152db"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "6e2bcb113c2c1baf6ba899e59a135db8482c7fa3", "filename": "clippy_lints/src/methods/wrong_self_convention.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/3ce6f0d022014ba13ed328a372c1ac1f37d9045e/clippy_lints%2Fsrc%2Fmethods%2Fwrong_self_convention.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ce6f0d022014ba13ed328a372c1ac1f37d9045e/clippy_lints%2Fsrc%2Fmethods%2Fwrong_self_convention.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fwrong_self_convention.rs?ref=3ce6f0d022014ba13ed328a372c1ac1f37d9045e", "patch": "@@ -102,6 +102,14 @@ pub(super) fn check<'tcx>(\n             .iter()\n             .all(|conv| conv.check(cx, self_ty, item_name, implements_trait, is_trait_item))\n     }) {\n+        // don't lint if it implements a trait but not willing to check `Copy` types conventions (see #7032)\n+        if implements_trait\n+            && !conventions\n+                .iter()\n+                .any(|conv| matches!(conv, Convention::IsSelfTypeCopy(_)))\n+        {\n+            return;\n+        }\n         if !self_kinds.iter().any(|k| k.matches(cx, self_ty, first_arg_ty)) {\n             let suggestion = {\n                 if conventions.len() > 1 {"}, {"sha": "ae3a740d405d6fc103c8b2f33f8381cb6d6584cf", "filename": "tests/ui/wrong_self_convention2.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/3ce6f0d022014ba13ed328a372c1ac1f37d9045e/tests%2Fui%2Fwrong_self_convention2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ce6f0d022014ba13ed328a372c1ac1f37d9045e/tests%2Fui%2Fwrong_self_convention2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fwrong_self_convention2.rs?ref=3ce6f0d022014ba13ed328a372c1ac1f37d9045e", "patch": "@@ -30,3 +30,15 @@ mod issue6983 {\n         }\n     }\n }\n+\n+mod issue7032 {\n+    trait Foo {\n+        fn from_usize(x: usize) -> Self;\n+    }\n+    // don't trigger\n+    impl Foo for usize {\n+        fn from_usize(x: usize) -> Self {\n+            x\n+        }\n+    }\n+}"}]}