{"sha": "02f93ca32481d3b1a6a307d28223ca061348eb0c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAyZjkzY2EzMjQ4MWQzYjFhNmEzMDdkMjgyMjNjYTA2MTM0OGViMGM=", "commit": {"author": {"name": "Ben Blum", "email": "bblum@andrew.cmu.edu", "date": "2013-08-23T00:15:09Z"}, "committer": {"name": "Ben Blum", "email": "bblum@andrew.cmu.edu", "date": "2013-08-23T21:24:15Z"}, "message": "Emit a better error for attempted unsafe-pointer-self. Close #8306.", "tree": {"sha": "8cf8745fde15c45b086cba256cb2cfd4b0865af5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8cf8745fde15c45b086cba256cb2cfd4b0865af5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/02f93ca32481d3b1a6a307d28223ca061348eb0c", "comment_count": 9, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/02f93ca32481d3b1a6a307d28223ca061348eb0c", "html_url": "https://github.com/rust-lang/rust/commit/02f93ca32481d3b1a6a307d28223ca061348eb0c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/02f93ca32481d3b1a6a307d28223ca061348eb0c/comments", "author": {"login": "bblum", "id": 1820515, "node_id": "MDQ6VXNlcjE4MjA1MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bblum", "html_url": "https://github.com/bblum", "followers_url": "https://api.github.com/users/bblum/followers", "following_url": "https://api.github.com/users/bblum/following{/other_user}", "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}", "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bblum/subscriptions", "organizations_url": "https://api.github.com/users/bblum/orgs", "repos_url": "https://api.github.com/users/bblum/repos", "events_url": "https://api.github.com/users/bblum/events{/privacy}", "received_events_url": "https://api.github.com/users/bblum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bblum", "id": 1820515, "node_id": "MDQ6VXNlcjE4MjA1MTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1820515?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bblum", "html_url": "https://github.com/bblum", "followers_url": "https://api.github.com/users/bblum/followers", "following_url": "https://api.github.com/users/bblum/following{/other_user}", "gists_url": "https://api.github.com/users/bblum/gists{/gist_id}", "starred_url": "https://api.github.com/users/bblum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bblum/subscriptions", "organizations_url": "https://api.github.com/users/bblum/orgs", "repos_url": "https://api.github.com/users/bblum/repos", "events_url": "https://api.github.com/users/bblum/events{/privacy}", "received_events_url": "https://api.github.com/users/bblum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e9f6f3f2ccf563b39f7484025c8272da60c24dfa", "url": "https://api.github.com/repos/rust-lang/rust/commits/e9f6f3f2ccf563b39f7484025c8272da60c24dfa", "html_url": "https://github.com/rust-lang/rust/commit/e9f6f3f2ccf563b39f7484025c8272da60c24dfa"}], "stats": {"total": 35, "additions": 35, "deletions": 0}, "files": [{"sha": "6db9828fa252c102fae7f605a40d4603b5e79f36", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/02f93ca32481d3b1a6a307d28223ca061348eb0c/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/02f93ca32481d3b1a6a307d28223ca061348eb0c/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=02f93ca32481d3b1a6a307d28223ca061348eb0c", "patch": "@@ -3571,6 +3571,19 @@ impl Parser {\n             self.bump();\n             sty_value\n           }\n+          token::BINOP(token::STAR) => {\n+            // Possibly \"*self\" or \"*mut self\" -- not supported. Try to avoid\n+            // emitting cryptic \"unexpected token\" errors.\n+            self.bump();\n+            if self.token_is_mutability(self.token) {\n+                self.bump();\n+            }\n+            if self.is_self_ident() {\n+                self.span_err(*self.span, \"cannot pass self by unsafe pointer\");\n+                self.bump();\n+            }\n+            sty_value\n+          }\n           _ => {\n             sty_static\n           }"}, {"sha": "0bf73bbdfe31cf3d559580f07379eb0551d7e987", "filename": "src/test/compile-fail/no-unsafe-self.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/02f93ca32481d3b1a6a307d28223ca061348eb0c/src%2Ftest%2Fcompile-fail%2Fno-unsafe-self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/02f93ca32481d3b1a6a307d28223ca061348eb0c/src%2Ftest%2Fcompile-fail%2Fno-unsafe-self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fno-unsafe-self.rs?ref=02f93ca32481d3b1a6a307d28223ca061348eb0c", "patch": "@@ -0,0 +1,22 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+trait A {\n+    fn foo(*mut self); //~ ERROR cannot pass self by unsafe pointer\n+    fn bar(*self); //~ ERROR cannot pass self by unsafe pointer\n+}\n+\n+struct X;\n+impl A for X {\n+    fn foo(*mut self) { } //~ ERROR cannot pass self by unsafe pointer\n+    fn bar(*self) { } //~ ERROR cannot pass self by unsafe pointer\n+}\n+\n+fn main() { }"}]}