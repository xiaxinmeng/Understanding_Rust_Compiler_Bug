{"sha": "7778906bee9e8e93792353824548044a758b72f4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc3Nzg5MDZiZWU5ZThlOTM3OTIzNTM4MjQ1NDgwNDRhNzU4YjcyZjQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-10-14T18:48:08Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-10-14T18:48:08Z"}, "message": "Auto merge of #45177 - oli-obk:clippy, r=alexcrichton\n\nEnable building clippy in CI\n\nr? @alexcrichton\n\nAs discussed at Rustfest. Measured additional time is 4 minutes on my machine if no dependencies are shared with other tools. In reality most dependencies are shared (especially the slow to compile ones like serde).\n\ncc @Manishearth\n\nDoes not run clippy's test suite, since\n\na) it is nontrivial in the rustc build system\nb) it breaks more frequently but the breakage is negligible\n\nIf clippy breaks, the procedure to follow is documented under https://github.com/rust-lang/rust/blob/master/CONTRIBUTING.md#external-dependencies", "tree": {"sha": "d952e717251540f400e76ad2262cb832f7777344", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d952e717251540f400e76ad2262cb832f7777344"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7778906bee9e8e93792353824548044a758b72f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7778906bee9e8e93792353824548044a758b72f4", "html_url": "https://github.com/rust-lang/rust/commit/7778906bee9e8e93792353824548044a758b72f4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7778906bee9e8e93792353824548044a758b72f4/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7920a7cc74bb2a2a80d90e32386e6194bb9a05dc", "url": "https://api.github.com/repos/rust-lang/rust/commits/7920a7cc74bb2a2a80d90e32386e6194bb9a05dc", "html_url": "https://github.com/rust-lang/rust/commit/7920a7cc74bb2a2a80d90e32386e6194bb9a05dc"}, {"sha": "c6c47fa6c0ee0569ba1ab725904c814aa33051ca", "url": "https://api.github.com/repos/rust-lang/rust/commits/c6c47fa6c0ee0569ba1ab725904c814aa33051ca", "html_url": "https://github.com/rust-lang/rust/commit/c6c47fa6c0ee0569ba1ab725904c814aa33051ca"}], "stats": {"total": 19, "additions": 12, "deletions": 7}, "files": [{"sha": "fb32ab0cb862d2a44ef798fc958d5c040e81302c", "filename": "src/bootstrap/check.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/7778906bee9e8e93792353824548044a758b72f4/src%2Fbootstrap%2Fcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7778906bee9e8e93792353824548044a758b72f4/src%2Fbootstrap%2Fcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcheck.rs?ref=7778906bee9e8e93792353824548044a758b72f4", "patch": "@@ -364,6 +364,7 @@ impl Step for Miri {\n \n #[derive(Debug, Copy, Clone, PartialEq, Eq, Hash)]\n pub struct Clippy {\n+    stage: u32,\n     host: Interned<String>,\n }\n \n@@ -378,24 +379,28 @@ impl Step for Clippy {\n \n     fn make_run(run: RunConfig) {\n         run.builder.ensure(Clippy {\n+            stage: run.builder.top_stage,\n             host: run.target,\n         });\n     }\n \n     /// Runs `cargo test` for clippy.\n     fn run(self, builder: &Builder) {\n         let build = builder.build;\n+        let stage = self.stage;\n         let host = self.host;\n-        let compiler = builder.compiler(1, host);\n+        let compiler = builder.compiler(stage, host);\n \n-        let _clippy = builder.ensure(tool::Clippy { compiler, target: self.host });\n+        let clippy = builder.ensure(tool::Clippy { compiler, target: self.host });\n         let mut cargo = builder.cargo(compiler, Mode::Tool, host, \"test\");\n         cargo.arg(\"--manifest-path\").arg(build.src.join(\"src/tools/clippy/Cargo.toml\"));\n \n         // Don't build tests dynamically, just a pain to work with\n         cargo.env(\"RUSTC_NO_PREFER_DYNAMIC\", \"1\");\n         // clippy tests need to know about the stage sysroot\n         cargo.env(\"SYSROOT\", builder.sysroot(compiler));\n+        // clippy tests need to find the driver\n+        cargo.env(\"CLIPPY_DRIVER_PATH\", clippy);\n \n         builder.add_rustc_lib_path(compiler, &mut cargo);\n "}, {"sha": "e95a5e0743637cb674509ba3c0d2ce6c59a0e243", "filename": "src/bootstrap/tool.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7778906bee9e8e93792353824548044a758b72f4/src%2Fbootstrap%2Ftool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7778906bee9e8e93792353824548044a758b72f4/src%2Fbootstrap%2Ftool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftool.rs?ref=7778906bee9e8e93792353824548044a758b72f4", "patch": "@@ -387,7 +387,7 @@ pub struct Clippy {\n \n impl Step for Clippy {\n     type Output = PathBuf;\n-    const DEFAULT: bool = false;\n+    const DEFAULT: bool = true;\n     const ONLY_HOSTS: bool = true;\n \n     fn should_run(run: ShouldRun) -> ShouldRun {\n@@ -411,7 +411,7 @@ impl Step for Clippy {\n         builder.ensure(ToolBuild {\n             compiler: self.compiler,\n             target: self.target,\n-            tool: \"clippy\",\n+            tool: \"clippy-driver\",\n             mode: Mode::Librustc,\n             path: \"src/tools/clippy\",\n             expectation: builder.build.config.toolstate.clippy.passes(ToolState::Compiling),"}, {"sha": "b62b1b68edcdf23a70cb12f31403c80e97f13634", "filename": "src/tools/clippy", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fclippy?ref=7778906bee9e8e93792353824548044a758b72f4", "patch": "@@ -1 +1 @@\n-Subproject commit 25444585592f5da648edd5317fcdd21f2db8bb64\n+Subproject commit b62b1b68edcdf23a70cb12f31403c80e97f13634"}, {"sha": "b03e4f05641eed1d4d3bb1a0b0d6b5233fad60a2", "filename": "src/tools/toolstate.toml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/7778906bee9e8e93792353824548044a758b72f4/src%2Ftools%2Ftoolstate.toml", "raw_url": "https://github.com/rust-lang/rust/raw/7778906bee9e8e93792353824548044a758b72f4/src%2Ftools%2Ftoolstate.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftoolstate.toml?ref=7778906bee9e8e93792353824548044a758b72f4", "patch": "@@ -3,7 +3,7 @@\n #\n # There are three states a tool can be in:\n # 1. Broken: The tool doesn't build\n-# 2. Building: The tool builds but its tests are failing\n+# 2. Compiling: The tool builds but its tests are failing\n # 3. Testing: The tool builds and its tests are passing\n #\n # In the future there will be further states like \"Distributing\", which\n@@ -26,7 +26,7 @@\n miri = \"Broken\"\n \n # ping @Manishearth @llogiq @mcarton @oli-obk\n-clippy = \"Broken\"\n+clippy = \"Compiling\"\n \n # ping @nrc\n rls = \"Testing\""}]}