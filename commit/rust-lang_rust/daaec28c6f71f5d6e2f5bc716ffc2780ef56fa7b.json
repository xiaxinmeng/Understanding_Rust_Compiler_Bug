{"sha": "daaec28c6f71f5d6e2f5bc716ffc2780ef56fa7b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRhYWVjMjhjNmY3MWY1ZDZlMmY1YmM3MTZmZmMyNzgwZWY1NmZhN2I=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-12-13T01:51:54Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-12-24T22:42:00Z"}, "message": "std: Move management of the exit code to std::os\n\nPreviously this functionality was located in std::rt::util, but there's no real\nreason for it to be located in there.", "tree": {"sha": "91464a4a2283aaf580ff102ffebf074ff78ec23e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/91464a4a2283aaf580ff102ffebf074ff78ec23e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/daaec28c6f71f5d6e2f5bc716ffc2780ef56fa7b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/daaec28c6f71f5d6e2f5bc716ffc2780ef56fa7b", "html_url": "https://github.com/rust-lang/rust/commit/daaec28c6f71f5d6e2f5bc716ffc2780ef56fa7b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/daaec28c6f71f5d6e2f5bc716ffc2780ef56fa7b/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "429313de69cb2ddd1f076017968d1862ef02b455", "url": "https://api.github.com/repos/rust-lang/rust/commits/429313de69cb2ddd1f076017968d1862ef02b455", "html_url": "https://github.com/rust-lang/rust/commit/429313de69cb2ddd1f076017968d1862ef02b455"}], "stats": {"total": 20, "additions": 15, "deletions": 5}, "files": [{"sha": "43a9390bfb6481c21bced5aa9f2568932018cf15", "filename": "src/libstd/os.rs", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/daaec28c6f71f5d6e2f5bc716ffc2780ef56fa7b/src%2Flibstd%2Fos.rs", "raw_url": "https://github.com/rust-lang/rust/raw/daaec28c6f71f5d6e2f5bc716ffc2780ef56fa7b/src%2Flibstd%2Fos.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fos.rs?ref=daaec28c6f71f5d6e2f5bc716ffc2780ef56fa7b", "patch": "@@ -28,8 +28,6 @@\n \n #[allow(missing_doc)];\n \n-#[cfg(unix)]\n-use c_str::CString;\n use clone::Clone;\n use container::Container;\n #[cfg(target_os = \"macos\")]\n@@ -43,6 +41,7 @@ use ptr;\n use str;\n use to_str;\n use unstable::finally::Finally;\n+use sync::atomics::{AtomicInt, INIT_ATOMIC_INT, SeqCst};\n \n pub use os::consts::*;\n \n@@ -58,6 +57,8 @@ static BUF_BYTES : uint = 2048u;\n \n #[cfg(unix)]\n pub fn getcwd() -> Path {\n+    use c_str::CString;\n+\n     let mut buf = [0 as libc::c_char, ..BUF_BYTES];\n     unsafe {\n         if libc::getcwd(buf.as_mut_ptr(), buf.len() as size_t).is_null() {\n@@ -675,17 +676,26 @@ pub fn last_os_error() -> ~str {\n     strerror()\n }\n \n+static mut EXIT_STATUS: AtomicInt = INIT_ATOMIC_INT;\n+\n /**\n  * Sets the process exit code\n  *\n  * Sets the exit code returned by the process if all supervised tasks\n  * terminate successfully (without failing). If the current root task fails\n  * and is supervised by the scheduler then any user-specified exit status is\n- * ignored and the process exits with the default failure status\n+ * ignored and the process exits with the default failure status.\n+ *\n+ * Note that this is not synchronized against modifications of other threads.\n  */\n pub fn set_exit_status(code: int) {\n-    use rt;\n-    rt::set_exit_status(code);\n+    unsafe { EXIT_STATUS.store(code, SeqCst) }\n+}\n+\n+/// Fetches the process's current exit code. This defaults to 0 and can change\n+/// by calling `set_exit_status`.\n+pub fn get_exit_status() -> int {\n+    unsafe { EXIT_STATUS.load(SeqCst) }\n }\n \n #[cfg(target_os = \"macos\")]"}]}