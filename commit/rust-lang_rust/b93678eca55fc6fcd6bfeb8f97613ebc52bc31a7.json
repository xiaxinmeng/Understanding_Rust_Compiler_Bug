{"sha": "b93678eca55fc6fcd6bfeb8f97613ebc52bc31a7", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5MzY3OGVjYTU1ZmM2ZmNkNmJmZWI4Zjk3NjEzZWJjNTJiYzMxYTc=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-09-27T18:06:07Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2013-09-27T18:06:07Z"}, "message": "rustdoc: Fix search for something on the same page", "tree": {"sha": "2e76db371295a692d8deecb1dbf67cbc4cab3c9b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2e76db371295a692d8deecb1dbf67cbc4cab3c9b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b93678eca55fc6fcd6bfeb8f97613ebc52bc31a7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b93678eca55fc6fcd6bfeb8f97613ebc52bc31a7", "html_url": "https://github.com/rust-lang/rust/commit/b93678eca55fc6fcd6bfeb8f97613ebc52bc31a7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b93678eca55fc6fcd6bfeb8f97613ebc52bc31a7/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a925762c3b1c1f7b3a272b7294c0ec9b4eb4fb6d", "url": "https://api.github.com/repos/rust-lang/rust/commits/a925762c3b1c1f7b3a272b7294c0ec9b4eb4fb6d", "html_url": "https://github.com/rust-lang/rust/commit/a925762c3b1c1f7b3a272b7294c0ec9b4eb4fb6d"}], "stats": {"total": 27, "additions": 20, "deletions": 7}, "files": [{"sha": "ac3e8a07d46eab74bdae9dfc42183cb5bcc776a4", "filename": "src/librustdoc/html/layout.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b93678eca55fc6fcd6bfeb8f97613ebc52bc31a7/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b93678eca55fc6fcd6bfeb8f97613ebc52bc31a7/src%2Flibrustdoc%2Fhtml%2Flayout.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Flayout.rs?ref=b93678eca55fc6fcd6bfeb8f97613ebc52bc31a7", "patch": "@@ -66,7 +66,8 @@ pub fn render<T: fmt::Default, S: fmt::Default>(\n         </form>\n     </nav>\n \n-    <section class=\\\"content {ty}\\\">{content}</section>\n+    <section id='main' class=\\\"content {ty}\\\">{content}</section>\n+    <section id='search' class=\\\"content hidden\\\">{content}</section>\n \n     <section class=\\\"footer\\\"></section>\n "}, {"sha": "bf9e9ac8027b9113503905d4f9f40b9b86755a58", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 18, "deletions": 6, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/b93678eca55fc6fcd6bfeb8f97613ebc52bc31a7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/b93678eca55fc6fcd6bfeb8f97613ebc52bc31a7/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=b93678eca55fc6fcd6bfeb8f97613ebc52bc31a7", "patch": "@@ -39,9 +39,15 @@\n         if (e.keyCode === 188 && $('#help').hasClass('hidden')) { // question mark\n             e.preventDefault();\n             $('#help').removeClass('hidden');\n-        } else if (e.keyCode === 27 && !$('#help').hasClass('hidden')) { // esc\n-            e.preventDefault();\n-            $('#help').addClass('hidden');\n+        } else if (e.keyCode === 27) { // esc\n+            if (!$('#help').hasClass('hidden')) {\n+                e.preventDefault();\n+                $('#help').addClass('hidden');\n+            } else if (!$('#search').hasClass('hidden')) {\n+                e.preventDefault();\n+                $('#search').addClass('hidden');\n+                $('#main').removeClass('hidden');\n+            }\n         } else if (e.keyCode === 83) { // S\n             e.preventDefault();\n             $('.search-input').focus();\n@@ -202,7 +208,13 @@\n             var hoverTimeout, $results = $('.search-results .result');\n \n             $results.on('click', function () {\n-                document.location.href = $(this).find('a').prop('href');\n+                var dst = $(this).find('a')[0];\n+                console.log(window.location.pathname, dst.pathname);\n+                if (window.location.pathname == dst.pathname) {\n+                    $('#search').addClass('hidden');\n+                    $('#main').removeClass('hidden');\n+                }\n+                document.location.href = dst.href;\n             }).on('mouseover', function () {\n                 var $el = $(this);\n                 clearTimeout(hoverTimeout);\n@@ -277,7 +289,6 @@\n                                             '/index.html\" class=\"' + type +\n                                             '\">' + name + '</a>';\n                     } else if (item.parent !== undefined) {\n-                        console.log(item);\n                         var myparent = allPaths[item.parent];\n                         var anchor = '#' + type + '.' + name;\n                         output += item.path + '::' + myparent.name +\n@@ -308,7 +319,8 @@\n             }\n \n             output += \"</p>\";\n-            $('.content').html(output);\n+            $('#main.content').addClass('hidden');\n+            $('#search.content').removeClass('hidden').html(output);\n             $('.search-results .desc').width($('.content').width() - 40 -\n                     $('.content td:first-child').first().width());\n             initSearchNav();"}]}