{"sha": "5e43ea96aad65fbaae5806ea6732ab59977ede1c", "node_id": "C_kwDOAAsO6NoAKDVlNDNlYTk2YWFkNjVmYmFhZTU4MDZlYTY3MzJhYjU5OTc3ZWRlMWM", "commit": {"author": {"name": "Ryo Yoshida", "email": "low.ryoshida@gmail.com", "date": "2022-10-10T10:32:24Z"}, "committer": {"name": "Ryo Yoshida", "email": "low.ryoshida@gmail.com", "date": "2022-10-11T11:26:11Z"}, "message": "fix: reorder dyn bounds on render", "tree": {"sha": "e19421e738a1f76473a2e785b0574f8b8e04874d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e19421e738a1f76473a2e785b0574f8b8e04874d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5e43ea96aad65fbaae5806ea6732ab59977ede1c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEkSbsQIURluxz4rzf4laYqTBYYXEFAmNFUtMACgkQ4laYqTBY\nYXHhzw//etGEgQgJ5wG0ZAa3E/kIQjNsNwfyu2+4Q7U0t7TY1pPJXffPAl0on8C6\nD5fMk2Tx/3Zoe+kyRFiFyLBVzoFSJr+d0Pt2GOZk6Mtn/sbrb1ad9LUZMsm2dMKG\n6kfmbzGf7yupVCXwl1pzqP5BRvR80s2AwCKMkcqFf5Ec5/vSLYlltdQ5bb/VubhA\nzXJL5hRnojRVM8t1dgKhPX3eqZILlRwO0L+6uZXMbcCvyaMbN5+lo3pl1RvnlzAc\ncOCiFepXNYqjWjhJHwG1L3sgR0IFCD5kdbgXaHyqX4zzlu88oY22T3P4NMns2F8a\nTeb6xjq/gFwvnFGncroPNvLs4/V3V+8KzluMBnE6crFQlQd6lYM4GthFwu1fom8O\nl2K3xGQ3DQyD71n9bF1yohevFZe9z71xtVxJXpYHzFPN+kXCCumuLTKYH0HcOzC4\nXO5eyn0i1B5trG3ZfWUidYUoD7nGTT4RVv9JeLM5OV4xxZ4Mn0jSjbRofqKvEPNF\nemmSKNqdxw8C5x95U9aPnnXWGJsErRJMEtFbu9r8GKKw4rg2UqKPvPIIVkJYajFv\nc57mcrVH3F37VbnjGO086S7SiPBETf5XGxgnactfkwmUHFtJlJASqGzRndoczarJ\n/oOJESqDN+7tgojOOFqA5QQ4fmu1GpkiFJV4wT5RagVgww/mscE=\n=Us4K\n-----END PGP SIGNATURE-----", "payload": "tree e19421e738a1f76473a2e785b0574f8b8e04874d\nparent 3a69435af7a1e6273744085cb251adb2b9c30a03\nauthor Ryo Yoshida <low.ryoshida@gmail.com> 1665397944 +0900\ncommitter Ryo Yoshida <low.ryoshida@gmail.com> 1665487571 +0900\n\nfix: reorder dyn bounds on render\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5e43ea96aad65fbaae5806ea6732ab59977ede1c", "html_url": "https://github.com/rust-lang/rust/commit/5e43ea96aad65fbaae5806ea6732ab59977ede1c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5e43ea96aad65fbaae5806ea6732ab59977ede1c/comments", "author": {"login": "lowr", "id": 24381114, "node_id": "MDQ6VXNlcjI0MzgxMTE0", "avatar_url": "https://avatars.githubusercontent.com/u/24381114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lowr", "html_url": "https://github.com/lowr", "followers_url": "https://api.github.com/users/lowr/followers", "following_url": "https://api.github.com/users/lowr/following{/other_user}", "gists_url": "https://api.github.com/users/lowr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lowr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lowr/subscriptions", "organizations_url": "https://api.github.com/users/lowr/orgs", "repos_url": "https://api.github.com/users/lowr/repos", "events_url": "https://api.github.com/users/lowr/events{/privacy}", "received_events_url": "https://api.github.com/users/lowr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lowr", "id": 24381114, "node_id": "MDQ6VXNlcjI0MzgxMTE0", "avatar_url": "https://avatars.githubusercontent.com/u/24381114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lowr", "html_url": "https://github.com/lowr", "followers_url": "https://api.github.com/users/lowr/followers", "following_url": "https://api.github.com/users/lowr/following{/other_user}", "gists_url": "https://api.github.com/users/lowr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lowr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lowr/subscriptions", "organizations_url": "https://api.github.com/users/lowr/orgs", "repos_url": "https://api.github.com/users/lowr/repos", "events_url": "https://api.github.com/users/lowr/events{/privacy}", "received_events_url": "https://api.github.com/users/lowr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3a69435af7a1e6273744085cb251adb2b9c30a03", "url": "https://api.github.com/repos/rust-lang/rust/commits/3a69435af7a1e6273744085cb251adb2b9c30a03", "html_url": "https://github.com/rust-lang/rust/commit/3a69435af7a1e6273744085cb251adb2b9c30a03"}], "stats": {"total": 34, "additions": 33, "deletions": 1}, "files": [{"sha": "a6602747ef799a078ce02e6e9f2b162ddc81a3a1", "filename": "crates/hir-ty/src/display.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/5e43ea96aad65fbaae5806ea6732ab59977ede1c/crates%2Fhir-ty%2Fsrc%2Fdisplay.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e43ea96aad65fbaae5806ea6732ab59977ede1c/crates%2Fhir-ty%2Fsrc%2Fdisplay.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-ty%2Fsrc%2Fdisplay.rs?ref=5e43ea96aad65fbaae5806ea6732ab59977ede1c", "patch": "@@ -751,9 +751,19 @@ impl HirDisplay for Ty {\n             }\n             TyKind::BoundVar(idx) => idx.hir_fmt(f)?,\n             TyKind::Dyn(dyn_ty) => {\n+                // Reorder bounds to satisfy `write_bounds_like_dyn_trait()`'s expectation.\n+                // FIXME: `Iterator::partition_in_place()` or `Vec::drain_filter()` may make it\n+                // more efficient when either of them hits stable.\n+                let mut bounds: SmallVec<[_; 4]> =\n+                    dyn_ty.bounds.skip_binders().iter(Interner).cloned().collect();\n+                let (auto_traits, others): (SmallVec<[_; 4]>, _) =\n+                    bounds.drain(1..).partition(|b| b.skip_binders().trait_id().is_some());\n+                bounds.extend(others);\n+                bounds.extend(auto_traits);\n+\n                 write_bounds_like_dyn_trait_with_prefix(\n                     \"dyn\",\n-                    dyn_ty.bounds.skip_binders().interned(),\n+                    &bounds,\n                     SizedByDefault::NotSized,\n                     f,\n                 )?;"}, {"sha": "8a8ff08cfe8cdab81a7250bdd273175ec3a47179", "filename": "crates/hir-ty/src/tests/display_source_code.rs", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/5e43ea96aad65fbaae5806ea6732ab59977ede1c/crates%2Fhir-ty%2Fsrc%2Ftests%2Fdisplay_source_code.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e43ea96aad65fbaae5806ea6732ab59977ede1c/crates%2Fhir-ty%2Fsrc%2Ftests%2Fdisplay_source_code.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir-ty%2Fsrc%2Ftests%2Fdisplay_source_code.rs?ref=5e43ea96aad65fbaae5806ea6732ab59977ede1c", "patch": "@@ -55,6 +55,28 @@ fn main() {\n     );\n }\n \n+#[test]\n+fn render_dyn_ty_independent_of_order() {\n+    check_types_source_code(\n+        r#\"\n+auto trait Send {}\n+trait A {\n+    type Assoc;\n+}\n+trait B: A {}\n+\n+fn test(\n+    _: &(dyn A<Assoc = ()> + Send),\n+  //^ &(dyn A<Assoc = ()> + Send)\n+    _: &(dyn Send + A<Assoc = ()>),\n+  //^ &(dyn A<Assoc = ()> + Send)\n+    _: &dyn B<Assoc = ()>,\n+  //^ &(dyn B<Assoc = ()>)\n+) {}\n+        \"#,\n+    );\n+}\n+\n #[test]\n fn render_dyn_for_ty() {\n     // FIXME"}]}