{"sha": "e3204c528b44ef676362d6fc27a72cac868dfbdb", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUzMjA0YzUyOGI0NGVmNjc2MzYyZDZmYzI3YTcyY2FjODY4ZGZiZGI=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-01-27T13:26:18Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-01-27T13:26:18Z"}, "message": "Merge #7464\n\n7464: Export `CARGO` for proc. macros r=jonas-schievink a=jonas-schievink\n\nFixes https://github.com/rust-analyzer/rust-analyzer/issues/7462\r\n\r\nbors r+\n\nCo-authored-by: Jonas Schievink <jonasschievink@gmail.com>", "tree": {"sha": "787bb42b245b3fca4efa72c9c5c1359ecc86627e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/787bb42b245b3fca4efa72c9c5c1359ecc86627e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e3204c528b44ef676362d6fc27a72cac868dfbdb", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgEWn6CRBK7hj4Ov3rIwAAdHIIAEO/PpDwxyw/aqHx0KIWr2rO\nL7kHAINfnAXw8LcDVkK4BgoVDVHu5SVIuL+nYA89EOWv3XrNuBMPnU1h+ppZaBkq\nJ3svt29fPgv6cuBfIpNur1HzBuup+AkZXq2bKrOg4SMOs5b6/ShJ9HgPLs9kF2g7\ndZ3sTgUAzbOXPyJQRAwHSZjiTb+ZSgjlxWvQezWuqR9LRgtosM6Mpxx+hxtATHFu\nfnVzyN+ueDN9tX/NwVmf5Fbldll7WN8jIaBZVznOHsRQOrpEfzhdX5z7xfzb+vYK\nWh5YZFjm6s8ND5aHvBopdiyc/rtDjAXTpnNaFEl/hImt8emZKko0B8By8HsbiXY=\n=u5ce\n-----END PGP SIGNATURE-----\n", "payload": "tree 787bb42b245b3fca4efa72c9c5c1359ecc86627e\nparent 6a6a80eb1fba0f9d206f9384ecb78bf4ac87691e\nparent 481a74eda7d004ec4a9992834d098fc0280d2a36\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1611753978 +0000\ncommitter GitHub <noreply@github.com> 1611753978 +0000\n\nMerge #7464\n\n7464: Export `CARGO` for proc. macros r=jonas-schievink a=jonas-schievink\n\nFixes https://github.com/rust-analyzer/rust-analyzer/issues/7462\r\n\r\nbors r+\n\nCo-authored-by: Jonas Schievink <jonasschievink@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e3204c528b44ef676362d6fc27a72cac868dfbdb", "html_url": "https://github.com/rust-lang/rust/commit/e3204c528b44ef676362d6fc27a72cac868dfbdb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e3204c528b44ef676362d6fc27a72cac868dfbdb/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6a6a80eb1fba0f9d206f9384ecb78bf4ac87691e", "url": "https://api.github.com/repos/rust-lang/rust/commits/6a6a80eb1fba0f9d206f9384ecb78bf4ac87691e", "html_url": "https://github.com/rust-lang/rust/commit/6a6a80eb1fba0f9d206f9384ecb78bf4ac87691e"}, {"sha": "481a74eda7d004ec4a9992834d098fc0280d2a36", "url": "https://api.github.com/repos/rust-lang/rust/commits/481a74eda7d004ec4a9992834d098fc0280d2a36", "html_url": "https://github.com/rust-lang/rust/commit/481a74eda7d004ec4a9992834d098fc0280d2a36"}], "stats": {"total": 5, "additions": 4, "deletions": 1}, "files": [{"sha": "3ff347e2c2e6260d912ede1a0f19971e3e88c2f0", "filename": "crates/project_model/src/build_data.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e3204c528b44ef676362d6fc27a72cac868dfbdb/crates%2Fproject_model%2Fsrc%2Fbuild_data.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e3204c528b44ef676362d6fc27a72cac868dfbdb/crates%2Fproject_model%2Fsrc%2Fbuild_data.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fproject_model%2Fsrc%2Fbuild_data.rs?ref=e3204c528b44ef676362d6fc27a72cac868dfbdb", "patch": "@@ -175,14 +175,17 @@ fn is_dylib(path: &Path) -> bool {\n /// Should be synced with <https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-sets-for-crates>\n fn inject_cargo_env(package: &cargo_metadata::Package, env: &mut Vec<(String, String)>) {\n     // FIXME: Missing variables:\n-    // CARGO, CARGO_PKG_HOMEPAGE, CARGO_CRATE_NAME, CARGO_BIN_NAME, CARGO_BIN_EXE_<name>\n+    // CARGO_PKG_HOMEPAGE, CARGO_CRATE_NAME, CARGO_BIN_NAME, CARGO_BIN_EXE_<name>\n \n     let mut manifest_dir = package.manifest_path.clone();\n     manifest_dir.pop();\n     if let Some(cargo_manifest_dir) = manifest_dir.to_str() {\n         env.push((\"CARGO_MANIFEST_DIR\".into(), cargo_manifest_dir.into()));\n     }\n \n+    // Not always right, but works for common cases.\n+    env.push((\"CARGO\".into(), \"cargo\".into()));\n+\n     env.push((\"CARGO_PKG_VERSION\".into(), package.version.to_string()));\n     env.push((\"CARGO_PKG_VERSION_MAJOR\".into(), package.version.major.to_string()));\n     env.push((\"CARGO_PKG_VERSION_MINOR\".into(), package.version.minor.to_string()));"}]}