{"sha": "2278814c8e33573b1c870c65f5fcbe69ea20601d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIyNzg4MTRjOGUzMzU3M2IxYzg3MGM2NWY1ZmNiZTY5ZWEyMDYwMWQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-10T20:57:15Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-04-10T20:57:15Z"}, "message": "Auto merge of #3931 - phansch:3891, r=flip1995\n\nFix ICE in decimal_literal_representation lint\n\nHandling the integer parsing properly instead of just unwrapping.\n\nNote that the test is not catching the ICE because plain UI tests\n[currently hide ICEs][compiletest_issue]. Once that issue is fixed, this\ntest would fail properly again.\n\nFixes #3891\n\n[compiletest_issue]: https://github.com/laumann/compiletest-rs/issues/169", "tree": {"sha": "eca8b4e44cf4d4025182feab626389b89da39460", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eca8b4e44cf4d4025182feab626389b89da39460"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2278814c8e33573b1c870c65f5fcbe69ea20601d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2278814c8e33573b1c870c65f5fcbe69ea20601d", "html_url": "https://github.com/rust-lang/rust/commit/2278814c8e33573b1c870c65f5fcbe69ea20601d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2278814c8e33573b1c870c65f5fcbe69ea20601d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3efc3e2455f1ebb7f74239c3398bae872ce0549e", "url": "https://api.github.com/repos/rust-lang/rust/commits/3efc3e2455f1ebb7f74239c3398bae872ce0549e", "html_url": "https://github.com/rust-lang/rust/commit/3efc3e2455f1ebb7f74239c3398bae872ce0549e"}, {"sha": "ab6b949224a4704641e7c9d24163b9b99d3b47ea", "url": "https://api.github.com/repos/rust-lang/rust/commits/ab6b949224a4704641e7c9d24163b9b99d3b47ea", "html_url": "https://github.com/rust-lang/rust/commit/ab6b949224a4704641e7c9d24163b9b99d3b47ea"}], "stats": {"total": 46, "additions": 29, "deletions": 17}, "files": [{"sha": "64214e3be8651550e53ff2043263818d6bb15e3a", "filename": "ci/base-tests.sh", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2278814c8e33573b1c870c65f5fcbe69ea20601d/ci%2Fbase-tests.sh", "raw_url": "https://github.com/rust-lang/rust/raw/2278814c8e33573b1c870c65f5fcbe69ea20601d/ci%2Fbase-tests.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/ci%2Fbase-tests.sh?ref=2278814c8e33573b1c870c65f5fcbe69ea20601d", "patch": "@@ -59,7 +59,9 @@ rustup override set nightly\n # avoid loop spam and allow cmds with exit status != 0\n set +ex\n \n-for file in `find tests | grep \"\\.rs$\"` ; do\n+# Excluding `ice-3891.rs` because the code triggers a rustc parse error which\n+# makes rustfmt fail.\n+for file in `find tests -not -path \"tests/ui/crashes/ice-3891.rs\" | grep \"\\.rs$\"` ; do\n   rustfmt ${file} --check\n   if [ $? -ne 0 ]; then\n     echo \"${file} needs reformatting!\""}, {"sha": "e97845314f9d4b075465c42c273b4af3c5196065", "filename": "clippy_lints/src/literal_representation.rs", "status": "modified", "additions": 13, "deletions": 16, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/2278814c8e33573b1c870c65f5fcbe69ea20601d/clippy_lints%2Fsrc%2Fliteral_representation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2278814c8e33573b1c870c65f5fcbe69ea20601d/clippy_lints%2Fsrc%2Fliteral_representation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fliteral_representation.rs?ref=2278814c8e33573b1c870c65f5fcbe69ea20601d", "patch": "@@ -526,23 +526,20 @@ impl LiteralRepresentation {\n             if let Some(src) = snippet_opt(cx, lit.span);\n             if let Some(firstch) = src.chars().next();\n             if char::to_digit(firstch, 10).is_some();\n+            let digit_info = DigitInfo::new(&src, false);\n+            if digit_info.radix == Radix::Decimal;\n+            if let Ok(val) = digit_info.digits\n+                .chars()\n+                .filter(|&c| c != '_')\n+                .collect::<String>()\n+                .parse::<u128>();\n+            if val >= u128::from(self.threshold);\n             then {\n-                let digit_info = DigitInfo::new(&src, false);\n-                if digit_info.radix == Radix::Decimal {\n-                    let val = digit_info.digits\n-                        .chars()\n-                        .filter(|&c| c != '_')\n-                        .collect::<String>()\n-                        .parse::<u128>().unwrap();\n-                    if val < u128::from(self.threshold) {\n-                        return\n-                    }\n-                    let hex = format!(\"{:#X}\", val);\n-                    let digit_info = DigitInfo::new(&hex[..], false);\n-                    let _ = Self::do_lint(digit_info.digits).map_err(|warning_type| {\n-                        warning_type.display(&digit_info.grouping_hint(), cx, lit.span)\n-                    });\n-                }\n+                let hex = format!(\"{:#X}\", val);\n+                let digit_info = DigitInfo::new(&hex, false);\n+                let _ = Self::do_lint(digit_info.digits).map_err(|warning_type| {\n+                    warning_type.display(&digit_info.grouping_hint(), cx, lit.span)\n+                });\n             }\n         }\n     }"}, {"sha": "05c5134c8457b4f2564b99eff0aa4353f773cbcd", "filename": "tests/ui/crashes/ice-3891.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2278814c8e33573b1c870c65f5fcbe69ea20601d/tests%2Fui%2Fcrashes%2Fice-3891.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2278814c8e33573b1c870c65f5fcbe69ea20601d/tests%2Fui%2Fcrashes%2Fice-3891.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcrashes%2Fice-3891.rs?ref=2278814c8e33573b1c870c65f5fcbe69ea20601d", "patch": "@@ -0,0 +1,3 @@\n+fn main() {\n+    1x;\n+}"}, {"sha": "16aedbd98dec30c6fa7c6efa4974e397847fbbf7", "filename": "tests/ui/crashes/ice-3891.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/2278814c8e33573b1c870c65f5fcbe69ea20601d/tests%2Fui%2Fcrashes%2Fice-3891.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2278814c8e33573b1c870c65f5fcbe69ea20601d/tests%2Fui%2Fcrashes%2Fice-3891.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcrashes%2Fice-3891.stderr?ref=2278814c8e33573b1c870c65f5fcbe69ea20601d", "patch": "@@ -0,0 +1,10 @@\n+error: invalid suffix `x` for numeric literal\n+  --> $DIR/ice-3891.rs:2:5\n+   |\n+LL |     1x;\n+   |     ^^ invalid suffix `x`\n+   |\n+   = help: the suffix must be one of the integral types (`u32`, `isize`, etc)\n+\n+error: aborting due to previous error\n+"}]}