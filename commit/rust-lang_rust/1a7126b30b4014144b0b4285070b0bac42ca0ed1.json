{"sha": "1a7126b30b4014144b0b4285070b0bac42ca0ed1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFhNzEyNmIzMGI0MDE0MTQ0YjBiNDI4NTA3MGIwYmFjNDJjYTBlZDE=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-02-15T20:45:38Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-02-23T10:13:35Z"}, "message": "Add full test for rustdoc map file", "tree": {"sha": "96204f5f0bd0f8a8a7991133c256adc28df453b5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/96204f5f0bd0f8a8a7991133c256adc28df453b5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1a7126b30b4014144b0b4285070b0bac42ca0ed1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1a7126b30b4014144b0b4285070b0bac42ca0ed1", "html_url": "https://github.com/rust-lang/rust/commit/1a7126b30b4014144b0b4285070b0bac42ca0ed1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1a7126b30b4014144b0b4285070b0bac42ca0ed1/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2b59e7667de6f63391d9cc390c6e9cd3559380e1", "url": "https://api.github.com/repos/rust-lang/rust/commits/2b59e7667de6f63391d9cc390c6e9cd3559380e1", "html_url": "https://github.com/rust-lang/rust/commit/2b59e7667de6f63391d9cc390c6e9cd3559380e1"}], "stats": {"total": 67, "additions": 67, "deletions": 0}, "files": [{"sha": "ce977fa0cea55050ca384c89f3ba583bc5325a06", "filename": "src/test/run-make-fulldeps/rustdoc-map-file/Makefile", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/1a7126b30b4014144b0b4285070b0bac42ca0ed1/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-map-file%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/1a7126b30b4014144b0b4285070b0bac42ca0ed1/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-map-file%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-map-file%2FMakefile?ref=1a7126b30b4014144b0b4285070b0bac42ca0ed1", "patch": "@@ -0,0 +1,5 @@\n+-include ../tools.mk\n+\n+all:\n+\t$(RUSTDOC) -Z unstable-options --generate-redirect-map foo.rs -o \"$(TMPDIR)/out\"\n+\t\"$(PYTHON)\" validate_json.py \"$(TMPDIR)/out\""}, {"sha": "6b1ccbeac3010849dde4231d550c141f9532ae88", "filename": "src/test/run-make-fulldeps/rustdoc-map-file/expected.json", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/1a7126b30b4014144b0b4285070b0bac42ca0ed1/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-map-file%2Fexpected.json", "raw_url": "https://github.com/rust-lang/rust/raw/1a7126b30b4014144b0b4285070b0bac42ca0ed1/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-map-file%2Fexpected.json", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-map-file%2Fexpected.json?ref=1a7126b30b4014144b0b4285070b0bac42ca0ed1", "patch": "@@ -0,0 +1,5 @@\n+{\n+  \"foo/macro.foo!.html\": \"foo/macro.foo.html\",\n+  \"foo/private/struct.Quz.html\": \"foo/struct.Quz.html\",\n+  \"foo/hidden/struct.Bar.html\": \"foo/struct.Bar.html\"\n+}"}, {"sha": "e12b9d2292c5110d3d1bb3f3e197ffd13f94aa56", "filename": "src/test/run-make-fulldeps/rustdoc-map-file/foo.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/1a7126b30b4014144b0b4285070b0bac42ca0ed1/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-map-file%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a7126b30b4014144b0b4285070b0bac42ca0ed1/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-map-file%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-map-file%2Ffoo.rs?ref=1a7126b30b4014144b0b4285070b0bac42ca0ed1", "patch": "@@ -0,0 +1,16 @@\n+pub use private::Quz;\n+pub use hidden::Bar;\n+\n+mod private {\n+    pub struct Quz;\n+}\n+\n+#[doc(hidden)]\n+pub mod hidden {\n+    pub struct Bar;\n+}\n+\n+#[macro_export]\n+macro_rules! foo {\n+    () => {}\n+}"}, {"sha": "5c14c90b70d37d899f1f9d9c8d65c94d185d80e1", "filename": "src/test/run-make-fulldeps/rustdoc-map-file/validate_json.py", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/1a7126b30b4014144b0b4285070b0bac42ca0ed1/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-map-file%2Fvalidate_json.py", "raw_url": "https://github.com/rust-lang/rust/raw/1a7126b30b4014144b0b4285070b0bac42ca0ed1/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-map-file%2Fvalidate_json.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Frustdoc-map-file%2Fvalidate_json.py?ref=1a7126b30b4014144b0b4285070b0bac42ca0ed1", "patch": "@@ -0,0 +1,41 @@\n+#!/usr/bin/env python\n+\n+import os\n+import sys\n+import json\n+\n+\n+def find_redirect_map_file(folder, errors):\n+    for root, dirs, files in os.walk(folder):\n+        for name in files:\n+            if not name.endswith(\"redirect-map.json\"):\n+                continue\n+            with open(os.path.join(root, name)) as f:\n+                data = json.load(f)\n+            with open(\"expected.json\") as f:\n+                expected = json.load(f)\n+            for key in expected:\n+                if expected[key] != data.get(key):\n+                    errors.append(\"Expected `{}` for key `{}`, found: `{}`\".format(\n+                        expected[key], key, data.get(key)))\n+                else:\n+                    del data[key]\n+            for key in data:\n+                errors.append(\"Extra data not expected: key: `{}`, data: `{}`\".format(\n+                    key, data[key]))\n+            return True\n+    return False\n+\n+\n+if len(sys.argv) != 2:\n+    print(\"Expected doc directory to check!\")\n+    sys.exit(1)\n+\n+errors = []\n+if not find_redirect_map_file(sys.argv[1], errors):\n+    print(\"Didn't find the map file in `{}`...\".format(sys.argv[1]))\n+    sys.exit(1)\n+for err in errors:\n+    print(\"=> {}\".format(err))\n+if len(errors) != 0:\n+    sys.exit(1)"}]}