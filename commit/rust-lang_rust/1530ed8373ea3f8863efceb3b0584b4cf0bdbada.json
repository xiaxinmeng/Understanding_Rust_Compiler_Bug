{"sha": "1530ed8373ea3f8863efceb3b0584b4cf0bdbada", "node_id": "C_kwDOAAsO6NoAKDE1MzBlZDgzNzNlYTNmODg2M2VmY2ViM2IwNTg0YjRjZjBiZGJhZGE", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-08-01T14:49:30Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-08-01T14:49:30Z"}, "message": "Rollup merge of #99864 - klensy:bootstrap-art-dupe, r=jyn514\n\nbootstrap: don't emit warn about duplicated deps with same/different features if some of sets actually empty\n\nExample (https://github.com/rust-lang-ci/rust/runs/7551453940?check_suite_focus=true#step:25:15008):\n```\n duplicate artifacts found when compiling a tool, this typically means that something was recompiled because a transitive dependency has different features activated than in a previous build:\n\nthe following dependencies are duplicated although they have the same features enabled:\nthe following dependencies have different features:\n  memchr 2.5.0 (registry+https://github.com/rust-lang/crates.io-index)\n    `clippy-driver` additionally enabled features {} at \"/checkout/obj/build/x86_64-unknown-linux-gnu/stage1-tools/x86_64-unknown-freebsd/release/deps/libmemchr-44aa6ff4f08e293f.rlib\"\n    `cargo` additionally enabled features {\"use_std\"} at \"/checkout/obj/build/x86_64-unknown-linux-gnu/stage1-tools/x86_64-unknown-freebsd/release/deps/libmemchr-70e29af0fd3ef292.rlib\"\n```\n\nNotice that no info printed under  `the following dependencies are duplicated although they have the same features enabled:`", "tree": {"sha": "5be79edd3ed0d4b8f57fdf9fe2e02c70868e76f6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5be79edd3ed0d4b8f57fdf9fe2e02c70868e76f6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1530ed8373ea3f8863efceb3b0584b4cf0bdbada", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi5+f6CRBK7hj4Ov3rIwAAKdoIAIdw8J3W1vJlIqibOKoAQFGZ\nS6FwXKwVGLxikDjoP+tTmVwweqfP/YTLfTiLLbUReCpsYDUcIl51odLJDk6olRWN\n0FD7gw4KNCRuxKmfXO7HETbv9588557O6zoDEbgzDFoaEBxRI9UC7hgySvZaEUAD\nK7MYr737OhbysXIZ2hCnlkiRZo9D0jv5u0KkIVY4F4rIWSmpW0LX4eYZJ5rIQsNV\ngafQIFMOlHTp5IENZC6yFNh/ohJ5UcBqsOLegiow26Xzs0zRX3n7YmXBLKomglYh\n3XFQ8rTOF2gCd6EwBne6tatyWZYlSHGJa9bNuhSOIfXm9L9Kk530M0TczZgcv2g=\n=gS3e\n-----END PGP SIGNATURE-----\n", "payload": "tree 5be79edd3ed0d4b8f57fdf9fe2e02c70868e76f6\nparent f9aa989eac08f0ef49453af696218336870647c8\nparent 339509494dabe8c8df14b591cd8761c6ce8ddfe7\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1659365370 +0200\ncommitter GitHub <noreply@github.com> 1659365370 +0200\n\nRollup merge of #99864 - klensy:bootstrap-art-dupe, r=jyn514\n\nbootstrap: don't emit warn about duplicated deps with same/different features if some of sets actually empty\n\nExample (https://github.com/rust-lang-ci/rust/runs/7551453940?check_suite_focus=true#step:25:15008):\n```\n duplicate artifacts found when compiling a tool, this typically means that something was recompiled because a transitive dependency has different features activated than in a previous build:\n\nthe following dependencies are duplicated although they have the same features enabled:\nthe following dependencies have different features:\n  memchr 2.5.0 (registry+https://github.com/rust-lang/crates.io-index)\n    `clippy-driver` additionally enabled features {} at \"/checkout/obj/build/x86_64-unknown-linux-gnu/stage1-tools/x86_64-unknown-freebsd/release/deps/libmemchr-44aa6ff4f08e293f.rlib\"\n    `cargo` additionally enabled features {\"use_std\"} at \"/checkout/obj/build/x86_64-unknown-linux-gnu/stage1-tools/x86_64-unknown-freebsd/release/deps/libmemchr-70e29af0fd3ef292.rlib\"\n```\n\nNotice that no info printed under  `the following dependencies are duplicated although they have the same features enabled:`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1530ed8373ea3f8863efceb3b0584b4cf0bdbada", "html_url": "https://github.com/rust-lang/rust/commit/1530ed8373ea3f8863efceb3b0584b4cf0bdbada", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1530ed8373ea3f8863efceb3b0584b4cf0bdbada/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f9aa989eac08f0ef49453af696218336870647c8", "url": "https://api.github.com/repos/rust-lang/rust/commits/f9aa989eac08f0ef49453af696218336870647c8", "html_url": "https://github.com/rust-lang/rust/commit/f9aa989eac08f0ef49453af696218336870647c8"}, {"sha": "339509494dabe8c8df14b591cd8761c6ce8ddfe7", "url": "https://api.github.com/repos/rust-lang/rust/commits/339509494dabe8c8df14b591cd8761c6ce8ddfe7", "html_url": "https://github.com/rust-lang/rust/commit/339509494dabe8c8df14b591cd8761c6ce8ddfe7"}], "stats": {"total": 52, "additions": 28, "deletions": 24}, "files": [{"sha": "06fa5039fdf9243cc4b5b62d7cdcd8381311699d", "filename": "src/bootstrap/tool.rs", "status": "modified", "additions": 28, "deletions": 24, "changes": 52, "blob_url": "https://github.com/rust-lang/rust/blob/1530ed8373ea3f8863efceb3b0584b4cf0bdbada/src%2Fbootstrap%2Ftool.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1530ed8373ea3f8863efceb3b0584b4cf0bdbada/src%2Fbootstrap%2Ftool.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftool.rs?ref=1530ed8373ea3f8863efceb3b0584b4cf0bdbada", "patch": "@@ -158,34 +158,38 @@ impl Step for ToolBuild {\n                       a transitive dependency has different features activated \\\n                       than in a previous build:\\n\"\n             );\n-            eprintln!(\n-                \"the following dependencies are duplicated although they \\\n-                      have the same features enabled:\"\n-            );\n             let (same, different): (Vec<_>, Vec<_>) =\n                 duplicates.into_iter().partition(|(_, cur, prev)| cur.2 == prev.2);\n-            for (id, cur, prev) in same {\n-                eprintln!(\"  {}\", id);\n-                // same features\n-                eprintln!(\"    `{}` ({:?})\\n    `{}` ({:?})\", cur.0, cur.1, prev.0, prev.1);\n-            }\n-            eprintln!(\"the following dependencies have different features:\");\n-            for (id, cur, prev) in different {\n-                eprintln!(\"  {}\", id);\n-                let cur_features: HashSet<_> = cur.2.into_iter().collect();\n-                let prev_features: HashSet<_> = prev.2.into_iter().collect();\n-                eprintln!(\n-                    \"    `{}` additionally enabled features {:?} at {:?}\",\n-                    cur.0,\n-                    &cur_features - &prev_features,\n-                    cur.1\n-                );\n+            if !same.is_empty() {\n                 eprintln!(\n-                    \"    `{}` additionally enabled features {:?} at {:?}\",\n-                    prev.0,\n-                    &prev_features - &cur_features,\n-                    prev.1\n+                    \"the following dependencies are duplicated although they \\\n+                      have the same features enabled:\"\n                 );\n+                for (id, cur, prev) in same {\n+                    eprintln!(\"  {}\", id);\n+                    // same features\n+                    eprintln!(\"    `{}` ({:?})\\n    `{}` ({:?})\", cur.0, cur.1, prev.0, prev.1);\n+                }\n+            }\n+            if !different.is_empty() {\n+                eprintln!(\"the following dependencies have different features:\");\n+                for (id, cur, prev) in different {\n+                    eprintln!(\"  {}\", id);\n+                    let cur_features: HashSet<_> = cur.2.into_iter().collect();\n+                    let prev_features: HashSet<_> = prev.2.into_iter().collect();\n+                    eprintln!(\n+                        \"    `{}` additionally enabled features {:?} at {:?}\",\n+                        cur.0,\n+                        &cur_features - &prev_features,\n+                        cur.1\n+                    );\n+                    eprintln!(\n+                        \"    `{}` additionally enabled features {:?} at {:?}\",\n+                        prev.0,\n+                        &prev_features - &cur_features,\n+                        prev.1\n+                    );\n+                }\n             }\n             eprintln!();\n             eprintln!("}]}