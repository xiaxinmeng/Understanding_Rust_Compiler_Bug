{"sha": "d4a32386f3b61a4997de54ed00c0a80fd07ecc75", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ0YTMyMzg2ZjNiNjFhNDk5N2RlNTRlZDAwYzBhODBmZDA3ZWNjNzU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-10-17T16:56:27Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-10-17T16:56:27Z"}, "message": "auto merge of #9907 : kballard/rust/vec_ends_with, r=alexcrichton", "tree": {"sha": "d766986b7eed566a705dd6f8fd135cb10614a881", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d766986b7eed566a705dd6f8fd135cb10614a881"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d4a32386f3b61a4997de54ed00c0a80fd07ecc75", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d4a32386f3b61a4997de54ed00c0a80fd07ecc75", "html_url": "https://github.com/rust-lang/rust/commit/d4a32386f3b61a4997de54ed00c0a80fd07ecc75", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d4a32386f3b61a4997de54ed00c0a80fd07ecc75/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2cb96a4eaf55cdf7f08e3493cf2953278b8acc43", "url": "https://api.github.com/repos/rust-lang/rust/commits/2cb96a4eaf55cdf7f08e3493cf2953278b8acc43", "html_url": "https://github.com/rust-lang/rust/commit/2cb96a4eaf55cdf7f08e3493cf2953278b8acc43"}, {"sha": "87a2d032ff6fe74e97348189f95a3a91fd9e228e", "url": "https://api.github.com/repos/rust-lang/rust/commits/87a2d032ff6fe74e97348189f95a3a91fd9e228e", "html_url": "https://github.com/rust-lang/rust/commit/87a2d032ff6fe74e97348189f95a3a91fd9e228e"}], "stats": {"total": 95, "additions": 59, "deletions": 36}, "files": [{"sha": "faf8dd25186f28165c0168f98c6ec369f77e8cce", "filename": "src/librustc/back/rpath.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d4a32386f3b61a4997de54ed00c0a80fd07ecc75/src%2Flibrustc%2Fback%2Frpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d4a32386f3b61a4997de54ed00c0a80fd07ecc75/src%2Flibrustc%2Fback%2Frpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fback%2Frpath.rs?ref=d4a32386f3b61a4997de54ed00c0a80fd07ecc75", "patch": "@@ -189,12 +189,9 @@ mod test {\n         let mut d = Path::new(env!(\"CFG_PREFIX\"));\n         d.push(\"lib/rustc/triple/lib\");\n         debug2!(\"test_prefix_path: {} vs. {}\",\n-               res.to_str(),\n+               res,\n                d.display());\n-        assert!(ends_with(res.as_bytes(), d.as_vec()));\n-        fn ends_with(v: &[u8], needle: &[u8]) -> bool {\n-            v.len() >= needle.len() && v.slice_from(v.len()-needle.len()) == needle\n-        }\n+        assert!(res.as_bytes().ends_with(d.as_vec()));\n     }\n \n     #[test]"}, {"sha": "0fe168625187a3fdae3b1fde2d230590f17689cd", "filename": "src/librustpkg/tests.rs", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d4a32386f3b61a4997de54ed00c0a80fd07ecc75/src%2Flibrustpkg%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d4a32386f3b61a4997de54ed00c0a80fd07ecc75/src%2Flibrustpkg%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Ftests.rs?ref=d4a32386f3b61a4997de54ed00c0a80fd07ecc75", "patch": "@@ -217,10 +217,6 @@ fn is_read_only(p: &Path) -> bool {\n     }\n }\n \n-fn ends_with(v: &[u8], needle: &[u8]) -> bool {\n-    v.len() >= needle.len() && v.slice_from(v.len() - needle.len()) == needle\n-}\n-\n fn test_sysroot() -> Path {\n     // Totally gross hack but it's just for test cases.\n     // Infer the sysroot from the exe name and pray that it's right.\n@@ -747,7 +743,7 @@ fn test_package_version() {\n                                              &ws) {\n         Some(p) => {\n             let suffix = format!(\"0.4{}\", os::consts::DLL_SUFFIX);\n-            ends_with(p.as_vec(), suffix.as_bytes())\n+            p.as_vec().ends_with(suffix.as_bytes())\n         }\n         None    => false\n     });\n@@ -785,7 +781,7 @@ fn test_package_request_version() {\n         Some(p) => {\n             debug2!(\"installed: {}\", p.display());\n             let suffix = format!(\"0.3{}\", os::consts::DLL_SUFFIX);\n-            ends_with(p.as_vec(), suffix.as_bytes())\n+            p.as_vec().ends_with(suffix.as_bytes())\n         }\n         None    => false\n     });"}, {"sha": "5c6974de17daec19c412b94cbbe7c5e7fc5e3987", "filename": "src/libstd/str.rs", "status": "modified", "additions": 6, "deletions": 19, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/d4a32386f3b61a4997de54ed00c0a80fd07ecc75/src%2Flibstd%2Fstr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d4a32386f3b61a4997de54ed00c0a80fd07ecc75/src%2Flibstd%2Fstr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fstr.rs?ref=d4a32386f3b61a4997de54ed00c0a80fd07ecc75", "patch": "@@ -827,17 +827,6 @@ pub fn eq(a: &~str, b: &~str) -> bool {\n     eq_slice(*a, *b)\n }\n \n-/*\n-Section: Searching\n-*/\n-\n-// Utility used by various searching functions\n-fn match_at<'a,'b>(haystack: &'a str, needle: &'b str, at: uint) -> bool {\n-    let mut i = at;\n-    for c in needle.byte_iter() { if haystack[i] != c { return false; } i += 1u; }\n-    return true;\n-}\n-\n /*\n Section: Misc\n */\n@@ -2018,18 +2007,16 @@ impl<'self> StrSlice<'self> for &'self str {\n         }\n     }\n \n+    #[inline]\n     fn starts_with<'a>(&self, needle: &'a str) -> bool {\n-        let (self_len, needle_len) = (self.len(), needle.len());\n-        if needle_len == 0u { true }\n-        else if needle_len > self_len { false }\n-        else { match_at(*self, needle, 0u) }\n+        let n = needle.len();\n+        self.len() >= n && needle == self.slice_to(n)\n     }\n \n+    #[inline]\n     fn ends_with(&self, needle: &str) -> bool {\n-        let (self_len, needle_len) = (self.len(), needle.len());\n-        if needle_len == 0u { true }\n-        else if needle_len > self_len { false }\n-        else { match_at(*self, needle, self_len - needle_len) }\n+        let (m, n) = (self.len(), needle.len());\n+        m >= n && needle == self.slice_from(m - n)\n     }\n \n     fn escape_default(&self) -> ~str {"}, {"sha": "17dcced94859bd0b7735d7d3548e4a90ec6f8503", "filename": "src/libstd/vec.rs", "status": "modified", "additions": 48, "deletions": 2, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/d4a32386f3b61a4997de54ed00c0a80fd07ecc75/src%2Flibstd%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d4a32386f3b61a4997de54ed00c0a80fd07ecc75/src%2Flibstd%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fvec.rs?ref=d4a32386f3b61a4997de54ed00c0a80fd07ecc75", "patch": "@@ -1173,6 +1173,12 @@ pub trait ImmutableEqVector<T:Eq> {\n \n     /// Return true if a vector contains an element with the given value\n     fn contains(&self, x: &T) -> bool;\n+\n+    /// Returns true if `needle` is a prefix of the vector.\n+    fn starts_with(&self, needle: &[T]) -> bool;\n+\n+    /// Returns true if `needle` is a suffix of the vector.\n+    fn ends_with(&self, needle: &[T]) -> bool;\n }\n \n impl<'self,T:Eq> ImmutableEqVector<T> for &'self [T] {\n@@ -1186,9 +1192,21 @@ impl<'self,T:Eq> ImmutableEqVector<T> for &'self [T] {\n         self.iter().rposition(|x| *x == *t)\n     }\n \n+    #[inline]\n     fn contains(&self, x: &T) -> bool {\n-        for elt in self.iter() { if *x == *elt { return true; } }\n-        false\n+        self.iter().any(|elt| *x == *elt)\n+    }\n+\n+    #[inline]\n+    fn starts_with(&self, needle: &[T]) -> bool {\n+        let n = needle.len();\n+        self.len() >= n && needle == self.slice_to(n)\n+    }\n+\n+    #[inline]\n+    fn ends_with(&self, needle: &[T]) -> bool {\n+        let (m, n) = (self.len(), needle.len());\n+        m >= n && needle == self.slice_from(m - n)\n     }\n }\n \n@@ -3828,6 +3846,34 @@ mod tests {\n         assert_eq!(xs.capacity(), 100);\n         assert_eq!(xs, range(0, 100).to_owned_vec());\n     }\n+\n+    #[test]\n+    fn test_starts_with() {\n+        assert!(bytes!(\"foobar\").starts_with(bytes!(\"foo\")));\n+        assert!(!bytes!(\"foobar\").starts_with(bytes!(\"oob\")));\n+        assert!(!bytes!(\"foobar\").starts_with(bytes!(\"bar\")));\n+        assert!(!bytes!(\"foo\").starts_with(bytes!(\"foobar\")));\n+        assert!(!bytes!(\"bar\").starts_with(bytes!(\"foobar\")));\n+        assert!(bytes!(\"foobar\").starts_with(bytes!(\"foobar\")));\n+        let empty: &[u8] = [];\n+        assert!(empty.starts_with(empty));\n+        assert!(!empty.starts_with(bytes!(\"foo\")));\n+        assert!(bytes!(\"foobar\").starts_with(empty));\n+    }\n+\n+    #[test]\n+    fn test_ends_with() {\n+        assert!(bytes!(\"foobar\").ends_with(bytes!(\"bar\")));\n+        assert!(!bytes!(\"foobar\").ends_with(bytes!(\"oba\")));\n+        assert!(!bytes!(\"foobar\").ends_with(bytes!(\"foo\")));\n+        assert!(!bytes!(\"foo\").ends_with(bytes!(\"foobar\")));\n+        assert!(!bytes!(\"bar\").ends_with(bytes!(\"foobar\")));\n+        assert!(bytes!(\"foobar\").ends_with(bytes!(\"foobar\")));\n+        let empty: &[u8] = [];\n+        assert!(empty.ends_with(empty));\n+        assert!(!empty.ends_with(bytes!(\"foo\")));\n+        assert!(bytes!(\"foobar\").ends_with(empty));\n+    }\n }\n \n #[cfg(test)]"}, {"sha": "5d12f4e88177c038a8edc4df59509880032ea3aa", "filename": "src/test/run-pass/tempfile.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d4a32386f3b61a4997de54ed00c0a80fd07ecc75/src%2Ftest%2Frun-pass%2Ftempfile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d4a32386f3b61a4997de54ed00c0a80fd07ecc75/src%2Ftest%2Frun-pass%2Ftempfile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Ftempfile.rs?ref=d4a32386f3b61a4997de54ed00c0a80fd07ecc75", "patch": "@@ -30,13 +30,10 @@ fn test_tempdir() {\n     let path = {\n         let p = TempDir::new_in(&Path::new(\".\"), \"foobar\").unwrap();\n         let p = p.path();\n-        assert!(ends_with(p.as_vec(), bytes!(\"foobar\")));\n+        assert!(p.as_vec().ends_with(bytes!(\"foobar\")));\n         p.clone()\n     };\n     assert!(!os::path_exists(&path));\n-    fn ends_with(v: &[u8], needle: &[u8]) -> bool {\n-        v.len() >= needle.len() && v.slice_from(v.len()-needle.len()) == needle\n-    }\n }\n \n fn test_rm_tempdir() {"}]}