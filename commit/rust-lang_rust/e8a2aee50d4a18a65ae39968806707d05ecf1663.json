{"sha": "e8a2aee50d4a18a65ae39968806707d05ecf1663", "node_id": "C_kwDOAAsO6NoAKGU4YTJhZWU1MGQ0YTE4YTY1YWUzOTk2ODgwNjcwN2QwNWVjZjE2NjM", "commit": {"author": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2022-10-07T15:08:59Z"}, "committer": {"name": "Deadbeef", "email": "ent3rm4n@gmail.com", "date": "2022-10-07T15:14:22Z"}, "message": "Remove `DefId` from some `SelectionCandidate` variants", "tree": {"sha": "104f6c51d2a5f39b297c1e189eca180323de602f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/104f6c51d2a5f39b297c1e189eca180323de602f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e8a2aee50d4a18a65ae39968806707d05ecf1663", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e8a2aee50d4a18a65ae39968806707d05ecf1663", "html_url": "https://github.com/rust-lang/rust/commit/e8a2aee50d4a18a65ae39968806707d05ecf1663", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e8a2aee50d4a18a65ae39968806707d05ecf1663/comments", "author": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fee1-dead", "id": 43851243, "node_id": "MDQ6VXNlcjQzODUxMjQz", "avatar_url": "https://avatars.githubusercontent.com/u/43851243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fee1-dead", "html_url": "https://github.com/fee1-dead", "followers_url": "https://api.github.com/users/fee1-dead/followers", "following_url": "https://api.github.com/users/fee1-dead/following{/other_user}", "gists_url": "https://api.github.com/users/fee1-dead/gists{/gist_id}", "starred_url": "https://api.github.com/users/fee1-dead/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fee1-dead/subscriptions", "organizations_url": "https://api.github.com/users/fee1-dead/orgs", "repos_url": "https://api.github.com/users/fee1-dead/repos", "events_url": "https://api.github.com/users/fee1-dead/events{/privacy}", "received_events_url": "https://api.github.com/users/fee1-dead/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e42c4d7218b2596276152c5eb1e69335621f3086", "url": "https://api.github.com/repos/rust-lang/rust/commits/e42c4d7218b2596276152c5eb1e69335621f3086", "html_url": "https://github.com/rust-lang/rust/commit/e42c4d7218b2596276152c5eb1e69335621f3086"}], "stats": {"total": 41, "additions": 20, "deletions": 21}, "files": [{"sha": "11758599cffa1ab98181eb2c4cbc6bda46d307eb", "filename": "compiler/rustc_middle/src/traits/select.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e8a2aee50d4a18a65ae39968806707d05ecf1663/compiler%2Frustc_middle%2Fsrc%2Ftraits%2Fselect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e8a2aee50d4a18a65ae39968806707d05ecf1663/compiler%2Frustc_middle%2Fsrc%2Ftraits%2Fselect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Ftraits%2Fselect.rs?ref=e8a2aee50d4a18a65ae39968806707d05ecf1663", "patch": "@@ -115,7 +115,7 @@ pub enum SelectionCandidate<'tcx> {\n \n     ParamCandidate(ty::PolyTraitPredicate<'tcx>),\n     ImplCandidate(DefId),\n-    AutoImplCandidate(DefId),\n+    AutoImplCandidate,\n \n     /// This is a trait matching with a projected type as `Self`, and we found\n     /// an applicable bound in the trait definition. The `usize` is an index\n@@ -143,7 +143,7 @@ pub enum SelectionCandidate<'tcx> {\n     /// Builtin implementation of `Pointee`.\n     PointeeCandidate,\n \n-    TraitAliasCandidate(DefId),\n+    TraitAliasCandidate,\n \n     /// Matching `dyn Trait` with a supertrait of `Trait`. The index is the\n     /// position in the iterator returned by"}, {"sha": "f6c0930eb5f3762c3094ddda026419f871121ca3", "filename": "compiler/rustc_trait_selection/src/traits/select/candidate_assembly.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/e8a2aee50d4a18a65ae39968806707d05ecf1663/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fcandidate_assembly.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e8a2aee50d4a18a65ae39968806707d05ecf1663/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fcandidate_assembly.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fcandidate_assembly.rs?ref=e8a2aee50d4a18a65ae39968806707d05ecf1663", "patch": "@@ -625,7 +625,7 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n                     }\n                 }\n \n-                _ => candidates.vec.push(AutoImplCandidate(def_id)),\n+                _ => candidates.vec.push(AutoImplCandidate),\n             }\n         }\n     }\n@@ -914,7 +914,7 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n         let def_id = obligation.predicate.def_id();\n \n         if self.tcx().is_trait_alias(def_id) {\n-            candidates.vec.push(TraitAliasCandidate(def_id));\n+            candidates.vec.push(TraitAliasCandidate);\n         }\n     }\n "}, {"sha": "98c99e9ad4fb6fe6773e56ade4dbb8cf17835abe", "filename": "compiler/rustc_trait_selection/src/traits/select/confirmation.rs", "status": "modified", "additions": 8, "deletions": 9, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/e8a2aee50d4a18a65ae39968806707d05ecf1663/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fconfirmation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e8a2aee50d4a18a65ae39968806707d05ecf1663/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fconfirmation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fconfirmation.rs?ref=e8a2aee50d4a18a65ae39968806707d05ecf1663", "patch": "@@ -64,8 +64,8 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n                 ImplSource::UserDefined(self.confirm_impl_candidate(obligation, impl_def_id))\n             }\n \n-            AutoImplCandidate(trait_def_id) => {\n-                let data = self.confirm_auto_impl_candidate(obligation, trait_def_id);\n+            AutoImplCandidate => {\n+                let data = self.confirm_auto_impl_candidate(obligation);\n                 ImplSource::AutoImpl(data)\n             }\n \n@@ -100,8 +100,8 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n \n             PointeeCandidate => ImplSource::Pointee(ImplSourcePointeeData),\n \n-            TraitAliasCandidate(alias_def_id) => {\n-                let data = self.confirm_trait_alias_candidate(obligation, alias_def_id);\n+            TraitAliasCandidate => {\n+                let data = self.confirm_trait_alias_candidate(obligation);\n                 ImplSource::TraitAlias(data)\n             }\n \n@@ -317,13 +317,12 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n     fn confirm_auto_impl_candidate(\n         &mut self,\n         obligation: &TraitObligation<'tcx>,\n-        trait_def_id: DefId,\n     ) -> ImplSourceAutoImplData<PredicateObligation<'tcx>> {\n-        debug!(?obligation, ?trait_def_id, \"confirm_auto_impl_candidate\");\n+        debug!(?obligation, \"confirm_auto_impl_candidate\");\n \n         let self_ty = self.infcx.shallow_resolve(obligation.predicate.self_ty());\n         let types = self.constituent_types_for_ty(self_ty);\n-        self.vtable_auto_impl(obligation, trait_def_id, types)\n+        self.vtable_auto_impl(obligation, obligation.predicate.def_id(), types)\n     }\n \n     /// See `confirm_auto_impl_candidate`.\n@@ -658,10 +657,10 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n     fn confirm_trait_alias_candidate(\n         &mut self,\n         obligation: &TraitObligation<'tcx>,\n-        alias_def_id: DefId,\n     ) -> ImplSourceTraitAliasData<'tcx, PredicateObligation<'tcx>> {\n-        debug!(?obligation, ?alias_def_id, \"confirm_trait_alias_candidate\");\n+        debug!(?obligation, \"confirm_trait_alias_candidate\");\n \n+        let alias_def_id = obligation.predicate.def_id();\n         let predicate = self.infcx().replace_bound_vars_with_placeholders(obligation.predicate);\n         let trait_ref = predicate.trait_ref;\n         let trait_def_id = trait_ref.def_id;"}, {"sha": "c9c47d6fb54563579b748020ecdb0625515e5e55", "filename": "compiler/rustc_trait_selection/src/traits/select/mod.rs", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/e8a2aee50d4a18a65ae39968806707d05ecf1663/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e8a2aee50d4a18a65ae39968806707d05ecf1663/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Fselect%2Fmod.rs?ref=e8a2aee50d4a18a65ae39968806707d05ecf1663", "patch": "@@ -1150,7 +1150,7 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n                     // const projection\n                     ProjectionCandidate(_, ty::BoundConstness::ConstIfConst) => {}\n                     // auto trait impl\n-                    AutoImplCandidate(..) => {}\n+                    AutoImplCandidate => {}\n                     // generator, this will raise error in other places\n                     // or ignore error with const_async_blocks feature\n                     GeneratorCandidate => {}\n@@ -1568,7 +1568,7 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n         // This is a fix for #53123 and prevents winnowing from accidentally extending the\n         // lifetime of a variable.\n         match (&other.candidate, &victim.candidate) {\n-            (_, AutoImplCandidate(..)) | (AutoImplCandidate(..), _) => {\n+            (_, AutoImplCandidate) | (AutoImplCandidate, _) => {\n                 bug!(\n                     \"default implementations shouldn't be recorded \\\n                     when there are other valid candidates\"\n@@ -1638,7 +1638,7 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n                 | BuiltinUnsizeCandidate\n                 | TraitUpcastingUnsizeCandidate(_)\n                 | BuiltinCandidate { .. }\n-                | TraitAliasCandidate(..)\n+                | TraitAliasCandidate\n                 | ObjectCandidate(_)\n                 | ProjectionCandidate(..),\n             ) => !is_global(cand),\n@@ -1656,7 +1656,7 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n                 | BuiltinUnsizeCandidate\n                 | TraitUpcastingUnsizeCandidate(_)\n                 | BuiltinCandidate { has_nested: true }\n-                | TraitAliasCandidate(..),\n+                | TraitAliasCandidate,\n                 ParamCandidate(ref cand),\n             ) => {\n                 // Prefer these to a global where-clause bound\n@@ -1686,7 +1686,7 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n                 | BuiltinUnsizeCandidate\n                 | TraitUpcastingUnsizeCandidate(_)\n                 | BuiltinCandidate { .. }\n-                | TraitAliasCandidate(..),\n+                | TraitAliasCandidate,\n             ) => true,\n \n             (\n@@ -1698,7 +1698,7 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n                 | BuiltinUnsizeCandidate\n                 | TraitUpcastingUnsizeCandidate(_)\n                 | BuiltinCandidate { .. }\n-                | TraitAliasCandidate(..),\n+                | TraitAliasCandidate,\n                 ObjectCandidate(_) | ProjectionCandidate(..),\n             ) => false,\n \n@@ -1779,7 +1779,7 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n                 | BuiltinUnsizeCandidate\n                 | TraitUpcastingUnsizeCandidate(_)\n                 | BuiltinCandidate { has_nested: true }\n-                | TraitAliasCandidate(..),\n+                | TraitAliasCandidate,\n                 ImplCandidate(_)\n                 | ClosureCandidate\n                 | GeneratorCandidate\n@@ -1788,7 +1788,7 @@ impl<'cx, 'tcx> SelectionContext<'cx, 'tcx> {\n                 | BuiltinUnsizeCandidate\n                 | TraitUpcastingUnsizeCandidate(_)\n                 | BuiltinCandidate { has_nested: true }\n-                | TraitAliasCandidate(..),\n+                | TraitAliasCandidate,\n             ) => false,\n         }\n     }"}]}