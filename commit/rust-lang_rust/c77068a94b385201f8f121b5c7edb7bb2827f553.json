{"sha": "c77068a94b385201f8f121b5c7edb7bb2827f553", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM3NzA2OGE5NGIzODUyMDFmOGYxMjFiNWM3ZWRiN2JiMjgyN2Y1NTM=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2017-10-18T17:59:52Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-10-18T17:59:52Z"}, "message": "Rollup merge of #45326 - cuviper:min-llvm-3.9, r=alexcrichton\n\nBump the minimum LLVM to 3.9\n\nOld LLVM bugs are reportedly cropping up harder, but 3.9 seems to be OK.\n\nFixes #45277.", "tree": {"sha": "c48dfdb429571b0fa41b934fa2714a3879b50934", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c48dfdb429571b0fa41b934fa2714a3879b50934"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c77068a94b385201f8f121b5c7edb7bb2827f553", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c77068a94b385201f8f121b5c7edb7bb2827f553", "html_url": "https://github.com/rust-lang/rust/commit/c77068a94b385201f8f121b5c7edb7bb2827f553", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c77068a94b385201f8f121b5c7edb7bb2827f553/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0d4dbbab4631616e882158ffddc062e890bb735f", "url": "https://api.github.com/repos/rust-lang/rust/commits/0d4dbbab4631616e882158ffddc062e890bb735f", "html_url": "https://github.com/rust-lang/rust/commit/0d4dbbab4631616e882158ffddc062e890bb735f"}, {"sha": "6309a475f912f8237cba57458bc598c2fc8fc90b", "url": "https://api.github.com/repos/rust-lang/rust/commits/6309a475f912f8237cba57458bc598c2fc8fc90b", "html_url": "https://github.com/rust-lang/rust/commit/6309a475f912f8237cba57458bc598c2fc8fc90b"}], "stats": {"total": 39, "additions": 20, "deletions": 19}, "files": [{"sha": "c76e17a27d188c264686e3225d8260398f318a51", "filename": ".travis.yml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c77068a94b385201f8f121b5c7edb7bb2827f553/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/c77068a94b385201f8f121b5c7edb7bb2827f553/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=c77068a94b385201f8f121b5c7edb7bb2827f553", "patch": "@@ -12,7 +12,7 @@ matrix:\n   fast_finish: true\n   include:\n     # Images used in testing PR and try-build should be run first.\n-    - env: IMAGE=x86_64-gnu-llvm-3.7 RUST_BACKTRACE=1\n+    - env: IMAGE=x86_64-gnu-llvm-3.9 RUST_BACKTRACE=1\n       if: type = pull_request OR branch = auto\n \n     - env: IMAGE=dist-x86_64-linux DEPLOY=1"}, {"sha": "261fe2053879f004fd2ffeecc23d49c43ceb8467", "filename": "config.toml.example", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c77068a94b385201f8f121b5c7edb7bb2827f553/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/c77068a94b385201f8f121b5c7edb7bb2827f553/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=c77068a94b385201f8f121b5c7edb7bb2827f553", "patch": "@@ -35,7 +35,7 @@\n # If an external LLVM root is specified, we automatically check the version by\n # default to make sure it's within the range that we're expecting, but setting\n # this flag will indicate that this version check should not be done.\n-#version-check = false\n+#version-check = true\n \n # Link libstdc++ statically into the librustc_llvm instead of relying on a\n # dynamic version to be available."}, {"sha": "d6c83e3acfc8ab3d844535644e4310aab3bb950b", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c77068a94b385201f8f121b5c7edb7bb2827f553/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c77068a94b385201f8f121b5c7edb7bb2827f553/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=c77068a94b385201f8f121b5c7edb7bb2827f553", "patch": "@@ -299,6 +299,7 @@ impl Config {\n         let mut config = Config::default();\n         config.llvm_enabled = true;\n         config.llvm_optimize = true;\n+        config.llvm_version_check = true;\n         config.use_jemalloc = true;\n         config.backtrace = true;\n         config.rust_optimize = true;"}, {"sha": "c37b1dad4c687cd9698543861ec74433206c3ab0", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/c77068a94b385201f8f121b5c7edb7bb2827f553/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c77068a94b385201f8f121b5c7edb7bb2827f553/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=c77068a94b385201f8f121b5c7edb7bb2827f553", "patch": "@@ -259,11 +259,14 @@ fn check_llvm_version(build: &Build, llvm_config: &Path) {\n \n     let mut cmd = Command::new(llvm_config);\n     let version = output(cmd.arg(\"--version\"));\n-    if version.starts_with(\"3.5\") || version.starts_with(\"3.6\") ||\n-       version.starts_with(\"3.7\") {\n-        return\n+    let mut parts = version.split('.').take(2)\n+        .filter_map(|s| s.parse::<u32>().ok());\n+    if let (Some(major), Some(minor)) = (parts.next(), parts.next()) {\n+        if major > 3 || (major == 3 && minor >= 9) {\n+            return\n+        }\n     }\n-    panic!(\"\\n\\nbad LLVM version: {}, need >=3.5\\n\\n\", version)\n+    panic!(\"\\n\\nbad LLVM version: {}, need >=3.9\\n\\n\", version)\n }\n \n #[derive(Debug, Copy, Clone, PartialEq, Eq, Hash)]"}, {"sha": "6b8186048988d089a08c9e8bc8c4aa393c466f82", "filename": "src/ci/docker/x86_64-gnu-llvm-3.9/Dockerfile", "status": "renamed", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c77068a94b385201f8f121b5c7edb7bb2827f553/src%2Fci%2Fdocker%2Fx86_64-gnu-llvm-3.9%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/c77068a94b385201f8f121b5c7edb7bb2827f553/src%2Fci%2Fdocker%2Fx86_64-gnu-llvm-3.9%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-llvm-3.9%2FDockerfile?ref=c77068a94b385201f8f121b5c7edb7bb2827f553", "patch": "@@ -11,15 +11,17 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n   cmake \\\n   sudo \\\n   gdb \\\n-  llvm-3.7-tools \\\n+  llvm-3.9-tools \\\n   libedit-dev \\\n   zlib1g-dev \\\n   xz-utils\n \n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+# using llvm-link-shared due to libffi issues -- see #34486\n ENV RUST_CONFIGURE_ARGS \\\n       --build=x86_64-unknown-linux-gnu \\\n-      --llvm-root=/usr/lib/llvm-3.7\n+      --llvm-root=/usr/lib/llvm-3.9 \\\n+      --enable-llvm-link-shared\n ENV RUST_CHECK_TARGET check", "previous_filename": "src/ci/docker/x86_64-gnu-llvm-3.7/Dockerfile"}, {"sha": "e0b37cb2f32243474a4dff376667460091cac759", "filename": "src/test/codegen/abi-x86-interrupt.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c77068a94b385201f8f121b5c7edb7bb2827f553/src%2Ftest%2Fcodegen%2Fabi-x86-interrupt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c77068a94b385201f8f121b5c7edb7bb2827f553/src%2Ftest%2Fcodegen%2Fabi-x86-interrupt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fabi-x86-interrupt.rs?ref=c77068a94b385201f8f121b5c7edb7bb2827f553", "patch": "@@ -14,7 +14,6 @@\n \n // ignore-arm\n // ignore-aarch64\n-// min-llvm-version 3.8\n \n // compile-flags: -C no-prepopulate-passes\n "}, {"sha": "f0508bc90f20c9941b537b8fc4549d82f3ec4342", "filename": "src/test/codegen/mainsubprogram.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c77068a94b385201f8f121b5c7edb7bb2827f553/src%2Ftest%2Fcodegen%2Fmainsubprogram.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c77068a94b385201f8f121b5c7edb7bb2827f553/src%2Ftest%2Fcodegen%2Fmainsubprogram.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fmainsubprogram.rs?ref=c77068a94b385201f8f121b5c7edb7bb2827f553", "patch": "@@ -8,14 +8,13 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// The minimum LLVM version is set to 3.8, but really this test\n-// depends on a patch that is was committed to upstream LLVM before\n-// 4.0; and also backported to the Rust LLVM fork.\n+// This test depends on a patch that was committed to upstream LLVM\n+// before 4.0, formerly backported to the Rust LLVM fork.\n \n // ignore-tidy-linelength\n // ignore-windows\n // ignore-macos\n-// min-llvm-version 3.8\n+// min-llvm-version 4.0\n \n // compile-flags: -g -C no-prepopulate-passes\n "}, {"sha": "8325318f9afc56dcecadf961d21de6b13a2acec0", "filename": "src/test/codegen/mainsubprogramstart.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c77068a94b385201f8f121b5c7edb7bb2827f553/src%2Ftest%2Fcodegen%2Fmainsubprogramstart.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c77068a94b385201f8f121b5c7edb7bb2827f553/src%2Ftest%2Fcodegen%2Fmainsubprogramstart.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fmainsubprogramstart.rs?ref=c77068a94b385201f8f121b5c7edb7bb2827f553", "patch": "@@ -8,14 +8,13 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// The minimum LLVM version is set to 3.8, but really this test\n-// depends on a patch that is was committed to upstream LLVM before\n-// 4.0; and also backported to the Rust LLVM fork.\n+// This test depends on a patch that was committed to upstream LLVM\n+// before 4.0, formerly backported to the Rust LLVM fork.\n \n // ignore-tidy-linelength\n // ignore-windows\n // ignore-macos\n-// min-llvm-version 3.8\n+// min-llvm-version 4.0\n \n // compile-flags: -g -C no-prepopulate-passes\n "}, {"sha": "f6c03b384f23db86416efe87d2436f628bdabea6", "filename": "src/test/run-pass/issue-36023.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c77068a94b385201f8f121b5c7edb7bb2827f553/src%2Ftest%2Frun-pass%2Fissue-36023.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c77068a94b385201f8f121b5c7edb7bb2827f553/src%2Ftest%2Frun-pass%2Fissue-36023.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fissue-36023.rs?ref=c77068a94b385201f8f121b5c7edb7bb2827f553", "patch": "@@ -8,8 +8,6 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// min-llvm-version 3.9\n-\n use std::ops::Deref;\n \n fn main() {"}]}