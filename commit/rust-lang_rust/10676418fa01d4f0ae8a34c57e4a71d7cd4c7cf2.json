{"sha": "10676418fa01d4f0ae8a34c57e4a71d7cd4c7cf2", "node_id": "C_kwDOAAsO6NoAKDEwNjc2NDE4ZmEwMWQ0ZjBhZThhMzRjNTdlNGE3MWQ3Y2Q0YzdjZjI", "commit": {"author": {"name": "David Wood", "email": "david.wood@huawei.com", "date": "2022-06-28T13:28:02Z"}, "committer": {"name": "David Wood", "email": "david.wood@huawei.com", "date": "2022-06-30T07:59:22Z"}, "message": "lint: port keyword idents diagnostics\n\nSigned-off-by: David Wood <david.wood@huawei.com>", "tree": {"sha": "57b7c6af34703470a0c1a1edb6d62b7651dbfdf4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/57b7c6af34703470a0c1a1edb6d62b7651dbfdf4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/10676418fa01d4f0ae8a34c57e4a71d7cd4c7cf2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/10676418fa01d4f0ae8a34c57e4a71d7cd4c7cf2", "html_url": "https://github.com/rust-lang/rust/commit/10676418fa01d4f0ae8a34c57e4a71d7cd4c7cf2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/10676418fa01d4f0ae8a34c57e4a71d7cd4c7cf2/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "10f2d3f566d4271ee95b9b1ae51dbf51b4aa1707", "url": "https://api.github.com/repos/rust-lang/rust/commits/10f2d3f566d4271ee95b9b1ae51dbf51b4aa1707", "html_url": "https://github.com/rust-lang/rust/commit/10f2d3f566d4271ee95b9b1ae51dbf51b4aa1707"}], "stats": {"total": 17, "additions": 14, "deletions": 3}, "files": [{"sha": "134ee43f02231bc5e0306ca5d339a3c20ccafdc8", "filename": "compiler/rustc_error_messages/locales/en-US/lint.ftl", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/10676418fa01d4f0ae8a34c57e4a71d7cd4c7cf2/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Flint.ftl", "raw_url": "https://github.com/rust-lang/rust/raw/10676418fa01d4f0ae8a34c57e4a71d7cd4c7cf2/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Flint.ftl", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_messages%2Flocales%2Fen-US%2Flint.ftl?ref=10676418fa01d4f0ae8a34c57e4a71d7cd4c7cf2", "patch": "@@ -373,3 +373,6 @@ lint-builtin-ellipsis-inclusive-range-patterns = `...` range patterns are deprec\n     .suggestion = use `..=` for an inclusive range\n \n lint-builtin-unnameable-test-items = cannot test inner items\n+\n+lint-builtin-keyword-idents = `{$kw}` is a keyword in the {$next} edition\n+    .suggestion = you can use a raw identifier to stay compatible"}, {"sha": "fc619ad54cf9214a5811fcd47d1b2fe22a80c9ba", "filename": "compiler/rustc_errors/src/diagnostic.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/10676418fa01d4f0ae8a34c57e4a71d7cd4c7cf2/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/10676418fa01d4f0ae8a34c57e4a71d7cd4c7cf2/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_errors%2Fsrc%2Fdiagnostic.rs?ref=10676418fa01d4f0ae8a34c57e4a71d7cd4c7cf2", "patch": "@@ -8,7 +8,7 @@ use rustc_error_messages::FluentValue;\n use rustc_lint_defs::{Applicability, LintExpectationId};\n use rustc_span::edition::LATEST_STABLE_EDITION;\n use rustc_span::symbol::{Ident, Symbol};\n-use rustc_span::{Span, DUMMY_SP};\n+use rustc_span::{edition::Edition, Span, DUMMY_SP};\n use std::borrow::Cow;\n use std::fmt;\n use std::hash::{Hash, Hasher};\n@@ -115,6 +115,12 @@ impl IntoDiagnosticArg for String {\n     }\n }\n \n+impl IntoDiagnosticArg for Edition {\n+    fn into_diagnostic_arg(self) -> DiagnosticArgValue<'static> {\n+        DiagnosticArgValue::Str(Cow::Owned(self.to_string()))\n+    }\n+}\n+\n impl IntoDiagnosticArg for Symbol {\n     fn into_diagnostic_arg(self) -> DiagnosticArgValue<'static> {\n         self.to_ident_string().into_diagnostic_arg()"}, {"sha": "a3ebc547544f12fd9741f921832f696101e5bdb7", "filename": "compiler/rustc_lint/src/builtin.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/10676418fa01d4f0ae8a34c57e4a71d7cd4c7cf2/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/10676418fa01d4f0ae8a34c57e4a71d7cd4c7cf2/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs?ref=10676418fa01d4f0ae8a34c57e4a71d7cd4c7cf2", "patch": "@@ -2033,10 +2033,12 @@ impl KeywordIdents {\n         }\n \n         cx.struct_span_lint(KEYWORD_IDENTS, ident.span, |lint| {\n-            lint.build(&format!(\"`{}` is a keyword in the {} edition\", ident, next_edition))\n+            lint.build(fluent::lint::builtin_keyword_idents)\n+                .set_arg(\"kw\", ident.clone())\n+                .set_arg(\"next\", next_edition)\n                 .span_suggestion(\n                     ident.span,\n-                    \"you can use a raw identifier to stay compatible\",\n+                    fluent::lint::suggestion,\n                     format!(\"r#{}\", ident),\n                     Applicability::MachineApplicable,\n                 )"}]}