{"sha": "f4e3851aa7bbd49294c20cc63eef9974f20192c8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY0ZTM4NTFhYTdiYmQ0OTI5NGMyMGNjNjNlZWY5OTc0ZjIwMTkyYzg=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2015-10-04T10:11:56Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2015-10-13T12:19:22Z"}, "message": "Fix rebase", "tree": {"sha": "10c3fe7653bae1485657c21ac92d9bf34f45780f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/10c3fe7653bae1485657c21ac92d9bf34f45780f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f4e3851aa7bbd49294c20cc63eef9974f20192c8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f4e3851aa7bbd49294c20cc63eef9974f20192c8", "html_url": "https://github.com/rust-lang/rust/commit/f4e3851aa7bbd49294c20cc63eef9974f20192c8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f4e3851aa7bbd49294c20cc63eef9974f20192c8/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b404ded15b0873696181114766967e2e154a6425", "url": "https://api.github.com/repos/rust-lang/rust/commits/b404ded15b0873696181114766967e2e154a6425", "html_url": "https://github.com/rust-lang/rust/commit/b404ded15b0873696181114766967e2e154a6425"}], "stats": {"total": 17, "additions": 10, "deletions": 7}, "files": [{"sha": "2ea4f694ec4bb54bdc122af439a476d9abe5e99c", "filename": "src/librustc/metadata/encoder.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f4e3851aa7bbd49294c20cc63eef9974f20192c8/src%2Flibrustc%2Fmetadata%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4e3851aa7bbd49294c20cc63eef9974f20192c8/src%2Flibrustc%2Fmetadata%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmetadata%2Fencoder.rs?ref=f4e3851aa7bbd49294c20cc63eef9974f20192c8", "patch": "@@ -1068,8 +1068,8 @@ fn encode_info_for_item<'a, 'tcx>(ecx: &EncodeContext<'a, 'tcx>,\n         // Encode inherent implementations for this structure.\n         encode_inherent_implementations(ecx, rbml_w, def_id);\n \n-        if let Some(ctor_id) = struct_def.ctor_id {\n-            let ctor_did = ecx.tcx.map.local_def_id(ctor_id);\n+        if struct_def.kind != hir::VariantKind::Dict {\n+            let ctor_did = ecx.tcx.map.local_def_id(struct_def.id);\n             rbml_w.wr_tagged_u64(tag_items_data_item_struct_ctor,\n                                  def_to_u64(ctor_did));\n         }"}, {"sha": "20ffa8c3e95487f026a3d7a9dbe0e1de846bd608", "filename": "src/librustc/middle/astencode.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f4e3851aa7bbd49294c20cc63eef9974f20192c8/src%2Flibrustc%2Fmiddle%2Fastencode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4e3851aa7bbd49294c20cc63eef9974f20192c8/src%2Flibrustc%2Fmiddle%2Fastencode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fastencode.rs?ref=f4e3851aa7bbd49294c20cc63eef9974f20192c8", "patch": "@@ -1316,11 +1316,11 @@ fn copy_item_types(dcx: &DecodeContext, ii: &InlinedItem, orig_did: DefId) {\n                 {\n                     debug!(\"astencode: copying variant {:?} => {:?}\",\n                            orig_variant.did, i_variant.node.id);\n-                    copy_item_type(dcx, i_variant.node.id, orig_variant.did);\n+                    copy_item_type(dcx, i_variant.node.def.id, orig_variant.did);\n                 }\n             }\n             hir::ItemStruct(ref def, _) => {\n-                if let Some(ctor_id) = def.ctor_id {\n+                if def.kind != hir::VariantKind::Dict {\n                     let ctor_did = dcx.tcx.lookup_adt_def(orig_did)\n                         .struct_variant().did;\n                     debug!(\"astencode: copying ctor {:?} => {:?}\", ctor_did,"}, {"sha": "a52226db4aa6201f7aa279f4355f1246b3a5cc19", "filename": "src/librustc_typeck/collect.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/f4e3851aa7bbd49294c20cc63eef9974f20192c8/src%2Flibrustc_typeck%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4e3851aa7bbd49294c20cc63eef9974f20192c8/src%2Flibrustc_typeck%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcollect.rs?ref=f4e3851aa7bbd49294c20cc63eef9974f20192c8", "patch": "@@ -1125,8 +1125,11 @@ fn convert_struct_def<'tcx>(tcx: &ty::ctxt<'tcx>,\n {\n \n     let did = tcx.map.local_def_id(it.id);\n-    let ctor_id = def.ctor_id.map_or(did,\n-        |ctor_id| tcx.map.local_def_id(ctor_id));\n+    let ctor_id = if def.kind != hir::VariantKind::Dict {\n+        tcx.map.local_def_id(def.id)\n+    } else {\n+        did\n+    };\n     tcx.intern_adt_def(\n         did,\n         ty::AdtKind::Struct,\n@@ -1208,7 +1211,7 @@ fn convert_enum_def<'tcx>(tcx: &ty::ctxt<'tcx>,\n     {\n         let did = tcx.map.local_def_id(v.node.def.id);\n         let name = v.node.name;\n-        convert_struct_variant(tcx, did, name, disr, &v.node.def)\n+        convert_struct_variant(tcx, did, name, disr, &v.node.def, did)\n     }\n     let did = tcx.map.local_def_id(it.id);\n     let repr_hints = tcx.lookup_repr_hints(did);"}]}