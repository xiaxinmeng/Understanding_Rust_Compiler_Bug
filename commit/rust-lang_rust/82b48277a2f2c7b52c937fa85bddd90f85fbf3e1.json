{"sha": "82b48277a2f2c7b52c937fa85bddd90f85fbf3e1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjgyYjQ4Mjc3YTJmMmM3YjUyYzkzN2ZhODViZGRkOTBmODVmYmYzZTE=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-08-06T19:15:15Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-08-09T08:25:23Z"}, "message": "Correctly identify named early bound regions.", "tree": {"sha": "4363d41ac99198ac6f82eb3406cf5361c7b77ce6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4363d41ac99198ac6f82eb3406cf5361c7b77ce6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/82b48277a2f2c7b52c937fa85bddd90f85fbf3e1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEWwgxPGhT5b/6kagXAXYLT59T8VQFAltr+nMACgkQAXYLT59T\n8VQfHQ/8CuzEL2ooVaElXejCupkBH/0QWtAK1rHqlvH2fL6gxK+nPbDlQnea9eWG\ngjQy42iBkL6svxgeiVs20PUB+gUk6iUprLCWnLrLTULUY68PdiFHuZBbekVBwDp4\n57dOBh6OsTN7OMum5GZTnoPuf1nfbm8pK0CNiwWhN2b97KCMshKxDvS+2qquEZhY\nwlfWgXOk+JHH4VObqhwi3IDZgOgYfC1obnzcKQL6YdwSh6BCApgBCVQzfhKsupNE\n7j4yCRGvNCXH51iTOO+WQttThWb660rcMTJApLbaplwa5nHBncgxdJQocfE8VR0d\nvO43vioxjgfALoJYmnVNma93s3KZugdXTVkkZx0fd4JvbpK3i0k2lCQ5Z5J9Aiug\n2H7Ys4JhtIx2wdmITArAKrcPcvU6EA4y4gqDMjweO4aHBzAQQOkby7K4yMmcLARB\nEyJN/S62T5CK5lfOIQWRbkVAwSUNvEWg4RKKidpIcYSYvrLdQiSa+ip+3jesu2AI\nEsFgNT2ODqhODdYsOQx4nfnV6HpBgm2W7omHZW8tNB4ivuqh0qvUCU0lMaPkcEKL\n3QEMx+SmU2ZjRGOW12MBfHmxKB5rgMDaaMOXBcguMWNyihBn3n3XcWsTdB9F7gsN\n3nNONCwxqMR8It6wSqmzer23GWqwQIHlY3N3OV3G5Y7GyTn36bw=\n=gzTH\n-----END PGP SIGNATURE-----", "payload": "tree 4363d41ac99198ac6f82eb3406cf5361c7b77ce6\nparent 76b69a604ee0d70be1edfa2828c769dc1b148d13\nauthor David Wood <david@davidtw.co> 1533582915 +0200\ncommitter David Wood <david@davidtw.co> 1533803123 +0200\n\nCorrectly identify named early bound regions.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/82b48277a2f2c7b52c937fa85bddd90f85fbf3e1", "html_url": "https://github.com/rust-lang/rust/commit/82b48277a2f2c7b52c937fa85bddd90f85fbf3e1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/82b48277a2f2c7b52c937fa85bddd90f85fbf3e1/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "76b69a604ee0d70be1edfa2828c769dc1b148d13", "url": "https://api.github.com/repos/rust-lang/rust/commits/76b69a604ee0d70be1edfa2828c769dc1b148d13", "html_url": "https://github.com/rust-lang/rust/commit/76b69a604ee0d70be1edfa2828c769dc1b148d13"}], "stats": {"total": 60, "additions": 56, "deletions": 4}, "files": [{"sha": "4e26a4178b95d78748bf92ed5364d90f904a3589", "filename": "src/librustc/infer/error_reporting/nice_region_error/named_anon_conflict.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/82b48277a2f2c7b52c937fa85bddd90f85fbf3e1/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fnamed_anon_conflict.rs", "raw_url": "https://github.com/rust-lang/rust/raw/82b48277a2f2c7b52c937fa85bddd90f85fbf3e1/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fnamed_anon_conflict.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Fnamed_anon_conflict.rs?ref=82b48277a2f2c7b52c937fa85bddd90f85fbf3e1", "patch": "@@ -129,7 +129,7 @@ impl<'a, 'gcx, 'tcx> NiceRegionError<'a, 'gcx, 'tcx> {\n                 ty::BrNamed(..) => true,\n                 _ => false,\n             },\n-            ty::ReEarlyBound(_) => true,\n+            ty::ReEarlyBound(ebr) => ebr.has_name(),\n             _ => false,\n         }\n     }"}, {"sha": "d7e30b0ca7143a217c069fc24d3083f49067f697", "filename": "src/librustc/ty/mod.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/82b48277a2f2c7b52c937fa85bddd90f85fbf3e1/src%2Flibrustc%2Fty%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/82b48277a2f2c7b52c937fa85bddd90f85fbf3e1/src%2Flibrustc%2Fty%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fmod.rs?ref=82b48277a2f2c7b52c937fa85bddd90f85fbf3e1", "patch": "@@ -51,7 +51,7 @@ use std::{mem, ptr};\n use syntax::ast::{self, DUMMY_NODE_ID, Name, Ident, NodeId};\n use syntax::attr;\n use syntax::ext::hygiene::Mark;\n-use syntax::symbol::{Symbol, LocalInternedString, InternedString};\n+use syntax::symbol::{keywords, Symbol, LocalInternedString, InternedString};\n use syntax_pos::{DUMMY_SP, Span};\n \n use rustc_data_structures::accumulate_vec::IntoIter as AccIntoIter;\n@@ -824,6 +824,12 @@ impl ty::EarlyBoundRegion {\n     pub fn to_bound_region(&self) -> ty::BoundRegion {\n         ty::BoundRegion::BrNamed(self.def_id, self.name)\n     }\n+\n+    /// Does this early bound region have a name? Early bound regions normally\n+    /// always have names except when using anonymous lifetimes (`'_`).\n+    pub fn has_name(&self) -> bool {\n+        self.name != keywords::UnderscoreLifetime.name().as_interned_str()\n+    }\n }\n \n #[derive(Clone, Debug, RustcEncodable, RustcDecodable)]"}, {"sha": "90edc7a60bdb18c5ef63d8416b946ffee77b54db", "filename": "src/librustc_mir/borrow_check/nll/region_infer/error_reporting/region_name.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/82b48277a2f2c7b52c937fa85bddd90f85fbf3e1/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fregion_infer%2Ferror_reporting%2Fregion_name.rs", "raw_url": "https://github.com/rust-lang/rust/raw/82b48277a2f2c7b52c937fa85bddd90f85fbf3e1/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fregion_infer%2Ferror_reporting%2Fregion_name.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fnll%2Fregion_infer%2Ferror_reporting%2Fregion_name.rs?ref=82b48277a2f2c7b52c937fa85bddd90f85fbf3e1", "patch": "@@ -95,8 +95,12 @@ impl<'tcx> RegionInferenceContext<'tcx> {\n         debug!(\"give_region_a_name: error_region = {:?}\", error_region);\n         match error_region {\n             ty::ReEarlyBound(ebr) => {\n-                self.highlight_named_span(tcx, error_region, &ebr.name, diag);\n-                Some(ebr.name)\n+                if ebr.has_name() {\n+                    self.highlight_named_span(tcx, error_region, &ebr.name, diag);\n+                    Some(ebr.name)\n+                } else {\n+                    None\n+                }\n             },\n \n             ty::ReStatic => Some(keywords::StaticLifetime.name().as_interned_str()),"}, {"sha": "84d06a1d20aac76485ed819f553df31cff08644b", "filename": "src/test/ui/nll/issue-52742.rs", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/82b48277a2f2c7b52c937fa85bddd90f85fbf3e1/src%2Ftest%2Fui%2Fnll%2Fissue-52742.rs", "raw_url": "https://github.com/rust-lang/rust/raw/82b48277a2f2c7b52c937fa85bddd90f85fbf3e1/src%2Ftest%2Fui%2Fnll%2Fissue-52742.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fissue-52742.rs?ref=82b48277a2f2c7b52c937fa85bddd90f85fbf3e1", "patch": "@@ -0,0 +1,30 @@\n+// Copyright 2012 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![feature(nll)]\n+#![feature(in_band_lifetimes)]\n+\n+struct Foo<'a, 'b> {\n+    x: &'a u32,\n+    y: &'b u32,\n+}\n+\n+struct Bar<'b> {\n+    z: &'b u32\n+}\n+\n+impl Foo<'_, '_> {\n+    fn take_bar(&mut self, b: Bar<'_>) {\n+        self.y = b.z\n+        //~^ ERROR unsatisfied lifetime constraints\n+    }\n+}\n+\n+fn main() { }"}, {"sha": "89c235c4e8f9eb1fb743496e11057e3f1e8ab203", "filename": "src/test/ui/nll/issue-52742.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/82b48277a2f2c7b52c937fa85bddd90f85fbf3e1/src%2Ftest%2Fui%2Fnll%2Fissue-52742.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/82b48277a2f2c7b52c937fa85bddd90f85fbf3e1/src%2Ftest%2Fui%2Fnll%2Fissue-52742.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fissue-52742.stderr?ref=82b48277a2f2c7b52c937fa85bddd90f85fbf3e1", "patch": "@@ -0,0 +1,12 @@\n+error: unsatisfied lifetime constraints\n+  --> $DIR/issue-52742.rs:25:9\n+   |\n+LL |     fn take_bar(&mut self, b: Bar<'_>) {\n+   |                 ---------         -- let's call this `'1`\n+   |                 |\n+   |                 lifetime `'2` appears in this type\n+LL |         self.y = b.z\n+   |         ^^^^^^^^^^^^ requires that `'1` must outlive `'2`\n+\n+error: aborting due to previous error\n+"}]}