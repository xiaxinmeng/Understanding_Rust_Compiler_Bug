{"sha": "b83daea479ceee19445058001ed0a6412ec25889", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI4M2RhZWE0NzljZWVlMTk0NDUwNTgwMDFlZDBhNjQxMmVjMjU4ODk=", "commit": {"author": {"name": "Matthew Jasper", "email": "mjjasper1@gmail.com", "date": "2018-05-26T10:47:38Z"}, "committer": {"name": "Matthew Jasper", "email": "mjjasper1@gmail.com", "date": "2018-05-31T19:40:25Z"}, "message": "Register outlives predicates from queries the right way around.", "tree": {"sha": "8079c250cf60a84ad953fd67f1f1e64fe94383e1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8079c250cf60a84ad953fd67f1f1e64fe94383e1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b83daea479ceee19445058001ed0a6412ec25889", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b83daea479ceee19445058001ed0a6412ec25889", "html_url": "https://github.com/rust-lang/rust/commit/b83daea479ceee19445058001ed0a6412ec25889", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b83daea479ceee19445058001ed0a6412ec25889/comments", "author": {"login": "matthewjasper", "id": 20113453, "node_id": "MDQ6VXNlcjIwMTEzNDUz", "avatar_url": "https://avatars.githubusercontent.com/u/20113453?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewjasper", "html_url": "https://github.com/matthewjasper", "followers_url": "https://api.github.com/users/matthewjasper/followers", "following_url": "https://api.github.com/users/matthewjasper/following{/other_user}", "gists_url": "https://api.github.com/users/matthewjasper/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewjasper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewjasper/subscriptions", "organizations_url": "https://api.github.com/users/matthewjasper/orgs", "repos_url": "https://api.github.com/users/matthewjasper/repos", "events_url": "https://api.github.com/users/matthewjasper/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewjasper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matthewjasper", "id": 20113453, "node_id": "MDQ6VXNlcjIwMTEzNDUz", "avatar_url": "https://avatars.githubusercontent.com/u/20113453?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthewjasper", "html_url": "https://github.com/matthewjasper", "followers_url": "https://api.github.com/users/matthewjasper/followers", "following_url": "https://api.github.com/users/matthewjasper/following{/other_user}", "gists_url": "https://api.github.com/users/matthewjasper/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthewjasper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthewjasper/subscriptions", "organizations_url": "https://api.github.com/users/matthewjasper/orgs", "repos_url": "https://api.github.com/users/matthewjasper/repos", "events_url": "https://api.github.com/users/matthewjasper/events{/privacy}", "received_events_url": "https://api.github.com/users/matthewjasper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6de4ec679d7179251bef205427d52d093c40a787", "url": "https://api.github.com/repos/rust-lang/rust/commits/6de4ec679d7179251bef205427d52d093c40a787", "html_url": "https://github.com/rust-lang/rust/commit/6de4ec679d7179251bef205427d52d093c40a787"}], "stats": {"total": 87, "additions": 82, "deletions": 5}, "files": [{"sha": "cdf20bdafadc40024990d6035823f5c416126b24", "filename": "src/librustc_traits/util.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/b83daea479ceee19445058001ed0a6412ec25889/src%2Flibrustc_traits%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b83daea479ceee19445058001ed0a6412ec25889/src%2Flibrustc_traits%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_traits%2Futil.rs?ref=b83daea479ceee19445058001ed0a6412ec25889", "patch": "@@ -74,17 +74,19 @@ where\n         let mut outlives: Vec<_> = constraints\n             .into_iter()\n             .map(|(k, _)| match *k {\n+                // Swap regions because we are going from sub (<=) to outlives\n+                // (>=).\n                 Constraint::VarSubVar(v1, v2) => ty::OutlivesPredicate(\n-                    tcx.mk_region(ty::ReVar(v1)).into(),\n-                    tcx.mk_region(ty::ReVar(v2)),\n+                    tcx.mk_region(ty::ReVar(v2)).into(),\n+                    tcx.mk_region(ty::ReVar(v1)),\n                 ),\n                 Constraint::VarSubReg(v1, r2) => {\n-                    ty::OutlivesPredicate(tcx.mk_region(ty::ReVar(v1)).into(), r2)\n+                    ty::OutlivesPredicate(r2.into(), tcx.mk_region(ty::ReVar(v1)))\n                 }\n                 Constraint::RegSubVar(r1, v2) => {\n-                    ty::OutlivesPredicate(r1.into(), tcx.mk_region(ty::ReVar(v2)))\n+                    ty::OutlivesPredicate(tcx.mk_region(ty::ReVar(v2)).into(), r1)\n                 }\n-                Constraint::RegSubReg(r1, r2) => ty::OutlivesPredicate(r1.into(), r2),\n+                Constraint::RegSubReg(r1, r2) => ty::OutlivesPredicate(r2.into(), r1),\n             })\n             .map(ty::Binder::dummy) // no bound regions in the code above\n             .collect();"}, {"sha": "65b5cc12478c8c16f012ad79d179b459561dffa9", "filename": "src/test/ui/nll/normalization-bounds-error.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/b83daea479ceee19445058001ed0a6412ec25889/src%2Ftest%2Fui%2Fnll%2Fnormalization-bounds-error.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b83daea479ceee19445058001ed0a6412ec25889/src%2Ftest%2Fui%2Fnll%2Fnormalization-bounds-error.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fnormalization-bounds-error.rs?ref=b83daea479ceee19445058001ed0a6412ec25889", "patch": "@@ -0,0 +1,26 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Check that we error when a bound from the impl is not satisfied when\n+// normalizing an associated type.\n+\n+#![feature(nll)]\n+trait Visitor<'d> {\n+    type Value;\n+}\n+\n+impl<'a, 'd: 'a> Visitor<'d> for &'a () {\n+    type Value = ();\n+}\n+\n+fn visit_seq<'d, 'a: 'd>() -> <&'a () as Visitor<'d>>::Value {}\n+//~^ ERROR\n+\n+fn main() {}"}, {"sha": "970384f9d56ff179de146ac569b5de03f989a6c7", "filename": "src/test/ui/nll/normalization-bounds-error.stderr", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/b83daea479ceee19445058001ed0a6412ec25889/src%2Ftest%2Fui%2Fnll%2Fnormalization-bounds-error.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b83daea479ceee19445058001ed0a6412ec25889/src%2Ftest%2Fui%2Fnll%2Fnormalization-bounds-error.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fnormalization-bounds-error.stderr?ref=b83daea479ceee19445058001ed0a6412ec25889", "patch": "@@ -0,0 +1,23 @@\n+error[E0495]: cannot infer an appropriate lifetime for lifetime parameter `'d` due to conflicting requirements\n+  --> $DIR/normalization-bounds-error.rs:23:1\n+   |\n+LL | fn visit_seq<'d, 'a: 'd>() -> <&'a () as Visitor<'d>>::Value {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+note: first, the lifetime cannot outlive the lifetime 'd as defined on the function body at 23:1...\n+  --> $DIR/normalization-bounds-error.rs:23:1\n+   |\n+LL | fn visit_seq<'d, 'a: 'd>() -> <&'a () as Visitor<'d>>::Value {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+note: ...but the lifetime must also be valid for the lifetime 'a as defined on the function body at 23:1...\n+  --> $DIR/normalization-bounds-error.rs:23:1\n+   |\n+LL | fn visit_seq<'d, 'a: 'd>() -> <&'a () as Visitor<'d>>::Value {}\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   = note: ...so that the types are compatible:\n+           expected Visitor<'d>\n+              found Visitor<'_>\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0495`."}, {"sha": "722a6c00e750c622073057f20ecaaa36c8cc6ef0", "filename": "src/test/ui/nll/normalization-bounds.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/b83daea479ceee19445058001ed0a6412ec25889/src%2Ftest%2Fui%2Fnll%2Fnormalization-bounds.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b83daea479ceee19445058001ed0a6412ec25889/src%2Ftest%2Fui%2Fnll%2Fnormalization-bounds.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fnormalization-bounds.rs?ref=b83daea479ceee19445058001ed0a6412ec25889", "patch": "@@ -0,0 +1,26 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// Check that lifetime bounds get checked the right way around with NLL enabled.\n+\n+//run-pass\n+\n+#![feature(nll)]\n+trait Visitor<'d> {\n+    type Value;\n+}\n+\n+impl<'a, 'd: 'a> Visitor<'d> for &'a () {\n+    type Value = ();\n+}\n+\n+fn visit_seq<'d: 'a, 'a>() -> <&'a () as Visitor<'d>>::Value {}\n+\n+fn main() {}"}]}