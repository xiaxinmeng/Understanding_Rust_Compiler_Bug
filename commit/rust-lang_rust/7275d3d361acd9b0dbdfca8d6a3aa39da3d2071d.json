{"sha": "7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcyNzVkM2QzNjFhY2Q5YjBkYmRmY2E4ZDZhM2FhMzlkYTNkMjA3MWQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-10-20T00:30:23Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-10-20T00:30:23Z"}, "message": "Auto merge of #29009 - alexcrichton:std-pkgs, r=brson\n\nThis commit splits out the standard library from the current 'rustc' package\r\ninto a new 'rust-std' package. This is the basis for the work on easily\r\npackaging compilers that can cross-compile to new targets.", "tree": {"sha": "9493f67821ff41098ed5fe610fd7ffd453e7f11a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9493f67821ff41098ed5fe610fd7ffd453e7f11a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d", "html_url": "https://github.com/rust-lang/rust/commit/7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "22581599819c2384dc2663999ab033cb7d5a0ac3", "url": "https://api.github.com/repos/rust-lang/rust/commits/22581599819c2384dc2663999ab033cb7d5a0ac3", "html_url": "https://github.com/rust-lang/rust/commit/22581599819c2384dc2663999ab033cb7d5a0ac3"}, {"sha": "4fe5932e3aabe18a293ba071d08e49f5950a9c69", "url": "https://api.github.com/repos/rust-lang/rust/commits/4fe5932e3aabe18a293ba071d08e49f5950a9c69", "html_url": "https://github.com/rust-lang/rust/commit/4fe5932e3aabe18a293ba071d08e49f5950a9c69"}], "stats": {"total": 154, "additions": 105, "deletions": 49}, "files": [{"sha": "65b08774d49a01977ebadb02fd1de6b602f73edd", "filename": "mk/cfg/mips-unknown-linux-gnu.mk", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d/mk%2Fcfg%2Fmips-unknown-linux-gnu.mk", "raw_url": "https://github.com/rust-lang/rust/raw/7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d/mk%2Fcfg%2Fmips-unknown-linux-gnu.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fcfg%2Fmips-unknown-linux-gnu.mk?ref=7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d", "patch": "@@ -7,8 +7,8 @@ CFG_LIB_NAME_mips-unknown-linux-gnu=lib$(1).so\n CFG_STATIC_LIB_NAME_mips-unknown-linux-gnu=lib$(1).a\n CFG_LIB_GLOB_mips-unknown-linux-gnu=lib$(1)-*.so\n CFG_LIB_DSYM_GLOB_mips-unknown-linux-gnu=lib$(1)-*.dylib.dSYM\n-CFG_JEMALLOC_CFLAGS_mips-unknown-linux-gnu := -mips32r2 -msoft-float -mabi=32 -mno-compact-eh $(CFLAGS)\n-CFG_GCCISH_CFLAGS_mips-unknown-linux-gnu := -Wall -g -fPIC -mips32r2 -msoft-float -mabi=32 -mno-compact-eh $(CFLAGS)\n+CFG_JEMALLOC_CFLAGS_mips-unknown-linux-gnu := -mips32r2 -msoft-float -mabi=32 $(CFLAGS)\n+CFG_GCCISH_CFLAGS_mips-unknown-linux-gnu := -Wall -g -fPIC -mips32r2 -msoft-float -mabi=32 $(CFLAGS)\n CFG_GCCISH_CXXFLAGS_mips-unknown-linux-gnu := -fno-rtti $(CXXFLAGS)\n CFG_GCCISH_LINK_FLAGS_mips-unknown-linux-gnu := -shared -fPIC -g -mips32r2 -msoft-float -mabi=32\n CFG_GCCISH_DEF_FLAG_mips-unknown-linux-gnu := -Wl,--export-dynamic,--dynamic-list=\n@@ -20,5 +20,5 @@ CFG_UNIXY_mips-unknown-linux-gnu := 1\n CFG_LDPATH_mips-unknown-linux-gnu :=\n CFG_RUN_mips-unknown-linux-gnu=\n CFG_RUN_TARG_mips-unknown-linux-gnu=\n-RUSTC_FLAGS_mips-unknown-linux-gnu := -C target-cpu=mips32r2 -C target-feature=\"+mips32r2,+o32\" -C soft-float\n+RUSTC_FLAGS_mips-unknown-linux-gnu := -C target-cpu=mips32r2 -C target-feature=\"+mips32r2\" -C soft-float\n CFG_GNU_TRIPLE_mips-unknown-linux-gnu := mips-unknown-linux-gnu"}, {"sha": "4dadfc275d3c5a518021e059ce0570c399f0c2ea", "filename": "mk/cfg/mipsel-unknown-linux-gnu.mk", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d/mk%2Fcfg%2Fmipsel-unknown-linux-gnu.mk", "raw_url": "https://github.com/rust-lang/rust/raw/7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d/mk%2Fcfg%2Fmipsel-unknown-linux-gnu.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fcfg%2Fmipsel-unknown-linux-gnu.mk?ref=7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d", "patch": "@@ -1,8 +1,8 @@\n # mipsel-unknown-linux-gnu configuration\n-CC_mipsel-unknown-linux-gnu=mipsel-unknown-linux-gnu-gcc\n-CXX_mipsel-unknown-linux-gnu=mipsel-unknown-linux-gnu-g++\n-CPP_mipsel-unknown-linux-gnu=mipsel-unknown-linux-gnu-gcc\n-AR_mipsel-unknown-linux-gnu=mipsel-unknown-linux-gnu-ar\n+CC_mipsel-unknown-linux-gnu=mipsel-linux-gnu-gcc\n+CXX_mipsel-unknown-linux-gnu=mipsel-linux-gnu-g++\n+CPP_mipsel-unknown-linux-gnu=mipsel-linux-gnu-gcc\n+AR_mipsel-unknown-linux-gnu=mipsel-linux-gnu-ar\n CFG_LIB_NAME_mipsel-unknown-linux-gnu=lib$(1).so\n CFG_STATIC_LIB_NAME_mipsel-unknown-linux-gnu=lib$(1).a\n CFG_LIB_GLOB_mipsel-unknown-linux-gnu=lib$(1)-*.so\n@@ -20,5 +20,5 @@ CFG_UNIXY_mipsel-unknown-linux-gnu := 1\n CFG_LDPATH_mipsel-unknown-linux-gnu :=\n CFG_RUN_mipsel-unknown-linux-gnu=\n CFG_RUN_TARG_mipsel-unknown-linux-gnu=\n-RUSTC_FLAGS_mipsel-unknown-linux-gnu := -C target-cpu=mips32 -C target-feature=\"+mips32,+o32\"\n+RUSTC_FLAGS_mipsel-unknown-linux-gnu := -C target-cpu=mips32 -C target-feature=\"+mips32\"\n CFG_GNU_TRIPLE_mipsel-unknown-linux-gnu := mipsel-unknown-linux-gnu"}, {"sha": "eb94760e248f6ebea7df728c78e017d7adb7ffeb", "filename": "mk/dist.mk", "status": "modified", "additions": 73, "deletions": 27, "changes": 100, "blob_url": "https://github.com/rust-lang/rust/blob/7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d/mk%2Fdist.mk", "raw_url": "https://github.com/rust-lang/rust/raw/7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d/mk%2Fdist.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fdist.mk?ref=7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d", "patch": "@@ -21,6 +21,7 @@\n # * dist-docs - Stage docs for upload\n \n PKG_NAME := $(CFG_PACKAGE_NAME)\n+STD_PKG_NAME := rust-std-$(CFG_PACKAGE_VERS)\n DOC_PKG_NAME := rust-docs-$(CFG_PACKAGE_VERS)\n MINGW_PKG_NAME := rust-mingw-$(CFG_PACKAGE_VERS)\n \n@@ -112,19 +113,25 @@ distcheck-tar-src: dist-tar-src\n # Unix binary installer tarballs\n ######################################################################\n \n-define DEF_INSTALLER\n+define DEF_START_INSTALLER\n+dist-install-dir-$(1)-%: PREPARE_DIR_CMD=$(DEFAULT_PREPARE_DIR_CMD)\n+dist-install-dir-$(1)-%: PREPARE_BIN_CMD=$(DEFAULT_PREPARE_BIN_CMD)\n+dist-install-dir-$(1)-%: PREPARE_LIB_CMD=$(DEFAULT_PREPARE_LIB_CMD)\n+dist-install-dir-$(1)-%: PREPARE_MAN_CMD=$(DEFAULT_PREPARE_MAN_CMD)\n+dist-install-dir-$(1)-%: PREPARE_CLEAN=true\n \n $$(eval $$(call DEF_PREPARE,dir-$(1)))\n+endef\n+\n+$(foreach target,$(CFG_TARGET),\\\n+  $(eval $(call DEF_START_INSTALLER,$(target))))\n \n-dist-install-dir-$(1): PREPARE_HOST=$(1)\n-dist-install-dir-$(1): PREPARE_TARGETS=$(2)\n-dist-install-dir-$(1): PREPARE_DEST_DIR=tmp/dist/$$(PKG_NAME)-$(1)-image\n-dist-install-dir-$(1): PREPARE_DIR_CMD=$(DEFAULT_PREPARE_DIR_CMD)\n-dist-install-dir-$(1): PREPARE_BIN_CMD=$(DEFAULT_PREPARE_BIN_CMD)\n-dist-install-dir-$(1): PREPARE_LIB_CMD=$(DEFAULT_PREPARE_LIB_CMD)\n-dist-install-dir-$(1): PREPARE_MAN_CMD=$(DEFAULT_PREPARE_MAN_CMD)\n-dist-install-dir-$(1): PREPARE_CLEAN=true\n-dist-install-dir-$(1): prepare-base-dir-$(1) docs\n+define DEF_INSTALLER\n+\n+dist-install-dir-$(1)-host: PREPARE_HOST=$(1)\n+dist-install-dir-$(1)-host: PREPARE_TARGETS=$(2)\n+dist-install-dir-$(1)-host: PREPARE_DEST_DIR=tmp/dist/$$(PKG_NAME)-$(1)-image\n+dist-install-dir-$(1)-host: prepare-base-dir-$(1)-host docs\n \t$$(Q)mkdir -p $$(PREPARE_DEST_DIR)/share/doc/rust\n \t$$(Q)$$(PREPARE_MAN_CMD) $$(S)COPYRIGHT $$(PREPARE_DEST_DIR)/share/doc/rust\n \t$$(Q)$$(PREPARE_MAN_CMD) $$(S)LICENSE-APACHE $$(PREPARE_DEST_DIR)/share/doc/rust\n@@ -141,14 +148,27 @@ prepare-overlay-$(1):\n # This tiny morsel of metadata is used by rust-packaging\n \t$$(Q)echo \"$(CFG_VERSION)\" > tmp/dist/$$(PKG_NAME)-$(1)-overlay/version\n \n-dist/$$(PKG_NAME)-$(1).tar.gz: dist-install-dir-$(1) prepare-overlay-$(1)\n+dist/$$(PKG_NAME)-$(1).tar.gz: dist-install-dir-$(1)-host prepare-overlay-$(1)\n \t@$(call E, build: $$@)\n-# Copy essential gcc components into installer\n-ifdef CFG_WINDOWSY_$(1)\n-ifeq ($$(findstring gnu,$(1)),gnu)\n-\t$$(Q)rm -Rf tmp/dist/win-rust-gcc-$(1)\n-\t$$(Q)$$(CFG_PYTHON) $$(S)src/etc/make-win-dist.py tmp/dist/$$(PKG_NAME)-$(1)-image tmp/dist/win-rust-gcc-$(1) $(1)\n-\t$$(Q)cp -r $$(S)src/etc/third-party tmp/dist/$$(PKG_NAME)-$(1)-image/share/doc/\n+# On a 32-bit MinGW target we've got a few runtime DLL dependencies that we need\n+# to include. THe first argument to `make-win-dist` is where to put these DLLs\n+# (the image we're creating) and the second argument is a junk directory to\n+# ignore all the other MinGW stuff the script creates.\n+ifeq ($(2),i686-pc-windows-gnu)\n+\t$$(Q)rm -Rf tmp/dist/win-rust-gcc-$(2)\n+\t$$(Q)$$(CFG_PYTHON) $$(S)src/etc/make-win-dist.py \\\n+\t\ttmp/dist/$$(STD_PKG_NAME)-$(2)-image \\\n+\t\ttmp/dist/win-rust-gcc-$(2) $(2)\n+endif\n+# On 32-bit MinGW we're always including a DLL which needs some extra licenses\n+# to distribute. On 64-bit MinGW we don't actually distribute anything requiring\n+# us to distribute a license but it's likely that the install will *also*\n+# include the rust-mingw package down below, which also need licenses, so to be\n+# safe we just inlude it here in all MinGW packages.\n+ifdef CFG_WINDOWSY_$(2)\n+ifeq ($$(findstring $(2),gnu),gnu)\n+\t$$(Q)cp -r $$(S)src/etc/third-party \\\n+\t\ttmp/dist/$$(STD_PKG_NAME)-$(2)-image/share/doc/\n endif\n endif\n \t$$(Q)$$(S)src/rust-installer/gen-installer.sh \\\n@@ -183,11 +203,16 @@ dist/$$(DOC_PKG_NAME)-$(1).tar.gz: dist-doc-install-dir-$(1)\n \t\t--bulk-dirs=share/doc/rust/html\n \t$$(Q)rm -R tmp/dist/$$(DOC_PKG_NAME)-$(1)-image\n \n+# Creates the rust-mingw package, and the first argument to make-win-dist is a\n+# \"temporary directory\" which is just thrown away (this contains the runtime\n+# DLLs included in the rustc package above) and the second argument is where to\n+# place all the MinGW components (which is what we want).\n dist-mingw-install-dir-$(1):\n \t$$(Q)mkdir -p tmp/dist/rust-mingw-tmp-$(1)-image\n \t$$(Q)rm -Rf tmp/dist/$$(MINGW_PKG_NAME)-$(1)-image\n \t$$(Q)$$(CFG_PYTHON) $$(S)src/etc/make-win-dist.py \\\n-\t\ttmp/dist/rust-mingw-tmp-$(1)-image tmp/dist/$$(MINGW_PKG_NAME)-$(1)-image $(1)\n+\t\ttmp/dist/rust-mingw-tmp-$(1)-image \\\n+\t\ttmp/dist/$$(MINGW_PKG_NAME)-$(1)-image $(1)\n \n dist/$$(MINGW_PKG_NAME)-$(1).tar.gz: dist-mingw-install-dir-$(1)\n \t@$(call E, build: $$@)\n@@ -205,15 +230,34 @@ dist/$$(MINGW_PKG_NAME)-$(1).tar.gz: dist-mingw-install-dir-$(1)\n \n endef\n \n-ifneq ($(CFG_ENABLE_DIST_HOST_ONLY),)\n-$(foreach host,$(CFG_HOST),\\\n-  $(eval $(call DEF_INSTALLER,$(host),$(host))))\n-else\n-$(foreach host,$(CFG_HOST),\\\n-  $(eval $(call DEF_INSTALLER,$(host),$(CFG_TARGET))))\n-endif\n+# $(1) - host\n+# $(2) - target\n+define DEF_INSTALLER_TARGETS\n+\n+dist-install-dir-$(2)-target: PREPARE_HOST=$(1)\n+dist-install-dir-$(2)-target: PREPARE_TARGETS=$(2)\n+dist-install-dir-$(2)-target: PREPARE_DEST_DIR=tmp/dist/$$(STD_PKG_NAME)-$(2)-image\n+dist-install-dir-$(2)-target: prepare-base-dir-$(2)-target\n \n-dist-install-dirs: $(foreach host,$(CFG_HOST),dist-install-dir-$(host))\n+dist/$$(STD_PKG_NAME)-$(2).tar.gz: dist-install-dir-$(2)-target\n+\t@$$(call E, build: $$@)\n+\t$$(Q)$$(S)src/rust-installer/gen-installer.sh \\\n+\t\t--product-name=Rust \\\n+\t\t--rel-manifest-dir=rustlib \\\n+\t\t--success-message=std-is-standing-at-the-ready. \\\n+\t\t--image-dir=tmp/dist/$$(STD_PKG_NAME)-$(2)-image \\\n+\t\t--work-dir=tmp/dist \\\n+\t\t--output-dir=dist \\\n+\t\t--package-name=$$(STD_PKG_NAME)-$(2) \\\n+\t\t--component-name=rust-std-$(2) \\\n+\t\t--legacy-manifest-dirs=rustlib,cargo\n+\t$$(Q)rm -R tmp/dist/$$(STD_PKG_NAME)-$(2)-image\n+endef\n+\n+$(foreach host,$(CFG_HOST),\\\n+  $(eval $(call DEF_INSTALLER,$(host))))\n+$(foreach target,$(CFG_TARGET),\\\n+  $(eval $(call DEF_INSTALLER_TARGETS,$(CFG_BUILD),$(target))))\n \n ifdef CFG_WINDOWSY_$(CFG_BUILD)\n define BUILD_MINGW_TARBALL\n@@ -230,7 +274,9 @@ ifeq ($(CFG_DISABLE_DOCS),)\n MAYBE_DOC_TARBALLS=$(foreach host,$(CFG_HOST),dist/$(DOC_PKG_NAME)-$(host).tar.gz)\n endif\n \n-dist-tar-bins: $(foreach host,$(CFG_HOST),dist/$(PKG_NAME)-$(host).tar.gz) \\\n+dist-tar-bins: \\\n+\t$(foreach host,$(CFG_HOST),dist/$(PKG_NAME)-$(host).tar.gz) \\\n+\t$(foreach target,$(CFG_TARGET),dist/$(STD_PKG_NAME)-$(target).tar.gz) \\\n \t$(MAYBE_DOC_TARBALLS) $(MAYBE_MINGW_TARBALLS)\n \n # Just try to run the compiler for the build host"}, {"sha": "8b8170220c9168a8db08ddf6884272cdf4346d14", "filename": "mk/install.mk", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d/mk%2Finstall.mk", "raw_url": "https://github.com/rust-lang/rust/raw/7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d/mk%2Finstall.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Finstall.mk?ref=7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d", "patch": "@@ -8,6 +8,12 @@\n # option. This file may not be copied, modified, or distributed\n # except according to those terms.\n \n+RUN_INSALLER = cd tmp/empty_dir && \\\n+\tsh ../../tmp/dist/$(1)/install.sh \\\n+\t\t--prefix=\"$(DESTDIR)$(CFG_PREFIX)\" \\\n+\t\t--libdir=\"$(DESTDIR)$(CFG_LIBDIR)\" \\\n+\t\t--mandir=\"$(DESTDIR)$(CFG_MANDIR)\"\n+\n install:\n ifeq (root user, $(USER) $(patsubst %,user,$(SUDO_USER)))\n # Build the dist as the original user\n@@ -16,9 +22,11 @@ else\n \t$(Q)$(MAKE) prepare_install\n endif\n ifeq ($(CFG_DISABLE_DOCS),)\n-\t$(Q)cd tmp/empty_dir && sh ../../tmp/dist/$(DOC_PKG_NAME)-$(CFG_BUILD)/install.sh --prefix=\"$(DESTDIR)$(CFG_PREFIX)\" --libdir=\"$(DESTDIR)$(CFG_LIBDIR)\" --mandir=\"$(DESTDIR)$(CFG_MANDIR)\"\n+\t$(Q)$(call RUN_INSALLER,$(DOC_PKG_NAME)-$(CFG_BUILD)) --disable-ldconfig\n endif\n-\t$(Q)cd tmp/empty_dir && sh ../../tmp/dist/$(PKG_NAME)-$(CFG_BUILD)/install.sh --prefix=\"$(DESTDIR)$(CFG_PREFIX)\" --libdir=\"$(DESTDIR)$(CFG_LIBDIR)\" --mandir=\"$(DESTDIR)$(CFG_MANDIR)\"\n+\t$(Q)$(foreach target,$(CFG_TARGET),\\\n+\t  ($(call RUN_INSALLER,$(STD_PKG_NAME)-$(target)) --disable-ldconfig);)\n+\t$(Q)$(call RUN_INSALLER,$(PKG_NAME)-$(CFG_BUILD))\n # Remove tmp files because it's a decent amount of disk space\n \t$(Q)rm -R tmp/dist\n \n@@ -32,9 +40,11 @@ else\n \t$(Q)$(MAKE) prepare_uninstall\n endif\n ifeq ($(CFG_DISABLE_DOCS),)\n-\t$(Q)cd tmp/empty_dir && sh ../../tmp/dist/$(DOC_PKG_NAME)-$(CFG_BUILD)/install.sh --uninstall --prefix=\"$(DESTDIR)$(CFG_PREFIX)\" --libdir=\"$(DESTDIR)$(CFG_LIBDIR)\" --mandir=\"$(DESTDIR)$(CFG_MANDIR)\"\n+\t$(Q)$(call RUN_INSALLER,$(DOC_PKG_NAME)-$(CFG_BUILD)) --uninstall\n endif\n-\t$(Q)cd tmp/empty_dir && sh ../../tmp/dist/$(PKG_NAME)-$(CFG_BUILD)/install.sh --uninstall --prefix=\"$(DESTDIR)$(CFG_PREFIX)\" --libdir=\"$(DESTDIR)$(CFG_LIBDIR)\" --mandir=\"$(DESTDIR)$(CFG_MANDIR)\"\n+\t$(Q)$(call RUN_INSALLER,$(PKG_NAME)-$(CFG_BUILD)) --uninstall\n+\t$(Q)$(foreach target,$(CFG_TARGET),\\\n+\t  ($(call RUN_INSALLER,$(STD_PKG_NAME)-$(target)) --uninstall);)\n # Remove tmp files because it's a decent amount of disk space\n \t$(Q)rm -R tmp/dist\n "}, {"sha": "e263a6d2e4d32ab6c13c9d8484cfa3fa9c8295a6", "filename": "mk/prepare.mk", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d/mk%2Fprepare.mk", "raw_url": "https://github.com/rust-lang/rust/raw/7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d/mk%2Fprepare.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fprepare.mk?ref=7275d3d361acd9b0dbdfca8d6a3aa39da3d2071d", "patch": "@@ -185,16 +185,16 @@ INSTALL_DEBUGGER_SCRIPT_COMMANDS=$(if $(findstring windows,$(1)),\\\n \n define DEF_PREPARE\n \n-prepare-base-$(1): PREPARE_SOURCE_DIR=$$(PREPARE_HOST)/stage$$(PREPARE_STAGE)\n-prepare-base-$(1): PREPARE_SOURCE_BIN_DIR=$$(PREPARE_SOURCE_DIR)/bin\n-prepare-base-$(1): PREPARE_SOURCE_LIB_DIR=$$(PREPARE_SOURCE_DIR)/$$(CFG_LIBDIR_RELATIVE)\n-prepare-base-$(1): PREPARE_SOURCE_MAN_DIR=$$(S)/man\n-prepare-base-$(1): PREPARE_DEST_BIN_DIR=$$(PREPARE_DEST_DIR)/bin\n-prepare-base-$(1): PREPARE_DEST_LIB_DIR=$$(PREPARE_DEST_DIR)/$$(CFG_LIBDIR_RELATIVE)\n-prepare-base-$(1): PREPARE_DEST_MAN_DIR=$$(PREPARE_DEST_DIR)/share/man/man1\n-prepare-base-$(1): prepare-everything-$(1)\n+prepare-base-$(1)-%: PREPARE_SOURCE_DIR=$$(PREPARE_HOST)/stage$$(PREPARE_STAGE)\n+prepare-base-$(1)-%: PREPARE_SOURCE_BIN_DIR=$$(PREPARE_SOURCE_DIR)/bin\n+prepare-base-$(1)-%: PREPARE_SOURCE_LIB_DIR=$$(PREPARE_SOURCE_DIR)/$$(CFG_LIBDIR_RELATIVE)\n+prepare-base-$(1)-%: PREPARE_SOURCE_MAN_DIR=$$(S)/man\n+prepare-base-$(1)-%: PREPARE_DEST_BIN_DIR=$$(PREPARE_DEST_DIR)/bin\n+prepare-base-$(1)-%: PREPARE_DEST_LIB_DIR=$$(PREPARE_DEST_DIR)/$$(CFG_LIBDIR_RELATIVE)\n+prepare-base-$(1)-%: PREPARE_DEST_MAN_DIR=$$(PREPARE_DEST_DIR)/share/man/man1\n \n-prepare-everything-$(1): prepare-host-$(1) prepare-targets-$(1) prepare-debugger-scripts-$(1)\n+prepare-base-$(1)-target: prepare-target-$(1)\n+prepare-base-$(1)-host: prepare-host-$(1) prepare-debugger-scripts-$(1)\n \n prepare-host-$(1): prepare-host-tools-$(1)\n \n@@ -222,7 +222,7 @@ $$(foreach lib,$$(CRATES), \\\n   $$(foreach host,$$(CFG_HOST), \\\n     $$(eval $$(call DEF_PREPARE_HOST_LIB,$$(lib),$$(PREPARE_STAGE),$$(host),$(1)))))\n \n-prepare-targets-$(1): \\\n+prepare-target-$(1): \\\n         $$(foreach host,$$(CFG_HOST), \\\n            $$(foreach target,$$(CFG_TARGET), \\\n              prepare-target-$$(target)-host-$$(host)-$$(PREPARE_STAGE)-$(1)))"}]}