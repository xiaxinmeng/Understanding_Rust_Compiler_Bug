{"sha": "d5f1f70a8e8d3f54230fe07eb0a79002161b2788", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ1ZjFmNzBhOGU4ZDNmNTQyMzBmZTA3ZWIwYTc5MDAyMTYxYjI3ODg=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-07-29T22:07:39Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-07-30T18:57:27Z"}, "message": "Fix Alias intra doc ICE", "tree": {"sha": "423a13e4a3479daafc0cf3c37c37ce3ad62ab8d7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/423a13e4a3479daafc0cf3c37c37ce3ad62ab8d7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d5f1f70a8e8d3f54230fe07eb0a79002161b2788", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d5f1f70a8e8d3f54230fe07eb0a79002161b2788", "html_url": "https://github.com/rust-lang/rust/commit/d5f1f70a8e8d3f54230fe07eb0a79002161b2788", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d5f1f70a8e8d3f54230fe07eb0a79002161b2788/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "75af9df71b9eea84f281cf7de72c3e3cc2b02222", "url": "https://api.github.com/repos/rust-lang/rust/commits/75af9df71b9eea84f281cf7de72c3e3cc2b02222", "html_url": "https://github.com/rust-lang/rust/commit/75af9df71b9eea84f281cf7de72c3e3cc2b02222"}], "stats": {"total": 73, "additions": 50, "deletions": 23}, "files": [{"sha": "e019b26dd1dd9a3013646061943347d16bf1235f", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 19, "deletions": 21, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/d5f1f70a8e8d3f54230fe07eb0a79002161b2788/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d5f1f70a8e8d3f54230fe07eb0a79002161b2788/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=d5f1f70a8e8d3f54230fe07eb0a79002161b2788", "patch": "@@ -1197,7 +1197,8 @@ fn resolve(cx: &DocContext, path_str: &str, is_val: bool) -> Result<(Def, Option\n         })?;\n         match ty.def {\n             Def::Struct(did) | Def::Union(did) | Def::Enum(did) | Def::TyAlias(did) => {\n-                let item = cx.tcx.inherent_impls(did).iter()\n+                let item = cx.tcx.inherent_impls(did)\n+                                 .iter()\n                                  .flat_map(|imp| cx.tcx.associated_items(*imp))\n                                  .find(|item| item.ident.name == item_name);\n                 if let Some(item) = item {\n@@ -1208,26 +1209,23 @@ fn resolve(cx: &DocContext, path_str: &str, is_val: bool) -> Result<(Def, Option\n                     };\n                     Ok((ty.def, Some(format!(\"{}.{}\", out, item_name))))\n                 } else {\n-                    let is_enum = match ty.def {\n-                        Def::Enum(_) => true,\n-                        _ => false,\n-                    };\n-                    let elem = if is_enum {\n-                        cx.tcx.adt_def(did).all_fields().find(|item| item.ident.name == item_name)\n-                    } else {\n-                        cx.tcx.adt_def(did)\n-                              .non_enum_variant()\n-                              .fields\n-                              .iter()\n-                              .find(|item| item.ident.name == item_name)\n-                    };\n-                    if let Some(item) = elem {\n-                        Ok((ty.def,\n-                            Some(format!(\"{}.{}\",\n-                                         if is_enum { \"variant\" } else { \"structfield\" },\n-                                         item.ident))))\n-                    } else {\n-                        Err(())\n+                    match cx.tcx.type_of(did).sty {\n+                        ty::TyAdt(def, _) => {\n+                            if let Some(item) = def.all_fields()\n+                                                   .find(|item| item.ident.name == item_name) {\n+                                Ok((ty.def,\n+                                    Some(format!(\"{}.{}\",\n+                                                 if def.is_enum() {\n+                                                     \"variant\"\n+                                                 } else {\n+                                                     \"structfield\"\n+                                                 },\n+                                                 item.ident))))\n+                            } else {\n+                                Err(())\n+                            }\n+                        }\n+                        _ => Err(()),\n                     }\n                 }\n             }"}, {"sha": "287913d2cc9b88f7e06ac25b0eaa6173949c725d", "filename": "src/librustdoc/visit_ast.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d5f1f70a8e8d3f54230fe07eb0a79002161b2788/src%2Flibrustdoc%2Fvisit_ast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d5f1f70a8e8d3f54230fe07eb0a79002161b2788/src%2Flibrustdoc%2Fvisit_ast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fvisit_ast.rs?ref=d5f1f70a8e8d3f54230fe07eb0a79002161b2788", "patch": "@@ -105,8 +105,8 @@ impl<'a, 'tcx, 'rcx> RustdocVisitor<'a, 'tcx, 'rcx> {\n     }\n \n     pub fn visit_variant_data(&mut self, item: &hir::Item,\n-                            name: ast::Name, sd: &hir::VariantData,\n-                            generics: &hir::Generics) -> Struct {\n+                              name: ast::Name, sd: &hir::VariantData,\n+                              generics: &hir::Generics) -> Struct {\n         debug!(\"Visiting struct\");\n         let struct_type = struct_type_from_def(&*sd);\n         Struct {"}, {"sha": "a459ab5dd2bea058b2079b2100caf526f97c59db", "filename": "src/test/rustdoc-ui/intra-doc-alias-ice.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/d5f1f70a8e8d3f54230fe07eb0a79002161b2788/src%2Ftest%2Frustdoc-ui%2Fintra-doc-alias-ice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d5f1f70a8e8d3f54230fe07eb0a79002161b2788/src%2Ftest%2Frustdoc-ui%2Fintra-doc-alias-ice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-doc-alias-ice.rs?ref=d5f1f70a8e8d3f54230fe07eb0a79002161b2788", "patch": "@@ -0,0 +1,16 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![deny(intra_doc_link_resolution_failure)]\n+\n+pub type TypeAlias = usize;\n+\n+/// [broken cross-reference](TypeAlias::hoge) //~ ERROR\n+pub fn some_public_item() {}"}, {"sha": "231963976ea75958bb59f9d2b9801c0f07b738fb", "filename": "src/test/rustdoc-ui/intra-doc-alias-ice.stderr", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/d5f1f70a8e8d3f54230fe07eb0a79002161b2788/src%2Ftest%2Frustdoc-ui%2Fintra-doc-alias-ice.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d5f1f70a8e8d3f54230fe07eb0a79002161b2788/src%2Ftest%2Frustdoc-ui%2Fintra-doc-alias-ice.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-doc-alias-ice.stderr?ref=d5f1f70a8e8d3f54230fe07eb0a79002161b2788", "patch": "@@ -0,0 +1,13 @@\n+error: `[TypeAlias::hoge]` cannot be resolved, ignoring it...\n+  --> $DIR/intra-doc-alias-ice.rs:15:30\n+   |\n+15 | /// [broken cross-reference](TypeAlias::hoge) //~ ERROR\n+   |                              ^^^^^^^^^^^^^^^ cannot be resolved, ignoring\n+   |\n+note: lint level defined here\n+  --> $DIR/intra-doc-alias-ice.rs:11:9\n+   |\n+11 | #![deny(intra_doc_link_resolution_failure)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   = help: to escape `[` and `]` characters, just add '/' before them like `/[` or `/]`\n+"}]}