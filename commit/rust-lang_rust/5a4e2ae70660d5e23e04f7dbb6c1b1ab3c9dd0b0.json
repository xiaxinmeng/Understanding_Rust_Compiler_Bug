{"sha": "5a4e2ae70660d5e23e04f7dbb6c1b1ab3c9dd0b0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVhNGUyYWU3MDY2MGQ1ZTIzZTA0ZjdkYmI2YzFiMWFiM2M5ZGQwYjA=", "commit": {"author": {"name": "Eric Holk", "email": "eric.holk@gmail.com", "date": "2012-05-21T23:26:28Z"}, "committer": {"name": "Eric Holk", "email": "eric.holk@gmail.com", "date": "2012-05-22T22:31:39Z"}, "message": "More unsafe pointers to share immutable structures between tasks. This version has a 2.8 to 3x speedup!", "tree": {"sha": "4f7b7ba00b52d0f74f1198e080e01e66cd6fc114", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4f7b7ba00b52d0f74f1198e080e01e66cd6fc114"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5a4e2ae70660d5e23e04f7dbb6c1b1ab3c9dd0b0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5a4e2ae70660d5e23e04f7dbb6c1b1ab3c9dd0b0", "html_url": "https://github.com/rust-lang/rust/commit/5a4e2ae70660d5e23e04f7dbb6c1b1ab3c9dd0b0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5a4e2ae70660d5e23e04f7dbb6c1b1ab3c9dd0b0/comments", "author": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eholk", "id": 105766, "node_id": "MDQ6VXNlcjEwNTc2Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/105766?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eholk", "html_url": "https://github.com/eholk", "followers_url": "https://api.github.com/users/eholk/followers", "following_url": "https://api.github.com/users/eholk/following{/other_user}", "gists_url": "https://api.github.com/users/eholk/gists{/gist_id}", "starred_url": "https://api.github.com/users/eholk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eholk/subscriptions", "organizations_url": "https://api.github.com/users/eholk/orgs", "repos_url": "https://api.github.com/users/eholk/repos", "events_url": "https://api.github.com/users/eholk/events{/privacy}", "received_events_url": "https://api.github.com/users/eholk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7f05f088c7e47442e6fee4bfc519227b814b39a4", "url": "https://api.github.com/repos/rust-lang/rust/commits/7f05f088c7e47442e6fee4bfc519227b814b39a4", "html_url": "https://github.com/rust-lang/rust/commit/7f05f088c7e47442e6fee4bfc519227b814b39a4"}], "stats": {"total": 36, "additions": 20, "deletions": 16}, "files": [{"sha": "f1e150d1a99395c2d5c9573d13781d24bb1f98e4", "filename": "src/test/bench/graph500-bfs.rs", "status": "modified", "additions": 20, "deletions": 16, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/5a4e2ae70660d5e23e04f7dbb6c1b1ab3c9dd0b0/src%2Ftest%2Fbench%2Fgraph500-bfs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5a4e2ae70660d5e23e04f7dbb6c1b1ab3c9dd0b0/src%2Ftest%2Fbench%2Fgraph500-bfs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fbench%2Fgraph500-bfs.rs?ref=5a4e2ae70660d5e23e04f7dbb6c1b1ab3c9dd0b0", "patch": "@@ -261,6 +261,7 @@ fn pbfs(graph: graph, key: node_id) -> bfs_result {\n         }\n     };\n \n+    #[inline(always)]\n     fn is_gray(c: color) -> bool {\n         alt c {\n           gray(_) { true }\n@@ -274,25 +275,28 @@ fn pbfs(graph: graph, key: node_id) -> bfs_result {\n         log(info, #fmt(\"PBFS iteration %?\", i));\n         i += 1u;\n         let old_len = colors.len();\n-        colors = par::mapi(colors) {|i, c, copy colors|\n+        let pc = ptr::addr_of(colors);\n+        let pg = ptr::addr_of(graph);\n+        colors = par::mapi(colors) {|i, c|\n             let c : color = c;\n             alt c {\n               white {\n-                let i = i as node_id;\n-                \n-                let neighbors = graph[i];\n-                \n-                let mut color = white;\n-\n-                neighbors.each() {|k|\n-                    if is_gray(colors[k]) {\n-                        color = gray(k);\n-                        false\n-                    }\n-                    else { true }\n-                };\n-\n-                color\n+                unsafe {\n+                    let i = i as node_id;\n+                    \n+                    let neighbors = &(*pg)[i];\n+                    \n+                    let mut color = white;\n+                    \n+                    (*neighbors).each() {|k|\n+                        if is_gray((*pc)[k]) {\n+                            color = gray(k);\n+                            false\n+                        }\n+                        else { true }\n+                    };\n+                    color\n+                }\n               }\n               gray(parent) { black(parent) }\n               black(parent) { black(parent) }"}]}