{"sha": "73963eae9a37d16bab872f3ffc9bdcc1b4567c00", "node_id": "MDY6Q29tbWl0NzI0NzEyOjczOTYzZWFlOWEzN2QxNmJhYjg3MmYzZmZjOWJkY2MxYjQ1NjdjMDA=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-07-07T19:43:08Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-07-07T20:31:11Z"}, "message": "Refactor tyencode::ty_str to not require a tyencode::ctxt\n\nAll users were constructing the context the same way.", "tree": {"sha": "827841ffa950c35c3b4a82453e2add0f32f193e6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/827841ffa950c35c3b4a82453e2add0f32f193e6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/73963eae9a37d16bab872f3ffc9bdcc1b4567c00", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/73963eae9a37d16bab872f3ffc9bdcc1b4567c00", "html_url": "https://github.com/rust-lang/rust/commit/73963eae9a37d16bab872f3ffc9bdcc1b4567c00", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/73963eae9a37d16bab872f3ffc9bdcc1b4567c00/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4304f8d4f6d9e4e7a7877baabd93b8895fb809b2", "url": "https://api.github.com/repos/rust-lang/rust/commits/4304f8d4f6d9e4e7a7877baabd93b8895fb809b2", "html_url": "https://github.com/rust-lang/rust/commit/4304f8d4f6d9e4e7a7877baabd93b8895fb809b2"}], "stats": {"total": 16, "additions": 6, "deletions": 10}, "files": [{"sha": "a77688db91486de8aededb5ab54ff29e2e15382b", "filename": "src/comp/back/link.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/73963eae9a37d16bab872f3ffc9bdcc1b4567c00/src%2Fcomp%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73963eae9a37d16bab872f3ffc9bdcc1b4567c00/src%2Fcomp%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fback%2Flink.rs?ref=73963eae9a37d16bab872f3ffc9bdcc1b4567c00", "patch": "@@ -401,17 +401,13 @@ fn symbol_hash(ty::ctxt tcx, sha1 sha, &ty::t t,\n     // NB: do *not* use abbrevs here as we want the symbol names\n     // to be independent of one another in the crate.\n \n-    auto cx =\n-        @rec(ds=metadata::encoder::def_to_str,\n-             tcx=tcx,\n-             abbrevs=metadata::tyencode::ac_no_abbrevs);\n     sha.reset();\n     sha.input_str(link_meta.name);\n     sha.input_str(\"-\");\n     // FIXME: This wants to be link_meta.meta_hash\n     sha.input_str(link_meta.name);\n     sha.input_str(\"-\");\n-    sha.input_str(metadata::tyencode::ty_str(cx, t));\n+    sha.input_str(metadata::tyencode::ty_str(tcx, t));\n     auto hash = truncated_sha1_result(sha);\n     // Prefix with _ so that it never blends into adjacent digits\n "}, {"sha": "36b7bc7711efdc44b43edc62c64d13e99d645e05", "filename": "src/comp/metadata/tyencode.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/73963eae9a37d16bab872f3ffc9bdcc1b4567c00/src%2Fcomp%2Fmetadata%2Ftyencode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73963eae9a37d16bab872f3ffc9bdcc1b4567c00/src%2Fcomp%2Fmetadata%2Ftyencode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmetadata%2Ftyencode.rs?ref=73963eae9a37d16bab872f3ffc9bdcc1b4567c00", "patch": "@@ -36,8 +36,10 @@ fn cx_uses_abbrevs(&@ctxt cx) -> bool {\n         case (ac_use_abbrevs(_)) { ret true; }\n     }\n }\n-fn ty_str(&@ctxt cx, &ty::t t) -> str {\n-    assert (!cx_uses_abbrevs(cx));\n+fn ty_str(&ty::ctxt tcx, &ty::t t) -> str {\n+    auto cx = @rec(ds = encoder::def_to_str,\n+                   tcx = tcx,\n+                   abbrevs = metadata::tyencode::ac_no_abbrevs);\n     auto sw = io::string_writer();\n     enc_ty(sw.get_writer(), cx, t);\n     ret sw.get_str();"}, {"sha": "3d0d78f2ffc11ef33f745d82a31799ac9b8dcd39", "filename": "src/comp/util/ppaux.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/73963eae9a37d16bab872f3ffc9bdcc1b4567c00/src%2Fcomp%2Futil%2Fppaux.rs", "raw_url": "https://github.com/rust-lang/rust/raw/73963eae9a37d16bab872f3ffc9bdcc1b4567c00/src%2Fcomp%2Futil%2Fppaux.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Futil%2Fppaux.rs?ref=73963eae9a37d16bab872f3ffc9bdcc1b4567c00", "patch": "@@ -151,9 +151,7 @@ fn ty_to_str(&ctxt cx, &t typ) -> str {\n }\n \n fn ty_to_short_str(&ctxt cx, t typ) -> str {\n-    auto f = metadata::encoder::def_to_str;\n-    auto ecx = @rec(ds=f, tcx=cx, abbrevs=metadata::tyencode::ac_no_abbrevs);\n-    auto s = metadata::tyencode::ty_str(ecx, typ);\n+    auto s = metadata::tyencode::ty_str(cx, typ);\n     if (str::byte_len(s) >= 32u) { s = str::substr(s, 0u, 32u); }\n     ret s;\n }"}]}