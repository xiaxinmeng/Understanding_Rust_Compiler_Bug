{"sha": "a7b9488599494a0c91ab18a169aaab476a274177", "node_id": "C_kwDOAAsO6NoAKGE3Yjk0ODg1OTk0OTRhMGM5MWFiMThhMTY5YWFhYjQ3NmEyNzQxNzc", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2023-03-07T14:06:21Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-03-07T14:06:21Z"}, "message": "Rollup merge of #108619 - jyn514:llvm-version-check, r=cuviper\n\nRemove the option to disable `llvm-version-check`\n\nWe don't support old versions of LLVM; there's no reason to have an easy way to force bootstrap to use them anyway. If someone really needs to use an unsupported version, they can modify bootstrap to change the version range.\n\nr? ``@cuviper`` on whether we want to do this or not, since you maintain rust on Fedora and touched this config last.", "tree": {"sha": "c4b1c9e5bf6bb5fd76d7f1bddcb0c38efab8df25", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c4b1c9e5bf6bb5fd76d7f1bddcb0c38efab8df25"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a7b9488599494a0c91ab18a169aaab476a274177", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkB0TdCRBK7hj4Ov3rIwAArh0IAGeMY7gPpge1yHOD67AmKBTy\nNjkK4wASKiGx4PhSaHE41Zj+FYJ9MJAwAlWjmfdsnv2jdunjlC2dQK98hbQxeM/S\n0nXXgzva4z6qFNixtaNbNY2L+/vPNxMb4lOZQUZe2+wucXhWid8tcDHxznM3r59D\ngyfxmduQFQ4L1pNo55CyHEMukn7Tb+QuAKO06zfmh4Sc8PfZmSaau3DyOvkQP2YV\no35jWDULDEYCrBAvgpJ88jqqZIY7bvJKC4AUHEcCT+5+Zqw3o6Ac/0Hzzp9D7S9w\nihN3Kr0PVUyhLPaB4QgWj7CMZed7m+7RD56NDaCamdZKs0LXomf8kQYEZBGQZB4=\n=NUhg\n-----END PGP SIGNATURE-----\n", "payload": "tree c4b1c9e5bf6bb5fd76d7f1bddcb0c38efab8df25\nparent 0a3b557d528dd7c8a88ceca6f7dc0699b89a3ef4\nparent 8becfed1c984a7efbba993a64c409d0c403848cd\nauthor Yuki Okushi <jtitor@2k36.org> 1678197981 +0900\ncommitter GitHub <noreply@github.com> 1678197981 +0900\n\nRollup merge of #108619 - jyn514:llvm-version-check, r=cuviper\n\nRemove the option to disable `llvm-version-check`\n\nWe don't support old versions of LLVM; there's no reason to have an easy way to force bootstrap to use them anyway. If someone really needs to use an unsupported version, they can modify bootstrap to change the version range.\n\nr? ``@cuviper`` on whether we want to do this or not, since you maintain rust on Fedora and touched this config last.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a7b9488599494a0c91ab18a169aaab476a274177", "html_url": "https://github.com/rust-lang/rust/commit/a7b9488599494a0c91ab18a169aaab476a274177", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a7b9488599494a0c91ab18a169aaab476a274177/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0a3b557d528dd7c8a88ceca6f7dc0699b89a3ef4", "url": "https://api.github.com/repos/rust-lang/rust/commits/0a3b557d528dd7c8a88ceca6f7dc0699b89a3ef4", "html_url": "https://github.com/rust-lang/rust/commit/0a3b557d528dd7c8a88ceca6f7dc0699b89a3ef4"}, {"sha": "8becfed1c984a7efbba993a64c409d0c403848cd", "url": "https://api.github.com/repos/rust-lang/rust/commits/8becfed1c984a7efbba993a64c409d0c403848cd", "html_url": "https://github.com/rust-lang/rust/commit/8becfed1c984a7efbba993a64c409d0c403848cd"}], "stats": {"total": 15, "additions": 1, "deletions": 14}, "files": [{"sha": "a12c4e0700c8807f261fc602524f1c583415ffdf", "filename": "config.toml.example", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a7b9488599494a0c91ab18a169aaab476a274177/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/a7b9488599494a0c91ab18a169aaab476a274177/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=a7b9488599494a0c91ab18a169aaab476a274177", "patch": "@@ -75,11 +75,6 @@ changelog-seen = 2\n # or alternatively ...\n #ccache = \"/path/to/ccache\"\n \n-# If an external LLVM root is specified, we automatically check the version by\n-# default to make sure it's within the range that we're expecting, but setting\n-# this flag will indicate that this version check should not be done.\n-#version-check = true\n-\n # When true, link libstdc++ statically into the rustc_llvm.\n # This is useful if you don't want to use the dynamic version of that\n # library provided by LLVM."}, {"sha": "648eb553c78c181d84e606f278ace06f55347ccb", "filename": "src/bootstrap/CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a7b9488599494a0c91ab18a169aaab476a274177/src%2Fbootstrap%2FCHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/a7b9488599494a0c91ab18a169aaab476a274177/src%2Fbootstrap%2FCHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2FCHANGELOG.md?ref=a7b9488599494a0c91ab18a169aaab476a274177", "patch": "@@ -16,6 +16,7 @@ The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/).\n - `remote-test-server`'s `verbose` argument has been removed in favor of the `--verbose` flag\n - `remote-test-server`'s `remote` argument has been removed in favor of the `--bind` flag. Use `--bind 0.0.0.0:12345` to replicate the behavior of the `remote` argument.\n - `x.py fmt` now formats only files modified between the merge-base of HEAD and the last commit in the master branch of the rust-lang repository and the current working directory. To restore old behaviour, use `x.py fmt .`. The check mode is not affected by this change. [#105702](https://github.com/rust-lang/rust/pull/105702)\n+- The `llvm.version-check` config option has been removed. Older versions were never supported. If you still need to support older versions (e.g. you are applying custom patches), patch `check_llvm_version` in bootstrap to change the minimum version. [#108619](https://github.com/rust-lang/rust/pull/108619)\n \n ### Non-breaking changes\n "}, {"sha": "6e64bc20d20795fa095c6338455ba574e1abe143", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a7b9488599494a0c91ab18a169aaab476a274177/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7b9488599494a0c91ab18a169aaab476a274177/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=a7b9488599494a0c91ab18a169aaab476a274177", "patch": "@@ -118,7 +118,6 @@ pub struct Config {\n     pub llvm_optimize: bool,\n     pub llvm_thin_lto: bool,\n     pub llvm_release_debuginfo: bool,\n-    pub llvm_version_check: bool,\n     pub llvm_static_stdcpp: bool,\n     /// `None` if `llvm_from_ci` is true and we haven't yet downloaded llvm.\n     #[cfg(not(test))]\n@@ -672,7 +671,6 @@ define_config! {\n         tests: Option<bool> = \"tests\",\n         plugins: Option<bool> = \"plugins\",\n         ccache: Option<StringOrBool> = \"ccache\",\n-        version_check: Option<bool> = \"version-check\",\n         static_libstdcpp: Option<bool> = \"static-libstdcpp\",\n         ninja: Option<bool> = \"ninja\",\n         targets: Option<String> = \"targets\",\n@@ -804,7 +802,6 @@ impl Config {\n         let mut config = Config::default();\n         config.llvm_optimize = true;\n         config.ninja_in_file = true;\n-        config.llvm_version_check = true;\n         config.llvm_static_stdcpp = false;\n         config.backtrace = true;\n         config.rust_optimize = true;\n@@ -1166,7 +1163,6 @@ impl Config {\n             set(&mut config.llvm_optimize, llvm.optimize);\n             set(&mut config.llvm_thin_lto, llvm.thin_lto);\n             set(&mut config.llvm_release_debuginfo, llvm.release_debuginfo);\n-            set(&mut config.llvm_version_check, llvm.version_check);\n             set(&mut config.llvm_static_stdcpp, llvm.static_libstdcpp);\n             if let Some(v) = llvm.link_shared {\n                 config.llvm_link_shared.set(Some(v));"}, {"sha": "5278f0c10b3d20a1ba8f104ed4be73948b748fb5", "filename": "src/bootstrap/configure.py", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/a7b9488599494a0c91ab18a169aaab476a274177/src%2Fbootstrap%2Fconfigure.py", "raw_url": "https://github.com/rust-lang/rust/raw/a7b9488599494a0c91ab18a169aaab476a274177/src%2Fbootstrap%2Fconfigure.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfigure.py?ref=a7b9488599494a0c91ab18a169aaab476a274177", "patch": "@@ -44,7 +44,6 @@ def v(*args):\n o(\"llvm-static-stdcpp\", \"llvm.static-libstdcpp\", \"statically link to libstdc++ for LLVM\")\n o(\"llvm-link-shared\", \"llvm.link-shared\", \"prefer shared linking to LLVM (llvm-config --link-shared)\")\n o(\"rpath\", \"rust.rpath\", \"build rpaths into rustc itself\")\n-o(\"llvm-version-check\", \"llvm.version-check\", \"check if the LLVM version is supported, build anyway\")\n o(\"codegen-tests\", \"rust.codegen-tests\", \"run the tests/codegen tests\")\n o(\"option-checking\", None, \"complain about unrecognized options in this configure script\")\n o(\"ninja\", \"llvm.ninja\", \"build LLVM using the Ninja generator (for MSVC, requires building in the correct environment)\")"}, {"sha": "909e7d83a1599ef1e26c68ee1d54ea4929ae8c80", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/a7b9488599494a0c91ab18a169aaab476a274177/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a7b9488599494a0c91ab18a169aaab476a274177/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=a7b9488599494a0c91ab18a169aaab476a274177", "patch": "@@ -520,10 +520,6 @@ impl Step for Llvm {\n }\n \n fn check_llvm_version(builder: &Builder<'_>, llvm_config: &Path) {\n-    if !builder.config.llvm_version_check {\n-        return;\n-    }\n-\n     if builder.config.dry_run() {\n         return;\n     }"}]}