{"sha": "8b7909afd797b2a65fcfbc91b4adfc6e1629b352", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhiNzkwOWFmZDc5N2IyYTY1ZmNmYmM5MWI0YWRmYzZlMTYyOWIzNTI=", "commit": {"author": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-09-12T08:12:36Z"}, "committer": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-09-12T09:07:20Z"}, "message": "Fix tests for new argument-passing convention", "tree": {"sha": "ceee50750288692e4a8a2aabef7cacd16c74d26e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ceee50750288692e4a8a2aabef7cacd16c74d26e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8b7909afd797b2a65fcfbc91b4adfc6e1629b352", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8b7909afd797b2a65fcfbc91b4adfc6e1629b352", "html_url": "https://github.com/rust-lang/rust/commit/8b7909afd797b2a65fcfbc91b4adfc6e1629b352", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8b7909afd797b2a65fcfbc91b4adfc6e1629b352/comments", "author": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0e6e56ca606dc8cc1d5435c3929c11c489f3854b", "url": "https://api.github.com/repos/rust-lang/rust/commits/0e6e56ca606dc8cc1d5435c3929c11c489f3854b", "html_url": "https://github.com/rust-lang/rust/commit/0e6e56ca606dc8cc1d5435c3929c11c489f3854b"}], "stats": {"total": 60, "additions": 33, "deletions": 27}, "files": [{"sha": "068e8c65ff514cb8da273f322c44dacee3070760", "filename": "src/test/compile-fail/alias-mismatch.rs", "status": "removed", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/0e6e56ca606dc8cc1d5435c3929c11c489f3854b/src%2Ftest%2Fcompile-fail%2Falias-mismatch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e6e56ca606dc8cc1d5435c3929c11c489f3854b/src%2Ftest%2Fcompile-fail%2Falias-mismatch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Falias-mismatch.rs?ref=0e6e56ca606dc8cc1d5435c3929c11c489f3854b", "patch": "@@ -1,9 +0,0 @@\n-// error-pattern:expected argument mode\n-use std;\n-import std::vec::map;\n-\n-fn main() {\n-    fn f(i: uint) -> bool { true }\n-\n-    let a = map(f, [5u]);\n-}"}, {"sha": "8be70d8e29f251e9af282e5480e2392609cf1a92", "filename": "src/test/compile-fail/aliasness-mismatch.rs", "status": "removed", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/0e6e56ca606dc8cc1d5435c3929c11c489f3854b/src%2Ftest%2Fcompile-fail%2Faliasness-mismatch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e6e56ca606dc8cc1d5435c3929c11c489f3854b/src%2Ftest%2Fcompile-fail%2Faliasness-mismatch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Faliasness-mismatch.rs?ref=0e6e56ca606dc8cc1d5435c3929c11c489f3854b", "patch": "@@ -1,8 +0,0 @@\n-// -*- rust -*-\n-// error-pattern: mismatched types\n-\n-fn f(x: &int) { log_err x; }\n-fn h(x: int) { log_err x; }\n-fn main() { let g: fn(int) = f; g(10); g = h; g(10); }\n-\n-"}, {"sha": "b291b6d47b63ff65f974f78e74a0aafd699f9503", "filename": "src/test/compile-fail/assign-alias.rs", "status": "removed", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0e6e56ca606dc8cc1d5435c3929c11c489f3854b/src%2Ftest%2Fcompile-fail%2Fassign-alias.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e6e56ca606dc8cc1d5435c3929c11c489f3854b/src%2Ftest%2Fcompile-fail%2Fassign-alias.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fassign-alias.rs?ref=0e6e56ca606dc8cc1d5435c3929c11c489f3854b", "patch": "@@ -1,5 +0,0 @@\n-// error-pattern:assigning to immutable alias\n-\n-fn f(i: &int) { i += 2; }\n-\n-fn main() { f(1); }"}, {"sha": "0a1c65aecf98bc9407756d24d7824adb36d41a06", "filename": "src/test/compile-fail/copy-a-resource.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/8b7909afd797b2a65fcfbc91b4adfc6e1629b352/src%2Ftest%2Fcompile-fail%2Fcopy-a-resource.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8b7909afd797b2a65fcfbc91b4adfc6e1629b352/src%2Ftest%2Fcompile-fail%2Fcopy-a-resource.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fcopy-a-resource.rs?ref=8b7909afd797b2a65fcfbc91b4adfc6e1629b352", "patch": "@@ -1,5 +1,8 @@\n // error-pattern:Copying a non-copyable type\n \n+// This is still not properly checked\n+// xfail-test\n+\n resource foo(i: int) { }\n \n fn main() { let x <- foo(10); let y = x; }"}, {"sha": "9b3e277a1fa858d91df7a1c61c0f8446a0438a1c", "filename": "src/test/compile-fail/unsafe-alias.rs", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/8b7909afd797b2a65fcfbc91b4adfc6e1629b352/src%2Ftest%2Fcompile-fail%2Funsafe-alias.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8b7909afd797b2a65fcfbc91b4adfc6e1629b352/src%2Ftest%2Fcompile-fail%2Funsafe-alias.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Funsafe-alias.rs?ref=8b7909afd797b2a65fcfbc91b4adfc6e1629b352", "patch": "@@ -1,7 +1,12 @@\n // error-pattern:may alias with argument\n \n-fn foo(x: &int, f: fn()) { log x; }\n+fn foo(x: &{mutable x: int}, f: fn()) { log x; }\n \n-fn whoknows(x: @mutable int) { *x = 10; }\n+fn whoknows(x: @mutable {mutable x: int}) {\n+    *x = {mutable x: 10};\n+}\n \n-fn main() { let box = @mutable 1; foo(*box, bind whoknows(box)); }\n+fn main() {\n+    let box = @mutable {mutable x: 1};\n+    foo(*box, bind whoknows(box));\n+}"}, {"sha": "c94fca11d5a3fcbf880ac1f224a8cf1f573c621e", "filename": "src/test/compile-fail/unsafe-mutable-alias.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8b7909afd797b2a65fcfbc91b4adfc6e1629b352/src%2Ftest%2Fcompile-fail%2Funsafe-mutable-alias.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8b7909afd797b2a65fcfbc91b4adfc6e1629b352/src%2Ftest%2Fcompile-fail%2Funsafe-mutable-alias.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Funsafe-mutable-alias.rs?ref=8b7909afd797b2a65fcfbc91b4adfc6e1629b352", "patch": "@@ -1,5 +1,7 @@\n // error-pattern:mutable alias to a variable that roots another alias\n \n-fn f(a: &int, b: &mutable int) -> int { b += 1; ret a + b; }\n+fn f(a: &{mutable x: int}, b: &mutable {mutable x: int}) -> int {\n+    b.x += 1; ret a.x + b.x;\n+}\n \n-fn main() { let i = 4; log f(i, i); }\n+fn main() { let i = {mutable x: 4}; log f(i, i); }"}, {"sha": "1e4ca8e9dff98851021b45a35f4b286cf1f0b5c7", "filename": "src/test/run-pass/argument-passing.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/8b7909afd797b2a65fcfbc91b4adfc6e1629b352/src%2Ftest%2Frun-pass%2Fargument-passing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8b7909afd797b2a65fcfbc91b4adfc6e1629b352/src%2Ftest%2Frun-pass%2Fargument-passing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fargument-passing.rs?ref=8b7909afd797b2a65fcfbc91b4adfc6e1629b352", "patch": "@@ -0,0 +1,18 @@\n+fn f1(a: {mutable x: int}, b: &mutable int, c: -int) -> int {\n+    let r = a.x + b + c;\n+    a.x = 0;\n+    b = 10;\n+    c = 20;\n+    ret r;\n+}\n+\n+fn f2(a: int, f: block(x: int)) -> int { f(1); ret a; }\n+\n+fn main() {\n+    let a = {mutable x: 1}, b = 2, c = 3;\n+    assert (f1(a, b, c) == 6);\n+    assert (a.x == 0);\n+    assert (b == 10);\n+    assert (f2(a.x, {| x | a.x = 50; }) == 0);\n+    assert (a.x == 50);\n+}"}]}