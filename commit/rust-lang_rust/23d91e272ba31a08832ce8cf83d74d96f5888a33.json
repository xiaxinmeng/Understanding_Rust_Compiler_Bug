{"sha": "23d91e272ba31a08832ce8cf83d74d96f5888a33", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIzZDkxZTI3MmJhMzFhMDg4MzJjZThjZjgzZDc0ZDk2ZjU4ODhhMzM=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-05-17T00:54:14Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-05-17T00:54:14Z"}, "message": "Rollup merge of #60805 - euclio:filetime-dep, r=Mark-Simulacrum\n\nremove compiletest's dependency on `filetime`", "tree": {"sha": "960718c4ca65e8eacf5e0323cac12569cafbbe02", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/960718c4ca65e8eacf5e0323cac12569cafbbe02"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/23d91e272ba31a08832ce8cf83d74d96f5888a33", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJc3gY2CRBK7hj4Ov3rIwAAdHIIAHLWiXP4JH++0MjlYUFUsGPU\nIAO/NOS7jX76OKwEXVOrejeOy1Vsu/wQENFY3xbtAX1iUp5D88FfzqxCnSx8vjNi\nRdkZFaorz5exUl3p5ZQnU5j6EPmPpEmfuYYiVVVHbCFuQT6dy6sZFVvQakFYEbyf\n9uFf4FUFB1nSPRO1FgFjsD5sU19+FlODa22SRjKJrvGXqqRhBf2MPcloZRnpLpxo\nhhbxtaM24Hi8wo38abWk3ED0PR2xUIl4HkT+IYeE54+PQh3s/MwhpGK0gGwz/v7T\ntlLQSqs9rYvsmhGwrfczNMPvKKzALv09uwEmXT0QXO/tFbEHultCjT4r7Bqjlag=\n=35Vv\n-----END PGP SIGNATURE-----\n", "payload": "tree 960718c4ca65e8eacf5e0323cac12569cafbbe02\nparent a92597392733ec73013f08b9924b635d107003f0\nparent 01bc58c5eecd0ed993ee37993f24c63780082e76\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1558054454 +0200\ncommitter GitHub <noreply@github.com> 1558054454 +0200\n\nRollup merge of #60805 - euclio:filetime-dep, r=Mark-Simulacrum\n\nremove compiletest's dependency on `filetime`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/23d91e272ba31a08832ce8cf83d74d96f5888a33", "html_url": "https://github.com/rust-lang/rust/commit/23d91e272ba31a08832ce8cf83d74d96f5888a33", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/23d91e272ba31a08832ce8cf83d74d96f5888a33/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a92597392733ec73013f08b9924b635d107003f0", "url": "https://api.github.com/repos/rust-lang/rust/commits/a92597392733ec73013f08b9924b635d107003f0", "html_url": "https://github.com/rust-lang/rust/commit/a92597392733ec73013f08b9924b635d107003f0"}, {"sha": "01bc58c5eecd0ed993ee37993f24c63780082e76", "url": "https://api.github.com/repos/rust-lang/rust/commits/01bc58c5eecd0ed993ee37993f24c63780082e76", "html_url": "https://github.com/rust-lang/rust/commit/01bc58c5eecd0ed993ee37993f24c63780082e76"}], "stats": {"total": 32, "additions": 17, "deletions": 15}, "files": [{"sha": "a4f30d1ebcf82f56b6c4ac6226f8579397cf3379", "filename": "Cargo.lock", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/23d91e272ba31a08832ce8cf83d74d96f5888a33/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/23d91e272ba31a08832ce8cf83d74d96f5888a33/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=23d91e272ba31a08832ce8cf83d74d96f5888a33", "patch": "@@ -475,7 +475,6 @@ version = \"0.0.0\"\n dependencies = [\n  \"diff 0.1.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"env_logger 0.5.13 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"filetime 0.2.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"getopts 0.2.19 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"lazy_static 1.3.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.54 (registry+https://github.com/rust-lang/crates.io-index)\","}, {"sha": "e759ad1f35dde426d8efd05251d1728c76e5e93c", "filename": "src/tools/compiletest/Cargo.toml", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/23d91e272ba31a08832ce8cf83d74d96f5888a33/src%2Ftools%2Fcompiletest%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/23d91e272ba31a08832ce8cf83d74d96f5888a33/src%2Ftools%2Fcompiletest%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2FCargo.toml?ref=23d91e272ba31a08832ce8cf83d74d96f5888a33", "patch": "@@ -7,7 +7,6 @@ edition = \"2018\"\n [dependencies]\n diff = \"0.1.10\"\n env_logger = { version = \"0.5\", default-features = false }\n-filetime = \"0.2\"\n getopts = \"0.2\"\n log = \"0.4\"\n regex = \"1.0\""}, {"sha": "442e58bfd74e1408c1ff9b9e31c5ed018ff507de", "filename": "src/tools/compiletest/src/main.rs", "status": "modified", "additions": 16, "deletions": 11, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/23d91e272ba31a08832ce8cf83d74d96f5888a33/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23d91e272ba31a08832ce8cf83d74d96f5888a33/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs?ref=23d91e272ba31a08832ce8cf83d74d96f5888a33", "patch": "@@ -9,14 +9,14 @@ use crate::common::CompareMode;\n use crate::common::{expected_output_path, output_base_dir, output_relative_path, UI_EXTENSIONS};\n use crate::common::{Config, TestPaths};\n use crate::common::{DebugInfoBoth, DebugInfoGdb, DebugInfoLldb, Mode, Pretty};\n-use filetime::FileTime;\n use getopts::Options;\n use std::env;\n use std::ffi::OsString;\n use std::fs;\n use std::io::{self, ErrorKind};\n use std::path::{Path, PathBuf};\n use std::process::Command;\n+use std::time::SystemTime;\n use test::ColorConfig;\n use crate::util::logv;\n use walkdir::WalkDir;\n@@ -752,31 +752,36 @@ fn up_to_date(\n \n #[derive(Debug, PartialEq, PartialOrd, Ord, Eq)]\n struct Stamp {\n-    time: FileTime,\n+    time: SystemTime,\n     file: PathBuf,\n }\n \n impl Stamp {\n     fn from_path(p: &Path) -> Self {\n+        let time = fs::metadata(p)\n+            .and_then(|metadata| metadata.modified())\n+            .unwrap_or(SystemTime::UNIX_EPOCH);\n+\n         Stamp {\n-            time: mtime(&p),\n+            time,\n             file: p.into(),\n         }\n     }\n \n-    fn from_dir(path: &Path) -> impl Iterator<Item=Stamp> {\n+    fn from_dir(path: &Path) -> impl Iterator<Item = Stamp> {\n         WalkDir::new(path)\n             .into_iter()\n             .map(|entry| entry.unwrap())\n             .filter(|entry| entry.file_type().is_file())\n-            .map(|entry| Stamp::from_path(entry.path()))\n-    }\n-}\n+            .map(|entry| {\n+                let time = (|| -> io::Result<_> { entry.metadata()?.modified() })();\n \n-fn mtime(path: &Path) -> FileTime {\n-    fs::metadata(path)\n-        .map(|f| FileTime::from_last_modification_time(&f))\n-        .unwrap_or_else(|_| FileTime::zero())\n+                Stamp {\n+                    time: time.unwrap_or(SystemTime::UNIX_EPOCH),\n+                    file: entry.path().into(),\n+                }\n+            })\n+    }\n }\n \n fn make_test_name("}, {"sha": "1e4deee6bf12e0ebbb3332443ba7bae0897b32fa", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/23d91e272ba31a08832ce8cf83d74d96f5888a33/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23d91e272ba31a08832ce8cf83d74d96f5888a33/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=23d91e272ba31a08832ce8cf83d74d96f5888a33", "patch": "@@ -9,7 +9,6 @@ use crate::common::{Config, TestPaths};\n use crate::common::{Incremental, MirOpt, RunMake, Ui, JsDocTest, Assembly};\n use diff;\n use crate::errors::{self, Error, ErrorKind};\n-use filetime::FileTime;\n use crate::header::TestProps;\n use crate::json;\n use regex::{Captures, Regex};\n@@ -3029,7 +3028,7 @@ impl<'test> TestCx<'test> {\n     }\n \n     fn check_mir_test_timestamp(&self, test_name: &str, output_file: &Path) {\n-        let t = |file| FileTime::from_last_modification_time(&fs::metadata(file).unwrap());\n+        let t = |file| fs::metadata(file).unwrap().modified().unwrap();\n         let source_file = &self.testpaths.file;\n         let output_time = t(output_file);\n         let source_time = t(source_file);"}]}