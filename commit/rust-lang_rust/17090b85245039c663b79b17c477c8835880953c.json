{"sha": "17090b85245039c663b79b17c477c8835880953c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE3MDkwYjg1MjQ1MDM5YzY2M2I3OWIxN2M0NzdjODgzNTg4MDk1M2M=", "commit": {"author": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2017-01-24T16:55:42Z"}, "committer": {"name": "Oliver Schneider", "email": "git-no-reply-9879165716479413131@oli-obk.de", "date": "2017-01-28T10:57:53Z"}, "message": "add tests for cargo miri and run them on travis", "tree": {"sha": "a2133281e5310101137072dbb5d58a41c0f0f156", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a2133281e5310101137072dbb5d58a41c0f0f156"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/17090b85245039c663b79b17c477c8835880953c", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJJBAABCAAzBQJYjHkxLBxnaXQtbm8tcmVwbHktOTg3OTE2NTcxNjQ3OTQxMzEz\nMUBvbGktb2JrLmRlAAoJEB1ctPxZfDAEnlQP/RC4EBp1xOYJXxbflF8hqseN3AYC\nWxHkpfhwi20WUyM7YaXs8OV8toESHtCd1HsihZ6GJY/MH3qggJdilIgXS7Oprj97\nIw0GuXnnVNgmxHwCSB73ps394KCoRwnVyOtS2EgaxumMff9tFvOx2HmdpiQ7dR++\nu0QCj+jRw9DUwuS0S75KGxXWob8Z+CTVCxQpNUZl9mrDkaVpbs991lncljMjvdhu\naGsiQO6NZmdw7e2Fk9ESmZvRCwPXbBPXZW2yeBWl7zqCzmrCl3jVJuuTGKGdDQnb\n0eOFq/3W4P5G8ZcY1i3/0d21nIDwrG7nP8eOebnoRP6iq/TV7Nl5FAQVF2mz+f+J\nd4RcHw8U7YIcO32Bbr8B5KzqcUZRh7sypa4PqThH8Rsvfq6Qb2a6QM0y5TpyDA65\ngSAEbRb7be9PYka95QhFCNRZDflley9AovXVk00B+qzfgrbfxEpVf/o84PrHGLId\nxAqXT4qQpi/fRPpQrmWFNc5vDGuJF681kis/o1v38yta4o+Z07P++LhRVozpmmhp\nCQp2gYDBbjsPmnR3rRQdhKmBbNIuY0z/8faV0If3d2zErs4nqSY3YTLG8HWlxVg0\nmz+0DoSMZ9h51SgEapUxtTbnoEk//VSPVrguF8YzIpI1TPrkAMMYWjuN+O7p21Yn\n8QWiTsSDlBSXZpfn\n=nEFV\n-----END PGP SIGNATURE-----", "payload": "tree a2133281e5310101137072dbb5d58a41c0f0f156\nparent 2cca377bd485ef56ac85c09ebeb9aa5907bfe1f7\nauthor Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1485276942 +0100\ncommitter Oliver Schneider <git-no-reply-9879165716479413131@oli-obk.de> 1485601073 +0100\n\nadd tests for cargo miri and run them on travis"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/17090b85245039c663b79b17c477c8835880953c", "html_url": "https://github.com/rust-lang/rust/commit/17090b85245039c663b79b17c477c8835880953c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/17090b85245039c663b79b17c477c8835880953c/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2cca377bd485ef56ac85c09ebeb9aa5907bfe1f7", "url": "https://api.github.com/repos/rust-lang/rust/commits/2cca377bd485ef56ac85c09ebeb9aa5907bfe1f7", "html_url": "https://github.com/rust-lang/rust/commit/2cca377bd485ef56ac85c09ebeb9aa5907bfe1f7"}], "stats": {"total": 41, "additions": 30, "deletions": 11}, "files": [{"sha": "d32d9eb99afd2b7b242a2c6c62ed1b571c5cb10f", "filename": ".gitignore", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/17090b85245039c663b79b17c477c8835880953c/.gitignore", "raw_url": "https://github.com/rust-lang/rust/raw/17090b85245039c663b79b17c477c8835880953c/.gitignore", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.gitignore?ref=17090b85245039c663b79b17c477c8835880953c", "patch": "@@ -1,4 +1,4 @@\n-/target\n+target\n /doc\n tex/*/out\n *.dot"}, {"sha": "52717dfc0dbfcccbfecc465ed3ccdfa88f3d80ef", "filename": ".travis.yml", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/17090b85245039c663b79b17c477c8835880953c/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/17090b85245039c663b79b17c477c8835880953c/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=17090b85245039c663b79b17c477c8835880953c", "patch": "@@ -11,7 +11,12 @@ before_script:\n script:\n - |\n   env RUST_SYSROOT=$HOME/rust travis-cargo build &&\n-  env RUST_SYSROOT=$HOME/rust travis-cargo test\n+  env RUST_SYSROOT=$HOME/rust travis-cargo test &&\n+  env RUST_SYSROOT=$HOME/rust travis-cargo install &&\n+  cd cargo-miri-test &&\n+  env RUST_SYSROOT=$HOME/rust travis-cargo miri &&\n+  env RUST_SYSROOT=$HOME/rust travis-cargo miri test &&\n+  cd ..\n notifications:\n   email:\n     on_success: never"}, {"sha": "a62bb86226cdb89cf73f412f1a8a4ee47eb55444", "filename": "cargo-miri-test/Cargo.lock", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/17090b85245039c663b79b17c477c8835880953c/cargo-miri-test%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/17090b85245039c663b79b17c477c8835880953c/cargo-miri-test%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/cargo-miri-test%2FCargo.lock?ref=17090b85245039c663b79b17c477c8835880953c", "patch": "@@ -0,0 +1,4 @@\n+[root]\n+name = \"cargo-miri-test\"\n+version = \"0.1.0\"\n+"}, {"sha": "29886d99a394b27759f1c4881fa1cd38c020078e", "filename": "cargo-miri-test/Cargo.toml", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/17090b85245039c663b79b17c477c8835880953c/cargo-miri-test%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/17090b85245039c663b79b17c477c8835880953c/cargo-miri-test%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/cargo-miri-test%2FCargo.toml?ref=17090b85245039c663b79b17c477c8835880953c", "patch": "@@ -0,0 +1,6 @@\n+[package]\n+name = \"cargo-miri-test\"\n+version = \"0.1.0\"\n+authors = [\"Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de>\"]\n+\n+[dependencies]"}, {"sha": "aa00ab84cb096cf8a7409779fbeb33b06d901802", "filename": "cargo-miri-test/src/main.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/17090b85245039c663b79b17c477c8835880953c/cargo-miri-test%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/17090b85245039c663b79b17c477c8835880953c/cargo-miri-test%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/cargo-miri-test%2Fsrc%2Fmain.rs?ref=17090b85245039c663b79b17c477c8835880953c", "patch": "@@ -0,0 +1,3 @@\n+fn main() {\n+    assert_eq!(5, 5);\n+}"}, {"sha": "fb7fad21c9db8fbdb017af27d962f5a7bde824d9", "filename": "cargo-miri-test/tests/foo.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/17090b85245039c663b79b17c477c8835880953c/cargo-miri-test%2Ftests%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/17090b85245039c663b79b17c477c8835880953c/cargo-miri-test%2Ftests%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/cargo-miri-test%2Ftests%2Ffoo.rs?ref=17090b85245039c663b79b17c477c8835880953c", "patch": "@@ -0,0 +1,4 @@\n+#[test]\n+fn bar() {\n+    assert_eq!(4, 4);\n+}"}, {"sha": "58109ad59587d6dbd21ee7a146b78040345e45cc", "filename": "src/bin/cargo-miri.rs", "status": "modified", "additions": 6, "deletions": 9, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/17090b85245039c663b79b17c477c8835880953c/src%2Fbin%2Fcargo-miri.rs", "raw_url": "https://github.com/rust-lang/rust/raw/17090b85245039c663b79b17c477c8835880953c/src%2Fbin%2Fcargo-miri.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbin%2Fcargo-miri.rs?ref=17090b85245039c663b79b17c477c8835880953c", "patch": "@@ -84,19 +84,16 @@ fn main() {\n         let package = metadata.packages.remove(package_index);\n         for target in package.targets {\n             let args = std::env::args().skip(skip);\n-            if test && target.kind.get(0).map_or(false, |kind| kind == \"test\") {\n+            let kind = target.kind.get(0).expect(\"badly formatted cargo metadata: target::kind is an empty array\");\n+            if test && kind == \"test\" {\n                 if let Err(code) = process(vec![\"--test\".to_string(), target.name].into_iter().chain(args),\n                                            &dep_path) {\n                     std::process::exit(code);\n                 }\n-            } else if !test {\n-                if target.kind.get(0).map_or(false, |kind| kind == \"bin\") {\n-                    if let Err(code) = process(vec![\"--bin\".to_string(), target.name].into_iter().chain(args),\n-                                               &dep_path) {\n-                        std::process::exit(code);\n-                    }\n-                } else {\n-                    panic!(\"badly formatted cargo metadata: target::kind is an empty array\");\n+            } else if !test && kind == \"bin\" {\n+                if let Err(code) = process(vec![\"--bin\".to_string(), target.name].into_iter().chain(args),\n+                                           &dep_path) {\n+                    std::process::exit(code);\n                 }\n             }\n         }"}]}