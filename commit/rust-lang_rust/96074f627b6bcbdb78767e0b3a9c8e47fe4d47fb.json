{"sha": "96074f627b6bcbdb78767e0b3a9c8e47fe4d47fb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk2MDc0ZjYyN2I2YmNiZGI3ODc2N2UwYjNhOWM4ZTQ3ZmU0ZDQ3ZmI=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-07-02T23:32:12Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-07-02T23:32:12Z"}, "message": "Merge #9467\n\n9467: internal: wrap_return_type_in_result works on the HIR r=Veykril a=Veykril\n\nbors r+\n\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>", "tree": {"sha": "0c8891b2d73e0990e37b34a471c2b7f42ec619c3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0c8891b2d73e0990e37b34a471c2b7f42ec619c3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/96074f627b6bcbdb78767e0b3a9c8e47fe4d47fb", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJg36H8CRBK7hj4Ov3rIwAARRUIAEAa/DFz6rO2mtZBR1tKEwdc\nm1VyGgIZIb8Wd80tWfOnDhtF43+BavLqW7jrCkY6R6HvV486BUVEv14QWwhfeC5U\nil9hZ7eh3kGixHofX3UFLuDxPQn5Vz0QU5y5bTALhzdTkTp8s2CTncjmr+wL7qlm\nZlIHOuFNPh5lbrGhDChy1vgt4bdV0rrUDulpitGMD3Tw5/HOYzkLxx+iZ22600TM\ntnYaWJfoN+Fbh1b8oCvf53HbH19R9hLDwPNPNT1RR4UeuOx6O7tkvWxIAIycQNBS\nIV0QWGgUa1loiR4I3dGKrM56s56gzb7enfVk31MvTeSALtV6oGu7GlWnR5YCGlg=\n=Jlez\n-----END PGP SIGNATURE-----\n", "payload": "tree 0c8891b2d73e0990e37b34a471c2b7f42ec619c3\nparent 3770fce086d765518158b5344fcfe3ea45d1e954\nparent fbdcb49d483bb305f9abc7bb23a1d096ccd0481b\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1625268732 +0000\ncommitter GitHub <noreply@github.com> 1625268732 +0000\n\nMerge #9467\n\n9467: internal: wrap_return_type_in_result works on the HIR r=Veykril a=Veykril\n\nbors r+\n\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/96074f627b6bcbdb78767e0b3a9c8e47fe4d47fb", "html_url": "https://github.com/rust-lang/rust/commit/96074f627b6bcbdb78767e0b3a9c8e47fe4d47fb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/96074f627b6bcbdb78767e0b3a9c8e47fe4d47fb/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3770fce086d765518158b5344fcfe3ea45d1e954", "url": "https://api.github.com/repos/rust-lang/rust/commits/3770fce086d765518158b5344fcfe3ea45d1e954", "html_url": "https://github.com/rust-lang/rust/commit/3770fce086d765518158b5344fcfe3ea45d1e954"}, {"sha": "fbdcb49d483bb305f9abc7bb23a1d096ccd0481b", "url": "https://api.github.com/repos/rust-lang/rust/commits/fbdcb49d483bb305f9abc7bb23a1d096ccd0481b", "html_url": "https://github.com/rust-lang/rust/commit/fbdcb49d483bb305f9abc7bb23a1d096ccd0481b"}], "stats": {"total": 206, "additions": 99, "deletions": 107}, "files": [{"sha": "57773e95e159b9d859d1626489135d1de4cb05e0", "filename": "crates/ide_assists/src/handlers/unmerge_use.rs", "status": "modified", "additions": 7, "deletions": 8, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/96074f627b6bcbdb78767e0b3a9c8e47fe4d47fb/crates%2Fide_assists%2Fsrc%2Fhandlers%2Funmerge_use.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96074f627b6bcbdb78767e0b3a9c8e47fe4d47fb/crates%2Fide_assists%2Fsrc%2Fhandlers%2Funmerge_use.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_assists%2Fsrc%2Fhandlers%2Funmerge_use.rs?ref=96074f627b6bcbdb78767e0b3a9c8e47fe4d47fb", "patch": "@@ -1,3 +1,5 @@\n+use ast::make;\n+use itertools::Itertools;\n use syntax::{\n     ast::{self, VisibilityOwner},\n     ted::{self, Position},\n@@ -42,9 +44,9 @@ pub(crate) fn unmerge_use(acc: &mut Assists, ctx: &AssistContext) -> Option<()>\n         \"Unmerge use\",\n         target,\n         |builder| {\n-            let new_use = ast::make::use_(\n+            let new_use = make::use_(\n                 use_.visibility(),\n-                ast::make::use_tree(\n+                make::use_tree(\n                     path,\n                     tree.use_tree_list(),\n                     tree.rename(),\n@@ -62,17 +64,14 @@ pub(crate) fn unmerge_use(acc: &mut Assists, ctx: &AssistContext) -> Option<()>\n }\n \n fn resolve_full_path(tree: &ast::UseTree) -> Option<ast::Path> {\n-    let mut paths = tree\n+    let paths = tree\n         .syntax()\n         .ancestors()\n-        .take_while(|n| n.kind() != SyntaxKind::USE_KW)\n+        .take_while(|n| n.kind() != SyntaxKind::USE)\n         .filter_map(ast::UseTree::cast)\n         .filter_map(|t| t.path());\n \n-    let mut final_path = paths.next()?;\n-    for path in paths {\n-        final_path = ast::make::path_concat(path, final_path)\n-    }\n+    let final_path = paths.fold1(|prev, next| make::path_concat(next, prev))?;\n     if final_path.segment().map_or(false, |it| it.self_token().is_some()) {\n         final_path.qualifier()\n     } else {"}, {"sha": "7977434e1ae23dd4ad2e510de0fdc903c36286e9", "filename": "crates/ide_assists/src/handlers/wrap_return_type_in_result.rs", "status": "modified", "additions": 86, "deletions": 99, "changes": 185, "blob_url": "https://github.com/rust-lang/rust/blob/96074f627b6bcbdb78767e0b3a9c8e47fe4d47fb/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fwrap_return_type_in_result.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96074f627b6bcbdb78767e0b3a9c8e47fe4d47fb/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fwrap_return_type_in_result.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fwrap_return_type_in_result.rs?ref=96074f627b6bcbdb78767e0b3a9c8e47fe4d47fb", "patch": "@@ -1,6 +1,6 @@\n use std::iter;\n \n-use ide_db::helpers::for_each_tail_expr;\n+use ide_db::helpers::{for_each_tail_expr, FamousDefs};\n use syntax::{\n     ast::{self, make, Expr},\n     match_ast, AstNode,\n@@ -13,6 +13,7 @@ use crate::{AssistContext, AssistId, AssistKind, Assists};\n // Wrap the function's return type into Result.\n //\n // ```\n+// # //- minicore: result\n // fn foo() -> i32$0 { 42i32 }\n // ```\n // ->\n@@ -33,23 +34,24 @@ pub(crate) fn wrap_return_type_in_result(acc: &mut Assists, ctx: &AssistContext)\n             _ => return None,\n         }\n     };\n-    let body = ast::Expr::BlockExpr(body);\n \n     let type_ref = &ret_type.ty()?;\n-    let ret_type_str = type_ref.syntax().text().to_string();\n-    let first_part_ret_type = ret_type_str.splitn(2, '<').next();\n-    if let Some(ret_type_first_part) = first_part_ret_type {\n-        if ret_type_first_part.ends_with(\"Result\") {\n-            cov_mark::hit!(wrap_return_type_in_result_simple_return_type_already_result);\n-            return None;\n-        }\n+    let ty = ctx.sema.resolve_type(type_ref).and_then(|ty| ty.as_adt());\n+    let result_enum =\n+        FamousDefs(&ctx.sema, ctx.sema.scope(type_ref.syntax()).krate()).core_result_Result()?;\n+\n+    if matches!(ty, Some(hir::Adt::Enum(ret_type)) if ret_type == result_enum) {\n+        cov_mark::hit!(wrap_return_type_in_result_simple_return_type_already_result);\n+        return None;\n     }\n \n     acc.add(\n         AssistId(\"wrap_return_type_in_result\", AssistKind::RefactorRewrite),\n         \"Wrap return type in Result\",\n         type_ref.syntax().text_range(),\n         |builder| {\n+            let body = ast::Expr::BlockExpr(body);\n+\n             let mut exprs_to_wrap = Vec::new();\n             let tail_cb = &mut |e: &_| tail_cb_impl(&mut exprs_to_wrap, e);\n             body.walk(&mut |expr| {\n@@ -88,6 +90,11 @@ fn tail_cb_impl(acc: &mut Vec<ast::Expr>, e: &ast::Expr) {\n                 for_each_tail_expr(&break_expr_arg, &mut |e| tail_cb_impl(acc, e))\n             }\n         }\n+        Expr::ReturnExpr(ret_expr) => {\n+            if let Some(ret_expr_arg) = &ret_expr.expr() {\n+                for_each_tail_expr(ret_expr_arg, &mut |e| tail_cb_impl(acc, e));\n+            }\n+        }\n         e => acc.push(e.clone()),\n     }\n }\n@@ -98,10 +105,17 @@ mod tests {\n \n     use super::*;\n \n-    #[test]\n-    fn wrap_return_type_in_result_simple() {\n+    fn check(ra_fixture_before: &str, ra_fixture_after: &str) {\n         check_assist(\n             wrap_return_type_in_result,\n+            &format!(\"//- minicore: result\\n{}\", ra_fixture_before.trim_start()),\n+            ra_fixture_after,\n+        );\n+    }\n+\n+    #[test]\n+    fn wrap_return_type_in_result_simple() {\n+        check(\n             r#\"\n fn foo() -> i3$02 {\n     let test = \"test\";\n@@ -119,8 +133,7 @@ fn foo() -> Result<i32, ${0:_}> {\n \n     #[test]\n     fn wrap_return_type_break_split_tail() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo() -> i3$02 {\n     loop {\n@@ -148,8 +161,7 @@ fn foo() -> Result<i32, ${0:_}> {\n \n     #[test]\n     fn wrap_return_type_in_result_simple_closure() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo() {\n     || -> i32$0 {\n@@ -207,7 +219,8 @@ fn foo() {\n         check_assist_not_applicable(\n             wrap_return_type_in_result,\n             r#\"\n-fn foo() -> std::result::Result<i32$0, String> {\n+//- minicore: result\n+fn foo() -> core::result::Result<i32$0, String> {\n     let test = \"test\";\n     return 42i32;\n }\n@@ -221,6 +234,7 @@ fn foo() -> std::result::Result<i32$0, String> {\n         check_assist_not_applicable(\n             wrap_return_type_in_result,\n             r#\"\n+//- minicore: result\n fn foo() -> Result<i32$0, String> {\n     let test = \"test\";\n     return 42i32;\n@@ -246,8 +260,7 @@ fn foo() {\n \n     #[test]\n     fn wrap_return_type_in_result_simple_with_cursor() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo() -> $0i32 {\n     let test = \"test\";\n@@ -265,8 +278,7 @@ fn foo() -> Result<i32, ${0:_}> {\n \n     #[test]\n     fn wrap_return_type_in_result_simple_with_tail() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo() ->$0 i32 {\n     let test = \"test\";\n@@ -284,8 +296,7 @@ fn foo() -> Result<i32, ${0:_}> {\n \n     #[test]\n     fn wrap_return_type_in_result_simple_with_tail_closure() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo() {\n     || ->$0 i32 {\n@@ -307,17 +318,12 @@ fn foo() {\n \n     #[test]\n     fn wrap_return_type_in_result_simple_with_tail_only() {\n-        check_assist(\n-            wrap_return_type_in_result,\n-            r#\"fn foo() -> i32$0 { 42i32 }\"#,\n-            r#\"fn foo() -> Result<i32, ${0:_}> { Ok(42i32) }\"#,\n-        );\n+        check(r#\"fn foo() -> i32$0 { 42i32 }\"#, r#\"fn foo() -> Result<i32, ${0:_}> { Ok(42i32) }\"#);\n     }\n \n     #[test]\n     fn wrap_return_type_in_result_simple_with_tail_block_like() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo() -> i32$0 {\n     if true {\n@@ -341,8 +347,7 @@ fn foo() -> Result<i32, ${0:_}> {\n \n     #[test]\n     fn wrap_return_type_in_result_simple_without_block_closure() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo() {\n     || -> i32$0 {\n@@ -370,8 +375,7 @@ fn foo() {\n \n     #[test]\n     fn wrap_return_type_in_result_simple_with_nested_if() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo() -> i32$0 {\n     if true {\n@@ -403,8 +407,7 @@ fn foo() -> Result<i32, ${0:_}> {\n \n     #[test]\n     fn wrap_return_type_in_result_simple_with_await() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n async fn foo() -> i$032 {\n     if true {\n@@ -436,17 +439,15 @@ async fn foo() -> Result<i32, ${0:_}> {\n \n     #[test]\n     fn wrap_return_type_in_result_simple_with_array() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"fn foo() -> [i32;$0 3] { [1, 2, 3] }\"#,\n             r#\"fn foo() -> Result<[i32; 3], ${0:_}> { Ok([1, 2, 3]) }\"#,\n         );\n     }\n \n     #[test]\n     fn wrap_return_type_in_result_simple_with_cast() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo() -$0> i32 {\n     if true {\n@@ -478,8 +479,7 @@ fn foo() -> Result<i32, ${0:_}> {\n \n     #[test]\n     fn wrap_return_type_in_result_simple_with_tail_block_like_match() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo() -> i32$0 {\n     let my_var = 5;\n@@ -503,8 +503,7 @@ fn foo() -> Result<i32, ${0:_}> {\n \n     #[test]\n     fn wrap_return_type_in_result_simple_with_loop_with_tail() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo() -> i32$0 {\n     let my_var = 5;\n@@ -530,8 +529,7 @@ fn foo() -> Result<i32, ${0:_}> {\n \n     #[test]\n     fn wrap_return_type_in_result_simple_with_loop_in_let_stmt() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo() -> i32$0 {\n     let my_var = let x = loop {\n@@ -553,8 +551,7 @@ fn foo() -> Result<i32, ${0:_}> {\n \n     #[test]\n     fn wrap_return_type_in_result_simple_with_tail_block_like_match_return_expr() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo() -> i32$0 {\n     let my_var = 5;\n@@ -577,8 +574,7 @@ fn foo() -> Result<i32, ${0:_}> {\n \"#,\n         );\n \n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo() -> i32$0 {\n     let my_var = 5;\n@@ -606,8 +602,7 @@ fn foo() -> Result<i32, ${0:_}> {\n \n     #[test]\n     fn wrap_return_type_in_result_simple_with_tail_block_like_match_deeper() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo() -> i32$0 {\n     let my_var = 5;\n@@ -655,8 +650,7 @@ fn foo() -> Result<i32, ${0:_}> {\n \n     #[test]\n     fn wrap_return_type_in_result_simple_with_tail_block_like_early_return() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo() -> i$032 {\n     let test = \"test\";\n@@ -680,8 +674,7 @@ fn foo() -> Result<i32, ${0:_}> {\n \n     #[test]\n     fn wrap_return_type_in_result_simple_with_closure() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo(the_field: u32) ->$0 u32 {\n     let true_closure = || { return true; };\n@@ -712,55 +705,53 @@ fn foo(the_field: u32) -> Result<u32, ${0:_}> {\n \"#,\n         );\n \n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n-            fn foo(the_field: u32) -> u32$0 {\n-                let true_closure = || {\n-                    return true;\n-                };\n-                if the_field < 5 {\n-                    let mut i = 0;\n+fn foo(the_field: u32) -> u32$0 {\n+    let true_closure = || {\n+        return true;\n+    };\n+    if the_field < 5 {\n+        let mut i = 0;\n \n \n-                    if true_closure() {\n-                        return 99;\n-                    } else {\n-                        return 0;\n-                    }\n-                }\n-                let t = None;\n+        if true_closure() {\n+            return 99;\n+        } else {\n+            return 0;\n+        }\n+    }\n+    let t = None;\n \n-                t.unwrap_or_else(|| the_field)\n-            }\n-            \"#,\n+    t.unwrap_or_else(|| the_field)\n+}\n+\"#,\n             r#\"\n-            fn foo(the_field: u32) -> Result<u32, ${0:_}> {\n-                let true_closure = || {\n-                    return true;\n-                };\n-                if the_field < 5 {\n-                    let mut i = 0;\n+fn foo(the_field: u32) -> Result<u32, ${0:_}> {\n+    let true_closure = || {\n+        return true;\n+    };\n+    if the_field < 5 {\n+        let mut i = 0;\n \n \n-                    if true_closure() {\n-                        return Ok(99);\n-                    } else {\n-                        return Ok(0);\n-                    }\n-                }\n-                let t = None;\n+        if true_closure() {\n+            return Ok(99);\n+        } else {\n+            return Ok(0);\n+        }\n+    }\n+    let t = None;\n \n-                Ok(t.unwrap_or_else(|| the_field))\n-            }\n-            \"#,\n+    Ok(t.unwrap_or_else(|| the_field))\n+}\n+\"#,\n         );\n     }\n \n     #[test]\n     fn wrap_return_type_in_result_simple_with_weird_forms() {\n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo() -> i32$0 {\n     let test = \"test\";\n@@ -793,8 +784,7 @@ fn foo() -> Result<i32, ${0:_}> {\n \"#,\n         );\n \n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo(the_field: u32) -> u32$0 {\n     if the_field < 5 {\n@@ -833,8 +823,7 @@ fn foo(the_field: u32) -> Result<u32, ${0:_}> {\n \"#,\n         );\n \n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo(the_field: u32) -> u3$02 {\n     if the_field < 5 {\n@@ -861,8 +850,7 @@ fn foo(the_field: u32) -> Result<u32, ${0:_}> {\n \"#,\n         );\n \n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo(the_field: u32) -> u32$0 {\n     if the_field < 5 {\n@@ -891,8 +879,7 @@ fn foo(the_field: u32) -> Result<u32, ${0:_}> {\n \"#,\n         );\n \n-        check_assist(\n-            wrap_return_type_in_result,\n+        check(\n             r#\"\n fn foo(the_field: u32) -> $0u32 {\n     if the_field < 5 {"}, {"sha": "c3c21317345df4efa0f24863a4d679b7b44fe364", "filename": "crates/ide_assists/src/tests/generated.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/96074f627b6bcbdb78767e0b3a9c8e47fe4d47fb/crates%2Fide_assists%2Fsrc%2Ftests%2Fgenerated.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96074f627b6bcbdb78767e0b3a9c8e47fe4d47fb/crates%2Fide_assists%2Fsrc%2Ftests%2Fgenerated.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_assists%2Fsrc%2Ftests%2Fgenerated.rs?ref=96074f627b6bcbdb78767e0b3a9c8e47fe4d47fb", "patch": "@@ -1600,6 +1600,7 @@ fn doctest_wrap_return_type_in_result() {\n     check_doc_test(\n         \"wrap_return_type_in_result\",\n         r#####\"\n+//- minicore: result\n fn foo() -> i32$0 { 42i32 }\n \"#####,\n         r#####\""}, {"sha": "e8cdcbf3fa5d756ff1db432fbb2840d8e7356df5", "filename": "crates/ide_db/src/helpers.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/96074f627b6bcbdb78767e0b3a9c8e47fe4d47fb/crates%2Fide_db%2Fsrc%2Fhelpers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96074f627b6bcbdb78767e0b3a9c8e47fe4d47fb/crates%2Fide_db%2Fsrc%2Fhelpers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_db%2Fsrc%2Fhelpers.rs?ref=96074f627b6bcbdb78767e0b3a9c8e47fe4d47fb", "patch": "@@ -122,6 +122,10 @@ impl FamousDefs<'_, '_> {\n         self.find_enum(\"core:option:Option\")\n     }\n \n+    pub fn core_result_Result(&self) -> Option<Enum> {\n+        self.find_enum(\"core:result:Result\")\n+    }\n+\n     pub fn core_default_Default(&self) -> Option<Trait> {\n         self.find_trait(\"core:default:Default\")\n     }\n@@ -206,6 +210,7 @@ impl SnippetCap {\n }\n \n /// Calls `cb` on each expression inside `expr` that is at \"tail position\".\n+/// Does not walk into `break` or `return` expressions.\n pub fn for_each_tail_expr(expr: &ast::Expr, cb: &mut dyn FnMut(&ast::Expr)) {\n     match expr {\n         ast::Expr::BlockExpr(b) => {"}]}