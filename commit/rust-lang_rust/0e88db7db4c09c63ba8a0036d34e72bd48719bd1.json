{"sha": "0e88db7db4c09c63ba8a0036d34e72bd48719bd1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBlODhkYjdkYjRjMDljNjNiYThhMDAzNmQzNGU3MmJkNDg3MTliZDE=", "commit": {"author": {"name": "Jubilee Young", "email": "workingjubilee@gmail.com", "date": "2020-10-22T18:42:44Z"}, "committer": {"name": "Jubilee Young", "email": "workingjubilee@gmail.com", "date": "2020-10-29T03:09:20Z"}, "message": "Dogfood {exclusive,half-open} ranges in compiler (nfc)\n\nIn particular, this allows us to write more explicit matches that\navoid the pitfalls of using a fully general fall-through case, yet\nremain fairly ergonomic. Less logic is in guard cases, more is in\nthe actual exhaustive case analysis.\n\nNo functional changes.", "tree": {"sha": "06918207d954eaca15caa69eae65dbb9947138a4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/06918207d954eaca15caa69eae65dbb9947138a4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0e88db7db4c09c63ba8a0036d34e72bd48719bd1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0e88db7db4c09c63ba8a0036d34e72bd48719bd1", "html_url": "https://github.com/rust-lang/rust/commit/0e88db7db4c09c63ba8a0036d34e72bd48719bd1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0e88db7db4c09c63ba8a0036d34e72bd48719bd1/comments", "author": {"login": "workingjubilee", "id": 46493976, "node_id": "MDQ6VXNlcjQ2NDkzOTc2", "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/workingjubilee", "html_url": "https://github.com/workingjubilee", "followers_url": "https://api.github.com/users/workingjubilee/followers", "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}", "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}", "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions", "organizations_url": "https://api.github.com/users/workingjubilee/orgs", "repos_url": "https://api.github.com/users/workingjubilee/repos", "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}", "received_events_url": "https://api.github.com/users/workingjubilee/received_events", "type": "User", "site_admin": false}, "committer": {"login": "workingjubilee", "id": 46493976, "node_id": "MDQ6VXNlcjQ2NDkzOTc2", "avatar_url": "https://avatars.githubusercontent.com/u/46493976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/workingjubilee", "html_url": "https://github.com/workingjubilee", "followers_url": "https://api.github.com/users/workingjubilee/followers", "following_url": "https://api.github.com/users/workingjubilee/following{/other_user}", "gists_url": "https://api.github.com/users/workingjubilee/gists{/gist_id}", "starred_url": "https://api.github.com/users/workingjubilee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/workingjubilee/subscriptions", "organizations_url": "https://api.github.com/users/workingjubilee/orgs", "repos_url": "https://api.github.com/users/workingjubilee/repos", "events_url": "https://api.github.com/users/workingjubilee/events{/privacy}", "received_events_url": "https://api.github.com/users/workingjubilee/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a9cd294cf2775441e713c7ee2918b728733b99f5", "url": "https://api.github.com/repos/rust-lang/rust/commits/a9cd294cf2775441e713c7ee2918b728733b99f5", "html_url": "https://github.com/rust-lang/rust/commit/a9cd294cf2775441e713c7ee2918b728733b99f5"}], "stats": {"total": 24, "additions": 14, "deletions": 10}, "files": [{"sha": "d036fbbb67d5690614bdc78c92b79d6fa74d3041", "filename": "compiler/rustc_lint/src/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0e88db7db4c09c63ba8a0036d34e72bd48719bd1/compiler%2Frustc_lint%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e88db7db4c09c63ba8a0036d34e72bd48719bd1/compiler%2Frustc_lint%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Flib.rs?ref=0e88db7db4c09c63ba8a0036d34e72bd48719bd1", "patch": "@@ -35,6 +35,8 @@\n #![feature(never_type)]\n #![feature(nll)]\n #![feature(or_patterns)]\n+#![feature(half_open_range_patterns)]\n+#![feature(exclusive_range_pattern)]\n #![recursion_limit = \"256\"]\n \n #[macro_use]"}, {"sha": "17f0d5632e657e0dfa71b346a74c6a645b974897", "filename": "compiler/rustc_lint/src/unused.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0e88db7db4c09c63ba8a0036d34e72bd48719bd1/compiler%2Frustc_lint%2Fsrc%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e88db7db4c09c63ba8a0036d34e72bd48719bd1/compiler%2Frustc_lint%2Fsrc%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Funused.rs?ref=0e88db7db4c09c63ba8a0036d34e72bd48719bd1", "patch": "@@ -250,13 +250,13 @@ impl<'tcx> LateLintPass<'tcx> for UnusedResults {\n                     has_emitted\n                 }\n                 ty::Array(ty, len) => match len.try_eval_usize(cx.tcx, cx.param_env) {\n+                    // If the array is empty we don't lint, to avoid false positives\n+                    Some(0) | None => false,\n                     // If the array is definitely non-empty, we can do `#[must_use]` checking.\n-                    Some(n) if n != 0 => {\n+                    Some(n) => {\n                         let descr_pre = &format!(\"{}array{} of \", descr_pre, plural_suffix,);\n                         check_must_use_ty(cx, ty, expr, span, descr_pre, descr_post, n as usize + 1)\n                     }\n-                    // Otherwise, we don't lint, to avoid false positives.\n-                    _ => false,\n                 },\n                 ty::Closure(..) => {\n                     cx.struct_span_lint(UNUSED_MUST_USE, span, |lint| {"}, {"sha": "5ccadb7e660f681c055c9700396fe25a8cdcc4d8", "filename": "compiler/rustc_middle/src/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0e88db7db4c09c63ba8a0036d34e72bd48719bd1/compiler%2Frustc_middle%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e88db7db4c09c63ba8a0036d34e72bd48719bd1/compiler%2Frustc_middle%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Flib.rs?ref=0e88db7db4c09c63ba8a0036d34e72bd48719bd1", "patch": "@@ -47,6 +47,8 @@\n #![feature(associated_type_bounds)]\n #![feature(rustc_attrs)]\n #![feature(int_error_matching)]\n+#![feature(half_open_range_patterns)]\n+#![feature(exclusive_range_pattern)]\n #![recursion_limit = \"512\"]\n \n #[macro_use]"}, {"sha": "2f7707b9498ad45541075e61788351088cd3ee00", "filename": "compiler/rustc_middle/src/ty/inhabitedness/mod.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0e88db7db4c09c63ba8a0036d34e72bd48719bd1/compiler%2Frustc_middle%2Fsrc%2Fty%2Finhabitedness%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e88db7db4c09c63ba8a0036d34e72bd48719bd1/compiler%2Frustc_middle%2Fsrc%2Fty%2Finhabitedness%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Finhabitedness%2Fmod.rs?ref=0e88db7db4c09c63ba8a0036d34e72bd48719bd1", "patch": "@@ -201,13 +201,13 @@ impl<'tcx> TyS<'tcx> {\n             ),\n \n             Array(ty, len) => match len.try_eval_usize(tcx, param_env) {\n+                Some(0) | None => DefIdForest::empty(),\n                 // If the array is definitely non-empty, it's uninhabited if\n                 // the type of its elements is uninhabited.\n-                Some(n) if n != 0 => ty.uninhabited_from(tcx, param_env),\n-                _ => DefIdForest::empty(),\n+                Some(1..) => ty.uninhabited_from(tcx, param_env),\n             },\n \n-            // References to uninitialised memory is valid for any type, including\n+            // References to uninitialised memory are valid for any type, including\n             // uninhabited types, in unsafe code, so we treat all references as\n             // inhabited.\n             // The precise semantics of inhabitedness with respect to references is currently"}, {"sha": "431fa30ed0fa1d9f8884c19ce1dbab01a90f07b6", "filename": "compiler/rustc_middle/src/ty/sty.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0e88db7db4c09c63ba8a0036d34e72bd48719bd1/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e88db7db4c09c63ba8a0036d34e72bd48719bd1/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fsty.rs?ref=0e88db7db4c09c63ba8a0036d34e72bd48719bd1", "patch": "@@ -1834,10 +1834,10 @@ impl<'tcx> TyS<'tcx> {\n             }\n             ty::Array(ty, len) => {\n                 match len.try_eval_usize(tcx, ParamEnv::empty()) {\n+                    Some(0) | None => false,\n                     // If the array is definitely non-empty, it's uninhabited if\n                     // the type of its elements is uninhabited.\n-                    Some(n) if n != 0 => ty.conservative_is_privately_uninhabited(tcx),\n-                    _ => false,\n+                    Some(1..) => ty.conservative_is_privately_uninhabited(tcx),\n                 }\n             }\n             ty::Ref(..) => {"}, {"sha": "55ee4e52082e51e3b10c57e4fc7dd2db3126b391", "filename": "compiler/rustc_session/src/filesearch.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0e88db7db4c09c63ba8a0036d34e72bd48719bd1/compiler%2Frustc_session%2Fsrc%2Ffilesearch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e88db7db4c09c63ba8a0036d34e72bd48719bd1/compiler%2Frustc_session%2Fsrc%2Ffilesearch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Ffilesearch.rs?ref=0e88db7db4c09c63ba8a0036d34e72bd48719bd1", "patch": "@@ -153,14 +153,14 @@ fn find_libdir(sysroot: &Path) -> Cow<'static, str> {\n     const SECONDARY_LIB_DIR: &str = \"lib\";\n \n     match option_env!(\"CFG_LIBDIR_RELATIVE\") {\n-        Some(libdir) if libdir != \"lib\" => libdir.into(),\n-        _ => {\n+        None | Some(\"lib\") => {\n             if sysroot.join(PRIMARY_LIB_DIR).join(RUST_LIB_DIR).exists() {\n                 PRIMARY_LIB_DIR.into()\n             } else {\n                 SECONDARY_LIB_DIR.into()\n             }\n         }\n+        Some(libdir) => libdir.into(),\n     }\n }\n "}]}