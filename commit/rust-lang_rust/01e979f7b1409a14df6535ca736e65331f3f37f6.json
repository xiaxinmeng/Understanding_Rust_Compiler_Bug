{"sha": "01e979f7b1409a14df6535ca736e65331f3f37f6", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAxZTk3OWY3YjE0MDlhMTRkZjY1MzVjYTczNmU2NTMzMWYzZjM3ZjY=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2017-11-14T15:52:12Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-11-14T15:52:12Z"}, "message": "Rollup merge of #45967 - matthewjasper:array-move-types, r=arielb1\n\nMIR-borrowck: don't ICE for cannot move from array error\n\nCloses #45694\ncompile-fail test E0508 now gives\n```text\nerror[E0508]: cannot move out of type `[NonCopy; 1]`, a non-copy array (Ast)\n  --> .\\src\\test\\compile-fail\\E0508.rs:18:18\n   |\n18 |     let _value = array[0];  //[ast]~ ERROR E0508\n   |                  ^^^^^^^^\n   |                  |\n   |                  cannot move out of here\n   |                  help: consider using a reference instead: `&array[0]`\n\nerror[E0508]: cannot move out of type `[NonCopy; 1]`, a non-copy array (Mir)\n  --> .\\src\\test\\compile-fail\\E0508.rs:18:18\n   |\n18 |     let _value = array[0];  //[ast]~ ERROR E0508\n   |                  ^^^^^^^^ cannot move out of here\n\nerror: aborting due to 2 previous errors\n```", "tree": {"sha": "114fc719d32ad2a2a61302a447894f7a01229648", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/114fc719d32ad2a2a61302a447894f7a01229648"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/01e979f7b1409a14df6535ca736e65331f3f37f6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/01e979f7b1409a14df6535ca736e65331f3f37f6", "html_url": "https://github.com/rust-lang/rust/commit/01e979f7b1409a14df6535ca736e65331f3f37f6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/01e979f7b1409a14df6535ca736e65331f3f37f6/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "529bb320f7d1c3a049fe5fe8d2542da4fb394dce", "url": "https://api.github.com/repos/rust-lang/rust/commits/529bb320f7d1c3a049fe5fe8d2542da4fb394dce", "html_url": "https://github.com/rust-lang/rust/commit/529bb320f7d1c3a049fe5fe8d2542da4fb394dce"}, {"sha": "a6824f18b886d3ca846916fb9bdc188453d2ebe9", "url": "https://api.github.com/repos/rust-lang/rust/commits/a6824f18b886d3ca846916fb9bdc188453d2ebe9", "html_url": "https://github.com/rust-lang/rust/commit/a6824f18b886d3ca846916fb9bdc188453d2ebe9"}], "stats": {"total": 26, "additions": 14, "deletions": 12}, "files": [{"sha": "4f0fff58918092e7a53b8125ad5812902ca1600f", "filename": "src/librustc_mir/borrow_check.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/01e979f7b1409a14df6535ca736e65331f3f37f6/src%2Flibrustc_mir%2Fborrow_check.rs", "raw_url": "https://github.com/rust-lang/rust/raw/01e979f7b1409a14df6535ca736e65331f3f37f6/src%2Flibrustc_mir%2Fborrow_check.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check.rs?ref=01e979f7b1409a14df6535ca736e65331f3f37f6", "patch": "@@ -93,9 +93,7 @@ fn do_mir_borrowck<'a, 'gcx, 'tcx>(infcx: &InferCtxt<'a, 'gcx, 'tcx>,\n                         tcx.cannot_move_out_of(span, \"borrowed_content\", origin),\n                     IllegalMoveOriginKind::InteriorOfTypeWithDestructor { container_ty: ty } =>\n                         tcx.cannot_move_out_of_interior_of_drop(span, ty, origin),\n-                    IllegalMoveOriginKind::InteriorOfSlice { elem_ty: ty, is_index } =>\n-                        tcx.cannot_move_out_of_interior_noncopy(span, ty, is_index, origin),\n-                    IllegalMoveOriginKind::InteriorOfArray { elem_ty: ty, is_index } =>\n+                    IllegalMoveOriginKind::InteriorOfSliceOrArray { ty, is_index } =>\n                         tcx.cannot_move_out_of_interior_noncopy(span, ty, is_index, origin),\n                 };\n                 err.emit();"}, {"sha": "f333dd4d2a1783c2d74dd643bf44d01b27120697", "filename": "src/librustc_mir/dataflow/move_paths/builder.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/01e979f7b1409a14df6535ca736e65331f3f37f6/src%2Flibrustc_mir%2Fdataflow%2Fmove_paths%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/01e979f7b1409a14df6535ca736e65331f3f37f6/src%2Flibrustc_mir%2Fdataflow%2Fmove_paths%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdataflow%2Fmove_paths%2Fbuilder.rs?ref=01e979f7b1409a14df6535ca736e65331f3f37f6", "patch": "@@ -137,21 +137,21 @@ impl<'b, 'a, 'gcx, 'tcx> Gatherer<'b, 'a, 'gcx, 'tcx> {\n             // move out of union - always move the entire union\n             ty::TyAdt(adt, _) if adt.is_union() =>\n                 return Err(MoveError::UnionMove { path: base }),\n-            ty::TySlice(elem_ty) =>\n+            ty::TySlice(_) =>\n                 return Err(MoveError::cannot_move_out_of(\n                     mir.source_info(self.loc).span,\n-                    InteriorOfSlice {\n-                        elem_ty, is_index: match proj.elem {\n+                    InteriorOfSliceOrArray {\n+                        ty: lv_ty, is_index: match proj.elem {\n                             ProjectionElem::Index(..) => true,\n                             _ => false\n                         },\n                     })),\n-            ty::TyArray(elem_ty, _num_elems) => match proj.elem {\n+            ty::TyArray(..) => match proj.elem {\n                 ProjectionElem::Index(..) =>\n                     return Err(MoveError::cannot_move_out_of(\n                         mir.source_info(self.loc).span,\n-                        InteriorOfArray {\n-                            elem_ty, is_index: true\n+                        InteriorOfSliceOrArray {\n+                            ty: lv_ty, is_index: true\n                         })),\n                 _ => {\n                     // FIXME: still badly broken"}, {"sha": "73218c9815024225d8be4eec876796c4f5e50a83", "filename": "src/librustc_mir/dataflow/move_paths/mod.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/01e979f7b1409a14df6535ca736e65331f3f37f6/src%2Flibrustc_mir%2Fdataflow%2Fmove_paths%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/01e979f7b1409a14df6535ca736e65331f3f37f6/src%2Flibrustc_mir%2Fdataflow%2Fmove_paths%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdataflow%2Fmove_paths%2Fmod.rs?ref=01e979f7b1409a14df6535ca736e65331f3f37f6", "patch": "@@ -239,8 +239,7 @@ pub(crate) enum IllegalMoveOriginKind<'tcx> {\n     Static,\n     BorrowedContent,\n     InteriorOfTypeWithDestructor { container_ty: ty::Ty<'tcx> },\n-    InteriorOfSlice { elem_ty: ty::Ty<'tcx>, is_index: bool, },\n-    InteriorOfArray { elem_ty: ty::Ty<'tcx>, is_index: bool, },\n+    InteriorOfSliceOrArray { ty: ty::Ty<'tcx>, is_index: bool, },\n }\n \n #[derive(Debug)]"}, {"sha": "d75f92580cc1d2fc9e6d5e4d490970827e285c84", "filename": "src/test/compile-fail/E0508.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/01e979f7b1409a14df6535ca736e65331f3f37f6/src%2Ftest%2Fcompile-fail%2FE0508.rs", "raw_url": "https://github.com/rust-lang/rust/raw/01e979f7b1409a14df6535ca736e65331f3f37f6/src%2Ftest%2Fcompile-fail%2FE0508.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2FE0508.rs?ref=01e979f7b1409a14df6535ca736e65331f3f37f6", "patch": "@@ -8,9 +8,14 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+// revisions: ast mir\n+//[mir]compile-flags: -Zborrowck-mir\n+\n struct NonCopy;\n \n fn main() {\n     let array = [NonCopy; 1];\n-    let _value = array[0]; //~ ERROR E0508\n+    let _value = array[0];  //[ast]~ ERROR E0508\n+                            //[mir]~^ ERROR (Ast) [E0508]\n+                            //[mir]~| ERROR (Mir) [E0508]\n }"}]}