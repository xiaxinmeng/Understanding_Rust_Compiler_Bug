{"sha": "9f6706975b3cca6bcf13e353eb47e238d65d5fe9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmNjcwNjk3NWIzY2NhNmJjZjEzZTM1M2ViNDdlMjM4ZDY1ZDVmZTk=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2013-12-22T21:59:08Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2013-12-26T23:54:36Z"}, "message": "librustc: De-`@mut` `fn_stats` in the stats", "tree": {"sha": "20ff11074955ff3e97aea8a102788f8fcf3418b9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/20ff11074955ff3e97aea8a102788f8fcf3418b9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9f6706975b3cca6bcf13e353eb47e238d65d5fe9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9f6706975b3cca6bcf13e353eb47e238d65d5fe9", "html_url": "https://github.com/rust-lang/rust/commit/9f6706975b3cca6bcf13e353eb47e238d65d5fe9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9f6706975b3cca6bcf13e353eb47e238d65d5fe9/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e84f79feb17d0b17f5898b5df934c3a5588eb4cf", "url": "https://api.github.com/repos/rust-lang/rust/commits/e84f79feb17d0b17f5898b5df934c3a5588eb4cf", "html_url": "https://github.com/rust-lang/rust/commit/e84f79feb17d0b17f5898b5df934c3a5588eb4cf"}], "stats": {"total": 31, "additions": 19, "deletions": 12}, "files": [{"sha": "e4bcfd3d1a7530a183b94cf762d0e3012b72ac11", "filename": "src/librustc/middle/trans/base.rs", "status": "modified", "additions": 16, "deletions": 10, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/9f6706975b3cca6bcf13e353eb47e238d65d5fe9/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f6706975b3cca6bcf13e353eb47e238d65d5fe9/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fbase.rs?ref=9f6706975b3cca6bcf13e353eb47e238d65d5fe9", "patch": "@@ -163,9 +163,12 @@ impl<'a> Drop for StatRecorder<'a> {\n             let end = time::precise_time_ns();\n             let elapsed = ((end - self.start) / 1_000_000) as uint;\n             let iend = self.ccx.stats.n_llvm_insns.get();\n-            self.ccx.stats.fn_stats.push((self.name.to_owned(),\n-                                          elapsed,\n-                                          iend - self.istart));\n+            {\n+                let mut fn_stats = self.ccx.stats.fn_stats.borrow_mut();\n+                fn_stats.get().push((self.name.to_owned(),\n+                                     elapsed,\n+                                     iend - self.istart));\n+            }\n             self.ccx.stats.n_fns.set(self.ccx.stats.n_fns.get() + 1);\n             // Reset LLVM insn count to avoid compound costs.\n             self.ccx.stats.n_llvm_insns.set(self.istart);\n@@ -3256,13 +3259,16 @@ pub fn trans_crate(sess: session::Session,\n         println!(\"n_inlines: {}\", ccx.stats.n_inlines.get());\n         println!(\"n_closures: {}\", ccx.stats.n_closures.get());\n         println(\"fn stats:\");\n-\n-        ccx.stats.fn_stats.sort_by(|&(_, _, insns_a), &(_, _, insns_b)| insns_b.cmp(&insns_a));\n-\n-        for tuple in ccx.stats.fn_stats.iter() {\n-            match *tuple {\n-                (ref name, ms, insns) => {\n-                    println!(\"{} insns, {} ms, {}\", insns, ms, *name);\n+        {\n+            let mut fn_stats = ccx.stats.fn_stats.borrow_mut();\n+            fn_stats.get().sort_by(|&(_, _, insns_a), &(_, _, insns_b)| {\n+                insns_b.cmp(&insns_a)\n+            });\n+            for tuple in fn_stats.get().iter() {\n+                match *tuple {\n+                    (ref name, ms, insns) => {\n+                        println!(\"{} insns, {} ms, {}\", insns, ms, *name);\n+                    }\n                 }\n             }\n         }"}, {"sha": "a9c5f223b944db34b6fad7055d7111135606f818", "filename": "src/librustc/middle/trans/common.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9f6706975b3cca6bcf13e353eb47e238d65d5fe9/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f6706975b3cca6bcf13e353eb47e238d65d5fe9/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcommon.rs?ref=9f6706975b3cca6bcf13e353eb47e238d65d5fe9", "patch": "@@ -136,7 +136,8 @@ pub struct Stats {\n     n_closures: Cell<uint>,\n     n_llvm_insns: Cell<uint>,\n     llvm_insns: RefCell<HashMap<~str, uint>>,\n-    fn_stats: ~[(~str, uint, uint)] // (ident, time-in-ms, llvm-instructions)\n+    // (ident, time-in-ms, llvm-instructions)\n+    fn_stats: RefCell<~[(~str, uint, uint)]>,\n }\n \n pub struct BuilderRef_res {"}, {"sha": "78d3dc8a2b16f5f990afa87b7c6cc6ebbce1231e", "filename": "src/librustc/middle/trans/context.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9f6706975b3cca6bcf13e353eb47e238d65d5fe9/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f6706975b3cca6bcf13e353eb47e238d65d5fe9/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcontext.rs?ref=9f6706975b3cca6bcf13e353eb47e238d65d5fe9", "patch": "@@ -221,7 +221,7 @@ impl CrateContext {\n                     n_closures: Cell::new(0u),\n                     n_llvm_insns: Cell::new(0u),\n                     llvm_insns: RefCell::new(HashMap::new()),\n-                    fn_stats: ~[]\n+                    fn_stats: RefCell::new(~[]),\n                   },\n                   tydesc_type: tydesc_type,\n                   int_type: int_type,"}]}