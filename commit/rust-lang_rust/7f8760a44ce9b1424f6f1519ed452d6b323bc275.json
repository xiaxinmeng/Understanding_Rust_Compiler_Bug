{"sha": "7f8760a44ce9b1424f6f1519ed452d6b323bc275", "node_id": "C_kwDOAAsO6NoAKDdmODc2MGE0NGNlOWIxNDI0ZjZmMTUxOWVkNDUyZDZiMzIzYmMyNzU", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-02-22T21:58:24Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-02-22T21:58:24Z"}, "message": "Auto merge of #8451 - matthiaskrgr:ui_speedup, r=llogiq\n\ntests: default to more threads for ui-tests\n\nBenchmarks (tested on i5-7200U, 2 cores, 4 threads)\n\n```\nmaster branch:\n\ncargo test // prime caches\ncargo --color=always test  70,39s user 21,91s system 180% cpu 51,035 total\ncargo --color=always test  70,77s user 22,13s system 180% cpu 51,579 total\ncargo --color=always test  70,97s user 22,12s system 180% cpu 51,673 total\n\ncargo --color=always nextest run  78,74s user 22,27s system 220% cpu 45,829 total\ncargo --color=always nextest run  78,46s user 21,92s system 224% cpu 44,674 total\ncargo --color=always nextest run  78,31s user 22,21s system 228% cpu 43,909 total\n\nPatched (ui_speedup branch):\n\ncargo test // prime cache\ncargo --color=always test  97,51s user 32,02s system 288% cpu 44,905 total\ncargo --color=always test  99,19s user 31,91s system 276% cpu 47,436 total\ncargo --color=always test  98,47s user 31,84s system 284% cpu 45,744 total\n\ncargo --color=always nextest run  102,18s user 30,80s system 350% cpu 37,902 total\ncargo --color=always nextest run  99,75s user 29,86s system 350% cpu 36,935 total\ncargo --color=always nextest run  100,36s user 29,93s system 351% cpu 37,061 total\n```\n\nchangelog: use more threads for running clippys ui-tests for ~10% walltime speedup", "tree": {"sha": "e6b860796a2f19d4f5d8b2cff9c24c4411ad6ce9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e6b860796a2f19d4f5d8b2cff9c24c4411ad6ce9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7f8760a44ce9b1424f6f1519ed452d6b323bc275", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7f8760a44ce9b1424f6f1519ed452d6b323bc275", "html_url": "https://github.com/rust-lang/rust/commit/7f8760a44ce9b1424f6f1519ed452d6b323bc275", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7f8760a44ce9b1424f6f1519ed452d6b323bc275/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9e605ef80f05fbaec22677e633971096675f2650", "url": "https://api.github.com/repos/rust-lang/rust/commits/9e605ef80f05fbaec22677e633971096675f2650", "html_url": "https://github.com/rust-lang/rust/commit/9e605ef80f05fbaec22677e633971096675f2650"}, {"sha": "a89c7958f5df4d45bfcf084cf371661bb2eaa96d", "url": "https://api.github.com/repos/rust-lang/rust/commits/a89c7958f5df4d45bfcf084cf371661bb2eaa96d", "html_url": "https://github.com/rust-lang/rust/commit/a89c7958f5df4d45bfcf084cf371661bb2eaa96d"}], "stats": {"total": 6, "additions": 6, "deletions": 0}, "files": [{"sha": "ef5b0a0cd7830f579af767382aee825158195f27", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/7f8760a44ce9b1424f6f1519ed452d6b323bc275/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/7f8760a44ce9b1424f6f1519ed452d6b323bc275/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=7f8760a44ce9b1424f6f1519ed452d6b323bc275", "patch": "@@ -50,6 +50,7 @@ syn = { version = \"1.0\", features = [\"full\"] }\n futures = \"0.3\"\n parking_lot = \"0.11.2\"\n tokio = { version = \"1\", features = [\"io-util\"] }\n+num_cpus = \"1.13\"\n \n [build-dependencies]\n rustc_tools_util = { version = \"0.2\", path = \"rustc_tools_util\" }"}, {"sha": "6bc74bc1e9aada60c2755bc51415ee8edb986854", "filename": "tests/compile-test.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7f8760a44ce9b1424f6f1519ed452d6b323bc275/tests%2Fcompile-test.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7f8760a44ce9b1424f6f1519ed452d6b323bc275/tests%2Fcompile-test.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-test.rs?ref=7f8760a44ce9b1424f6f1519ed452d6b323bc275", "patch": "@@ -162,6 +162,11 @@ fn run_ui() {\n     let config = base_config(\"ui\");\n     // use tests/clippy.toml\n     let _g = VarGuard::set(\"CARGO_MANIFEST_DIR\", fs::canonicalize(\"tests\").unwrap());\n+    let _threads = VarGuard::set(\n+        \"RUST_TEST_THREADS\",\n+        // if RUST_TEST_THREADS is set, adhere to it, otherwise override it\n+        env::var(\"RUST_TEST_THREADS\").unwrap_or_else(|_| num_cpus::get().to_string()),\n+    );\n     compiletest::run_tests(&config);\n }\n "}]}