{"sha": "281492898be7fd6b9705a818d2c880e9d7fd2da0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI4MTQ5Mjg5OGJlN2ZkNmI5NzA1YTgxOGQyYzg4MGU5ZDdmZDJkYTA=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2018-04-12T12:52:43Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2018-04-17T14:23:48Z"}, "message": "Clean up attribute handling in create_function_debug_context().", "tree": {"sha": "70dc046fe362db886d11a066144b32280fff793b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/70dc046fe362db886d11a066144b32280fff793b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/281492898be7fd6b9705a818d2c880e9d7fd2da0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/281492898be7fd6b9705a818d2c880e9d7fd2da0", "html_url": "https://github.com/rust-lang/rust/commit/281492898be7fd6b9705a818d2c880e9d7fd2da0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/281492898be7fd6b9705a818d2c880e9d7fd2da0/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6f9c36e40097de8a8094c0d9c77c9acc494ffc90", "url": "https://api.github.com/repos/rust-lang/rust/commits/6f9c36e40097de8a8094c0d9c77c9acc494ffc90", "html_url": "https://github.com/rust-lang/rust/commit/6f9c36e40097de8a8094c0d9c77c9acc494ffc90"}], "stats": {"total": 9, "additions": 5, "deletions": 4}, "files": [{"sha": "706dc3dca8a6143c2b10dc6faeb26d4dcd031f35", "filename": "src/librustc_trans/debuginfo/mod.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/281492898be7fd6b9705a818d2c880e9d7fd2da0/src%2Flibrustc_trans%2Fdebuginfo%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/281492898be7fd6b9705a818d2c880e9d7fd2da0/src%2Flibrustc_trans%2Fdebuginfo%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fdebuginfo%2Fmod.rs?ref=281492898be7fd6b9705a818d2c880e9d7fd2da0", "patch": "@@ -23,14 +23,15 @@ use self::source_loc::InternalDebugLocation::{self, UnknownLocation};\n use llvm;\n use llvm::{ModuleRef, ContextRef, ValueRef};\n use llvm::debuginfo::{DIFile, DIType, DIScope, DIBuilderRef, DISubprogram, DIArray, DIFlags};\n+use rustc::hir::TransFnAttrFlags;\n use rustc::hir::def_id::{DefId, CrateNum};\n use rustc::ty::subst::Substs;\n \n use abi::Abi;\n use common::CodegenCx;\n use builder::Builder;\n use monomorphize::Instance;\n-use rustc::ty::{self, ParamEnv, Ty};\n+use rustc::ty::{self, ParamEnv, Ty, InstanceDef};\n use rustc::mir;\n use rustc::session::config::{self, FullDebugInfo, LimitedDebugInfo, NoDebugInfo};\n use rustc::util::nodemap::{DefIdMap, FxHashMap, FxHashSet};\n@@ -210,13 +211,12 @@ pub fn create_function_debug_context<'a, 'tcx>(cx: &CodegenCx<'a, 'tcx>,\n         return FunctionDebugContext::DebugInfoDisabled;\n     }\n \n-    for attr in instance.def.attrs(cx.tcx).iter() {\n-        if attr.check_name(\"no_debug\") {\n+    if let InstanceDef::Item(def_id) = instance.def {\n+        if cx.tcx.trans_fn_attrs(def_id).flags.contains(TransFnAttrFlags::NO_DEBUG) {\n             return FunctionDebugContext::FunctionWithoutDebugInfo;\n         }\n     }\n \n-    let containing_scope = get_containing_scope(cx, instance);\n     let span = mir.span;\n \n     // This can be the case for functions inlined from another crate\n@@ -226,6 +226,7 @@ pub fn create_function_debug_context<'a, 'tcx>(cx: &CodegenCx<'a, 'tcx>,\n     }\n \n     let def_id = instance.def_id();\n+    let containing_scope = get_containing_scope(cx, instance);\n     let loc = span_start(cx, span);\n     let file_metadata = file_metadata(cx, &loc.file.name, def_id.krate);\n "}]}