{"sha": "2d85270bdf22d19072392ee15cff64de762c8315", "node_id": "C_kwDOAAsO6NoAKDJkODUyNzBiZGYyMmQxOTA3MjM5MmVlMTVjZmY2NGRlNzYyYzgzMTU", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-03-26T00:54:54Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-03-26T00:54:54Z"}, "message": "Auto merge of #95149 - cjgillot:once-diag, r=estebank\n\nRemove `Session::one_time_diagnostic`\n\nThis is untracked mutable state, which modified the behaviour of queries.\nIt was used for 2 things: some full-blown errors, but mostly for lint declaration notes (\"the lint level is defined here\" notes).\n\nIt is replaced by the diagnostic deduplication infra which already exists in the diagnostic emitter.\nA new diagnostic level `OnceNote` is introduced specifically for lint notes, to deduplicate subdiagnostics.\n\nAs a drive-by, diagnostic emission takes a `&mut` to allow dropping the `SubDiagnostic`s.", "tree": {"sha": "7e55d152336d517232ec879be4c330d4517fb864", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7e55d152336d517232ec879be4c330d4517fb864"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2d85270bdf22d19072392ee15cff64de762c8315", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2d85270bdf22d19072392ee15cff64de762c8315", "html_url": "https://github.com/rust-lang/rust/commit/2d85270bdf22d19072392ee15cff64de762c8315", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2d85270bdf22d19072392ee15cff64de762c8315/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b7b0dad656075e0d0e57cc189d7f0a4d29f9301e", "url": "https://api.github.com/repos/rust-lang/rust/commits/b7b0dad656075e0d0e57cc189d7f0a4d29f9301e", "html_url": "https://github.com/rust-lang/rust/commit/b7b0dad656075e0d0e57cc189d7f0a4d29f9301e"}, {"sha": "94c727eccf0d8befe27aca4050cbb880a6e0343b", "url": "https://api.github.com/repos/rust-lang/rust/commits/94c727eccf0d8befe27aca4050cbb880a6e0343b", "html_url": "https://github.com/rust-lang/rust/commit/94c727eccf0d8befe27aca4050cbb880a6e0343b"}], "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "855a6a6ef6adafd4aaa2dd5441189dce22e7b60d", "filename": "src/driver.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2d85270bdf22d19072392ee15cff64de762c8315/src%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d85270bdf22d19072392ee15cff64de762c8315/src%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdriver.rs?ref=2d85270bdf22d19072392ee15cff64de762c8315", "patch": "@@ -178,8 +178,8 @@ fn report_clippy_ice(info: &panic::PanicInfo<'_>, bug_report_url: &str) {\n     // a .span_bug or .bug call has already printed what\n     // it wants to print.\n     if !info.payload().is::<rustc_errors::ExplicitBug>() {\n-        let d = rustc_errors::Diagnostic::new(rustc_errors::Level::Bug, \"unexpected panic\");\n-        handler.emit_diagnostic(&d);\n+        let mut d = rustc_errors::Diagnostic::new(rustc_errors::Level::Bug, \"unexpected panic\");\n+        handler.emit_diagnostic(&mut d);\n     }\n \n     let version_info = rustc_tools_util::get_version_info!();"}]}