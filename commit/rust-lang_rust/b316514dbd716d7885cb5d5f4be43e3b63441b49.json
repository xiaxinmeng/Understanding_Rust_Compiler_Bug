{"sha": "b316514dbd716d7885cb5d5f4be43e3b63441b49", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIzMTY1MTRkYmQ3MTZkNzg4NWNiNWQ1ZjRiZTQzZTNiNjM0NDFiNDk=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-03-26T08:05:39Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-03-26T08:05:39Z"}, "message": "Rollup merge of #59150 - estebank:type-ascription, r=varkor\n\nExpand suggestions for type ascription parse errors\n\nFix #51222. CC #48016, #47666, #54516, #34255.", "tree": {"sha": "befdb4bb9eea756a2cfe7ffb8d6477ed689a0365", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/befdb4bb9eea756a2cfe7ffb8d6477ed689a0365"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b316514dbd716d7885cb5d5f4be43e3b63441b49", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcmd1TCRBK7hj4Ov3rIwAAdHIIAJvp+aU3VraPOuDj8QXgw45t\nFmqlPGJJsON0SmXO234+x3o8W4L9wrqa8SvRPCutSFJ8srnx5ZFBni0wmbwN8Cd8\nrS22T/kSjcjLhmYQJ9CI55ZSTmVcxXO2pBn/VJTyYiPwiQ09cqj5PFQVAMmpZjzv\nh5/EN95Kuiq6RxhQ7HqdyeY2WFsai/egNOrj8Wv9wloMVU5Mg0vRTLKYSSyzQyxu\n070XnYUud0GA1Mm5wpBs8NoEha1Cxmz9BIgbf0aX+S9OQ/D9sMFEI2MthVZm30MI\n1sI1mMWru+RN8vfOeYzHGbvPuRoWzFfdLHR0JAFwNnGhLGpvz8C0byzkaF9rPWU=\n=Okgq\n-----END PGP SIGNATURE-----\n", "payload": "tree befdb4bb9eea756a2cfe7ffb8d6477ed689a0365\nparent 54479c624cc24bb852291d83e11cc19389dcb21b\nparent d72ef21ddd4d56b3ec169a5ed64fa4cbf778c5c8\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1553587539 +0100\ncommitter GitHub <noreply@github.com> 1553587539 +0100\n\nRollup merge of #59150 - estebank:type-ascription, r=varkor\n\nExpand suggestions for type ascription parse errors\n\nFix #51222. CC #48016, #47666, #54516, #34255.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b316514dbd716d7885cb5d5f4be43e3b63441b49", "html_url": "https://github.com/rust-lang/rust/commit/b316514dbd716d7885cb5d5f4be43e3b63441b49", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b316514dbd716d7885cb5d5f4be43e3b63441b49/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "54479c624cc24bb852291d83e11cc19389dcb21b", "url": "https://api.github.com/repos/rust-lang/rust/commits/54479c624cc24bb852291d83e11cc19389dcb21b", "html_url": "https://github.com/rust-lang/rust/commit/54479c624cc24bb852291d83e11cc19389dcb21b"}, {"sha": "d72ef21ddd4d56b3ec169a5ed64fa4cbf778c5c8", "url": "https://api.github.com/repos/rust-lang/rust/commits/d72ef21ddd4d56b3ec169a5ed64fa4cbf778c5c8", "html_url": "https://github.com/rust-lang/rust/commit/d72ef21ddd4d56b3ec169a5ed64fa4cbf778c5c8"}], "stats": {"total": 324, "additions": 302, "deletions": 22}, "files": [{"sha": "f48cfa0b1479f2f66dc42dfb2c4edc8f1e64c06d", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 57, "deletions": 7, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -3262,32 +3262,82 @@ impl<'a> Resolver<'a> {\n         resolution\n     }\n \n-    fn type_ascription_suggestion(&self,\n-                                  err: &mut DiagnosticBuilder<'_>,\n-                                  base_span: Span) {\n+    /// Only used in a specific case of type ascription suggestions\n+    #[doc(hidden)]\n+    fn get_colon_suggestion_span(&self, start: Span) -> Span {\n+        let cm = self.session.source_map();\n+        start.to(cm.next_point(start))\n+    }\n+\n+    fn type_ascription_suggestion(\n+        &self,\n+        err: &mut DiagnosticBuilder<'_>,\n+        base_span: Span,\n+    ) {\n         debug!(\"type_ascription_suggetion {:?}\", base_span);\n         let cm = self.session.source_map();\n+        let base_snippet = cm.span_to_snippet(base_span);\n         debug!(\"self.current_type_ascription {:?}\", self.current_type_ascription);\n         if let Some(sp) = self.current_type_ascription.last() {\n             let mut sp = *sp;\n             loop {\n                 // Try to find the `:`; bail on first non-':' / non-whitespace.\n                 sp = cm.next_point(sp);\n                 if let Ok(snippet) = cm.span_to_snippet(sp.to(cm.next_point(sp))) {\n-                    debug!(\"snippet {:?}\", snippet);\n                     let line_sp = cm.lookup_char_pos(sp.hi()).line;\n                     let line_base_sp = cm.lookup_char_pos(base_span.lo()).line;\n-                    debug!(\"{:?} {:?}\", line_sp, line_base_sp);\n                     if snippet == \":\" {\n-                        err.span_label(base_span,\n-                                       \"expecting a type here because of type ascription\");\n+                        let mut show_label = true;\n                         if line_sp != line_base_sp {\n                             err.span_suggestion_short(\n                                 sp,\n                                 \"did you mean to use `;` here instead?\",\n                                 \";\".to_string(),\n                                 Applicability::MaybeIncorrect,\n                             );\n+                        } else {\n+                            let colon_sp = self.get_colon_suggestion_span(sp);\n+                            let after_colon_sp = self.get_colon_suggestion_span(\n+                                colon_sp.shrink_to_hi(),\n+                            );\n+                            if !cm.span_to_snippet(after_colon_sp).map(|s| s == \" \")\n+                                .unwrap_or(false)\n+                            {\n+                                err.span_suggestion(\n+                                    colon_sp,\n+                                    \"maybe you meant to write a path separator here\",\n+                                    \"::\".to_string(),\n+                                    Applicability::MaybeIncorrect,\n+                                );\n+                                show_label = false;\n+                            }\n+                            if let Ok(base_snippet) = base_snippet {\n+                                let mut sp = after_colon_sp;\n+                                for _ in 0..100 {\n+                                    // Try to find an assignment\n+                                    sp = cm.next_point(sp);\n+                                    let snippet = cm.span_to_snippet(sp.to(cm.next_point(sp)));\n+                                    match snippet {\n+                                        Ok(ref x) if x.as_str() == \"=\" => {\n+                                            err.span_suggestion(\n+                                                base_span,\n+                                                \"maybe you meant to write an assignment here\",\n+                                                format!(\"let {}\", base_snippet),\n+                                                Applicability::MaybeIncorrect,\n+                                            );\n+                                            show_label = false;\n+                                            break;\n+                                        }\n+                                        Ok(ref x) if x.as_str() == \"\\n\" => break,\n+                                        Err(_) => break,\n+                                        Ok(_) => {}\n+                                    }\n+                                }\n+                            }\n+                        }\n+                        if show_label {\n+                            err.span_label(base_span,\n+                                           \"expecting a type here because of type ascription\");\n                         }\n                         break;\n                     } else if !snippet.trim().is_empty() {"}, {"sha": "96c89d3176ab60ad035ccf39410a064a5b502cb2", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -1836,8 +1836,12 @@ impl<'a> Visitor<'a> for PostExpansionVisitor<'a> {\n                 gate_feature_post!(&self, box_syntax, e.span, EXPLAIN_BOX_SYNTAX);\n             }\n             ast::ExprKind::Type(..) => {\n-                gate_feature_post!(&self, type_ascription, e.span,\n-                                  \"type ascription is experimental\");\n+                // To avoid noise about type ascription in common syntax errors, only emit if it\n+                // is the *only* error.\n+                if self.context.parse_sess.span_diagnostic.err_count() == 0 {\n+                    gate_feature_post!(&self, type_ascription, e.span,\n+                                       \"type ascription is experimental\");\n+                }\n             }\n             ast::ExprKind::ObsoleteInPlace(..) => {\n                 // these get a hard error in ast-validation"}, {"sha": "a0c3fe356083f76bb6031d85f11d26b933b98d76", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 62, "deletions": 13, "changes": 75, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -3538,22 +3538,19 @@ impl<'a> Parser<'a> {\n                 lhs = self.parse_assoc_op_cast(lhs, lhs_span, ExprKind::Cast)?;\n                 continue\n             } else if op == AssocOp::Colon {\n+                let maybe_path = self.could_ascription_be_path(&lhs.node);\n+                let next_sp = self.span;\n+\n                 lhs = match self.parse_assoc_op_cast(lhs, lhs_span, ExprKind::Type) {\n                     Ok(lhs) => lhs,\n                     Err(mut err) => {\n-                        err.span_label(self.span,\n-                                       \"expecting a type here because of type ascription\");\n-                        let cm = self.sess.source_map();\n-                        let cur_pos = cm.lookup_char_pos(self.span.lo());\n-                        let op_pos = cm.lookup_char_pos(cur_op_span.hi());\n-                        if cur_pos.line != op_pos.line {\n-                            err.span_suggestion(\n-                                cur_op_span,\n-                                \"try using a semicolon\",\n-                                \";\".to_string(),\n-                                Applicability::MaybeIncorrect // speculative\n-                            );\n-                        }\n+                        self.bad_type_ascription(\n+                            &mut err,\n+                            lhs_span,\n+                            cur_op_span,\n+                            next_sp,\n+                            maybe_path,\n+                        );\n                         return Err(err);\n                     }\n                 };\n@@ -3658,6 +3655,58 @@ impl<'a> Parser<'a> {\n         Ok(lhs)\n     }\n \n+    fn could_ascription_be_path(&self, node: &ast::ExprKind) -> bool {\n+        self.token.is_ident() &&\n+            if let ast::ExprKind::Path(..) = node { true } else { false } &&\n+            !self.token.is_reserved_ident() &&           // v `foo:bar(baz)`\n+            self.look_ahead(1, |t| t == &token::OpenDelim(token::Paren)) ||\n+            self.look_ahead(1, |t| t == &token::Lt) &&     // `foo:bar<baz`\n+            self.look_ahead(2, |t| t.is_ident()) ||\n+            self.look_ahead(1, |t| t == &token::Colon) &&  // `foo:bar:baz`\n+            self.look_ahead(2, |t| t.is_ident()) ||\n+            self.look_ahead(1, |t| t == &token::ModSep) &&  // `foo:bar::baz`\n+            self.look_ahead(2, |t| t.is_ident())\n+    }\n+\n+    fn bad_type_ascription(\n+        &self,\n+        err: &mut DiagnosticBuilder<'a>,\n+        lhs_span: Span,\n+        cur_op_span: Span,\n+        next_sp: Span,\n+        maybe_path: bool,\n+    ) {\n+        err.span_label(self.span, \"expecting a type here because of type ascription\");\n+        let cm = self.sess.source_map();\n+        let next_pos = cm.lookup_char_pos(next_sp.lo());\n+        let op_pos = cm.lookup_char_pos(cur_op_span.hi());\n+        if op_pos.line != next_pos.line {\n+            err.span_suggestion(\n+                cur_op_span,\n+                \"try using a semicolon\",\n+                \";\".to_string(),\n+                Applicability::MaybeIncorrect,\n+            );\n+        } else {\n+            if maybe_path {\n+                err.span_suggestion(\n+                    cur_op_span,\n+                    \"maybe you meant to write a path separator here\",\n+                    \"::\".to_string(),\n+                    Applicability::MaybeIncorrect,\n+                );\n+            } else {\n+                err.note(\"type ascription is a nightly-only feature that lets \\\n+                          you annotate an expression with a type: `<expr>: <type>`\");\n+                err.span_note(\n+                    lhs_span,\n+                    \"this expression expects an ascribed type after the colon\",\n+                );\n+                err.help(\"this might be indicative of a syntax error elsewhere\");\n+            }\n+        }\n+    }\n+\n     fn parse_assoc_op_cast(&mut self, lhs: P<Expr>, lhs_span: Span,\n                            expr_kind: fn(P<Expr>, P<Ty>) -> ExprKind)\n                            -> PResult<'a, P<Expr>> {"}, {"sha": "b0ef4e1b25413c315c8de5df707a3ded89ec11ec", "filename": "src/test/ui/error-codes/E0423.stderr", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Ferror-codes%2FE0423.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Ferror-codes%2FE0423.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0423.stderr?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -3,6 +3,14 @@ error: expected type, found `1`\n    |\n LL |     if let S { x: _x, y: 2 } = S { x: 1, y: 2 } { println!(\"Ok\"); }\n    |                                       ^ expecting a type here because of type ascription\n+   |\n+   = note: type ascription is a nightly-only feature that lets you annotate an expression with a type: `<expr>: <type>`\n+note: this expression expects an ascribed type after the colon\n+  --> $DIR/E0423.rs:12:36\n+   |\n+LL |     if let S { x: _x, y: 2 } = S { x: 1, y: 2 } { println!(\"Ok\"); }\n+   |                                    ^\n+   = help: this might be indicative of a syntax error elsewhere\n \n error: expected expression, found `==`\n   --> $DIR/E0423.rs:15:13\n@@ -15,6 +23,14 @@ error: expected type, found `0`\n    |\n LL |     for _ in std::ops::Range { start: 0, end: 10 } {}\n    |                                       ^ expecting a type here because of type ascription\n+   |\n+   = note: type ascription is a nightly-only feature that lets you annotate an expression with a type: `<expr>: <type>`\n+note: this expression expects an ascribed type after the colon\n+  --> $DIR/E0423.rs:21:32\n+   |\n+LL |     for _ in std::ops::Range { start: 0, end: 10 } {}\n+   |                                ^^^^^\n+   = help: this might be indicative of a syntax error elsewhere\n \n error[E0423]: expected function, found struct `Foo`\n   --> $DIR/E0423.rs:4:13"}, {"sha": "a28ea0d09f8f0fca7452fabb99118a15dc7155b0", "filename": "src/test/ui/issues/issue-22644.stderr", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fissues%2Fissue-22644.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fissues%2Fissue-22644.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-22644.stderr?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -88,6 +88,14 @@ error: expected type, found `4`\n    |\n LL |     println!(\"{}\", a: &mut 4);\n    |                            ^ expecting a type here because of type ascription\n+   |\n+   = note: type ascription is a nightly-only feature that lets you annotate an expression with a type: `<expr>: <type>`\n+note: this expression expects an ascribed type after the colon\n+  --> $DIR/issue-22644.rs:34:20\n+   |\n+LL |     println!(\"{}\", a: &mut 4);\n+   |                    ^\n+   = help: this might be indicative of a syntax error elsewhere\n \n error: aborting due to 9 previous errors\n "}, {"sha": "b1071934bb2f3cea0aeb98e1833e4412da85f23e", "filename": "src/test/ui/issues/issue-34255-1.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fissues%2Fissue-34255-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fissues%2Fissue-34255-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-34255-1.rs?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -0,0 +1,10 @@\n+enum Test {\n+    Drill {\n+        field: i32,\n+    }\n+}\n+\n+fn main() {\n+    Test::Drill(field: 42);\n+    //~^ ERROR expected type, found\n+}"}, {"sha": "7899c8d30f1ddca60eea74c71ded0ba3b83918c1", "filename": "src/test/ui/issues/issue-34255-1.stderr", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fissues%2Fissue-34255-1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fissues%2Fissue-34255-1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-34255-1.stderr?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -0,0 +1,16 @@\n+error: expected type, found `42`\n+  --> $DIR/issue-34255-1.rs:8:24\n+   |\n+LL |     Test::Drill(field: 42);\n+   |                        ^^ expecting a type here because of type ascription\n+   |\n+   = note: type ascription is a nightly-only feature that lets you annotate an expression with a type: `<expr>: <type>`\n+note: this expression expects an ascribed type after the colon\n+  --> $DIR/issue-34255-1.rs:8:17\n+   |\n+LL |     Test::Drill(field: 42);\n+   |                 ^^^^^\n+   = help: this might be indicative of a syntax error elsewhere\n+\n+error: aborting due to previous error\n+"}, {"sha": "cb5a52a3e081a75668a83902803fca0418b88ddb", "filename": "src/test/ui/lifetime_starts_expressions.stderr", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Flifetime_starts_expressions.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Flifetime_starts_expressions.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flifetime_starts_expressions.stderr?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -13,6 +13,14 @@ error: expected type, found keyword `loop`\n    |\n LL |     loop { break 'label: loop { break 'label 42; }; }\n    |                          ^^^^ expecting a type here because of type ascription\n+   |\n+   = note: type ascription is a nightly-only feature that lets you annotate an expression with a type: `<expr>: <type>`\n+note: this expression expects an ascribed type after the colon\n+  --> $DIR/lifetime_starts_expressions.rs:6:12\n+   |\n+LL |     loop { break 'label: loop { break 'label 42; }; }\n+   |            ^^^^^^^^^^^^\n+   = help: this might be indicative of a syntax error elsewhere\n \n error: aborting due to 2 previous errors\n "}, {"sha": "07f2e41ac4fb036e5ffc546feac71947a2ca4191", "filename": "src/test/ui/parser/struct-literal-in-for.stderr", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fparser%2Fstruct-literal-in-for.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fparser%2Fstruct-literal-in-for.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fstruct-literal-in-for.stderr?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -3,6 +3,14 @@ error: expected type, found `3`\n    |\n LL |         x: 3\n    |            ^ expecting a type here because of type ascription\n+   |\n+   = note: type ascription is a nightly-only feature that lets you annotate an expression with a type: `<expr>: <type>`\n+note: this expression expects an ascribed type after the colon\n+  --> $DIR/struct-literal-in-for.rs:13:9\n+   |\n+LL |         x: 3\n+   |         ^\n+   = help: this might be indicative of a syntax error elsewhere\n \n error: expected one of `.`, `;`, `?`, `}`, or an operator, found `{`\n   --> $DIR/struct-literal-in-for.rs:14:12"}, {"sha": "3dd61e74f12eda67e9808948cc727bda1b915b25", "filename": "src/test/ui/parser/struct-literal-in-if.stderr", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fparser%2Fstruct-literal-in-if.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fparser%2Fstruct-literal-in-if.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fstruct-literal-in-if.stderr?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -3,6 +3,14 @@ error: expected type, found `3`\n    |\n LL |         x: 3\n    |            ^ expecting a type here because of type ascription\n+   |\n+   = note: type ascription is a nightly-only feature that lets you annotate an expression with a type: `<expr>: <type>`\n+note: this expression expects an ascribed type after the colon\n+  --> $DIR/struct-literal-in-if.rs:13:9\n+   |\n+LL |         x: 3\n+   |         ^\n+   = help: this might be indicative of a syntax error elsewhere\n \n error: expected one of `.`, `;`, `?`, `}`, or an operator, found `{`\n   --> $DIR/struct-literal-in-if.rs:14:12"}, {"sha": "d48244654cd023dd43250ecc39e446d45132d8da", "filename": "src/test/ui/parser/struct-literal-in-while.stderr", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fparser%2Fstruct-literal-in-while.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fparser%2Fstruct-literal-in-while.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fstruct-literal-in-while.stderr?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -3,6 +3,14 @@ error: expected type, found `3`\n    |\n LL |         x: 3\n    |            ^ expecting a type here because of type ascription\n+   |\n+   = note: type ascription is a nightly-only feature that lets you annotate an expression with a type: `<expr>: <type>`\n+note: this expression expects an ascribed type after the colon\n+  --> $DIR/struct-literal-in-while.rs:13:9\n+   |\n+LL |         x: 3\n+   |         ^\n+   = help: this might be indicative of a syntax error elsewhere\n \n error: expected one of `.`, `;`, `?`, `}`, or an operator, found `{`\n   --> $DIR/struct-literal-in-while.rs:14:12"}, {"sha": "a8c93233dbc535408b4e55e670dcc5aa52cdb19d", "filename": "src/test/ui/parser/struct-literal-restrictions-in-lamda.stderr", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fparser%2Fstruct-literal-restrictions-in-lamda.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fparser%2Fstruct-literal-restrictions-in-lamda.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fstruct-literal-restrictions-in-lamda.stderr?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -3,6 +3,14 @@ error: expected type, found `3`\n    |\n LL |         x: 3\n    |            ^ expecting a type here because of type ascription\n+   |\n+   = note: type ascription is a nightly-only feature that lets you annotate an expression with a type: `<expr>: <type>`\n+note: this expression expects an ascribed type after the colon\n+  --> $DIR/struct-literal-restrictions-in-lamda.rs:13:9\n+   |\n+LL |         x: 3\n+   |         ^\n+   = help: this might be indicative of a syntax error elsewhere\n \n error: expected one of `.`, `;`, `?`, `}`, or an operator, found `{`\n   --> $DIR/struct-literal-restrictions-in-lamda.rs:14:12"}, {"sha": "0e1c307502728c7c8bedf38e64887a2e894be3d2", "filename": "src/test/ui/suggestions/type-ascription-instead-of-let.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-let.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-let.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-let.rs?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -0,0 +1,10 @@\n+fn fun(x: i32) -> i32 { x }\n+\n+fn main() {\n+    let closure_annotated = |value: i32| -> i32 {\n+        temp: i32 = fun(5i32);\n+        //~^ ERROR cannot find value `temp` in this scope\n+        temp + value + 1\n+        //~^ ERROR cannot find value `temp` in this scope\n+    };\n+}"}, {"sha": "92e4b5798c88944db86f6afeb97669b913b3ca14", "filename": "src/test/ui/suggestions/type-ascription-instead-of-let.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-let.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-let.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-let.stderr?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -0,0 +1,18 @@\n+error[E0425]: cannot find value `temp` in this scope\n+  --> $DIR/type-ascription-instead-of-let.rs:5:9\n+   |\n+LL |         temp: i32 = fun(5i32);\n+   |         ^^^^\n+   |         |\n+   |         not found in this scope\n+   |         help: maybe you meant to write an assignment here: `let temp`\n+\n+error[E0425]: cannot find value `temp` in this scope\n+  --> $DIR/type-ascription-instead-of-let.rs:7:9\n+   |\n+LL |         temp + value + 1\n+   |         ^^^^ not found in this scope\n+\n+error: aborting due to 2 previous errors\n+\n+For more information about this error, try `rustc --explain E0425`."}, {"sha": "361729d50c2f393fd386bdc8d4d966bba5c95379", "filename": "src/test/ui/suggestions/type-ascription-instead-of-method.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-method.rs?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -0,0 +1,4 @@\n+fn main() {\n+    Box:new(\"foo\".to_string())\n+    //~^ ERROR expected type, found\n+}"}, {"sha": "15ec087b1cc01d790083c55d356776c1fe2e037f", "filename": "src/test/ui/suggestions/type-ascription-instead-of-method.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-method.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-method.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-method.stderr?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -0,0 +1,10 @@\n+error: expected type, found `\"foo\"`\n+  --> $DIR/type-ascription-instead-of-method.rs:2:13\n+   |\n+LL |     Box:new(\"foo\".to_string())\n+   |        -    ^^^^^ expecting a type here because of type ascription\n+   |        |\n+   |        help: maybe you meant to write a path separator here: `::`\n+\n+error: aborting due to previous error\n+"}, {"sha": "4c0fe6d8b5b4e29a3c65d4c882d31a049fb41be4", "filename": "src/test/ui/suggestions/type-ascription-instead-of-path.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-path.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-path.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-path.rs?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -0,0 +1,5 @@\n+fn main() {\n+    std:io::stdin();\n+    //~^ ERROR failed to resolve: use of undeclared type or module `io`\n+    //~| ERROR expected value, found module\n+}"}, {"sha": "1beb822d6a74946ec91823e537001384718bdef4", "filename": "src/test/ui/suggestions/type-ascription-instead-of-path.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-path.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-path.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-path.stderr?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -0,0 +1,18 @@\n+error[E0433]: failed to resolve: use of undeclared type or module `io`\n+  --> $DIR/type-ascription-instead-of-path.rs:2:9\n+   |\n+LL |     std:io::stdin();\n+   |         ^^ use of undeclared type or module `io`\n+\n+error[E0423]: expected value, found module `std`\n+  --> $DIR/type-ascription-instead-of-path.rs:2:5\n+   |\n+LL |     std:io::stdin();\n+   |     ^^^- help: maybe you meant to write a path separator here: `::`\n+   |     |\n+   |     not a value\n+\n+error: aborting due to 2 previous errors\n+\n+Some errors occurred: E0423, E0433.\n+For more information about an error, try `rustc --explain E0423`."}, {"sha": "b90867fef6b51d4fa365e31870956d4c402a6b33", "filename": "src/test/ui/suggestions/type-ascription-instead-of-variant.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-variant.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-variant.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-variant.rs?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -0,0 +1,4 @@\n+fn main() {\n+    let _ = Option:Some(\"\");\n+    //~^ ERROR expected type, found\n+}"}, {"sha": "5719a667a841509b4f16a3425f5d45930b019649", "filename": "src/test/ui/suggestions/type-ascription-instead-of-variant.stderr", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-variant.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-variant.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Ftype-ascription-instead-of-variant.stderr?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -0,0 +1,10 @@\n+error: expected type, found `\"\"`\n+  --> $DIR/type-ascription-instead-of-variant.rs:2:25\n+   |\n+LL |     let _ = Option:Some(\"\");\n+   |                   -     ^^ expecting a type here because of type ascription\n+   |                   |\n+   |                   help: maybe you meant to write a path separator here: `::`\n+\n+error: aborting due to previous error\n+"}, {"sha": "2084cbcce4f6253ddd17027f2864c8b7498c288c", "filename": "src/test/ui/type/type-ascription-instead-of-statement-end.stderr", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Ftype%2Ftype-ascription-instead-of-statement-end.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b316514dbd716d7885cb5d5f4be43e3b63441b49/src%2Ftest%2Fui%2Ftype%2Ftype-ascription-instead-of-statement-end.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype%2Ftype-ascription-instead-of-statement-end.stderr?ref=b316514dbd716d7885cb5d5f4be43e3b63441b49", "patch": "@@ -11,6 +11,14 @@ error: expected type, found `0`\n    |\n LL |     println!(\"test\"): 0;\n    |                       ^ expecting a type here because of type ascription\n+   |\n+   = note: type ascription is a nightly-only feature that lets you annotate an expression with a type: `<expr>: <type>`\n+note: this expression expects an ascribed type after the colon\n+  --> $DIR/type-ascription-instead-of-statement-end.rs:9:5\n+   |\n+LL |     println!(\"test\"): 0;\n+   |     ^^^^^^^^^^^^^^^^\n+   = help: this might be indicative of a syntax error elsewhere\n \n error: aborting due to 2 previous errors\n "}]}