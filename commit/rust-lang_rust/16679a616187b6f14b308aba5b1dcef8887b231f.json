{"sha": "16679a616187b6f14b308aba5b1dcef8887b231f", "node_id": "C_kwDOAAsO6NoAKDE2Njc5YTYxNjE4N2I2ZjE0YjMwOGFiYTViMWRjZWY4ODg3YjIzMWY", "commit": {"author": {"name": "zredb", "email": "zredb@163.com", "date": "2022-01-15T09:00:59Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2022-01-17T12:41:59Z"}, "message": "fix #90187\nremove the definition of def_id_no_primitives and change;\n a missing use was modified;\n narrow the Cache accessibility of BadImplStripper;", "tree": {"sha": "2e5e6334180b8fbcb308ccea6fb253d4a23591df", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2e5e6334180b8fbcb308ccea6fb253d4a23591df"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/16679a616187b6f14b308aba5b1dcef8887b231f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/16679a616187b6f14b308aba5b1dcef8887b231f", "html_url": "https://github.com/rust-lang/rust/commit/16679a616187b6f14b308aba5b1dcef8887b231f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/16679a616187b6f14b308aba5b1dcef8887b231f/comments", "author": {"login": "zredb", "id": 8102504, "node_id": "MDQ6VXNlcjgxMDI1MDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/8102504?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zredb", "html_url": "https://github.com/zredb", "followers_url": "https://api.github.com/users/zredb/followers", "following_url": "https://api.github.com/users/zredb/following{/other_user}", "gists_url": "https://api.github.com/users/zredb/gists{/gist_id}", "starred_url": "https://api.github.com/users/zredb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zredb/subscriptions", "organizations_url": "https://api.github.com/users/zredb/orgs", "repos_url": "https://api.github.com/users/zredb/repos", "events_url": "https://api.github.com/users/zredb/events{/privacy}", "received_events_url": "https://api.github.com/users/zredb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "be9d6335f74ed6e23ac0b34a3603410ab3abca31", "url": "https://api.github.com/repos/rust-lang/rust/commits/be9d6335f74ed6e23ac0b34a3603410ab3abca31", "html_url": "https://github.com/rust-lang/rust/commit/be9d6335f74ed6e23ac0b34a3603410ab3abca31"}], "stats": {"total": 18, "additions": 3, "deletions": 15}, "files": [{"sha": "bb8dc7827d62f82e27e8f7b5ce1fb60fde9ffea8", "filename": "src/librustdoc/clean/types.rs", "status": "modified", "additions": 1, "deletions": 13, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/16679a616187b6f14b308aba5b1dcef8887b231f/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/16679a616187b6f14b308aba5b1dcef8887b231f/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Ftypes.rs?ref=16679a616187b6f14b308aba5b1dcef8887b231f", "patch": "@@ -1566,23 +1566,11 @@ impl Type {\n \n     /// Use this method to get the [DefId] of a [clean] AST node, including [PrimitiveType]s.\n     ///\n-    /// See [`Self::def_id_no_primitives`] for more.\n-    ///\n     /// [clean]: crate::clean\n+    ///\n     crate fn def_id(&self, cache: &Cache) -> Option<DefId> {\n         self.inner_def_id(Some(cache))\n     }\n-\n-    /// Use this method to get the [`DefId`] of a [`clean`] AST node.\n-    /// This will return [`None`] when called on a primitive [`clean::Type`].\n-    /// Use [`Self::def_id`] if you want to include primitives.\n-    ///\n-    /// [`clean`]: crate::clean\n-    /// [`clean::Type`]: crate::clean::Type\n-    // FIXME: get rid of this function and always use `def_id`\n-    crate fn def_id_no_primitives(&self) -> Option<DefId> {\n-        self.inner_def_id(None)\n-    }\n }\n \n /// A primitive (aka, builtin) type."}, {"sha": "53280b3df138b39a03724cd22fd00fe63938d411", "filename": "src/librustdoc/passes/collect_trait_impls.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/16679a616187b6f14b308aba5b1dcef8887b231f/src%2Flibrustdoc%2Fpasses%2Fcollect_trait_impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/16679a616187b6f14b308aba5b1dcef8887b231f/src%2Flibrustdoc%2Fpasses%2Fcollect_trait_impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcollect_trait_impls.rs?ref=16679a616187b6f14b308aba5b1dcef8887b231f", "patch": "@@ -208,7 +208,7 @@ impl DocVisitor for ItemCollector {\n struct BadImplStripper<'a> {\n     prims: FxHashSet<PrimitiveType>,\n     items: FxHashSet<ItemId>,\n-    crate cache: &'a Cache,\n+    cache: &'a Cache,\n }\n \n impl<'a> BadImplStripper<'a> {"}, {"sha": "717dc078b343cf3fd46176df79c8b54d74de2c74", "filename": "src/librustdoc/passes/stripper.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/16679a616187b6f14b308aba5b1dcef8887b231f/src%2Flibrustdoc%2Fpasses%2Fstripper.rs", "raw_url": "https://github.com/rust-lang/rust/raw/16679a616187b6f14b308aba5b1dcef8887b231f/src%2Flibrustdoc%2Fpasses%2Fstripper.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fstripper.rs?ref=16679a616187b6f14b308aba5b1dcef8887b231f", "patch": "@@ -144,7 +144,7 @@ impl<'a> DocFolder for ImplStripper<'a> {\n             }\n             if let Some(generics) = imp.trait_.as_ref().and_then(|t| t.generics()) {\n                 for typaram in generics {\n-                    if let Some(did) = typaram.def_id_no_primitives() {\n+                    if let Some(did) = typaram.def_id(self.cache) {\n                         if did.is_local() && !self.retained.contains(&did.into()) {\n                             debug!(\n                                 \"ImplStripper: stripped item in trait's generics; removing impl\""}]}