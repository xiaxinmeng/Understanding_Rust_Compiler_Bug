{"sha": "b38a86a145b510663e8b57f0a6df64f3c969cf1f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIzOGE4NmExNDViNTEwNjYzZThiNTdmMGE2ZGY2NGYzYzk2OWNmMWY=", "commit": {"author": {"name": "Martin Carton", "email": "cartonmartin+github@gmail.com", "date": "2016-08-29T12:19:08Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-08-29T12:19:08Z"}, "message": "Merge pull request #1200 from killercup/feature/gh-pages-fixes\n\nTweak HTML version of docs with scroll to lints", "tree": {"sha": "ab706c5a50f72ac6d9103e0a1f25caa67e05b1f4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ab706c5a50f72ac6d9103e0a1f25caa67e05b1f4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b38a86a145b510663e8b57f0a6df64f3c969cf1f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b38a86a145b510663e8b57f0a6df64f3c969cf1f", "html_url": "https://github.com/rust-lang/rust/commit/b38a86a145b510663e8b57f0a6df64f3c969cf1f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b38a86a145b510663e8b57f0a6df64f3c969cf1f/comments", "author": {"login": "mcarton", "id": 3751788, "node_id": "MDQ6VXNlcjM3NTE3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/3751788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarton", "html_url": "https://github.com/mcarton", "followers_url": "https://api.github.com/users/mcarton/followers", "following_url": "https://api.github.com/users/mcarton/following{/other_user}", "gists_url": "https://api.github.com/users/mcarton/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarton/subscriptions", "organizations_url": "https://api.github.com/users/mcarton/orgs", "repos_url": "https://api.github.com/users/mcarton/repos", "events_url": "https://api.github.com/users/mcarton/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c54457ccf384812c7f1dc089de1792405933c442", "url": "https://api.github.com/repos/rust-lang/rust/commits/c54457ccf384812c7f1dc089de1792405933c442", "html_url": "https://github.com/rust-lang/rust/commit/c54457ccf384812c7f1dc089de1792405933c442"}, {"sha": "3e2bb3fd813a4ea07668e2a678b8c7cc8878fc82", "url": "https://api.github.com/repos/rust-lang/rust/commits/3e2bb3fd813a4ea07668e2a678b8c7cc8878fc82", "html_url": "https://github.com/rust-lang/rust/commit/3e2bb3fd813a4ea07668e2a678b8c7cc8878fc82"}], "stats": {"total": 65, "additions": 57, "deletions": 8}, "files": [{"sha": "04196eef396089d0453cb999a4f2682682efc673", "filename": "util/gh-pages/index.html", "status": "modified", "additions": 57, "deletions": 8, "changes": 65, "blob_url": "https://github.com/rust-lang/rust/blob/b38a86a145b510663e8b57f0a6df64f3c969cf1f/util%2Fgh-pages%2Findex.html", "raw_url": "https://github.com/rust-lang/rust/raw/b38a86a145b510663e8b57f0a6df64f3c969cf1f/util%2Fgh-pages%2Findex.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/util%2Fgh-pages%2Findex.html?ref=b38a86a145b510663e8b57f0a6df64f3c969cf1f", "patch": "@@ -62,7 +62,8 @@ <h1>ALL the Clippy Lints</h1>\n                 </div>\n             </div>\n \n-            <article class=\"panel panel-default\" id=\"{{lint.id}}\" ng-repeat=\"lint in data | filter:byLevels | filter:search | orderBy:'id' track by lint.id\">\n+            <article class=\"panel panel-default\" id=\"{{lint.id}}\"\n+                ng-repeat=\"lint in data | filter:byLevels | filter:search | orderBy:'id' track by lint.id\" on-finish-render=\"ngRepeatFinished\">\n                 <header class=\"panel-heading\" ng-click=\"open[lint.id] = !open[lint.id]\">\n                     <button class=\"btn btn-default btn-sm pull-right\" style=\"margin-top: -6px;\">\n                         <span ng-show=\"open[lint.id]\">&minus;</span>\n@@ -77,11 +78,11 @@ <h2 class=\"panel-title\">\n                         <span ng-if=\"lint.level == 'Deny'\" class=\"label label-danger\">Deny</span>\n                         <span ng-if=\"lint.level == 'Deprecated'\" class=\"label label-default\">Deprecated</span>\n \n-                        <a href=\"#{{lint.id}}\" class=\"anchor label label-default\">&para;</a>\n+                        <a href=\"#{{lint.id}}\" class=\"anchor label label-default\" ng-click=\"open[lint.id] = true; $event.stopPropagation()\">&para;</a>\n                     </h2>\n                 </header>\n \n-                <ul class=\"list-group\" ng-if=\"lint.docs\" ng-class=\"{collapse: true, in: open[lint.id]}\">\n+                <ul class=\"list-group lint-docs\" ng-if=\"lint.docs\" ng-class=\"{collapse: true, in: open[lint.id]}\">\n                     <li class=\"list-group-item\" ng-repeat=\"(title, text) in lint.docs\">\n                         <h4 class=\"list-group-item-heading\">\n                             {{title}}\n@@ -96,7 +97,7 @@ <h4 class=\"list-group-item-heading\">\n     <a href=\"https://github.com/Manishearth/rust-clippy\">\n         <img style=\"position: absolute; top: 0; right: 0; border: 0;\" src=\"https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png\"/>\n     </a>\n-    \n+\n     <script src=\"https://cdnjs.cloudflare.com/ajax/libs/markdown-it/7.0.0/markdown-it.min.js\"></script>\n     <script src=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/highlight.min.js\"></script>\n     <script src=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/languages/rust.min.js\"></script>\n@@ -120,6 +121,21 @@ <h4 class=\"list-group-item-heading\">\n             }\n         });\n \n+        function scrollToLint(lintId) {\n+            var target = document.getElementById(lintId);\n+            if (!target) {\n+                return;\n+            }\n+            target.scrollIntoView();\n+        }\n+\n+        function scrollToLintByURL($scope) {\n+            var removeListener = $scope.$on('ngRepeatFinished', function(ngRepeatFinishedEvent) {\n+                scrollToLint(window.location.hash.slice(1));\n+                removeListener();\n+            });\n+        }\n+\n         angular.module(\"clippy\", [])\n         .filter('markdown', function ($sce) {\n             return function (text) {\n@@ -130,9 +146,22 @@ <h4 class=\"list-group-item-heading\">\n                 );\n             };\n         })\n-        .controller(\"lintList\", function ($scope, $http) {\n+        .directive('onFinishRender', function ($timeout) {\n+            return {\n+                restrict: 'A',\n+                link: function (scope, element, attr) {\n+                    if (scope.$last === true) {\n+                        $timeout(function () {\n+                            scope.$emit(attr.onFinishRender);\n+                        });\n+                    }\n+                }\n+            };\n+        })\n+        .controller(\"lintList\", function ($scope, $http, $timeout) {\n             // Level filter\n-            $scope.levels = {Allow: true, Warn: true, Deny: true, Deprecated: true};\n+            var LEVEL_FILTERS_DEFAULT = {Allow: true, Warn: true, Deny: true, Deprecated: true};\n+            $scope.levels = LEVEL_FILTERS_DEFAULT;\n             $scope.byLevels = function (lint) {\n                 return $scope.levels[lint.level];\n             };\n@@ -141,17 +170,37 @@ <h4 class=\"list-group-item-heading\">\n             $scope.open = {};\n             $scope.loading = true;\n \n+            if (window.location.hash.length > 1) {\n+                $scope.search = window.location.hash.slice(1);\n+                $scope.open[window.location.hash.slice(1)] = true;\n+                scrollToLintByURL($scope);\n+            }\n+\n             $http.get('./lints.json')\n             .success(function (data) {\n                 $scope.data = data;\n                 $scope.loading = false;\n+\n+                scrollToLintByURL($scope);\n             })\n             .error(function (data) {\n                 $scope.error = data;\n                 $scope.loading = false;\n             });\n-        })\n+\n+            window.addEventListener('hashchange', function () {\n+                // trigger re-render\n+                $timeout(function () {\n+                    $scope.levels = LEVEL_FILTERS_DEFAULT;\n+                    $scope.search = window.location.hash.slice(1);\n+                    $scope.open[window.location.hash.slice(1)] = true;\n+\n+                    scrollToLintByURL($scope);\n+                });\n+                return true;\n+            }, false);\n+        });\n     })();\n     </script>\n </body>\n-</html>\n\\ No newline at end of file\n+</html>"}]}