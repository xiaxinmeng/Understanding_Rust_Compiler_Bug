{"sha": "355cfcdf433c47bfb2365752d33f2a24dfc6e78f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM1NWNmY2RmNDMzYzQ3YmZiMjM2NTc1MmQzM2YyYTI0ZGZjNmU3OGY=", "commit": {"author": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2019-11-11T19:50:27Z"}, "committer": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2020-01-14T22:37:16Z"}, "message": "Use unified dataflow framework in `check_consts`", "tree": {"sha": "2f6ed5610e49fb78a9e3af690e26b920187552a6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2f6ed5610e49fb78a9e3af690e26b920187552a6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/355cfcdf433c47bfb2365752d33f2a24dfc6e78f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/355cfcdf433c47bfb2365752d33f2a24dfc6e78f", "html_url": "https://github.com/rust-lang/rust/commit/355cfcdf433c47bfb2365752d33f2a24dfc6e78f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/355cfcdf433c47bfb2365752d33f2a24dfc6e78f/comments", "author": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7d5885727d4a42518f811933de20676f8be61818", "url": "https://api.github.com/repos/rust-lang/rust/commits/7d5885727d4a42518f811933de20676f8be61818", "html_url": "https://github.com/rust-lang/rust/commit/7d5885727d4a42518f811933de20676f8be61818"}], "stats": {"total": 22, "additions": 12, "deletions": 10}, "files": [{"sha": "2cd2495eef8a29523281a3c1c2f4195758377d33", "filename": "src/librustc_mir/transform/check_consts/resolver.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/355cfcdf433c47bfb2365752d33f2a24dfc6e78f/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fresolver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/355cfcdf433c47bfb2365752d33f2a24dfc6e78f/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fresolver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fresolver.rs?ref=355cfcdf433c47bfb2365752d33f2a24dfc6e78f", "patch": "@@ -158,7 +158,7 @@ impl<Q> old_dataflow::BottomValue for FlowSensitiveAnalysis<'_, '_, '_, Q> {\n     const BOTTOM_VALUE: bool = false;\n }\n \n-impl<Q> dataflow::Analysis<'tcx> for FlowSensitiveAnalysis<'_, '_, 'tcx, Q>\n+impl<Q> dataflow::AnalysisDomain<'tcx> for FlowSensitiveAnalysis<'_, '_, 'tcx, Q>\n where\n     Q: Qualif,\n {\n@@ -173,7 +173,12 @@ where\n     fn initialize_start_block(&self, _body: &mir::Body<'tcx>, state: &mut BitSet<Self::Idx>) {\n         self.transfer_function(state).initialize_state();\n     }\n+}\n \n+impl<Q> dataflow::Analysis<'tcx> for FlowSensitiveAnalysis<'_, '_, 'tcx, Q>\n+where\n+    Q: Qualif,\n+{\n     fn apply_statement_effect(\n         &self,\n         state: &mut BitSet<Self::Idx>,"}, {"sha": "243077a7c2fbe19aabb7434f585695898bd7f090", "filename": "src/librustc_mir/transform/check_consts/validation.rs", "status": "modified", "additions": 6, "deletions": 9, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/355cfcdf433c47bfb2365752d33f2a24dfc6e78f/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fvalidation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/355cfcdf433c47bfb2365752d33f2a24dfc6e78f/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fvalidation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fvalidation.rs?ref=355cfcdf433c47bfb2365752d33f2a24dfc6e78f", "patch": "@@ -33,11 +33,10 @@ struct QualifCursor<'a, 'mir, 'tcx, Q: Qualif> {\n }\n \n impl<Q: Qualif> QualifCursor<'a, 'mir, 'tcx, Q> {\n-    pub fn new(q: Q, item: &'a Item<'mir, 'tcx>, dead_unwinds: &BitSet<BasicBlock>) -> Self {\n+    pub fn new(q: Q, item: &'a Item<'mir, 'tcx>) -> Self {\n         let analysis = FlowSensitiveAnalysis::new(q, item);\n-        let results =\n-            dataflow::Engine::new(item.tcx, &item.body, item.def_id, dead_unwinds, analysis)\n-                .iterate_to_fixpoint();\n+        let results = dataflow::Engine::new_generic(item.tcx, &item.body, item.def_id, analysis)\n+            .iterate_to_fixpoint();\n         let cursor = dataflow::ResultsCursor::new(*item.body, results);\n \n         let mut in_any_value_of_ty = BitSet::new_empty(item.body.local_decls.len());\n@@ -146,12 +145,10 @@ impl Deref for Validator<'_, 'mir, 'tcx> {\n \n impl Validator<'a, 'mir, 'tcx> {\n     pub fn new(item: &'a Item<'mir, 'tcx>) -> Self {\n-        let dead_unwinds = BitSet::new_empty(item.body.basic_blocks().len());\n-\n-        let needs_drop = QualifCursor::new(NeedsDrop, item, &dead_unwinds);\n-\n-        let has_mut_interior = QualifCursor::new(HasMutInterior, item, &dead_unwinds);\n+        let needs_drop = QualifCursor::new(NeedsDrop, item);\n+        let has_mut_interior = QualifCursor::new(HasMutInterior, item);\n \n+        let dead_unwinds = BitSet::new_empty(item.body.basic_blocks().len());\n         let indirectly_mutable = old_dataflow::do_dataflow(\n             item.tcx,\n             &*item.body,"}]}