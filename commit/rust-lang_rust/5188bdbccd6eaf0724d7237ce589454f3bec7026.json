{"sha": "5188bdbccd6eaf0724d7237ce589454f3bec7026", "node_id": "C_kwDOAAsO6NoAKDUxODhiZGJjY2Q2ZWFmMDcyNGQ3MjM3Y2U1ODk0NTRmM2JlYzcwMjY", "commit": {"author": {"name": "Takayuki Maeda", "email": "takoyaki0316@gmail.com", "date": "2022-07-13T04:24:06Z"}, "committer": {"name": "Takayuki Maeda", "email": "takoyaki0316@gmail.com", "date": "2022-07-13T04:24:06Z"}, "message": "remove an unnecessary `span_to_snippet`", "tree": {"sha": "8ef0e9aa9ea45f7442bf9890b3774ad73a6e0ab5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8ef0e9aa9ea45f7442bf9890b3774ad73a6e0ab5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5188bdbccd6eaf0724d7237ce589454f3bec7026", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5188bdbccd6eaf0724d7237ce589454f3bec7026", "html_url": "https://github.com/rust-lang/rust/commit/5188bdbccd6eaf0724d7237ce589454f3bec7026", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5188bdbccd6eaf0724d7237ce589454f3bec7026/comments", "author": {"login": "TaKO8Ki", "id": 41065217, "node_id": "MDQ6VXNlcjQxMDY1MjE3", "avatar_url": "https://avatars.githubusercontent.com/u/41065217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TaKO8Ki", "html_url": "https://github.com/TaKO8Ki", "followers_url": "https://api.github.com/users/TaKO8Ki/followers", "following_url": "https://api.github.com/users/TaKO8Ki/following{/other_user}", "gists_url": "https://api.github.com/users/TaKO8Ki/gists{/gist_id}", "starred_url": "https://api.github.com/users/TaKO8Ki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TaKO8Ki/subscriptions", "organizations_url": "https://api.github.com/users/TaKO8Ki/orgs", "repos_url": "https://api.github.com/users/TaKO8Ki/repos", "events_url": "https://api.github.com/users/TaKO8Ki/events{/privacy}", "received_events_url": "https://api.github.com/users/TaKO8Ki/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TaKO8Ki", "id": 41065217, "node_id": "MDQ6VXNlcjQxMDY1MjE3", "avatar_url": "https://avatars.githubusercontent.com/u/41065217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TaKO8Ki", "html_url": "https://github.com/TaKO8Ki", "followers_url": "https://api.github.com/users/TaKO8Ki/followers", "following_url": "https://api.github.com/users/TaKO8Ki/following{/other_user}", "gists_url": "https://api.github.com/users/TaKO8Ki/gists{/gist_id}", "starred_url": "https://api.github.com/users/TaKO8Ki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TaKO8Ki/subscriptions", "organizations_url": "https://api.github.com/users/TaKO8Ki/orgs", "repos_url": "https://api.github.com/users/TaKO8Ki/repos", "events_url": "https://api.github.com/users/TaKO8Ki/events{/privacy}", "received_events_url": "https://api.github.com/users/TaKO8Ki/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1c7b36d4db582cb47513a6c7176baaec1c3346ab", "url": "https://api.github.com/repos/rust-lang/rust/commits/1c7b36d4db582cb47513a6c7176baaec1c3346ab", "html_url": "https://github.com/rust-lang/rust/commit/1c7b36d4db582cb47513a6c7176baaec1c3346ab"}], "stats": {"total": 21, "additions": 9, "deletions": 12}, "files": [{"sha": "0ceb63477c80961df33fab6236fecf9361afdbbe", "filename": "compiler/rustc_borrowck/src/diagnostics/conflict_errors.rs", "status": "modified", "additions": 9, "deletions": 12, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/5188bdbccd6eaf0724d7237ce589454f3bec7026/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fconflict_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5188bdbccd6eaf0724d7237ce589454f3bec7026/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fconflict_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Fdiagnostics%2Fconflict_errors.rs?ref=5188bdbccd6eaf0724d7237ce589454f3bec7026", "patch": "@@ -1598,21 +1598,18 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n             let return_ty = tcx.erase_regions(return_ty);\n \n             // to avoid panics\n-            if let Some(iter_trait) = tcx.get_diagnostic_item(sym::Iterator) {\n-                if self\n+            if let Some(iter_trait) = tcx.get_diagnostic_item(sym::Iterator)\n+                && self\n                     .infcx\n                     .type_implements_trait(iter_trait, return_ty, ty_params, self.param_env)\n                     .must_apply_modulo_regions()\n-                {\n-                    if let Ok(snippet) = tcx.sess.source_map().span_to_snippet(return_span) {\n-                        err.span_suggestion_hidden(\n-                            return_span,\n-                            \"use `.collect()` to allocate the iterator\",\n-                            format!(\"{snippet}.collect::<Vec<_>>()\"),\n-                            Applicability::MaybeIncorrect,\n-                        );\n-                    }\n-                }\n+            {\n+                err.span_suggestion_hidden(\n+                    return_span.shrink_to_hi(),\n+                    \"use `.collect()` to allocate the iterator\",\n+                    \".collect::<Vec<_>>()\",\n+                    Applicability::MaybeIncorrect,\n+                );\n             }\n         }\n "}]}