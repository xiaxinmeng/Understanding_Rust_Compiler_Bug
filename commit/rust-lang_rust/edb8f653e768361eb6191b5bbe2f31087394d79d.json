{"sha": "edb8f653e768361eb6191b5bbe2f31087394d79d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVkYjhmNjUzZTc2ODM2MWViNjE5MWI1YmJlMmYzMTA4NzM5NGQ3OWQ=", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2021-06-04T04:43:06Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-06-04T04:43:06Z"}, "message": "Rollup merge of #85977 - ehuss:linkcheck-nightly, r=Mark-Simulacrum\n\nFix linkcheck script from getting out of sync.\n\nWhen there are changes to the linkcheck script, the CI jobs used in the books would download the latest version on master, but run it against nightly. During that 24 hour window, the CI can fail if the script has changes that are incompatible with the last nightly. This fixes it so that it downloads the linkchecker that matches the version of nightly.\n\nThis also includes a fix to build with release to make it run much faster (I forgot to add this in #85652).", "tree": {"sha": "1c5142ab39dda78eb1444f9676ca8d4c92070f11", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1c5142ab39dda78eb1444f9676ca8d4c92070f11"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/edb8f653e768361eb6191b5bbe2f31087394d79d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgua9bCRBK7hj4Ov3rIwAAyrsIAIoBrbrpc3CHarMvyP7iRnl2\nlLMRHKAzVtHvvBOW3n69vmi5VN7Xt0Hse+surIln514OjWwi3HN0gqIzoI1/4vS9\nvvYfV+RcrsCFoYXOFr279MJ3rDWGG209f273WIvuCFP2ZHsIDMN8OCE03FExJTGb\nMDYsGk02fVCKt/ZL58KSeRJBS1T7B3eGDDwrlRkB941kPqZcL/EkknoEGNLdnL7m\n0H5MBSOWAYIr0DT95iOrJ+H7yuU7neMAV5W7sP7J7YpQTsu8qAT0AUujgUbBZthu\nWH2hWrquf+blpNebVR0iIE/+oOfD0gTZ7zKU9GguLoinUlzG1m0Ps85BPG0WoaY=\n=ZbcW\n-----END PGP SIGNATURE-----\n", "payload": "tree 1c5142ab39dda78eb1444f9676ca8d4c92070f11\nparent 0a124319625b4415fc8ca567b9ad07fa190658c8\nparent 095f09a5bf1433ca4003728fd95682dd34b19dca\nauthor Yuki Okushi <jtitor@2k36.org> 1622781786 +0900\ncommitter GitHub <noreply@github.com> 1622781786 +0900\n\nRollup merge of #85977 - ehuss:linkcheck-nightly, r=Mark-Simulacrum\n\nFix linkcheck script from getting out of sync.\n\nWhen there are changes to the linkcheck script, the CI jobs used in the books would download the latest version on master, but run it against nightly. During that 24 hour window, the CI can fail if the script has changes that are incompatible with the last nightly. This fixes it so that it downloads the linkchecker that matches the version of nightly.\n\nThis also includes a fix to build with release to make it run much faster (I forgot to add this in #85652).\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/edb8f653e768361eb6191b5bbe2f31087394d79d", "html_url": "https://github.com/rust-lang/rust/commit/edb8f653e768361eb6191b5bbe2f31087394d79d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/edb8f653e768361eb6191b5bbe2f31087394d79d/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0a124319625b4415fc8ca567b9ad07fa190658c8", "url": "https://api.github.com/repos/rust-lang/rust/commits/0a124319625b4415fc8ca567b9ad07fa190658c8", "html_url": "https://github.com/rust-lang/rust/commit/0a124319625b4415fc8ca567b9ad07fa190658c8"}, {"sha": "095f09a5bf1433ca4003728fd95682dd34b19dca", "url": "https://api.github.com/repos/rust-lang/rust/commits/095f09a5bf1433ca4003728fd95682dd34b19dca", "html_url": "https://github.com/rust-lang/rust/commit/095f09a5bf1433ca4003728fd95682dd34b19dca"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "9eeebf444a49929cc714f69dab679a6f41060607", "filename": "src/tools/linkchecker/linkcheck.sh", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/edb8f653e768361eb6191b5bbe2f31087394d79d/src%2Ftools%2Flinkchecker%2Flinkcheck.sh", "raw_url": "https://github.com/rust-lang/rust/raw/edb8f653e768361eb6191b5bbe2f31087394d79d/src%2Ftools%2Flinkchecker%2Flinkcheck.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Flinkchecker%2Flinkcheck.sh?ref=edb8f653e768361eb6191b5bbe2f31087394d79d", "patch": "@@ -85,11 +85,11 @@ fi\n if [ ! -e \"linkchecker/main.rs\" ] || [ \"$iterative\" = \"0\" ]\n then\n     echo \"Downloading linkchecker source...\"\n+    nightly_hash=$(rustc +nightly -Vv | grep commit-hash | cut -f2 -d\" \")\n+    url=\"https://raw.githubusercontent.com/rust-lang/rust\"\n     mkdir linkchecker\n-    curl -o linkchecker/Cargo.toml \\\n-        https://raw.githubusercontent.com/rust-lang/rust/master/src/tools/linkchecker/Cargo.toml\n-    curl -o linkchecker/main.rs \\\n-        https://raw.githubusercontent.com/rust-lang/rust/master/src/tools/linkchecker/main.rs\n+    curl -o linkchecker/Cargo.toml ${url}/${nightly_hash}/src/tools/linkchecker/Cargo.toml\n+    curl -o linkchecker/main.rs ${url}/${nightly_hash}/src/tools/linkchecker/main.rs\n fi\n \n echo \"Building book \\\"$book_name\\\"...\"\n@@ -106,7 +106,7 @@ else\n     check_path=\"linkcheck/$book_name\"\n fi\n echo \"Running linkchecker on \\\"$check_path\\\"...\"\n-cargo run --manifest-path=linkchecker/Cargo.toml -- \"$check_path\"\n+cargo run --release --manifest-path=linkchecker/Cargo.toml -- \"$check_path\"\n \n if [ \"$iterative\" = \"0\" ]\n then"}]}