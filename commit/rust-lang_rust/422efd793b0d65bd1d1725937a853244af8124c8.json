{"sha": "422efd793b0d65bd1d1725937a853244af8124c8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQyMmVmZDc5M2IwZDY1YmQxZDE3MjU5MzdhODUzMjQ0YWY4MTI0Yzg=", "commit": {"author": {"name": "Oliver Schneider", "email": "git-no-reply-9879165716479413131@oli-obk.de", "date": "2018-03-27T15:19:41Z"}, "committer": {"name": "Oliver Schneider", "email": "git-no-reply-9879165716479413131@oli-obk.de", "date": "2018-03-27T15:19:41Z"}, "message": "Use the actual discriminant instead of always choosing the dataful variant", "tree": {"sha": "0168b7ef9134a608d97e4fb087bef5fb570fc803", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0168b7ef9134a608d97e4fb087bef5fb570fc803"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/422efd793b0d65bd1d1725937a853244af8124c8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJgBAABCgBKFiEEvpMjxK4/cnPNfesJHVy0/Fl8MAQFAlq6YQ0sHGdpdC1uby1y\nZXBseS05ODc5MTY1NzE2NDc5NDEzMTMxQG9saS1vYmsuZGUACgkQHVy0/Fl8MARu\nhBAAu2i5cQ+dpCGFE5KakPqcb6Di7veXIytU+r+pYmeC9OSo6quCzSe8XRpn5sh4\nidFQMGhOD9hfkZcdmw0FdEEIVcCw+ixgKs0by0kduNNeV1BaS5dr1K8VkWi5ObQJ\nM7i0s2hylH9rbu8GjUpl+7TgS/loLYSinT5sQhe995mQOIDW2VPABZtVc2AFGcIi\nwAl1EzmIFxOhETL0onYY8/empHbigz1TlSnmc+r3VhnV46Ky2cuWKj2LeFd0vBRK\nIa4KiB2SwcvT/KUyv3d+eeILkC2NrnF9Cz5MGUjoi8sbFAU/oqJzvUlrEIL5l/NW\nPL/VP/0k1n+d65RSp0nq5lbFAjqRrL/gP250ooZopwdcOkZE6cGyxqsUG2Q4LV4e\n31iqHbIA8kcZHYT7FmCd0jFiNnXJHZ4gb7qp+Jg8n7ubxZ8IQ+agaU8fJb64XXED\nwudYNpdmMZDqObwEB1p6Mp8USRPF2F/mFeDkswlSHLI0v5EwdAJ9gGP8HNQrqt2K\np8TuATDWx+bJgV0A3dRDv104u4aw+NDsDQOSY7Ck9NycZE/KjNU+WOou+zzuyb0f\nIORtn/wswNUzScOVQcDOKZ3o7gyg8qPpfx3IAlVbBW0s9Anb6lye+HtzSoUMiXBq\nsh4YZK4aLXl/EMrmz2jzLMlf9jP7H69FvEPPQhHxL2OLH7o=\n=TlAX\n-----END PGP SIGNATURE-----", "payload": "tree 0168b7ef9134a608d97e4fb087bef5fb570fc803\nparent 6b3202a2bfd33f435d3266f2583c0f5d3356251d\nauthor Oliver Schneider <git-no-reply-9879165716479413131@oli-obk.de> 1522163981 +0200\ncommitter Oliver Schneider <git-no-reply-9879165716479413131@oli-obk.de> 1522163981 +0200\n\nUse the actual discriminant instead of always choosing the dataful variant\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/422efd793b0d65bd1d1725937a853244af8124c8", "html_url": "https://github.com/rust-lang/rust/commit/422efd793b0d65bd1d1725937a853244af8124c8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/422efd793b0d65bd1d1725937a853244af8124c8/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6b3202a2bfd33f435d3266f2583c0f5d3356251d", "url": "https://api.github.com/repos/rust-lang/rust/commits/6b3202a2bfd33f435d3266f2583c0f5d3356251d", "html_url": "https://github.com/rust-lang/rust/commit/6b3202a2bfd33f435d3266f2583c0f5d3356251d"}], "stats": {"total": 13, "additions": 11, "deletions": 2}, "files": [{"sha": "798d635318180937696cddae0546b3e8e2ef7461", "filename": "src/librustc_mir/hair/pattern/mod.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/422efd793b0d65bd1d1725937a853244af8124c8/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/422efd793b0d65bd1d1725937a853244af8124c8/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fhair%2Fpattern%2Fmod.rs?ref=422efd793b0d65bd1d1725937a853244af8124c8", "patch": "@@ -878,8 +878,10 @@ impl<'a, 'tcx> PatternContext<'a, 'tcx> {\n                                             );\n                                     })\n                             }\n-                            ty::layout::Variants::NicheFilling { dataful_variant, .. } =>\n-                                dataful_variant,\n+                            ty::layout::Variants::NicheFilling { .. } => {\n+                                assert_eq!(discr_val as usize as u128, discr_val);\n+                                discr_val as usize\n+                            },\n                         };\n                         let subpatterns = adt_subpatterns(\n                             adt_def.variants[variant_index].fields.len(),"}, {"sha": "ca6ef2e42777bec4d5f0f07b272d24b8a3c09cb5", "filename": "src/test/run-pass/match-arm-statics.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/422efd793b0d65bd1d1725937a853244af8124c8/src%2Ftest%2Frun-pass%2Fmatch-arm-statics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/422efd793b0d65bd1d1725937a853244af8124c8/src%2Ftest%2Frun-pass%2Fmatch-arm-statics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fmatch-arm-statics.rs?ref=422efd793b0d65bd1d1725937a853244af8124c8", "patch": "@@ -94,6 +94,13 @@ fn issue_14576() {\n     const F : C = C::D;\n \n     assert_eq!(match C::D { F => 1, _ => 2, }, 1);\n+\n+    // test gaps\n+    #[derive(PartialEq, Eq)]\n+    enum G { H = 3, I = 5 }\n+    const K : G = G::I;\n+\n+    assert_eq!(match G::I { K => 1, _ => 2, }, 1);\n }\n \n fn issue_13731() {"}]}