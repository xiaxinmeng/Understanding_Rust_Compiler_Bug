{"sha": "196753e4c3a4848ce92a84c596c385dc00f66578", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE5Njc1M2U0YzNhNDg0OGNlOTJhODRjNTk2YzM4NWRjMDBmNjY1Nzg=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-07-14T00:39:33Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-07-14T00:39:33Z"}, "message": "rustc: Remove some interior vectors from ty, except the ones that I think were causing crashes before", "tree": {"sha": "64660043c2584b332b389bd8de0bde2c8fa51065", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/64660043c2584b332b389bd8de0bde2c8fa51065"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/196753e4c3a4848ce92a84c596c385dc00f66578", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/196753e4c3a4848ce92a84c596c385dc00f66578", "html_url": "https://github.com/rust-lang/rust/commit/196753e4c3a4848ce92a84c596c385dc00f66578", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/196753e4c3a4848ce92a84c596c385dc00f66578/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c94fc7aad8c7e7ad26ab30b0328323b7e69c9f78", "url": "https://api.github.com/repos/rust-lang/rust/commits/c94fc7aad8c7e7ad26ab30b0328323b7e69c9f78", "html_url": "https://github.com/rust-lang/rust/commit/c94fc7aad8c7e7ad26ab30b0328323b7e69c9f78"}], "stats": {"total": 43, "additions": 8, "deletions": 35}, "files": [{"sha": "0261e1680738de332dc7bfa491520b70f45e4260", "filename": "src/comp/middle/ty.rs", "status": "modified", "additions": 8, "deletions": 35, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/196753e4c3a4848ce92a84c596c385dc00f66578/src%2Fcomp%2Fmiddle%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/196753e4c3a4848ce92a84c596c385dc00f66578/src%2Fcomp%2Fmiddle%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fty.rs?ref=196753e4c3a4848ce92a84c596c385dc00f66578", "patch": "@@ -3,7 +3,6 @@ import std::int;\n import std::ivec;\n import std::str;\n import std::uint;\n-import std::vec;\n import std::box;\n import std::ufindivec;\n import std::map;\n@@ -1039,24 +1038,16 @@ fn type_has_pointers(&ctxt cx, &t ty) -> bool {\n         case (ty_tag(?did, ?tps)) {\n             auto variants = tag_variants(cx, did);\n             for (variant_info variant in variants) {\n-                // TODO: Remove this vec->ivec conversion.\n-                auto args = ~[];\n-                for (ty::t arg in variant.args) { args += ~[arg]; }\n+                auto tup_ty = mk_imm_tup(cx, variant.args);\n \n-                auto tup_ty = mk_imm_tup(cx, args);\n                 // Perform any type parameter substitutions.\n-\n                 tup_ty = substitute_type_params(cx, tps, tup_ty);\n                 if (type_has_pointers(cx, tup_ty)) { result = true; }\n             }\n         }\n         case (ty_res(?did, ?inner, ?tps)) {\n-            // FIXME: Remove this vec->ivec conversion.\n-            auto tps_ivec = ~[];\n-            for (ty::t tp in tps) { tps_ivec += ~[tp]; }\n-\n-            result = type_has_pointers\n-                (cx, substitute_type_params(cx, tps_ivec, inner));\n+            result = type_has_pointers(cx,\n+                substitute_type_params(cx, tps, inner));\n         }\n         case (_) { result = true; }\n     }\n@@ -1221,11 +1212,7 @@ fn type_owns_heap_mem(&ctxt cx, &t ty) -> bool {\n         case (ty_tag(?did, ?tps)) {\n             auto variants = tag_variants(cx, did);\n             for (variant_info variant in variants) {\n-                // TODO: Remove this vec->ivec conversion.\n-                auto args = ~[];\n-                for (ty::t arg in variant.args) { args += ~[arg]; }\n-\n-                auto tup_ty = mk_imm_tup(cx, args);\n+                auto tup_ty = mk_imm_tup(cx, variant.args);\n \n                 // Perform any type parameter substitutions.\n                 tup_ty = substitute_type_params(cx, tps, tup_ty);\n@@ -1243,12 +1230,8 @@ fn type_owns_heap_mem(&ctxt cx, &t ty) -> bool {\n             }\n         }\n         case (ty_res(_, ?inner, ?tps)) {\n-            // FIXME: Remove this vec->ivec conversion.\n-            auto tps_ivec = ~[];\n-            for (ty::t tp in tps) { tps_ivec += ~[tp]; }\n-\n-            result = type_owns_heap_mem\n-                (cx, substitute_type_params(cx, tps_ivec, inner));\n+            result = type_owns_heap_mem(cx,\n+                substitute_type_params(cx, tps, inner));\n         }\n \n         case (ty_ptr(_)) { result = false; }\n@@ -1279,11 +1262,7 @@ fn type_autoderef(&ctxt cx, &ty::t t) -> ty::t {\n         alt (struct(cx, t1)) {\n             case (ty::ty_box(?mt)) { t1 = mt.ty; }\n             case (ty::ty_res(_, ?inner, ?tps)) {\n-                // FIXME: Remove this vec->ivec conversion.\n-                auto tps_ivec = ~[];\n-                for (ty::t tp in tps) { tps_ivec += ~[tp]; }\n-\n-                t1 = substitute_type_params(cx, tps_ivec, inner);\n+                t1 = substitute_type_params(cx, tps, inner);\n             }\n             case (ty::ty_tag(?did, ?tps)) {\n                 auto variants = tag_variants(cx, did);\n@@ -1763,13 +1742,7 @@ fn ty_param_substs_opt_and_ty_to_monotype(&ctxt cx,\n    t {\n     alt (tpot._0) {\n         case (none) { ret tpot._1; }\n-        case (some(?tps)) {\n-            // FIXME: Remove this vec->ivec conversion.\n-            auto tps_ivec = ~[];\n-            for (ty::t tp in tps) { tps_ivec += ~[tp]; }\n-\n-            ret substitute_type_params(cx, tps_ivec, tpot._1);\n-        }\n+        case (some(?tps)) { ret substitute_type_params(cx, tps, tpot._1); }\n     }\n }\n "}]}