{"sha": "15f9f1a1f1fb37f77fee99e53e754ad5b06bc854", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE1ZjlmMWExZjFmYjM3Zjc3ZmVlOTllNTNlNzU0YWQ1YjA2YmM4NTQ=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-08-17T19:59:48Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-08-17T22:12:38Z"}, "message": "Remove more hacks from the test runner", "tree": {"sha": "a269d423382b806f9e61548a039c6124bd69bc28", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a269d423382b806f9e61548a039c6124bd69bc28"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/15f9f1a1f1fb37f77fee99e53e754ad5b06bc854", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/15f9f1a1f1fb37f77fee99e53e754ad5b06bc854", "html_url": "https://github.com/rust-lang/rust/commit/15f9f1a1f1fb37f77fee99e53e754ad5b06bc854", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/15f9f1a1f1fb37f77fee99e53e754ad5b06bc854/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "87a782c0b3034d0833f677ffc1161ddfb4c6765d", "url": "https://api.github.com/repos/rust-lang/rust/commits/87a782c0b3034d0833f677ffc1161ddfb4c6765d", "html_url": "https://github.com/rust-lang/rust/commit/87a782c0b3034d0833f677ffc1161ddfb4c6765d"}], "stats": {"total": 11, "additions": 2, "deletions": 9}, "files": [{"sha": "b1594c6c4cba9f387f7001e91b44b9daca897b8a", "filename": "src/lib/test.rs", "status": "modified", "additions": 2, "deletions": 9, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/15f9f1a1f1fb37f77fee99e53e754ad5b06bc854/src%2Flib%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/15f9f1a1f1fb37f77fee99e53e754ad5b06bc854/src%2Flib%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib%2Ftest.rs?ref=15f9f1a1f1fb37f77fee99e53e754ad5b06bc854", "patch": "@@ -305,18 +305,12 @@ fn filter_tests(opts: &test_opts, tests: &[test_desc]) -> [test_desc] {\n }\n \n type test_future =\n-    {test: test_desc, fnref: @fn() , wait: fn() -> test_result };\n+    {test: test_desc, wait: fn() -> test_result };\n \n fn run_test(test: &test_desc, to_task: &test_to_task) -> test_future {\n-    // FIXME: Because of the unsafe way we're passing the test function\n-    // to the test task, we need to make sure we keep a reference to that\n-    // function around for longer than the lifetime of the task. To that end\n-    // we keep the function boxed in the test future.\n-    let fnref = @test.fn;\n     if !test.ignore {\n-        let test_task = to_task(*fnref);\n+        let test_task = to_task(test.fn);\n         ret {test: test,\n-             fnref: fnref,\n              wait:\n              bind fn (test_task: task_id) -> test_result {\n                  alt task::join_id(test_task) {\n@@ -326,7 +320,6 @@ fn run_test(test: &test_desc, to_task: &test_to_task) -> test_future {\n              }(test_task)};\n     } else {\n         ret {test: test,\n-             fnref: fnref,\n              wait: fn () -> test_result { tr_ignored }};\n     }\n }"}]}