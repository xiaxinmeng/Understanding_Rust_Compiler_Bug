{"sha": "4fddf40f5bd51066e3201f319f7a5c1466483b4d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRmZGRmNDBmNWJkNTEwNjZlMzIwMWYzMTlmN2E1YzE0NjY0ODNiNGQ=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-01-10T09:34:24Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-01-10T09:34:24Z"}, "message": "Merge #7224\n\n7224: Remove unnecessary allocation when checking whether to hide argument name hint r=jhpratt a=jhpratt\n\nThe case-insensitive prefix/suffix check can be performed\r\ncharacter-by-character. This allows the check to be done without having\r\nto allocate a new string. As a side effect, it's also no longer\r\nnecessary to convert the entire string to lowercase, as it's done as\r\nneeded. As the only case equality we're handling is ASCII, this\r\noperation can be further optimized by using byte equality, rather than\r\ncharacter equality.\r\n\r\ncc @SomeoneToIgnore, as it's an update on my PR from yesterday.\n\nCo-authored-by: Jacob Pratt <jacob@jhpratt.dev>", "tree": {"sha": "7aeb7cfd43b5a25f7e06a4e8c1df7cd6eb177f60", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7aeb7cfd43b5a25f7e06a4e8c1df7cd6eb177f60"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4fddf40f5bd51066e3201f319f7a5c1466483b4d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJf+sogCRBK7hj4Ov3rIwAAdHIIAAOiTsbehm6VbG5lVfr5RxLp\nB+m08H6BIFXUXh3TyUtksMbbdsvepDkAfCx8iyJRhcY9ujjroem5FK22ll3wXXKk\nyNVOvgO33CYBsjlJq2D6Eq4ci3zs6W92jxkgiqLjSGu1ed/7tFi8ISurExAVr1WP\nBPTUb4C5KAF02CQOp58MRTno7O/DalzUt3huKRsi2W5V37NzIsDJniRkDxWzcFIJ\nNE7ElNQuZ4WgSyIjHZMi9Q64Wr/NWBpebLxaOZ3V8OIIWNbA6tWiHyU1mSKXxeGJ\n/Sv9piG+5XZxltXAB7c7SWUjWxeH5v6iyggWLWAIdv6mySoUVDAAq2fEDMoGObU=\n=MoER\n-----END PGP SIGNATURE-----\n", "payload": "tree 7aeb7cfd43b5a25f7e06a4e8c1df7cd6eb177f60\nparent d0c2456994848479331c3434631996668039fc3a\nparent 5e81892d4dd3b8353d11df8b9239432b5aa10512\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1610271264 +0000\ncommitter GitHub <noreply@github.com> 1610271264 +0000\n\nMerge #7224\n\n7224: Remove unnecessary allocation when checking whether to hide argument name hint r=jhpratt a=jhpratt\n\nThe case-insensitive prefix/suffix check can be performed\r\ncharacter-by-character. This allows the check to be done without having\r\nto allocate a new string. As a side effect, it's also no longer\r\nnecessary to convert the entire string to lowercase, as it's done as\r\nneeded. As the only case equality we're handling is ASCII, this\r\noperation can be further optimized by using byte equality, rather than\r\ncharacter equality.\r\n\r\ncc @SomeoneToIgnore, as it's an update on my PR from yesterday.\n\nCo-authored-by: Jacob Pratt <jacob@jhpratt.dev>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4fddf40f5bd51066e3201f319f7a5c1466483b4d", "html_url": "https://github.com/rust-lang/rust/commit/4fddf40f5bd51066e3201f319f7a5c1466483b4d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4fddf40f5bd51066e3201f319f7a5c1466483b4d/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d0c2456994848479331c3434631996668039fc3a", "url": "https://api.github.com/repos/rust-lang/rust/commits/d0c2456994848479331c3434631996668039fc3a", "html_url": "https://github.com/rust-lang/rust/commit/d0c2456994848479331c3434631996668039fc3a"}, {"sha": "5e81892d4dd3b8353d11df8b9239432b5aa10512", "url": "https://api.github.com/repos/rust-lang/rust/commits/5e81892d4dd3b8353d11df8b9239432b5aa10512", "html_url": "https://github.com/rust-lang/rust/commit/5e81892d4dd3b8353d11df8b9239432b5aa10512"}], "stats": {"total": 26, "additions": 19, "deletions": 7}, "files": [{"sha": "3e9a65d9c72b9df2bea5ab33550b0fa2b668dbac", "filename": "crates/ide/src/inlay_hints.rs", "status": "modified", "additions": 19, "deletions": 7, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/4fddf40f5bd51066e3201f319f7a5c1466483b4d/crates%2Fide%2Fsrc%2Finlay_hints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4fddf40f5bd51066e3201f319f7a5c1466483b4d/crates%2Fide%2Fsrc%2Finlay_hints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Finlay_hints.rs?ref=4fddf40f5bd51066e3201f319f7a5c1466483b4d", "patch": "@@ -353,13 +353,25 @@ fn is_argument_similar_to_param_name(\n     }\n     match get_string_representation(argument) {\n         None => false,\n-        Some(mut repr) => {\n-            let param_name = param_name.to_ascii_lowercase();\n-            let argument_string = {\n-                repr.make_ascii_lowercase();\n-                repr.trim_start_matches('_')\n-            };\n-            argument_string.starts_with(&param_name) || argument_string.ends_with(&param_name)\n+        Some(argument_string) => {\n+            let num_leading_underscores =\n+                argument_string.bytes().take_while(|&c| c == b'_').count();\n+\n+            // Does the argument name begin with the parameter name? Ignore leading underscores.\n+            let mut arg_bytes = argument_string.bytes().skip(num_leading_underscores);\n+            let starts_with_pattern = param_name.bytes().all(\n+                |expected| matches!(arg_bytes.next(), Some(actual) if expected.eq_ignore_ascii_case(&actual)),\n+            );\n+\n+            if starts_with_pattern {\n+                return true;\n+            }\n+\n+            // Does the argument name end with the parameter name?\n+            let mut arg_bytes = argument_string.bytes().skip(num_leading_underscores);\n+            param_name.bytes().rev().all(\n+                |expected| matches!(arg_bytes.next_back(), Some(actual) if expected.eq_ignore_ascii_case(&actual)),\n+            )\n         }\n     }\n }"}]}