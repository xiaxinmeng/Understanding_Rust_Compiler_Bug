{"sha": "f1d7f98ed07b9934286b9c4809dd4d7a47537879", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYxZDdmOThlZDA3Yjk5MzQyODZiOWM0ODA5ZGQ0ZDdhNDc1Mzc4Nzk=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-09-19T22:33:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-09-19T22:33:42Z"}, "message": "Merge #10293\n\n10293: fix: Don't bail on parse errors in macro input for builtin expansion r=Veykril a=Veykril\n\nFixes https://github.com/rust-analyzer/rust-analyzer/issues/8158\n\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>", "tree": {"sha": "98a8874ecbad4aaa19d52755874cecae9d97dc43", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/98a8874ecbad4aaa19d52755874cecae9d97dc43"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f1d7f98ed07b9934286b9c4809dd4d7a47537879", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhR7rGCRBK7hj4Ov3rIwAAyIMIAIgWUyZFkWw3XQTN1OWPgzWJ\nuRFOo4or27LwpOEjqufJl4bf56inSH1/bFAVpoqhxiXOlmCigJX8Vl0SyisaaQwq\n3T+spWgoTpW3l7gff6pa2ymfbRjNcOGc4dVog4vY9lQea9NLc3Mk//bVljkD3/AZ\nMJSz/lZNE/fLramvZhvI3Vg4D0XCRDLgx3OIwPhT/PpTON2jy0xVt2i71h3MtmQW\nmNJCXMUBHR3YX6JMq00HESuPdNcWUOsju3uz9xRT6hybsQWesZ5YQ7jnC7ZAaTq+\nk7zaeQxokd8sV1DzhAucsnV5HG0EEx+QrS9ihPTd/C/O9xjW1Qc57pALzG4ICmQ=\n=wwDp\n-----END PGP SIGNATURE-----\n", "payload": "tree 98a8874ecbad4aaa19d52755874cecae9d97dc43\nparent b7bedf16a113f5b1b7aefedd68defce429c33a9b\nparent e7e87fc69d6a7d41981e1b730ccf8687179dc9ea\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1632090822 +0000\ncommitter GitHub <noreply@github.com> 1632090822 +0000\n\nMerge #10293\n\n10293: fix: Don't bail on parse errors in macro input for builtin expansion r=Veykril a=Veykril\n\nFixes https://github.com/rust-analyzer/rust-analyzer/issues/8158\n\nCo-authored-by: Lukas Wirth <lukastw97@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f1d7f98ed07b9934286b9c4809dd4d7a47537879", "html_url": "https://github.com/rust-lang/rust/commit/f1d7f98ed07b9934286b9c4809dd4d7a47537879", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f1d7f98ed07b9934286b9c4809dd4d7a47537879/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b7bedf16a113f5b1b7aefedd68defce429c33a9b", "url": "https://api.github.com/repos/rust-lang/rust/commits/b7bedf16a113f5b1b7aefedd68defce429c33a9b", "html_url": "https://github.com/rust-lang/rust/commit/b7bedf16a113f5b1b7aefedd68defce429c33a9b"}, {"sha": "e7e87fc69d6a7d41981e1b730ccf8687179dc9ea", "url": "https://api.github.com/repos/rust-lang/rust/commits/e7e87fc69d6a7d41981e1b730ccf8687179dc9ea", "html_url": "https://github.com/rust-lang/rust/commit/e7e87fc69d6a7d41981e1b730ccf8687179dc9ea"}], "stats": {"total": 22, "additions": 18, "deletions": 4}, "files": [{"sha": "74f9b23d731ec2f6b7c60bbad303792935296c20", "filename": "crates/hir_expand/src/builtin_macro.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/f1d7f98ed07b9934286b9c4809dd4d7a47537879/crates%2Fhir_expand%2Fsrc%2Fbuiltin_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f1d7f98ed07b9934286b9c4809dd4d7a47537879/crates%2Fhir_expand%2Fsrc%2Fbuiltin_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_expand%2Fsrc%2Fbuiltin_macro.rs?ref=f1d7f98ed07b9934286b9c4809dd4d7a47537879", "patch": "@@ -792,6 +792,23 @@ mod tests {\n         );\n     }\n \n+    #[test]\n+    fn test_format_args_expand_with_broken_member_access() {\n+        check_expansion(\n+            r#\"\n+            #[rustc_builtin_macro]\n+            macro_rules! format_args {\n+                ($fmt:expr) => ({ /* compiler built-in */ });\n+                ($fmt:expr, $($args:tt)*) => ({ /* compiler built-in */ })\n+            }\n+            format_args!(\"{} {:?}\", a.);\n+            \"#,\n+            expect![[\n+                r#\"unsafe{std::fmt::Arguments::new_v1(&[], &[std::fmt::ArgumentV1::new(&(a.),std::fmt::Display::fmt),])}\"#\n+            ]],\n+        );\n+    }\n+\n     #[test]\n     fn test_include_bytes_expand() {\n         check_expansion("}, {"sha": "06597f458bd8858b348b24a7d3818315fdaedd29", "filename": "crates/mbe/src/syntax_bridge.rs", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f1d7f98ed07b9934286b9c4809dd4d7a47537879/crates%2Fmbe%2Fsrc%2Fsyntax_bridge.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f1d7f98ed07b9934286b9c4809dd4d7a47537879/crates%2Fmbe%2Fsrc%2Fsyntax_bridge.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fmbe%2Fsrc%2Fsyntax_bridge.rs?ref=f1d7f98ed07b9934286b9c4809dd4d7a47537879", "patch": "@@ -89,7 +89,7 @@ pub fn parse_to_token_tree(text: &str) -> Option<(tt::Subtree, TokenMap)> {\n     Some((subtree, conv.id_alloc.map))\n }\n \n-/// Split token tree with seperate expr: $($e:expr)SEP*\n+/// Split token tree with separate expr: $($e:expr)SEP*\n pub fn parse_exprs_with_sep(tt: &tt::Subtree, sep: char) -> Vec<tt::Subtree> {\n     if tt.token_trees.is_empty() {\n         return Vec::new();\n@@ -100,9 +100,6 @@ pub fn parse_exprs_with_sep(tt: &tt::Subtree, sep: char) -> Vec<tt::Subtree> {\n \n     while iter.peek_n(0).is_some() {\n         let expanded = iter.expect_fragment(ParserEntryPoint::Expr);\n-        if expanded.err.is_some() {\n-            break;\n-        }\n \n         res.push(match expanded.value {\n             None => break,"}]}