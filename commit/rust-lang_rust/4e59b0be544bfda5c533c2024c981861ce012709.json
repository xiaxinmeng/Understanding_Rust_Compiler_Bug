{"sha": "4e59b0be544bfda5c533c2024c981861ce012709", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRlNTliMGJlNTQ0YmZkYTVjNTMzYzIwMjRjOTgxODYxY2UwMTI3MDk=", "commit": {"author": {"name": "Rob Arnold", "email": "robarnold@cs.cmu.edu", "date": "2011-07-01T02:27:35Z"}, "committer": {"name": "Eric Holk", "email": "eholk@mozilla.com", "date": "2011-07-01T23:59:11Z"}, "message": "Sync rust_chan's deref() method with rustc's code.\n\nIf the channel is associated with a port then the destructor will assert.\nAdditionally, destruction of the object is not always appropriate. This brings\nthe deref() method into sync with the behavior of generated rust code which\nonly invokes destroy() once the reference count goes to 0.", "tree": {"sha": "2f9941d1e49bb5a26808f26b61d172f29cf3a03b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2f9941d1e49bb5a26808f26b61d172f29cf3a03b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4e59b0be544bfda5c533c2024c981861ce012709", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4e59b0be544bfda5c533c2024c981861ce012709", "html_url": "https://github.com/rust-lang/rust/commit/4e59b0be544bfda5c533c2024c981861ce012709", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4e59b0be544bfda5c533c2024c981861ce012709/comments", "author": {"login": "robarnold", "id": 326113, "node_id": "MDQ6VXNlcjMyNjExMw==", "avatar_url": "https://avatars.githubusercontent.com/u/326113?v=4", "gravatar_id": "", "url": "https://api.github.com/users/robarnold", "html_url": "https://github.com/robarnold", "followers_url": "https://api.github.com/users/robarnold/followers", "following_url": "https://api.github.com/users/robarnold/following{/other_user}", "gists_url": "https://api.github.com/users/robarnold/gists{/gist_id}", "starred_url": "https://api.github.com/users/robarnold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/robarnold/subscriptions", "organizations_url": "https://api.github.com/users/robarnold/orgs", "repos_url": "https://api.github.com/users/robarnold/repos", "events_url": "https://api.github.com/users/robarnold/events{/privacy}", "received_events_url": "https://api.github.com/users/robarnold/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "02a5949abaa4e888ecb470023ea2f29cd6bde43b", "url": "https://api.github.com/repos/rust-lang/rust/commits/02a5949abaa4e888ecb470023ea2f29cd6bde43b", "html_url": "https://github.com/rust-lang/rust/commit/02a5949abaa4e888ecb470023ea2f29cd6bde43b"}], "stats": {"total": 5, "additions": 3, "deletions": 2}, "files": [{"sha": "78301e3d879ddc64e07f5e16cf7433c4862d494a", "filename": "src/rt/rust_chan.cpp", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4e59b0be544bfda5c533c2024c981861ce012709/src%2Frt%2Frust_chan.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/4e59b0be544bfda5c533c2024c981861ce012709/src%2Frt%2Frust_chan.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_chan.cpp?ref=4e59b0be544bfda5c533c2024c981861ce012709", "patch": "@@ -7,6 +7,7 @@\n rust_chan::rust_chan(rust_task *task,\n                      maybe_proxy<rust_port> *port,\n                      size_t unit_sz) :\n+                     ref_count(1),\n                      task(task),\n                      port(port),\n                      buffer(task, unit_sz) {"}, {"sha": "4172ca5f09d868c8d01fc92683f3f654b4d3a0b9", "filename": "src/rt/rust_chan.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/4e59b0be544bfda5c533c2024c981861ce012709/src%2Frt%2Frust_chan.h", "raw_url": "https://github.com/rust-lang/rust/raw/4e59b0be544bfda5c533c2024c981861ce012709/src%2Frt%2Frust_chan.h", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_chan.h?ref=4e59b0be544bfda5c533c2024c981861ce012709", "patch": "@@ -1,10 +1,10 @@\n #ifndef RUST_CHAN_H\n #define RUST_CHAN_H\n \n-class rust_chan : public rc_base<rust_chan>,\n-                  public task_owned<rust_chan>,\n+class rust_chan : public task_owned<rust_chan>,\n                   public rust_cond {\n public:\n+    RUST_REFCOUNTED_WITH_DTOR(rust_chan, destroy())\n     rust_chan(rust_task *task, maybe_proxy<rust_port> *port, size_t unit_sz);\n \n     ~rust_chan();"}]}