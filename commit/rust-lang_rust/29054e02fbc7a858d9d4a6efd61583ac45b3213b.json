{"sha": "29054e02fbc7a858d9d4a6efd61583ac45b3213b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI5MDU0ZTAyZmJjN2E4NThkOWQ0YTZlZmQ2MTU4M2FjNDViMzIxM2I=", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-06-15T19:44:07Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-06-15T19:49:59Z"}, "message": "Highlight unsafe trait refs as unsafe only in impl blocks and definitions", "tree": {"sha": "87d55a0ef8df2c6263722ea3899c4e45c11173db", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/87d55a0ef8df2c6263722ea3899c4e45c11173db"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/29054e02fbc7a858d9d4a6efd61583ac45b3213b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/29054e02fbc7a858d9d4a6efd61583ac45b3213b", "html_url": "https://github.com/rust-lang/rust/commit/29054e02fbc7a858d9d4a6efd61583ac45b3213b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/29054e02fbc7a858d9d4a6efd61583ac45b3213b/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7f482afada7519e828b8dbe8fafe063885256516", "url": "https://api.github.com/repos/rust-lang/rust/commits/7f482afada7519e828b8dbe8fafe063885256516", "html_url": "https://github.com/rust-lang/rust/commit/7f482afada7519e828b8dbe8fafe063885256516"}], "stats": {"total": 79, "additions": 60, "deletions": 19}, "files": [{"sha": "6834fe11ae8fe8b4cbaf75d965281aa730aaf9d8", "filename": "crates/ide/src/syntax_highlighting/highlight.rs", "status": "modified", "additions": 31, "deletions": 19, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Fhighlight.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Fhighlight.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Fhighlight.rs?ref=29054e02fbc7a858d9d4a6efd61583ac45b3213b", "patch": "@@ -48,7 +48,13 @@ pub(super) fn element(\n             match name_kind {\n                 Some(NameClass::ExternCrate(_)) => SymbolKind::Module.into(),\n                 Some(NameClass::Definition(def)) => {\n-                    highlight_def(db, krate, def) | HlMod::Definition\n+                    let mut h = highlight_def(db, krate, def) | HlMod::Definition;\n+                    if let Definition::ModuleDef(hir::ModuleDef::Trait(trait_)) = &def {\n+                        if trait_.is_unsafe(db) {\n+                            h |= HlMod::Unsafe;\n+                        }\n+                    }\n+                    h\n                 }\n                 Some(NameClass::ConstReference(def)) => highlight_def(db, krate, def),\n                 Some(NameClass::PatFieldShorthand { field_ref, .. }) => {\n@@ -87,20 +93,34 @@ pub(super) fn element(\n \n                             let mut h = highlight_def(db, krate, def);\n \n-                            if let Definition::Local(local) = &def {\n-                                if is_consumed_lvalue(name_ref.syntax().clone().into(), local, db) {\n+                            match def {\n+                                Definition::Local(local)\n+                                    if is_consumed_lvalue(\n+                                        name_ref.syntax().clone().into(),\n+                                        &local,\n+                                        db,\n+                                    ) =>\n+                                {\n                                     h |= HlMod::Consuming;\n                                 }\n-                            }\n-\n-                            if let Some(parent) = name_ref.syntax().parent() {\n-                                if matches!(parent.kind(), FIELD_EXPR | RECORD_PAT_FIELD) {\n-                                    if let Definition::Field(field) = def {\n-                                        if let hir::VariantDef::Union(_) = field.parent_def(db) {\n-                                            h |= HlMod::Unsafe;\n+                                Definition::ModuleDef(hir::ModuleDef::Trait(trait_))\n+                                    if trait_.is_unsafe(db) =>\n+                                {\n+                                    if ast::Impl::for_trait_name_ref(&name_ref).is_some() {\n+                                        h |= HlMod::Unsafe;\n+                                    }\n+                                }\n+                                Definition::Field(field) => {\n+                                    if let Some(parent) = name_ref.syntax().parent() {\n+                                        if matches!(parent.kind(), FIELD_EXPR | RECORD_PAT_FIELD) {\n+                                            if let hir::VariantDef::Union(_) = field.parent_def(db)\n+                                            {\n+                                                h |= HlMod::Unsafe;\n+                                            }\n                                         }\n                                     }\n                                 }\n+                                _ => (),\n                             }\n \n                             h\n@@ -354,15 +374,7 @@ fn highlight_def(db: &RootDatabase, krate: Option<hir::Crate>, def: Definition)\n \n                 h\n             }\n-            hir::ModuleDef::Trait(trait_) => {\n-                let mut h = Highlight::new(HlTag::Symbol(SymbolKind::Trait));\n-\n-                if trait_.is_unsafe(db) {\n-                    h |= HlMod::Unsafe;\n-                }\n-\n-                h\n-            }\n+            hir::ModuleDef::Trait(_) => Highlight::new(HlTag::Symbol(SymbolKind::Trait)),\n             hir::ModuleDef::TypeAlias(type_) => {\n                 let mut h = Highlight::new(HlTag::Symbol(SymbolKind::TypeAlias));\n "}, {"sha": "21376a7ae2a8939fadf3221ee58d6a283f099623", "filename": "crates/ide/src/syntax_highlighting/html.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Fhtml.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Fhtml.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Fhtml.rs?ref=29054e02fbc7a858d9d4a6efd61583ac45b3213b", "patch": "@@ -67,6 +67,7 @@ pre                 { color: #DCDCCC; background: #3F3F3F; font-size: 22px; padd\n .field              { color: #94BFF3; }\n .function           { color: #93E0E3; }\n .function.unsafe    { color: #BC8383; }\n+.trait.unsafe       { color: #BC8383; }\n .operator.unsafe    { color: #BC8383; }\n .parameter          { color: #94BFF3; }\n .text               { color: #DCDCCC; }"}, {"sha": "4e85f7c0b5b9e97a0a82131bcbcc3356de6171cc", "filename": "crates/ide/src/syntax_highlighting/test_data/highlight_assoc_functions.html", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_assoc_functions.html", "raw_url": "https://github.com/rust-lang/rust/raw/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_assoc_functions.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_assoc_functions.html?ref=29054e02fbc7a858d9d4a6efd61583ac45b3213b", "patch": "@@ -15,6 +15,7 @@\n .field              { color: #94BFF3; }\n .function           { color: #93E0E3; }\n .function.unsafe    { color: #BC8383; }\n+.trait.unsafe       { color: #BC8383; }\n .operator.unsafe    { color: #BC8383; }\n .parameter          { color: #94BFF3; }\n .text               { color: #DCDCCC; }"}, {"sha": "79a285107cbade232c92bf771260d3e423a54050", "filename": "crates/ide/src/syntax_highlighting/test_data/highlight_doctest.html", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_doctest.html", "raw_url": "https://github.com/rust-lang/rust/raw/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_doctest.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_doctest.html?ref=29054e02fbc7a858d9d4a6efd61583ac45b3213b", "patch": "@@ -15,6 +15,7 @@\n .field              { color: #94BFF3; }\n .function           { color: #93E0E3; }\n .function.unsafe    { color: #BC8383; }\n+.trait.unsafe       { color: #BC8383; }\n .operator.unsafe    { color: #BC8383; }\n .parameter          { color: #94BFF3; }\n .text               { color: #DCDCCC; }"}, {"sha": "13f589cc0e2bac544032f55c96868eee29fe0f85", "filename": "crates/ide/src/syntax_highlighting/test_data/highlight_extern_crate.html", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_extern_crate.html", "raw_url": "https://github.com/rust-lang/rust/raw/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_extern_crate.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_extern_crate.html?ref=29054e02fbc7a858d9d4a6efd61583ac45b3213b", "patch": "@@ -15,6 +15,7 @@\n .field              { color: #94BFF3; }\n .function           { color: #93E0E3; }\n .function.unsafe    { color: #BC8383; }\n+.trait.unsafe       { color: #BC8383; }\n .operator.unsafe    { color: #BC8383; }\n .parameter          { color: #94BFF3; }\n .text               { color: #DCDCCC; }"}, {"sha": "50df376ae4558b3f1e4c294cd3582fa2376f5dfc", "filename": "crates/ide/src/syntax_highlighting/test_data/highlight_injection.html", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_injection.html", "raw_url": "https://github.com/rust-lang/rust/raw/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_injection.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_injection.html?ref=29054e02fbc7a858d9d4a6efd61583ac45b3213b", "patch": "@@ -15,6 +15,7 @@\n .field              { color: #94BFF3; }\n .function           { color: #93E0E3; }\n .function.unsafe    { color: #BC8383; }\n+.trait.unsafe       { color: #BC8383; }\n .operator.unsafe    { color: #BC8383; }\n .parameter          { color: #94BFF3; }\n .text               { color: #DCDCCC; }"}, {"sha": "96cb09642b8c4eaf28a1e8e447bfc7eb01955672", "filename": "crates/ide/src/syntax_highlighting/test_data/highlight_strings.html", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_strings.html", "raw_url": "https://github.com/rust-lang/rust/raw/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_strings.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_strings.html?ref=29054e02fbc7a858d9d4a6efd61583ac45b3213b", "patch": "@@ -15,6 +15,7 @@\n .field              { color: #94BFF3; }\n .function           { color: #93E0E3; }\n .function.unsafe    { color: #BC8383; }\n+.trait.unsafe       { color: #BC8383; }\n .operator.unsafe    { color: #BC8383; }\n .parameter          { color: #94BFF3; }\n .text               { color: #DCDCCC; }"}, {"sha": "55453468b76e2a65a7fd5fe8fc1496ff4d90c62b", "filename": "crates/ide/src/syntax_highlighting/test_data/highlight_unsafe.html", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_unsafe.html", "raw_url": "https://github.com/rust-lang/rust/raw/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_unsafe.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlight_unsafe.html?ref=29054e02fbc7a858d9d4a6efd61583ac45b3213b", "patch": "@@ -15,6 +15,7 @@\n .field              { color: #94BFF3; }\n .function           { color: #93E0E3; }\n .function.unsafe    { color: #BC8383; }\n+.trait.unsafe       { color: #BC8383; }\n .operator.unsafe    { color: #BC8383; }\n .parameter          { color: #94BFF3; }\n .text               { color: #DCDCCC; }\n@@ -61,6 +62,11 @@\n     <span class=\"field declaration\">a</span><span class=\"colon\">:</span> <span class=\"builtin_type\">u16</span><span class=\"comma\">,</span>\n <span class=\"brace\">}</span>\n \n+<span class=\"keyword unsafe\">unsafe</span> <span class=\"keyword\">trait</span> <span class=\"trait declaration unsafe\">UnsafeTrait</span> <span class=\"brace\">{</span><span class=\"brace\">}</span>\n+<span class=\"keyword unsafe\">unsafe</span> <span class=\"keyword\">impl</span> <span class=\"trait unsafe\">UnsafeTrait</span> <span class=\"keyword\">for</span> <span class=\"struct\">Packed</span> <span class=\"brace\">{</span><span class=\"brace\">}</span>\n+\n+<span class=\"keyword\">fn</span> <span class=\"function declaration\">require_unsafe_trait</span><span class=\"angle\">&lt;</span><span class=\"type_param declaration\">T</span><span class=\"colon\">:</span> <span class=\"trait\">UnsafeTrait</span><span class=\"angle\">&gt;</span><span class=\"parenthesis\">(</span><span class=\"punctuation\">_</span><span class=\"colon\">:</span> <span class=\"type_param\">T</span><span class=\"parenthesis\">)</span> <span class=\"brace\">{</span><span class=\"brace\">}</span>\n+\n <span class=\"keyword\">trait</span> <span class=\"trait declaration\">DoTheAutoref</span> <span class=\"brace\">{</span>\n     <span class=\"keyword\">fn</span> <span class=\"function associated declaration trait\">calls_autoref</span><span class=\"parenthesis\">(</span><span class=\"operator\">&</span><span class=\"self_keyword declaration\">self</span><span class=\"parenthesis\">)</span><span class=\"semicolon\">;</span>\n <span class=\"brace\">}</span>"}, {"sha": "9232cf905700696e2d0d5531a9f2f3f4f31c60f2", "filename": "crates/ide/src/syntax_highlighting/test_data/highlighting.html", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlighting.html", "raw_url": "https://github.com/rust-lang/rust/raw/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlighting.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Fhighlighting.html?ref=29054e02fbc7a858d9d4a6efd61583ac45b3213b", "patch": "@@ -15,6 +15,7 @@\n .field              { color: #94BFF3; }\n .function           { color: #93E0E3; }\n .function.unsafe    { color: #BC8383; }\n+.trait.unsafe       { color: #BC8383; }\n .operator.unsafe    { color: #BC8383; }\n .parameter          { color: #94BFF3; }\n .text               { color: #DCDCCC; }"}, {"sha": "082837328ffd908441bb849af8fc2b5f0db71f75", "filename": "crates/ide/src/syntax_highlighting/test_data/injection.html", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Finjection.html", "raw_url": "https://github.com/rust-lang/rust/raw/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Finjection.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Finjection.html?ref=29054e02fbc7a858d9d4a6efd61583ac45b3213b", "patch": "@@ -15,6 +15,7 @@\n .field              { color: #94BFF3; }\n .function           { color: #93E0E3; }\n .function.unsafe    { color: #BC8383; }\n+.trait.unsafe       { color: #BC8383; }\n .operator.unsafe    { color: #BC8383; }\n .parameter          { color: #94BFF3; }\n .text               { color: #DCDCCC; }"}, {"sha": "763917714c7b6f46e06d68e161de92c7e7a592d6", "filename": "crates/ide/src/syntax_highlighting/test_data/rainbow_highlighting.html", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Frainbow_highlighting.html", "raw_url": "https://github.com/rust-lang/rust/raw/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Frainbow_highlighting.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftest_data%2Frainbow_highlighting.html?ref=29054e02fbc7a858d9d4a6efd61583ac45b3213b", "patch": "@@ -15,6 +15,7 @@\n .field              { color: #94BFF3; }\n .function           { color: #93E0E3; }\n .function.unsafe    { color: #BC8383; }\n+.trait.unsafe       { color: #BC8383; }\n .operator.unsafe    { color: #BC8383; }\n .parameter          { color: #94BFF3; }\n .text               { color: #DCDCCC; }"}, {"sha": "4f0b1ce854d599723d38f6831b55ba56687080f4", "filename": "crates/ide/src/syntax_highlighting/tests.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fsyntax_highlighting%2Ftests.rs?ref=29054e02fbc7a858d9d4a6efd61583ac45b3213b", "patch": "@@ -527,6 +527,11 @@ struct Packed {\n     a: u16,\n }\n \n+unsafe trait UnsafeTrait {}\n+unsafe impl UnsafeTrait for Packed {}\n+\n+fn require_unsafe_trait<T: UnsafeTrait>(_: T) {}\n+\n trait DoTheAutoref {\n     fn calls_autoref(&self);\n }"}, {"sha": "2bd9ad867e1a0767bac5a77a1f8f5b2b08cc0dd7", "filename": "crates/syntax/src/ast/node_ext.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fsyntax%2Fsrc%2Fast%2Fnode_ext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/29054e02fbc7a858d9d4a6efd61583ac45b3213b/crates%2Fsyntax%2Fsrc%2Fast%2Fnode_ext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Fsrc%2Fast%2Fnode_ext.rs?ref=29054e02fbc7a858d9d4a6efd61583ac45b3213b", "patch": "@@ -325,6 +325,15 @@ impl ast::Impl {\n         let second = types.next();\n         (first, second)\n     }\n+\n+    pub fn for_trait_name_ref(name_ref: &ast::NameRef) -> Option<ast::Impl> {\n+        let this = name_ref.syntax().ancestors().find_map(ast::Impl::cast)?;\n+        if this.trait_()?.syntax().text_range().start() == name_ref.syntax().text_range().start() {\n+            Some(this)\n+        } else {\n+            None\n+        }\n+    }\n }\n \n #[derive(Debug, Clone, PartialEq, Eq)]"}]}