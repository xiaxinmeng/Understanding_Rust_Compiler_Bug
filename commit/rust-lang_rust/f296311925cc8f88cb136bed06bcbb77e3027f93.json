{"sha": "f296311925cc8f88cb136bed06bcbb77e3027f93", "node_id": "C_kwDOAAsO6NoAKGYyOTYzMTE5MjVjYzhmODhjYjEzNmJlZDA2YmNiYjc3ZTMwMjdmOTM", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-12-03T12:16:34Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-12-03T12:16:34Z"}, "message": "Test on CI with unstable cg_clif features disabled\n\nPart of #1084", "tree": {"sha": "1c6b0f38e211170cabd2ec6a8662cc0761961237", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1c6b0f38e211170cabd2ec6a8662cc0761961237"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f296311925cc8f88cb136bed06bcbb77e3027f93", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f296311925cc8f88cb136bed06bcbb77e3027f93", "html_url": "https://github.com/rust-lang/rust/commit/f296311925cc8f88cb136bed06bcbb77e3027f93", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f296311925cc8f88cb136bed06bcbb77e3027f93/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8fa112b0d368fe0753cd0d16588faa76f9fd4808", "url": "https://api.github.com/repos/rust-lang/rust/commits/8fa112b0d368fe0753cd0d16588faa76f9fd4808", "html_url": "https://github.com/rust-lang/rust/commit/8fa112b0d368fe0753cd0d16588faa76f9fd4808"}], "stats": {"total": 27, "additions": 23, "deletions": 4}, "files": [{"sha": "7b73d3c00e60ef6ccdc68b053f8b92f20312ee29", "filename": ".github/workflows/main.yml", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f296311925cc8f88cb136bed06bcbb77e3027f93/.github%2Fworkflows%2Fmain.yml", "raw_url": "https://github.com/rust-lang/rust/raw/f296311925cc8f88cb136bed06bcbb77e3027f93/.github%2Fworkflows%2Fmain.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fworkflows%2Fmain.yml?ref=f296311925cc8f88cb136bed06bcbb77e3027f93", "patch": "@@ -65,6 +65,12 @@ jobs:\n         git config --global user.name \"User\"\n         ./y.rs prepare\n \n+    - name: Build without unstable features\n+      env:\n+        TARGET_TRIPLE: ${{ matrix.env.TARGET_TRIPLE }}\n+      # This is the config rust-lang/rust uses for builds\n+      run: ./y.rs build --no-unstable-features\n+\n     - name: Build\n       run: ./y.rs build --sysroot none\n "}, {"sha": "ccc50ee4a59bf57544459befa117c5acf5048121", "filename": "build_system/build_backend.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f296311925cc8f88cb136bed06bcbb77e3027f93/build_system%2Fbuild_backend.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f296311925cc8f88cb136bed06bcbb77e3027f93/build_system%2Fbuild_backend.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build_system%2Fbuild_backend.rs?ref=f296311925cc8f88cb136bed06bcbb77e3027f93", "patch": "@@ -2,9 +2,17 @@ use std::env;\n use std::path::{Path, PathBuf};\n use std::process::Command;\n \n-pub(crate) fn build_backend(channel: &str, host_triple: &str) -> PathBuf {\n+pub(crate) fn build_backend(\n+    channel: &str,\n+    host_triple: &str,\n+    use_unstable_features: bool,\n+) -> PathBuf {\n     let mut cmd = Command::new(\"cargo\");\n-    cmd.arg(\"build\").arg(\"--target\").arg(host_triple).arg(\"--features\").arg(\"unstable-features\");\n+    cmd.arg(\"build\").arg(\"--target\").arg(host_triple);\n+\n+    if use_unstable_features {\n+        cmd.arg(\"--features\").arg(\"unstable-features\");\n+    }\n \n     match channel {\n         \"debug\" => {}"}, {"sha": "98b114de91078910d97a788605f64e59790ff95a", "filename": "y.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/f296311925cc8f88cb136bed06bcbb77e3027f93/y.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f296311925cc8f88cb136bed06bcbb77e3027f93/y.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/y.rs?ref=f296311925cc8f88cb136bed06bcbb77e3027f93", "patch": "@@ -43,7 +43,9 @@ mod utils;\n fn usage() {\n     eprintln!(\"Usage:\");\n     eprintln!(\"  ./y.rs prepare\");\n-    eprintln!(\"  ./y.rs build [--debug] [--sysroot none|clif|llvm] [--target-dir DIR]\");\n+    eprintln!(\n+        \"  ./y.rs build [--debug] [--sysroot none|clif|llvm] [--target-dir DIR] [--no-unstable-features]\"\n+    );\n }\n \n macro_rules! arg_error {\n@@ -92,6 +94,7 @@ fn main() {\n     let mut target_dir = PathBuf::from(\"build\");\n     let mut channel = \"release\";\n     let mut sysroot_kind = SysrootKind::Clif;\n+    let mut use_unstable_features = true;\n     while let Some(arg) = args.next().as_deref() {\n         match arg {\n             \"--target-dir\" => {\n@@ -109,6 +112,7 @@ fn main() {\n                     None => arg_error!(\"--sysroot requires argument\"),\n                 }\n             }\n+            \"--no-unstable-features\" => use_unstable_features = false,\n             flag if flag.starts_with(\"-\") => arg_error!(\"Unknown flag {}\", flag),\n             arg => arg_error!(\"Unexpected argument {}\", arg),\n         }\n@@ -141,7 +145,8 @@ fn main() {\n         process::exit(1);\n     }\n \n-    let cg_clif_build_dir = build_backend::build_backend(channel, &host_triple);\n+    let cg_clif_build_dir =\n+        build_backend::build_backend(channel, &host_triple, use_unstable_features);\n     build_sysroot::build_sysroot(\n         channel,\n         sysroot_kind,"}]}