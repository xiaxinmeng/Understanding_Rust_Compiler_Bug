{"sha": "9d493c897b4382dc145b9448b3fafdfbbaecf528", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlkNDkzYzg5N2I0MzgyZGMxNDViOTQ0OGIzZmFmZGZiYmFlY2Y1Mjg=", "commit": {"author": {"name": "Robin Kruppe", "email": "robin.kruppe@gmail.com", "date": "2018-02-14T22:01:39Z"}, "committer": {"name": "Robin Kruppe", "email": "robin.kruppe@gmail.com", "date": "2018-02-15T17:10:55Z"}, "message": "[improper_ctypes] Point at definition of non-FFI-safe type if possible", "tree": {"sha": "1587304f5b542c9d8af0b4805d52bcb7f0761eaf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1587304f5b542c9d8af0b4805d52bcb7f0761eaf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9d493c897b4382dc145b9448b3fafdfbbaecf528", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9d493c897b4382dc145b9448b3fafdfbbaecf528", "html_url": "https://github.com/rust-lang/rust/commit/9d493c897b4382dc145b9448b3fafdfbbaecf528", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9d493c897b4382dc145b9448b3fafdfbbaecf528/comments", "author": null, "committer": null, "parents": [{"sha": "22a171609bf555833b277a70420a24696dd8805d", "url": "https://api.github.com/repos/rust-lang/rust/commits/22a171609bf555833b277a70420a24696dd8805d", "html_url": "https://github.com/rust-lang/rust/commit/22a171609bf555833b277a70420a24696dd8805d"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "396d830d85be1fb2d644aa9f66e75d48f6a02f81", "filename": "src/librustc_lint/types.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9d493c897b4382dc145b9448b3fafdfbbaecf528/src%2Flibrustc_lint%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d493c897b4382dc145b9448b3fafdfbbaecf528/src%2Flibrustc_lint%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Ftypes.rs?ref=9d493c897b4382dc145b9448b3fafdfbbaecf528", "patch": "@@ -666,6 +666,11 @@ impl<'a, 'tcx> ImproperCTypesVisitor<'a, 'tcx> {\n                 if let Some(s) = help {\n                     diag.help(s);\n                 }\n+                if let ty::TyAdt(def, _) = unsafe_ty.sty {\n+                    if let Some(sp) = self.cx.tcx.hir.span_if_local(def.did) {\n+                        diag.span_note(sp, \"type defined here\");\n+                    }\n+                }\n                 diag.emit();\n             }\n         }"}, {"sha": "2abf08d55f7b32fb79a4e47323c0d7b7f841b18d", "filename": "src/test/ui/lint-ctypes.stderr", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/9d493c897b4382dc145b9448b3fafdfbbaecf528/src%2Ftest%2Fui%2Flint-ctypes.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9d493c897b4382dc145b9448b3fafdfbbaecf528/src%2Ftest%2Fui%2Flint-ctypes.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint-ctypes.stderr?ref=9d493c897b4382dc145b9448b3fafdfbbaecf528", "patch": "@@ -10,6 +10,11 @@ note: lint level defined here\n 11 | #![deny(improper_ctypes)]\n    |         ^^^^^^^^^^^^^^^\n    = help: consider adding a #[repr(C)] or #[repr(transparent)] attribute to this struct\n+note: type defined here\n+  --> $DIR/lint-ctypes.rs:32:1\n+   |\n+32 | pub struct Foo;\n+   | ^^^^^^^^^^^^^^^\n \n error: `extern` block uses type `Foo` which is not FFI-safe: this struct has unspecified layout\n   --> $DIR/lint-ctypes.rs:55:28\n@@ -18,6 +23,11 @@ error: `extern` block uses type `Foo` which is not FFI-safe: this struct has uns\n    |                            ^^^^^^^^^^\n    |\n    = help: consider adding a #[repr(C)] or #[repr(transparent)] attribute to this struct\n+note: type defined here\n+  --> $DIR/lint-ctypes.rs:32:1\n+   |\n+32 | pub struct Foo;\n+   | ^^^^^^^^^^^^^^^\n \n error: `extern` block uses type `[u32]` which is not FFI-safe: slices have no C equivalent\n   --> $DIR/lint-ctypes.rs:56:26\n@@ -94,6 +104,11 @@ error: `extern` block uses type `ZeroSize` which is not FFI-safe: this struct ha\n    |                         ^^^^^^^^\n    |\n    = help: consider adding a member to this struct\n+note: type defined here\n+  --> $DIR/lint-ctypes.rs:28:1\n+   |\n+28 | pub struct ZeroSize;\n+   | ^^^^^^^^^^^^^^^^^^^^\n \n error: `extern` block uses type `ZeroSizeWithPhantomData` which is not FFI-safe: composed only of PhantomData\n   --> $DIR/lint-ctypes.rs:66:33"}]}