{"sha": "f17f97d36a41a1ca4c9f9bc3ecec9b30b5555583", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYxN2Y5N2QzNmE0MWExY2E0YzlmOWJjM2VjZWM5YjMwYjU1NTU1ODM=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-02-03T17:58:36Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-02-03T17:58:36Z"}, "message": "Rollup merge of #68798 - Centril:caller-loc-ctfe-rt-equiv, r=RalfJung\n\nTest that `#[track_caller]` as `fn()` respects RT / CTFE equivalence\n\nr? @RalfJung cc @anp @eddyb", "tree": {"sha": "1626ccfc1d8ca79211fc90321edee1d0d5e8c18d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1626ccfc1d8ca79211fc90321edee1d0d5e8c18d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f17f97d36a41a1ca4c9f9bc3ecec9b30b5555583", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeOF9MCRBK7hj4Ov3rIwAAdHIIAEF+bbSUrcqq4jG+7TYlYwdM\nmt/OroS5iGDNdezlwe/0ZPSP6Cf++tO5TwL9qD0IRYr0B/PQA6SIj4EZJ5tsLuZ7\nchtZRVY3dKeVdVCOOMlxxXBY3DyoBk9LIiXR3hm7TBhP8AFUF59a6mu17i3zyaNS\n+5wbRwi8bWFWWdhAIu04dqskhT+ptgquoBhcGzQlL7Wx4AS3UX+P6CGBXMy2V9tk\nabrtUPcdWcmgL5dX0J4giMPYp4PGBHDQf3GMR+Pn47HrGcFCQNWPE3GsTuR6aVek\nF6skHvccQeXF3xhZVIub5YULiNIIQtj4KMVsUKKvCbAGUyhQ+5sB53c0myYQEz4=\n=6CqF\n-----END PGP SIGNATURE-----\n", "payload": "tree 1626ccfc1d8ca79211fc90321edee1d0d5e8c18d\nparent 1028978e8f8c51aeab76667ba7f5a5e46524c1ba\nparent f0eec8858173868d2d266c5d7fe4ef83a2d9412c\nauthor Dylan DPC <dylan.dpc@gmail.com> 1580752716 +0100\ncommitter GitHub <noreply@github.com> 1580752716 +0100\n\nRollup merge of #68798 - Centril:caller-loc-ctfe-rt-equiv, r=RalfJung\n\nTest that `#[track_caller]` as `fn()` respects RT / CTFE equivalence\n\nr? @RalfJung cc @anp @eddyb\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f17f97d36a41a1ca4c9f9bc3ecec9b30b5555583", "html_url": "https://github.com/rust-lang/rust/commit/f17f97d36a41a1ca4c9f9bc3ecec9b30b5555583", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f17f97d36a41a1ca4c9f9bc3ecec9b30b5555583/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1028978e8f8c51aeab76667ba7f5a5e46524c1ba", "url": "https://api.github.com/repos/rust-lang/rust/commits/1028978e8f8c51aeab76667ba7f5a5e46524c1ba", "html_url": "https://github.com/rust-lang/rust/commit/1028978e8f8c51aeab76667ba7f5a5e46524c1ba"}, {"sha": "f0eec8858173868d2d266c5d7fe4ef83a2d9412c", "url": "https://api.github.com/repos/rust-lang/rust/commits/f0eec8858173868d2d266c5d7fe4ef83a2d9412c", "html_url": "https://github.com/rust-lang/rust/commit/f0eec8858173868d2d266c5d7fe4ef83a2d9412c"}], "stats": {"total": 38, "additions": 38, "deletions": 0}, "files": [{"sha": "fe2b92eafdb76d8fd11ff61cfd2a35b35681c824", "filename": "src/test/ui/rfc-2091-track-caller/caller-location-fnptr-rt-ctfe-equiv.rs", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/f17f97d36a41a1ca4c9f9bc3ecec9b30b5555583/src%2Ftest%2Fui%2Frfc-2091-track-caller%2Fcaller-location-fnptr-rt-ctfe-equiv.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f17f97d36a41a1ca4c9f9bc3ecec9b30b5555583/src%2Ftest%2Fui%2Frfc-2091-track-caller%2Fcaller-location-fnptr-rt-ctfe-equiv.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2091-track-caller%2Fcaller-location-fnptr-rt-ctfe-equiv.rs?ref=f17f97d36a41a1ca4c9f9bc3ecec9b30b5555583", "patch": "@@ -0,0 +1,32 @@\n+// Ensure that a `#[track_caller]` function, returning `caller_location()`,\n+// which coerced (to a function pointer) and called, inside a `const fn`,\n+// in turn called, results in the same output irrespective of whether\n+// we're in a const or runtime context.\n+\n+// run-pass\n+// compile-flags: -Z unleash-the-miri-inside-of-you\n+\n+#![feature(core_intrinsics, const_caller_location, track_caller, const_fn)]\n+\n+type L = &'static std::panic::Location<'static>;\n+\n+#[track_caller]\n+const fn attributed() -> L {\n+    std::intrinsics::caller_location()\n+}\n+\n+const fn calling_attributed() -> L {\n+    // We need `-Z unleash-the-miri-inside-of-you` for this as we don't have `const fn` pointers.\n+    let ptr: fn() -> L = attributed;\n+    ptr() //~ WARN skipping const checks\n+}\n+\n+fn main() {\n+    const CONSTANT: L = calling_attributed();\n+    let runtime = calling_attributed();\n+\n+    assert_eq!(\n+        (runtime.file(), runtime.line(), runtime.column()),\n+        (CONSTANT.file(), CONSTANT.line(), CONSTANT.column()),\n+    );\n+}"}, {"sha": "fcf0945ed4cc672c3a66a0f3667d21d018bdaaf5", "filename": "src/test/ui/rfc-2091-track-caller/caller-location-fnptr-rt-ctfe-equiv.stderr", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f17f97d36a41a1ca4c9f9bc3ecec9b30b5555583/src%2Ftest%2Fui%2Frfc-2091-track-caller%2Fcaller-location-fnptr-rt-ctfe-equiv.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f17f97d36a41a1ca4c9f9bc3ecec9b30b5555583/src%2Ftest%2Fui%2Frfc-2091-track-caller%2Fcaller-location-fnptr-rt-ctfe-equiv.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfc-2091-track-caller%2Fcaller-location-fnptr-rt-ctfe-equiv.stderr?ref=f17f97d36a41a1ca4c9f9bc3ecec9b30b5555583", "patch": "@@ -0,0 +1,6 @@\n+warning: skipping const checks\n+  --> $DIR/caller-location-fnptr-rt-ctfe-equiv.rs:21:5\n+   |\n+LL |     ptr()\n+   |     ^^^^^\n+"}]}