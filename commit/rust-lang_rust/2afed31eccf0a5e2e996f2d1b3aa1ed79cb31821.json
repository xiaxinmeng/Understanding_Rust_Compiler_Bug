{"sha": "2afed31eccf0a5e2e996f2d1b3aa1ed79cb31821", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJhZmVkMzFlY2NmMGE1ZTJlOTk2ZjJkMWIzYWExZWQ3OWNiMzE4MjE=", "commit": {"author": {"name": "Daniel Micay", "email": "danielmicay@gmail.com", "date": "2013-08-09T03:49:49Z"}, "committer": {"name": "Daniel Micay", "email": "danielmicay@gmail.com", "date": "2013-08-11T07:14:35Z"}, "message": "vec: optimize the Add implementation\n\nbefore:\n\ntest add ... bench: 164 ns/iter (+/- 1)\n\nafter:\n\ntest add ... bench: 113 ns/iter (+/- 2)", "tree": {"sha": "caac6a3d4fa410cc0b83dbe69b7f4a2fa34f1a1a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/caac6a3d4fa410cc0b83dbe69b7f4a2fa34f1a1a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2afed31eccf0a5e2e996f2d1b3aa1ed79cb31821", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2afed31eccf0a5e2e996f2d1b3aa1ed79cb31821", "html_url": "https://github.com/rust-lang/rust/commit/2afed31eccf0a5e2e996f2d1b3aa1ed79cb31821", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2afed31eccf0a5e2e996f2d1b3aa1ed79cb31821/comments", "author": {"login": "thestinger", "id": 1505226, "node_id": "MDQ6VXNlcjE1MDUyMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thestinger", "html_url": "https://github.com/thestinger", "followers_url": "https://api.github.com/users/thestinger/followers", "following_url": "https://api.github.com/users/thestinger/following{/other_user}", "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions", "organizations_url": "https://api.github.com/users/thestinger/orgs", "repos_url": "https://api.github.com/users/thestinger/repos", "events_url": "https://api.github.com/users/thestinger/events{/privacy}", "received_events_url": "https://api.github.com/users/thestinger/received_events", "type": "User", "site_admin": false}, "committer": {"login": "thestinger", "id": 1505226, "node_id": "MDQ6VXNlcjE1MDUyMjY=", "avatar_url": "https://avatars.githubusercontent.com/u/1505226?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thestinger", "html_url": "https://github.com/thestinger", "followers_url": "https://api.github.com/users/thestinger/followers", "following_url": "https://api.github.com/users/thestinger/following{/other_user}", "gists_url": "https://api.github.com/users/thestinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/thestinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thestinger/subscriptions", "organizations_url": "https://api.github.com/users/thestinger/orgs", "repos_url": "https://api.github.com/users/thestinger/repos", "events_url": "https://api.github.com/users/thestinger/events{/privacy}", "received_events_url": "https://api.github.com/users/thestinger/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eebcff1493a98524e72bbf0c79b004fc286d58d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/eebcff1493a98524e72bbf0c79b004fc286d58d7", "html_url": "https://github.com/rust-lang/rust/commit/eebcff1493a98524e72bbf0c79b004fc286d58d7"}], "stats": {"total": 19, "additions": 14, "deletions": 5}, "files": [{"sha": "d626b8604db87ed065ee36ff93d632514edbc7a8", "filename": "src/libstd/vec.rs", "status": "modified", "additions": 14, "deletions": 5, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/2afed31eccf0a5e2e996f2d1b3aa1ed79cb31821/src%2Flibstd%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2afed31eccf0a5e2e996f2d1b3aa1ed79cb31821/src%2Flibstd%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fvec.rs?ref=2afed31eccf0a5e2e996f2d1b3aa1ed79cb31821", "patch": "@@ -561,7 +561,7 @@ impl<'self, T> RandomAccessIterator<&'self [T]> for ChunkIter<'self, T> {\n \n #[cfg(not(test))]\n pub mod traits {\n-    use super::Vector;\n+    use super::*;\n \n     use clone::Clone;\n     use cmp::{Eq, Ord, TotalEq, TotalOrd, Ordering, Equal, Equiv};\n@@ -686,17 +686,17 @@ pub mod traits {\n     impl<'self,T:Clone, V: Vector<T>> Add<V, ~[T]> for &'self [T] {\n         #[inline]\n         fn add(&self, rhs: &V) -> ~[T] {\n-            let mut res = self.to_owned();\n+            let mut res = with_capacity(self.len() + rhs.as_slice().len());\n+            res.push_all(*self);\n             res.push_all(rhs.as_slice());\n             res\n         }\n     }\n+\n     impl<T:Clone, V: Vector<T>> Add<V, ~[T]> for ~[T] {\n         #[inline]\n         fn add(&self, rhs: &V) -> ~[T] {\n-            let mut res = self.to_owned();\n-            res.push_all(rhs.as_slice());\n-            res\n+            self.as_slice() + rhs.as_slice()\n         }\n     }\n }\n@@ -3662,4 +3662,13 @@ mod bench {\n             }\n         }\n     }\n+\n+    #[bench]\n+    fn add(b: &mut BenchHarness) {\n+        let xs: &[int] = [5, ..10];\n+        let ys: &[int] = [5, ..10];\n+        do b.iter() {\n+            xs + ys;\n+        }\n+    }\n }"}]}