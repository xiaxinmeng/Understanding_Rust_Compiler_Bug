{"sha": "365a3586a94dc9ca675ddb02a86e116e8161481a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM2NWEzNTg2YTk0ZGM5Y2E2NzVkZGIwMmE4NmUxMTZlODE2MTQ4MWE=", "commit": {"author": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2021-06-19T08:46:34Z"}, "committer": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2021-06-19T08:46:34Z"}, "message": "Windows: Fix `Command::env_clear` so it works\n\nPreviously, it would error unless at least one new environment variable was added.", "tree": {"sha": "64ad908eb1920691e4c8e4ca08e78e2d05f0f2ed", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/64ad908eb1920691e4c8e4ca08e78e2d05f0f2ed"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/365a3586a94dc9ca675ddb02a86e116e8161481a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE+p/jD6jrzmnSIWJLcTRy8vRWJ94FAmDNruoACgkQcTRy8vRW\nJ95DoA/9FnMDlR/wQ5WS+iC/EzRLR/6b/r1V04ntflT4av24mHsW0jl3fyaJMH7p\ne1AXAsC3ZejuMGzZmqus3IgqPKoq/aIQm/pNlirVjqnAN6x+8B0OHAGv+i4uC9st\nIAZ/GauNRMvLrv5MGTZ2j+TxCniLJsjZpGEI1GNq5bpmY/+G+V9KfNjSY8kf2yCH\nb4OP5km/Vrwee7k2Nt9FZFGMVDQFRQfKPKdo4XOL5Yxy4BBdgFfCbd2UWVL8ZtQm\n2mddMQYS9ni87MTRsgUhqw+pzUW/7+RNo0a08PFlQRd4M0PITOGtS8yBfAdlbZoR\n+qYnCBAPTGjvTNIxJZq0k5NNZsOMVpk3Z/u+KQ6/dZbtzu+HVvxYmlYC/eEqUOCa\nEes/toPct3pC1ojtMU/mi8yeKCJCAcRCOx/VBtp/MtrYbN6o3TbffcJFmd7S4FEH\nSou6OXg6q+5lqANL4qFcHrT52TYbug//vlpIzUg1k9KOGw9w9HgFrSQw233Jp0yR\nW7u0uNUkNfcRKFiFyE+njpaMsmimcZ/M1rIZhpSZQ4nQUvcA/yPx9OfnWbXW9AiX\nOsLOXtsIzWVrsOX3H4jzUGj3tXS8d9OQ6RN4fk9/UXrN1ZTdShCTdSSH7me+ZEwc\nrKmC9wgpXuUjA0ZM7SIaRG+TdHJAY4O+a6FlJJAirC34ogF+xtY=\n=kSoW\n-----END PGP SIGNATURE-----", "payload": "tree 64ad908eb1920691e4c8e4ca08e78e2d05f0f2ed\nparent 9839f9c7ff0c550e1234e9784612e981ea0123d5\nauthor Chris Denton <christophersdenton@gmail.com> 1624092394 +0100\ncommitter Chris Denton <christophersdenton@gmail.com> 1624092394 +0100\n\nWindows: Fix `Command::env_clear` so it works\n\nPreviously, it would error unless at least one new environment variable was added.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/365a3586a94dc9ca675ddb02a86e116e8161481a", "html_url": "https://github.com/rust-lang/rust/commit/365a3586a94dc9ca675ddb02a86e116e8161481a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/365a3586a94dc9ca675ddb02a86e116e8161481a/comments", "author": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9839f9c7ff0c550e1234e9784612e981ea0123d5", "url": "https://api.github.com/repos/rust-lang/rust/commits/9839f9c7ff0c550e1234e9784612e981ea0123d5", "html_url": "https://github.com/rust-lang/rust/commit/9839f9c7ff0c550e1234e9784612e981ea0123d5"}], "stats": {"total": 6, "additions": 6, "deletions": 0}, "files": [{"sha": "14de2530842f8da93d16558e109ee6ad50419c8f", "filename": "library/std/src/sys/windows/process.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/365a3586a94dc9ca675ddb02a86e116e8161481a/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/365a3586a94dc9ca675ddb02a86e116e8161481a/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fprocess.rs?ref=365a3586a94dc9ca675ddb02a86e116e8161481a", "patch": "@@ -530,6 +530,12 @@ fn make_envp(maybe_env: Option<BTreeMap<EnvKey, OsString>>) -> io::Result<(*mut\n     if let Some(env) = maybe_env {\n         let mut blk = Vec::new();\n \n+        // If there are no environment variables to set then signal this by\n+        // pushing a null.\n+        if env.is_empty() {\n+            blk.push(0);\n+        }\n+\n         for (k, v) in env {\n             blk.extend(ensure_no_nuls(k.0)?.encode_wide());\n             blk.push('=' as u16);"}]}