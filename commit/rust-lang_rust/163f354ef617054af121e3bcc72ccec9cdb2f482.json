{"sha": "163f354ef617054af121e3bcc72ccec9cdb2f482", "node_id": "C_kwDOAAsO6NoAKDE2M2YzNTRlZjYxNzA1NGFmMTIxZTNiY2M3MmNjZWM5Y2RiMmY0ODI", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-03-12T21:23:24Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-03-12T21:23:24Z"}, "message": "Auto merge of #2811 - saethlin:readme-nextest, r=RalfJung\n\nAdd a section on using nextest\n\nInspired by this question: https://github.com/rust-lang/miri/issues/2805", "tree": {"sha": "ba2ab6ab2a08b19e7f7c2ad7e3de43e0811ca2e6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ba2ab6ab2a08b19e7f7c2ad7e3de43e0811ca2e6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/163f354ef617054af121e3bcc72ccec9cdb2f482", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/163f354ef617054af121e3bcc72ccec9cdb2f482", "html_url": "https://github.com/rust-lang/rust/commit/163f354ef617054af121e3bcc72ccec9cdb2f482", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/163f354ef617054af121e3bcc72ccec9cdb2f482/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a99494776aee34167c199419f163ab786835affa", "url": "https://api.github.com/repos/rust-lang/rust/commits/a99494776aee34167c199419f163ab786835affa", "html_url": "https://github.com/rust-lang/rust/commit/a99494776aee34167c199419f163ab786835affa"}, {"sha": "d3ce3de68c6a4d9db362f4128e8e544516f9d315", "url": "https://api.github.com/repos/rust-lang/rust/commits/d3ce3de68c6a4d9db362f4128e8e544516f9d315", "html_url": "https://github.com/rust-lang/rust/commit/d3ce3de68c6a4d9db362f4128e8e544516f9d315"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "f0b73d058739420e5653480bb7673b3d0aee21a5", "filename": "src/tools/miri/README.md", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/163f354ef617054af121e3bcc72ccec9cdb2f482/src%2Ftools%2Fmiri%2FREADME.md", "raw_url": "https://github.com/rust-lang/rust/raw/163f354ef617054af121e3bcc72ccec9cdb2f482/src%2Ftools%2Fmiri%2FREADME.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fmiri%2FREADME.md?ref=163f354ef617054af121e3bcc72ccec9cdb2f482", "patch": "@@ -225,6 +225,26 @@ degree documented below):\n   reduced feature set. We might ship Miri with a nightly even when some features\n   on these targets regress.\n \n+### Running tests in parallel\n+\n+Though it implements Rust threading, Miri itself is a single-threaded interpreter.\n+This means that when running `cargo miri test`, you will probably see a dramatic\n+increase in the amount of time it takes to run your whole test suite due to the\n+inherent interpreter slowdown and a loss of parallelism.\n+\n+You can get your test suite's parallelism back by running `cargo miri nextest run -jN`\n+(note that you will need [`cargo-nextest`](https://nexte.st) installed).\n+This works because `cargo-nextest` collects a list of all tests then launches a\n+separate `cargo miri run` for each test. You will need to specify a `-j` or `--test-threads`;\n+by default `cargo miri nextest run` runs one test at a time. For more details, see the\n+[`cargo-nextest` Miri documentation](https://nexte.st/book/miri.html).\n+\n+Note: This one-test-per-process model means that `cargo miri test` is able to detect data\n+races where two tests race on a shared resource, but `cargo miri nextest run` will not detect\n+such races.\n+\n+Note: `cargo-nextest` does not support doctests, see https://github.com/nextest-rs/nextest/issues/16\n+\n ### Common Problems\n \n When using the above instructions, you may encounter a number of confusing compiler"}]}