{"sha": "3d0610b072537f43946cf685bc9888ec7df44f08", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNkMDYxMGIwNzI1MzdmNDM5NDZjZjY4NWJjOTg4OGVjN2RmNDRmMDg=", "commit": {"author": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-12-07T20:53:05Z"}, "committer": {"name": "Marijn Haverbeke", "email": "marijnh@gmail.com", "date": "2011-12-07T20:53:05Z"}, "message": "Check for literals that are out of range for their type", "tree": {"sha": "b30dc88e7f30a1d53d68eef2ff30b1981de0a2d9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b30dc88e7f30a1d53d68eef2ff30b1981de0a2d9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3d0610b072537f43946cf685bc9888ec7df44f08", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3d0610b072537f43946cf685bc9888ec7df44f08", "html_url": "https://github.com/rust-lang/rust/commit/3d0610b072537f43946cf685bc9888ec7df44f08", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3d0610b072537f43946cf685bc9888ec7df44f08/comments", "author": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marijnh", "id": 144427, "node_id": "MDQ6VXNlcjE0NDQyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/144427?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marijnh", "html_url": "https://github.com/marijnh", "followers_url": "https://api.github.com/users/marijnh/followers", "following_url": "https://api.github.com/users/marijnh/following{/other_user}", "gists_url": "https://api.github.com/users/marijnh/gists{/gist_id}", "starred_url": "https://api.github.com/users/marijnh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marijnh/subscriptions", "organizations_url": "https://api.github.com/users/marijnh/orgs", "repos_url": "https://api.github.com/users/marijnh/repos", "events_url": "https://api.github.com/users/marijnh/events{/privacy}", "received_events_url": "https://api.github.com/users/marijnh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e3eca9174b9dc186de4ad44f80f7537f2e9e4c60", "url": "https://api.github.com/repos/rust-lang/rust/commits/e3eca9174b9dc186de4ad44f80f7537f2e9e4c60", "html_url": "https://github.com/rust-lang/rust/commit/e3eca9174b9dc186de4ad44f80f7537f2e9e4c60"}], "stats": {"total": 42, "additions": 40, "deletions": 2}, "files": [{"sha": "81d41b06e49fb270f4ab7eb77c076f6b906e4ed1", "filename": "src/comp/middle/check_const.rs", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/3d0610b072537f43946cf685bc9888ec7df44f08/src%2Fcomp%2Fmiddle%2Fcheck_const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d0610b072537f43946cf685bc9888ec7df44f08/src%2Fcomp%2Fmiddle%2Fcheck_const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fcheck_const.rs?ref=3d0610b072537f43946cf685bc9888ec7df44f08", "patch": "@@ -1,5 +1,5 @@\n import syntax::ast::*;\n-import syntax::visit;\n+import syntax::{visit, ast_util};\n import driver::session::session;\n \n fn check_crate(sess: session, crate: @crate) {\n@@ -56,6 +56,23 @@ fn check_expr(sess: session, e: @expr, &&is_const: bool, v: visit::vt<bool>) {\n           }\n         }\n     }\n+    alt e.node {\n+      expr_lit(@{node: lit_int(v, t), _}) {\n+        if t != ty_char {\n+            if (v as u64) > ast_util::int_ty_max(\n+                t == ty_i ? sess.get_targ_cfg().int_type : t) {\n+                sess.span_err(e.span, \"literal out of range for its type\");\n+            }\n+        }\n+      }\n+      expr_lit(@{node: lit_uint(v, t), _}) {\n+        if v > ast_util::uint_ty_max(\n+            t == ty_u ? sess.get_targ_cfg().uint_type : t) {\n+            sess.span_err(e.span, \"literal out of range for its type\");\n+        }\n+      }\n+      _ {}\n+    }\n     visit::visit_expr(e, is_const, v);\n }\n "}, {"sha": "dc1d0e0bbbb7fefe6d716ca1c9effe5d4d757aaf", "filename": "src/comp/syntax/ast_util.rs", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/3d0610b072537f43946cf685bc9888ec7df44f08/src%2Fcomp%2Fsyntax%2Fast_util.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d0610b072537f43946cf685bc9888ec7df44f08/src%2Fcomp%2Fsyntax%2Fast_util.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fsyntax%2Fast_util.rs?ref=3d0610b072537f43946cf685bc9888ec7df44f08", "patch": "@@ -132,13 +132,31 @@ fn int_ty_to_str(t: int_ty) -> str {\n     }\n }\n \n+fn int_ty_max(t: int_ty) -> u64 {\n+    alt t {\n+      ty_i8. { 0x80u64 }\n+      ty_i16. { 0x800u64 }\n+      ty_char. | ty_i32. { 0x80000000u64 }\n+      ty_i64. { 0x8000000000000000u64 }\n+    }\n+}\n+\n fn uint_ty_to_str(t: uint_ty) -> str {\n     alt t {\n       ty_u. { \"\" } ty_u8. { \"u8\" } ty_u16. { \"u16\" }\n       ty_u32. { \"u32\" } ty_u64. { \"u64\" }\n     }\n }\n \n+fn uint_ty_max(t: uint_ty) -> u64 {\n+    alt t {\n+      ty_u8. { 0xffu64 }\n+      ty_u16. { 0xffffu64 }\n+      ty_u32. { 0xffffffffu64 }\n+      ty_u64. { 0xffffffffffffffffu64 }\n+    }\n+}\n+\n fn float_ty_to_str(t: float_ty) -> str {\n     alt t { ty_f. { \"\" } ty_f32. { \"f32\" } ty_f64. { \"f64\" } }\n }"}, {"sha": "f33b8414a4d2eee46ac188d5fb90414fefc3f4d3", "filename": "src/libstd/u32.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3d0610b072537f43946cf685bc9888ec7df44f08/src%2Flibstd%2Fu32.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d0610b072537f43946cf685bc9888ec7df44f08/src%2Flibstd%2Fu32.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fu32.rs?ref=3d0610b072537f43946cf685bc9888ec7df44f08", "patch": "@@ -14,7 +14,7 @@ Const: max_value\n \n Return the maximal value for a u32\n */\n-const max_value: u32 = 4294967296u32;\n+const max_value: u32 = 0xffff_ffffu32;\n \n //\n // Local Variables:"}, {"sha": "30b61811b04b05614fbea06b7558f5decb3bf717", "filename": "src/test/compile-fail/oversized-literal.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3d0610b072537f43946cf685bc9888ec7df44f08/src%2Ftest%2Fcompile-fail%2Foversized-literal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d0610b072537f43946cf685bc9888ec7df44f08/src%2Ftest%2Fcompile-fail%2Foversized-literal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Foversized-literal.rs?ref=3d0610b072537f43946cf685bc9888ec7df44f08", "patch": "@@ -0,0 +1,3 @@\n+// error-pattern:literal out of range\n+\n+fn main() { log 300u8; }"}]}