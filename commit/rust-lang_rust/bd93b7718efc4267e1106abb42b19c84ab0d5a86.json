{"sha": "bd93b7718efc4267e1106abb42b19c84ab0d5a86", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJkOTNiNzcxOGVmYzQyNjdlMTEwNmFiYjQyYjE5Yzg0YWIwZDVhODY=", "commit": {"author": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2019-12-27T11:56:52Z"}, "committer": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2019-12-27T12:33:22Z"}, "message": "Avoid memory copy logic for zsts\n\nCloses #67539", "tree": {"sha": "a9af5e0a6df47f77dbaa0ba6d83e9ada8a0b1fce", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a9af5e0a6df47f77dbaa0ba6d83e9ada8a0b1fce"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bd93b7718efc4267e1106abb42b19c84ab0d5a86", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEmNHc6jmXzkUyxd4xiMlBzaHUZDIFAl4F+hMACgkQiMlBzaHU\nZDL7sA//QKBOrzE9B15squ3MFTAAO8ThULZp8hTZmjv7jPocGpQzmLXFt5NS/Vaz\n+YGylTnS/Uz3VHLfbpDT8C4Dpo/CFra9toDX0xrpVkjCVNq+M0JnMZ7EYaRMavyG\nApx0xxwsm1l2+oImLDj3MvV/F0WJSXCr0R+L8EUDOd+0putunMlLCTSGJdh4sAjr\nJPJVtAEF6bDphRD2T6rGgaKyWcxRxVvJ2AP7syutJWnAyxEY/KDUcA470WCy17Pv\nU9wa+c1m4v03cKlOzsn5CUTypQKD2NSyP5Xa5zPDrTcwql2ueHt1OwKj4Nnw3Ma0\nvZiRgwzLniWVTYkaG2LZmm6ihmUq3MU5gbtjQ0GikuLXgfyh88usbbCEhiS7vvI5\n0xqVzLvbUKEC1QfRdZ2f0INOL//7m6THXYO+HhP9GcQHAAhgzfF4sYyzvuefgLYW\nVShW0TexlMZyFrCcpFNICllxWeK2Rb3YQwwFt9oXvYlBkk0wAu7mfEWuMjemvngY\nqrRRLUji/DHjovL2ShDXe/TH5zXIPAQ56AwII9EZdO/gsYC/e2aq2b63tkosA9h2\nYRy49Wk3/4M1JG2oxRi6muvHu1pK4Xnlwegkd8jqhQnOIWHx47AJf42myZ83o/YV\n2g8exG212TjuEoZ6dexSxm7ZNGC+chymEIdQBYlOriFqQ4JgoHg=\n=fOT1\n-----END PGP SIGNATURE-----", "payload": "tree a9af5e0a6df47f77dbaa0ba6d83e9ada8a0b1fce\nparent 8f5f8f916f00f7989a4ebf7b7dbfe1afd605f828\nauthor Santiago Pastorino <spastorino@gmail.com> 1577447812 -0300\ncommitter Santiago Pastorino <spastorino@gmail.com> 1577450002 -0300\n\nAvoid memory copy logic for zsts\n\nCloses #67539\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bd93b7718efc4267e1106abb42b19c84ab0d5a86", "html_url": "https://github.com/rust-lang/rust/commit/bd93b7718efc4267e1106abb42b19c84ab0d5a86", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bd93b7718efc4267e1106abb42b19c84ab0d5a86/comments", "author": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "committer": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8f5f8f916f00f7989a4ebf7b7dbfe1afd605f828", "url": "https://api.github.com/repos/rust-lang/rust/commits/8f5f8f916f00f7989a4ebf7b7dbfe1afd605f828", "html_url": "https://github.com/rust-lang/rust/commit/8f5f8f916f00f7989a4ebf7b7dbfe1afd605f828"}], "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "3d59b33c15d1ef45664eb43f94362f2fefac0fb0", "filename": "src/librustc_mir/interpret/memory.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/bd93b7718efc4267e1106abb42b19c84ab0d5a86/src%2Flibrustc_mir%2Finterpret%2Fmemory.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bd93b7718efc4267e1106abb42b19c84ab0d5a86/src%2Flibrustc_mir%2Finterpret%2Fmemory.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Finterpret%2Fmemory.rs?ref=bd93b7718efc4267e1106abb42b19c84ab0d5a86", "patch": "@@ -845,7 +845,15 @@ impl<'mir, 'tcx, M: Machine<'mir, 'tcx>> Memory<'mir, 'tcx, M> {\n         let src_bytes =\n             self.get_raw(src.alloc_id)?.get_bytes_with_undef_and_ptr(&tcx, src, size)?.as_ptr();\n         let dest_bytes =\n-            self.get_raw_mut(dest.alloc_id)?.get_bytes_mut(&tcx, dest, size * length)?.as_mut_ptr();\n+            self.get_raw_mut(dest.alloc_id)?.get_bytes_mut(&tcx, dest, size * length)?;\n+\n+        // If `dest_bytes` is empty we just optimize to not run anything for zsts.\n+        // See #67539\n+        if dest_bytes.is_empty() {\n+            return Ok(());\n+        }\n+\n+        let dest_bytes = dest_bytes.as_mut_ptr();\n \n         // SAFE: The above indexing would have panicked if there weren't at least `size` bytes\n         // behind `src` and `dest`. Also, we use the overlapping-safe `ptr::copy` if `src` and"}]}