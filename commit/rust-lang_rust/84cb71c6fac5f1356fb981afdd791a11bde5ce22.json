{"sha": "84cb71c6fac5f1356fb981afdd791a11bde5ce22", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg0Y2I3MWM2ZmFjNWYxMzU2ZmI5ODFhZmRkNzkxYTExYmRlNWNlMjI=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-09-16T14:41:45Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2020-10-02T17:26:59Z"}, "message": "Forbid some characters to be used as doc alias", "tree": {"sha": "498fba38ea71c2583f4f63bb79368cafeb9456ae", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/498fba38ea71c2583f4f63bb79368cafeb9456ae"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/84cb71c6fac5f1356fb981afdd791a11bde5ce22", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/84cb71c6fac5f1356fb981afdd791a11bde5ce22", "html_url": "https://github.com/rust-lang/rust/commit/84cb71c6fac5f1356fb981afdd791a11bde5ce22", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/84cb71c6fac5f1356fb981afdd791a11bde5ce22/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5fae56971d8487088c0099c82c0a5ce1638b5f62", "url": "https://api.github.com/repos/rust-lang/rust/commits/5fae56971d8487088c0099c82c0a5ce1638b5f62", "html_url": "https://github.com/rust-lang/rust/commit/5fae56971d8487088c0099c82c0a5ce1638b5f62"}], "stats": {"total": 34, "additions": 27, "deletions": 7}, "files": [{"sha": "852310ab1221c9ae2cbd47fd318c90dd3c3aac88", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 27, "deletions": 7, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/84cb71c6fac5f1356fb981afdd791a11bde5ce22/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84cb71c6fac5f1356fb981afdd791a11bde5ce22/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=84cb71c6fac5f1356fb981afdd791a11bde5ce22", "patch": "@@ -252,23 +252,42 @@ impl CheckAttrVisitor<'tcx> {\n         }\n     }\n \n+    fn doc_alias_str_error(&self, meta: &NestedMetaItem) {\n+        self.tcx\n+            .sess\n+            .struct_span_err(\n+                meta.span(),\n+                \"doc alias attribute expects a string: #[doc(alias = \\\"0\\\")]\",\n+            )\n+            .emit();\n+    }\n+\n     fn check_doc_alias(&self, attr: &Attribute, hir_id: HirId, target: Target) -> bool {\n         if let Some(mi) = attr.meta() {\n             if let Some(list) = mi.meta_item_list() {\n                 for meta in list {\n                     if meta.has_name(sym::alias) {\n-                        if !meta.is_value_str()\n-                            || meta\n-                                .value_str()\n-                                .map(|s| s.to_string())\n-                                .unwrap_or_else(String::new)\n-                                .is_empty()\n+                        if !meta.is_value_str() {\n+                            self.doc_alias_str_error(meta);\n+                            return false;\n+                        }\n+                        let doc_alias =\n+                            meta.value_str().map(|s| s.to_string()).unwrap_or_else(String::new);\n+                        if doc_alias.is_empty() {\n+                            self.doc_alias_str_error(meta);\n+                            return false;\n+                        }\n+                        if let Some(c) =\n+                            doc_alias.chars().find(|&c| c == '\"' || c == '\\'' || c.is_whitespace())\n                         {\n                             self.tcx\n                                 .sess\n                                 .struct_span_err(\n                                     meta.span(),\n-                                    \"doc alias attribute expects a string: #[doc(alias = \\\"0\\\")]\",\n+                                    &format!(\n+                                        \"{:?} character isn't allowed in `#[doc(alias = \\\"...\\\")]`\",\n+                                        c,\n+                                    ),\n                                 )\n                                 .emit();\n                             return false;\n@@ -304,6 +323,7 @@ impl CheckAttrVisitor<'tcx> {\n                                     &format!(\"`#[doc(alias = \\\"...\\\")]` isn't allowed on {}\", err),\n                                 )\n                                 .emit();\n+                            return false;\n                         }\n                     }\n                 }"}]}