{"sha": "69a4eaa1871a288968d3fcfa10e9a9612669fd9c", "node_id": "C_kwDOAAsO6NoAKDY5YTRlYWExODcxYTI4ODk2OGQzZmNmYTEwZTlhOTYxMjY2OWZkOWM", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-21T15:31:40Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-21T15:31:40Z"}, "message": "Auto merge of #2410 - rust-lang:miri_auto_ops, r=RalfJung\n\nSome cleanups and docs around the auto ops", "tree": {"sha": "788086564eba419030888fbc5e922c66cb5be810", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/788086564eba419030888fbc5e922c66cb5be810"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/69a4eaa1871a288968d3fcfa10e9a9612669fd9c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/69a4eaa1871a288968d3fcfa10e9a9612669fd9c", "html_url": "https://github.com/rust-lang/rust/commit/69a4eaa1871a288968d3fcfa10e9a9612669fd9c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/69a4eaa1871a288968d3fcfa10e9a9612669fd9c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "46d309f4243992c7708cd967ec8ef56e2e1b4553", "url": "https://api.github.com/repos/rust-lang/rust/commits/46d309f4243992c7708cd967ec8ef56e2e1b4553", "html_url": "https://github.com/rust-lang/rust/commit/46d309f4243992c7708cd967ec8ef56e2e1b4553"}, {"sha": "9e7f3cdc36fdef06647f5c35a91dc4631f0b92d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/9e7f3cdc36fdef06647f5c35a91dc4631f0b92d7", "html_url": "https://github.com/rust-lang/rust/commit/9e7f3cdc36fdef06647f5c35a91dc4631f0b92d7"}], "stats": {"total": 11, "additions": 9, "deletions": 2}, "files": [{"sha": "42f77b5cbc0ed54667481ef12503134f62b2e33d", "filename": "CONTRIBUTING.md", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/69a4eaa1871a288968d3fcfa10e9a9612669fd9c/CONTRIBUTING.md", "raw_url": "https://github.com/rust-lang/rust/raw/69a4eaa1871a288968d3fcfa10e9a9612669fd9c/CONTRIBUTING.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CONTRIBUTING.md?ref=69a4eaa1871a288968d3fcfa10e9a9612669fd9c", "patch": "@@ -168,11 +168,15 @@ to `.vscode/settings.json` in your local Miri clone:\n         \"./cargo-miri/Cargo.toml\"\n     ],\n     \"rust-analyzer.checkOnSave.overrideCommand\": [\n+        \"env\",\n+        \"MIRI_AUTO_OPS=no\",\n         \"./miri\",\n         \"check\",\n         \"--message-format=json\"\n     ],\n     \"rust-analyzer.buildScripts.overrideCommand\": [\n+        \"env\",\n+        \"MIRI_AUTO_OPS=no\",\n         \"./miri\",\n         \"check\",\n         \"--message-format=json\","}, {"sha": "2214bcf4c59cb4cc62de2db1bef1a4aca0e95200", "filename": "README.md", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/69a4eaa1871a288968d3fcfa10e9a9612669fd9c/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/69a4eaa1871a288968d3fcfa10e9a9612669fd9c/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=69a4eaa1871a288968d3fcfa10e9a9612669fd9c", "patch": "@@ -393,6 +393,9 @@ Some native rustc `-Z` flags are also very relevant for Miri:\n \n Moreover, Miri recognizes some environment variables:\n \n+* `MIRI_AUTO_OPS` indicates whether the automatic execution of rustfmt, clippy and rustup-toolchain\n+  should be skipped. If it is set to any value, they are skipped. This is used for avoiding\n+  infinite recursion in `./miri` and to allow automated IDE actions to avoid the auto ops.\n * `MIRI_LOG`, `MIRI_BACKTRACE` control logging and backtrace printing during\n   Miri executions, also [see \"Testing the Miri driver\" in `CONTRIBUTING.md`][testing-miri].\n * `MIRIFLAGS` (recognized by `cargo miri` and the test suite) defines extra"}, {"sha": "463e4607baedbb89f8e40557a9c39839c76390e1", "filename": "miri", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/69a4eaa1871a288968d3fcfa10e9a9612669fd9c/miri", "raw_url": "https://github.com/rust-lang/rust/raw/69a4eaa1871a288968d3fcfa10e9a9612669fd9c/miri", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/miri?ref=69a4eaa1871a288968d3fcfa10e9a9612669fd9c", "patch": "@@ -53,8 +53,8 @@ EOF\n MIRIDIR=$(python3 -c 'import os, sys; print(os.path.dirname(os.path.realpath(sys.argv[1])))' \"$0\")\n \n ## Run the auto-things.\n-if [ -z \"$AUTO_OPS\" ]; then\n-    export AUTO_OPS=42\n+if [ -z \"$MIRI_AUTO_OPS\" ]; then\n+    export MIRI_AUTO_OPS=42\n \n     # Run this first, so that the toolchain doesn't change after\n     # other code has run."}]}