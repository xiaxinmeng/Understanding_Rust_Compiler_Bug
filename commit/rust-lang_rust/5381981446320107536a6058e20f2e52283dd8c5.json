{"sha": "5381981446320107536a6058e20f2e52283dd8c5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUzODE5ODE0NDYzMjAxMDc1MzZhNjA1OGUyMGYyZTUyMjgzZGQ4YzU=", "commit": {"author": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2016-07-07T09:21:18Z"}, "committer": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2016-07-07T09:21:18Z"}, "message": "shrink_to_fit some vectors to prevent interpreted code from passing the memory limits", "tree": {"sha": "e56d47392a82d2ebf26d43333557e36eb7ec0982", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e56d47392a82d2ebf26d43333557e36eb7ec0982"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5381981446320107536a6058e20f2e52283dd8c5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJXfh8OAAoJEFbW7qD8Z6xG7/8QAJmqY75NXurhMsUw4zKPCcEz\nHrXSOZpAz4Rxqj2WT9pfkBANOGlUakYA5197dKmUb1Qu3qoH+Fcexr3HJ4dnyicq\nYLLaPROESJO8bX7iycuatKad8iOj7vczuRKzyoFQzxuDSzycpyXDCNgYN0TjrUxg\nwdzfLa6lmCeSFvPmaraamCiwkVdEFfOR7iCI+nNyDV7dAnNAbHnl0u0M5IrFL2rc\niDPkgdT+8U5IvHvfs8cM1ebQYSQP0B7Xsq1hqu2pFNdvN8vGpr99w8Nq5s28w3yS\nZh8AiQzkSYrLVo4VKQILJZEvkpJoCSD1f6eKlHUl07VUmc295T8z/g738yKiPwZk\nw5FAvwWVZgo1phhkKfuwj31FT7M+7o5oviocMglTPv3VmCraF3VrUhNpc5HaP7t2\nhWr20lZJ3zt9mn9b3M9pg1bLmOK7QBtd2qVhhSAstLykgiQQbuE9mlW02UVN3TVm\n/kvhQLfgnZEbnt0hDtOBgrSM1quVMm3NyPVrfgKJvKan9UTXqyHzaQ3aDrOgtOI2\n9ZxgfUGPP8NB2krWuBck1Llv+9WQAfAvG1prGYa/WjOhU5F3YdEhz6jIK3qyg0dJ\nLbfofrzAL1PhvGemRF1JJL7wodZGQwnX6gkQ/uGy+/OFKWEAPyn/Rmh6LGLV/IOw\nrY0bbElPc6xA7TpXnr+V\n=hBIl\n-----END PGP SIGNATURE-----", "payload": "tree e56d47392a82d2ebf26d43333557e36eb7ec0982\nparent 8d3817cfc63674db308e56371ed8f1cc32af4d92\nauthor Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1467883278 +0200\ncommitter Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1467883278 +0200\n\nshrink_to_fit some vectors to prevent interpreted code from passing the memory limits"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5381981446320107536a6058e20f2e52283dd8c5", "html_url": "https://github.com/rust-lang/rust/commit/5381981446320107536a6058e20f2e52283dd8c5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5381981446320107536a6058e20f2e52283dd8c5/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d3817cfc63674db308e56371ed8f1cc32af4d92", "url": "https://api.github.com/repos/rust-lang/rust/commits/8d3817cfc63674db308e56371ed8f1cc32af4d92", "html_url": "https://github.com/rust-lang/rust/commit/8d3817cfc63674db308e56371ed8f1cc32af4d92"}], "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "f7ee6b61e5acd9473f73d9536d22f01ce6d2706f", "filename": "src/memory.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5381981446320107536a6058e20f2e52283dd8c5/src%2Fmemory.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5381981446320107536a6058e20f2e52283dd8c5/src%2Fmemory.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmemory.rs?ref=5381981446320107536a6058e20f2e52283dd8c5", "patch": "@@ -179,12 +179,11 @@ impl<'a, 'tcx> Memory<'a, 'tcx> {\n             alloc.bytes.extend(iter::repeat(0).take(amount));\n             alloc.undef_mask.grow(amount, false);\n         } else if size > new_size {\n-            // it's possible to cause miri to use arbitrary amounts of memory that aren't detectable\n-            // through the memory_usage value, by allocating a lot and reallocating to zero\n             self.memory_usage -= size - new_size;\n             self.clear_relocations(ptr.offset(new_size as isize), size - new_size)?;\n             let alloc = self.get_mut(ptr.alloc_id)?;\n             alloc.bytes.truncate(new_size);\n+            alloc.bytes.shrink_to_fit();\n             alloc.undef_mask.truncate(new_size);\n         }\n \n@@ -676,6 +675,7 @@ impl UndefMask {\n     fn truncate(&mut self, length: usize) {\n         self.len = length;\n         self.blocks.truncate(self.len / BLOCK_SIZE + 1);\n+        self.blocks.shrink_to_fit();\n     }\n }\n "}]}