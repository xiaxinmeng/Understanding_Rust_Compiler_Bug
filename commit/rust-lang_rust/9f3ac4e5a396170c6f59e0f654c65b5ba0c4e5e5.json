{"sha": "9f3ac4e5a396170c6f59e0f654c65b5ba0c4e5e5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmM2FjNGU1YTM5NjE3MGM2ZjU5ZTBmNjU0YzY1YjViYTBjNGU1ZTU=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-10-17T06:18:05Z"}, "committer": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-10-17T06:18:05Z"}, "message": "RIIR update_lints: Update changelog links\n\nThis now also updates the link list at the bottom of the changelog.", "tree": {"sha": "b66e353588b44c52ee3532afb37ca8525bf5296c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b66e353588b44c52ee3532afb37ca8525bf5296c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9f3ac4e5a396170c6f59e0f654c65b5ba0c4e5e5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEvUKv4zqIn2RHUgCKtvoGpuDiZlsFAlvG1IUACgkQtvoGpuDi\nZluP2BAAhpf+NjuRDXhp2Fg0N31h5ScLSSD3hB67p9jhgvvmB8xMSkonpknCv0mu\nWCuSnsBBkLiO5LBzr4w722S15YRyFp6g0lO6ZTc2riQzCG4Rz30vrfOXRBKaU3wo\nkNwIZFqunbznQLgXpzQ2mD0G2HFeCr4Q2TEf7MDDKiesYUOtIamknVMZFST8AszL\nhJ2PjAMPXfnCNe4yPeNH3ghA3GLGmpe2fWuXzs4EodOqeQTY7pU3UvRIPeeLdEKc\nQin5Rvwplz5avuYqtRR9i9V/jzL+vndZr6SrwVclK30KQsoy2bI+pnbZAIG+/SCe\n24pVd/KC+eBRyReFl2q4Ph8tK3aBKau1HAsysnVZe6WmrNk0ChCTfQ083lUxVaP7\nxsukPqwPcdCcLCcN94jcQkDTm9MPIP6ZJrUWCiHJSbq9hBRBgpNSeLo2sThvwpR0\nm8cf58rhLAj39c0ctw7CIuEcrXOkuyVrbmDzCUSGvDUjD+vEGxx4siQpoTh8NlDa\nVFtVPBa+iHVGhmKDVuOoY6r3M3bUDMwq0ELViy8uRoAWegDLMLz9SEfUAyMdIqJ6\nS8rwFmuCCldLWkUQSoUy+OlipDVzVFGXfgNie4wFcQSjQCLbBWuBOHu95dpbKKlq\nP/8HmawbUIECKc3MMadUC4aJEUmth4Dqsvzky0D8YRXdzkGgV6E=\n=ZXlO\n-----END PGP SIGNATURE-----", "payload": "tree b66e353588b44c52ee3532afb37ca8525bf5296c\nparent 284c63e84d21a844c0cbe6fc9d227f381f1b5130\nauthor Philipp Hansch <dev@phansch.net> 1539757085 +0200\ncommitter Philipp Hansch <dev@phansch.net> 1539757085 +0200\n\nRIIR update_lints: Update changelog links\n\nThis now also updates the link list at the bottom of the changelog.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9f3ac4e5a396170c6f59e0f654c65b5ba0c4e5e5", "html_url": "https://github.com/rust-lang/rust/commit/9f3ac4e5a396170c6f59e0f654c65b5ba0c4e5e5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9f3ac4e5a396170c6f59e0f654c65b5ba0c4e5e5/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "284c63e84d21a844c0cbe6fc9d227f381f1b5130", "url": "https://api.github.com/repos/rust-lang/rust/commits/284c63e84d21a844c0cbe6fc9d227f381f1b5130", "html_url": "https://github.com/rust-lang/rust/commit/284c63e84d21a844c0cbe6fc9d227f381f1b5130"}], "stats": {"total": 44, "additions": 41, "deletions": 3}, "files": [{"sha": "773512333815e2104e7f8bfab49c0d212e7dbddc", "filename": "clippy_dev/src/lib.rs", "status": "modified", "additions": 31, "deletions": 1, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/9f3ac4e5a396170c6f59e0f654c65b5ba0c4e5e5/clippy_dev%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f3ac4e5a396170c6f59e0f654c65b5ba0c4e5e5/clippy_dev%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Flib.rs?ref=9f3ac4e5a396170c6f59e0f654c65b5ba0c4e5e5", "patch": "@@ -59,13 +59,29 @@ impl Lint {\n \n     /// Returns all non-deprecated lints and non-internal lints\n     pub fn usable_lints(lints: impl Iterator<Item=Self>) -> impl Iterator<Item=Self> {\n-        lints.filter(|l| l.deprecation.is_none() && !l.group.starts_with(\"internal\"))\n+        lints.filter(|l| l.deprecation.is_none() && !l.is_internal())\n     }\n \n     /// Returns the lints in a HashMap, grouped by the different lint groups\n     pub fn by_lint_group(lints: &[Self]) -> HashMap<String, Vec<Self>> {\n         lints.iter().map(|lint| (lint.group.to_string(), lint.clone())).into_group_map()\n     }\n+\n+    pub fn is_internal(&self) -> bool {\n+        self.group.starts_with(\"internal\")\n+    }\n+}\n+\n+pub fn gen_changelog_lint_list(lints: Vec<Lint>) -> Vec<String> {\n+    let mut lint_list_sorted: Vec<Lint> = lints;\n+    lint_list_sorted.sort_by_key(|l| l.name.clone());\n+    lint_list_sorted\n+        .iter()\n+        .filter(|l| !l.is_internal())\n+        .map(|l| {\n+            format!(\"[`{}`]: {}#{}\", l.name, DOCS_LINK.clone(), l.name)\n+        })\n+        .collect()\n }\n \n /// Gathers all files in `src/clippy_lints` and gathers all lints inside\n@@ -291,3 +307,17 @@ fn test_by_lint_group() {\n     ]);\n     assert_eq!(expected, Lint::by_lint_group(&lints));\n }\n+\n+#[test]\n+fn test_gen_changelog_lint_list() {\n+    let lints = vec![\n+        Lint::new(\"should_assert_eq\", \"group1\", \"abc\", None, \"module_name\"),\n+        Lint::new(\"should_assert_eq2\", \"group2\", \"abc\", None, \"module_name\"),\n+        Lint::new(\"incorrect_internal\", \"internal_style\", \"abc\", None, \"module_name\"),\n+    ];\n+    let expected = vec![\n+        format!(\"[`should_assert_eq`]: {}#should_assert_eq\", DOCS_LINK.to_string()),\n+        format!(\"[`should_assert_eq2`]: {}#should_assert_eq2\", DOCS_LINK.to_string())\n+    ];\n+    assert_eq!(expected, gen_changelog_lint_list(lints));\n+}"}, {"sha": "8769ee6b8103eb9b7a4e69f072f48f7893b6b6e6", "filename": "clippy_dev/src/main.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9f3ac4e5a396170c6f59e0f654c65b5ba0c4e5e5/clippy_dev%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f3ac4e5a396170c6f59e0f654c65b5ba0c4e5e5/clippy_dev%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fmain.rs?ref=9f3ac4e5a396170c6f59e0f654c65b5ba0c4e5e5", "patch": "@@ -59,8 +59,8 @@ fn print_lints() {\n }\n \n fn update_lints() {\n-    let lint_list = gather_all();\n-    let usable_lints: Vec<Lint> = Lint::usable_lints(lint_list).collect();\n+    let lint_list: Vec<Lint> = gather_all().collect();\n+    let usable_lints: Vec<Lint> = Lint::usable_lints(lint_list.clone().into_iter()).collect();\n     let lint_count = usable_lints.len();\n \n     replace_region_in_file(\n@@ -74,4 +74,12 @@ fn update_lints() {\n             ]\n         }\n     );\n+\n+    replace_region_in_file(\n+        \"../CHANGELOG.md\",\n+        \"<!-- begin autogenerated links to lint list -->\",\n+        \"<!-- end autogenerated links to lint list -->\",\n+        false,\n+        || { gen_changelog_lint_list(lint_list.clone()) }\n+    );\n }"}]}