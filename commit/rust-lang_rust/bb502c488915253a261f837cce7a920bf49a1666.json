{"sha": "bb502c488915253a261f837cce7a920bf49a1666", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJiNTAyYzQ4ODkxNTI1M2EyNjFmODM3Y2NlN2E5MjBiZjQ5YTE2NjY=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2021-04-08T22:54:26Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2021-04-08T22:54:26Z"}, "message": "Provide verbose suggestion for new output type", "tree": {"sha": "b0f78d38d26931e448686421df84c6549d7cd769", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b0f78d38d26931e448686421df84c6549d7cd769"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bb502c488915253a261f837cce7a920bf49a1666", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bb502c488915253a261f837cce7a920bf49a1666", "html_url": "https://github.com/rust-lang/rust/commit/bb502c488915253a261f837cce7a920bf49a1666", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bb502c488915253a261f837cce7a920bf49a1666/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5af3dec59f3dba741ce17cb3fcea6ddfaf058f6c", "url": "https://api.github.com/repos/rust-lang/rust/commits/5af3dec59f3dba741ce17cb3fcea6ddfaf058f6c", "html_url": "https://github.com/rust-lang/rust/commit/5af3dec59f3dba741ce17cb3fcea6ddfaf058f6c"}], "stats": {"total": 25, "additions": 12, "deletions": 13}, "files": [{"sha": "60ca562f9920068d44fc8e5635a65b7ed0a4652b", "filename": "compiler/rustc_typeck/src/check/compare_method.rs", "status": "modified", "additions": 7, "deletions": 9, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/bb502c488915253a261f837cce7a920bf49a1666/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bb502c488915253a261f837cce7a920bf49a1666/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs?ref=bb502c488915253a261f837cce7a920bf49a1666", "patch": "@@ -338,20 +338,18 @@ fn compare_predicate_entailment<'tcx>(\n                             ImplItemKind::Fn(ref sig, _)\n                                 if sig.header.asyncness == hir::IsAsync::NotAsync =>\n                             {\n-                                let (span, sugg) = match sig.decl.output {\n+                                let msg = \"change the output type to match the trait\";\n+                                let ap = Applicability::MachineApplicable;\n+                                match sig.decl.output {\n                                     hir::FnRetTy::DefaultReturn(sp) => {\n-                                        (sp, format!(\" -> {} \", trait_sig.output()))\n+                                        let sugg = format!(\"-> {} \", trait_sig.output());\n+                                        diag.span_suggestion_verbose(sp, msg, sugg, ap);\n                                     }\n                                     hir::FnRetTy::Return(hir_ty) => {\n-                                        (hir_ty.span, trait_sig.output().to_string())\n+                                        let sugg = trait_sig.output().to_string();\n+                                        diag.span_suggestion(hir_ty.span, msg, sugg, ap);\n                                     }\n                                 };\n-                                diag.span_suggestion(\n-                                    span,\n-                                    \"change the output type to match the trait\",\n-                                    sugg,\n-                                    Applicability::MachineApplicable,\n-                                );\n                             }\n                             _ => {}\n                         };"}, {"sha": "76f91fbf241d030c36065d5acd923aa1bfa0f67e", "filename": "src/test/ui/compare-method/bad-self-type.stderr", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/bb502c488915253a261f837cce7a920bf49a1666/src%2Ftest%2Fui%2Fcompare-method%2Fbad-self-type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bb502c488915253a261f837cce7a920bf49a1666/src%2Ftest%2Fui%2Fcompare-method%2Fbad-self-type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fcompare-method%2Fbad-self-type.stderr?ref=bb502c488915253a261f837cce7a920bf49a1666", "patch": "@@ -32,13 +32,14 @@ LL |     fn bar(self) -> Option<()>;\n    |                     ---------- type in trait\n ...\n LL |     fn bar(self) {}\n-   |                  ^\n-   |                  |\n-   |                  expected enum `Option`, found `()`\n-   |                  help: change the output type to match the trait: `-> Option<()>`\n+   |                  ^ expected enum `Option`, found `()`\n    |\n    = note: expected fn pointer `fn(MyFuture) -> Option<()>`\n               found fn pointer `fn(MyFuture)`\n+help: change the output type to match the trait\n+   |\n+LL |     fn bar(self) -> Option<()> {}\n+   |                  ^^^^^^^^^^^^^\n \n error: aborting due to 3 previous errors\n "}]}