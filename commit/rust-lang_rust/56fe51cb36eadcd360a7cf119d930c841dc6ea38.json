{"sha": "56fe51cb36eadcd360a7cf119d930c841dc6ea38", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU2ZmU1MWNiMzZlYWRjZDM2MGE3Y2YxMTlkOTMwYzg0MWRjNmVhMzg=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-03-21T09:05:22Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2021-03-21T09:05:22Z"}, "message": "Update Cranelift", "tree": {"sha": "b5581d64608d9c78f7e0bbb0ef49ac02cc78fd55", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b5581d64608d9c78f7e0bbb0ef49ac02cc78fd55"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/56fe51cb36eadcd360a7cf119d930c841dc6ea38", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/56fe51cb36eadcd360a7cf119d930c841dc6ea38", "html_url": "https://github.com/rust-lang/rust/commit/56fe51cb36eadcd360a7cf119d930c841dc6ea38", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/56fe51cb36eadcd360a7cf119d930c841dc6ea38/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7bd3950831bde1f8d4910e9435cf0c423e1a6772", "url": "https://api.github.com/repos/rust-lang/rust/commits/7bd3950831bde1f8d4910e9435cf0c423e1a6772", "html_url": "https://github.com/rust-lang/rust/commit/7bd3950831bde1f8d4910e9435cf0c423e1a6772"}], "stats": {"total": 61, "additions": 31, "deletions": 30}, "files": [{"sha": "3cb67032aaa24b9ae68ca5254439904710a2819c", "filename": "Cargo.lock", "status": "modified", "additions": 20, "deletions": 20, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/56fe51cb36eadcd360a7cf119d930c841dc6ea38/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/56fe51cb36eadcd360a7cf119d930c841dc6ea38/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=56fe51cb36eadcd360a7cf119d930c841dc6ea38", "patch": "@@ -39,16 +39,16 @@ checksum = \"baf1de4339761588bc0619e3cbc0120ee582ebb74b53b4efbf79117bd2da40fd\"\n \n [[package]]\n name = \"cranelift-bforest\"\n-version = \"0.71.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#df6812b8559c35230d44c6d6f94a83b2b97b5de3\"\n+version = \"0.72.0\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#8e43e96410a14143d368273cf1e708f8094bb8e0\"\n dependencies = [\n  \"cranelift-entity\",\n ]\n \n [[package]]\n name = \"cranelift-codegen\"\n-version = \"0.71.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#df6812b8559c35230d44c6d6f94a83b2b97b5de3\"\n+version = \"0.72.0\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#8e43e96410a14143d368273cf1e708f8094bb8e0\"\n dependencies = [\n  \"byteorder\",\n  \"cranelift-bforest\",\n@@ -65,27 +65,27 @@ dependencies = [\n \n [[package]]\n name = \"cranelift-codegen-meta\"\n-version = \"0.71.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#df6812b8559c35230d44c6d6f94a83b2b97b5de3\"\n+version = \"0.72.0\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#8e43e96410a14143d368273cf1e708f8094bb8e0\"\n dependencies = [\n  \"cranelift-codegen-shared\",\n  \"cranelift-entity\",\n ]\n \n [[package]]\n name = \"cranelift-codegen-shared\"\n-version = \"0.71.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#df6812b8559c35230d44c6d6f94a83b2b97b5de3\"\n+version = \"0.72.0\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#8e43e96410a14143d368273cf1e708f8094bb8e0\"\n \n [[package]]\n name = \"cranelift-entity\"\n-version = \"0.71.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#df6812b8559c35230d44c6d6f94a83b2b97b5de3\"\n+version = \"0.72.0\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#8e43e96410a14143d368273cf1e708f8094bb8e0\"\n \n [[package]]\n name = \"cranelift-frontend\"\n-version = \"0.71.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#df6812b8559c35230d44c6d6f94a83b2b97b5de3\"\n+version = \"0.72.0\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#8e43e96410a14143d368273cf1e708f8094bb8e0\"\n dependencies = [\n  \"cranelift-codegen\",\n  \"log\",\n@@ -95,8 +95,8 @@ dependencies = [\n \n [[package]]\n name = \"cranelift-jit\"\n-version = \"0.71.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#df6812b8559c35230d44c6d6f94a83b2b97b5de3\"\n+version = \"0.72.0\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#8e43e96410a14143d368273cf1e708f8094bb8e0\"\n dependencies = [\n  \"anyhow\",\n  \"cranelift-codegen\",\n@@ -113,8 +113,8 @@ dependencies = [\n \n [[package]]\n name = \"cranelift-module\"\n-version = \"0.71.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#df6812b8559c35230d44c6d6f94a83b2b97b5de3\"\n+version = \"0.72.0\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#8e43e96410a14143d368273cf1e708f8094bb8e0\"\n dependencies = [\n  \"anyhow\",\n  \"cranelift-codegen\",\n@@ -125,17 +125,17 @@ dependencies = [\n \n [[package]]\n name = \"cranelift-native\"\n-version = \"0.71.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#df6812b8559c35230d44c6d6f94a83b2b97b5de3\"\n+version = \"0.72.0\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#8e43e96410a14143d368273cf1e708f8094bb8e0\"\n dependencies = [\n  \"cranelift-codegen\",\n  \"target-lexicon\",\n ]\n \n [[package]]\n name = \"cranelift-object\"\n-version = \"0.71.0\"\n-source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#df6812b8559c35230d44c6d6f94a83b2b97b5de3\"\n+version = \"0.72.0\"\n+source = \"git+https://github.com/bytecodealliance/wasmtime/?branch=main#8e43e96410a14143d368273cf1e708f8094bb8e0\"\n dependencies = [\n  \"anyhow\",\n  \"cranelift-codegen\","}, {"sha": "f60645a9f97bc9eed7559924b480ff6d2de29427", "filename": "src/allocator.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/56fe51cb36eadcd360a7cf119d930c841dc6ea38/src%2Fallocator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/56fe51cb36eadcd360a7cf119d930c841dc6ea38/src%2Fallocator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fallocator.rs?ref=56fe51cb36eadcd360a7cf119d930c841dc6ea38", "patch": "@@ -3,6 +3,7 @@\n \n use crate::prelude::*;\n \n+use cranelift_codegen::binemit::{NullStackMapSink, NullTrapSink};\n use rustc_ast::expand::allocator::{AllocatorKind, AllocatorTy, ALLOCATOR_METHODS};\n use rustc_span::symbol::sym;\n \n@@ -92,7 +93,7 @@ fn codegen_inner(\n             bcx.finalize();\n         }\n         module\n-            .define_function(func_id, &mut ctx, &mut cranelift_codegen::binemit::NullTrapSink {})\n+            .define_function(func_id, &mut ctx, &mut NullTrapSink {}, &mut NullStackMapSink {})\n             .unwrap();\n         unwind_context.add_function(func_id, &ctx, module.isa());\n     }\n@@ -132,7 +133,7 @@ fn codegen_inner(\n         bcx.finalize();\n     }\n     module\n-        .define_function(func_id, &mut ctx, &mut cranelift_codegen::binemit::NullTrapSink {})\n+        .define_function(func_id, &mut ctx, &mut NullTrapSink {}, &mut NullStackMapSink {})\n         .unwrap();\n     unwind_context.add_function(func_id, &ctx, module.isa());\n }"}, {"sha": "8c14e04eeebf55e95f2fa0655825c7bc6029890f", "filename": "src/base.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/56fe51cb36eadcd360a7cf119d930c841dc6ea38/src%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/56fe51cb36eadcd360a7cf119d930c841dc6ea38/src%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbase.rs?ref=56fe51cb36eadcd360a7cf119d930c841dc6ea38", "patch": "@@ -1,5 +1,6 @@\n //! Codegen of a single function\n \n+use cranelift_codegen::binemit::{NullStackMapSink, NullTrapSink};\n use rustc_index::vec::IndexVec;\n use rustc_middle::ty::adjustment::PointerCast;\n use rustc_middle::ty::layout::FnAbiExt;\n@@ -131,7 +132,7 @@ pub(crate) fn codegen_fn<'tcx>(\n     let module = &mut cx.module;\n     tcx.sess.time(\"define function\", || {\n         module\n-            .define_function(func_id, context, &mut cranelift_codegen::binemit::NullTrapSink {})\n+            .define_function(func_id, context, &mut NullTrapSink {}, &mut NullStackMapSink {})\n             .unwrap()\n     });\n "}, {"sha": "1b08b4169132daa254c47041b84420502d5990af", "filename": "src/driver/jit.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/56fe51cb36eadcd360a7cf119d930c841dc6ea38/src%2Fdriver%2Fjit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/56fe51cb36eadcd360a7cf119d930c841dc6ea38/src%2Fdriver%2Fjit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdriver%2Fjit.rs?ref=56fe51cb36eadcd360a7cf119d930c841dc6ea38", "patch": "@@ -5,6 +5,7 @@ use std::cell::RefCell;\n use std::ffi::CString;\n use std::os::raw::{c_char, c_int};\n \n+use cranelift_codegen::binemit::{NullStackMapSink, NullTrapSink};\n use rustc_codegen_ssa::CrateInfo;\n use rustc_middle::mir::mono::MonoItem;\n use rustc_session::config::EntryFnType;\n@@ -297,7 +298,8 @@ fn codegen_shim<'tcx>(cx: &mut CodegenCx<'_, 'tcx>, inst: Instance<'tcx>) {\n         .define_function(\n             func_id,\n             &mut Context::for_function(trampoline),\n-            &mut cranelift_codegen::binemit::NullTrapSink {},\n+            &mut NullTrapSink {},\n+            &mut NullStackMapSink {},\n         )\n         .unwrap();\n }"}, {"sha": "a6266f507765fdf663f9ab1b4525d12115a00cfd", "filename": "src/main_shim.rs", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/56fe51cb36eadcd360a7cf119d930c841dc6ea38/src%2Fmain_shim.rs", "raw_url": "https://github.com/rust-lang/rust/raw/56fe51cb36eadcd360a7cf119d930c841dc6ea38/src%2Fmain_shim.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmain_shim.rs?ref=56fe51cb36eadcd360a7cf119d930c841dc6ea38", "patch": "@@ -1,3 +1,4 @@\n+use cranelift_codegen::binemit::{NullStackMapSink, NullTrapSink};\n use rustc_hir::LangItem;\n use rustc_session::config::EntryFnType;\n \n@@ -100,12 +101,8 @@ pub(crate) fn maybe_create_entry_wrapper(\n             bcx.seal_all_blocks();\n             bcx.finalize();\n         }\n-        m.define_function(\n-            cmain_func_id,\n-            &mut ctx,\n-            &mut cranelift_codegen::binemit::NullTrapSink {},\n-        )\n-        .unwrap();\n+        m.define_function(cmain_func_id, &mut ctx, &mut NullTrapSink {}, &mut NullStackMapSink {})\n+            .unwrap();\n         unwind_context.add_function(cmain_func_id, &ctx, m.isa());\n     }\n }"}]}