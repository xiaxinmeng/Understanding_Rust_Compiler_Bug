{"sha": "95d239da99cb1b7ba60f5f20f6df54e1397a1bca", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk1ZDIzOWRhOTljYjFiN2JhNjBmNWYyMGY2ZGY1NGUxMzk3YTFiY2E=", "commit": {"author": {"name": "Arnaud", "email": "arnaud.golfouse@laposte.net", "date": "2021-02-15T17:11:10Z"}, "committer": {"name": "Arnaud", "email": "arnaud.golfouse@laposte.net", "date": "2021-02-15T17:33:12Z"}, "message": "Specialization for async traits", "tree": {"sha": "b50dcd82f35b524ec86b8a95bf64dda9b1e8efd1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b50dcd82f35b524ec86b8a95bf64dda9b1e8efd1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/95d239da99cb1b7ba60f5f20f6df54e1397a1bca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/95d239da99cb1b7ba60f5f20f6df54e1397a1bca", "html_url": "https://github.com/rust-lang/rust/commit/95d239da99cb1b7ba60f5f20f6df54e1397a1bca", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/95d239da99cb1b7ba60f5f20f6df54e1397a1bca/comments", "author": {"login": "arnaudgolfouse", "id": 53786772, "node_id": "MDQ6VXNlcjUzNzg2Nzcy", "avatar_url": "https://avatars.githubusercontent.com/u/53786772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arnaudgolfouse", "html_url": "https://github.com/arnaudgolfouse", "followers_url": "https://api.github.com/users/arnaudgolfouse/followers", "following_url": "https://api.github.com/users/arnaudgolfouse/following{/other_user}", "gists_url": "https://api.github.com/users/arnaudgolfouse/gists{/gist_id}", "starred_url": "https://api.github.com/users/arnaudgolfouse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arnaudgolfouse/subscriptions", "organizations_url": "https://api.github.com/users/arnaudgolfouse/orgs", "repos_url": "https://api.github.com/users/arnaudgolfouse/repos", "events_url": "https://api.github.com/users/arnaudgolfouse/events{/privacy}", "received_events_url": "https://api.github.com/users/arnaudgolfouse/received_events", "type": "User", "site_admin": false}, "committer": {"login": "arnaudgolfouse", "id": 53786772, "node_id": "MDQ6VXNlcjUzNzg2Nzcy", "avatar_url": "https://avatars.githubusercontent.com/u/53786772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arnaudgolfouse", "html_url": "https://github.com/arnaudgolfouse", "followers_url": "https://api.github.com/users/arnaudgolfouse/followers", "following_url": "https://api.github.com/users/arnaudgolfouse/following{/other_user}", "gists_url": "https://api.github.com/users/arnaudgolfouse/gists{/gist_id}", "starred_url": "https://api.github.com/users/arnaudgolfouse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arnaudgolfouse/subscriptions", "organizations_url": "https://api.github.com/users/arnaudgolfouse/orgs", "repos_url": "https://api.github.com/users/arnaudgolfouse/repos", "events_url": "https://api.github.com/users/arnaudgolfouse/events{/privacy}", "received_events_url": "https://api.github.com/users/arnaudgolfouse/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "00d5a9563af9c84cdea9d029a9583be0513cc459", "url": "https://api.github.com/repos/rust-lang/rust/commits/00d5a9563af9c84cdea9d029a9583be0513cc459", "html_url": "https://github.com/rust-lang/rust/commit/00d5a9563af9c84cdea9d029a9583be0513cc459"}], "stats": {"total": 116, "additions": 116, "deletions": 0}, "files": [{"sha": "adec74ef3dc2a54c93ae72bc794dca68814b8f27", "filename": "crates/parser/src/grammar/items.rs", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/95d239da99cb1b7ba60f5f20f6df54e1397a1bca/crates%2Fparser%2Fsrc%2Fgrammar%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/95d239da99cb1b7ba60f5f20f6df54e1397a1bca/crates%2Fparser%2Fsrc%2Fgrammar%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Fsrc%2Fgrammar%2Fitems.rs?ref=95d239da99cb1b7ba60f5f20f6df54e1397a1bca", "patch": "@@ -83,6 +83,7 @@ pub(super) fn item_or_macro(p: &mut Parser, stop_on_r_curly: bool) {\n     }\n }\n \n+/// Try to parse an item, completing `m` in case of success.\n pub(super) fn maybe_item(p: &mut Parser, m: Marker) -> Result<(), Marker> {\n     // test_err pub_expr\n     // fn foo() { pub 92; }\n@@ -143,6 +144,33 @@ pub(super) fn maybe_item(p: &mut Parser, m: Marker) -> Result<(), Marker> {\n                     has_mods = true;\n                 }\n             }\n+            T![async] => {\n+                // test default_async_fn\n+                // impl T for Foo {\n+                //     default async fn foo() {}\n+                // }\n+\n+                // test default_async_unsafe_fn\n+                // impl T for Foo {\n+                //     default async unsafe fn foo() {}\n+                // }\n+                let mut maybe_fn = p.nth(2);\n+                let is_unsafe = if matches!(maybe_fn, T![unsafe]) {\n+                    maybe_fn = p.nth(3);\n+                    true\n+                } else {\n+                    false\n+                };\n+\n+                if matches!(maybe_fn, T![fn]) {\n+                    p.bump_remap(T![default]);\n+                    p.bump(T![async]);\n+                    if is_unsafe {\n+                        p.bump(T![unsafe])\n+                    }\n+                    has_mods = true;\n+                }\n+            }\n             _ => (),\n         }\n     }"}, {"sha": "61c17333a4cba8fee5003f2653cd0e2ce85fd5db", "filename": "crates/syntax/test_data/parser/inline/ok/0162_default_async_unsafe_fn.rast", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/95d239da99cb1b7ba60f5f20f6df54e1397a1bca/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0162_default_async_unsafe_fn.rast", "raw_url": "https://github.com/rust-lang/rust/raw/95d239da99cb1b7ba60f5f20f6df54e1397a1bca/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0162_default_async_unsafe_fn.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0162_default_async_unsafe_fn.rast?ref=95d239da99cb1b7ba60f5f20f6df54e1397a1bca", "patch": "@@ -0,0 +1,42 @@\n+SOURCE_FILE@0..56\n+  IMPL@0..55\n+    IMPL_KW@0..4 \"impl\"\n+    WHITESPACE@4..5 \" \"\n+    PATH_TYPE@5..6\n+      PATH@5..6\n+        PATH_SEGMENT@5..6\n+          NAME_REF@5..6\n+            IDENT@5..6 \"T\"\n+    WHITESPACE@6..7 \" \"\n+    FOR_KW@7..10 \"for\"\n+    WHITESPACE@10..11 \" \"\n+    PATH_TYPE@11..14\n+      PATH@11..14\n+        PATH_SEGMENT@11..14\n+          NAME_REF@11..14\n+            IDENT@11..14 \"Foo\"\n+    WHITESPACE@14..15 \" \"\n+    ASSOC_ITEM_LIST@15..55\n+      L_CURLY@15..16 \"{\"\n+      WHITESPACE@16..21 \"\\n    \"\n+      FN@21..53\n+        DEFAULT_KW@21..28 \"default\"\n+        WHITESPACE@28..29 \" \"\n+        ASYNC_KW@29..34 \"async\"\n+        WHITESPACE@34..35 \" \"\n+        UNSAFE_KW@35..41 \"unsafe\"\n+        WHITESPACE@41..42 \" \"\n+        FN_KW@42..44 \"fn\"\n+        WHITESPACE@44..45 \" \"\n+        NAME@45..48\n+          IDENT@45..48 \"foo\"\n+        PARAM_LIST@48..50\n+          L_PAREN@48..49 \"(\"\n+          R_PAREN@49..50 \")\"\n+        WHITESPACE@50..51 \" \"\n+        BLOCK_EXPR@51..53\n+          L_CURLY@51..52 \"{\"\n+          R_CURLY@52..53 \"}\"\n+      WHITESPACE@53..54 \"\\n\"\n+      R_CURLY@54..55 \"}\"\n+  WHITESPACE@55..56 \"\\n\""}, {"sha": "05c20a68fe827f07cea6e08bbf66b4b952237516", "filename": "crates/syntax/test_data/parser/inline/ok/0162_default_async_unsafe_fn.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/95d239da99cb1b7ba60f5f20f6df54e1397a1bca/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0162_default_async_unsafe_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/95d239da99cb1b7ba60f5f20f6df54e1397a1bca/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0162_default_async_unsafe_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0162_default_async_unsafe_fn.rs?ref=95d239da99cb1b7ba60f5f20f6df54e1397a1bca", "patch": "@@ -0,0 +1,3 @@\n+impl T for Foo {\n+    default async unsafe fn foo() {}\n+}"}, {"sha": "9c43ccea5251f3fe8ad19e28263f427bbafb88e4", "filename": "crates/syntax/test_data/parser/inline/ok/0163_default_async_fn.rast", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/95d239da99cb1b7ba60f5f20f6df54e1397a1bca/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_async_fn.rast", "raw_url": "https://github.com/rust-lang/rust/raw/95d239da99cb1b7ba60f5f20f6df54e1397a1bca/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_async_fn.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_async_fn.rast?ref=95d239da99cb1b7ba60f5f20f6df54e1397a1bca", "patch": "@@ -0,0 +1,40 @@\n+SOURCE_FILE@0..49\n+  IMPL@0..48\n+    IMPL_KW@0..4 \"impl\"\n+    WHITESPACE@4..5 \" \"\n+    PATH_TYPE@5..6\n+      PATH@5..6\n+        PATH_SEGMENT@5..6\n+          NAME_REF@5..6\n+            IDENT@5..6 \"T\"\n+    WHITESPACE@6..7 \" \"\n+    FOR_KW@7..10 \"for\"\n+    WHITESPACE@10..11 \" \"\n+    PATH_TYPE@11..14\n+      PATH@11..14\n+        PATH_SEGMENT@11..14\n+          NAME_REF@11..14\n+            IDENT@11..14 \"Foo\"\n+    WHITESPACE@14..15 \" \"\n+    ASSOC_ITEM_LIST@15..48\n+      L_CURLY@15..16 \"{\"\n+      WHITESPACE@16..21 \"\\n    \"\n+      FN@21..46\n+        DEFAULT_KW@21..28 \"default\"\n+        WHITESPACE@28..29 \" \"\n+        ASYNC_KW@29..34 \"async\"\n+        WHITESPACE@34..35 \" \"\n+        FN_KW@35..37 \"fn\"\n+        WHITESPACE@37..38 \" \"\n+        NAME@38..41\n+          IDENT@38..41 \"foo\"\n+        PARAM_LIST@41..43\n+          L_PAREN@41..42 \"(\"\n+          R_PAREN@42..43 \")\"\n+        WHITESPACE@43..44 \" \"\n+        BLOCK_EXPR@44..46\n+          L_CURLY@44..45 \"{\"\n+          R_CURLY@45..46 \"}\"\n+      WHITESPACE@46..47 \"\\n\"\n+      R_CURLY@47..48 \"}\"\n+  WHITESPACE@48..49 \"\\n\""}, {"sha": "78c3b4d85fb28ab5465cd6f718087603d808e13a", "filename": "crates/syntax/test_data/parser/inline/ok/0163_default_async_fn.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/95d239da99cb1b7ba60f5f20f6df54e1397a1bca/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_async_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/95d239da99cb1b7ba60f5f20f6df54e1397a1bca/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_async_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0163_default_async_fn.rs?ref=95d239da99cb1b7ba60f5f20f6df54e1397a1bca", "patch": "@@ -0,0 +1,3 @@\n+impl T for Foo {\n+    default async fn foo() {}\n+}"}]}