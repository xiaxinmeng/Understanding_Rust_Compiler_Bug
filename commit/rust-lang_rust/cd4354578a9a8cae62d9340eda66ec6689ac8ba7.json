{"sha": "cd4354578a9a8cae62d9340eda66ec6689ac8ba7", "node_id": "C_kwDOAAsO6NoAKGNkNDM1NDU3OGE5YThjYWU2MmQ5MzQwZWRhNjZlYzY2ODlhYzhiYTc", "commit": {"author": {"name": "Tamir Duberstein", "email": "tamird@gmail.com", "date": "2023-06-01T17:07:51Z"}, "committer": {"name": "Tamir Duberstein", "email": "tamird@gmail.com", "date": "2023-06-01T17:07:51Z"}, "message": "Avoid passing --cpu-features when empty\n\nAdded in 12ac719b99560072cbe52a957f22d3fe6946cf2a, this logic always\npassed --cpu-features, even when the value was the empty string.", "tree": {"sha": "40f5cd3d3bf84e781b2322b56326a5e0a6433506", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/40f5cd3d3bf84e781b2322b56326a5e0a6433506"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cd4354578a9a8cae62d9340eda66ec6689ac8ba7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN SSH SIGNATURE-----\nU1NIU0lHAAAAAQAAADMAAAALc3NoLWVkMjU1MTkAAAAgtYz36g7iDMSkY5K7Ab51ksGX7h\nJgsMRt+XVZTrIzMVIAAAADZ2l0AAAAAAAAAAZzaGE1MTIAAABTAAAAC3NzaC1lZDI1NTE5\nAAAAQD3+7GlTmIfwVAseRJULfuD1jdqllNLPdDB3zbIWYTnAqCjxfL22YEK2jzTr1yN2Yq\nvjxRVzKisDAq+TcHDsPwA=\n-----END SSH SIGNATURE-----", "payload": "tree 40f5cd3d3bf84e781b2322b56326a5e0a6433506\nparent 642c92e63008ffb49f6ad8344e07bfa7d5b0d9bb\nauthor Tamir Duberstein <tamird@gmail.com> 1685639271 -0400\ncommitter Tamir Duberstein <tamird@gmail.com> 1685639271 -0400\n\nAvoid passing --cpu-features when empty\n\nAdded in 12ac719b99560072cbe52a957f22d3fe6946cf2a, this logic always\npassed --cpu-features, even when the value was the empty string.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cd4354578a9a8cae62d9340eda66ec6689ac8ba7", "html_url": "https://github.com/rust-lang/rust/commit/cd4354578a9a8cae62d9340eda66ec6689ac8ba7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cd4354578a9a8cae62d9340eda66ec6689ac8ba7/comments", "author": {"login": "tamird", "id": 1535036, "node_id": "MDQ6VXNlcjE1MzUwMzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1535036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tamird", "html_url": "https://github.com/tamird", "followers_url": "https://api.github.com/users/tamird/followers", "following_url": "https://api.github.com/users/tamird/following{/other_user}", "gists_url": "https://api.github.com/users/tamird/gists{/gist_id}", "starred_url": "https://api.github.com/users/tamird/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tamird/subscriptions", "organizations_url": "https://api.github.com/users/tamird/orgs", "repos_url": "https://api.github.com/users/tamird/repos", "events_url": "https://api.github.com/users/tamird/events{/privacy}", "received_events_url": "https://api.github.com/users/tamird/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tamird", "id": 1535036, "node_id": "MDQ6VXNlcjE1MzUwMzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1535036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tamird", "html_url": "https://github.com/tamird", "followers_url": "https://api.github.com/users/tamird/followers", "following_url": "https://api.github.com/users/tamird/following{/other_user}", "gists_url": "https://api.github.com/users/tamird/gists{/gist_id}", "starred_url": "https://api.github.com/users/tamird/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tamird/subscriptions", "organizations_url": "https://api.github.com/users/tamird/orgs", "repos_url": "https://api.github.com/users/tamird/repos", "events_url": "https://api.github.com/users/tamird/events{/privacy}", "received_events_url": "https://api.github.com/users/tamird/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "642c92e63008ffb49f6ad8344e07bfa7d5b0d9bb", "url": "https://api.github.com/repos/rust-lang/rust/commits/642c92e63008ffb49f6ad8344e07bfa7d5b0d9bb", "html_url": "https://github.com/rust-lang/rust/commit/642c92e63008ffb49f6ad8344e07bfa7d5b0d9bb"}], "stats": {"total": 12, "additions": 7, "deletions": 5}, "files": [{"sha": "8dbd4456a6b8990ce06f477735f08b091d09be25", "filename": "compiler/rustc_codegen_ssa/src/back/link.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/cd4354578a9a8cae62d9340eda66ec6689ac8ba7/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cd4354578a9a8cae62d9340eda66ec6689ac8ba7/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs?ref=cd4354578a9a8cae62d9340eda66ec6689ac8ba7", "patch": "@@ -2256,11 +2256,13 @@ fn add_order_independent_options(\n     } else if flavor == LinkerFlavor::Bpf {\n         cmd.arg(\"--cpu\");\n         cmd.arg(&codegen_results.crate_info.target_cpu);\n-        cmd.arg(\"--cpu-features\");\n-        cmd.arg(match &sess.opts.cg.target_feature {\n-            feat if !feat.is_empty() => feat.as_ref(),\n-            _ => sess.target.options.features.as_ref(),\n-        });\n+        if let Some(feat) = [sess.opts.cg.target_feature.as_str(), &sess.target.options.features]\n+            .into_iter()\n+            .find(|feat| !feat.is_empty())\n+        {\n+            cmd.arg(\"--cpu-features\");\n+            cmd.arg(feat);\n+        }\n     }\n \n     cmd.linker_plugin_lto();"}]}