{"sha": "d794cb0d4fb795fc67e4e1e34c590d10e7189e76", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ3OTRjYjBkNGZiNzk1ZmM2N2U0ZTFlMzRjNTkwZDEwZTcxODllNzY=", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-03-06T10:25:41Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2021-04-29T19:36:56Z"}, "message": "Introduce a hir_owner_parent query.", "tree": {"sha": "9f6617abc217f1cbcbb4c90d8c6c61437ea50d15", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9f6617abc217f1cbcbb4c90d8c6c61437ea50d15"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d794cb0d4fb795fc67e4e1e34c590d10e7189e76", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d794cb0d4fb795fc67e4e1e34c590d10e7189e76", "html_url": "https://github.com/rust-lang/rust/commit/d794cb0d4fb795fc67e4e1e34c590d10e7189e76", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d794cb0d4fb795fc67e4e1e34c590d10e7189e76/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "18bffdb10e25ebaec6752fe4f18dba77e27a23ed", "url": "https://api.github.com/repos/rust-lang/rust/commits/18bffdb10e25ebaec6752fe4f18dba77e27a23ed", "html_url": "https://github.com/rust-lang/rust/commit/18bffdb10e25ebaec6752fe4f18dba77e27a23ed"}], "stats": {"total": 16, "additions": 14, "deletions": 2}, "files": [{"sha": "73f3b550c3721f32ca5efb7c00d596eb4c28acad", "filename": "compiler/rustc_middle/src/hir/map/mod.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/d794cb0d4fb795fc67e4e1e34c590d10e7189e76/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d794cb0d4fb795fc67e4e1e34c590d10e7189e76/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmap%2Fmod.rs?ref=d794cb0d4fb795fc67e4e1e34c590d10e7189e76", "patch": "@@ -285,8 +285,7 @@ impl<'hir> Map<'hir> {\n \n     pub fn find_parent_node(&self, id: HirId) -> Option<HirId> {\n         if id.local_id == ItemLocalId::from_u32(0) {\n-            let index = self.tcx.index_hir(LOCAL_CRATE);\n-            index.parenting.get(&id.owner).copied()\n+            Some(self.tcx.hir_owner_parent(id.owner))\n         } else {\n             let owner = self.tcx.hir_owner_nodes(id.owner)?;\n             let node = owner.nodes[id.local_id].as_ref()?;"}, {"sha": "565664778e56570975a2c05ac77d6eaa6107bb2a", "filename": "compiler/rustc_middle/src/hir/mod.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d794cb0d4fb795fc67e4e1e34c590d10e7189e76/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d794cb0d4fb795fc67e4e1e34c590d10e7189e76/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fhir%2Fmod.rs?ref=d794cb0d4fb795fc67e4e1e34c590d10e7189e76", "patch": "@@ -129,6 +129,10 @@ pub fn provide(providers: &mut Providers) {\n     providers.hir_module_items = |tcx, id| &tcx.untracked_crate.modules[&id];\n     providers.hir_owner = |tcx, id| tcx.index_hir(LOCAL_CRATE).map[id].signature;\n     providers.hir_owner_nodes = |tcx, id| tcx.index_hir(LOCAL_CRATE).map[id].with_bodies.as_deref();\n+    providers.hir_owner_parent = |tcx, id| {\n+        let index = tcx.index_hir(LOCAL_CRATE);\n+        index.parenting.get(&id).copied().unwrap_or(CRATE_HIR_ID)\n+    };\n     providers.hir_attrs = |tcx, id| AttributeMap { map: &tcx.untracked_crate.attrs, prefix: id };\n     providers.def_span = |tcx, def_id| tcx.hir().span_if_local(def_id).unwrap_or(DUMMY_SP);\n     providers.fn_arg_names = |tcx, id| {"}, {"sha": "e642d038ea3d1a7294195fa48ef87bd35cf28ebb", "filename": "compiler/rustc_middle/src/query/mod.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/d794cb0d4fb795fc67e4e1e34c590d10e7189e76/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d794cb0d4fb795fc67e4e1e34c590d10e7189e76/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fquery%2Fmod.rs?ref=d794cb0d4fb795fc67e4e1e34c590d10e7189e76", "patch": "@@ -52,6 +52,15 @@ rustc_queries! {\n         desc { |tcx| \"HIR owner of `{}`\", tcx.def_path_str(key.to_def_id()) }\n     }\n \n+    /// Gives access to the HIR node's parent for the HIR owner `key`.\n+    ///\n+    /// This can be conveniently accessed by methods on `tcx.hir()`.\n+    /// Avoid calling this query directly.\n+    query hir_owner_parent(key: LocalDefId) -> hir::HirId {\n+        eval_always\n+        desc { |tcx| \"HIR parent of `{}`\", tcx.def_path_str(key.to_def_id()) }\n+    }\n+\n     /// Gives access to the HIR nodes and bodies inside the HIR owner `key`.\n     ///\n     /// This can be conveniently accessed by methods on `tcx.hir()`."}]}