{"sha": "de2d9877dcc6b3a352165b220e4e9fb67f771bab", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRlMmQ5ODc3ZGNjNmIzYTM1MjE2NWIyMjBlNGU5ZmI2N2Y3NzFiYWI=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2020-05-07T21:12:13Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2020-05-07T21:12:13Z"}, "message": "ci: use the latest python available on windows\n\nThis commit changes our Windows CI to always use the latest Python\ninterpreter available in the GHA tool cache instead of hardcoding Python\n3.7.6. This is needed because occasionally GitHub bumps the installed\nversion, deleting the previous one.", "tree": {"sha": "fc8df6465bd9e8ca43283d8f4b84d40e71a107a0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fc8df6465bd9e8ca43283d8f4b84d40e71a107a0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/de2d9877dcc6b3a352165b220e4e9fb67f771bab", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl60ehUACgkQPgar6Auq\n8Zxbgg//ca6X8K/BgV3+cQ92YFbxFHrLNcbpNU6YgHTWvz96yLtS7NcJK3PFr8TN\nHi250MBjiWPY2sRWuPM89YQWmrY0SDypY/VMMm8LqYCJIGaqeGN3UgwPdx2dwQTz\nDb5J7Yn6esaQT2j0Z/dOeoqwwgNj/ATQSuIZ8iRikc+GPehqMgqbJ7hHhD2xQPIi\n5B9ymNeR+wenhct59OdMV68345KHBs2NpmY/HTCQZkOctLm4cKgq++FUqoXQ6dMX\nYceKr4DQ/n3WS6+iPAd80rUyGqybZLxKSEot2kNL6Mayn3EiG3byb1jx8wFIAgma\noR3G54H2Ghqya3kRhIOlkEOSLu99+qK4tEyrnLGte6UmQSSAKMgOmQsKCybCc8th\n5IjhEjEO0mcNX9I0ionmlMfOVYtvh5KXV5q0orkQnlh18Ro6ZqR4a6mswyRKDQ4N\nPaNkQ0w5WE3kxnYSriztEyMVjm52LVZX3IN+11oQvReE0eovjRtCgqOFIMcnGgtE\neNl3xak/za6NqfkJ0QlpXMuV+0GX2AOf7VT7ZC6td21DdxT6vtr/QaUDVd8JnnWp\nUImcn0yfp5X3veG6+iJAp79KpbXAP+fpzF4fMeelkfzUsUqpt9Ap4F91SJofu+vg\nVV5YdPIXp848Rg1bhvVbBpny61cM3+dylmqfV2CeNIdoBz8Df0A=\n=OMTE\n-----END PGP SIGNATURE-----", "payload": "tree fc8df6465bd9e8ca43283d8f4b84d40e71a107a0\nparent 649b6323cd20d4a454264798c189107fd1eda33f\nauthor Pietro Albini <pietro@pietroalbini.org> 1588885933 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1588885933 +0200\n\nci: use the latest python available on windows\n\nThis commit changes our Windows CI to always use the latest Python\ninterpreter available in the GHA tool cache instead of hardcoding Python\n3.7.6. This is needed because occasionally GitHub bumps the installed\nversion, deleting the previous one.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/de2d9877dcc6b3a352165b220e4e9fb67f771bab", "html_url": "https://github.com/rust-lang/rust/commit/de2d9877dcc6b3a352165b220e4e9fb67f771bab", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/de2d9877dcc6b3a352165b220e4e9fb67f771bab/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "649b6323cd20d4a454264798c189107fd1eda33f", "url": "https://api.github.com/repos/rust-lang/rust/commits/649b6323cd20d4a454264798c189107fd1eda33f", "html_url": "https://github.com/rust-lang/rust/commit/649b6323cd20d4a454264798c189107fd1eda33f"}], "stats": {"total": 12, "additions": 10, "deletions": 2}, "files": [{"sha": "ff7479c05d04e5d7821b220646862ea03290bbcf", "filename": "src/ci/scripts/install-msys2-packages.sh", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/de2d9877dcc6b3a352165b220e4e9fb67f771bab/src%2Fci%2Fscripts%2Finstall-msys2-packages.sh", "raw_url": "https://github.com/rust-lang/rust/raw/de2d9877dcc6b3a352165b220e4e9fb67f771bab/src%2Fci%2Fscripts%2Finstall-msys2-packages.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fscripts%2Finstall-msys2-packages.sh?ref=de2d9877dcc6b3a352165b220e4e9fb67f771bab", "patch": "@@ -9,11 +9,19 @@ if isWindows; then\n     pacman -S --noconfirm --needed base-devel ca-certificates make diffutils tar \\\n         binutils\n \n+    # Detect the native Python version installed on the agent. On GitHub\n+    # Actions, the C:\\hostedtoolcache\\windows\\Python directory contains a\n+    # subdirectory for each installed Python version.\n+    #\n+    # The -V flag of the sort command sorts the input by version number.\n+    native_python_version=\"$(ls /c/hostedtoolcache/windows/Python | sort -Vr | head -n 1)\"\n+\n     # Make sure we use the native python interpreter instead of some msys equivalent\n     # one way or another. The msys interpreters seem to have weird path conversions\n     # baked in which break LLVM's build system one way or another, so let's use the\n     # native version which keeps everything as native as possible.\n-    python_home=\"C:/hostedtoolcache/windows/Python/3.7.6/x64\"\n+    python_home=\"/c/hostedtoolcache/windows/Python/${native_python_version}/x64\"\n     cp \"${python_home}/python.exe\" \"${python_home}/python3.exe\"\n-    ciCommandAddPath \"C:\\\\hostedtoolcache\\\\windows\\\\Python\\\\3.7.6\\\\x64\"\n+    ciCommandAddPath \"C:\\\\hostedtoolcache\\\\windows\\\\Python\\\\${native_python_version}\\\\x64\"\n+    ciCommandAddPath \"C:\\\\hostedtoolcache\\\\windows\\\\Python\\\\${native_python_version}\\\\x64\\\\Scripts\"\n fi"}]}