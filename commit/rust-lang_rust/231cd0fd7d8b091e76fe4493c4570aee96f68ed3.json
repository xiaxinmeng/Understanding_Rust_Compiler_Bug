{"sha": "231cd0fd7d8b091e76fe4493c4570aee96f68ed3", "node_id": "C_kwDOAAsO6NoAKDIzMWNkMGZkN2Q4YjA5MWU3NmZlNDQ5M2M0NTcwYWVlOTZmNjhlZDM", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-05-12T14:41:04Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-05-12T14:41:04Z"}, "message": "Rollup merge of #96939 - GuillaumeGomez:settings-css, r=notriddle\n\nFix settings page CSS\n\nIn https://github.com/rust-lang/rust/pull/96741, I moved the CSS loading outside of `settings.js`. The result was that on the settings page, there isn't the settings CSS anymore:\n\n![Screenshot from 2022-05-11 11-09-24](https://user-images.githubusercontent.com/3050060/167817969-6750931b-3e6e-4178-b5a9-ee3851e983be.png)\n\nI also used this opportunity to remove unused CSS rules (we don't have `<select>` elements anymore in the settings).\n\ncc `@jsha`\nr? `@notriddle`", "tree": {"sha": "2b3667f38a05d9314c044a2d672f6412eb53128a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2b3667f38a05d9314c044a2d672f6412eb53128a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/231cd0fd7d8b091e76fe4493c4570aee96f68ed3", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJifRyACRBK7hj4Ov3rIwAAEE0IABtwI+8nkMuszW7pr9lvylt1\n2sfv4Imj0BNpwBthqPEP5ELJK8JlH+hjtfq+5tKYjy3wrJ8/Jg4jWa8fQ77WCJ7W\n3n+9hG4mfASkWw19H/fdwUhCity8DNdeWD7+d6wlZLaUxwSUQY7bzTZGasOdGhqV\nKfkbnvXvzTfEixMqjIfWI7EWuhOxKmPHBGYPzYZfRdk6nlNpOCP4ORLu0+ex75Xp\nOTGocp/bOQG/uZZ5emvyvqnhnJCcyApklgiJFTHM9himAZPvnrQ+GCEnm70tGVQn\nS7ebyldpVXdk/Xn9CuRDybnMaFcpO/0NvaNL0ZYTiLg71/Zle4fyoC3wUSH7NYQ=\n=nU3Q\n-----END PGP SIGNATURE-----\n", "payload": "tree 2b3667f38a05d9314c044a2d672f6412eb53128a\nparent 80e1dec10e989a559a63a85c63339cb2eb553168\nparent dd6bb09133f1f97db6a36024bf4e66489fc760c1\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1652366464 +0200\ncommitter GitHub <noreply@github.com> 1652366464 +0200\n\nRollup merge of #96939 - GuillaumeGomez:settings-css, r=notriddle\n\nFix settings page CSS\n\nIn https://github.com/rust-lang/rust/pull/96741, I moved the CSS loading outside of `settings.js`. The result was that on the settings page, there isn't the settings CSS anymore:\n\n![Screenshot from 2022-05-11 11-09-24](https://user-images.githubusercontent.com/3050060/167817969-6750931b-3e6e-4178-b5a9-ee3851e983be.png)\n\nI also used this opportunity to remove unused CSS rules (we don't have `<select>` elements anymore in the settings).\n\ncc `@jsha`\nr? `@notriddle`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/231cd0fd7d8b091e76fe4493c4570aee96f68ed3", "html_url": "https://github.com/rust-lang/rust/commit/231cd0fd7d8b091e76fe4493c4570aee96f68ed3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/231cd0fd7d8b091e76fe4493c4570aee96f68ed3/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "80e1dec10e989a559a63a85c63339cb2eb553168", "url": "https://api.github.com/repos/rust-lang/rust/commits/80e1dec10e989a559a63a85c63339cb2eb553168", "html_url": "https://github.com/rust-lang/rust/commit/80e1dec10e989a559a63a85c63339cb2eb553168"}, {"sha": "dd6bb09133f1f97db6a36024bf4e66489fc760c1", "url": "https://api.github.com/repos/rust-lang/rust/commits/dd6bb09133f1f97db6a36024bf4e66489fc760c1", "html_url": "https://github.com/rust-lang/rust/commit/dd6bb09133f1f97db6a36024bf4e66489fc760c1"}], "stats": {"total": 49, "additions": 10, "deletions": 39}, "files": [{"sha": "528180288de6a5175eeb2af2b5c923846fb086a1", "filename": "src/librustdoc/html/render/context.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/231cd0fd7d8b091e76fe4493c4570aee96f68ed3/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/231cd0fd7d8b091e76fe4493c4570aee96f68ed3/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs?ref=231cd0fd7d8b091e76fe4493c4570aee96f68ed3", "patch": "@@ -596,9 +596,11 @@ impl<'tcx> FormatRenderer<'tcx> for Context<'tcx> {\n             |buf: &mut Buffer| {\n                 write!(\n                     buf,\n-                    \"<script defer src=\\\"{}settings{}.js\\\"></script>\",\n-                    page.static_root_path.unwrap_or(\"\"),\n-                    page.resource_suffix\n+                    \"<link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" \\\n+                        href=\\\"{root_path}settings{suffix}.css\\\">\\\n+                    <script defer src=\\\"{root_path}settings{suffix}.js\\\"></script>\",\n+                    root_path = page.static_root_path.unwrap_or(\"\"),\n+                    suffix = page.resource_suffix,\n                 )\n             },\n             &self.shared.style_files,"}, {"sha": "07588748ad68ef814251ca5ba30d5b43198b4f94", "filename": "src/librustdoc/html/static/css/settings.css", "status": "modified", "additions": 0, "deletions": 36, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/231cd0fd7d8b091e76fe4493c4570aee96f68ed3/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fsettings.css", "raw_url": "https://github.com/rust-lang/rust/raw/231cd0fd7d8b091e76fe4493c4570aee96f68ed3/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fsettings.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fsettings.css?ref=231cd0fd7d8b091e76fe4493c4570aee96f68ed3", "patch": "@@ -56,38 +56,6 @@\n \tposition: absolute;\n }\n \n-.select-wrapper {\n-\tfloat: right;\n-\tposition: relative;\n-\theight: 27px;\n-\tmin-width: 25%;\n-}\n-\n-.select-wrapper select {\n-\tappearance: none;\n-\t-moz-appearance: none;\n-\t-webkit-appearance: none;\n-\tbackground: none;\n-\tborder: 2px solid #ccc;\n-\tpadding-right: 28px;\n-\twidth: 100%;\n-}\n-\n-.select-wrapper img {\n-\tpointer-events: none;\n-\tposition: absolute;\n-\tright: 0;\n-\tbottom: 0;\n-\tbackground: #ccc;\n-\theight: 100%;\n-\twidth: 28px;\n-\tpadding: 0px 4px;\n-}\n-\n-.select-wrapper select option {\n-\tcolor: initial;\n-}\n-\n .slider {\n \tposition: absolute;\n \tcursor: pointer;\n@@ -96,7 +64,6 @@\n \tright: 0;\n \tbottom: 0;\n \tbackground-color: #ccc;\n-\t-webkit-transition: .3s;\n \ttransition: .3s;\n }\n \n@@ -108,7 +75,6 @@\n \tleft: 4px;\n \tbottom: 4px;\n \tbackground-color: white;\n-\t-webkit-transition: .3s;\n \ttransition: .3s;\n }\n \n@@ -121,8 +87,6 @@ input:focus + .slider {\n }\n \n input:checked + .slider:before {\n-\t-webkit-transform: translateX(19px);\n-\t-ms-transform: translateX(19px);\n \ttransform: translateX(19px);\n }\n "}, {"sha": "18270264266f424ff792987660e6a7415ced2e39", "filename": "src/test/rustdoc-gui/settings.goml", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/231cd0fd7d8b091e76fe4493c4570aee96f68ed3/src%2Ftest%2Frustdoc-gui%2Fsettings.goml", "raw_url": "https://github.com/rust-lang/rust/raw/231cd0fd7d8b091e76fe4493c4570aee96f68ed3/src%2Ftest%2Frustdoc-gui%2Fsettings.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsettings.goml?ref=231cd0fd7d8b091e76fe4493c4570aee96f68ed3", "patch": "@@ -65,3 +65,8 @@ assert: \".setting-line.hidden #theme\"\n // We check their text as well.\n assert-text: (\"#preferred-dark-theme .setting-name\", \"Preferred dark theme\")\n assert-text: (\"#preferred-light-theme .setting-name\", \"Preferred light theme\")\n+\n+// Now we go to the settings page to check that the CSS is loaded as expected.\n+goto: file://|DOC_PATH|/settings.html\n+wait-for: \"#settings\"\n+assert-css: (\".setting-line .toggle\", {\"width\": \"45px\", \"margin-right\": \"20px\"})"}]}