{"sha": "57f0e9c1006896bc6bead470c87aea8b015e5af8", "node_id": "C_kwDOAAsO6NoAKDU3ZjBlOWMxMDA2ODk2YmM2YmVhZDQ3MGM4N2FlYThiMDE1ZTVhZjg", "commit": {"author": {"name": "Ryo Yoshida", "email": "low.ryoshida@gmail.com", "date": "2023-02-13T09:05:23Z"}, "committer": {"name": "Ryo Yoshida", "email": "low.ryoshida@gmail.com", "date": "2023-02-13T09:45:19Z"}, "message": "Disallow invalid raw ident names", "tree": {"sha": "ef913f3d8b5ee33f029e49d7e075ebd69dcc28ae", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ef913f3d8b5ee33f029e49d7e075ebd69dcc28ae"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/57f0e9c1006896bc6bead470c87aea8b015e5af8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEkSbsQIURluxz4rzf4laYqTBYYXEFAmPqBq8ACgkQ4laYqTBY\nYXFwfxAAtt+w3e2XHQ/Ib8hKyTcKNxKBgVee1AKxM7mxmfh7HVR82WHR0eJCbJbT\n930RKjFbmZw252Bx6LTEPW4PfXWEXZcyk/CG2n7UphvJaPXddSYfgtcSbS3bljPz\nBqExOqOr2fZywYI67fD4NPLyGi38en/2alHAkjy80qbm/i8GdnaOlv459iFP6xJz\npQpgw5IQcsNcrVMZ/Q/H6guCDznN0+pBEBq/pfy+x4xA/vAEnztwcQnV2NyCNX4P\nmumJ3mcRft/OEFimoJrwFdYjGSgvxBRQGJ5ZAV7726TX7oUtQ7efzxffaaWcbIy7\nSGTbrhdW0A5gZGzW+x/5mQa1RTSmmrvTYdWtSRHbk+gVYPXPSgS8FagOwImdb7k3\noaG7cVR3GLGsJeNxbaaRSgb8XIshb3hG+0TEXIN6h2p/bDeTGn9EfKj2rI2sNDg2\n9iMEL9kIcaZFr9wJxenU+wwcAVZkm5NWDQc9f0yrGCOdI0RD5NvdfxTMo8UqhXvc\nyF4xAHTr6Aq5ZhSj6+ulJqTSgE75yU6Yhl3/Ixc38BLND+n8EAW+7V3XRsmPZTko\nN0ucRKjln+tqsxQNRoTOsFRCGeWJq0S5E8thVAXqNv2xH969/zjOJXp1QPE30M7I\nU+YfKGq2zoXz91qOL3ThMrSJxlIT/C4BLWhI+zBSsTumsn3hx4s=\n=4Y/x\n-----END PGP SIGNATURE-----", "payload": "tree ef913f3d8b5ee33f029e49d7e075ebd69dcc28ae\nparent 9b0daf20c9cf2437017da07d7b4f1d4bdf721d2d\nauthor Ryo Yoshida <low.ryoshida@gmail.com> 1676279123 +0900\ncommitter Ryo Yoshida <low.ryoshida@gmail.com> 1676281519 +0900\n\nDisallow invalid raw ident names\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/57f0e9c1006896bc6bead470c87aea8b015e5af8", "html_url": "https://github.com/rust-lang/rust/commit/57f0e9c1006896bc6bead470c87aea8b015e5af8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/57f0e9c1006896bc6bead470c87aea8b015e5af8/comments", "author": {"login": "lowr", "id": 24381114, "node_id": "MDQ6VXNlcjI0MzgxMTE0", "avatar_url": "https://avatars.githubusercontent.com/u/24381114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lowr", "html_url": "https://github.com/lowr", "followers_url": "https://api.github.com/users/lowr/followers", "following_url": "https://api.github.com/users/lowr/following{/other_user}", "gists_url": "https://api.github.com/users/lowr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lowr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lowr/subscriptions", "organizations_url": "https://api.github.com/users/lowr/orgs", "repos_url": "https://api.github.com/users/lowr/repos", "events_url": "https://api.github.com/users/lowr/events{/privacy}", "received_events_url": "https://api.github.com/users/lowr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lowr", "id": 24381114, "node_id": "MDQ6VXNlcjI0MzgxMTE0", "avatar_url": "https://avatars.githubusercontent.com/u/24381114?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lowr", "html_url": "https://github.com/lowr", "followers_url": "https://api.github.com/users/lowr/followers", "following_url": "https://api.github.com/users/lowr/following{/other_user}", "gists_url": "https://api.github.com/users/lowr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lowr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lowr/subscriptions", "organizations_url": "https://api.github.com/users/lowr/orgs", "repos_url": "https://api.github.com/users/lowr/repos", "events_url": "https://api.github.com/users/lowr/events{/privacy}", "received_events_url": "https://api.github.com/users/lowr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9b0daf20c9cf2437017da07d7b4f1d4bdf721d2d", "url": "https://api.github.com/repos/rust-lang/rust/commits/9b0daf20c9cf2437017da07d7b4f1d4bdf721d2d", "html_url": "https://github.com/rust-lang/rust/commit/9b0daf20c9cf2437017da07d7b4f1d4bdf721d2d"}], "stats": {"total": 18, "additions": 17, "deletions": 1}, "files": [{"sha": "84d70b258ff86537432be125fe2ab3523302b539", "filename": "crates/ide-db/src/rename.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/57f0e9c1006896bc6bead470c87aea8b015e5af8/crates%2Fide-db%2Fsrc%2Frename.rs", "raw_url": "https://github.com/rust-lang/rust/raw/57f0e9c1006896bc6bead470c87aea8b015e5af8/crates%2Fide-db%2Fsrc%2Frename.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide-db%2Fsrc%2Frename.rs?ref=57f0e9c1006896bc6bead470c87aea8b015e5af8", "patch": "@@ -537,7 +537,14 @@ impl IdentifierKind {\n     pub fn classify(new_name: &str) -> Result<IdentifierKind> {\n         match parser::LexedStr::single_token(new_name) {\n             Some(res) => match res {\n-                (SyntaxKind::IDENT, _) => Ok(IdentifierKind::Ident),\n+                (SyntaxKind::IDENT, _) => {\n+                    if let Some(inner) = new_name.strip_prefix(\"r#\") {\n+                        if matches!(inner, \"self\" | \"crate\" | \"super\" | \"Self\") {\n+                            bail!(\"Invalid name: `{}` cannot be a raw identifier\", inner);\n+                        }\n+                    }\n+                    Ok(IdentifierKind::Ident)\n+                }\n                 (T![_], _) => Ok(IdentifierKind::Underscore),\n                 (SyntaxKind::LIFETIME_IDENT, _) if new_name != \"'static\" && new_name != \"'_\" => {\n                     Ok(IdentifierKind::Lifetime)"}, {"sha": "8e89160ef5e05d9099f3b05941aa926d418efd59", "filename": "crates/ide/src/rename.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/57f0e9c1006896bc6bead470c87aea8b015e5af8/crates%2Fide%2Fsrc%2Frename.rs", "raw_url": "https://github.com/rust-lang/rust/raw/57f0e9c1006896bc6bead470c87aea8b015e5af8/crates%2Fide%2Fsrc%2Frename.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Frename.rs?ref=57f0e9c1006896bc6bead470c87aea8b015e5af8", "patch": "@@ -562,6 +562,15 @@ impl Foo {\n         );\n     }\n \n+    #[test]\n+    fn test_rename_mod_invalid_raw_ident() {\n+        check(\n+            \"r#self\",\n+            r#\"mod foo$0 {}\"#,\n+            \"error: Invalid name: `self` cannot be a raw identifier\",\n+        );\n+    }\n+\n     #[test]\n     fn test_rename_for_local() {\n         check("}]}