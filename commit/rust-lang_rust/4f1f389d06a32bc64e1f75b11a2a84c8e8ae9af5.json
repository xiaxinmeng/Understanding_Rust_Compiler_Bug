{"sha": "4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRmMWYzODlkMDZhMzJiYzY0ZTFmNzViMTFhMmE4NGM4ZThhZTlhZjU=", "commit": {"author": {"name": "Wesley Wiser", "email": "wwiser@gmail.com", "date": "2018-03-10T22:17:30Z"}, "committer": {"name": "Wesley Wiser", "email": "wwiser@gmail.com", "date": "2018-03-16T03:11:09Z"}, "message": "Queryify check_impl_item_well_formed\n\nFixes #46753", "tree": {"sha": "b499b63fc0cf74b005ec03b3ba7eb62b01507571", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b499b63fc0cf74b005ec03b3ba7eb62b01507571"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5", "html_url": "https://github.com/rust-lang/rust/commit/4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5/comments", "author": {"login": "wesleywiser", "id": 831192, "node_id": "MDQ6VXNlcjgzMTE5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/831192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wesleywiser", "html_url": "https://github.com/wesleywiser", "followers_url": "https://api.github.com/users/wesleywiser/followers", "following_url": "https://api.github.com/users/wesleywiser/following{/other_user}", "gists_url": "https://api.github.com/users/wesleywiser/gists{/gist_id}", "starred_url": "https://api.github.com/users/wesleywiser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wesleywiser/subscriptions", "organizations_url": "https://api.github.com/users/wesleywiser/orgs", "repos_url": "https://api.github.com/users/wesleywiser/repos", "events_url": "https://api.github.com/users/wesleywiser/events{/privacy}", "received_events_url": "https://api.github.com/users/wesleywiser/received_events", "type": "User", "site_admin": false}, "committer": {"login": "wesleywiser", "id": 831192, "node_id": "MDQ6VXNlcjgzMTE5Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/831192?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wesleywiser", "html_url": "https://github.com/wesleywiser", "followers_url": "https://api.github.com/users/wesleywiser/followers", "following_url": "https://api.github.com/users/wesleywiser/following{/other_user}", "gists_url": "https://api.github.com/users/wesleywiser/gists{/gist_id}", "starred_url": "https://api.github.com/users/wesleywiser/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wesleywiser/subscriptions", "organizations_url": "https://api.github.com/users/wesleywiser/orgs", "repos_url": "https://api.github.com/users/wesleywiser/repos", "events_url": "https://api.github.com/users/wesleywiser/events{/privacy}", "received_events_url": "https://api.github.com/users/wesleywiser/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "edbd02fd35ffd3724a415c05c21e4e4fc5575e1e", "url": "https://api.github.com/repos/rust-lang/rust/commits/edbd02fd35ffd3724a415c05c21e4e4fc5575e1e", "html_url": "https://github.com/rust-lang/rust/commit/edbd02fd35ffd3724a415c05c21e4e4fc5575e1e"}], "stats": {"total": 27, "additions": 21, "deletions": 6}, "files": [{"sha": "13cf7a9ec8f1ee4e8905dea3320e4cd37c32cf67", "filename": "src/librustc/dep_graph/dep_node.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5/src%2Flibrustc%2Fdep_graph%2Fdep_node.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5/src%2Flibrustc%2Fdep_graph%2Fdep_node.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdep_graph%2Fdep_node.rs?ref=4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5", "patch": "@@ -581,6 +581,7 @@ define_dep_nodes!( <'tcx>\n     [] ImplDefaultness(DefId),\n     [] CheckItemWellFormed(DefId),\n     [] CheckTraitItemWellFormed(DefId),\n+    [] CheckImplItemWellFormed(DefId),\n     [] ReachableNonGenerics(CrateNum),\n     [] NativeLibraries(CrateNum),\n     [] PluginRegistrarFn(CrateNum),"}, {"sha": "4dcd7c20c33d5d31848f585dcb1fa1a2e3eab4ec", "filename": "src/librustc/ty/maps/mod.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5/src%2Flibrustc%2Fty%2Fmaps%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5/src%2Flibrustc%2Fty%2Fmaps%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fmaps%2Fmod.rs?ref=4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5", "patch": "@@ -300,6 +300,7 @@ define_maps! { <'tcx>\n \n     [] fn check_item_well_formed: CheckItemWellFormed(DefId) -> (),\n     [] fn check_trait_item_well_formed: CheckTraitItemWellFormed(DefId) -> (),\n+    [] fn check_impl_item_well_formed: CheckImplItemWellFormed(DefId) -> (),\n \n     // The DefIds of all non-generic functions and statics in the given crate\n     // that can be reached from outside the crate."}, {"sha": "267d7da5e0c255e5b0752ac218f86c8f3b0531b2", "filename": "src/librustc/ty/maps/plumbing.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5/src%2Flibrustc%2Fty%2Fmaps%2Fplumbing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5/src%2Flibrustc%2Fty%2Fmaps%2Fplumbing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fmaps%2Fplumbing.rs?ref=4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5", "patch": "@@ -873,6 +873,7 @@ pub fn force_from_dep_node<'a, 'gcx, 'lcx>(tcx: TyCtxt<'a, 'gcx, 'lcx>,\n         DepKind::ImplDefaultness => { force!(impl_defaultness, def_id!()); }\n         DepKind::CheckItemWellFormed => { force!(check_item_well_formed, def_id!()); }\n         DepKind::CheckTraitItemWellFormed => { force!(check_trait_item_well_formed, def_id!()); }\n+        DepKind::CheckImplItemWellFormed => { force!(check_impl_item_well_formed, def_id!()); }\n         DepKind::ReachableNonGenerics => { force!(reachable_non_generics, krate!()); }\n         DepKind::NativeLibraries => { force!(native_libraries, krate!()); }\n         DepKind::PluginRegistrarFn => { force!(plugin_registrar_fn, krate!()); }"}, {"sha": "5b3a4529f1a099a77cad8dcddf982d79bf098a68", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5", "patch": "@@ -726,6 +726,10 @@ fn check_trait_item_well_formed<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>, def_id: D\n     wfcheck::CheckTypeWellFormed::new(tcx).check_trait_item(def_id);\n }\n \n+fn check_impl_item_well_formed<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>, def_id: DefId) {\n+    wfcheck::CheckTypeWellFormed::new(tcx).check_impl_item(def_id);\n+}\n+\n pub fn provide(providers: &mut Providers) {\n     *providers = Providers {\n         typeck_item_bodies,\n@@ -735,6 +739,7 @@ pub fn provide(providers: &mut Providers) {\n         used_trait_imports,\n         check_item_well_formed,\n         check_trait_item_well_formed,\n+        check_impl_item_well_formed,\n         ..*providers\n     };\n }"}, {"sha": "72f40627b831af038013bcc9d5bdc51fd72ae42f", "filename": "src/librustc_typeck/check/wfcheck.rs", "status": "modified", "additions": 13, "deletions": 6, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5/src%2Flibrustc_typeck%2Fcheck%2Fwfcheck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5/src%2Flibrustc_typeck%2Fcheck%2Fwfcheck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fwfcheck.rs?ref=4f1f389d06a32bc64e1f75b11a2a84c8e8ae9af5", "patch": "@@ -171,6 +171,17 @@ impl<'a, 'gcx> CheckTypeWellFormed<'a, 'gcx> {\n             .check_associated_item(trait_item.id, trait_item.span, method_sig);\n     }\n \n+    pub fn check_impl_item(&mut self, def_id: DefId) {\n+        let node_id = self.tcx.hir.as_local_node_id(def_id).unwrap();\n+        let impl_item = self.tcx.hir.expect_impl_item(node_id);\n+\n+        let method_sig = match impl_item.node {\n+            hir::ImplItemKind::Method(ref sig, _) => Some(sig),\n+            _ => None\n+        };\n+        self.check_associated_item(impl_item.id, impl_item.span, method_sig);\n+    }\n+\n     fn check_associated_item(&mut self,\n                              item_id: ast::NodeId,\n                              span: Span,\n@@ -694,12 +705,8 @@ impl<'a, 'tcx, 'v> Visitor<'v> for CheckTypeWellFormedVisitor<'a, 'tcx> {\n \n     fn visit_impl_item(&mut self, impl_item: &'v hir::ImplItem) {\n         debug!(\"visit_impl_item: {:?}\", impl_item);\n-        let method_sig = match impl_item.node {\n-            hir::ImplItemKind::Method(ref sig, _) => Some(sig),\n-            _ => None\n-        };\n-        CheckTypeWellFormed::new(self.tcx)\n-            .check_associated_item(impl_item.id, impl_item.span, method_sig);\n+        let def_id = self.tcx.hir.local_def_id(impl_item.id);\n+        ty::maps::queries::check_impl_item_well_formed::ensure(self.tcx, def_id);\n         intravisit::walk_impl_item(self, impl_item)\n     }\n }"}]}