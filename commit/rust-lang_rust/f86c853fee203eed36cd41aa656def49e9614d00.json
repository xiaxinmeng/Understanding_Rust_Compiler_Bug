{"sha": "f86c853fee203eed36cd41aa656def49e9614d00", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY4NmM4NTNmZWUyMDNlZWQzNmNkNDFhYTY1NmRlZjQ5ZTk2MTRkMDA=", "commit": {"author": {"name": "Diggory Blake", "email": "diggsey@googlemail.com", "date": "2015-08-27T17:16:31Z"}, "committer": {"name": "Diggory Blake", "email": "diggsey@googlemail.com", "date": "2015-09-04T09:03:56Z"}, "message": "Fix escaping in msvc builds", "tree": {"sha": "7d86b7787c689dd3f04665c5f53674680eb6478d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7d86b7787c689dd3f04665c5f53674680eb6478d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f86c853fee203eed36cd41aa656def49e9614d00", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f86c853fee203eed36cd41aa656def49e9614d00", "html_url": "https://github.com/rust-lang/rust/commit/f86c853fee203eed36cd41aa656def49e9614d00", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f86c853fee203eed36cd41aa656def49e9614d00/comments", "author": {"login": "Diggsey", "id": 451321, "node_id": "MDQ6VXNlcjQ1MTMyMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/451321?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Diggsey", "html_url": "https://github.com/Diggsey", "followers_url": "https://api.github.com/users/Diggsey/followers", "following_url": "https://api.github.com/users/Diggsey/following{/other_user}", "gists_url": "https://api.github.com/users/Diggsey/gists{/gist_id}", "starred_url": "https://api.github.com/users/Diggsey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Diggsey/subscriptions", "organizations_url": "https://api.github.com/users/Diggsey/orgs", "repos_url": "https://api.github.com/users/Diggsey/repos", "events_url": "https://api.github.com/users/Diggsey/events{/privacy}", "received_events_url": "https://api.github.com/users/Diggsey/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Diggsey", "id": 451321, "node_id": "MDQ6VXNlcjQ1MTMyMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/451321?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Diggsey", "html_url": "https://github.com/Diggsey", "followers_url": "https://api.github.com/users/Diggsey/followers", "following_url": "https://api.github.com/users/Diggsey/following{/other_user}", "gists_url": "https://api.github.com/users/Diggsey/gists{/gist_id}", "starred_url": "https://api.github.com/users/Diggsey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Diggsey/subscriptions", "organizations_url": "https://api.github.com/users/Diggsey/orgs", "repos_url": "https://api.github.com/users/Diggsey/repos", "events_url": "https://api.github.com/users/Diggsey/events{/privacy}", "received_events_url": "https://api.github.com/users/Diggsey/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "28ef44a9e6110d7e59aca590ce7cf16d6d601d54", "url": "https://api.github.com/repos/rust-lang/rust/commits/28ef44a9e6110d7e59aca590ce7cf16d6d601d54", "html_url": "https://github.com/rust-lang/rust/commit/28ef44a9e6110d7e59aca590ce7cf16d6d601d54"}], "stats": {"total": 19, "additions": 15, "deletions": 4}, "files": [{"sha": "45e137d4a9f41ce4ddc392a94e8354a2381d936e", "filename": "configure", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/f86c853fee203eed36cd41aa656def49e9614d00/configure", "raw_url": "https://github.com/rust-lang/rust/raw/f86c853fee203eed36cd41aa656def49e9614d00/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=f86c853fee203eed36cd41aa656def49e9614d00", "patch": "@@ -1180,16 +1180,27 @@ do\n             # MSVC requires cmake because that's how we're going to build LLVM\n             probe_need CFG_CMAKE cmake\n \n+            # There are three builds of cmake on windows: MSVC, MinGW and Cygwin\n+            # The Cygwin build does not have generators for Visual Studio, so\n+            # detect that here and error.\n+            if ! \"$CFG_CMAKE\" --help | sed -n '/^Generators/,$p' | grep 'Visual Studio' > /dev/null\n+            then\n+                err \"cmake does not support Visual Studio generators.\\n\\n \\\n+                     This is likely due to it being an msys/cygwin build of cmake, \\\n+                     rather than the required windows version, built using MinGW \\\n+                     or Visual Studio.\"\n+            fi\n+\n             # Use the REG program to figure out where VS is installed\n             # We need to figure out where cl.exe and link.exe are, so we do some\n             # munging and some probing here. We also look for the default\n             # INCLUDE and LIB variables for MSVC so we can set those in the\n             # build system as well.\n-            install=$(reg QUERY \\\n+            install=$(cmd //c reg QUERY \\\n                        'HKLM\\SOFTWARE\\Wow6432Node\\Microsoft\\VisualStudio\\14.0' \\\n                        -v InstallDir)\n             if [ -z \"$install\" ]; then\n-              install=$(reg QUERY \\\n+              install=$(cmd //c reg QUERY \\\n                          'HKLM\\SOFTWARE\\Wow6432Node\\Microsoft\\VisualStudio\\12.0' \\\n                          -v InstallDir)\n             fi\n@@ -1222,9 +1233,9 @@ do\n             eval CFG_MSVC_LINK_$bits=\"\\\"$bindir/link.exe\\\"\"\n \n             vcvarsall=\"${CFG_MSVC_ROOT}/VC/vcvarsall.bat\"\n-            include_path=$(cmd /c \"\\\"$vcvarsall\\\" $msvc_part && cmd /c echo %INCLUDE%\")\n+            include_path=$(cmd //V:ON //c \"$vcvarsall\" $msvc_part \\& echo !INCLUDE!)\n             need_ok \"failed to learn about MSVC's INCLUDE\"\n-            lib_path=$(cmd /c \"\\\"$vcvarsall\\\" $msvc_part && cmd /c echo %LIB%\")\n+            lib_path=$(cmd //V:ON //c \"$vcvarsall\" $msvc_part \\& echo !LIB!)\n             need_ok \"failed to learn about MSVC's LIB\"\n \n             eval CFG_MSVC_INCLUDE_PATH_${bits}=\"\\\"$include_path\\\"\""}]}