{"sha": "0231d19f3fba410896d52fa345fe1967c2ea8f55", "node_id": "C_kwDOAAsO6NoAKDAyMzFkMTlmM2ZiYTQxMDg5NmQ1MmZhMzQ1ZmUxOTY3YzJlYThmNTU", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-09-24T01:07:05Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2022-09-24T01:07:05Z"}, "message": "Fix diagnostics not working in enum variant bodies", "tree": {"sha": "01e75e48461d5ff8204f7d75403faad73f56bcb4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/01e75e48461d5ff8204f7d75403faad73f56bcb4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0231d19f3fba410896d52fa345fe1967c2ea8f55", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0231d19f3fba410896d52fa345fe1967c2ea8f55", "html_url": "https://github.com/rust-lang/rust/commit/0231d19f3fba410896d52fa345fe1967c2ea8f55", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0231d19f3fba410896d52fa345fe1967c2ea8f55/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7ec9ffa3251504da334a29f0e4331378bc26c54a", "url": "https://api.github.com/repos/rust-lang/rust/commits/7ec9ffa3251504da334a29f0e4331378bc26c54a", "html_url": "https://github.com/rust-lang/rust/commit/7ec9ffa3251504da334a29f0e4331378bc26c54a"}], "stats": {"total": 13, "additions": 11, "deletions": 2}, "files": [{"sha": "e1f69001e80029676da905aa754cd314414db6a7", "filename": "crates/hir/src/lib.rs", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/0231d19f3fba410896d52fa345fe1967c2ea8f55/crates%2Fhir%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0231d19f3fba410896d52fa345fe1967c2ea8f55/crates%2Fhir%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Flib.rs?ref=0231d19f3fba410896d52fa345fe1967c2ea8f55", "patch": "@@ -50,7 +50,7 @@ use hir_def::{\n     resolver::{HasResolver, Resolver},\n     src::HasSource as _,\n     AdtId, AssocItemId, AssocItemLoc, AttrDefId, ConstId, ConstParamId, DefWithBodyId, EnumId,\n-    FunctionId, GenericDefId, HasModule, ImplId, ItemContainerId, LifetimeParamId,\n+    EnumVariantId, FunctionId, GenericDefId, HasModule, ImplId, ItemContainerId, LifetimeParamId,\n     LocalEnumVariantId, LocalFieldId, Lookup, MacroExpander, MacroId, ModuleId, StaticId, StructId,\n     TraitId, TypeAliasId, TypeOrConstParamId, TypeParamId, UnionId,\n };\n@@ -348,7 +348,10 @@ impl ModuleDef {\n             ModuleDef::Module(it) => it.id.into(),\n             ModuleDef::Const(it) => it.id.into(),\n             ModuleDef::Static(it) => it.id.into(),\n-            _ => return Vec::new(),\n+            ModuleDef::Variant(it) => {\n+                EnumVariantId { parent: it.parent.into(), local_id: it.id }.into()\n+            }\n+            ModuleDef::BuiltinType(_) | ModuleDef::Macro(_) => return Vec::new(),\n         };\n \n         let module = match self.module(db) {\n@@ -537,6 +540,12 @@ impl Module {\n                     }\n                     acc.extend(decl.diagnostics(db))\n                 }\n+                ModuleDef::Adt(Adt::Enum(e)) => {\n+                    for v in e.variants(db) {\n+                        acc.extend(ModuleDef::Variant(v).diagnostics(db));\n+                    }\n+                    acc.extend(decl.diagnostics(db))\n+                }\n                 _ => acc.extend(decl.diagnostics(db)),\n             }\n         }"}]}