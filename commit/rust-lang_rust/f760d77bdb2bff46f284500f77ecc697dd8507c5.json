{"sha": "f760d77bdb2bff46f284500f77ecc697dd8507c5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY3NjBkNzdiZGIyYmZmNDZmMjg0NTAwZjc3ZWNjNjk3ZGQ4NTA3YzU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-06-02T11:42:22Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-06-02T11:42:22Z"}, "message": "Auto merge of #5597 - esamudera:slice_iter_next, r=flip1995\n\nNew lint: iter_next_slice\n\nHello, this is a work-in-progress PR for issue: https://github.com/rust-lang/rust-clippy/issues/5572\n\nI have implemented lint to replace `iter().next()` for `slice[index..]` and `array` with `get(index)` and `get(0)` respectively. However since I made a lot of changes, I would like to request some feedback before continuing so that I could fix mistakes.\n\nThank you!\n\n---\n\nchangelog: implement `iter_next_slice` lint and test, and modify `needless_continues`, `for_loop_over_options_result` UI tests since they have `iter().next()`", "tree": {"sha": "165f0ef977d0ad29157d774e6456a06e2e6aedc6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/165f0ef977d0ad29157d774e6456a06e2e6aedc6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f760d77bdb2bff46f284500f77ecc697dd8507c5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f760d77bdb2bff46f284500f77ecc697dd8507c5", "html_url": "https://github.com/rust-lang/rust/commit/f760d77bdb2bff46f284500f77ecc697dd8507c5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f760d77bdb2bff46f284500f77ecc697dd8507c5/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bfafb8e0d61fd55bf72e11babefee76d17006367", "url": "https://api.github.com/repos/rust-lang/rust/commits/bfafb8e0d61fd55bf72e11babefee76d17006367", "html_url": "https://github.com/rust-lang/rust/commit/bfafb8e0d61fd55bf72e11babefee76d17006367"}, {"sha": "32fde0b5116b3a1115d11c49a9bf2af2ebdd5773", "url": "https://api.github.com/repos/rust-lang/rust/commits/32fde0b5116b3a1115d11c49a9bf2af2ebdd5773", "html_url": "https://github.com/rust-lang/rust/commit/32fde0b5116b3a1115d11c49a9bf2af2ebdd5773"}], "stats": {"total": 229, "additions": 204, "deletions": 25}, "files": [{"sha": "7f26d2b169a268676f98ea0708f9c5015ee96c12", "filename": "CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/f760d77bdb2bff46f284500f77ecc697dd8507c5/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/f760d77bdb2bff46f284500f77ecc697dd8507c5/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=f760d77bdb2bff46f284500f77ecc697dd8507c5", "patch": "@@ -1401,6 +1401,7 @@ Released 2018-09-13\n [`items_after_statements`]: https://rust-lang.github.io/rust-clippy/master/index.html#items_after_statements\n [`iter_cloned_collect`]: https://rust-lang.github.io/rust-clippy/master/index.html#iter_cloned_collect\n [`iter_next_loop`]: https://rust-lang.github.io/rust-clippy/master/index.html#iter_next_loop\n+[`iter_next_slice`]: https://rust-lang.github.io/rust-clippy/master/index.html#iter_next_slice\n [`iter_nth`]: https://rust-lang.github.io/rust-clippy/master/index.html#iter_nth\n [`iter_nth_zero`]: https://rust-lang.github.io/rust-clippy/master/index.html#iter_nth_zero\n [`iter_skip_next`]: https://rust-lang.github.io/rust-clippy/master/index.html#iter_skip_next"}, {"sha": "7e9a52fe69f33257919a0beaaa10be6e6650a47b", "filename": "clippy_lints/src/lib.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f760d77bdb2bff46f284500f77ecc697dd8507c5/clippy_lints%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f760d77bdb2bff46f284500f77ecc697dd8507c5/clippy_lints%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Flib.rs?ref=f760d77bdb2bff46f284500f77ecc697dd8507c5", "patch": "@@ -666,6 +666,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         &methods::INTO_ITER_ON_REF,\n         &methods::ITERATOR_STEP_BY_ZERO,\n         &methods::ITER_CLONED_COLLECT,\n+        &methods::ITER_NEXT_SLICE,\n         &methods::ITER_NTH,\n         &methods::ITER_NTH_ZERO,\n         &methods::ITER_SKIP_NEXT,\n@@ -1310,6 +1311,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&methods::INTO_ITER_ON_REF),\n         LintId::of(&methods::ITERATOR_STEP_BY_ZERO),\n         LintId::of(&methods::ITER_CLONED_COLLECT),\n+        LintId::of(&methods::ITER_NEXT_SLICE),\n         LintId::of(&methods::ITER_NTH),\n         LintId::of(&methods::ITER_NTH_ZERO),\n         LintId::of(&methods::ITER_SKIP_NEXT),\n@@ -1491,6 +1493,7 @@ pub fn register_plugins(store: &mut rustc_lint::LintStore, sess: &Session, conf:\n         LintId::of(&methods::CHARS_NEXT_CMP),\n         LintId::of(&methods::INTO_ITER_ON_REF),\n         LintId::of(&methods::ITER_CLONED_COLLECT),\n+        LintId::of(&methods::ITER_NEXT_SLICE),\n         LintId::of(&methods::ITER_NTH_ZERO),\n         LintId::of(&methods::ITER_SKIP_NEXT),\n         LintId::of(&methods::MANUAL_SATURATING_ARITHMETIC),"}, {"sha": "dbe41823a9cf6874ef5f88977f6d76fee9ef6933", "filename": "clippy_lints/src/loops.rs", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/f760d77bdb2bff46f284500f77ecc697dd8507c5/clippy_lints%2Fsrc%2Floops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f760d77bdb2bff46f284500f77ecc697dd8507c5/clippy_lints%2Fsrc%2Floops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops.rs?ref=f760d77bdb2bff46f284500f77ecc697dd8507c5", "patch": "@@ -27,7 +27,7 @@ use rustc_middle::middle::region;\n use rustc_middle::ty::{self, Ty};\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n use rustc_span::source_map::Span;\n-use rustc_span::BytePos;\n+use rustc_span::symbol::Symbol;\n use rustc_typeck::expr_use_visitor::{ConsumeMode, Delegate, ExprUseVisitor, Place, PlaceBase};\n use std::iter::{once, Iterator};\n use std::mem;\n@@ -2381,32 +2381,32 @@ fn check_needless_collect<'a, 'tcx>(expr: &'tcx Expr<'_>, cx: &LateContext<'a, '\n                 match_type(cx, ty, &paths::BTREEMAP) ||\n                 is_type_diagnostic_item(cx, ty, sym!(hashmap_type)) {\n                 if method.ident.name == sym!(len) {\n-                    let span = shorten_needless_collect_span(expr);\n+                    let span = shorten_span(expr, sym!(collect));\n                     span_lint_and_sugg(\n                         cx,\n                         NEEDLESS_COLLECT,\n                         span,\n                         NEEDLESS_COLLECT_MSG,\n                         \"replace with\",\n-                        \".count()\".to_string(),\n+                        \"count()\".to_string(),\n                         Applicability::MachineApplicable,\n                     );\n                 }\n                 if method.ident.name == sym!(is_empty) {\n-                    let span = shorten_needless_collect_span(expr);\n+                    let span = shorten_span(expr, sym!(iter));\n                     span_lint_and_sugg(\n                         cx,\n                         NEEDLESS_COLLECT,\n                         span,\n                         NEEDLESS_COLLECT_MSG,\n                         \"replace with\",\n-                        \".next().is_none()\".to_string(),\n+                        \"get(0).is_none()\".to_string(),\n                         Applicability::MachineApplicable,\n                     );\n                 }\n                 if method.ident.name == sym!(contains) {\n                     let contains_arg = snippet(cx, args[1].span, \"??\");\n-                    let span = shorten_needless_collect_span(expr);\n+                    let span = shorten_span(expr, sym!(collect));\n                     span_lint_and_then(\n                         cx,\n                         NEEDLESS_COLLECT,\n@@ -2422,7 +2422,7 @@ fn check_needless_collect<'a, 'tcx>(expr: &'tcx Expr<'_>, cx: &LateContext<'a, '\n                                 span,\n                                 \"replace with\",\n                                 format!(\n-                                    \".any(|{}| x == {})\",\n+                                    \"any(|{}| x == {})\",\n                                     arg, pred\n                                 ),\n                                 Applicability::MachineApplicable,\n@@ -2435,13 +2435,13 @@ fn check_needless_collect<'a, 'tcx>(expr: &'tcx Expr<'_>, cx: &LateContext<'a, '\n     }\n }\n \n-fn shorten_needless_collect_span(expr: &Expr<'_>) -> Span {\n-    if_chain! {\n-        if let ExprKind::MethodCall(_, _, ref args) = expr.kind;\n-        if let ExprKind::MethodCall(_, ref span, _) = args[0].kind;\n-        then {\n-            return expr.span.with_lo(span.lo() - BytePos(1));\n+fn shorten_span(expr: &Expr<'_>, target_fn_name: Symbol) -> Span {\n+    let mut current_expr = expr;\n+    while let ExprKind::MethodCall(ref path, ref span, ref args) = current_expr.kind {\n+        if path.ident.name == target_fn_name {\n+            return expr.span.with_lo(span.lo());\n         }\n+        current_expr = &args[0];\n     }\n     unreachable!()\n }"}, {"sha": "4b10496280ff6a0de808e28a75ff0db280d2ceef", "filename": "clippy_lints/src/methods/mod.rs", "status": "modified", "additions": 83, "deletions": 1, "changes": 84, "blob_url": "https://github.com/rust-lang/rust/blob/f760d77bdb2bff46f284500f77ecc697dd8507c5/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f760d77bdb2bff46f284500f77ecc697dd8507c5/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fmod.rs?ref=f760d77bdb2bff46f284500f77ecc697dd8507c5", "patch": "@@ -26,7 +26,7 @@ use rustc_span::symbol::{sym, SymbolStr};\n use crate::consts::{constant, Constant};\n use crate::utils::usage::mutated_variables;\n use crate::utils::{\n-    get_arg_name, get_parent_expr, get_trait_def_id, has_iter_method, implements_trait, in_macro, is_copy,\n+    get_arg_name, get_parent_expr, get_trait_def_id, has_iter_method, higher, implements_trait, in_macro, is_copy,\n     is_ctor_or_promotable_const_function, is_expn_of, is_type_diagnostic_item, iter_input_pats, last_path_segment,\n     match_def_path, match_qpath, match_trait_method, match_type, match_var, method_calls, method_chain_args, paths,\n     remove_blocks, return_ty, same_tys, single_segment_path, snippet, snippet_with_applicability,\n@@ -1242,6 +1242,32 @@ declare_clippy_lint! {\n     \"using `as_ref().map(Deref::deref)`, which is more succinctly expressed as `as_deref()`\"\n }\n \n+declare_clippy_lint! {\n+    /// **What it does:** Checks for usage of `iter().next()` on a Slice or an Array\n+    ///\n+    /// **Why is this bad?** These can be shortened into `.get()`\n+    ///\n+    /// **Known problems:** None.\n+    ///\n+    /// **Example:**\n+    /// ```rust\n+    /// # let a = [1, 2, 3];\n+    /// # let b = vec![1, 2, 3];\n+    /// a[2..].iter().next();\n+    /// b.iter().next();\n+    /// ```\n+    /// should be written as:\n+    /// ```rust\n+    /// # let a = [1, 2, 3];\n+    /// # let b = vec![1, 2, 3];\n+    /// a.get(2);\n+    /// b.get(0);\n+    /// ```\n+    pub ITER_NEXT_SLICE,\n+    style,\n+    \"using `.iter().next()` on a sliced array, which can be shortened to just `.get()`\"\n+}\n+\n declare_lint_pass!(Methods => [\n     UNWRAP_USED,\n     EXPECT_USED,\n@@ -1273,6 +1299,7 @@ declare_lint_pass!(Methods => [\n     FIND_MAP,\n     MAP_FLATTEN,\n     ITERATOR_STEP_BY_ZERO,\n+    ITER_NEXT_SLICE,\n     ITER_NTH,\n     ITER_NTH_ZERO,\n     ITER_SKIP_NEXT,\n@@ -1320,6 +1347,7 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Methods {\n             },\n             [\"next\", \"filter\"] => lint_filter_next(cx, expr, arg_lists[1]),\n             [\"next\", \"skip_while\"] => lint_skip_while_next(cx, expr, arg_lists[1]),\n+            [\"next\", \"iter\"] => lint_iter_next(cx, expr, arg_lists[1]),\n             [\"map\", \"filter\"] => lint_filter_map(cx, expr, arg_lists[1], arg_lists[0]),\n             [\"map\", \"filter_map\"] => lint_filter_map_map(cx, expr, arg_lists[1], arg_lists[0]),\n             [\"next\", \"filter_map\"] => lint_filter_map_next(cx, expr, arg_lists[1]),\n@@ -2199,6 +2227,60 @@ fn lint_step_by<'a, 'tcx>(cx: &LateContext<'a, 'tcx>, expr: &hir::Expr<'_>, args\n     }\n }\n \n+fn lint_iter_next<'a, 'tcx>(cx: &LateContext<'a, 'tcx>, expr: &'tcx hir::Expr<'_>, iter_args: &'tcx [hir::Expr<'_>]) {\n+    let caller_expr = &iter_args[0];\n+\n+    // Skip lint if the `iter().next()` expression is a for loop argument,\n+    // since it is already covered by `&loops::ITER_NEXT_LOOP`\n+    let mut parent_expr_opt = get_parent_expr(cx, expr);\n+    while let Some(parent_expr) = parent_expr_opt {\n+        if higher::for_loop(parent_expr).is_some() {\n+            return;\n+        }\n+        parent_expr_opt = get_parent_expr(cx, parent_expr);\n+    }\n+\n+    if derefs_to_slice(cx, caller_expr, cx.tables.expr_ty(caller_expr)).is_some() {\n+        // caller is a Slice\n+        if_chain! {\n+            if let hir::ExprKind::Index(ref caller_var, ref index_expr) = &caller_expr.kind;\n+            if let Some(higher::Range { start: Some(start_expr), end: None, limits: ast::RangeLimits::HalfOpen })\n+                = higher::range(cx, index_expr);\n+            if let hir::ExprKind::Lit(ref start_lit) = &start_expr.kind;\n+            if let ast::LitKind::Int(start_idx, _) = start_lit.node;\n+            then {\n+                let mut applicability = Applicability::MachineApplicable;\n+                span_lint_and_sugg(\n+                    cx,\n+                    ITER_NEXT_SLICE,\n+                    expr.span,\n+                    \"Using `.iter().next()` on a Slice without end index.\",\n+                    \"try calling\",\n+                    format!(\"{}.get({})\", snippet_with_applicability(cx, caller_var.span, \"..\", &mut applicability), start_idx),\n+                    applicability,\n+                );\n+            }\n+        }\n+    } else if is_type_diagnostic_item(cx, cx.tables.expr_ty(caller_expr), sym!(vec_type))\n+        || matches!(&walk_ptrs_ty(cx.tables.expr_ty(caller_expr)).kind, ty::Array(_, _))\n+    {\n+        // caller is a Vec or an Array\n+        let mut applicability = Applicability::MachineApplicable;\n+        span_lint_and_sugg(\n+            cx,\n+            ITER_NEXT_SLICE,\n+            expr.span,\n+            \"Using `.iter().next()` on an array\",\n+            \"try calling\",\n+            format!(\n+                \"{}.get(0)\",\n+                snippet_with_applicability(cx, caller_expr.span, \"..\", &mut applicability)\n+            ),\n+            applicability,\n+        );\n+    }\n+}\n+\n fn lint_iter_nth<'a, 'tcx>(\n     cx: &LateContext<'a, 'tcx>,\n     expr: &hir::Expr<'_>,"}, {"sha": "a971d041ca6613182a5166e70d2b3a31f1792854", "filename": "clippy_lints/src/needless_continue.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f760d77bdb2bff46f284500f77ecc697dd8507c5/clippy_lints%2Fsrc%2Fneedless_continue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f760d77bdb2bff46f284500f77ecc697dd8507c5/clippy_lints%2Fsrc%2Fneedless_continue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_continue.rs?ref=f760d77bdb2bff46f284500f77ecc697dd8507c5", "patch": "@@ -424,7 +424,7 @@ fn erode_from_back(s: &str) -> String {\n }\n \n fn span_of_first_expr_in_block(block: &ast::Block) -> Option<Span> {\n-    block.stmts.iter().next().map(|stmt| stmt.span)\n+    block.stmts.get(0).map(|stmt| stmt.span)\n }\n \n #[cfg(test)]"}, {"sha": "f44a3e148bffdb5c6bdfd7bf89dc56e28623e306", "filename": "src/lintlist/mod.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f760d77bdb2bff46f284500f77ecc697dd8507c5/src%2Flintlist%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f760d77bdb2bff46f284500f77ecc697dd8507c5/src%2Flintlist%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flintlist%2Fmod.rs?ref=f760d77bdb2bff46f284500f77ecc697dd8507c5", "patch": "@@ -934,6 +934,13 @@ pub static ref ALL_LINTS: Vec<Lint> = vec![\n         deprecation: None,\n         module: \"loops\",\n     },\n+    Lint {\n+        name: \"iter_next_slice\",\n+        group: \"style\",\n+        desc: \"using `.iter().next()` on a sliced array, which can be shortened to just `.get()`\",\n+        deprecation: None,\n+        module: \"methods\",\n+    },\n     Lint {\n         name: \"iter_nth\",\n         group: \"perf\","}, {"sha": "7f92d0dbdc973a50fd4964ed0312600e49c02619", "filename": "tests/ui/into_iter_on_ref.fixed", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f760d77bdb2bff46f284500f77ecc697dd8507c5/tests%2Fui%2Finto_iter_on_ref.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/f760d77bdb2bff46f284500f77ecc697dd8507c5/tests%2Fui%2Finto_iter_on_ref.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Finto_iter_on_ref.fixed?ref=f760d77bdb2bff46f284500f77ecc697dd8507c5", "patch": "@@ -40,4 +40,6 @@ fn main() {\n     let _ = (&HashSet::<i32>::new()).iter(); //~ WARN equivalent to .iter()\n     let _ = std::path::Path::new(\"12/34\").iter(); //~ WARN equivalent to .iter()\n     let _ = std::path::PathBuf::from(\"12/34\").iter(); //~ ERROR equivalent to .iter()\n+\n+    let _ = (&[1, 2, 3]).iter().next(); //~ WARN equivalent to .iter()\n }"}, {"sha": "416056d3fdb9cb3fd2bc5aec5234e9ea0d0630d1", "filename": "tests/ui/into_iter_on_ref.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f760d77bdb2bff46f284500f77ecc697dd8507c5/tests%2Fui%2Finto_iter_on_ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f760d77bdb2bff46f284500f77ecc697dd8507c5/tests%2Fui%2Finto_iter_on_ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Finto_iter_on_ref.rs?ref=f760d77bdb2bff46f284500f77ecc697dd8507c5", "patch": "@@ -40,4 +40,6 @@ fn main() {\n     let _ = (&HashSet::<i32>::new()).into_iter(); //~ WARN equivalent to .iter()\n     let _ = std::path::Path::new(\"12/34\").into_iter(); //~ WARN equivalent to .iter()\n     let _ = std::path::PathBuf::from(\"12/34\").into_iter(); //~ ERROR equivalent to .iter()\n+\n+    let _ = (&[1, 2, 3]).into_iter().next(); //~ WARN equivalent to .iter()\n }"}, {"sha": "1cd6400b0195baedc7a1e09d8849859d2361f1a1", "filename": "tests/ui/into_iter_on_ref.stderr", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f760d77bdb2bff46f284500f77ecc697dd8507c5/tests%2Fui%2Finto_iter_on_ref.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f760d77bdb2bff46f284500f77ecc697dd8507c5/tests%2Fui%2Finto_iter_on_ref.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Finto_iter_on_ref.stderr?ref=f760d77bdb2bff46f284500f77ecc697dd8507c5", "patch": "@@ -156,5 +156,11 @@ error: this `.into_iter()` call is equivalent to `.iter()` and will not move the\n LL |     let _ = std::path::PathBuf::from(\"12/34\").into_iter(); //~ ERROR equivalent to .iter()\n    |                                               ^^^^^^^^^ help: call directly: `iter`\n \n-error: aborting due to 26 previous errors\n+error: this `.into_iter()` call is equivalent to `.iter()` and will not move the `array`\n+  --> $DIR/into_iter_on_ref.rs:44:26\n+   |\n+LL |     let _ = (&[1, 2, 3]).into_iter().next(); //~ WARN equivalent to .iter()\n+   |                          ^^^^^^^^^ help: call directly: `iter`\n+\n+error: aborting due to 27 previous errors\n "}, {"sha": "79c1db87ac3c43c4ac97ba7d85bbc53e7d3ce3de", "filename": "tests/ui/iter_next_slice.fixed", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/f760d77bdb2bff46f284500f77ecc697dd8507c5/tests%2Fui%2Fiter_next_slice.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/f760d77bdb2bff46f284500f77ecc697dd8507c5/tests%2Fui%2Fiter_next_slice.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fiter_next_slice.fixed?ref=f760d77bdb2bff46f284500f77ecc697dd8507c5", "patch": "@@ -0,0 +1,24 @@\n+// run-rustfix\n+#![warn(clippy::iter_next_slice)]\n+\n+fn main() {\n+    // test code goes here\n+    let s = [1, 2, 3];\n+    let v = vec![1, 2, 3];\n+\n+    s.get(0);\n+    // Should be replaced by s.get(0)\n+\n+    s.get(2);\n+    // Should be replaced by s.get(2)\n+\n+    v.get(5);\n+    // Should be replaced by v.get(5)\n+\n+    v.get(0);\n+    // Should be replaced by v.get(0)\n+\n+    let o = Some(5);\n+    o.iter().next();\n+    // Shouldn't be linted since this is not a Slice or an Array\n+}"}, {"sha": "ef9a55f3d997c1cb9916d8653786f3d7c609fcdd", "filename": "tests/ui/iter_next_slice.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/f760d77bdb2bff46f284500f77ecc697dd8507c5/tests%2Fui%2Fiter_next_slice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f760d77bdb2bff46f284500f77ecc697dd8507c5/tests%2Fui%2Fiter_next_slice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fiter_next_slice.rs?ref=f760d77bdb2bff46f284500f77ecc697dd8507c5", "patch": "@@ -0,0 +1,24 @@\n+// run-rustfix\n+#![warn(clippy::iter_next_slice)]\n+\n+fn main() {\n+    // test code goes here\n+    let s = [1, 2, 3];\n+    let v = vec![1, 2, 3];\n+\n+    s.iter().next();\n+    // Should be replaced by s.get(0)\n+\n+    s[2..].iter().next();\n+    // Should be replaced by s.get(2)\n+\n+    v[5..].iter().next();\n+    // Should be replaced by v.get(5)\n+\n+    v.iter().next();\n+    // Should be replaced by v.get(0)\n+\n+    let o = Some(5);\n+    o.iter().next();\n+    // Shouldn't be linted since this is not a Slice or an Array\n+}"}, {"sha": "bbf61df0cda68523debcdea9309072eeb61a73e6", "filename": "tests/ui/iter_next_slice.stderr", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/f760d77bdb2bff46f284500f77ecc697dd8507c5/tests%2Fui%2Fiter_next_slice.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f760d77bdb2bff46f284500f77ecc697dd8507c5/tests%2Fui%2Fiter_next_slice.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fiter_next_slice.stderr?ref=f760d77bdb2bff46f284500f77ecc697dd8507c5", "patch": "@@ -0,0 +1,28 @@\n+error: Using `.iter().next()` on an array\n+  --> $DIR/iter_next_slice.rs:9:5\n+   |\n+LL |     s.iter().next();\n+   |     ^^^^^^^^^^^^^^^ help: try calling: `s.get(0)`\n+   |\n+   = note: `-D clippy::iter-next-slice` implied by `-D warnings`\n+\n+error: Using `.iter().next()` on a Slice without end index.\n+  --> $DIR/iter_next_slice.rs:12:5\n+   |\n+LL |     s[2..].iter().next();\n+   |     ^^^^^^^^^^^^^^^^^^^^ help: try calling: `s.get(2)`\n+\n+error: Using `.iter().next()` on a Slice without end index.\n+  --> $DIR/iter_next_slice.rs:15:5\n+   |\n+LL |     v[5..].iter().next();\n+   |     ^^^^^^^^^^^^^^^^^^^^ help: try calling: `v.get(5)`\n+\n+error: Using `.iter().next()` on an array\n+  --> $DIR/iter_next_slice.rs:18:5\n+   |\n+LL |     v.iter().next();\n+   |     ^^^^^^^^^^^^^^^ help: try calling: `v.get(0)`\n+\n+error: aborting due to 4 previous errors\n+"}, {"sha": "be37dc16b9a3effcc6aec5b4fd92f1de7a2412c5", "filename": "tests/ui/needless_collect.fixed", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f760d77bdb2bff46f284500f77ecc697dd8507c5/tests%2Fui%2Fneedless_collect.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/f760d77bdb2bff46f284500f77ecc697dd8507c5/tests%2Fui%2Fneedless_collect.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_collect.fixed?ref=f760d77bdb2bff46f284500f77ecc697dd8507c5", "patch": "@@ -9,7 +9,7 @@ use std::collections::{BTreeSet, HashMap, HashSet};\n fn main() {\n     let sample = [1; 5];\n     let len = sample.iter().count();\n-    if sample.iter().next().is_none() {\n+    if sample.get(0).is_none() {\n         // Empty\n     }\n     sample.iter().cloned().any(|x| x == 1);"}, {"sha": "9113aad90dd7cc120e89748f5df590f74878f174", "filename": "tests/ui/needless_collect.stderr", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/f760d77bdb2bff46f284500f77ecc697dd8507c5/tests%2Fui%2Fneedless_collect.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f760d77bdb2bff46f284500f77ecc697dd8507c5/tests%2Fui%2Fneedless_collect.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_collect.stderr?ref=f760d77bdb2bff46f284500f77ecc697dd8507c5", "patch": "@@ -1,28 +1,28 @@\n error: avoid using `collect()` when not needed\n-  --> $DIR/needless_collect.rs:11:28\n+  --> $DIR/needless_collect.rs:11:29\n    |\n LL |     let len = sample.iter().collect::<Vec<_>>().len();\n-   |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^ help: replace with: `.count()`\n+   |                             ^^^^^^^^^^^^^^^^^^^^^^^^^ help: replace with: `count()`\n    |\n    = note: `-D clippy::needless-collect` implied by `-D warnings`\n \n error: avoid using `collect()` when not needed\n-  --> $DIR/needless_collect.rs:12:21\n+  --> $DIR/needless_collect.rs:12:15\n    |\n LL |     if sample.iter().collect::<Vec<_>>().is_empty() {\n-   |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: replace with: `.next().is_none()`\n+   |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: replace with: `get(0).is_none()`\n \n error: avoid using `collect()` when not needed\n-  --> $DIR/needless_collect.rs:15:27\n+  --> $DIR/needless_collect.rs:15:28\n    |\n LL |     sample.iter().cloned().collect::<Vec<_>>().contains(&1);\n-   |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: replace with: `.any(|x| x == 1)`\n+   |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: replace with: `any(|x| x == 1)`\n \n error: avoid using `collect()` when not needed\n-  --> $DIR/needless_collect.rs:16:34\n+  --> $DIR/needless_collect.rs:16:35\n    |\n LL |     sample.iter().map(|x| (x, x)).collect::<HashMap<_, _>>().len();\n-   |                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: replace with: `.count()`\n+   |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: replace with: `count()`\n \n error: aborting due to 4 previous errors\n "}]}