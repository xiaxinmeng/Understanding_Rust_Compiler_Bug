{"sha": "13d1802b8882452f7d9d1bf514a096c5c8a22303", "node_id": "C_kwDOAAsO6NoAKDEzZDE4MDJiODg4MjQ1MmY3ZDlkMWJmNTE0YTA5NmM1YzhhMjIzMDM", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-04-12T02:30:21Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-04-12T02:30:21Z"}, "message": "Auto merge of #109895 - nikic:llvm-16-tests, r=cuviper\n\nAdd codegen tests for issues fixed by LLVM 16\n\nFixes #75978.\nFixes #99960.\nFixes #101048.\nFixes #101082.\nFixes #101814.\nFixes #103132.\nFixes #103327.", "tree": {"sha": "7e5daa49628fddbedf6eedcefb48b30d90f8ad1c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7e5daa49628fddbedf6eedcefb48b30d90f8ad1c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/13d1802b8882452f7d9d1bf514a096c5c8a22303", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/13d1802b8882452f7d9d1bf514a096c5c8a22303", "html_url": "https://github.com/rust-lang/rust/commit/13d1802b8882452f7d9d1bf514a096c5c8a22303", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/13d1802b8882452f7d9d1bf514a096c5c8a22303/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e7271f4b92ce3cbc1bb3ae5081d8c61d5ea63c8c", "url": "https://api.github.com/repos/rust-lang/rust/commits/e7271f4b92ce3cbc1bb3ae5081d8c61d5ea63c8c", "html_url": "https://github.com/rust-lang/rust/commit/e7271f4b92ce3cbc1bb3ae5081d8c61d5ea63c8c"}, {"sha": "83f525cc2897d3561e268d3ea2207cd49a1c1bff", "url": "https://api.github.com/repos/rust-lang/rust/commits/83f525cc2897d3561e268d3ea2207cd49a1c1bff", "html_url": "https://github.com/rust-lang/rust/commit/83f525cc2897d3561e268d3ea2207cd49a1c1bff"}], "stats": {"total": 118, "additions": 118, "deletions": 0}, "files": [{"sha": "efa4db93ec212fd850059c73c5c2de4f3cef85de", "filename": "tests/codegen/issues/issue-101048.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/13d1802b8882452f7d9d1bf514a096c5c8a22303/tests%2Fcodegen%2Fissues%2Fissue-101048.rs", "raw_url": "https://github.com/rust-lang/rust/raw/13d1802b8882452f7d9d1bf514a096c5c8a22303/tests%2Fcodegen%2Fissues%2Fissue-101048.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcodegen%2Fissues%2Fissue-101048.rs?ref=13d1802b8882452f7d9d1bf514a096c5c8a22303", "patch": "@@ -0,0 +1,13 @@\n+// compile-flags: -O\n+// min-llvm-version: 16\n+\n+#![crate_type = \"lib\"]\n+\n+#[no_mangle]\n+pub fn all_zero(data: &[u64]) -> bool {\n+    // CHECK-LABEL: @all_zero(\n+    // CHECK: [[PHI:%.*]] = phi i1\n+    // CHECK-NOT: phi i8\n+    // CHECK-NOT: zext\n+    data.iter().copied().fold(true, |acc, x| acc & (x == 0))\n+}"}, {"sha": "2cbe99942cba3e26c079c3da4a4c2d545e95d63c", "filename": "tests/codegen/issues/issue-101082.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/13d1802b8882452f7d9d1bf514a096c5c8a22303/tests%2Fcodegen%2Fissues%2Fissue-101082.rs", "raw_url": "https://github.com/rust-lang/rust/raw/13d1802b8882452f7d9d1bf514a096c5c8a22303/tests%2Fcodegen%2Fissues%2Fissue-101082.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcodegen%2Fissues%2Fissue-101082.rs?ref=13d1802b8882452f7d9d1bf514a096c5c8a22303", "patch": "@@ -0,0 +1,17 @@\n+// compile-flags: -O\n+// min-llvm-version: 16\n+// ignore-debug: the debug assertions get in the way\n+\n+#![crate_type = \"lib\"]\n+\n+#[no_mangle]\n+pub fn test() -> usize {\n+    // CHECK-LABEL: @test(\n+    // CHECK: ret {{i64|i32}} 165\n+    let values = [23, 16, 54, 3, 60, 9];\n+    let mut acc = 0;\n+    for item in values {\n+        acc += item;\n+    }\n+    acc\n+}"}, {"sha": "13796352c0285061c51bdb9892bff2131691e0de", "filename": "tests/codegen/issues/issue-101814.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/13d1802b8882452f7d9d1bf514a096c5c8a22303/tests%2Fcodegen%2Fissues%2Fissue-101814.rs", "raw_url": "https://github.com/rust-lang/rust/raw/13d1802b8882452f7d9d1bf514a096c5c8a22303/tests%2Fcodegen%2Fissues%2Fissue-101814.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcodegen%2Fissues%2Fissue-101814.rs?ref=13d1802b8882452f7d9d1bf514a096c5c8a22303", "patch": "@@ -0,0 +1,20 @@\n+// compile-flags: -O\n+// min-llvm-version: 16\n+// ignore-debug: the debug assertions get in the way\n+\n+#![crate_type = \"lib\"]\n+\n+#[no_mangle]\n+pub fn test(a: [i32; 10]) -> i32 {\n+    // CHECK-LABEL: @test(\n+    // CHECK: [[L1:%.+]] = load i32\n+    // CHECK: [[L2:%.+]] = load i32\n+    // CHECK: [[R:%.+]] = add i32 [[L1]], [[L2]]\n+    // CHECK: ret i32 [[R]]\n+    let mut sum = 0;\n+    for v in a.iter().skip(8) {\n+        sum += v;\n+    }\n+\n+    sum\n+}"}, {"sha": "cc87d7cd2b9dab65954608f704358343869dd66e", "filename": "tests/codegen/issues/issue-103132.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/13d1802b8882452f7d9d1bf514a096c5c8a22303/tests%2Fcodegen%2Fissues%2Fissue-103132.rs", "raw_url": "https://github.com/rust-lang/rust/raw/13d1802b8882452f7d9d1bf514a096c5c8a22303/tests%2Fcodegen%2Fissues%2Fissue-103132.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcodegen%2Fissues%2Fissue-103132.rs?ref=13d1802b8882452f7d9d1bf514a096c5c8a22303", "patch": "@@ -0,0 +1,16 @@\n+// compile-flags: -O -C overflow-checks\n+// min-llvm-version: 16\n+\n+#![crate_type = \"lib\"]\n+\n+#[no_mangle]\n+pub fn test(arr: &[u8], weight: u32) {\n+    // CHECK-LABEL: @test(\n+    // CHECK-NOT: panic\n+    let weight = weight.min(256 * 256 * 256);\n+\n+    for x in arr {\n+        assert!(weight <= 256 * 256 * 256);\n+        let result = *x as u32 * weight;\n+    }\n+}"}, {"sha": "cee00faccc811b15a1a0917d6da706dd1ce583aa", "filename": "tests/codegen/issues/issue-103327.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/13d1802b8882452f7d9d1bf514a096c5c8a22303/tests%2Fcodegen%2Fissues%2Fissue-103327.rs", "raw_url": "https://github.com/rust-lang/rust/raw/13d1802b8882452f7d9d1bf514a096c5c8a22303/tests%2Fcodegen%2Fissues%2Fissue-103327.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcodegen%2Fissues%2Fissue-103327.rs?ref=13d1802b8882452f7d9d1bf514a096c5c8a22303", "patch": "@@ -0,0 +1,18 @@\n+// compile-flags: -O\n+// min-llvm-version: 16\n+\n+#![crate_type = \"lib\"]\n+\n+#[no_mangle]\n+pub fn test(a: i32, b: i32) -> bool {\n+    // CHECK-LABEL: @test(\n+    // CHECK: ret i1 true\n+    let c1 = (a >= 0) && (a <= 10);\n+    let c2 = (b >= 0) && (b <= 20);\n+\n+    if c1 & c2 {\n+        a + 100 != b\n+    } else {\n+        true\n+    }\n+}"}, {"sha": "f335e92c3dc446a2dc82565b8f34e8a8d647d948", "filename": "tests/codegen/issues/issue-75978.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/13d1802b8882452f7d9d1bf514a096c5c8a22303/tests%2Fcodegen%2Fissues%2Fissue-75978.rs", "raw_url": "https://github.com/rust-lang/rust/raw/13d1802b8882452f7d9d1bf514a096c5c8a22303/tests%2Fcodegen%2Fissues%2Fissue-75978.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcodegen%2Fissues%2Fissue-75978.rs?ref=13d1802b8882452f7d9d1bf514a096c5c8a22303", "patch": "@@ -0,0 +1,19 @@\n+// compile-flags: -O\n+// min-llvm-version: 16\n+\n+#![crate_type = \"lib\"]\n+\n+#[no_mangle]\n+pub fn test() -> u32 {\n+    // CHECK-LABEL: @test(\n+    // CHECK: ret i32 13\n+    let s = [1, 2, 3, 4, 5, 6, 7];\n+\n+    let mut iter = s.iter();\n+    let mut sum = 0;\n+    while let Some(_) = iter.next() {\n+        sum += iter.next().map_or(1, |&x| x)\n+    }\n+\n+    sum\n+}"}, {"sha": "e9c9367fa64b6f9a1d96d9d3aa91fb4006c87602", "filename": "tests/codegen/issues/issue-99960.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/13d1802b8882452f7d9d1bf514a096c5c8a22303/tests%2Fcodegen%2Fissues%2Fissue-99960.rs", "raw_url": "https://github.com/rust-lang/rust/raw/13d1802b8882452f7d9d1bf514a096c5c8a22303/tests%2Fcodegen%2Fissues%2Fissue-99960.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcodegen%2Fissues%2Fissue-99960.rs?ref=13d1802b8882452f7d9d1bf514a096c5c8a22303", "patch": "@@ -0,0 +1,15 @@\n+// compile-flags: -O\n+// min-llvm-version: 16\n+\n+#![crate_type = \"lib\"]\n+\n+#[no_mangle]\n+pub fn test(dividend: i64, divisor: i64) -> Option<i64> {\n+    // CHECK-LABEL: @test(\n+    // CHECK-NOT: panic\n+    if dividend > i64::min_value() && divisor != 0 {\n+        Some(dividend / divisor)\n+    } else {\n+        None\n+    }\n+}"}]}