{"sha": "aaaffa9a3ee4851422ff435bf6b24dd2e55da171", "node_id": "C_kwDOAAsO6NoAKGFhYWZmYTlhM2VlNDg1MTQyMmZmNDM1YmY2YjI0ZGQyZTU1ZGExNzE", "commit": {"author": {"name": "Ezra Shaw", "email": "ezrasure@outlook.com", "date": "2023-03-04T08:08:15Z"}, "committer": {"name": "Ezra Shaw", "email": "ezrasure@outlook.com", "date": "2023-03-04T20:34:00Z"}, "message": "feat: impl better help for `.poll()` not found on `impl Future`", "tree": {"sha": "0d621fbbcf645240df4ef06e24d679a14ad8b5b9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0d621fbbcf645240df4ef06e24d679a14ad8b5b9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aaaffa9a3ee4851422ff435bf6b24dd2e55da171", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEINUdoc4Vb1yVx04IZ6vxb7Ds2HAFAmQDqzgACgkQZ6vxb7Ds\n2HAV7xAAxyYo7c/WWtPF49d3lnAs/oRr6FeindnoUSfpgXxRNjLuIA2BankFiEqJ\nUi6/wV6+zC+TZQRLF+m1S9uTIku4wkQRTJXE3wRVqKKkOJO+QGh0c7AR4aMcOC7I\nwgWRvqjWkgM2QNW4OilbjZte/w1CUYZbtu9p/Sz85WMxlsJdYEeC/aqJEz7wkkf9\nV1ZQy5nshhHDs5H0oE+B79WY/AK4zw5DdtQ46qWQV1Z+zxgY8jNNGXdQzqy1oagw\noUAb5V5S9oUA/B/vLFneogY6wQpMYzfPRpky896u94mZ524UdhgK7bnv2c050xuj\nkxdP8N30pZPw1FSRl24tMURoxpWDUaEYCYW/dkTrCxvHN1CKkMAZ0aNOH9GDBhQ4\nb/S8uPz/gV4ScJ4Xafg8CuZawimDLT+g24RNiF7mjhnucVCGVeUhqspSuQblF7Bp\nKzyRMwtXNeAG9aJGsamU5qlvFTm2fg1je333OvV+vSzEGVctWmu8GMAj/XvgIu1Q\nWdha/6BQyg/qeNR5HTHkD6qouTd43aRmCVQFMWaXnf3spm96V4U/dnsER83SzPNx\ntxf1DOgDZn1+poyrHBEBq2xgToQLd5WatntmdX0L4/4aGSv9nCdB7m+hFARwS09Q\n+xHjR6P9YhoMPi6eBYOelqaVncI41XaItFoI92SX/yp+HS9BFL0=\n=rc3P\n-----END PGP SIGNATURE-----", "payload": "tree 0d621fbbcf645240df4ef06e24d679a14ad8b5b9\nparent 0fbfc3e76916521b509b63286296dd0762170d34\nauthor Ezra Shaw <ezrasure@outlook.com> 1677917295 +1300\ncommitter Ezra Shaw <ezrasure@outlook.com> 1677962040 +1300\n\nfeat: impl better help for `.poll()` not found on `impl Future`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aaaffa9a3ee4851422ff435bf6b24dd2e55da171", "html_url": "https://github.com/rust-lang/rust/commit/aaaffa9a3ee4851422ff435bf6b24dd2e55da171", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aaaffa9a3ee4851422ff435bf6b24dd2e55da171/comments", "author": {"login": "Ezrashaw", "id": 38062690, "node_id": "MDQ6VXNlcjM4MDYyNjkw", "avatar_url": "https://avatars.githubusercontent.com/u/38062690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ezrashaw", "html_url": "https://github.com/Ezrashaw", "followers_url": "https://api.github.com/users/Ezrashaw/followers", "following_url": "https://api.github.com/users/Ezrashaw/following{/other_user}", "gists_url": "https://api.github.com/users/Ezrashaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ezrashaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ezrashaw/subscriptions", "organizations_url": "https://api.github.com/users/Ezrashaw/orgs", "repos_url": "https://api.github.com/users/Ezrashaw/repos", "events_url": "https://api.github.com/users/Ezrashaw/events{/privacy}", "received_events_url": "https://api.github.com/users/Ezrashaw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Ezrashaw", "id": 38062690, "node_id": "MDQ6VXNlcjM4MDYyNjkw", "avatar_url": "https://avatars.githubusercontent.com/u/38062690?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ezrashaw", "html_url": "https://github.com/Ezrashaw", "followers_url": "https://api.github.com/users/Ezrashaw/followers", "following_url": "https://api.github.com/users/Ezrashaw/following{/other_user}", "gists_url": "https://api.github.com/users/Ezrashaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ezrashaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ezrashaw/subscriptions", "organizations_url": "https://api.github.com/users/Ezrashaw/orgs", "repos_url": "https://api.github.com/users/Ezrashaw/repos", "events_url": "https://api.github.com/users/Ezrashaw/events{/privacy}", "received_events_url": "https://api.github.com/users/Ezrashaw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0fbfc3e76916521b509b63286296dd0762170d34", "url": "https://api.github.com/repos/rust-lang/rust/commits/0fbfc3e76916521b509b63286296dd0762170d34", "html_url": "https://github.com/rust-lang/rust/commit/0fbfc3e76916521b509b63286296dd0762170d34"}], "stats": {"total": 34, "additions": 34, "deletions": 0}, "files": [{"sha": "5d09915c7495c59a6584da9c6be14f7f9b3faefd", "filename": "compiler/rustc_hir_typeck/src/method/suggest.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/aaaffa9a3ee4851422ff435bf6b24dd2e55da171/compiler%2Frustc_hir_typeck%2Fsrc%2Fmethod%2Fsuggest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aaaffa9a3ee4851422ff435bf6b24dd2e55da171/compiler%2Frustc_hir_typeck%2Fsrc%2Fmethod%2Fsuggest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fmethod%2Fsuggest.rs?ref=aaaffa9a3ee4851422ff435bf6b24dd2e55da171", "patch": "@@ -348,6 +348,16 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n             err.downgrade_to_delayed_bug();\n         }\n \n+        if tcx.ty_is_opaque_future(rcvr_ty) && item_name.name == sym::poll {\n+            err.help(&format!(\n+                \"method `poll` found on `Pin<&mut {ty_str}>`, \\\n+                see documentation for `std::pin::Pin`\"\n+            ));\n+            err.help(\"self type must be pinned to call `Future::poll`, \\\n+                see https://rust-lang.github.io/async-book/04_pinning/01_chapter.html#pinning-in-practice\"\n+            );\n+        }\n+\n         if let Mode::MethodCall = mode && let SelfSource::MethodCall(cal) = source {\n             self.suggest_await_before_method(\n                 &mut err, item_name, rcvr_ty, cal, span, expected.only_has_type(self),"}, {"sha": "efcb8b8ebab0a7ebbc326870a510d10d57de96f6", "filename": "tests/ui/async-await/issue-108572.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/aaaffa9a3ee4851422ff435bf6b24dd2e55da171/tests%2Fui%2Fasync-await%2Fissue-108572.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aaaffa9a3ee4851422ff435bf6b24dd2e55da171/tests%2Fui%2Fasync-await%2Fissue-108572.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fasync-await%2Fissue-108572.rs?ref=aaaffa9a3ee4851422ff435bf6b24dd2e55da171", "patch": "@@ -0,0 +1,12 @@\n+// edition: 2021\n+\n+use std::future::Future;\n+fn foo() -> impl Future<Output=()> {\n+    async { }\n+}\n+\n+fn main() {\n+    let fut = foo();\n+    fut.poll();\n+    //~^ ERROR no method named `poll` found for opaque type `impl Future<Output = ()>` in the current scope [E0599]\n+}"}, {"sha": "0dbcf4d660a98a1d74e7b0b8ca7402da4b3c7323", "filename": "tests/ui/async-await/issue-108572.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/aaaffa9a3ee4851422ff435bf6b24dd2e55da171/tests%2Fui%2Fasync-await%2Fissue-108572.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/aaaffa9a3ee4851422ff435bf6b24dd2e55da171/tests%2Fui%2Fasync-await%2Fissue-108572.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fasync-await%2Fissue-108572.stderr?ref=aaaffa9a3ee4851422ff435bf6b24dd2e55da171", "patch": "@@ -0,0 +1,12 @@\n+error[E0599]: no method named `poll` found for opaque type `impl Future<Output = ()>` in the current scope\n+  --> $DIR/issue-108572.rs:10:9\n+   |\n+LL |     fut.poll();\n+   |         ^^^^ method not found in `impl Future<Output = ()>`\n+   |\n+   = help: method `poll` found on `Pin<&mut impl Future<Output = ()>>`, see documentation for `std::pin::Pin`\n+   = help: self type must be pinned to call `Future::poll`, see https://rust-lang.github.io/async-book/04_pinning/01_chapter.html#pinning-in-practice\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0599`."}]}