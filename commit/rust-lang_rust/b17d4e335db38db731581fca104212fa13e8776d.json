{"sha": "b17d4e335db38db731581fca104212fa13e8776d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIxN2Q0ZTMzNWRiMzhkYjczMTU4MWZjYTEwNDIxMmZhMTNlODc3NmQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-11-06T02:31:09Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-11-06T02:31:09Z"}, "message": "auto merge of #10299 : alexcrichton/rust/osx-loader-path-fix, r=brson\n\nAccording to apple's documentation of rpath semantics, `@executable_path` means\r\nthat the path is relative the the *process executable*, not necessarily the\r\nlibrary in question. On the other hand, `@loader_path` is the path that points to\r\nthe library which contains the `@loader_path` reference. All of our rpath usage is\r\nbased off the library or executable, not just the executable. This means that on\r\nOSX we should be using `@loader_path` instead of `@executable_path` to achieve the\r\nsame semantics as linux's $ORIGIN.\r\n\r\nThe purpose of this is to unblock the current snapshot from landing. It appears that because we were propagating linker arguments we never saw this before. Now that we're no longer printing linker arguments, we're depending on the libraries to resolve their own references. In using `@executable_path` on OSX, libraries in different locations than the executable were not able to resolve their references (because their rpaths listed were all relative to the location of the library, not the executable).\r\n\r\nI'm still a little unclear on how this ever passed locally on my own machine, but it's clear why this is failing on the bots at least.", "tree": {"sha": "d3999e0bafac4cc70285ce1ebadead14e16f5fea", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d3999e0bafac4cc70285ce1ebadead14e16f5fea"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b17d4e335db38db731581fca104212fa13e8776d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b17d4e335db38db731581fca104212fa13e8776d", "html_url": "https://github.com/rust-lang/rust/commit/b17d4e335db38db731581fca104212fa13e8776d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b17d4e335db38db731581fca104212fa13e8776d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "99e866392f2b39bf9424d954fde2cb881c81a08d", "url": "https://api.github.com/repos/rust-lang/rust/commits/99e866392f2b39bf9424d954fde2cb881c81a08d", "html_url": "https://github.com/rust-lang/rust/commit/99e866392f2b39bf9424d954fde2cb881c81a08d"}, {"sha": "243c0dac8fe7e06125bad7b1f87a61794c8636f1", "url": "https://api.github.com/repos/rust-lang/rust/commits/243c0dac8fe7e06125bad7b1f87a61794c8636f1", "html_url": "https://github.com/rust-lang/rust/commit/243c0dac8fe7e06125bad7b1f87a61794c8636f1"}], "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "6f76b228d3e3ec300918950f77d37a424e005603", "filename": "src/librustc/back/rpath.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b17d4e335db38db731581fca104212fa13e8776d/src%2Flibrustc%2Fback%2Frpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b17d4e335db38db731581fca104212fa13e8776d/src%2Flibrustc%2Fback%2Frpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fback%2Frpath.rs?ref=b17d4e335db38db731581fca104212fa13e8776d", "patch": "@@ -118,7 +118,7 @@ pub fn get_rpath_relative_to_output(os: session::Os,\n     let prefix = match os {\n         session::OsAndroid | session::OsLinux | session::OsFreebsd\n                           => \"$ORIGIN\",\n-        session::OsMacos => \"@executable_path\",\n+        session::OsMacos => \"@loader_path\",\n         session::OsWin32 => unreachable!()\n     };\n \n@@ -241,7 +241,7 @@ mod test {\n         let res = get_rpath_relative_to_output(o,\n                                                &Path::new(\"bin/rustc\"),\n                                                &Path::new(\"lib/libstd.so\"));\n-        assert_eq!(res.as_slice(), \"@executable_path/../lib\");\n+        assert_eq!(res.as_slice(), \"@loader_path/../lib\");\n     }\n \n     #[test]"}]}