{"sha": "0340ddeb3bcfcd0cfe6a0c4745293ecf2b733dac", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAzNDBkZGViM2JjZmNkMGNmZTZhMGM0NzQ1MjkzZWNmMmI3MzNkYWM=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-02-12T01:28:29Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-02-12T01:38:09Z"}, "message": "travis: Add builders without assertions\n\nThis commit adds three new builders, one OSX, one Linux, and one MSVC, which\nwill produce \"nightlies\" with LLVM assertions disabled. Currently all nightly\nreleases have LLVM assertions enabled to catch bugs before they reach the\nbeta/stable channels. The beta/stable channels, however, do not have LLVM\nassertions enabled.\n\nUnfortunately though projects like Servo are stuck on nightlies for the near\nfuture at least and are also suffering very long compile times. The purpose of\nthis commit is to provide artifacts to these projects which are not distributed\nthrough normal channels (e.g. rustup) but are provided for developers to use\nlocally if need be.\n\nLogistically these builds will all be uploaded to `rustc-builds-alt` instead of\nthe `rustc-builds` folder of the `rust-lang-ci` bucket. These builds will stay\nthere forever (until cleaned out if necessary) and there are no plans to\nintegrate this with rustup and/or the official release process.", "tree": {"sha": "f83a7526ccbd5989c94f1a624e48d6401f7cd938", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f83a7526ccbd5989c94f1a624e48d6401f7cd938"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0340ddeb3bcfcd0cfe6a0c4745293ecf2b733dac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0340ddeb3bcfcd0cfe6a0c4745293ecf2b733dac", "html_url": "https://github.com/rust-lang/rust/commit/0340ddeb3bcfcd0cfe6a0c4745293ecf2b733dac", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0340ddeb3bcfcd0cfe6a0c4745293ecf2b733dac/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f80514426aaf59967e08f32ec44c1876cdeffe9d", "url": "https://api.github.com/repos/rust-lang/rust/commits/f80514426aaf59967e08f32ec44c1876cdeffe9d", "html_url": "https://github.com/rust-lang/rust/commit/f80514426aaf59967e08f32ec44c1876cdeffe9d"}], "stats": {"total": 57, "additions": 56, "deletions": 1}, "files": [{"sha": "537849964ab415ae0470e45ea57a79e2ad905ae4", "filename": ".travis.yml", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/0340ddeb3bcfcd0cfe6a0c4745293ecf2b733dac/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/0340ddeb3bcfcd0cfe6a0c4745293ecf2b733dac/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=0340ddeb3bcfcd0cfe6a0c4745293ecf2b733dac", "patch": "@@ -65,6 +65,20 @@ matrix:\n       osx_image: xcode8.2\n       install: *osx_install_sccache\n \n+    # \"alternate\" deployments, these are \"nightlies\" but don't have assertions\n+    # turned on, they're deployed to a different location primarily for projects\n+    # which are stuck on nightly and don't want llvm assertions in the artifacts\n+    # that they use.\n+    - env: IMAGE=dist-x86-linux DEPLOY_ALT=1\n+    - env: >\n+        RUST_CHECK_TARGET=dist\n+        RUST_CONFIGURE_ARGS=\"--enable-extended\"\n+        SRC=.\n+        DEPLOY_ALT=1\n+      os: osx\n+      osx_image: xcode8.2\n+      install: *osx_install_sccache\n+\n env:\n   global:\n     - SCCACHE_BUCKET=rust-lang-ci-sccache\n@@ -125,3 +139,19 @@ deploy:\n     on:\n       branch: auto\n       condition: $DEPLOY = 1\n+\n+  # this is the same as the above deployment provider except that it uploads to\n+  # a slightly different directory and has a different trigger\n+  - provider: s3\n+    bucket: rust-lang-ci\n+    skip_cleanup: true\n+    local_dir: deploy\n+    upload_dir: rustc-builds-alt\n+    acl: public_read\n+    region: us-east-1\n+    access_key_id: AKIAIPQVNYF2T3DTYIWQ\n+    secret_access_key:\n+      secure: \"FBqDqOTeIPMu6v/WYPf4CFSlh9rLRZGKVtpLa5KkyuOhXRTrnEzBduEtS8/FMIxdQImvurhSvxWvqRybMOi4qoVfjMqqpHAI7uBbidbrvAcJoHNsx6BgUNVCIoH6a0UsAjTUtm6/YPIpzbHoLZXPL0GrHPMk6Mu04qVSmcYNWn4=\"\n+    on:\n+      branch: auto\n+      condition: $DEPLOY_ALT = 1"}, {"sha": "38781d281c8ec4256b2dc05c20879b9c557a3962", "filename": "appveyor.yml", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/0340ddeb3bcfcd0cfe6a0c4745293ecf2b733dac/appveyor.yml", "raw_url": "https://github.com/rust-lang/rust/raw/0340ddeb3bcfcd0cfe6a0c4745293ecf2b733dac/appveyor.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/appveyor.yml?ref=0340ddeb3bcfcd0cfe6a0c4745293ecf2b733dac", "patch": "@@ -61,6 +61,12 @@ environment:\n     MINGW_DIR: mingw64\n     DEPLOY: 1\n \n+  # \"alternate\" deployment, see .travis.yml for more info\n+  - MSYS_BITS: 64\n+    RUST_CONFIGURE_ARGS: --build=x86_64-pc-windows-msvc --enable-extended\n+    SCRIPT: python x.py dist\n+    DEPLOY_ALT: 1\n+\n matrix:\n   fast_finish: true\n \n@@ -146,6 +152,22 @@ deploy:\n       branch: auto\n       DEPLOY: 1\n \n+  # This provider is the same as the one above except that it has a slightly\n+  # different upload directory and a slightly different trigger\n+  - provider: S3\n+    skip_cleanup: true\n+    access_key_id: AKIAIPQVNYF2T3DTYIWQ\n+    secret_access_key:\n+      secure: +11jsUNFTQ9dq5Ad1i2+PeUJaXluFJ0zIJAXESE1dFT3Kdjku4/eDdgyjgsB6GnV\n+    bucket: rust-lang-ci\n+    set_public: true\n+    region: us-east-1\n+    artifact: /.*/\n+    folder: rustc-builds-alt\n+    on:\n+      branch: auto\n+      DEPLOY_ALT: 1\n+\n # init:\n #   - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))\n # on_finish:"}, {"sha": "892c5baa5c64b03944f454e3759424c86ff3f083", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0340ddeb3bcfcd0cfe6a0c4745293ecf2b733dac/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/0340ddeb3bcfcd0cfe6a0c4745293ecf2b733dac/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=0340ddeb3bcfcd0cfe6a0c4745293ecf2b733dac", "patch": "@@ -49,6 +49,7 @@ exec docker \\\n   $args \\\n   --env CARGO_HOME=/cargo \\\n   --env DEPLOY=$DEPLOY \\\n+  --env DEPLOY_ALT=$DEPLOY_ALT \\\n   --env LOCAL_USER_ID=`id -u` \\\n   --volume \"$HOME/.cargo:/cargo\" \\\n   --rm \\"}, {"sha": "41230aedbfa0188d1b2109c95de90897a5f6aa9e", "filename": "src/ci/run.sh", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0340ddeb3bcfcd0cfe6a0c4745293ecf2b733dac/src%2Fci%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/0340ddeb3bcfcd0cfe6a0c4745293ecf2b733dac/src%2Fci%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Frun.sh?ref=0340ddeb3bcfcd0cfe6a0c4745293ecf2b733dac", "patch": "@@ -30,12 +30,14 @@ RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --disable-manage-submodules\"\n #\n # FIXME: need a scheme for changing this `nightly` value to `beta` and `stable`\n #        either automatically or manually.\n-if [ \"$DEPLOY\" != \"\" ]; then\n+if [ \"$DEPLOY$DEPLOY_ALT\" != \"\" ]; then\n   RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --release-channel=nightly\"\n   RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --enable-llvm-static-stdcpp\"\n \n   if [ \"$NO_LLVM_ASSERTIONS\" = \"1\" ]; then\n     RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --disable-llvm-assertions\"\n+  elif [ \"$DEPLOY_ALT\" != \"\" ]; then\n+    RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --disable-llvm-assertions\"\n   fi\n else\n   RUST_CONFIGURE_ARGS=\"$RUST_CONFIGURE_ARGS --enable-debug-assertions\""}]}