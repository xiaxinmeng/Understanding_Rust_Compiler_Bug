{"sha": "ed7e438f87a6b2b036db06608d23f23b50d54d6c", "node_id": "C_kwDOAAsO6NoAKGVkN2U0MzhmODdhNmIyYjAzNmRiMDY2MDhkMjNmMjNiNTBkNTRkNmM", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-11-06T15:36:23Z"}, "committer": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-11-06T16:58:02Z"}, "message": "use filter(|x| matches!(..)) instead of filter_map(|x| match x ... => Some(xy))", "tree": {"sha": "db12943de3d802ca1c0a6619a6d017a0a962a8bf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/db12943de3d802ca1c0a6619a6d017a0a962a8bf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ed7e438f87a6b2b036db06608d23f23b50d54d6c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ed7e438f87a6b2b036db06608d23f23b50d54d6c", "html_url": "https://github.com/rust-lang/rust/commit/ed7e438f87a6b2b036db06608d23f23b50d54d6c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ed7e438f87a6b2b036db06608d23f23b50d54d6c/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3cd3bbecc5e498465e89be8a33d2936aaebed0bf", "url": "https://api.github.com/repos/rust-lang/rust/commits/3cd3bbecc5e498465e89be8a33d2936aaebed0bf", "html_url": "https://github.com/rust-lang/rust/commit/3cd3bbecc5e498465e89be8a33d2936aaebed0bf"}], "stats": {"total": 36, "additions": 12, "deletions": 24}, "files": [{"sha": "1ed264b2c95f95dbbc1be5eed197e17d5dae5d6e", "filename": "compiler/rustc_resolve/src/late/lifetimes.rs", "status": "modified", "additions": 8, "deletions": 20, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/ed7e438f87a6b2b036db06608d23f23b50d54d6c/compiler%2Frustc_resolve%2Fsrc%2Flate%2Flifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed7e438f87a6b2b036db06608d23f23b50d54d6c/compiler%2Frustc_resolve%2Fsrc%2Flate%2Flifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate%2Flifetimes.rs?ref=ed7e438f87a6b2b036db06608d23f23b50d54d6c", "patch": "@@ -887,10 +887,7 @@ impl<'a, 'tcx> Visitor<'tcx> for LifetimeContext<'a, 'tcx> {\n                 let (lifetimes, binders): (FxIndexMap<hir::ParamName, Region>, Vec<_>) = c\n                     .generic_params\n                     .iter()\n-                    .filter_map(|param| match param.kind {\n-                        GenericParamKind::Lifetime { .. } => Some(param),\n-                        _ => None,\n-                    })\n+                    .filter(|param| matches!(param.kind, GenericParamKind::Lifetime { .. }))\n                     .enumerate()\n                     .map(|(late_bound_idx, param)| {\n                         let pair = Region::late(late_bound_idx as u32, &self.tcx.hir(), param);\n@@ -1370,9 +1367,8 @@ impl<'a, 'tcx> Visitor<'tcx> for LifetimeContext<'a, 'tcx> {\n                         let (lifetimes, binders): (FxIndexMap<hir::ParamName, Region>, Vec<_>) =\n                             bound_generic_params\n                                 .iter()\n-                                .filter_map(|param| match param.kind {\n-                                    GenericParamKind::Lifetime { .. } => Some(param),\n-                                    _ => None,\n+                                .filter(|param| {\n+                                    matches!(param.kind, GenericParamKind::Lifetime { .. })\n                                 })\n                                 .enumerate()\n                                 .map(|(late_bound_idx, param)| {\n@@ -1469,10 +1465,7 @@ impl<'a, 'tcx> Visitor<'tcx> for LifetimeContext<'a, 'tcx> {\n         let binders_iter = trait_ref\n             .bound_generic_params\n             .iter()\n-            .filter_map(|param| match param.kind {\n-                GenericParamKind::Lifetime { .. } => Some(param),\n-                _ => None,\n-            })\n+            .filter(|param| matches!(param.kind, GenericParamKind::Lifetime { .. }))\n             .enumerate()\n             .map(|(late_bound_idx, param)| {\n                 let pair = Region::late(\n@@ -2237,19 +2230,14 @@ impl<'a, 'tcx> LifetimeContext<'a, 'tcx> {\n         let binders: Vec<_> = generics\n             .params\n             .iter()\n-            .filter_map(|param| match param.kind {\n-                GenericParamKind::Lifetime { .. }\n-                    if self.map.late_bound.contains(&param.hir_id) =>\n-                {\n-                    Some(param)\n-                }\n-                _ => None,\n+            .filter(|param| {\n+                matches!(param.kind, GenericParamKind::Lifetime { .. })\n+                    && self.map.late_bound.contains(&param.hir_id)\n             })\n             .enumerate()\n             .map(|(late_bound_idx, param)| {\n                 let pair = Region::late(late_bound_idx as u32, &self.tcx.hir(), param);\n-                let r = late_region_as_bound_region(self.tcx, &pair.1);\n-                r\n+                late_region_as_bound_region(self.tcx, &pair.1)\n             })\n             .collect();\n         self.map.late_bound_vars.insert(hir_id, binders);"}, {"sha": "d818771f7800a29c58e546cba6df16c33049eaea", "filename": "compiler/rustc_typeck/src/coherence/builtin.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ed7e438f87a6b2b036db06608d23f23b50d54d6c/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed7e438f87a6b2b036db06608d23f23b50d54d6c/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcoherence%2Fbuiltin.rs?ref=ed7e438f87a6b2b036db06608d23f23b50d54d6c", "patch": "@@ -180,14 +180,14 @@ fn visit_implementation_of_dispatch_from_dyn(tcx: TyCtxt<'_>, impl_did: LocalDef\n \n                 let coerced_fields = fields\n                     .iter()\n-                    .filter_map(|field| {\n+                    .filter(|field| {\n                         let ty_a = field.ty(tcx, substs_a);\n                         let ty_b = field.ty(tcx, substs_b);\n \n                         if let Ok(layout) = tcx.layout_of(param_env.and(ty_a)) {\n                             if layout.is_zst() && layout.align.abi.bytes() == 1 {\n                                 // ignore ZST fields with alignment of 1 byte\n-                                return None;\n+                                return false;\n                             }\n                         }\n \n@@ -204,11 +204,11 @@ fn visit_implementation_of_dispatch_from_dyn(tcx: TyCtxt<'_>, impl_did: LocalDef\n                                 ))\n                                 .emit();\n \n-                                return None;\n+                                return false;\n                             }\n                         }\n \n-                        Some(field)\n+                        return true;\n                     })\n                     .collect::<Vec<_>>();\n "}]}