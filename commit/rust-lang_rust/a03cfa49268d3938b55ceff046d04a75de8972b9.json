{"sha": "a03cfa49268d3938b55ceff046d04a75de8972b9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEwM2NmYTQ5MjY4ZDM5MzhiNTVjZWZmMDQ2ZDA0YTc1ZGU4OTcyYjk=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-01T14:42:14Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-07-01T14:42:14Z"}, "message": "Automatically reload project on config change", "tree": {"sha": "c0bb679bf039e7cae1cafd688ab2750e7932b3cb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c0bb679bf039e7cae1cafd688ab2750e7932b3cb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a03cfa49268d3938b55ceff046d04a75de8972b9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a03cfa49268d3938b55ceff046d04a75de8972b9", "html_url": "https://github.com/rust-lang/rust/commit/a03cfa49268d3938b55ceff046d04a75de8972b9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a03cfa49268d3938b55ceff046d04a75de8972b9/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "298adb27b9642adcb566d1e3b709a444d0b0ef06", "url": "https://api.github.com/repos/rust-lang/rust/commits/298adb27b9642adcb566d1e3b709a444d0b0ef06", "html_url": "https://github.com/rust-lang/rust/commit/298adb27b9642adcb566d1e3b709a444d0b0ef06"}], "stats": {"total": 13, "additions": 8, "deletions": 5}, "files": [{"sha": "b0fe093335866ff5c34b7dba264a1e907f42598d", "filename": "crates/ra_project_model/src/project_json.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a03cfa49268d3938b55ceff046d04a75de8972b9/crates%2Fra_project_model%2Fsrc%2Fproject_json.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a03cfa49268d3938b55ceff046d04a75de8972b9/crates%2Fra_project_model%2Fsrc%2Fproject_json.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_project_model%2Fsrc%2Fproject_json.rs?ref=a03cfa49268d3938b55ceff046d04a75de8972b9", "patch": "@@ -10,22 +10,22 @@ use serde::{de, Deserialize};\n use stdx::split_delim;\n \n /// Roots and crates that compose this Rust project.\n-#[derive(Clone, Debug)]\n+#[derive(Clone, Debug, Eq, PartialEq)]\n pub struct ProjectJson {\n     pub(crate) roots: Vec<Root>,\n     pub(crate) crates: Vec<Crate>,\n }\n \n /// A root points to the directory which contains Rust crates. rust-analyzer watches all files in\n /// all roots. Roots might be nested.\n-#[derive(Clone, Debug)]\n+#[derive(Clone, Debug, Eq, PartialEq)]\n pub struct Root {\n     pub(crate) path: AbsPathBuf,\n }\n \n /// A crate points to the root module of a crate and lists the dependencies of the crate. This is\n /// useful in creating the crate graph.\n-#[derive(Clone, Debug)]\n+#[derive(Clone, Debug, Eq, PartialEq)]\n pub struct Crate {\n     pub(crate) root_module: AbsPathBuf,\n     pub(crate) edition: Edition,"}, {"sha": "6c311648a9d506bb8ee358883b09f419511c1596", "filename": "crates/rust-analyzer/src/config.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a03cfa49268d3938b55ceff046d04a75de8972b9/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a03cfa49268d3938b55ceff046d04a75de8972b9/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fconfig.rs?ref=a03cfa49268d3938b55ceff046d04a75de8972b9", "patch": "@@ -44,7 +44,7 @@ pub struct Config {\n     pub root_path: AbsPathBuf,\n }\n \n-#[derive(Debug, Clone)]\n+#[derive(Debug, Clone, Eq, PartialEq)]\n pub enum LinkedProject {\n     ProjectManifest(ProjectManifest),\n     InlineJsonProject(ProjectJson),"}, {"sha": "0c1fd1b8b5b06d297f9dfa18fdf296b9492ca4d6", "filename": "crates/rust-analyzer/src/reload.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/a03cfa49268d3938b55ceff046d04a75de8972b9/crates%2Frust-analyzer%2Fsrc%2Freload.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a03cfa49268d3938b55ceff046d04a75de8972b9/crates%2Frust-analyzer%2Fsrc%2Freload.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Freload.rs?ref=a03cfa49268d3938b55ceff046d04a75de8972b9", "patch": "@@ -19,11 +19,14 @@ impl GlobalState {\n         if self.config.lru_capacity != old_config.lru_capacity {\n             self.analysis_host.update_lru_capacity(old_config.lru_capacity);\n         }\n-        if self.config.flycheck != old_config.flycheck {\n+        if self.config.linked_projects != old_config.linked_projects {\n+            self.reload()\n+        } else if self.config.flycheck != old_config.flycheck {\n             self.reload_flycheck();\n         }\n     }\n     pub(crate) fn reload(&mut self) {\n+        log::info!(\"reloading projects: {:?}\", self.config.linked_projects);\n         let workspaces = {\n             if self.config.linked_projects.is_empty()\n                 && self.config.notifications.cargo_toml_not_found"}]}