{"sha": "d974aade934d7bca50fe66eb1de849d4b666828b", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ5NzRhYWRlOTM0ZDdiY2E1MGZlNjZlYjFkZTg0OWQ0YjY2NjgyOGI=", "commit": {"author": {"name": "Jeffrey Yasskin", "email": "jyasskin@gmail.com", "date": "2010-07-17T20:26:23Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@pobox.com", "date": "2010-07-19T17:23:45Z"}, "message": "Improve the LLVM-using experience.\nllvm-config may be installed somewhere that's not on the path or in ocaml's\ndefault lib directory, so allow users to override $CFG_LLVM_CONFIG with an\nenvironment variable and look up lib and binary paths through calls to\nllvm-config.", "tree": {"sha": "77c1faec18f4ce3e6df766030143f92c6dae9067", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/77c1faec18f4ce3e6df766030143f92c6dae9067"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d974aade934d7bca50fe66eb1de849d4b666828b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d974aade934d7bca50fe66eb1de849d4b666828b", "html_url": "https://github.com/rust-lang/rust/commit/d974aade934d7bca50fe66eb1de849d4b666828b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d974aade934d7bca50fe66eb1de849d4b666828b/comments", "author": {"login": "jyasskin", "id": 83420, "node_id": "MDQ6VXNlcjgzNDIw", "avatar_url": "https://avatars.githubusercontent.com/u/83420?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyasskin", "html_url": "https://github.com/jyasskin", "followers_url": "https://api.github.com/users/jyasskin/followers", "following_url": "https://api.github.com/users/jyasskin/following{/other_user}", "gists_url": "https://api.github.com/users/jyasskin/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyasskin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyasskin/subscriptions", "organizations_url": "https://api.github.com/users/jyasskin/orgs", "repos_url": "https://api.github.com/users/jyasskin/repos", "events_url": "https://api.github.com/users/jyasskin/events{/privacy}", "received_events_url": "https://api.github.com/users/jyasskin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0633c7ae6e54edebde8421cef14267ad1ba1e30c", "url": "https://api.github.com/repos/rust-lang/rust/commits/0633c7ae6e54edebde8421cef14267ad1ba1e30c", "html_url": "https://github.com/rust-lang/rust/commit/0633c7ae6e54edebde8421cef14267ad1ba1e30c"}], "stats": {"total": 7, "additions": 4, "deletions": 3}, "files": [{"sha": "3c4db92493b6730a4a32fbb013a5b953809a5322", "filename": "src/Makefile", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d974aade934d7bca50fe66eb1de849d4b666828b/src%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/d974aade934d7bca50fe66eb1de849d4b666828b/src%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2FMakefile?ref=d974aade934d7bca50fe66eb1de849d4b666828b", "patch": "@@ -23,7 +23,7 @@ CFG_GCC_CFLAGS :=\n CFG_GCC_LINK_FLAGS :=\n CFG_VALGRIND :=\n \n-CFG_LLVM_CONFIG := llvm-config\n+CFG_LLVM_CONFIG ?= llvm-config\n CFG_BOOT_FLAGS := $(FLAGS)\n \n ifeq ($(CFG_OSTYPE), Linux)\n@@ -162,7 +162,7 @@ ifneq ($(CFG_LLVM_CONFIG),)\n   CFG_LLVM_VERSION := $(shell $(CFG_LLVM_CONFIG) --version)\n   ifeq ($(CFG_LLVM_VERSION),2.8svn)\n     $(info cfg: using LLVM version 2.8svn)\n-    WHERE := $(shell ocamlc -where)\n+    WHERE := $(shell $(CFG_LLVM_CONFIG) --libdir)/ocaml\n     ifneq ($(shell test -e $(WHERE)/llvm.cma && echo ok),ok)\n       CFG_LLVM_CONFIG := $(info cfg: LLVM ocaml bindings not found)\n     endif\n@@ -181,6 +181,7 @@ ifdef CFG_LLVM_CONFIG\n   LLVM_INCS := -I boot/llvm -I $(WHERE)\n   LLVM_MLS := $(addprefix boot/llvm/, llabi.ml llasm.ml llfinal.ml \\\n     lltrans.ml llemit.ml)\n+  LLC := \"$(shell $(CFG_LLVM_CONFIG) --bindir)/llc\"\n   CFG_LLC_CFLAGS := -march=x86\n   $(info cfg: found llvm-config at $(CFG_LLVM_CONFIG))\n else\n@@ -648,7 +649,7 @@ test/bench/shootout/%.x86$(CFG_EXE_SUFFIX): test/bench/shootout/%.rs $(REQ)\n \n %.s: %.bc\n \t@$(call CFG_ECHO, compile [llvm]: $<)\n-\t$(CFG_QUIET)llc $(CFG_LLC_CFLAGS) -o $@ $<\n+\t$(CFG_QUIET)$(LLC) $(CFG_LLC_CFLAGS) -o $@ $<\n \n %.llvm$(CFG_EXE_SUFFIX): %.s $(CFG_RUNTIME)\n \t@$(call CFG_ECHO, compile [llvm]: $<)"}]}