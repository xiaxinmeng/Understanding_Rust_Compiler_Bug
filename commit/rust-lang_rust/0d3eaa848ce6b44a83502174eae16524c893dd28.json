{"sha": "0d3eaa848ce6b44a83502174eae16524c893dd28", "node_id": "C_kwDOAAsO6NoAKDBkM2VhYTg0OGNlNmI0NGE4MzUwMjE3NGVhZTE2NTI0Yzg5M2RkMjg", "commit": {"author": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2023-01-15T21:08:20Z"}, "committer": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2023-01-15T21:12:28Z"}, "message": "Add test showing broken behavior of BinaryHeap::retain", "tree": {"sha": "b83e2a577cf1922a83051304f0146d4e946af733", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b83e2a577cf1922a83051304f0146d4e946af733"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0d3eaa848ce6b44a83502174eae16524c893dd28", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEERijF2Cz/ZdaBZKeK+boUO5X/bYIFAmPEbDwACgkQ+boUO5X/\nbYJKvxAAgfCxMJHyOsM2Zc5jAhElbU5QFuz2REe3gGLcBcLhV/bRyIabat6ozgzm\nZLfcOAycVUKc/t3xdcRJ3U8eG8NoJ0KG8lji8Acl9Q4iPEtUeeJBTlG4UGF/ib0v\nVlC9Pp0D0d1X4PajLV32cX9zMrQQCITabDXJOrzK4KTTaLgausHEPjp0pyhef8VL\n2VG25xV/Ca335syp3ms7CCSXRyrAz/NFnMW/stnc4vsDQbsdsz5qXMEWxoIhJNMI\n9r2Vtroizj9m9CT2yzFoEtxeIGvncG8OQRhTgB9UjeH4eL0IqTxMg0k1Fdb42jgh\nJbm9mjxUk/RDafau8K8Ap7CEEHffdGvEP/p3OW5JzvzR/n3yG2GEu34XWGZY3Vex\n4DAt/vZGGIUThXMB4Mojz+hjdYUDz404l8zxVLd214EHAoTwcDdiYJdEVIgdw1lP\ndmgxPJIoki+N75qiM24CfJeUb8Kvfjtk/CIlodbjmn4OnZhkS/oM6pnCSVNwfodj\nhZAjD9GCgC5lvlXnhxnEEWDcP237+OkOmilcx7LUvztM89+l4lz6WTFH0xw2ia1U\ndyA5IkSjCofgf3UP+jqSJyMdXxXQEthoSQRJmozMT13gmm1FM0inA/wUsGWYb9Cp\n6lbf+ipXxdl3V9p9c+KDR+Mm6qbSkKhgukAfT3WCfDFymzZRSLw=\n=ZpEN\n-----END PGP SIGNATURE-----", "payload": "tree b83e2a577cf1922a83051304f0146d4e946af733\nparent ae4d89dfb51535c1c43052ef848564bd2323c9ca\nauthor David Tolnay <dtolnay@gmail.com> 1673816900 -0800\ncommitter David Tolnay <dtolnay@gmail.com> 1673817148 -0800\n\nAdd test showing broken behavior of BinaryHeap::retain\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0d3eaa848ce6b44a83502174eae16524c893dd28", "html_url": "https://github.com/rust-lang/rust/commit/0d3eaa848ce6b44a83502174eae16524c893dd28", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0d3eaa848ce6b44a83502174eae16524c893dd28/comments", "author": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ae4d89dfb51535c1c43052ef848564bd2323c9ca", "url": "https://api.github.com/repos/rust-lang/rust/commits/ae4d89dfb51535c1c43052ef848564bd2323c9ca", "html_url": "https://github.com/rust-lang/rust/commit/ae4d89dfb51535c1c43052ef848564bd2323c9ca"}], "stats": {"total": 17, "additions": 17, "deletions": 0}, "files": [{"sha": "835b2e5b7e9179de561c4de8f2aa1e392401c094", "filename": "library/alloc/src/collections/binary_heap/tests.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/0d3eaa848ce6b44a83502174eae16524c893dd28/library%2Falloc%2Fsrc%2Fcollections%2Fbinary_heap%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0d3eaa848ce6b44a83502174eae16524c893dd28/library%2Falloc%2Fsrc%2Fcollections%2Fbinary_heap%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fbinary_heap%2Ftests.rs?ref=0d3eaa848ce6b44a83502174eae16524c893dd28", "patch": "@@ -474,6 +474,23 @@ fn test_retain() {\n     assert!(a.is_empty());\n }\n \n+#[test]\n+fn test_retain_catch_unwind() {\n+    let mut heap = BinaryHeap::from(vec![3, 1, 2]);\n+\n+    // Removes the 3, then unwinds out of retain.\n+    let _ = catch_unwind(AssertUnwindSafe(|| {\n+        heap.retain(|e| {\n+            if *e == 1 {\n+                panic!();\n+            }\n+            false\n+        });\n+    }));\n+\n+    assert_eq!(heap.into_vec(), [1, 2]); // BAD!!\n+}\n+\n // old binaryheap failed this test\n //\n // Integrity means that all elements are present after a comparison panics,"}]}