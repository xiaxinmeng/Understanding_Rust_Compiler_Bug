{"sha": "207832bdc04da0859475f9364ec24198c6ec6849", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIwNzgzMmJkYzA0ZGEwODU5NDc1ZjkzNjRlYzI0MTk4YzZlYzY4NDk=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-10-06T22:16:12Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-10-06T22:16:12Z"}, "message": "Rollup merge of #77605 - da-x:fix-rustc-def-path, r=petrochenkov\n\nFix rustc_def_path to show the full path and not the trimmed one\n\nFollow-up fix for #73996.", "tree": {"sha": "0ca7ec0e786dd20878e5c1050f24510cc6e84d55", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0ca7ec0e786dd20878e5c1050f24510cc6e84d55"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/207832bdc04da0859475f9364ec24198c6ec6849", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJffOytCRBK7hj4Ov3rIwAAdHIIAD+OPkwquPfIkRzWi3QK8I0I\n4KnLE4lau+UCkVQTC+tJdwHaFMRI3vcib0cuAXOmBwXT23XGn0vplG2I0YjA6Ou+\nWKAlhMKT5FyrVfQDnEEJ67R+BKXPb7cOmkw5Zzoq0+adByPl2CjOV24egjSZD7mh\nMUcHHZN/9wC3t5DYfZeDX9WWzbtSJy0Cjp1CcKCLAjVIpovNcyi2wG3pH0w1m2nq\nLa4do/CPlnQ9IIB3An+XYQYH2/PZlztcHWXpVaJ8sIVZIFEHNDXGrTTj+Ifxcq+9\nHKlr1mf0EvMy260bQkiV/QQRHuwTDPXCXZgBG0aIFTHGxU7SJ4rbvFYVt78sbQ0=\n=5rvn\n-----END PGP SIGNATURE-----\n", "payload": "tree 0ca7ec0e786dd20878e5c1050f24510cc6e84d55\nparent 6951c3180e416abe3d4eb55fcc6a177d0bbedc8f\nparent d25c580453829afeff9753013f71503164e68d5f\nauthor Dylan DPC <dylan.dpc@gmail.com> 1602022572 +0200\ncommitter GitHub <noreply@github.com> 1602022572 +0200\n\nRollup merge of #77605 - da-x:fix-rustc-def-path, r=petrochenkov\n\nFix rustc_def_path to show the full path and not the trimmed one\n\nFollow-up fix for #73996.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/207832bdc04da0859475f9364ec24198c6ec6849", "html_url": "https://github.com/rust-lang/rust/commit/207832bdc04da0859475f9364ec24198c6ec6849", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/207832bdc04da0859475f9364ec24198c6ec6849/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6951c3180e416abe3d4eb55fcc6a177d0bbedc8f", "url": "https://api.github.com/repos/rust-lang/rust/commits/6951c3180e416abe3d4eb55fcc6a177d0bbedc8f", "html_url": "https://github.com/rust-lang/rust/commit/6951c3180e416abe3d4eb55fcc6a177d0bbedc8f"}, {"sha": "d25c580453829afeff9753013f71503164e68d5f", "url": "https://api.github.com/repos/rust-lang/rust/commits/d25c580453829afeff9753013f71503164e68d5f", "html_url": "https://github.com/rust-lang/rust/commit/d25c580453829afeff9753013f71503164e68d5f"}], "stats": {"total": 11, "additions": 6, "deletions": 5}, "files": [{"sha": "d2c9b05c5607fbf43123db914a8b33cbba2237c9", "filename": "compiler/rustc_symbol_mangling/src/test.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/207832bdc04da0859475f9364ec24198c6ec6849/compiler%2Frustc_symbol_mangling%2Fsrc%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/207832bdc04da0859475f9364ec24198c6ec6849/compiler%2Frustc_symbol_mangling%2Fsrc%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_symbol_mangling%2Fsrc%2Ftest.rs?ref=207832bdc04da0859475f9364ec24198c6ec6849", "patch": "@@ -5,6 +5,7 @@\n //! paths etc in all kinds of annoying scenarios.\n \n use rustc_hir as hir;\n+use rustc_middle::ty::print::with_no_trimmed_paths;\n use rustc_middle::ty::{Instance, TyCtxt};\n use rustc_span::symbol::{sym, Symbol};\n \n@@ -44,7 +45,7 @@ impl SymbolNamesTest<'tcx> {\n                     tcx.sess.span_err(attr.span, &format!(\"demangling-alt({:#})\", demangling));\n                 }\n             } else if tcx.sess.check_name(attr, DEF_PATH) {\n-                let path = tcx.def_path_str(def_id.to_def_id());\n+                let path = with_no_trimmed_paths(|| tcx.def_path_str(def_id.to_def_id()));\n                 tcx.sess.span_err(attr.span, &format!(\"def-path({})\", path));\n             }\n "}, {"sha": "c866f9bd3b79100d8e0ed587136cac1b2aeb2d2a", "filename": "src/test/ui/symbol-names/impl1.legacy.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/207832bdc04da0859475f9364ec24198c6ec6849/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.legacy.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/207832bdc04da0859475f9364ec24198c6ec6849/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.legacy.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.legacy.stderr?ref=207832bdc04da0859475f9364ec24198c6ec6849", "patch": "@@ -64,7 +64,7 @@ error: demangling-alt(<[&dyn impl1::Foo+Assoc = extern \"C\" fn(&u8, ::.)+impl1::A\n LL |             #[rustc_symbol_name]\n    |             ^^^^^^^^^^^^^^^^^^^^\n \n-error: def-path(<[&dyn Foo<Assoc = for<'r> extern \"C\" fn(&'r u8, ...)> + AutoTrait; 3] as Bar>::method)\n+error: def-path(<[&dyn Foo<Assoc = for<'r> extern \"C\" fn(&'r u8, ...)> + AutoTrait; 3] as main::{closure#1}::Bar>::method)\n   --> $DIR/impl1.rs:71:13\n    |\n LL |             #[rustc_def_path]"}, {"sha": "1ada54cc102ed022fe0e9b6de98fdbaf0eefc4e9", "filename": "src/test/ui/symbol-names/impl1.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/207832bdc04da0859475f9364ec24198c6ec6849/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/207832bdc04da0859475f9364ec24198c6ec6849/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.rs?ref=207832bdc04da0859475f9364ec24198c6ec6849", "patch": "@@ -69,8 +69,8 @@ fn main() {\n                 //[v0]~| ERROR demangling(<[&dyn impl1[317d481089b8c8fe]::Foo<Assoc = for<'a> extern \"C\" fn(&'a u8, ...)> + impl1[317d481089b8c8fe]::AutoTrait; 3: usize] as impl1[317d481089b8c8fe]::main::{closure#1}::Bar>::method)\n                 //[v0]~| ERROR demangling-alt(<[&dyn impl1::Foo<Assoc = for<'a> extern \"C\" fn(&'a u8, ...)> + impl1::AutoTrait; 3] as impl1::main::{closure#1}::Bar>::method)\n             #[rustc_def_path]\n-            //[legacy]~^ ERROR def-path(<[&dyn Foo<Assoc = for<'r> extern \"C\" fn(&'r u8, ...)> + AutoTrait; 3] as Bar>::method)\n-               //[v0]~^^ ERROR def-path(<[&dyn Foo<Assoc = for<'r> extern \"C\" fn(&'r u8, ...)> + AutoTrait; 3] as Bar>::method)\n+            //[legacy]~^ ERROR def-path(<[&dyn Foo<Assoc = for<'r> extern \"C\" fn(&'r u8, ...)> + AutoTrait; 3] as main::{closure#1}::Bar>::method)\n+               //[v0]~^^ ERROR def-path(<[&dyn Foo<Assoc = for<'r> extern \"C\" fn(&'r u8, ...)> + AutoTrait; 3] as main::{closure#1}::Bar>::method)\n             fn method(&self) {}\n         }\n     };"}, {"sha": "db5eda0db5074899c563d007470fcaf57f8422af", "filename": "src/test/ui/symbol-names/impl1.v0.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/207832bdc04da0859475f9364ec24198c6ec6849/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.v0.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/207832bdc04da0859475f9364ec24198c6ec6849/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.v0.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.v0.stderr?ref=207832bdc04da0859475f9364ec24198c6ec6849", "patch": "@@ -64,7 +64,7 @@ error: demangling-alt(<[&dyn impl1::Foo<Assoc = for<'a> extern \"C\" fn(&'a u8, ..\n LL |             #[rustc_symbol_name]\n    |             ^^^^^^^^^^^^^^^^^^^^\n \n-error: def-path(<[&dyn Foo<Assoc = for<'r> extern \"C\" fn(&'r u8, ...)> + AutoTrait; 3] as Bar>::method)\n+error: def-path(<[&dyn Foo<Assoc = for<'r> extern \"C\" fn(&'r u8, ...)> + AutoTrait; 3] as main::{closure#1}::Bar>::method)\n   --> $DIR/impl1.rs:71:13\n    |\n LL |             #[rustc_def_path]"}]}