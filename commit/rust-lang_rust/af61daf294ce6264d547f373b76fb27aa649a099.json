{"sha": "af61daf294ce6264d547f373b76fb27aa649a099", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFmNjFkYWYyOTRjZTYyNjRkNTQ3ZjM3M2I3NmZiMjdhYTY0OWEwOTk=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-08-15T21:36:52Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-08-15T21:38:48Z"}, "message": "rustc: Parse and typecheck unique pointers", "tree": {"sha": "cd80b30497f1738726087c7aeb5bfc69208b99b5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cd80b30497f1738726087c7aeb5bfc69208b99b5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/af61daf294ce6264d547f373b76fb27aa649a099", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/af61daf294ce6264d547f373b76fb27aa649a099", "html_url": "https://github.com/rust-lang/rust/commit/af61daf294ce6264d547f373b76fb27aa649a099", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/af61daf294ce6264d547f373b76fb27aa649a099/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5c6790519b12afae688c87ae3f55ee5eec1a6dcc", "url": "https://api.github.com/repos/rust-lang/rust/commits/5c6790519b12afae688c87ae3f55ee5eec1a6dcc", "html_url": "https://github.com/rust-lang/rust/commit/5c6790519b12afae688c87ae3f55ee5eec1a6dcc"}], "stats": {"total": 15, "additions": 14, "deletions": 1}, "files": [{"sha": "56dca058c5e956e638bc31dec662e872f30a29d0", "filename": "src/comp/middle/tstate/states.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/af61daf294ce6264d547f373b76fb27aa649a099/src%2Fcomp%2Fmiddle%2Ftstate%2Fstates.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af61daf294ce6264d547f373b76fb27aa649a099/src%2Fcomp%2Fmiddle%2Ftstate%2Fstates.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftstate%2Fstates.rs?ref=af61daf294ce6264d547f373b76fb27aa649a099", "patch": "@@ -620,6 +620,7 @@ fn find_pre_post_state_expr(fcx: &fn_ctxt, pres: &prestate, e: @expr) ->\n           none. { ret pure_exp(fcx.ccx, e.id, pres); }\n         }\n       }\n+      expr_uniq(_) { ret pure_exp(fcx.ccx, e.id, pres); }\n     }\n }\n "}, {"sha": "161ad2811584df3e0e5f91131bc27e35dd9bfe3a", "filename": "src/comp/middle/typeck.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/af61daf294ce6264d547f373b76fb27aa649a099/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af61daf294ce6264d547f373b76fb27aa649a099/src%2Fcomp%2Fmiddle%2Ftypeck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftypeck.rs?ref=af61daf294ce6264d547f373b76fb27aa649a099", "patch": "@@ -2467,6 +2467,11 @@ fn check_expr_with_unifier(fcx: &@fn_ctxt, expr: &@ast::expr,\n         // Now remove the info from the stack.\n         ivec::pop[obj_info](fcx.ccx.obj_infos);\n       }\n+      ast::expr_uniq(x) {\n+        let t = next_ty_var(fcx);\n+        check_expr_with(fcx, x, ty::mk_uniq(tcx, t));\n+        write::ty_only_fixup(fcx, id, ty::mk_uniq(tcx, t));\n+      }\n       _ { tcx.sess.unimpl(\"expr type in typeck::check_expr\"); }\n     }\n     if bot {"}, {"sha": "152fb38157c1cb52d7de102df97213c08d5a7101", "filename": "src/comp/syntax/ast.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/af61daf294ce6264d547f373b76fb27aa649a099/src%2Fcomp%2Fsyntax%2Fast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af61daf294ce6264d547f373b76fb27aa649a099/src%2Fcomp%2Fsyntax%2Fast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fsyntax%2Fast.rs?ref=af61daf294ce6264d547f373b76fb27aa649a099", "patch": "@@ -336,6 +336,7 @@ tag expr_ {\n     expr_chan(@expr);\n     expr_anon_obj(anon_obj);\n     expr_mac(mac);\n+    expr_uniq(@expr);\n }\n \n type mac = spanned[mac_];"}, {"sha": "956373da964e4810b003a0c2b08086907aaf3315", "filename": "src/comp/syntax/fold.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/af61daf294ce6264d547f373b76fb27aa649a099/src%2Fcomp%2Fsyntax%2Ffold.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af61daf294ce6264d547f373b76fb27aa649a099/src%2Fcomp%2Fsyntax%2Ffold.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fsyntax%2Ffold.rs?ref=af61daf294ce6264d547f373b76fb27aa649a099", "patch": "@@ -433,6 +433,7 @@ fn noop_fold_expr(e: &expr_, fld: ast_fold) -> expr_ {\n           expr_chan(e) { expr_chan(fld.fold_expr(e)) }\n           expr_anon_obj(ao) { expr_anon_obj(fold_anon_obj(ao)) }\n           expr_mac(mac) { expr_mac(fold_mac(mac)) }\n+          expr_uniq(e) { expr_uniq(fld.fold_expr(e)) }\n         }\n }\n "}, {"sha": "7f8a3aae0bfde93781f13ad93531810b3ad94ab0", "filename": "src/comp/syntax/parse/parser.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/af61daf294ce6264d547f373b76fb27aa649a099/src%2Fcomp%2Fsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af61daf294ce6264d547f373b76fb27aa649a099/src%2Fcomp%2Fsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fsyntax%2Fparse%2Fparser.rs?ref=af61daf294ce6264d547f373b76fb27aa649a099", "patch": "@@ -870,7 +870,7 @@ fn parse_bottom_expr(p: &parser) -> @ast::expr {\n                   span: p.get_span()};\n             ex = ast::expr_lit(lit);\n           }\n-          _ { p.fatal(\"unimplemented: unique pointer creation\"); }\n+          _ { ex = ast::expr_uniq(parse_expr(p)); }\n         }\n     } else if (eat_word(p, \"obj\")) {\n         // Anonymous object"}, {"sha": "98e91a7f41f17938660cd56d23273b01b4fdae96", "filename": "src/comp/syntax/print/pprust.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/af61daf294ce6264d547f373b76fb27aa649a099/src%2Fcomp%2Fsyntax%2Fprint%2Fpprust.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af61daf294ce6264d547f373b76fb27aa649a099/src%2Fcomp%2Fsyntax%2Fprint%2Fpprust.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fsyntax%2Fprint%2Fpprust.rs?ref=af61daf294ce6264d547f373b76fb27aa649a099", "patch": "@@ -1037,6 +1037,10 @@ fn print_expr(s: &ps, expr: &@ast::expr) {\n         }\n         bclose(s, expr.span);\n       }\n+      ast::expr_uniq(expr) {\n+        word(s.s, \"~\");\n+        print_expr(s, expr);\n+      }\n     }\n     s.ann.post(ann_node);\n     end(s);"}, {"sha": "735daf0b1b4df51655fc1265ce7b879996c127f5", "filename": "src/comp/syntax/visit.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/af61daf294ce6264d547f373b76fb27aa649a099/src%2Fcomp%2Fsyntax%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af61daf294ce6264d547f373b76fb27aa649a099/src%2Fcomp%2Fsyntax%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fsyntax%2Fvisit.rs?ref=af61daf294ce6264d547f373b76fb27aa649a099", "patch": "@@ -341,6 +341,7 @@ fn visit_expr[E](ex: &@expr, e: &E, v: &vt[E]) {\n         }\n       }\n       expr_mac(mac) { visit_mac(mac, e, v); }\n+      expr_uniq(x) { v.visit_expr(x, e, v); }\n     }\n }\n "}]}