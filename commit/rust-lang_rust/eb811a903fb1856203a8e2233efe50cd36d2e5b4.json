{"sha": "eb811a903fb1856203a8e2233efe50cd36d2e5b4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViODExYTkwM2ZiMTg1NjIwM2E4ZTIyMzNlZmU1MGNkMzZkMmU1YjQ=", "commit": {"author": {"name": "Rafael \u00c1vila de Esp\u00edndola", "email": "respindola@mozilla.com", "date": "2011-06-13T20:08:07Z"}, "committer": {"name": "Rafael \u00c1vila de Esp\u00edndola", "email": "respindola@mozilla.com", "date": "2011-06-13T20:08:07Z"}, "message": "Enough driver support to link an empty program on linux. Will\ntry to update the Makefiles to use it.", "tree": {"sha": "52c8e682c7936714023582aa5a937d58ce16dbe8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/52c8e682c7936714023582aa5a937d58ce16dbe8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eb811a903fb1856203a8e2233efe50cd36d2e5b4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eb811a903fb1856203a8e2233efe50cd36d2e5b4", "html_url": "https://github.com/rust-lang/rust/commit/eb811a903fb1856203a8e2233efe50cd36d2e5b4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eb811a903fb1856203a8e2233efe50cd36d2e5b4/comments", "author": null, "committer": null, "parents": [{"sha": "913383d7755e5336c29314ea36760e07353e9983", "url": "https://api.github.com/repos/rust-lang/rust/commits/913383d7755e5336c29314ea36760e07353e9983", "html_url": "https://github.com/rust-lang/rust/commit/913383d7755e5336c29314ea36760e07353e9983"}], "stats": {"total": 21, "additions": 16, "deletions": 5}, "files": [{"sha": "6b1a8d395ee451c044da7aac3d2bfe793c57cc64", "filename": "src/comp/driver/rustc.rs", "status": "modified", "additions": 16, "deletions": 5, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/eb811a903fb1856203a8e2233efe50cd36d2e5b4/src%2Fcomp%2Fdriver%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb811a903fb1856203a8e2233efe50cd36d2e5b4/src%2Fcomp%2Fdriver%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fdriver%2Frustc.rs?ref=eb811a903fb1856203a8e2233efe50cd36d2e5b4", "patch": "@@ -421,8 +421,20 @@ fn main(vec[str] args) {\n             compile_input(sess, env, ifile, ofile);\n         }\n         case (some(?ofile)) {\n+            // FIXME: what about windows? This will create a foo.exe.o.\n             saved_out_filename = ofile;\n-            compile_input(sess, env, ifile, ofile);\n+            auto temp_filename;\n+            alt (sopts.output_type) {\n+                case (link::output_type_exe) {\n+                    // FIXME: what about shared?\n+                    temp_filename = ofile + \".o\";\n+                }\n+                case (_) {\n+                    temp_filename = ofile;\n+                }\n+            }\n+\n+            compile_input(sess, env, ifile, temp_filename);\n         }\n     }\n \n@@ -431,11 +443,10 @@ fn main(vec[str] args) {\n     //\n     // TODO: Factor this out of main.\n     if (sopts.output_type == link::output_type_exe) {\n-\n-        //FIXME: Should we make the 'stage3's variable here?\n-        let str glu = \"stage3/glue.o\";\n+        auto binary_dir = fs::dirname(binary);\n+        let str glu = binary_dir + \"/glue.o\";\n         let str main = \"rt/main.o\";\n-        let str stage = \"-Lstage3\";\n+        let str stage = \"-L\" + binary_dir;\n         let vec[str] gcc_args;\n         let str prog = \"gcc\";\n         let str exe_suffix = \"\";"}]}