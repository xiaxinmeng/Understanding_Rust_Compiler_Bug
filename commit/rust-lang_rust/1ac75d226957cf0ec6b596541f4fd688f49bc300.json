{"sha": "1ac75d226957cf0ec6b596541f4fd688f49bc300", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFhYzc1ZDIyNjk1N2NmMGVjNmI1OTY1NDFmNGZkNjg4ZjQ5YmMzMDA=", "commit": {"author": {"name": "Erick Tryzelaar", "email": "erick.tryzelaar@gmail.com", "date": "2012-10-08T17:41:02Z"}, "committer": {"name": "Erick Tryzelaar", "email": "erick.tryzelaar@gmail.com", "date": "2012-10-08T17:42:13Z"}, "message": "allow interner cache to be shared across parsers (#3699)", "tree": {"sha": "0af35199fb9c273781d1c07131227cf35a35e423", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0af35199fb9c273781d1c07131227cf35a35e423"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1ac75d226957cf0ec6b596541f4fd688f49bc300", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1ac75d226957cf0ec6b596541f4fd688f49bc300", "html_url": "https://github.com/rust-lang/rust/commit/1ac75d226957cf0ec6b596541f4fd688f49bc300", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1ac75d226957cf0ec6b596541f4fd688f49bc300/comments", "author": {"login": "erickt", "id": 84711, "node_id": "MDQ6VXNlcjg0NzEx", "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erickt", "html_url": "https://github.com/erickt", "followers_url": "https://api.github.com/users/erickt/followers", "following_url": "https://api.github.com/users/erickt/following{/other_user}", "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}", "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erickt/subscriptions", "organizations_url": "https://api.github.com/users/erickt/orgs", "repos_url": "https://api.github.com/users/erickt/repos", "events_url": "https://api.github.com/users/erickt/events{/privacy}", "received_events_url": "https://api.github.com/users/erickt/received_events", "type": "User", "site_admin": false}, "committer": {"login": "erickt", "id": 84711, "node_id": "MDQ6VXNlcjg0NzEx", "avatar_url": "https://avatars.githubusercontent.com/u/84711?v=4", "gravatar_id": "", "url": "https://api.github.com/users/erickt", "html_url": "https://github.com/erickt", "followers_url": "https://api.github.com/users/erickt/followers", "following_url": "https://api.github.com/users/erickt/following{/other_user}", "gists_url": "https://api.github.com/users/erickt/gists{/gist_id}", "starred_url": "https://api.github.com/users/erickt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/erickt/subscriptions", "organizations_url": "https://api.github.com/users/erickt/orgs", "repos_url": "https://api.github.com/users/erickt/repos", "events_url": "https://api.github.com/users/erickt/events{/privacy}", "received_events_url": "https://api.github.com/users/erickt/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bbda995bfe03680b6d621c6ab809ddb145125c3a", "url": "https://api.github.com/repos/rust-lang/rust/commits/bbda995bfe03680b6d621c6ab809ddb145125c3a", "html_url": "https://github.com/rust-lang/rust/commit/bbda995bfe03680b6d621c6ab809ddb145125c3a"}], "stats": {"total": 47, "additions": 26, "deletions": 21}, "files": [{"sha": "5e928d086b86c9cbf2372c2f6b958f88eaf77ca7", "filename": "src/libsyntax/parse/token.rs", "status": "modified", "additions": 26, "deletions": 21, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/1ac75d226957cf0ec6b596541f4fd688f49bc300/src%2Flibsyntax%2Fparse%2Ftoken.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1ac75d226957cf0ec6b596541f4fd688f49bc300/src%2Flibsyntax%2Fparse%2Ftoken.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Ftoken.rs?ref=1ac75d226957cf0ec6b596541f4fd688f49bc300", "patch": "@@ -343,28 +343,33 @@ macro_rules! interner_key (\n )\n \n fn mk_ident_interner() -> @ident_interner {\n-    /* the indices here must correspond to the numbers in special_idents */\n-    let init_vec = ~[@~\"_\", @~\"anon\", @~\"drop\", @~\"\", @~\"unary\", @~\"!\",\n-                     @~\"[]\", @~\"unary-\", @~\"__extensions__\", @~\"self\",\n-                     @~\"item\", @~\"block\", @~\"stmt\", @~\"pat\", @~\"expr\",\n-                     @~\"ty\", @~\"ident\", @~\"path\", @~\"tt\", @~\"matchers\",\n-                     @~\"str\", @~\"TyVisitor\", @~\"arg\", @~\"descrim\",\n-                     @~\"__rust_abi\", @~\"__rust_stack_shim\", @~\"TyDesc\",\n-                     @~\"dtor\", @~\"main\", @~\"<opaque>\", @~\"blk\", @~\"static\",\n-                     @~\"intrinsic\", @~\"__foreign_mod__\"];\n-\n-    let rv = @ident_interner {\n-        interner: interner::mk_prefill::<@~str>(init_vec)\n-    };\n-\n-    /* having multiple interners will just confuse the serializer */\n     unsafe {\n-        assert task::local_data::local_data_get(interner_key!()).is_none()\n-    };\n-    unsafe {\n-        task::local_data::local_data_set(interner_key!(), @rv)\n-    };\n-    rv\n+        match task::local_data::local_data_get(interner_key!()) {\n+            Some(interner) => *interner,\n+            None => {\n+                // the indices here must correspond to the numbers in\n+                // special_idents.\n+                let init_vec = ~[\n+                    @~\"_\", @~\"anon\", @~\"drop\", @~\"\", @~\"unary\", @~\"!\",\n+                    @~\"[]\", @~\"unary-\", @~\"__extensions__\", @~\"self\",\n+                    @~\"item\", @~\"block\", @~\"stmt\", @~\"pat\", @~\"expr\",\n+                    @~\"ty\", @~\"ident\", @~\"path\", @~\"tt\", @~\"matchers\",\n+                    @~\"str\", @~\"TyVisitor\", @~\"arg\", @~\"descrim\",\n+                    @~\"__rust_abi\", @~\"__rust_stack_shim\", @~\"TyDesc\",\n+                    @~\"dtor\", @~\"main\", @~\"<opaque>\", @~\"blk\", @~\"static\",\n+                    @~\"intrinsic\", @~\"__foreign_mod__\"\n+                ];\n+\n+                let rv = @ident_interner {\n+                    interner: interner::mk_prefill(init_vec)\n+                };\n+\n+                task::local_data::local_data_set(interner_key!(), @rv);\n+\n+                rv\n+            }\n+        }\n+    }\n }\n \n /* for when we don't care about the contents; doesn't interact with TLD or"}]}