{"sha": "d95de0dd955312d840c7e4f20a5dd9d791355e3e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ5NWRlMGRkOTU1MzEyZDg0MGM3ZTRmMjBhNWRkOWQ3OTEzNTVlM2U=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-13T03:25:27Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-13T03:25:27Z"}, "message": "Merge remote-tracking branch 'brson/win32'", "tree": {"sha": "69b83f743063c85a32a896ef918aeeb5ddb97c31", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/69b83f743063c85a32a896ef918aeeb5ddb97c31"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d95de0dd955312d840c7e4f20a5dd9d791355e3e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d95de0dd955312d840c7e4f20a5dd9d791355e3e", "html_url": "https://github.com/rust-lang/rust/commit/d95de0dd955312d840c7e4f20a5dd9d791355e3e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d95de0dd955312d840c7e4f20a5dd9d791355e3e/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fefdb63c4c2b078c43836e2ae9d7ffcaeec32890", "url": "https://api.github.com/repos/rust-lang/rust/commits/fefdb63c4c2b078c43836e2ae9d7ffcaeec32890", "html_url": "https://github.com/rust-lang/rust/commit/fefdb63c4c2b078c43836e2ae9d7ffcaeec32890"}, {"sha": "17d504e0a9bce9d341a85ebbf080b769887cb5c9", "url": "https://api.github.com/repos/rust-lang/rust/commits/17d504e0a9bce9d341a85ebbf080b769887cb5c9", "html_url": "https://github.com/rust-lang/rust/commit/17d504e0a9bce9d341a85ebbf080b769887cb5c9"}], "stats": {"total": 65, "additions": 46, "deletions": 19}, "files": [{"sha": "457af635b0a338948c37e09ffc9d0bc9a2598707", "filename": "Makefile.in", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d95de0dd955312d840c7e4f20a5dd9d791355e3e/Makefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/d95de0dd955312d840c7e4f20a5dd9d791355e3e/Makefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Makefile.in?ref=d95de0dd955312d840c7e4f20a5dd9d791355e3e", "patch": "@@ -262,6 +262,7 @@ export CFG_HOST_TRIPLE\n export CFG_LLVM_ROOT\n export CFG_ENABLE_MINGW_CROSS\n export CFG_PREFIX\n+export CFG_LIBDIR\n \n ######################################################################\n # Subprograms\n@@ -279,12 +280,12 @@ define SREQ\n # Destinations of artifacts for the host compiler\n HROOT$(1)_H_$(3) = $(3)/stage$(1)\n HBIN$(1)_H_$(3) = $$(HROOT$(1)_H_$(3))/bin\n-HLIB$(1)_H_$(3) = $$(HROOT$(1)_H_$(3))/lib\n+HLIB$(1)_H_$(3) = $$(HROOT$(1)_H_$(3))/$$(CFG_LIBDIR)\n \n # Destinations of artifacts for target architectures\n TROOT$(1)_T_$(2)_H_$(3) = $$(HLIB$(1)_H_$(3))/rustc/$(2)\n TBIN$(1)_T_$(2)_H_$(3) = $$(TROOT$(1)_T_$(2)_H_$(3))/bin\n-TLIB$(1)_T_$(2)_H_$(3) = $$(TROOT$(1)_T_$(2)_H_$(3))/lib\n+TLIB$(1)_T_$(2)_H_$(3) = $$(TROOT$(1)_T_$(2)_H_$(3))/$$(CFG_LIBDIR)\n \n # The name of the core and standard libraries used by rustc\n ifdef CFG_DISABLE_SHAREDSTD"}, {"sha": "603cfbd7fafef256122085f85e8bca8dca05ed93", "filename": "configure", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/d95de0dd955312d840c7e4f20a5dd9d791355e3e/configure", "raw_url": "https://github.com/rust-lang/rust/raw/d95de0dd955312d840c7e4f20a5dd9d791355e3e/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=d95de0dd955312d840c7e4f20a5dd9d791355e3e", "patch": "@@ -397,6 +397,14 @@ do\n   done\n done\n \n+# On windows we just store the libraries in the bin directory because\n+# there's no rpath\n+CFG_LIBDIR=lib\n+if [ \"$CFG_OSTYPE\" = \"pc-mingw32\" ]\n+then\n+    CFG_LIBDIR=bin\n+fi\n+\n for h in $CFG_TARGET_TRIPLES\n do\n     for t in $CFG_TARGET_TRIPLES\n@@ -407,13 +415,13 @@ do\n             make_dir $h/stage$i/bin\n \n             # host lib dir\n-            make_dir $h/stage$i/lib\n+            make_dir $h/stage$i/$CFG_LIBDIR\n \n             # target bin dir\n-            make_dir $h/stage$i/lib/rustc/$t/bin\n+            make_dir $h/stage$i/$CFG_LIBDIR/rustc/$t/bin\n \n             # target lib dir\n-            make_dir $h/stage$i/lib/rustc/$t/lib\n+            make_dir $h/stage$i/$CFG_LIBDIR/rustc/$t/$CFG_LIBDIR\n         done\n     done\n \n@@ -582,6 +590,7 @@ putvar CFG_HOST_TRIPLE\n putvar CFG_TARGET_TRIPLES\n putvar CFG_C_COMPILER\n putvar CFG_PREFIX\n+putvar CFG_LIBDIR\n \n # Setting this again because it may have been changed\n if [ $CFG_DISABLE_MANAGE_SUBMODULES ]"}, {"sha": "3d070724abcb63f3a0b25fa5d1b62e37b6041dbd", "filename": "mk/platform.mk", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d95de0dd955312d840c7e4f20a5dd9d791355e3e/mk%2Fplatform.mk", "raw_url": "https://github.com/rust-lang/rust/raw/d95de0dd955312d840c7e4f20a5dd9d791355e3e/mk%2Fplatform.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fplatform.mk?ref=d95de0dd955312d840c7e4f20a5dd9d791355e3e", "patch": "@@ -108,14 +108,14 @@ endif\n \n CFG_TESTLIB=$(CFG_BUILD_DIR)/$(2)/$(strip \\\n  $(if $(findstring stage0,$(1)), \\\n-       stage0/lib, \\\n+       stage0/$(CFG_LIBDIR), \\\n       $(if $(findstring stage1,$(1)), \\\n-           stage1/lib, \\\n+           stage1/$(CFG_LIBDIR), \\\n           $(if $(findstring stage2,$(1)), \\\n-               stage2/lib, \\\n+               stage2/$(CFG_LIBDIR), \\\n                $(if $(findstring stage3,$(1)), \\\n-                    stage3/lib, \\\n-               )))))/rustc/$(CFG_HOST_TRIPLE)/lib\n+                    stage3/$(CFG_LIBDIR), \\\n+               )))))/rustc/$(CFG_HOST_TRIPLE)/$(CFG_LIBDIR)\n \n ifdef CFG_UNIXY\n   CFG_INFO := $(info cfg: unix-y environment)"}, {"sha": "417d553c36afaa145073ace33618333055411bcc", "filename": "src/comp/back/rpath.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/d95de0dd955312d840c7e4f20a5dd9d791355e3e/src%2Fcomp%2Fback%2Frpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d95de0dd955312d840c7e4f20a5dd9d791355e3e/src%2Fcomp%2Fback%2Frpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fback%2Frpath.rs?ref=d95de0dd955312d840c7e4f20a5dd9d791355e3e", "patch": "@@ -191,7 +191,6 @@ fn minimize_rpaths(rpaths: [str]) -> [str] {\n #[cfg(target_os = \"linux\")]\n #[cfg(target_os = \"macos\")]\n #[cfg(target_os = \"freebsd\")]\n-#[cfg(test)]\n mod test {\n     #[test]\n     fn test_rpaths_to_flags() {"}, {"sha": "d2dd2fc502c904b852f5fbffdb1cbb9769aaab6f", "filename": "src/comp/util/filesearch.rs", "status": "modified", "additions": 14, "deletions": 3, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/d95de0dd955312d840c7e4f20a5dd9d791355e3e/src%2Fcomp%2Futil%2Ffilesearch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d95de0dd955312d840c7e4f20a5dd9d791355e3e/src%2Fcomp%2Futil%2Ffilesearch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Futil%2Ffilesearch.rs?ref=d95de0dd955312d840c7e4f20a5dd9d791355e3e", "patch": "@@ -16,6 +16,7 @@ export pick_file;\n export search;\n export relative_target_lib_path;\n export get_cargo_root;\n+export libdir;\n \n type pick<T> = block(path: fs::path) -> option::t<T>;\n \n@@ -80,7 +81,7 @@ fn search<T: copy>(filesearch: filesearch, pick: pick<T>) -> option::t<T> {\n }\n \n fn relative_target_lib_path(target_triple: str) -> [fs::path] {\n-    [\"lib\", \"rustc\", target_triple, \"lib\"]\n+    [libdir(), \"rustc\", target_triple, libdir()]\n }\n \n fn make_target_lib_path(sysroot: fs::path,\n@@ -121,6 +122,16 @@ fn get_cargo_root() -> result::t<fs::path, str> {\n \n fn get_cargo_lib_path() -> result::t<fs::path, str> {\n     result::chain(get_cargo_root()) { |p|\n-        result::ok(fs::connect(p, \"lib\"))\n+        result::ok(fs::connect(p, libdir()))\n     }\n-}\n\\ No newline at end of file\n+}\n+\n+// The name of the directory rustc expects libraries to be located.\n+// On Unix should be \"lib\", on windows \"bin\"\n+fn libdir() -> str {\n+   let libdir = #env(\"CFG_LIBDIR\");\n+   if str::is_empty(libdir) {\n+      fail \"rustc compiled without CFG_LIBDIR environment variable\";\n+   }\n+   libdir\n+}"}, {"sha": "48e5e0bfd02c23d12b25c10f20da7873fa1f7a93", "filename": "src/etc/snapshot.py", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d95de0dd955312d840c7e4f20a5dd9d791355e3e/src%2Fetc%2Fsnapshot.py", "raw_url": "https://github.com/rust-lang/rust/raw/d95de0dd955312d840c7e4f20a5dd9d791355e3e/src%2Fetc%2Fsnapshot.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fsnapshot.py?ref=d95de0dd955312d840c7e4f20a5dd9d791355e3e", "patch": "@@ -29,11 +29,11 @@ def scrub(b):\n               \"lib/librustrt.dylib\",\n               \"lib/librustllvm.dylib\"],\n     \"winnt\": [\"bin/rustc.exe\",\n-              \"lib/core-*.dll\",\n-              \"lib/std-*.dll\",\n-              \"lib/rustc-*.dll\",\n-              \"lib/rustrt.dll\",\n-              \"lib/rustllvm.dll\"],\n+              \"bin/core-*.dll\",\n+              \"bin/std-*.dll\",\n+              \"bin/rustc-*.dll\",\n+              \"bin/rustrt.dll\",\n+              \"bin/rustllvm.dll\"],\n     \"freebsd\": [\"bin/rustc\",\n                 \"lib/libcore-*.so\",\n                 \"lib/libstd-*.so\","}, {"sha": "2849fec43be505a0caf1d39f8ba01a9f4be5e930", "filename": "src/snapshots.txt", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/d95de0dd955312d840c7e4f20a5dd9d791355e3e/src%2Fsnapshots.txt", "raw_url": "https://github.com/rust-lang/rust/raw/d95de0dd955312d840c7e4f20a5dd9d791355e3e/src%2Fsnapshots.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fsnapshots.txt?ref=d95de0dd955312d840c7e4f20a5dd9d791355e3e", "patch": "@@ -1,3 +1,10 @@\n+S 2012-01-12 23e0d16\n+  winnt-i386 3d21b0cddbfd086afaf6632b2458d8457422ff62\n+  linux-i386 bb6b05e0e91ae51d696ebce299a45f89babccdee\n+  macos-i386 9e835b370db42b480eafab4f8365028f1c5a5197\n+  linux-x86_64 e9372901737124fe6b776101f0877cc13c86252f\n+  macos-x86_64 550d9a1b0fb30e5fc296a833682db15088a6c803\n+\n S 2012-01-12 44352df\n   winnt-i386 fcb87845b0c80b1fa8b798d319a1bd4aaeaa91d1\n   linux-x86_64 dc84514290cafab43d0e79387931d6c79129b5ac"}]}