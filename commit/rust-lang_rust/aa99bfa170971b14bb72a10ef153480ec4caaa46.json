{"sha": "aa99bfa170971b14bb72a10ef153480ec4caaa46", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFhOTliZmExNzA5NzFiMTRiYjcyYTEwZWYxNTM0ODBlYzRjYWFhNDY=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2011-12-06T22:02:06Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2011-12-07T03:55:45Z"}, "message": "do not stringify AST nodes unless emitting comments", "tree": {"sha": "157cebd5f0e4f7b94893515a7888e18fb77a97d6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/157cebd5f0e4f7b94893515a7888e18fb77a97d6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/aa99bfa170971b14bb72a10ef153480ec4caaa46", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/aa99bfa170971b14bb72a10ef153480ec4caaa46", "html_url": "https://github.com/rust-lang/rust/commit/aa99bfa170971b14bb72a10ef153480ec4caaa46", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/aa99bfa170971b14bb72a10ef153480ec4caaa46/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "15d60326f67e84608ff8b2ffe1984d9b4d600ba6", "url": "https://api.github.com/repos/rust-lang/rust/commits/15d60326f67e84608ff8b2ffe1984d9b4d600ba6", "html_url": "https://github.com/rust-lang/rust/commit/15d60326f67e84608ff8b2ffe1984d9b4d600ba6"}], "stats": {"total": 8, "additions": 6, "deletions": 2}, "files": [{"sha": "693c8ae79e82e9993e1c937fcc1efee1f27b42db", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/aa99bfa170971b14bb72a10ef153480ec4caaa46/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa99bfa170971b14bb72a10ef153480ec4caaa46/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=aa99bfa170971b14bb72a10ef153480ec4caaa46", "patch": "@@ -4536,7 +4536,9 @@ fn zero_alloca(cx: @block_ctxt, llptr: ValueRef, t: ty::t)\n fn trans_stmt(cx: @block_ctxt, s: ast::stmt) -> @block_ctxt {\n     // FIXME Fill in cx.sp\n \n-    add_span_comment(cx, s.span, stmt_to_str(s));\n+    if (!bcx_ccx(cx).sess.get_opts().no_asm_comments) {\n+        add_span_comment(cx, s.span, stmt_to_str(s));\n+    }\n \n     let bcx = cx;\n     alt s.node {"}, {"sha": "b7756b0902d8b6b7d12671cb00b09940f952acdc", "filename": "src/comp/middle/trans_build.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/aa99bfa170971b14bb72a10ef153480ec4caaa46/src%2Fcomp%2Fmiddle%2Ftrans_build.rs", "raw_url": "https://github.com/rust-lang/rust/raw/aa99bfa170971b14bb72a10ef153480ec4caaa46/src%2Fcomp%2Fmiddle%2Ftrans_build.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans_build.rs?ref=aa99bfa170971b14bb72a10ef153480ec4caaa46", "patch": "@@ -515,7 +515,9 @@ fn add_span_comment(bcx: @block_ctxt, sp: span, text: str) {\n fn add_comment(bcx: @block_ctxt, text: str) {\n     let ccx = bcx_ccx(bcx);\n     if (!ccx.sess.get_opts().no_asm_comments) {\n-        let comment_text = \"; \" + text;\n+        check str::is_not_empty(\"$\");\n+        let sanitized = str::replace(text, \"$\", \"\");\n+        let comment_text = \"; \" + sanitized;\n         let asm = str::as_buf(comment_text, { |c|\n             str::as_buf(\"\", { |e|\n                 llvm::LLVMConstInlineAsm(T_fn([], T_void()), c, e, 0, 0)})});"}]}