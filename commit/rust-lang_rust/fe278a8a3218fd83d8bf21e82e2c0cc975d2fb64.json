{"sha": "fe278a8a3218fd83d8bf21e82e2c0cc975d2fb64", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZlMjc4YThhMzIxOGZkODNkOGJmMjFlODJlMmMwY2M5NzVkMmZiNjQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-09-07T03:06:34Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-09-07T03:06:34Z"}, "message": "Auto merge of #36252 - joshtriplett:union-field-never-used, r=sanxiyn\n\nFix \"field is never used\" warning to take unions into account\n\nWhen compiling code containing a union with an unused field, rustc says\n\"struct field is never used\".\n\nRather than saying \"struct or union\", or adding logic to determine the\ntype of the item, just change the message to \"field is never used\",\ndropping the \"struct\".\n\nUpdate tests accordingly.", "tree": {"sha": "049b0812007f7a663f6acbda56e33f459a66e840", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/049b0812007f7a663f6acbda56e33f459a66e840"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fe278a8a3218fd83d8bf21e82e2c0cc975d2fb64", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fe278a8a3218fd83d8bf21e82e2c0cc975d2fb64", "html_url": "https://github.com/rust-lang/rust/commit/fe278a8a3218fd83d8bf21e82e2c0cc975d2fb64", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fe278a8a3218fd83d8bf21e82e2c0cc975d2fb64/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3b272bf3102afd739d3e7284b898fa42fa1bd64e", "url": "https://api.github.com/repos/rust-lang/rust/commits/3b272bf3102afd739d3e7284b898fa42fa1bd64e", "html_url": "https://github.com/rust-lang/rust/commit/3b272bf3102afd739d3e7284b898fa42fa1bd64e"}, {"sha": "046c7f23680f9a8f24209be4097656f91ade0bbb", "url": "https://api.github.com/repos/rust-lang/rust/commits/046c7f23680f9a8f24209be4097656f91ade0bbb", "html_url": "https://github.com/rust-lang/rust/commit/046c7f23680f9a8f24209be4097656f91ade0bbb"}], "stats": {"total": 38, "additions": 32, "deletions": 6}, "files": [{"sha": "26a89feb2181f7ba5efeea5b8312c2c9b711d47c", "filename": "src/librustc/middle/dead.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fe278a8a3218fd83d8bf21e82e2c0cc975d2fb64/src%2Flibrustc%2Fmiddle%2Fdead.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe278a8a3218fd83d8bf21e82e2c0cc975d2fb64/src%2Flibrustc%2Fmiddle%2Fdead.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fdead.rs?ref=fe278a8a3218fd83d8bf21e82e2c0cc975d2fb64", "patch": "@@ -548,7 +548,7 @@ impl<'a, 'tcx, 'v> Visitor<'v> for DeadVisitor<'a, 'tcx> {\n     fn visit_struct_field(&mut self, field: &hir::StructField) {\n         if self.should_warn_about_field(&field) {\n             self.warn_dead_code(field.id, field.span,\n-                                field.name, \"struct field\");\n+                                field.name, \"field\");\n         }\n \n         intravisit::walk_struct_field(self, field);"}, {"sha": "3df089fc2004864a0d3cd88ce8c6dfb97174447f", "filename": "src/test/compile-fail/lint-dead-code-4.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/fe278a8a3218fd83d8bf21e82e2c0cc975d2fb64/src%2Ftest%2Fcompile-fail%2Flint-dead-code-4.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe278a8a3218fd83d8bf21e82e2c0cc975d2fb64/src%2Ftest%2Fcompile-fail%2Flint-dead-code-4.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Flint-dead-code-4.rs?ref=fe278a8a3218fd83d8bf21e82e2c0cc975d2fb64", "patch": "@@ -14,7 +14,7 @@\n \n struct Foo {\n     x: usize,\n-    b: bool, //~ ERROR: struct field is never used\n+    b: bool, //~ ERROR: field is never used\n }\n \n fn field_read(f: Foo) -> usize {\n@@ -46,8 +46,8 @@ enum IJK {\n     I, //~ ERROR variant is never used\n     J {\n         a: String,\n-        b: i32, //~ ERROR struct field is never used\n-        c: i32, //~ ERROR struct field is never used\n+        b: i32, //~ ERROR field is never used\n+        c: i32, //~ ERROR field is never used\n     },\n     K //~ ERROR variant is never used\n \n@@ -68,9 +68,9 @@ fn field_match_in_patterns(b: XYZ) -> String {\n }\n \n struct Bar {\n-    x: usize, //~ ERROR: struct field is never used\n+    x: usize, //~ ERROR: field is never used\n     b: bool,\n-    c: bool, //~ ERROR: struct field is never used\n+    c: bool, //~ ERROR: field is never used\n     _guard: ()\n }\n "}, {"sha": "7a552c8f8b76a0a45734eb683580cb9afc7f7a93", "filename": "src/test/compile-fail/union/union-lint-dead-code.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/fe278a8a3218fd83d8bf21e82e2c0cc975d2fb64/src%2Ftest%2Fcompile-fail%2Funion%2Funion-lint-dead-code.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fe278a8a3218fd83d8bf21e82e2c0cc975d2fb64/src%2Ftest%2Fcompile-fail%2Funion%2Funion-lint-dead-code.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Funion%2Funion-lint-dead-code.rs?ref=fe278a8a3218fd83d8bf21e82e2c0cc975d2fb64", "patch": "@@ -0,0 +1,26 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![feature(untagged_unions)]\n+#![deny(dead_code)]\n+\n+union Foo {\n+    x: usize,\n+    b: bool, //~ ERROR: field is never used\n+    _unused: u16,\n+}\n+\n+fn field_read(f: Foo) -> usize {\n+    unsafe { f.x }\n+}\n+\n+fn main() {\n+    let _ = field_read(Foo { x: 2 });\n+}"}]}