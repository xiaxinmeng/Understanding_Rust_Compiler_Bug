{"sha": "ee0a6bf0535a5a6c7e536d2cffa11959c3ee2ae3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVlMGE2YmYwNTM1YTVhNmM3ZTUzNmQyY2ZmYTExOTU5YzNlZTJhZTM=", "commit": {"author": {"name": "Adolfo Ochagav\u00eda", "email": "github@adolfo.ochagavia.xyz", "date": "2018-10-12T06:59:12Z"}, "committer": {"name": "Adolfo Ochagav\u00eda", "email": "github@adolfo.ochagavia.xyz", "date": "2018-10-12T06:59:12Z"}, "message": "Fold multiline comments", "tree": {"sha": "51ae5f73f3069769cf8d87f5d3d3e500408930fd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/51ae5f73f3069769cf8d87f5d3d3e500408930fd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ee0a6bf0535a5a6c7e536d2cffa11959c3ee2ae3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ee0a6bf0535a5a6c7e536d2cffa11959c3ee2ae3", "html_url": "https://github.com/rust-lang/rust/commit/ee0a6bf0535a5a6c7e536d2cffa11959c3ee2ae3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ee0a6bf0535a5a6c7e536d2cffa11959c3ee2ae3/comments", "author": {"login": "aochagavia", "id": 5196584, "node_id": "MDQ6VXNlcjUxOTY1ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5196584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aochagavia", "html_url": "https://github.com/aochagavia", "followers_url": "https://api.github.com/users/aochagavia/followers", "following_url": "https://api.github.com/users/aochagavia/following{/other_user}", "gists_url": "https://api.github.com/users/aochagavia/gists{/gist_id}", "starred_url": "https://api.github.com/users/aochagavia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aochagavia/subscriptions", "organizations_url": "https://api.github.com/users/aochagavia/orgs", "repos_url": "https://api.github.com/users/aochagavia/repos", "events_url": "https://api.github.com/users/aochagavia/events{/privacy}", "received_events_url": "https://api.github.com/users/aochagavia/received_events", "type": "User", "site_admin": false}, "committer": {"login": "aochagavia", "id": 5196584, "node_id": "MDQ6VXNlcjUxOTY1ODQ=", "avatar_url": "https://avatars.githubusercontent.com/u/5196584?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aochagavia", "html_url": "https://github.com/aochagavia", "followers_url": "https://api.github.com/users/aochagavia/followers", "following_url": "https://api.github.com/users/aochagavia/following{/other_user}", "gists_url": "https://api.github.com/users/aochagavia/gists{/gist_id}", "starred_url": "https://api.github.com/users/aochagavia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aochagavia/subscriptions", "organizations_url": "https://api.github.com/users/aochagavia/orgs", "repos_url": "https://api.github.com/users/aochagavia/repos", "events_url": "https://api.github.com/users/aochagavia/events{/privacy}", "received_events_url": "https://api.github.com/users/aochagavia/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2ba6f18586d02a6dbc32e0bea88f7b4236277ea1", "url": "https://api.github.com/repos/rust-lang/rust/commits/2ba6f18586d02a6dbc32e0bea88f7b4236277ea1", "html_url": "https://github.com/rust-lang/rust/commit/2ba6f18586d02a6dbc32e0bea88f7b4236277ea1"}], "stats": {"total": 42, "additions": 21, "deletions": 21}, "files": [{"sha": "1d89ac853131789b30a80d9fc6bd5d477fab94c5", "filename": "crates/ra_editor/src/folding_ranges.rs", "status": "modified", "additions": 19, "deletions": 19, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/ee0a6bf0535a5a6c7e536d2cffa11959c3ee2ae3/crates%2Fra_editor%2Fsrc%2Ffolding_ranges.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ee0a6bf0535a5a6c7e536d2cffa11959c3ee2ae3/crates%2Fra_editor%2Fsrc%2Ffolding_ranges.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_editor%2Fsrc%2Ffolding_ranges.rs?ref=ee0a6bf0535a5a6c7e536d2cffa11959c3ee2ae3", "patch": "@@ -1,6 +1,8 @@\n use rustc_hash::FxHashSet;\n \n use ra_syntax::{\n+    ast,\n+    AstNode,\n     File, TextRange, SyntaxNodeRef,\n     SyntaxKind,\n     Direction,\n@@ -27,27 +29,25 @@ pub fn folding_ranges(file: &File) -> Vec<Fold> {\n             continue;\n         }\n \n-        let range_and_kind = match node.kind() {\n-            SyntaxKind::COMMENT => (\n-                contiguous_range_for(SyntaxKind::COMMENT, node, &mut visited),\n-                Some(FoldKind::Comment),\n-            ),\n-            SyntaxKind::USE_ITEM => (\n-                contiguous_range_for(SyntaxKind::USE_ITEM, node, &mut visited),\n-                Some(FoldKind::Imports),\n-            ),\n-            _ => (None, None),\n-        };\n+        if let Some(comment) = ast::Comment::cast(node) {\n+            // Multiline comments (`/* ... */`) can only be folded if they span multiple lines\n+            let range = if let ast::CommentFlavor::Multiline = comment.flavor() {\n+                if comment.text().contains('\\n') {\n+                    Some(comment.syntax().range())\n+                } else {\n+                    None\n+                }\n+            } else {\n+                contiguous_range_for(SyntaxKind::COMMENT, node, &mut visited)\n+            };\n \n-        match range_and_kind {\n-            (Some(range), Some(kind)) => {\n-                res.push(Fold {\n-                    range: range,\n-                    kind: kind\n-                });\n-            }\n-            _ => {}\n+            range.map(|range| res.push(Fold { range, kind: FoldKind::Comment }));\n         }\n+\n+        if let SyntaxKind::USE_ITEM = node.kind() {\n+            contiguous_range_for(SyntaxKind::USE_ITEM, node, &mut visited)\n+                .map(|range| res.push(Fold { range, kind: FoldKind::Imports}));\n+        };\n     }\n \n     res"}, {"sha": "d1c525f685abbd1d13b854d4a0833d7ce7423ff6", "filename": "editors/code/src/extension.ts", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/ee0a6bf0535a5a6c7e536d2cffa11959c3ee2ae3/editors%2Fcode%2Fsrc%2Fextension.ts", "raw_url": "https://github.com/rust-lang/rust/raw/ee0a6bf0535a5a6c7e536d2cffa11959c3ee2ae3/editors%2Fcode%2Fsrc%2Fextension.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fextension.ts?ref=ee0a6bf0535a5a6c7e536d2cffa11959c3ee2ae3", "patch": "@@ -20,8 +20,8 @@ export function activate(context: vscode.ExtensionContext) {\n         f: (...args: any[]) => Promise<boolean>\n     ) {\n         const defaultCmd = `default:${name}`;\n-        const original = async (...args: any[]) =>\n-            await vscode.commands.executeCommand(defaultCmd, ...args);\n+        const original = (...args: any[]) =>\n+            vscode.commands.executeCommand(defaultCmd, ...args);\n \n         registerCommand(name, async (...args: any[]) => {\n             const editor = vscode.window.activeTextEditor;"}]}