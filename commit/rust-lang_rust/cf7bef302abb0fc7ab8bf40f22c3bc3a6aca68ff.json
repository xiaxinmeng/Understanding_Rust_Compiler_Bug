{"sha": "cf7bef302abb0fc7ab8bf40f22c3bc3a6aca68ff", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNmN2JlZjMwMmFiYjBmYzdhYjhiZjQwZjIyYzNiYzNhNmFjYTY4ZmY=", "commit": {"author": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2020-07-23T22:47:05Z"}, "committer": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2020-07-26T22:37:02Z"}, "message": "Properly reset `orig_id` when loading from incremental cache", "tree": {"sha": "b3194cd946df296223d8a29df9ce9c91c6dbc1c4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b3194cd946df296223d8a29df9ce9c91c6dbc1c4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cf7bef302abb0fc7ab8bf40f22c3bc3a6aca68ff", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7J9Gc3TfBwj2K399tAh+UQ6YsWQFAl8eBY4ACgkQtAh+UQ6Y\nsWQX/BAAsOkK74i9jyx5yuTrwkcRdzl+tpOTrsnVLzEzf44roOfeImc9P8tIx9xm\nH9qNSsN/7M46ZL7bg1mcBEYmXe6G0bdU9X1vdZdlkwdVMgqY/xKVrj+1Tb/984LO\nkyBniAz7yzC/vjzrPv7ZguCuTHqzD1X1HYhEeuHAA0/7rTmc4wPdDmXT6jS3iO9K\nfcICZELS24yUW3tTcqqE3J615aFzvnGn1JiPASBBPzChueAUPn5HTQOgW6Ng7i5V\n8gb7VilbEi/llpUESGBuCOhPxjJIeMCHmi0ICAObzR6R3x95D+RGF2Yhz0woc2Pq\nOO82X+3x0xoD0brwCFXd9Iuhm5JSRmAIf7EEf/IdW92R2eTjqIx1dZljlptzORvq\nMs+FBL3SydPqGkne6izBtB6fjyXUCiOwdj/6P2UQZ+ieZ3Rtj6ZeRdoJxUqTuCcl\nyDSQHF6SnO02B4ptvxIktsldS9eJHVLVvuIcIzW3MS2fyfq+l7lJVJlAyracAShI\nFftKeWl6UufBJ38nTTXgz470RjcOemI7eP0GhN0JWaaDC0QBF4jCb/GSiZFOZijo\nfJ4UmNEN4twUwFF0tDpgRcg/suKkKlsBct/yF/iOuIWlqaeBZY+whbbKk8fW3wEP\n3g7+FKMcCYvC0oESoysFqZNxQ4aWO0indQLGxCX/fv8Lezv2N9g=\n=eCvR\n-----END PGP SIGNATURE-----", "payload": "tree b3194cd946df296223d8a29df9ce9c91c6dbc1c4\nparent 7e0d3fdd888b97fbb014299ede0482cf0ecf626f\nauthor Aaron Hill <aa1ronham@gmail.com> 1595544425 -0400\ncommitter Aaron Hill <aa1ronham@gmail.com> 1595803022 -0400\n\nProperly reset `orig_id` when loading from incremental cache\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cf7bef302abb0fc7ab8bf40f22c3bc3a6aca68ff", "html_url": "https://github.com/rust-lang/rust/commit/cf7bef302abb0fc7ab8bf40f22c3bc3a6aca68ff", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cf7bef302abb0fc7ab8bf40f22c3bc3a6aca68ff/comments", "author": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7e0d3fdd888b97fbb014299ede0482cf0ecf626f", "url": "https://api.github.com/repos/rust-lang/rust/commits/7e0d3fdd888b97fbb014299ede0482cf0ecf626f", "html_url": "https://github.com/rust-lang/rust/commit/7e0d3fdd888b97fbb014299ede0482cf0ecf626f"}], "stats": {"total": 12, "additions": 11, "deletions": 1}, "files": [{"sha": "44da5d77b7ec8d7504659d8b6388cb288b0d4366", "filename": "src/librustc_span/hygiene.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/cf7bef302abb0fc7ab8bf40f22c3bc3a6aca68ff/src%2Flibrustc_span%2Fhygiene.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf7bef302abb0fc7ab8bf40f22c3bc3a6aca68ff/src%2Flibrustc_span%2Fhygiene.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_span%2Fhygiene.rs?ref=cf7bef302abb0fc7ab8bf40f22c3bc3a6aca68ff", "patch": "@@ -947,10 +947,20 @@ pub fn decode_expn_id<\n \n     // Don't decode the data inside `HygieneData::with`, since we need to recursively decode\n     // other ExpnIds\n-    let expn_data = decode_data(d, index)?;\n+    let mut expn_data = decode_data(d, index)?;\n \n     let expn_id = HygieneData::with(|hygiene_data| {\n         let expn_id = ExpnId(hygiene_data.expn_data.len() as u32);\n+\n+        // If we just deserialized an `ExpnData` owned by\n+        // the local crate, its `orig_id` will be stale,\n+        // so we need to update it to its own value.\n+        // This only happens when we deserialize the incremental cache,\n+        // since a crate will never decode its own metadata.\n+        if expn_data.krate == LOCAL_CRATE {\n+            expn_data.orig_id = Some(expn_id.0);\n+        }\n+\n         hygiene_data.expn_data.push(Some(expn_data));\n \n         // Drop lock() temporary early"}]}