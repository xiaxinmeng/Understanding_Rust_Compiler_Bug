{"sha": "eae42fd9d0d6e568282a4c782405058b64f1ef0b", "node_id": "C_kwDOAAsO6NoAKGVhZTQyZmQ5ZDBkNmU1NjgyODJhNGM3ODI0MDUwNThiNjRmMWVmMGI", "commit": {"author": {"name": "Jakob Degen", "email": "jakob@degen.com", "date": "2021-10-24T02:36:50Z"}, "committer": {"name": "Jakob Degen", "email": "jakob@degen.com", "date": "2021-10-24T02:36:50Z"}, "message": "Add regresstion test for #90024.\n\nUses 2 MCVEs from the issue tracker that test opposite sides of the problem.", "tree": {"sha": "90637f139a905c9924da201f92ce451722b6fa74", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/90637f139a905c9924da201f92ce451722b6fa74"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eae42fd9d0d6e568282a4c782405058b64f1ef0b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eae42fd9d0d6e568282a4c782405058b64f1ef0b", "html_url": "https://github.com/rust-lang/rust/commit/eae42fd9d0d6e568282a4c782405058b64f1ef0b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eae42fd9d0d6e568282a4c782405058b64f1ef0b/comments", "author": {"login": "JakobDegen", "id": 51179609, "node_id": "MDQ6VXNlcjUxMTc5NjA5", "avatar_url": "https://avatars.githubusercontent.com/u/51179609?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JakobDegen", "html_url": "https://github.com/JakobDegen", "followers_url": "https://api.github.com/users/JakobDegen/followers", "following_url": "https://api.github.com/users/JakobDegen/following{/other_user}", "gists_url": "https://api.github.com/users/JakobDegen/gists{/gist_id}", "starred_url": "https://api.github.com/users/JakobDegen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JakobDegen/subscriptions", "organizations_url": "https://api.github.com/users/JakobDegen/orgs", "repos_url": "https://api.github.com/users/JakobDegen/repos", "events_url": "https://api.github.com/users/JakobDegen/events{/privacy}", "received_events_url": "https://api.github.com/users/JakobDegen/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JakobDegen", "id": 51179609, "node_id": "MDQ6VXNlcjUxMTc5NjA5", "avatar_url": "https://avatars.githubusercontent.com/u/51179609?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JakobDegen", "html_url": "https://github.com/JakobDegen", "followers_url": "https://api.github.com/users/JakobDegen/followers", "following_url": "https://api.github.com/users/JakobDegen/following{/other_user}", "gists_url": "https://api.github.com/users/JakobDegen/gists{/gist_id}", "starred_url": "https://api.github.com/users/JakobDegen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JakobDegen/subscriptions", "organizations_url": "https://api.github.com/users/JakobDegen/orgs", "repos_url": "https://api.github.com/users/JakobDegen/repos", "events_url": "https://api.github.com/users/JakobDegen/events{/privacy}", "received_events_url": "https://api.github.com/users/JakobDegen/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9158fc2071d8b6424ca56bcebc1cf21d264e9d7d", "url": "https://api.github.com/repos/rust-lang/rust/commits/9158fc2071d8b6424ca56bcebc1cf21d264e9d7d", "html_url": "https://github.com/rust-lang/rust/commit/9158fc2071d8b6424ca56bcebc1cf21d264e9d7d"}], "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "ed8cb042b3ea6a6862f9b9be3bf5fa7b1321158c", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/issue-90024-adt-correct-subst.rs", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/eae42fd9d0d6e568282a4c782405058b64f1ef0b/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fissue-90024-adt-correct-subst.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eae42fd9d0d6e568282a4c782405058b64f1ef0b/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fissue-90024-adt-correct-subst.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fissue-90024-adt-correct-subst.rs?ref=eae42fd9d0d6e568282a4c782405058b64f1ef0b", "patch": "@@ -0,0 +1,37 @@\n+// Test that rustc doesn't ICE as in #90024.\n+// check-pass\n+// edition=2018\n+\n+#![warn(rust_2021_incompatible_closure_captures)]\n+\n+// Checks there's no double-subst into the generic args, otherwise we get OOB\n+// MCVE by @lqd\n+pub struct Graph<N, E, Ix> {\n+    _edges: E,\n+    _nodes: N,\n+    _ix: Vec<Ix>,\n+}\n+fn graph<N, E>() -> Graph<N, E, i32> {\n+    todo!()\n+}\n+fn first_ice() {\n+    let g = graph::<i32, i32>();\n+    let _ = || g;\n+}\n+\n+// Checks that there is a subst into the fields, otherwise we get normalization error\n+// MCVE by @cuviper\n+use std::iter::Empty;\n+struct Foo<I: Iterator> {\n+    data: Vec<I::Item>,\n+}\n+pub fn second_ice() {\n+    let v = Foo::<Empty<()>> { data: vec![] };\n+\n+    (|| v.data[0])();\n+}\n+\n+pub fn main() {\n+    first_ice();\n+    second_ice();\n+}"}]}