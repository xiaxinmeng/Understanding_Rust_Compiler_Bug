{"sha": "62939e41b23ebcb0fb4fd1f2abefe360d313fe56", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYyOTM5ZTQxYjIzZWJjYjBmYjRmZDFmMmFiZWZlMzYwZDMxM2ZlNTY=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-06-16T21:59:51Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-06-17T00:23:20Z"}, "message": "rustc: Parse inner items of file-level modules linked from crate files\n\nIssue #487", "tree": {"sha": "e7d3e142a303612a2d1e105e70d8b4a0dce71a3a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e7d3e142a303612a2d1e105e70d8b4a0dce71a3a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/62939e41b23ebcb0fb4fd1f2abefe360d313fe56", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/62939e41b23ebcb0fb4fd1f2abefe360d313fe56", "html_url": "https://github.com/rust-lang/rust/commit/62939e41b23ebcb0fb4fd1f2abefe360d313fe56", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/62939e41b23ebcb0fb4fd1f2abefe360d313fe56/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "40746fa447b78a27b649db41a6bfe63f6645d5eb", "url": "https://api.github.com/repos/rust-lang/rust/commits/40746fa447b78a27b649db41a6bfe63f6645d5eb", "html_url": "https://github.com/rust-lang/rust/commit/40746fa447b78a27b649db41a6bfe63f6645d5eb"}], "stats": {"total": 23, "additions": 19, "deletions": 4}, "files": [{"sha": "3366ddf51abd177bfe058340922435bd77657bb0", "filename": "src/comp/front/eval.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/62939e41b23ebcb0fb4fd1f2abefe360d313fe56/src%2Fcomp%2Ffront%2Feval.rs", "raw_url": "https://github.com/rust-lang/rust/raw/62939e41b23ebcb0fb4fd1f2abefe360d313fe56/src%2Fcomp%2Ffront%2Feval.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Ffront%2Feval.rs?ref=62939e41b23ebcb0fb4fd1f2abefe360d313fe56", "patch": "@@ -10,6 +10,7 @@ import ast::ident;\n import front::parser::parser;\n import front::parser::spanned;\n import front::parser::new_parser;\n+import front::parser::parse_inner_attributes;\n import front::parser::parse_mod_items;\n import util::common;\n import util::common::filename;\n@@ -287,16 +288,19 @@ fn eval_crate_directive(ctx cx, env e, @ast::crate_directive cdir, str prefix,\n             auto p0 =\n                 new_parser(cx.sess, e, start_id, full_path, cx.chpos,\n                            cx.next_ann);\n-            auto m0 = parse_mod_items(p0, token::EOF, []);\n+            auto inner_attrs = parse_inner_attributes(p0);\n+            auto first_item_outer_attrs = inner_attrs._1;\n+            auto m0 = parse_mod_items(p0, token::EOF,\n+                                      first_item_outer_attrs);\n             auto next_id = p0.next_def_id();\n             // Thread defids and chpos through the parsers\n \n             cx.p.set_def(next_id._1);\n             cx.chpos = p0.get_chpos();\n             cx.next_ann = p0.next_ann_num();\n-            auto i =\n-                front::parser::mk_item(cx.p, cdir.span.lo, cdir.span.hi, id,\n-                                       ast::item_mod(m0), []);\n+            auto i = front::parser::mk_item(cx.p, cdir.span.lo, cdir.span.hi,\n+                                            id, ast::item_mod(m0),\n+                                            inner_attrs._0);\n             vec::push[@ast::item](items, i);\n         }\n         case (ast::cdir_dir_mod(?id, ?dir_opt, ?cdirs)) {"}, {"sha": "5ab36dfe00dbea25497265bfe0dc024952532b84", "filename": "src/test/run-pass/crate-attributes-src/foo.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/62939e41b23ebcb0fb4fd1f2abefe360d313fe56/src%2Ftest%2Frun-pass%2Fcrate-attributes-src%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/62939e41b23ebcb0fb4fd1f2abefe360d313fe56/src%2Ftest%2Frun-pass%2Fcrate-attributes-src%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fcrate-attributes-src%2Ffoo.rs?ref=62939e41b23ebcb0fb4fd1f2abefe360d313fe56", "patch": "@@ -0,0 +1,8 @@\n+// These are attributes of the foo module\n+#[attr1 = \"val\"];\n+#[attr2 = \"val\"];\n+\n+// Attributes of the following function\n+#[attr1 = \"val\"]\n+#[attr2 = \"val\"]\n+fn main() { }"}, {"sha": "c0ed56556b859e55c47e95372777db6d2aa19d7d", "filename": "src/test/run-pass/crate-attributes.rc", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/62939e41b23ebcb0fb4fd1f2abefe360d313fe56/src%2Ftest%2Frun-pass%2Fcrate-attributes.rc", "raw_url": "https://github.com/rust-lang/rust/raw/62939e41b23ebcb0fb4fd1f2abefe360d313fe56/src%2Ftest%2Frun-pass%2Fcrate-attributes.rc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fcrate-attributes.rc?ref=62939e41b23ebcb0fb4fd1f2abefe360d313fe56", "patch": "@@ -0,0 +1,3 @@\n+mod m = \"crate-attributes-src\" {\n+  mod foo;\n+}\n\\ No newline at end of file"}]}