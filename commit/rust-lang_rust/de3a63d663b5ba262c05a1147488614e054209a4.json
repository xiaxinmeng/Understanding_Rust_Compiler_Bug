{"sha": "de3a63d663b5ba262c05a1147488614e054209a4", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRlM2E2M2Q2NjNiNWJhMjYyYzA1YTExNDc0ODg2MTRlMDU0MjA5YTQ=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-03-07T02:01:07Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2018-03-07T07:38:06Z"}, "message": "Rollup merge of #48618 - scottmcm:elaborate-exitcode, r=alexcrichton\n\nBetter docs and associated SUCCESS/FAILURE for process::ExitCode\n\nFollow-up to https://github.com/rust-lang/rust/pull/48497#discussion_r170676525, since that PR was the minimal thing to unblock https://github.com/rust-lang/rust/issues/48453#issuecomment-368155082.\n\nr? @nikomatsakis", "tree": {"sha": "8774da3bced0d037dc6c423a290a9d8038dd7a77", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8774da3bced0d037dc6c423a290a9d8038dd7a77"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/de3a63d663b5ba262c05a1147488614e054209a4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/de3a63d663b5ba262c05a1147488614e054209a4", "html_url": "https://github.com/rust-lang/rust/commit/de3a63d663b5ba262c05a1147488614e054209a4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/de3a63d663b5ba262c05a1147488614e054209a4/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a06aed1df7f0bf6a2083d6b0434428ef2242cff9", "url": "https://api.github.com/repos/rust-lang/rust/commits/a06aed1df7f0bf6a2083d6b0434428ef2242cff9", "html_url": "https://github.com/rust-lang/rust/commit/a06aed1df7f0bf6a2083d6b0434428ef2242cff9"}, {"sha": "74c5c6e6cb0425284f57fece6fbf248e827ea06d", "url": "https://api.github.com/repos/rust-lang/rust/commits/74c5c6e6cb0425284f57fece6fbf248e827ea06d", "html_url": "https://github.com/rust-lang/rust/commit/74c5c6e6cb0425284f57fece6fbf248e827ea06d"}], "stats": {"total": 140, "additions": 108, "deletions": 32}, "files": [{"sha": "d5ac2d19e831f81c6fa4b7c15d1c6800493277ab", "filename": "src/libstd/process.rs", "status": "modified", "additions": 43, "deletions": 28, "changes": 71, "blob_url": "https://github.com/rust-lang/rust/blob/de3a63d663b5ba262c05a1147488614e054209a4/src%2Flibstd%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de3a63d663b5ba262c05a1147488614e054209a4/src%2Flibstd%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fprocess.rs?ref=de3a63d663b5ba262c05a1147488614e054209a4", "patch": "@@ -1080,14 +1080,45 @@ impl fmt::Display for ExitStatus {\n     }\n }\n \n-/// This is ridiculously unstable, as it's a completely-punted-upon part\n-/// of the `?`-in-`main` RFC.  It's here only to allow experimenting with\n-/// returning a code directly from main.  It will definitely change\n-/// drastically before being stabilized, if it doesn't just get deleted.\n-#[doc(hidden)]\n+/// This type represents the status code a process can return to its\n+/// parent under normal termination.\n+///\n+/// Numeric values used in this type don't have portable meanings, and\n+/// different platforms may mask different amounts of them.\n+///\n+/// For the platform's canonical successful and unsuccessful codes, see\n+/// the [`SUCCESS`] and [`FAILURE`] associated items.\n+///\n+/// [`SUCCESS`]: #associatedconstant.SUCCESS\n+/// [`FAILURE`]: #associatedconstant.FAILURE\n+///\n+/// **Warning**: While various forms of this were discussed in [RFC #1937],\n+/// it was ultimately cut from that RFC, and thus this type is more subject\n+/// to change even than the usual unstable item churn.\n+///\n+/// [RFC #1937]: https://github.com/rust-lang/rfcs/pull/1937\n #[derive(Clone, Copy, Debug)]\n-#[unstable(feature = \"process_exitcode_placeholder\", issue = \"43301\")]\n-pub struct ExitCode(pub i32);\n+#[unstable(feature = \"process_exitcode_placeholder\", issue = \"48711\")]\n+pub struct ExitCode(imp::ExitCode);\n+\n+#[unstable(feature = \"process_exitcode_placeholder\", issue = \"48711\")]\n+impl ExitCode {\n+    /// The canonical ExitCode for successful termination on this platform.\n+    ///\n+    /// Note that a `()`-returning `main` implicitly results in a successful\n+    /// termination, so there's no need to return this from `main` unless\n+    /// you're also returning other possible codes.\n+    #[unstable(feature = \"process_exitcode_placeholder\", issue = \"48711\")]\n+    pub const SUCCESS: ExitCode = ExitCode(imp::ExitCode::SUCCESS);\n+\n+    /// The canonical ExitCode for unsuccessful termination on this platform.\n+    ///\n+    /// If you're only returning this and `SUCCESS` from `main`, consider\n+    /// instead returning `Err(_)` and `Ok(())` respectively, which will\n+    /// return the same codes (but will also `eprintln!` the error).\n+    #[unstable(feature = \"process_exitcode_placeholder\", issue = \"48711\")]\n+    pub const FAILURE: ExitCode = ExitCode(imp::ExitCode::FAILURE);\n+}\n \n impl Child {\n     /// Forces the child to exit. This is equivalent to sending a\n@@ -1401,18 +1432,6 @@ pub fn id() -> u32 {\n     ::sys::os::getpid()\n }\n \n-#[cfg(target_arch = \"wasm32\")]\n-mod exit {\n-    pub const SUCCESS: i32 = 0;\n-    pub const FAILURE: i32 = 1;\n-}\n-#[cfg(not(target_arch = \"wasm32\"))]\n-mod exit {\n-    use libc;\n-    pub const SUCCESS: i32 = libc::EXIT_SUCCESS;\n-    pub const FAILURE: i32 = libc::EXIT_FAILURE;\n-}\n-\n /// A trait for implementing arbitrary return types in the `main` function.\n ///\n /// The c-main function only supports to return integers as return type.\n@@ -1433,18 +1452,15 @@ pub trait Termination {\n \n #[unstable(feature = \"termination_trait_lib\", issue = \"43301\")]\n impl Termination for () {\n-    fn report(self) -> i32 { exit::SUCCESS }\n+    fn report(self) -> i32 { ExitCode::SUCCESS.report() }\n }\n \n #[unstable(feature = \"termination_trait_lib\", issue = \"43301\")]\n impl<E: fmt::Debug> Termination for Result<(), E> {\n     fn report(self) -> i32 {\n         match self {\n-            Ok(val) => val.report(),\n-            Err(err) => {\n-                eprintln!(\"Error: {:?}\", err);\n-                exit::FAILURE\n-            }\n+            Ok(()) => ().report(),\n+            Err(err) => Err::<!, _>(err).report(),\n         }\n     }\n }\n@@ -1459,15 +1475,14 @@ impl<E: fmt::Debug> Termination for Result<!, E> {\n     fn report(self) -> i32 {\n         let Err(err) = self;\n         eprintln!(\"Error: {:?}\", err);\n-        exit::FAILURE\n+        ExitCode::FAILURE.report()\n     }\n }\n \n #[unstable(feature = \"termination_trait_lib\", issue = \"43301\")]\n impl Termination for ExitCode {\n     fn report(self) -> i32 {\n-        let ExitCode(code) = self;\n-        code\n+        self.0.as_i32()\n     }\n }\n "}, {"sha": "fcd40c15c1708bf77e63559d5103f9461aa3c132", "filename": "src/libstd/sys/cloudabi/shims/process.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/de3a63d663b5ba262c05a1147488614e054209a4/src%2Flibstd%2Fsys%2Fcloudabi%2Fshims%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de3a63d663b5ba262c05a1147488614e054209a4/src%2Flibstd%2Fsys%2Fcloudabi%2Fshims%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fcloudabi%2Fshims%2Fprocess.rs?ref=de3a63d663b5ba262c05a1147488614e054209a4", "patch": "@@ -126,6 +126,18 @@ impl fmt::Display for ExitStatus {\n     }\n }\n \n+#[derive(PartialEq, Eq, Clone, Copy, Debug)]\n+pub struct ExitCode(bool);\n+\n+impl ExitCode {\n+    pub const SUCCESS: ExitCode = ExitCode(false);\n+    pub const FAILURE: ExitCode = ExitCode(true);\n+\n+    pub fn as_i32(&self) -> i32 {\n+        self.0 as i32\n+    }\n+}\n+\n pub struct Process(Void);\n \n impl Process {"}, {"sha": "d0b94e14f54e93e1c4bd14ee117ca523b604a45c", "filename": "src/libstd/sys/redox/process.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/de3a63d663b5ba262c05a1147488614e054209a4/src%2Flibstd%2Fsys%2Fredox%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de3a63d663b5ba262c05a1147488614e054209a4/src%2Flibstd%2Fsys%2Fredox%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fredox%2Fprocess.rs?ref=de3a63d663b5ba262c05a1147488614e054209a4", "patch": "@@ -13,6 +13,7 @@ use ffi::OsStr;\n use os::unix::ffi::OsStrExt;\n use fmt;\n use io::{self, Error, ErrorKind};\n+use libc::{EXIT_SUCCESS, EXIT_FAILURE};\n use path::{Path, PathBuf};\n use sys::fd::FileDesc;\n use sys::fs::{File, OpenOptions};\n@@ -480,6 +481,18 @@ impl fmt::Display for ExitStatus {\n     }\n }\n \n+#[derive(PartialEq, Eq, Clone, Copy, Debug)]\n+pub struct ExitCode(u8);\n+\n+impl ExitCode {\n+    pub const SUCCESS: ExitCode = ExitCode(EXIT_SUCCESS as _);\n+    pub const FAILURE: ExitCode = ExitCode(EXIT_FAILURE as _);\n+\n+    pub fn as_i32(&self) -> i32 {\n+        self.0 as i32\n+    }\n+}\n+\n /// The unique id of the process (this should never be negative).\n pub struct Process {\n     pid: usize,"}, {"sha": "d8ac26c45b172982e07543a570e8189237b2f632", "filename": "src/libstd/sys/unix/process/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/de3a63d663b5ba262c05a1147488614e054209a4/src%2Flibstd%2Fsys%2Funix%2Fprocess%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de3a63d663b5ba262c05a1147488614e054209a4/src%2Flibstd%2Fsys%2Funix%2Fprocess%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Funix%2Fprocess%2Fmod.rs?ref=de3a63d663b5ba262c05a1147488614e054209a4", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-pub use self::process_common::{Command, ExitStatus, Stdio, StdioPipes};\n+pub use self::process_common::{Command, ExitStatus, ExitCode, Stdio, StdioPipes};\n pub use self::process_inner::Process;\n \n mod process_common;"}, {"sha": "d0486f06a143af2598f3987ed18054583f4bd552", "filename": "src/libstd/sys/unix/process/process_common.rs", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/de3a63d663b5ba262c05a1147488614e054209a4/src%2Flibstd%2Fsys%2Funix%2Fprocess%2Fprocess_common.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de3a63d663b5ba262c05a1147488614e054209a4/src%2Flibstd%2Fsys%2Funix%2Fprocess%2Fprocess_common.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Funix%2Fprocess%2Fprocess_common.rs?ref=de3a63d663b5ba262c05a1147488614e054209a4", "patch": "@@ -13,7 +13,7 @@ use os::unix::prelude::*;\n use ffi::{OsString, OsStr, CString, CStr};\n use fmt;\n use io;\n-use libc::{self, c_int, gid_t, uid_t, c_char};\n+use libc::{self, c_int, gid_t, uid_t, c_char, EXIT_SUCCESS, EXIT_FAILURE};\n use ptr;\n use sys::fd::FileDesc;\n use sys::fs::{File, OpenOptions};\n@@ -393,6 +393,18 @@ impl fmt::Display for ExitStatus {\n     }\n }\n \n+#[derive(PartialEq, Eq, Clone, Copy, Debug)]\n+pub struct ExitCode(u8);\n+\n+impl ExitCode {\n+    pub const SUCCESS: ExitCode = ExitCode(EXIT_SUCCESS as _);\n+    pub const FAILURE: ExitCode = ExitCode(EXIT_FAILURE as _);\n+\n+    pub fn as_i32(&self) -> i32 {\n+        self.0 as i32\n+    }\n+}\n+\n #[cfg(all(test, not(target_os = \"emscripten\")))]\n mod tests {\n     use super::*;"}, {"sha": "433e9cec7c8accf78195af2536c004396268f89d", "filename": "src/libstd/sys/wasm/process.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/de3a63d663b5ba262c05a1147488614e054209a4/src%2Flibstd%2Fsys%2Fwasm%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de3a63d663b5ba262c05a1147488614e054209a4/src%2Flibstd%2Fsys%2Fwasm%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fwasm%2Fprocess.rs?ref=de3a63d663b5ba262c05a1147488614e054209a4", "patch": "@@ -129,6 +129,18 @@ impl fmt::Display for ExitStatus {\n     }\n }\n \n+#[derive(PartialEq, Eq, Clone, Copy, Debug)]\n+pub struct ExitCode(bool);\n+\n+impl ExitCode {\n+    pub const SUCCESS: ExitCode = ExitCode(false);\n+    pub const FAILURE: ExitCode = ExitCode(true);\n+\n+    pub fn as_i32(&self) -> i32 {\n+        self.0 as i32\n+    }\n+}\n+\n pub struct Process(Void);\n \n impl Process {"}, {"sha": "f1ab9c4760965e38efcf59dbb4b98ebd603dcca9", "filename": "src/libstd/sys/windows/process.rs", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/de3a63d663b5ba262c05a1147488614e054209a4/src%2Flibstd%2Fsys%2Fwindows%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de3a63d663b5ba262c05a1147488614e054209a4/src%2Flibstd%2Fsys%2Fwindows%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fwindows%2Fprocess.rs?ref=de3a63d663b5ba262c05a1147488614e054209a4", "patch": "@@ -18,7 +18,7 @@ use ffi::{OsString, OsStr};\n use fmt;\n use fs;\n use io::{self, Error, ErrorKind};\n-use libc::c_void;\n+use libc::{c_void, EXIT_SUCCESS, EXIT_FAILURE};\n use mem;\n use os::windows::ffi::OsStrExt;\n use path::Path;\n@@ -408,6 +408,18 @@ impl fmt::Display for ExitStatus {\n     }\n }\n \n+#[derive(PartialEq, Eq, Clone, Copy, Debug)]\n+pub struct ExitCode(c::DWORD);\n+\n+impl ExitCode {\n+    pub const SUCCESS: ExitCode = ExitCode(EXIT_SUCCESS as _);\n+    pub const FAILURE: ExitCode = ExitCode(EXIT_FAILURE as _);\n+\n+    pub fn as_i32(&self) -> i32 {\n+        self.0 as i32\n+    }\n+}\n+\n fn zeroed_startupinfo() -> c::STARTUPINFO {\n     c::STARTUPINFO {\n         cb: 0,"}, {"sha": "80fa4d17b6116904899c5a1e238958208b89526c", "filename": "src/test/run-pass/rfc-1937-termination-trait/termination-trait-for-exitcode.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/de3a63d663b5ba262c05a1147488614e054209a4/src%2Ftest%2Frun-pass%2Frfc-1937-termination-trait%2Ftermination-trait-for-exitcode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de3a63d663b5ba262c05a1147488614e054209a4/src%2Ftest%2Frun-pass%2Frfc-1937-termination-trait%2Ftermination-trait-for-exitcode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Frfc-1937-termination-trait%2Ftermination-trait-for-exitcode.rs?ref=de3a63d663b5ba262c05a1147488614e054209a4", "patch": "@@ -14,5 +14,5 @@\n use std::process::ExitCode;\n \n fn main() -> ExitCode {\n-    ExitCode(0)\n+    ExitCode::SUCCESS\n }"}]}