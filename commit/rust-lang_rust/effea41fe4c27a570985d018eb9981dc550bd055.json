{"sha": "effea41fe4c27a570985d018eb9981dc550bd055", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVmZmVhNDFmZTRjMjdhNTcwOTg1ZDAxOGViOTk4MWRjNTUwYmQwNTU=", "commit": {"author": {"name": "Andy Russell", "email": "arussell123@gmail.com", "date": "2019-05-24T18:09:43Z"}, "committer": {"name": "Andy Russell", "email": "arussell123@gmail.com", "date": "2019-05-24T18:52:55Z"}, "message": "tweak `let_and_return` diagnostic\n\nLabel the unnecessary let binding and convert the note to structured\nsuggestion.", "tree": {"sha": "f1207ca3956ac2ed2a7e58aa8c4e0a8f1d8d4ef4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f1207ca3956ac2ed2a7e58aa8c4e0a8f1d8d4ef4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/effea41fe4c27a570985d018eb9981dc550bd055", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQFKBAABCAA0FiEELriChyEaiMu0yCg7viIhAz7bw3QFAlzoPYoWHGFydXNzZWxs\nMTIzQGdtYWlsLmNvbQAKCRC+IiEDPtvDdEEOCAC2EPlQ9M/uFSwOaMU8pyp8cX70\nX1IGJsvjOKqRwpLX8vRlq1ouDHIFlezD/krTg2wLN8JNkW3aj3klVqBsRGzXVDAF\nWwaa2vJJ3NmAegJ9JgxyYVQ2RsGUUwhchEnb3mvuVHmO3uoQKO+YDCsw5TCJw7mk\nFCnDMISH+WjKsu5dodpG4IIXEUICkXjYRXFLTGBvfTkRZ/9flcehoQ5crEAxPGzu\n8Sm+KMLjT+QT26cJIQ5mo8RtjWWSvSjI65s0AxCpkjCqB/k0aM2ze8HWKHm9OOUX\njO4QFlG89wbjbsfG2j8izEVs3c1CqD+IXdlBnBWophxDUjfR29zTzx40IQIM\n=z04S\n-----END PGP SIGNATURE-----", "payload": "tree f1207ca3956ac2ed2a7e58aa8c4e0a8f1d8d4ef4\nparent d519ed433e3140d00ecbe3f62140374b8c19fae0\nauthor Andy Russell <arussell123@gmail.com> 1558721383 -0400\ncommitter Andy Russell <arussell123@gmail.com> 1558723975 -0400\n\ntweak `let_and_return` diagnostic\n\nLabel the unnecessary let binding and convert the note to structured\nsuggestion.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/effea41fe4c27a570985d018eb9981dc550bd055", "html_url": "https://github.com/rust-lang/rust/commit/effea41fe4c27a570985d018eb9981dc550bd055", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/effea41fe4c27a570985d018eb9981dc550bd055/comments", "author": {"login": "euclio", "id": 1372438, "node_id": "MDQ6VXNlcjEzNzI0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1372438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/euclio", "html_url": "https://github.com/euclio", "followers_url": "https://api.github.com/users/euclio/followers", "following_url": "https://api.github.com/users/euclio/following{/other_user}", "gists_url": "https://api.github.com/users/euclio/gists{/gist_id}", "starred_url": "https://api.github.com/users/euclio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/euclio/subscriptions", "organizations_url": "https://api.github.com/users/euclio/orgs", "repos_url": "https://api.github.com/users/euclio/repos", "events_url": "https://api.github.com/users/euclio/events{/privacy}", "received_events_url": "https://api.github.com/users/euclio/received_events", "type": "User", "site_admin": false}, "committer": {"login": "euclio", "id": 1372438, "node_id": "MDQ6VXNlcjEzNzI0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1372438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/euclio", "html_url": "https://github.com/euclio", "followers_url": "https://api.github.com/users/euclio/followers", "following_url": "https://api.github.com/users/euclio/following{/other_user}", "gists_url": "https://api.github.com/users/euclio/gists{/gist_id}", "starred_url": "https://api.github.com/users/euclio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/euclio/subscriptions", "organizations_url": "https://api.github.com/users/euclio/orgs", "repos_url": "https://api.github.com/users/euclio/repos", "events_url": "https://api.github.com/users/euclio/events{/privacy}", "received_events_url": "https://api.github.com/users/euclio/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d519ed433e3140d00ecbe3f62140374b8c19fae0", "url": "https://api.github.com/repos/rust-lang/rust/commits/d519ed433e3140d00ecbe3f62140374b8c19fae0", "html_url": "https://github.com/rust-lang/rust/commit/d519ed433e3140d00ecbe3f62140374b8c19fae0"}], "stats": {"total": 66, "additions": 43, "deletions": 23}, "files": [{"sha": "8976d73fc9a240effeb2cfb9e3623f359bbf59c7", "filename": "clippy_lints/src/returns.rs", "status": "modified", "additions": 23, "deletions": 8, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/effea41fe4c27a570985d018eb9981dc550bd055/clippy_lints%2Fsrc%2Freturns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/effea41fe4c27a570985d018eb9981dc550bd055/clippy_lints%2Fsrc%2Freturns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Freturns.rs?ref=effea41fe4c27a570985d018eb9981dc550bd055", "patch": "@@ -7,7 +7,7 @@ use syntax::source_map::Span;\n use syntax::visit::FnKind;\n use syntax_pos::BytePos;\n \n-use crate::utils::{in_macro_or_desugar, match_path_ast, snippet_opt, span_lint_and_then, span_note_and_lint};\n+use crate::utils::{in_macro_or_desugar, match_path_ast, snippet_opt, span_lint_and_then};\n \n declare_clippy_lint! {\n     /// **What it does:** Checks for return statements at the end of a block.\n@@ -164,13 +164,28 @@ impl Return {\n             if match_path_ast(path, &[&*ident.name.as_str()]);\n             if !in_external_macro(cx.sess(), initexpr.span);\n             then {\n-                    span_note_and_lint(cx,\n-                                       LET_AND_RETURN,\n-                                       retexpr.span,\n-                                       \"returning the result of a let binding from a block. \\\n-                                       Consider returning the expression directly.\",\n-                                       initexpr.span,\n-                                       \"this expression can be directly returned\");\n+                span_lint_and_then(\n+                    cx,\n+                    LET_AND_RETURN,\n+                    retexpr.span,\n+                    \"returning the result of a let binding from a block\",\n+                    |err| {\n+                        err.span_label(local.span, \"unnecessary let binding\");\n+\n+                        if let Some(snippet) = snippet_opt(cx, initexpr.span) {\n+                            err.multipart_suggestion(\n+                                \"return the expression directly\",\n+                                vec![\n+                                    (local.span, String::new()),\n+                                    (retexpr.span, snippet),\n+                                ],\n+                                Applicability::MachineApplicable,\n+                            );\n+                        } else {\n+                            err.span_help(initexpr.span, \"this expression can be directly returned\");\n+                        }\n+                    },\n+                );\n             }\n         }\n     }"}, {"sha": "74d070dc4b28a663e085acf9f409503a0bffee54", "filename": "tests/ui/author/matches.stderr", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/effea41fe4c27a570985d018eb9981dc550bd055/tests%2Fui%2Fauthor%2Fmatches.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/effea41fe4c27a570985d018eb9981dc550bd055/tests%2Fui%2Fauthor%2Fmatches.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fauthor%2Fmatches.stderr?ref=effea41fe4c27a570985d018eb9981dc550bd055", "patch": "@@ -1,15 +1,17 @@\n-error: returning the result of a let binding from a block. Consider returning the expression directly.\n+error: returning the result of a let binding from a block\n   --> $DIR/matches.rs:9:13\n    |\n+LL |             let x = 3;\n+   |             ---------- unnecessary let binding\n LL |             x\n    |             ^\n    |\n    = note: `-D clippy::let-and-return` implied by `-D warnings`\n-note: this expression can be directly returned\n-  --> $DIR/matches.rs:8:21\n+help: return the expression directly\n+   |\n+LL |             \n+LL |             3\n    |\n-LL |             let x = 3;\n-   |                     ^\n \n error: aborting due to previous error\n "}, {"sha": "319f45c0a8a0b071ce168aac260ac0b85bc429b4", "filename": "tests/ui/let_return.stderr", "status": "modified", "additions": 13, "deletions": 10, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/effea41fe4c27a570985d018eb9981dc550bd055/tests%2Fui%2Flet_return.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/effea41fe4c27a570985d018eb9981dc550bd055/tests%2Fui%2Flet_return.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flet_return.stderr?ref=effea41fe4c27a570985d018eb9981dc550bd055", "patch": "@@ -1,27 +1,30 @@\n-error: returning the result of a let binding from a block. Consider returning the expression directly.\n+error: returning the result of a let binding from a block\n   --> $DIR/let_return.rs:7:5\n    |\n+LL |     let x = 5;\n+   |     ---------- unnecessary let binding\n LL |     x\n    |     ^\n    |\n    = note: `-D clippy::let-and-return` implied by `-D warnings`\n-note: this expression can be directly returned\n-  --> $DIR/let_return.rs:6:13\n+help: return the expression directly\n+   |\n+LL |     \n+LL |     5\n    |\n-LL |     let x = 5;\n-   |             ^\n \n-error: returning the result of a let binding from a block. Consider returning the expression directly.\n+error: returning the result of a let binding from a block\n   --> $DIR/let_return.rs:13:9\n    |\n+LL |         let x = 5;\n+   |         ---------- unnecessary let binding\n LL |         x\n    |         ^\n+help: return the expression directly\n    |\n-note: this expression can be directly returned\n-  --> $DIR/let_return.rs:12:17\n+LL |         \n+LL |         5\n    |\n-LL |         let x = 5;\n-   |                 ^\n \n error: aborting due to 2 previous errors\n "}]}