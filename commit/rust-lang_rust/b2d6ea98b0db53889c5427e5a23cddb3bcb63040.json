{"sha": "b2d6ea98b0db53889c5427e5a23cddb3bcb63040", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIyZDZlYTk4YjBkYjUzODg5YzU0MjdlNWEyM2NkZGIzYmNiNjMwNDA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-10-07T19:30:24Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-10-07T19:30:24Z"}, "message": "Auto merge of #54810 - 1aim:unused-impl-trait, r=oli-obk\n\nFix dead code lint for functions using impl Trait\n\nFixes https://github.com/rust-lang/rust/issues/54754\n\nThis is a minimal fix that doesn't add any new queries or touches unnecessary code. Please nominate for beta backport if wanted.", "tree": {"sha": "bd63322b8fb1b86ea70912c2d81a79d7633f4afb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bd63322b8fb1b86ea70912c2d81a79d7633f4afb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b2d6ea98b0db53889c5427e5a23cddb3bcb63040", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b2d6ea98b0db53889c5427e5a23cddb3bcb63040", "html_url": "https://github.com/rust-lang/rust/commit/b2d6ea98b0db53889c5427e5a23cddb3bcb63040", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0ee045ea09127e5318e9cb1fff85ec34b9e3e6eb", "url": "https://api.github.com/repos/rust-lang/rust/commits/0ee045ea09127e5318e9cb1fff85ec34b9e3e6eb", "html_url": "https://github.com/rust-lang/rust/commit/0ee045ea09127e5318e9cb1fff85ec34b9e3e6eb"}, {"sha": "e24f4d57b01be3eb3b36c49385cbe89e096586bc", "url": "https://api.github.com/repos/rust-lang/rust/commits/e24f4d57b01be3eb3b36c49385cbe89e096586bc", "html_url": "https://github.com/rust-lang/rust/commit/e24f4d57b01be3eb3b36c49385cbe89e096586bc"}], "stats": {"total": 31, "additions": 24, "deletions": 7}, "files": [{"sha": "ea90922b11066ad0e633cf1e34caef837b456742", "filename": "src/librustc/middle/dead.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Flibrustc%2Fmiddle%2Fdead.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Flibrustc%2Fmiddle%2Fdead.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fdead.rs?ref=b2d6ea98b0db53889c5427e5a23cddb3bcb63040", "patch": "@@ -398,7 +398,13 @@ fn create_and_seed_worklist<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n                                       krate: &hir::Crate)\n                                       -> Vec<ast::NodeId>\n {\n-    let worklist = access_levels.map.iter().map(|(&id, _)| id).chain(\n+    let worklist = access_levels.map.iter().filter_map(|(&id, level)| {\n+        if level >= &privacy::AccessLevel::Reachable {\n+            Some(id)\n+        } else {\n+            None\n+        }\n+    }).chain(\n         // Seed entry point\n         tcx.sess.entry_fn.borrow().map(|(id, _, _)| id)\n     ).collect::<Vec<_>>();"}, {"sha": "59da7580354669c369cfc7072f250dc61a18fa57", "filename": "src/test/run-pass/async-await.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Ftest%2Frun-pass%2Fasync-await.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Ftest%2Frun-pass%2Fasync-await.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fasync-await.rs?ref=b2d6ea98b0db53889c5427e5a23cddb3bcb63040", "patch": "@@ -170,6 +170,7 @@ fn main() {\n         async_closure,\n         async_fn,\n         async_fn_with_internal_borrow,\n+        Foo::async_method,\n         |x| {\n             async move {\n                 unsafe { await!(unsafe_async_fn(x)) }"}, {"sha": "ff9209251aa37d391d335f8db65dccf1dd82d282", "filename": "src/test/ui/impl-trait/existential-minimal.rs", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Ftest%2Fui%2Fimpl-trait%2Fexistential-minimal.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Ftest%2Fui%2Fimpl-trait%2Fexistential-minimal.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fexistential-minimal.rs?ref=b2d6ea98b0db53889c5427e5a23cddb3bcb63040", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// run-pass\n+// compile-pass\n \n fn main() {}\n ", "previous_filename": "src/test/run-pass/impl-trait/existential-minimal.rs"}, {"sha": "fbf2c3f8a4e49add60bf2cc72a41b7c823fcf961", "filename": "src/test/ui/impl-trait/issue-42479.rs", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-42479.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-42479.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-42479.rs?ref=b2d6ea98b0db53889c5427e5a23cddb3bcb63040", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// run-pass\n+// compile-pass\n \n use std::iter::once;\n ", "previous_filename": "src/test/run-pass/impl-trait/issue-42479.rs"}, {"sha": "1dfea0b95732958b773832ef899904069615b4d2", "filename": "src/test/ui/impl-trait/issue-49376.rs", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-49376.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-49376.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-49376.rs?ref=b2d6ea98b0db53889c5427e5a23cddb3bcb63040", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// run-pass\n+// compile-pass\n \n // Tests for nested self-reference which caused a stack overflow.\n ", "previous_filename": "src/test/run-pass/impl-trait/issue-49376.rs"}, {"sha": "7f7b349c3a0bf034e03648fc74120719c8c4c332", "filename": "src/test/ui/issue-49556.rs", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Ftest%2Fui%2Fissue-49556.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Ftest%2Fui%2Fissue-49556.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-49556.rs?ref=b2d6ea98b0db53889c5427e5a23cddb3bcb63040", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// run-pass\n+// compile-pass\n fn iter<'a>(data: &'a [usize]) -> impl Iterator<Item = usize> + 'a {\n     data.iter()\n         .map(", "previous_filename": "src/test/run-pass/issues/issue-49556.rs"}, {"sha": "944d57b5ba8f5866860e639ca29ae3ee5bde6f29", "filename": "src/test/ui/lint/lint-dead-code-1.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Ftest%2Fui%2Flint%2Flint-dead-code-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Ftest%2Fui%2Flint%2Flint-dead-code-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-dead-code-1.rs?ref=b2d6ea98b0db53889c5427e5a23cddb3bcb63040", "patch": "@@ -109,6 +109,10 @@ fn bar() { //~ ERROR: function is never used\n     foo();\n }\n \n+fn baz() -> impl Copy { //~ ERROR: function is never used\n+    \"I'm unused, too\"\n+}\n+\n // Code with #[allow(dead_code)] should be marked live (and thus anything it\n // calls is marked live)\n #[allow(dead_code)]"}, {"sha": "9d8e44c25d87e3a8f3a52e4a8927ea45954d09d0", "filename": "src/test/ui/lint/lint-dead-code-1.stderr", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Ftest%2Fui%2Flint%2Flint-dead-code-1.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Ftest%2Fui%2Flint%2Flint-dead-code-1.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Flint-dead-code-1.stderr?ref=b2d6ea98b0db53889c5427e5a23cddb3bcb63040", "patch": "@@ -58,5 +58,11 @@ error: function is never used: `bar`\n LL | fn bar() { //~ ERROR: function is never used\n    | ^^^^^^^^\n \n-error: aborting due to 9 previous errors\n+error: function is never used: `baz`\n+  --> $DIR/lint-dead-code-1.rs:112:1\n+   |\n+LL | fn baz() -> impl Copy { //~ ERROR: function is never used\n+   | ^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 10 previous errors\n "}, {"sha": "3f119affd8c9b458b810932937d62f2cda73f549", "filename": "src/test/ui/traits/conservative_impl_trait.rs", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Ftest%2Fui%2Ftraits%2Fconservative_impl_trait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2d6ea98b0db53889c5427e5a23cddb3bcb63040/src%2Ftest%2Fui%2Ftraits%2Fconservative_impl_trait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fconservative_impl_trait.rs?ref=b2d6ea98b0db53889c5427e5a23cddb3bcb63040", "patch": "@@ -8,7 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// run-pass\n+// compile-pass\n // #39665\n \n fn batches(n: &u32) -> impl Iterator<Item=&u32> {", "previous_filename": "src/test/run-pass/traits/conservative_impl_trait.rs"}]}