{"sha": "bf59152c01d9ffc4ceeb982e26b3df2354ebede6", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJmNTkxNTJjMDFkOWZmYzRjZWViOTgyZTI2YjNkZjIzNTRlYmVkZTY=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2020-06-18T22:20:49Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-06-18T22:20:49Z"}, "message": "Rollup merge of #72968 - integer32llc:docs-arrow-keys, r=GuillaumeGomez\n\nOnly highlight doc search results via mouseover if mouse has moved\n\n## What happens\n\n- Go to https://doc.rust-lang.org/stable/std/index.html\n- Put your mouse cursor somewhere in the middle where search results will appear and then don't move the mouse\n- Press 's' to focus the search box\n- Type a query that brings up enough search results to go under where your mouse cursor is\n- Press the down arrow\n- The search result that is one below where your mouse cursor is will be highlighted.\n\n## What I expected\n\nWhen not currently using the mouse, I expect doing a search and then pressing the down arrow to always highlight the first search result immediately below the search box.\n\n## The fix\n\nThis feels a bit hacky to me; I'm open to other solutions. This introduces a global JS var that keeps track of whether the person searching has moved their mouse after doing a search or not, and only uses the mouse position to highlight search results if the person HAS moved the mouse AFTER doing a search.", "tree": {"sha": "99687cfeeba022301054a9b71762dbaaf6d39e38", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/99687cfeeba022301054a9b71762dbaaf6d39e38"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bf59152c01d9ffc4ceeb982e26b3df2354ebede6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJe6+jBCRBK7hj4Ov3rIwAAdHIIABxggbV1llCY2egfYbZj8pwc\nnTBxcIFN6AEveP0HgwxkDfToXEOZFiK+f+8tmqI1jFXQhZWeLOnx8fwfeB8QSrDG\n0YzZZCDjl20BXOg0KKGJy9TecVENHT8Qzro+ivRpB3VUgXxswltbpDBvU6px1pbV\nKJ3Z/cBOSu5ku2TW+9a0M+51xM24jyDE5YIuFr0LerSPjL7BkJulVr7F1sccWj2R\nbASkMNM2Nf4FFFAlUzAskgsJuiSgFNugWLYFUIfKkosqlKJRse3QyMlwkJTs/Al5\n4e+eXgABKSNqAo9JuovNbesUQ4NgDifXnYiQDLEqkKOfGRtqkS1MyWThdMozI0A=\n=ffPT\n-----END PGP SIGNATURE-----\n", "payload": "tree 99687cfeeba022301054a9b71762dbaaf6d39e38\nparent e1549786ff6105af4f3e9be30496c812b7ca71b3\nparent 1bc4e45b3fe3a0817908bd7cc21ec23798d38d63\nauthor Manish Goregaokar <manishsmail@gmail.com> 1592518849 -0700\ncommitter GitHub <noreply@github.com> 1592518849 -0700\n\nRollup merge of #72968 - integer32llc:docs-arrow-keys, r=GuillaumeGomez\n\nOnly highlight doc search results via mouseover if mouse has moved\n\n## What happens\n\n- Go to https://doc.rust-lang.org/stable/std/index.html\n- Put your mouse cursor somewhere in the middle where search results will appear and then don't move the mouse\n- Press 's' to focus the search box\n- Type a query that brings up enough search results to go under where your mouse cursor is\n- Press the down arrow\n- The search result that is one below where your mouse cursor is will be highlighted.\n\n## What I expected\n\nWhen not currently using the mouse, I expect doing a search and then pressing the down arrow to always highlight the first search result immediately below the search box.\n\n## The fix\n\nThis feels a bit hacky to me; I'm open to other solutions. This introduces a global JS var that keeps track of whether the person searching has moved their mouse after doing a search or not, and only uses the mouse position to highlight search results if the person HAS moved the mouse AFTER doing a search.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bf59152c01d9ffc4ceeb982e26b3df2354ebede6", "html_url": "https://github.com/rust-lang/rust/commit/bf59152c01d9ffc4ceeb982e26b3df2354ebede6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bf59152c01d9ffc4ceeb982e26b3df2354ebede6/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e1549786ff6105af4f3e9be30496c812b7ca71b3", "url": "https://api.github.com/repos/rust-lang/rust/commits/e1549786ff6105af4f3e9be30496c812b7ca71b3", "html_url": "https://github.com/rust-lang/rust/commit/e1549786ff6105af4f3e9be30496c812b7ca71b3"}, {"sha": "1bc4e45b3fe3a0817908bd7cc21ec23798d38d63", "url": "https://api.github.com/repos/rust-lang/rust/commits/1bc4e45b3fe3a0817908bd7cc21ec23798d38d63", "html_url": "https://github.com/rust-lang/rust/commit/1bc4e45b3fe3a0817908bd7cc21ec23798d38d63"}], "stats": {"total": 37, "additions": 24, "deletions": 13}, "files": [{"sha": "8d53b0579537407c8abbf5c66c2566baacb58b71", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 24, "deletions": 13, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/bf59152c01d9ffc4ceeb982e26b3df2354ebede6/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/bf59152c01d9ffc4ceeb982e26b3df2354ebede6/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=bf59152c01d9ffc4ceeb982e26b3df2354ebede6", "patch": "@@ -100,6 +100,8 @@ function defocusSearchBar() {\n     // 2 for \"In Return Types\"\n     var currentTab = 0;\n \n+    var mouseMovedAfterSearch = true;\n+\n     var titleBeforeSearch = document.title;\n \n     function clearInputTimeout() {\n@@ -162,6 +164,7 @@ function defocusSearchBar() {\n         }\n         addClass(main, \"hidden\");\n         removeClass(search, \"hidden\");\n+        mouseMovedAfterSearch = false;\n     }\n \n     function hideSearchResults(search) {\n@@ -424,6 +427,12 @@ function defocusSearchBar() {\n     document.addEventListener(\"keypress\", handleShortcut);\n     document.addEventListener(\"keydown\", handleShortcut);\n \n+    function resetMouseMoved(ev) {\n+        mouseMovedAfterSearch = true;\n+    }\n+\n+    document.addEventListener(\"mousemove\", resetMouseMoved);\n+\n     var handleSourceHighlight = (function() {\n         var prev_line_id = 0;\n \n@@ -1353,20 +1362,22 @@ function defocusSearchBar() {\n                 }\n             };\n             var mouseover_func = function(e) {\n-                var el = e.target;\n-                // to retrieve the real \"owner\" of the event.\n-                while (el.tagName !== \"TR\") {\n-                    el = el.parentNode;\n-                }\n-                clearTimeout(hoverTimeout);\n-                hoverTimeout = setTimeout(function() {\n-                    onEachLazy(document.getElementsByClassName(\"search-results\"), function(e) {\n-                        onEachLazy(e.getElementsByClassName(\"result\"), function(i_e) {\n-                            removeClass(i_e, \"highlighted\");\n+                if (mouseMovedAfterSearch) {\n+                    var el = e.target;\n+                    // to retrieve the real \"owner\" of the event.\n+                    while (el.tagName !== \"TR\") {\n+                        el = el.parentNode;\n+                    }\n+                    clearTimeout(hoverTimeout);\n+                    hoverTimeout = setTimeout(function() {\n+                        onEachLazy(document.getElementsByClassName(\"search-results\"), function(e) {\n+                            onEachLazy(e.getElementsByClassName(\"result\"), function(i_e) {\n+                                removeClass(i_e, \"highlighted\");\n+                            });\n                         });\n-                    });\n-                    addClass(el, \"highlighted\");\n-                }, 20);\n+                        addClass(el, \"highlighted\");\n+                    }, 20);\n+                }\n             };\n             onEachLazy(document.getElementsByClassName(\"search-results\"), function(e) {\n                 onEachLazy(e.getElementsByClassName(\"result\"), function(i_e) {"}]}