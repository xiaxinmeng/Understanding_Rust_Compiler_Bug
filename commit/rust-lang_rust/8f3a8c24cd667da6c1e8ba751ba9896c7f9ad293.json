{"sha": "8f3a8c24cd667da6c1e8ba751ba9896c7f9ad293", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhmM2E4YzI0Y2Q2NjdkYTZjMWU4YmE3NTFiYTk4OTZjN2Y5YWQyOTM=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2016-04-22T19:18:02Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2016-05-18T14:11:35Z"}, "message": "always encode variant fields\n\nwe need them to be able to retrace.", "tree": {"sha": "8c477fb8d84d654f0d9b8f28c91e9d31e69106ab", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8c477fb8d84d654f0d9b8f28c91e9d31e69106ab"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8f3a8c24cd667da6c1e8ba751ba9896c7f9ad293", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8f3a8c24cd667da6c1e8ba751ba9896c7f9ad293", "html_url": "https://github.com/rust-lang/rust/commit/8f3a8c24cd667da6c1e8ba751ba9896c7f9ad293", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8f3a8c24cd667da6c1e8ba751ba9896c7f9ad293/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c7840cfe140a1f523a4fa399344da431022e3cb6", "url": "https://api.github.com/repos/rust-lang/rust/commits/c7840cfe140a1f523a4fa399344da431022e3cb6", "html_url": "https://github.com/rust-lang/rust/commit/c7840cfe140a1f523a4fa399344da431022e3cb6"}], "stats": {"total": 14, "additions": 7, "deletions": 7}, "files": [{"sha": "d7499342bf5ea7ef889a8abeb5aec8b7c2f27cd1", "filename": "src/librustc_metadata/decoder.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/8f3a8c24cd667da6c1e8ba751ba9896c7f9ad293/src%2Flibrustc_metadata%2Fdecoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f3a8c24cd667da6c1e8ba751ba9896c7f9ad293/src%2Flibrustc_metadata%2Fdecoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fdecoder.rs?ref=8f3a8c24cd667da6c1e8ba751ba9896c7f9ad293", "patch": "@@ -71,7 +71,10 @@ impl crate_metadata {\n \n     fn lookup_item(&self, item_id: DefIndex) -> rbml::Doc {\n         match self.get_item(item_id) {\n-            None => bug!(\"lookup_item: id not found: {:?}\", item_id),\n+            None => bug!(\"lookup_item: id not found: {:?} in crate {:?} with number {}\",\n+                         item_id,\n+                         self.name,\n+                         self.cnum),\n             Some(d) => d\n         }\n     }"}, {"sha": "1b313aac7cac7cfc7b9b1053e6b96e0d3c5c16f3", "filename": "src/librustc_metadata/encoder.rs", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/8f3a8c24cd667da6c1e8ba751ba9896c7f9ad293/src%2Flibrustc_metadata%2Fencoder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f3a8c24cd667da6c1e8ba751ba9896c7f9ad293/src%2Flibrustc_metadata%2Fencoder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_metadata%2Fencoder.rs?ref=8f3a8c24cd667da6c1e8ba751ba9896c7f9ad293", "patch": "@@ -267,12 +267,8 @@ fn encode_enum_variant_info<'a, 'tcx>(ecx: &EncodeContext<'a, 'tcx>,\n         let vid = variant.did;\n         let variant_node_id = ecx.local_id(vid);\n \n-        if let ty::VariantKind::Struct = variant.kind() {\n-            // tuple-like enum variant fields aren't really items so\n-            // don't try to encode them.\n-            for field in &variant.fields {\n-                encode_field(ecx, rbml_w, field, index);\n-            }\n+        for field in &variant.fields {\n+            encode_field(ecx, rbml_w, field, index);\n         }\n \n         let _task = index.record(vid, rbml_w);\n@@ -306,6 +302,7 @@ fn encode_enum_variant_info<'a, 'tcx>(ecx: &EncodeContext<'a, 'tcx>,\n         encode_bounds_and_type_for_item(rbml_w, ecx, index, variant_node_id);\n \n         rbml_w.end_tag();\n+\n         disr_val = disr_val.wrap_incr();\n     }\n }"}]}