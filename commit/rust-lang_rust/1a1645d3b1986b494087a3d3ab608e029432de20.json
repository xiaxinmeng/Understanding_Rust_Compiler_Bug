{"sha": "1a1645d3b1986b494087a3d3ab608e029432de20", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFhMTY0NWQzYjE5ODZiNDk0MDg3YTNkM2FiNjA4ZTAyOTQzMmRlMjA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-05-14T16:21:25Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-05-14T16:21:25Z"}, "message": "auto merge of #14009 : jcmoyer/rust/bitflags-complement, r=alexcrichton\n\nI feel that this is a very vital, missing piece of functionality. This adds on to #13072.\r\n\r\nOnly bits used in the definition of the bitflag are considered for the universe set. This is a bit safer than simply inverting all of the bits in the wrapped value.\r\n\r\n```rust\r\nbitflags!(flags Flags: u32 {\r\n    FlagA       = 0x00000001,\r\n    FlagB       = 0x00000010,\r\n    FlagC       = 0x00000100,\r\n    FlagABC     = FlagA.bits\r\n                | FlagB.bits\r\n                | FlagC.bits\r\n})\r\n\r\n...\r\n\r\n// `Not` implements set complement\r\nassert!(!(FlagB | FlagC) == FlagA);\r\n// `all` and `is_all` are the inverses of `empty` and `is_empty`\r\nassert!(Flags::all() - FlagA == !FlagA);\r\nassert!(FlagABC.is_all());\r\n```", "tree": {"sha": "e1d29f652e68dcb64bfa794f4aa1dc6f9d3b06b8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e1d29f652e68dcb64bfa794f4aa1dc6f9d3b06b8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1a1645d3b1986b494087a3d3ab608e029432de20", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1a1645d3b1986b494087a3d3ab608e029432de20", "html_url": "https://github.com/rust-lang/rust/commit/1a1645d3b1986b494087a3d3ab608e029432de20", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1a1645d3b1986b494087a3d3ab608e029432de20/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "96bcadc1813b069869219163f90f6b0299d63132", "url": "https://api.github.com/repos/rust-lang/rust/commits/96bcadc1813b069869219163f90f6b0299d63132", "html_url": "https://github.com/rust-lang/rust/commit/96bcadc1813b069869219163f90f6b0299d63132"}, {"sha": "1595885501897a2827d11afa193adda8771a967d", "url": "https://api.github.com/repos/rust-lang/rust/commits/1595885501897a2827d11afa193adda8771a967d", "html_url": "https://github.com/rust-lang/rust/commit/1595885501897a2827d11afa193adda8771a967d"}], "stats": {"total": 34, "additions": 32, "deletions": 2}, "files": [{"sha": "32f9bc1173b2dec7e148fb22a049762a3e694d87", "filename": "src/libstd/bitflags.rs", "status": "modified", "additions": 31, "deletions": 1, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/1a1645d3b1986b494087a3d3ab608e029432de20/src%2Flibstd%2Fbitflags.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a1645d3b1986b494087a3d3ab608e029432de20/src%2Flibstd%2Fbitflags.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fbitflags.rs?ref=1a1645d3b1986b494087a3d3ab608e029432de20", "patch": "@@ -34,6 +34,7 @@\n //!     assert!((e1 | e2) == FlagABC);   // union\n //!     assert!((e1 & e2) == FlagC);     // intersection\n //!     assert!((e1 - e2) == FlagA);     // set difference\n+//!     assert!(!e2 == FlagA);           // set complement\n //! }\n //! ~~~\n //!\n@@ -88,14 +89,17 @@\n //! - `BitOr`: union\n //! - `BitAnd`: intersection\n //! - `Sub`: set difference\n+//! - `Not`: set complement\n //!\n //! # Methods\n //!\n //! The following methods are defined for the generated `struct`:\n //!\n //! - `empty`: an empty set of flags\n+//! - `all`: the set of all flags\n //! - `bits`: the raw value of the flags currently stored\n //! - `is_empty`: `true` if no flags are currently stored\n+//! - `is_all`: `true` if all flags are currently set\n //! - `intersects`: `true` if there are flags common to both `self` and `other`\n //! - `contains`: `true` all of the flags in `other` are contained within `self`\n //! - `insert`: inserts the specified flags in-place\n@@ -122,6 +126,11 @@ macro_rules! bitflags(\n                 $BitFlags { bits: 0 }\n             }\n \n+            /// Returns the set containing all flags.\n+            pub fn all() -> $BitFlags {\n+                $BitFlags { bits: $($value)|+ }\n+            }\n+\n             /// Returns the raw value of the flags currently stored.\n             pub fn bits(&self) -> $T {\n                 self.bits\n@@ -138,6 +147,11 @@ macro_rules! bitflags(\n                 *self == $BitFlags::empty()\n             }\n \n+            /// Returns `true` if all flags are currently set.\n+            pub fn is_all(&self) -> bool {\n+                *self == $BitFlags::all()\n+            }\n+\n             /// Returns `true` if there are flags common to both `self` and `other`.\n             pub fn intersects(&self, other: $BitFlags) -> bool {\n                 !(self & other).is_empty()\n@@ -182,12 +196,20 @@ macro_rules! bitflags(\n                 $BitFlags { bits: self.bits & !other.bits }\n             }\n         }\n+\n+        impl Not<$BitFlags> for $BitFlags {\n+            /// Returns the complement of this set of flags.\n+            #[inline]\n+            fn not(&self) -> $BitFlags {\n+                $BitFlags { bits: !self.bits } & $BitFlags::all()\n+            }\n+        }\n     )\n )\n \n #[cfg(test)]\n mod tests {\n-    use ops::{BitOr, BitAnd, Sub};\n+    use ops::{BitOr, BitAnd, Sub, Not};\n \n     bitflags!(\n         flags Flags: u32 {\n@@ -221,6 +243,13 @@ mod tests {\n         assert!(!FlagABC.is_empty());\n     }\n \n+    #[test]\n+    fn test_is_all() {\n+        assert!(Flags::all().is_all());\n+        assert!(!FlagA.is_all());\n+        assert!(FlagABC.is_all());\n+    }\n+\n     #[test]\n     fn test_two_empties_do_not_intersect() {\n         let e1 = Flags::empty();\n@@ -281,5 +310,6 @@ mod tests {\n         assert!((e1 | e2) == FlagABC);   // union\n         assert!((e1 & e2) == FlagC);     // intersection\n         assert!((e1 - e2) == FlagA);     // set difference\n+        assert!(!e2 == FlagA);           // set complement\n     }\n }"}, {"sha": "2ee3ee597313bb063806d9b37d8c68704b6add26", "filename": "src/libstd/io/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1a1645d3b1986b494087a3d3ab608e029432de20/src%2Flibstd%2Fio%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1a1645d3b1986b494087a3d3ab608e029432de20/src%2Flibstd%2Fio%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fio%2Fmod.rs?ref=1a1645d3b1986b494087a3d3ab608e029432de20", "patch": "@@ -220,7 +220,7 @@ use int;\n use iter::Iterator;\n use libc;\n use mem::transmute;\n-use ops::{BitOr, BitAnd, Sub};\n+use ops::{BitOr, BitAnd, Sub, Not};\n use option::{Option, Some, None};\n use os;\n use owned::Box;"}]}