{"sha": "f332a9ce5676859f0f07c4d6bf2d2c415be67066", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYzMzJhOWNlNTY3Njg1OWYwZjA3YzRkNmJmMmQyYzQxNWJlNjcwNjY=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-03-19T06:26:57Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-03-19T21:08:57Z"}, "message": "Single diagnostic for all non-mentioned fields in a pattern", "tree": {"sha": "c2108c33b284c59186f61f040c905812cbc3de4f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c2108c33b284c59186f61f040c905812cbc3de4f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f332a9ce5676859f0f07c4d6bf2d2c415be67066", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f332a9ce5676859f0f07c4d6bf2d2c415be67066", "html_url": "https://github.com/rust-lang/rust/commit/f332a9ce5676859f0f07c4d6bf2d2c415be67066", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f332a9ce5676859f0f07c4d6bf2d2c415be67066/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "685c3c1b4a7c1949048177409ca43fc05daefd3f", "url": "https://api.github.com/repos/rust-lang/rust/commits/685c3c1b4a7c1949048177409ca43fc05daefd3f", "html_url": "https://github.com/rust-lang/rust/commit/685c3c1b4a7c1949048177409ca43fc05daefd3f"}], "stats": {"total": 46, "additions": 41, "deletions": 5}, "files": [{"sha": "cc72a565ba28ed1b06ab8192c61eb3bad2ed8361", "filename": "src/librustc_typeck/check/_match.rs", "status": "modified", "additions": 17, "deletions": 5, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/f332a9ce5676859f0f07c4d6bf2d2c415be67066/src%2Flibrustc_typeck%2Fcheck%2F_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f332a9ce5676859f0f07c4d6bf2d2c415be67066/src%2Flibrustc_typeck%2Fcheck%2F_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2F_match.rs?ref=f332a9ce5676859f0f07c4d6bf2d2c415be67066", "patch": "@@ -993,13 +993,25 @@ https://doc.rust-lang.org/reference/types.html#trait-objects\");\n                 tcx.sess.span_err(span, \"`..` cannot be used in union patterns\");\n             }\n         } else if !etc {\n-            for field in variant.fields\n+            let unmentioned_fields = variant.fields\n                 .iter()\n-                .filter(|field| !used_fields.contains_key(&field.name)) {\n+                .map(|field| field.name)\n+                .filter(|field| !used_fields.contains_key(&field))\n+                .collect::<Vec<_>>();\n+            if unmentioned_fields.len() > 0 {\n+                let field_names = if unmentioned_fields.len() == 1 {\n+                    format!(\"field `{}`\", unmentioned_fields[0])\n+                } else {\n+                    format!(\"fields {}\",\n+                            unmentioned_fields.iter()\n+                                .map(|name| format!(\"`{}`\", name))\n+                                .collect::<Vec<String>>()\n+                                .join(\", \"))\n+                };\n                 let mut diag = struct_span_err!(tcx.sess, span, E0027,\n-                                                \"pattern does not mention field `{}`\",\n-                                                field.name);\n-                diag.span_label(span, format!(\"missing field `{}`\", field.name));\n+                                                \"pattern does not mention {}\",\n+                                                field_names);\n+                diag.span_label(span, format!(\"missing {}\", field_names));\n                 if variant.ctor_kind == CtorKind::Fn {\n                     diag.note(\"trying to match a tuple variant with a struct variant pattern\");\n                 }"}, {"sha": "28ed151b986064f6c6faaed69d07ddcd4109a65c", "filename": "src/test/ui/missing-fields-in-struct-pattern.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f332a9ce5676859f0f07c4d6bf2d2c415be67066/src%2Ftest%2Fui%2Fmissing-fields-in-struct-pattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f332a9ce5676859f0f07c4d6bf2d2c415be67066/src%2Ftest%2Fui%2Fmissing-fields-in-struct-pattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmissing-fields-in-struct-pattern.rs?ref=f332a9ce5676859f0f07c4d6bf2d2c415be67066", "patch": "@@ -12,6 +12,8 @@ struct S(usize, usize, usize, usize);\n \n fn main() {\n     if let S { a, b, c, d } = S(1, 2, 3, 4) {\n+    //~^ ERROR struct `S` does not have fields named `a`, `b`, `c`, `d` [E0026]\n+    //~^ ERROR pattern does not mention fields `0`, `1`, `2`, `3` [E0027]\n         println!(\"hi\");\n     }\n }"}, {"sha": "88fba19d14e35bd25ee4bd4612d3b218921195fe", "filename": "src/test/ui/missing-fields-in-struct-pattern.stderr", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/f332a9ce5676859f0f07c4d6bf2d2c415be67066/src%2Ftest%2Fui%2Fmissing-fields-in-struct-pattern.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f332a9ce5676859f0f07c4d6bf2d2c415be67066/src%2Ftest%2Fui%2Fmissing-fields-in-struct-pattern.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmissing-fields-in-struct-pattern.stderr?ref=f332a9ce5676859f0f07c4d6bf2d2c415be67066", "patch": "@@ -0,0 +1,22 @@\n+error[E0026]: struct `S` does not have fields named `a`, `b`, `c`, `d`\n+  --> $DIR/missing-fields-in-struct-pattern.rs:14:16\n+   |\n+LL |     if let S { a, b, c, d } = S(1, 2, 3, 4) {\n+   |                ^  ^  ^  ^ struct `S` does not have field `d`\n+   |                |  |  |\n+   |                |  |  struct `S` does not have field `c`\n+   |                |  struct `S` does not have field `b`\n+   |                struct `S` does not have field `a`\n+\n+error[E0027]: pattern does not mention fields `0`, `1`, `2`, `3`\n+  --> $DIR/missing-fields-in-struct-pattern.rs:14:12\n+   |\n+LL |     if let S { a, b, c, d } = S(1, 2, 3, 4) {\n+   |            ^^^^^^^^^^^^^^^^ missing fields `0`, `1`, `2`, `3`\n+   |\n+   = note: trying to match a tuple variant with a struct variant pattern\n+\n+error: aborting due to 2 previous errors\n+\n+Some errors occurred: E0026, E0027.\n+For more information about an error, try `rustc --explain E0026`."}]}