{"sha": "0352866da7098bdcc868fbc37246b48778ecf74a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAzNTI4NjZkYTcwOThiZGNjODY4ZmJjMzcyNDZiNDg3NzhlY2Y3NGE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-05-20T15:44:01Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-05-20T15:44:01Z"}, "message": "Auto merge of #33378 - oli-obk:fix/registry_args, r=Manishearth\n\nfix Registry::args for plugins loaded with --extra-plugins\n\nr? @Manishearth", "tree": {"sha": "88b754ee08a8593f2977cf257d3e2879264be1d2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/88b754ee08a8593f2977cf257d3e2879264be1d2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0352866da7098bdcc868fbc37246b48778ecf74a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0352866da7098bdcc868fbc37246b48778ecf74a", "html_url": "https://github.com/rust-lang/rust/commit/0352866da7098bdcc868fbc37246b48778ecf74a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0352866da7098bdcc868fbc37246b48778ecf74a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "55cabda8d5bc023991aff7f53230a11a539dad80", "url": "https://api.github.com/repos/rust-lang/rust/commits/55cabda8d5bc023991aff7f53230a11a539dad80", "html_url": "https://github.com/rust-lang/rust/commit/55cabda8d5bc023991aff7f53230a11a539dad80"}, {"sha": "46de0fadb54dbacd8598237d60ed2a91718806a9", "url": "https://api.github.com/repos/rust-lang/rust/commits/46de0fadb54dbacd8598237d60ed2a91718806a9", "html_url": "https://github.com/rust-lang/rust/commit/46de0fadb54dbacd8598237d60ed2a91718806a9"}], "stats": {"total": 9, "additions": 6, "deletions": 3}, "files": [{"sha": "dc5a38bb7647ee6d2974c4e9f7a611a2b093be0b", "filename": "src/librustc_plugin/registry.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/0352866da7098bdcc868fbc37246b48778ecf74a/src%2Flibrustc_plugin%2Fregistry.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0352866da7098bdcc868fbc37246b48778ecf74a/src%2Flibrustc_plugin%2Fregistry.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_plugin%2Fregistry.rs?ref=0352866da7098bdcc868fbc37246b48778ecf74a", "patch": "@@ -92,8 +92,11 @@ impl<'a> Registry<'a> {\n     /// ```no_run\n     /// #![plugin(my_plugin_name(... args ...))]\n     /// ```\n-    pub fn args<'b>(&'b self) -> &'b Vec<P<ast::MetaItem>> {\n-        self.args_hidden.as_ref().expect(\"args not set\")\n+    ///\n+    /// Returns empty slice in case the plugin was loaded\n+    /// with `--extra-plugins`\n+    pub fn args<'b>(&'b self) -> &'b [P<ast::MetaItem>] {\n+        self.args_hidden.as_ref().map(|v| &v[..]).unwrap_or(&[])\n     }\n \n     /// Register a syntax extension of any kind."}, {"sha": "99321ad42418dd8f0b2dddb61b84e1289e25e514", "filename": "src/test/run-pass-fulldeps/auxiliary/plugin_args.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0352866da7098bdcc868fbc37246b48778ecf74a/src%2Ftest%2Frun-pass-fulldeps%2Fauxiliary%2Fplugin_args.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0352866da7098bdcc868fbc37246b48778ecf74a/src%2Ftest%2Frun-pass-fulldeps%2Fauxiliary%2Fplugin_args.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass-fulldeps%2Fauxiliary%2Fplugin_args.rs?ref=0352866da7098bdcc868fbc37246b48778ecf74a", "patch": "@@ -45,7 +45,7 @@ impl TTMacroExpander for Expander {\n \n #[plugin_registrar]\n pub fn plugin_registrar(reg: &mut Registry) {\n-    let args = reg.args().clone();\n+    let args = reg.args().to_owned();\n     reg.register_syntax_extension(token::intern(\"plugin_args\"),\n         // FIXME (#22405): Replace `Box::new` with `box` here when/if possible.\n         NormalTT(Box::new(Expander { args: args, }), None, false));"}]}