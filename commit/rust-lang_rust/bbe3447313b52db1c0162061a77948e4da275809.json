{"sha": "bbe3447313b52db1c0162061a77948e4da275809", "node_id": "C_kwDOAAsO6NoAKGJiZTM0NDczMTNiNTJkYjFjMDE2MjA2MWE3Nzk0OGU0ZGEyNzU4MDk", "commit": {"author": {"name": "flip1995", "email": "philipp.krones@embecosm.com", "date": "2022-02-25T11:30:16Z"}, "committer": {"name": "flip1995", "email": "philipp.krones@embecosm.com", "date": "2022-02-25T11:30:16Z"}, "message": "Fix debug_assert in unused lint pass\n\nThis fixes a debug assertion in the unused lint pass. As a side effect,\nthis also improves the span generated for tuples in the\n`unused_must_use` lint.", "tree": {"sha": "203732ccd2b4721baa44fcd0411c31235bd7d87e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/203732ccd2b4721baa44fcd0411c31235bd7d87e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bbe3447313b52db1c0162061a77948e4da275809", "comment_count": 0, "verification": {"verified": false, "reason": "bad_email", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEij1UXJ/PQTcb99vTHKDfKvWdaKUFAmIYvg4ACgkQHKDfKvWd\naKXMxw/9E0yUUF44sZosEXfLX3Y1kaw2FfPX2595GcdtLCBJutYSd+5h8+zqcBiF\nBdaDj/Xj+zVQhliwsk+hrWHdZCsneCzeiag1sUAgdpoHN0Pij8gYR76KpU8k3xxq\nqsw/7G4IQEO/fkfou7/Bh8BQ3u1MJ4TFPKcepVwUWfpmKLKZ5OtGr/1SlAkeFZSG\nanDCVDFpW/cInsiV1CahtkQpvtx5l379xWGYmQoYfLYWHo1gnvVHHidkDMWEXmQy\nPgysqpmFD8n/oTuAQ/8vfKpp4ne7vTIrEnhoeLcPBHeaK+WfFJVGxDUwlKMkCXki\nUkhI816lYl9IgOcL61IYjfYflW/2GTWsg0yR5rOD1xCxDt4pJrfLpUdAjQOw4Jl7\nx5VvJyhDIakW+3q3ZQ88mFxeGTFNECF8jRd9LHdm94kaV4Fx6G53rL40a3/rnI2z\n0hRccBjCG6wltEBWpGHc5SN4Q1fBm+279RyfQAProJ7LNybDbEnlahq1ksI6ASom\nB1kX5Xl1n1Zw/l5KLFCEJ3e3lRjPmrJRVag0Mq1GZbSWJvflrr1P2ASC0//mSAy7\nY/vAO3tdHeCa5llWx9fzeE3MCe1VtDIfMzcEVPfpxsLXoHFYQOJRQLtMtW8QgfCw\n2Usz4oUVknYTdQ8F4ApvFRUlvj4BPzwvbYpdySrNZ8lichW7M0Y=\n=5M7S\n-----END PGP SIGNATURE-----", "payload": "tree 203732ccd2b4721baa44fcd0411c31235bd7d87e\nparent ece55d416e65256e4da274988651c20e5d5cb4ea\nauthor flip1995 <philipp.krones@embecosm.com> 1645788616 +0000\ncommitter flip1995 <philipp.krones@embecosm.com> 1645788616 +0000\n\nFix debug_assert in unused lint pass\n\nThis fixes a debug assertion in the unused lint pass. As a side effect,\nthis also improves the span generated for tuples in the\n`unused_must_use` lint.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bbe3447313b52db1c0162061a77948e4da275809", "html_url": "https://github.com/rust-lang/rust/commit/bbe3447313b52db1c0162061a77948e4da275809", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bbe3447313b52db1c0162061a77948e4da275809/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ece55d416e65256e4da274988651c20e5d5cb4ea", "url": "https://api.github.com/repos/rust-lang/rust/commits/ece55d416e65256e4da274988651c20e5d5cb4ea", "html_url": "https://github.com/rust-lang/rust/commit/ece55d416e65256e4da274988651c20e5d5cb4ea"}], "stats": {"total": 24, "additions": 12, "deletions": 12}, "files": [{"sha": "16d222f68a3211e3a56a1435bbb5aab94fdbd68f", "filename": "compiler/rustc_lint/src/unused.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/bbe3447313b52db1c0162061a77948e4da275809/compiler%2Frustc_lint%2Fsrc%2Funused.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bbe3447313b52db1c0162061a77948e4da275809/compiler%2Frustc_lint%2Fsrc%2Funused.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Funused.rs?ref=bbe3447313b52db1c0162061a77948e4da275809", "patch": "@@ -240,17 +240,17 @@ impl<'tcx> LateLintPass<'tcx> for UnusedResults {\n                 }\n                 ty::Tuple(ref tys) => {\n                     let mut has_emitted = false;\n-                    let spans = if let hir::ExprKind::Tup(comps) = &expr.kind {\n+                    let comps = if let hir::ExprKind::Tup(comps) = expr.kind {\n                         debug_assert_eq!(comps.len(), tys.len());\n-                        comps.iter().map(|e| e.span).collect()\n+                        comps\n                     } else {\n-                        vec![]\n+                        &[]\n                     };\n                     for (i, ty) in tys.iter().enumerate() {\n                         let descr_post = &format!(\" in tuple element {}\", i);\n-                        let span = *spans.get(i).unwrap_or(&span);\n-                        if check_must_use_ty(cx, ty, expr, span, descr_pre, descr_post, plural_len)\n-                        {\n+                        let e = comps.get(i).unwrap_or(expr);\n+                        let span = e.span;\n+                        if check_must_use_ty(cx, ty, e, span, descr_pre, descr_post, plural_len) {\n                             has_emitted = true;\n                         }\n                     }"}, {"sha": "45a5317fccc6e7c508a901736ebc049da5e531fb", "filename": "src/test/ui/lint/unused/must_use-array.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bbe3447313b52db1c0162061a77948e4da275809/src%2Ftest%2Fui%2Flint%2Funused%2Fmust_use-array.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bbe3447313b52db1c0162061a77948e4da275809/src%2Ftest%2Fui%2Flint%2Funused%2Fmust_use-array.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused%2Fmust_use-array.stderr?ref=bbe3447313b52db1c0162061a77948e4da275809", "patch": "@@ -32,7 +32,7 @@ error: unused array of boxed `T` trait objects in tuple element 1 that must be u\n   --> $DIR/must_use-array.rs:43:5\n    |\n LL |     impl_array();\n-   |     ^^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^\n \n error: unused array of arrays of arrays of `S` that must be used\n   --> $DIR/must_use-array.rs:45:5"}, {"sha": "a42eb8841789dfb0f0071a4e1d2d65b833b877a1", "filename": "src/test/ui/lint/unused/must_use-trait.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/bbe3447313b52db1c0162061a77948e4da275809/src%2Ftest%2Fui%2Flint%2Funused%2Fmust_use-trait.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bbe3447313b52db1c0162061a77948e4da275809/src%2Ftest%2Fui%2Flint%2Funused%2Fmust_use-trait.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused%2Fmust_use-trait.stderr?ref=bbe3447313b52db1c0162061a77948e4da275809", "patch": "@@ -26,13 +26,13 @@ error: unused boxed `Critical` trait object in tuple element 1 that must be used\n   --> $DIR/must_use-trait.rs:37:5\n    |\n LL |     get_critical_tuple();\n-   |     ^^^^^^^^^^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^^^^^^^^^\n \n error: unused implementer of `Critical` in tuple element 2 that must be used\n   --> $DIR/must_use-trait.rs:37:5\n    |\n LL |     get_critical_tuple();\n-   |     ^^^^^^^^^^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^^^^^^^^^\n \n error: aborting due to 5 previous errors\n "}, {"sha": "e5709a5f0af5a1e04e0acf3bdf37f88fcb3ac36c", "filename": "src/test/ui/lint/unused/must_use-tuple.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/bbe3447313b52db1c0162061a77948e4da275809/src%2Ftest%2Fui%2Flint%2Funused%2Fmust_use-tuple.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bbe3447313b52db1c0162061a77948e4da275809/src%2Ftest%2Fui%2Flint%2Funused%2Fmust_use-tuple.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flint%2Funused%2Fmust_use-tuple.stderr?ref=bbe3447313b52db1c0162061a77948e4da275809", "patch": "@@ -31,15 +31,15 @@ error: unused `Result` in tuple element 0 that must be used\n   --> $DIR/must_use-tuple.rs:14:5\n    |\n LL |     foo();\n-   |     ^^^^^^\n+   |     ^^^^^\n    |\n    = note: this `Result` may be an `Err` variant, which should be handled\n \n error: unused `Result` in tuple element 0 that must be used\n-  --> $DIR/must_use-tuple.rs:16:6\n+  --> $DIR/must_use-tuple.rs:16:7\n    |\n LL |     ((Err::<(), ()>(()), ()), ());\n-   |      ^^^^^^^^^^^^^^^^^^^^^^^\n+   |       ^^^^^^^^^^^^^^^^^\n    |\n    = note: this `Result` may be an `Err` variant, which should be handled\n "}]}