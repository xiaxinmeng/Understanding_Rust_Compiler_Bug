{"sha": "9991be3ee472905975b28f1939e535fbe83100d4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk5OTFiZTNlZTQ3MjkwNTk3NWIyOGYxOTM5ZTUzNWZiZTgzMTAwZDQ=", "commit": {"author": {"name": "Steve Klabnik", "email": "steve@steveklabnik.com", "date": "2016-05-07T19:35:16Z"}, "committer": {"name": "Steve Klabnik", "email": "steve@steveklabnik.com", "date": "2016-05-07T19:35:16Z"}, "message": "Rollup merge of #33313 - birkenfeld:depgraph-panic, r=nikomatsakis\n\ndep_graph: avoid panicking in thread when channel closed\n\nOn my system, when the processor is already loaded, and I try to\nrun the test suite, e.g. compile-fail/dep-graph-assoc-type-trans.rs\nfails because of undecodable JSON.\n\nRunning the compiler manually, I can see that the dep graph thread\npanics (and puts non-JSON on stderr) while `send`ing on `swap_out`,\npresumably because the other end has already quit.  I think that in\nthis case, we can just gracefully exit the thread.", "tree": {"sha": "72f05a3b65fff4d242eb44d3e11638f25d74cbe5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/72f05a3b65fff4d242eb44d3e11638f25d74cbe5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9991be3ee472905975b28f1939e535fbe83100d4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9991be3ee472905975b28f1939e535fbe83100d4", "html_url": "https://github.com/rust-lang/rust/commit/9991be3ee472905975b28f1939e535fbe83100d4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9991be3ee472905975b28f1939e535fbe83100d4/comments", "author": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "committer": {"login": "steveklabnik", "id": 27786, "node_id": "MDQ6VXNlcjI3Nzg2", "avatar_url": "https://avatars.githubusercontent.com/u/27786?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steveklabnik", "html_url": "https://github.com/steveklabnik", "followers_url": "https://api.github.com/users/steveklabnik/followers", "following_url": "https://api.github.com/users/steveklabnik/following{/other_user}", "gists_url": "https://api.github.com/users/steveklabnik/gists{/gist_id}", "starred_url": "https://api.github.com/users/steveklabnik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steveklabnik/subscriptions", "organizations_url": "https://api.github.com/users/steveklabnik/orgs", "repos_url": "https://api.github.com/users/steveklabnik/repos", "events_url": "https://api.github.com/users/steveklabnik/events{/privacy}", "received_events_url": "https://api.github.com/users/steveklabnik/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "93285f8adb23620575a495c34ba4a467b3e7bd55", "url": "https://api.github.com/repos/rust-lang/rust/commits/93285f8adb23620575a495c34ba4a467b3e7bd55", "html_url": "https://github.com/rust-lang/rust/commit/93285f8adb23620575a495c34ba4a467b3e7bd55"}, {"sha": "e3f13129b42354ca9cc408df084796f0404c30a9", "url": "https://api.github.com/repos/rust-lang/rust/commits/e3f13129b42354ca9cc408df084796f0404c30a9", "html_url": "https://github.com/rust-lang/rust/commit/e3f13129b42354ca9cc408df084796f0404c30a9"}], "stats": {"total": 5, "additions": 4, "deletions": 1}, "files": [{"sha": "b15e0e33b84026cdc384685b8d1e81cf4528290e", "filename": "src/librustc/dep_graph/thread.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/9991be3ee472905975b28f1939e535fbe83100d4/src%2Flibrustc%2Fdep_graph%2Fthread.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9991be3ee472905975b28f1939e535fbe83100d4/src%2Flibrustc%2Fdep_graph%2Fthread.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fdep_graph%2Fthread.rs?ref=9991be3ee472905975b28f1939e535fbe83100d4", "patch": "@@ -176,6 +176,9 @@ pub fn main(swap_in: Receiver<Vec<DepMessage>>,\n                 DepMessage::Query => query_out.send(edges.query()).unwrap(),\n             }\n         }\n-        swap_out.send(messages).unwrap();\n+        if let Err(_) = swap_out.send(messages) {\n+            // the receiver must have been dropped already\n+            break;\n+        }\n     }\n }"}]}