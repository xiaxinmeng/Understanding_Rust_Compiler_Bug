{"sha": "9a6ca413714271adac017cbdd764a7de8b244001", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlhNmNhNDEzNzE0MjcxYWRhYzAxN2NiZGQ3NjRhN2RlOGIyNDQwMDE=", "commit": {"author": {"name": "ljedrz", "email": "ljedrz@gmail.com", "date": "2019-07-10T10:22:07Z"}, "committer": {"name": "ljedrz", "email": "ljedrz@gmail.com", "date": "2019-08-25T09:57:36Z"}, "message": "HirIdify hir::Crate.modules", "tree": {"sha": "8c308c2f55c86e52eed13e226033e465364cfc38", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8c308c2f55c86e52eed13e226033e465364cfc38"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9a6ca413714271adac017cbdd764a7de8b244001", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9a6ca413714271adac017cbdd764a7de8b244001", "html_url": "https://github.com/rust-lang/rust/commit/9a6ca413714271adac017cbdd764a7de8b244001", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9a6ca413714271adac017cbdd764a7de8b244001/comments", "author": {"login": "ljedrz", "id": 3750347, "node_id": "MDQ6VXNlcjM3NTAzNDc=", "avatar_url": "https://avatars.githubusercontent.com/u/3750347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ljedrz", "html_url": "https://github.com/ljedrz", "followers_url": "https://api.github.com/users/ljedrz/followers", "following_url": "https://api.github.com/users/ljedrz/following{/other_user}", "gists_url": "https://api.github.com/users/ljedrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/ljedrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ljedrz/subscriptions", "organizations_url": "https://api.github.com/users/ljedrz/orgs", "repos_url": "https://api.github.com/users/ljedrz/repos", "events_url": "https://api.github.com/users/ljedrz/events{/privacy}", "received_events_url": "https://api.github.com/users/ljedrz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ljedrz", "id": 3750347, "node_id": "MDQ6VXNlcjM3NTAzNDc=", "avatar_url": "https://avatars.githubusercontent.com/u/3750347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ljedrz", "html_url": "https://github.com/ljedrz", "followers_url": "https://api.github.com/users/ljedrz/followers", "following_url": "https://api.github.com/users/ljedrz/following{/other_user}", "gists_url": "https://api.github.com/users/ljedrz/gists{/gist_id}", "starred_url": "https://api.github.com/users/ljedrz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ljedrz/subscriptions", "organizations_url": "https://api.github.com/users/ljedrz/orgs", "repos_url": "https://api.github.com/users/ljedrz/repos", "events_url": "https://api.github.com/users/ljedrz/events{/privacy}", "received_events_url": "https://api.github.com/users/ljedrz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "478464570e60523adc6d303577d1782229ca1f93", "url": "https://api.github.com/repos/rust-lang/rust/commits/478464570e60523adc6d303577d1782229ca1f93", "html_url": "https://github.com/rust-lang/rust/commit/478464570e60523adc6d303577d1782229ca1f93"}], "stats": {"total": 43, "additions": 22, "deletions": 21}, "files": [{"sha": "4a254d2123ecd5320beac3f6c791fae38f88da18", "filename": "src/librustc/hir/lowering.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc%2Fhir%2Flowering.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc%2Fhir%2Flowering.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Flowering.rs?ref=9a6ca413714271adac017cbdd764a7de8b244001", "patch": "@@ -97,7 +97,7 @@ pub struct LoweringContext<'a> {\n \n     trait_impls: BTreeMap<DefId, Vec<hir::HirId>>,\n \n-    modules: BTreeMap<NodeId, hir::ModuleItems>,\n+    modules: BTreeMap<hir::HirId, hir::ModuleItems>,\n \n     generator_kind: Option<hir::GeneratorKind>,\n \n@@ -141,7 +141,7 @@ pub struct LoweringContext<'a> {\n     /// vector.\n     in_scope_lifetimes: Vec<ParamName>,\n \n-    current_module: NodeId,\n+    current_module: hir::HirId,\n \n     type_def_lifetime_params: DefIdMap<usize>,\n \n@@ -262,7 +262,7 @@ pub fn lower_crate(\n         is_in_dyn_type: false,\n         anonymous_lifetime_mode: AnonymousLifetimeMode::PassThrough,\n         type_def_lifetime_params: Default::default(),\n-        current_module: CRATE_NODE_ID,\n+        current_module: hir::CRATE_HIR_ID,\n         current_hir_id_owner: vec![(CRATE_DEF_INDEX, 0)],\n         item_local_id_counters: Default::default(),\n         node_id_to_hir_id: IndexVec::new(),"}, {"sha": "780dd79435bf2deeebcae6e6fc1f6761628e10a3", "filename": "src/librustc/hir/lowering/item.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc%2Fhir%2Flowering%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc%2Fhir%2Flowering%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Flowering%2Fitem.rs?ref=9a6ca413714271adac017cbdd764a7de8b244001", "patch": "@@ -45,14 +45,16 @@ impl<'tcx, 'interner> ItemLowerer<'tcx, 'interner> {\n \n impl<'tcx, 'interner> Visitor<'tcx> for ItemLowerer<'tcx, 'interner> {\n     fn visit_mod(&mut self, m: &'tcx Mod, _s: Span, _attrs: &[Attribute], n: NodeId) {\n-        self.lctx.modules.insert(n, hir::ModuleItems {\n+        let hir_id = self.lctx.lower_node_id(n);\n+\n+        self.lctx.modules.insert(hir_id, hir::ModuleItems {\n             items: BTreeSet::new(),\n             trait_items: BTreeSet::new(),\n             impl_items: BTreeSet::new(),\n         });\n \n         let old = self.lctx.current_module;\n-        self.lctx.current_module = n;\n+        self.lctx.current_module = hir_id;\n         visit::walk_mod(self, m);\n         self.lctx.current_module = old;\n     }"}, {"sha": "b66c2ce1178a4aae1207c59003ca107a1ee94b26", "filename": "src/librustc/hir/map/hir_id_validator.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc%2Fhir%2Fmap%2Fhir_id_validator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc%2Fhir%2Fmap%2Fhir_id_validator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fmap%2Fhir_id_validator.rs?ref=9a6ca413714271adac017cbdd764a7de8b244001", "patch": "@@ -10,7 +10,7 @@ pub fn check_crate(hir_map: &hir::map::Map<'_>) {\n     let errors = Lock::new(Vec::new());\n \n     par_iter(&hir_map.krate().modules).for_each(|(module_id, _)| {\n-        let local_def_id = hir_map.local_def_id_from_node_id(*module_id);\n+        let local_def_id = hir_map.local_def_id(*module_id);\n         hir_map.visit_item_likes_in_module(local_def_id, &mut OuterVisitor {\n             hir_map,\n             errors: &errors,"}, {"sha": "e833c2bb8f3d826caa61c1f0371e2c5d5bd0e735", "filename": "src/librustc/hir/map/mod.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc%2Fhir%2Fmap%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc%2Fhir%2Fmap%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fmap%2Fmod.rs?ref=9a6ca413714271adac017cbdd764a7de8b244001", "patch": "@@ -539,9 +539,7 @@ impl<'hir> Map<'hir> {\n         // in the expect_* calls the loops below\n         self.read(hir_id);\n \n-        let node_id = self.hir_to_node_id[&hir_id];\n-\n-        let module = &self.forest.krate.modules[&node_id];\n+        let module = &self.forest.krate.modules[&hir_id];\n \n         for id in &module.items {\n             visitor.visit_item(self.expect_item(*id));"}, {"sha": "d639fdf6abc2c912aae55d463444b49d1051d3fc", "filename": "src/librustc/hir/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc%2Fhir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc%2Fhir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fmod.rs?ref=9a6ca413714271adac017cbdd764a7de8b244001", "patch": "@@ -767,7 +767,7 @@ pub struct Crate {\n \n     /// A list of modules written out in the order in which they\n     /// appear in the crate. This includes the main crate module.\n-    pub modules: BTreeMap<NodeId, ModuleItems>,\n+    pub modules: BTreeMap<HirId, ModuleItems>,\n }\n \n impl Crate {"}, {"sha": "a44dbff27ed6efb6d1f0495573fb874e5cdf6c06", "filename": "src/librustc/lint/context.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc%2Flint%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc%2Flint%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fcontext.rs?ref=9a6ca413714271adac017cbdd764a7de8b244001", "patch": "@@ -1515,7 +1515,7 @@ pub fn check_crate<'tcx, T: for<'a> LateLintPass<'a, 'tcx>>(\n         time(tcx.sess, \"module lints\", || {\n             // Run per-module lints\n             par_iter(&tcx.hir().krate().modules).for_each(|(&module, _)| {\n-                tcx.ensure().lint_mod(tcx.hir().local_def_id_from_node_id(module));\n+                tcx.ensure().lint_mod(tcx.hir().local_def_id(module));\n             });\n         });\n     });"}, {"sha": "68e799eced2f3c2da646015c678723e75bf66f35", "filename": "src/librustc_interface/passes.rs", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc_interface%2Fpasses.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc_interface%2Fpasses.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_interface%2Fpasses.rs?ref=9a6ca413714271adac017cbdd764a7de8b244001", "patch": "@@ -913,10 +913,10 @@ fn analysis(tcx: TyCtxt<'_>, cnum: CrateNum) -> Result<()> {\n             });\n         }, {\n             par_iter(&tcx.hir().krate().modules).for_each(|(&module, _)| {\n-                tcx.ensure().check_mod_loops(tcx.hir().local_def_id_from_node_id(module));\n-                tcx.ensure().check_mod_attrs(tcx.hir().local_def_id_from_node_id(module));\n-                tcx.ensure().check_mod_unstable_api_usage(\n-                    tcx.hir().local_def_id_from_node_id(module));\n+                let local_def_id = tcx.hir().local_def_id(module);\n+                tcx.ensure().check_mod_loops(local_def_id);\n+                tcx.ensure().check_mod_attrs(local_def_id);\n+                tcx.ensure().check_mod_unstable_api_usage(local_def_id);\n             });\n         });\n     });\n@@ -939,9 +939,10 @@ fn analysis(tcx: TyCtxt<'_>, cnum: CrateNum) -> Result<()> {\n                     // \"not all control paths return a value\" is reported here.\n                     //\n                     // maybe move the check to a MIR pass?\n-                    tcx.ensure().check_mod_liveness(tcx.hir().local_def_id_from_node_id(module));\n+                    let local_def_id = tcx.hir().local_def_id(module);\n \n-                    tcx.ensure().check_mod_intrinsics(tcx.hir().local_def_id_from_node_id(module));\n+                    tcx.ensure().check_mod_liveness(local_def_id);\n+                    tcx.ensure().check_mod_intrinsics(local_def_id);\n                 });\n             });\n         });\n@@ -1001,7 +1002,7 @@ fn analysis(tcx: TyCtxt<'_>, cnum: CrateNum) -> Result<()> {\n         }, {\n             time(sess, \"privacy checking modules\", || {\n                 par_iter(&tcx.hir().krate().modules).for_each(|(&module, _)| {\n-                    tcx.ensure().check_mod_privacy(tcx.hir().local_def_id_from_node_id(module));\n+                    tcx.ensure().check_mod_privacy(tcx.hir().local_def_id(module));\n                 });\n             });\n         });"}, {"sha": "e3302f299ea715485c57f55f868974758c872b8a", "filename": "src/librustc_typeck/impl_wf_check.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc_typeck%2Fimpl_wf_check.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc_typeck%2Fimpl_wf_check.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fimpl_wf_check.rs?ref=9a6ca413714271adac017cbdd764a7de8b244001", "patch": "@@ -54,7 +54,7 @@ pub fn impl_wf_check(tcx: TyCtxt<'_>) {\n     // but it's one that we must perform earlier than the rest of\n     // WfCheck.\n     for &module in tcx.hir().krate().modules.keys() {\n-        tcx.ensure().check_mod_impl_wf(tcx.hir().local_def_id_from_node_id(module));\n+        tcx.ensure().check_mod_impl_wf(tcx.hir().local_def_id(module));\n     }\n }\n "}, {"sha": "53506454be79e1db8c83f4abe6fea75689ca4311", "filename": "src/librustc_typeck/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc_typeck%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9a6ca413714271adac017cbdd764a7de8b244001/src%2Flibrustc_typeck%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Flib.rs?ref=9a6ca413714271adac017cbdd764a7de8b244001", "patch": "@@ -306,7 +306,7 @@ pub fn check_crate(tcx: TyCtxt<'_>) -> Result<(), ErrorReported> {\n     tcx.sess.track_errors(|| {\n         time(tcx.sess, \"type collecting\", || {\n             for &module in tcx.hir().krate().modules.keys() {\n-                tcx.ensure().collect_mod_item_types(tcx.hir().local_def_id_from_node_id(module));\n+                tcx.ensure().collect_mod_item_types(tcx.hir().local_def_id(module));\n             }\n         });\n     })?;\n@@ -341,7 +341,7 @@ pub fn check_crate(tcx: TyCtxt<'_>) -> Result<(), ErrorReported> {\n \n     time(tcx.sess, \"item-types checking\", || {\n         for &module in tcx.hir().krate().modules.keys() {\n-            tcx.ensure().check_mod_item_types(tcx.hir().local_def_id_from_node_id(module));\n+            tcx.ensure().check_mod_item_types(tcx.hir().local_def_id(module));\n         }\n     });\n "}]}