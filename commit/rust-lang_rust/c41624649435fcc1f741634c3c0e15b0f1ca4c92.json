{"sha": "c41624649435fcc1f741634c3c0e15b0f1ca4c92", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM0MTYyNDY0OTQzNWZjYzFmNzQxNjM0YzNjMGUxNWIwZjFjYTRjOTI=", "commit": {"author": {"name": "Nick Cameron", "email": "nrc@ncameron.org", "date": "2018-03-15T18:30:30Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-03-15T18:30:30Z"}, "message": "Merge pull request #2509 from topecongiro/issue-2493\n\nOverflow the last rhs of a binary expression", "tree": {"sha": "d3ec66d22337c4d78bff1c5a9e94f6d6c9459066", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d3ec66d22337c4d78bff1c5a9e94f6d6c9459066"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c41624649435fcc1f741634c3c0e15b0f1ca4c92", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJaqrvGCRBK7hj4Ov3rIwAAdHIIAJyOKzEjsizJAQDjVJY+dksI\npnW+dIvM21w6+fbm+O8mgOm1WkuxM7nmztNlUaAsmS967a8MKuxeRH12Ywk9zvGx\nAvFW9Oiwa2Lk9qxLY9MqNdXd7Ebz5TKUnyjMHZ7dVzxXu7MlvgO5Kx/eQs+GwIjG\n2UQWvHoWdgqc1nzWYJ1bLzcmZBeCnVUdq+vFoMmpln7GO8/hX67cnz7fmjuj1tlH\nNuJes7CI4noejK0lgPdgecTTWwmc590to9e1EB3/MPdAZL6PUdUVz4PIURC/0I/z\nKX1yO8pW8QYSe6zYMYmE59VEZqWeAd0vQdjDVj9652KlFh35fozX3Thtx/V/euM=\n=HCna\n-----END PGP SIGNATURE-----\n", "payload": "tree d3ec66d22337c4d78bff1c5a9e94f6d6c9459066\nparent 65ce7bbb814f76129f8a0db674a4a5a4db2ee1ee\nparent 822dd41ad907b2147340541ffc3d28b6eb6109db\nauthor Nick Cameron <nrc@ncameron.org> 1521138630 +1300\ncommitter GitHub <noreply@github.com> 1521138630 +1300\n\nMerge pull request #2509 from topecongiro/issue-2493\n\nOverflow the last rhs of a binary expression"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c41624649435fcc1f741634c3c0e15b0f1ca4c92", "html_url": "https://github.com/rust-lang/rust/commit/c41624649435fcc1f741634c3c0e15b0f1ca4c92", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c41624649435fcc1f741634c3c0e15b0f1ca4c92/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "65ce7bbb814f76129f8a0db674a4a5a4db2ee1ee", "url": "https://api.github.com/repos/rust-lang/rust/commits/65ce7bbb814f76129f8a0db674a4a5a4db2ee1ee", "html_url": "https://github.com/rust-lang/rust/commit/65ce7bbb814f76129f8a0db674a4a5a4db2ee1ee"}, {"sha": "822dd41ad907b2147340541ffc3d28b6eb6109db", "url": "https://api.github.com/repos/rust-lang/rust/commits/822dd41ad907b2147340541ffc3d28b6eb6109db", "html_url": "https://github.com/rust-lang/rust/commit/822dd41ad907b2147340541ffc3d28b6eb6109db"}], "stats": {"total": 46, "additions": 39, "deletions": 7}, "files": [{"sha": "e144c8307b6608d5e8c7ceb18cb16b640ccb9acb", "filename": "src/expr.rs", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/c41624649435fcc1f741634c3c0e15b0f1ca4c92/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c41624649435fcc1f741634c3c0e15b0f1ca4c92/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=c41624649435fcc1f741634c3c0e15b0f1ca4c92", "patch": "@@ -369,13 +369,15 @@ where\n         .and_then(|s| s.sub_width(pp.suffix.len()))\n         .and_then(|rhs_shape| rhs.rewrite(context, rhs_shape));\n     if let Some(ref rhs_result) = rhs_orig_result {\n-        // If the rhs looks like block expression, we allow it to stay on the same line\n-        // with the lhs even if it is multi-lined.\n-        let allow_same_line = rhs_result\n-            .lines()\n-            .next()\n-            .map(|first_line| first_line.ends_with('{'))\n-            .unwrap_or(false);\n+        // If the length of the lhs is equal to or shorter than the tab width or\n+        // the rhs looks like block expression, we put the rhs on the same\n+        // line with the lhs even if the rhs is multi-lined.\n+        let allow_same_line = lhs_result.len() <= context.config.tab_spaces()\n+            || rhs_result\n+                .lines()\n+                .next()\n+                .map(|first_line| first_line.ends_with('{'))\n+                .unwrap_or(false);\n         if !rhs_result.contains('\\n') || allow_same_line {\n             let one_line_width = last_line_width(&lhs_result) + pp.infix.len()\n                 + first_line_width(rhs_result) + pp.suffix.len();"}, {"sha": "6367dbc95b8e28ae23ad92e082f4f36d324c7ba1", "filename": "tests/source/expr.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/c41624649435fcc1f741634c3c0e15b0f1ca4c92/tests%2Fsource%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c41624649435fcc1f741634c3c0e15b0f1ca4c92/tests%2Fsource%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fexpr.rs?ref=c41624649435fcc1f741634c3c0e15b0f1ca4c92", "patch": "@@ -370,3 +370,17 @@ fn newlines_between_list_like_expr() {\n fn issue2178() {\n     Ok(result.iter().map(|item| ls_util::rls_to_location(item)).collect())\n }\n+\n+// #2493\n+impl Foo {\n+fn bar(&self) {\n+    {\n+        let x = match () {\n+            () => {\n+                let i;\n+                i == self.install_config.storage.experimental_compressed_block_size as usize\n+            }\n+        };\n+    }\n+}\n+}"}, {"sha": "09e1e8afd1ada7db341a096a576e0e14fb13c1ed", "filename": "tests/target/expr.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/c41624649435fcc1f741634c3c0e15b0f1ca4c92/tests%2Ftarget%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c41624649435fcc1f741634c3c0e15b0f1ca4c92/tests%2Ftarget%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fexpr.rs?ref=c41624649435fcc1f741634c3c0e15b0f1ca4c92", "patch": "@@ -393,3 +393,19 @@ fn issue2178() {\n         .map(|item| ls_util::rls_to_location(item))\n         .collect())\n }\n+\n+// #2493\n+impl Foo {\n+    fn bar(&self) {\n+        {\n+            let x = match () {\n+                () => {\n+                    let i;\n+                    i == self.install_config\n+                        .storage\n+                        .experimental_compressed_block_size as usize\n+                }\n+            };\n+        }\n+    }\n+}"}]}