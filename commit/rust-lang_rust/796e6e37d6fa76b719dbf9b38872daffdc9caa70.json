{"sha": "796e6e37d6fa76b719dbf9b38872daffdc9caa70", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc5NmU2ZTM3ZDZmYTc2YjcxOWRiZjliMzg4NzJkYWZmZGM5Y2FhNzA=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2019-04-11T20:48:53Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2019-04-12T17:17:46Z"}, "message": "Don't generate empty json variables", "tree": {"sha": "7680ffb0b2e3c06c201c728cd5c3bb97631a4f1d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7680ffb0b2e3c06c201c728cd5c3bb97631a4f1d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/796e6e37d6fa76b719dbf9b38872daffdc9caa70", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/796e6e37d6fa76b719dbf9b38872daffdc9caa70", "html_url": "https://github.com/rust-lang/rust/commit/796e6e37d6fa76b719dbf9b38872daffdc9caa70", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/796e6e37d6fa76b719dbf9b38872daffdc9caa70/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2002b4b39a16760f37107cf02d7a91ff316d3073", "url": "https://api.github.com/repos/rust-lang/rust/commits/2002b4b39a16760f37107cf02d7a91ff316d3073", "html_url": "https://github.com/rust-lang/rust/commit/2002b4b39a16760f37107cf02d7a91ff316d3073"}], "stats": {"total": 53, "additions": 34, "deletions": 19}, "files": [{"sha": "3f2eaf8ec5527b3c449d4c8a0950d9e8d88c0108", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/796e6e37d6fa76b719dbf9b38872daffdc9caa70/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/796e6e37d6fa76b719dbf9b38872daffdc9caa70/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=796e6e37d6fa76b719dbf9b38872daffdc9caa70", "patch": "@@ -1060,11 +1060,22 @@ themePicker.onblur = handleThemeButtonsBlur;\n                                                         .expect(\"invalid osstring conversion\")))\n                                       .collect::<Vec<_>>();\n             files.sort_unstable_by(|a, b| a.cmp(b));\n-            // FIXME(imperio): we could avoid to generate \"dirs\" and \"files\" if they're empty.\n-            format!(\"{{\\\"name\\\":\\\"{name}\\\",\\\"dirs\\\":[{subs}],\\\"files\\\":[{files}]}}\",\n+            let subs = subs.iter().map(|s| s.to_json_string()).collect::<Vec<_>>().join(\",\");\n+            let dirs = if subs.is_empty() {\n+                String::new()\n+            } else {\n+                format!(\",\\\"dirs\\\":[{}]\", subs)\n+            };\n+            let files = files.join(\",\");\n+            let files = if files.is_empty() {\n+                String::new()\n+            } else {\n+                format!(\",\\\"files\\\":[{}]\", files)\n+            };\n+            format!(\"{{\\\"name\\\":\\\"{name}\\\"{dirs}{files}}}\",\n                     name=self.elem.to_str().expect(\"invalid osstring conversion\"),\n-                    subs=subs.iter().map(|s| s.to_json_string()).collect::<Vec<_>>().join(\",\"),\n-                    files=files.join(\",\"))\n+                    dirs=dirs,\n+                    files=files)\n         }\n     }\n "}, {"sha": "567022b4139adaf7b97c9f203d0ac734b89d39c1", "filename": "src/librustdoc/html/static/source-script.js", "status": "modified", "additions": 19, "deletions": 15, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/796e6e37d6fa76b719dbf9b38872daffdc9caa70/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsource-script.js", "raw_url": "https://github.com/rust-lang/rust/raw/796e6e37d6fa76b719dbf9b38872daffdc9caa70/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsource-script.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsource-script.js?ref=796e6e37d6fa76b719dbf9b38872daffdc9caa70", "patch": "@@ -39,28 +39,32 @@ function createDirEntry(elem, parent, fullPath, currentFile, hasFoundFile) {\n     children.className = \"children\";\n     var folders = document.createElement(\"div\");\n     folders.className = \"folders\";\n-    for (var i = 0; i < elem.dirs.length; ++i) {\n-        if (createDirEntry(elem.dirs[i], folders, fullPath, currentFile,\n-                           hasFoundFile) === true) {\n-            addClass(name, \"expand\");\n-            hasFoundFile = true;\n+    if (elem.dirs) {\n+        for (var i = 0; i < elem.dirs.length; ++i) {\n+            if (createDirEntry(elem.dirs[i], folders, fullPath, currentFile,\n+                               hasFoundFile) === true) {\n+                addClass(name, \"expand\");\n+                hasFoundFile = true;\n+            }\n         }\n     }\n     children.appendChild(folders);\n \n     var files = document.createElement(\"div\");\n     files.className = \"files\";\n-    for (i = 0; i < elem.files.length; ++i) {\n-        var file = document.createElement(\"a\");\n-        file.innerText = elem.files[i];\n-        file.href = window.rootPath + \"src/\" + fullPath + elem.files[i] + \".html\";\n-        if (hasFoundFile === false &&\n-                currentFile === fullPath + elem.files[i]) {\n-            file.className = \"selected\";\n-            addClass(name, \"expand\");\n-            hasFoundFile = true;\n+    if (elem.files) {\n+        for (i = 0; i < elem.files.length; ++i) {\n+            var file = document.createElement(\"a\");\n+            file.innerText = elem.files[i];\n+            file.href = window.rootPath + \"src/\" + fullPath + elem.files[i] + \".html\";\n+            if (hasFoundFile === false &&\n+                    currentFile === fullPath + elem.files[i]) {\n+                file.className = \"selected\";\n+                addClass(name, \"expand\");\n+                hasFoundFile = true;\n+            }\n+            files.appendChild(file);\n         }\n-        files.appendChild(file);\n     }\n     search.fullPath = fullPath;\n     children.appendChild(files);"}]}