{"sha": "45c6423cbc1fe5ae5be33e6afe4f313d6951e01b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ1YzY0MjNjYmMxZmU1YWU1YmUzM2U2YWZlNGYzMTNkNjk1MWUwMWI=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2015-01-15T14:22:56Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2015-01-15T14:22:56Z"}, "message": "debuginfo: Fix ICE when compiling for-loops with lines-tables-only.", "tree": {"sha": "d4ca679323ea0692466ed8d612ffaab486d48a24", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d4ca679323ea0692466ed8d612ffaab486d48a24"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/45c6423cbc1fe5ae5be33e6afe4f313d6951e01b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/45c6423cbc1fe5ae5be33e6afe4f313d6951e01b", "html_url": "https://github.com/rust-lang/rust/commit/45c6423cbc1fe5ae5be33e6afe4f313d6951e01b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/45c6423cbc1fe5ae5be33e6afe4f313d6951e01b/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1c78ad937b4da9dd872b0a865025f3e2e885f90d", "url": "https://api.github.com/repos/rust-lang/rust/commits/1c78ad937b4da9dd872b0a865025f3e2e885f90d", "html_url": "https://github.com/rust-lang/rust/commit/1c78ad937b4da9dd872b0a865025f3e2e885f90d"}], "stats": {"total": 60, "additions": 28, "deletions": 32}, "files": [{"sha": "77d2280bb6ee46803f95fad15ab56dbba1439e55", "filename": "src/librustc_trans/trans/_match.rs", "status": "modified", "additions": 2, "deletions": 9, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/45c6423cbc1fe5ae5be33e6afe4f313d6951e01b/src%2Flibrustc_trans%2Ftrans%2F_match.rs", "raw_url": "https://github.com/rust-lang/rust/raw/45c6423cbc1fe5ae5be33e6afe4f313d6951e01b/src%2Flibrustc_trans%2Ftrans%2F_match.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2F_match.rs?ref=45c6423cbc1fe5ae5be33e6afe4f313d6951e01b", "patch": "@@ -857,16 +857,9 @@ fn insert_lllocals<'blk, 'tcx>(mut bcx: Block<'blk, 'tcx>,\n             bcx.fcx.schedule_lifetime_end(cs, binding_info.llmatch);\n         }\n \n-        debug!(\"binding {} to {}\",\n-               binding_info.id,\n-               bcx.val_to_string(llval));\n+        debug!(\"binding {} to {}\", binding_info.id, bcx.val_to_string(llval));\n         bcx.fcx.lllocals.borrow_mut().insert(binding_info.id, datum);\n-\n-        if bcx.sess().opts.debuginfo == FullDebugInfo {\n-            debuginfo::create_match_binding_metadata(bcx,\n-                                                     ident,\n-                                                     binding_info);\n-        }\n+        debuginfo::create_match_binding_metadata(bcx, ident, binding_info);\n     }\n     bcx\n }"}, {"sha": "a8fd9e571f942bdea32cad29d7da125e4d7b52b0", "filename": "src/librustc_trans/trans/base.rs", "status": "modified", "additions": 5, "deletions": 12, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/45c6423cbc1fe5ae5be33e6afe4f313d6951e01b/src%2Flibrustc_trans%2Ftrans%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/45c6423cbc1fe5ae5be33e6afe4f313d6951e01b/src%2Flibrustc_trans%2Ftrans%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fbase.rs?ref=45c6423cbc1fe5ae5be33e6afe4f313d6951e01b", "patch": "@@ -44,7 +44,7 @@ use middle::subst;\n use middle::weak_lang_items;\n use middle::subst::{Subst, Substs};\n use middle::ty::{self, Ty, UnboxedClosureTyper};\n-use session::config::{self, NoDebugInfo, FullDebugInfo};\n+use session::config::{self, NoDebugInfo};\n use session::Session;\n use trans::_match;\n use trans::adt;\n@@ -1626,9 +1626,8 @@ fn create_datums_for_fn_args_under_call_abi<'blk, 'tcx>(\n     result\n }\n \n-fn copy_args_to_allocas<'blk, 'tcx>(fcx: &FunctionContext<'blk, 'tcx>,\n+fn copy_args_to_allocas<'blk, 'tcx>(bcx: Block<'blk, 'tcx>,\n                                     arg_scope: cleanup::CustomScopeIndex,\n-                                    bcx: Block<'blk, 'tcx>,\n                                     args: &[ast::Arg],\n                                     arg_datums: Vec<RvalueDatum<'tcx>>)\n                                     -> Block<'blk, 'tcx> {\n@@ -1649,10 +1648,7 @@ fn copy_args_to_allocas<'blk, 'tcx>(fcx: &FunctionContext<'blk, 'tcx>,\n         // the event it's not truly needed.\n \n         bcx = _match::store_arg(bcx, &*args[i].pat, arg_datum, arg_scope_id);\n-\n-        if fcx.ccx.sess().opts.debuginfo == FullDebugInfo {\n-            debuginfo::create_argument_metadata(bcx, &args[i]);\n-        }\n+        debuginfo::create_argument_metadata(bcx, &args[i]);\n     }\n \n     bcx\n@@ -1702,9 +1698,7 @@ fn copy_unboxed_closure_args_to_allocas<'blk, 'tcx>(\n                                 tuple_element_datum,\n                                 arg_scope_id);\n \n-        if bcx.fcx.ccx.sess().opts.debuginfo == FullDebugInfo {\n-            debuginfo::create_argument_metadata(bcx, &args[j]);\n-        }\n+        debuginfo::create_argument_metadata(bcx, &args[j]);\n     }\n \n     bcx\n@@ -1877,9 +1871,8 @@ pub fn trans_closure<'a, 'b, 'tcx>(ccx: &CrateContext<'a, 'tcx>,\n \n     bcx = match closure_env.kind {\n         closure::NotClosure | closure::BoxedClosure(..) => {\n-            copy_args_to_allocas(&fcx,\n+            copy_args_to_allocas(bcx,\n                                  arg_scope,\n-                                 bcx,\n                                  &decl.inputs[],\n                                  arg_datums)\n         }"}, {"sha": "5dc939dc2025bca7d192bd396e7112d7b2568e8f", "filename": "src/librustc_trans/trans/controlflow.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/45c6423cbc1fe5ae5be33e6afe4f313d6951e01b/src%2Flibrustc_trans%2Ftrans%2Fcontrolflow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/45c6423cbc1fe5ae5be33e6afe4f313d6951e01b/src%2Flibrustc_trans%2Ftrans%2Fcontrolflow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fcontrolflow.rs?ref=45c6423cbc1fe5ae5be33e6afe4f313d6951e01b", "patch": "@@ -28,7 +28,6 @@ use trans::type_::Type;\n use trans;\n use middle::ty;\n use middle::ty::MethodCall;\n-use session::config::FullDebugInfo;\n use util::ppaux::Repr;\n use util::ppaux;\n \n@@ -66,10 +65,7 @@ pub fn trans_stmt<'blk, 'tcx>(cx: Block<'blk, 'tcx>,\n             match d.node {\n                 ast::DeclLocal(ref local) => {\n                     bcx = init_local(bcx, &**local);\n-                    if cx.sess().opts.debuginfo == FullDebugInfo {\n-                        trans::debuginfo::create_local_var_metadata(bcx,\n-                                                                    &**local);\n-                    }\n+                    debuginfo::create_local_var_metadata(bcx, &**local);\n                 }\n                 // Inner items are visited by `trans_item`/`trans_meth`.\n                 ast::DeclItem(_) => {},"}, {"sha": "bbead5f4153efc3889ed0af440acb6aac7f8aa21", "filename": "src/librustc_trans/trans/debuginfo.rs", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/45c6423cbc1fe5ae5be33e6afe4f313d6951e01b/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/45c6423cbc1fe5ae5be33e6afe4f313d6951e01b/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Ftrans%2Fdebuginfo.rs?ref=45c6423cbc1fe5ae5be33e6afe4f313d6951e01b", "patch": "@@ -878,7 +878,9 @@ pub fn create_global_var_metadata(cx: &CrateContext,\n /// local in `bcx.fcx.lllocals`.\n /// Adds the created metadata nodes directly to the crate's IR.\n pub fn create_local_var_metadata(bcx: Block, local: &ast::Local) {\n-    if bcx.unreachable.get() || fn_should_be_ignored(bcx.fcx) {\n+    if bcx.unreachable.get() ||\n+       fn_should_be_ignored(bcx.fcx) ||\n+       bcx.sess().opts.debuginfo != FullDebugInfo  {\n         return;\n     }\n \n@@ -922,7 +924,9 @@ pub fn create_captured_var_metadata<'blk, 'tcx>(bcx: Block<'blk, 'tcx>,\n                                                 env_index: uint,\n                                                 captured_by_ref: bool,\n                                                 span: Span) {\n-    if bcx.unreachable.get() || fn_should_be_ignored(bcx.fcx) {\n+    if bcx.unreachable.get() ||\n+       fn_should_be_ignored(bcx.fcx) ||\n+       bcx.sess().opts.debuginfo != FullDebugInfo {\n         return;\n     }\n \n@@ -1005,7 +1009,9 @@ pub fn create_captured_var_metadata<'blk, 'tcx>(bcx: Block<'blk, 'tcx>,\n pub fn create_match_binding_metadata<'blk, 'tcx>(bcx: Block<'blk, 'tcx>,\n                                                  variable_ident: ast::Ident,\n                                                  binding: BindingInfo<'tcx>) {\n-    if bcx.unreachable.get() || fn_should_be_ignored(bcx.fcx) {\n+    if bcx.unreachable.get() ||\n+       fn_should_be_ignored(bcx.fcx) ||\n+       bcx.sess().opts.debuginfo != FullDebugInfo {\n         return;\n     }\n \n@@ -1045,7 +1051,9 @@ pub fn create_match_binding_metadata<'blk, 'tcx>(bcx: Block<'blk, 'tcx>,\n /// argument in `bcx.fcx.lllocals`.\n /// Adds the created metadata nodes directly to the crate's IR.\n pub fn create_argument_metadata(bcx: Block, arg: &ast::Arg) {\n-    if bcx.unreachable.get() || fn_should_be_ignored(bcx.fcx) {\n+    if bcx.unreachable.get() ||\n+       fn_should_be_ignored(bcx.fcx) ||\n+       bcx.sess().opts.debuginfo != FullDebugInfo {\n         return;\n     }\n \n@@ -1099,7 +1107,9 @@ pub fn create_argument_metadata(bcx: Block, arg: &ast::Arg) {\n /// loop variable in `bcx.fcx.lllocals`.\n /// Adds the created metadata nodes directly to the crate's IR.\n pub fn create_for_loop_var_metadata(bcx: Block, pat: &ast::Pat) {\n-    if bcx.unreachable.get() || fn_should_be_ignored(bcx.fcx) {\n+    if bcx.unreachable.get() ||\n+       fn_should_be_ignored(bcx.fcx) ||\n+       bcx.sess().opts.debuginfo != FullDebugInfo {\n         return;\n     }\n "}, {"sha": "00de4497cedbf0ee2e7e88438a350dc0b4f79372", "filename": "src/test/debuginfo/limited-debuginfo.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/45c6423cbc1fe5ae5be33e6afe4f313d6951e01b/src%2Ftest%2Fdebuginfo%2Flimited-debuginfo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/45c6423cbc1fe5ae5be33e6afe4f313d6951e01b/src%2Ftest%2Fdebuginfo%2Flimited-debuginfo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fdebuginfo%2Flimited-debuginfo.rs?ref=45c6423cbc1fe5ae5be33e6afe4f313d6951e01b", "patch": "@@ -48,7 +48,11 @@ fn zzz() {()}\n fn some_function(a: int, b: int) {\n     let some_variable = Struct { a: 11, b: 22 };\n     let some_other_variable = 23i;\n-    zzz(); // #break\n+\n+    for x in range(0, 1) {\n+        zzz(); // #break\n+    }\n }\n \n fn some_other_function(a: int, b: int) -> bool { true }\n+"}]}