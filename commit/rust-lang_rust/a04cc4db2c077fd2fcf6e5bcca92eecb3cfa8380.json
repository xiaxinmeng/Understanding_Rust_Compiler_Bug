{"sha": "a04cc4db2c077fd2fcf6e5bcca92eecb3cfa8380", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEwNGNjNGRiMmMwNzdmZDJmY2Y2ZTViY2NhOTJlZWNiM2NmYTgzODA=", "commit": {"author": {"name": "Luqman Aden", "email": "laden@csclub.uwaterloo.ca", "date": "2014-01-22T21:05:28Z"}, "committer": {"name": "Luqman Aden", "email": "laden@csclub.uwaterloo.ca", "date": "2014-01-24T21:44:16Z"}, "message": "libstd: Use iotest! for for get_host_addresses.", "tree": {"sha": "08c0ae2c6e3cc3c7c75e052288c8771bab0ac62a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/08c0ae2c6e3cc3c7c75e052288c8771bab0ac62a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a04cc4db2c077fd2fcf6e5bcca92eecb3cfa8380", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a04cc4db2c077fd2fcf6e5bcca92eecb3cfa8380", "html_url": "https://github.com/rust-lang/rust/commit/a04cc4db2c077fd2fcf6e5bcca92eecb3cfa8380", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a04cc4db2c077fd2fcf6e5bcca92eecb3cfa8380/comments", "author": {"login": "luqmana", "id": 287063, "node_id": "MDQ6VXNlcjI4NzA2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luqmana", "html_url": "https://github.com/luqmana", "followers_url": "https://api.github.com/users/luqmana/followers", "following_url": "https://api.github.com/users/luqmana/following{/other_user}", "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}", "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions", "organizations_url": "https://api.github.com/users/luqmana/orgs", "repos_url": "https://api.github.com/users/luqmana/repos", "events_url": "https://api.github.com/users/luqmana/events{/privacy}", "received_events_url": "https://api.github.com/users/luqmana/received_events", "type": "User", "site_admin": false}, "committer": {"login": "luqmana", "id": 287063, "node_id": "MDQ6VXNlcjI4NzA2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luqmana", "html_url": "https://github.com/luqmana", "followers_url": "https://api.github.com/users/luqmana/followers", "following_url": "https://api.github.com/users/luqmana/following{/other_user}", "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}", "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions", "organizations_url": "https://api.github.com/users/luqmana/orgs", "repos_url": "https://api.github.com/users/luqmana/repos", "events_url": "https://api.github.com/users/luqmana/events{/privacy}", "received_events_url": "https://api.github.com/users/luqmana/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5aa31c43a0ab50208e58680cf5f29eec8ff76357", "url": "https://api.github.com/repos/rust-lang/rust/commits/5aa31c43a0ab50208e58680cf5f29eec8ff76357", "html_url": "https://github.com/rust-lang/rust/commit/5aa31c43a0ab50208e58680cf5f29eec8ff76357"}], "stats": {"total": 52, "additions": 11, "deletions": 41}, "files": [{"sha": "2740671c00d60489abb90b402fce4ddafa5ea4f8", "filename": "src/librustuv/addrinfo.rs", "status": "modified", "additions": 0, "deletions": 36, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/a04cc4db2c077fd2fcf6e5bcca92eecb3cfa8380/src%2Flibrustuv%2Faddrinfo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a04cc4db2c077fd2fcf6e5bcca92eecb3cfa8380/src%2Flibrustuv%2Faddrinfo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustuv%2Faddrinfo.rs?ref=a04cc4db2c077fd2fcf6e5bcca92eecb3cfa8380", "patch": "@@ -183,39 +183,3 @@ pub fn accum_addrinfo(addr: &Addrinfo) -> ~[ai::Info] {\n         return addrs;\n     }\n }\n-\n-// cannot give tcp/ip permission without help of apk\n-#[cfg(test, not(target_os=\"android\"))]\n-mod test {\n-    use std::io::net::ip::{SocketAddr, Ipv4Addr};\n-    use super::super::local_loop;\n-    use super::GetAddrInfoRequest;\n-\n-    #[test]\n-    fn getaddrinfo_test() {\n-        let loop_ = &mut local_loop().loop_;\n-        match GetAddrInfoRequest::run(loop_, Some(\"localhost\"), None, None) {\n-            Ok(infos) => {\n-                let mut found_local = false;\n-                let local_addr = &SocketAddr {\n-                    ip: Ipv4Addr(127, 0, 0, 1),\n-                    port: 0\n-                };\n-                for addr in infos.iter() {\n-                    found_local = found_local || addr.address == *local_addr;\n-                }\n-                assert!(found_local);\n-            }\n-            Err(e) => fail!(\"{:?}\", e),\n-        }\n-    }\n-\n-    #[test]\n-    fn issue_10663() {\n-        let loop_ = &mut local_loop().loop_;\n-        // Something should happen here, but this certainly shouldn't cause\n-        // everything to die. The actual outcome we don't care too much about.\n-        GetAddrInfoRequest::run(loop_, Some(\"irc.n0v4.com\"), None,\n-                                None);\n-    }\n-}"}, {"sha": "4a8529d0a0aafec8e3d3b623d2090b001cc0fc20", "filename": "src/libstd/io/net/addrinfo.rs", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/a04cc4db2c077fd2fcf6e5bcca92eecb3cfa8380/src%2Flibstd%2Fio%2Fnet%2Faddrinfo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a04cc4db2c077fd2fcf6e5bcca92eecb3cfa8380/src%2Flibstd%2Fio%2Fnet%2Faddrinfo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fio%2Fnet%2Faddrinfo.rs?ref=a04cc4db2c077fd2fcf6e5bcca92eecb3cfa8380", "patch": "@@ -98,21 +98,27 @@ fn lookup(hostname: Option<&str>, servname: Option<&str>, hint: Option<Hint>)\n     LocalIo::maybe_raise(|io| io.get_host_addresses(hostname, servname, hint))\n }\n \n-#[cfg(test)]\n+// Ignored on android since we cannot give tcp/ip\n+// permission without help of apk\n+#[cfg(test, not(target_os = \"android\"))]\n mod test {\n     use io::net::ip::Ipv4Addr;\n     use prelude::*;\n     use super::*;\n \n-    #[test]\n-    #[ignore(cfg(target_os=\"android\"))] // cannot give tcp/ip permission without help of apk\n-    fn dns_smoke_test() {\n+    iotest!(fn dns_smoke_test() {\n         let ipaddrs = get_host_addresses(\"localhost\").unwrap();\n         let mut found_local = false;\n         let local_addr = &Ipv4Addr(127, 0, 0, 1);\n         for addr in ipaddrs.iter() {\n             found_local = found_local || addr == local_addr;\n         }\n         assert!(found_local);\n-    }\n+    })\n+\n+    iotest!(fn issue_10663() {\n+        // Something should happen here, but this certainly shouldn't cause\n+        // everything to die. The actual outcome we don't care too much about.\n+        get_host_addresses(\"example.com\");\n+    } #[ignore])\n }"}]}