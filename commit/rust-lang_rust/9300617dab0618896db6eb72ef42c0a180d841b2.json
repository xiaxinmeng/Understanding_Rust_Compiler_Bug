{"sha": "9300617dab0618896db6eb72ef42c0a180d841b2", "node_id": "C_kwDOAAsO6NoAKDkzMDA2MTdkYWIwNjE4ODk2ZGI2ZWI3MmVmNDJjMGExODBkODQxYjI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-02-10T05:09:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-02-10T05:09:59Z"}, "message": "Rollup merge of #107863 - compiler-errors:new-solver-multiple-candidates, r=jackh726\n\nAllow multiple candidates with same response in new solver\n\nTreat >1 candidates as *not* ambiguous if they return the same response.", "tree": {"sha": "748d16be6933b7da814d55f8356cf0b2dbf1dc09", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/748d16be6933b7da814d55f8356cf0b2dbf1dc09"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9300617dab0618896db6eb72ef42c0a180d841b2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJj5dGnCRBK7hj4Ov3rIwAAYq0IABkUM6XNW/bykmk8ixU4vrsM\nyoDuhx3zeZI7quPrzZ/IYFjEWKjhtYS9ccm50Jo2oZ4mYqh7DnctLQDZBDiRcSR6\n3YPIyXiRHNdggF0MXYQvHlt1Xx2UObri0DLqAg46uvQWX9S8i355t1tYun/09FBS\nCIX5yOkptuU7YCgfsAn9RdZG+i5strWWxoA1peZKYq0JE8izEbiPpl3vO1wyssXF\nKEpzjXm75FYJw4hWsH/7qCytsZeR3hc9+U2OPSBRxil6H1vJiB6ali/xYDv/HZfN\nhCUD/8nOR8Wo5QIvANX5DblTSeM2XtGNZh9VEA1SMf9w0S5suS4gbbpmu50nhds=\n=AnC4\n-----END PGP SIGNATURE-----\n", "payload": "tree 748d16be6933b7da814d55f8356cf0b2dbf1dc09\nparent dd5e4ade6ed6c6e85ceba77699a8f103a31cc767\nparent 3c4e1f85cb7103751bf99e3d826051ab42700dcc\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1676005799 +0100\ncommitter GitHub <noreply@github.com> 1676005799 +0100\n\nRollup merge of #107863 - compiler-errors:new-solver-multiple-candidates, r=jackh726\n\nAllow multiple candidates with same response in new solver\n\nTreat >1 candidates as *not* ambiguous if they return the same response.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9300617dab0618896db6eb72ef42c0a180d841b2", "html_url": "https://github.com/rust-lang/rust/commit/9300617dab0618896db6eb72ef42c0a180d841b2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9300617dab0618896db6eb72ef42c0a180d841b2/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dd5e4ade6ed6c6e85ceba77699a8f103a31cc767", "url": "https://api.github.com/repos/rust-lang/rust/commits/dd5e4ade6ed6c6e85ceba77699a8f103a31cc767", "html_url": "https://github.com/rust-lang/rust/commit/dd5e4ade6ed6c6e85ceba77699a8f103a31cc767"}, {"sha": "3c4e1f85cb7103751bf99e3d826051ab42700dcc", "url": "https://api.github.com/repos/rust-lang/rust/commits/3c4e1f85cb7103751bf99e3d826051ab42700dcc", "html_url": "https://github.com/rust-lang/rust/commit/3c4e1f85cb7103751bf99e3d826051ab42700dcc"}], "stats": {"total": 23, "additions": 8, "deletions": 15}, "files": [{"sha": "1ddf8cadd72800c621415fd630c7414bf5eef970", "filename": "Cargo.lock", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9300617dab0618896db6eb72ef42c0a180d841b2/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/9300617dab0618896db6eb72ef42c0a180d841b2/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=9300617dab0618896db6eb72ef42c0a180d841b2", "patch": "@@ -4773,6 +4773,7 @@ checksum = \"8ba09476327c4b70ccefb6180f046ef588c26a24cf5d269a9feba316eb4f029f\"\n name = \"rustc_trait_selection\"\n version = \"0.0.0\"\n dependencies = [\n+ \"itertools\",\n  \"rustc_ast\",\n  \"rustc_attr\",\n  \"rustc_data_structures\","}, {"sha": "d3eba43b47e95435072df092e44be36bb706278d", "filename": "compiler/rustc_trait_selection/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9300617dab0618896db6eb72ef42c0a180d841b2/compiler%2Frustc_trait_selection%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/9300617dab0618896db6eb72ef42c0a180d841b2/compiler%2Frustc_trait_selection%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2FCargo.toml?ref=9300617dab0618896db6eb72ef42c0a180d841b2", "patch": "@@ -24,3 +24,4 @@ rustc_span = { path = \"../rustc_span\" }\n rustc_target = { path = \"../rustc_target\" }\n rustc_transmute = { path = \"../rustc_transmute\", features = [\"rustc\"] }\n smallvec = { version = \"1.8.1\", features = [\"union\", \"may_dangle\"] }\n+itertools = \"0.10.1\""}, {"sha": "126ec60b3d68a078ca8cc2e087f236b28760c1ba", "filename": "compiler/rustc_trait_selection/src/solve/assembly.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9300617dab0618896db6eb72ef42c0a180d841b2/compiler%2Frustc_trait_selection%2Fsrc%2Fsolve%2Fassembly.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9300617dab0618896db6eb72ef42c0a180d841b2/compiler%2Frustc_trait_selection%2Fsrc%2Fsolve%2Fassembly.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Fsolve%2Fassembly.rs?ref=9300617dab0618896db6eb72ef42c0a180d841b2", "patch": "@@ -4,6 +4,7 @@ use super::infcx_ext::InferCtxtExt;\n #[cfg(doc)]\n use super::trait_goals::structural_traits::*;\n use super::{CanonicalResponse, Certainty, EvalCtxt, Goal, MaybeCause, QueryResult};\n+use itertools::Itertools;\n use rustc_hir::def_id::DefId;\n use rustc_infer::traits::query::NoSolution;\n use rustc_infer::traits::util::elaborate_predicates;\n@@ -489,9 +490,9 @@ impl<'tcx> EvalCtxt<'_, 'tcx> {\n                 i += 1;\n             }\n \n-            // If there are *STILL* multiple candidates, give up\n-            // and report ambiguity.\n-            if candidates.len() > 1 {\n+            // If there are *STILL* multiple candidates that have *different* response\n+            // results, give up and report ambiguity.\n+            if candidates.len() > 1 && !candidates.iter().map(|cand| cand.result).all_equal() {\n                 let certainty = if candidates.iter().all(|x| {\n                     matches!(x.result.value.certainty, Certainty::Maybe(MaybeCause::Overflow))\n                 }) {\n@@ -503,6 +504,7 @@ impl<'tcx> EvalCtxt<'_, 'tcx> {\n             }\n         }\n \n+        // FIXME: What if there are >1 candidates left with the same response, and one is a reservation impl?\n         Ok(self.discard_reservation_impl(candidates.pop().unwrap()).result)\n     }\n "}, {"sha": "589d34dd7abb1d4dce378e6647139810a63a64c0", "filename": "tests/ui/traits/new-solver/provisional-result-done.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9300617dab0618896db6eb72ef42c0a180d841b2/tests%2Fui%2Ftraits%2Fnew-solver%2Fprovisional-result-done.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9300617dab0618896db6eb72ef42c0a180d841b2/tests%2Fui%2Ftraits%2Fnew-solver%2Fprovisional-result-done.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftraits%2Fnew-solver%2Fprovisional-result-done.rs?ref=9300617dab0618896db6eb72ef42c0a180d841b2", "patch": "@@ -1,5 +1,5 @@\n-// known-bug: unknown\n // compile-flags: -Ztrait-solver=next\n+// check-pass\n \n // This tests checks that we update results in the provisional cache when\n // we pop a goal from the stack."}, {"sha": "5bd0613d25911612d5757accb5200e92354002d7", "filename": "tests/ui/traits/new-solver/provisional-result-done.stderr", "status": "removed", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/dd5e4ade6ed6c6e85ceba77699a8f103a31cc767/tests%2Fui%2Ftraits%2Fnew-solver%2Fprovisional-result-done.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/dd5e4ade6ed6c6e85ceba77699a8f103a31cc767/tests%2Fui%2Ftraits%2Fnew-solver%2Fprovisional-result-done.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftraits%2Fnew-solver%2Fprovisional-result-done.stderr?ref=dd5e4ade6ed6c6e85ceba77699a8f103a31cc767", "patch": "@@ -1,11 +0,0 @@\n-error[E0283]: type annotations needed: cannot satisfy `Bar<T>: Coinductive`\n-  --> $DIR/provisional-result-done.rs:16:25\n-   |\n-LL | impl<T> Coinductive for Bar<T>\n-   |                         ^^^^^^\n-   |\n-   = note: cannot satisfy `Bar<T>: Coinductive`\n-\n-error: aborting due to previous error\n-\n-For more information about this error, try `rustc --explain E0283`."}]}