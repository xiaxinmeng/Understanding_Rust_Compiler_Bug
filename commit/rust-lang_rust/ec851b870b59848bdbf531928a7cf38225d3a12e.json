{"sha": "ec851b870b59848bdbf531928a7cf38225d3a12e", "node_id": "C_kwDOAAsO6NoAKGVjODUxYjg3MGI1OTg0OGJkYmY1MzE5MjhhN2NmMzgyMjVkM2ExMmU", "commit": {"author": {"name": "Jaic1", "email": "506933131@qq.com", "date": "2022-03-28T04:09:01Z"}, "committer": {"name": "Jaic1", "email": "506933131@qq.com", "date": "2022-03-28T04:09:01Z"}, "message": "First submit", "tree": {"sha": "71236613ac9ae5f3c4ea01aa63fda618331bc0cf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/71236613ac9ae5f3c4ea01aa63fda618331bc0cf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ec851b870b59848bdbf531928a7cf38225d3a12e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ec851b870b59848bdbf531928a7cf38225d3a12e", "html_url": "https://github.com/rust-lang/rust/commit/ec851b870b59848bdbf531928a7cf38225d3a12e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ec851b870b59848bdbf531928a7cf38225d3a12e/comments", "author": {"login": "Jaic1", "id": 31958045, "node_id": "MDQ6VXNlcjMxOTU4MDQ1", "avatar_url": "https://avatars.githubusercontent.com/u/31958045?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jaic1", "html_url": "https://github.com/Jaic1", "followers_url": "https://api.github.com/users/Jaic1/followers", "following_url": "https://api.github.com/users/Jaic1/following{/other_user}", "gists_url": "https://api.github.com/users/Jaic1/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jaic1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jaic1/subscriptions", "organizations_url": "https://api.github.com/users/Jaic1/orgs", "repos_url": "https://api.github.com/users/Jaic1/repos", "events_url": "https://api.github.com/users/Jaic1/events{/privacy}", "received_events_url": "https://api.github.com/users/Jaic1/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Jaic1", "id": 31958045, "node_id": "MDQ6VXNlcjMxOTU4MDQ1", "avatar_url": "https://avatars.githubusercontent.com/u/31958045?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jaic1", "html_url": "https://github.com/Jaic1", "followers_url": "https://api.github.com/users/Jaic1/followers", "following_url": "https://api.github.com/users/Jaic1/following{/other_user}", "gists_url": "https://api.github.com/users/Jaic1/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jaic1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jaic1/subscriptions", "organizations_url": "https://api.github.com/users/Jaic1/orgs", "repos_url": "https://api.github.com/users/Jaic1/repos", "events_url": "https://api.github.com/users/Jaic1/events{/privacy}", "received_events_url": "https://api.github.com/users/Jaic1/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6206086dd5a83477131094b1f0ef61b10e7ced42", "url": "https://api.github.com/repos/rust-lang/rust/commits/6206086dd5a83477131094b1f0ef61b10e7ced42", "html_url": "https://github.com/rust-lang/rust/commit/6206086dd5a83477131094b1f0ef61b10e7ced42"}], "stats": {"total": 30, "additions": 29, "deletions": 1}, "files": [{"sha": "af56ec11ef8acd741ec4a8a45926d8fd2656e36a", "filename": "clippy_lints/src/casts/unnecessary_cast.rs", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/ec851b870b59848bdbf531928a7cf38225d3a12e/clippy_lints%2Fsrc%2Fcasts%2Funnecessary_cast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ec851b870b59848bdbf531928a7cf38225d3a12e/clippy_lints%2Fsrc%2Fcasts%2Funnecessary_cast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fcasts%2Funnecessary_cast.rs?ref=ec851b870b59848bdbf531928a7cf38225d3a12e", "patch": "@@ -4,7 +4,8 @@ use clippy_utils::source::snippet_opt;\n use if_chain::if_chain;\n use rustc_ast::{LitFloatType, LitIntType, LitKind};\n use rustc_errors::Applicability;\n-use rustc_hir::{Expr, ExprKind, Lit, UnOp};\n+use rustc_hir::def::Res;\n+use rustc_hir::{Expr, ExprKind, Lit, QPath, TyKind, UnOp};\n use rustc_lint::{LateContext, LintContext};\n use rustc_middle::lint::in_external_macro;\n use rustc_middle::ty::{self, FloatTy, InferTy, Ty};\n@@ -18,6 +19,17 @@ pub(super) fn check(\n     cast_from: Ty<'_>,\n     cast_to: Ty<'_>,\n ) -> bool {\n+    // skip non-primitive type cast\n+    if_chain! {\n+        if let ExprKind::Cast(_, cast_to) = expr.kind;\n+        if let TyKind::Path(QPath::Resolved(_, path)) = &cast_to.kind;\n+        if let Res::PrimTy(_) = path.res;\n+        then {}\n+        else {\n+            return false\n+        }\n+    }\n+\n     if let Some(lit) = get_numeric_literal(cast_expr) {\n         let literal_str = snippet_opt(cx, cast_expr.span).unwrap_or_default();\n "}, {"sha": "62c3e9636866a5a67492f339ca706b97aea73c31", "filename": "tests/ui/unnecessary_cast.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/ec851b870b59848bdbf531928a7cf38225d3a12e/tests%2Fui%2Funnecessary_cast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ec851b870b59848bdbf531928a7cf38225d3a12e/tests%2Fui%2Funnecessary_cast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funnecessary_cast.rs?ref=ec851b870b59848bdbf531928a7cf38225d3a12e", "patch": "@@ -30,4 +30,10 @@ fn main() {\n \n     // do not lint cast to cfg-dependant type\n     1 as std::os::raw::c_char;\n+\n+    // do not lint cast to alias type\n+    1 as I32Alias;\n+    &1 as &I32Alias;\n }\n+\n+type I32Alias = i32;"}, {"sha": "36800c5340db21d665070b288040e00958bd612a", "filename": "tests/ui/unnecessary_cast_fixable.fixed", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ec851b870b59848bdbf531928a7cf38225d3a12e/tests%2Fui%2Funnecessary_cast_fixable.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/ec851b870b59848bdbf531928a7cf38225d3a12e/tests%2Fui%2Funnecessary_cast_fixable.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funnecessary_cast_fixable.fixed?ref=ec851b870b59848bdbf531928a7cf38225d3a12e", "patch": "@@ -42,4 +42,9 @@ fn main() {\n \n     let _ = -1_i32;\n     let _ = -1.0_f32;\n+\n+    let _ = 1 as I32Alias;\n+    let _ = &1 as &I32Alias;\n }\n+\n+type I32Alias = i32;"}, {"sha": "d4b6bb952ab3508261198212ba394d20b5cd3d4c", "filename": "tests/ui/unnecessary_cast_fixable.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/ec851b870b59848bdbf531928a7cf38225d3a12e/tests%2Fui%2Funnecessary_cast_fixable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ec851b870b59848bdbf531928a7cf38225d3a12e/tests%2Fui%2Funnecessary_cast_fixable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funnecessary_cast_fixable.rs?ref=ec851b870b59848bdbf531928a7cf38225d3a12e", "patch": "@@ -42,4 +42,9 @@ fn main() {\n \n     let _ = -1 as i32;\n     let _ = -1.0 as f32;\n+\n+    let _ = 1 as I32Alias;\n+    let _ = &1 as &I32Alias;\n }\n+\n+type I32Alias = i32;"}]}