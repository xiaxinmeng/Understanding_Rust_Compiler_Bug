{"sha": "0be8537e236f811a0eb722a8fa097313808f26f0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBiZTg1MzdlMjM2ZjgxMWEwZWI3MjJhOGZhMDk3MzEzODA4ZjI2ZjA=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2018-12-06T06:48:55Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-12-06T06:48:55Z"}, "message": "Rollup merge of #56441 - ollie27:rustbuild_compiler_docs, r=alexcrichton\n\nrustbuild: Fix issues with compiler docs\n\n* Create output directories for crates beforehand so rustdoc uses relative links (fixes #56107)\n* Readd rustc_codegen_ssa (fixes #56196)\n* Don't build out of tree dependencies for rustdoc like we don't for rustc", "tree": {"sha": "8a8b28675bbca6aa36f38d579c92c08c4faf365a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8a8b28675bbca6aa36f38d579c92c08c4faf365a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0be8537e236f811a0eb722a8fa097313808f26f0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcCMZXCRBK7hj4Ov3rIwAAdHIIAHr6hJO9zzSiUV2MhWFPCXcp\nZbMnT5hTocrr1ZR92qt3i0YN719YOg3WSYKv2H7tOHIJMPTY+INkJYQWeGa/GRNL\n/rP6hus73+3chZCGrjZpcZznrX/qdW2MwBOgcXbOC2eBm9W9jgI3GBqWD5R8tBla\nIwT8CF6lz4xvzooZ2Lyb5B2lXuv4A/PrwklzbGA7qzW06U8LwlE7Uxq2B1Dhyf23\n0Vh0iB1z34ypLPkFELCqeozh+dPKHDOrOEq2w6bEOSa0vkvQcPkPsxgYXphLFHih\ntdXXJnTlenoI2jSqdMOaepUtzl71G8kVzr1UKYVlHHkramEfZQE4AJLf16Yfki8=\n=ounZ\n-----END PGP SIGNATURE-----\n", "payload": "tree 8a8b28675bbca6aa36f38d579c92c08c4faf365a\nparent 0aa72ad55de5b431e04e26316358a629574bf79f\nparent 3b705a0ece15843e6deef6833025f8548f4348c5\nauthor Pietro Albini <pietro@pietroalbini.org> 1544078935 +0100\ncommitter GitHub <noreply@github.com> 1544078935 +0100\n\nRollup merge of #56441 - ollie27:rustbuild_compiler_docs, r=alexcrichton\n\nrustbuild: Fix issues with compiler docs\n\n* Create output directories for crates beforehand so rustdoc uses relative links (fixes #56107)\n* Readd rustc_codegen_ssa (fixes #56196)\n* Don't build out of tree dependencies for rustdoc like we don't for rustc\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0be8537e236f811a0eb722a8fa097313808f26f0", "html_url": "https://github.com/rust-lang/rust/commit/0be8537e236f811a0eb722a8fa097313808f26f0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0be8537e236f811a0eb722a8fa097313808f26f0/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0aa72ad55de5b431e04e26316358a629574bf79f", "url": "https://api.github.com/repos/rust-lang/rust/commits/0aa72ad55de5b431e04e26316358a629574bf79f", "html_url": "https://github.com/rust-lang/rust/commit/0aa72ad55de5b431e04e26316358a629574bf79f"}, {"sha": "3b705a0ece15843e6deef6833025f8548f4348c5", "url": "https://api.github.com/repos/rust-lang/rust/commits/3b705a0ece15843e6deef6833025f8548f4348c5", "html_url": "https://github.com/rust-lang/rust/commit/3b705a0ece15843e6deef6833025f8548f4348c5"}], "stats": {"total": 17, "additions": 11, "deletions": 6}, "files": [{"sha": "e9c27a3f3cf31f9fec8835fbcc2489ee05ea8efe", "filename": "src/bootstrap/doc.rs", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/0be8537e236f811a0eb722a8fa097313808f26f0/src%2Fbootstrap%2Fdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0be8537e236f811a0eb722a8fa097313808f26f0/src%2Fbootstrap%2Fdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdoc.rs?ref=0be8537e236f811a0eb722a8fa097313808f26f0", "patch": "@@ -697,9 +697,6 @@ impl Step for Rustc {\n             return;\n         }\n \n-        // Build libstd docs so that we generate relative links.\n-        builder.ensure(Std { stage, target });\n-\n         // Build rustc.\n         builder.ensure(compile::Rustc { compiler, target });\n \n@@ -718,12 +715,16 @@ impl Step for Rustc {\n \n         // Find dependencies for top level crates.\n         let mut compiler_crates = HashSet::new();\n-        for root_crate in &[\"rustc\", \"rustc_driver\", \"rustc_codegen_llvm\"] {\n+        for root_crate in &[\"rustc_driver\", \"rustc_codegen_llvm\", \"rustc_codegen_ssa\"] {\n             let interned_root_crate = INTERNER.intern_str(root_crate);\n             find_compiler_crates(builder, &interned_root_crate, &mut compiler_crates);\n         }\n \n         for krate in &compiler_crates {\n+            // Create all crate output directories first to make sure rustdoc uses\n+            // relative links.\n+            // FIXME: Cargo should probably do this itself.\n+            t!(fs::create_dir_all(out_dir.join(krate)));\n             cargo.arg(\"-p\").arg(krate);\n         }\n \n@@ -797,8 +798,8 @@ impl Step for Rustdoc {\n             return;\n         }\n \n-        // Build libstd docs so that we generate relative links.\n-        builder.ensure(Std { stage, target });\n+        // Build rustc docs so that we generate relative links.\n+        builder.ensure(Rustc { stage, target });\n \n         // Build rustdoc.\n         builder.ensure(tool::Rustdoc { host: compiler.host });\n@@ -822,6 +823,10 @@ impl Step for Rustdoc {\n             &[]\n         );\n \n+        // Only include compiler crates, no dependencies of those, such as `libc`.\n+        cargo.arg(\"--no-deps\");\n+        cargo.arg(\"-p\").arg(\"rustdoc\");\n+\n         cargo.env(\"RUSTDOCFLAGS\", \"--document-private-items\");\n         builder.run(&mut cargo);\n     }"}]}