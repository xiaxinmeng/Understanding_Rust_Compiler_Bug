{"sha": "77627ea8dd3b310d02138647363e72fdd024bb6c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc3NjI3ZWE4ZGQzYjMxMGQwMjEzODY0NzM2M2U3MmZkZDAyNGJiNmM=", "commit": {"author": {"name": "Christopher Chambers", "email": "chris.chambers@peanutcode.com", "date": "2015-04-11T05:59:00Z"}, "committer": {"name": "Christopher Chambers", "email": "chris.chambers@peanutcode.com", "date": "2015-04-11T05:59:00Z"}, "message": "Moves expand_stmt's bt_pop so that it balances correctly.", "tree": {"sha": "599c1164a10414e2c4fbcd8e53bfeccd44743a66", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/599c1164a10414e2c4fbcd8e53bfeccd44743a66"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/77627ea8dd3b310d02138647363e72fdd024bb6c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/77627ea8dd3b310d02138647363e72fdd024bb6c", "html_url": "https://github.com/rust-lang/rust/commit/77627ea8dd3b310d02138647363e72fdd024bb6c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/77627ea8dd3b310d02138647363e72fdd024bb6c/comments", "author": {"login": "chris-chambers", "id": 6810256, "node_id": "MDQ6VXNlcjY4MTAyNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/6810256?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chris-chambers", "html_url": "https://github.com/chris-chambers", "followers_url": "https://api.github.com/users/chris-chambers/followers", "following_url": "https://api.github.com/users/chris-chambers/following{/other_user}", "gists_url": "https://api.github.com/users/chris-chambers/gists{/gist_id}", "starred_url": "https://api.github.com/users/chris-chambers/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chris-chambers/subscriptions", "organizations_url": "https://api.github.com/users/chris-chambers/orgs", "repos_url": "https://api.github.com/users/chris-chambers/repos", "events_url": "https://api.github.com/users/chris-chambers/events{/privacy}", "received_events_url": "https://api.github.com/users/chris-chambers/received_events", "type": "User", "site_admin": false}, "committer": {"login": "chris-chambers", "id": 6810256, "node_id": "MDQ6VXNlcjY4MTAyNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/6810256?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chris-chambers", "html_url": "https://github.com/chris-chambers", "followers_url": "https://api.github.com/users/chris-chambers/followers", "following_url": "https://api.github.com/users/chris-chambers/following{/other_user}", "gists_url": "https://api.github.com/users/chris-chambers/gists{/gist_id}", "starred_url": "https://api.github.com/users/chris-chambers/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chris-chambers/subscriptions", "organizations_url": "https://api.github.com/users/chris-chambers/orgs", "repos_url": "https://api.github.com/users/chris-chambers/repos", "events_url": "https://api.github.com/users/chris-chambers/events{/privacy}", "received_events_url": "https://api.github.com/users/chris-chambers/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "22eb3193a62fa01e97bf53d5f5aa74ca8ea57a67", "url": "https://api.github.com/repos/rust-lang/rust/commits/22eb3193a62fa01e97bf53d5f5aa74ca8ea57a67", "html_url": "https://github.com/rust-lang/rust/commit/22eb3193a62fa01e97bf53d5f5aa74ca8ea57a67"}], "stats": {"total": 7, "additions": 4, "deletions": 3}, "files": [{"sha": "8aa6acaeec2c33838aeadff80fdd36982669539a", "filename": "src/libsyntax/ext/expand.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/77627ea8dd3b310d02138647363e72fdd024bb6c/src%2Flibsyntax%2Fext%2Fexpand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/77627ea8dd3b310d02138647363e72fdd024bb6c/src%2Flibsyntax%2Fext%2Fexpand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fexpand.rs?ref=77627ea8dd3b310d02138647363e72fdd024bb6c", "patch": "@@ -761,13 +761,14 @@ fn expand_stmt(stmt: P<Stmt>, fld: &mut MacroExpander) -> SmallVector<P<Stmt>> {\n     let mut fully_expanded = match maybe_new_items {\n         Some(stmts) => {\n             // Keep going, outside-in.\n-            stmts.into_iter().flat_map(|s| {\n+            let new_items = stmts.into_iter().flat_map(|s| {\n                 fld.fold_stmt(s).into_iter()\n-            }).collect()\n+            }).collect();\n+            fld.cx.bt_pop();\n+            new_items\n         }\n         None => SmallVector::zero()\n     };\n-    fld.cx.bt_pop();\n \n     // If this is a macro invocation with a semicolon, then apply that\n     // semicolon to the final statement produced by expansion."}]}