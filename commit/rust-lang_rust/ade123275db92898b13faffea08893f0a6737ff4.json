{"sha": "ade123275db92898b13faffea08893f0a6737ff4", "node_id": "C_kwDOAAsO6NoAKGFkZTEyMzI3NWRiOTI4OThiMTNmYWZmZWEwODg5M2YwYTY3MzdmZjQ", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2022-05-05T01:20:38Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-05-05T01:20:38Z"}, "message": "Rollup merge of #96697 - oli-obk:trace_queries, r=michaelwoerister\n\nEnable tracing for all queries\n\nThis allows you to log everything within a specific query, e.g.\n\n```\nenv RUSTC_LOG=[mir_borrowck]\n```\n\ndumping all borrowck queries may be a bit verbose, so you can also restrict it to just an item of your choice:\n\n```\nenv RUSTC_LOG=[mir_borrowck{key=\\.\\*name_of_item\\.\\*}]\n```\n\nthe regex `.*` in the key name are because the key is a debug printed DefId, so you'd get all kinds of things like hashes in there. The tracing logs will show you the key, so you can restrict it further if you want.", "tree": {"sha": "9b18b5c05a5673bf00548c5b7e9d011fbaa39f4f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9b18b5c05a5673bf00548c5b7e9d011fbaa39f4f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ade123275db92898b13faffea08893f0a6737ff4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJicyZmCRBK7hj4Ov3rIwAAp24IAAIX2Tdxj/hhEbf74fT47n92\nH29uUIUK0WJgc29JCMJbrAQRZyZ0iv45AcDUjvVEaAf90XaIbHd0iy02Yd5QUBBQ\nlcflY6LWcFbbdSo96FUNF9Rubb+kZuz4Jlg3KM5ZCKiSXuEpIwJYRpF2gYJsu8go\n3XjCiNAXhSA6JFtw1sJ6LgIKmBe0CJgzQZFU4AYOMBBAXjFhkXSKmUuE1AhKyf1u\nJMKssjzX0iS7VL5hQ/sYT0bJEM3qpiUBAk41+99yq5fdxPkkGBftPnjCL5YxFeM+\nZ5cr/UxgUkgoXWupoPcBdzImEoNktpRM7AGT0H8+ejnPJzj9uuASoYps+FVeqko=\n=CA/l\n-----END PGP SIGNATURE-----\n", "payload": "tree 9b18b5c05a5673bf00548c5b7e9d011fbaa39f4f\nparent e3ada27d7d95cdc4e3c05b91c2cf404546c2d7fd\nparent 0d5a738b8b715024c25c4ad973399f2e81b7577b\nauthor Yuki Okushi <jtitor@2k36.org> 1651713638 +0900\ncommitter GitHub <noreply@github.com> 1651713638 +0900\n\nRollup merge of #96697 - oli-obk:trace_queries, r=michaelwoerister\n\nEnable tracing for all queries\n\nThis allows you to log everything within a specific query, e.g.\n\n```\nenv RUSTC_LOG=[mir_borrowck]\n```\n\ndumping all borrowck queries may be a bit verbose, so you can also restrict it to just an item of your choice:\n\n```\nenv RUSTC_LOG=[mir_borrowck{key=\\.\\*name_of_item\\.\\*}]\n```\n\nthe regex `.*` in the key name are because the key is a debug printed DefId, so you'd get all kinds of things like hashes in there. The tracing logs will show you the key, so you can restrict it further if you want.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ade123275db92898b13faffea08893f0a6737ff4", "html_url": "https://github.com/rust-lang/rust/commit/ade123275db92898b13faffea08893f0a6737ff4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ade123275db92898b13faffea08893f0a6737ff4/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e3ada27d7d95cdc4e3c05b91c2cf404546c2d7fd", "url": "https://api.github.com/repos/rust-lang/rust/commits/e3ada27d7d95cdc4e3c05b91c2cf404546c2d7fd", "html_url": "https://github.com/rust-lang/rust/commit/e3ada27d7d95cdc4e3c05b91c2cf404546c2d7fd"}, {"sha": "0d5a738b8b715024c25c4ad973399f2e81b7577b", "url": "https://api.github.com/repos/rust-lang/rust/commits/0d5a738b8b715024c25c4ad973399f2e81b7577b", "html_url": "https://github.com/rust-lang/rust/commit/0d5a738b8b715024c25c4ad973399f2e81b7577b"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "417f3300f0b21c405e3d9cc375ce7ec65d9ef4ba", "filename": "Cargo.lock", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ade123275db92898b13faffea08893f0a6737ff4/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/ade123275db92898b13faffea08893f0a6737ff4/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=ade123275db92898b13faffea08893f0a6737ff4", "patch": "@@ -4245,6 +4245,7 @@ dependencies = [\n  \"rustc_serialize\",\n  \"rustc_session\",\n  \"rustc_span\",\n+ \"tracing\",\n ]\n \n [[package]]"}, {"sha": "fa05434e48b1b7eb021e1296c3de7c9f80db9e36", "filename": "compiler/rustc_query_impl/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ade123275db92898b13faffea08893f0a6737ff4/compiler%2Frustc_query_impl%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/ade123275db92898b13faffea08893f0a6737ff4/compiler%2Frustc_query_impl%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_impl%2FCargo.toml?ref=ade123275db92898b13faffea08893f0a6737ff4", "patch": "@@ -20,6 +20,7 @@ rustc_query_system = { path = \"../rustc_query_system\" }\n rustc_serialize = { path = \"../rustc_serialize\" }\n rustc_session = { path = \"../rustc_session\" }\n rustc_span = { path = \"../rustc_span\" }\n+tracing = \"0.1\"\n \n [features]\n rustc_use_parallel_compiler = [\"rustc-rayon-core\", \"rustc_query_system/rustc_use_parallel_compiler\"]"}, {"sha": "ae4ad42815966476f05c10e6687ce637fe571ad5", "filename": "compiler/rustc_query_impl/src/plumbing.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/ade123275db92898b13faffea08893f0a6737ff4/compiler%2Frustc_query_impl%2Fsrc%2Fplumbing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ade123275db92898b13faffea08893f0a6737ff4/compiler%2Frustc_query_impl%2Fsrc%2Fplumbing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_impl%2Fsrc%2Fplumbing.rs?ref=ade123275db92898b13faffea08893f0a6737ff4", "patch": "@@ -435,6 +435,8 @@ macro_rules! define_queries {\n \n                 fn force_from_dep_node(tcx: TyCtxt<'_>, dep_node: DepNode) -> bool {\n                     if let Some(key) = recover(tcx, dep_node) {\n+                        #[cfg(debug_assertions)]\n+                        let _guard = tracing::span!(tracing::Level::TRACE, stringify!($name), ?key).entered();\n                         let tcx = QueryCtxt::from_tcx(tcx);\n                         force_query::<queries::$name<'_>, _>(tcx, key, dep_node);\n                         true\n@@ -532,6 +534,7 @@ macro_rules! define_queries_struct {\n \n             $($(#[$attr])*\n             #[inline(always)]\n+            #[tracing::instrument(level = \"trace\", skip(self, tcx))]\n             fn $name(\n                 &'tcx self,\n                 tcx: TyCtxt<$tcx>,"}, {"sha": "3498df95196e55b14c0e12ea7d94eae48bfa3f7e", "filename": "compiler/rustc_query_system/src/query/plumbing.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ade123275db92898b13faffea08893f0a6737ff4/compiler%2Frustc_query_system%2Fsrc%2Fquery%2Fplumbing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ade123275db92898b13faffea08893f0a6737ff4/compiler%2Frustc_query_system%2Fsrc%2Fquery%2Fplumbing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_system%2Fsrc%2Fquery%2Fplumbing.rs?ref=ade123275db92898b13faffea08893f0a6737ff4", "patch": "@@ -675,6 +675,7 @@ where\n     }\n }\n \n+#[derive(Debug)]\n pub enum QueryMode {\n     Get,\n     Ensure,\n@@ -697,7 +698,6 @@ where\n         None\n     };\n \n-    debug!(\"ty::query::get_query<{}>(key={:?}, span={:?})\", Q::NAME, key, span);\n     let (result, dep_node_index) = try_execute_query(\n         tcx,\n         Q::query_state(tcx),"}]}