{"sha": "3652ea4594918d5f4c7e7a073d3e3105c726d1ef", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM2NTJlYTQ1OTQ5MThkNWY0YzdlN2EwNzNkM2UzMTA1YzcyNmQxZWY=", "commit": {"author": {"name": "Eduard-Mihai Burtescu", "email": "edy.burt@gmail.com", "date": "2019-05-30T00:56:45Z"}, "committer": {"name": "Eduard-Mihai Burtescu", "email": "edy.burt@gmail.com", "date": "2019-05-31T16:24:15Z"}, "message": "test: add a more complex symbol-name testcase.", "tree": {"sha": "7a889764e3c41a49003821316ddbbb3e69e04bfa", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7a889764e3c41a49003821316ddbbb3e69e04bfa"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3652ea4594918d5f4c7e7a073d3e3105c726d1ef", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3652ea4594918d5f4c7e7a073d3e3105c726d1ef", "html_url": "https://github.com/rust-lang/rust/commit/3652ea4594918d5f4c7e7a073d3e3105c726d1ef", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3652ea4594918d5f4c7e7a073d3e3105c726d1ef/comments", "author": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9cf35bfbe7b2610ff64c41668403fdb8f36c839c", "url": "https://api.github.com/repos/rust-lang/rust/commits/9cf35bfbe7b2610ff64c41668403fdb8f36c839c", "html_url": "https://github.com/rust-lang/rust/commit/9cf35bfbe7b2610ff64c41668403fdb8f36c839c"}], "stats": {"total": 117, "additions": 98, "deletions": 19}, "files": [{"sha": "c1d22a919d9004197ec5208d08f15b6935cc6091", "filename": "src/test/ui/symbol-names/impl1.legacy.stderr", "status": "modified", "additions": 33, "deletions": 9, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/3652ea4594918d5f4c7e7a073d3e3105c726d1ef/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.legacy.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3652ea4594918d5f4c7e7a073d3e3105c726d1ef/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.legacy.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.legacy.stderr?ref=3652ea4594918d5f4c7e7a073d3e3105c726d1ef", "patch": "@@ -1,50 +1,74 @@\n error: symbol-name(_ZN5impl13foo3Foo3bar17he53b9bee7600ed8dE)\n-  --> $DIR/impl1.rs:12:9\n+  --> $DIR/impl1.rs:13:9\n    |\n LL |         #[rustc_symbol_name]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n error: demangling(impl1::foo::Foo::bar::he53b9bee7600ed8d)\n-  --> $DIR/impl1.rs:12:9\n+  --> $DIR/impl1.rs:13:9\n    |\n LL |         #[rustc_symbol_name]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n error: demangling-alt(impl1::foo::Foo::bar)\n-  --> $DIR/impl1.rs:12:9\n+  --> $DIR/impl1.rs:13:9\n    |\n LL |         #[rustc_symbol_name]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n error: def-path(foo::Foo::bar)\n-  --> $DIR/impl1.rs:19:9\n+  --> $DIR/impl1.rs:20:9\n    |\n LL |         #[rustc_def_path]\n    |         ^^^^^^^^^^^^^^^^^\n \n error: symbol-name(_ZN5impl13bar33_$LT$impl$u20$impl1..foo..Foo$GT$3baz17h86c41f0462d901d4E)\n-  --> $DIR/impl1.rs:30:9\n+  --> $DIR/impl1.rs:31:9\n    |\n LL |         #[rustc_symbol_name]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n error: demangling(impl1::bar::<impl impl1::foo::Foo>::baz::h86c41f0462d901d4)\n-  --> $DIR/impl1.rs:30:9\n+  --> $DIR/impl1.rs:31:9\n    |\n LL |         #[rustc_symbol_name]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n error: demangling-alt(impl1::bar::<impl impl1::foo::Foo>::baz)\n-  --> $DIR/impl1.rs:30:9\n+  --> $DIR/impl1.rs:31:9\n    |\n LL |         #[rustc_symbol_name]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n error: def-path(bar::<impl foo::Foo>::baz)\n-  --> $DIR/impl1.rs:37:9\n+  --> $DIR/impl1.rs:38:9\n    |\n LL |         #[rustc_def_path]\n    |         ^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 8 previous errors\n+error: symbol-name(_ZN198_$LT$$u5b$$RF$dyn$u20$impl1..Foo$u2b$Assoc$u20$$u3d$$u20$extern$u20$$u22$C$u22$$u20$fn$LP$$RF$u8$RP$$u2b$impl1..AutoTrait$u3b$$u20$_$u5d$$u20$as$u20$impl1..main..$u7b$$u7b$closure$u7d$$u7d$..Bar$GT$6method17h6f205aef6a8ccc7bE)\n+  --> $DIR/impl1.rs:63:13\n+   |\n+LL |             #[rustc_symbol_name]\n+   |             ^^^^^^^^^^^^^^^^^^^^\n+\n+error: demangling(<[&dyn impl1::Foo+Assoc = extern \"C\" fn(&u8)+impl1::AutoTrait; _] as impl1::main::{{closure}}::Bar>::method::h6f205aef6a8ccc7b)\n+  --> $DIR/impl1.rs:63:13\n+   |\n+LL |             #[rustc_symbol_name]\n+   |             ^^^^^^^^^^^^^^^^^^^^\n+\n+error: demangling-alt(<[&dyn impl1::Foo+Assoc = extern \"C\" fn(&u8)+impl1::AutoTrait; _] as impl1::main::{{closure}}::Bar>::method)\n+  --> $DIR/impl1.rs:63:13\n+   |\n+LL |             #[rustc_symbol_name]\n+   |             ^^^^^^^^^^^^^^^^^^^^\n+\n+error: def-path(<[&dyn Foo<Assoc = for<'r> extern \"C\" fn(&'r u8)> + AutoTrait; _] as main::{{closure}}#1::Bar>::method)\n+  --> $DIR/impl1.rs:70:13\n+   |\n+LL |             #[rustc_def_path]\n+   |             ^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 12 previous errors\n "}, {"sha": "9ed93bb98185a5dad2209dee6a48ab1607495293", "filename": "src/test/ui/symbol-names/impl1.rs", "status": "modified", "additions": 32, "deletions": 1, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/3652ea4594918d5f4c7e7a073d3e3105c726d1ef/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3652ea4594918d5f4c7e7a073d3e3105c726d1ef/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.rs?ref=3652ea4594918d5f4c7e7a073d3e3105c726d1ef", "patch": "@@ -1,8 +1,9 @@\n+// ignore-tidy-linelength\n // revisions: legacy v0\n //[legacy]compile-flags: -Z symbol-mangling-version=legacy\n     //[v0]compile-flags: -Z symbol-mangling-version=v0\n \n-#![feature(rustc_attrs)]\n+#![feature(optin_builtin_traits, rustc_attrs)]\n #![allow(dead_code)]\n \n mod foo {\n@@ -41,5 +42,35 @@ mod bar {\n     }\n }\n \n+trait Foo {\n+    type Assoc;\n+}\n+\n+auto trait AutoTrait {}\n+\n fn main() {\n+    // Test closure mangling, and disambiguators.\n+    || {};\n+    || {\n+        trait Bar {\n+            fn method(&self) {}\n+        }\n+\n+        // Test type mangling, by putting them in an `impl` header.\n+        // FIXME(eddyb) test C varargs when `core::ffi::VaList` stops leaking into the signature\n+        // (which is a problem because `core` has an unpredictable hash) - see also #44930.\n+        impl Bar for [&'_ (dyn Foo<Assoc = extern fn(&u8, /*...*/)> + AutoTrait); 3] {\n+            #[rustc_symbol_name]\n+            //[legacy]~^ ERROR symbol-name(_ZN198_$LT$$u5b$$RF$dyn$u20$impl1..Foo$u2b$Assoc$u20$$u3d$$u20$extern$u20$$u22$C$u22$$u20$fn$LP$$RF$u8$RP$$u2b$impl1..AutoTrait$u3b$$u20$_$u5d$$u20$as$u20$impl1..main..$u7b$$u7b$closure$u7d$$u7d$..Bar$GT$6method\n+            //[legacy]~| ERROR demangling(<[&dyn impl1::Foo+Assoc = extern \"C\" fn(&u8)+impl1::AutoTrait; _] as impl1::main::{{closure}}::Bar>::method\n+            //[legacy]~| ERROR demangling-alt(<[&dyn impl1::Foo+Assoc = extern \"C\" fn(&u8)+impl1::AutoTrait; _] as impl1::main::{{closure}}::Bar>::method)\n+             //[v0]~^^^^ ERROR symbol-name(_RNvXNCNvCs4fqI2P2rA04_5impl14mains_0ARDNtB6_3Foop5AssocFG0_KCRL0_hEuNtB6_9AutoTraitEL_j3_NtB2_3Bar6method)\n+                //[v0]~| ERROR demangling(<[&dyn impl1[317d481089b8c8fe]::Foo<Assoc = for<'a, 'b> extern \"C\" fn(&'b u8)> + impl1[317d481089b8c8fe]::AutoTrait; 3: usize] as impl1[317d481089b8c8fe]::main::{closure#1}::Bar>::method)\n+                //[v0]~| ERROR demangling-alt(<[&dyn impl1::Foo<Assoc = for<'a, 'b> extern \"C\" fn(&'b u8)> + impl1::AutoTrait; 3] as impl1::main::{closure#1}::Bar>::method)\n+            #[rustc_def_path]\n+            //[legacy]~^ ERROR def-path(<[&dyn Foo<Assoc = for<'r> extern \"C\" fn(&'r u8)> + AutoTrait; _] as main::{{closure}}#1::Bar>::method)\n+               //[v0]~^^ ERROR def-path(<[&dyn Foo<Assoc = for<'r> extern \"C\" fn(&'r u8)> + AutoTrait; _] as main::{{closure}}#1::Bar>::method)\n+            fn method(&self) {}\n+        }\n+    };\n }"}, {"sha": "1c4b256c9e9339412a14776fe81dbded2f697485", "filename": "src/test/ui/symbol-names/impl1.v0.stderr", "status": "modified", "additions": 33, "deletions": 9, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/3652ea4594918d5f4c7e7a073d3e3105c726d1ef/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.v0.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3652ea4594918d5f4c7e7a073d3e3105c726d1ef/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.v0.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fimpl1.v0.stderr?ref=3652ea4594918d5f4c7e7a073d3e3105c726d1ef", "patch": "@@ -1,50 +1,74 @@\n error: symbol-name(_RNvMNtCs4fqI2P2rA04_5impl13fooNtB2_3Foo3bar)\n-  --> $DIR/impl1.rs:12:9\n+  --> $DIR/impl1.rs:13:9\n    |\n LL |         #[rustc_symbol_name]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n error: demangling(<impl1[317d481089b8c8fe]::foo::Foo>::bar)\n-  --> $DIR/impl1.rs:12:9\n+  --> $DIR/impl1.rs:13:9\n    |\n LL |         #[rustc_symbol_name]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n error: demangling-alt(<impl1::foo::Foo>::bar)\n-  --> $DIR/impl1.rs:12:9\n+  --> $DIR/impl1.rs:13:9\n    |\n LL |         #[rustc_symbol_name]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n error: def-path(foo::Foo::bar)\n-  --> $DIR/impl1.rs:19:9\n+  --> $DIR/impl1.rs:20:9\n    |\n LL |         #[rustc_def_path]\n    |         ^^^^^^^^^^^^^^^^^\n \n error: symbol-name(_RNvMNtCs4fqI2P2rA04_5impl13barNtNtB4_3foo3Foo3baz)\n-  --> $DIR/impl1.rs:30:9\n+  --> $DIR/impl1.rs:31:9\n    |\n LL |         #[rustc_symbol_name]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n error: demangling(<impl1[317d481089b8c8fe]::foo::Foo>::baz)\n-  --> $DIR/impl1.rs:30:9\n+  --> $DIR/impl1.rs:31:9\n    |\n LL |         #[rustc_symbol_name]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n error: demangling-alt(<impl1::foo::Foo>::baz)\n-  --> $DIR/impl1.rs:30:9\n+  --> $DIR/impl1.rs:31:9\n    |\n LL |         #[rustc_symbol_name]\n    |         ^^^^^^^^^^^^^^^^^^^^\n \n error: def-path(bar::<impl foo::Foo>::baz)\n-  --> $DIR/impl1.rs:37:9\n+  --> $DIR/impl1.rs:38:9\n    |\n LL |         #[rustc_def_path]\n    |         ^^^^^^^^^^^^^^^^^\n \n-error: aborting due to 8 previous errors\n+error: symbol-name(_RNvXNCNvCs4fqI2P2rA04_5impl14mains_0ARDNtB6_3Foop5AssocFG0_KCRL0_hEuNtB6_9AutoTraitEL_j3_NtB2_3Bar6method)\n+  --> $DIR/impl1.rs:63:13\n+   |\n+LL |             #[rustc_symbol_name]\n+   |             ^^^^^^^^^^^^^^^^^^^^\n+\n+error: demangling(<[&dyn impl1[317d481089b8c8fe]::Foo<Assoc = for<'a, 'b> extern \"C\" fn(&'b u8)> + impl1[317d481089b8c8fe]::AutoTrait; 3: usize] as impl1[317d481089b8c8fe]::main::{closure#1}::Bar>::method)\n+  --> $DIR/impl1.rs:63:13\n+   |\n+LL |             #[rustc_symbol_name]\n+   |             ^^^^^^^^^^^^^^^^^^^^\n+\n+error: demangling-alt(<[&dyn impl1::Foo<Assoc = for<'a, 'b> extern \"C\" fn(&'b u8)> + impl1::AutoTrait; 3] as impl1::main::{closure#1}::Bar>::method)\n+  --> $DIR/impl1.rs:63:13\n+   |\n+LL |             #[rustc_symbol_name]\n+   |             ^^^^^^^^^^^^^^^^^^^^\n+\n+error: def-path(<[&dyn Foo<Assoc = for<'r> extern \"C\" fn(&'r u8)> + AutoTrait; _] as main::{{closure}}#1::Bar>::method)\n+  --> $DIR/impl1.rs:70:13\n+   |\n+LL |             #[rustc_def_path]\n+   |             ^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to 12 previous errors\n "}]}