{"sha": "2d02772993ebeb06547ae18b8b07abe8706aff57", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJkMDI3NzI5OTNlYmViMDY1NDdhZTE4YjhiMDdhYmU4NzA2YWZmNTc=", "commit": {"author": {"name": "Havvy", "email": "ryan.havvy@gmail.com", "date": "2017-11-07T02:53:23Z"}, "committer": {"name": "Havvy", "email": "ryan.havvy@gmail.com", "date": "2017-11-07T02:53:23Z"}, "message": "Add RefCell<T>::replace_with", "tree": {"sha": "8cca2cb31e85132fea6ed527f055e24b353f4656", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8cca2cb31e85132fea6ed527f055e24b353f4656"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2d02772993ebeb06547ae18b8b07abe8706aff57", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2d02772993ebeb06547ae18b8b07abe8706aff57", "html_url": "https://github.com/rust-lang/rust/commit/2d02772993ebeb06547ae18b8b07abe8706aff57", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2d02772993ebeb06547ae18b8b07abe8706aff57/comments", "author": {"login": "Havvy", "id": 731722, "node_id": "MDQ6VXNlcjczMTcyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/731722?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Havvy", "html_url": "https://github.com/Havvy", "followers_url": "https://api.github.com/users/Havvy/followers", "following_url": "https://api.github.com/users/Havvy/following{/other_user}", "gists_url": "https://api.github.com/users/Havvy/gists{/gist_id}", "starred_url": "https://api.github.com/users/Havvy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Havvy/subscriptions", "organizations_url": "https://api.github.com/users/Havvy/orgs", "repos_url": "https://api.github.com/users/Havvy/repos", "events_url": "https://api.github.com/users/Havvy/events{/privacy}", "received_events_url": "https://api.github.com/users/Havvy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Havvy", "id": 731722, "node_id": "MDQ6VXNlcjczMTcyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/731722?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Havvy", "html_url": "https://github.com/Havvy", "followers_url": "https://api.github.com/users/Havvy/followers", "following_url": "https://api.github.com/users/Havvy/following{/other_user}", "gists_url": "https://api.github.com/users/Havvy/gists{/gist_id}", "starred_url": "https://api.github.com/users/Havvy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Havvy/subscriptions", "organizations_url": "https://api.github.com/users/Havvy/orgs", "repos_url": "https://api.github.com/users/Havvy/repos", "events_url": "https://api.github.com/users/Havvy/events{/privacy}", "received_events_url": "https://api.github.com/users/Havvy/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bd0e45a323f85a1940d997ac237023c00670da67", "url": "https://api.github.com/repos/rust-lang/rust/commits/bd0e45a323f85a1940d997ac237023c00670da67", "html_url": "https://github.com/rust-lang/rust/commit/bd0e45a323f85a1940d997ac237023c00670da67"}], "stats": {"total": 51, "additions": 38, "deletions": 13}, "files": [{"sha": "d02576ae54607cfae982812e7eb7c8b5a8bfbc18", "filename": "src/libcore/cell.rs", "status": "modified", "additions": 38, "deletions": 13, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/2d02772993ebeb06547ae18b8b07abe8706aff57/src%2Flibcore%2Fcell.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d02772993ebeb06547ae18b8b07abe8706aff57/src%2Flibcore%2Fcell.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fcell.rs?ref=2d02772993ebeb06547ae18b8b07abe8706aff57", "patch": "@@ -579,32 +579,62 @@ impl<T> RefCell<T> {\n     ///\n     /// This function corresponds to [`std::mem::replace`](../mem/fn.replace.html).\n     ///\n+    /// # Panics\n+    ///\n+    /// Panics if the value is currently borrowed.\n+    ///\n     /// # Examples\n     ///\n     /// ```\n     /// #![feature(refcell_replace_swap)]\n     /// use std::cell::RefCell;\n-    /// let c = RefCell::new(5);\n-    /// let u = c.replace(6);\n-    /// assert_eq!(u, 5);\n-    /// assert_eq!(c, RefCell::new(6));\n+    /// let cell = RefCell::new(5);\n+    /// let old_value = cell.replace(6);\n+    /// assert_eq!(old_value, 5);\n+    /// assert_eq!(cell, RefCell::new(6));\n     /// ```\n+    #[inline]\n+    #[unstable(feature = \"refcell_replace_swap\", issue=\"43570\")]\n+    pub fn replace(&self, t: T) -> T {\n+        mem::replace(&mut *self.borrow_mut(), t)\n+    }\n+\n+    /// Replaces the wrapped value with a new one computed from `f`, returning\n+    /// the old value, without deinitializing either one.\n+    ///\n+    /// This function corresponds to [`std::mem::replace`](../mem/fn.replace.html).\n     ///\n     /// # Panics\n     ///\n-    /// This function will panic if the `RefCell` has any outstanding borrows,\n-    /// whether or not they are full mutable borrows.\n+    /// Panics if the value is currently borrowed.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(refcell_replace_swap)]\n+    /// use std::cell::RefCell;\n+    /// let cell = RefCell::new(5);\n+    /// let old_value = cell.replace_with(|&mut old| old + 1);\n+    /// assert_eq!(old_value, 5);\n+    /// assert_eq!(cell, RefCell::new(6));\n+    /// ```\n     #[inline]\n     #[unstable(feature = \"refcell_replace_swap\", issue=\"43570\")]\n-    pub fn replace(&self, t: T) -> T {\n-        mem::replace(&mut *self.borrow_mut(), t)\n+    pub fn replace_with<F: FnOnce(&mut T) -> T>(&self, f: F) -> T {\n+        let mut_borrow = &mut *self.borrow_mut();\n+        let replacement = f(mut_borrow);\n+        mem::replace(mut_borrow, replacement)\n     }\n \n     /// Swaps the wrapped value of `self` with the wrapped value of `other`,\n     /// without deinitializing either one.\n     ///\n     /// This function corresponds to [`std::mem::swap`](../mem/fn.swap.html).\n     ///\n+    /// # Panics\n+    ///\n+    /// Panics if the value in either `RefCell` is currently borrowed.\n+    ///\n     /// # Examples\n     ///\n     /// ```\n@@ -616,11 +646,6 @@ impl<T> RefCell<T> {\n     /// assert_eq!(c, RefCell::new(6));\n     /// assert_eq!(d, RefCell::new(5));\n     /// ```\n-    ///\n-    /// # Panics\n-    ///\n-    /// This function will panic if either `RefCell` has any outstanding borrows,\n-    /// whether or not they are full mutable borrows.\n     #[inline]\n     #[unstable(feature = \"refcell_replace_swap\", issue=\"43570\")]\n     pub fn swap(&self, other: &Self) {"}]}