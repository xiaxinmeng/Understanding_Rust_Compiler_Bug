{"sha": "87ec5680c982e665e028cbec9219d7849a9535da", "node_id": "C_kwDOAAsO6NoAKDg3ZWM1NjgwYzk4MmU2NjVlMDI4Y2JlYzkyMTlkNzg0OWE5NTM1ZGE", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-11-03T05:36:30Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-11-03T05:36:30Z"}, "message": "Auto merge of #90421 - thomcc:friendship-ended-with-ssize_t-now-ptrdiff_t-is-my-best-friend, r=joshtriplett\n\nReplace `std::os::raw::c_ssize_t` with `std::os::raw::c_ptrdiff_t`\n\nThe discussions in #88345 brought up that `ssize_t` is not actually the signed index type defined in stddef.h, but instead it's `ptrdiff_t`. It seems pretty clear that the use of `ssize_t` here was a mistake on my part, and that if we're going to bother having a isize-alike for FFI in `std::os::raw`, it should be `ptrdiff_t` and not `ssize_t`.\n\nAnyway, both this and `c_size_t` are dubious in the face of the discussion in https://internals.rust-lang.org/t/pre-rfc-usize-is-not-size-t/15369, and any RFC/project-group/etc that handles those issues there should contend with these types in some manner, but that doesn't mean we shouldn't fix something wrong like this, even if it is unstable.\n\nAll that said, `size_t` is *vastly* more common in function signatures than either `ssize_t` or `ptrdiff_t`, so I'm going to update the tracking issue's list of unresolved questions to note that perhaps we only want `c_size_t` \u2014\u00a0I mostly added the signed version for symmetry, rather than to meet a need. (Given this, I'm also fine with modifying this patch to instead remove `c_ssize_t` without a replacement)\n\nCC `@magicant` (who brought the issue up)\nCC `@chorman0773` (who has a significantly firmer grasp on the minutae of the C standard than I do)\n\nr? `@joshtriplett` (original reviewer, active in the discussions around this)", "tree": {"sha": "888ebd87502af35c715d48ec5a52c42fa4b039b0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/888ebd87502af35c715d48ec5a52c42fa4b039b0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/87ec5680c982e665e028cbec9219d7849a9535da", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/87ec5680c982e665e028cbec9219d7849a9535da", "html_url": "https://github.com/rust-lang/rust/commit/87ec5680c982e665e028cbec9219d7849a9535da", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/87ec5680c982e665e028cbec9219d7849a9535da/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3802025f400af7817ba4874587e6a2df95abd65d", "url": "https://api.github.com/repos/rust-lang/rust/commits/3802025f400af7817ba4874587e6a2df95abd65d", "html_url": "https://github.com/rust-lang/rust/commit/3802025f400af7817ba4874587e6a2df95abd65d"}, {"sha": "8d19819781318c6ba24240af4b0038b692dd627f", "url": "https://api.github.com/repos/rust-lang/rust/commits/8d19819781318c6ba24240af4b0038b692dd627f", "html_url": "https://github.com/rust-lang/rust/commit/8d19819781318c6ba24240af4b0038b692dd627f"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "01392ffab79cac81f03288b789efce77ce064de4", "filename": "library/std/src/os/raw/mod.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/87ec5680c982e665e028cbec9219d7849a9535da/library%2Fstd%2Fsrc%2Fos%2Fraw%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87ec5680c982e665e028cbec9219d7849a9535da/library%2Fstd%2Fsrc%2Fos%2Fraw%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fos%2Fraw%2Fmod.rs?ref=87ec5680c982e665e028cbec9219d7849a9535da", "patch": "@@ -165,7 +165,14 @@ pub use core::ffi::c_void;\n #[unstable(feature = \"c_size_t\", issue = \"88345\")]\n pub type c_size_t = usize;\n \n-/// Equivalent to C's `ssize_t` type, from `stddef.h` (or `cstddef` for C++).\n+/// Equivalent to C's `ptrdiff_t` type, from `stddef.h` (or `cstddef` for C++).\n+///\n+/// This type is currently always [`isize`], however in the future there may be\n+/// platforms where this is not the case.\n+#[unstable(feature = \"c_size_t\", issue = \"88345\")]\n+pub type c_ptrdiff_t = isize;\n+\n+/// Equivalent to C's `ssize_t` (on POSIX) or `SSIZE_T` (on Windows) type.\n ///\n /// This type is currently always [`isize`], however in the future there may be\n /// platforms where this is not the case."}]}