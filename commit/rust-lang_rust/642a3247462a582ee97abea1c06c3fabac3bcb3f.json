{"sha": "642a3247462a582ee97abea1c06c3fabac3bcb3f", "node_id": "C_kwDOAAsO6NoAKDY0MmEzMjQ3NDYyYTU4MmVlOTdhYmVhMWMwNmMzZmFiYWMzYmNiM2Y", "commit": {"author": {"name": "joboet", "email": "jonasboettiger@icloud.com", "date": "2023-02-17T14:58:15Z"}, "committer": {"name": "joboet", "email": "jonasboettiger@icloud.com", "date": "2023-02-17T14:58:15Z"}, "message": "std: add regression test for #107466\n\nTests that messages are immediately dropped once the last receiver is destroyed.", "tree": {"sha": "055a43edbff511ae8f00bf8ac81227b4db197e30", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/055a43edbff511ae8f00bf8ac81227b4db197e30"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/642a3247462a582ee97abea1c06c3fabac3bcb3f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/642a3247462a582ee97abea1c06c3fabac3bcb3f", "html_url": "https://github.com/rust-lang/rust/commit/642a3247462a582ee97abea1c06c3fabac3bcb3f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/642a3247462a582ee97abea1c06c3fabac3bcb3f/comments", "author": {"login": "joboet", "id": 25721079, "node_id": "MDQ6VXNlcjI1NzIxMDc5", "avatar_url": "https://avatars.githubusercontent.com/u/25721079?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joboet", "html_url": "https://github.com/joboet", "followers_url": "https://api.github.com/users/joboet/followers", "following_url": "https://api.github.com/users/joboet/following{/other_user}", "gists_url": "https://api.github.com/users/joboet/gists{/gist_id}", "starred_url": "https://api.github.com/users/joboet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joboet/subscriptions", "organizations_url": "https://api.github.com/users/joboet/orgs", "repos_url": "https://api.github.com/users/joboet/repos", "events_url": "https://api.github.com/users/joboet/events{/privacy}", "received_events_url": "https://api.github.com/users/joboet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "joboet", "id": 25721079, "node_id": "MDQ6VXNlcjI1NzIxMDc5", "avatar_url": "https://avatars.githubusercontent.com/u/25721079?v=4", "gravatar_id": "", "url": "https://api.github.com/users/joboet", "html_url": "https://github.com/joboet", "followers_url": "https://api.github.com/users/joboet/followers", "following_url": "https://api.github.com/users/joboet/following{/other_user}", "gists_url": "https://api.github.com/users/joboet/gists{/gist_id}", "starred_url": "https://api.github.com/users/joboet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/joboet/subscriptions", "organizations_url": "https://api.github.com/users/joboet/orgs", "repos_url": "https://api.github.com/users/joboet/repos", "events_url": "https://api.github.com/users/joboet/events{/privacy}", "received_events_url": "https://api.github.com/users/joboet/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "746331edf3a6d055859ed0ed70dde1aa883c517d", "url": "https://api.github.com/repos/rust-lang/rust/commits/746331edf3a6d055859ed0ed70dde1aa883c517d", "html_url": "https://github.com/rust-lang/rust/commit/746331edf3a6d055859ed0ed70dde1aa883c517d"}], "stats": {"total": 13, "additions": 13, "deletions": 0}, "files": [{"sha": "632709fd98d8691e3fcc64cd56f4792422c03d5f", "filename": "library/std/src/sync/mpsc/sync_tests.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/642a3247462a582ee97abea1c06c3fabac3bcb3f/library%2Fstd%2Fsrc%2Fsync%2Fmpsc%2Fsync_tests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/642a3247462a582ee97abea1c06c3fabac3bcb3f/library%2Fstd%2Fsrc%2Fsync%2Fmpsc%2Fsync_tests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsync%2Fmpsc%2Fsync_tests.rs?ref=642a3247462a582ee97abea1c06c3fabac3bcb3f", "patch": "@@ -1,5 +1,6 @@\n use super::*;\n use crate::env;\n+use crate::rc::Rc;\n use crate::sync::mpmc::SendTimeoutError;\n use crate::thread;\n use crate::time::Duration;\n@@ -656,3 +657,15 @@ fn issue_15761() {\n         repro()\n     }\n }\n+\n+#[test]\n+fn drop_unreceived() {\n+    let (tx, rx) = sync_channel::<Rc<()>>(1);\n+    let msg = Rc::new(());\n+    let weak = Rc::downgrade(&msg);\n+    assert!(tx.send(msg).is_ok());\n+    drop(rx);\n+    // Messages should be dropped immediately when the last receiver is destroyed.\n+    assert!(weak.upgrade().is_none());\n+    drop(tx);\n+}"}]}