{"sha": "8aedb9c68dceebef23439541337a321252036b54", "node_id": "C_kwDOAAsO6NoAKDhhZWRiOWM2OGRjZWViZWYyMzQzOTU0MTMzN2EzMjEyNTIwMzZiNTQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-23T00:01:19Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-07-23T00:01:19Z"}, "message": "Auto merge of #99623 - RalfJung:rollup-0h066kc, r=RalfJung\n\nRollup of 3 pull requests\n\nSuccessful merges:\n\n - #99588 (Update books)\n - #99602 (cargotest: do not run quickcheck tests in xsv)\n - #99607 (interpret: fix vtable check debug assertion)\n\nFailed merges:\n\nr? `@ghost`\n`@rustbot` modify labels: rollup", "tree": {"sha": "3411062a2cbba8a73e880e8e93734d5d26bf5329", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3411062a2cbba8a73e880e8e93734d5d26bf5329"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8aedb9c68dceebef23439541337a321252036b54", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8aedb9c68dceebef23439541337a321252036b54", "html_url": "https://github.com/rust-lang/rust/commit/8aedb9c68dceebef23439541337a321252036b54", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8aedb9c68dceebef23439541337a321252036b54/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "848090dcd18553b790461132ca9d2a020aeea9a2", "url": "https://api.github.com/repos/rust-lang/rust/commits/848090dcd18553b790461132ca9d2a020aeea9a2", "html_url": "https://github.com/rust-lang/rust/commit/848090dcd18553b790461132ca9d2a020aeea9a2"}, {"sha": "25de227b434dc596f9f9caef180e0811564f8d14", "url": "https://api.github.com/repos/rust-lang/rust/commits/25de227b434dc596f9f9caef180e0811564f8d14", "html_url": "https://github.com/rust-lang/rust/commit/25de227b434dc596f9f9caef180e0811564f8d14"}], "stats": {"total": 42, "additions": 34, "deletions": 8}, "files": [{"sha": "6fef7b3b3cf7c46cc500ef51d442662359e2941c", "filename": "compiler/rustc_const_eval/src/interpret/terminator.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/8aedb9c68dceebef23439541337a321252036b54/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fterminator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8aedb9c68dceebef23439541337a321252036b54/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fterminator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fterminator.rs?ref=8aedb9c68dceebef23439541337a321252036b54", "patch": "@@ -589,13 +589,12 @@ impl<'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n                         ty::ExistentialTraitRef::erase_self_ty(tcx, virtual_trait_ref);\n                     let concrete_trait_ref = existential_trait_ref.with_self_ty(tcx, dyn_ty);\n \n-                    let concrete_method = Instance::resolve(\n+                    let concrete_method = Instance::resolve_for_vtable(\n                         tcx,\n                         self.param_env,\n                         def_id,\n                         instance.substs.rebase_onto(tcx, trait_def_id, concrete_trait_ref.substs),\n                     )\n-                    .unwrap()\n                     .unwrap();\n                     assert_eq!(fn_inst, concrete_method);\n                 }"}, {"sha": "36383b4da21dbd0a0781473bc8ad7ef0ed1b6751", "filename": "src/doc/book", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Fbook?ref=8aedb9c68dceebef23439541337a321252036b54", "patch": "@@ -1 +1 @@\n-Subproject commit cf2653a5ca553cbbb4a17f1a7db1947820f6a775\n+Subproject commit 36383b4da21dbd0a0781473bc8ad7ef0ed1b6751"}, {"sha": "8d1e4dccf71114ff56f328f671f2026d8e6b62a2", "filename": "src/doc/nomicon", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Fnomicon?ref=8aedb9c68dceebef23439541337a321252036b54", "patch": "@@ -1 +1 @@\n-Subproject commit 70db9e4189f64d1d8e2451b1046111fb356b6dc2\n+Subproject commit 8d1e4dccf71114ff56f328f671f2026d8e6b62a2"}, {"sha": "a92be0fef439b3d8e0468d82cb24812d303520a0", "filename": "src/doc/reference", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Freference?ref=8aedb9c68dceebef23439541337a321252036b54", "patch": "@@ -1 +1 @@\n-Subproject commit 9fce337a55ee4a4629205f6094656195cecad231\n+Subproject commit a92be0fef439b3d8e0468d82cb24812d303520a0"}, {"sha": "3155db49b0d57cd82c65456ac210b69ecec5ccb1", "filename": "src/doc/rust-by-example", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frust-by-example?ref=8aedb9c68dceebef23439541337a321252036b54", "patch": "@@ -1 +1 @@\n-Subproject commit 83724ca387a2a1cd3e8d848f62820020760e358b\n+Subproject commit 3155db49b0d57cd82c65456ac210b69ecec5ccb1"}, {"sha": "d5201cddace979b299ec1bf9fd8997338151aa9d", "filename": "src/doc/rustc-dev-guide", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Frustc-dev-guide?ref=8aedb9c68dceebef23439541337a321252036b54", "patch": "@@ -1 +1 @@\n-Subproject commit eb83839e903a0a8f1406f7e941886273f189b26b\n+Subproject commit d5201cddace979b299ec1bf9fd8997338151aa9d"}, {"sha": "95fe98a683ffdb66748054c965dc9159e7a91e54", "filename": "src/tools/cargotest/main.rs", "status": "modified", "additions": 28, "deletions": 1, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/8aedb9c68dceebef23439541337a321252036b54/src%2Ftools%2Fcargotest%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8aedb9c68dceebef23439541337a321252036b54/src%2Ftools%2Fcargotest%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcargotest%2Fmain.rs?ref=8aedb9c68dceebef23439541337a321252036b54", "patch": "@@ -11,6 +11,8 @@ struct Test {\n     packages: &'static [&'static str],\n     features: Option<&'static [&'static str]>,\n     manifest_path: Option<&'static str>,\n+    /// `filters` are passed to libtest (i.e., after a `--` in the `cargo test` invocation).\n+    filters: &'static [&'static str],\n }\n \n const TEST_REPOS: &[Test] = &[\n@@ -22,6 +24,7 @@ const TEST_REPOS: &[Test] = &[\n         packages: &[],\n         features: None,\n         manifest_path: None,\n+        filters: &[],\n     },\n     Test {\n         name: \"ripgrep\",\n@@ -31,6 +34,7 @@ const TEST_REPOS: &[Test] = &[\n         packages: &[],\n         features: None,\n         manifest_path: None,\n+        filters: &[],\n     },\n     Test {\n         name: \"tokei\",\n@@ -40,6 +44,7 @@ const TEST_REPOS: &[Test] = &[\n         packages: &[],\n         features: None,\n         manifest_path: None,\n+        filters: &[],\n     },\n     Test {\n         name: \"xsv\",\n@@ -49,6 +54,21 @@ const TEST_REPOS: &[Test] = &[\n         packages: &[],\n         features: None,\n         manifest_path: None,\n+        // Many tests here use quickcheck and some of them can fail randomly, so only run deterministic tests.\n+        filters: &[\n+            \"test_flatten::\",\n+            \"test_fmt::\",\n+            \"test_headers::\",\n+            \"test_index::\",\n+            \"test_join::\",\n+            \"test_partition::\",\n+            \"test_search::\",\n+            \"test_select::\",\n+            \"test_slice::\",\n+            \"test_split::\",\n+            \"test_stats::\",\n+            \"test_table::\",\n+        ],\n     },\n     Test {\n         name: \"servo\",\n@@ -60,6 +80,7 @@ const TEST_REPOS: &[Test] = &[\n         packages: &[\"selectors\"],\n         features: None,\n         manifest_path: None,\n+        filters: &[],\n     },\n     Test {\n         name: \"diesel\",\n@@ -75,6 +96,7 @@ const TEST_REPOS: &[Test] = &[\n         // not any other crate present in the diesel workspace\n         // (This is required to set the feature flags above)\n         manifest_path: Some(\"diesel/Cargo.toml\"),\n+        filters: &[],\n     },\n ];\n \n@@ -97,7 +119,8 @@ fn test_repo(cargo: &Path, out_dir: &Path, test: &Test) {\n     if let Some(lockfile) = test.lock {\n         fs::write(&dir.join(\"Cargo.lock\"), lockfile).unwrap();\n     }\n-    if !run_cargo_test(cargo, &dir, test.packages, test.features, test.manifest_path) {\n+    if !run_cargo_test(cargo, &dir, test.packages, test.features, test.manifest_path, test.filters)\n+    {\n         panic!(\"tests failed for {}\", test.repo);\n     }\n }\n@@ -155,6 +178,7 @@ fn run_cargo_test(\n     packages: &[&str],\n     features: Option<&[&str]>,\n     manifest_path: Option<&str>,\n+    filters: &[&str],\n ) -> bool {\n     let mut command = Command::new(cargo_path);\n     command.arg(\"test\");\n@@ -174,6 +198,9 @@ fn run_cargo_test(\n         command.arg(\"-p\").arg(name);\n     }\n \n+    command.arg(\"--\");\n+    command.args(filters);\n+\n     let status = command\n         // Disable rust-lang/cargo's cross-compile tests\n         .env(\"CFG_DISABLE_CROSS_TESTS\", \"1\")"}]}