{"sha": "44e6c2cb54312e14b3c7bd9d64a9fa0547c17ad7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ0ZTZjMmNiNTQzMTJlMTRiM2M3YmQ5ZDY0YTlmYTA1NDdjMTdhZDc=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-04-24T01:28:53Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-04-24T01:28:53Z"}, "message": "Merge #4101\n\n4101: Panic proc macro srv if read request failed r=matklad a=edwin0cheng\n\nThis PR fixed a bug when the rust-analyzer is killed suddenly, the `rust-analyzer proc-macro` will become stale.\n\nCo-authored-by: Edwin Cheng <edwin0cheng@gmail.com>", "tree": {"sha": "681d9ab297c4ef3062503f39cf07ef4a01896003", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/681d9ab297c4ef3062503f39cf07ef4a01896003"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/44e6c2cb54312e14b3c7bd9d64a9fa0547c17ad7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeokDVCRBK7hj4Ov3rIwAAdHIIABPftc/6t3TeiYBxPN2o3/qI\n1rR4T7ENaYGQSd9JSe63XLBGtu4fySWpDPHa5F2yC7LfYoex9B1YVTd92voQNNFv\nAfUNCiImmC66IRO/ERIFQ9vigFGa3dMzgrpctjI9nMrXEDBjDE+FOMgEZ4DA8R64\nj3SU5KaNgiHwJ/BKfdz+60cmEMNA8+4wEhXNDSazsqyLvPmmjVPBfqTjKotXGOrR\na/sFMoCeCaRiftaDJw+Byjopa9nBrExdj0TFMKvfESx7j5Od7lTRYxAYgnRHftvv\nIlMANJtJwgUvo3D9rca2PGML8JWFCkV6+2SYs3pd1JrOeMX9vvKy+Kdd9dSVM5M=\n=B8RT\n-----END PGP SIGNATURE-----\n", "payload": "tree 681d9ab297c4ef3062503f39cf07ef4a01896003\nparent ffba39aca05873d928f3253fd42893f76a8ea16b\nparent a83d1743a5a753b69c08760e4182878fce3fca08\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1587691733 +0000\ncommitter GitHub <noreply@github.com> 1587691733 +0000\n\nMerge #4101\n\n4101: Panic proc macro srv if read request failed r=matklad a=edwin0cheng\n\nThis PR fixed a bug when the rust-analyzer is killed suddenly, the `rust-analyzer proc-macro` will become stale.\n\nCo-authored-by: Edwin Cheng <edwin0cheng@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/44e6c2cb54312e14b3c7bd9d64a9fa0547c17ad7", "html_url": "https://github.com/rust-lang/rust/commit/44e6c2cb54312e14b3c7bd9d64a9fa0547c17ad7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/44e6c2cb54312e14b3c7bd9d64a9fa0547c17ad7/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ffba39aca05873d928f3253fd42893f76a8ea16b", "url": "https://api.github.com/repos/rust-lang/rust/commits/ffba39aca05873d928f3253fd42893f76a8ea16b", "html_url": "https://github.com/rust-lang/rust/commit/ffba39aca05873d928f3253fd42893f76a8ea16b"}, {"sha": "a83d1743a5a753b69c08760e4182878fce3fca08", "url": "https://api.github.com/repos/rust-lang/rust/commits/a83d1743a5a753b69c08760e4182878fce3fca08", "html_url": "https://github.com/rust-lang/rust/commit/a83d1743a5a753b69c08760e4182878fce3fca08"}], "stats": {"total": 17, "additions": 5, "deletions": 12}, "files": [{"sha": "7282e5b9b7a9a62031afa7754f3cce033613ebce", "filename": "crates/ra_proc_macro_srv/src/cli.rs", "status": "modified", "additions": 4, "deletions": 11, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/44e6c2cb54312e14b3c7bd9d64a9fa0547c17ad7/crates%2Fra_proc_macro_srv%2Fsrc%2Fcli.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44e6c2cb54312e14b3c7bd9d64a9fa0547c17ad7/crates%2Fra_proc_macro_srv%2Fsrc%2Fcli.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_proc_macro_srv%2Fsrc%2Fcli.rs?ref=44e6c2cb54312e14b3c7bd9d64a9fa0547c17ad7", "patch": "@@ -4,17 +4,8 @@ use crate::{expand_task, list_macros};\n use ra_proc_macro::msg::{self, Message};\n use std::io;\n \n-pub fn run() {\n-    loop {\n-        let req = match read_request() {\n-            Err(err) => {\n-                eprintln!(\"Read message error on ra_proc_macro_srv: {}\", err);\n-                continue;\n-            }\n-            Ok(None) => continue,\n-            Ok(Some(req)) => req,\n-        };\n-\n+pub fn run() -> io::Result<()> {\n+    while let Some(req) = read_request()? {\n         let res = match req {\n             msg::Request::ListMacro(task) => Ok(msg::Response::ListMacro(list_macros(&task))),\n             msg::Request::ExpansionMacro(task) => {\n@@ -33,6 +24,8 @@ pub fn run() {\n             eprintln!(\"Write message error: {}\", err);\n         }\n     }\n+\n+    Ok(())\n }\n \n fn read_request() -> io::Result<Option<msg::Request>> {"}, {"sha": "22a84b50c0998a3b2b461ebb0077be54e01a250a", "filename": "crates/rust-analyzer/src/bin/main.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/44e6c2cb54312e14b3c7bd9d64a9fa0547c17ad7/crates%2Frust-analyzer%2Fsrc%2Fbin%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/44e6c2cb54312e14b3c7bd9d64a9fa0547c17ad7/crates%2Frust-analyzer%2Fsrc%2Fbin%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Frust-analyzer%2Fsrc%2Fbin%2Fmain.rs?ref=44e6c2cb54312e14b3c7bd9d64a9fa0547c17ad7", "patch": "@@ -66,7 +66,7 @@ fn setup_logging() -> Result<()> {\n }\n \n fn run_proc_macro_srv() -> Result<()> {\n-    ra_proc_macro_srv::cli::run();\n+    ra_proc_macro_srv::cli::run()?;\n     Ok(())\n }\n "}]}