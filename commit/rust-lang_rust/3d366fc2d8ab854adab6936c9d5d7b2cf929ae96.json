{"sha": "3d366fc2d8ab854adab6936c9d5d7b2cf929ae96", "node_id": "C_kwDOAAsO6NoAKDNkMzY2ZmMyZDhhYjg1NGFkYWI2OTM2YzlkNWQ3YjJjZjkyOWFlOTY", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-06-22T22:18:08Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-06-22T22:18:08Z"}, "message": "Auto merge of #9026 - hellow554:neg_multiply_precedence, r=xFrednet\n\nput parentheses around neg_multiply suggestion if needed\n\n*Please write a short comment explaining your change (or \"none\" for internal only changes)*\n\nchangelog: [`neg_multiply`]: put parentheses around suggestion if needed", "tree": {"sha": "36049a9fa8154e6888fd39efc657d15d67c0b517", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/36049a9fa8154e6888fd39efc657d15d67c0b517"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3d366fc2d8ab854adab6936c9d5d7b2cf929ae96", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3d366fc2d8ab854adab6936c9d5d7b2cf929ae96", "html_url": "https://github.com/rust-lang/rust/commit/3d366fc2d8ab854adab6936c9d5d7b2cf929ae96", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3d366fc2d8ab854adab6936c9d5d7b2cf929ae96/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f9fea1737e34da3afedf4a0d35ea4866ce7f87a1", "url": "https://api.github.com/repos/rust-lang/rust/commits/f9fea1737e34da3afedf4a0d35ea4866ce7f87a1", "html_url": "https://github.com/rust-lang/rust/commit/f9fea1737e34da3afedf4a0d35ea4866ce7f87a1"}, {"sha": "6fc84d4da39942857e243cfe951bbefbdba5250b", "url": "https://api.github.com/repos/rust-lang/rust/commits/6fc84d4da39942857e243cfe951bbefbdba5250b", "html_url": "https://github.com/rust-lang/rust/commit/6fc84d4da39942857e243cfe951bbefbdba5250b"}], "stats": {"total": 29, "additions": 27, "deletions": 2}, "files": [{"sha": "b087cfb36b1166968c1fde2c28b3e2bd42b872a4", "filename": "clippy_lints/src/neg_multiply.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/3d366fc2d8ab854adab6936c9d5d7b2cf929ae96/clippy_lints%2Fsrc%2Fneg_multiply.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d366fc2d8ab854adab6936c9d5d7b2cf929ae96/clippy_lints%2Fsrc%2Fneg_multiply.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneg_multiply.rs?ref=3d366fc2d8ab854adab6936c9d5d7b2cf929ae96", "patch": "@@ -1,7 +1,9 @@\n use clippy_utils::consts::{self, Constant};\n use clippy_utils::diagnostics::span_lint_and_sugg;\n use clippy_utils::source::snippet_with_applicability;\n+use clippy_utils::sugg::has_enclosing_paren;\n use if_chain::if_chain;\n+use rustc_ast::util::parser::PREC_PREFIX;\n use rustc_errors::Applicability;\n use rustc_hir::{BinOpKind, Expr, ExprKind, UnOp};\n use rustc_lint::{LateContext, LateLintPass};\n@@ -58,7 +60,12 @@ fn check_mul(cx: &LateContext<'_>, span: Span, lit: &Expr<'_>, exp: &Expr<'_>) {\n \n         then {\n             let mut applicability = Applicability::MachineApplicable;\n-            let suggestion = format!(\"-{}\", snippet_with_applicability(cx, exp.span, \"..\", &mut applicability));\n+            let snip = snippet_with_applicability(cx, exp.span, \"..\", &mut applicability);\n+            let suggestion = if exp.precedence().order() < PREC_PREFIX && !has_enclosing_paren(&snip) {\n+                format!(\"-({})\", snip)\n+            } else {\n+                format!(\"-{}\", snip)\n+            };\n             span_lint_and_sugg(\n                     cx,\n                     NEG_MULTIPLY,"}, {"sha": "58ab9e856783849ceacfb1bfc9e8ea6533a19a6c", "filename": "tests/ui/neg_multiply.fixed", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3d366fc2d8ab854adab6936c9d5d7b2cf929ae96/tests%2Fui%2Fneg_multiply.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/3d366fc2d8ab854adab6936c9d5d7b2cf929ae96/tests%2Fui%2Fneg_multiply.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneg_multiply.fixed?ref=3d366fc2d8ab854adab6936c9d5d7b2cf929ae96", "patch": "@@ -38,6 +38,9 @@ fn main() {\n \n     0xcafe | -0xff00;\n \n+    -(3_usize as i32);\n+    -(3_usize as i32);\n+\n     -1 * -1; // should be ok\n \n     X * -1; // should be ok"}, {"sha": "581290dc72e43e87fccc68c6b322996a9ee55f1d", "filename": "tests/ui/neg_multiply.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3d366fc2d8ab854adab6936c9d5d7b2cf929ae96/tests%2Fui%2Fneg_multiply.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3d366fc2d8ab854adab6936c9d5d7b2cf929ae96/tests%2Fui%2Fneg_multiply.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneg_multiply.rs?ref=3d366fc2d8ab854adab6936c9d5d7b2cf929ae96", "patch": "@@ -38,6 +38,9 @@ fn main() {\n \n     0xcafe | 0xff00 * -1;\n \n+    3_usize as i32 * -1;\n+    (3_usize as i32) * -1;\n+\n     -1 * -1; // should be ok\n \n     X * -1; // should be ok"}, {"sha": "388ef29eb8567fa178ef4d03be77aab1479938ce", "filename": "tests/ui/neg_multiply.stderr", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/3d366fc2d8ab854adab6936c9d5d7b2cf929ae96/tests%2Fui%2Fneg_multiply.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3d366fc2d8ab854adab6936c9d5d7b2cf929ae96/tests%2Fui%2Fneg_multiply.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneg_multiply.stderr?ref=3d366fc2d8ab854adab6936c9d5d7b2cf929ae96", "patch": "@@ -36,5 +36,17 @@ error: this multiplication by -1 can be written more succinctly\n LL |     0xcafe | 0xff00 * -1;\n    |              ^^^^^^^^^^^ help: consider using: `-0xff00`\n \n-error: aborting due to 6 previous errors\n+error: this multiplication by -1 can be written more succinctly\n+  --> $DIR/neg_multiply.rs:41:5\n+   |\n+LL |     3_usize as i32 * -1;\n+   |     ^^^^^^^^^^^^^^^^^^^ help: consider using: `-(3_usize as i32)`\n+\n+error: this multiplication by -1 can be written more succinctly\n+  --> $DIR/neg_multiply.rs:42:5\n+   |\n+LL |     (3_usize as i32) * -1;\n+   |     ^^^^^^^^^^^^^^^^^^^^^ help: consider using: `-(3_usize as i32)`\n+\n+error: aborting due to 8 previous errors\n "}]}