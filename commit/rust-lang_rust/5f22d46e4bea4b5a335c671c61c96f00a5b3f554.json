{"sha": "5f22d46e4bea4b5a335c671c61c96f00a5b3f554", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVmMjJkNDZlNGJlYTRiNWEzMzVjNjcxYzYxYzk2ZjAwYTViM2Y1NTQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-04-19T05:54:23Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2017-04-19T05:54:23Z"}, "message": "Auto merge of #41170 - Nashenas88:master, r=alexcrichton\n\nUse the existing path when removing the prefix fails\n\nThis allows the use of out-of-tree paths to be specified. I found this while trying to build with a modified version of `rls-data`, which is currently pointing to a version on crates.io.\n\ncc @alexcrichton\n\nAlso, it wasn't clear if I needed to add a test for this (or how). I didn't see any tests that took paths into consideration.", "tree": {"sha": "6f01ad3daede6d5ba7803d83d1cb512314e3acba", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6f01ad3daede6d5ba7803d83d1cb512314e3acba"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5f22d46e4bea4b5a335c671c61c96f00a5b3f554", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5f22d46e4bea4b5a335c671c61c96f00a5b3f554", "html_url": "https://github.com/rust-lang/rust/commit/5f22d46e4bea4b5a335c671c61c96f00a5b3f554", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5f22d46e4bea4b5a335c671c61c96f00a5b3f554/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "84be2df0e9dac63a4e730c4f5652deb872060ad8", "url": "https://api.github.com/repos/rust-lang/rust/commits/84be2df0e9dac63a4e730c4f5652deb872060ad8", "html_url": "https://github.com/rust-lang/rust/commit/84be2df0e9dac63a4e730c4f5652deb872060ad8"}, {"sha": "a6f7628ea28a74e09002e430609b6e6ce52fd0ba", "url": "https://api.github.com/repos/rust-lang/rust/commits/a6f7628ea28a74e09002e430609b6e6ce52fd0ba", "html_url": "https://github.com/rust-lang/rust/commit/a6f7628ea28a74e09002e430609b6e6ce52fd0ba"}], "stats": {"total": 4, "additions": 3, "deletions": 1}, "files": [{"sha": "17902a39df1e82b4b76fa45034131fb67f630239", "filename": "src/bootstrap/step.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5f22d46e4bea4b5a335c671c61c96f00a5b3f554/src%2Fbootstrap%2Fstep.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5f22d46e4bea4b5a335c671c61c96f00a5b3f554/src%2Fbootstrap%2Fstep.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fstep.rs?ref=5f22d46e4bea4b5a335c671c61c96f00a5b3f554", "patch": "@@ -137,7 +137,9 @@ pub fn build_rules<'a>(build: &'a Build) -> Rules {\n         while let Some(krate) = list.pop() {\n             let default = krate == name;\n             let krate = &build.crates[krate];\n-            let path = krate.path.strip_prefix(&build.src).unwrap();\n+            let path = krate.path.strip_prefix(&build.src)\n+                // This handles out of tree paths\n+                .unwrap_or(&krate.path);\n             ret.push((krate, path.to_str().unwrap(), default));\n             for dep in krate.deps.iter() {\n                 if visited.insert(dep) && dep != \"build_helper\" {"}]}