{"sha": "ad096d1a0e82ecb1174d92ea08eb223d7dc0117a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFkMDk2ZDFhMGU4MmVjYjExNzRkOTJlYTA4ZWIyMjNkN2RjMDExN2E=", "commit": {"author": {"name": "Dale Wijnand", "email": "dale.wijnand@gmail.com", "date": "2019-02-20T10:17:23Z"}, "committer": {"name": "Dale Wijnand", "email": "dale.wijnand@gmail.com", "date": "2019-02-20T14:07:07Z"}, "message": "Dedup a rustdoc diagnostic construction", "tree": {"sha": "66cd1b0a73d2176c870704a27a4164db055e8797", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/66cd1b0a73d2176c870704a27a4164db055e8797"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ad096d1a0e82ecb1174d92ea08eb223d7dc0117a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEERGS9JmrgEHKCFADQTyVuPRUd9e8FAlxtXwsACgkQTyVuPRUd\n9e9ybA//apb7/ywgvqoMVFSGwCifnXFkqr8MQzI26sSx1vp5R7qcOU/5Tt7xbkPm\nQ0I1PnpvCJpwHJreefCJLc+3VknnwEXL17yQz0FdwQUNo5r/e++w1W69fyw627xs\n5C9hV+OemnsVrlA2NcFh8beZu7aeqqL7Sc79LMHjFo+pfzqcJOx9tnodNJLlYNmM\nVNSrkAK3op/FhZN9A+/KIt+eqh1T2HxWNCf2zhLh1f/iaaQ/Y7STEXSwseu3tFzp\n8aYFiMxOB53XO5FR7rSEAqbkOH8JMilOLNvXMZFViTnTc7wB8MgAcRhko7O/G8Gm\nhB3oVc2P/MKvI4lpU3Jim0nDZ521uDmEBmE+RzbmxYJf+xJkRmiYaEqynr+Z1xYL\nVGsKoWVb1pNjSU/R2sLLK3h0yx6v0H1T/l2a7+T9mzyuuYDdOh2qC+Ht3BuRKXB0\niEp14fKUm8SQIJesnyTDfG770v8j+4zwla+wwqrArUYaamw0Zdhh1NSF8wHuyQpP\nTvHLKRclTQ1vElSuDz+rZ+S89OCB3ig6AkR9ItsCyyYSPr/zcuxYZldJ/aNJbJHk\nxG0EV5Waa597qP6Mdroc7Yw50nySCjH/+wdPznHTKQcOa0AA+dGBPoy0N0R7RGkM\n5gwPot9qfCM/OBJzGSc7495B3cl/Pe8t4YP+9zW5uY0wchVR9zw=\n=yHlS\n-----END PGP SIGNATURE-----", "payload": "tree 66cd1b0a73d2176c870704a27a4164db055e8797\nparent 74e35d270067afff72034312065c48e6d8cfba67\nauthor Dale Wijnand <dale.wijnand@gmail.com> 1550657843 +0000\ncommitter Dale Wijnand <dale.wijnand@gmail.com> 1550671627 +0000\n\nDedup a rustdoc diagnostic construction\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ad096d1a0e82ecb1174d92ea08eb223d7dc0117a", "html_url": "https://github.com/rust-lang/rust/commit/ad096d1a0e82ecb1174d92ea08eb223d7dc0117a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ad096d1a0e82ecb1174d92ea08eb223d7dc0117a/comments", "author": {"login": "dwijnand", "id": 344610, "node_id": "MDQ6VXNlcjM0NDYxMA==", "avatar_url": "https://avatars.githubusercontent.com/u/344610?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dwijnand", "html_url": "https://github.com/dwijnand", "followers_url": "https://api.github.com/users/dwijnand/followers", "following_url": "https://api.github.com/users/dwijnand/following{/other_user}", "gists_url": "https://api.github.com/users/dwijnand/gists{/gist_id}", "starred_url": "https://api.github.com/users/dwijnand/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dwijnand/subscriptions", "organizations_url": "https://api.github.com/users/dwijnand/orgs", "repos_url": "https://api.github.com/users/dwijnand/repos", "events_url": "https://api.github.com/users/dwijnand/events{/privacy}", "received_events_url": "https://api.github.com/users/dwijnand/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dwijnand", "id": 344610, "node_id": "MDQ6VXNlcjM0NDYxMA==", "avatar_url": "https://avatars.githubusercontent.com/u/344610?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dwijnand", "html_url": "https://github.com/dwijnand", "followers_url": "https://api.github.com/users/dwijnand/followers", "following_url": "https://api.github.com/users/dwijnand/following{/other_user}", "gists_url": "https://api.github.com/users/dwijnand/gists{/gist_id}", "starred_url": "https://api.github.com/users/dwijnand/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dwijnand/subscriptions", "organizations_url": "https://api.github.com/users/dwijnand/orgs", "repos_url": "https://api.github.com/users/dwijnand/repos", "events_url": "https://api.github.com/users/dwijnand/events{/privacy}", "received_events_url": "https://api.github.com/users/dwijnand/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "74e35d270067afff72034312065c48e6d8cfba67", "url": "https://api.github.com/repos/rust-lang/rust/commits/74e35d270067afff72034312065c48e6d8cfba67", "html_url": "https://github.com/rust-lang/rust/commit/74e35d270067afff72034312065c48e6d8cfba67"}], "stats": {"total": 30, "additions": 8, "deletions": 22}, "files": [{"sha": "7f7fffbba100ee9038f5cf8da286deab31fa406f", "filename": "src/librustdoc/passes/collect_intra_doc_links.rs", "status": "modified", "additions": 8, "deletions": 22, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/ad096d1a0e82ecb1174d92ea08eb223d7dc0117a/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad096d1a0e82ecb1174d92ea08eb223d7dc0117a/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs?ref=ad096d1a0e82ecb1174d92ea08eb223d7dc0117a", "patch": "@@ -458,26 +458,18 @@ fn resolution_failure(\n     link_range: Option<Range<usize>>,\n ) {\n     let sp = span_of_attrs(attrs);\n-    let msg = format!(\"`[{}]` cannot be resolved, ignoring it...\", path_str);\n \n-    let mut diag = if let Some(link_range) = link_range {\n+    let mut diag = cx.tcx.struct_span_lint_node(\n+        lint::builtin::INTRA_DOC_LINK_RESOLUTION_FAILURE,\n+        NodeId::from_u32(0),\n+        sp,\n+        &format!(\"`[{}]` cannot be resolved, ignoring it...\", path_str),\n+    );\n+    if let Some(link_range) = link_range {\n         if let Some(sp) = super::source_span_for_markdown_range(cx, dox, &link_range, attrs) {\n-            let mut diag = cx.tcx.struct_span_lint_node(\n-                lint::builtin::INTRA_DOC_LINK_RESOLUTION_FAILURE,\n-                NodeId::from_u32(0),\n-                sp,\n-                &msg,\n-            );\n+            diag.set_span(sp);\n             diag.span_label(sp, \"cannot be resolved, ignoring\");\n-            diag\n         } else {\n-            let mut diag = cx.tcx.struct_span_lint_node(\n-                lint::builtin::INTRA_DOC_LINK_RESOLUTION_FAILURE,\n-                NodeId::from_u32(0),\n-                sp,\n-                &msg,\n-            );\n-\n             // blah blah blah\\nblah\\nblah [blah] blah blah\\nblah blah\n             //                       ^     ~~~~\n             //                       |     link_range\n@@ -494,13 +486,7 @@ fn resolution_failure(\n                 before=link_range.start - last_new_line_offset,\n                 found=link_range.len(),\n             ));\n-            diag\n         }\n-    } else {\n-        cx.tcx.struct_span_lint_node(lint::builtin::INTRA_DOC_LINK_RESOLUTION_FAILURE,\n-                                     NodeId::from_u32(0),\n-                                     sp,\n-                                     &msg)\n     };\n     diag.help(\"to escape `[` and `]` characters, just add '\\\\' before them like \\\n                `\\\\[` or `\\\\]`\");"}]}