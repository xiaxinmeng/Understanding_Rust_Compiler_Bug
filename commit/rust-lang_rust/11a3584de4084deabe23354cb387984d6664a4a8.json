{"sha": "11a3584de4084deabe23354cb387984d6664a4a8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjExYTM1ODRkZTQwODRkZWFiZTIzMzU0Y2IzODc5ODRkNjY2NGE0YTg=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2020-06-25T10:56:15Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2020-06-25T10:56:15Z"}, "message": "emitter: column width defaults to 140\n\nThis commit modifies the column width computation in the emitter when\n`termize::dimensions` returns `None` so that it uses the default value\nof 140 (which is used in UI testing currently) instead of `usize::MAX`\nwhich just ends up causing overflows in later computations. This is hard\nto test but appears to produce the same output as using saturating\nfunctions instead.\n\nSigned-off-by: David Wood <david@davidtw.co>", "tree": {"sha": "47560715a539ba32f94c3bd14aa90bd450be48f0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/47560715a539ba32f94c3bd14aa90bd450be48f0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/11a3584de4084deabe23354cb387984d6664a4a8", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEfgm2/wUjk9OnjxlyJZLnbIc4H9kFAl70g14ACgkQJZLnbIc4\nH9ksZQ/8Dt1iN6s35jDgfdUIfJmiUFCeWJsF4vBJL5RwTjRF1ahGZdqetqoxODmu\nVVX6kxtV3biKmwn5Qf+zHuaWUU5tW0s2m6RUVBL2S/fcJZOxYAL5UExNJkEzo8oS\nXAUSOW87Cpn5MHxVP4i9CmV31oxXEnr3DRznV90i99I1ye6T1flGteZu2s+9z7bf\nIeiz3YaPwoFUGZ/CdUD03gxvcaAnheGAZ00E3YJPj9DMHjzDbZ4SUbxEoh02Gfy+\n3BQCJcv74b/N43WOq5aCfPJYu46jVPklUebFLXL5k7ZuvZwafm/P8FmLDNbpauSS\nlXXf+P0KuQJnSK++skrmqgLGIKRGV8B47xa8FpEOKjGGoDx6SQq66Y6DiYA/iOZU\nyDzrrXETqdBu2JkJuhBekUEj5npY7rZjIiGaBXkxx7Xdm+WJOyFm65AnXgz6JA9J\ntOpwFnpmWPYSo1khq0nwGPQ1/0KnUjP1jKoMhJ75JQydLnIZD5Hcad4FDGV/82Iz\nSrHNUkunODnXNb1vI89rZy8k2sTAS/4Xnbx2zKV7Qq0t5s7/DKp+sRS6+jEKq7He\nGcuOvXzLNKZLyaQFazJahKdndzVQqm2HtvJy8WcqVY5gUcSqz6pAHyIO+79abhZ/\nlM4m7EktWNQZgYcOlW9qt2cJCXF2CQte7c4FbBQ2pUJNjn29Ru8=\n=Gcm3\n-----END PGP SIGNATURE-----", "payload": "tree 47560715a539ba32f94c3bd14aa90bd450be48f0\nparent 67100f61e62a86f2bf9e38552ee138e231eddc74\nauthor David Wood <david@davidtw.co> 1593082575 +0100\ncommitter David Wood <david@davidtw.co> 1593082575 +0100\n\nemitter: column width defaults to 140\n\nThis commit modifies the column width computation in the emitter when\n`termize::dimensions` returns `None` so that it uses the default value\nof 140 (which is used in UI testing currently) instead of `usize::MAX`\nwhich just ends up causing overflows in later computations. This is hard\nto test but appears to produce the same output as using saturating\nfunctions instead.\n\nSigned-off-by: David Wood <david@davidtw.co>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/11a3584de4084deabe23354cb387984d6664a4a8", "html_url": "https://github.com/rust-lang/rust/commit/11a3584de4084deabe23354cb387984d6664a4a8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/11a3584de4084deabe23354cb387984d6664a4a8/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "67100f61e62a86f2bf9e38552ee138e231eddc74", "url": "https://api.github.com/repos/rust-lang/rust/commits/67100f61e62a86f2bf9e38552ee138e231eddc74", "html_url": "https://github.com/rust-lang/rust/commit/67100f61e62a86f2bf9e38552ee138e231eddc74"}], "stats": {"total": 10, "additions": 7, "deletions": 3}, "files": [{"sha": "1362a1155bcdd358e68573809147005fe47d2b6d", "filename": "src/librustc_errors/emitter.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/11a3584de4084deabe23354cb387984d6664a4a8/src%2Flibrustc_errors%2Femitter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11a3584de4084deabe23354cb387984d6664a4a8/src%2Flibrustc_errors%2Femitter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_errors%2Femitter.rs?ref=11a3584de4084deabe23354cb387984d6664a4a8", "patch": "@@ -31,6 +31,9 @@ use std::path::Path;\n use termcolor::{Ansi, BufferWriter, ColorChoice, ColorSpec, StandardStream};\n use termcolor::{Buffer, Color, WriteColor};\n \n+/// Default column width, used in tests and when terminal dimensions cannot be determined.\n+const DEFAULT_COLUMN_WIDTH: usize = 140;\n+\n /// Describes the way the content of the `rendered` field of the json output is generated\n #[derive(Clone, Copy, Debug, PartialEq, Eq)]\n pub enum HumanReadableErrorType {\n@@ -74,7 +77,8 @@ struct Margin {\n     pub computed_left: usize,\n     /// The end of the line to be displayed.\n     pub computed_right: usize,\n-    /// The current width of the terminal. 140 by default and in tests.\n+    /// The current width of the terminal. Uses value of `DEFAULT_COLUMN_WIDTH` constant by default\n+    /// and in tests.\n     pub column_width: usize,\n     /// The end column of a span label, including the span. Doesn't account for labels not in the\n     /// same line as the span.\n@@ -1414,11 +1418,11 @@ impl EmitterWriter {\n                 let column_width = if let Some(width) = self.terminal_width {\n                     width.saturating_sub(code_offset)\n                 } else if self.ui_testing {\n-                    140\n+                    DEFAULT_COLUMN_WIDTH\n                 } else {\n                     termize::dimensions()\n                         .map(|(w, _)| w.saturating_sub(code_offset))\n-                        .unwrap_or(usize::MAX)\n+                        .unwrap_or(DEFAULT_COLUMN_WIDTH)\n                 };\n \n                 let margin = Margin::new("}]}