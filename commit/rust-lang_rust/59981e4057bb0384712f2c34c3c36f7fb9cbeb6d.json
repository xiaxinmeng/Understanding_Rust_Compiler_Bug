{"sha": "59981e4057bb0384712f2c34c3c36f7fb9cbeb6d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU5OTgxZTQwNTdiYjAzODQ3MTJmMmMzNGMzYzM2ZjdmYjljYmViNmQ=", "commit": {"author": {"name": "Ian Douglas Scott", "email": "ian@iandouglasscott.com", "date": "2017-07-05T19:00:46Z"}, "committer": {"name": "Ian Douglas Scott", "email": "ian@iandouglasscott.com", "date": "2017-07-07T15:34:48Z"}, "message": "Redox: Fix Condvar.wait(); do not lock mutex twice\n\nThe atomic_xchg() loop locks the mutex, so the call to mutex_lock is\nincorrect, and blocks.", "tree": {"sha": "99d93a0ab0d0f5642b40d6b7ff26a987f3268a1d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/99d93a0ab0d0f5642b40d6b7ff26a987f3268a1d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/59981e4057bb0384712f2c34c3c36f7fb9cbeb6d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCAAdFiEECYv1aaNg4jTOK4YaSSThDhmbWVkFAllfqhgACgkQSSThDhmb\nWVkOswgAlFA/0jMYjX0EuyUXnHD9e8TLqy4PgDx+J09IhQDPVkR38ycJznx4Xb+2\n86bNLUMOkY6ozq7WTONji7ZDx5DEFDCYx43FqIybu4dAEKvAyB/2XmKRgrRLAMAk\ncDCrHMqEo9gQO/F57RWg4kUUJCSLHmhG4rwuKHfvE5MIL44gLmRNuWVfyyf/5ZFI\niS33hDWC2ybOKxJOmmmwHSMMyEQN9JPQzFyFcjlIGrg9lHeNRi9k5/vBY19EsCfe\n0eM2HBsdAqoFGOi/79PP/gY6aw9uo4KCTgnmKNpKWxZ/6EEO/Ju7PuxdSKicef/F\ne9E6uL/tIswj8a0+03UQpPoV/9OLdA==\n=1vna\n-----END PGP SIGNATURE-----", "payload": "tree 99d93a0ab0d0f5642b40d6b7ff26a987f3268a1d\nparent 703341051d857bba054f97c38f80d10aab44521c\nauthor Ian Douglas Scott <ian@iandouglasscott.com> 1499281246 -0700\ncommitter Ian Douglas Scott <ian@iandouglasscott.com> 1499441688 -0700\n\nRedox: Fix Condvar.wait(); do not lock mutex twice\n\nThe atomic_xchg() loop locks the mutex, so the call to mutex_lock is\nincorrect, and blocks.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/59981e4057bb0384712f2c34c3c36f7fb9cbeb6d", "html_url": "https://github.com/rust-lang/rust/commit/59981e4057bb0384712f2c34c3c36f7fb9cbeb6d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/59981e4057bb0384712f2c34c3c36f7fb9cbeb6d/comments", "author": {"login": "ids1024", "id": 2263150, "node_id": "MDQ6VXNlcjIyNjMxNTA=", "avatar_url": "https://avatars.githubusercontent.com/u/2263150?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ids1024", "html_url": "https://github.com/ids1024", "followers_url": "https://api.github.com/users/ids1024/followers", "following_url": "https://api.github.com/users/ids1024/following{/other_user}", "gists_url": "https://api.github.com/users/ids1024/gists{/gist_id}", "starred_url": "https://api.github.com/users/ids1024/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ids1024/subscriptions", "organizations_url": "https://api.github.com/users/ids1024/orgs", "repos_url": "https://api.github.com/users/ids1024/repos", "events_url": "https://api.github.com/users/ids1024/events{/privacy}", "received_events_url": "https://api.github.com/users/ids1024/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ids1024", "id": 2263150, "node_id": "MDQ6VXNlcjIyNjMxNTA=", "avatar_url": "https://avatars.githubusercontent.com/u/2263150?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ids1024", "html_url": "https://github.com/ids1024", "followers_url": "https://api.github.com/users/ids1024/followers", "following_url": "https://api.github.com/users/ids1024/following{/other_user}", "gists_url": "https://api.github.com/users/ids1024/gists{/gist_id}", "starred_url": "https://api.github.com/users/ids1024/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ids1024/subscriptions", "organizations_url": "https://api.github.com/users/ids1024/orgs", "repos_url": "https://api.github.com/users/ids1024/repos", "events_url": "https://api.github.com/users/ids1024/events{/privacy}", "received_events_url": "https://api.github.com/users/ids1024/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "703341051d857bba054f97c38f80d10aab44521c", "url": "https://api.github.com/repos/rust-lang/rust/commits/703341051d857bba054f97c38f80d10aab44521c", "html_url": "https://github.com/rust-lang/rust/commit/703341051d857bba054f97c38f80d10aab44521c"}], "stats": {"total": 4, "additions": 1, "deletions": 3}, "files": [{"sha": "fe4a89c6f3ebb5dc8aaf069a9ad221c5d94c22bb", "filename": "src/libstd/sys/redox/condvar.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/59981e4057bb0384712f2c34c3c36f7fb9cbeb6d/src%2Flibstd%2Fsys%2Fredox%2Fcondvar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/59981e4057bb0384712f2c34c3c36f7fb9cbeb6d/src%2Flibstd%2Fsys%2Fredox%2Fcondvar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fredox%2Fcondvar.rs?ref=59981e4057bb0384712f2c34c3c36f7fb9cbeb6d", "patch": "@@ -13,7 +13,7 @@ use intrinsics::{atomic_cxchg, atomic_xadd, atomic_xchg};\n use ptr;\n use time::Duration;\n \n-use sys::mutex::{mutex_lock, mutex_unlock, Mutex};\n+use sys::mutex::{mutex_unlock, Mutex};\n use sys::syscall::{futex, FUTEX_WAIT, FUTEX_WAKE, FUTEX_REQUEUE};\n \n pub struct Condvar {\n@@ -83,8 +83,6 @@ impl Condvar {\n             while atomic_xchg(*lock, 2) != 0 {\n                 let _ = futex(*lock, FUTEX_WAIT, 2, 0, ptr::null_mut());\n             }\n-\n-            mutex_lock(*lock);\n         }\n     }\n "}]}