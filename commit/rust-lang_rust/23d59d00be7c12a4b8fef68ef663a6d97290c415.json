{"sha": "23d59d00be7c12a4b8fef68ef663a6d97290c415", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIzZDU5ZDAwYmU3YzEyYTRiOGZlZjY4ZWY2NjNhNmQ5NzI5MGM0MTU=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-06-28T21:58:54Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2018-06-28T21:58:54Z"}, "message": "Suggest correct comparison against negative literal\n\nWhen parsing as emplacement syntax (`x<-1`), suggest the correct syntax\nfor comparison against a negative value (`x< -1`).", "tree": {"sha": "ebbbaf28392f3c48b8688e42ce28768477995359", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ebbbaf28392f3c48b8688e42ce28768477995359"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/23d59d00be7c12a4b8fef68ef663a6d97290c415", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/23d59d00be7c12a4b8fef68ef663a6d97290c415", "html_url": "https://github.com/rust-lang/rust/commit/23d59d00be7c12a4b8fef68ef663a6d97290c415", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/23d59d00be7c12a4b8fef68ef663a6d97290c415/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5d95db34a472dc09a90737c83ab533b840dcd224", "url": "https://api.github.com/repos/rust-lang/rust/commits/5d95db34a472dc09a90737c83ab533b840dcd224", "html_url": "https://github.com/rust-lang/rust/commit/5d95db34a472dc09a90737c83ab533b840dcd224"}], "stats": {"total": 68, "additions": 62, "deletions": 6}, "files": [{"sha": "00b71accbf5a0c4a9fb2e6c08ba9422de57a6b4d", "filename": "src/librustc_passes/ast_validation.rs", "status": "modified", "additions": 21, "deletions": 6, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/23d59d00be7c12a4b8fef68ef663a6d97290c415/src%2Flibrustc_passes%2Fast_validation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23d59d00be7c12a4b8fef68ef663a6d97290c415/src%2Flibrustc_passes%2Fast_validation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_passes%2Fast_validation.rs?ref=23d59d00be7c12a4b8fef68ef663a6d97290c415", "patch": "@@ -172,12 +172,27 @@ impl<'a> Visitor<'a> for AstValidator<'a> {\n             ExprKind::InlineAsm(..) if !self.session.target.target.options.allow_asm => {\n                 span_err!(self.session, expr.span, E0472, \"asm! is unsupported on this target\");\n             }\n-            ExprKind::ObsoleteInPlace(..) => {\n-                self.err_handler()\n-                    .struct_span_err(expr.span, \"emplacement syntax is obsolete (for now, anyway)\")\n-                    .note(\"for more information, see \\\n-                           <https://github.com/rust-lang/rust/issues/27779#issuecomment-378416911>\")\n-                    .emit();\n+            ExprKind::ObsoleteInPlace(ref place, ref val) => {\n+                let mut err = self.err_handler().struct_span_err(\n+                    expr.span,\n+                    \"emplacement syntax is obsolete (for now, anyway)\",\n+                );\n+                err.note(\n+                    \"for more information, see \\\n+                     <https://github.com/rust-lang/rust/issues/27779#issuecomment-378416911>\"\n+                );\n+                match val.node {\n+                    ExprKind::Lit(ref v) if v.node.is_numeric() => {\n+                        err.span_suggestion(\n+                            place.span.between(val.span),\n+                            \"if you meant to write a comparison against a negative value, add a \\\n+                             space in between `<` and `-`\",\n+                            \"< -\".to_string(),\n+                        );\n+                    }\n+                    _ => {}\n+                }\n+                err.emit();\n             }\n             _ => {}\n         }"}, {"sha": "07e22b02c55bb691c6a8b9f06bc9b5cac6ba27d9", "filename": "src/libsyntax/ast.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/23d59d00be7c12a4b8fef68ef663a6d97290c415/src%2Flibsyntax%2Fast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23d59d00be7c12a4b8fef68ef663a6d97290c415/src%2Flibsyntax%2Fast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fast.rs?ref=23d59d00be7c12a4b8fef68ef663a6d97290c415", "patch": "@@ -1298,6 +1298,16 @@ impl LitKind {\n         }\n     }\n \n+    /// Returns true if this is a numeric literal.\n+    pub fn is_numeric(&self) -> bool {\n+        match *self {\n+            LitKind::Int(..) |\n+            LitKind::Float(..) |\n+            LitKind::FloatUnsuffixed(..) => true,\n+            _ => false,\n+        }\n+    }\n+\n     /// Returns true if this literal has no suffix. Note: this will return true\n     /// for literals with prefixes such as raw strings and byte strings.\n     pub fn is_unsuffixed(&self) -> bool {"}, {"sha": "39252597a23e8803926a413cb86fc9de0cded96d", "filename": "src/test/ui/suggestions/placement-syntax.rs", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/23d59d00be7c12a4b8fef68ef663a6d97290c415/src%2Ftest%2Fui%2Fsuggestions%2Fplacement-syntax.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23d59d00be7c12a4b8fef68ef663a6d97290c415/src%2Ftest%2Fui%2Fsuggestions%2Fplacement-syntax.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fplacement-syntax.rs?ref=23d59d00be7c12a4b8fef68ef663a6d97290c415", "patch": "@@ -0,0 +1,17 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    let x = -5;\n+    if x<-1 {\n+    //~^ ERROR emplacement syntax is obsolete\n+        println!(\"ok\");\n+    }\n+}"}, {"sha": "933ba96519c445f6b21b8723cc36e6bc211468dd", "filename": "src/test/ui/suggestions/placement-syntax.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/23d59d00be7c12a4b8fef68ef663a6d97290c415/src%2Ftest%2Fui%2Fsuggestions%2Fplacement-syntax.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/23d59d00be7c12a4b8fef68ef663a6d97290c415/src%2Ftest%2Fui%2Fsuggestions%2Fplacement-syntax.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fplacement-syntax.stderr?ref=23d59d00be7c12a4b8fef68ef663a6d97290c415", "patch": "@@ -0,0 +1,14 @@\n+error: emplacement syntax is obsolete (for now, anyway)\n+  --> $DIR/placement-syntax.rs:13:8\n+   |\n+LL |     if x<-1 {\n+   |        ^^^^\n+   |\n+   = note: for more information, see <https://github.com/rust-lang/rust/issues/27779#issuecomment-378416911>\n+help: if you meant to write a comparison against a negative value, add a space in between `<` and `-`\n+   |\n+LL |     if x< -1 {\n+   |         ^^^\n+\n+error: aborting due to previous error\n+"}]}