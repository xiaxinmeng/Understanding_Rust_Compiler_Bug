{"sha": "505b09e326907dcab22361be33053a4c5792f8a1", "node_id": "C_kwDOAAsO6NoAKDUwNWIwOWUzMjY5MDdkY2FiMjIzNjFiZTMzMDUzYTRjNTc5MmY4YTE", "commit": {"author": {"name": "Esteban Kuber", "email": "esteban@kuber.com.ar", "date": "2021-11-24T20:24:14Z"}, "committer": {"name": "Esteban Kuber", "email": "esteban@kuber.com.ar", "date": "2021-11-24T22:04:52Z"}, "message": "Tweak span and add more tests", "tree": {"sha": "746bd00254c882ef9718c5c0d9d5d28ec696d375", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/746bd00254c882ef9718c5c0d9d5d28ec696d375"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/505b09e326907dcab22361be33053a4c5792f8a1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/505b09e326907dcab22361be33053a4c5792f8a1", "html_url": "https://github.com/rust-lang/rust/commit/505b09e326907dcab22361be33053a4c5792f8a1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/505b09e326907dcab22361be33053a4c5792f8a1/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d86aff8042cd06427fc3917aa2f964094c3643ec", "url": "https://api.github.com/repos/rust-lang/rust/commits/d86aff8042cd06427fc3917aa2f964094c3643ec", "html_url": "https://github.com/rust-lang/rust/commit/d86aff8042cd06427fc3917aa2f964094c3643ec"}], "stats": {"total": 49, "additions": 40, "deletions": 9}, "files": [{"sha": "16bfebef2c41f45251a2ed878668a1b269d0b299", "filename": "compiler/rustc_parse/src/parser/diagnostics.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/505b09e326907dcab22361be33053a4c5792f8a1/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/505b09e326907dcab22361be33053a4c5792f8a1/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs?ref=505b09e326907dcab22361be33053a4c5792f8a1", "patch": "@@ -1925,11 +1925,8 @@ impl<'a> Parser<'a> {\n             }\n         };\n         let mut err =\n-            self.struct_span_err(param.ident.span, \"unexpected `const` parameter declaration\");\n-        err.span_label(\n-            param.ident.span,\n-            \"expected a `const` expression, not a parameter declaration\",\n-        );\n+            self.struct_span_err(param.span(), \"unexpected `const` parameter declaration\");\n+        err.span_label(param.span(), \"expected a `const` expression, not a parameter declaration\");\n         if let (Some(generics), Ok(snippet)) =\n             (ty_generics, self.sess.source_map().span_to_snippet(param.span()))\n         {"}, {"sha": "53e3c6f9605005ee48ca992692ac910ffa3ed7b0", "filename": "src/test/ui/parser/const-param-decl-on-type-instead-of-impl.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/505b09e326907dcab22361be33053a4c5792f8a1/src%2Ftest%2Fui%2Fparser%2Fconst-param-decl-on-type-instead-of-impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/505b09e326907dcab22361be33053a4c5792f8a1/src%2Ftest%2Fui%2Fparser%2Fconst-param-decl-on-type-instead-of-impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fconst-param-decl-on-type-instead-of-impl.rs?ref=505b09e326907dcab22361be33053a4c5792f8a1", "patch": "@@ -4,3 +4,12 @@ impl NInts<const N: usize> {} //~ ERROR unexpected `const` parameter declaration\n fn main() {\n     let _: () = 42; //~ ERROR mismatched types\n }\n+\n+fn banana(a: <T<const N: usize>>::BAR) {}\n+//~^ ERROR unexpected `const` parameter declaration\n+//~| ERROR cannot find type `T` in this scope\n+fn chaenomeles() {\n+    path::path::Struct::<const N: usize>()\n+    //~^ ERROR unexpected `const` parameter declaration\n+    //~| ERROR failed to resolve: use of undeclared crate or module `path`\n+}"}, {"sha": "96885d11ee07f7b65662dd8508db88aa83172bad", "filename": "src/test/ui/parser/const-param-decl-on-type-instead-of-impl.stderr", "status": "modified", "additions": 29, "deletions": 4, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/505b09e326907dcab22361be33053a4c5792f8a1/src%2Ftest%2Fui%2Fparser%2Fconst-param-decl-on-type-instead-of-impl.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/505b09e326907dcab22361be33053a4c5792f8a1/src%2Ftest%2Fui%2Fparser%2Fconst-param-decl-on-type-instead-of-impl.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fconst-param-decl-on-type-instead-of-impl.stderr?ref=505b09e326907dcab22361be33053a4c5792f8a1", "patch": "@@ -1,14 +1,38 @@\n error: unexpected `const` parameter declaration\n-  --> $DIR/const-param-decl-on-type-instead-of-impl.rs:2:18\n+  --> $DIR/const-param-decl-on-type-instead-of-impl.rs:2:12\n    |\n LL | impl NInts<const N: usize> {}\n-   |                  ^ expected a `const` expression, not a parameter declaration\n+   |            ^^^^^^^^^^^^^^ expected a `const` expression, not a parameter declaration\n    |\n help: `const` parameters must be declared for the `impl`\n    |\n LL | impl<const N: usize> NInts<N> {}\n    |     ++++++++++++++++       ~\n \n+error: unexpected `const` parameter declaration\n+  --> $DIR/const-param-decl-on-type-instead-of-impl.rs:8:17\n+   |\n+LL | fn banana(a: <T<const N: usize>>::BAR) {}\n+   |                 ^^^^^^^^^^^^^^ expected a `const` expression, not a parameter declaration\n+\n+error: unexpected `const` parameter declaration\n+  --> $DIR/const-param-decl-on-type-instead-of-impl.rs:12:26\n+   |\n+LL |     path::path::Struct::<const N: usize>()\n+   |                          ^^^^^^^^^^^^^^ expected a `const` expression, not a parameter declaration\n+\n+error[E0433]: failed to resolve: use of undeclared crate or module `path`\n+  --> $DIR/const-param-decl-on-type-instead-of-impl.rs:12:5\n+   |\n+LL |     path::path::Struct::<const N: usize>()\n+   |     ^^^^ use of undeclared crate or module `path`\n+\n+error[E0412]: cannot find type `T` in this scope\n+  --> $DIR/const-param-decl-on-type-instead-of-impl.rs:8:15\n+   |\n+LL | fn banana(a: <T<const N: usize>>::BAR) {}\n+   |               ^ not found in this scope\n+\n error[E0308]: mismatched types\n   --> $DIR/const-param-decl-on-type-instead-of-impl.rs:5:17\n    |\n@@ -17,6 +41,7 @@ LL |     let _: () = 42;\n    |            |\n    |            expected due to this\n \n-error: aborting due to 2 previous errors\n+error: aborting due to 6 previous errors\n \n-For more information about this error, try `rustc --explain E0308`.\n+Some errors have detailed explanations: E0308, E0412, E0433.\n+For more information about an error, try `rustc --explain E0308`."}]}