{"sha": "034df9478013dc05d06598c6e39494a8b518b004", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAzNGRmOTQ3ODAxM2RjMDVkMDY1OThjNmUzOTQ5NGE4YjUxOGIwMDQ=", "commit": {"author": {"name": "trixnz", "email": "mtatrix@gmail.com", "date": "2016-08-05T18:05:57Z"}, "committer": {"name": "trixnz", "email": "me@trix.nz", "date": "2016-08-10T17:04:11Z"}, "message": "Update error format for E0326", "tree": {"sha": "f742d8e33cfe3ae4a7c8b9567150582cbd087d1c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f742d8e33cfe3ae4a7c8b9567150582cbd087d1c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/034df9478013dc05d06598c6e39494a8b518b004", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/034df9478013dc05d06598c6e39494a8b518b004", "html_url": "https://github.com/rust-lang/rust/commit/034df9478013dc05d06598c6e39494a8b518b004", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/034df9478013dc05d06598c6e39494a8b518b004/comments", "author": {"login": "trixnz", "id": 2995953, "node_id": "MDQ6VXNlcjI5OTU5NTM=", "avatar_url": "https://avatars.githubusercontent.com/u/2995953?v=4", "gravatar_id": "", "url": "https://api.github.com/users/trixnz", "html_url": "https://github.com/trixnz", "followers_url": "https://api.github.com/users/trixnz/followers", "following_url": "https://api.github.com/users/trixnz/following{/other_user}", "gists_url": "https://api.github.com/users/trixnz/gists{/gist_id}", "starred_url": "https://api.github.com/users/trixnz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/trixnz/subscriptions", "organizations_url": "https://api.github.com/users/trixnz/orgs", "repos_url": "https://api.github.com/users/trixnz/repos", "events_url": "https://api.github.com/users/trixnz/events{/privacy}", "received_events_url": "https://api.github.com/users/trixnz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "trixnz", "id": 2995953, "node_id": "MDQ6VXNlcjI5OTU5NTM=", "avatar_url": "https://avatars.githubusercontent.com/u/2995953?v=4", "gravatar_id": "", "url": "https://api.github.com/users/trixnz", "html_url": "https://github.com/trixnz", "followers_url": "https://api.github.com/users/trixnz/followers", "following_url": "https://api.github.com/users/trixnz/following{/other_user}", "gists_url": "https://api.github.com/users/trixnz/gists{/gist_id}", "starred_url": "https://api.github.com/users/trixnz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/trixnz/subscriptions", "organizations_url": "https://api.github.com/users/trixnz/orgs", "repos_url": "https://api.github.com/users/trixnz/repos", "events_url": "https://api.github.com/users/trixnz/events{/privacy}", "received_events_url": "https://api.github.com/users/trixnz/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ae774103501337ed63b42b673c6c4fdbf369e80e", "url": "https://api.github.com/repos/rust-lang/rust/commits/ae774103501337ed63b42b673c6c4fdbf369e80e", "html_url": "https://github.com/rust-lang/rust/commit/ae774103501337ed63b42b673c6c4fdbf369e80e"}], "stats": {"total": 28, "additions": 25, "deletions": 3}, "files": [{"sha": "140fabce76b4d5401414e96da5a6755f385147e2", "filename": "src/librustc_typeck/check/compare_method.rs", "status": "modified", "additions": 23, "deletions": 1, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/034df9478013dc05d06598c6e39494a8b518b004/src%2Flibrustc_typeck%2Fcheck%2Fcompare_method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/034df9478013dc05d06598c6e39494a8b518b004/src%2Flibrustc_typeck%2Fcheck%2Fcompare_method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fcompare_method.rs?ref=034df9478013dc05d06598c6e39494a8b518b004", "patch": "@@ -14,6 +14,8 @@ use rustc::ty;\n use rustc::traits::{self, ProjectionMode};\n use rustc::ty::error::ExpectedFound;\n use rustc::ty::subst::{self, Subst, Substs, VecPerParamSpace};\n+use rustc::hir::map::Node;\n+use rustc::hir::{ImplItemKind, TraitItem_};\n \n use syntax::ast;\n use syntax_pos::Span;\n@@ -461,7 +463,7 @@ pub fn compare_const_impl<'a, 'tcx>(ccx: &CrateCtxt<'a, 'tcx>,\n         // Compute skolemized form of impl and trait const tys.\n         let impl_ty = impl_c.ty.subst(tcx, impl_to_skol_substs);\n         let trait_ty = trait_c.ty.subst(tcx, &trait_to_skol_substs);\n-        let origin = TypeOrigin::Misc(impl_c_span);\n+        let mut origin = TypeOrigin::Misc(impl_c_span);\n \n         let err = infcx.commit_if_ok(|_| {\n             // There is no \"body\" here, so just pass dummy id.\n@@ -496,11 +498,31 @@ pub fn compare_const_impl<'a, 'tcx>(ccx: &CrateCtxt<'a, 'tcx>,\n             debug!(\"checking associated const for compatibility: impl ty {:?}, trait ty {:?}\",\n                    impl_ty,\n                    trait_ty);\n+\n+            // Locate the Span containing just the type of the offending impl\n+            if let Some(impl_trait_node) = tcx.map.get_if_local(impl_c.def_id) {\n+                if let Node::NodeImplItem(impl_trait_item) = impl_trait_node {\n+                    if let ImplItemKind::Const(ref ty, _) = impl_trait_item.node {\n+                        origin = TypeOrigin::Misc(ty.span);\n+                    }\n+                }\n+            }\n+\n             let mut diag = struct_span_err!(\n                 tcx.sess, origin.span(), E0326,\n                 \"implemented const `{}` has an incompatible type for trait\",\n                 trait_c.name\n             );\n+\n+            // Add a label to the Span containing just the type of the item\n+            if let Some(orig_trait_node) = tcx.map.get_if_local(trait_c.def_id) {\n+                if let Node::NodeTraitItem(orig_trait_item) = orig_trait_node {\n+                    if let TraitItem_::ConstTraitItem(ref ty, _) = orig_trait_item.node {\n+                        diag.span_label(ty.span, &format!(\"original trait requirement\"));\n+                    }\n+                }\n+            }\n+\n             infcx.note_type_err(\n                 &mut diag, origin,\n                 Some(infer::ValuePairs::Types(ExpectedFound {"}, {"sha": "b3776091682da18b3f149c01f8786e830657df6d", "filename": "src/test/compile-fail/associated-const-impl-wrong-type.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/034df9478013dc05d06598c6e39494a8b518b004/src%2Ftest%2Fcompile-fail%2Fassociated-const-impl-wrong-type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/034df9478013dc05d06598c6e39494a8b518b004/src%2Ftest%2Fcompile-fail%2Fassociated-const-impl-wrong-type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fassociated-const-impl-wrong-type.rs?ref=034df9478013dc05d06598c6e39494a8b518b004", "patch": "@@ -11,15 +11,15 @@\n #![feature(associated_consts)]\n \n trait Foo {\n-    const BAR: u32;\n+    const BAR: u32; //~ NOTE original trait requirement\n }\n \n struct SignedBar;\n \n impl Foo for SignedBar {\n     const BAR: i32 = -1;\n     //~^ ERROR implemented const `BAR` has an incompatible type for trait [E0326]\n-    //~| expected u32, found i32\n+    //~| NOTE expected u32, found i32\n }\n \n fn main() {}"}]}