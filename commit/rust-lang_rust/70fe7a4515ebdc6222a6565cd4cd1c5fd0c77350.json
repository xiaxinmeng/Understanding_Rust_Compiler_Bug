{"sha": "70fe7a4515ebdc6222a6565cd4cd1c5fd0c77350", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcwZmU3YTQ1MTVlYmRjNjIyMmE2NTY1Y2Q0Y2QxYzVmZDBjNzczNTA=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-04-20T21:25:27Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-04-20T21:25:27Z"}, "message": "Merge #8606\n\n8606: fix: no more  Registering progress handler for token rustAnalyzer/Ind\u2026 r=jonas-schievink a=matklad\n\n\u2026exing failed.\r\n\r\ncloses #8509\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "ecc5755941360a672c5ef1f6a040fb9f03c4b7d7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ecc5755941360a672c5ef1f6a040fb9f03c4b7d7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/70fe7a4515ebdc6222a6565cd4cd1c5fd0c77350", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgf0bHCRBK7hj4Ov3rIwAAGNgIAC1G1xIgxV7OovaKooHsV4Je\nc++14a3EghOqcxjboqBi0dHs1D9aVDw7YDooXsBLZCEvviNCR39CgvcbNtDSCrI5\nJUKMlDbO8X2C72XU8oAhaMBjGy5qtKy8ZKeNCLDVE0rY+7/hBlGxCP920Cd9OZCR\nnPH9QzZizEMg1hR0mS5jb+L467cE/BuFDDtdUA7j81vZKhgUW/vlRkCosgWI8zW2\n/7DzKtN4ny4L5hdaKQEIr1E109X/bTgZybDdSRSvhaf3EWYTMCqkwGYBmYwpPFNK\nLG1cNk1Uib1wJxTXfTLlsDP/Cy+zdU7fB8Hinuon46viMMw1IkOpTKg71zLtn8o=\n=i3Fy\n-----END PGP SIGNATURE-----\n", "payload": "tree ecc5755941360a672c5ef1f6a040fb9f03c4b7d7\nparent ad131049c4cd1302af1a5616ff83d0e1f0cadea2\nparent cdfe5a8be01dd7427db734f17c5ec0de7bbe6c80\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1618953927 +0000\ncommitter GitHub <noreply@github.com> 1618953927 +0000\n\nMerge #8606\n\n8606: fix: no more  Registering progress handler for token rustAnalyzer/Ind\u2026 r=jonas-schievink a=matklad\n\n\u2026exing failed.\r\n\r\ncloses #8509\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/70fe7a4515ebdc6222a6565cd4cd1c5fd0c77350", "html_url": "https://github.com/rust-lang/rust/commit/70fe7a4515ebdc6222a6565cd4cd1c5fd0c77350", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/70fe7a4515ebdc6222a6565cd4cd1c5fd0c77350/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ad131049c4cd1302af1a5616ff83d0e1f0cadea2", "url": "https://api.github.com/repos/rust-lang/rust/commits/ad131049c4cd1302af1a5616ff83d0e1f0cadea2", "html_url": "https://github.com/rust-lang/rust/commit/ad131049c4cd1302af1a5616ff83d0e1f0cadea2"}, {"sha": "cdfe5a8be01dd7427db734f17c5ec0de7bbe6c80", "url": "https://api.github.com/repos/rust-lang/rust/commits/cdfe5a8be01dd7427db734f17c5ec0de7bbe6c80", "html_url": "https://github.com/rust-lang/rust/commit/cdfe5a8be01dd7427db734f17c5ec0de7bbe6c80"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "03597f5078b7a5735e0f7117ba307c94439ffc2d", "filename": "crates/ide/src/prime_caches.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/70fe7a4515ebdc6222a6565cd4cd1c5fd0c77350/crates%2Fide%2Fsrc%2Fprime_caches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/70fe7a4515ebdc6222a6565cd4cd1c5fd0c77350/crates%2Fide%2Fsrc%2Fprime_caches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fprime_caches.rs?ref=70fe7a4515ebdc6222a6565cd4cd1c5fd0c77350", "patch": "@@ -27,6 +27,7 @@ pub(crate) fn prime_caches(db: &RootDatabase, cb: &(dyn Fn(PrimeCachesProgress)\n     let topo = &graph.crates_in_topological_order();\n \n     cb(PrimeCachesProgress::Started);\n+    let _d = stdx::defer(|| cb(PrimeCachesProgress::Finished));\n \n     // FIXME: This would be easy to parallelize, since it's in the ideal ordering for that.\n     // Unfortunately rayon prevents panics from propagation out of a `scope`, which breaks\n@@ -41,6 +42,4 @@ pub(crate) fn prime_caches(db: &RootDatabase, cb: &(dyn Fn(PrimeCachesProgress)\n         });\n         db.crate_def_map(*krate);\n     }\n-\n-    cb(PrimeCachesProgress::Finished);\n }"}, {"sha": "857567a853aabf46a91b55b5ce3af49453258c86", "filename": "crates/stdx/src/lib.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/70fe7a4515ebdc6222a6565cd4cd1c5fd0c77350/crates%2Fstdx%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/70fe7a4515ebdc6222a6565cd4cd1c5fd0c77350/crates%2Fstdx%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fstdx%2Fsrc%2Flib.rs?ref=70fe7a4515ebdc6222a6565cd4cd1c5fd0c77350", "patch": "@@ -179,6 +179,18 @@ where\n     start..start + len\n }\n \n+pub fn defer<F: FnOnce()>(f: F) -> impl Drop {\n+    struct D<F: FnOnce()>(Option<F>);\n+    impl<F: FnOnce()> Drop for D<F> {\n+        fn drop(&mut self) {\n+            if let Some(f) = self.0.take() {\n+                f()\n+            }\n+        }\n+    }\n+    D(Some(f))\n+}\n+\n #[repr(transparent)]\n pub struct JodChild(pub std::process::Child);\n "}]}