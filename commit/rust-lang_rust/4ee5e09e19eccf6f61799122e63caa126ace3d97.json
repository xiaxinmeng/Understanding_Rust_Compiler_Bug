{"sha": "4ee5e09e19eccf6f61799122e63caa126ace3d97", "node_id": "C_kwDOAAsO6NoAKDRlZTVlMDllMTllY2NmNmY2MTc5OTEyMmU2M2NhYTEyNmFjZTNkOTc", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-01-17T19:21:26Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-01-17T19:21:26Z"}, "message": "Rollup merge of #106784 - lyming2007:issue-106695-fix, r=WaffleLapkin\n\nprevent E0512 from emitting [type error] by checking the references_error\n\nbut still emit E0512\nthis will fix #106695", "tree": {"sha": "713816033e7f1b4f9169370fe65565cf3494b484", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/713816033e7f1b4f9169370fe65565cf3494b484"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4ee5e09e19eccf6f61799122e63caa126ace3d97", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjxvU2CRBK7hj4Ov3rIwAAeWkIAKNBcaZQsYiLCiniTlJZgMFS\nw/1rtYu3iLETrxzRsSv9fH8DUZmqsnSvSv90zqbD0WTki7IEfvWkvCPIO0H5h3Iz\nvZPau8Xtnu+BpeStZD6L7dTjvxi3xwozF60e15Njq3vSi0k29iBbJIQrYQjcil8Y\nWDXOij87/0nj4w7aPEUo+d+hwSbbzPp4EUcNg86A0OFx5uO+pywRomsFfuAUDy4q\nk1n9afnuICrrihKjR9NE1y097OImUHy5Dwmu0yqH8CAFDGnc1GKnzuLGHlvMZ9aa\nE2AdEfZjSLTsVpIGvyJ7+Dm43YcPPkCVd/nivgtNlXuGCQP9XlCD/9KtKnjJU/c=\n=nKcX\n-----END PGP SIGNATURE-----\n", "payload": "tree 713816033e7f1b4f9169370fe65565cf3494b484\nparent 68f12338afed4162317225850719f558cefad71f\nparent d1478a5600f43637751215802d5df4541e9a005c\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1673983286 +0100\ncommitter GitHub <noreply@github.com> 1673983286 +0100\n\nRollup merge of #106784 - lyming2007:issue-106695-fix, r=WaffleLapkin\n\nprevent E0512 from emitting [type error] by checking the references_error\n\nbut still emit E0512\nthis will fix #106695\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4ee5e09e19eccf6f61799122e63caa126ace3d97", "html_url": "https://github.com/rust-lang/rust/commit/4ee5e09e19eccf6f61799122e63caa126ace3d97", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4ee5e09e19eccf6f61799122e63caa126ace3d97/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "68f12338afed4162317225850719f558cefad71f", "url": "https://api.github.com/repos/rust-lang/rust/commits/68f12338afed4162317225850719f558cefad71f", "html_url": "https://github.com/rust-lang/rust/commit/68f12338afed4162317225850719f558cefad71f"}, {"sha": "d1478a5600f43637751215802d5df4541e9a005c", "url": "https://api.github.com/repos/rust-lang/rust/commits/d1478a5600f43637751215802d5df4541e9a005c", "html_url": "https://github.com/rust-lang/rust/commit/d1478a5600f43637751215802d5df4541e9a005c"}], "stats": {"total": 41, "additions": 15, "deletions": 26}, "files": [{"sha": "3c873024c924f3837c473312fb3c0395be8eeaa1", "filename": "compiler/rustc_hir_typeck/src/intrinsicck.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/4ee5e09e19eccf6f61799122e63caa126ace3d97/compiler%2Frustc_hir_typeck%2Fsrc%2Fintrinsicck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4ee5e09e19eccf6f61799122e63caa126ace3d97/compiler%2Frustc_hir_typeck%2Fsrc%2Fintrinsicck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fintrinsicck.rs?ref=4ee5e09e19eccf6f61799122e63caa126ace3d97", "patch": "@@ -105,6 +105,16 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n         } else {\n             err.note(&format!(\"source type: `{}` ({})\", from, skeleton_string(from, sk_from)))\n                 .note(&format!(\"target type: `{}` ({})\", to, skeleton_string(to, sk_to)));\n+            let mut should_delay_as_bug = false;\n+            if let Err(LayoutError::Unknown(bad_from)) = sk_from && bad_from.references_error() {\n+                should_delay_as_bug = true;\n+            }\n+            if let Err(LayoutError::Unknown(bad_to)) = sk_to && bad_to.references_error() {\n+                should_delay_as_bug = true;\n+            }\n+            if should_delay_as_bug {\n+                err.delay_as_bug();\n+            }\n         }\n         err.emit();\n     }"}, {"sha": "057930f0c1ce759a4d12c4ebff64c43076ab3714", "filename": "tests/ui/type-alias-impl-trait/issue-53092-2.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4ee5e09e19eccf6f61799122e63caa126ace3d97/tests%2Fui%2Ftype-alias-impl-trait%2Fissue-53092-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4ee5e09e19eccf6f61799122e63caa126ace3d97/tests%2Fui%2Ftype-alias-impl-trait%2Fissue-53092-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftype-alias-impl-trait%2Fissue-53092-2.rs?ref=4ee5e09e19eccf6f61799122e63caa126ace3d97", "patch": "@@ -4,7 +4,6 @@\n type Bug<T, U> = impl Fn(T) -> U + Copy; //~ ERROR cycle detected\n \n const CONST_BUG: Bug<u8, ()> = unsafe { std::mem::transmute(|_: u8| ()) };\n-//~^ ERROR: cannot transmute\n \n fn make_bug<T, U: From<T>>() -> Bug<T, U> {\n     |x| x.into() //~ ERROR the trait bound `U: From<T>` is not satisfied"}, {"sha": "2565a28b493541c1a48bc195e01546d1dfe66160", "filename": "tests/ui/type-alias-impl-trait/issue-53092-2.stderr", "status": "modified", "additions": 4, "deletions": 13, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/4ee5e09e19eccf6f61799122e63caa126ace3d97/tests%2Fui%2Ftype-alias-impl-trait%2Fissue-53092-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4ee5e09e19eccf6f61799122e63caa126ace3d97/tests%2Fui%2Ftype-alias-impl-trait%2Fissue-53092-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftype-alias-impl-trait%2Fissue-53092-2.stderr?ref=4ee5e09e19eccf6f61799122e63caa126ace3d97", "patch": "@@ -24,23 +24,14 @@ LL | |     CONST_BUG(0);\n LL | | }\n    | |_^\n \n-error[E0512]: cannot transmute between types of different sizes, or dependently-sized types\n-  --> $DIR/issue-53092-2.rs:6:41\n-   |\n-LL | const CONST_BUG: Bug<u8, ()> = unsafe { std::mem::transmute(|_: u8| ()) };\n-   |                                         ^^^^^^^^^^^^^^^^^^^\n-   |\n-   = note: source type: `[closure@$DIR/issue-53092-2.rs:6:61: 6:68]` (0 bits)\n-   = note: target type: `Bug<u8, ()>` (size can vary because of [type error])\n-\n error[E0277]: the trait bound `U: From<T>` is not satisfied\n-  --> $DIR/issue-53092-2.rs:10:5\n+  --> $DIR/issue-53092-2.rs:9:5\n    |\n LL |     |x| x.into()\n    |     ^^^^^^^^^^^^ the trait `From<T>` is not implemented for `U`\n    |\n note: required by a bound in `make_bug`\n-  --> $DIR/issue-53092-2.rs:9:19\n+  --> $DIR/issue-53092-2.rs:8:19\n    |\n LL | fn make_bug<T, U: From<T>>() -> Bug<T, U> {\n    |                   ^^^^^^^ required by this bound in `make_bug`\n@@ -49,7 +40,7 @@ help: consider restricting type parameter `U`\n LL | type Bug<T, U: std::convert::From<T>> = impl Fn(T) -> U + Copy;\n    |              +++++++++++++++++++++++\n \n-error: aborting due to 3 previous errors\n+error: aborting due to 2 previous errors\n \n-Some errors have detailed explanations: E0277, E0391, E0512.\n+Some errors have detailed explanations: E0277, E0391.\n For more information about an error, try `rustc --explain E0277`."}, {"sha": "0f0a02e97d82db4054e6531932337b7c3b939a3a", "filename": "tests/ui/type-alias-impl-trait/no_inferrable_concrete_type.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4ee5e09e19eccf6f61799122e63caa126ace3d97/tests%2Fui%2Ftype-alias-impl-trait%2Fno_inferrable_concrete_type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4ee5e09e19eccf6f61799122e63caa126ace3d97/tests%2Fui%2Ftype-alias-impl-trait%2Fno_inferrable_concrete_type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftype-alias-impl-trait%2Fno_inferrable_concrete_type.rs?ref=4ee5e09e19eccf6f61799122e63caa126ace3d97", "patch": "@@ -15,5 +15,4 @@ mod foo {\n \n fn main() {\n     let _: foo::Foo = std::mem::transmute(0u8);\n-    //~^ ERROR cannot transmute between types of different sizes, or dependently-sized types\n }"}, {"sha": "f3e8ae9c7dbae9ff379197ee592b8de713090669", "filename": "tests/ui/type-alias-impl-trait/no_inferrable_concrete_type.stderr", "status": "modified", "additions": 1, "deletions": 11, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/4ee5e09e19eccf6f61799122e63caa126ace3d97/tests%2Fui%2Ftype-alias-impl-trait%2Fno_inferrable_concrete_type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/4ee5e09e19eccf6f61799122e63caa126ace3d97/tests%2Fui%2Ftype-alias-impl-trait%2Fno_inferrable_concrete_type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftype-alias-impl-trait%2Fno_inferrable_concrete_type.stderr?ref=4ee5e09e19eccf6f61799122e63caa126ace3d97", "patch": "@@ -6,15 +6,5 @@ LL |     pub type Foo = impl Copy;\n    |\n    = note: `Foo` must be used in combination with a concrete type within the same module\n \n-error[E0512]: cannot transmute between types of different sizes, or dependently-sized types\n-  --> $DIR/no_inferrable_concrete_type.rs:17:23\n-   |\n-LL |     let _: foo::Foo = std::mem::transmute(0u8);\n-   |                       ^^^^^^^^^^^^^^^^^^^\n-   |\n-   = note: source type: `u8` (8 bits)\n-   = note: target type: `Foo` (size can vary because of [type error])\n-\n-error: aborting due to 2 previous errors\n+error: aborting due to previous error\n \n-For more information about this error, try `rustc --explain E0512`."}]}