{"sha": "55e237284ffa561b4a989682ea4093509c1c345e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU1ZTIzNzI4NGZmYTU2MWI0YTk4OTY4MmVhNDA5MzUwOWMxYzM0NWU=", "commit": {"author": {"name": "Nikita Popov", "email": "nikita.ppv@gmail.com", "date": "2021-02-05T14:52:49Z"}, "committer": {"name": "Nikita Popov", "email": "nikita.ppv@gmail.com", "date": "2021-02-06T12:05:56Z"}, "message": "Upgrade wasm32 image to Ubuntu 20.04\n\nThis switches the wasm32 image, which is used to test\nwasm32-unknown-emscripten to Ubuntu 20.04. While at it, enable\nmost of the excluded tests, as they seem to work fine with some\nminor fixes.", "tree": {"sha": "bac7b968aaeed637b64ffa233a839e49dc41ee03", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bac7b968aaeed637b64ffa233a839e49dc41ee03"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/55e237284ffa561b4a989682ea4093509c1c345e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/55e237284ffa561b4a989682ea4093509c1c345e", "html_url": "https://github.com/rust-lang/rust/commit/55e237284ffa561b4a989682ea4093509c1c345e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/55e237284ffa561b4a989682ea4093509c1c345e/comments", "author": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6ad11e2e25919b75ebbc36d7910f2a1126a7e873", "url": "https://api.github.com/repos/rust-lang/rust/commits/6ad11e2e25919b75ebbc36d7910f2a1126a7e873", "html_url": "https://github.com/rust-lang/rust/commit/6ad11e2e25919b75ebbc36d7910f2a1126a7e873"}], "stats": {"total": 21, "additions": 10, "deletions": 11}, "files": [{"sha": "83466eb0904fb0a34adef3c79ea31a6c280faead", "filename": "library/std/src/lazy/tests.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/55e237284ffa561b4a989682ea4093509c1c345e/library%2Fstd%2Fsrc%2Flazy%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/55e237284ffa561b4a989682ea4093509c1c345e/library%2Fstd%2Fsrc%2Flazy%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Flazy%2Ftests.rs?ref=55e237284ffa561b4a989682ea4093509c1c345e", "patch": "@@ -48,6 +48,7 @@ fn spawn_and_wait<R: Send + 'static>(f: impl FnOnce() -> R + Send + 'static) ->\n }\n \n #[test]\n+#[cfg_attr(target_os = \"emscripten\", ignore)]\n fn sync_once_cell() {\n     static ONCE_CELL: SyncOnceCell<i32> = SyncOnceCell::new();\n \n@@ -81,6 +82,7 @@ fn sync_once_cell_get_unchecked() {\n }\n \n #[test]\n+#[cfg_attr(target_os = \"emscripten\", ignore)]\n fn sync_once_cell_drop() {\n     static DROP_CNT: AtomicUsize = AtomicUsize::new(0);\n     struct Dropper;\n@@ -158,6 +160,7 @@ fn into_inner() {\n }\n \n #[test]\n+#[cfg_attr(target_os = \"emscripten\", ignore)]\n fn sync_lazy_new() {\n     static CALLED: AtomicUsize = AtomicUsize::new(0);\n     static SYNC_LAZY: SyncLazy<i32> = SyncLazy::new(|| {\n@@ -204,6 +207,7 @@ fn sync_lazy_default() {\n }\n \n #[test]\n+#[cfg_attr(target_os = \"emscripten\", ignore)]\n fn static_sync_lazy() {\n     static XS: SyncLazy<Vec<i32>> = SyncLazy::new(|| {\n         let mut xs = Vec::new();\n@@ -279,6 +283,7 @@ fn eval_once_macro() {\n }\n \n #[test]\n+#[cfg_attr(target_os = \"emscripten\", ignore)]\n fn sync_once_cell_does_not_leak_partially_constructed_boxes() {\n     static ONCE_CELL: SyncOnceCell<String> = SyncOnceCell::new();\n "}, {"sha": "e4adf55fb7b165ad0c7497022e45aaac5d911f39", "filename": "library/test/src/tests.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/55e237284ffa561b4a989682ea4093509c1c345e/library%2Ftest%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/55e237284ffa561b4a989682ea4093509c1c345e/library%2Ftest%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Ftest%2Fsrc%2Ftests.rs?ref=55e237284ffa561b4a989682ea4093509c1c345e", "patch": "@@ -27,7 +27,6 @@ use crate::{\n     },\n     time::{TestTimeOptions, TimeThreshold},\n };\n-use std::any::TypeId;\n use std::sync::mpsc::channel;\n use std::time::Duration;\n \n@@ -198,6 +197,7 @@ fn test_should_panic_bad_message() {\n #[cfg(not(target_os = \"emscripten\"))]\n fn test_should_panic_non_string_message_type() {\n     use crate::tests::TrFailedMsg;\n+    use std::any::TypeId;\n     fn f() {\n         panic!(1i32);\n     }"}, {"sha": "878c4e341589d8e52598f71d4440e3023febb825", "filename": "src/ci/docker/host-x86_64/wasm32/Dockerfile", "status": "modified", "additions": 4, "deletions": 10, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/55e237284ffa561b4a989682ea4093509c1c345e/src%2Fci%2Fdocker%2Fhost-x86_64%2Fwasm32%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/55e237284ffa561b4a989682ea4093509c1c345e/src%2Fci%2Fdocker%2Fhost-x86_64%2Fwasm32%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fwasm32%2FDockerfile?ref=55e237284ffa561b4a989682ea4093509c1c345e", "patch": "@@ -1,6 +1,6 @@\n-FROM ubuntu:16.04\n+FROM ubuntu:20.04\n \n-RUN apt-get update && apt-get install -y --no-install-recommends \\\n+RUN apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \\\n   g++ \\\n   make \\\n   ninja-build \\\n@@ -51,12 +51,6 @@ ENV EMCC_CFLAGS=-O1\n # Emscripten installation is user-specific\n ENV NO_CHANGE_USER=1\n \n-# FIXME: Re-enable these tests once https://github.com/rust-lang/cargo/pull/7476\n-# is picked up by CI\n+# Exclude library/alloc due to OOM in benches.\n ENV SCRIPT python3 ../x.py test --stage 2 --host='' --target $TARGETS \\\n-    --exclude library/core \\\n-    --exclude library/alloc \\\n-    --exclude library/proc_macro \\\n-    --exclude library/std \\\n-    --exclude library/term \\\n-    --exclude library/test\n+    --exclude library/alloc"}]}