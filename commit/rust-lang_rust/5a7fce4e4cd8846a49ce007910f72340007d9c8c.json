{"sha": "5a7fce4e4cd8846a49ce007910f72340007d9c8c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVhN2ZjZTRlNGNkODg0NmE0OWNlMDA3OTEwZjcyMzQwMDA3ZDljOGM=", "commit": {"author": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-02-01T23:18:10Z"}, "committer": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-02-01T23:23:53Z"}, "message": "Pass aliases to ImportData", "tree": {"sha": "7ec654f142d821e5ad5f9347bb84367fef0943d6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7ec654f142d821e5ad5f9347bb84367fef0943d6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5a7fce4e4cd8846a49ce007910f72340007d9c8c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5a7fce4e4cd8846a49ce007910f72340007d9c8c", "html_url": "https://github.com/rust-lang/rust/commit/5a7fce4e4cd8846a49ce007910f72340007d9c8c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5a7fce4e4cd8846a49ce007910f72340007d9c8c/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aa5f6a1ee8b56343e9f3dc9b1578d56f29dd2bc8", "url": "https://api.github.com/repos/rust-lang/rust/commits/aa5f6a1ee8b56343e9f3dc9b1578d56f29dd2bc8", "html_url": "https://github.com/rust-lang/rust/commit/aa5f6a1ee8b56343e9f3dc9b1578d56f29dd2bc8"}], "stats": {"total": 55, "additions": 47, "deletions": 8}, "files": [{"sha": "df87f520fab42f8a67de2d83fe1f10347364c8a0", "filename": "crates/ra_hir/src/nameres/lower.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/5a7fce4e4cd8846a49ce007910f72340007d9c8c/crates%2Fra_hir%2Fsrc%2Fnameres%2Flower.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5a7fce4e4cd8846a49ce007910f72340007d9c8c/crates%2Fra_hir%2Fsrc%2Fnameres%2Flower.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fnameres%2Flower.rs?ref=5a7fce4e4cd8846a49ce007910f72340007d9c8c", "patch": "@@ -21,6 +21,7 @@ impl_arena_id!(ImportId);\n #[derive(Debug, PartialEq, Eq)]\n pub(super) struct ImportData {\n     pub(super) path: Path,\n+    pub(super) alias: Option<Name>,\n     pub(super) is_glob: bool,\n }\n \n@@ -209,9 +210,10 @@ impl LoweredModule {\n     }\n \n     fn add_use_item(&mut self, source_map: &mut ImportSourceMap, item: &ast::UseItem) {\n-        Path::expand_use_item(item, |path, segment| {\n+        Path::expand_use_item(item, |path, segment, alias| {\n             let import = self.imports.alloc(ImportData {\n                 path,\n+                alias,\n                 is_glob: segment.is_none(),\n             });\n             if let Some(segment) = segment {"}, {"sha": "cb0a045004bdc7aa19e2db6967ec3e05f567b23c", "filename": "crates/ra_hir/src/path.rs", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/5a7fce4e4cd8846a49ce007910f72340007d9c8c/crates%2Fra_hir%2Fsrc%2Fpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5a7fce4e4cd8846a49ce007910f72340007d9c8c/crates%2Fra_hir%2Fsrc%2Fpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fpath.rs?ref=5a7fce4e4cd8846a49ce007910f72340007d9c8c", "patch": "@@ -1,6 +1,6 @@\n use std::sync::Arc;\n \n-use ra_syntax::{ast, AstNode};\n+use ra_syntax::{ast::{self, NameOwner}, AstNode};\n \n use crate::{Name, AsName, type_ref::TypeRef};\n \n@@ -46,7 +46,7 @@ impl Path {\n     /// Calls `cb` with all paths, represented by this use item.\n     pub fn expand_use_item<'a>(\n         item: &'a ast::UseItem,\n-        mut cb: impl FnMut(Path, Option<&'a ast::PathSegment>),\n+        mut cb: impl FnMut(Path, Option<&'a ast::PathSegment>, Option<Name>),\n     ) {\n         if let Some(tree) = item.use_tree() {\n             expand_use_tree(None, tree, &mut cb);\n@@ -164,7 +164,7 @@ impl From<Name> for Path {\n fn expand_use_tree<'a>(\n     prefix: Option<Path>,\n     tree: &'a ast::UseTree,\n-    cb: &mut impl FnMut(Path, Option<&'a ast::PathSegment>),\n+    cb: &mut impl FnMut(Path, Option<&'a ast::PathSegment>, Option<Name>),\n ) {\n     if let Some(use_tree_list) = tree.use_tree_list() {\n         let prefix = match tree.path() {\n@@ -181,24 +181,25 @@ fn expand_use_tree<'a>(\n             expand_use_tree(prefix.clone(), child_tree, cb);\n         }\n     } else {\n+        let alias = tree.alias().and_then(|a| a.name()).map(|a| a.as_name());\n         if let Some(ast_path) = tree.path() {\n             // Handle self in a path.\n             // E.g. `use something::{self, <...>}`\n             if ast_path.qualifier().is_none() {\n                 if let Some(segment) = ast_path.segment() {\n                     if segment.kind() == Some(ast::PathSegmentKind::SelfKw) {\n                         if let Some(prefix) = prefix {\n-                            cb(prefix, Some(segment));\n+                            cb(prefix, Some(segment), alias);\n                             return;\n                         }\n                     }\n                 }\n             }\n             if let Some(path) = convert_path(prefix, ast_path) {\n                 if tree.has_star() {\n-                    cb(path, None)\n+                    cb(path, None, alias)\n                 } else if let Some(segment) = ast_path.segment() {\n-                    cb(path, Some(segment))\n+                    cb(path, Some(segment), alias)\n                 };\n             }\n             // TODO: report errors somewhere"}, {"sha": "60480c69998e23f6301ef9703fd53524a6891be5", "filename": "crates/ra_syntax/src/ast/generated.rs", "status": "modified", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/5a7fce4e4cd8846a49ce007910f72340007d9c8c/crates%2Fra_syntax%2Fsrc%2Fast%2Fgenerated.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5a7fce4e4cd8846a49ce007910f72340007d9c8c/crates%2Fra_syntax%2Fsrc%2Fast%2Fgenerated.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fast%2Fgenerated.rs?ref=5a7fce4e4cd8846a49ce007910f72340007d9c8c", "patch": "@@ -17,6 +17,35 @@ use crate::{\n     ast::{self, AstNode},\n };\n \n+// Alias\n+#[derive(Debug, PartialEq, Eq, Hash)]\n+#[repr(transparent)]\n+pub struct Alias {\n+    pub(crate) syntax: SyntaxNode,\n+}\n+unsafe impl TransparentNewType for Alias {\n+    type Repr = rowan::SyntaxNode<RaTypes>;\n+}\n+\n+impl AstNode for Alias {\n+    fn cast(syntax: &SyntaxNode) -> Option<&Self> {\n+        match syntax.kind() {\n+            ALIAS => Some(Alias::from_repr(syntax.into_repr())),\n+            _ => None,\n+        }\n+    }\n+    fn syntax(&self) -> &SyntaxNode { &self.syntax }\n+}\n+\n+impl ToOwned for Alias {\n+    type Owned = TreeArc<Alias>;\n+    fn to_owned(&self) -> TreeArc<Alias> { TreeArc::cast(self.syntax.to_owned()) }\n+}\n+\n+\n+impl ast::NameOwner for Alias {}\n+impl Alias {}\n+\n // ArgList\n #[derive(Debug, PartialEq, Eq, Hash)]\n #[repr(transparent)]\n@@ -4176,6 +4205,10 @@ impl UseTree {\n     pub fn use_tree_list(&self) -> Option<&UseTreeList> {\n         super::child_opt(self)\n     }\n+\n+    pub fn alias(&self) -> Option<&Alias> {\n+        super::child_opt(self)\n+    }\n }\n \n // UseTreeList"}, {"sha": "a2ccd7cb9466f5489ee3874fdffb746ce92dbb4e", "filename": "crates/ra_syntax/src/grammar.ron", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5a7fce4e4cd8846a49ce007910f72340007d9c8c/crates%2Fra_syntax%2Fsrc%2Fgrammar.ron", "raw_url": "https://github.com/rust-lang/rust/raw/5a7fce4e4cd8846a49ce007910f72340007d9c8c/crates%2Fra_syntax%2Fsrc%2Fgrammar.ron", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Fsrc%2Fgrammar.ron?ref=5a7fce4e4cd8846a49ce007910f72340007d9c8c", "patch": "@@ -593,7 +593,10 @@ Grammar(\n             options: [ \"UseTree\" ]\n         ),\n         \"UseTree\": (\n-            options: [ \"Path\", \"UseTreeList\" ]\n+            options: [ \"Path\", \"UseTreeList\", \"Alias\" ]\n+        ),\n+        \"Alias\": (\n+            traits: [\"NameOwner\"],\n         ),\n         \"UseTreeList\": (\n             collections: [[\"use_trees\", \"UseTree\"]]"}]}