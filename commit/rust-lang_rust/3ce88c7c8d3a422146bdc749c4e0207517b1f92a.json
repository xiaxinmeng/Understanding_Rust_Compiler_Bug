{"sha": "3ce88c7c8d3a422146bdc749c4e0207517b1f92a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNjZTg4YzdjOGQzYTQyMjE0NmJkYzc0OWM0ZTAyMDc1MTdiMWY5MmE=", "commit": {"author": {"name": "Corey Farwell", "email": "coreyf@rwell.org", "date": "2017-06-08T01:58:44Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-06-08T01:58:44Z"}, "message": "Rollup merge of #42490 - gaurikholkar:master, r=eddyb\n\nChanging error message from `contains interior mutability` to `may contain interior mutability`\n\nFixes #40313 . I have changed the message from `contains interior mutability` to `may contain interior mutability` for the following example\n```\nuse std::cell::Cell;\nuse std::panic::catch_unwind;\nfn main() {\n    let mut x = Cell::new(22);\n    catch_unwind(|| { x.set(23); });\n}\n```\nwhich has been added as a ui test.\n\nAlso, the message [here](https://github.com/gaurikholkar/rust/blob/master/src/librustc_mir/transform/qualify_consts.rs#L666) and it's respective `compile-fail` test have been modified.\n\ncc @nikomatsakis  @Mark-Simulacrum  @eddyb", "tree": {"sha": "b03d95cd3a30c560d6351bcd4e87c3921928145a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b03d95cd3a30c560d6351bcd4e87c3921928145a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3ce88c7c8d3a422146bdc749c4e0207517b1f92a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3ce88c7c8d3a422146bdc749c4e0207517b1f92a", "html_url": "https://github.com/rust-lang/rust/commit/3ce88c7c8d3a422146bdc749c4e0207517b1f92a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3ce88c7c8d3a422146bdc749c4e0207517b1f92a/comments", "author": {"login": "frewsxcv", "id": 416575, "node_id": "MDQ6VXNlcjQxNjU3NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/416575?v=4", "gravatar_id": "", "url": "https://api.github.com/users/frewsxcv", "html_url": "https://github.com/frewsxcv", "followers_url": "https://api.github.com/users/frewsxcv/followers", "following_url": "https://api.github.com/users/frewsxcv/following{/other_user}", "gists_url": "https://api.github.com/users/frewsxcv/gists{/gist_id}", "starred_url": "https://api.github.com/users/frewsxcv/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/frewsxcv/subscriptions", "organizations_url": "https://api.github.com/users/frewsxcv/orgs", "repos_url": "https://api.github.com/users/frewsxcv/repos", "events_url": "https://api.github.com/users/frewsxcv/events{/privacy}", "received_events_url": "https://api.github.com/users/frewsxcv/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0362891073f442a151b1255c57549b46beaa1fb3", "url": "https://api.github.com/repos/rust-lang/rust/commits/0362891073f442a151b1255c57549b46beaa1fb3", "html_url": "https://github.com/rust-lang/rust/commit/0362891073f442a151b1255c57549b46beaa1fb3"}, {"sha": "980a5b0529a94d68c1ab37170f810e7cf73996d8", "url": "https://api.github.com/repos/rust-lang/rust/commits/980a5b0529a94d68c1ab37170f810e7cf73996d8", "html_url": "https://github.com/rust-lang/rust/commit/980a5b0529a94d68c1ab37170f810e7cf73996d8"}], "stats": {"total": 48, "additions": 39, "deletions": 9}, "files": [{"sha": "6f3db0b388defe4607a37804a8344fa2cbf0eeeb", "filename": "src/librustc_mir/diagnostics.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/3ce88c7c8d3a422146bdc749c4e0207517b1f92a/src%2Flibrustc_mir%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ce88c7c8d3a422146bdc749c4e0207517b1f92a/src%2Flibrustc_mir%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdiagnostics.rs?ref=3ce88c7c8d3a422146bdc749c4e0207517b1f92a", "patch": "@@ -309,8 +309,8 @@ use std::sync::atomic::{AtomicUsize, ATOMIC_USIZE_INIT};\n \n const A: AtomicUsize = ATOMIC_USIZE_INIT;\n static B: &'static AtomicUsize = &A;\n-// error: cannot borrow a constant which contains interior mutability, create a\n-//        static instead\n+// error: cannot borrow a constant which may contain interior mutability,\n+//        create a static instead\n ```\n \n A `const` represents a constant value that should never change. If one takes\n@@ -338,8 +338,8 @@ use std::cell::Cell;\n \n const A: Cell<usize> = Cell::new(1);\n const B: &'static Cell<usize> = &A;\n-// error: cannot borrow a constant which contains interior mutability, create\n-//        a static instead\n+// error: cannot borrow a constant which may contain interior mutability,\n+//        create a static instead\n \n // or:\n struct C { a: Cell<usize> }"}, {"sha": "793cffdec89e36699d17852282337f40905b45b0", "filename": "src/librustc_mir/transform/qualify_consts.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3ce88c7c8d3a422146bdc749c4e0207517b1f92a/src%2Flibrustc_mir%2Ftransform%2Fqualify_consts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ce88c7c8d3a422146bdc749c4e0207517b1f92a/src%2Flibrustc_mir%2Ftransform%2Fqualify_consts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fqualify_consts.rs?ref=3ce88c7c8d3a422146bdc749c4e0207517b1f92a", "patch": "@@ -663,7 +663,7 @@ impl<'a, 'tcx> Visitor<'tcx> for Qualifier<'a, 'tcx, 'tcx> {\n                         self.add(Qualif::NOT_CONST);\n                         if self.mode != Mode::Fn {\n                             span_err!(self.tcx.sess, self.span, E0492,\n-                                      \"cannot borrow a constant which contains \\\n+                                      \"cannot borrow a constant which may contain \\\n                                        interior mutability, create a static instead\");\n                         }\n                     }"}, {"sha": "58356bc43eebc8ab8aa93c37dbd613d8b192fa39", "filename": "src/libstd/panic.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3ce88c7c8d3a422146bdc749c4e0207517b1f92a/src%2Flibstd%2Fpanic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ce88c7c8d3a422146bdc749c4e0207517b1f92a/src%2Flibstd%2Fpanic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fpanic.rs?ref=3ce88c7c8d3a422146bdc749c4e0207517b1f92a", "patch": "@@ -112,7 +112,7 @@ pub trait UnwindSafe {}\n /// This is a \"helper marker trait\" used to provide impl blocks for the\n /// `UnwindSafe` trait, for more information see that documentation.\n #[stable(feature = \"catch_unwind\", since = \"1.9.0\")]\n-#[rustc_on_unimplemented = \"the type {Self} contains interior mutability \\\n+#[rustc_on_unimplemented = \"the type {Self} may contain interior mutability \\\n                             and a reference may not be safely transferrable \\\n                             across a catch_unwind boundary\"]\n pub trait RefUnwindSafe {}"}, {"sha": "327b6946822987d1c0ed16ed71164a583e4b04eb", "filename": "src/test/compile-fail/issue-17718-const-borrow.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/3ce88c7c8d3a422146bdc749c4e0207517b1f92a/src%2Ftest%2Fcompile-fail%2Fissue-17718-const-borrow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ce88c7c8d3a422146bdc749c4e0207517b1f92a/src%2Ftest%2Fcompile-fail%2Fissue-17718-const-borrow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-17718-const-borrow.rs?ref=3ce88c7c8d3a422146bdc749c4e0207517b1f92a", "patch": "@@ -14,13 +14,13 @@ use std::cell::UnsafeCell;\n \n const A: UnsafeCell<usize> = UnsafeCell::new(1);\n const B: &'static UnsafeCell<usize> = &A;\n-//~^ ERROR: cannot borrow a constant which contains interior mutability\n+//~^ ERROR: cannot borrow a constant which may contain interior mutability\n \n struct C { a: UnsafeCell<usize> }\n const D: C = C { a: UnsafeCell::new(1) };\n const E: &'static UnsafeCell<usize> = &D.a;\n-//~^ ERROR: cannot borrow a constant which contains interior mutability\n+//~^ ERROR: cannot borrow a constant which may contain interior mutability\n const F: &'static C = &D;\n-//~^ ERROR: cannot borrow a constant which contains interior mutability\n+//~^ ERROR: cannot borrow a constant which may contain interior mutability\n \n fn main() {}"}, {"sha": "60d85d1b3b787c3144beba792858bc10c1f8f2b2", "filename": "src/test/ui/interior-mutability/interior-mutability.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/3ce88c7c8d3a422146bdc749c4e0207517b1f92a/src%2Ftest%2Fui%2Finterior-mutability%2Finterior-mutability.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ce88c7c8d3a422146bdc749c4e0207517b1f92a/src%2Ftest%2Fui%2Finterior-mutability%2Finterior-mutability.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Finterior-mutability%2Finterior-mutability.rs?ref=3ce88c7c8d3a422146bdc749c4e0207517b1f92a", "patch": "@@ -0,0 +1,16 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+use std::cell::Cell;\n+use std::panic::catch_unwind;\n+fn main() {\n+    let mut x = Cell::new(22);\n+    catch_unwind(|| { x.set(23); });\n+}"}, {"sha": "a9535f1c8303884ff6e63919c0e16a2c7543b0eb", "filename": "src/test/ui/interior-mutability/interior-mutability.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/3ce88c7c8d3a422146bdc749c4e0207517b1f92a/src%2Ftest%2Fui%2Finterior-mutability%2Finterior-mutability.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3ce88c7c8d3a422146bdc749c4e0207517b1f92a/src%2Ftest%2Fui%2Finterior-mutability%2Finterior-mutability.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Finterior-mutability%2Finterior-mutability.stderr?ref=3ce88c7c8d3a422146bdc749c4e0207517b1f92a", "patch": "@@ -0,0 +1,14 @@\n+error[E0277]: the trait bound `std::cell::UnsafeCell<i32>: std::panic::RefUnwindSafe` is not satisfied in `std::cell::Cell<i32>`\n+  --> $DIR/interior-mutability.rs:15:5\n+   |\n+15 |     catch_unwind(|| { x.set(23); });\n+   |     ^^^^^^^^^^^^ the type std::cell::UnsafeCell<i32> may contain interior mutability and a reference may not be safely transferrable across a catch_unwind boundary\n+   |\n+   = help: within `std::cell::Cell<i32>`, the trait `std::panic::RefUnwindSafe` is not implemented for `std::cell::UnsafeCell<i32>`\n+   = note: required because it appears within the type `std::cell::Cell<i32>`\n+   = note: required because of the requirements on the impl of `std::panic::UnwindSafe` for `&std::cell::Cell<i32>`\n+   = note: required because it appears within the type `[closure@$DIR/interior-mutability.rs:15:18: 15:35 x:&std::cell::Cell<i32>]`\n+   = note: required by `std::panic::catch_unwind`\n+\n+error: aborting due to previous error(s)\n+"}]}