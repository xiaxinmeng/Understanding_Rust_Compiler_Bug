{"sha": "682c401045fbc24ecec8cab0e315293192825c69", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY4MmM0MDEwNDVmYmMyNGVjZWM4Y2FiMGUzMTUyOTMxOTI4MjVjNjk=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-04-14T17:27:16Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-04-17T18:11:39Z"}, "message": "configure: Enable clang for older OSX gcc versions\n\nOSX often has a more recent version of clang than it does for GCC. When an older\nversion of gcc is detected on OSX, the --enable-clang flag is implicitly\nenabled.", "tree": {"sha": "118b9ede74fd44779d9255849292c0f992abb3ac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/118b9ede74fd44779d9255849292c0f992abb3ac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/682c401045fbc24ecec8cab0e315293192825c69", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/682c401045fbc24ecec8cab0e315293192825c69", "html_url": "https://github.com/rust-lang/rust/commit/682c401045fbc24ecec8cab0e315293192825c69", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/682c401045fbc24ecec8cab0e315293192825c69/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "32a81d1e161a8b4a498c88ddb79955775d18fbfd", "url": "https://api.github.com/repos/rust-lang/rust/commits/32a81d1e161a8b4a498c88ddb79955775d18fbfd", "html_url": "https://github.com/rust-lang/rust/commit/32a81d1e161a8b4a498c88ddb79955775d18fbfd"}], "stats": {"total": 44, "additions": 25, "deletions": 19}, "files": [{"sha": "8d0116cb0ca7d3c58820313f5f196fd7c06ab7f8", "filename": "configure", "status": "modified", "additions": 25, "deletions": 19, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/682c401045fbc24ecec8cab0e315293192825c69/configure", "raw_url": "https://github.com/rust-lang/rust/raw/682c401045fbc24ecec8cab0e315293192825c69/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=682c401045fbc24ecec8cab0e315293192825c69", "patch": "@@ -579,26 +579,32 @@ then\n         CFG_ENABLE_CLANG=1\n         putvar CFG_ENABLE_CLANG\n     else\n-        # on OS X, with xcode 5 and newer, certain developers may have\n-        # cc, gcc and g++ point to a  mixture of clang and gcc\n-        # if so, this will create very strange build errors\n-        # this last stanza is to detect some such problems and save the future rust\n-        # contributor some time solving that issue.\n-        # this detection could be generalized to other OSes aside from OS X\n-        # but the issue seems most likely to happen on OS X\n-\n-        chk_cc () {\n-            $1 --version 2> /dev/null | grep -q $2\n-        }\n-        # check that gcc, cc and g++ all point to the same compiler.\n-        # note that for xcode 5, g++ points to clang, not clang++\n-        if !((chk_cc gcc clang  && chk_cc g++ clang) ||\n-            (chk_cc gcc gcc  &&( chk_cc g++ g++ || chk g++ gcc))) then\n-            err \"the gcc and g++ in your path point to different compilers.\n-Check which versions are in your path with  cc --version and g++ --version.\n-To resolve this problem, either fix your PATH  or run configure with --enable-clang\"\n-        fi\n+        if [ $(\"$CFG_GCC\" --version 2>&1 | grep -c ' 4\\.[0-6]') -ne 0 ]; then\n+            step_msg \"older GCC found, using clang instead\"\n+            CFG_ENABLE_CLANG=1\n+            putvar CFG_ENABLE_CLANG\n+        else\n+            # on OS X, with xcode 5 and newer, certain developers may have\n+            # cc, gcc and g++ point to a  mixture of clang and gcc\n+            # if so, this will create very strange build errors\n+            # this last stanza is to detect some such problems and save the future rust\n+            # contributor some time solving that issue.\n+            # this detection could be generalized to other OSes aside from OS X\n+            # but the issue seems most likely to happen on OS X\n+\n+            chk_cc () {\n+                $1 --version 2> /dev/null | grep -q $2\n+            }\n+            # check that gcc, cc and g++ all point to the same compiler.\n+            # note that for xcode 5, g++ points to clang, not clang++\n+            if !((chk_cc gcc clang  && chk_cc g++ clang) ||\n+                (chk_cc gcc gcc  &&( chk_cc g++ g++ || chk g++ gcc))) then\n+                err \"the gcc and g++ in your path point to different compilers.\n+    Check which versions are in your path with  cc --version and g++ --version.\n+    To resolve this problem, either fix your PATH  or run configure with --enable-clang\"\n+            fi\n \n+        fi\n     fi\n fi\n "}]}