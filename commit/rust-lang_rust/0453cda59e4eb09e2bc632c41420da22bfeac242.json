{"sha": "0453cda59e4eb09e2bc632c41420da22bfeac242", "node_id": "C_kwDOAAsO6NoAKDA0NTNjZGE1OWU0ZWIwOWUyYmM2MzJjNDE0MjBkYTIyYmZlYWMyNDI", "commit": {"author": {"name": "clubby789", "email": "jamie@hill-daniel.co.uk", "date": "2023-05-01T13:36:52Z"}, "committer": {"name": "clubby789", "email": "jamie@hill-daniel.co.uk", "date": "2023-05-01T14:05:39Z"}, "message": "Don't bail out early when checking invalid `repr` attr", "tree": {"sha": "7369df01221614ba909c07eac3f96b7eade8b1a2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7369df01221614ba909c07eac3f96b7eade8b1a2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0453cda59e4eb09e2bc632c41420da22bfeac242", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0453cda59e4eb09e2bc632c41420da22bfeac242", "html_url": "https://github.com/rust-lang/rust/commit/0453cda59e4eb09e2bc632c41420da22bfeac242", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0453cda59e4eb09e2bc632c41420da22bfeac242/comments", "author": {"login": "clubby789", "id": 13556931, "node_id": "MDQ6VXNlcjEzNTU2OTMx", "avatar_url": "https://avatars.githubusercontent.com/u/13556931?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clubby789", "html_url": "https://github.com/clubby789", "followers_url": "https://api.github.com/users/clubby789/followers", "following_url": "https://api.github.com/users/clubby789/following{/other_user}", "gists_url": "https://api.github.com/users/clubby789/gists{/gist_id}", "starred_url": "https://api.github.com/users/clubby789/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clubby789/subscriptions", "organizations_url": "https://api.github.com/users/clubby789/orgs", "repos_url": "https://api.github.com/users/clubby789/repos", "events_url": "https://api.github.com/users/clubby789/events{/privacy}", "received_events_url": "https://api.github.com/users/clubby789/received_events", "type": "User", "site_admin": false}, "committer": {"login": "clubby789", "id": 13556931, "node_id": "MDQ6VXNlcjEzNTU2OTMx", "avatar_url": "https://avatars.githubusercontent.com/u/13556931?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clubby789", "html_url": "https://github.com/clubby789", "followers_url": "https://api.github.com/users/clubby789/followers", "following_url": "https://api.github.com/users/clubby789/following{/other_user}", "gists_url": "https://api.github.com/users/clubby789/gists{/gist_id}", "starred_url": "https://api.github.com/users/clubby789/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clubby789/subscriptions", "organizations_url": "https://api.github.com/users/clubby789/orgs", "repos_url": "https://api.github.com/users/clubby789/repos", "events_url": "https://api.github.com/users/clubby789/events{/privacy}", "received_events_url": "https://api.github.com/users/clubby789/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4b87ed9d0f18166a26aadb5289bac004e058b90f", "url": "https://api.github.com/repos/rust-lang/rust/commits/4b87ed9d0f18166a26aadb5289bac004e058b90f", "html_url": "https://github.com/rust-lang/rust/commit/4b87ed9d0f18166a26aadb5289bac004e058b90f"}], "stats": {"total": 33, "additions": 25, "deletions": 8}, "files": [{"sha": "06aa2737915263c7d82b1fead7a43fceb2b39d97", "filename": "compiler/rustc_passes/src/check_attr.rs", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/0453cda59e4eb09e2bc632c41420da22bfeac242/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0453cda59e4eb09e2bc632c41420da22bfeac242/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fcheck_attr.rs?ref=0453cda59e4eb09e2bc632c41420da22bfeac242", "patch": "@@ -101,12 +101,11 @@ impl CheckAttrVisitor<'_> {\n         item: Option<ItemLike<'_>>,\n     ) {\n         let mut doc_aliases = FxHashMap::default();\n-        let mut is_valid = true;\n         let mut specified_inline = None;\n         let mut seen = FxHashMap::default();\n         let attrs = self.tcx.hir().attrs(hir_id);\n         for attr in attrs {\n-            let attr_is_valid = match attr.name_or_empty() {\n+            match attr.name_or_empty() {\n                 sym::do_not_recommend => self.check_do_not_recommend(attr.span, target),\n                 sym::inline => self.check_inline(hir_id, attr, span, target),\n                 sym::no_coverage => self.check_no_coverage(hir_id, attr, span, target),\n@@ -188,7 +187,6 @@ impl CheckAttrVisitor<'_> {\n                 sym::link_ordinal => self.check_link_ordinal(&attr, span, target),\n                 _ => true,\n             };\n-            is_valid &= attr_is_valid;\n \n             // lint-only checks\n             match attr.name_or_empty() {\n@@ -255,10 +253,6 @@ impl CheckAttrVisitor<'_> {\n             self.check_unused_attribute(hir_id, attr)\n         }\n \n-        if !is_valid {\n-            return;\n-        }\n-\n         self.check_repr(attrs, span, target, item, hir_id);\n         self.check_used(attrs, target);\n     }"}, {"sha": "785ffb1e0f4cbf03312c0e1b3158a2999150d009", "filename": "tests/ui/repr/invalid_repr_list_help.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0453cda59e4eb09e2bc632c41420da22bfeac242/tests%2Fui%2Frepr%2Finvalid_repr_list_help.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0453cda59e4eb09e2bc632c41420da22bfeac242/tests%2Fui%2Frepr%2Finvalid_repr_list_help.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frepr%2Finvalid_repr_list_help.rs?ref=0453cda59e4eb09e2bc632c41420da22bfeac242", "patch": "@@ -15,3 +15,8 @@ pub struct OwO3 {\n pub enum OwO4 {\n     UwU = 1,\n }\n+\n+#[repr(uwu)] //~ERROR: unrecognized representation hint\n+#[doc(owo)]  //~WARN: unknown `doc` attribute\n+             //~^ WARN: this was previously\n+pub struct Owo5;"}, {"sha": "48a6af3dd4c11ce518180faad53e2bd77861a13a", "filename": "tests/ui/repr/invalid_repr_list_help.stderr", "status": "modified", "additions": 19, "deletions": 1, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/0453cda59e4eb09e2bc632c41420da22bfeac242/tests%2Fui%2Frepr%2Finvalid_repr_list_help.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0453cda59e4eb09e2bc632c41420da22bfeac242/tests%2Fui%2Frepr%2Finvalid_repr_list_help.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Frepr%2Finvalid_repr_list_help.stderr?ref=0453cda59e4eb09e2bc632c41420da22bfeac242", "patch": "@@ -30,6 +30,24 @@ LL | #[repr(uwu, u8)]\n    |\n    = help: valid reprs are `C`, `align`, `packed`, `transparent`, `simd`, `i8`, `u8`, `i16`, `u16`, `i32`, `u32`, `i64`, `u64`, `i128`, `u128`, `isize`, `usize`\n \n-error: aborting due to 4 previous errors\n+warning: unknown `doc` attribute `owo`\n+  --> $DIR/invalid_repr_list_help.rs:20:7\n+   |\n+LL | #[doc(owo)]\n+   |       ^^^\n+   |\n+   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!\n+   = note: for more information, see issue #82730 <https://github.com/rust-lang/rust/issues/82730>\n+   = note: `#[warn(invalid_doc_attributes)]` on by default\n+\n+error[E0552]: unrecognized representation hint\n+  --> $DIR/invalid_repr_list_help.rs:19:8\n+   |\n+LL | #[repr(uwu)]\n+   |        ^^^\n+   |\n+   = help: valid reprs are `C`, `align`, `packed`, `transparent`, `simd`, `i8`, `u8`, `i16`, `u16`, `i32`, `u32`, `i64`, `u64`, `i128`, `u128`, `isize`, `usize`\n+\n+error: aborting due to 5 previous errors; 1 warning emitted\n \n For more information about this error, try `rustc --explain E0552`."}]}