{"sha": "c6e6428d1a13f61f5ffbe43697a21f3cd82cd01d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM2ZTY0MjhkMWExM2Y2MWY1ZmZiZTQzNjk3YTIxZjNjZDgyY2QwMWQ=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-01-14T00:23:35Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2018-01-27T11:46:26Z"}, "message": "Moved overflow check into end_point function.", "tree": {"sha": "d5913be5df0ff9cc69b031321423035d246e80c1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d5913be5df0ff9cc69b031321423035d246e80c1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c6e6428d1a13f61f5ffbe43697a21f3cd82cd01d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEWwgxPGhT5b/6kagXAXYLT59T8VQFAlpsZpIACgkQAXYLT59T\n8VTmLQ/9Gd79hJ0D+hz/YjIvQHVWUsRYCvRv1dA+q8iAwm/XwazJcox0rHoSuw2w\nhrjVWTX8a/Akvd6ARQwLIiL4Cinp1WcFkg4QD5oqEVhCKHQ/QYr3gptj3uB8Ir6x\nd2aVW6341UmbCM4FICH2LfsZ4gauttBUcaWzk3m+C0ZzniKX/11wjVH7HYwLg9LE\n+ForS+BGc4lNbOx8Jze3qyaWI6x3EfBMTGIGXpt+4YOrt2L2LmuwfGD/09+x6WXr\nx5neKtPcK76bwv3KtL4wl98I61ds4exzEwbDwKF8R0+Fy7vsAV+lI/BNTD4YRf/A\nPgBz7tqnswjcGtVjJFb9YOd5S8wZswxp4DgJtjP4Bt4iBQTKrLQESttUC9574n1P\nUnvg4tt+sFwzGbb+O8JK3dnqp1PHvjJ+yi4ZjOgbBMuW5wD6sTHYF0h1v0Y/qycW\njZODcGBz+FUQrW6r/GzbFRnqIGTRs5Qj9ShpzTPVbyv4wPoqhqmPLhwHcODTk3p7\n35bSUC3MKmIYzvClHGjiCKI4qBVMjapcsowY5BUbI3wlqeZlJlr2NTuxeHbCvMMB\nBU0Q+ECv0xU9q7x1gCM3VCQJpPJyH2o6VhHC/SOVlej5R1+pISGssXDTuAlyNGRX\n+EuRG5SWYOYjY6j3JZquzT8gY+OBFbH+AH0vTyGBY7t7XQsWgX8=\n=dmVJ\n-----END PGP SIGNATURE-----", "payload": "tree d5913be5df0ff9cc69b031321423035d246e80c1\nparent f6fee2a479070526495b65b6b3e7959088a1dd62\nauthor David Wood <david@davidtw.co> 1515889415 +0000\ncommitter David Wood <david@davidtw.co> 1517053586 +0000\n\nMoved overflow check into end_point function.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c6e6428d1a13f61f5ffbe43697a21f3cd82cd01d", "html_url": "https://github.com/rust-lang/rust/commit/c6e6428d1a13f61f5ffbe43697a21f3cd82cd01d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c6e6428d1a13f61f5ffbe43697a21f3cd82cd01d/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f6fee2a479070526495b65b6b3e7959088a1dd62", "url": "https://api.github.com/repos/rust-lang/rust/commits/f6fee2a479070526495b65b6b3e7959088a1dd62", "html_url": "https://github.com/rust-lang/rust/commit/f6fee2a479070526495b65b6b3e7959088a1dd62"}], "stats": {"total": 11, "additions": 4, "deletions": 7}, "files": [{"sha": "50e50b95f7750401cff775c2e15c1a271e630322", "filename": "src/librustc_mir/build/scope.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c6e6428d1a13f61f5ffbe43697a21f3cd82cd01d/src%2Flibrustc_mir%2Fbuild%2Fscope.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6e6428d1a13f61f5ffbe43697a21f3cd82cd01d/src%2Flibrustc_mir%2Fbuild%2Fscope.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fbuild%2Fscope.rs?ref=c6e6428d1a13f61f5ffbe43697a21f3cd82cd01d", "patch": "@@ -699,12 +699,7 @@ impl<'a, 'gcx, 'tcx> Builder<'a, 'gcx, 'tcx> {\n                 let region_scope_span = region_scope.span(self.hir.tcx(),\n                                                           &self.hir.region_scope_tree);\n                 // Attribute scope exit drops to scope's closing brace.\n-                // Without this check when finding the endpoint, we'll run into an ICE.\n-                let scope_end = if region_scope_span.hi().0 == 0 {\n-                    region_scope_span\n-                } else {\n-                    region_scope_span.end_point()\n-                };\n+                let scope_end = region_scope_span.end_point();\n \n                 scope.drops.push(DropData {\n                     span: scope_end,"}, {"sha": "5866d8e4aa9323668195c87b2a67c6e9cdaac95e", "filename": "src/libsyntax_pos/lib.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c6e6428d1a13f61f5ffbe43697a21f3cd82cd01d/src%2Flibsyntax_pos%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c6e6428d1a13f61f5ffbe43697a21f3cd82cd01d/src%2Flibsyntax_pos%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_pos%2Flib.rs?ref=c6e6428d1a13f61f5ffbe43697a21f3cd82cd01d", "patch": "@@ -219,7 +219,9 @@ impl Span {\n     /// Returns a new span representing just the end-point of this span\n     pub fn end_point(self) -> Span {\n         let span = self.data();\n-        let lo = cmp::max(span.hi.0 - 1, span.lo.0);\n+        // We can avoid an ICE by checking if subtraction would cause an overflow.\n+        let hi = if span.hi.0 == u32::min_value() { span.hi.0 } else { span.hi.0 - 1 };\n+        let lo = cmp::max(hi, span.lo.0);\n         span.with_lo(BytePos(lo))\n     }\n "}]}