{"sha": "702f88a3bee11d1a09541093280ef27a1453710b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcwMmY4OGEzYmVlMTFkMWEwOTU0MTA5MzI4MGVmMjdhMTQ1MzcxMGI=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-07-05T03:56:23Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2011-07-06T18:09:07Z"}, "message": "rustc: Move tstate::annotate over to interior vectors", "tree": {"sha": "7ad68bd2ebcb3f811675a06d127b26f4846667d2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7ad68bd2ebcb3f811675a06d127b26f4846667d2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/702f88a3bee11d1a09541093280ef27a1453710b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/702f88a3bee11d1a09541093280ef27a1453710b", "html_url": "https://github.com/rust-lang/rust/commit/702f88a3bee11d1a09541093280ef27a1453710b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/702f88a3bee11d1a09541093280ef27a1453710b/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4c384304e9c37590a2e65d4803b7abef375490a4", "url": "https://api.github.com/repos/rust-lang/rust/commits/4c384304e9c37590a2e65d4803b7abef375490a4", "html_url": "https://github.com/rust-lang/rust/commit/4c384304e9c37590a2e65d4803b7abef375490a4"}], "stats": {"total": 24, "additions": 12, "deletions": 12}, "files": [{"sha": "b306eda5737161b4609cfab144bc1889026394fc", "filename": "src/comp/middle/tstate/annotate.rs", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/702f88a3bee11d1a09541093280ef27a1453710b/src%2Fcomp%2Fmiddle%2Ftstate%2Fannotate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/702f88a3bee11d1a09541093280ef27a1453710b/src%2Fcomp%2Fmiddle%2Ftstate%2Fannotate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftstate%2Fannotate.rs?ref=702f88a3bee11d1a09541093280ef27a1453710b", "patch": "@@ -24,36 +24,36 @@ import aux::crate_ctxt;\n import aux::add_node;\n import middle::tstate::ann::empty_ann;\n \n-fn collect_ids_expr(&@expr e, @mutable vec[node_id] rs) {\n-    vec::push(*rs, e.id);\n+fn collect_ids_expr(&@expr e, @mutable node_id[] rs) {\n+    *rs += ~[e.id];\n }\n \n-fn collect_ids_block(&block b, @mutable vec[node_id] rs) {\n-    vec::push(*rs, b.node.id);\n+fn collect_ids_block(&block b, @mutable node_id[] rs) {\n+    *rs += ~[b.node.id];\n }\n \n-fn collect_ids_stmt(&@stmt s, @mutable vec[node_id] rs) {\n+fn collect_ids_stmt(&@stmt s, @mutable node_id[] rs) {\n     alt (s.node) {\n         case (stmt_decl(_, ?id)) {\n             log \"node_id \" + int::str(id);\n             log_stmt(*s);\n-            vec::push(*rs, id);\n+            *rs += ~[id];\n         }\n         case (stmt_expr(_, ?id)) {\n             log \"node_id \" + int::str(id);\n             log_stmt(*s);\n-            vec::push(*rs, id);\n+            *rs += ~[id];\n         }\n         case (_) { }\n     }\n }\n \n-fn collect_ids_local(&@local l, @mutable vec[node_id] rs) {\n-    vec::push(*rs, l.node.id);\n+fn collect_ids_local(&@local l, @mutable node_id[] rs) {\n+    *rs += ~[l.node.id];\n }\n \n fn node_ids_in_fn(&_fn f, &vec[ty_param] tps, &span sp, &fn_ident i,\n-                  node_id id, @mutable vec[node_id] rs) {\n+                  node_id id, @mutable node_id[] rs) {\n     auto collect_ids = walk::default_visitor();\n     collect_ids =\n         rec(visit_expr_pre=bind collect_ids_expr(_, rs),\n@@ -63,7 +63,7 @@ fn node_ids_in_fn(&_fn f, &vec[ty_param] tps, &span sp, &fn_ident i,\n     walk::walk_fn(collect_ids, f, tps, sp, i, id);\n }\n \n-fn init_vecs(&crate_ctxt ccx, &vec[node_id] node_ids, uint len) {\n+fn init_vecs(&crate_ctxt ccx, &node_id[] node_ids, uint len) {\n     for (node_id i in node_ids) {\n         log int::str(i) + \" |-> \" + uint::str(len);\n         add_node(ccx, i, empty_ann(len));\n@@ -72,7 +72,7 @@ fn init_vecs(&crate_ctxt ccx, &vec[node_id] node_ids, uint len) {\n \n fn visit_fn(&crate_ctxt ccx, uint num_constraints, &_fn f, &vec[ty_param] tps,\n             &span sp, &fn_ident i, node_id id) {\n-    let @mutable vec[node_id] node_ids = @mutable [];\n+    let @mutable node_id[] node_ids = @mutable ~[];\n     node_ids_in_fn(f, tps, sp, i, id, node_ids);\n     auto node_id_vec = *node_ids;\n     init_vecs(ccx, node_id_vec, num_constraints);"}]}