{"sha": "b49269ad399e33c5c5ea2cd9a01376221ea2c62e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI0OTI2OWFkMzk5ZTMzYzVjNWVhMmNkOWEwMTM3NjIyMWVhMmM2MmU=", "commit": {"author": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-06-04T06:23:00Z"}, "committer": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-06-04T10:37:24Z"}, "message": "Forbid method chain to get combined if it uses multi line.\n\nIf the method chain goes multi line before the last element, disallow combining\nthe method chain.", "tree": {"sha": "ea7555694c54e30ca6d39cb8ebd54071eb64940b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ea7555694c54e30ca6d39cb8ebd54071eb64940b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b49269ad399e33c5c5ea2cd9a01376221ea2c62e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b49269ad399e33c5c5ea2cd9a01376221ea2c62e", "html_url": "https://github.com/rust-lang/rust/commit/b49269ad399e33c5c5ea2cd9a01376221ea2c62e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b49269ad399e33c5c5ea2cd9a01376221ea2c62e/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fabbef2c3eaad7326e60cbb7c4c818bfaccb3178", "url": "https://api.github.com/repos/rust-lang/rust/commits/fabbef2c3eaad7326e60cbb7c4c818bfaccb3178", "html_url": "https://github.com/rust-lang/rust/commit/fabbef2c3eaad7326e60cbb7c4c818bfaccb3178"}], "stats": {"total": 11, "additions": 11, "deletions": 0}, "files": [{"sha": "a56b8cf196d02ebdab4010bb051c2676e0413ab5", "filename": "src/chains.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b49269ad399e33c5c5ea2cd9a01376221ea2c62e/src%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b49269ad399e33c5c5ea2cd9a01376221ea2c62e/src%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fchains.rs?ref=b49269ad399e33c5c5ea2cd9a01376221ea2c62e", "patch": "@@ -252,6 +252,9 @@ pub fn rewrite_chain(expr: &ast::Expr, context: &RewriteContext, shape: Shape) -\n         String::new()\n     } else {\n         // Use new lines.\n+        if context.force_one_line_chain {\n+            return None;\n+        }\n         format!(\"\\n{}\", nested_shape.indent.to_string(context.config))\n     };\n "}, {"sha": "46e030bd094bb3fc2b1a85596cec963e71b4e93e", "filename": "src/expr.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/b49269ad399e33c5c5ea2cd9a01376221ea2c62e/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b49269ad399e33c5c5ea2cd9a01376221ea2c62e/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=b49269ad399e33c5c5ea2cd9a01376221ea2c62e", "patch": "@@ -1784,6 +1784,11 @@ fn try_overflow_last_arg(context: &RewriteContext,\n     // Replace the last item with its first line to see if it fits with\n     // first arguments.\n     let (orig_last, placeholder) = if overflow_last {\n+        let mut context = context.clone();\n+        match args[args.len() - 1].node {\n+            ast::ExprKind::MethodCall(..) => context.force_one_line_chain = true,\n+            _ => (),\n+        }\n         last_arg_shape(&context, &item_vec, shape).map_or((None, None), |arg_shape| {\n             rewrite_last_arg_with_overflow(&context,\n                                            &args[args.len() - 1],"}, {"sha": "5c1236104b520a70cf5380908e96fbdf89b51d64", "filename": "src/rewrite.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b49269ad399e33c5c5ea2cd9a01376221ea2c62e/src%2Frewrite.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b49269ad399e33c5c5ea2cd9a01376221ea2c62e/src%2Frewrite.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frewrite.rs?ref=b49269ad399e33c5c5ea2cd9a01376221ea2c62e", "patch": "@@ -32,6 +32,8 @@ pub struct RewriteContext<'a> {\n     // When `format_if_else_cond_comment` is true, unindent the comment on top\n     // of the `else` or `else if`.\n     pub is_if_else_block: bool,\n+    // When rewriting chain, veto going multi line except the last element\n+    pub force_one_line_chain: bool,\n }\n \n impl<'a> RewriteContext<'a> {"}, {"sha": "d7d54a819e216d1634b822d4af499bb75fd4c023", "filename": "src/visitor.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b49269ad399e33c5c5ea2cd9a01376221ea2c62e/src%2Fvisitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b49269ad399e33c5c5ea2cd9a01376221ea2c62e/src%2Fvisitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fvisitor.rs?ref=b49269ad399e33c5c5ea2cd9a01376221ea2c62e", "patch": "@@ -629,6 +629,7 @@ impl<'a> FmtVisitor<'a> {\n             inside_macro: false,\n             use_block: false,\n             is_if_else_block: false,\n+            force_one_line_chain: false,\n         }\n     }\n }"}]}