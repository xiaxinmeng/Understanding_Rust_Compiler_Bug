{"sha": "41e2d71589d3ff1ae2a271f8fe69e1d0652402f2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQxZTJkNzE1ODlkM2ZmMWFlMmEyNzFmOGZlNjllMWQwNjUyNDAyZjI=", "commit": {"author": {"name": "Flavio Percoco Premoli", "email": "flaper87@gmail.com", "date": "2015-01-24T09:42:41Z"}, "committer": {"name": "Flavio Percoco Premoli", "email": "flaper87@gmail.com", "date": "2015-01-24T09:42:41Z"}, "message": "Rollup merge of #21539 - iKevinY:pythonic, r=alexcrichton\n\nAlso makes `errorck.py` and `tidy.py` compatible with Python 3.", "tree": {"sha": "067b79424786fdd95d8752d6f8609194facea17b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/067b79424786fdd95d8752d6f8609194facea17b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/41e2d71589d3ff1ae2a271f8fe69e1d0652402f2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/41e2d71589d3ff1ae2a271f8fe69e1d0652402f2", "html_url": "https://github.com/rust-lang/rust/commit/41e2d71589d3ff1ae2a271f8fe69e1d0652402f2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/41e2d71589d3ff1ae2a271f8fe69e1d0652402f2/comments", "author": {"login": "flaper87", "id": 13816, "node_id": "MDQ6VXNlcjEzODE2", "avatar_url": "https://avatars.githubusercontent.com/u/13816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flaper87", "html_url": "https://github.com/flaper87", "followers_url": "https://api.github.com/users/flaper87/followers", "following_url": "https://api.github.com/users/flaper87/following{/other_user}", "gists_url": "https://api.github.com/users/flaper87/gists{/gist_id}", "starred_url": "https://api.github.com/users/flaper87/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flaper87/subscriptions", "organizations_url": "https://api.github.com/users/flaper87/orgs", "repos_url": "https://api.github.com/users/flaper87/repos", "events_url": "https://api.github.com/users/flaper87/events{/privacy}", "received_events_url": "https://api.github.com/users/flaper87/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flaper87", "id": 13816, "node_id": "MDQ6VXNlcjEzODE2", "avatar_url": "https://avatars.githubusercontent.com/u/13816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flaper87", "html_url": "https://github.com/flaper87", "followers_url": "https://api.github.com/users/flaper87/followers", "following_url": "https://api.github.com/users/flaper87/following{/other_user}", "gists_url": "https://api.github.com/users/flaper87/gists{/gist_id}", "starred_url": "https://api.github.com/users/flaper87/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flaper87/subscriptions", "organizations_url": "https://api.github.com/users/flaper87/orgs", "repos_url": "https://api.github.com/users/flaper87/repos", "events_url": "https://api.github.com/users/flaper87/events{/privacy}", "received_events_url": "https://api.github.com/users/flaper87/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dc32dfaccf4e5d9a8c2e47bb8f843219ba989dbc", "url": "https://api.github.com/repos/rust-lang/rust/commits/dc32dfaccf4e5d9a8c2e47bb8f843219ba989dbc", "html_url": "https://github.com/rust-lang/rust/commit/dc32dfaccf4e5d9a8c2e47bb8f843219ba989dbc"}, {"sha": "76c279a4cfc9e54327bcc668a895ec19185139e9", "url": "https://api.github.com/repos/rust-lang/rust/commits/76c279a4cfc9e54327bcc668a895ec19185139e9", "html_url": "https://github.com/rust-lang/rust/commit/76c279a4cfc9e54327bcc668a895ec19185139e9"}], "stats": {"total": 86, "additions": 30, "deletions": 56}, "files": [{"sha": "952e299265d85aba4ca5d6f76ca4b8c37ca2aa0a", "filename": "src/etc/errorck.py", "status": "modified", "additions": 14, "deletions": 25, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/41e2d71589d3ff1ae2a271f8fe69e1d0652402f2/src%2Fetc%2Ferrorck.py", "raw_url": "https://github.com/rust-lang/rust/raw/41e2d71589d3ff1ae2a271f8fe69e1d0652402f2/src%2Fetc%2Ferrorck.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Ferrorck.py?ref=41e2d71589d3ff1ae2a271f8fe69e1d0652402f2", "patch": "@@ -14,11 +14,10 @@\n import sys, os, re\n \n src_dir = sys.argv[1]\n-\n-errcode_map = { }\n+errcode_map = {}\n+error_re = re.compile(\"(E\\d\\d\\d\\d)\")\n \n for (dirpath, dirnames, filenames) in os.walk(src_dir):\n-\n     if \"src/test\" in dirpath or \"src/llvm\" in dirpath:\n         # Short circuit for fast\n         continue\n@@ -28,15 +27,12 @@\n             continue\n \n         path = os.path.join(dirpath, filename)\n-        line_num = 1\n-        with open(path, 'r') as f:\n-            for line in f:\n-\n-                p = re.compile(\"(E\\d\\d\\d\\d)\")\n-                m = p.search(line)\n-                if not m is None:\n-                    errcode = m.group(1)\n \n+        with open(path, 'r') as f:\n+            for line_num, line in enumerate(f, start=1):\n+                match = error_re.search(line)\n+                if match:\n+                    errcode = match.group(1)\n                     new_record = [(errcode, path, line_num, line)]\n                     existing = errcode_map.get(errcode)\n                     if existing is not None:\n@@ -45,26 +41,19 @@\n                     else:\n                         errcode_map[errcode] = new_record\n \n-                line_num += 1\n-\n errors = False\n all_errors = []\n-for errcode in errcode_map:\n-    entries = errcode_map[errcode]\n-    all_errors += [entries[0][0]]\n+\n+for errcode, entries in errcode_map.items():\n+    all_errors.append(entries[0][0])\n     if len(entries) > 1:\n-        print \"error: duplicate error code \" + errcode\n+        print(\"error: duplicate error code \" + errcode)\n         for entry in entries:\n-            print entry[1] + \": \" + str(entry[2])\n-            print entry[3]\n+            print(\"{1}: {2}\\n{3}\".format(*entry))\n         errors = True\n \n-print str(len(errcode_map)) + \" error codes\"\n-\n-all_errors.sort()\n-all_errors.reverse()\n-\n-print \"highest error code: \" + all_errors[0]\n+print(\"{0} error codes\".format(len(errcode_map)))\n+print(\"highest error code: \" + max(all_errors))\n \n if errors:\n     sys.exit(1)"}, {"sha": "f38583ee1fb3774c8bf01c56304358b58992fe70", "filename": "src/etc/licenseck.py", "status": "modified", "additions": 15, "deletions": 30, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/41e2d71589d3ff1ae2a271f8fe69e1d0652402f2/src%2Fetc%2Flicenseck.py", "raw_url": "https://github.com/rust-lang/rust/raw/41e2d71589d3ff1ae2a271f8fe69e1d0652402f2/src%2Fetc%2Flicenseck.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Flicenseck.py?ref=41e2d71589d3ff1ae2a271f8fe69e1d0652402f2", "patch": "@@ -8,29 +8,18 @@\n # option. This file may not be copied, modified, or distributed\n # except according to those terms.\n \n-license1 = \"\"\"// Copyright \"\"\"\n-license2 = \"\"\" The Rust Project Developers. See the COPYRIGHT\n-// file at the top-level directory of this distribution and at\n-// http://rust-lang.org/COPYRIGHT.\n-//\n-// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-// option. This file may not be copied, modified, or distributed\n-// except according to those terms.\n-\"\"\"\n+import re\n \n-license3 = \"\"\"# Copyright \"\"\"\n-license4 = \"\"\" The Rust Project Developers. See the COPYRIGHT\n-# file at the top-level directory of this distribution and at\n-# http://rust-lang.org/COPYRIGHT.\n-#\n-# Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n-# http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n-# <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n-# option. This file may not be copied, modified, or distributed\n-# except according to those terms.\n-\"\"\"\n+license_re = re.compile(\n+u\"\"\"(#|//) Copyright .* The Rust Project Developers. See the COPYRIGHT\n+\\\\1 file at the top-level directory of this distribution and at\n+\\\\1 http://rust-lang.org/COPYRIGHT.\n+\\\\1\n+\\\\1 Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+\\\\1 http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+\\\\1 <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+\\\\1 option. This file may not be copied, modified, or distributed\n+\\\\1 except according to those terms.\"\"\")\n \n exceptions = [\n     \"rt/rust_android_dummy.cpp\", # BSD, chromium\n@@ -57,18 +46,14 @@\n \n def check_license(name, contents):\n     # Whitelist check\n-    for exception in exceptions:\n-        if name.endswith(exception):\n-            return True\n+    if any(name.endswith(e) for e in exceptions):\n+        return True\n \n     # Xfail check\n     firstlineish = contents[:100]\n-    if firstlineish.find(\"ignore-license\") != -1:\n+    if \"ignore-license\" in firstlineish:\n         return True\n \n     # License check\n     boilerplate = contents[:500]\n-    if (boilerplate.find(license1) == -1 or boilerplate.find(license2) == -1) and \\\n-       (boilerplate.find(license3) == -1 or boilerplate.find(license4) == -1):\n-        return False\n-    return True\n+    return bool(license_re.search(boilerplate))"}, {"sha": "c65b762e5173168c880f18dc5209b99e62c65226", "filename": "src/etc/tidy.py", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/41e2d71589d3ff1ae2a271f8fe69e1d0652402f2/src%2Fetc%2Ftidy.py", "raw_url": "https://github.com/rust-lang/rust/raw/41e2d71589d3ff1ae2a271f8fe69e1d0652402f2/src%2Fetc%2Ftidy.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Ftidy.py?ref=41e2d71589d3ff1ae2a271f8fe69e1d0652402f2", "patch": "@@ -113,7 +113,7 @@ def do_license_check(name, contents):\n     if current_name != \"\":\n         do_license_check(current_name, current_contents)\n \n-except UnicodeDecodeError, e:\n+except UnicodeDecodeError as e:\n     report_err(\"UTF-8 decoding error \" + str(e))\n \n "}]}