{"sha": "623daf66a96065333579eb2e551ba71f8f8000b9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYyM2RhZjY2YTk2MDY1MzMzNTc5ZWIyZTU1MWJhNzFmOGY4MDAwYjk=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-10-30T11:36:26Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-10-30T11:36:26Z"}, "message": "auto merge of #10123 : klutzy/rust/fix-7507, r=alexcrichton\n\nThis patch fixes rustc to emit explicit error if LHS of assignment is\r\nnot allowed.\r\n\r\nFixes #7507\r\nFixes #7508", "tree": {"sha": "87bfcc047897ba58a825a4d4e1368e60d551eaaf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/87bfcc047897ba58a825a4d4e1368e60d551eaaf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/623daf66a96065333579eb2e551ba71f8f8000b9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/623daf66a96065333579eb2e551ba71f8f8000b9", "html_url": "https://github.com/rust-lang/rust/commit/623daf66a96065333579eb2e551ba71f8f8000b9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/623daf66a96065333579eb2e551ba71f8f8000b9/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a0e6e0e9b7bc468b9e31d22c6f82a391ad7ba90a", "url": "https://api.github.com/repos/rust-lang/rust/commits/a0e6e0e9b7bc468b9e31d22c6f82a391ad7ba90a", "html_url": "https://github.com/rust-lang/rust/commit/a0e6e0e9b7bc468b9e31d22c6f82a391ad7ba90a"}, {"sha": "cab00457fefb89444cd4b7a4e601dc6d200e0c86", "url": "https://api.github.com/repos/rust-lang/rust/commits/cab00457fefb89444cd4b7a4e601dc6d200e0c86", "html_url": "https://github.com/rust-lang/rust/commit/cab00457fefb89444cd4b7a4e601dc6d200e0c86"}], "stats": {"total": 32, "additions": 31, "deletions": 1}, "files": [{"sha": "b0196010cb06b26786165d7c9284c141acd991cb", "filename": "src/librustc/middle/typeck/check/mod.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/623daf66a96065333579eb2e551ba71f8f8000b9/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/623daf66a96065333579eb2e551ba71f8f8000b9/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fmod.rs?ref=623daf66a96065333579eb2e551ba71f8f8000b9", "patch": "@@ -2373,6 +2373,11 @@ pub fn check_expr_with_unifier(fcx: @mut FnCtxt,\n         let result_t = fcx.expr_ty(expr);\n         demand::suptype(fcx, expr.span, result_t, lhs_t);\n \n+        let tcx = fcx.tcx();\n+        if !ty::expr_is_lval(tcx, fcx.ccx.method_map, lhs) {\n+            tcx.sess.span_err(lhs.span, \"illegal left-hand side expression\");\n+        }\n+\n         // Overwrite result of check_binop...this preserves existing behavior\n         // but seems quite dubious with regard to user-defined methods\n         // and so forth. - Niko\n@@ -2545,6 +2550,12 @@ pub fn check_expr_with_unifier(fcx: @mut FnCtxt,\n       }\n       ast::ExprAssign(lhs, rhs) => {\n         check_assignment(fcx, lhs, rhs, id);\n+\n+        let tcx = fcx.tcx();\n+        if !ty::expr_is_lval(tcx, fcx.ccx.method_map, lhs) {\n+            tcx.sess.span_err(lhs.span, \"illegal left-hand side expression\");\n+        }\n+\n         let lhs_ty = fcx.expr_ty(lhs);\n         let rhs_ty = fcx.expr_ty(rhs);\n         if ty::type_is_error(lhs_ty) || ty::type_is_error(rhs_ty) {"}, {"sha": "6907bf4b5b8137ee361bf542368dbf3107edaa06", "filename": "src/test/compile-fail/bad-expr-lhs.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/623daf66a96065333579eb2e551ba71f8f8000b9/src%2Ftest%2Fcompile-fail%2Fbad-expr-lhs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/623daf66a96065333579eb2e551ba71f8f8000b9/src%2Ftest%2Fcompile-fail%2Fbad-expr-lhs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fbad-expr-lhs.rs?ref=623daf66a96065333579eb2e551ba71f8f8000b9", "patch": "@@ -0,0 +1,20 @@\n+// Copyright 2012-2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn main() {\n+    1 = 2; //~ ERROR illegal left-hand side expression\n+    1 += 2; //~ ERROR illegal left-hand side expression\n+    (1, 2) = (3, 4); //~ ERROR illegal left-hand side expression\n+\n+    let (a, b) = (1, 2);\n+    (a, b) = (3, 4); //~ ERROR illegal left-hand side expression\n+\n+    None = Some(3); //~ ERROR illegal left-hand side expression\n+}"}, {"sha": "c0fb24c83e37af9c27dfe4e893f5021acdc06364", "filename": "src/test/compile-fail/borrowck-assign-to-constants.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/623daf66a96065333579eb2e551ba71f8f8000b9/src%2Ftest%2Fcompile-fail%2Fborrowck-assign-to-constants.rs", "raw_url": "https://github.com/rust-lang/rust/raw/623daf66a96065333579eb2e551ba71f8f8000b9/src%2Ftest%2Fcompile-fail%2Fborrowck-assign-to-constants.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fborrowck-assign-to-constants.rs?ref=623daf66a96065333579eb2e551ba71f8f8000b9", "patch": "@@ -12,6 +12,5 @@ static foo: int = 5;\n \n fn main() {\n     // assigning to various global constants\n-    None = Some(3); //~ ERROR cannot assign to immutable static item\n     foo = 6; //~ ERROR cannot assign to immutable static item\n }"}]}