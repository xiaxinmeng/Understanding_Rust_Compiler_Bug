{"sha": "9f7f9496000eb2e1e49eaab075233f0f44e7bdac", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmN2Y5NDk2MDAwZWIyZTFlNDllYWFiMDc1MjMzZjBmNDRlN2JkYWM=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2018-12-08T07:43:49Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-12-08T07:43:49Z"}, "message": "Rollup merge of #56620 - petrochenkov:noclutter, r=estebank\n\nresolve: Reduce some clutter in import ambiguity errors\n\nNoticed in https://www.reddit.com/r/rust/comments/a3pyrw/announcing_rust_131_and_rust_2018/eb8alhi/.\nThe first error is distracting, but unnecessary, it's a *consequence* of the ambiguity error and appears because one of the ambiguous `actix` modules (unsurprisingly) doesn't have the expected name in it.", "tree": {"sha": "e701e316cda063d1e224ffe53e927fedc7e45b1c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e701e316cda063d1e224ffe53e927fedc7e45b1c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9f7f9496000eb2e1e49eaab075233f0f44e7bdac", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcC3Y1CRBK7hj4Ov3rIwAAdHIIABv85hqucggUsQIscF6ZHSuI\nmOu0uTSRh92QU3kdGNkcBT1L5RwhVGTMiHhJTDXE1wa3BHRipPUlqAod5hmEPVWG\nyD3f133OvnjNQZUCQTh5vw8EBm2JO/mioHarX6M6Zq49qKc0wIUT6SvrJeh2E9yh\n07ED5vdc4JdFuMnN5qm0czSZkPDQJuBWWcVZULPq4ceM6BQ1mFS3UIzvK5/lUqZt\n/5BLGifRC1o4I7wCiwBIi7tuvx7XTzDI1uIh6fvFaZRHCPdQc2abq2SppuMVVL+D\ny3Aw3lao0WbqA0jJT6qFZgGoA/CaCdbuZJQmOYwCcqmThpz3A2Eh3v5Hur4uLDM=\n=esZJ\n-----END PGP SIGNATURE-----\n", "payload": "tree e701e316cda063d1e224ffe53e927fedc7e45b1c\nparent 7f076fa521e0a94781846585b60914fbd6ec0984\nparent 2010b4f60b6fd2d3b54e7aeef329bcb7f92aec76\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1544255029 +0100\ncommitter GitHub <noreply@github.com> 1544255029 +0100\n\nRollup merge of #56620 - petrochenkov:noclutter, r=estebank\n\nresolve: Reduce some clutter in import ambiguity errors\n\nNoticed in https://www.reddit.com/r/rust/comments/a3pyrw/announcing_rust_131_and_rust_2018/eb8alhi/.\nThe first error is distracting, but unnecessary, it's a *consequence* of the ambiguity error and appears because one of the ambiguous `actix` modules (unsurprisingly) doesn't have the expected name in it.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9f7f9496000eb2e1e49eaab075233f0f44e7bdac", "html_url": "https://github.com/rust-lang/rust/commit/9f7f9496000eb2e1e49eaab075233f0f44e7bdac", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9f7f9496000eb2e1e49eaab075233f0f44e7bdac/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7f076fa521e0a94781846585b60914fbd6ec0984", "url": "https://api.github.com/repos/rust-lang/rust/commits/7f076fa521e0a94781846585b60914fbd6ec0984", "html_url": "https://github.com/rust-lang/rust/commit/7f076fa521e0a94781846585b60914fbd6ec0984"}, {"sha": "2010b4f60b6fd2d3b54e7aeef329bcb7f92aec76", "url": "https://api.github.com/repos/rust-lang/rust/commits/2010b4f60b6fd2d3b54e7aeef329bcb7f92aec76", "html_url": "https://github.com/rust-lang/rust/commit/2010b4f60b6fd2d3b54e7aeef329bcb7f92aec76"}], "stats": {"total": 70, "additions": 30, "deletions": 40}, "files": [{"sha": "015cd31ac1d76d17d6909dd2011f90ea6a005503", "filename": "src/librustc_resolve/resolve_imports.rs", "status": "modified", "additions": 23, "deletions": 19, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/9f7f9496000eb2e1e49eaab075233f0f44e7bdac/src%2Flibrustc_resolve%2Fresolve_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f7f9496000eb2e1e49eaab075233f0f44e7bdac/src%2Flibrustc_resolve%2Fresolve_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fresolve_imports.rs?ref=9f7f9496000eb2e1e49eaab075233f0f44e7bdac", "patch": "@@ -843,14 +843,16 @@ impl<'a, 'b:'a, 'c: 'b> ImportResolver<'a, 'b, 'c> {\n         self.current_module = directive.parent_scope.module;\n \n         let orig_vis = directive.vis.replace(ty::Visibility::Invisible);\n+        let prev_ambiguity_errors_len = self.ambiguity_errors.len();\n         let path_res = self.resolve_path(&directive.module_path, None, &directive.parent_scope,\n                                          true, directive.span, directive.crate_lint());\n+        let no_ambiguity = self.ambiguity_errors.len() == prev_ambiguity_errors_len;\n         directive.vis.set(orig_vis);\n         let module = match path_res {\n             PathResult::Module(module) => {\n                 // Consistency checks, analogous to `finalize_current_module_macro_resolutions`.\n                 if let Some(initial_module) = directive.imported_module.get() {\n-                    if module != initial_module && self.ambiguity_errors.is_empty() {\n+                    if module != initial_module && no_ambiguity {\n                         span_bug!(directive.span, \"inconsistent resolution for an import\");\n                     }\n                 } else {\n@@ -864,30 +866,32 @@ impl<'a, 'b:'a, 'c: 'b> ImportResolver<'a, 'b, 'c> {\n                 module\n             }\n             PathResult::Failed(span, msg, false) => {\n-                assert!(!self.ambiguity_errors.is_empty() ||\n-                        directive.imported_module.get().is_none());\n-                resolve_error(self, span, ResolutionError::FailedToResolve(&msg));\n+                if no_ambiguity {\n+                    assert!(directive.imported_module.get().is_none());\n+                    resolve_error(self, span, ResolutionError::FailedToResolve(&msg));\n+                }\n                 return None;\n             }\n             PathResult::Failed(span, msg, true) => {\n-                assert!(!self.ambiguity_errors.is_empty() ||\n-                        directive.imported_module.get().is_none());\n-                return if let Some((suggested_path, note)) = self.make_path_suggestion(\n-                    span, directive.module_path.clone(), &directive.parent_scope\n-                ) {\n-                    Some((\n-                        span,\n-                        format!(\"did you mean `{}`?\", Segment::names_to_string(&suggested_path)),\n-                        note,\n-                    ))\n-                } else {\n-                    Some((span, msg, None))\n-                };\n+                if no_ambiguity {\n+                    assert!(directive.imported_module.get().is_none());\n+                    return Some(match self.make_path_suggestion(span, directive.module_path.clone(),\n+                                                                &directive.parent_scope) {\n+                        Some((suggestion, note)) => (\n+                            span,\n+                            format!(\"did you mean `{}`?\", Segment::names_to_string(&suggestion)),\n+                            note,\n+                        ),\n+                        None => (span, msg, None),\n+                    });\n+                }\n+                return None;\n             }\n             PathResult::NonModule(path_res) if path_res.base_def() == Def::Err => {\n+                if no_ambiguity {\n+                    assert!(directive.imported_module.get().is_none());\n+                }\n                 // The error was already reported earlier.\n-                assert!(!self.ambiguity_errors.is_empty() ||\n-                        directive.imported_module.get().is_none());\n                 return None;\n             }\n             PathResult::Indeterminate | PathResult::NonModule(..) => unreachable!(),"}, {"sha": "0327522e4b8d60760f6c3259ca885cf2a0972b79", "filename": "src/test/ui/imports/issue-56125.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9f7f9496000eb2e1e49eaab075233f0f44e7bdac/src%2Ftest%2Fui%2Fimports%2Fissue-56125.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9f7f9496000eb2e1e49eaab075233f0f44e7bdac/src%2Ftest%2Fui%2Fimports%2Fissue-56125.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fissue-56125.rs?ref=9f7f9496000eb2e1e49eaab075233f0f44e7bdac", "patch": "@@ -7,13 +7,11 @@\n mod m1 {\n     use issue_56125::last_segment::*;\n     //~^ ERROR `issue_56125` is ambiguous\n-    //~| ERROR unresolved import `issue_56125::last_segment`\n }\n \n mod m2 {\n     use issue_56125::non_last_segment::non_last_segment::*;\n     //~^ ERROR `issue_56125` is ambiguous\n-    //~| ERROR failed to resolve: could not find `non_last_segment` in `issue_56125`\n }\n \n mod m3 {"}, {"sha": "559979e5d51c308e544fcfa71df97857e9532456", "filename": "src/test/ui/imports/issue-56125.stderr", "status": "modified", "additions": 7, "deletions": 19, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/9f7f9496000eb2e1e49eaab075233f0f44e7bdac/src%2Ftest%2Fui%2Fimports%2Fissue-56125.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9f7f9496000eb2e1e49eaab075233f0f44e7bdac/src%2Ftest%2Fui%2Fimports%2Fissue-56125.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimports%2Fissue-56125.stderr?ref=9f7f9496000eb2e1e49eaab075233f0f44e7bdac", "patch": "@@ -1,17 +1,5 @@\n-error[E0433]: failed to resolve: could not find `non_last_segment` in `issue_56125`\n-  --> $DIR/issue-56125.rs:14:22\n-   |\n-LL |     use issue_56125::non_last_segment::non_last_segment::*;\n-   |                      ^^^^^^^^^^^^^^^^ could not find `non_last_segment` in `issue_56125`\n-\n-error[E0432]: unresolved import `issue_56125::last_segment`\n-  --> $DIR/issue-56125.rs:8:22\n-   |\n-LL |     use issue_56125::last_segment::*;\n-   |                      ^^^^^^^^^^^^ could not find `last_segment` in `issue_56125`\n-\n error[E0432]: unresolved import `empty::issue_56125`\n-  --> $DIR/issue-56125.rs:21:9\n+  --> $DIR/issue-56125.rs:19:9\n    |\n LL |     use empty::issue_56125; //~ ERROR unresolved import `empty::issue_56125`\n    |         ^^^^^^^^^^^^^^^^^^ no `issue_56125` in `m3::empty`\n@@ -32,36 +20,36 @@ LL |     use issue_56125::last_segment::*;\n    = help: use `self::issue_56125` to refer to this module unambiguously\n \n error[E0659]: `issue_56125` is ambiguous (name vs any other name during import resolution)\n-  --> $DIR/issue-56125.rs:14:9\n+  --> $DIR/issue-56125.rs:13:9\n    |\n LL |     use issue_56125::non_last_segment::non_last_segment::*;\n    |         ^^^^^^^^^^^ ambiguous name\n    |\n    = note: `issue_56125` could refer to an extern crate passed with `--extern`\n    = help: use `::issue_56125` to refer to this extern crate unambiguously\n note: `issue_56125` could also refer to the module imported here\n-  --> $DIR/issue-56125.rs:14:9\n+  --> $DIR/issue-56125.rs:13:9\n    |\n LL |     use issue_56125::non_last_segment::non_last_segment::*;\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    = help: use `self::issue_56125` to refer to this module unambiguously\n \n error[E0659]: `issue_56125` is ambiguous (name vs any other name during import resolution)\n-  --> $DIR/issue-56125.rs:22:9\n+  --> $DIR/issue-56125.rs:20:9\n    |\n LL |     use issue_56125::*; //~ ERROR `issue_56125` is ambiguous\n    |         ^^^^^^^^^^^ ambiguous name\n    |\n    = note: `issue_56125` could refer to an extern crate passed with `--extern`\n    = help: use `::issue_56125` to refer to this extern crate unambiguously\n note: `issue_56125` could also refer to the unresolved item imported here\n-  --> $DIR/issue-56125.rs:21:9\n+  --> $DIR/issue-56125.rs:19:9\n    |\n LL |     use empty::issue_56125; //~ ERROR unresolved import `empty::issue_56125`\n    |         ^^^^^^^^^^^^^^^^^^\n    = help: use `self::issue_56125` to refer to this unresolved item unambiguously\n \n-error: aborting due to 6 previous errors\n+error: aborting due to 4 previous errors\n \n-Some errors occurred: E0432, E0433, E0659.\n+Some errors occurred: E0432, E0659.\n For more information about an error, try `rustc --explain E0432`."}]}