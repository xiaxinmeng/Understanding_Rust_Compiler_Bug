{"sha": "b58a7f41f14f56375c602911be768d40cf46de04", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI1OGE3ZjQxZjE0ZjU2Mzc1YzYwMjkxMWJlNzY4ZDQwY2Y0NmRlMDQ=", "commit": {"author": {"name": "Lauren\u021biu Nicola", "email": "lnicola@dend.ro", "date": "2020-04-05T15:18:40Z"}, "committer": {"name": "Lauren\u021biu Nicola", "email": "lnicola@dend.ro", "date": "2020-04-05T15:18:40Z"}, "message": "Fix inference of function pointer return types", "tree": {"sha": "9c27eb88a68fceade7480ac83b1ba271c8e1f6f0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9c27eb88a68fceade7480ac83b1ba271c8e1f6f0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b58a7f41f14f56375c602911be768d40cf46de04", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b58a7f41f14f56375c602911be768d40cf46de04", "html_url": "https://github.com/rust-lang/rust/commit/b58a7f41f14f56375c602911be768d40cf46de04", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b58a7f41f14f56375c602911be768d40cf46de04/comments", "author": {"login": "lnicola", "id": 308347, "node_id": "MDQ6VXNlcjMwODM0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/308347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lnicola", "html_url": "https://github.com/lnicola", "followers_url": "https://api.github.com/users/lnicola/followers", "following_url": "https://api.github.com/users/lnicola/following{/other_user}", "gists_url": "https://api.github.com/users/lnicola/gists{/gist_id}", "starred_url": "https://api.github.com/users/lnicola/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lnicola/subscriptions", "organizations_url": "https://api.github.com/users/lnicola/orgs", "repos_url": "https://api.github.com/users/lnicola/repos", "events_url": "https://api.github.com/users/lnicola/events{/privacy}", "received_events_url": "https://api.github.com/users/lnicola/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lnicola", "id": 308347, "node_id": "MDQ6VXNlcjMwODM0Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/308347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lnicola", "html_url": "https://github.com/lnicola", "followers_url": "https://api.github.com/users/lnicola/followers", "following_url": "https://api.github.com/users/lnicola/following{/other_user}", "gists_url": "https://api.github.com/users/lnicola/gists{/gist_id}", "starred_url": "https://api.github.com/users/lnicola/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lnicola/subscriptions", "organizations_url": "https://api.github.com/users/lnicola/orgs", "repos_url": "https://api.github.com/users/lnicola/repos", "events_url": "https://api.github.com/users/lnicola/events{/privacy}", "received_events_url": "https://api.github.com/users/lnicola/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e300e1e8d8f4de273d52fa62762ed14e8a7f96bb", "url": "https://api.github.com/repos/rust-lang/rust/commits/e300e1e8d8f4de273d52fa62762ed14e8a7f96bb", "html_url": "https://github.com/rust-lang/rust/commit/e300e1e8d8f4de273d52fa62762ed14e8a7f96bb"}], "stats": {"total": 32, "additions": 31, "deletions": 1}, "files": [{"sha": "01cc392db02709ad5d445f42e1da374e5a32feda", "filename": "crates/ra_hir_def/src/type_ref.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b58a7f41f14f56375c602911be768d40cf46de04/crates%2Fra_hir_def%2Fsrc%2Ftype_ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b58a7f41f14f56375c602911be768d40cf46de04/crates%2Fra_hir_def%2Fsrc%2Ftype_ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Ftype_ref.rs?ref=b58a7f41f14f56375c602911be768d40cf46de04", "patch": "@@ -93,7 +93,11 @@ impl TypeRef {\n             }\n             ast::TypeRef::PlaceholderType(_inner) => TypeRef::Placeholder,\n             ast::TypeRef::FnPointerType(inner) => {\n-                let ret_ty = TypeRef::from_ast_opt(inner.ret_type().and_then(|rt| rt.type_ref()));\n+                let ret_ty = inner\n+                    .ret_type()\n+                    .and_then(|rt| rt.type_ref())\n+                    .map(TypeRef::from_ast)\n+                    .unwrap_or_else(|| TypeRef::Tuple(Vec::new()));\n                 let mut params = if let Some(pl) = inner.param_list() {\n                     pl.params().map(|p| p.ascribed_type()).map(TypeRef::from_ast_opt).collect()\n                 } else {"}, {"sha": "141f0245aa0868952dd613c4f453e598c9636e25", "filename": "crates/ra_hir_ty/src/tests/simple.rs", "status": "modified", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/b58a7f41f14f56375c602911be768d40cf46de04/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fsimple.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b58a7f41f14f56375c602911be768d40cf46de04/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fsimple.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fsimple.rs?ref=b58a7f41f14f56375c602911be768d40cf46de04", "patch": "@@ -1729,3 +1729,29 @@ fn foo() -> u32 {\n     \"###\n     );\n }\n+\n+#[test]\n+fn fn_pointer_return() {\n+    assert_snapshot!(\n+        infer(r#\"\n+struct Vtable {\n+    method: fn(),\n+}\n+\n+fn main() {\n+    let vtable = Vtable { method: || {} };\n+    let m = vtable.method;\n+}\n+\"#),\n+        @r###\"\n+    [48; 121) '{     ...hod; }': ()\n+    [58; 64) 'vtable': Vtable\n+    [67; 91) 'Vtable...| {} }': Vtable\n+    [84; 89) '|| {}': || -> ()\n+    [87; 89) '{}': ()\n+    [101; 102) 'm': fn() -> ()\n+    [105; 111) 'vtable': Vtable\n+    [105; 118) 'vtable.method': fn() -> ()\n+    \"###\n+    );\n+}"}]}