{"sha": "25266c18409858ac0c482bc00a6d72c0f83f3df2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI1MjY2YzE4NDA5ODU4YWMwYzQ4MmJjMDBhNmQ3MmMwZjgzZjNkZjI=", "commit": {"author": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2018-07-05T18:14:34Z"}, "committer": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2018-07-05T19:57:32Z"}, "message": "Do not run AST borrowck when -Zborrowck=mir", "tree": {"sha": "1be792a758064b6a0538dd1d6c55e6c6c1d30e27", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1be792a758064b6a0538dd1d6c55e6c6c1d30e27"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/25266c18409858ac0c482bc00a6d72c0f83f3df2", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEmNHc6jmXzkUyxd4xiMlBzaHUZDIFAls+eC4ACgkQiMlBzaHU\nZDLG9A/+Nptt5dyQqsVkOTgijMzVmBuTL6XDmqH8433Ya/jDv66DVHpALdaNX855\nqM8UvO+5vjZrmpUjT0oqCjc2HvnG0WtO9hBqGZFPEqxWqffL5r3Ink6CFVURtd9V\niBkcw9nvgTsCbarH6HbW7WO0brMc20XQ4qj0jGBSVRy/X6NZOqdAZNY1GM7oEiHH\n9gQL6H95uzzgTqhD8qGy6Ocj2wreiJvELAyBz2fNHx7ylw36kC6XeGDAqPuJ9eDo\nU7/q92jGID4WzsxEDQamFzcjub/+rAgRnJwdcnztiM8DyPkYlrNSPaVobnIyK//0\nMCUT1Oc4ZEsup3yvoM96MPuk8vcj4sNRL9seZkGKC9pR6ngOoqtCUrSQCpb6Y843\nTLEV8twIRz4M1RrSveHyd2Gg+eBQCu7lHK4uNI2egR5T5vqxvs2BgIO1BKVBpOtx\njUD7xaFRnUJupJ3wnm2H1bw3lEMptJ2XQPrfth3Hl/YRozkkvQnnKBhVdEDzt+bA\n8pIKsMhV3lz+xM65z2akUrpi5da4gJskezB3P5JU78NYo8b82nsZh9mxtuUOQPSS\nhGsl7YC4LC5n2UqkMJJ513fjee3kS/l/h+wJ0kWLBhn/oNiGl2jQXnx4GvyMuAUT\nLVINnG4DdB8lGwk4SDei9Z3Wwb+PPYYwHjXk67ayRMko5Rceip4=\n=XEbT\n-----END PGP SIGNATURE-----", "payload": "tree 1be792a758064b6a0538dd1d6c55e6c6c1d30e27\nparent 0e31e2fa9b984ac15e3818685fa3ad87216811df\nauthor Santiago Pastorino <spastorino@gmail.com> 1530814474 -0300\ncommitter Santiago Pastorino <spastorino@gmail.com> 1530820652 -0300\n\nDo not run AST borrowck when -Zborrowck=mir\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/25266c18409858ac0c482bc00a6d72c0f83f3df2", "html_url": "https://github.com/rust-lang/rust/commit/25266c18409858ac0c482bc00a6d72c0f83f3df2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/25266c18409858ac0c482bc00a6d72c0f83f3df2/comments", "author": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "committer": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0e31e2fa9b984ac15e3818685fa3ad87216811df", "url": "https://api.github.com/repos/rust-lang/rust/commits/0e31e2fa9b984ac15e3818685fa3ad87216811df", "html_url": "https://github.com/rust-lang/rust/commit/0e31e2fa9b984ac15e3818685fa3ad87216811df"}], "stats": {"total": 43, "additions": 29, "deletions": 14}, "files": [{"sha": "8f7f9d09423f68198ffd321e6587a286881f7ba9", "filename": "src/librustc/ty/context.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/25266c18409858ac0c482bc00a6d72c0f83f3df2/src%2Flibrustc%2Fty%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/25266c18409858ac0c482bc00a6d72c0f83f3df2/src%2Flibrustc%2Fty%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fcontext.rs?ref=25266c18409858ac0c482bc00a6d72c0f83f3df2", "patch": "@@ -1354,6 +1354,12 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n         !self.sess.opts.debugging_opts.disable_ast_check_for_mutation_in_guard\n     }\n \n+    /// If true, we should use the AST-based borrowck (we may *also* use\n+    /// the MIR-based borrowck).\n+    pub fn use_ast_borrowck(self) -> bool {\n+        self.borrowck_mode().use_ast()\n+    }\n+\n     /// If true, we should use the MIR-based borrowck (we may *also* use\n     /// the AST-based borrowck).\n     pub fn use_mir_borrowck(self) -> bool {"}, {"sha": "df1b1138f3e888cbbe7848242dcf370875a2b2db", "filename": "src/librustc_borrowck/borrowck/mod.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/25266c18409858ac0c482bc00a6d72c0f83f3df2/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/25266c18409858ac0c482bc00a6d72c0f83f3df2/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs?ref=25266c18409858ac0c482bc00a6d72c0f83f3df2", "patch": "@@ -89,6 +89,8 @@ pub struct AnalysisData<'a, 'tcx: 'a> {\n fn borrowck<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>, owner_def_id: DefId)\n     -> Lrc<BorrowCheckResult>\n {\n+    assert!(tcx.use_ast_borrowck());\n+\n     debug!(\"borrowck(body_owner_def_id={:?})\", owner_def_id);\n \n     let owner_id = tcx.hir.as_local_node_id(owner_def_id).unwrap();"}, {"sha": "96e9616699d3717a8ba86adfb524547f4307927c", "filename": "src/librustc_driver/driver.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/25266c18409858ac0c482bc00a6d72c0f83f3df2/src%2Flibrustc_driver%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/25266c18409858ac0c482bc00a6d72c0f83f3df2/src%2Flibrustc_driver%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Fdriver.rs?ref=25266c18409858ac0c482bc00a6d72c0f83f3df2", "patch": "@@ -1279,7 +1279,11 @@ where\n                 middle::liveness::check_crate(tcx)\n             });\n \n-            time(sess, \"borrow checking\", || borrowck::check_crate(tcx));\n+            time(sess, \"borrow checking\", || {\n+                if tcx.use_ast_borrowck() {\n+                    borrowck::check_crate(tcx);\n+                }\n+            });\n \n             time(sess,\n                  \"MIR borrow checking\","}, {"sha": "90dfebeef1b0ca7b0bb194b1bc46d3808e2ca251", "filename": "src/librustc_mir/transform/mod.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/25266c18409858ac0c482bc00a6d72c0f83f3df2/src%2Flibrustc_mir%2Ftransform%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/25266c18409858ac0c482bc00a6d72c0f83f3df2/src%2Flibrustc_mir%2Ftransform%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fmod.rs?ref=25266c18409858ac0c482bc00a6d72c0f83f3df2", "patch": "@@ -225,7 +225,10 @@ fn optimized_mir<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>, def_id: DefId) -> &'tcx\n     // (Mir-)Borrowck uses `mir_validated`, so we have to force it to\n     // execute before we can steal.\n     let _ = tcx.mir_borrowck(def_id);\n-    let _ = tcx.borrowck(def_id);\n+\n+    if tcx.use_ast_borrowck() {\n+        let _ = tcx.borrowck(def_id);\n+    }\n \n     let mut mir = tcx.mir_validated(def_id).steal();\n     run_passes![tcx, mir, def_id, 2;"}, {"sha": "addbbf4434f4f99cda802fd5f319acefb0642d90", "filename": "src/test/ui/error-codes/E0017.nll.stderr", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/25266c18409858ac0c482bc00a6d72c0f83f3df2/src%2Ftest%2Fui%2Ferror-codes%2FE0017.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/25266c18409858ac0c482bc00a6d72c0f83f3df2/src%2Ftest%2Fui%2Ferror-codes%2FE0017.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0017.nll.stderr?ref=25266c18409858ac0c482bc00a6d72c0f83f3df2", "patch": "@@ -10,18 +10,18 @@ error[E0017]: references in statics may only refer to immutable values\n LL | static STATIC_REF: &'static mut i32 = &mut X; //~ ERROR E0017\n    |                                       ^^^^^^ statics require immutable values\n \n-error[E0017]: references in statics may only refer to immutable values\n-  --> $DIR/E0017.rs:17:38\n-   |\n-LL | static CONST_REF: &'static mut i32 = &mut C; //~ ERROR E0017\n-   |                                      ^^^^^^ statics require immutable values\n-\n error[E0596]: cannot borrow immutable item `X` as mutable\n   --> $DIR/E0017.rs:15:39\n    |\n LL | static STATIC_REF: &'static mut i32 = &mut X; //~ ERROR E0017\n    |                                       ^^^^^^ cannot borrow as mutable\n \n+error[E0017]: references in statics may only refer to immutable values\n+  --> $DIR/E0017.rs:17:38\n+   |\n+LL | static CONST_REF: &'static mut i32 = &mut C; //~ ERROR E0017\n+   |                                      ^^^^^^ statics require immutable values\n+\n error: aborting due to 4 previous errors\n \n Some errors occurred: E0017, E0596."}, {"sha": "0238ca6b623da26ab44c7c91d11c7f624c785c50", "filename": "src/test/ui/error-codes/E0388.nll.stderr", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/25266c18409858ac0c482bc00a6d72c0f83f3df2/src%2Ftest%2Fui%2Ferror-codes%2FE0388.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/25266c18409858ac0c482bc00a6d72c0f83f3df2/src%2Ftest%2Fui%2Ferror-codes%2FE0388.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ferror-codes%2FE0388.nll.stderr?ref=25266c18409858ac0c482bc00a6d72c0f83f3df2", "patch": "@@ -10,18 +10,18 @@ error[E0017]: references in statics may only refer to immutable values\n LL | static STATIC_REF: &'static mut i32 = &mut X; //~ ERROR E0017\n    |                                       ^^^^^^ statics require immutable values\n \n-error[E0017]: references in statics may only refer to immutable values\n-  --> $DIR/E0388.rs:17:38\n-   |\n-LL | static CONST_REF: &'static mut i32 = &mut C; //~ ERROR E0017\n-   |                                      ^^^^^^ statics require immutable values\n-\n error[E0596]: cannot borrow immutable item `X` as mutable\n   --> $DIR/E0388.rs:15:39\n    |\n LL | static STATIC_REF: &'static mut i32 = &mut X; //~ ERROR E0017\n    |                                       ^^^^^^ cannot borrow as mutable\n \n+error[E0017]: references in statics may only refer to immutable values\n+  --> $DIR/E0388.rs:17:38\n+   |\n+LL | static CONST_REF: &'static mut i32 = &mut C; //~ ERROR E0017\n+   |                                      ^^^^^^ statics require immutable values\n+\n error: aborting due to 4 previous errors\n \n Some errors occurred: E0017, E0596."}]}