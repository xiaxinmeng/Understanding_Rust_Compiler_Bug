{"sha": "cbe932801892da06688b53638622be1c8a1c8974", "node_id": "C_kwDOAAsO6NoAKGNiZTkzMjgwMTg5MmRhMDY2ODhiNTM2Mzg2MjJiZTFjOGExYzg5NzQ", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-11-11T03:19:02Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-11-23T04:42:38Z"}, "message": "Do not need to account for overflow in predicate_can_apply", "tree": {"sha": "82d8a35318fa85699871ff7b82dc84e0b45b0d49", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/82d8a35318fa85699871ff7b82dc84e0b45b0d49"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cbe932801892da06688b53638622be1c8a1c8974", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cbe932801892da06688b53638622be1c8a1c8974", "html_url": "https://github.com/rust-lang/rust/commit/cbe932801892da06688b53638622be1c8a1c8974", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cbe932801892da06688b53638622be1c8a1c8974/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "604d52108e9272d75618ab6a7b5eb006857fce52", "url": "https://api.github.com/repos/rust-lang/rust/commits/604d52108e9272d75618ab6a7b5eb006857fce52", "html_url": "https://github.com/rust-lang/rust/commit/604d52108e9272d75618ab6a7b5eb006857fce52"}], "stats": {"total": 32, "additions": 31, "deletions": 1}, "files": [{"sha": "c2a7be804676258850f0c43fa9cd9dedb35dc48a", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/mod.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cbe932801892da06688b53638622be1c8a1c8974/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cbe932801892da06688b53638622be1c8a1c8974/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs?ref=cbe932801892da06688b53638622be1c8a1c8974", "patch": "@@ -2544,7 +2544,10 @@ impl<'tcx> InferCtxtPrivExt<'tcx> for TypeErrCtxt<'_, 'tcx> {\n             let obligation =\n                 Obligation::new(self.tcx, ObligationCause::dummy(), param_env, cleaned_pred);\n \n-            self.predicate_may_hold(&obligation)\n+            // We don't use `InferCtxt::predicate_may_hold` because that\n+            // will re-run predicates that overflow locally, which ends up\n+            // taking a really long time to compute.\n+            self.evaluate_obligation(&obligation).map_or(false, |eval| eval.may_apply())\n         })\n     }\n "}, {"sha": "5f01645da5242c5fd26b4ba510fe93bdb60fcf63", "filename": "src/test/ui/traits/predicate_can_apply-hang.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cbe932801892da06688b53638622be1c8a1c8974/src%2Ftest%2Fui%2Ftraits%2Fpredicate_can_apply-hang.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cbe932801892da06688b53638622be1c8a1c8974/src%2Ftest%2Fui%2Ftraits%2Fpredicate_can_apply-hang.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fpredicate_can_apply-hang.rs?ref=cbe932801892da06688b53638622be1c8a1c8974", "patch": "@@ -0,0 +1,6 @@\n+fn f<B>(x: Vec<[[[B; 1]; 1]; 1]>) -> impl PartialEq<B> {\n+    //~^ ERROR can't compare `Vec<[[[B; 1]; 1]; 1]>` with `B`\n+    x\n+}\n+\n+fn main() {}"}, {"sha": "49fe63b412ac91b3ec165282a82e421abe8c30cb", "filename": "src/test/ui/traits/predicate_can_apply-hang.stderr", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/cbe932801892da06688b53638622be1c8a1c8974/src%2Ftest%2Fui%2Ftraits%2Fpredicate_can_apply-hang.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cbe932801892da06688b53638622be1c8a1c8974/src%2Ftest%2Fui%2Ftraits%2Fpredicate_can_apply-hang.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fpredicate_can_apply-hang.stderr?ref=cbe932801892da06688b53638622be1c8a1c8974", "patch": "@@ -0,0 +1,21 @@\n+error[E0277]: can't compare `Vec<[[[B; 1]; 1]; 1]>` with `B`\n+  --> $DIR/predicate_can_apply-hang.rs:1:38\n+   |\n+LL | fn f<B>(x: Vec<[[[B; 1]; 1]; 1]>) -> impl PartialEq<B> {\n+   |                                      ^^^^^^^^^^^^^^^^^ no implementation for `Vec<[[[B; 1]; 1]; 1]> == B`\n+LL |\n+LL |     x\n+   |     - return type was inferred to be `Vec<[[[B; 1]; 1]; 1]>` here\n+   |\n+   = help: the trait `PartialEq<B>` is not implemented for `Vec<[[[B; 1]; 1]; 1]>`\n+   = help: the following other types implement trait `PartialEq<Rhs>`:\n+             <Vec<T, A1> as PartialEq<Vec<U, A2>>>\n+             <Vec<T, A> as PartialEq<&[U; N]>>\n+             <Vec<T, A> as PartialEq<&[U]>>\n+             <Vec<T, A> as PartialEq<&mut [U]>>\n+             <Vec<T, A> as PartialEq<[U; N]>>\n+             <Vec<T, A> as PartialEq<[U]>>\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0277`."}]}