{"sha": "a1ecdb103d32551ffb5bf552f95c88292b7eac1c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmExZWNkYjEwM2QzMjU1MWZmYjViZjU1MmY5NWM4ODI5MmI3ZWFjMWM=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-08-03T23:28:50Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-08-03T23:28:50Z"}, "message": "Fix some naughtiness of handling newlines in bracequotes and multi-line comments. Closes #142.", "tree": {"sha": "b9de43929b763d6acf5e4348aabc4843b06a062b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b9de43929b763d6acf5e4348aabc4843b06a062b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a1ecdb103d32551ffb5bf552f95c88292b7eac1c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a1ecdb103d32551ffb5bf552f95c88292b7eac1c", "html_url": "https://github.com/rust-lang/rust/commit/a1ecdb103d32551ffb5bf552f95c88292b7eac1c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a1ecdb103d32551ffb5bf552f95c88292b7eac1c/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1fc4e9fcc623df313dcaaf541f08fc7a8415c67f", "url": "https://api.github.com/repos/rust-lang/rust/commits/1fc4e9fcc623df313dcaaf541f08fc7a8415c67f", "html_url": "https://github.com/rust-lang/rust/commit/1fc4e9fcc623df313dcaaf541f08fc7a8415c67f"}], "stats": {"total": 30, "additions": 23, "deletions": 7}, "files": [{"sha": "ed548b1e78c107bb35b5ceafb39bcba65a1101d8", "filename": "src/boot/fe/lexer.mll", "status": "modified", "additions": 13, "deletions": 7, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/a1ecdb103d32551ffb5bf552f95c88292b7eac1c/src%2Fboot%2Ffe%2Flexer.mll", "raw_url": "https://github.com/rust-lang/rust/raw/a1ecdb103d32551ffb5bf552f95c88292b7eac1c/src%2Fboot%2Ffe%2Flexer.mll", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fboot%2Ffe%2Flexer.mll?ref=a1ecdb103d32551ffb5bf552f95c88292b7eac1c", "patch": "@@ -22,6 +22,11 @@\n               Lexing.pos_bol = p.Lexing.pos_cnum }\n   ;;\n \n+  let newline lexbuf =\n+    lexbuf.Lexing.lex_curr_p\n+    <- (bump_line lexbuf.Lexing.lex_curr_p)\n+  ;;\n+\n   let mach_suf_table = Hashtbl.create 0\n   ;;\n   let _ =\n@@ -155,8 +160,7 @@ let id = ['a'-'z' 'A'-'Z' '_']['a'-'z' 'A'-'Z' '0'-'9' '_']*\n \n rule token = parse\n   ws+                          { token lexbuf }\n-| '\\n'                         { lexbuf.Lexing.lex_curr_p\n-                                     <- (bump_line lexbuf.Lexing.lex_curr_p);\n+| '\\n'                         { newline lexbuf;\n                                  token lexbuf }\n | \"//\" [^'\\n']*                { token lexbuf }\n | \"/*\"                         { comment 1 lexbuf }\n@@ -389,8 +393,9 @@ and bracequote buf depth = parse\n                                     bracequote buf depth lexbuf        }\n \n \n-| [^'\\\\' '{' '}']+              { let s = Lexing.lexeme lexbuf in\n-                                    Buffer.add_string buf s;\n+| [^'\\\\' '{' '}'] as c          {   Buffer.add_char buf c;\n+                                    if c = '\\n'\n+                                    then newline lexbuf;\n                                     bracequote buf depth lexbuf        }\n \n \n@@ -402,6 +407,7 @@ and comment depth = parse\n                                   then token lexbuf\n                                   else comment (depth-1) lexbuf }\n \n-| '*' [^'{']                   { comment depth lexbuf           }\n-| '/' [^'*']                   { comment depth lexbuf           }\n-| [^'/' '*']+                  { comment depth lexbuf           }\n+| '\\n'                          { newline lexbuf;\n+                                  comment depth lexbuf           }\n+\n+| _                             { comment depth lexbuf           }"}, {"sha": "3f555bfc87bdac90ff294c78c2f4d7a120dd0289", "filename": "src/test/compile-fail/multiline-comment-line-tracking.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/a1ecdb103d32551ffb5bf552f95c88292b7eac1c/src%2Ftest%2Fcompile-fail%2Fmultiline-comment-line-tracking.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a1ecdb103d32551ffb5bf552f95c88292b7eac1c/src%2Ftest%2Fcompile-fail%2Fmultiline-comment-line-tracking.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fmultiline-comment-line-tracking.rs?ref=a1ecdb103d32551ffb5bf552f95c88292b7eac1c", "patch": "@@ -0,0 +1,10 @@\n+// -*- rust -*-\n+// error-pattern:9:2:E\n+\n+/* 1\n+ * 2\n+ * 3\n+ */\n+fn main() {\n+  %; // parse error on line 9, but is reported on line 6 instead.\n+}"}]}