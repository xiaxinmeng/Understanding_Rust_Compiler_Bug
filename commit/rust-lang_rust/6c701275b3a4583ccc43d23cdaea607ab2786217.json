{"sha": "6c701275b3a4583ccc43d23cdaea607ab2786217", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZjNzAxMjc1YjNhNDU4M2NjYzQzZDIzY2RhZWE2MDdhYjI3ODYyMTc=", "commit": {"author": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2015-07-04T21:25:38Z"}, "committer": {"name": "Michael Woerister", "email": "michaelwoerister@posteo", "date": "2015-07-12T19:00:34Z"}, "message": "debuginfo: Instruct MSVC linker to generate PDB file if debuginfo is enabled", "tree": {"sha": "a6052c6dbc55be0bc7c06c3142d7b0ba96b9ee0b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a6052c6dbc55be0bc7c06c3142d7b0ba96b9ee0b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6c701275b3a4583ccc43d23cdaea607ab2786217", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6c701275b3a4583ccc43d23cdaea607ab2786217", "html_url": "https://github.com/rust-lang/rust/commit/6c701275b3a4583ccc43d23cdaea607ab2786217", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6c701275b3a4583ccc43d23cdaea607ab2786217/comments", "author": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "committer": {"login": "michaelwoerister", "id": 1825894, "node_id": "MDQ6VXNlcjE4MjU4OTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1825894?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelwoerister", "html_url": "https://github.com/michaelwoerister", "followers_url": "https://api.github.com/users/michaelwoerister/followers", "following_url": "https://api.github.com/users/michaelwoerister/following{/other_user}", "gists_url": "https://api.github.com/users/michaelwoerister/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelwoerister/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelwoerister/subscriptions", "organizations_url": "https://api.github.com/users/michaelwoerister/orgs", "repos_url": "https://api.github.com/users/michaelwoerister/repos", "events_url": "https://api.github.com/users/michaelwoerister/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelwoerister/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "50d305e498c29c022c5bca2726d22e9f09b0a437", "url": "https://api.github.com/repos/rust-lang/rust/commits/50d305e498c29c022c5bca2726d22e9f09b0a437", "html_url": "https://github.com/rust-lang/rust/commit/50d305e498c29c022c5bca2726d22e9f09b0a437"}], "stats": {"total": 24, "additions": 24, "deletions": 0}, "files": [{"sha": "d7849e8f555ba7539a49deef252e5d2cde6d385c", "filename": "src/librustc_trans/back/link.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6c701275b3a4583ccc43d23cdaea607ab2786217/src%2Flibrustc_trans%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6c701275b3a4583ccc43d23cdaea607ab2786217/src%2Flibrustc_trans%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Flink.rs?ref=6c701275b3a4583ccc43d23cdaea607ab2786217", "patch": "@@ -954,6 +954,9 @@ fn link_args(cmd: &mut Linker,\n     // Pass optimization flags down to the linker.\n     cmd.optimize();\n \n+    // Pass debuginfo flags down to the linker.\n+    cmd.debuginfo();\n+\n     // We want to prevent the compiler from accidentally leaking in any system\n     // libraries, so we explicitly ask gcc to not link to any libraries by\n     // default. Note that this does not happen for windows because windows pulls"}, {"sha": "3a709955098c3db0622899741ac4e0fe3917fa38", "filename": "src/librustc_trans/back/linker.rs", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/6c701275b3a4583ccc43d23cdaea607ab2786217/src%2Flibrustc_trans%2Fback%2Flinker.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6c701275b3a4583ccc43d23cdaea607ab2786217/src%2Flibrustc_trans%2Fback%2Flinker.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_trans%2Fback%2Flinker.rs?ref=6c701275b3a4583ccc43d23cdaea607ab2786217", "patch": "@@ -16,6 +16,7 @@ use std::fs;\n use back::archive;\n use session::Session;\n use session::config;\n+use session::config::DebugInfoLevel::{NoDebugInfo, LimitedDebugInfo, FullDebugInfo};\n \n /// Linker abstraction used by back::link to build up the command to invoke a\n /// linker.\n@@ -39,6 +40,7 @@ pub trait Linker {\n     fn gc_sections(&mut self, is_dylib: bool);\n     fn position_independent_executable(&mut self);\n     fn optimize(&mut self);\n+    fn debuginfo(&mut self);\n     fn no_default_libraries(&mut self);\n     fn build_dylib(&mut self, out_filename: &Path);\n     fn args(&mut self, args: &[String]);\n@@ -143,6 +145,10 @@ impl<'a> Linker for GnuLinker<'a> {\n         }\n     }\n \n+    fn debuginfo(&mut self) {\n+        // Don't do anything special here for GNU-style linkers.\n+    }\n+\n     fn no_default_libraries(&mut self) {\n         // Unfortunately right now passing -nodefaultlibs to gcc on windows\n         // doesn't work so hot (in terms of native dependencies). This if\n@@ -265,6 +271,21 @@ impl<'a> Linker for MsvcLinker<'a> {\n     fn optimize(&mut self) {\n         // Needs more investigation of `/OPT` arguments\n     }\n+\n+    fn debuginfo(&mut self) {\n+        match self.sess.opts.debuginfo {\n+            NoDebugInfo => {\n+                // Do nothing if debuginfo is disabled\n+            },\n+            LimitedDebugInfo |\n+            FullDebugInfo    => {\n+                // This will cause the Microsoft linker to generate a PDB file\n+                // from the CodeView line tables in the object files.\n+                self.cmd.arg(\"/DEBUG\");\n+            }\n+        }\n+    }\n+\n     fn whole_archives(&mut self) {\n         // hints not supported?\n     }"}]}