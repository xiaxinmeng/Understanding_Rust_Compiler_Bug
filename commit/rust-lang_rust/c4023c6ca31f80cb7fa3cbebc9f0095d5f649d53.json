{"sha": "c4023c6ca31f80cb7fa3cbebc9f0095d5f649d53", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM0MDIzYzZjYTMxZjgwY2I3ZmEzY2JlYmM5ZjAwOTVkNWY2NDlkNTM=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-06-22T10:06:09Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2021-06-23T08:09:26Z"}, "message": "Fix search filter update", "tree": {"sha": "9eaa76d7a2978abd8bc98f040309ea486518c8bb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9eaa76d7a2978abd8bc98f040309ea486518c8bb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c4023c6ca31f80cb7fa3cbebc9f0095d5f649d53", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c4023c6ca31f80cb7fa3cbebc9f0095d5f649d53", "html_url": "https://github.com/rust-lang/rust/commit/c4023c6ca31f80cb7fa3cbebc9f0095d5f649d53", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c4023c6ca31f80cb7fa3cbebc9f0095d5f649d53/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8cb207ae69700de3e782eec5cc9013c0987b2519", "url": "https://api.github.com/repos/rust-lang/rust/commits/8cb207ae69700de3e782eec5cc9013c0987b2519", "html_url": "https://github.com/rust-lang/rust/commit/8cb207ae69700de3e782eec5cc9013c0987b2519"}], "stats": {"total": 21, "additions": 21, "deletions": 0}, "files": [{"sha": "617c79a45795af28356a9bde6f7b746b7fceb488", "filename": "src/librustdoc/html/static/search.js", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c4023c6ca31f80cb7fa3cbebc9f0095d5f649d53/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsearch.js", "raw_url": "https://github.com/rust-lang/rust/raw/c4023c6ca31f80cb7fa3cbebc9f0095d5f649d53/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsearch.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fsearch.js?ref=c4023c6ca31f80cb7fa3cbebc9f0095d5f649d53", "patch": "@@ -1442,6 +1442,10 @@ window.initSearch = function(rawSearchIndex) {\n         if (selectCrate) {\n             selectCrate.onchange = function() {\n                 updateLocalStorage(\"rustdoc-saved-filter-crate\", selectCrate.value);\n+                // In case you \"cut\" the entry from the search input, then change the crate filter\n+                // before paste back the previous search, you get the old search results without\n+                // the filter. To prevent this, we need to remove the previous results.\n+                currentResults = null;\n                 search(undefined, true);\n             };\n         }"}, {"sha": "a098dbd9f129bf8f5dd0dedaaf718ba4a49f0fa1", "filename": "src/test/rustdoc-gui/search-filter.goml", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/c4023c6ca31f80cb7fa3cbebc9f0095d5f649d53/src%2Ftest%2Frustdoc-gui%2Fsearch-filter.goml", "raw_url": "https://github.com/rust-lang/rust/raw/c4023c6ca31f80cb7fa3cbebc9f0095d5f649d53/src%2Ftest%2Frustdoc-gui%2Fsearch-filter.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsearch-filter.goml?ref=c4023c6ca31f80cb7fa3cbebc9f0095d5f649d53", "patch": "@@ -0,0 +1,17 @@\n+goto: file://|DOC_PATH|/test_docs/index.html\n+write: (\".search-input\", \"test\")\n+// Waiting for the search results to appear...\n+wait-for: \"#titles\"\n+assert-text: (\"#results .externcrate\", \"test_docs\")\n+text: (\".search-input\", \"\")\n+// We now want to change the crate filter.\n+click: \"#crate-search\"\n+// We select \"lib2\" option then press enter to change the filter.\n+press-key: \"ArrowDown\"\n+press-key: \"Enter\"\n+// We now make the search again.\n+write: (\".search-input\", \"test\")\n+// Waiting for the search results to appear...\n+wait-for: \"#titles\"\n+// We check that there is no more \"test_docs\" appearing.\n+assert-false: \"#results .externcrate\""}]}