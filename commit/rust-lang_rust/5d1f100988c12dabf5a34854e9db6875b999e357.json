{"sha": "5d1f100988c12dabf5a34854e9db6875b999e357", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVkMWYxMDA5ODhjMTJkYWJmNWEzNDg1NGU5ZGI2ODc1Yjk5OWUzNTc=", "commit": {"author": {"name": "memoryruins", "email": "memoryruinsmusic@gmail.com", "date": "2019-02-24T02:07:04Z"}, "committer": {"name": "memoryruins", "email": "memoryruinsmusic@gmail.com", "date": "2019-02-24T02:07:04Z"}, "message": "Add unstable option to ignore should_panic tests.", "tree": {"sha": "998e3a2cbcdd3b8e74372240a9c330dd42da0001", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/998e3a2cbcdd3b8e74372240a9c330dd42da0001"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5d1f100988c12dabf5a34854e9db6875b999e357", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5d1f100988c12dabf5a34854e9db6875b999e357", "html_url": "https://github.com/rust-lang/rust/commit/5d1f100988c12dabf5a34854e9db6875b999e357", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5d1f100988c12dabf5a34854e9db6875b999e357/comments", "author": {"login": "memoryruins", "id": 6868531, "node_id": "MDQ6VXNlcjY4Njg1MzE=", "avatar_url": "https://avatars.githubusercontent.com/u/6868531?v=4", "gravatar_id": "", "url": "https://api.github.com/users/memoryruins", "html_url": "https://github.com/memoryruins", "followers_url": "https://api.github.com/users/memoryruins/followers", "following_url": "https://api.github.com/users/memoryruins/following{/other_user}", "gists_url": "https://api.github.com/users/memoryruins/gists{/gist_id}", "starred_url": "https://api.github.com/users/memoryruins/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/memoryruins/subscriptions", "organizations_url": "https://api.github.com/users/memoryruins/orgs", "repos_url": "https://api.github.com/users/memoryruins/repos", "events_url": "https://api.github.com/users/memoryruins/events{/privacy}", "received_events_url": "https://api.github.com/users/memoryruins/received_events", "type": "User", "site_admin": false}, "committer": {"login": "memoryruins", "id": 6868531, "node_id": "MDQ6VXNlcjY4Njg1MzE=", "avatar_url": "https://avatars.githubusercontent.com/u/6868531?v=4", "gravatar_id": "", "url": "https://api.github.com/users/memoryruins", "html_url": "https://github.com/memoryruins", "followers_url": "https://api.github.com/users/memoryruins/followers", "following_url": "https://api.github.com/users/memoryruins/following{/other_user}", "gists_url": "https://api.github.com/users/memoryruins/gists{/gist_id}", "starred_url": "https://api.github.com/users/memoryruins/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/memoryruins/subscriptions", "organizations_url": "https://api.github.com/users/memoryruins/orgs", "repos_url": "https://api.github.com/users/memoryruins/repos", "events_url": "https://api.github.com/users/memoryruins/events{/privacy}", "received_events_url": "https://api.github.com/users/memoryruins/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aadbc459bd97a0325897e2ff94999efbec6a499c", "url": "https://api.github.com/repos/rust-lang/rust/commits/aadbc459bd97a0325897e2ff94999efbec6a499c", "html_url": "https://github.com/rust-lang/rust/commit/aadbc459bd97a0325897e2ff94999efbec6a499c"}], "stats": {"total": 45, "additions": 45, "deletions": 0}, "files": [{"sha": "a712d4092308b7d9e2aa56dac75715cc19719f51", "filename": "src/libtest/lib.rs", "status": "modified", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/5d1f100988c12dabf5a34854e9db6875b999e357/src%2Flibtest%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5d1f100988c12dabf5a34854e9db6875b999e357/src%2Flibtest%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibtest%2Flib.rs?ref=5d1f100988c12dabf5a34854e9db6875b999e357", "patch": "@@ -366,6 +366,7 @@ pub struct TestOpts {\n     pub list: bool,\n     pub filter: Option<String>,\n     pub filter_exact: bool,\n+    pub exclude_should_panic: bool,\n     pub run_ignored: RunIgnored,\n     pub run_tests: bool,\n     pub bench_benchmarks: bool,\n@@ -385,6 +386,7 @@ impl TestOpts {\n             list: false,\n             filter: None,\n             filter_exact: false,\n+            exclude_should_panic: false,\n             run_ignored: RunIgnored::No,\n             run_tests: false,\n             bench_benchmarks: false,\n@@ -406,6 +408,7 @@ fn optgroups() -> getopts::Options {\n     let mut opts = getopts::Options::new();\n     opts.optflag(\"\", \"include-ignored\", \"Run ignored and not ignored tests\")\n         .optflag(\"\", \"ignored\", \"Run only ignored tests\")\n+        .optflag(\"\", \"exclude-should-panic\", \"Sets #[should_panic] tests to imply #[ignore]\")\n         .optflag(\"\", \"test\", \"Run tests and not benchmarks\")\n         .optflag(\"\", \"bench\", \"Run benchmarks instead of tests\")\n         .optflag(\"\", \"list\", \"List all tests and benchmarks\")\n@@ -558,6 +561,13 @@ pub fn parse_opts(args: &[String]) -> Option<OptRes> {\n         None\n     };\n \n+    let exclude_should_panic = matches.opt_present(\"exclude-should-panic\");\n+    if !allow_unstable && exclude_should_panic {\n+        return Some(Err(\n+            \"The \\\"exclude-should-panic\\\" flag is only accepted on the nightly compiler\".into(),\n+        ));\n+    }\n+\n     let include_ignored = matches.opt_present(\"include-ignored\");\n     if !allow_unstable && include_ignored {\n         return Some(Err(\n@@ -648,6 +658,7 @@ pub fn parse_opts(args: &[String]) -> Option<OptRes> {\n         list,\n         filter,\n         filter_exact: exact,\n+        exclude_should_panic,\n         run_ignored,\n         run_tests,\n         bench_benchmarks,\n@@ -1365,6 +1376,14 @@ pub fn filter_tests(opts: &TestOpts, tests: Vec<TestDescAndFn>) -> Vec<TestDescA\n     // Skip tests that match any of the skip filters\n     filtered.retain(|test| !opts.skip.iter().any(|sf| matches_filter(test, sf)));\n \n+    // Set #[should_panic] tests to ignore\n+    if opts.exclude_should_panic {\n+        filtered\n+            .iter_mut()\n+            .filter(|test| test.desc.should_panic != ShouldPanic::No)\n+            .for_each(|test| test.desc.ignore = true);\n+    }\n+\n     // maybe unignore tests\n     match opts.run_ignored {\n         RunIgnored::Yes => {\n@@ -1983,6 +2002,32 @@ mod tests {\n         assert!(!filtered[1].desc.ignore);\n     }\n \n+    #[test]\n+    pub fn exclude_should_panic_option() {\n+        let mut opts = TestOpts::new();\n+        opts.run_tests = true;\n+        opts.exclude_should_panic = true;\n+\n+        let mut tests = one_ignored_one_unignored_test();\n+\n+        tests.push(TestDescAndFn {\n+            desc: TestDesc {\n+                name: StaticTestName(\"3\"),\n+                ignore: false,\n+                should_panic: ShouldPanic::YesWithMessage(\"should panic with message\"),\n+                allow_fail: false,\n+            },\n+            testfn: DynTestFn(Box::new(move || {})),\n+        });\n+\n+        let filtered = filter_tests(&opts, tests);\n+\n+        assert_eq!(filtered.len(), 3);\n+        assert!(filtered[0].desc.ignore);\n+        assert!(!filtered[1].desc.ignore);\n+        assert!(filtered[2].desc.ignore);\n+    }\n+\n     #[test]\n     pub fn exact_filter_match() {\n         fn tests() -> Vec<TestDescAndFn> {"}]}