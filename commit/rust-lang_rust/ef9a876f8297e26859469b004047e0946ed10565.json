{"sha": "ef9a876f8297e26859469b004047e0946ed10565", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVmOWE4NzZmODI5N2UyNjg1OTQ2OWIwMDQwNDdlMDk0NmVkMTA1NjU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-05-03T10:15:48Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-05-03T10:15:48Z"}, "message": "Auto merge of #60423 - varkor:update-getopts, r=alexcrichton\n\nUpdate getopts\n\nThis is a prerequisite to fixing https://github.com/rust-lang/rust/issues/32352. The rustbuild fix has been pulled out of https://github.com/rust-lang/rust/pull/59440.\n\nr? @alexcrichton", "tree": {"sha": "e99999181d3da8a4035003e3a85f3702274f8e53", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e99999181d3da8a4035003e3a85f3702274f8e53"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ef9a876f8297e26859469b004047e0946ed10565", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ef9a876f8297e26859469b004047e0946ed10565", "html_url": "https://github.com/rust-lang/rust/commit/ef9a876f8297e26859469b004047e0946ed10565", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ef9a876f8297e26859469b004047e0946ed10565/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1891bfa80364eead426517c68de6947b7692e2de", "url": "https://api.github.com/repos/rust-lang/rust/commits/1891bfa80364eead426517c68de6947b7692e2de", "html_url": "https://github.com/rust-lang/rust/commit/1891bfa80364eead426517c68de6947b7692e2de"}, {"sha": "e72f7e1e56404b2b7d62c02e625e97e2b0ff6c26", "url": "https://api.github.com/repos/rust-lang/rust/commits/e72f7e1e56404b2b7d62c02e625e97e2b0ff6c26", "html_url": "https://github.com/rust-lang/rust/commit/e72f7e1e56404b2b7d62c02e625e97e2b0ff6c26"}], "stats": {"total": 51, "additions": 35, "deletions": 16}, "files": [{"sha": "16d17cf85836b3feffdf0aaf54f1e6871e7fba40", "filename": "Cargo.lock", "status": "modified", "additions": 13, "deletions": 10, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/ef9a876f8297e26859469b004047e0946ed10565/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/ef9a876f8297e26859469b004047e0946ed10565/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=ef9a876f8297e26859469b004047e0946ed10565", "patch": "@@ -169,7 +169,7 @@ dependencies = [\n  \"cc 1.0.35 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"cmake 0.1.38 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"filetime 0.2.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"getopts 0.2.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"lazy_static 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.51 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"num_cpus 1.8.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -463,7 +463,7 @@ dependencies = [\n  \"diff 0.1.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"env_logger 0.5.13 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"filetime 0.2.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"getopts 0.2.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"lazy_static 1.2.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.51 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -484,7 +484,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"diff 0.1.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"filetime 0.2.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"getopts 0.2.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.51 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"miow 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -974,8 +974,11 @@ dependencies = [\n \n [[package]]\n name = \"getopts\"\n-version = \"0.2.17\"\n+version = \"0.2.18\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"unicode-width 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n \n [[package]]\n name = \"git2\"\n@@ -1986,7 +1989,7 @@ version = \"0.1.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"bitflags 0.9.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"getopts 0.2.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -2005,7 +2008,7 @@ version = \"0.5.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"bitflags 1.0.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"getopts 0.2.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"memchr 2.2.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"unicase 2.3.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n@@ -3091,7 +3094,7 @@ dependencies = [\n  \"dirs 1.0.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"env_logger 0.6.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"failure 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"getopts 0.2.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"ignore 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"itertools 0.8.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"lazy_static 1.2.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -3518,7 +3521,7 @@ dependencies = [\n name = \"test\"\n version = \"0.0.0\"\n dependencies = [\n- \"getopts 0.2.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"proc_macro 0.0.0\",\n  \"term 0.0.0\",\n ]\n@@ -3528,7 +3531,7 @@ name = \"tester\"\n version = \"0.5.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"getopts 0.2.17 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.51 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"term 0.4.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n@@ -4127,7 +4130,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum futures 0.1.21 (registry+https://github.com/rust-lang/crates.io-index)\" = \"1a70b146671de62ec8c8ed572219ca5d594d9b06c0b364d5e67b722fc559b48c\"\n \"checksum fwdansi 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"34dd4c507af68d37ffef962063dfa1944ce0dd4d5b82043dbab1dabe088610c3\"\n \"checksum generic-array 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ef25c5683767570c2bbd7deba372926a55eaae9982d7726ee2a1050239d45b9d\"\n-\"checksum getopts 0.2.17 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b900c08c1939860ce8b54dc6a89e26e00c04c380fd0e09796799bd7f12861e05\"\n+\"checksum getopts 0.2.18 (registry+https://github.com/rust-lang/crates.io-index)\" = \"0a7292d30132fb5424b354f5dc02512a86e4c516fe544bb7a25e7f266951b797\"\n \"checksum git2 0.8.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c7339329bfa14a00223244311560d11f8f489b453fb90092af97f267a6090ab0\"\n \"checksum git2-curl 0.9.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d58551e903ed7e2d6fe3a2f3c7efa3a784ec29b19d0fbb035aaf0497c183fbdd\"\n \"checksum glob 0.3.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"9b919933a397b79c37e33b77bb2aa3dc8eb6e165ad809e58ff75bc7db2e34574\""}, {"sha": "9a410c339bf5f24f5fe1235ffb5e3ec2949e5356", "filename": "src/bootstrap/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ef9a876f8297e26859469b004047e0946ed10565/src%2Fbootstrap%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/ef9a876f8297e26859469b004047e0946ed10565/src%2Fbootstrap%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2FCargo.toml?ref=ef9a876f8297e26859469b004047e0946ed10565", "patch": "@@ -39,7 +39,7 @@ build_helper = { path = \"../build_helper\" }\n cmake = \"0.1.38\"\n filetime = \"0.2\"\n num_cpus = \"1.0\"\n-getopts = \"0.2\"\n+getopts = \"0.2.18\"\n cc = \"1.0.35\"\n libc = \"0.2\"\n serde = \"1.0.8\""}, {"sha": "c84eb6476e087aea79ce0ac579faab177c7b0f88", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 20, "deletions": 4, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/ef9a876f8297e26859469b004047e0946ed10565/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ef9a876f8297e26859469b004047e0946ed10565/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=ef9a876f8297e26859469b004047e0946ed10565", "patch": "@@ -853,14 +853,30 @@ impl<'a> Builder<'a> {\n \n         // FIXME: Temporary fix for https://github.com/rust-lang/cargo/issues/3005\n         // Force cargo to output binaries with disambiguating hashes in the name\n-        let metadata = if compiler.stage == 0 {\n-            // Treat stage0 like special channel, whether it's a normal prior-\n+        let mut metadata = if compiler.stage == 0 {\n+            // Treat stage0 like a special channel, whether it's a normal prior-\n             // release rustc or a local rebuild with the same version, so we\n             // never mix these libraries by accident.\n-            \"bootstrap\"\n+            \"bootstrap\".to_string()\n         } else {\n-            &self.config.channel\n+            self.config.channel.to_string()\n         };\n+        // We want to make sure that none of the dependencies between\n+        // std/test/rustc unify with one another. This is done for weird linkage\n+        // reasons but the gist of the problem is that if librustc, libtest, and\n+        // libstd all depend on libc from crates.io (which they actually do) we\n+        // want to make sure they all get distinct versions. Things get really\n+        // weird if we try to unify all these dependencies right now, namely\n+        // around how many times the library is linked in dynamic libraries and\n+        // such. If rustc were a static executable or if we didn't ship dylibs\n+        // this wouldn't be a problem, but we do, so it is. This is in general\n+        // just here to make sure things build right. If you can remove this and\n+        // things still build right, please do!\n+        match mode {\n+            Mode::Std => metadata.push_str(\"std\"),\n+            Mode::Test => metadata.push_str(\"test\"),\n+            _ => {},\n+        }\n         cargo.env(\"__CARGO_DEFAULT_LIB_METADATA\", &metadata);\n \n         let stage;"}, {"sha": "2e836b6772fda9871149ab44d5937e4c2948c39c", "filename": "src/libtest/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ef9a876f8297e26859469b004047e0946ed10565/src%2Flibtest%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/ef9a876f8297e26859469b004047e0946ed10565/src%2Flibtest%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibtest%2FCargo.toml?ref=ef9a876f8297e26859469b004047e0946ed10565", "patch": "@@ -10,7 +10,7 @@ path = \"lib.rs\"\n crate-type = [\"dylib\", \"rlib\"]\n \n [dependencies]\n-getopts = \"0.2\"\n+getopts = \"0.2.18\"\n term = { path = \"../libterm\" }\n \n # not actually used but needed to always have proc_macro in the sysroot"}]}