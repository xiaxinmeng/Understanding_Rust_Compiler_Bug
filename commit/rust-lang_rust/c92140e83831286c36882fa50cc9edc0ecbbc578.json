{"sha": "c92140e83831286c36882fa50cc9edc0ecbbc578", "node_id": "C_kwDOAAsO6NoAKGM5MjE0MGU4MzgzMTI4NmMzNjg4MmZhNTBjYzllZGMwZWNiYmM1Nzg", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-05-30T20:35:10Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2023-06-08T16:30:05Z"}, "message": "Don't suggest cyclic associated type constraint", "tree": {"sha": "dec8848b5b53184ef85c929a9c84503b7f4cf997", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dec8848b5b53184ef85c929a9c84503b7f4cf997"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c92140e83831286c36882fa50cc9edc0ecbbc578", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c92140e83831286c36882fa50cc9edc0ecbbc578", "html_url": "https://github.com/rust-lang/rust/commit/c92140e83831286c36882fa50cc9edc0ecbbc578", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c92140e83831286c36882fa50cc9edc0ecbbc578/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "acf257e62cbd2011f987ee67b5c5dc02f60da88c", "url": "https://api.github.com/repos/rust-lang/rust/commits/acf257e62cbd2011f987ee67b5c5dc02f60da88c", "html_url": "https://github.com/rust-lang/rust/commit/acf257e62cbd2011f987ee67b5c5dc02f60da88c"}], "stats": {"total": 29, "additions": 29, "deletions": 0}, "files": [{"sha": "a723dc3f079d76820204c1776bc0adc1bafeaee2", "filename": "compiler/rustc_infer/src/infer/error_reporting/note_and_explain.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c92140e83831286c36882fa50cc9edc0ecbbc578/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnote_and_explain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c92140e83831286c36882fa50cc9edc0ecbbc578/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnote_and_explain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnote_and_explain.rs?ref=c92140e83831286c36882fa50cc9edc0ecbbc578", "patch": "@@ -374,12 +374,18 @@ impl<T> Trait<T> for X {\n     ) {\n         let tcx = self.tcx;\n \n+        // Don't suggest constraining a projection to something containing itself\n+        if self.tcx.erase_regions(values.found).contains(self.tcx.erase_regions(values.expected)) {\n+            return;\n+        }\n+\n         let msg = || {\n             format!(\n                 \"consider constraining the associated type `{}` to `{}`\",\n                 values.expected, values.found\n             )\n         };\n+\n         let body_owner = tcx.hir().get_if_local(body_owner_def_id);\n         let current_method_ident = body_owner.and_then(|n| n.ident()).map(|i| i.name);\n "}, {"sha": "6894f6b6cc4a02ba55495e304028e20b8dc7e1e4", "filename": "tests/ui/associated-types/dont-suggest-cyclic-constraint.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/c92140e83831286c36882fa50cc9edc0ecbbc578/tests%2Fui%2Fassociated-types%2Fdont-suggest-cyclic-constraint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c92140e83831286c36882fa50cc9edc0ecbbc578/tests%2Fui%2Fassociated-types%2Fdont-suggest-cyclic-constraint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fassociated-types%2Fdont-suggest-cyclic-constraint.rs?ref=c92140e83831286c36882fa50cc9edc0ecbbc578", "patch": "@@ -0,0 +1,11 @@\n+use std::fmt::Debug;\n+\n+fn foo<I: Iterator>(mut iter: I, value: &I::Item)\n+where\n+    I::Item: Eq + Debug,\n+{\n+    debug_assert_eq!(iter.next(), Some(value));\n+    //~^ ERROR mismatched types\n+}\n+\n+fn main() {}"}, {"sha": "3ecac9c83e571e5f891266db9201e61703b61e3a", "filename": "tests/ui/associated-types/dont-suggest-cyclic-constraint.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/c92140e83831286c36882fa50cc9edc0ecbbc578/tests%2Fui%2Fassociated-types%2Fdont-suggest-cyclic-constraint.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c92140e83831286c36882fa50cc9edc0ecbbc578/tests%2Fui%2Fassociated-types%2Fdont-suggest-cyclic-constraint.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fassociated-types%2Fdont-suggest-cyclic-constraint.stderr?ref=c92140e83831286c36882fa50cc9edc0ecbbc578", "patch": "@@ -0,0 +1,12 @@\n+error[E0308]: mismatched types\n+  --> $DIR/dont-suggest-cyclic-constraint.rs:7:35\n+   |\n+LL |     debug_assert_eq!(iter.next(), Some(value));\n+   |                                   ^^^^^^^^^^^ expected `Option<<I as Iterator>::Item>`, found `Option<&<I as Iterator>::Item>`\n+   |\n+   = note: expected enum `Option<<I as Iterator>::Item>`\n+              found enum `Option<&<I as Iterator>::Item>`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}]}