{"sha": "354098ccdd4514c1a9ad0c2d3cb21bc2bdc77ac7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM1NDA5OGNjZGQ0NTE0YzFhOWFkMGMyZDNjYjIxYmMyYmRjNzdhYzc=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-11-10T13:45:28Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-11-10T13:45:28Z"}, "message": "Rollup merge of #78897 - hyd-dev:alloc-error-hook-newline, r=m-ou-se\n\nAdd missing newline to error message of the default OOM hook\n\nCurrently the default OOM hook in libstd does not end the error message with a newline:\n```\nmemory allocation of 4 bytes failedtimeout: the monitored command dumped core\n/playground/tools/entrypoint.sh: line 11:     7 Aborted                 timeout --signal=KILL ${timeout} \"$`@\"`\n```\nhttps://play.rust-lang.org/?version=nightly&mode=debug&edition=2018&gist=030d8223eb57dfe47ef157709aa26542\n\nThis is because the `fmt::Arguments` passed to `dumb_print()` does not end with a newline. All other calls to `dumb_print()` in libstd pass a `\\n`-ended `fmt::Arguments` to `dumb_print()`. For example:\nhttps://github.com/rust-lang/rust/blob/25f6938da459a57b43bdf16ed6bdad3225b2a3ce/library/std/src/sys_common/util.rs#L18\nI think the `\\n` was forgotten in #51264.\n\nThis PR appends `\\n` to the error string.\n\n~~Note that I didn't add a test, because I didn't find tests for functions in ` library/std/src/alloc.rs` or a test that is similar to the test of this change would be.~~ *Edit: CI told me there is an existing test. Sorry.*", "tree": {"sha": "dfa3105b25985bd427c9e1a2acce025d435fba3f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/dfa3105b25985bd427c9e1a2acce025d435fba3f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/354098ccdd4514c1a9ad0c2d3cb21bc2bdc77ac7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfqpl5CRBK7hj4Ov3rIwAAdHIIABSHrxOiCjAxEfB4PVZWhcYl\naFFLgPaNzo6GNmUuXNYuyWwRl4OGbu89+09HBjAdVi94hABu45FEpiskFpXcZ/RS\novI4k+RfQaJB9q43+rLgmpv+8hHzyewy4kWzWatj9u014v9mthTV5ETq6UcQbj3I\nhGKQ/hXbccUBz1GLiIZkUub7e2C3e7fU+sxkcNKzKRu5Hos3bjwwo6cEoVMyVShe\nobkBPaeAzM+KAH2TiEAJP7Ao2WnwROWYvdYNHIpOZ1twjAt/9o317S07w6E7Qv6r\nrhgOi3zBxhfwZLf7pQvxYyW8/rvwCivDPW9vXvLWSb1lQew6KiBVDqY9aojwS0Q=\n=KORK\n-----END PGP SIGNATURE-----\n", "payload": "tree dfa3105b25985bd427c9e1a2acce025d435fba3f\nparent 87ecb0afacaabea3b2a4555207f1ad44932d2d9a\nparent 70e175b551f4d1c1b310ef616ba06454030db77e\nauthor Jonas Schievink <jonasschievink@gmail.com> 1605015928 +0100\ncommitter GitHub <noreply@github.com> 1605015928 +0100\n\nRollup merge of #78897 - hyd-dev:alloc-error-hook-newline, r=m-ou-se\n\nAdd missing newline to error message of the default OOM hook\n\nCurrently the default OOM hook in libstd does not end the error message with a newline:\n```\nmemory allocation of 4 bytes failedtimeout: the monitored command dumped core\n/playground/tools/entrypoint.sh: line 11:     7 Aborted                 timeout --signal=KILL ${timeout} \"$`@\"`\n```\nhttps://play.rust-lang.org/?version=nightly&mode=debug&edition=2018&gist=030d8223eb57dfe47ef157709aa26542\n\nThis is because the `fmt::Arguments` passed to `dumb_print()` does not end with a newline. All other calls to `dumb_print()` in libstd pass a `\\n`-ended `fmt::Arguments` to `dumb_print()`. For example:\nhttps://github.com/rust-lang/rust/blob/25f6938da459a57b43bdf16ed6bdad3225b2a3ce/library/std/src/sys_common/util.rs#L18\nI think the `\\n` was forgotten in #51264.\n\nThis PR appends `\\n` to the error string.\n\n~~Note that I didn't add a test, because I didn't find tests for functions in ` library/std/src/alloc.rs` or a test that is similar to the test of this change would be.~~ *Edit: CI told me there is an existing test. Sorry.*\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/354098ccdd4514c1a9ad0c2d3cb21bc2bdc77ac7", "html_url": "https://github.com/rust-lang/rust/commit/354098ccdd4514c1a9ad0c2d3cb21bc2bdc77ac7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/354098ccdd4514c1a9ad0c2d3cb21bc2bdc77ac7/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "87ecb0afacaabea3b2a4555207f1ad44932d2d9a", "url": "https://api.github.com/repos/rust-lang/rust/commits/87ecb0afacaabea3b2a4555207f1ad44932d2d9a", "html_url": "https://github.com/rust-lang/rust/commit/87ecb0afacaabea3b2a4555207f1ad44932d2d9a"}, {"sha": "70e175b551f4d1c1b310ef616ba06454030db77e", "url": "https://api.github.com/repos/rust-lang/rust/commits/70e175b551f4d1c1b310ef616ba06454030db77e", "html_url": "https://github.com/rust-lang/rust/commit/70e175b551f4d1c1b310ef616ba06454030db77e"}], "stats": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"sha": "375b015ccc8dfebb05fc28bd6839c7f683788053", "filename": "library/std/src/alloc.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/354098ccdd4514c1a9ad0c2d3cb21bc2bdc77ac7/library%2Fstd%2Fsrc%2Falloc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/354098ccdd4514c1a9ad0c2d3cb21bc2bdc77ac7/library%2Fstd%2Fsrc%2Falloc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Falloc.rs?ref=354098ccdd4514c1a9ad0c2d3cb21bc2bdc77ac7", "patch": "@@ -316,7 +316,7 @@ pub fn take_alloc_error_hook() -> fn(Layout) {\n }\n \n fn default_alloc_error_hook(layout: Layout) {\n-    dumb_print(format_args!(\"memory allocation of {} bytes failed\", layout.size()));\n+    dumb_print(format_args!(\"memory allocation of {} bytes failed\\n\", layout.size()));\n }\n \n #[cfg(not(test))]"}, {"sha": "6871977c79831c544e15c7f36c51a201bead3c67", "filename": "src/test/ui/default-alloc-error-hook.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/354098ccdd4514c1a9ad0c2d3cb21bc2bdc77ac7/src%2Ftest%2Fui%2Fdefault-alloc-error-hook.rs", "raw_url": "https://github.com/rust-lang/rust/raw/354098ccdd4514c1a9ad0c2d3cb21bc2bdc77ac7/src%2Ftest%2Fui%2Fdefault-alloc-error-hook.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdefault-alloc-error-hook.rs?ref=354098ccdd4514c1a9ad0c2d3cb21bc2bdc77ac7", "patch": "@@ -16,5 +16,5 @@ fn main() {\n     let me = env::current_exe().unwrap();\n     let output = Command::new(&me).arg(\"next\").output().unwrap();\n     assert!(!output.status.success(), \"{:?} is a success\", output.status);\n-    assert_eq!(str::from_utf8(&output.stderr).unwrap(), \"memory allocation of 42 bytes failed\");\n+    assert_eq!(str::from_utf8(&output.stderr).unwrap(), \"memory allocation of 42 bytes failed\\n\");\n }"}]}