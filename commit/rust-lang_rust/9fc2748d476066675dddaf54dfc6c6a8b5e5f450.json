{"sha": "9fc2748d476066675dddaf54dfc6c6a8b5e5f450", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlmYzI3NDhkNDc2MDY2Njc1ZGRkYWY1NGRmYzZjNmE4YjVlNWY0NTA=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-02-14T17:33:30Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-02-14T17:42:48Z"}, "message": "Add dry run mode to xtask release", "tree": {"sha": "b69434c3de621771e19dcde4d3ae1617bc3fbdb5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b69434c3de621771e19dcde4d3ae1617bc3fbdb5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9fc2748d476066675dddaf54dfc6c6a8b5e5f450", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9fc2748d476066675dddaf54dfc6c6a8b5e5f450", "html_url": "https://github.com/rust-lang/rust/commit/9fc2748d476066675dddaf54dfc6c6a8b5e5f450", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9fc2748d476066675dddaf54dfc6c6a8b5e5f450/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "082dd87b328e8cdf1b99999f9332e056a8bc916b", "url": "https://api.github.com/repos/rust-lang/rust/commits/082dd87b328e8cdf1b99999f9332e056a8bc916b", "html_url": "https://github.com/rust-lang/rust/commit/082dd87b328e8cdf1b99999f9332e056a8bc916b"}], "stats": {"total": 15, "additions": 9, "deletions": 6}, "files": [{"sha": "301a88324ea4ca3443d63ba7cac276cb2f2c6580", "filename": "xtask/src/lib.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9fc2748d476066675dddaf54dfc6c6a8b5e5f450/xtask%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9fc2748d476066675dddaf54dfc6c6a8b5e5f450/xtask%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Flib.rs?ref=9fc2748d476066675dddaf54dfc6c6a8b5e5f450", "patch": "@@ -158,11 +158,13 @@ fn rm_rf(path: &Path) -> Result<()> {\n         .with_context(|| format!(\"failed to remove {:?}\", path))\n }\n \n-pub fn run_release() -> Result<()> {\n-    run!(\"git switch release\")?;\n-    run!(\"git fetch upstream\")?;\n-    run!(\"git reset --hard upstream/master\")?;\n-    run!(\"git push\")?;\n+pub fn run_release(dry_run: bool) -> Result<()> {\n+    if !dry_run {\n+        run!(\"git switch release\")?;\n+        run!(\"git fetch upstream\")?;\n+        run!(\"git reset --hard upstream/master\")?;\n+        run!(\"git push\")?;\n+    }\n \n     let changelog_dir = project_root().join(\"../rust-analyzer.github.io/thisweek/_posts\");\n "}, {"sha": "a7dffe2cc87162c2af4f595da206123e3980537c", "filename": "xtask/src/main.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9fc2748d476066675dddaf54dfc6c6a8b5e5f450/xtask%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9fc2748d476066675dddaf54dfc6c6a8b5e5f450/xtask%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/xtask%2Fsrc%2Fmain.rs?ref=9fc2748d476066675dddaf54dfc6c6a8b5e5f450", "patch": "@@ -93,8 +93,9 @@ FLAGS:\n             run_pre_cache()\n         }\n         \"release\" => {\n+            let dry_run = args.contains(\"--dry-run\");\n             args.finish()?;\n-            run_release()\n+            run_release(dry_run)\n         }\n         _ => {\n             eprintln!("}]}