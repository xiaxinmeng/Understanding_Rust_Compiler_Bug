{"sha": "f41f327f7f41cc55c8278c9994aa13a461adf107", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY0MWYzMjdmN2Y0MWNjNTVjODI3OGM5OTk0YWExM2E0NjFhZGYxMDc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-12-05T09:08:14Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-12-05T09:08:14Z"}, "message": "Auto merge of #30185 - fhahn:improve-borrowck-public-accessibility, r=pnkfelix\n\nThis PR makes `AnalysisData` and`BorrowckCtxt` public. Those types are returned by the public function `build_borrowck_dataflow_data_for_fn` and are needed if a caller wants to pass on the return values.\n\nIt also removes `FnPartsWithCFG`, which required callers of  `build_borrowck_dataflow_data_for_fn` to have a reference to a `CFG` with the same lifetime as `FnParts`, which is more limiting than required.", "tree": {"sha": "ebf4b9cb0dcf80605c7e39bd393fc7ca58fd2b94", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ebf4b9cb0dcf80605c7e39bd393fc7ca58fd2b94"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f41f327f7f41cc55c8278c9994aa13a461adf107", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f41f327f7f41cc55c8278c9994aa13a461adf107", "html_url": "https://github.com/rust-lang/rust/commit/f41f327f7f41cc55c8278c9994aa13a461adf107", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f41f327f7f41cc55c8278c9994aa13a461adf107/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e70c733250d5ccdeb58181a83fd7bfeff0fdb833", "url": "https://api.github.com/repos/rust-lang/rust/commits/e70c733250d5ccdeb58181a83fd7bfeff0fdb833", "html_url": "https://github.com/rust-lang/rust/commit/e70c733250d5ccdeb58181a83fd7bfeff0fdb833"}, {"sha": "b1b40c7ef6514b3f5882822aea244dbda2a3a918", "url": "https://api.github.com/repos/rust-lang/rust/commits/b1b40c7ef6514b3f5882822aea244dbda2a3a918", "html_url": "https://github.com/rust-lang/rust/commit/b1b40c7ef6514b3f5882822aea244dbda2a3a918"}], "stats": {"total": 42, "additions": 14, "deletions": 28}, "files": [{"sha": "b727f10d276ac0f0f400ffe6859ef60a20ff6b1c", "filename": "src/librustc_borrowck/borrowck/mod.rs", "status": "modified", "additions": 9, "deletions": 24, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/f41f327f7f41cc55c8278c9994aa13a461adf107/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f41f327f7f41cc55c8278c9994aa13a461adf107/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs?ref=f41f327f7f41cc55c8278c9994aa13a461adf107", "patch": "@@ -21,7 +21,7 @@ pub use self::MovedValueUseKind::*;\n use self::InteriorKind::*;\n \n use rustc::front::map as hir_map;\n-use rustc::front::map::blocks::{FnLikeNode, FnParts};\n+use rustc::front::map::blocks::FnParts;\n use rustc::middle::cfg;\n use rustc::middle::dataflow::DataFlowContext;\n use rustc::middle::dataflow::BitwiseOperator;\n@@ -227,25 +227,12 @@ fn build_borrowck_dataflow_data<'a, 'tcx>(this: &mut BorrowckCtxt<'a, 'tcx>,\n                    move_data:flowed_moves }\n }\n \n-/// This and a `ty::ctxt` is all you need to run the dataflow analyses\n-/// used in the borrow checker.\n-pub struct FnPartsWithCFG<'a> {\n-    pub fn_parts: FnParts<'a>,\n-    pub cfg:  &'a cfg::CFG,\n-}\n-\n-impl<'a> FnPartsWithCFG<'a> {\n-    pub fn from_fn_like(f: &'a FnLikeNode,\n-                        g: &'a cfg::CFG) -> FnPartsWithCFG<'a> {\n-        FnPartsWithCFG { fn_parts: f.to_fn_parts(), cfg: g }\n-    }\n-}\n-\n /// Accessor for introspective clients inspecting `AnalysisData` and\n /// the `BorrowckCtxt` itself , e.g. the flowgraph visualizer.\n pub fn build_borrowck_dataflow_data_for_fn<'a, 'tcx>(\n     tcx: &'a ty::ctxt<'tcx>,\n-    input: FnPartsWithCFG<'a>)\n+    fn_parts: FnParts<'a>,\n+    cfg: &cfg::CFG)\n     -> (BorrowckCtxt<'a, 'tcx>, AnalysisData<'a, 'tcx>)\n {\n \n@@ -260,15 +247,13 @@ pub fn build_borrowck_dataflow_data_for_fn<'a, 'tcx>(\n         }\n     };\n \n-    let p = input.fn_parts;\n-\n     let dataflow_data = build_borrowck_dataflow_data(&mut bccx,\n-                                                     p.kind,\n-                                                     &*p.decl,\n-                                                     input.cfg,\n-                                                     &*p.body,\n-                                                     p.span,\n-                                                     p.id);\n+                                                     fn_parts.kind,\n+                                                     &*fn_parts.decl,\n+                                                     cfg,\n+                                                     &*fn_parts.body,\n+                                                     fn_parts.span,\n+                                                     fn_parts.id);\n \n     (bccx, dataflow_data)\n }"}, {"sha": "27cd9530c9be3404b2972aafa8e89c64ed027832", "filename": "src/librustc_borrowck/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f41f327f7f41cc55c8278c9994aa13a461adf107/src%2Flibrustc_borrowck%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f41f327f7f41cc55c8278c9994aa13a461adf107/src%2Flibrustc_borrowck%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_borrowck%2Flib.rs?ref=f41f327f7f41cc55c8278c9994aa13a461adf107", "patch": "@@ -38,7 +38,7 @@ extern crate rustc_front;\n \n pub use borrowck::check_crate;\n pub use borrowck::build_borrowck_dataflow_data_for_fn;\n-pub use borrowck::FnPartsWithCFG;\n+pub use borrowck::{AnalysisData, BorrowckCtxt};\n \n // NB: This module needs to be declared first so diagnostics are\n // registered before they are used."}, {"sha": "47b89e3be5d43cfbdf77596501ca09ba8320f79e", "filename": "src/librustc_driver/pretty.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/f41f327f7f41cc55c8278c9994aa13a461adf107/src%2Flibrustc_driver%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f41f327f7f41cc55c8278c9994aa13a461adf107/src%2Flibrustc_driver%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Fpretty.rs?ref=f41f327f7f41cc55c8278c9994aa13a461adf107", "patch": "@@ -888,9 +888,10 @@ fn print_flowgraph<W: Write>(variants: Vec<borrowck_dot::Variant>,\n             return Ok(());\n         }\n         blocks::FnLikeCode(fn_like) => {\n-            let fn_parts = borrowck::FnPartsWithCFG::from_fn_like(&fn_like, &cfg);\n-            let (bccx, analysis_data) = borrowck::build_borrowck_dataflow_data_for_fn(tcx,\n-                                                                                      fn_parts);\n+            let (bccx, analysis_data) =\n+                borrowck::build_borrowck_dataflow_data_for_fn(tcx,\n+                                                              fn_like.to_fn_parts(),\n+                                                              &cfg);\n \n             let lcfg = borrowck_dot::DataflowLabeller {\n                 inner: lcfg,"}]}