{"sha": "72283689534272fb64952a3d7161de72513de6cf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjcyMjgzNjg5NTM0MjcyZmI2NDk1MmEzZDcxNjFkZTcyNTEzZGU2Y2Y=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-08-09T19:18:01Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-08-09T19:18:01Z"}, "message": "Auto merge of #5882 - dima74:ra_setup-prevent-compile-rustc, r=Manishearth\n\nPrevent compile parts of rustc when using `cargo dev ra-setup`\n\nCurrently after running `cargo dev ra-setup` the following lines are added to `Cargo.toml`:\n\n```toml\n[target]\nrustc_data_structures = { path = \".../rust/src/librustc_data_structures\" }\nrustc_driver = { path = \".../rust/src/librustc_driver\" }\nrustc_errors = { path = \".../rust/src/librustc_errors\" }\nrustc_interface = { path = \".../rust/src/librustc_interface\" }\nrustc_middle = { path = \".../rust/src/librustc_middle\" }\n```\n\nThis pull request adds dependencies for `rustc` crates under `cfg(NOT_A_PLATFORM)`, thus preventing them from compiling together with clippy:\n\n```toml\n[target.'cfg(NOT_A_PLATFORM)'.dependencies]\nrustc_data_structures = { path = \".../rust/src/librustc_data_structures\" }\nrustc_driver = { path = \".../rust/src/librustc_driver\" }\nrustc_errors = { path = \".../rust/src/librustc_errors\" }\nrustc_interface = { path = \".../rust/src/librustc_interface\" }\nrustc_middle = { path = \".../rust/src/librustc_middle\" }\n```\n\n---\n\nThis approach was [originally proposed for IntelliJ Rust](https://github.com/intellij-rust/intellij-rust/issues/1618#issuecomment-459098749), and looks like it works for rust-analyzer too.\n\nchangelog: none", "tree": {"sha": "75766572ea0f1aa6f6d13ffcb40ec19a9c3ac158", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/75766572ea0f1aa6f6d13ffcb40ec19a9c3ac158"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/72283689534272fb64952a3d7161de72513de6cf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/72283689534272fb64952a3d7161de72513de6cf", "html_url": "https://github.com/rust-lang/rust/commit/72283689534272fb64952a3d7161de72513de6cf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/72283689534272fb64952a3d7161de72513de6cf/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "70c46de012fe73fb57662085c02ef921e2e5b93c", "url": "https://api.github.com/repos/rust-lang/rust/commits/70c46de012fe73fb57662085c02ef921e2e5b93c", "html_url": "https://github.com/rust-lang/rust/commit/70c46de012fe73fb57662085c02ef921e2e5b93c"}, {"sha": "6af969379e766bf85652196c04ff267edf5cace7", "url": "https://api.github.com/repos/rust-lang/rust/commits/6af969379e766bf85652196c04ff267edf5cace7", "html_url": "https://github.com/rust-lang/rust/commit/6af969379e766bf85652196c04ff267edf5cace7"}], "stats": {"total": 3, "additions": 2, "deletions": 1}, "files": [{"sha": "f2bd651ab253c6419ce6395e22d7d5a18562dd78", "filename": "clippy_dev/src/ra_setup.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/72283689534272fb64952a3d7161de72513de6cf/clippy_dev%2Fsrc%2Fra_setup.rs", "raw_url": "https://github.com/rust-lang/rust/raw/72283689534272fb64952a3d7161de72513de6cf/clippy_dev%2Fsrc%2Fra_setup.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fra_setup.rs?ref=72283689534272fb64952a3d7161de72513de6cf", "patch": "@@ -68,10 +68,11 @@ fn inject_deps_into_manifest(\n     });\n \n     // format a new [dependencies]-block with the new deps we need to inject\n-    let mut all_deps = String::from(\"[dependencies]\\n\");\n+    let mut all_deps = String::from(\"[target.'cfg(NOT_A_PLATFORM)'.dependencies]\\n\");\n     new_deps.for_each(|dep_line| {\n         all_deps.push_str(&dep_line);\n     });\n+    all_deps.push_str(\"\\n[dependencies]\\n\");\n \n     // replace \"[dependencies]\" with\n     // [dependencies]"}]}