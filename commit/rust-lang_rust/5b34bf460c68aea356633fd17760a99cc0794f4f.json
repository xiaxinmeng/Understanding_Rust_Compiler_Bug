{"sha": "5b34bf460c68aea356633fd17760a99cc0794f4f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjViMzRiZjQ2MGM2OGFlYTM1NjYzM2ZkMTc3NjBhOTljYzA3OTRmNGY=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2021-05-05T09:57:10Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2021-05-05T11:50:20Z"}, "message": "Revert PR 83866\n\nThat PR caused multiple test failures when Rust's channel is changed\nfrom nightly to anything else. The commit will have to be landed again\nafter the test suite is fixed.", "tree": {"sha": "d03eb816dc1a6f8f04a103fe2d07367433a4d92b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d03eb816dc1a6f8f04a103fe2d07367433a4d92b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5b34bf460c68aea356633fd17760a99cc0794f4f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAmCShosACgkQPgar6Auq\n8ZwL8w//ZGLjP701AloGtG+2iwZ/wRJeFPH5mxCJyum4e2gkcWV6HSAS1WkrqRAS\nFJ17tiFskskyeQ5V/SttclmUX+sHF9Cmjb+8C654GcJG5GOA8qDP0swcSWfG+8V8\n9i5rOB/I2Y8BoXEIodaHXug6SztYx9GTL4SAz54aECu+4tzwZ7Uk7uqIy0T94CvY\nGbe1F6QjsJvs+zzmN+wx7Vkf6yzRi+NKtdoIuDSp28XKpDtKwCodKgf6fCpgiQHF\n7bsO24JaWNVIsofPVYzqGvCYq496ZA3Qwd0Fy0qD1kAkb/qSND3awmbp9ZOgeNm/\nq1JTV+0T9F7N9BNmlb3+0/qolCbX+Vj3tM7a5pvWb/PCq7tO+qtOjgbYKSpyo5HC\nRnkAUKgMaRFP/JgHXuUUWn8h+6T8fKNmctcLYAxaJ2sklLorUKGjJiOWdfJCRie/\nFnKWwqIN8+epG0ZFHg1MTvMkpNLebngoi+Gnz0BGbaSyyGE2ks/QQoUJYp3b87IB\nrKvZkI5Z6Z2FI53xF2VnChikgrxvvMc3W6fvKJKXONsTjNz1eOYNU1kVRLzpW8/t\nX+7pSlbulBRqeQwEKp15bwbsAFv8o0gEQsJsxK699PVc2YfcbaaffCZO44mPE2Kg\nCqJmrSA6FuBzsHhdF3E1bg4bXahFaXcdhDRrYxtz7ZDW/JZRMbc=\n=0fr4\n-----END PGP SIGNATURE-----", "payload": "tree d03eb816dc1a6f8f04a103fe2d07367433a4d92b\nparent 2d11e257945c710d406e77903764ad4b7a52bda5\nauthor Pietro Albini <pietro@pietroalbini.org> 1620208630 +0200\ncommitter Pietro Albini <pietro@pietroalbini.org> 1620215420 +0200\n\nRevert PR 83866\n\nThat PR caused multiple test failures when Rust's channel is changed\nfrom nightly to anything else. The commit will have to be landed again\nafter the test suite is fixed.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5b34bf460c68aea356633fd17760a99cc0794f4f", "html_url": "https://github.com/rust-lang/rust/commit/5b34bf460c68aea356633fd17760a99cc0794f4f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5b34bf460c68aea356633fd17760a99cc0794f4f/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2d11e257945c710d406e77903764ad4b7a52bda5", "url": "https://api.github.com/repos/rust-lang/rust/commits/2d11e257945c710d406e77903764ad4b7a52bda5", "html_url": "https://github.com/rust-lang/rust/commit/2d11e257945c710d406e77903764ad4b7a52bda5"}], "stats": {"total": 55, "additions": 8, "deletions": 47}, "files": [{"sha": "47dae63f1fdf73f8f7bb65aaa547ac46c222ceb2", "filename": "src/librustdoc/clean/types.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/5b34bf460c68aea356633fd17760a99cc0794f4f/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5b34bf460c68aea356633fd17760a99cc0794f4f/src%2Flibrustdoc%2Fclean%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Ftypes.rs?ref=5b34bf460c68aea356633fd17760a99cc0794f4f", "patch": "@@ -517,10 +517,9 @@ impl Item {\n                                 Some(ExternalLocation::Remote(ref s)) => {\n                                     format!(\"{}/std/\", s.trim_end_matches('/'))\n                                 }\n-                                Some(ExternalLocation::Unknown) | None => format!(\n-                                    \"https://doc.rust-lang.org/{}/std/\",\n-                                    crate::doc_rust_lang_org_channel(),\n-                                ),\n+                                Some(ExternalLocation::Unknown) | None => {\n+                                    \"https://doc.rust-lang.org/nightly/std/\".to_string()\n+                                }\n                             };\n                             // This is a primitive so the url is done \"by hand\".\n                             let tail = fragment.find('#').unwrap_or_else(|| fragment.len());"}, {"sha": "51a011cf1977364ec7081bac0e954156f8835b31", "filename": "src/librustdoc/clean/utils.rs", "status": "modified", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/5b34bf460c68aea356633fd17760a99cc0794f4f/src%2Flibrustdoc%2Fclean%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5b34bf460c68aea356633fd17760a99cc0794f4f/src%2Flibrustdoc%2Fclean%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Futils.rs?ref=5b34bf460c68aea356633fd17760a99cc0794f4f", "patch": "@@ -542,14 +542,3 @@ crate fn has_doc_flag(attrs: ty::Attributes<'_>, flag: Symbol) -> bool {\n             && attr.meta_item_list().map_or(false, |l| rustc_attr::list_contains_name(&l, flag))\n     })\n }\n-\n-/// Return a channel suitable for using in a `doc.rust-lang.org/{channel}` format string.\n-crate fn doc_rust_lang_org_channel() -> &'static str {\n-    match env!(\"CFG_RELEASE_CHANNEL\") {\n-        \"stable\" => env!(\"CFG_RELEASE_NUM\"),\n-        \"beta\" => \"beta\",\n-        \"nightly\" | \"dev\" => \"nightly\",\n-        // custom build of rustdoc maybe? link to the stable docs just in case\n-        _ => \"\",\n-    }\n-}"}, {"sha": "7b0c0b6699653a1f0a877140a4109b5db4e2c6ff", "filename": "src/librustdoc/core.rs", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/5b34bf460c68aea356633fd17760a99cc0794f4f/src%2Flibrustdoc%2Fcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5b34bf460c68aea356633fd17760a99cc0794f4f/src%2Flibrustdoc%2Fcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fcore.rs?ref=5b34bf460c68aea356633fd17760a99cc0794f4f", "patch": "@@ -406,18 +406,15 @@ crate fn run_global_ctxt(\n     let mut krate = tcx.sess.time(\"clean_crate\", || clean::krate(&mut ctxt));\n \n     if krate.module.doc_value().map(|d| d.is_empty()).unwrap_or(true) {\n-        let help = format!(\n-            \"The following guide may be of use:\\n\\\n-            https://doc.rust-lang.org/{}/rustdoc/how-to-write-documentation.html\",\n-            crate::doc_rust_lang_org_channel(),\n-        );\n+        let help = \"The following guide may be of use:\\n\\\n+                https://doc.rust-lang.org/nightly/rustdoc/how-to-write-documentation.html\";\n         tcx.struct_lint_node(\n             crate::lint::MISSING_CRATE_LEVEL_DOCS,\n             DocContext::as_local_hir_id(tcx, krate.module.def_id).unwrap(),\n             |lint| {\n                 let mut diag =\n                     lint.build(\"no documentation found for this crate's top-level module\");\n-                diag.help(&help);\n+                diag.help(help);\n                 diag.emit();\n             },\n         );"}, {"sha": "169ef015fa88c71bff5c03da04b59b27fb83a1b5", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/5b34bf460c68aea356633fd17760a99cc0794f4f/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5b34bf460c68aea356633fd17760a99cc0794f4f/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=5b34bf460c68aea356633fd17760a99cc0794f4f", "patch": "@@ -82,8 +82,6 @@ use rustc_session::config::{make_crate_type_option, ErrorOutputType, RustcOptGro\n use rustc_session::getopts;\n use rustc_session::{early_error, early_warn};\n \n-use crate::clean::utils::doc_rust_lang_org_channel;\n-\n /// A macro to create a FxHashMap.\n ///\n /// Example:\n@@ -606,10 +604,7 @@ fn usage(argv0: &str) {\n     }\n     println!(\"{}\", options.usage(&format!(\"{} [options] <input>\", argv0)));\n     println!(\"    @path               Read newline separated options from `path`\\n\");\n-    println!(\n-        \"More information available at https://doc.rust-lang.org/{}/rustdoc/what-is-rustdoc.html\",\n-        doc_rust_lang_org_channel()\n-    );\n+    println!(\"More information available at https://doc.rust-lang.org/rustdoc/what-is-rustdoc.html\")\n }\n \n /// A result type used by several functions under `main()`."}, {"sha": "25b6c187f3b27315d67b68d56f63f96edb39d07e", "filename": "src/librustdoc/passes/collect_intra_doc_links.rs", "status": "modified", "additions": 1, "deletions": 8, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/5b34bf460c68aea356633fd17760a99cc0794f4f/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5b34bf460c68aea356633fd17760a99cc0794f4f/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fpasses%2Fcollect_intra_doc_links.rs?ref=5b34bf460c68aea356633fd17760a99cc0794f4f", "patch": "@@ -2017,14 +2017,7 @@ fn disambiguator_error(\n     msg: &str,\n ) {\n     diag_info.link_range = disambiguator_range;\n-    report_diagnostic(cx.tcx, BROKEN_INTRA_DOC_LINKS, msg, &diag_info, |diag, _sp| {\n-        let msg = format!(\n-            \"see https://doc.rust-lang.org/{}/rustdoc/linking-to-items-by-name.html#namespaces-and-disambiguators \\\n-             for more info about disambiguators\",\n-            crate::doc_rust_lang_org_channel(),\n-        );\n-        diag.note(&msg);\n-    });\n+    report_diagnostic(cx.tcx, BROKEN_INTRA_DOC_LINKS, msg, &diag_info, |_diag, _sp| {});\n }\n \n /// Report an ambiguity error, where there were multiple possible resolutions."}, {"sha": "de215b2163bd4e28d1100720c34876aa08ec4f8f", "filename": "src/test/rustdoc-ui/intra-doc/email-address-localhost.stderr", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5b34bf460c68aea356633fd17760a99cc0794f4f/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Femail-address-localhost.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5b34bf460c68aea356633fd17760a99cc0794f4f/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Femail-address-localhost.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Femail-address-localhost.stderr?ref=5b34bf460c68aea356633fd17760a99cc0794f4f", "patch": "@@ -10,7 +10,6 @@ note: the lint level is defined here\n LL | #![deny(warnings)]\n    |         ^^^^^^^^\n    = note: `#[deny(rustdoc::broken_intra_doc_links)]` implied by `#[deny(warnings)]`\n-   = note: see https://doc.rust-lang.org/nightly/rustdoc/linking-to-items-by-name.html#namespaces-and-disambiguators for more info about disambiguators\n \n error: aborting due to previous error\n "}, {"sha": "195aaca32a27d860b1a4ac9eecddaeec966e73f7", "filename": "src/test/rustdoc-ui/intra-doc/unknown-disambiguator.stderr", "status": "modified", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/5b34bf460c68aea356633fd17760a99cc0794f4f/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Funknown-disambiguator.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5b34bf460c68aea356633fd17760a99cc0794f4f/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Funknown-disambiguator.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fintra-doc%2Funknown-disambiguator.stderr?ref=5b34bf460c68aea356633fd17760a99cc0794f4f", "patch": "@@ -10,47 +10,36 @@ note: the lint level is defined here\n LL | #![deny(warnings)]\n    |         ^^^^^^^^\n    = note: `#[deny(rustdoc::broken_intra_doc_links)]` implied by `#[deny(warnings)]`\n-   = note: see https://doc.rust-lang.org/nightly/rustdoc/linking-to-items-by-name.html#namespaces-and-disambiguators for more info about disambiguators\n \n error: unknown disambiguator `bar`\n   --> $DIR/unknown-disambiguator.rs:3:35\n    |\n LL | //! Linking to [foo@banana] and [`bar@banana!()`].\n    |                                   ^^^\n-   |\n-   = note: see https://doc.rust-lang.org/nightly/rustdoc/linking-to-items-by-name.html#namespaces-and-disambiguators for more info about disambiguators\n \n error: unknown disambiguator `foo`\n   --> $DIR/unknown-disambiguator.rs:9:34\n    |\n LL | //! And with weird backticks: [``foo@hello``] [foo`@`hello].\n    |                                  ^^^\n-   |\n-   = note: see https://doc.rust-lang.org/nightly/rustdoc/linking-to-items-by-name.html#namespaces-and-disambiguators for more info about disambiguators\n \n error: unknown disambiguator `foo`\n   --> $DIR/unknown-disambiguator.rs:9:48\n    |\n LL | //! And with weird backticks: [``foo@hello``] [foo`@`hello].\n    |                                                ^^^\n-   |\n-   = note: see https://doc.rust-lang.org/nightly/rustdoc/linking-to-items-by-name.html#namespaces-and-disambiguators for more info about disambiguators\n \n error: unknown disambiguator ``\n   --> $DIR/unknown-disambiguator.rs:6:31\n    |\n LL | //! And to [no disambiguator](@nectarine) and [another](@apricot!()).\n    |                               ^\n-   |\n-   = note: see https://doc.rust-lang.org/nightly/rustdoc/linking-to-items-by-name.html#namespaces-and-disambiguators for more info about disambiguators\n \n error: unknown disambiguator ``\n   --> $DIR/unknown-disambiguator.rs:6:57\n    |\n LL | //! And to [no disambiguator](@nectarine) and [another](@apricot!()).\n    |                                                         ^\n-   |\n-   = note: see https://doc.rust-lang.org/nightly/rustdoc/linking-to-items-by-name.html#namespaces-and-disambiguators for more info about disambiguators\n \n error: aborting due to 6 previous errors\n "}]}