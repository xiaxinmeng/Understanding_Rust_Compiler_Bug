{"sha": "89495f3ca33b8a236ee8bc4f89a64a500fe2391f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg5NDk1ZjNjYTMzYjhhMjM2ZWU4YmM0Zjg5YTY0YTUwMGZlMjM5MWY=", "commit": {"author": {"name": "Thomas de Zeeuw", "email": "thomasdezeeuw@gmail.com", "date": "2018-07-23T11:39:21Z"}, "committer": {"name": "Thomas de Zeeuw", "email": "thomasdezeeuw@gmail.com", "date": "2018-07-23T11:45:25Z"}, "message": "Forget Waker when cloning LocalWaker\n\nSince NonNull is Copy the inner field of the cloned Waker was copied for\nuse in the new LocalWaker, however this left Waker to be dropped. Which\nmeans that when cloning LocalWaker would also erroneously call drop_raw.\n\nThis change forgets the Waker, rather then dropping it, leaving the\ninner field to be used by the returned LocalWaker.\n\nCloses #52629.", "tree": {"sha": "e6f5f33aaced37a1c7b15f852b5c415cf280ce29", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e6f5f33aaced37a1c7b15f852b5c415cf280ce29"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/89495f3ca33b8a236ee8bc4f89a64a500fe2391f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/89495f3ca33b8a236ee8bc4f89a64a500fe2391f", "html_url": "https://github.com/rust-lang/rust/commit/89495f3ca33b8a236ee8bc4f89a64a500fe2391f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/89495f3ca33b8a236ee8bc4f89a64a500fe2391f/comments", "author": {"login": "Thomasdezeeuw", "id": 3159064, "node_id": "MDQ6VXNlcjMxNTkwNjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3159064?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Thomasdezeeuw", "html_url": "https://github.com/Thomasdezeeuw", "followers_url": "https://api.github.com/users/Thomasdezeeuw/followers", "following_url": "https://api.github.com/users/Thomasdezeeuw/following{/other_user}", "gists_url": "https://api.github.com/users/Thomasdezeeuw/gists{/gist_id}", "starred_url": "https://api.github.com/users/Thomasdezeeuw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Thomasdezeeuw/subscriptions", "organizations_url": "https://api.github.com/users/Thomasdezeeuw/orgs", "repos_url": "https://api.github.com/users/Thomasdezeeuw/repos", "events_url": "https://api.github.com/users/Thomasdezeeuw/events{/privacy}", "received_events_url": "https://api.github.com/users/Thomasdezeeuw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Thomasdezeeuw", "id": 3159064, "node_id": "MDQ6VXNlcjMxNTkwNjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3159064?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Thomasdezeeuw", "html_url": "https://github.com/Thomasdezeeuw", "followers_url": "https://api.github.com/users/Thomasdezeeuw/followers", "following_url": "https://api.github.com/users/Thomasdezeeuw/following{/other_user}", "gists_url": "https://api.github.com/users/Thomasdezeeuw/gists{/gist_id}", "starred_url": "https://api.github.com/users/Thomasdezeeuw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Thomasdezeeuw/subscriptions", "organizations_url": "https://api.github.com/users/Thomasdezeeuw/orgs", "repos_url": "https://api.github.com/users/Thomasdezeeuw/repos", "events_url": "https://api.github.com/users/Thomasdezeeuw/events{/privacy}", "received_events_url": "https://api.github.com/users/Thomasdezeeuw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3b7720399a9006d9d7b89c251fa37ead46f9db7a", "url": "https://api.github.com/repos/rust-lang/rust/commits/3b7720399a9006d9d7b89c251fa37ead46f9db7a", "html_url": "https://github.com/rust-lang/rust/commit/3b7720399a9006d9d7b89c251fa37ead46f9db7a"}], "stats": {"total": 9, "additions": 5, "deletions": 4}, "files": [{"sha": "3b901c9aef0ca95bb5c09a6479c813b993da8083", "filename": "src/libcore/task/wake.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/89495f3ca33b8a236ee8bc4f89a64a500fe2391f/src%2Flibcore%2Ftask%2Fwake.rs", "raw_url": "https://github.com/rust-lang/rust/raw/89495f3ca33b8a236ee8bc4f89a64a500fe2391f/src%2Flibcore%2Ftask%2Fwake.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Ftask%2Fwake.rs?ref=89495f3ca33b8a236ee8bc4f89a64a500fe2391f", "patch": "@@ -12,7 +12,7 @@\n             reason = \"futures in libcore are unstable\",\n             issue = \"50547\")]\n \n-use fmt;\n+use {fmt, mem};\n use marker::Unpin;\n use ptr::NonNull;\n \n@@ -166,9 +166,10 @@ impl From<LocalWaker> for Waker {\n impl Clone for LocalWaker {\n     #[inline]\n     fn clone(&self) -> Self {\n-        unsafe {\n-            LocalWaker { inner: self.inner.as_ref().clone_raw().inner }\n-        }\n+        let waker = unsafe { self.inner.as_ref().clone_raw() };\n+        let inner = waker.inner;\n+        mem::forget(waker);\n+        LocalWaker { inner }\n     }\n }\n "}]}