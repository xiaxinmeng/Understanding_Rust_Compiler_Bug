{"sha": "9467033a8e7f369b5a3d8cc68a51283fd19f4955", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk0NjcwMzNhOGU3ZjM2OWI1YTNkOGNjNjhhNTEyODNmZDE5ZjQ5NTU=", "commit": {"author": {"name": "St\u00e9phane Campinas", "email": "stephane.campinas@gmail.com", "date": "2018-11-07T14:00:33Z"}, "committer": {"name": "St\u00e9phane Campinas", "email": "stephane.campinas@gmail.com", "date": "2018-11-07T14:00:33Z"}, "message": "fix the logic for retaining a comment before the arrow in a match", "tree": {"sha": "355dad803aecac113bc82a99a1e945514c1ef25a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/355dad803aecac113bc82a99a1e945514c1ef25a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9467033a8e7f369b5a3d8cc68a51283fd19f4955", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCgAdFiEEipi5pnt+pUplKNfibVYg2QghATMFAlvi8AEACgkQbVYg2Qgh\nATNy4wf/VZ+dr2Kxy03QaGlO7ZX4mlQz1/wAGkaYpxRJcLFKeyjNN686qNAXm9/C\nLwHeLrio1iB5t1JU3EtP2HuUV3j67dxsZSPAqx7ctFo5QcxuK5AHNt5AtAAhHbSI\nQ5rqxn3FykdSasW/0xqO6ZwOjv9n2C3s3k2vK6JR0xM4nQvSy7LGdspnh/iuFpVg\n+zLtuHLgnopr+w43z2fN+LgG043xGbQoKf7JVk4OCRqwMlzYhVgyz+zc29vudNrw\nRCBc4Ypk62WdxLtHSLSDtQ/JyfGPokUtNu/fVuDEQuVhWjPeecR5IZpWTwFjRSYZ\nnzQnBU2DrwCt1trUzpGg5hIFWgXutw==\n=uAwT\n-----END PGP SIGNATURE-----", "payload": "tree 355dad803aecac113bc82a99a1e945514c1ef25a\nparent cd8bb50aea35f73fa4be62857dfed88f772cd07e\nauthor St\u00e9phane Campinas <stephane.campinas@gmail.com> 1541599233 +0100\ncommitter St\u00e9phane Campinas <stephane.campinas@gmail.com> 1541599233 +0100\n\nfix the logic for retaining a comment before the arrow in a match\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9467033a8e7f369b5a3d8cc68a51283fd19f4955", "html_url": "https://github.com/rust-lang/rust/commit/9467033a8e7f369b5a3d8cc68a51283fd19f4955", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9467033a8e7f369b5a3d8cc68a51283fd19f4955/comments", "author": {"login": "scampi", "id": 795879, "node_id": "MDQ6VXNlcjc5NTg3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/795879?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scampi", "html_url": "https://github.com/scampi", "followers_url": "https://api.github.com/users/scampi/followers", "following_url": "https://api.github.com/users/scampi/following{/other_user}", "gists_url": "https://api.github.com/users/scampi/gists{/gist_id}", "starred_url": "https://api.github.com/users/scampi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scampi/subscriptions", "organizations_url": "https://api.github.com/users/scampi/orgs", "repos_url": "https://api.github.com/users/scampi/repos", "events_url": "https://api.github.com/users/scampi/events{/privacy}", "received_events_url": "https://api.github.com/users/scampi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "scampi", "id": 795879, "node_id": "MDQ6VXNlcjc5NTg3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/795879?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scampi", "html_url": "https://github.com/scampi", "followers_url": "https://api.github.com/users/scampi/followers", "following_url": "https://api.github.com/users/scampi/following{/other_user}", "gists_url": "https://api.github.com/users/scampi/gists{/gist_id}", "starred_url": "https://api.github.com/users/scampi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scampi/subscriptions", "organizations_url": "https://api.github.com/users/scampi/orgs", "repos_url": "https://api.github.com/users/scampi/repos", "events_url": "https://api.github.com/users/scampi/events{/privacy}", "received_events_url": "https://api.github.com/users/scampi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cd8bb50aea35f73fa4be62857dfed88f772cd07e", "url": "https://api.github.com/repos/rust-lang/rust/commits/cd8bb50aea35f73fa4be62857dfed88f772cd07e", "html_url": "https://github.com/rust-lang/rust/commit/cd8bb50aea35f73fa4be62857dfed88f772cd07e"}], "stats": {"total": 20, "additions": 19, "deletions": 1}, "files": [{"sha": "fc7d4cca0200a913ee596112c26cbe720490ae9b", "filename": "src/matches.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/9467033a8e7f369b5a3d8cc68a51283fd19f4955/src%2Fmatches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9467033a8e7f369b5a3d8cc68a51283fd19f4955/src%2Fmatches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmatches.rs?ref=9467033a8e7f369b5a3d8cc68a51283fd19f4955", "patch": "@@ -379,7 +379,9 @@ fn rewrite_match_body(\n     // Look for comments between `=>` and the start of the body.\n     let arrow_comment = {\n         let arrow_snippet = context.snippet(arrow_span).trim();\n-        let arrow_index = arrow_snippet.find(\"=>\").unwrap();\n+        // search for the arrow starting from the end of the snippet since there may be a match\n+        // expression within the guard\n+        let arrow_index = arrow_snippet.rfind(\"=>\").unwrap();\n         // 2 = `=>`\n         let comment_str = arrow_snippet[arrow_index + 2..].trim();\n         if comment_str.is_empty() {"}, {"sha": "c4cb2d8c03c03bc522d1d4023a4ab81289f79fa1", "filename": "tests/source/issue-3131.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9467033a8e7f369b5a3d8cc68a51283fd19f4955/tests%2Fsource%2Fissue-3131.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9467033a8e7f369b5a3d8cc68a51283fd19f4955/tests%2Fsource%2Fissue-3131.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-3131.rs?ref=9467033a8e7f369b5a3d8cc68a51283fd19f4955", "patch": "@@ -0,0 +1,8 @@\n+fn main() {\n+    match 3 {\n+        t if match t {\n+            _ => true,\n+        } => {},\n+        _ => {}\n+    }\n+}"}, {"sha": "c7304dd55855323d36123f3dc62bf3298fd776ef", "filename": "tests/target/issue-3131.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9467033a8e7f369b5a3d8cc68a51283fd19f4955/tests%2Ftarget%2Fissue-3131.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9467033a8e7f369b5a3d8cc68a51283fd19f4955/tests%2Ftarget%2Fissue-3131.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-3131.rs?ref=9467033a8e7f369b5a3d8cc68a51283fd19f4955", "patch": "@@ -0,0 +1,8 @@\n+fn main() {\n+    match 3 {\n+        t if match t {\n+            _ => true,\n+        } => {}\n+        _ => {}\n+    }\n+}"}]}