{"sha": "c3f7069a0f755b154cf9c62b94154570695e7813", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMzZjcwNjlhMGY3NTViMTU0Y2Y5YzYyYjk0MTU0NTcwNjk1ZTc4MTM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-02-14T12:29:15Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-02-14T12:29:15Z"}, "message": "Auto merge of #1709 - hyd-dev:rlib, r=RalfJung\n\n[cargo-miri] Don't skip `rlib` crates\n\nFixes #1691.", "tree": {"sha": "d988ce555847e630b8ddf959c54e222a984c0355", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d988ce555847e630b8ddf959c54e222a984c0355"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c3f7069a0f755b154cf9c62b94154570695e7813", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c3f7069a0f755b154cf9c62b94154570695e7813", "html_url": "https://github.com/rust-lang/rust/commit/c3f7069a0f755b154cf9c62b94154570695e7813", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c3f7069a0f755b154cf9c62b94154570695e7813/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7ac8be8529d77c0f75e6459859e4831a81498aca", "url": "https://api.github.com/repos/rust-lang/rust/commits/7ac8be8529d77c0f75e6459859e4831a81498aca", "html_url": "https://github.com/rust-lang/rust/commit/7ac8be8529d77c0f75e6459859e4831a81498aca"}, {"sha": "0737de86f760a35408088f19c45c0617ffed21d0", "url": "https://api.github.com/repos/rust-lang/rust/commits/0737de86f760a35408088f19c45c0617ffed21d0", "html_url": "https://github.com/rust-lang/rust/commit/0737de86f760a35408088f19c45c0617ffed21d0"}], "stats": {"total": 34, "additions": 24, "deletions": 10}, "files": [{"sha": "f38e79732b27460dc70c690355d016fb551a66aa", "filename": "cargo-miri/bin.rs", "status": "modified", "additions": 5, "deletions": 8, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/c3f7069a0f755b154cf9c62b94154570695e7813/cargo-miri%2Fbin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c3f7069a0f755b154cf9c62b94154570695e7813/cargo-miri%2Fbin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/cargo-miri%2Fbin.rs?ref=c3f7069a0f755b154cf9c62b94154570695e7813", "patch": "@@ -596,16 +596,13 @@ fn phase_cargo_rustc(args: env::Args) {\n     let target_crate = is_target_crate();\n     let print = get_arg_flag_value(\"--print\").is_some(); // whether this is cargo passing `--print` to get some infos\n \n-    // rlib and cdylib are just skipped, we cannot interpret them and do not need them\n+    // cdylib is just skipped, we cannot interpret it and do not need it\n     // for the rest of the build either.\n-    match get_arg_flag_value(\"--crate-type\").as_deref() {\n-        Some(\"rlib\") | Some(\"cdylib\") => {\n-            if verbose {\n-                eprint!(\"[cargo-miri rustc] (rlib/cdylib skipped)\");\n-            }\n-            return;\n+    if get_arg_flag_value(\"--crate-type\").as_deref() == Some(\"cdylib\") {\n+        if verbose {\n+            eprint!(\"[cargo-miri rustc] (cdylib skipped)\");\n         }\n-        _ => {},\n+        return;\n     }\n \n     let store_json = |info: CrateRunInfo| {"}, {"sha": "a3a708c6b544756d62b34293e1813c06557d3ae0", "filename": "test-cargo-miri/Cargo.lock", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c3f7069a0f755b154cf9c62b94154570695e7813/test-cargo-miri%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/c3f7069a0f755b154cf9c62b94154570695e7813/test-cargo-miri%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2FCargo.lock?ref=c3f7069a0f755b154cf9c62b94154570695e7813", "patch": "@@ -12,6 +12,7 @@ version = \"0.1.0\"\n dependencies = [\n  \"byteorder\",\n  \"issue_1567\",\n+ \"issue_1691\",\n  \"rand\",\n  \"serde_derive\",\n ]\n@@ -49,6 +50,10 @@ dependencies = [\n  \"byteorder\",\n ]\n \n+[[package]]\n+name = \"issue_1691\"\n+version = \"0.1.0\"\n+\n [[package]]\n name = \"libc\"\n version = \"0.2.81\""}, {"sha": "c42d6753e8e0ba578d408a3d180d534c7c2a48f8", "filename": "test-cargo-miri/Cargo.toml", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c3f7069a0f755b154cf9c62b94154570695e7813/test-cargo-miri%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/c3f7069a0f755b154cf9c62b94154570695e7813/test-cargo-miri%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2FCargo.toml?ref=c3f7069a0f755b154cf9c62b94154570695e7813", "patch": "@@ -9,7 +9,8 @@ edition = \"2018\"\n \n [dependencies]\n byteorder = \"1.0\"\n-issue_1567 = { path =\"issue-1567\" }\n+issue_1567 = { path = \"issue-1567\" }\n+issue_1691 = { path = \"issue-1691\" }\n \n [dev-dependencies]\n rand = { version = \"0.7\", features = [\"small_rng\"] }"}, {"sha": "3100cc6a60b5861bf94f5264b01c128c787777cb", "filename": "test-cargo-miri/issue-1691/Cargo.toml", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c3f7069a0f755b154cf9c62b94154570695e7813/test-cargo-miri%2Fissue-1691%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/c3f7069a0f755b154cf9c62b94154570695e7813/test-cargo-miri%2Fissue-1691%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Fissue-1691%2FCargo.toml?ref=c3f7069a0f755b154cf9c62b94154570695e7813", "patch": "@@ -0,0 +1,8 @@\n+[package]\n+name = \"issue_1691\"\n+version = \"0.1.0\"\n+authors = [\"Miri Team\"]\n+edition = \"2018\"\n+\n+[lib]\n+crate-type = [\"rlib\"]"}, {"sha": "efde2b58e199e042ffea44db102ae2cc8be609ed", "filename": "test-cargo-miri/issue-1691/src/lib.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c3f7069a0f755b154cf9c62b94154570695e7813/test-cargo-miri%2Fissue-1691%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c3f7069a0f755b154cf9c62b94154570695e7813/test-cargo-miri%2Fissue-1691%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Fissue-1691%2Fsrc%2Flib.rs?ref=c3f7069a0f755b154cf9c62b94154570695e7813", "patch": "@@ -0,0 +1,3 @@\n+pub fn use_me() -> bool {\n+    true\n+}"}, {"sha": "b50dfbe51eb37f6706726153cdc363103aa603b5", "filename": "test-cargo-miri/src/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c3f7069a0f755b154cf9c62b94154570695e7813/test-cargo-miri%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c3f7069a0f755b154cf9c62b94154570695e7813/test-cargo-miri%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test-cargo-miri%2Fsrc%2Flib.rs?ref=c3f7069a0f755b154cf9c62b94154570695e7813", "patch": "@@ -3,5 +3,5 @@\n /// assert!(cargo_miri_test::make_true());\n /// ```\n pub fn make_true() -> bool {\n-    true\n+    issue_1691::use_me()\n }"}]}