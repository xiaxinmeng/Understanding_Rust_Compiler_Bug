{"sha": "0595f57186744061b6cf0673e55de5e8e578b348", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA1OTVmNTcxODY3NDQwNjFiNmNmMDY3M2U1NWRlNWU4ZTU3OGIzNDg=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2012-01-07T03:40:49Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2012-01-07T06:40:32Z"}, "message": "revert changes to trans_uniq.rs", "tree": {"sha": "2202d82f1b471fa96bc1e0bb48cdbb9722d41479", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2202d82f1b471fa96bc1e0bb48cdbb9722d41479"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0595f57186744061b6cf0673e55de5e8e578b348", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0595f57186744061b6cf0673e55de5e8e578b348", "html_url": "https://github.com/rust-lang/rust/commit/0595f57186744061b6cf0673e55de5e8e578b348", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0595f57186744061b6cf0673e55de5e8e578b348/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "154f81b0be502b401c2900ce1bd0db8afb474ff6", "url": "https://api.github.com/repos/rust-lang/rust/commits/154f81b0be502b401c2900ce1bd0db8afb474ff6", "html_url": "https://github.com/rust-lang/rust/commit/154f81b0be502b401c2900ce1bd0db8afb474ff6"}], "stats": {"total": 18, "additions": 14, "deletions": 4}, "files": [{"sha": "6b420a43091991006b23ee013fd5d66e8ac3b876", "filename": "src/comp/middle/trans_uniq.rs", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/0595f57186744061b6cf0673e55de5e8e578b348/src%2Fcomp%2Fmiddle%2Ftrans_uniq.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0595f57186744061b6cf0673e55de5e8e578b348/src%2Fcomp%2Fmiddle%2Ftrans_uniq.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans_uniq.rs?ref=0595f57186744061b6cf0673e55de5e8e578b348", "patch": "@@ -33,14 +33,24 @@ fn trans_uniq(bcx: @block_ctxt, contents: @ast::expr,\n     ret trans::store_in_dest(bcx, llptr, dest);\n }\n \n-fn alloc_uniq(bcx: @block_ctxt, uniq_ty: ty::t)\n-    : type_is_unique_box(bcx, uniq_ty) -> result {\n+fn alloc_uniq(cx: @block_ctxt, uniq_ty: ty::t)\n+    : type_is_unique_box(cx, uniq_ty) -> result {\n+\n+    let bcx = cx;\n     let contents_ty = content_ty(bcx, uniq_ty);\n-    let {bcx, val: llsz} = size_of(bcx, contents_ty);\n+    let r = size_of(bcx, contents_ty);\n+    bcx = r.bcx;\n+    let llsz = r.val;\n+\n     let ccx = bcx_ccx(bcx);\n     check non_ty_var(ccx, contents_ty);\n     let llptrty = T_ptr(type_of_inner(ccx, bcx.sp, contents_ty));\n-    ret trans_shared_malloc(bcx, llptrty, llsz);\n+\n+    r = trans_shared_malloc(bcx, llptrty, llsz);\n+    bcx = r.bcx;\n+    let llptr = r.val;\n+\n+    ret rslt(bcx, llptr);\n }\n \n fn make_free_glue(cx: @block_ctxt, vptr: ValueRef, t: ty::t)"}]}