{"sha": "9b2f8dbba39dd4167f22a7026674a585c3d907d8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjliMmY4ZGJiYTM5ZGQ0MTY3ZjIyYTcwMjY2NzRhNTg1YzNkOTA3ZDg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-04-20T02:18:00Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-04-20T02:18:00Z"}, "message": "Auto merge of #71007 - Amanieu:deprecate_asm, r=Mark-Simulacrum\n\nDeprecate the asm! macro in favor of llvm_asm!\n\nSince we will be changing the syntax of `asm!` soon, deprecate it and encourage people to use `llvm_asm!` instead (which preserves the old syntax). This will avoid breakage when `asm!` is changed.\n\nRFC: https://github.com/rust-lang/rfcs/pull/2843", "tree": {"sha": "0b0b920e6b81d0b7477aeb4aa9e54e0e5fd2f560", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0b0b920e6b81d0b7477aeb4aa9e54e0e5fd2f560"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9b2f8dbba39dd4167f22a7026674a585c3d907d8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9b2f8dbba39dd4167f22a7026674a585c3d907d8", "html_url": "https://github.com/rust-lang/rust/commit/9b2f8dbba39dd4167f22a7026674a585c3d907d8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9b2f8dbba39dd4167f22a7026674a585c3d907d8/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c6b55eed638db7db34e887ef255c765bc8910ec0", "url": "https://api.github.com/repos/rust-lang/rust/commits/c6b55eed638db7db34e887ef255c765bc8910ec0", "html_url": "https://github.com/rust-lang/rust/commit/c6b55eed638db7db34e887ef255c765bc8910ec0"}, {"sha": "ce83b49d161b9375849345be722e86c5417dfdda", "url": "https://api.github.com/repos/rust-lang/rust/commits/ce83b49d161b9375849345be722e86c5417dfdda", "html_url": "https://github.com/rust-lang/rust/commit/ce83b49d161b9375849345be722e86c5417dfdda"}], "stats": {"total": 65, "additions": 47, "deletions": 18}, "files": [{"sha": "73cb611d79f18768e078d7c784c0ded2860a0c55", "filename": "Cargo.lock", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/9b2f8dbba39dd4167f22a7026674a585c3d907d8/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/9b2f8dbba39dd4167f22a7026674a585c3d907d8/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=9b2f8dbba39dd4167f22a7026674a585c3d907d8", "patch": "@@ -1736,7 +1736,7 @@ checksum = \"5b31c9b90731276fdd24d896f31bb10aecf2e5151733364ae81123186643d939\"\n dependencies = [\n  \"jsonrpc-core\",\n  \"log\",\n- \"parking_lot 0.10.0\",\n+ \"parking_lot 0.10.2\",\n  \"serde\",\n ]\n \n@@ -1855,9 +1855,9 @@ checksum = \"ae91b68aebc4ddb91978b11a1b02ddd8602a05ec19002801c5666000e05e0f83\"\n \n [[package]]\n name = \"lock_api\"\n-version = \"0.3.1\"\n+version = \"0.3.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"f8912e782533a93a167888781b836336a6ca5da6175c05944c86cf28c31104dc\"\n+checksum = \"c4da24a77a3d8a6d4862d95f72e6fdb9c09a643ecdb402d754004a557f2bec75\"\n dependencies = [\n  \"scopeguard\",\n ]\n@@ -2395,12 +2395,12 @@ dependencies = [\n \n [[package]]\n name = \"parking_lot\"\n-version = \"0.10.0\"\n+version = \"0.10.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"92e98c49ab0b7ce5b222f2cc9193fc4efe11c6d0bd4f648e374684a6857b1cfc\"\n+checksum = \"d3a704eb390aafdc107b0e392f56a82b668e3a71366993b5340f5833fd62505e\"\n dependencies = [\n  \"lock_api\",\n- \"parking_lot_core 0.7.0\",\n+ \"parking_lot_core 0.7.1\",\n ]\n \n [[package]]\n@@ -2420,9 +2420,9 @@ dependencies = [\n \n [[package]]\n name = \"parking_lot_core\"\n-version = \"0.7.0\"\n+version = \"0.7.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"7582838484df45743c8434fbff785e8edf260c28748353d44bc0da32e0ceabf1\"\n+checksum = \"0e136c1904604defe99ce5fd71a28d473fa60a12255d511aa78a9ddf11237aeb\"\n dependencies = [\n  \"cfg-if\",\n  \"cloudabi\",\n@@ -3242,7 +3242,7 @@ dependencies = [\n  \"libc\",\n  \"log\",\n  \"measureme\",\n- \"parking_lot 0.10.0\",\n+ \"parking_lot 0.10.2\",\n  \"rustc-ap-graphviz\",\n  \"rustc-ap-rustc_index\",\n  \"rustc-ap-serialize\",\n@@ -3691,7 +3691,7 @@ dependencies = [\n  \"libc\",\n  \"log\",\n  \"measureme\",\n- \"parking_lot 0.10.0\",\n+ \"parking_lot 0.10.2\",\n  \"rustc-hash\",\n  \"rustc-rayon\",\n  \"rustc-rayon-core\",\n@@ -3989,7 +3989,7 @@ dependencies = [\n  \"jobserver\",\n  \"log\",\n  \"measureme\",\n- \"parking_lot 0.10.0\",\n+ \"parking_lot 0.10.2\",\n  \"polonius-engine\",\n  \"rustc-rayon\",\n  \"rustc-rayon-core\",\n@@ -4138,7 +4138,7 @@ name = \"rustc_query_system\"\n version = \"0.0.0\"\n dependencies = [\n  \"log\",\n- \"parking_lot 0.9.0\",\n+ \"parking_lot 0.10.2\",\n  \"rustc-rayon-core\",\n  \"rustc_data_structures\",\n  \"rustc_errors\","}, {"sha": "73404a73e3d0052e6cdddb039360159bae46c181", "filename": "src/libcore/macros/mod.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Flibcore%2Fmacros%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Flibcore%2Fmacros%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fmacros%2Fmod.rs?ref=9b2f8dbba39dd4167f22a7026674a585c3d907d8", "patch": "@@ -1316,6 +1316,14 @@ pub(crate) mod builtin {\n         issue = \"70173\",\n         reason = \"inline assembly is not stable enough for use and is subject to change\"\n     )]\n+    #[cfg_attr(\n+        not(bootstrap),\n+        rustc_deprecated(\n+            since = \"1.44.0\",\n+            reason = \"the syntax of asm! will change soon, use llvm_asm! to avoid breakage\",\n+            suggestion = \"llvm_asm\",\n+        )\n+    )]\n     #[rustc_builtin_macro]\n     #[macro_export]\n     macro_rules! asm {"}, {"sha": "6a51d39ab9d4e105a9624b23efe9d5c84d79b231", "filename": "src/libcore/prelude/v1.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Flibcore%2Fprelude%2Fv1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Flibcore%2Fprelude%2Fv1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fprelude%2Fv1.rs?ref=9b2f8dbba39dd4167f22a7026674a585c3d907d8", "patch": "@@ -54,6 +54,7 @@ pub use crate::fmt::macros::Debug;\n pub use crate::hash::macros::Hash;\n \n #[stable(feature = \"builtin_macro_prelude\", since = \"1.38.0\")]\n+#[allow(deprecated)]\n #[doc(no_inline)]\n pub use crate::{\n     asm, assert, cfg, column, compile_error, concat, concat_idents, env, file, format_args,"}, {"sha": "7520da1f32bcdde8efa5919518258372d27b5c5a", "filename": "src/librustc_query_system/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Flibrustc_query_system%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Flibrustc_query_system%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_query_system%2FCargo.toml?ref=9b2f8dbba39dd4167f22a7026674a585c3d907d8", "patch": "@@ -18,5 +18,5 @@ rustc_index = { path = \"../librustc_index\" }\n rustc_macros = { path = \"../librustc_macros\" }\n rustc_serialize = { path = \"../libserialize\", package = \"serialize\" }\n rustc_span = { path = \"../librustc_span\" }\n-parking_lot = \"0.9\"\n+parking_lot = \"0.10\"\n smallvec = { version = \"1.0\", features = [\"union\", \"may_dangle\"] }"}, {"sha": "9d2810cacc2bff2a5f09335001f1995f1faca04e", "filename": "src/libstd/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Flibstd%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Flibstd%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Flib.rs?ref=9b2f8dbba39dd4167f22a7026674a585c3d907d8", "patch": "@@ -524,6 +524,7 @@ pub use core::{\n \n // Re-export built-in macros defined through libcore.\n #[stable(feature = \"builtin_macro_prelude\", since = \"1.38.0\")]\n+#[allow(deprecated)]\n pub use core::{\n     asm, assert, cfg, column, compile_error, concat, concat_idents, env, file, format_args,\n     format_args_nl, global_asm, include, include_bytes, include_str, line, llvm_asm, log_syntax,"}, {"sha": "92e3ea8485036f62e095a97c11782ccf35cdb545", "filename": "src/libstd/prelude/v1.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Flibstd%2Fprelude%2Fv1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Flibstd%2Fprelude%2Fv1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fprelude%2Fv1.rs?ref=9b2f8dbba39dd4167f22a7026674a585c3d907d8", "patch": "@@ -36,6 +36,7 @@ pub use crate::result::Result::{self, Err, Ok};\n \n // Re-exported built-in macros\n #[stable(feature = \"builtin_macro_prelude\", since = \"1.38.0\")]\n+#[allow(deprecated)]\n #[doc(no_inline)]\n pub use core::prelude::v1::{\n     asm, assert, cfg, column, compile_error, concat, concat_idents, env, file, format_args,"}, {"sha": "b00ecbeb268ee97cef9fa9b2375e6f6cf0864db2", "filename": "src/stdarch", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fstdarch?ref=9b2f8dbba39dd4167f22a7026674a585c3d907d8", "patch": "@@ -1 +1 @@\n-Subproject commit 1a577bd78e84e357e29c5336ff8beb432873046b\n+Subproject commit b00ecbeb268ee97cef9fa9b2375e6f6cf0864db2"}, {"sha": "70f5845550d175075391c265f8337a34a4e67c05", "filename": "src/test/ui/feature-gates/feature-gate-asm.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm.rs?ref=9b2f8dbba39dd4167f22a7026674a585c3d907d8", "patch": "@@ -3,6 +3,7 @@\n fn main() {\n     unsafe {\n         asm!(\"\"); //~ ERROR inline assembly is not stable enough\n+        //~^ WARN use of deprecated item 'asm'\n         llvm_asm!(\"\"); //~ ERROR inline assembly is not stable enough\n     }\n }"}, {"sha": "9d4d7b53955b5fe1d5ce25999e7eb9983d61ae78", "filename": "src/test/ui/feature-gates/feature-gate-asm.stderr", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm.stderr?ref=9b2f8dbba39dd4167f22a7026674a585c3d907d8", "patch": "@@ -8,14 +8,22 @@ LL |         asm!(\"\");\n    = help: add `#![feature(asm)]` to the crate attributes to enable\n \n error[E0658]: use of unstable library feature 'llvm_asm': inline assembly is not stable enough for use and is subject to change\n-  --> $DIR/feature-gate-asm.rs:6:9\n+  --> $DIR/feature-gate-asm.rs:7:9\n    |\n LL |         llvm_asm!(\"\");\n    |         ^^^^^^^^\n    |\n    = note: see issue #70173 <https://github.com/rust-lang/rust/issues/70173> for more information\n    = help: add `#![feature(llvm_asm)]` to the crate attributes to enable\n \n-error: aborting due to 2 previous errors\n+warning: use of deprecated item 'asm': the syntax of asm! will change soon, use llvm_asm! to avoid breakage\n+  --> $DIR/feature-gate-asm.rs:5:9\n+   |\n+LL |         asm!(\"\");\n+   |         ^^^ help: replace the use of the deprecated item: `llvm_asm`\n+   |\n+   = note: `#[warn(deprecated)]` on by default\n+\n+error: aborting due to 2 previous errors; 1 warning emitted\n \n For more information about this error, try `rustc --explain E0658`."}, {"sha": "e3e86592a480aaa104bc177715cf60201d4beba9", "filename": "src/test/ui/feature-gates/feature-gate-asm2.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm2.rs?ref=9b2f8dbba39dd4167f22a7026674a585c3d907d8", "patch": "@@ -3,6 +3,7 @@\n fn main() {\n     unsafe {\n         println!(\"{:?}\", asm!(\"\")); //~ ERROR inline assembly is not stable\n+        //~^ WARN use of deprecated item 'asm'\n         println!(\"{:?}\", llvm_asm!(\"\")); //~ ERROR inline assembly is not stable\n     }\n }"}, {"sha": "a3c8116d6b1662d048f847f2513b798ec3171f5a", "filename": "src/test/ui/feature-gates/feature-gate-asm2.stderr", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/9b2f8dbba39dd4167f22a7026674a585c3d907d8/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-asm2.stderr?ref=9b2f8dbba39dd4167f22a7026674a585c3d907d8", "patch": "@@ -8,14 +8,22 @@ LL |         println!(\"{:?}\", asm!(\"\"));\n    = help: add `#![feature(asm)]` to the crate attributes to enable\n \n error[E0658]: use of unstable library feature 'llvm_asm': inline assembly is not stable enough for use and is subject to change\n-  --> $DIR/feature-gate-asm2.rs:6:26\n+  --> $DIR/feature-gate-asm2.rs:7:26\n    |\n LL |         println!(\"{:?}\", llvm_asm!(\"\"));\n    |                          ^^^^^^^^\n    |\n    = note: see issue #70173 <https://github.com/rust-lang/rust/issues/70173> for more information\n    = help: add `#![feature(llvm_asm)]` to the crate attributes to enable\n \n-error: aborting due to 2 previous errors\n+warning: use of deprecated item 'asm': the syntax of asm! will change soon, use llvm_asm! to avoid breakage\n+  --> $DIR/feature-gate-asm2.rs:5:26\n+   |\n+LL |         println!(\"{:?}\", asm!(\"\"));\n+   |                          ^^^ help: replace the use of the deprecated item: `llvm_asm`\n+   |\n+   = note: `#[warn(deprecated)]` on by default\n+\n+error: aborting due to 2 previous errors; 1 warning emitted\n \n For more information about this error, try `rustc --explain E0658`."}]}