{"sha": "1334638144d660822e02f087b6168356375e92ac", "node_id": "MDY6Q29tbWl0NzI0NzEyOjEzMzQ2MzgxNDRkNjYwODIyZTAyZjA4N2I2MTY4MzU2Mzc1ZTkyYWM=", "commit": {"author": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2017-12-13T07:06:39Z"}, "committer": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2017-12-13T21:48:20Z"}, "message": "Add some doc to `struct Borrows`.", "tree": {"sha": "f4145875ea3b050046375c00ec30f6792836ad65", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f4145875ea3b050046375c00ec30f6792836ad65"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1334638144d660822e02f087b6168356375e92ac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1334638144d660822e02f087b6168356375e92ac", "html_url": "https://github.com/rust-lang/rust/commit/1334638144d660822e02f087b6168356375e92ac", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1334638144d660822e02f087b6168356375e92ac/comments", "author": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "658ed797003ff392e42e9f29e99905d8558b36f0", "url": "https://api.github.com/repos/rust-lang/rust/commits/658ed797003ff392e42e9f29e99905d8558b36f0", "html_url": "https://github.com/rust-lang/rust/commit/658ed797003ff392e42e9f29e99905d8558b36f0"}], "stats": {"total": 25, "additions": 22, "deletions": 3}, "files": [{"sha": "4c36deae10113ed5c4a9a369210c8e45483b8480", "filename": "src/librustc_mir/dataflow/impls/borrows.rs", "status": "modified", "additions": 22, "deletions": 3, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/1334638144d660822e02f087b6168356375e92ac/src%2Flibrustc_mir%2Fdataflow%2Fimpls%2Fborrows.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1334638144d660822e02f087b6168356375e92ac/src%2Flibrustc_mir%2Fdataflow%2Fimpls%2Fborrows.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdataflow%2Fimpls%2Fborrows.rs?ref=1334638144d660822e02f087b6168356375e92ac", "patch": "@@ -33,17 +33,36 @@ use std::fmt;\n use std::hash::Hash;\n use std::rc::Rc;\n \n-// `Borrows` maps each dataflow bit to an `Rvalue::Ref`, which can be\n-// uniquely identified in the MIR by the `Location` of the assigment\n-// statement in which it appears on the right hand side.\n+/// `Borrows` stores the data used in the analyses that track the flow\n+/// of borrows.\n+///\n+/// It uniquely identifies every borrow (`Rvalue::Ref`) by a\n+/// `BorrowIndex`, and maps each such index to a `BorrowData`\n+/// describing the borrow. These indexes are used for representing the\n+/// borrows in compact bitvectors.\n pub struct Borrows<'a, 'gcx: 'tcx, 'tcx: 'a> {\n     tcx: TyCtxt<'a, 'gcx, 'tcx>,\n     mir: &'a Mir<'tcx>,\n     scope_tree: Rc<region::ScopeTree>,\n     root_scope: Option<region::Scope>,\n+\n+    /// The fundamental map relating bitvector indexes to the borrows\n+    /// in the MIR.\n     borrows: IndexVec<BorrowIndex, BorrowData<'tcx>>,\n+\n+    /// Each borrow is also uniquely identified in the MIR by the\n+    /// `Location` of the assignment statement in which it appears on\n+    /// the right hand side; we map each such location to the\n+    /// corresponding `BorrowIndex`.\n     location_map: FxHashMap<Location, BorrowIndex>,\n+\n+    /// Every borrow in MIR is immediately stored into a place via an\n+    /// assignment statement. This maps each such assigned place back\n+    /// to its borrow-indexes.\n     assigned_map: FxHashMap<Place<'tcx>, FxHashSet<BorrowIndex>>,\n+\n+    /// Every borrow has a region; this maps each such regions back to\n+    /// its borrow-indexes.\n     region_map: FxHashMap<Region<'tcx>, FxHashSet<BorrowIndex>>,\n     local_map: FxHashMap<mir::Local, FxHashSet<BorrowIndex>>,\n     region_span_map: FxHashMap<RegionKind, Span>,"}]}