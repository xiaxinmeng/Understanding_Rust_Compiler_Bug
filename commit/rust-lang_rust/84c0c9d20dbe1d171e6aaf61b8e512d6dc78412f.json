{"sha": "84c0c9d20dbe1d171e6aaf61b8e512d6dc78412f", "node_id": "C_kwDOAAsO6NoAKDg0YzBjOWQyMGRiZTFkMTcxZTZhYWY2MWI4ZTUxMmQ2ZGM3ODQxMmY", "commit": {"author": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2022-01-25T10:36:10Z"}, "committer": {"name": "Chris Denton", "email": "christophersdenton@gmail.com", "date": "2022-01-25T10:36:10Z"}, "message": "Avoid double panics when using `TempDir` in tests", "tree": {"sha": "c8f9a1963f49783ec52695c408bc3318c01551da", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c8f9a1963f49783ec52695c408bc3318c01551da"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/84c0c9d20dbe1d171e6aaf61b8e512d6dc78412f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE+p/jD6jrzmnSIWJLcTRy8vRWJ94FAmHv0poACgkQcTRy8vRW\nJ96GiQ//Y7jdbIceBGSutE38MnMiMiC27N4yrCFE30xx7PDpf80RdzZ/IxL6DiF1\nA1gRDpoOwgCanDgJCIdVGfpnFdCM1gBL9RXPaKPnIgHFTyhCWLUFj2xx1EliO6EY\naO7PNrLFiT1s5Gb4DcJT2bSX6dDb1FRiWzLKzihieXF66w9wte6wn0LYC2UEeNvP\nGMPypqnkQflBduQX+Hn2Dv9nYQ8M6HQl3oi3RyZIKr12UXMeKwQ6I4XlLYCg4OLz\nPs18aIcFUacBDHIHzU/yHmQxJp+/YLzLpHOXjzJjG6KI3++7FxszWNz9aA2JNTeF\nAFuZHFvmP5tqP8MBACuFx3ldjAvM1QyJGHa2dZxfKRbyfBCY54OLKO1pQz7fiHax\nzKWLa+uF0WZukgCVvwyPlJufEOP+WoWyUopBz86WmktXpkg9pJOcqZIe3zd1DW/Y\nU55Z4iiGRxeOG1eavG1BYHFRvYwuqxEBWno8Hm5idBCsSg3vOHmh8aucuqwMwQTK\ne8yzibwlTraXBkegCtg8OCwbqLE50YVPi+wA+XrILmw0qhfReZd+reJ8+HXvbRgh\nfWRRxkoO6vGW78GLnRu2ls/bWfgDfEziipXs2ZOKkix498tvcY5zVJwGn2YOmVQo\ndOnxBX9xsa1i2hsnCm59JJMFiQqD4F6ryXA+nVF1uR3wmiX+tmE=\n=m+d1\n-----END PGP SIGNATURE-----", "payload": "tree c8f9a1963f49783ec52695c408bc3318c01551da\nparent df368ae457c54fb95d3e64f9986a5f171a6370f0\nauthor Chris Denton <christophersdenton@gmail.com> 1643106970 +0000\ncommitter Chris Denton <christophersdenton@gmail.com> 1643106970 +0000\n\nAvoid double panics when using `TempDir` in tests\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/84c0c9d20dbe1d171e6aaf61b8e512d6dc78412f", "html_url": "https://github.com/rust-lang/rust/commit/84c0c9d20dbe1d171e6aaf61b8e512d6dc78412f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/84c0c9d20dbe1d171e6aaf61b8e512d6dc78412f/comments", "author": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ChrisDenton", "id": 4459874, "node_id": "MDQ6VXNlcjQ0NTk4NzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4459874?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ChrisDenton", "html_url": "https://github.com/ChrisDenton", "followers_url": "https://api.github.com/users/ChrisDenton/followers", "following_url": "https://api.github.com/users/ChrisDenton/following{/other_user}", "gists_url": "https://api.github.com/users/ChrisDenton/gists{/gist_id}", "starred_url": "https://api.github.com/users/ChrisDenton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ChrisDenton/subscriptions", "organizations_url": "https://api.github.com/users/ChrisDenton/orgs", "repos_url": "https://api.github.com/users/ChrisDenton/repos", "events_url": "https://api.github.com/users/ChrisDenton/events{/privacy}", "received_events_url": "https://api.github.com/users/ChrisDenton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "df368ae457c54fb95d3e64f9986a5f171a6370f0", "url": "https://api.github.com/repos/rust-lang/rust/commits/df368ae457c54fb95d3e64f9986a5f171a6370f0", "html_url": "https://github.com/rust-lang/rust/commit/df368ae457c54fb95d3e64f9986a5f171a6370f0"}], "stats": {"total": 8, "additions": 7, "deletions": 1}, "files": [{"sha": "d1e9fed41fc930093b85b900ab5fb9e2735fcc3d", "filename": "library/std/src/sys_common/io.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/84c0c9d20dbe1d171e6aaf61b8e512d6dc78412f/library%2Fstd%2Fsrc%2Fsys_common%2Fio.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84c0c9d20dbe1d171e6aaf61b8e512d6dc78412f/library%2Fstd%2Fsrc%2Fsys_common%2Fio.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys_common%2Fio.rs?ref=84c0c9d20dbe1d171e6aaf61b8e512d6dc78412f", "patch": "@@ -8,6 +8,7 @@ pub mod test {\n     use crate::env;\n     use crate::fs;\n     use crate::path::{Path, PathBuf};\n+    use crate::thread;\n     use rand::RngCore;\n \n     pub struct TempDir(PathBuf);\n@@ -29,7 +30,12 @@ pub mod test {\n             // Gee, seeing how we're testing the fs module I sure hope that we\n             // at least implement this correctly!\n             let TempDir(ref p) = *self;\n-            fs::remove_dir_all(p).unwrap();\n+            let result = fs::remove_dir_all(p);\n+            // Avoid panicking while panicking as this causes the process to\n+            // immediately abort, without displaying test results.\n+            if !thread::panicking() {\n+                result.unwrap();\n+            }\n         }\n     }\n "}]}