{"sha": "5303c1b90b12c0edb3fbadf96f15edf93fb69155", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUzMDNjMWI5MGIxMmMwZWRiM2ZiYWRmOTZmMTVlZGY5M2ZiNjkxNTU=", "commit": {"author": {"name": "Brian Campbell", "email": "lambda@continuation.org", "date": "2019-03-15T05:51:26Z"}, "committer": {"name": "Brian Campbell", "email": "lambda@continuation.org", "date": "2019-03-15T13:42:02Z"}, "message": "Remove restriction on isize/usize in repr(simd)\n\nAs discussed in #55078, there's no known reason for this restriction.\n\nIt's unlikely that repr(simd) will be stabilized in its current form, but\nmight as well remove some restrictions on it.\n\nThis removes the branch in `is_machine` which returns false for these types.\n`is_machine` is only used for the repr(simd) type validation check.", "tree": {"sha": "21043a71607c3b7859b347dbfd4a68ba289801f0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/21043a71607c3b7859b347dbfd4a68ba289801f0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5303c1b90b12c0edb3fbadf96f15edf93fb69155", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5303c1b90b12c0edb3fbadf96f15edf93fb69155", "html_url": "https://github.com/rust-lang/rust/commit/5303c1b90b12c0edb3fbadf96f15edf93fb69155", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5303c1b90b12c0edb3fbadf96f15edf93fb69155/comments", "author": {"login": "lambda", "id": 37398, "node_id": "MDQ6VXNlcjM3Mzk4", "avatar_url": "https://avatars.githubusercontent.com/u/37398?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lambda", "html_url": "https://github.com/lambda", "followers_url": "https://api.github.com/users/lambda/followers", "following_url": "https://api.github.com/users/lambda/following{/other_user}", "gists_url": "https://api.github.com/users/lambda/gists{/gist_id}", "starred_url": "https://api.github.com/users/lambda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lambda/subscriptions", "organizations_url": "https://api.github.com/users/lambda/orgs", "repos_url": "https://api.github.com/users/lambda/repos", "events_url": "https://api.github.com/users/lambda/events{/privacy}", "received_events_url": "https://api.github.com/users/lambda/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lambda", "id": 37398, "node_id": "MDQ6VXNlcjM3Mzk4", "avatar_url": "https://avatars.githubusercontent.com/u/37398?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lambda", "html_url": "https://github.com/lambda", "followers_url": "https://api.github.com/users/lambda/followers", "following_url": "https://api.github.com/users/lambda/following{/other_user}", "gists_url": "https://api.github.com/users/lambda/gists{/gist_id}", "starred_url": "https://api.github.com/users/lambda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lambda/subscriptions", "organizations_url": "https://api.github.com/users/lambda/orgs", "repos_url": "https://api.github.com/users/lambda/repos", "events_url": "https://api.github.com/users/lambda/events{/privacy}", "received_events_url": "https://api.github.com/users/lambda/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bc44841ad2a2ad5f6c5e67b9e35ed8e7e71d4dc7", "url": "https://api.github.com/repos/rust-lang/rust/commits/bc44841ad2a2ad5f6c5e67b9e35ed8e7e71d4dc7", "html_url": "https://github.com/rust-lang/rust/commit/bc44841ad2a2ad5f6c5e67b9e35ed8e7e71d4dc7"}], "stats": {"total": 46, "additions": 34, "deletions": 12}, "files": [{"sha": "2db4caaff92bc579e5a87122869e7d30ee01cf2a", "filename": "src/librustc/ty/sty.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5303c1b90b12c0edb3fbadf96f15edf93fb69155/src%2Flibrustc%2Fty%2Fsty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5303c1b90b12c0edb3fbadf96f15edf93fb69155/src%2Flibrustc%2Fty%2Fsty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fsty.rs?ref=5303c1b90b12c0edb3fbadf96f15edf93fb69155", "patch": "@@ -1910,7 +1910,6 @@ impl<'a, 'gcx, 'tcx> TyS<'tcx> {\n \n     pub fn is_machine(&self) -> bool {\n         match self.sty {\n-            Int(ast::IntTy::Isize) | Uint(ast::UintTy::Usize) => false,\n             Int(..) | Uint(..) | Float(..) => true,\n             _ => false,\n         }"}, {"sha": "556013788c33557c0b81445d0b3d5d235d1dd5a5", "filename": "src/test/run-pass/simd/simd-size-align.rs", "status": "modified", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/5303c1b90b12c0edb3fbadf96f15edf93fb69155/src%2Ftest%2Frun-pass%2Fsimd%2Fsimd-size-align.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5303c1b90b12c0edb3fbadf96f15edf93fb69155/src%2Ftest%2Frun-pass%2Fsimd%2Fsimd-size-align.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fsimd%2Fsimd-size-align.rs?ref=5303c1b90b12c0edb3fbadf96f15edf93fb69155", "patch": "@@ -37,6 +37,22 @@ fn main() {\n     check::<f32x6>();\n     check::<f32x7>();\n     check::<f32x8>();\n+\n+    check::<usizex2>();\n+    check::<usizex3>();\n+    check::<usizex4>();\n+    check::<usizex5>();\n+    check::<usizex6>();\n+    check::<usizex7>();\n+    check::<usizex8>();\n+\n+    check::<isizex2>();\n+    check::<isizex3>();\n+    check::<isizex4>();\n+    check::<isizex5>();\n+    check::<isizex6>();\n+    check::<isizex7>();\n+    check::<isizex8>();\n }\n \n #[repr(simd)] struct u8x2(u8, u8);\n@@ -62,3 +78,19 @@ fn main() {\n #[repr(simd)] struct f32x6(f32, f32, f32, f32, f32, f32);\n #[repr(simd)] struct f32x7(f32, f32, f32, f32, f32, f32, f32);\n #[repr(simd)] struct f32x8(f32, f32, f32, f32, f32, f32, f32, f32);\n+\n+#[repr(simd)] struct usizex2(usize, usize);\n+#[repr(simd)] struct usizex3(usize, usize, usize);\n+#[repr(simd)] struct usizex4(usize, usize, usize, usize);\n+#[repr(simd)] struct usizex5(usize, usize, usize, usize, usize);\n+#[repr(simd)] struct usizex6(usize, usize, usize, usize, usize, usize);\n+#[repr(simd)] struct usizex7(usize, usize, usize, usize, usize, usize, usize);\n+#[repr(simd)] struct usizex8(usize, usize, usize, usize, usize, usize, usize, usize);\n+\n+#[repr(simd)] struct isizex2(isize, isize);\n+#[repr(simd)] struct isizex3(isize, isize, isize);\n+#[repr(simd)] struct isizex4(isize, isize, isize, isize);\n+#[repr(simd)] struct isizex5(isize, isize, isize, isize, isize);\n+#[repr(simd)] struct isizex6(isize, isize, isize, isize, isize, isize);\n+#[repr(simd)] struct isizex7(isize, isize, isize, isize, isize, isize, isize);\n+#[repr(simd)] struct isizex8(isize, isize, isize, isize, isize, isize, isize, isize);"}, {"sha": "9e4b7e7656055f1ca685ec7c026a671713d74df3", "filename": "src/test/ui/simd-type.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/5303c1b90b12c0edb3fbadf96f15edf93fb69155/src%2Ftest%2Fui%2Fsimd-type.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5303c1b90b12c0edb3fbadf96f15edf93fb69155/src%2Ftest%2Fui%2Fsimd-type.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimd-type.rs?ref=5303c1b90b12c0edb3fbadf96f15edf93fb69155", "patch": "@@ -7,7 +7,4 @@ struct empty; //~ ERROR SIMD vector cannot be empty\n #[repr(simd)]\n struct i64f64(i64, f64); //~ ERROR SIMD vector should be homogeneous\n \n-#[repr(simd)]\n-struct int4(isize, isize, isize, isize); //~ ERROR SIMD vector element type should be machine type\n-\n fn main() {}"}, {"sha": "48b9916e89d98b65cbabdbd2a14575769474c028", "filename": "src/test/ui/simd-type.stderr", "status": "modified", "additions": 2, "deletions": 8, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/5303c1b90b12c0edb3fbadf96f15edf93fb69155/src%2Ftest%2Fui%2Fsimd-type.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5303c1b90b12c0edb3fbadf96f15edf93fb69155/src%2Ftest%2Fui%2Fsimd-type.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsimd-type.stderr?ref=5303c1b90b12c0edb3fbadf96f15edf93fb69155", "patch": "@@ -10,13 +10,7 @@ error[E0076]: SIMD vector should be homogeneous\n LL | struct i64f64(i64, f64);\n    | ^^^^^^^^^^^^^^^^^^^^^^^^ SIMD elements must have the same type\n \n-error[E0077]: SIMD vector element type should be machine type\n-  --> $DIR/simd-type.rs:11:1\n-   |\n-LL | struct int4(isize, isize, isize, isize);\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-error: aborting due to 3 previous errors\n+error: aborting due to 2 previous errors\n \n-Some errors occurred: E0075, E0076, E0077.\n+Some errors occurred: E0075, E0076.\n For more information about an error, try `rustc --explain E0075`."}]}