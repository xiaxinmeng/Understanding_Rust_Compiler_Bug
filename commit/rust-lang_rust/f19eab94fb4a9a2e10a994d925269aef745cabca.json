{"sha": "f19eab94fb4a9a2e10a994d925269aef745cabca", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYxOWVhYjk0ZmI0YTlhMmUxMGE5OTRkOTI1MjY5YWVmNzQ1Y2FiY2E=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-05-17T12:16:26Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-05-17T12:16:26Z"}, "message": "Merge pull request #2764 from phansch/integration_tests\n\nAdd basic integration tests for travis", "tree": {"sha": "6c8c5d7c5a6c2c1a138fe79405f75e257cb46d2d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6c8c5d7c5a6c2c1a138fe79405f75e257cb46d2d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f19eab94fb4a9a2e10a994d925269aef745cabca", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJa/XKaCRBK7hj4Ov3rIwAAdHIIABFZY9BqlhPHVOchT77kxJqF\nc5h5+HvXV97HZH078Czw1mEsV0DwDGoNWZ0IPHwZ9fJh2M8pxJ2ZN6Xd+6y38qOg\nXFCQOGQbLj8mv4VBdhKd92bmuPffnblysAHHIyCvNTrbyusCFQ/pLXfj3OQZQVq5\n6+5dAnHM7lGjrBKfn2wLaACNQcM6FETB6pL0Wl9v4uuCEnNpqtz1WqP0lP0K8DLD\n5qnEFJ7zvehn+/HwdxyrzCQ62Znv/EbRj9blDZ3XrSEvx7opxyC+DS/ig7gEzkAG\nk7j+UJQRwQC4jiPd4LhVMxTrIokBe9vCTM0YN4RUoXAHf41NPU9QcpC6BiOLcig=\n=kLvd\n-----END PGP SIGNATURE-----\n", "payload": "tree 6c8c5d7c5a6c2c1a138fe79405f75e257cb46d2d\nparent c0bf3a46968e9f19e5f3aad563d03a2d222a320b\nparent 569c138333ba41f66172f0c6ceb0d475e2623730\nauthor Philipp Hansch <dev@phansch.net> 1526559386 +0200\ncommitter GitHub <noreply@github.com> 1526559386 +0200\n\nMerge pull request #2764 from phansch/integration_tests\n\nAdd basic integration tests for travis"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f19eab94fb4a9a2e10a994d925269aef745cabca", "html_url": "https://github.com/rust-lang/rust/commit/f19eab94fb4a9a2e10a994d925269aef745cabca", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f19eab94fb4a9a2e10a994d925269aef745cabca/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c0bf3a46968e9f19e5f3aad563d03a2d222a320b", "url": "https://api.github.com/repos/rust-lang/rust/commits/c0bf3a46968e9f19e5f3aad563d03a2d222a320b", "html_url": "https://github.com/rust-lang/rust/commit/c0bf3a46968e9f19e5f3aad563d03a2d222a320b"}, {"sha": "569c138333ba41f66172f0c6ceb0d475e2623730", "url": "https://api.github.com/repos/rust-lang/rust/commits/569c138333ba41f66172f0c6ceb0d475e2623730", "html_url": "https://github.com/rust-lang/rust/commit/569c138333ba41f66172f0c6ceb0d475e2623730"}], "stats": {"total": 76, "additions": 57, "deletions": 19}, "files": [{"sha": "1d206e61167e9c33be0dd7f3764887167d053bb6", "filename": ".github/deploy.sh", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f19eab94fb4a9a2e10a994d925269aef745cabca/.github%2Fdeploy.sh", "raw_url": "https://github.com/rust-lang/rust/raw/f19eab94fb4a9a2e10a994d925269aef745cabca/.github%2Fdeploy.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.github%2Fdeploy.sh?ref=f19eab94fb4a9a2e10a994d925269aef745cabca", "patch": "@@ -1,8 +1,7 @@\n #!/bin/bash\n # Automatically deploy on gh-pages\n \n-set -e\n-set -x\n+set -ex\n \n SOURCE_BRANCH=\"master\"\n TARGET_BRANCH=\"gh-pages\""}, {"sha": "22dc2f572ae02669381b8c02b9234f0c4c412408", "filename": ".travis.yml", "status": "modified", "additions": 16, "deletions": 17, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/f19eab94fb4a9a2e10a994d925269aef745cabca/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/f19eab94fb4a9a2e10a994d925269aef745cabca/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=f19eab94fb4a9a2e10a994d925269aef745cabca", "patch": "@@ -29,28 +29,27 @@ install:\n   - nvm use stable\n   - npm install remark-cli remark-lint\n \n+matrix:\n+  include:\n+    - env: BASE_TESTS=true # runs the base tests\n+    - env: INTEGRATION=rust-lang/cargo\n+    - env: INTEGRATION=rust-lang-nursery/rand\n+  allow_failures:\n+    - env: INTEGRATION=rust-lang/cargo\n+    - env: INTEGRATION=rust-lang-nursery/rand\n+\n script:\n- - PATH=$PATH:./node_modules/.bin\n- - remark -f *.md > /dev/null\n- - set -e\n- - cargo build --features debugging\n- - cargo test --features debugging\n- - mkdir -p ~/rust/cargo/bin\n- - cp target/debug/cargo-clippy ~/rust/cargo/bin/cargo-clippy\n- - cp target/debug/clippy-driver ~/rust/cargo/bin/clippy-driver\n- - PATH=$PATH:~/rust/cargo/bin cargo clippy --all -- -D clippy\n- - cd clippy_workspace_tests && PATH=$PATH:~/rust/cargo/bin cargo clippy -- -D clippy && cd ..\n- - cd clippy_workspace_tests/src && PATH=$PATH:~/rust/cargo/bin cargo clippy -- -D clippy && cd ../..\n- - cd clippy_workspace_tests/subcrate && PATH=$PATH:~/rust/cargo/bin cargo clippy -- -D clippy && cd ../..\n- - cd clippy_workspace_tests/subcrate/src && PATH=$PATH:~/rust/cargo/bin cargo clippy -- -D clippy && cd ../../..\n- - PATH=$PATH:~/rust/cargo/bin cargo clippy --manifest-path=clippy_workspace_tests/Cargo.toml -- -D clippy\n- - cd clippy_workspace_tests/subcrate && PATH=$PATH:~/rust/cargo/bin cargo clippy --manifest-path=../Cargo.toml -- -D clippy && cd ../..\n- - set +e\n+  - |\n+    if [ -z ${INTEGRATION} ]; then\n+      ./ci/base-tests.sh\n+    else\n+      ./ci/integration-tests.sh\n+    fi\n \n after_success: |\n   #!/bin/bash\n   if [ $(uname) == Linux ]; then\n-    set -e\n+    set -ex\n     ./.github/deploy.sh\n     # trigger rebuild of the clippy-service, to keep it up to date with clippy itself\n     if [ \"$TRAVIS_PULL_REQUEST\" == \"false\" ] &&"}, {"sha": "daec740212db30fc80a5e82dcc75c5ee9f27b4bd", "filename": "ci/base-tests.sh", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/f19eab94fb4a9a2e10a994d925269aef745cabca/ci%2Fbase-tests.sh", "raw_url": "https://github.com/rust-lang/rust/raw/f19eab94fb4a9a2e10a994d925269aef745cabca/ci%2Fbase-tests.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/ci%2Fbase-tests.sh?ref=f19eab94fb4a9a2e10a994d925269aef745cabca", "patch": "@@ -0,0 +1,15 @@\n+set -ex\n+PATH=$PATH:./node_modules/.bin\n+remark -f *.md > /dev/null\n+cargo build --features debugging\n+cargo test --features debugging\n+mkdir -p ~/rust/cargo/bin\n+cp target/debug/cargo-clippy ~/rust/cargo/bin/cargo-clippy\n+cp target/debug/clippy-driver ~/rust/cargo/bin/clippy-driver\n+PATH=$PATH:~/rust/cargo/bin cargo clippy --all -- -D clippy\n+cd clippy_workspace_tests && PATH=$PATH:~/rust/cargo/bin cargo clippy -- -D clippy && cd ..\n+cd clippy_workspace_tests/src && PATH=$PATH:~/rust/cargo/bin cargo clippy -- -D clippy && cd ../..\n+cd clippy_workspace_tests/subcrate && PATH=$PATH:~/rust/cargo/bin cargo clippy -- -D clippy && cd ../..\n+cd clippy_workspace_tests/subcrate/src && PATH=$PATH:~/rust/cargo/bin cargo clippy -- -D clippy && cd ../../..\n+PATH=$PATH:~/rust/cargo/bin cargo clippy --manifest-path=clippy_workspace_tests/Cargo.toml -- -D clippy\n+cd clippy_workspace_tests/subcrate && PATH=$PATH:~/rust/cargo/bin cargo clippy --manifest-path=../Cargo.toml -- -D clippy && cd ../.."}, {"sha": "2fe15179b5f45cd6ca1016253a2c8a3fc2dd9360", "filename": "ci/integration-tests.sh", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/f19eab94fb4a9a2e10a994d925269aef745cabca/ci%2Fintegration-tests.sh", "raw_url": "https://github.com/rust-lang/rust/raw/f19eab94fb4a9a2e10a994d925269aef745cabca/ci%2Fintegration-tests.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/ci%2Fintegration-tests.sh?ref=f19eab94fb4a9a2e10a994d925269aef745cabca", "patch": "@@ -0,0 +1,25 @@\n+set -x\n+cargo install --force\n+\n+echo \"Running integration test for crate ${INTEGRATION}\"\n+\n+git clone --depth=1 https://github.com/${INTEGRATION}.git checkout\n+cd checkout\n+\n+function check() {\n+  cargo clippy --all &> clippy_output\n+  cat clippy_output\n+  ! cat clippy_output | grep -q \"internal compiler error\"\n+  if [[ $? != 0 ]]; then\n+    return 1\n+  fi\n+}\n+\n+case ${INTEGRATION} in\n+  rust-lang/cargo)\n+    check\n+    ;;\n+  *)\n+    check\n+    ;;\n+esac"}]}