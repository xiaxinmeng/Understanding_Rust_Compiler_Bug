{"sha": "3e086528efd950e3051654daf9e62f339ef4a55c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNlMDg2NTI4ZWZkOTUwZTMwNTE2NTRkYWY5ZTYyZjMzOWVmNGE1NWM=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2019-07-23T16:44:15Z"}, "committer": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2019-07-23T16:44:15Z"}, "message": "Merge #1582\n\n1582: Show local variable types in completion r=matklad a=viorina\n\n\n\nCo-authored-by: Ekaterina Babshukova <ekaterina.babshukova@yandex.ru>", "tree": {"sha": "3b555fbdb1cf4d8c9c2a67e34b29ec8ebc31b2cb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3b555fbdb1cf4d8c9c2a67e34b29ec8ebc31b2cb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3e086528efd950e3051654daf9e62f339ef4a55c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3e086528efd950e3051654daf9e62f339ef4a55c", "html_url": "https://github.com/rust-lang/rust/commit/3e086528efd950e3051654daf9e62f339ef4a55c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3e086528efd950e3051654daf9e62f339ef4a55c/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "5f3ff157e3efe9f4fe2461bca1a0caaa5d2c72e5", "url": "https://api.github.com/repos/rust-lang/rust/commits/5f3ff157e3efe9f4fe2461bca1a0caaa5d2c72e5", "html_url": "https://github.com/rust-lang/rust/commit/5f3ff157e3efe9f4fe2461bca1a0caaa5d2c72e5"}, {"sha": "8e49bb664a03c29e25055a5a2ec03aa055462423", "url": "https://api.github.com/repos/rust-lang/rust/commits/8e49bb664a03c29e25055a5a2ec03aa055462423", "html_url": "https://github.com/rust-lang/rust/commit/8e49bb664a03c29e25055a5a2ec03aa055462423"}], "stats": {"total": 39, "additions": 30, "deletions": 9}, "files": [{"sha": "c2c6921cbc3a187d3204545f2967844af0df57d8", "filename": "crates/ra_hir/src/source_binder.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/3e086528efd950e3051654daf9e62f339ef4a55c/crates%2Fra_hir%2Fsrc%2Fsource_binder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e086528efd950e3051654daf9e62f339ef4a55c/crates%2Fra_hir%2Fsrc%2Fsource_binder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fsource_binder.rs?ref=3e086528efd950e3051654daf9e62f339ef4a55c", "patch": "@@ -256,6 +256,14 @@ impl SourceAnalyzer {\n         Some(self.infer.as_ref()?[pat_id].clone())\n     }\n \n+    pub fn type_of_pat_by_id(\n+        &self,\n+        _db: &impl HirDatabase,\n+        pat_id: expr::PatId,\n+    ) -> Option<crate::Ty> {\n+        Some(self.infer.as_ref()?[pat_id].clone())\n+    }\n+\n     pub fn resolve_method_call(&self, call: &ast::MethodCallExpr) -> Option<Function> {\n         let expr_id = self.body_source_map.as_ref()?.node_expr(&call.clone().into())?;\n         self.infer.as_ref()?.method_resolution(expr_id)"}, {"sha": "5cf55a496c02502e506af3355ca8963513d02732", "filename": "crates/ra_ide_api/src/completion/presentation.rs", "status": "modified", "additions": 13, "deletions": 5, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/3e086528efd950e3051654daf9e62f339ef4a55c/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fpresentation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3e086528efd950e3051654daf9e62f339ef4a55c/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fpresentation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fpresentation.rs?ref=3e086528efd950e3051654daf9e62f339ef4a55c", "patch": "@@ -1,5 +1,5 @@\n //! This modules takes care of rendering various defenitions as completion items.\n-use hir::{Docs, HasSource, HirDisplay, PerNs, Resolution};\n+use hir::{Docs, HasSource, HirDisplay, PerNs, Resolution, Ty};\n use join_to_string::join;\n use ra_syntax::ast::NameOwner;\n use test_utils::tested_by;\n@@ -80,10 +80,18 @@ impl Completions {\n                 None,\n             ),\n         };\n-        CompletionItem::new(completion_kind, ctx.source_range(), local_name)\n-            .kind(kind)\n-            .set_documentation(docs)\n-            .add_to(self)\n+\n+        let mut completion_item =\n+            CompletionItem::new(completion_kind, ctx.source_range(), local_name);\n+        if let Resolution::LocalBinding(pat_id) = def {\n+            let ty = ctx\n+                .analyzer\n+                .type_of_pat_by_id(ctx.db, pat_id.clone())\n+                .filter(|t| t != &Ty::Unknown)\n+                .map(|t| t.display(ctx.db).to_string());\n+            completion_item = completion_item.set_detail(ty);\n+        };\n+        completion_item.kind(kind).set_documentation(docs).add_to(self)\n     }\n \n     pub(crate) fn add_function(&mut self, ctx: &CompletionContext, func: hir::Function) {"}, {"sha": "f94477b438075322ec817b63d69caf0aeec6460e", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__bindings_from_if_let.snap", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3e086528efd950e3051654daf9e62f339ef4a55c/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__bindings_from_if_let.snap", "raw_url": "https://github.com/rust-lang/rust/raw/3e086528efd950e3051654daf9e62f339ef4a55c/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__bindings_from_if_let.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__bindings_from_if_let.snap?ref=3e086528efd950e3051654daf9e62f339ef4a55c", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-05-23T22:23:35.122168608Z\"\n+created: \"2019-07-23T16:11:48.828805910Z\"\n creator: insta@0.8.1\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -18,6 +18,7 @@ expression: kind_completions\n         delete: [214; 214),\n         insert: \"b\",\n         kind: Binding,\n+        detail: \"i32\",\n     },\n     CompletionItem {\n         label: \"quux\","}, {"sha": "590e2a820b00fd27ebb0be31a1052728f24caea8", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__bindings_from_let.snap", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3e086528efd950e3051654daf9e62f339ef4a55c/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__bindings_from_let.snap", "raw_url": "https://github.com/rust-lang/rust/raw/3e086528efd950e3051654daf9e62f339ef4a55c/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__bindings_from_let.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__bindings_from_let.snap?ref=3e086528efd950e3051654daf9e62f339ef4a55c", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-05-23T22:23:35.122797188Z\"\n+created: \"2019-07-23T16:11:48.828811567Z\"\n creator: insta@0.8.1\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -19,12 +19,14 @@ expression: kind_completions\n         delete: [79; 79),\n         insert: \"x\",\n         kind: Binding,\n+        detail: \"i32\",\n     },\n     CompletionItem {\n         label: \"y\",\n         source_range: [79; 79),\n         delete: [79; 79),\n         insert: \"y\",\n         kind: Binding,\n+        detail: \"i32\",\n     },\n ]"}, {"sha": "158a2e5b934133a660b854126fff6f16bd2c9859", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__dont_show_both_completions_for_shadowing.snap", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3e086528efd950e3051654daf9e62f339ef4a55c/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_show_both_completions_for_shadowing.snap", "raw_url": "https://github.com/rust-lang/rust/raw/3e086528efd950e3051654daf9e62f339ef4a55c/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_show_both_completions_for_shadowing.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__dont_show_both_completions_for_shadowing.snap?ref=3e086528efd950e3051654daf9e62f339ef4a55c", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-05-23T22:23:35.142044205Z\"\n+created: \"2019-07-23T16:11:48.860949870Z\"\n creator: insta@0.8.1\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -11,6 +11,7 @@ expression: kind_completions\n         delete: [126; 126),\n         insert: \"bar\",\n         kind: Binding,\n+        detail: \"i32\",\n     },\n     CompletionItem {\n         label: \"foo\","}, {"sha": "b7bcbe864783eb9b10e650d85eee7af5e41d3306", "filename": "crates/ra_ide_api/src/completion/snapshots/completion_item__self_in_methods.snap", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/3e086528efd950e3051654daf9e62f339ef4a55c/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__self_in_methods.snap", "raw_url": "https://github.com/rust-lang/rust/raw/3e086528efd950e3051654daf9e62f339ef4a55c/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__self_in_methods.snap", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide_api%2Fsrc%2Fcompletion%2Fsnapshots%2Fcompletion_item__self_in_methods.snap?ref=3e086528efd950e3051654daf9e62f339ef4a55c", "patch": "@@ -1,5 +1,5 @@\n ---\n-created: \"2019-05-23T22:23:35.141900902Z\"\n+created: \"2019-07-23T16:11:48.859812318Z\"\n creator: insta@0.8.1\n source: crates/ra_ide_api/src/completion/completion_item.rs\n expression: kind_completions\n@@ -18,5 +18,6 @@ expression: kind_completions\n         delete: [25; 25),\n         insert: \"self\",\n         kind: Binding,\n+        detail: \"&{unknown}\",\n     },\n ]"}]}