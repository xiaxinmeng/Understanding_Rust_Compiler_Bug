{"sha": "0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329", "node_id": "C_kwDOAAsO6NoAKDBlMTlmYjkyZTFlYjdmOTFhYTU1NzBiMmFjNzgyYzlhNDJhNmUzMjk", "commit": {"author": {"name": "Yiming Lei", "email": "yiming.lei@futurewei.com", "date": "2022-11-30T20:01:00Z"}, "committer": {"name": "Yiming Lei", "email": "yiming.lei@futurewei.com", "date": "2022-12-02T06:48:52Z"}, "message": "While parsing enum variant, the error message always disappear\nBecause the error message that emit out is from main error of parser\nThe information of enum variant disappears while parsing enum variant with error\nWe only check the syntax of expecting token, i.e, in case #103869\nIt will error it without telling the message that this error is from pasring enum variant.\nPropagate the sub-error from parsing enum variant to the main error of parser by chaining it with map_err\nCheck the sub-error before emitting the main error of parser and attach it.\nFix #103869", "tree": {"sha": "a6e9ba82c5cf00782bba66ac2677e052ff9747c5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a6e9ba82c5cf00782bba66ac2677e052ff9747c5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329", "html_url": "https://github.com/rust-lang/rust/commit/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/comments", "author": null, "committer": null, "parents": [{"sha": "90711a86e5bdd4b0b65d293f0c2c48fd2db761b3", "url": "https://api.github.com/repos/rust-lang/rust/commits/90711a86e5bdd4b0b65d293f0c2c48fd2db761b3", "html_url": "https://github.com/rust-lang/rust/commit/90711a86e5bdd4b0b65d293f0c2c48fd2db761b3"}], "stats": {"total": 40, "additions": 39, "deletions": 1}, "files": [{"sha": "7ce89b5c3597b5aa67ccd70ba206b35931142ff0", "filename": "compiler/rustc_parse/src/parser/item.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs?ref=0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329", "patch": "@@ -1414,7 +1414,10 @@ impl<'a> Parser<'a> {\n \n                 Ok((Some(vr), TrailingToken::MaybeComma))\n             },\n-        )\n+        ).map_err(|mut err|{\n+            err.help(\"enum variants can be `Variant`, `Variant = <integer>`, `Variant(Type, ..., TypeN)` or `Variant { fields: Types }`\");\n+            err\n+        })\n     }\n \n     /// Parses `struct Foo { ... }`."}, {"sha": "bebb012660a16ae140a780bb5da5049761bc0faa", "filename": "compiler/rustc_parse/src/parser/mod.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fmod.rs?ref=0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329", "patch": "@@ -943,6 +943,10 @@ impl<'a> Parser<'a> {\n                                 Err(e) => {\n                                     // Parsing failed, therefore it must be something more serious\n                                     // than just a missing separator.\n+                                    for xx in &e.children {\n+                                        // propagate the help message from sub error 'e' to main error 'expect_err;\n+                                        expect_err.children.push(xx.clone());\n+                                    }\n                                     expect_err.emit();\n \n                                     e.cancel();"}, {"sha": "c42ee9b295e1d365e4f07ff2b76200994470828c", "filename": "src/test/ui/macros/syntax-error-recovery.stderr", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/src%2Ftest%2Fui%2Fmacros%2Fsyntax-error-recovery.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/src%2Ftest%2Fui%2Fmacros%2Fsyntax-error-recovery.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmacros%2Fsyntax-error-recovery.stderr?ref=0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329", "patch": "@@ -7,6 +7,7 @@ LL |                 $token $($inner)? = $value,\n LL | values!(STRING(1) as (String) => cfg(test),);\n    | -------------------------------------------- in this macro invocation\n    |\n+   = help: enum variants can be `Variant`, `Variant = <integer>`, `Variant(Type, ..., TypeN)` or `Variant { fields: Types }`\n    = note: this error originates in the macro `values` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: macro expansion ignores token `(String)` and any following"}, {"sha": "1edca391e8fd01eb9e6b7e877d7ce4f6ab64f2fe", "filename": "src/test/ui/parser/issue-101477-enum.stderr", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/src%2Ftest%2Fui%2Fparser%2Fissue-101477-enum.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/src%2Ftest%2Fui%2Fparser%2Fissue-101477-enum.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-101477-enum.stderr?ref=0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329", "patch": "@@ -3,6 +3,8 @@ error: unexpected `==`\n    |\n LL |     B == 2\n    |       ^^ help: try using `=` instead\n+   |\n+   = help: enum variants can be `Variant`, `Variant = <integer>`, `Variant(Type, ..., TypeN)` or `Variant { fields: Types }`\n \n error: expected item, found `==`\n   --> $DIR/issue-101477-enum.rs:6:7"}, {"sha": "28c442bdd632dd62ebaa7a5ef02f3419fbebda67", "filename": "src/test/ui/parser/issue-103869.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/src%2Ftest%2Fui%2Fparser%2Fissue-103869.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/src%2Ftest%2Fui%2Fparser%2Fissue-103869.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-103869.rs?ref=0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329", "patch": "@@ -0,0 +1,9 @@\n+enum VecOrMap{\n+    vec: Vec<usize>,\n+    //~^ ERROR expected one of `(`, `,`, `=`, `{`, or `}`, found `:`\n+    //~| HELP: enum variants can be `Variant`, `Variant = <integer>`, `Variant(Type, ..., TypeN)` or `Variant { fields: Types }`\n+    //~| ERROR expected item, found `:`\n+    map: HashMap<String,usize>\n+}\n+\n+fn main() {}"}, {"sha": "0b8cd919a9de26a8f654648a36b211df25b6984b", "filename": "src/test/ui/parser/issue-103869.stderr", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/src%2Ftest%2Fui%2Fparser%2Fissue-103869.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/src%2Ftest%2Fui%2Fparser%2Fissue-103869.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fissue-103869.stderr?ref=0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329", "patch": "@@ -0,0 +1,16 @@\n+error: expected one of `(`, `,`, `=`, `{`, or `}`, found `:`\n+  --> $DIR/issue-103869.rs:2:8\n+   |\n+LL |     vec: Vec<usize>,\n+   |        ^ expected one of `(`, `,`, `=`, `{`, or `}`\n+   |\n+   = help: enum variants can be `Variant`, `Variant = <integer>`, `Variant(Type, ..., TypeN)` or `Variant { fields: Types }`\n+\n+error: expected item, found `:`\n+  --> $DIR/issue-103869.rs:2:8\n+   |\n+LL |     vec: Vec<usize>,\n+   |        ^ expected item\n+\n+error: aborting due to 2 previous errors\n+"}, {"sha": "da9e743a0b44ffc73a4f45ef9eb3f2ee0535b63d", "filename": "src/test/ui/parser/macro/issue-37113.stderr", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/src%2Ftest%2Fui%2Fparser%2Fmacro%2Fissue-37113.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/src%2Ftest%2Fui%2Fparser%2Fmacro%2Fissue-37113.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fmacro%2Fissue-37113.stderr?ref=0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329", "patch": "@@ -9,6 +9,7 @@ LL |             $( $t, )*\n LL |     test_macro!(String,);\n    |     -------------------- in this macro invocation\n    |\n+   = help: enum variants can be `Variant`, `Variant = <integer>`, `Variant(Type, ..., TypeN)` or `Variant { fields: Types }`\n    = note: this error originates in the macro `test_macro` (in Nightly builds, run with -Z macro-backtrace for more info)\n \n error: aborting due to previous error"}, {"sha": "7f48f55fec93803d3e89f002ee57963edcfde507", "filename": "src/test/ui/structs/struct-fn-in-definition.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/src%2Ftest%2Fui%2Fstructs%2Fstruct-fn-in-definition.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/src%2Ftest%2Fui%2Fstructs%2Fstruct-fn-in-definition.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstructs%2Fstruct-fn-in-definition.rs?ref=0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329", "patch": "@@ -28,6 +28,7 @@ enum E {\n     //~^ ERROR functions are not allowed in enum definitions\n     //~| HELP unlike in C++, Java, and C#, functions are declared in `impl` blocks\n     //~| HELP see https://doc.rust-lang.org/book/ch05-03-method-syntax.html for more information\n+    //~| HELP enum variants can be `Variant`, `Variant = <integer>`, `Variant(Type, ..., TypeN)` or `Variant { fields: Types }`\n }\n \n fn main() {}"}, {"sha": "439c86ec22b0eb9178e39fd2c5569be225a94a3b", "filename": "src/test/ui/structs/struct-fn-in-definition.stderr", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/src%2Ftest%2Fui%2Fstructs%2Fstruct-fn-in-definition.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329/src%2Ftest%2Fui%2Fstructs%2Fstruct-fn-in-definition.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fstructs%2Fstruct-fn-in-definition.stderr?ref=0e19fb92e1eb7f91aa5570b2ac782c9a42a6e329", "patch": "@@ -33,6 +33,7 @@ LL |     fn foo() {}\n    |\n    = help: unlike in C++, Java, and C#, functions are declared in `impl` blocks\n    = help: see https://doc.rust-lang.org/book/ch05-03-method-syntax.html for more information\n+   = help: enum variants can be `Variant`, `Variant = <integer>`, `Variant(Type, ..., TypeN)` or `Variant { fields: Types }`\n \n error: aborting due to 3 previous errors\n "}]}