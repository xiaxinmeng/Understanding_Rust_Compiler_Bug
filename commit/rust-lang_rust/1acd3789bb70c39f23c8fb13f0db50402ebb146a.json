{"sha": "1acd3789bb70c39f23c8fb13f0db50402ebb146a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFhY2QzNzg5YmI3MGMzOWYyM2M4ZmIxM2YwZGI1MDQwMmViYjE0NmE=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-02-21T14:25:12Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-02-22T19:30:10Z"}, "message": "Provides direct link to the PR when toolstate is changed.\n\nFix rust-lang-nursery/rust-toolstate#1.", "tree": {"sha": "4873534881a8fd9af5ba252b784824cc9e8c0476", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4873534881a8fd9af5ba252b784824cc9e8c0476"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1acd3789bb70c39f23c8fb13f0db50402ebb146a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlqPGkIACgkQ/vbIBR0O\nATx33Q/9GTvS19Rhvedhr1ISuQF6inmdmb4vKYOfqG04J7gjwaAuwzId4xC+d+M6\nzYpJ6TQCrotZSpmdKf515yv2psIg0bPbrz3C9qCGcYfSAt+gXRPJ/eHlwpnQ6iLn\nLm5ZDApPqM7sQXxcukHndrSomR/OCTuDoJaceRY7m8yEsUBxaT3w+UYGXmnlmMcB\nXp8dGz/ghsf3djFeaj+8q0+OiOJB8jBB7dwmuwT7aFxvK0LiW8bUXlaepifgS+17\ngICWDFIMLdLPay0OQp0xgn4wSzxsHV/02K2Z8nUMste6+OLHwZO1FnYV3BKFPkl0\nG3/wcUfBZcAx1HcQIgUWYAwt9DoJedmHbBs3htzaNv+uJRjuEeeANnwF/+FLApMa\njfT/nuHi+kq+M0LtOMKjceB1sT1bVZGMyu11mriO6/YXt8J3ylMRyx1oVIgRbF60\n2yziX44XAhXkAG85wvsZQKz1sXBs4s+sJWwLh4ZvZUKRiwu3AgzVtdPJAZ7UnaD9\nkmgZkdmDDI6qosTS5a1ajM5lagybRPFNuoWIKN9VnNkjhbi5pYn/nPzHrYq3eGOd\n7L/WInaI1toOxOryAcMpt08/KeLmPEY7VD+EWZGROD9CvllkMl3HnY0T3annxV5M\nPjrZN9OvmNyJSNsG59/RDWs9C3FZdiaMmEL4/YMxb9Vc0sqqdZo=\n=nW1Q\n-----END PGP SIGNATURE-----", "payload": "tree 4873534881a8fd9af5ba252b784824cc9e8c0476\nparent b1f8e6fb06d7362eeb2065347a7db94e76b1cb2f\nauthor kennytm <kennytm@gmail.com> 1519223112 +0800\ncommitter kennytm <kennytm@gmail.com> 1519327810 +0800\n\nProvides direct link to the PR when toolstate is changed.\n\nFix rust-lang-nursery/rust-toolstate#1.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1acd3789bb70c39f23c8fb13f0db50402ebb146a", "html_url": "https://github.com/rust-lang/rust/commit/1acd3789bb70c39f23c8fb13f0db50402ebb146a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1acd3789bb70c39f23c8fb13f0db50402ebb146a/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b1f8e6fb06d7362eeb2065347a7db94e76b1cb2f", "url": "https://api.github.com/repos/rust-lang/rust/commits/b1f8e6fb06d7362eeb2065347a7db94e76b1cb2f", "html_url": "https://github.com/rust-lang/rust/commit/b1f8e6fb06d7362eeb2065347a7db94e76b1cb2f"}], "stats": {"total": 33, "additions": 26, "deletions": 7}, "files": [{"sha": "e2dbdb301e286d885598ddec2cddf3d737f2d1d8", "filename": "src/tools/publish_toolstate.py", "status": "modified", "additions": 26, "deletions": 7, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/1acd3789bb70c39f23c8fb13f0db50402ebb146a/src%2Ftools%2Fpublish_toolstate.py", "raw_url": "https://github.com/rust-lang/rust/raw/1acd3789bb70c39f23c8fb13f0db50402ebb146a/src%2Ftools%2Fpublish_toolstate.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fpublish_toolstate.py?ref=1acd3789bb70c39f23c8fb13f0db50402ebb146a", "patch": "@@ -17,6 +17,7 @@\n import copy\n import datetime\n import collections\n+import textwrap\n \n # List of people to ping when the status of a tool changed.\n MAINTAINERS = {\n@@ -38,7 +39,12 @@ def read_current_status(current_commit, path):\n     return {}\n \n \n-def update_latest(current_commit, relevant_pr_number, current_datetime):\n+def update_latest(\n+    current_commit,\n+    relevant_pr_number,\n+    relevant_pr_url,\n+    current_datetime\n+):\n     '''Updates `_data/latest.json` to match build result of the given commit.\n     '''\n     with open('_data/latest.json', 'rb+') as f:\n@@ -50,8 +56,13 @@ def update_latest(current_commit, relevant_pr_number, current_datetime):\n         }\n \n         slug = 'rust-lang/rust'\n-        message = '\ud83d\udce3 Toolstate changed by {}!\\n\\nTested on commit {}@{}.\\n\\n' \\\n-            .format(relevant_pr_number, slug, current_commit)\n+        message = textwrap.dedent('''\\\n+            \ud83d\udce3 Toolstate changed by {}!\n+\n+            Tested on commit {}@{}.\n+            Direct link to PR: <{}>\n+\n+        ''').format(relevant_pr_number, slug, current_commit, relevant_pr_url)\n         anything_changed = False\n         for status in latest:\n             tool = status['tool']\n@@ -90,13 +101,21 @@ def update_latest(current_commit, relevant_pr_number, current_datetime):\n     cur_commit_msg = sys.argv[2]\n     save_message_to_path = sys.argv[3]\n \n-    relevant_pr_match = re.search('#[0-9]+', cur_commit_msg)\n+    relevant_pr_match = re.search('#([0-9]+)', cur_commit_msg)\n     if relevant_pr_match:\n-        relevant_pr_number = 'rust-lang/rust' + relevant_pr_match.group(0)\n+        number = relevant_pr_match.group(1)\n+        relevant_pr_number = 'rust-lang/rust#' + number\n+        relevant_pr_url = 'https://github.com/rust-lang/rust/pull/' + number\n     else:\n         relevant_pr_number = '<unknown PR>'\n-\n-    message = update_latest(cur_commit, relevant_pr_number, cur_datetime)\n+        relevant_pr_url = '<unknown>'\n+\n+    message = update_latest(\n+        cur_commit,\n+        relevant_pr_number,\n+        relevant_pr_url,\n+        cur_datetime\n+    )\n     if message:\n         print(message)\n         with open(save_message_to_path, 'w') as f:"}]}