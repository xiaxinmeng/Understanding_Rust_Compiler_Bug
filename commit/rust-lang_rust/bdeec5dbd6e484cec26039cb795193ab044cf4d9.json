{"sha": "bdeec5dbd6e484cec26039cb795193ab044cf4d9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJkZWVjNWRiZDZlNDg0Y2VjMjYwMzljYjc5NTE5M2FiMDQ0Y2Y0ZDk=", "commit": {"author": {"name": "Yoshitomo Nakanishi", "email": "yurayura.rounin.3@gmail.com", "date": "2021-02-27T12:52:15Z"}, "committer": {"name": "Yoshitomo Nakanishi", "email": "yurayura.rounin.3@gmail.com", "date": "2021-02-27T13:57:29Z"}, "message": "Use TypeckResults::expr_ty instead of TyCtxt::type_of to fix \"Not a type\" ICE", "tree": {"sha": "70bea6f06c2025cddafe38255b820c162055e27c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/70bea6f06c2025cddafe38255b820c162055e27c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bdeec5dbd6e484cec26039cb795193ab044cf4d9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bdeec5dbd6e484cec26039cb795193ab044cf4d9", "html_url": "https://github.com/rust-lang/rust/commit/bdeec5dbd6e484cec26039cb795193ab044cf4d9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bdeec5dbd6e484cec26039cb795193ab044cf4d9/comments", "author": {"login": "Y-Nak", "id": 6376004, "node_id": "MDQ6VXNlcjYzNzYwMDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6376004?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Y-Nak", "html_url": "https://github.com/Y-Nak", "followers_url": "https://api.github.com/users/Y-Nak/followers", "following_url": "https://api.github.com/users/Y-Nak/following{/other_user}", "gists_url": "https://api.github.com/users/Y-Nak/gists{/gist_id}", "starred_url": "https://api.github.com/users/Y-Nak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Y-Nak/subscriptions", "organizations_url": "https://api.github.com/users/Y-Nak/orgs", "repos_url": "https://api.github.com/users/Y-Nak/repos", "events_url": "https://api.github.com/users/Y-Nak/events{/privacy}", "received_events_url": "https://api.github.com/users/Y-Nak/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Y-Nak", "id": 6376004, "node_id": "MDQ6VXNlcjYzNzYwMDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6376004?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Y-Nak", "html_url": "https://github.com/Y-Nak", "followers_url": "https://api.github.com/users/Y-Nak/followers", "following_url": "https://api.github.com/users/Y-Nak/following{/other_user}", "gists_url": "https://api.github.com/users/Y-Nak/gists{/gist_id}", "starred_url": "https://api.github.com/users/Y-Nak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Y-Nak/subscriptions", "organizations_url": "https://api.github.com/users/Y-Nak/orgs", "repos_url": "https://api.github.com/users/Y-Nak/repos", "events_url": "https://api.github.com/users/Y-Nak/events{/privacy}", "received_events_url": "https://api.github.com/users/Y-Nak/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7154b2360114977cd67bb844114cf429fa9cdb88", "url": "https://api.github.com/repos/rust-lang/rust/commits/7154b2360114977cd67bb844114cf429fa9cdb88", "html_url": "https://github.com/rust-lang/rust/commit/7154b2360114977cd67bb844114cf429fa9cdb88"}], "stats": {"total": 28, "additions": 23, "deletions": 5}, "files": [{"sha": "369efacc9bcf47f87aea5360875ba04f40cae2b4", "filename": "clippy_lints/src/default_numeric_fallback.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/bdeec5dbd6e484cec26039cb795193ab044cf4d9/clippy_lints%2Fsrc%2Fdefault_numeric_fallback.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bdeec5dbd6e484cec26039cb795193ab044cf4d9/clippy_lints%2Fsrc%2Fdefault_numeric_fallback.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdefault_numeric_fallback.rs?ref=bdeec5dbd6e484cec26039cb795193ab044cf4d9", "patch": "@@ -130,10 +130,9 @@ impl<'a, 'tcx> Visitor<'tcx> for NumericFallbackVisitor<'a, 'tcx> {\n                 }\n             },\n \n-            ExprKind::Struct(qpath, fields, base) => {\n+            ExprKind::Struct(_, fields, base) => {\n                 if_chain! {\n-                    if let Some(def_id) = self.cx.qpath_res(qpath, expr.hir_id).opt_def_id();\n-                    let ty = self.cx.tcx.type_of(def_id);\n+                    let ty = self.cx.typeck_results().expr_ty(expr);\n                     if let Some(adt_def) = ty.ty_adt_def();\n                     if adt_def.is_struct();\n                     if let Some(variant) = adt_def.variants.iter().next();"}, {"sha": "4f35e13c85a1c7cc771425ffec4422f09b3defb4", "filename": "clippy_lints/src/inconsistent_struct_constructor.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/bdeec5dbd6e484cec26039cb795193ab044cf4d9/clippy_lints%2Fsrc%2Finconsistent_struct_constructor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bdeec5dbd6e484cec26039cb795193ab044cf4d9/clippy_lints%2Fsrc%2Finconsistent_struct_constructor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Finconsistent_struct_constructor.rs?ref=bdeec5dbd6e484cec26039cb795193ab044cf4d9", "patch": "@@ -66,8 +66,7 @@ impl LateLintPass<'_> for InconsistentStructConstructor {\n     fn check_expr(&mut self, cx: &LateContext<'tcx>, expr: &'tcx hir::Expr<'_>) {\n         if_chain! {\n             if let ExprKind::Struct(qpath, fields, base) = expr.kind;\n-            if let Some(def_id)  = cx.qpath_res(qpath, expr.hir_id).opt_def_id();\n-            let ty = cx.tcx.type_of(def_id);\n+            let ty = cx.typeck_results().expr_ty(expr);\n             if let Some(adt_def) = ty.ty_adt_def();\n             if adt_def.is_struct();\n             if let Some(variant) = adt_def.variants.iter().next();"}, {"sha": "0e2ab1a39b82f98c0faefe4187c36f3c52b5a78f", "filename": "tests/ui/crashes/ice-6792.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/bdeec5dbd6e484cec26039cb795193ab044cf4d9/tests%2Fui%2Fcrashes%2Fice-6792.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bdeec5dbd6e484cec26039cb795193ab044cf4d9/tests%2Fui%2Fcrashes%2Fice-6792.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcrashes%2Fice-6792.rs?ref=bdeec5dbd6e484cec26039cb795193ab044cf4d9", "patch": "@@ -0,0 +1,20 @@\n+//! This is a reproducer for the ICE 6792: https://github.com/rust-lang/rust-clippy/issues/6792.\n+//! The ICE is caused by using `TyCtxt::type_of(assoc_type_id)`.\n+\n+trait Trait {\n+    type Ty;\n+\n+    fn broken() -> Self::Ty;\n+}\n+\n+struct Foo {}\n+\n+impl Trait for Foo {\n+    type Ty = Foo;\n+\n+    fn broken() -> Self::Ty {\n+        Self::Ty {}\n+    }\n+}\n+\n+fn main() {}"}]}