{"sha": "76c87a166fa8ca247855ea6c32465d627d1ead14", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc2Yzg3YTE2NmZhOGNhMjQ3ODU1ZWE2YzMyNDY1ZDYyN2QxZWFkMTQ=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-01-22T10:59:09Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-01-22T10:59:09Z"}, "message": "Auto merge of #56221 - estebank:remove-dummy-checks, r=varkor\n\nRemove unnecessary dummy span checks\n\nThe emitter already verifies wether a given span note or span label\ncan be emitted to the output. If it can't, because it is a dummy\nspan, it will be either elided for labels or emitted as an unspanned\nnote/help when applicable.", "tree": {"sha": "cbbcf9fa8edab3408c29fa3d816c7e397cca9269", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cbbcf9fa8edab3408c29fa3d816c7e397cca9269"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/76c87a166fa8ca247855ea6c32465d627d1ead14", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/76c87a166fa8ca247855ea6c32465d627d1ead14", "html_url": "https://github.com/rust-lang/rust/commit/76c87a166fa8ca247855ea6c32465d627d1ead14", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/76c87a166fa8ca247855ea6c32465d627d1ead14/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "70015373b4980fbfa10130de4b0ce041f5b5da8b", "url": "https://api.github.com/repos/rust-lang/rust/commits/70015373b4980fbfa10130de4b0ce041f5b5da8b", "html_url": "https://github.com/rust-lang/rust/commit/70015373b4980fbfa10130de4b0ce041f5b5da8b"}, {"sha": "f077990ed4e7fadd0197d00d65a198e02544ab07", "url": "https://api.github.com/repos/rust-lang/rust/commits/f077990ed4e7fadd0197d00d65a198e02544ab07", "html_url": "https://github.com/rust-lang/rust/commit/f077990ed4e7fadd0197d00d65a198e02544ab07"}], "stats": {"total": 42, "additions": 24, "deletions": 18}, "files": [{"sha": "25d09a33c154fad930b780a341540568bbb3ea97", "filename": "src/librustc_errors/emitter.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/76c87a166fa8ca247855ea6c32465d627d1ead14/src%2Flibrustc_errors%2Femitter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/76c87a166fa8ca247855ea6c32465d627d1ead14/src%2Flibrustc_errors%2Femitter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_errors%2Femitter.rs?ref=76c87a166fa8ca247855ea6c32465d627d1ead14", "patch": "@@ -959,7 +959,7 @@ impl EmitterWriter {\n             Style::MainHeaderMsg\n         };\n \n-        if msp.primary_spans().is_empty() && msp.span_labels().is_empty() && is_secondary\n+        if !msp.has_primary_spans() && !msp.has_span_labels() && is_secondary\n            && !self.short_message {\n             // This is a secondary message with no span info\n             for _ in 0..max_line_num_len {"}, {"sha": "4c9347afa611d442d27a1f49e69e847bce421c64", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 5, "deletions": 9, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/76c87a166fa8ca247855ea6c32465d627d1ead14/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/76c87a166fa8ca247855ea6c32465d627d1ead14/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=76c87a166fa8ca247855ea6c32465d627d1ead14", "patch": "@@ -5013,11 +5013,7 @@ impl<'a> Resolver<'a> {\n                 ))\n             }\n \n-            if b.span.is_dummy() {\n-                err.note(&note_msg);\n-            } else {\n-                err.span_note(b.span, &note_msg);\n-            }\n+            err.span_note(b.span, &note_msg);\n             for (i, help_msg) in help_msgs.iter().enumerate() {\n                 let or = if i == 0 { \"\" } else { \"or \" };\n                 err.help(&format!(\"{}{}\", or, help_msg));\n@@ -5132,10 +5128,10 @@ impl<'a> Resolver<'a> {\n                           container));\n \n         err.span_label(span, format!(\"`{}` re{} here\", name, new_participle));\n-        if !old_binding.span.is_dummy() {\n-            err.span_label(self.session.source_map().def_span(old_binding.span),\n-                           format!(\"previous {} of the {} `{}` here\", old_noun, old_kind, name));\n-        }\n+        err.span_label(\n+            self.session.source_map().def_span(old_binding.span),\n+            format!(\"previous {} of the {} `{}` here\", old_noun, old_kind, name),\n+        );\n \n         // See https://github.com/rust-lang/rust/issues/32354\n         if old_binding.is_import() || new_binding.is_import() {"}, {"sha": "d9d7f9b0cb4926fcfb9a392cbb6b177b99816538", "filename": "src/libsyntax_pos/lib.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/76c87a166fa8ca247855ea6c32465d627d1ead14/src%2Flibsyntax_pos%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/76c87a166fa8ca247855ea6c32465d627d1ead14/src%2Flibsyntax_pos%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_pos%2Flib.rs?ref=76c87a166fa8ca247855ea6c32465d627d1ead14", "patch": "@@ -668,6 +668,11 @@ impl MultiSpan {\n         &self.primary_spans\n     }\n \n+    /// Returns whether any of the primary spans is displayable.\n+    pub fn has_primary_spans(&self) -> bool {\n+        self.primary_spans.iter().any(|sp| !sp.is_dummy())\n+    }\n+\n     /// Returns `true` if this contains only a dummy primary span with any hygienic context.\n     pub fn is_dummy(&self) -> bool {\n         let mut is_dummy = true;\n@@ -726,6 +731,11 @@ impl MultiSpan {\n \n         span_labels\n     }\n+\n+    /// Returns whether any of the span labels is displayable.\n+    pub fn has_span_labels(&self) -> bool {\n+        self.span_labels.iter().any(|(sp, _)| !sp.is_dummy())\n+    }\n }\n \n impl From<Span> for MultiSpan {"}, {"sha": "8f8eb38e938737bb0faa23514ff476a77f4ff57c", "filename": "src/test/ui/consts/const-size_of-cycle.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/76c87a166fa8ca247855ea6c32465d627d1ead14/src%2Ftest%2Fui%2Fconsts%2Fconst-size_of-cycle.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/76c87a166fa8ca247855ea6c32465d627d1ead14/src%2Ftest%2Fui%2Fconsts%2Fconst-size_of-cycle.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-size_of-cycle.stderr?ref=76c87a166fa8ca247855ea6c32465d627d1ead14", "patch": "@@ -9,8 +9,8 @@ note: ...which requires const-evaluating `Foo::bytes::{{constant}}`...\n    |\n LL |     intrinsics::size_of::<T>()\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^\n-note: ...which requires computing layout of `Foo`...\n-note: ...which requires normalizing `ParamEnvAnd { param_env: ParamEnv { caller_bounds: [], reveal: All, def_id: None }, value: [u8; _] }`...\n+   = note: ...which requires computing layout of `Foo`...\n+   = note: ...which requires normalizing `ParamEnvAnd { param_env: ParamEnv { caller_bounds: [], reveal: All, def_id: None }, value: [u8; _] }`...\n note: ...which requires const-evaluating + checking `Foo::bytes::{{constant}}`...\n   --> $DIR/const-size_of-cycle.rs:6:17\n    |"}, {"sha": "b936fed85f48efbf8753a567c214f94943fd06b9", "filename": "src/test/ui/impl-trait/auto-trait-leak.stderr", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/76c87a166fa8ca247855ea6c32465d627d1ead14/src%2Ftest%2Fui%2Fimpl-trait%2Fauto-trait-leak.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/76c87a166fa8ca247855ea6c32465d627d1ead14/src%2Ftest%2Fui%2Fimpl-trait%2Fauto-trait-leak.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fauto-trait-leak.stderr?ref=76c87a166fa8ca247855ea6c32465d627d1ead14", "patch": "@@ -9,7 +9,7 @@ note: ...which requires processing `cycle1`...\n    |\n LL | fn cycle1() -> impl Clone {\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^\n-note: ...which requires evaluating trait selection obligation `impl std::clone::Clone: std::marker::Send`...\n+   = note: ...which requires evaluating trait selection obligation `impl std::clone::Clone: std::marker::Send`...\n note: ...which requires processing `cycle2::{{impl-Trait}}`...\n   --> $DIR/auto-trait-leak.rs:23:16\n    |\n@@ -20,7 +20,7 @@ note: ...which requires processing `cycle2`...\n    |\n LL | fn cycle2() -> impl Clone {\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^\n-note: ...which requires evaluating trait selection obligation `impl std::clone::Clone: std::marker::Send`...\n+   = note: ...which requires evaluating trait selection obligation `impl std::clone::Clone: std::marker::Send`...\n    = note: ...which again requires processing `cycle1::{{impl-Trait}}`, completing the cycle\n note: cycle used when checking item types in top-level module\n   --> $DIR/auto-trait-leak.rs:3:1\n@@ -45,7 +45,7 @@ note: ...which requires processing `cycle1`...\n    |\n LL | fn cycle1() -> impl Clone {\n    | ^^^^^^^^^^^^^^^^^^^^^^^^^\n-note: ...which requires evaluating trait selection obligation `impl std::clone::Clone: std::marker::Send`...\n+   = note: ...which requires evaluating trait selection obligation `impl std::clone::Clone: std::marker::Send`...\n note: ...which requires processing `cycle2::{{impl-Trait}}`...\n   --> $DIR/auto-trait-leak.rs:23:16\n    |"}, {"sha": "ff197eeeb0fe92429eba624a897ac1db2afe53b0", "filename": "src/test/ui/issues/issue-26548.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/76c87a166fa8ca247855ea6c32465d627d1ead14/src%2Ftest%2Fui%2Fissues%2Fissue-26548.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/76c87a166fa8ca247855ea6c32465d627d1ead14/src%2Ftest%2Fui%2Fissues%2Fissue-26548.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-26548.stderr?ref=76c87a166fa8ca247855ea6c32465d627d1ead14", "patch": "@@ -1,6 +1,6 @@\n error[E0391]: cycle detected when computing layout of `std::option::Option<S>`\n    |\n-note: ...which requires computing layout of `S`...\n+   = note: ...which requires computing layout of `S`...\n    = note: ...which again requires computing layout of `std::option::Option<S>`, completing the cycle\n note: cycle used when processing `main`\n   --> $DIR/issue-26548.rs:9:1"}, {"sha": "3f377fd27e7db29296083134fea603ff9e06c222", "filename": "src/test/ui/issues/issue-44415.stderr", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/76c87a166fa8ca247855ea6c32465d627d1ead14/src%2Ftest%2Fui%2Fissues%2Fissue-44415.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/76c87a166fa8ca247855ea6c32465d627d1ead14/src%2Ftest%2Fui%2Fissues%2Fissue-44415.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-44415.stderr?ref=76c87a166fa8ca247855ea6c32465d627d1ead14", "patch": "@@ -9,8 +9,8 @@ note: ...which requires const-evaluating `Foo::bytes::{{constant}}`...\n    |\n LL |     bytes: [u8; unsafe { intrinsics::size_of::<Foo>() }],\n    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-note: ...which requires computing layout of `Foo`...\n-note: ...which requires normalizing `ParamEnvAnd { param_env: ParamEnv { caller_bounds: [], reveal: All, def_id: None }, value: [u8; _] }`...\n+   = note: ...which requires computing layout of `Foo`...\n+   = note: ...which requires normalizing `ParamEnvAnd { param_env: ParamEnv { caller_bounds: [], reveal: All, def_id: None }, value: [u8; _] }`...\n note: ...which requires const-evaluating + checking `Foo::bytes::{{constant}}`...\n   --> $DIR/issue-44415.rs:6:17\n    |"}]}