{"sha": "de4a8460275bedf616bd51a0167216e2339f5b67", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRlNGE4NDYwMjc1YmVkZjYxNmJkNTFhMDE2NzIxNmUyMzM5ZjViNjc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-10-05T15:23:35Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-10-05T15:23:35Z"}, "message": "Auto merge of #979 - nico-abram:patch-1, r=oli-obk\n\nAdd missing atomic_fence intrinsics as nops\n\nFixes #972", "tree": {"sha": "79efd738d465d84f0010c5452c620b20444aa350", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/79efd738d465d84f0010c5452c620b20444aa350"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/de4a8460275bedf616bd51a0167216e2339f5b67", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/de4a8460275bedf616bd51a0167216e2339f5b67", "html_url": "https://github.com/rust-lang/rust/commit/de4a8460275bedf616bd51a0167216e2339f5b67", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/de4a8460275bedf616bd51a0167216e2339f5b67/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b0de1e9b9521fe86c94dabd6e21c8dface68379d", "url": "https://api.github.com/repos/rust-lang/rust/commits/b0de1e9b9521fe86c94dabd6e21c8dface68379d", "html_url": "https://github.com/rust-lang/rust/commit/b0de1e9b9521fe86c94dabd6e21c8dface68379d"}, {"sha": "bd4a2996d1ac30e49adfcb241cb8a436730c35ac", "url": "https://api.github.com/repos/rust-lang/rust/commits/bd4a2996d1ac30e49adfcb241cb8a436730c35ac", "html_url": "https://github.com/rust-lang/rust/commit/bd4a2996d1ac30e49adfcb241cb8a436730c35ac"}], "stats": {"total": 19, "additions": 16, "deletions": 3}, "files": [{"sha": "875a344363a017ad01c93c4a07d778f3ec80e9b7", "filename": "src/shims/intrinsics.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/de4a8460275bedf616bd51a0167216e2339f5b67/src%2Fshims%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de4a8460275bedf616bd51a0167216e2339f5b67/src%2Fshims%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fshims%2Fintrinsics.rs?ref=de4a8460275bedf616bd51a0167216e2339f5b67", "patch": "@@ -88,7 +88,10 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n                 this.write_scalar(val, place.into())?;\n             }\n \n-            \"atomic_fence_acq\" => {\n+            \"atomic_fence_acq\" |\n+            \"atomic_fence_rel\" |\n+            \"atomic_fence_acqrel\" |\n+            \"atomic_fence\" => {\n                 // we are inherently singlethreaded and singlecored, this is a nop\n             }\n "}, {"sha": "5872a496dbfa4bb1de2b0718f13f41f2d36d45f0", "filename": "tests/run-pass/atomic.rs", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/de4a8460275bedf616bd51a0167216e2339f5b67/tests%2Frun-pass%2Fatomic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/de4a8460275bedf616bd51a0167216e2339f5b67/tests%2Frun-pass%2Fatomic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Fatomic.rs?ref=de4a8460275bedf616bd51a0167216e2339f5b67", "patch": "@@ -1,9 +1,10 @@\n-use std::sync::atomic::{AtomicBool, AtomicIsize, AtomicU64, Ordering::*};\n+use std::sync::atomic::{fence, AtomicBool, AtomicIsize, AtomicU64, Ordering::*};\n \n fn main() {\n     atomic_bool();\n     atomic_isize();\n     atomic_u64();\n+    atomic_fences();\n }\n \n fn atomic_bool() {\n@@ -57,6 +58,15 @@ fn atomic_u64() {\n \n     ATOMIC.store(1, SeqCst);\n     assert_eq!(ATOMIC.compare_exchange(0, 0x100, AcqRel, Acquire), Err(1));\n-    assert_eq!(ATOMIC.compare_exchange_weak(1, 0x100, AcqRel, Acquire), Ok(1));\n+    assert_eq!(\n+        ATOMIC.compare_exchange_weak(1, 0x100, AcqRel, Acquire),\n+        Ok(1)\n+    );\n     assert_eq!(ATOMIC.load(Relaxed), 0x100);\n }\n+\n+fn atomic_fences() {\n+    fence(SeqCst);\n+    fence(Release);\n+    fence(Acquire);\n+}"}]}