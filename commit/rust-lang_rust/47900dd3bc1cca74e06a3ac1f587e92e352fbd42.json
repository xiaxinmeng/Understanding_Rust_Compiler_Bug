{"sha": "47900dd3bc1cca74e06a3ac1f587e92e352fbd42", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ3OTAwZGQzYmMxY2NhNzRlMDZhM2FjMWY1ODdlOTJlMzUyZmJkNDI=", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-01-01T23:05:51Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2021-01-04T11:24:47Z"}, "message": "Impl hovering for TypeParams", "tree": {"sha": "61bbf0f03da85b42229a103203d5840fbbba3048", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/61bbf0f03da85b42229a103203d5840fbbba3048"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/47900dd3bc1cca74e06a3ac1f587e92e352fbd42", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/47900dd3bc1cca74e06a3ac1f587e92e352fbd42", "html_url": "https://github.com/rust-lang/rust/commit/47900dd3bc1cca74e06a3ac1f587e92e352fbd42", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/47900dd3bc1cca74e06a3ac1f587e92e352fbd42/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5b86ff3e91838e58397ec39502d85056e46fcfcb", "url": "https://api.github.com/repos/rust-lang/rust/commits/5b86ff3e91838e58397ec39502d85056e46fcfcb", "html_url": "https://github.com/rust-lang/rust/commit/5b86ff3e91838e58397ec39502d85056e46fcfcb"}], "stats": {"total": 74, "additions": 67, "deletions": 7}, "files": [{"sha": "a2255508e368342df707ba69eef68997bc25c80b", "filename": "crates/hir/src/code_model.rs", "status": "modified", "additions": 16, "deletions": 4, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/47900dd3bc1cca74e06a3ac1f587e92e352fbd42/crates%2Fhir%2Fsrc%2Fcode_model.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47900dd3bc1cca74e06a3ac1f587e92e352fbd42/crates%2Fhir%2Fsrc%2Fcode_model.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Fcode_model.rs?ref=47900dd3bc1cca74e06a3ac1f587e92e352fbd42", "patch": "@@ -5,9 +5,7 @@ use arrayvec::ArrayVec;\n use base_db::{CrateDisplayName, CrateId, Edition, FileId};\n use either::Either;\n use hir_def::{\n-    adt::ReprKind,\n-    adt::StructKind,\n-    adt::VariantData,\n+    adt::{ReprKind, StructKind, VariantData},\n     builtin_type::BuiltinType,\n     expr::{BindingAnnotation, LabelId, Pat, PatId},\n     import_map,\n@@ -31,7 +29,7 @@ use hir_expand::{\n };\n use hir_ty::{\n     autoderef,\n-    display::{HirDisplayError, HirFormatter},\n+    display::{write_bounds_like_dyn_trait, HirDisplayError, HirFormatter},\n     method_resolution,\n     traits::{FnTrait, Solution, SolutionVariables},\n     ApplicationTy, BoundVar, CallableDefId, Canonical, DebruijnIndex, FnSig, GenericPredicate,\n@@ -1293,6 +1291,20 @@ impl TypeParam {\n     }\n }\n \n+impl HirDisplay for TypeParam {\n+    fn hir_fmt(&self, f: &mut HirFormatter) -> Result<(), HirDisplayError> {\n+        write!(f, \"{}\", self.name(f.db))?;\n+        let bounds = f.db.generic_predicates_for_param(self.id);\n+        let substs = Substs::type_params(f.db, self.id.parent);\n+        let predicates = bounds.iter().cloned().map(|b| b.subst(&substs)).collect::<Vec<_>>();\n+        if !(predicates.is_empty() || f.omit_verbose_types()) {\n+            write!(f, \": \")?;\n+            write_bounds_like_dyn_trait(&predicates, f)?;\n+        }\n+        Ok(())\n+    }\n+}\n+\n #[derive(Clone, Copy, Debug, PartialEq, Eq, Hash)]\n pub struct LifetimeParam {\n     pub(crate) id: LifetimeParamId,"}, {"sha": "a54225c18ba61b32579126a5634bb1fde58bc801", "filename": "crates/hir_ty/src/display.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/47900dd3bc1cca74e06a3ac1f587e92e352fbd42/crates%2Fhir_ty%2Fsrc%2Fdisplay.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47900dd3bc1cca74e06a3ac1f587e92e352fbd42/crates%2Fhir_ty%2Fsrc%2Fdisplay.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_ty%2Fsrc%2Fdisplay.rs?ref=47900dd3bc1cca74e06a3ac1f587e92e352fbd42", "patch": "@@ -595,7 +595,7 @@ impl HirDisplay for FnSig {\n     }\n }\n \n-fn write_bounds_like_dyn_trait(\n+pub fn write_bounds_like_dyn_trait(\n     predicates: &[GenericPredicate],\n     f: &mut HirFormatter,\n ) -> Result<(), HirDisplayError> {"}, {"sha": "61439ae534179339374fc21b4821e1b4602b3629", "filename": "crates/ide/src/hover.rs", "status": "modified", "additions": 50, "deletions": 2, "changes": 52, "blob_url": "https://github.com/rust-lang/rust/blob/47900dd3bc1cca74e06a3ac1f587e92e352fbd42/crates%2Fide%2Fsrc%2Fhover.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47900dd3bc1cca74e06a3ac1f587e92e352fbd42/crates%2Fide%2Fsrc%2Fhover.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Fhover.rs?ref=47900dd3bc1cca74e06a3ac1f587e92e352fbd42", "patch": "@@ -370,8 +370,9 @@ fn hover_for_definition(db: &RootDatabase, def: Definition) -> Option<Markup> {\n         }\n         Definition::Label(it) => Some(Markup::fenced_block(&it.name(db))),\n         Definition::LifetimeParam(it) => Some(Markup::fenced_block(&it.name(db))),\n-        Definition::TypeParam(_) | Definition::ConstParam(_) => {\n-            // FIXME: Hover for generic param\n+        Definition::TypeParam(type_param) => Some(Markup::fenced_block(&type_param.display(db))),\n+        Definition::ConstParam(_) => {\n+            // FIXME: Hover for generic const param\n             None\n         }\n     };\n@@ -3257,4 +3258,51 @@ fn foo() {\n             \"#]],\n         );\n     }\n+\n+    #[test]\n+    fn hover_type_param() {\n+        check(\n+            r#\"\n+struct Foo<T>(T);\n+trait Copy {}\n+trait Clone {}\n+trait Sized {}\n+impl<T: Copy + Clone> Foo<T<|>> where T: Sized {}\n+\"#,\n+            expect![[r#\"\n+                *T*\n+\n+                ```rust\n+                T: Copy + Clone + Sized\n+                ```\n+            \"#]],\n+        );\n+        check(\n+            r#\"\n+struct Foo<T>(T);\n+impl<T> Foo<T<|>> {}\n+\"#,\n+            expect![[r#\"\n+                *T*\n+\n+                ```rust\n+                T\n+                ```\n+                \"#]],\n+        );\n+        // lifetimes aren't being substituted yet\n+        check(\n+            r#\"\n+struct Foo<T>(T);\n+impl<T: 'static> Foo<T<|>> {}\n+\"#,\n+            expect![[r#\"\n+                *T*\n+\n+                ```rust\n+                T: {error}\n+                ```\n+                \"#]],\n+        );\n+    }\n }"}]}