{"sha": "71c1e873907be8b50a54bce1be01fb5308ccbc0d", "node_id": "C_kwDOAAsO6NoAKDcxYzFlODczOTA3YmU4YjUwYTU0YmNlMWJlMDFmYjUzMDhjY2JjMGQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-03-30T22:09:56Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-03-30T22:09:56Z"}, "message": "Auto merge of #95436 - cjgillot:static-mut, r=oli-obk\n\nRemember mutability in `DefKind::Static`.\n\nThis allows to compute the `BodyOwnerKind` from `DefKind` only, and\nremoves a direct dependency of some MIR queries onto HIR.\n\nAs a side effect, it also simplifies metadata, since we don't need 4\nflavours of `EntryKind::*Static` any more.", "tree": {"sha": "3e97f0888ba0774e14283893d3cff8187a2b29ee", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3e97f0888ba0774e14283893d3cff8187a2b29ee"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/71c1e873907be8b50a54bce1be01fb5308ccbc0d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/71c1e873907be8b50a54bce1be01fb5308ccbc0d", "html_url": "https://github.com/rust-lang/rust/commit/71c1e873907be8b50a54bce1be01fb5308ccbc0d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/71c1e873907be8b50a54bce1be01fb5308ccbc0d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "104ba478f202c895545b3023919b346ba84d55a1", "url": "https://api.github.com/repos/rust-lang/rust/commits/104ba478f202c895545b3023919b346ba84d55a1", "html_url": "https://github.com/rust-lang/rust/commit/104ba478f202c895545b3023919b346ba84d55a1"}, {"sha": "e01897edcbcf89952b1823125c199a4ce8ec628d", "url": "https://api.github.com/repos/rust-lang/rust/commits/e01897edcbcf89952b1823125c199a4ce8ec628d", "html_url": "https://github.com/rust-lang/rust/commit/e01897edcbcf89952b1823125c199a4ce8ec628d"}], "stats": {"total": 20, "additions": 13, "deletions": 7}, "files": [{"sha": "c5948707c812448d88a8ec9c45eb7c97c31f4bb3", "filename": "clippy_lints/src/arithmetic.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/71c1e873907be8b50a54bce1be01fb5308ccbc0d/clippy_lints%2Fsrc%2Farithmetic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/71c1e873907be8b50a54bce1be01fb5308ccbc0d/clippy_lints%2Fsrc%2Farithmetic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Farithmetic.rs?ref=71c1e873907be8b50a54bce1be01fb5308ccbc0d", "patch": "@@ -139,11 +139,11 @@ impl<'tcx> LateLintPass<'tcx> for Arithmetic {\n     }\n \n     fn check_body(&mut self, cx: &LateContext<'_>, body: &hir::Body<'_>) {\n-        let body_owner = cx.tcx.hir().body_owner(body.id());\n+        let body_owner = cx.tcx.hir().body_owner_def_id(body.id());\n \n         match cx.tcx.hir().body_owner_kind(body_owner) {\n             hir::BodyOwnerKind::Static(_) | hir::BodyOwnerKind::Const => {\n-                let body_span = cx.tcx.hir().span(body_owner);\n+                let body_span = cx.tcx.def_span(body_owner);\n \n                 if let Some(span) = self.const_span {\n                     if span.contains(body_span) {"}, {"sha": "72e86804ed2c3b4136a534d024ae6d7d59283b8a", "filename": "clippy_lints/src/loops/needless_range_loop.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/71c1e873907be8b50a54bce1be01fb5308ccbc0d/clippy_lints%2Fsrc%2Floops%2Fneedless_range_loop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/71c1e873907be8b50a54bce1be01fb5308ccbc0d/clippy_lints%2Fsrc%2Floops%2Fneedless_range_loop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops%2Fneedless_range_loop.rs?ref=71c1e873907be8b50a54bce1be01fb5308ccbc0d", "patch": "@@ -273,7 +273,7 @@ impl<'a, 'tcx> VarVisitor<'a, 'tcx> {\n                         }\n                         return false;  // no need to walk further *on the variable*\n                     }\n-                    Res::Def(DefKind::Static | DefKind::Const, ..) => {\n+                    Res::Def(DefKind::Static (_)| DefKind::Const, ..) => {\n                         if index_used_directly {\n                             self.indexed_directly.insert(\n                                 seqvar.segments[0].ident.name,"}, {"sha": "a63422d2a36ac530c14b75843a7bd38905c58774", "filename": "clippy_lints/src/loops/while_immutable_condition.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/71c1e873907be8b50a54bce1be01fb5308ccbc0d/clippy_lints%2Fsrc%2Floops%2Fwhile_immutable_condition.rs", "raw_url": "https://github.com/rust-lang/rust/raw/71c1e873907be8b50a54bce1be01fb5308ccbc0d/clippy_lints%2Fsrc%2Floops%2Fwhile_immutable_condition.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Floops%2Fwhile_immutable_condition.rs?ref=71c1e873907be8b50a54bce1be01fb5308ccbc0d", "patch": "@@ -104,7 +104,7 @@ impl<'a, 'tcx> VarCollectorVisitor<'a, 'tcx> {\n                     Res::Local(hir_id) => {\n                         self.ids.insert(hir_id);\n                     },\n-                    Res::Def(DefKind::Static, def_id) => {\n+                    Res::Def(DefKind::Static(_), def_id) => {\n                         let mutable = self.cx.tcx.is_mutable_static(def_id);\n                         self.def_ids.insert(def_id, mutable);\n                     },"}, {"sha": "6f2307d8f18ff1505acd84603ff2003c3f0e1feb", "filename": "clippy_lints/src/methods/expect_fun_call.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/71c1e873907be8b50a54bce1be01fb5308ccbc0d/clippy_lints%2Fsrc%2Fmethods%2Fexpect_fun_call.rs", "raw_url": "https://github.com/rust-lang/rust/raw/71c1e873907be8b50a54bce1be01fb5308ccbc0d/clippy_lints%2Fsrc%2Fmethods%2Fexpect_fun_call.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmethods%2Fexpect_fun_call.rs?ref=71c1e873907be8b50a54bce1be01fb5308ccbc0d", "patch": "@@ -93,7 +93,7 @@ pub(super) fn check<'tcx>(\n             },\n             hir::ExprKind::Path(ref p) => matches!(\n                 cx.qpath_res(p, arg.hir_id),\n-                hir::def::Res::Def(hir::def::DefKind::Const | hir::def::DefKind::Static, _)\n+                hir::def::Res::Def(hir::def::DefKind::Const | hir::def::DefKind::Static(_), _)\n             ),\n             _ => false,\n         }"}, {"sha": "1188258504461d8e15d9c43219c557946388af7d", "filename": "clippy_lints/src/shadow.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/71c1e873907be8b50a54bce1be01fb5308ccbc0d/clippy_lints%2Fsrc%2Fshadow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/71c1e873907be8b50a54bce1be01fb5308ccbc0d/clippy_lints%2Fsrc%2Fshadow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fshadow.rs?ref=71c1e873907be8b50a54bce1be01fb5308ccbc0d", "patch": "@@ -139,14 +139,20 @@ impl<'tcx> LateLintPass<'tcx> for Shadow {\n \n     fn check_body(&mut self, cx: &LateContext<'_>, body: &Body<'_>) {\n         let hir = cx.tcx.hir();\n-        if !matches!(hir.body_owner_kind(hir.body_owner(body.id())), BodyOwnerKind::Closure) {\n+        if !matches!(\n+            hir.body_owner_kind(hir.body_owner_def_id(body.id())),\n+            BodyOwnerKind::Closure\n+        ) {\n             self.bindings.push(FxHashMap::default());\n         }\n     }\n \n     fn check_body_post(&mut self, cx: &LateContext<'_>, body: &Body<'_>) {\n         let hir = cx.tcx.hir();\n-        if !matches!(hir.body_owner_kind(hir.body_owner(body.id())), BodyOwnerKind::Closure) {\n+        if !matches!(\n+            hir.body_owner_kind(hir.body_owner_def_id(body.id())),\n+            BodyOwnerKind::Closure\n+        ) {\n             self.bindings.pop();\n         }\n     }"}]}