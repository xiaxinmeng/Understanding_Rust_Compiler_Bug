{"sha": "c7f4154c6a839d31abcbb74be4c9b2404ae3a2ec", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM3ZjQxNTRjNmE4MzlkMzFhYmNiYjc0YmU0YzliMjQwNGFlM2EyZWM=", "commit": {"author": {"name": "Miguel Ojeda", "email": "ojeda@kernel.org", "date": "2021-01-29T19:09:07Z"}, "committer": {"name": "Miguel Ojeda", "email": "ojeda@kernel.org", "date": "2021-01-29T19:25:23Z"}, "message": "sys: use `process::abort()` instead of `arch::wasm32::unreachable()`\n\nRationale:\n\n  - `abort()` lowers to `wasm32::unreachable()` anyway.\n  - `abort()` isn't `unsafe`.\n  - `abort()` matches the comment better.\n  - `abort()` avoids confusion by future readers (e.g.\n    https://github.com/rust-lang/rust/pull/81527): the naming of wasm's\n    `unreachable' instruction is a bit unfortunate because it is not\n    related to the `unreachable()` intrinsic (intended to trigger UB).\n\nCodegen is likely to be different since `unreachable()` is `inline`\nwhile `abort()` is `cold`. Since it doesn't look like we are expecting\nhere to trigger this case, the latter seems better anyway.\n\nSigned-off-by: Miguel Ojeda <ojeda@kernel.org>", "tree": {"sha": "696e9f0405ec5be8897c12f6e3b1f2ef522630d6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/696e9f0405ec5be8897c12f6e3b1f2ef522630d6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c7f4154c6a839d31abcbb74be4c9b2404ae3a2ec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c7f4154c6a839d31abcbb74be4c9b2404ae3a2ec", "html_url": "https://github.com/rust-lang/rust/commit/c7f4154c6a839d31abcbb74be4c9b2404ae3a2ec", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c7f4154c6a839d31abcbb74be4c9b2404ae3a2ec/comments", "author": {"login": "ojeda", "id": 1054456, "node_id": "MDQ6VXNlcjEwNTQ0NTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1054456?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ojeda", "html_url": "https://github.com/ojeda", "followers_url": "https://api.github.com/users/ojeda/followers", "following_url": "https://api.github.com/users/ojeda/following{/other_user}", "gists_url": "https://api.github.com/users/ojeda/gists{/gist_id}", "starred_url": "https://api.github.com/users/ojeda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ojeda/subscriptions", "organizations_url": "https://api.github.com/users/ojeda/orgs", "repos_url": "https://api.github.com/users/ojeda/repos", "events_url": "https://api.github.com/users/ojeda/events{/privacy}", "received_events_url": "https://api.github.com/users/ojeda/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ojeda", "id": 1054456, "node_id": "MDQ6VXNlcjEwNTQ0NTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1054456?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ojeda", "html_url": "https://github.com/ojeda", "followers_url": "https://api.github.com/users/ojeda/followers", "following_url": "https://api.github.com/users/ojeda/following{/other_user}", "gists_url": "https://api.github.com/users/ojeda/gists{/gist_id}", "starred_url": "https://api.github.com/users/ojeda/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ojeda/subscriptions", "organizations_url": "https://api.github.com/users/ojeda/orgs", "repos_url": "https://api.github.com/users/ojeda/repos", "events_url": "https://api.github.com/users/ojeda/events{/privacy}", "received_events_url": "https://api.github.com/users/ojeda/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c4e33b51c1a2d5e599b949fa3006467b88df253a", "url": "https://api.github.com/repos/rust-lang/rust/commits/c4e33b51c1a2d5e599b949fa3006467b88df253a", "html_url": "https://github.com/rust-lang/rust/commit/c4e33b51c1a2d5e599b949fa3006467b88df253a"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "5eafb77da1dcdc5883b27b079cf81c8c1f911e61", "filename": "library/std/src/sys/wasm/thread.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c7f4154c6a839d31abcbb74be4c9b2404ae3a2ec/library%2Fstd%2Fsrc%2Fsys%2Fwasm%2Fthread.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c7f4154c6a839d31abcbb74be4c9b2404ae3a2ec/library%2Fstd%2Fsrc%2Fsys%2Fwasm%2Fthread.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwasm%2Fthread.rs?ref=c7f4154c6a839d31abcbb74be4c9b2404ae3a2ec", "patch": "@@ -86,7 +86,7 @@ pub fn my_id() -> u32 {\n         if MY_ID == 0 {\n             let mut cur = NEXT_ID.load(SeqCst);\n             MY_ID = loop {\n-                let next = cur.checked_add(1).unwrap_or_else(|| crate::arch::wasm32::unreachable());\n+                let next = cur.checked_add(1).unwrap_or_else(|| crate::process::abort());\n                 match NEXT_ID.compare_exchange(cur, next, SeqCst, SeqCst) {\n                     Ok(_) => break next,\n                     Err(i) => cur = i,"}]}