{"sha": "bd77fbfef1d7be3fd8d8db137b800476199fa11b", "node_id": "C_kwDOAAsO6NoAKGJkNzdmYmZlZjFkN2JlM2ZkOGQ4ZGIxMzdiODAwNDc2MTk5ZmExMWI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-12-27T20:42:25Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-12-27T20:42:25Z"}, "message": "Rollup merge of #92112 - SparrowLii:issue92010, r=cjgillot\n\nFix the error of checking `base_expr` twice in type_changing_struct_update\n\nFixes #92010", "tree": {"sha": "3316d110c63a53cbbfe0267126a3c74bdabbb43d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3316d110c63a53cbbfe0267126a3c74bdabbb43d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bd77fbfef1d7be3fd8d8db137b800476199fa11b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhyiUyCRBK7hj4Ov3rIwAAM0oIAJx+1ZhJIjD8vvyOoPk3aYLr\nvD1sm1bBxnURVyVege+RKxD0WHcRn46fQYrnd5KqL3/vTcVyOp6FcjJHjRZmoxJ6\nyVCwAKNllsFGxxVlZ3hcHAsqXpLd8tyCLT9e4dHwyVLm6747SsTba01huTEM6K3C\n72PZ/acnAMWeiKdLOc3eAtxJaB6HnS5uHQUvjmWP6BYeuqyFFhhVsWoedb9x8Qs4\npzvorWrUrnh3bgc/3UdtvlGSF0y06+qZXILZ2YQhOv58D50qpQhQxq7hhdHk1gmz\nCDqj52TlmF+5hqF41RYEP2gDkW5QbB+sYV8NQjXb5GrtSTMG/jtQeW6wKbantr4=\n=1PXb\n-----END PGP SIGNATURE-----\n", "payload": "tree 3316d110c63a53cbbfe0267126a3c74bdabbb43d\nparent b57a6b38c5b3ac932cf5bc70558fc2b4d0792e91\nparent 643484416b6f09cf40c7583b4259e685c1e30f03\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1640637745 +0100\ncommitter GitHub <noreply@github.com> 1640637745 +0100\n\nRollup merge of #92112 - SparrowLii:issue92010, r=cjgillot\n\nFix the error of checking `base_expr` twice in type_changing_struct_update\n\nFixes #92010\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bd77fbfef1d7be3fd8d8db137b800476199fa11b", "html_url": "https://github.com/rust-lang/rust/commit/bd77fbfef1d7be3fd8d8db137b800476199fa11b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bd77fbfef1d7be3fd8d8db137b800476199fa11b/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b57a6b38c5b3ac932cf5bc70558fc2b4d0792e91", "url": "https://api.github.com/repos/rust-lang/rust/commits/b57a6b38c5b3ac932cf5bc70558fc2b4d0792e91", "html_url": "https://github.com/rust-lang/rust/commit/b57a6b38c5b3ac932cf5bc70558fc2b4d0792e91"}, {"sha": "643484416b6f09cf40c7583b4259e685c1e30f03", "url": "https://api.github.com/repos/rust-lang/rust/commits/643484416b6f09cf40c7583b4259e685c1e30f03", "html_url": "https://github.com/rust-lang/rust/commit/643484416b6f09cf40c7583b4259e685c1e30f03"}], "stats": {"total": 26, "additions": 25, "deletions": 1}, "files": [{"sha": "8d370e440eaf1fedd55d27844464e66b46481e91", "filename": "compiler/rustc_typeck/src/check/expr.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/bd77fbfef1d7be3fd8d8db137b800476199fa11b/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bd77fbfef1d7be3fd8d8db137b800476199fa11b/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fexpr.rs?ref=bd77fbfef1d7be3fd8d8db137b800476199fa11b", "patch": "@@ -1508,7 +1508,7 @@ impl<'a, 'tcx> FnCtxt<'a, 'tcx> {\n                 }\n             } else {\n                 self.check_expr_has_type_or_error(base_expr, adt_ty, |_| {\n-                    let base_ty = self.check_expr(base_expr);\n+                    let base_ty = self.typeck_results.borrow().node_type(base_expr.hir_id);\n                     let same_adt = match (adt_ty.kind(), base_ty.kind()) {\n                         (ty::Adt(adt, _), ty::Adt(base_adt, _)) if adt == base_adt => true,\n                         _ => false,"}, {"sha": "f1a54ee5867c59feb9a64ddabc199f513c578e09", "filename": "src/test/ui/rfcs/rfc-2528-type-changing-struct-update/issue-92010-trait-bound-not-satisfied.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/bd77fbfef1d7be3fd8d8db137b800476199fa11b/src%2Ftest%2Fui%2Frfcs%2Frfc-2528-type-changing-struct-update%2Fissue-92010-trait-bound-not-satisfied.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bd77fbfef1d7be3fd8d8db137b800476199fa11b/src%2Ftest%2Fui%2Frfcs%2Frfc-2528-type-changing-struct-update%2Fissue-92010-trait-bound-not-satisfied.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfcs%2Frfc-2528-type-changing-struct-update%2Fissue-92010-trait-bound-not-satisfied.rs?ref=bd77fbfef1d7be3fd8d8db137b800476199fa11b", "patch": "@@ -0,0 +1,12 @@\n+#[derive(Clone)]\n+struct P<T> {\n+    x: T,\n+    y: f64,\n+}\n+\n+impl<T> P<T> {\n+    fn y(&self, y: f64) -> Self { P{y, .. self.clone() } }\n+                                       //~^ mismatched types [E0308]\n+}\n+\n+fn main() {}"}, {"sha": "5957ea7c9efdd8c9d2551c16c502f52cfc73003b", "filename": "src/test/ui/rfcs/rfc-2528-type-changing-struct-update/issue-92010-trait-bound-not-satisfied.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/bd77fbfef1d7be3fd8d8db137b800476199fa11b/src%2Ftest%2Fui%2Frfcs%2Frfc-2528-type-changing-struct-update%2Fissue-92010-trait-bound-not-satisfied.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/bd77fbfef1d7be3fd8d8db137b800476199fa11b/src%2Ftest%2Fui%2Frfcs%2Frfc-2528-type-changing-struct-update%2Fissue-92010-trait-bound-not-satisfied.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frfcs%2Frfc-2528-type-changing-struct-update%2Fissue-92010-trait-bound-not-satisfied.stderr?ref=bd77fbfef1d7be3fd8d8db137b800476199fa11b", "patch": "@@ -0,0 +1,12 @@\n+error[E0308]: mismatched types\n+  --> $DIR/issue-92010-trait-bound-not-satisfied.rs:8:43\n+   |\n+LL |     fn y(&self, y: f64) -> Self { P{y, .. self.clone() } }\n+   |                                           ^^^^^^^^^^^^ expected struct `P`, found `&P<T>`\n+   |\n+   = note: expected struct `P<T>`\n+           found reference `&P<T>`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}]}