{"sha": "3ec813e4e508f3608e51c278626ea838d0351c2d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNlYzgxM2U0ZTUwOGYzNjA4ZTUxYzI3ODYyNmVhODM4ZDAzNTFjMmQ=", "commit": {"author": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2016-05-30T11:40:20Z"}, "committer": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2016-05-30T11:40:20Z"}, "message": "add benchmarks", "tree": {"sha": "7301b9d05ab62b28baf013f789ea0bb2f6382a80", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7301b9d05ab62b28baf013f789ea0bb2f6382a80"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3ec813e4e508f3608e51c278626ea838d0351c2d", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJXTCakAAoJEFbW7qD8Z6xGpdUP/A8c81pBjGVnb8D++5ME960h\nFedeTr7/rm78vbJ65fC+67YJiFDGSQeVp5KkyTM+0fAIDe2uQqaKRVi/N3saAU+8\njBWDRO1DJTS7CvcG0aS+qEVpjNW0A/XL874xc+oAHKkFTaqXM8V9bOsUOf4CA6gl\nTpaCc/72bjui2PtRFuW8FqqDiBcTo5wpsbbd/MfF1xBmIjY0cpUQoP6BUUuvGlFB\nK2DXj0b7mFgvd+2Dv7PZQYfOcYnvsTokJ9EKpzsDAr1jBIhEFb/Gtvx2mDd66xaq\nKm3wupJwY6ZCtRNns9F4s2DpExJUguJMy7JDzm/wW0uzwdvuiD207egj48TWocup\n+xoARDcy17+WrETJGvpfNVQtQ5eqkCRKpGoJNl2Yqz6KA1/j/3ydkZR5lxFhj46M\nl76HYRG9z1fpk22ZMYl1JtZcHKfEIVamlVlMdW0aB3sRYEo1lBbEtbZqTrMk2mtq\nxxrSIleu17eTV60bCm01+NlDgtareA/TawYUoJpFtnTiTnlKEkCi/g8TIybPxve8\nOT/GQh+hq5NOGkkmjEO21LfkATqTxMyYmqLqCit7tuiT/cT9hy7bRaK1HJRBpFU4\nmyiYUGrRKz3A+3ZEwm1AOFgQDsum2fFHjdahqxiQzgOgq0UQ0teQ6K6myvxt0Gv5\n7e2UUhn5qYBrrJVMm80M\n=6TTG\n-----END PGP SIGNATURE-----", "payload": "tree 7301b9d05ab62b28baf013f789ea0bb2f6382a80\nparent c55b3666eaeb74c33eea5d4b6a8cc4b974912d9e\nauthor Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1464608420 +0200\ncommitter Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1464608420 +0200\n\nadd benchmarks"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3ec813e4e508f3608e51c278626ea838d0351c2d", "html_url": "https://github.com/rust-lang/rust/commit/3ec813e4e508f3608e51c278626ea838d0351c2d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3ec813e4e508f3608e51c278626ea838d0351c2d/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c55b3666eaeb74c33eea5d4b6a8cc4b974912d9e", "url": "https://api.github.com/repos/rust-lang/rust/commits/c55b3666eaeb74c33eea5d4b6a8cc4b974912d9e", "html_url": "https://github.com/rust-lang/rust/commit/c55b3666eaeb74c33eea5d4b6a8cc4b974912d9e"}], "stats": {"total": 83, "additions": 83, "deletions": 0}, "files": [{"sha": "992f435a501ce1ba508568a7fd8dfbebda9b4586", "filename": "benches/smoke.rs", "status": "added", "additions": 76, "deletions": 0, "changes": 76, "blob_url": "https://github.com/rust-lang/rust/blob/3ec813e4e508f3608e51c278626ea838d0351c2d/benches%2Fsmoke.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ec813e4e508f3608e51c278626ea838d0351c2d/benches%2Fsmoke.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/benches%2Fsmoke.rs?ref=3ec813e4e508f3608e51c278626ea838d0351c2d", "patch": "@@ -0,0 +1,76 @@\n+#![feature(custom_attribute, test)]\n+#![feature(rustc_private)]\n+#![allow(unused_attributes)]\n+\n+extern crate getopts;\n+extern crate miri;\n+extern crate rustc;\n+extern crate rustc_driver;\n+\n+use miri::interpreter;\n+use rustc::session::Session;\n+use rustc_driver::{driver, CompilerCalls};\n+use std::cell::RefCell;\n+use std::rc::Rc;\n+\n+extern crate test;\n+use test::Bencher;\n+\n+mod smoke_helper;\n+\n+#[bench]\n+fn noop(bencher: &mut Bencher) {\n+    bencher.iter(|| {\n+        smoke_helper::main();\n+    })\n+}\n+\n+/*\n+// really slow\n+#[bench]\n+fn noop_miri_full(bencher: &mut Bencher) {\n+    let path = std::env::var(\"RUST_SYSROOT\").expect(\"env variable `RUST_SYSROOT` not set\");\n+    bencher.iter(|| {\n+        let mut process = std::process::Command::new(\"target/release/miri\");\n+        process.arg(\"benches/smoke_helper.rs\")\n+               .arg(\"--sysroot\").arg(&path);\n+        let output = process.output().unwrap();\n+        if !output.status.success() {\n+            println!(\"{}\", String::from_utf8(output.stdout).unwrap());\n+            println!(\"{}\", String::from_utf8(output.stderr).unwrap());\n+            panic!(\"failed to run miri\");\n+        }\n+    })\n+}\n+*/\n+\n+#[bench]\n+fn noop_miri_interpreter(bencher: &mut Bencher) {\n+    let path = std::env::var(\"RUST_SYSROOT\").expect(\"env variable `RUST_SYSROOT` not set\");\n+    rustc_driver::run_compiler(&[\n+        \"miri\".to_string(), \"benches/smoke_helper.rs\".to_string(), \"--sysroot\".to_string(), path.to_string(),\n+    ], &mut MiriCompilerCalls(Rc::new(RefCell::new(bencher))));\n+}\n+\n+struct MiriCompilerCalls<'a>(Rc<RefCell<&'a mut Bencher>>);\n+\n+impl<'a> CompilerCalls<'a> for MiriCompilerCalls<'a> {\n+    fn build_controller(\n+        &mut self,\n+        _: &Session,\n+        _: &getopts::Matches\n+    ) -> driver::CompileController<'a> {\n+        let mut control: driver::CompileController<'a> = driver::CompileController::basic();\n+\n+        let bencher = self.0.clone();\n+\n+        control.after_analysis.callback = Box::new(move |state| {\n+            state.session.abort_if_errors();\n+            bencher.borrow_mut().iter(|| {\n+                interpreter::interpret_start_points(state.tcx.unwrap(), state.mir_map.unwrap());\n+            })\n+        });\n+\n+        control\n+    }\n+}"}, {"sha": "e8691f244c02f02440f3795c2ef232d47e7bdb55", "filename": "benches/smoke_helper.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/3ec813e4e508f3608e51c278626ea838d0351c2d/benches%2Fsmoke_helper.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3ec813e4e508f3608e51c278626ea838d0351c2d/benches%2Fsmoke_helper.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/benches%2Fsmoke_helper.rs?ref=3ec813e4e508f3608e51c278626ea838d0351c2d", "patch": "@@ -0,0 +1,7 @@\n+#![feature(custom_attribute)]\n+#![allow(unused_attributes)]\n+\n+#[miri_run]\n+#[inline(never)]\n+pub fn main() {\n+}"}]}