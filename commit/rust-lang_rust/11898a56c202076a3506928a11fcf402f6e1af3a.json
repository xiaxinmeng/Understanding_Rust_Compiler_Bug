{"sha": "11898a56c202076a3506928a11fcf402f6e1af3a", "node_id": "C_kwDOAAsO6NoAKDExODk4YTU2YzIwMjA3NmEzNTA2OTI4YTExZmNmNDAyZjZlMWFmM2E", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-01-29T13:46:29Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-01-29T13:46:29Z"}, "message": "Rollup merge of #88205 - danii:e0772, r=GuillaumeGomez\n\nAdd Explanation For Error E0772\n\nI've added an error explanation for the error code E0772.\n\nAssists with #61137", "tree": {"sha": "b835ee89f3d538e91004900467d37863d2f96d31", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b835ee89f3d538e91004900467d37863d2f96d31"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/11898a56c202076a3506928a11fcf402f6e1af3a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJh9UU1CRBK7hj4Ov3rIwAAoR4IAEwrbJkFVcfquLjxwaCQEL6f\nw8Z8+xWK5VYqRmKmP80/vtNSLGvbDzWcnW6e3C62q/AOIWJbSLbFliygms6ikAEu\njUdHCSZQNhYqewdDDRfUr68I0n6muzjy53CEdY5tnQbyXu6lvk8ll+VuKXsC49W/\nW7FMqYY8FGc+d4wltcDxY5vULVIi8dNI8YkAq2q65LWRs0nvoKgaZHeVDZuesEBi\n/F0LnzcjR5uvuWE38FX9NP70d7rDwfnEkVW293QUCMWbSelfodSZc32JtpIiC6Wy\nMvaDhinp6XfSTcrdDfh6gKChdDmBvtAsw/99jcYJ4i/iulTyq0xJ5gzuADM38+o=\n=096L\n-----END PGP SIGNATURE-----\n", "payload": "tree b835ee89f3d538e91004900467d37863d2f96d31\nparent ca43894e0e350af2245ba7d9ad8b6e31e0d4786d\nparent 4f8b9a41263ebd8469c626d36bf10034ad99ea8c\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1643463989 +0100\ncommitter GitHub <noreply@github.com> 1643463989 +0100\n\nRollup merge of #88205 - danii:e0772, r=GuillaumeGomez\n\nAdd Explanation For Error E0772\n\nI've added an error explanation for the error code E0772.\n\nAssists with #61137\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/11898a56c202076a3506928a11fcf402f6e1af3a", "html_url": "https://github.com/rust-lang/rust/commit/11898a56c202076a3506928a11fcf402f6e1af3a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/11898a56c202076a3506928a11fcf402f6e1af3a/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ca43894e0e350af2245ba7d9ad8b6e31e0d4786d", "url": "https://api.github.com/repos/rust-lang/rust/commits/ca43894e0e350af2245ba7d9ad8b6e31e0d4786d", "html_url": "https://github.com/rust-lang/rust/commit/ca43894e0e350af2245ba7d9ad8b6e31e0d4786d"}, {"sha": "4f8b9a41263ebd8469c626d36bf10034ad99ea8c", "url": "https://api.github.com/repos/rust-lang/rust/commits/4f8b9a41263ebd8469c626d36bf10034ad99ea8c", "html_url": "https://github.com/rust-lang/rust/commit/4f8b9a41263ebd8469c626d36bf10034ad99ea8c"}], "stats": {"total": 97, "additions": 94, "deletions": 3}, "files": [{"sha": "c401f65eddaedde02a099bc37ac22533871b9e0d", "filename": "compiler/rustc_error_codes/src/error_codes.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/11898a56c202076a3506928a11fcf402f6e1af3a/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/11898a56c202076a3506928a11fcf402f6e1af3a/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes.rs?ref=11898a56c202076a3506928a11fcf402f6e1af3a", "patch": "@@ -472,6 +472,7 @@ E0768: include_str!(\"./error_codes/E0768.md\"),\n E0769: include_str!(\"./error_codes/E0769.md\"),\n E0770: include_str!(\"./error_codes/E0770.md\"),\n E0771: include_str!(\"./error_codes/E0771.md\"),\n+E0772: include_str!(\"./error_codes/E0772.md\"),\n E0773: include_str!(\"./error_codes/E0773.md\"),\n E0774: include_str!(\"./error_codes/E0774.md\"),\n E0775: include_str!(\"./error_codes/E0775.md\"),\n@@ -642,5 +643,4 @@ E0787: include_str!(\"./error_codes/E0787.md\"),\n //  E0723, // unstable feature in `const` context\n     E0726, // non-explicit (not `'_`) elided lifetime in unsupported position\n //  E0738, // Removed; errored on `#[track_caller] fn`s in `extern \"Rust\" { ... }`.\n-    E0772, // `'static' obligation coming from `impl dyn Trait {}` or `impl Foo for dyn Bar {}`.\n }"}, {"sha": "262e52351ef01c203ad655f7c2683dc6915e8a8a", "filename": "compiler/rustc_error_codes/src/error_codes/E0772.md", "status": "added", "additions": 89, "deletions": 0, "changes": 89, "blob_url": "https://github.com/rust-lang/rust/blob/11898a56c202076a3506928a11fcf402f6e1af3a/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes%2FE0772.md", "raw_url": "https://github.com/rust-lang/rust/raw/11898a56c202076a3506928a11fcf402f6e1af3a/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes%2FE0772.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_error_codes%2Fsrc%2Ferror_codes%2FE0772.md?ref=11898a56c202076a3506928a11fcf402f6e1af3a", "patch": "@@ -0,0 +1,89 @@\n+A trait object has some specific lifetime `'1`, but it was used in a way that\n+requires it to have a `'static` lifetime.\n+\n+Example of erroneous code:\n+\n+```compile_fail,E0772\n+trait BooleanLike {}\n+trait Person {}\n+\n+impl BooleanLike for bool {}\n+\n+impl dyn Person {\n+    fn is_cool(&self) -> bool {\n+        // hey you, you're pretty cool\n+        true\n+    }\n+}\n+\n+fn get_is_cool<'p>(person: &'p dyn Person) -> impl BooleanLike {\n+    // error: `person` has an anonymous lifetime `'p` but calling\n+    //        `print_cool_fn` introduces an implicit `'static` lifetime\n+    //        requirement\n+    person.is_cool()\n+}\n+```\n+\n+The trait object `person` in the function `get_is_cool`, while already being\n+behind a reference with lifetime `'p`, also has it's own implicit lifetime,\n+`'2`.\n+\n+Lifetime `'2` represents the data the trait object might hold inside, for\n+example:\n+\n+```\n+trait MyTrait {}\n+\n+struct MyStruct<'a>(&'a i32);\n+\n+impl<'a> MyTrait for MyStruct<'a> {}\n+```\n+\n+With this scenario, if a trait object of `dyn MyTrait + '2` was made from\n+`MyStruct<'a>`, `'a` must live as long, if not longer than `'2`. This allows the\n+trait object's internal data to be accessed safely from any trait methods. This\n+rule also goes for any lifetime any struct made into a trait object may have.\n+\n+In the implementation for `dyn Person`, the `'2` lifetime representing the\n+internal data was ommitted, meaning that the compiler inferred the lifetime\n+`'static`. As a result, the implementation's `is_cool` is inferred by the\n+compiler to look like this:\n+\n+```\n+# trait Person {}\n+#\n+# impl dyn Person {\n+fn is_cool<'a>(self: &'a (dyn Person + 'static)) -> bool {unimplemented!()}\n+# }\n+```\n+\n+While the `get_is_cool` function is inferred to look like this:\n+\n+```\n+# trait Person {}\n+# trait BooleanLike {}\n+#\n+fn get_is_cool<'p, R: BooleanLike>(person: &'p (dyn Person + 'p)) -> R {\n+    unimplemented!()\n+}\n+```\n+\n+Which brings us to the core of the problem; the assignment of type\n+`&'_ (dyn Person + '_)` to type `&'_ (dyn Person + 'static)` is impossible.\n+\n+Fixing it is as simple as being generic over lifetime `'2`, as to prevent the\n+compiler from inferring it as `'static`:\n+\n+```\n+# trait Person {}\n+#\n+impl<'d> dyn Person + 'd {/* ... */}\n+\n+// This works too, and is more elegant:\n+//impl dyn Person + '_ {/* ... */}\n+```\n+\n+See the [Rust Reference on Trait Object Lifetime Bounds][trait-objects] for\n+more information on trait object lifetimes.\n+\n+[trait-object-lifetime-bounds]: https://doc.rust-lang.org/reference/types/trait-object.html#trait-object-lifetime-bounds"}, {"sha": "b125eacfb6cf4444d6f351b3f94438304477e548", "filename": "src/test/ui/suggestions/impl-on-dyn-trait-with-implicit-static-bound-needing-more-suggestions.stderr", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/11898a56c202076a3506928a11fcf402f6e1af3a/src%2Ftest%2Fui%2Fsuggestions%2Fimpl-on-dyn-trait-with-implicit-static-bound-needing-more-suggestions.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/11898a56c202076a3506928a11fcf402f6e1af3a/src%2Ftest%2Fui%2Fsuggestions%2Fimpl-on-dyn-trait-with-implicit-static-bound-needing-more-suggestions.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fimpl-on-dyn-trait-with-implicit-static-bound-needing-more-suggestions.stderr?ref=11898a56c202076a3506928a11fcf402f6e1af3a", "patch": "@@ -38,4 +38,5 @@ LL |     impl MyTrait for Box<dyn ObjectTrait<Assoc = i32> + '_> {\n \n error: aborting due to 4 previous errors\n \n-For more information about this error, try `rustc --explain E0515`.\n+Some errors have detailed explanations: E0515, E0772.\n+For more information about an error, try `rustc --explain E0515`."}, {"sha": "ed094c1365caa6a72de2ca9b6580b1ed59c317c5", "filename": "src/test/ui/suggestions/impl-on-dyn-trait-with-implicit-static-bound.stderr", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/11898a56c202076a3506928a11fcf402f6e1af3a/src%2Ftest%2Fui%2Fsuggestions%2Fimpl-on-dyn-trait-with-implicit-static-bound.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/11898a56c202076a3506928a11fcf402f6e1af3a/src%2Ftest%2Fui%2Fsuggestions%2Fimpl-on-dyn-trait-with-implicit-static-bound.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsuggestions%2Fimpl-on-dyn-trait-with-implicit-static-bound.stderr?ref=11898a56c202076a3506928a11fcf402f6e1af3a", "patch": "@@ -131,4 +131,5 @@ LL |     impl MyTrait for Box<dyn ObjectTrait + '_> {\n \n error: aborting due to 6 previous errors\n \n-For more information about this error, try `rustc --explain E0759`.\n+Some errors have detailed explanations: E0759, E0772.\n+For more information about an error, try `rustc --explain E0759`."}]}