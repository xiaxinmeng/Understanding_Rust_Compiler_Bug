{"sha": "050cb1c45232017a7708144b867114d7a7fbb569", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA1MGNiMWM0NTIzMjAxN2E3NzA4MTQ0Yjg2NzExNGQ3YTdmYmI1Njk=", "commit": {"author": {"name": "Oliver Schneider", "email": "git-no-reply-9879165716479413131@oli-obk.de", "date": "2018-05-09T15:34:37Z"}, "committer": {"name": "Oliver Schneider", "email": "git-no-reply-9879165716479413131@oli-obk.de", "date": "2018-05-09T16:17:08Z"}, "message": "Don't require clippy/miri for beta", "tree": {"sha": "0ea6ae9c4ba79afe47aa2d275ecdf8ebc45e4bed", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0ea6ae9c4ba79afe47aa2d275ecdf8ebc45e4bed"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/050cb1c45232017a7708144b867114d7a7fbb569", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQJgBAABCgBKFiEEvpMjxK4/cnPNfesJHVy0/Fl8MAQFAlrzHwgsHGdpdC1uby1y\nZXBseS05ODc5MTY1NzE2NDc5NDEzMTMxQG9saS1vYmsuZGUACgkQHVy0/Fl8MARK\n7RAAtu9UoI3v1gUCbXE+1h/XVLaVnCKIblYpNFr6WAY7XQiFgZu4DXIzofO6fqUO\nsuSAJB/qX97Q8UlbQshZj0cdbsi5ioveCfcRm9Ht0oBQhQrZ1jYf4v6MGLb1ALh3\nXM3F/rvYsraoZxG6ra3Dp4ryStakcMHjBbHh7SHFaf0w/7gdGMEG05WLQeq5Hn6w\n6VS0L6xFT80cQ4mD0GE5Z4Kw7lQbopH7nxoiXchc6eefyu2kZPu7s0gkugyezns0\noLnXa70MpzJNxjbP3G2xNPcuB02kq8P002/iLf0dJA8ikhjTvYeLCmlODB0wVVyc\ni+hubMV/QAGDLFQOGcca0XWfM3oag0uaYfwcrQt4TmE9SM4hCaIIpVGz92leMgBH\n77U/YjaqmPP+UvL9aKa/6YSgpKRbvw/HIsLuElkTeWlOmQQc52zqh9e7d/mXD/xy\nNtpoXvX2i0a0YeQT68tGXlc8Fii7PrhGegT0FtGh41U0qyyFbPqp49gMdfkF4dIo\nFM1SOIFVMcXev4JdwGuSjSc+dK7+Y8Kirp6jI8sZmHsfVplqFMdlNc+KeNeS3X2k\nlNKT9xEz9Kgg/qu2mRRZriIAPUdzhyliEYEwF3uYzzhigW6DHZTGyVH42Amv52tQ\nVG+hy6u8NLa9VNdH9I+t+DWxxvZELgBEBwPZ/P6cNd1PLMM=\n=/kDR\n-----END PGP SIGNATURE-----", "payload": "tree 0ea6ae9c4ba79afe47aa2d275ecdf8ebc45e4bed\nparent 8ff4b42064b374bb62043f7729f84b6d979c7667\nauthor Oliver Schneider <git-no-reply-9879165716479413131@oli-obk.de> 1525880077 +0200\ncommitter Oliver Schneider <git-no-reply-9879165716479413131@oli-obk.de> 1525882628 +0200\n\nDon't require clippy/miri for beta\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/050cb1c45232017a7708144b867114d7a7fbb569", "html_url": "https://github.com/rust-lang/rust/commit/050cb1c45232017a7708144b867114d7a7fbb569", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/050cb1c45232017a7708144b867114d7a7fbb569/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8ff4b42064b374bb62043f7729f84b6d979c7667", "url": "https://api.github.com/repos/rust-lang/rust/commits/8ff4b42064b374bb62043f7729f84b6d979c7667", "html_url": "https://github.com/rust-lang/rust/commit/8ff4b42064b374bb62043f7729f84b6d979c7667"}], "stats": {"total": 37, "additions": 26, "deletions": 11}, "files": [{"sha": "b0b88a6f3051614b842bee976eadaa9f25f8fbc7", "filename": "src/ci/docker/x86_64-gnu-tools/checktools.sh", "status": "modified", "additions": 26, "deletions": 11, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/050cb1c45232017a7708144b867114d7a7fbb569/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh", "raw_url": "https://github.com/rust-lang/rust/raw/050cb1c45232017a7708144b867114d7a7fbb569/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fx86_64-gnu-tools%2Fchecktools.sh?ref=050cb1c45232017a7708144b867114d7a7fbb569", "patch": "@@ -57,17 +57,34 @@ verify_status() {\n     fi\n }\n \n+check_dispatch() {\n+    if [ \"$1\" = submodule_changed ]; then\n+        # ignore $2 (branch id)\n+        verify_status $3 $4\n+    elif [ \"$2\" = beta ]; then\n+        echo \"Requiring test passing for $3...\"\n+        if grep -q '\"'\"$3\"'\":\"\\(test\\|build\\)-fail\"' \"$TOOLSTATE_FILE\"; then\n+            exit 4\n+        fi\n+    fi\n+}\n+\n+status_check() {\n+    check_dispatch $1 beta book src/doc/book\n+    check_dispatch $1 beta nomicon src/doc/nomicon\n+    check_dispatch $1 beta reference src/doc/reference\n+    check_dispatch $1 beta rust-by-example src/doc/rust-by-example\n+    check_dispatch $1 beta rls src/tool/rls\n+    check_dispatch $1 beta rustfmt src/tool/rustfmt\n+    # these tools are not required for beta to successfully branch\n+    check_dispatch $1 nightly clippy-driver src/tool/clippy\n+    check_dispatch $1 nightly miri src/tool/miri\n+}\n+\n # If this PR is intended to update one of these tools, do not let the build pass\n # when they do not test-pass.\n \n-verify_status book src/doc/book\n-verify_status nomicon src/doc/nomicon\n-verify_status reference src/doc/reference\n-verify_status rust-by-example src/doc/rust-by-example\n-verify_status rls src/tool/rls\n-verify_status rustfmt src/tool/rustfmt\n-verify_status clippy-driver src/tool/clippy\n-verify_status miri src/tool/miri\n+status_check \"submodule_changed\"\n \n if [ \"$RUST_RELEASE_CHANNEL\" = nightly -a -n \"${TOOLSTATE_REPO_ACCESS_TOKEN+is_set}\" ]; then\n     . \"$(dirname $0)/repo.sh\"\n@@ -86,6 +103,4 @@ $COMMIT\\t$(cat \"$TOOLSTATE_FILE\")\n     exit 0\n fi\n \n-if grep -q fail \"$TOOLSTATE_FILE\"; then\n-    exit 4\n-fi\n+status_check \"beta_required\""}]}