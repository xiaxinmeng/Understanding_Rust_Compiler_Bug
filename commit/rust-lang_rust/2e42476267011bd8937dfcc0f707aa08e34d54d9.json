{"sha": "2e42476267011bd8937dfcc0f707aa08e34d54d9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJlNDI0NzYyNjcwMTFiZDg5MzdkZmNjMGY3MDdhYTA4ZTM0ZDU0ZDk=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2020-06-11T22:05:19Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-06-11T22:05:19Z"}, "message": "Rollup merge of #73033 - Amanieu:asm-tls, r=oli-obk\n\nFix #[thread_local] statics as asm! sym operands\n\nThe `asm!` RFC specifies that `#[thread_local]` statics may be used as `sym` operands for inline assembly.\n\nThis also fixes a regression in the handling of `#[thread_local]` during monomorphization which caused link-time errors with multiple codegen units, most likely introduced by #71192.\n\nr? @oli-obk", "tree": {"sha": "088ec42bbadf9700638a9283effbcf9cfc05c923", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/088ec42bbadf9700638a9283effbcf9cfc05c923"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2e42476267011bd8937dfcc0f707aa08e34d54d9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJe4qqgCRBK7hj4Ov3rIwAAdHIIADDjp7BDpQvrkixvnS1ccZq3\nNaccBfYtlBgn+3lNkb7dmmlqHms7s11VQbarVDM5jzJzgzgijB6eHg5f0kHY7zA8\nC3J0vK1v5BVSX9g3giEV1wQPZrMA1hoM5xenATvp7hKraVDJhFBAP79uFmArL0eC\ndUHCagr1w3XScWavtxFxSsT3AwaRTwF2OuF5pcugljt42lYUQvfETAzyPjTioqW1\nRsKJK4jCnA1i48GtJR3wY8HHYdEW5plHl1cBT6kQsi3n3dZ5i5L/pGtokGUwuLtb\n2dCzm05DGDsOG6AdNWNw0QKdJvU69FR02OYQGOvMGLvsq5Wvts/AUDlGOgsXfiA=\n=vSY9\n-----END PGP SIGNATURE-----\n", "payload": "tree 088ec42bbadf9700638a9283effbcf9cfc05c923\nparent a37c32e2d5fb186627ffe99a391c7fd6fd159334\nparent 74befd955bfe23418369064888dc0f08f59c024f\nauthor Dylan DPC <dylan.dpc@gmail.com> 1591913119 +0200\ncommitter GitHub <noreply@github.com> 1591913119 +0200\n\nRollup merge of #73033 - Amanieu:asm-tls, r=oli-obk\n\nFix #[thread_local] statics as asm! sym operands\n\nThe `asm!` RFC specifies that `#[thread_local]` statics may be used as `sym` operands for inline assembly.\n\nThis also fixes a regression in the handling of `#[thread_local]` during monomorphization which caused link-time errors with multiple codegen units, most likely introduced by #71192.\n\nr? @oli-obk\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2e42476267011bd8937dfcc0f707aa08e34d54d9", "html_url": "https://github.com/rust-lang/rust/commit/2e42476267011bd8937dfcc0f707aa08e34d54d9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2e42476267011bd8937dfcc0f707aa08e34d54d9/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a37c32e2d5fb186627ffe99a391c7fd6fd159334", "url": "https://api.github.com/repos/rust-lang/rust/commits/a37c32e2d5fb186627ffe99a391c7fd6fd159334", "html_url": "https://github.com/rust-lang/rust/commit/a37c32e2d5fb186627ffe99a391c7fd6fd159334"}, {"sha": "74befd955bfe23418369064888dc0f08f59c024f", "url": "https://api.github.com/repos/rust-lang/rust/commits/74befd955bfe23418369064888dc0f08f59c024f", "html_url": "https://github.com/rust-lang/rust/commit/74befd955bfe23418369064888dc0f08f59c024f"}], "stats": {"total": 123, "additions": 78, "deletions": 45}, "files": [{"sha": "ef59ad486eefe5fa12be6cebef0f19de2fc282a1", "filename": "src/librustc_codegen_ssa/mir/block.rs", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_codegen_ssa%2Fmir%2Fblock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_codegen_ssa%2Fmir%2Fblock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fmir%2Fblock.rs?ref=2e42476267011bd8937dfcc0f707aa08e34d54d9", "patch": "@@ -927,12 +927,8 @@ impl<'a, 'tcx, Bx: BuilderMethods<'a, 'tcx>> FunctionCx<'a, 'tcx, Bx> {\n                         span_bug!(span, \"invalid type for asm sym (fn)\");\n                     }\n                 }\n-                mir::InlineAsmOperand::SymStatic { ref value } => {\n-                    if let Some(def_id) = value.check_static_ptr(bx.tcx()) {\n-                        InlineAsmOperandRef::SymStatic { def_id }\n-                    } else {\n-                        span_bug!(span, \"invalid type for asm sym (static)\");\n-                    }\n+                mir::InlineAsmOperand::SymStatic { def_id } => {\n+                    InlineAsmOperandRef::SymStatic { def_id }\n                 }\n             })\n             .collect();"}, {"sha": "129f9691ea521b4d7405c0a570d5b945a2e32c8f", "filename": "src/librustc_middle/mir/mod.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_middle%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_middle%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_middle%2Fmir%2Fmod.rs?ref=2e42476267011bd8937dfcc0f707aa08e34d54d9", "patch": "@@ -1243,7 +1243,7 @@ pub enum InlineAsmOperand<'tcx> {\n         value: Box<Constant<'tcx>>,\n     },\n     SymStatic {\n-        value: Box<Constant<'tcx>>,\n+        def_id: DefId,\n     },\n }\n \n@@ -1639,9 +1639,11 @@ impl<'tcx> TerminatorKind<'tcx> {\n                         InlineAsmOperand::Const { value } => {\n                             write!(fmt, \"const {:?}\", value)?;\n                         }\n-                        InlineAsmOperand::SymFn { value }\n-                        | InlineAsmOperand::SymStatic { value } => {\n-                            write!(fmt, \"sym {:?}\", value)?;\n+                        InlineAsmOperand::SymFn { value } => {\n+                            write!(fmt, \"sym_fn {:?}\", value)?;\n+                        }\n+                        InlineAsmOperand::SymStatic { def_id } => {\n+                            write!(fmt, \"sym_static {:?}\", def_id)?;\n                         }\n                     }\n                 }"}, {"sha": "5f9fcdca516b1ae802515bbbbc656dfb226be0be", "filename": "src/librustc_middle/mir/visit.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_middle%2Fmir%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_middle%2Fmir%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_middle%2Fmir%2Fvisit.rs?ref=2e42476267011bd8937dfcc0f707aa08e34d54d9", "patch": "@@ -564,10 +564,10 @@ macro_rules! make_mir_visitor {\n                                         );\n                                     }\n                                 }\n-                                InlineAsmOperand::SymFn { value }\n-                                | InlineAsmOperand::SymStatic { value } => {\n+                                InlineAsmOperand::SymFn { value } => {\n                                     self.visit_constant(value, source_location);\n                                 }\n+                                InlineAsmOperand::SymStatic { def_id: _ } => {}\n                             }\n                         }\n                     }"}, {"sha": "17fa641ae6c17d1c6edd2ee56e348d677d1454ca", "filename": "src/librustc_mir/borrow_check/invalidation.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_mir%2Fborrow_check%2Finvalidation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_mir%2Fborrow_check%2Finvalidation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Finvalidation.rs?ref=2e42476267011bd8937dfcc0f707aa08e34d54d9", "patch": "@@ -209,7 +209,7 @@ impl<'cx, 'tcx> Visitor<'tcx> for InvalidationGenerator<'cx, 'tcx> {\n                             }\n                         }\n                         InlineAsmOperand::SymFn { value: _ }\n-                        | InlineAsmOperand::SymStatic { value: _ } => {}\n+                        | InlineAsmOperand::SymStatic { def_id: _ } => {}\n                     }\n                 }\n             }"}, {"sha": "b703237a18e111b3f76c7e56f5b8090a4b7200b8", "filename": "src/librustc_mir/borrow_check/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fmod.rs?ref=2e42476267011bd8937dfcc0f707aa08e34d54d9", "patch": "@@ -760,7 +760,7 @@ impl<'cx, 'tcx> dataflow::ResultsVisitor<'cx, 'tcx> for MirBorrowckCtxt<'cx, 'tc\n                             }\n                         }\n                         InlineAsmOperand::SymFn { value: _ }\n-                        | InlineAsmOperand::SymStatic { value: _ } => {}\n+                        | InlineAsmOperand::SymStatic { def_id: _ } => {}\n                     }\n                 }\n             }"}, {"sha": "41c7bd95a96cc1e877fe7e63362e76f3bdef3e84", "filename": "src/librustc_mir/dataflow/move_paths/builder.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_mir%2Fdataflow%2Fmove_paths%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_mir%2Fdataflow%2Fmove_paths%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdataflow%2Fmove_paths%2Fbuilder.rs?ref=2e42476267011bd8937dfcc0f707aa08e34d54d9", "patch": "@@ -439,7 +439,7 @@ impl<'b, 'a, 'tcx> Gatherer<'b, 'a, 'tcx> {\n                             }\n                         }\n                         InlineAsmOperand::SymFn { value: _ }\n-                        | InlineAsmOperand::SymStatic { value: _ } => {}\n+                        | InlineAsmOperand::SymStatic { def_id: _ } => {}\n                     }\n                 }\n             }"}, {"sha": "994d1e69f2e3e709cefadfa34f4205121b151bf7", "filename": "src/librustc_mir/monomorphize/collector.rs", "status": "modified", "additions": 13, "deletions": 3, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fmonomorphize%2Fcollector.rs?ref=2e42476267011bd8937dfcc0f707aa08e34d54d9", "patch": "@@ -634,9 +634,19 @@ impl<'a, 'tcx> MirVisitor<'tcx> for MirNeighborCollector<'a, 'tcx> {\n             }\n             mir::TerminatorKind::InlineAsm { ref operands, .. } => {\n                 for op in operands {\n-                    if let mir::InlineAsmOperand::SymFn { value } = op {\n-                        let fn_ty = self.monomorphize(value.literal.ty);\n-                        visit_fn_use(self.tcx, fn_ty, false, &mut self.output);\n+                    match *op {\n+                        mir::InlineAsmOperand::SymFn { ref value } => {\n+                            let fn_ty = self.monomorphize(value.literal.ty);\n+                            visit_fn_use(self.tcx, fn_ty, false, &mut self.output);\n+                        }\n+                        mir::InlineAsmOperand::SymStatic { def_id } => {\n+                            let instance = Instance::mono(self.tcx, def_id);\n+                            if should_monomorphize_locally(self.tcx, &instance) {\n+                                trace!(\"collecting asm sym static {:?}\", def_id);\n+                                self.output.push(MonoItem::Static(def_id));\n+                            }\n+                        }\n+                        _ => {}\n                     }\n                 }\n             }"}, {"sha": "0d5bd4c7e61b90a5448f5c593a25bc9930b2a827", "filename": "src/librustc_mir_build/build/expr/into.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_mir_build%2Fbuild%2Fexpr%2Finto.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_mir_build%2Fbuild%2Fexpr%2Finto.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir_build%2Fbuild%2Fexpr%2Finto.rs?ref=2e42476267011bd8937dfcc0f707aa08e34d54d9", "patch": "@@ -358,8 +358,8 @@ impl<'a, 'tcx> Builder<'a, 'tcx> {\n                         hair::InlineAsmOperand::SymFn { expr } => {\n                             mir::InlineAsmOperand::SymFn { value: box this.as_constant(expr) }\n                         }\n-                        hair::InlineAsmOperand::SymStatic { expr } => {\n-                            mir::InlineAsmOperand::SymStatic { value: box this.as_constant(expr) }\n+                        hair::InlineAsmOperand::SymStatic { def_id } => {\n+                            mir::InlineAsmOperand::SymStatic { def_id }\n                         }\n                     })\n                     .collect();"}, {"sha": "703f6ef8dc41e91fcc74c4e3ff8256f477d37dc1", "filename": "src/librustc_mir_build/hair/cx/expr.rs", "status": "modified", "additions": 2, "deletions": 19, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_mir_build%2Fhair%2Fcx%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_mir_build%2Fhair%2Fcx%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir_build%2Fhair%2Fcx%2Fexpr.rs?ref=2e42476267011bd8937dfcc0f707aa08e34d54d9", "patch": "@@ -467,25 +467,8 @@ fn make_mirror_unadjusted<'a, 'tcx>(\n                                     }\n                                 }\n \n-                                Res::Def(DefKind::Static, id) => {\n-                                    ty = cx.tcx.static_ptr_ty(id);\n-                                    let ptr = cx.tcx.create_static_alloc(id);\n-                                    InlineAsmOperand::SymStatic {\n-                                        expr: Expr {\n-                                            ty,\n-                                            temp_lifetime,\n-                                            span: expr.span,\n-                                            kind: ExprKind::StaticRef {\n-                                                literal: ty::Const::from_scalar(\n-                                                    cx.tcx,\n-                                                    Scalar::Ptr(ptr.into()),\n-                                                    ty,\n-                                                ),\n-                                                def_id: id,\n-                                            },\n-                                        }\n-                                        .to_ref(),\n-                                    }\n+                                Res::Def(DefKind::Static, def_id) => {\n+                                    InlineAsmOperand::SymStatic { def_id }\n                                 }\n \n                                 _ => {"}, {"sha": "ccff510f2d4e5ca7d49ca2087018394bbf93e669", "filename": "src/librustc_mir_build/hair/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_mir_build%2Fhair%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Flibrustc_mir_build%2Fhair%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir_build%2Fhair%2Fmod.rs?ref=2e42476267011bd8937dfcc0f707aa08e34d54d9", "patch": "@@ -377,7 +377,7 @@ crate enum InlineAsmOperand<'tcx> {\n         expr: ExprRef<'tcx>,\n     },\n     SymStatic {\n-        expr: ExprRef<'tcx>,\n+        def_id: DefId,\n     },\n }\n "}, {"sha": "8cff16aa75f695a76479b8185bd3cdf282524ce4", "filename": "src/test/ui/asm/sym.rs", "status": "modified", "additions": 47, "deletions": 5, "changes": 52, "blob_url": "https://github.com/rust-lang/rust/blob/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Ftest%2Fui%2Fasm%2Fsym.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e42476267011bd8937dfcc0f707aa08e34d54d9/src%2Ftest%2Fui%2Fasm%2Fsym.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasm%2Fsym.rs?ref=2e42476267011bd8937dfcc0f707aa08e34d54d9", "patch": "@@ -1,8 +1,9 @@\n // no-system-llvm\n // only-x86_64\n+// only-linux\n // run-pass\n \n-#![feature(asm, track_caller)]\n+#![feature(asm, track_caller, thread_local)]\n \n extern \"C\" fn f1() -> i32 {\n     111\n@@ -15,9 +16,9 @@ fn f2() -> i32 {\n }\n \n macro_rules! call {\n-    ($func:path) => {{\n-        let result: i32;\n+    ($func:path) => {\n         unsafe {\n+            let result: i32;\n             asm!(\"call {}\", sym $func,\n                 out(\"rax\") result,\n                 out(\"rcx\") _, out(\"rdx\") _, out(\"rdi\") _, out(\"rsi\") _,\n@@ -27,12 +28,53 @@ macro_rules! call {\n                 out(\"xmm8\") _, out(\"xmm9\") _, out(\"xmm10\") _, out(\"xmm11\") _,\n                 out(\"xmm12\") _, out(\"xmm13\") _, out(\"xmm14\") _, out(\"xmm15\") _,\n             );\n+            result\n         }\n-        result\n-    }}\n+    }\n }\n \n+macro_rules! static_addr {\n+    ($s:expr) => {\n+        unsafe {\n+            let result: *const u32;\n+            // LEA performs a RIP-relative address calculation and returns the address\n+            asm!(\"lea {}, [rip + {}]\", out(reg) result, sym $s);\n+            result\n+        }\n+    }\n+}\n+macro_rules! static_tls_addr {\n+    ($s:expr) => {\n+        unsafe {\n+            let result: *const u32;\n+            asm!(\n+                \"\n+                    # Load TLS base address\n+                    mov {out}, qword ptr fs:[0]\n+                    # Calculate the address of sym in the TLS block. The @tpoff\n+                    # relocation gives the offset of the symbol from the start\n+                    # of the TLS block.\n+                    lea {out}, [{out} + {sym}@tpoff]\n+                \",\n+                out = out(reg) result,\n+                sym = sym $s\n+            );\n+            result\n+        }\n+    }\n+}\n+\n+static S1: u32 = 111;\n+#[thread_local]\n+static S2: u32 = 222;\n+\n fn main() {\n     assert_eq!(call!(f1), 111);\n     assert_eq!(call!(f2), 222);\n+    assert_eq!(static_addr!(S1), &S1 as *const u32);\n+    assert_eq!(static_tls_addr!(S2), &S2 as *const u32);\n+    std::thread::spawn(|| {\n+        assert_eq!(static_addr!(S1), &S1 as *const u32);\n+        assert_eq!(static_tls_addr!(S2), &S2 as *const u32);\n+    });\n }"}]}