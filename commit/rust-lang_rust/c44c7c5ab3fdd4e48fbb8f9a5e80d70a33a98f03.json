{"sha": "c44c7c5ab3fdd4e48fbb8f9a5e80d70a33a98f03", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM0NGM3YzVhYjNmZGQ0ZTQ4ZmJiOGY5YTVlODBkNzBhMzNhOThmMDM=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2010-12-18T01:21:56Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2010-12-18T01:21:56Z"}, "message": "rustc: Zero out slots after dropping them", "tree": {"sha": "e9f3a2fb028520284f8f9c662d461beca181c909", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e9f3a2fb028520284f8f9c662d461beca181c909"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c44c7c5ab3fdd4e48fbb8f9a5e80d70a33a98f03", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c44c7c5ab3fdd4e48fbb8f9a5e80d70a33a98f03", "html_url": "https://github.com/rust-lang/rust/commit/c44c7c5ab3fdd4e48fbb8f9a5e80d70a33a98f03", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c44c7c5ab3fdd4e48fbb8f9a5e80d70a33a98f03/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "56e040e61a382a831faa5c563c46ffee2f4d7333", "url": "https://api.github.com/repos/rust-lang/rust/commits/56e040e61a382a831faa5c563c46ffee2f4d7333", "html_url": "https://github.com/rust-lang/rust/commit/56e040e61a382a831faa5c563c46ffee2f4d7333"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "2b6ab9b05693d68b3d7e067017211b6b71ac978d", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/c44c7c5ab3fdd4e48fbb8f9a5e80d70a33a98f03/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c44c7c5ab3fdd4e48fbb8f9a5e80d70a33a98f03/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=c44c7c5ab3fdd4e48fbb8f9a5e80d70a33a98f03", "patch": "@@ -768,7 +768,7 @@ fn type_of_variant(@crate_ctxt cx, &ast.variant v) -> TypeRef {\n type val_and_ty_fn =\n     fn(@block_ctxt cx, ValueRef v, @typeck.ty t) -> result;\n \n-// Iterates through the elements of a tup, rec or tag.\n+// Iterates through the elements of a box, tup, rec or tag.\n fn iter_structural_ty(@block_ctxt cx,\n                       ValueRef v,\n                       @typeck.ty t,\n@@ -968,7 +968,13 @@ fn incr_all_refcnts(@block_ctxt cx,\n fn drop_slot(@block_ctxt cx,\n              ValueRef slot,\n              @typeck.ty t) -> result {\n-    be drop_ty(cx, load_non_structural(cx, slot, t), t);\n+    auto llptr = load_non_structural(cx, slot, t);\n+    auto re = drop_ty(cx, llptr, t);\n+\n+    auto llty = val_ty(slot);\n+    auto llelemty = lib.llvm.llvm.LLVMGetElementType(llty);\n+    re.bcx.build.Store(C_null(llelemty), slot);\n+    ret re;\n }\n \n fn drop_ty(@block_ctxt cx,"}]}