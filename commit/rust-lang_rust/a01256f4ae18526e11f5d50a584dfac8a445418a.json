{"sha": "a01256f4ae18526e11f5d50a584dfac8a445418a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEwMTI1NmY0YWUxODUyNmUxMWY1ZDUwYTU4NGRmYWM4YTQ0NTQxOGE=", "commit": {"author": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2020-11-12T14:49:45Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2020-11-17T11:38:35Z"}, "message": "Avoid installing external LLVM dylibs\n\nIf the LLVM was externally provided, then we don't currently copy artifacts into\nthe sysroot. This is not necessarily the right choice (in particular, it will\nrequire the LLVM dylib to be in the linker's load path at runtime), but the\ncommon use case for external LLVMs is distribution provided LLVMs, and in that\ncase they're usually in the standard search path (e.g., /usr/lib) and copying\nthem here is going to cause problems as we may end up with the wrong files and\nisn't what distributions want.\n\nThis behavior may be revisited in the future though.", "tree": {"sha": "a64f5cc39bcfce1268d7bc9f011e64ecd58222fe", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a64f5cc39bcfce1268d7bc9f011e64ecd58222fe"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a01256f4ae18526e11f5d50a584dfac8a445418a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl+ztjsACgkQPgar6Auq\n8ZzE4w/+NAZz4p8hKjCWzzzaB1BWMv4PyxlrNH+U3igzSCIZxAZQUkXzOGfJU4eH\nUT63xV77DBGaDwhhpJyl1pn6wxhOqeg7d/Ju7RQWxKsQGp1lZnqF7wC98j+gENFy\nM105UsYTFMG6tgy3/FV7raA9NJBk61xN/yGsevypvfiIF7aORhPaSXcxSjyiyrbb\nuXQTd1mVDEyzCL0+F6TqTIBbeLfoCQxMudlTQoaDnvFwot95YPH1sAPvgSQpZq1G\nJ0Y2cpyCng1ak4Q31hikoorW0Jl8ngdNKJFCo3Fhyi2+IgTdLgEfDBs4xeRamWwM\n/Qj1UUMJ1b3AYAX0PT/I1F+ob7jpcPLaRRpSi+CR8ayJGuLaARZWqmPwkCxIlxV2\n3BKbFIOMUJBS/R3KHGfyT+PsDiYmQAfR2v51JBXNYjrfb7H/NDK5BHUH0DJrXWdC\nittgXu9IYh86gd810b1wL7KkqG2altaVVw1Hy7jiloY8UzZEroxJIc+v3vaRDQjH\nyvvhnOX30wPesVfhUa2tdafSoajb+/N05LyuvvHHFzU+wCCBrmwqp+UM5GVFYZK4\n92nPi0QtfAVMBkUCVmkZgtKJyQqN11hOB5mtMdtNggZ6HobBwM6+nZbz9sJ6ly8p\ntyjSsm+9MV8rUQeSPEBP8DeuK1g2u4qACvqn3J3fmyi4QIeG5WM=\n=BEOt\n-----END PGP SIGNATURE-----", "payload": "tree a64f5cc39bcfce1268d7bc9f011e64ecd58222fe\nparent e881b4e26c7d5b343f91854f8025395109671bb7\nauthor Mark Rousskov <mark.simulacrum@gmail.com> 1605192585 -0500\ncommitter Pietro Albini <pietro@pietroalbini.org> 1605613115 +0100\n\nAvoid installing external LLVM dylibs\n\nIf the LLVM was externally provided, then we don't currently copy artifacts into\nthe sysroot. This is not necessarily the right choice (in particular, it will\nrequire the LLVM dylib to be in the linker's load path at runtime), but the\ncommon use case for external LLVMs is distribution provided LLVMs, and in that\ncase they're usually in the standard search path (e.g., /usr/lib) and copying\nthem here is going to cause problems as we may end up with the wrong files and\nisn't what distributions want.\n\nThis behavior may be revisited in the future though.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a01256f4ae18526e11f5d50a584dfac8a445418a", "html_url": "https://github.com/rust-lang/rust/commit/a01256f4ae18526e11f5d50a584dfac8a445418a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a01256f4ae18526e11f5d50a584dfac8a445418a/comments", "author": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e881b4e26c7d5b343f91854f8025395109671bb7", "url": "https://api.github.com/repos/rust-lang/rust/commits/e881b4e26c7d5b343f91854f8025395109671bb7", "html_url": "https://github.com/rust-lang/rust/commit/e881b4e26c7d5b343f91854f8025395109671bb7"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "514be9e6864ba01e9d1ccdabd92ffd2043903ba8", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/a01256f4ae18526e11f5d50a584dfac8a445418a/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a01256f4ae18526e11f5d50a584dfac8a445418a/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=a01256f4ae18526e11f5d50a584dfac8a445418a", "patch": "@@ -2357,6 +2357,22 @@ fn maybe_install_llvm(builder: &Builder<'_>, target: TargetSelection, dst_libdir\n         return;\n     }\n \n+    if let Some(config) = builder.config.target_config.get(&target) {\n+        if config.llvm_config.is_some() {\n+            // If the LLVM was externally provided, then we don't currently copy\n+            // artifacts into the sysroot. This is not necessarily the right\n+            // choice (in particular, it will require the LLVM dylib to be in\n+            // the linker's load path at runtime), but the common use case for\n+            // external LLVMs is distribution provided LLVMs, and in that case\n+            // they're usually in the standard search path (e.g., /usr/lib) and\n+            // copying them here is going to cause problems as we may end up\n+            // with the wrong files and isn't what distributions want.\n+            //\n+            // This behavior may be revisited in the future though.\n+            return;\n+        }\n+    }\n+\n     // On macOS, rustc (and LLVM tools) link to an unversioned libLLVM.dylib\n     // instead of libLLVM-11-rust-....dylib, as on linux. It's not entirely\n     // clear why this is the case, though. llvm-config will emit the versioned"}]}