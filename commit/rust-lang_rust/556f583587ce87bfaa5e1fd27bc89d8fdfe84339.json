{"sha": "556f583587ce87bfaa5e1fd27bc89d8fdfe84339", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU1NmY1ODM1ODdjZTg3YmZhYTVlMWZkMjdiYzg5ZDhmZGZlODQzMzk=", "commit": {"author": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2018-11-08T11:52:53Z"}, "committer": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2018-11-08T11:54:20Z"}, "message": "Regression test for issue #54382\n\n(I opted to rely on compare-mode=nll rather than opt into\n`#![feature(nll)]`, mostly to make it easy to observe the interesting\ndifferences between the AST-borrwock diagnostic and the NLL one.)", "tree": {"sha": "b4ebd8cb7d7bfe5683610aae803b3a42956db732", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b4ebd8cb7d7bfe5683610aae803b3a42956db732"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/556f583587ce87bfaa5e1fd27bc89d8fdfe84339", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/556f583587ce87bfaa5e1fd27bc89d8fdfe84339", "html_url": "https://github.com/rust-lang/rust/commit/556f583587ce87bfaa5e1fd27bc89d8fdfe84339", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/556f583587ce87bfaa5e1fd27bc89d8fdfe84339/comments", "author": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3011ecdeac214aeb99714abbefffbf6a1fe1e0c8", "url": "https://api.github.com/repos/rust-lang/rust/commits/3011ecdeac214aeb99714abbefffbf6a1fe1e0c8", "html_url": "https://github.com/rust-lang/rust/commit/3011ecdeac214aeb99714abbefffbf6a1fe1e0c8"}], "stats": {"total": 61, "additions": 61, "deletions": 0}, "files": [{"sha": "31f49b2836e91952f77e28b123a72eb98e8a769c", "filename": "src/test/ui/nll/issue-54382-use-span-of-tail-of-block.nll.stderr", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/556f583587ce87bfaa5e1fd27bc89d8fdfe84339/src%2Ftest%2Fui%2Fnll%2Fissue-54382-use-span-of-tail-of-block.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/556f583587ce87bfaa5e1fd27bc89d8fdfe84339/src%2Ftest%2Fui%2Fnll%2Fissue-54382-use-span-of-tail-of-block.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fissue-54382-use-span-of-tail-of-block.nll.stderr?ref=556f583587ce87bfaa5e1fd27bc89d8fdfe84339", "patch": "@@ -0,0 +1,18 @@\n+error[E0597]: `_thing1` does not live long enough\n+  --> $DIR/issue-54382-use-span-of-tail-of-block.rs:7:29\n+   |\n+LL |             D(\"other\").next(&_thing1)\n+   |             ----------------^^^^^^^^-\n+   |             |               |\n+   |             |               borrowed value does not live long enough\n+   |             a temporary with access to the borrow is created here ...\n+LL |         }\n+LL |     }\n+   |     - `_thing1` dropped here while still borrowed\n+LL | \n+LL |     ;\n+   |     - ... and the borrow might be used here, when that temporary is dropped and runs the `Drop` code for type `D`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0597`."}, {"sha": "99eafe0e9d18f2832cf1ef815ffe648ffb88f42d", "filename": "src/test/ui/nll/issue-54382-use-span-of-tail-of-block.rs", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/556f583587ce87bfaa5e1fd27bc89d8fdfe84339/src%2Ftest%2Fui%2Fnll%2Fissue-54382-use-span-of-tail-of-block.rs", "raw_url": "https://github.com/rust-lang/rust/raw/556f583587ce87bfaa5e1fd27bc89d8fdfe84339/src%2Ftest%2Fui%2Fnll%2Fissue-54382-use-span-of-tail-of-block.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fissue-54382-use-span-of-tail-of-block.rs?ref=556f583587ce87bfaa5e1fd27bc89d8fdfe84339", "patch": "@@ -0,0 +1,28 @@\n+fn main() {\n+    {\n+        let mut _thing1 = D(Box::new(\"thing1\"));\n+        {\n+            let _thing2 = D(\"thing2\");\n+            side_effects();\n+            D(\"other\").next(&_thing1)\n+        }\n+    }\n+\n+    ;\n+}\n+\n+#[derive(Debug)]\n+struct D<T: std::fmt::Debug>(T);\n+\n+impl<T: std::fmt::Debug>  Drop for D<T> {\n+    fn drop(&mut self) {\n+        println!(\"dropping {:?})\", self);\n+    }\n+}\n+\n+impl<T: std::fmt::Debug> D<T> {\n+    fn next<U: std::fmt::Debug>(&self, _other: U) -> D<U> { D(_other) }\n+    fn end(&self) { }\n+}\n+\n+fn side_effects() { }"}, {"sha": "eeba7d6bb445fa8b68adfc52ffbd500f069ae7cb", "filename": "src/test/ui/nll/issue-54382-use-span-of-tail-of-block.stderr", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/556f583587ce87bfaa5e1fd27bc89d8fdfe84339/src%2Ftest%2Fui%2Fnll%2Fissue-54382-use-span-of-tail-of-block.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/556f583587ce87bfaa5e1fd27bc89d8fdfe84339/src%2Ftest%2Fui%2Fnll%2Fissue-54382-use-span-of-tail-of-block.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Fissue-54382-use-span-of-tail-of-block.stderr?ref=556f583587ce87bfaa5e1fd27bc89d8fdfe84339", "patch": "@@ -0,0 +1,15 @@\n+error[E0597]: `_thing1` does not live long enough\n+  --> $DIR/issue-54382-use-span-of-tail-of-block.rs:7:30\n+   |\n+LL |             D(\"other\").next(&_thing1)\n+   |                              ^^^^^^^ borrowed value does not live long enough\n+LL |         }\n+LL |     }\n+   |     - `_thing1` dropped here while still borrowed\n+LL | \n+LL |     ;\n+   |     - borrowed value needs to live until here\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0597`."}]}