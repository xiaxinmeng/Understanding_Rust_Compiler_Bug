{"sha": "0e2a96321a368c62cf98e73c67507a9bcdded01e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBlMmE5NjMyMWEzNjhjNjJjZjk4ZTczYzY3NTA3YTliY2RkZWQwMWU=", "commit": {"author": {"name": "Wang Xuerui", "email": "idontknw.wang@gmail.com", "date": "2016-06-05T10:01:37Z"}, "committer": {"name": "Wang Xuerui", "email": "idontknw.wang@gmail.com", "date": "2016-07-13T18:55:33Z"}, "message": "syntax_ext: format: separate verification and translation of pieces", "tree": {"sha": "2e59f1edd04d1cb94cdf62222a10f1c9cd1c04b1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2e59f1edd04d1cb94cdf62222a10f1c9cd1c04b1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0e2a96321a368c62cf98e73c67507a9bcdded01e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v2\n\niQIcBAABCAAGBQJXho6mAAoJEHg5bO9pIxDsnIcP/3+pVBMtPR6XqUvpFB12oEjY\nySguYKbv55o+AMt067lysya+9AZUoXqZLecznTuJOdV8VSdGBXJJaAQqIZwDZfKW\n38j45pa64LWo5IEQHom1wfwVUkj/vRrPBvG59Gm8YD5BDw6LA9EwM3TNtkZclSm6\nkMBLMzHTzR9Qtxv77tjEmQZ0foQ94SpY3pKZZKWwL0pgb2Xvu+hV4afQAOoQemA2\nfmjaAwljnHSFvhADX+WBwJs9VBJDaV7/jP0EXzxtVOhG3exFJNFrQPczCSuJRIkL\nD5XgiUYIqbUue4HJ/F2IfgZMxMj16Fopz8fL6BjgRz159S5lIvMXoJs7sYOfbf9Q\nyGHMocjbThAC+w5k5rVbX5sRpnukh3UccBX8wxuDeE47YFJqEMLt8VS+xf+GaJoW\nS/niKERvrmONR6OA5Pyb3H1fvmCguqqiIzZ0/bvkQEXKycv7wgc7INwSRy7h6EWv\nGG2lyD4F6oiqUDIu4FUI4Va8UcLIgkucjPmb1tlvMq7ZOj0Mf+mCzpeh4edd/Dbc\nltodTcg8JehhqbJdobJSiVcHX6SHAyQ13qSteGc4F6LeOJm3ejsW+atds6Sg2gej\nyl+cngkIGPit45mCxxj7yv8IA0DVux7cruqkHdAV9BUq2ihLX0KjW3+84mibb3IK\nXMkB02bWyiaZpws2jD5Y\n=g4Av\n-----END PGP SIGNATURE-----", "payload": "tree 2e59f1edd04d1cb94cdf62222a10f1c9cd1c04b1\nparent 06b034ae8b418beab7d0767a9a8d29023558d701\nauthor Wang Xuerui <idontknw.wang@gmail.com> 1465120897 +0800\ncommitter Wang Xuerui <idontknw.wang@gmail.com> 1468436133 +0800\n\nsyntax_ext: format: separate verification and translation of pieces\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0e2a96321a368c62cf98e73c67507a9bcdded01e", "html_url": "https://github.com/rust-lang/rust/commit/0e2a96321a368c62cf98e73c67507a9bcdded01e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0e2a96321a368c62cf98e73c67507a9bcdded01e/comments", "author": {"login": "xen0n", "id": 1175567, "node_id": "MDQ6VXNlcjExNzU1Njc=", "avatar_url": "https://avatars.githubusercontent.com/u/1175567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xen0n", "html_url": "https://github.com/xen0n", "followers_url": "https://api.github.com/users/xen0n/followers", "following_url": "https://api.github.com/users/xen0n/following{/other_user}", "gists_url": "https://api.github.com/users/xen0n/gists{/gist_id}", "starred_url": "https://api.github.com/users/xen0n/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xen0n/subscriptions", "organizations_url": "https://api.github.com/users/xen0n/orgs", "repos_url": "https://api.github.com/users/xen0n/repos", "events_url": "https://api.github.com/users/xen0n/events{/privacy}", "received_events_url": "https://api.github.com/users/xen0n/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xen0n", "id": 1175567, "node_id": "MDQ6VXNlcjExNzU1Njc=", "avatar_url": "https://avatars.githubusercontent.com/u/1175567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xen0n", "html_url": "https://github.com/xen0n", "followers_url": "https://api.github.com/users/xen0n/followers", "following_url": "https://api.github.com/users/xen0n/following{/other_user}", "gists_url": "https://api.github.com/users/xen0n/gists{/gist_id}", "starred_url": "https://api.github.com/users/xen0n/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xen0n/subscriptions", "organizations_url": "https://api.github.com/users/xen0n/orgs", "repos_url": "https://api.github.com/users/xen0n/repos", "events_url": "https://api.github.com/users/xen0n/events{/privacy}", "received_events_url": "https://api.github.com/users/xen0n/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "06b034ae8b418beab7d0767a9a8d29023558d701", "url": "https://api.github.com/repos/rust-lang/rust/commits/06b034ae8b418beab7d0767a9a8d29023558d701", "html_url": "https://github.com/rust-lang/rust/commit/06b034ae8b418beab7d0767a9a8d29023558d701"}], "stats": {"total": 16, "additions": 11, "deletions": 5}, "files": [{"sha": "8a329126ca85bf025dab72851c2e937522f483d7", "filename": "src/libsyntax_ext/format.rs", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/0e2a96321a368c62cf98e73c67507a9bcdded01e/src%2Flibsyntax_ext%2Fformat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e2a96321a368c62cf98e73c67507a9bcdded01e/src%2Flibsyntax_ext%2Fformat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fformat.rs?ref=0e2a96321a368c62cf98e73c67507a9bcdded01e", "patch": "@@ -651,21 +651,27 @@ pub fn expand_preparsed_format_args(ecx: &mut ExtCtxt, sp: Span,\n     };\n \n     let mut parser = parse::Parser::new(&fmt);\n+    let mut pieces = vec![];\n \n     loop {\n         match parser.next() {\n             Some(piece) => {\n                 if !parser.errors.is_empty() { break }\n                 cx.verify_piece(&piece);\n-                if let Some(piece) = cx.trans_piece(&piece) {\n-                    let s = cx.trans_literal_string();\n-                    cx.str_pieces.push(s);\n-                    cx.pieces.push(piece);\n-                }\n+                pieces.push(piece);\n             }\n             None => break\n         }\n     }\n+\n+    for piece in pieces {\n+        if let Some(piece) = cx.trans_piece(&piece) {\n+            let s = cx.trans_literal_string();\n+            cx.str_pieces.push(s);\n+            cx.pieces.push(piece);\n+        }\n+    }\n+\n     if !parser.errors.is_empty() {\n         cx.ecx.span_err(cx.fmtsp, &format!(\"invalid format string: {}\",\n                                           parser.errors.remove(0)));"}]}