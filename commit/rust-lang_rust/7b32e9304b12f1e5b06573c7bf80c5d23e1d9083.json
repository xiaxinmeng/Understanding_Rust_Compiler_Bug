{"sha": "7b32e9304b12f1e5b06573c7bf80c5d23e1d9083", "node_id": "C_kwDOAAsO6NoAKDdiMzJlOTMwNGIxMmYxZTViMDY1NzNjN2JmODBjNWQyM2UxZDkwODM", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-05-10T06:24:03Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-05-10T06:24:03Z"}, "message": "Rollup merge of #96812 - cjgillot:no-lint-outllives-macro, r=petrochenkov\n\nDo not lint on explicit outlives requirements from external macros.\n\nThe current implementation of the list rightfully skipped where predicates from external macros.\nHowever, if the where predicate came from the current macro but the bounds were from an external macro, the lint still fired.\n\nCloses https://github.com/rust-lang/rust/issues/96640", "tree": {"sha": "e47acd8329bddf62377c91f78b395f3771a22fbd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e47acd8329bddf62377c91f78b395f3771a22fbd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7b32e9304b12f1e5b06573c7bf80c5d23e1d9083", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiegUDCRBK7hj4Ov3rIwAALocIAK3suxiUAJ4dUzgp2u+hKhWw\nSq+LobQWHDodHKZGLWU83F9Is7sGIvwLw1wL7+Hobc34CXA/yTsA3I7e4MRLPKnd\nMsKAXGBMU4TWy6AXnhNC0jXt4jqfI3DNAn7sgSsCg0q1HsvqIfFGMnrIilQUVF43\nb1g16W9TEF0UevDKXvKZiMRJterK6csms6BmVk3a/dvKufgqEuqxhTjA0Cw+TX3h\nqagUHXPo959gQ7SyqSbyJwQNE+HkEyZBcdxV26r6NE/71ukYYLGvMrOHHmR29AB7\nT6AoWxNTYNu18SEj0C8K5/WH2IPyzK/Dsncz/DT+r4uOQAflSL75pA0Nl2HTM8Y=\n=diMs\n-----END PGP SIGNATURE-----\n", "payload": "tree e47acd8329bddf62377c91f78b395f3771a22fbd\nparent c5c273b30e2464de2c4de2cc4c9d2696de540e7f\nparent 89f15bfd907b0b44a851c5810ab463fe91a206e5\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1652163843 +0200\ncommitter GitHub <noreply@github.com> 1652163843 +0200\n\nRollup merge of #96812 - cjgillot:no-lint-outllives-macro, r=petrochenkov\n\nDo not lint on explicit outlives requirements from external macros.\n\nThe current implementation of the list rightfully skipped where predicates from external macros.\nHowever, if the where predicate came from the current macro but the bounds were from an external macro, the lint still fired.\n\nCloses https://github.com/rust-lang/rust/issues/96640\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7b32e9304b12f1e5b06573c7bf80c5d23e1d9083", "html_url": "https://github.com/rust-lang/rust/commit/7b32e9304b12f1e5b06573c7bf80c5d23e1d9083", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7b32e9304b12f1e5b06573c7bf80c5d23e1d9083/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c5c273b30e2464de2c4de2cc4c9d2696de540e7f", "url": "https://api.github.com/repos/rust-lang/rust/commits/c5c273b30e2464de2c4de2cc4c9d2696de540e7f", "html_url": "https://github.com/rust-lang/rust/commit/c5c273b30e2464de2c4de2cc4c9d2696de540e7f"}, {"sha": "89f15bfd907b0b44a851c5810ab463fe91a206e5", "url": "https://api.github.com/repos/rust-lang/rust/commits/89f15bfd907b0b44a851c5810ab463fe91a206e5", "html_url": "https://github.com/rust-lang/rust/commit/89f15bfd907b0b44a851c5810ab463fe91a206e5"}], "stats": {"total": 51, "additions": 50, "deletions": 1}, "files": [{"sha": "5a985be08a133229810211dffeb81e4cd59bb187", "filename": "compiler/rustc_lint/src/builtin.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/7b32e9304b12f1e5b06573c7bf80c5d23e1d9083/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b32e9304b12f1e5b06573c7bf80c5d23e1d9083/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_lint%2Fsrc%2Fbuiltin.rs?ref=7b32e9304b12f1e5b06573c7bf80c5d23e1d9083", "patch": "@@ -38,7 +38,7 @@ use rustc_hir::def::{DefKind, Res};\n use rustc_hir::def_id::{DefId, LocalDefId, LocalDefIdSet, CRATE_DEF_ID};\n use rustc_hir::{ForeignItemKind, GenericParamKind, HirId, PatKind, PredicateOrigin};\n use rustc_index::vec::Idx;\n-use rustc_middle::lint::LintDiagnosticBuilder;\n+use rustc_middle::lint::{in_external_macro, LintDiagnosticBuilder};\n use rustc_middle::ty::layout::{LayoutError, LayoutOf};\n use rustc_middle::ty::print::with_no_trimmed_paths;\n use rustc_middle::ty::subst::{GenericArgKind, Subst};\n@@ -2115,6 +2115,7 @@ impl ExplicitOutlivesRequirements {\n                     None\n                 }\n             })\n+            .filter(|(_, span)| !in_external_macro(tcx.sess, *span))\n             .collect()\n     }\n "}, {"sha": "d45fa10f022aa56542563c15e47535c56f4cc28b", "filename": "src/test/ui/rust-2018/auxiliary/edition-lint-infer-outlives-macro.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7b32e9304b12f1e5b06573c7bf80c5d23e1d9083/src%2Ftest%2Fui%2Frust-2018%2Fauxiliary%2Fedition-lint-infer-outlives-macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b32e9304b12f1e5b06573c7bf80c5d23e1d9083/src%2Ftest%2Fui%2Frust-2018%2Fauxiliary%2Fedition-lint-infer-outlives-macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fauxiliary%2Fedition-lint-infer-outlives-macro.rs?ref=7b32e9304b12f1e5b06573c7bf80c5d23e1d9083", "patch": "@@ -0,0 +1,6 @@\n+pub fn foo() {}\n+\n+#[macro_export]\n+macro_rules! gimme_a {\n+    ($($mac:tt)*) => { $($mac)* { 'a } }\n+}"}, {"sha": "d7a832831c1d91cc916021ab172decb757d38420", "filename": "src/test/ui/rust-2018/edition-lint-infer-outlives-macro.rs", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/7b32e9304b12f1e5b06573c7bf80c5d23e1d9083/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-infer-outlives-macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7b32e9304b12f1e5b06573c7bf80c5d23e1d9083/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-infer-outlives-macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-infer-outlives-macro.rs?ref=7b32e9304b12f1e5b06573c7bf80c5d23e1d9083", "patch": "@@ -0,0 +1,28 @@\n+// edition:2018\n+// aux-build:edition-lint-infer-outlives-macro.rs\n+\n+// Test that the lint does not fire if the where predicate\n+// is from the local crate, but all the bounds are from an\n+// external macro.\n+\n+#![deny(explicit_outlives_requirements)]\n+\n+#[macro_use]\n+extern crate edition_lint_infer_outlives_macro;\n+\n+macro_rules! make_foo {\n+    ($a:tt) => {\n+        struct Foo<$a, 'b> where 'b: $a {\n+            foo: &$a &'b (),\n+        }\n+    }\n+}\n+\n+gimme_a! {make_foo!}\n+\n+struct Bar<'a, 'b: 'a> {\n+    //~^ ERROR: outlives requirements can be inferred\n+    bar: &'a &'b (),\n+}\n+\n+fn main() {}"}, {"sha": "553b1cd976ad6a114a10ce5dcc15770650ee10b3", "filename": "src/test/ui/rust-2018/edition-lint-infer-outlives-macro.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/7b32e9304b12f1e5b06573c7bf80c5d23e1d9083/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-infer-outlives-macro.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/7b32e9304b12f1e5b06573c7bf80c5d23e1d9083/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-infer-outlives-macro.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Frust-2018%2Fedition-lint-infer-outlives-macro.stderr?ref=7b32e9304b12f1e5b06573c7bf80c5d23e1d9083", "patch": "@@ -0,0 +1,14 @@\n+error: outlives requirements can be inferred\n+  --> $DIR/edition-lint-infer-outlives-macro.rs:23:18\n+   |\n+LL | struct Bar<'a, 'b: 'a> {\n+   |                  ^^^^ help: remove this bound\n+   |\n+note: the lint level is defined here\n+  --> $DIR/edition-lint-infer-outlives-macro.rs:8:9\n+   |\n+LL | #![deny(explicit_outlives_requirements)]\n+   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}]}