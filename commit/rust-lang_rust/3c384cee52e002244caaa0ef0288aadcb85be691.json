{"sha": "3c384cee52e002244caaa0ef0288aadcb85be691", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNjMzg0Y2VlNTJlMDAyMjQ0Y2FhYTBlZjAyODhhYWRjYjg1YmU2OTE=", "commit": {"author": {"name": "waterlens", "email": "82268070+waterlens@users.noreply.github.com", "date": "2021-07-16T09:56:51Z"}, "committer": {"name": "waterlens", "email": "82268070+waterlens@users.noreply.github.com", "date": "2021-07-16T09:56:51Z"}, "message": "Fix panics on Windows when the build was cancelled", "tree": {"sha": "fe7a82ce28bc9bb5d80f0be35d00269437fd79b8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fe7a82ce28bc9bb5d80f0be35d00269437fd79b8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3c384cee52e002244caaa0ef0288aadcb85be691", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3c384cee52e002244caaa0ef0288aadcb85be691", "html_url": "https://github.com/rust-lang/rust/commit/3c384cee52e002244caaa0ef0288aadcb85be691", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3c384cee52e002244caaa0ef0288aadcb85be691/comments", "author": {"login": "waterlens", "id": 82268070, "node_id": "MDQ6VXNlcjgyMjY4MDcw", "avatar_url": "https://avatars.githubusercontent.com/u/82268070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/waterlens", "html_url": "https://github.com/waterlens", "followers_url": "https://api.github.com/users/waterlens/followers", "following_url": "https://api.github.com/users/waterlens/following{/other_user}", "gists_url": "https://api.github.com/users/waterlens/gists{/gist_id}", "starred_url": "https://api.github.com/users/waterlens/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/waterlens/subscriptions", "organizations_url": "https://api.github.com/users/waterlens/orgs", "repos_url": "https://api.github.com/users/waterlens/repos", "events_url": "https://api.github.com/users/waterlens/events{/privacy}", "received_events_url": "https://api.github.com/users/waterlens/received_events", "type": "User", "site_admin": false}, "committer": {"login": "waterlens", "id": 82268070, "node_id": "MDQ6VXNlcjgyMjY4MDcw", "avatar_url": "https://avatars.githubusercontent.com/u/82268070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/waterlens", "html_url": "https://github.com/waterlens", "followers_url": "https://api.github.com/users/waterlens/followers", "following_url": "https://api.github.com/users/waterlens/following{/other_user}", "gists_url": "https://api.github.com/users/waterlens/gists{/gist_id}", "starred_url": "https://api.github.com/users/waterlens/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/waterlens/subscriptions", "organizations_url": "https://api.github.com/users/waterlens/orgs", "repos_url": "https://api.github.com/users/waterlens/repos", "events_url": "https://api.github.com/users/waterlens/events{/privacy}", "received_events_url": "https://api.github.com/users/waterlens/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "057050a95bdfc5849a893208c53c7b2a081c6808", "url": "https://api.github.com/repos/rust-lang/rust/commits/057050a95bdfc5849a893208c53c7b2a081c6808", "html_url": "https://github.com/rust-lang/rust/commit/057050a95bdfc5849a893208c53c7b2a081c6808"}], "stats": {"total": 20, "additions": 14, "deletions": 6}, "files": [{"sha": "5c0322e18a4ab9fff09fa2b62be5592c546aa08d", "filename": "src/bootstrap/job.rs", "status": "modified", "additions": 14, "deletions": 6, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/3c384cee52e002244caaa0ef0288aadcb85be691/src%2Fbootstrap%2Fjob.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3c384cee52e002244caaa0ef0288aadcb85be691/src%2Fbootstrap%2Fjob.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fjob.rs?ref=3c384cee52e002244caaa0ef0288aadcb85be691", "patch": "@@ -103,12 +103,20 @@ pub unsafe fn setup(build: &mut Build) {\n     };\n \n     let parent = OpenProcess(PROCESS_DUP_HANDLE, FALSE, pid.parse().unwrap());\n-    assert!(\n-        !parent.is_null(),\n-        \"PID `{}` doesn't seem to exist: {}\",\n-        pid,\n-        io::Error::last_os_error()\n-    );\n+\n+    // If we get a null parent pointer here, it is possible that either\n+    // we have got an invalid pid or the parent process has been closed.\n+    // Since the first case rarely happens\n+    // (only when wrongly setting the environmental variable),\n+    // so it might be better to improve the experience of the second case\n+    // when users have interrupted the parent process and we don't finish\n+    // duplicating the handle yet.\n+    // We just need close the job object if that occurs.\n+    if parent.is_null() {\n+        CloseHandle(job);\n+        return;\n+    }\n+\n     let mut parent_handle = ptr::null_mut();\n     let r = DuplicateHandle(\n         GetCurrentProcess(),"}]}