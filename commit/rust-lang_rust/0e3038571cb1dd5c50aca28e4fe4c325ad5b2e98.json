{"sha": "0e3038571cb1dd5c50aca28e4fe4c325ad5b2e98", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBlMzAzODU3MWNiMWRkNWM1MGFjYTI4ZTRmZTRjMzI1YWQ1YjJlOTg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-05-01T16:07:48Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-05-01T16:07:48Z"}, "message": "Auto merge of #1784 - hyd-dev:harness-false, r=RalfJung\n\nUse `harness = false` instead of `#![feature(custom_test_frameworks)]`\n\nQuoting from the comment in `tests/compiletest.rs`:\n> Custom test runner, to avoid libtest being wrapped around compiletest which wraps libtest.\n\nI believe `harness = false` is more suitable for that purpose.\n\nI have verified that both `./miri test` and `LD_LIBRARY_PATH=$PWD/build/x86_64-unknown-linux-gnu/stage2/lib PATH=$PWD/build/bin:$PATH ./x.py test src/tools/miri` work well.", "tree": {"sha": "8326665e32c3a926501d2ffb0b9c3e218d768e75", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8326665e32c3a926501d2ffb0b9c3e218d768e75"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0e3038571cb1dd5c50aca28e4fe4c325ad5b2e98", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0e3038571cb1dd5c50aca28e4fe4c325ad5b2e98", "html_url": "https://github.com/rust-lang/rust/commit/0e3038571cb1dd5c50aca28e4fe4c325ad5b2e98", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0e3038571cb1dd5c50aca28e4fe4c325ad5b2e98/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "41f3fe64317a6ef144d2ac33e4e5870d894d6038", "url": "https://api.github.com/repos/rust-lang/rust/commits/41f3fe64317a6ef144d2ac33e4e5870d894d6038", "html_url": "https://github.com/rust-lang/rust/commit/41f3fe64317a6ef144d2ac33e4e5870d894d6038"}, {"sha": "2da6bedaec3f072daae18b7d59e45dd090d48428", "url": "https://api.github.com/repos/rust-lang/rust/commits/2da6bedaec3f072daae18b7d59e45dd090d48428", "html_url": "https://github.com/rust-lang/rust/commit/2da6bedaec3f072daae18b7d59e45dd090d48428"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "ab7d88e66934a6aed98cfd7134dc2580faebe090", "filename": "Cargo.toml", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0e3038571cb1dd5c50aca28e4fe4c325ad5b2e98/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/0e3038571cb1dd5c50aca28e4fe4c325ad5b2e98/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=0e3038571cb1dd5c50aca28e4fe4c325ad5b2e98", "patch": "@@ -45,3 +45,7 @@ colored = \"2\"\n # This crate uses #[feature(rustc_private)]. \n # See https://github.com/rust-analyzer/rust-analyzer/pull/7891\n rustc_private = true\n+\n+[[test]]\n+name = \"compiletest\"\n+harness = false"}, {"sha": "a0d49c9ddcf4864115131b10a9951a3aea127174", "filename": "tests/compiletest.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/0e3038571cb1dd5c50aca28e4fe4c325ad5b2e98/tests%2Fcompiletest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e3038571cb1dd5c50aca28e4fe4c325ad5b2e98/tests%2Fcompiletest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompiletest.rs?ref=0e3038571cb1dd5c50aca28e4fe4c325ad5b2e98", "patch": "@@ -1,7 +1,3 @@\n-#![feature(custom_test_frameworks)]\n-// Custom test runner, to avoid libtest being wrapped around compiletest which wraps libtest.\n-#![test_runner(test_runner)]\n-\n use std::env;\n use std::path::PathBuf;\n \n@@ -83,7 +79,7 @@ fn get_target() -> String {\n     env::var(\"MIRI_TEST_TARGET\").unwrap_or_else(|_| get_host())\n }\n \n-fn test_runner(_tests: &[&()]) {\n+fn main() {\n     // Add a test env var to do environment communication tests.\n     env::set_var(\"MIRI_ENV_VAR_TEST\", \"0\");\n     // Let the tests know where to store temp files (they might run for a different target, which can make this hard to find)."}]}