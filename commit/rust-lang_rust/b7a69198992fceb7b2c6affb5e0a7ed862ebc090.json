{"sha": "b7a69198992fceb7b2c6affb5e0a7ed862ebc090", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI3YTY5MTk4OTkyZmNlYjdiMmM2YWZmYjVlMGE3ZWQ4NjJlYmMwOTA=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-06-19T22:18:25Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2013-06-19T22:18:25Z"}, "message": "rustc: Dispose of LLVM passes in test cases", "tree": {"sha": "226006913791b6edbc424a7f948757212845bf8e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/226006913791b6edbc424a7f948757212845bf8e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b7a69198992fceb7b2c6affb5e0a7ed862ebc090", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b7a69198992fceb7b2c6affb5e0a7ed862ebc090", "html_url": "https://github.com/rust-lang/rust/commit/b7a69198992fceb7b2c6affb5e0a7ed862ebc090", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b7a69198992fceb7b2c6affb5e0a7ed862ebc090/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1120f8c1e57b7b30134d670dd1dfc18c6444c15f", "url": "https://api.github.com/repos/rust-lang/rust/commits/1120f8c1e57b7b30134d670dd1dfc18c6444c15f", "html_url": "https://github.com/rust-lang/rust/commit/1120f8c1e57b7b30134d670dd1dfc18c6444c15f"}], "stats": {"total": 24, "additions": 21, "deletions": 3}, "files": [{"sha": "987c76dccb4242a80d7cc38a55b64477be9907e3", "filename": "src/librustc/back/passes.rs", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/b7a69198992fceb7b2c6affb5e0a7ed862ebc090/src%2Flibrustc%2Fback%2Fpasses.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7a69198992fceb7b2c6affb5e0a7ed862ebc090/src%2Flibrustc%2Fback%2Fpasses.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fback%2Fpasses.rs?ref=b7a69198992fceb7b2c6affb5e0a7ed862ebc090", "patch": "@@ -299,18 +299,27 @@ fn passes_exist() {\n     let mut failed = ~[];\n     unsafe { llvm::LLVMInitializePasses(); }\n     for analysis_passes.each() |&(name,_)| {\n-        if !create_pass(name).is_some() {\n+        let pass = create_pass(name);\n+        if !pass.is_some() {\n             failed.push(name);\n+        } else {\n+            unsafe { llvm::LLVMDestroyPass(pass.get()) }\n         }\n     }\n     for transform_passes.each() |&(name,_)| {\n-        if !create_pass(name).is_some() {\n+        let pass = create_pass(name);\n+        if !pass.is_some() {\n             failed.push(name);\n+        } else {\n+            unsafe { llvm::LLVMDestroyPass(pass.get()) }\n         }\n     }\n     for utility_passes.each() |&(name,_)| {\n-        if !create_pass(name).is_some() {\n+        let pass = create_pass(name);\n+        if !pass.is_some() {\n             failed.push(name);\n+        } else {\n+            unsafe { llvm::LLVMDestroyPass(pass.get()) }\n         }\n     }\n "}, {"sha": "2b2c1e27cbc3d9f0b7d5e2d5dc8584477290abf0", "filename": "src/librustc/lib/llvm.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/b7a69198992fceb7b2c6affb5e0a7ed862ebc090/src%2Flibrustc%2Flib%2Fllvm.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b7a69198992fceb7b2c6affb5e0a7ed862ebc090/src%2Flibrustc%2Flib%2Fllvm.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flib%2Fllvm.rs?ref=b7a69198992fceb7b2c6affb5e0a7ed862ebc090", "patch": "@@ -1684,6 +1684,9 @@ pub mod llvm {\n         #[fast_ffi]\n         pub unsafe fn LLVMCreatePass(PassName:*c_char) -> PassRef;\n \n+        #[fast_ffi]\n+        pub unsafe fn LLVMDestroyPass(P: PassRef);\n+\n         /** Adds a verification pass. */\n         #[fast_ffi]\n         pub unsafe fn LLVMAddVerifierPass(PM: PassManagerRef);"}, {"sha": "32b6df4e1dd595c572d1cab9a45b3731750798aa", "filename": "src/rustllvm/PassWrapper.cpp", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/b7a69198992fceb7b2c6affb5e0a7ed862ebc090/src%2Frustllvm%2FPassWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/b7a69198992fceb7b2c6affb5e0a7ed862ebc090/src%2Frustllvm%2FPassWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2FPassWrapper.cpp?ref=b7a69198992fceb7b2c6affb5e0a7ed862ebc090", "patch": "@@ -63,3 +63,8 @@ extern \"C\" LLVMPassRef LLVMCreatePass(const char * PassName) {\n         return (LLVMPassRef)0;\n     }\n }\n+\n+extern \"C\" void LLVMDestroyPass(LLVMPassRef PassRef) {\n+    Pass *p = unwrap(PassRef);\n+    delete p;\n+}"}, {"sha": "d5f03ac604b7605724c4aa70a33ca3b9e9a7a180", "filename": "src/rustllvm/rustllvm.def.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b7a69198992fceb7b2c6affb5e0a7ed862ebc090/src%2Frustllvm%2Frustllvm.def.in", "raw_url": "https://github.com/rust-lang/rust/raw/b7a69198992fceb7b2c6affb5e0a7ed862ebc090/src%2Frustllvm%2Frustllvm.def.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2Frustllvm.def.in?ref=b7a69198992fceb7b2c6affb5e0a7ed862ebc090", "patch": "@@ -588,6 +588,7 @@ LLVMInlineAsm\n LLVMInitializePasses\n LLVMAddPass\n LLVMCreatePass\n+LLVMDestroyPass\n LLVMDIBuilderCreate\n LLVMDIBuilderDispose\n LLVMDIBuilderFinalize"}]}