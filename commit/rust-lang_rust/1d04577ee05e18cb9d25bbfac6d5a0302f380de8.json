{"sha": "1d04577ee05e18cb9d25bbfac6d5a0302f380de8", "node_id": "C_kwDOAAsO6NoAKDFkMDQ1NzdlZTA1ZTE4Y2I5ZDI1YmJmYWM2ZDVhMDMwMmYzODBkZTg", "commit": {"author": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2021-11-05T17:26:16Z"}, "committer": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2021-11-05T17:26:16Z"}, "message": "Remove some minor checks for LLVM < 12", "tree": {"sha": "06eab5005b828180754bbae5b91de2f118a6cc9b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/06eab5005b828180754bbae5b91de2f118a6cc9b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1d04577ee05e18cb9d25bbfac6d5a0302f380de8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1d04577ee05e18cb9d25bbfac6d5a0302f380de8", "html_url": "https://github.com/rust-lang/rust/commit/1d04577ee05e18cb9d25bbfac6d5a0302f380de8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1d04577ee05e18cb9d25bbfac6d5a0302f380de8/comments", "author": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d22dd65835190278f315e06442614142653ec98f", "url": "https://api.github.com/repos/rust-lang/rust/commits/d22dd65835190278f315e06442614142653ec98f", "html_url": "https://github.com/rust-lang/rust/commit/d22dd65835190278f315e06442614142653ec98f"}], "stats": {"total": 21, "additions": 6, "deletions": 15}, "files": [{"sha": "bedd3523d899e89f0f8205c28b72ad7e03307c17", "filename": "compiler/rustc_codegen_llvm/src/abi.rs", "status": "modified", "additions": 4, "deletions": 10, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/1d04577ee05e18cb9d25bbfac6d5a0302f380de8/compiler%2Frustc_codegen_llvm%2Fsrc%2Fabi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1d04577ee05e18cb9d25bbfac6d5a0302f380de8/compiler%2Frustc_codegen_llvm%2Fsrc%2Fabi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fabi.rs?ref=1d04577ee05e18cb9d25bbfac6d5a0302f380de8", "patch": "@@ -1,7 +1,6 @@\n use crate::builder::Builder;\n use crate::context::CodegenCx;\n use crate::llvm::{self, AttributePlace};\n-use crate::llvm_util;\n use crate::type_::Type;\n use crate::type_of::LayoutLlvmExt;\n use crate::value::Value;\n@@ -53,15 +52,10 @@ pub trait ArgAttributesExt {\n }\n \n fn should_use_mutable_noalias(cx: &CodegenCx<'_, '_>) -> bool {\n-    // LLVM prior to version 12 has known miscompiles in the presence of\n-    // noalias attributes (see #54878). Only enable mutable noalias by\n-    // default for versions we believe to be safe.\n-    cx.tcx\n-        .sess\n-        .opts\n-        .debugging_opts\n-        .mutable_noalias\n-        .unwrap_or_else(|| llvm_util::get_version() >= (12, 0, 0))\n+    // LLVM prior to version 12 had known miscompiles in the presence of\n+    // noalias attributes (see #54878), but we don't support earlier\n+    // versions at all anymore. We now enable mutable noalias by default.\n+    cx.tcx.sess.opts.debugging_opts.mutable_noalias.unwrap_or(true)\n }\n \n impl ArgAttributesExt for ArgAttributes {"}, {"sha": "6c74163fb496c18bf33923b9c2fc0c5f949a2e30", "filename": "compiler/rustc_codegen_llvm/src/builder.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1d04577ee05e18cb9d25bbfac6d5a0302f380de8/compiler%2Frustc_codegen_llvm%2Fsrc%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1d04577ee05e18cb9d25bbfac6d5a0302f380de8/compiler%2Frustc_codegen_llvm%2Fsrc%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fbuilder.rs?ref=1d04577ee05e18cb9d25bbfac6d5a0302f380de8", "patch": "@@ -731,7 +731,7 @@ impl BuilderMethods<'a, 'tcx> for Builder<'a, 'll, 'tcx> {\n     }\n \n     fn fptoui_sat(&mut self, val: &'ll Value, dest_ty: &'ll Type) -> Option<&'ll Value> {\n-        if llvm_util::get_version() >= (12, 0, 0) && !self.fptoint_sat_broken_in_llvm() {\n+        if !self.fptoint_sat_broken_in_llvm() {\n             let src_ty = self.cx.val_ty(val);\n             let float_width = self.cx.float_width(src_ty);\n             let int_width = self.cx.int_width(dest_ty);\n@@ -743,7 +743,7 @@ impl BuilderMethods<'a, 'tcx> for Builder<'a, 'll, 'tcx> {\n     }\n \n     fn fptosi_sat(&mut self, val: &'ll Value, dest_ty: &'ll Type) -> Option<&'ll Value> {\n-        if llvm_util::get_version() >= (12, 0, 0) && !self.fptoint_sat_broken_in_llvm() {\n+        if !self.fptoint_sat_broken_in_llvm() {\n             let src_ty = self.cx.val_ty(val);\n             let float_width = self.cx.float_width(src_ty);\n             let int_width = self.cx.int_width(dest_ty);"}, {"sha": "1dba264a9614a32a5ae9fa62dce679a1d3fc5318", "filename": "compiler/rustc_codegen_llvm/src/context.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/1d04577ee05e18cb9d25bbfac6d5a0302f380de8/compiler%2Frustc_codegen_llvm%2Fsrc%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1d04577ee05e18cb9d25bbfac6d5a0302f380de8/compiler%2Frustc_codegen_llvm%2Fsrc%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fcontext.rs?ref=1d04577ee05e18cb9d25bbfac6d5a0302f380de8", "patch": "@@ -134,9 +134,6 @@ pub unsafe fn create_module(\n     let llmod = llvm::LLVMModuleCreateWithNameInContext(mod_name.as_ptr(), llcx);\n \n     let mut target_data_layout = sess.target.data_layout.clone();\n-    if llvm_util::get_version() < (12, 0, 0) && sess.target.arch == \"powerpc64\" {\n-        target_data_layout = target_data_layout.replace(\"-v256:256:256-v512:512:512\", \"\");\n-    }\n     if llvm_util::get_version() < (13, 0, 0) {\n         if sess.target.arch == \"powerpc64\" {\n             target_data_layout = target_data_layout.replace(\"-S128\", \"\");"}]}