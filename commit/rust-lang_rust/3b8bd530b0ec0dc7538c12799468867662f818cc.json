{"sha": "3b8bd530b0ec0dc7538c12799468867662f818cc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNiOGJkNTMwYjBlYzBkYzc1MzhjMTI3OTk0Njg4Njc2NjJmODE4Y2M=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-03-03T14:09:56Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-03-03T14:09:56Z"}, "message": "Auto merge of #48583 - dotdash:jt_assume, r=alexcrichton\n\nBackport LLVM fixes for a JumpThreading / assume intrinsic bug\n\nThis fixes the original cause of #48116 and restores the assume intrinsic that was removed as a workaround.\n\nr? @alexcrichton", "tree": {"sha": "7e50234ad5ef6aaaef6cbae13cf8515fee58e1be", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7e50234ad5ef6aaaef6cbae13cf8515fee58e1be"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3b8bd530b0ec0dc7538c12799468867662f818cc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3b8bd530b0ec0dc7538c12799468867662f818cc", "html_url": "https://github.com/rust-lang/rust/commit/3b8bd530b0ec0dc7538c12799468867662f818cc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3b8bd530b0ec0dc7538c12799468867662f818cc/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c9b86a91786ca54e898b54f30a6e11546b8e8026", "url": "https://api.github.com/repos/rust-lang/rust/commits/c9b86a91786ca54e898b54f30a6e11546b8e8026", "html_url": "https://github.com/rust-lang/rust/commit/c9b86a91786ca54e898b54f30a6e11546b8e8026"}, {"sha": "93cfb2abfd22c5ce106f51c5e40c31fed10e4756", "url": "https://api.github.com/repos/rust-lang/rust/commits/93cfb2abfd22c5ce106f51c5e40c31fed10e4756", "html_url": "https://github.com/rust-lang/rust/commit/93cfb2abfd22c5ce106f51c5e40c31fed10e4756"}], "stats": {"total": 26, "additions": 10, "deletions": 16}, "files": [{"sha": "64d0d3bb6503dba89c8d8f2e142a6f68bc58f0b0", "filename": "src/libcore/slice/mod.rs", "status": "modified", "additions": 9, "deletions": 15, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/3b8bd530b0ec0dc7538c12799468867662f818cc/src%2Flibcore%2Fslice%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3b8bd530b0ec0dc7538c12799468867662f818cc/src%2Flibcore%2Fslice%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fslice%2Fmod.rs?ref=3b8bd530b0ec0dc7538c12799468867662f818cc", "patch": "@@ -1246,18 +1246,15 @@ macro_rules! iterator {\n             {\n                 // The addition might panic on overflow\n                 // Use the len of the slice to hint optimizer to remove result index bounds check.\n-                let _n = make_slice!(self.ptr, self.end).len();\n+                let n = make_slice!(self.ptr, self.end).len();\n                 self.try_fold(0, move |i, x| {\n                     if predicate(x) { Err(i) }\n                     else { Ok(i + 1) }\n                 }).err()\n-                    // // FIXME(#48116/#45964):\n-                    // // This assume() causes misoptimization on LLVM 6.\n-                    // // Commented out until it is fixed again.\n-                    // .map(|i| {\n-                    //     unsafe { assume(i < n) };\n-                    //     i\n-                    // })\n+                    .map(|i| {\n+                        unsafe { assume(i < n) };\n+                        i\n+                    })\n             }\n \n             #[inline]\n@@ -1274,13 +1271,10 @@ macro_rules! iterator {\n                     if predicate(x) { Err(i) }\n                     else { Ok(i) }\n                 }).err()\n-                    // // FIXME(#48116/#45964):\n-                    // // This assume() causes misoptimization on LLVM 6.\n-                    // // Commented out until it is fixed again.\n-                    // .map(|i| {\n-                    //     unsafe { assume(i < n) };\n-                    //     i\n-                    // })\n+                    .map(|i| {\n+                        unsafe { assume(i < n) };\n+                        i\n+                    })\n             }\n         }\n "}, {"sha": "ba2edd794c7def715007931fcd1b4ce62aa711c8", "filename": "src/llvm", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": null, "raw_url": null, "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fllvm?ref=3b8bd530b0ec0dc7538c12799468867662f818cc", "patch": "@@ -1 +1 @@\n-Subproject commit 9f81beaf32608fbe1fe0f2a82f974e800e9d8c62\n+Subproject commit ba2edd794c7def715007931fcd1b4ce62aa711c8"}]}