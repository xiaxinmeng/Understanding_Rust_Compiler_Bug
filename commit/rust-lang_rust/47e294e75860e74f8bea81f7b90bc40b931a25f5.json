{"sha": "47e294e75860e74f8bea81f7b90bc40b931a25f5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ3ZTI5NGU3NTg2MGU3NGY4YmVhODFmN2I5MGJjNDBiOTMxYTI1ZjU=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2018-12-01T13:46:25Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2019-01-06T17:55:55Z"}, "message": "check missing docs for reexported macros as well", "tree": {"sha": "20a1c3e6449301028766643cb5f3faeda33c681b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/20a1c3e6449301028766643cb5f3faeda33c681b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/47e294e75860e74f8bea81f7b90bc40b931a25f5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/47e294e75860e74f8bea81f7b90bc40b931a25f5", "html_url": "https://github.com/rust-lang/rust/commit/47e294e75860e74f8bea81f7b90bc40b931a25f5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/47e294e75860e74f8bea81f7b90bc40b931a25f5/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e628196d41834971e70b3eb7d40a9d962b4d4da6", "url": "https://api.github.com/repos/rust-lang/rust/commits/e628196d41834971e70b3eb7d40a9d962b4d4da6", "html_url": "https://github.com/rust-lang/rust/commit/e628196d41834971e70b3eb7d40a9d962b4d4da6"}], "stats": {"total": 117, "additions": 97, "deletions": 20}, "files": [{"sha": "5678f30dabccd5b98112ece998330c1132daac80", "filename": "src/librustc_lint/builtin.rs", "status": "modified", "additions": 29, "deletions": 20, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/47e294e75860e74f8bea81f7b90bc40b931a25f5/src%2Flibrustc_lint%2Fbuiltin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47e294e75860e74f8bea81f7b90bc40b931a25f5/src%2Flibrustc_lint%2Fbuiltin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_lint%2Fbuiltin.rs?ref=47e294e75860e74f8bea81f7b90bc40b931a25f5", "patch": "@@ -297,6 +297,26 @@ pub struct MissingDoc {\n     private_traits: FxHashSet<ast::NodeId>,\n }\n \n+fn has_doc(attr: &ast::Attribute) -> bool {\n+    if !attr.check_name(\"doc\") {\n+        return false;\n+    }\n+\n+    if attr.is_value_str() {\n+        return true;\n+    }\n+\n+    if let Some(list) = attr.meta_item_list() {\n+        for meta in list {\n+            if meta.check_name(\"include\") || meta.check_name(\"hidden\") {\n+                return true;\n+            }\n+        }\n+    }\n+\n+    false\n+}\n+\n impl MissingDoc {\n     pub fn new() -> MissingDoc {\n         MissingDoc {\n@@ -335,26 +355,6 @@ impl MissingDoc {\n             }\n         }\n \n-        fn has_doc(attr: &ast::Attribute) -> bool {\n-            if !attr.check_name(\"doc\") {\n-                return false;\n-            }\n-\n-            if attr.is_value_str() {\n-                return true;\n-            }\n-\n-            if let Some(list) = attr.meta_item_list() {\n-                for meta in list {\n-                    if meta.check_name(\"include\") {\n-                        return true;\n-                    }\n-                }\n-            }\n-\n-            false\n-        }\n-\n         let has_doc = attrs.iter().any(|a| has_doc(a));\n         if !has_doc {\n             cx.span_lint(MISSING_DOCS,\n@@ -389,6 +389,15 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for MissingDoc {\n \n     fn check_crate(&mut self, cx: &LateContext, krate: &hir::Crate) {\n         self.check_missing_docs_attrs(cx, None, &krate.attrs, krate.span, \"crate\");\n+\n+        for macro_def in &krate.exported_macros {\n+            let has_doc = macro_def.attrs.iter().any(|a| has_doc(a));\n+            if !has_doc {\n+                cx.span_lint(MISSING_DOCS,\n+                             cx.tcx.sess.source_map().def_span(macro_def.span),\n+                             \"missing documentation for macro\");\n+            }\n+        }\n     }\n \n     fn check_item(&mut self, cx: &LateContext, it: &hir::Item) {"}, {"sha": "b87257188df10c50a1e34cccff76191c838f2769", "filename": "src/libstd/macros.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/47e294e75860e74f8bea81f7b90bc40b931a25f5/src%2Flibstd%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47e294e75860e74f8bea81f7b90bc40b931a25f5/src%2Flibstd%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fmacros.rs?ref=47e294e75860e74f8bea81f7b90bc40b931a25f5", "patch": "@@ -322,6 +322,7 @@ macro_rules! dbg {\n     }\n }\n \n+/// A macro to await on an async call.\n #[macro_export]\n #[unstable(feature = \"await_macro\", issue = \"50547\")]\n #[allow_internal_unstable]"}, {"sha": "910c99314e49bc50a7f9d579c04fc2a055841792", "filename": "src/test/rustdoc-ui/deny-missing-docs-crate.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/47e294e75860e74f8bea81f7b90bc40b931a25f5/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-crate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47e294e75860e74f8bea81f7b90bc40b931a25f5/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-crate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-crate.rs?ref=47e294e75860e74f8bea81f7b90bc40b931a25f5", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![deny(missing_docs)] //~ ERROR\n+\n+pub struct Foo; //~ ERROR"}, {"sha": "7f0590e0b229bb829b2639801092d6f530cde945", "filename": "src/test/rustdoc-ui/deny-missing-docs-crate.stderr", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/47e294e75860e74f8bea81f7b90bc40b931a25f5/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-crate.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/47e294e75860e74f8bea81f7b90bc40b931a25f5/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-crate.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-crate.stderr?ref=47e294e75860e74f8bea81f7b90bc40b931a25f5", "patch": "@@ -0,0 +1,22 @@\n+error: missing documentation for crate\n+  --> $DIR/deny-missing-docs-crate.rs:11:1\n+   |\n+LL | / #![deny(missing_docs)] //~ ERROR\n+LL | |\n+LL | | pub struct Foo; //~ ERROR\n+   | |_______________^\n+   |\n+note: lint level defined here\n+  --> $DIR/deny-missing-docs-crate.rs:11:9\n+   |\n+LL | #![deny(missing_docs)] //~ ERROR\n+   |         ^^^^^^^^^^^^\n+\n+error: missing documentation for a struct\n+  --> $DIR/deny-missing-docs-crate.rs:13:1\n+   |\n+LL | pub struct Foo; //~ ERROR\n+   | ^^^^^^^^^^^^^^^\n+\n+error: Compilation failed, aborting rustdoc\n+"}, {"sha": "a12fe17e0cb61a287cd385386a05cef50c80db2e", "filename": "src/test/rustdoc-ui/deny-missing-docs-macro.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/47e294e75860e74f8bea81f7b90bc40b931a25f5/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/47e294e75860e74f8bea81f7b90bc40b931a25f5/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-macro.rs?ref=47e294e75860e74f8bea81f7b90bc40b931a25f5", "patch": "@@ -0,0 +1,18 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+//! foo\n+\n+#![deny(missing_docs)]\n+\n+#[macro_export]\n+macro_rules! foo { //~ ERROR\n+    () => {}\n+}"}, {"sha": "686a45030e6ca113add5eac27b94b8bc0b7c6e57", "filename": "src/test/rustdoc-ui/deny-missing-docs-macro.stderr", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/47e294e75860e74f8bea81f7b90bc40b931a25f5/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-macro.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/47e294e75860e74f8bea81f7b90bc40b931a25f5/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-macro.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-ui%2Fdeny-missing-docs-macro.stderr?ref=47e294e75860e74f8bea81f7b90bc40b931a25f5", "patch": "@@ -0,0 +1,14 @@\n+error: missing documentation for macro\n+  --> $DIR/deny-missing-docs-macro.rs:16:1\n+   |\n+LL | macro_rules! foo { //~ ERROR\n+   | ^^^^^^^^^^^^^^^^\n+   |\n+note: lint level defined here\n+  --> $DIR/deny-missing-docs-macro.rs:13:9\n+   |\n+LL | #![deny(missing_docs)]\n+   |         ^^^^^^^^^^^^\n+\n+error: Compilation failed, aborting rustdoc\n+"}]}