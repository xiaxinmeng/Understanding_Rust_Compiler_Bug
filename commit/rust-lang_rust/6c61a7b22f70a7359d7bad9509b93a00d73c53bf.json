{"sha": "6c61a7b22f70a7359d7bad9509b93a00d73c53bf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZjNjFhN2IyMmY3MGE3MzU5ZDdiYWQ5NTA5YjkzYTAwZDczYzUzYmY=", "commit": {"author": {"name": "nathanwhit", "email": "nathan.whitaker01@gmail.com", "date": "2020-04-21T18:28:49Z"}, "committer": {"name": "nathanwhit", "email": "nathan.whitaker01@gmail.com", "date": "2020-04-22T16:20:18Z"}, "message": "Add utility fn for expected type of a node\n\nAdds `expected_type_of` to `CompletionContext` to return the expected type of a\nnode, if it is known.", "tree": {"sha": "2c77e8a126fa0d86786e3d11f130c95d90e24360", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2c77e8a126fa0d86786e3d11f130c95d90e24360"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6c61a7b22f70a7359d7bad9509b93a00d73c53bf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6c61a7b22f70a7359d7bad9509b93a00d73c53bf", "html_url": "https://github.com/rust-lang/rust/commit/6c61a7b22f70a7359d7bad9509b93a00d73c53bf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6c61a7b22f70a7359d7bad9509b93a00d73c53bf/comments", "author": {"login": "nathanwhit", "id": 17734409, "node_id": "MDQ6VXNlcjE3NzM0NDA5", "avatar_url": "https://avatars.githubusercontent.com/u/17734409?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nathanwhit", "html_url": "https://github.com/nathanwhit", "followers_url": "https://api.github.com/users/nathanwhit/followers", "following_url": "https://api.github.com/users/nathanwhit/following{/other_user}", "gists_url": "https://api.github.com/users/nathanwhit/gists{/gist_id}", "starred_url": "https://api.github.com/users/nathanwhit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nathanwhit/subscriptions", "organizations_url": "https://api.github.com/users/nathanwhit/orgs", "repos_url": "https://api.github.com/users/nathanwhit/repos", "events_url": "https://api.github.com/users/nathanwhit/events{/privacy}", "received_events_url": "https://api.github.com/users/nathanwhit/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nathanwhit", "id": 17734409, "node_id": "MDQ6VXNlcjE3NzM0NDA5", "avatar_url": "https://avatars.githubusercontent.com/u/17734409?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nathanwhit", "html_url": "https://github.com/nathanwhit", "followers_url": "https://api.github.com/users/nathanwhit/followers", "following_url": "https://api.github.com/users/nathanwhit/following{/other_user}", "gists_url": "https://api.github.com/users/nathanwhit/gists{/gist_id}", "starred_url": "https://api.github.com/users/nathanwhit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nathanwhit/subscriptions", "organizations_url": "https://api.github.com/users/nathanwhit/orgs", "repos_url": "https://api.github.com/users/nathanwhit/repos", "events_url": "https://api.github.com/users/nathanwhit/events{/privacy}", "received_events_url": "https://api.github.com/users/nathanwhit/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "84e3304a9bf0d68e30d58b1e37a6db2e9ec97525", "url": "https://api.github.com/repos/rust-lang/rust/commits/84e3304a9bf0d68e30d58b1e37a6db2e9ec97525", "html_url": "https://github.com/rust-lang/rust/commit/84e3304a9bf0d68e30d58b1e37a6db2e9ec97525"}], "stats": {"total": 13, "additions": 12, "deletions": 1}, "files": [{"sha": "cfc5c34df0851fd96974dc33881001ffb7e8d112", "filename": "crates/ra_ide/src/completion/completion_context.rs", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/6c61a7b22f70a7359d7bad9509b93a00d73c53bf/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcompletion_context.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6c61a7b22f70a7359d7bad9509b93a00d73c53bf/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcompletion_context.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcompletion_context.rs?ref=6c61a7b22f70a7359d7bad9509b93a00d73c53bf", "patch": "@@ -1,6 +1,6 @@\n //! FIXME: write short doc here\n \n-use hir::{Semantics, SemanticsScope};\n+use hir::{Semantics, SemanticsScope, Type};\n use ra_db::SourceDatabase;\n use ra_ide_db::RootDatabase;\n use ra_syntax::{\n@@ -168,6 +168,17 @@ impl<'a> CompletionContext<'a> {\n         self.sema.scope_at_offset(&self.token.parent(), self.offset)\n     }\n \n+    pub(crate) fn expected_type_of(&self, node: &SyntaxNode) -> Option<Type> {\n+        for ancestor in node.ancestors() {\n+            if let Some(pat) = ast::Pat::cast(ancestor.clone()) {\n+                return self.sema.type_of_pat(&pat);\n+            } else if let Some(expr) = ast::Expr::cast(ancestor) {\n+                return self.sema.type_of_expr(&expr);\n+            }\n+        }\n+        None\n+    }\n+\n     fn fill(\n         &mut self,\n         original_file: &SyntaxNode,"}]}