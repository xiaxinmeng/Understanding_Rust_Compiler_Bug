{"sha": "2e7abf83844ef0c7d807262a682941f2aef9d3d9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJlN2FiZjgzODQ0ZWYwYzdkODA3MjYyYTY4Mjk0MWYyYWVmOWQzZDk=", "commit": {"author": {"name": "Jesse Bakker", "email": "github@jessebakker.com", "date": "2020-12-21T16:37:38Z"}, "committer": {"name": "Jesse Bakker", "email": "github@jessebakker.com", "date": "2020-12-21T16:37:38Z"}, "message": "Remove parentheses when inverting `!(cond)`", "tree": {"sha": "59104f78176ee7ebccb77ab90e9d26f0430d56f9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/59104f78176ee7ebccb77ab90e9d26f0430d56f9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2e7abf83844ef0c7d807262a682941f2aef9d3d9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2e7abf83844ef0c7d807262a682941f2aef9d3d9", "html_url": "https://github.com/rust-lang/rust/commit/2e7abf83844ef0c7d807262a682941f2aef9d3d9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2e7abf83844ef0c7d807262a682941f2aef9d3d9/comments", "author": {"login": "Jesse-Bakker", "id": 22473248, "node_id": "MDQ6VXNlcjIyNDczMjQ4", "avatar_url": "https://avatars.githubusercontent.com/u/22473248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jesse-Bakker", "html_url": "https://github.com/Jesse-Bakker", "followers_url": "https://api.github.com/users/Jesse-Bakker/followers", "following_url": "https://api.github.com/users/Jesse-Bakker/following{/other_user}", "gists_url": "https://api.github.com/users/Jesse-Bakker/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jesse-Bakker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jesse-Bakker/subscriptions", "organizations_url": "https://api.github.com/users/Jesse-Bakker/orgs", "repos_url": "https://api.github.com/users/Jesse-Bakker/repos", "events_url": "https://api.github.com/users/Jesse-Bakker/events{/privacy}", "received_events_url": "https://api.github.com/users/Jesse-Bakker/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Jesse-Bakker", "id": 22473248, "node_id": "MDQ6VXNlcjIyNDczMjQ4", "avatar_url": "https://avatars.githubusercontent.com/u/22473248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jesse-Bakker", "html_url": "https://github.com/Jesse-Bakker", "followers_url": "https://api.github.com/users/Jesse-Bakker/followers", "following_url": "https://api.github.com/users/Jesse-Bakker/following{/other_user}", "gists_url": "https://api.github.com/users/Jesse-Bakker/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jesse-Bakker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jesse-Bakker/subscriptions", "organizations_url": "https://api.github.com/users/Jesse-Bakker/orgs", "repos_url": "https://api.github.com/users/Jesse-Bakker/repos", "events_url": "https://api.github.com/users/Jesse-Bakker/events{/privacy}", "received_events_url": "https://api.github.com/users/Jesse-Bakker/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9bb9fbab3ab603150990ef8f2df12bddc7104058", "url": "https://api.github.com/repos/rust-lang/rust/commits/9bb9fbab3ab603150990ef8f2df12bddc7104058", "html_url": "https://github.com/rust-lang/rust/commit/9bb9fbab3ab603150990ef8f2df12bddc7104058"}], "stats": {"total": 17, "additions": 16, "deletions": 1}, "files": [{"sha": "f9c33b3f7d1c23a8600a66ee95e71a82c8b9e37e", "filename": "crates/assists/src/handlers/invert_if.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/2e7abf83844ef0c7d807262a682941f2aef9d3d9/crates%2Fassists%2Fsrc%2Fhandlers%2Finvert_if.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e7abf83844ef0c7d807262a682941f2aef9d3d9/crates%2Fassists%2Fsrc%2Fhandlers%2Finvert_if.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fassists%2Fsrc%2Fhandlers%2Finvert_if.rs?ref=2e7abf83844ef0c7d807262a682941f2aef9d3d9", "patch": "@@ -77,6 +77,15 @@ mod tests {\n         )\n     }\n \n+    #[test]\n+    fn invert_if_remove_not_parentheses() {\n+        check_assist(\n+            invert_if,\n+            \"fn f() { i<|>f !(x == 3 || x == 4 || x == 5) { 3 * 2 } else { 1 } }\",\n+            \"fn f() { if x == 3 || x == 4 || x == 5 { 1 } else { 3 * 2 } }\",\n+        )\n+    }\n+\n     #[test]\n     fn invert_if_remove_inequality() {\n         check_assist("}, {"sha": "d41084b59944daad1b91e6827bd2c3119b7ef730", "filename": "crates/assists/src/utils.rs", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/2e7abf83844ef0c7d807262a682941f2aef9d3d9/crates%2Fassists%2Fsrc%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2e7abf83844ef0c7d807262a682941f2aef9d3d9/crates%2Fassists%2Fsrc%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fassists%2Fsrc%2Futils.rs?ref=2e7abf83844ef0c7d807262a682941f2aef9d3d9", "patch": "@@ -232,7 +232,13 @@ fn invert_special_case(expr: &ast::Expr) -> Option<ast::Expr> {\n             };\n             Some(make::expr_method_call(receiver, method, arg_list))\n         }\n-        ast::Expr::PrefixExpr(pe) if pe.op_kind()? == ast::PrefixOp::Not => pe.expr(),\n+        ast::Expr::PrefixExpr(pe) if pe.op_kind()? == ast::PrefixOp::Not => {\n+            if let ast::Expr::ParenExpr(parexpr) = pe.expr()? {\n+                parexpr.expr()\n+            } else {\n+                pe.expr()\n+            }\n+        }\n         // FIXME:\n         // ast::Expr::Literal(true | false )\n         _ => None,"}]}