{"sha": "5aac75a8da40e66a9a127905e71379908b743d71", "node_id": "C_kwDOAAsO6NoAKDVhYWM3NWE4ZGE0MGU2NmE5YTEyNzkwNWU3MTM3OTkwOGI3NDNkNzE", "commit": {"author": {"name": "Yoshiki Matsuda", "email": "myskjp@gmail.com", "date": "2022-05-02T02:50:35Z"}, "committer": {"name": "Yoshiki Matsuda", "email": "myskjp@gmail.com", "date": "2022-07-02T13:54:36Z"}, "message": "import all necessary parts of rustc_metadata::fs", "tree": {"sha": "bc45113f9c79c243b87e2510cda14b46c3f09dbb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bc45113f9c79c243b87e2510cda14b46c3f09dbb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5aac75a8da40e66a9a127905e71379908b743d71", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5aac75a8da40e66a9a127905e71379908b743d71", "html_url": "https://github.com/rust-lang/rust/commit/5aac75a8da40e66a9a127905e71379908b743d71", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5aac75a8da40e66a9a127905e71379908b743d71/comments", "author": {"login": "m-ysk", "id": 47472854, "node_id": "MDQ6VXNlcjQ3NDcyODU0", "avatar_url": "https://avatars.githubusercontent.com/u/47472854?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ysk", "html_url": "https://github.com/m-ysk", "followers_url": "https://api.github.com/users/m-ysk/followers", "following_url": "https://api.github.com/users/m-ysk/following{/other_user}", "gists_url": "https://api.github.com/users/m-ysk/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ysk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ysk/subscriptions", "organizations_url": "https://api.github.com/users/m-ysk/orgs", "repos_url": "https://api.github.com/users/m-ysk/repos", "events_url": "https://api.github.com/users/m-ysk/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ysk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "m-ysk", "id": 47472854, "node_id": "MDQ6VXNlcjQ3NDcyODU0", "avatar_url": "https://avatars.githubusercontent.com/u/47472854?v=4", "gravatar_id": "", "url": "https://api.github.com/users/m-ysk", "html_url": "https://github.com/m-ysk", "followers_url": "https://api.github.com/users/m-ysk/followers", "following_url": "https://api.github.com/users/m-ysk/following{/other_user}", "gists_url": "https://api.github.com/users/m-ysk/gists{/gist_id}", "starred_url": "https://api.github.com/users/m-ysk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/m-ysk/subscriptions", "organizations_url": "https://api.github.com/users/m-ysk/orgs", "repos_url": "https://api.github.com/users/m-ysk/repos", "events_url": "https://api.github.com/users/m-ysk/events{/privacy}", "received_events_url": "https://api.github.com/users/m-ysk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1c2cc687a7b39e8ca2ed52649185f438a52ced3a", "url": "https://api.github.com/repos/rust-lang/rust/commits/1c2cc687a7b39e8ca2ed52649185f438a52ced3a", "html_url": "https://github.com/rust-lang/rust/commit/1c2cc687a7b39e8ca2ed52649185f438a52ced3a"}], "stats": {"total": 7, "additions": 4, "deletions": 3}, "files": [{"sha": "1051b1eb59389a9ebb91f52e483310aaf0bfcd16", "filename": "compiler/rustc_codegen_ssa/src/back/link.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/5aac75a8da40e66a9a127905e71379908b743d71/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5aac75a8da40e66a9a127905e71379908b743d71/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs?ref=5aac75a8da40e66a9a127905e71379908b743d71", "patch": "@@ -6,6 +6,7 @@ use rustc_data_structures::temp_dir::MaybeTempDir;\n use rustc_errors::{ErrorGuaranteed, Handler};\n use rustc_fs_util::fix_windows_verbatim_for_gcc;\n use rustc_hir::def_id::CrateNum;\n+use rustc_metadata::fs::{emit_metadata, METADATA_FILENAME};\n use rustc_middle::middle::dependency_format::Linkage;\n use rustc_middle::middle::exported_symbols::SymbolExportKind;\n use rustc_session::config::{self, CFGuard, CrateType, DebugInfo, LdImpl, Strip};\n@@ -257,7 +258,7 @@ fn link_rlib<'a, B: ArchiveBuilder<'a>>(\n         RlibFlavor::Normal => {\n             let (metadata, metadata_position) =\n                 create_rmeta_file(sess, codegen_results.metadata.raw_data());\n-            let metadata = rustc_metadata::fs::emit_metadata(sess, &metadata, tmpdir);\n+            let metadata = emit_metadata(sess, &metadata, tmpdir);\n             match metadata_position {\n                 MetadataPosition::First => {\n                     // Most of the time metadata in rlib files is wrapped in a \"dummy\" object\n@@ -483,7 +484,7 @@ fn link_staticlib<'a, B: ArchiveBuilder<'a>>(\n \n         ab.add_archive(path, move |fname: &str| {\n             // Ignore metadata files, no matter the name.\n-            if fname == rustc_metadata::fs::METADATA_FILENAME {\n+            if fname == METADATA_FILENAME {\n                 return true;\n             }\n \n@@ -2455,7 +2456,7 @@ fn add_upstream_rust_crates<'a, B: ArchiveBuilder<'a>>(\n \n             let mut archive = <B as ArchiveBuilder>::new(sess, &dst);\n             if let Err(e) = archive.add_archive(cratepath, move |f| {\n-                if f == rustc_metadata::fs::METADATA_FILENAME {\n+                if f == METADATA_FILENAME {\n                     return true;\n                 }\n "}]}