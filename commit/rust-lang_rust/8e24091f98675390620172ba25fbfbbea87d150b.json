{"sha": "8e24091f98675390620172ba25fbfbbea87d150b", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhlMjQwOTFmOTg2NzUzOTA2MjAxNzJiYTI1ZmJmYmJlYTg3ZDE1MGI=", "commit": {"author": {"name": "Victor Berger", "email": "victor.berger@m4x.org", "date": "2015-08-06T10:47:10Z"}, "committer": {"name": "Victor Berger", "email": "victor.berger@m4x.org", "date": "2015-08-06T10:47:10Z"}, "message": "Factor inc/dec count methods.", "tree": {"sha": "94e2528e8eb662afed6d5492d50a71b88643bb70", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/94e2528e8eb662afed6d5492d50a71b88643bb70"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8e24091f98675390620172ba25fbfbbea87d150b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8e24091f98675390620172ba25fbfbbea87d150b", "html_url": "https://github.com/rust-lang/rust/commit/8e24091f98675390620172ba25fbfbbea87d150b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8e24091f98675390620172ba25fbfbbea87d150b/comments", "author": {"login": "elinorbgr", "id": 3009227, "node_id": "MDQ6VXNlcjMwMDkyMjc=", "avatar_url": "https://avatars.githubusercontent.com/u/3009227?v=4", "gravatar_id": "", "url": "https://api.github.com/users/elinorbgr", "html_url": "https://github.com/elinorbgr", "followers_url": "https://api.github.com/users/elinorbgr/followers", "following_url": "https://api.github.com/users/elinorbgr/following{/other_user}", "gists_url": "https://api.github.com/users/elinorbgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/elinorbgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/elinorbgr/subscriptions", "organizations_url": "https://api.github.com/users/elinorbgr/orgs", "repos_url": "https://api.github.com/users/elinorbgr/repos", "events_url": "https://api.github.com/users/elinorbgr/events{/privacy}", "received_events_url": "https://api.github.com/users/elinorbgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "elinorbgr", "id": 3009227, "node_id": "MDQ6VXNlcjMwMDkyMjc=", "avatar_url": "https://avatars.githubusercontent.com/u/3009227?v=4", "gravatar_id": "", "url": "https://api.github.com/users/elinorbgr", "html_url": "https://github.com/elinorbgr", "followers_url": "https://api.github.com/users/elinorbgr/followers", "following_url": "https://api.github.com/users/elinorbgr/following{/other_user}", "gists_url": "https://api.github.com/users/elinorbgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/elinorbgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/elinorbgr/subscriptions", "organizations_url": "https://api.github.com/users/elinorbgr/orgs", "repos_url": "https://api.github.com/users/elinorbgr/repos", "events_url": "https://api.github.com/users/elinorbgr/events{/privacy}", "received_events_url": "https://api.github.com/users/elinorbgr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "751675938edef0e904086b29dc4d15bdaf519a41", "url": "https://api.github.com/repos/rust-lang/rust/commits/751675938edef0e904086b29dc4d15bdaf519a41", "html_url": "https://github.com/rust-lang/rust/commit/751675938edef0e904086b29dc4d15bdaf519a41"}], "stats": {"total": 39, "additions": 30, "deletions": 9}, "files": [{"sha": "75b99bed431941445b5663525d1af47b1da7612e", "filename": "src/librustc_resolve/build_reduced_graph.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/8e24091f98675390620172ba25fbfbbea87d150b/src%2Flibrustc_resolve%2Fbuild_reduced_graph.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e24091f98675390620172ba25fbfbbea87d150b/src%2Flibrustc_resolve%2Fbuild_reduced_graph.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fbuild_reduced_graph.rs?ref=8e24091f98675390620172ba25fbfbbea87d150b", "patch": "@@ -928,7 +928,7 @@ impl<'a, 'b:'a, 'tcx:'b> GraphBuilder<'a, 'b, 'tcx> {\n         self.unresolved_imports += 1;\n \n         if is_public {\n-            module_.pub_count.set(module_.pub_count.get() + 1);\n+            module_.inc_pub_count();\n         }\n \n         // Bump the reference count on the name. Or, if this is a glob, set\n@@ -963,9 +963,9 @@ impl<'a, 'b:'a, 'tcx:'b> GraphBuilder<'a, 'b, 'tcx> {\n                 // Set the glob flag. This tells us that we don't know the\n                 // module's exports ahead of time.\n \n-                module_.glob_count.set(module_.glob_count.get() + 1);\n+                module_.inc_glob_count();\n                 if is_public {\n-                    module_.pub_glob_count.set(module_.pub_glob_count.get() + 1);\n+                    module_.inc_pub_glob_count();\n                 }\n             }\n         }"}, {"sha": "50a8c5885338567702df8494982b93a589e26d30", "filename": "src/librustc_resolve/lib.rs", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/8e24091f98675390620172ba25fbfbbea87d150b/src%2Flibrustc_resolve%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e24091f98675390620172ba25fbfbbea87d150b/src%2Flibrustc_resolve%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Flib.rs?ref=8e24091f98675390620172ba25fbfbbea87d150b", "patch": "@@ -749,6 +749,30 @@ impl Module {\n     }\n }\n \n+impl Module {\n+    pub fn inc_glob_count(&self) {\n+        self.glob_count.set(self.glob_count.get() + 1);\n+    }\n+    pub fn dec_glob_count(&self) {\n+        assert!(self.glob_count.get() > 0);\n+        self.glob_count.set(self.glob_count.get() - 1);\n+    }\n+    pub fn inc_pub_count(&self) {\n+        self.pub_count.set(self.pub_count.get() + 1);\n+    }\n+    pub fn dec_pub_count(&self) {\n+        assert!(self.pub_count.get() > 0);\n+        self.pub_count.set(self.pub_count.get() - 1);\n+    }\n+    pub fn inc_pub_glob_count(&self) {\n+        self.pub_glob_count.set(self.pub_glob_count.get() + 1);\n+    }\n+    pub fn dec_pub_glob_count(&self) {\n+        assert!(self.pub_glob_count.get() > 0);\n+        self.pub_glob_count.set(self.pub_glob_count.get() - 1);\n+    }\n+}\n+\n impl fmt::Debug for Module {\n     fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n         write!(f, \"{:?}, kind: {:?}, {}\","}, {"sha": "bab9f19bbffd0e87956fe7fad9648c93f1f4d462", "filename": "src/librustc_resolve/resolve_imports.rs", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/8e24091f98675390620172ba25fbfbbea87d150b/src%2Flibrustc_resolve%2Fresolve_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8e24091f98675390620172ba25fbfbbea87d150b/src%2Flibrustc_resolve%2Fresolve_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fresolve_imports.rs?ref=8e24091f98675390620172ba25fbfbbea87d150b", "patch": "@@ -407,20 +407,17 @@ impl<'a, 'b:'a, 'tcx:'b> ImportResolver<'a, 'b, 'tcx> {\n         if resolution_result.success() {\n             match import_directive.subclass {\n                 GlobImport => {\n-                    assert!(module_.glob_count.get() >= 1);\n-                    module_.glob_count.set(module_.glob_count.get() - 1);\n+                    module_.dec_glob_count();\n                     if import_directive.is_public {\n-                        assert!(module_.pub_glob_count.get() >= 1);\n-                        module_.pub_glob_count.set(module_.pub_glob_count.get() - 1);\n+                        module_.dec_pub_glob_count();\n                     }\n                 }\n                 SingleImport(..) => {\n                     // Ignore.\n                 }\n             }\n             if import_directive.is_public {\n-                assert!(module_.pub_count.get() >= 1);\n-                module_.pub_count.set(module_.pub_count.get() - 1);\n+                module_.dec_pub_count();\n             }\n         }\n "}]}