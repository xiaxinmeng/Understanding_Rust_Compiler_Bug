{"sha": "1e578c9fb051ed3a4e608a43d840ad2877701333", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFlNTc4YzlmYjA1MWVkM2E0ZTYwOGE0M2Q4NDBhZDI4Nzc3MDEzMzM=", "commit": {"author": {"name": "CAD97", "email": "cad97@cad97.com", "date": "2021-01-07T17:50:31Z"}, "committer": {"name": "CAD97", "email": "cad97@cad97.com", "date": "2021-01-07T17:53:04Z"}, "message": "Reclarify Weak<->raw pointer safety comments", "tree": {"sha": "ce58851ba60523b8641c76d04f1d129029f164d7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ce58851ba60523b8641c76d04f1d129029f164d7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1e578c9fb051ed3a4e608a43d840ad2877701333", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1e578c9fb051ed3a4e608a43d840ad2877701333", "html_url": "https://github.com/rust-lang/rust/commit/1e578c9fb051ed3a4e608a43d840ad2877701333", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1e578c9fb051ed3a4e608a43d840ad2877701333/comments", "author": {"login": "CAD97", "id": 5992217, "node_id": "MDQ6VXNlcjU5OTIyMTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5992217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CAD97", "html_url": "https://github.com/CAD97", "followers_url": "https://api.github.com/users/CAD97/followers", "following_url": "https://api.github.com/users/CAD97/following{/other_user}", "gists_url": "https://api.github.com/users/CAD97/gists{/gist_id}", "starred_url": "https://api.github.com/users/CAD97/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CAD97/subscriptions", "organizations_url": "https://api.github.com/users/CAD97/orgs", "repos_url": "https://api.github.com/users/CAD97/repos", "events_url": "https://api.github.com/users/CAD97/events{/privacy}", "received_events_url": "https://api.github.com/users/CAD97/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CAD97", "id": 5992217, "node_id": "MDQ6VXNlcjU5OTIyMTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5992217?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CAD97", "html_url": "https://github.com/CAD97", "followers_url": "https://api.github.com/users/CAD97/followers", "following_url": "https://api.github.com/users/CAD97/following{/other_user}", "gists_url": "https://api.github.com/users/CAD97/gists{/gist_id}", "starred_url": "https://api.github.com/users/CAD97/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CAD97/subscriptions", "organizations_url": "https://api.github.com/users/CAD97/orgs", "repos_url": "https://api.github.com/users/CAD97/repos", "events_url": "https://api.github.com/users/CAD97/events{/privacy}", "received_events_url": "https://api.github.com/users/CAD97/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b10b9e25ffcb06077375960f07a0c6443184f07a", "url": "https://api.github.com/repos/rust-lang/rust/commits/b10b9e25ffcb06077375960f07a0c6443184f07a", "html_url": "https://github.com/rust-lang/rust/commit/b10b9e25ffcb06077375960f07a0c6443184f07a"}], "stats": {"total": 8, "additions": 4, "deletions": 4}, "files": [{"sha": "dd7710e5c051ac641bc05272dc8b40c92afcecd9", "filename": "library/alloc/src/rc.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1e578c9fb051ed3a4e608a43d840ad2877701333/library%2Falloc%2Fsrc%2Frc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e578c9fb051ed3a4e608a43d840ad2877701333/library%2Falloc%2Fsrc%2Frc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Frc.rs?ref=1e578c9fb051ed3a4e608a43d840ad2877701333", "patch": "@@ -1899,7 +1899,7 @@ impl<T: ?Sized> Weak<T> {\n             // a valid pointer, so that `from_raw` can reverse this transformation.\n             (ptr as *mut T).set_ptr_value(ptr::null_mut())\n         } else {\n-            // SAFETY: If the pointer is not dangling, it references a valid allocation.\n+            // SAFETY: if is_dangling returns false, then the pointer is dereferencable.\n             // The payload may be dropped at this point, and we have to maintain provenance,\n             // so use raw pointer manipulation.\n             unsafe { &raw mut (*ptr).value }\n@@ -1991,7 +1991,7 @@ impl<T: ?Sized> Weak<T> {\n             // SAFETY: this is the same sentinel as used in Weak::new and is_dangling\n             (ptr as *mut RcBox<T>).set_ptr_value(usize::MAX as *mut _)\n         } else {\n-            // Otherwise, this references a real allocation.\n+            // Otherwise, we're guaranteed the pointer came from a nondangling Weak.\n             // SAFETY: data_offset is safe to call, as ptr references a real (potentially dropped) T.\n             let offset = unsafe { data_offset(ptr) };\n             // Thus, we reverse the offset to get the whole RcBox."}, {"sha": "6241ee626f7f023d77b94a47f9ba1f62feebafcf", "filename": "library/alloc/src/sync.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/1e578c9fb051ed3a4e608a43d840ad2877701333/library%2Falloc%2Fsrc%2Fsync.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1e578c9fb051ed3a4e608a43d840ad2877701333/library%2Falloc%2Fsrc%2Fsync.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fsync.rs?ref=1e578c9fb051ed3a4e608a43d840ad2877701333", "patch": "@@ -1685,7 +1685,7 @@ impl<T: ?Sized> Weak<T> {\n             // a valid pointer, so that `from_raw` can reverse this transformation.\n             (ptr as *mut T).set_ptr_value(ptr::null_mut())\n         } else {\n-            // SAFETY: If the pointer is not dangling, it references a valid allocation.\n+            // SAFETY: if is_dangling returns false, then the pointer is dereferencable.\n             // The payload may be dropped at this point, and we have to maintain provenance,\n             // so use raw pointer manipulation.\n             unsafe { &raw mut (*ptr).data }\n@@ -1777,7 +1777,7 @@ impl<T: ?Sized> Weak<T> {\n             // SAFETY: this is the same sentinel as used in Weak::new and is_dangling\n             (ptr as *mut ArcInner<T>).set_ptr_value(usize::MAX as *mut _)\n         } else {\n-            // Otherwise, this references a real allocation.\n+            // Otherwise, we're guaranteed the pointer came from a nondangling Weak.\n             // SAFETY: data_offset is safe to call, as ptr references a real (potentially dropped) T.\n             let offset = unsafe { data_offset(ptr) };\n             // Thus, we reverse the offset to get the whole RcBox."}]}