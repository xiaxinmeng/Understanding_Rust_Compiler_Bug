{"sha": "af664be4230d4052df32e7821a4a85ae9d13a474", "node_id": "C_kwDOAAsO6NoAKGFmNjY0YmU0MjMwZDQwNTJkZjMyZTc4MjFhNGE4NWFlOWQxM2E0NzQ", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2023-03-03T01:21:26Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2023-03-04T18:54:28Z"}, "message": "rustdoc: include link on all.html location header\n\nThis avoids a subtle layout shift when switching from the crate page\nto all items.", "tree": {"sha": "1a7db33aa22264d7039d5ab1843d8f61042f98e1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1a7db33aa22264d7039d5ab1843d8f61042f98e1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/af664be4230d4052df32e7821a4a85ae9d13a474", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/af664be4230d4052df32e7821a4a85ae9d13a474", "html_url": "https://github.com/rust-lang/rust/commit/af664be4230d4052df32e7821a4a85ae9d13a474", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/af664be4230d4052df32e7821a4a85ae9d13a474/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "13471d3b2046cce78181dde6cfc146c09f55e29e", "url": "https://api.github.com/repos/rust-lang/rust/commits/13471d3b2046cce78181dde6cfc146c09f55e29e", "html_url": "https://github.com/rust-lang/rust/commit/13471d3b2046cce78181dde6cfc146c09f55e29e"}], "stats": {"total": 18, "additions": 15, "deletions": 3}, "files": [{"sha": "1030fe747475856f9fa6f8b1084ba388773571e1", "filename": "src/librustdoc/html/render/context.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/af664be4230d4052df32e7821a4a85ae9d13a474/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/af664be4230d4052df32e7821a4a85ae9d13a474/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fcontext.rs?ref=af664be4230d4052df32e7821a4a85ae9d13a474", "patch": "@@ -600,9 +600,7 @@ impl<'tcx> FormatRenderer<'tcx> for Context<'tcx> {\n         };\n         let all = shared.all.replace(AllTypes::new());\n         let mut sidebar = Buffer::html();\n-        if shared.cache.crate_version.is_some() {\n-            write!(sidebar, \"<h2 class=\\\"location\\\">Crate {}</h2>\", crate_name)\n-        };\n+        write!(sidebar, \"<h2 class=\\\"location\\\"><a href=\\\"#\\\">Crate {}</a></h2>\", crate_name);\n \n         let mut items = Buffer::html();\n         sidebar_module_like(&mut items, all.item_sections());"}, {"sha": "473ab8fc960c560e8a75034f8aebf0057c89ce2e", "filename": "tests/rustdoc-gui/sidebar.goml", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/af664be4230d4052df32e7821a4a85ae9d13a474/tests%2Frustdoc-gui%2Fsidebar.goml", "raw_url": "https://github.com/rust-lang/rust/raw/af664be4230d4052df32e7821a4a85ae9d13a474/tests%2Frustdoc-gui%2Fsidebar.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frustdoc-gui%2Fsidebar.goml?ref=af664be4230d4052df32e7821a4a85ae9d13a474", "patch": "@@ -149,3 +149,17 @@ assert-property: (\".sidebar\", {\"clientWidth\": \"200\"})\n click: \"#toggle-all-docs\"\n assert-text: (\"#toggle-all-docs\", \"[\u2212]\")\n assert-property: (\".sidebar\", {\"clientWidth\": \"200\"})\n+\n+// Checks that all.html and index.html have their sidebar link in the same place.\n+goto: \"file://\" + |DOC_PATH| + \"/test_docs/index.html\"\n+store-property: (index_sidebar_width, \".sidebar .location a\", \"clientWidth\")\n+store-property: (index_sidebar_height, \".sidebar .location a\", \"clientHeight\")\n+store-property: (index_sidebar_x, \".sidebar .location a\", \"offsetTop\")\n+store-property: (index_sidebar_y, \".sidebar .location a\", \"offsetLeft\")\n+goto: \"file://\" + |DOC_PATH| + \"/test_docs/all.html\"\n+assert-property: (\".sidebar .location a\", {\n+    \"clientWidth\": |index_sidebar_width|,\n+    \"clientHeight\": |index_sidebar_height|,\n+    \"offsetTop\": |index_sidebar_x|,\n+    \"offsetLeft\": |index_sidebar_y|,\n+})"}]}