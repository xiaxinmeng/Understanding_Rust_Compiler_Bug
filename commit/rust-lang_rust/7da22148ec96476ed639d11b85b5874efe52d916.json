{"sha": "7da22148ec96476ed639d11b85b5874efe52d916", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdkYTIyMTQ4ZWM5NjQ3NmVkNjM5ZDExYjg1YjU4NzRlZmU1MmQ5MTY=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-07-28T08:24:57Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-07-28T08:24:57Z"}, "message": "Rollup merge of #52703 - ljedrz:vec_improvements, r=nikomatsakis\n\nImprove a few vectors - calculate capacity or build from iterators\n\nCollecting from iterators improves readability and tailoring vector capacities should be beneficial in terms of performance.", "tree": {"sha": "5bf3fd20847378fccad42228bcbe0df481a3f3ee", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5bf3fd20847378fccad42228bcbe0df481a3f3ee"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7da22148ec96476ed639d11b85b5874efe52d916", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbXChZCRBK7hj4Ov3rIwAAdHIIAEhWhSTntNW/PAqvBpV26PBs\nitXEr7/Kg96TaqAwHle0WUUgCne+78VMvu1XzADORmCMOMC/xpB/6Io387qEcFI7\nUJKuBMkq5oo30offFiJuDlsKMSt6o+2Usby3+zzsoe5mkBFFUisi1Igela02JNvg\nrt2APfPOBwAjJzN7rh4wZdvUjcB5Gn8j03vfrhey5b+MNizQegLnic8BPvmz5xAP\nSAJAUiKub2ffseDxPNqh2pB/UkY01SaSxAuk60/2ZCM6KXETOTzeGngt3U0KXVNc\nzgEi2ZDDsZoM83WtYQM6PLruMC7ZQofoHVXoxSJB6w7SGwUFem6vnqPTspFemic=\n=lGm1\n-----END PGP SIGNATURE-----\n", "payload": "tree 5bf3fd20847378fccad42228bcbe0df481a3f3ee\nparent 80c798b982d972261705f72f4585959476fbcf73\nparent acd38f656ad20166f25f527530ddc32a523c9e97\nauthor kennytm <kennytm@gmail.com> 1532766297 +0800\ncommitter GitHub <noreply@github.com> 1532766297 +0800\n\nRollup merge of #52703 - ljedrz:vec_improvements, r=nikomatsakis\n\nImprove a few vectors - calculate capacity or build from iterators\n\nCollecting from iterators improves readability and tailoring vector capacities should be beneficial in terms of performance.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7da22148ec96476ed639d11b85b5874efe52d916", "html_url": "https://github.com/rust-lang/rust/commit/7da22148ec96476ed639d11b85b5874efe52d916", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7da22148ec96476ed639d11b85b5874efe52d916/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "80c798b982d972261705f72f4585959476fbcf73", "url": "https://api.github.com/repos/rust-lang/rust/commits/80c798b982d972261705f72f4585959476fbcf73", "html_url": "https://github.com/rust-lang/rust/commit/80c798b982d972261705f72f4585959476fbcf73"}, {"sha": "acd38f656ad20166f25f527530ddc32a523c9e97", "url": "https://api.github.com/repos/rust-lang/rust/commits/acd38f656ad20166f25f527530ddc32a523c9e97", "html_url": "https://github.com/rust-lang/rust/commit/acd38f656ad20166f25f527530ddc32a523c9e97"}], "stats": {"total": 35, "additions": 14, "deletions": 21}, "files": [{"sha": "a17c160c4d03e5340051d6597dd69ab1a7ed59cf", "filename": "src/librustc/hir/map/hir_id_validator.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7da22148ec96476ed639d11b85b5874efe52d916/src%2Flibrustc%2Fhir%2Fmap%2Fhir_id_validator.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7da22148ec96476ed639d11b85b5874efe52d916/src%2Flibrustc%2Fhir%2Fmap%2Fhir_id_validator.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fhir%2Fmap%2Fhir_id_validator.rs?ref=7da22148ec96476ed639d11b85b5874efe52d916", "patch": "@@ -105,7 +105,7 @@ impl<'a, 'hir: 'a> HirIdValidator<'a, 'hir> {\n               .collect();\n \n             // Try to map those to something more useful\n-            let mut missing_items = vec![];\n+            let mut missing_items = Vec::with_capacity(missing.len());\n \n             for local_id in missing {\n                 let hir_id = HirId {"}, {"sha": "b8991a0366a61d0672e3ff214bcfa682a8b24b72", "filename": "src/librustc/infer/outlives/obligations.rs", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7da22148ec96476ed639d11b85b5874efe52d916/src%2Flibrustc%2Finfer%2Foutlives%2Fobligations.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7da22148ec96476ed639d11b85b5874efe52d916/src%2Flibrustc%2Finfer%2Foutlives%2Fobligations.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Finfer%2Foutlives%2Fobligations.rs?ref=7da22148ec96476ed639d11b85b5874efe52d916", "patch": "@@ -505,11 +505,7 @@ where\n     }\n \n     fn recursive_type_bound(&self, ty: Ty<'tcx>) -> VerifyBound<'tcx> {\n-        let mut bounds = vec![];\n-\n-        for subty in ty.walk_shallow() {\n-            bounds.push(self.type_bound(subty));\n-        }\n+        let mut bounds = ty.walk_shallow().map(|subty| self.type_bound(subty)).collect::<Vec<_>>();\n \n         let mut regions = ty.regions();\n         regions.retain(|r| !r.is_late_bound()); // ignore late-bound regions"}, {"sha": "14cfaa8153377d76f1adbdcc6c5acac35ffc2a66", "filename": "src/librustc/lint/context.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/7da22148ec96476ed639d11b85b5874efe52d916/src%2Flibrustc%2Flint%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7da22148ec96476ed639d11b85b5874efe52d916/src%2Flibrustc%2Flint%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Flint%2Fcontext.rs?ref=7da22148ec96476ed639d11b85b5874efe52d916", "patch": "@@ -219,7 +219,7 @@ impl LintStore {\n             }\n         }\n \n-        let mut future_incompatible = vec![];\n+        let mut future_incompatible = Vec::with_capacity(lints.len());\n         for lint in lints {\n             future_incompatible.push(lint.id);\n             self.future_incompatible.insert(lint.id, lint);"}, {"sha": "aa4f63675d7341dbab16834fc61ecf64c88fc3f5", "filename": "src/librustc/traits/object_safety.rs", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/7da22148ec96476ed639d11b85b5874efe52d916/src%2Flibrustc%2Ftraits%2Fobject_safety.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7da22148ec96476ed639d11b85b5874efe52d916/src%2Flibrustc%2Ftraits%2Fobject_safety.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Ftraits%2Fobject_safety.rs?ref=7da22148ec96476ed639d11b85b5874efe52d916", "patch": "@@ -98,13 +98,10 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n     pub fn astconv_object_safety_violations(self, trait_def_id: DefId)\n                                             -> Vec<ObjectSafetyViolation>\n     {\n-        let mut violations = vec![];\n-\n-        for def_id in traits::supertrait_def_ids(self, trait_def_id) {\n-            if self.predicates_reference_self(def_id, true) {\n-                violations.push(ObjectSafetyViolation::SupertraitSelf);\n-            }\n-        }\n+        let violations = traits::supertrait_def_ids(self, trait_def_id)\n+            .filter(|&def_id| self.predicates_reference_self(def_id, true))\n+            .map(|_| ObjectSafetyViolation::SupertraitSelf)\n+            .collect();\n \n         debug!(\"astconv_object_safety_violations(trait_def_id={:?}) = {:?}\",\n                trait_def_id,"}, {"sha": "13f0c90e8855e7efd5d20c5e8a4a27da47af6433", "filename": "src/librustc_codegen_llvm/back/link.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/7da22148ec96476ed639d11b85b5874efe52d916/src%2Flibrustc_codegen_llvm%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7da22148ec96476ed639d11b85b5874efe52d916/src%2Flibrustc_codegen_llvm%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fback%2Flink.rs?ref=7da22148ec96476ed639d11b85b5874efe52d916", "patch": "@@ -40,6 +40,7 @@ use std::env;\n use std::fmt;\n use std::fs;\n use std::io;\n+use std::iter;\n use std::path::{Path, PathBuf};\n use std::process::{Output, Stdio};\n use std::str;\n@@ -885,9 +886,9 @@ fn exec_linker(sess: &Session, cmd: &mut Command, out_filename: &Path, tmpdir: &\n     }\n     let file = tmpdir.join(\"linker-arguments\");\n     let bytes = if sess.target.target.options.is_like_msvc {\n-        let mut out = vec![];\n+        let mut out = Vec::with_capacity((1 + args.len()) * 2);\n         // start the stream with a UTF-16 BOM\n-        for c in vec![0xFEFF].into_iter().chain(args.encode_utf16()) {\n+        for c in iter::once(0xFEFF).chain(args.encode_utf16()) {\n             // encode in little endian\n             out.push(c as u8);\n             out.push((c >> 8) as u8);"}, {"sha": "734f76e499908b172899792e527b540d8877fde7", "filename": "src/libsyntax_pos/lib.rs", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/7da22148ec96476ed639d11b85b5874efe52d916/src%2Flibsyntax_pos%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7da22148ec96476ed639d11b85b5874efe52d916/src%2Flibsyntax_pos%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_pos%2Flib.rs?ref=7da22148ec96476ed639d11b85b5874efe52d916", "patch": "@@ -632,15 +632,14 @@ impl MultiSpan {\n     /// `SpanLabel` instances with empty labels.\n     pub fn span_labels(&self) -> Vec<SpanLabel> {\n         let is_primary = |span| self.primary_spans.contains(&span);\n-        let mut span_labels = vec![];\n \n-        for &(span, ref label) in &self.span_labels {\n-            span_labels.push(SpanLabel {\n+        let mut span_labels = self.span_labels.iter().map(|&(span, ref label)|\n+            SpanLabel {\n                 span,\n                 is_primary: is_primary(span),\n                 label: Some(label.clone())\n-            });\n-        }\n+            }\n+        ).collect::<Vec<_>>();\n \n         for &span in &self.primary_spans {\n             if !span_labels.iter().any(|sl| sl.span == span) {"}]}