{"sha": "42174308a277f3d3f774abbcf42f58de0288d272", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQyMTc0MzA4YTI3N2YzZDNmNzc0YWJiY2Y0MmY1OGRlMDI4OGQyNzI=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2021-05-19T22:18:57Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-05-19T22:18:57Z"}, "message": "Rollup merge of #85169 - jsha:hoist-classes, r=GuillaumeGomez\n\nAdd method-toggle to <details> for methods\n\nThe makes the code for handling \"auto-hide\" settings more consistent.\n\nDemo at https://hoffman-andrews.com/rust/hoist-classes/std/string/struct.String.html\n\nFixes #84829", "tree": {"sha": "4ed2c5e67a2ab120f54226c7ac248716391897df", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4ed2c5e67a2ab120f54226c7ac248716391897df"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/42174308a277f3d3f774abbcf42f58de0288d272", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgpY7RCRBK7hj4Ov3rIwAAGFQIAGpWDonUv6dZqe0uYTQoToR5\nTOHEC65mpO8MAvAgpcY7Eu9S6tak1cZFLCH7GQ6uvpeu6tACNJfcm96QAyQLpiQG\nByen8m8+LCUVAmmHzSGDdX34IOnf0Btdry34z0hfI8KDjw9pmuUrekVCXFMhJ00Z\nDEo3q3dXyiVeX5tSNPcUbWIpDp+axBTzo8bBt+lXszNvGuhl1ulzMbZK7keeVJ3h\nhueUk5GgH5c3G8xROHSQm3WxJ7c66cnjkQZCwRwLgUWxuORV207QwHxILREyFxY+\nXnbii0YLwC7MYuEj6r4oWVWpCf1NYd5h4K1rWk7SP4AD8YRdSL/jj+BIFBi0OuE=\n=55R2\n-----END PGP SIGNATURE-----\n", "payload": "tree 4ed2c5e67a2ab120f54226c7ac248716391897df\nparent a1ac37289404cef53467e09bd3ff7e13ceb18bb6\nparent 24480ded58c9867439cfabba4198e1877c1fd166\nauthor Ralf Jung <post@ralfj.de> 1621462737 +0200\ncommitter GitHub <noreply@github.com> 1621462737 +0200\n\nRollup merge of #85169 - jsha:hoist-classes, r=GuillaumeGomez\n\nAdd method-toggle to <details> for methods\n\nThe makes the code for handling \"auto-hide\" settings more consistent.\n\nDemo at https://hoffman-andrews.com/rust/hoist-classes/std/string/struct.String.html\n\nFixes #84829\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/42174308a277f3d3f774abbcf42f58de0288d272", "html_url": "https://github.com/rust-lang/rust/commit/42174308a277f3d3f774abbcf42f58de0288d272", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/42174308a277f3d3f774abbcf42f58de0288d272/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a1ac37289404cef53467e09bd3ff7e13ceb18bb6", "url": "https://api.github.com/repos/rust-lang/rust/commits/a1ac37289404cef53467e09bd3ff7e13ceb18bb6", "html_url": "https://github.com/rust-lang/rust/commit/a1ac37289404cef53467e09bd3ff7e13ceb18bb6"}, {"sha": "24480ded58c9867439cfabba4198e1877c1fd166", "url": "https://api.github.com/repos/rust-lang/rust/commits/24480ded58c9867439cfabba4198e1877c1fd166", "html_url": "https://github.com/rust-lang/rust/commit/24480ded58c9867439cfabba4198e1877c1fd166"}], "stats": {"total": 25, "additions": 10, "deletions": 15}, "files": [{"sha": "318e1b44f86830f427b2a5fe1e2ae56a1f988beb", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/42174308a277f3d3f774abbcf42f58de0288d272/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/42174308a277f3d3f774abbcf42f58de0288d272/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=42174308a277f3d3f774abbcf42f58de0288d272", "patch": "@@ -1352,8 +1352,11 @@ fn render_impl(\n         }\n         let w = if short_documented && trait_.is_some() { interesting } else { boring };\n \n-        if !doc_buffer.is_empty() {\n-            w.write_str(\"<details class=\\\"rustdoc-toggle\\\" open><summary>\");\n+        let toggled = !doc_buffer.is_empty();\n+        if toggled {\n+            let method_toggle_class =\n+                if item_type == ItemType::Method { \" method-toggle\" } else { \"\" };\n+            write!(w, \"<details class=\\\"rustdoc-toggle{}\\\" open><summary>\", method_toggle_class);\n         }\n         match *item.kind {\n             clean::MethodItem(..) | clean::TyMethodItem(_) => {\n@@ -1453,7 +1456,7 @@ fn render_impl(\n         }\n \n         w.push_buffer(info_buffer);\n-        if !doc_buffer.is_empty() {\n+        if toggled {\n             w.write_str(\"</summary>\");\n             w.push_buffer(doc_buffer);\n             w.push_str(\"</details>\");"}, {"sha": "8204949267250fd09fb10ae732176196835f1be2", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 4, "deletions": 12, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/42174308a277f3d3f774abbcf42f58de0288d272/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/42174308a277f3d3f774abbcf42f58de0288d272/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=42174308a277f3d3f774abbcf42f58de0288d272", "patch": "@@ -924,24 +924,16 @@ function hideThemeButtonState() {\n             });\n         }\n \n-        if (hideMethodDocs) {\n-            onEachLazy(document.getElementsByClassName(\"method\"), function(e) {\n-                var toggle = e.parentNode;\n-                if (toggle) {\n-                    toggle = toggle.parentNode;\n-                }\n-                if (toggle && toggle.tagName === \"DETAILS\") {\n-                    toggle.open = false;\n-                }\n-            });\n-        }\n-\n         onEachLazy(document.getElementsByTagName(\"details\"), function (e) {\n             var showLargeItem = !hideLargeItemContents && hasClass(e, \"type-contents-toggle\");\n             var showImplementor = !hideImplementors && hasClass(e, \"implementors-toggle\");\n             if (showLargeItem || showImplementor) {\n                 e.open = true;\n             }\n+            if (hideMethodDocs && hasClass(e, \"method-toggle\")) {\n+                e.open = false;\n+            }\n+\n         });\n \n         var currentType = document.getElementsByClassName(\"type-decl\")[0];"}]}