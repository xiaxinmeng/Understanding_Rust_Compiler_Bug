{"sha": "c08ddaaa48074040eeecf75e243cb5cbc19f4eaf", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMwOGRkYWFhNDgwNzQwNDBlZWVjZjc1ZTI0M2NiNWNiYzE5ZjRlYWY=", "commit": {"author": {"name": "Scott Olson", "email": "scott@solson.me", "date": "2016-04-06T10:08:52Z"}, "committer": {"name": "Scott Olson", "email": "scott@solson.me", "date": "2016-04-06T10:08:52Z"}, "message": "Implement a naive, slow version of undef mask copying.", "tree": {"sha": "5141857f6246db7cc487e8eebf102b777a344349", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5141857f6246db7cc487e8eebf102b777a344349"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c08ddaaa48074040eeecf75e243cb5cbc19f4eaf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c08ddaaa48074040eeecf75e243cb5cbc19f4eaf", "html_url": "https://github.com/rust-lang/rust/commit/c08ddaaa48074040eeecf75e243cb5cbc19f4eaf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c08ddaaa48074040eeecf75e243cb5cbc19f4eaf/comments", "author": {"login": "solson", "id": 26806, "node_id": "MDQ6VXNlcjI2ODA2", "avatar_url": "https://avatars.githubusercontent.com/u/26806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/solson", "html_url": "https://github.com/solson", "followers_url": "https://api.github.com/users/solson/followers", "following_url": "https://api.github.com/users/solson/following{/other_user}", "gists_url": "https://api.github.com/users/solson/gists{/gist_id}", "starred_url": "https://api.github.com/users/solson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/solson/subscriptions", "organizations_url": "https://api.github.com/users/solson/orgs", "repos_url": "https://api.github.com/users/solson/repos", "events_url": "https://api.github.com/users/solson/events{/privacy}", "received_events_url": "https://api.github.com/users/solson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "solson", "id": 26806, "node_id": "MDQ6VXNlcjI2ODA2", "avatar_url": "https://avatars.githubusercontent.com/u/26806?v=4", "gravatar_id": "", "url": "https://api.github.com/users/solson", "html_url": "https://github.com/solson", "followers_url": "https://api.github.com/users/solson/followers", "following_url": "https://api.github.com/users/solson/following{/other_user}", "gists_url": "https://api.github.com/users/solson/gists{/gist_id}", "starred_url": "https://api.github.com/users/solson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/solson/subscriptions", "organizations_url": "https://api.github.com/users/solson/orgs", "repos_url": "https://api.github.com/users/solson/repos", "events_url": "https://api.github.com/users/solson/events{/privacy}", "received_events_url": "https://api.github.com/users/solson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8a0aa9291a423cd031d040b1d7a38d728cc6d60a", "url": "https://api.github.com/repos/rust-lang/rust/commits/8a0aa9291a423cd031d040b1d7a38d728cc6d60a", "html_url": "https://github.com/rust-lang/rust/commit/8a0aa9291a423cd031d040b1d7a38d728cc6d60a"}], "stats": {"total": 25, "additions": 23, "deletions": 2}, "files": [{"sha": "c8f19fa165fa5bad407ced2c6be66e422e80619c", "filename": "src/memory.rs", "status": "modified", "additions": 18, "deletions": 2, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/c08ddaaa48074040eeecf75e243cb5cbc19f4eaf/src%2Fmemory.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c08ddaaa48074040eeecf75e243cb5cbc19f4eaf/src%2Fmemory.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmemory.rs?ref=c08ddaaa48074040eeecf75e243cb5cbc19f4eaf", "patch": "@@ -225,8 +225,10 @@ impl Memory {\n             }\n         }\n \n-        // TODO(tsion): Copy undef ranges from src to dest.\n-        self.copy_relocations(src, dest, size)\n+        try!(self.copy_undef_mask(src, dest, size));\n+        try!(self.copy_relocations(src, dest, size));\n+\n+        Ok(())\n     }\n \n     pub fn write_bytes(&mut self, ptr: Pointer, src: &[u8]) -> EvalResult<()> {\n@@ -379,6 +381,20 @@ impl Memory {\n     // Undefined bytes\n     ////////////////////////////////////////////////////////////////////////////////\n \n+    // FIXME(tsino): This is a very naive, slow version.\n+    fn copy_undef_mask(&mut self, src: Pointer, dest: Pointer, size: usize) -> EvalResult<()> {\n+        // The bits have to be saved locally before writing to dest in case src and dest overlap.\n+        let mut v = Vec::with_capacity(size);\n+        for i in 0..size {\n+            let defined = try!(self.get(src.alloc_id)).undef_mask.get(src.offset + i);\n+            v.push(defined);\n+        }\n+        for (i, defined) in v.into_iter().enumerate() {\n+            try!(self.get_mut(dest.alloc_id)).undef_mask.set(dest.offset + i, defined);\n+        }\n+        Ok(())\n+    }\n+\n     fn check_defined(&self, ptr: Pointer, size: usize) -> EvalResult<()> {\n         let alloc = try!(self.get(ptr.alloc_id));\n         if !alloc.undef_mask.is_range_defined(ptr.offset, ptr.offset + size) {"}, {"sha": "67257050364c9d0da0cdb65c7bd4851f9606f0d3", "filename": "test/sums.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c08ddaaa48074040eeecf75e243cb5cbc19f4eaf/test%2Fsums.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c08ddaaa48074040eeecf75e243cb5cbc19f4eaf/test%2Fsums.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/test%2Fsums.rs?ref=c08ddaaa48074040eeecf75e243cb5cbc19f4eaf", "patch": "@@ -47,3 +47,8 @@ fn match_opt_some() -> i8 {\n         None => 20,\n     }\n }\n+\n+#[miri_run]\n+fn two_nones() -> (Option<i16>, Option<i16>) {\n+    (None, None)\n+}"}]}