{"sha": "4bfa269fe7ce48c7cd54404b4f74c48e0e7895ea", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRiZmEyNjlmZTdjZTQ4YzdjZDU0NDA0YjRmNzRjNDhlMGU3ODk1ZWE=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-07-08T01:33:59Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-07-08T16:37:00Z"}, "message": "Move used_libraries from session to cstore", "tree": {"sha": "3d0d7d8cbdd9a6292662ac5450332bb4e810c519", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3d0d7d8cbdd9a6292662ac5450332bb4e810c519"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4bfa269fe7ce48c7cd54404b4f74c48e0e7895ea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4bfa269fe7ce48c7cd54404b4f74c48e0e7895ea", "html_url": "https://github.com/rust-lang/rust/commit/4bfa269fe7ce48c7cd54404b4f74c48e0e7895ea", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4bfa269fe7ce48c7cd54404b4f74c48e0e7895ea/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1386420cad0ed926de268dff0648a815c317c032", "url": "https://api.github.com/repos/rust-lang/rust/commits/1386420cad0ed926de268dff0648a815c317c032", "html_url": "https://github.com/rust-lang/rust/commit/1386420cad0ed926de268dff0648a815c317c032"}], "stats": {"total": 43, "additions": 21, "deletions": 22}, "files": [{"sha": "27389e98762ca10ec6907a4e7ce68761114b6746", "filename": "src/comp/driver/rustc.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/4bfa269fe7ce48c7cd54404b4f74c48e0e7895ea/src%2Fcomp%2Fdriver%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4bfa269fe7ce48c7cd54404b4f74c48e0e7895ea/src%2Fcomp%2Fdriver%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fdriver%2Frustc.rs?ref=4bfa269fe7ce48c7cd54404b4f74c48e0e7895ea", "patch": "@@ -355,7 +355,7 @@ fn build_session(@session::options sopts) -> session::session {\n     auto target_cfg = build_target_config();\n     auto cstore = cstore::mk_cstore();\n     ret session::session(target_cfg, sopts, cstore,\n-                         [], [], codemap::new_codemap(), 0u);\n+                         [], codemap::new_codemap(), 0u);\n }\n \n fn parse_pretty(session::session sess, &str name) -> pp_mode {\n@@ -517,7 +517,8 @@ fn main(vec[str] args) {\n         };\n     }\n \n-    for (str cratepath in cstore::get_used_crate_files(sess.get_cstore())) {\n+    auto cstore = sess.get_cstore();\n+    for (str cratepath in cstore::get_used_crate_files(cstore)) {\n         auto dir = fs::dirname(cratepath);\n         if (dir != \"\") {\n             gcc_args += [\"-L\" + dir];\n@@ -527,7 +528,7 @@ fn main(vec[str] args) {\n     }\n \n     gcc_args += sess.get_used_link_args();\n-    auto used_libs = sess.get_used_libraries();\n+    auto used_libs = cstore::get_used_libraries(cstore);\n     for (str l in used_libs) {\n         gcc_args += [\"-l\" + l];\n     }"}, {"sha": "8d28f9046ef1b139008d1721bc2eb7b4ccc136b5", "filename": "src/comp/driver/session.rs", "status": "modified", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/4bfa269fe7ce48c7cd54404b4f74c48e0e7895ea/src%2Fcomp%2Fdriver%2Fsession.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4bfa269fe7ce48c7cd54404b4f74c48e0e7895ea/src%2Fcomp%2Fdriver%2Fsession.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fdriver%2Fsession.rs?ref=4bfa269fe7ce48c7cd54404b4f74c48e0e7895ea", "patch": "@@ -46,7 +46,6 @@ type crate_metadata = rec(str name, vec[u8] data);\n obj session(@config targ_cfg,\n             @options opts,\n             metadata::cstore::cstore cstore,\n-            mutable vec[str] used_libraries,\n             mutable vec[str] used_link_args,\n             codemap::codemap cm,\n             mutable uint err_count) {\n@@ -105,23 +104,6 @@ obj session(@config targ_cfg,\n     fn get_used_link_args() -> vec[str] {\n         ret used_link_args;\n     }\n-    fn add_used_library(&str lib) -> bool {\n-        if (lib == \"\") {\n-            ret false;\n-        }\n-        // A program has a small number of libraries, so a vector is probably\n-        // a good data structure in here.\n-        for (str l in used_libraries) {\n-            if (l == lib) {\n-                ret false;\n-            }\n-        }\n-        used_libraries += [lib];\n-        ret true;\n-    }\n-    fn get_used_libraries() -> vec[str] {\n-       ret used_libraries;\n-    }\n     fn get_codemap() -> codemap::codemap { ret cm; }\n     fn lookup_pos(uint pos) -> codemap::loc {\n         ret codemap::lookup_pos(cm, pos);"}, {"sha": "6b1512b02cc92ed229414efcc76159a9b431f3d5", "filename": "src/comp/metadata/creader.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/4bfa269fe7ce48c7cd54404b4f74c48e0e7895ea/src%2Fcomp%2Fmetadata%2Fcreader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4bfa269fe7ce48c7cd54404b4f74c48e0e7895ea/src%2Fcomp%2Fmetadata%2Fcreader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmetadata%2Fcreader.rs?ref=4bfa269fe7ce48c7cd54404b4f74c48e0e7895ea", "patch": "@@ -180,7 +180,8 @@ fn visit_item(env e, &@ast::item i) {\n                 m.abi != ast::native_abi_cdecl) {\n                 ret;\n             }\n-            if (!e.sess.add_used_library(m.native_name)) {\n+            auto cstore = e.sess.get_cstore();\n+            if (!cstore::add_used_library(cstore, m.native_name)) {\n                 ret;\n             }\n             for (ast::attribute a in"}, {"sha": "270179198aae9b266e73bb052fa1d11dcdc4c1a4", "filename": "src/comp/metadata/cstore.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/4bfa269fe7ce48c7cd54404b4f74c48e0e7895ea/src%2Fcomp%2Fmetadata%2Fcstore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4bfa269fe7ce48c7cd54404b4f74c48e0e7895ea/src%2Fcomp%2Fmetadata%2Fcstore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmetadata%2Fcstore.rs?ref=4bfa269fe7ce48c7cd54404b4f74c48e0e7895ea", "patch": "@@ -38,6 +38,21 @@ fn get_used_crate_files(&cstore cstore) -> vec[str] {\n     ret cstore.used_crate_files;\n }\n \n+fn add_used_library(&cstore cstore, &str lib) -> bool {\n+    if (lib == \"\") { ret false; }\n+\n+    if (vec::member(lib, cstore.used_libraries)) {\n+        ret false;\n+    }\n+\n+    cstore.used_libraries += [lib];\n+    ret true;\n+}\n+\n+fn get_used_libraries(&cstore cstore) -> vec[str] {\n+    ret cstore.used_libraries;\n+}\n+\n // Local Variables:\n // mode: rust\n // fill-column: 78;"}]}