{"sha": "f972adc2012fc49b35124d080a000a0d44c95452", "node_id": "C_kwDOAAsO6NoAKGY5NzJhZGMyMDEyZmM0OWIzNTEyNGQwODBhMDAwYTBkNDRjOTU0NTI", "commit": {"author": {"name": "iDawer", "email": "ilnur.iskhakov.oss@outlook.com", "date": "2022-04-12T15:40:31Z"}, "committer": {"name": "iDawer", "email": "ilnur.iskhakov.oss@outlook.com", "date": "2022-04-16T08:41:10Z"}, "message": "fix: comletion detail shows `{unknown}` for `impl Trait` in return position", "tree": {"sha": "85420ee8f0ddf62e4fe1445fbbdca8df54af01a6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/85420ee8f0ddf62e4fe1445fbbdca8df54af01a6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f972adc2012fc49b35124d080a000a0d44c95452", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f972adc2012fc49b35124d080a000a0d44c95452", "html_url": "https://github.com/rust-lang/rust/commit/f972adc2012fc49b35124d080a000a0d44c95452", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f972adc2012fc49b35124d080a000a0d44c95452/comments", "author": {"login": "iDawer", "id": 7803845, "node_id": "MDQ6VXNlcjc4MDM4NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/7803845?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iDawer", "html_url": "https://github.com/iDawer", "followers_url": "https://api.github.com/users/iDawer/followers", "following_url": "https://api.github.com/users/iDawer/following{/other_user}", "gists_url": "https://api.github.com/users/iDawer/gists{/gist_id}", "starred_url": "https://api.github.com/users/iDawer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iDawer/subscriptions", "organizations_url": "https://api.github.com/users/iDawer/orgs", "repos_url": "https://api.github.com/users/iDawer/repos", "events_url": "https://api.github.com/users/iDawer/events{/privacy}", "received_events_url": "https://api.github.com/users/iDawer/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iDawer", "id": 7803845, "node_id": "MDQ6VXNlcjc4MDM4NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/7803845?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iDawer", "html_url": "https://github.com/iDawer", "followers_url": "https://api.github.com/users/iDawer/followers", "following_url": "https://api.github.com/users/iDawer/following{/other_user}", "gists_url": "https://api.github.com/users/iDawer/gists{/gist_id}", "starred_url": "https://api.github.com/users/iDawer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iDawer/subscriptions", "organizations_url": "https://api.github.com/users/iDawer/orgs", "repos_url": "https://api.github.com/users/iDawer/repos", "events_url": "https://api.github.com/users/iDawer/events{/privacy}", "received_events_url": "https://api.github.com/users/iDawer/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "66c232d03baadecf5318a77837f0f8b6166c0796", "url": "https://api.github.com/repos/rust-lang/rust/commits/66c232d03baadecf5318a77837f0f8b6166c0796", "html_url": "https://github.com/rust-lang/rust/commit/66c232d03baadecf5318a77837f0f8b6166c0796"}], "stats": {"total": 45, "additions": 42, "deletions": 3}, "files": [{"sha": "7cda75b347828534bebaf4e73d88fdb083ed1e63", "filename": "crates/hir/src/lib.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f972adc2012fc49b35124d080a000a0d44c95452/crates%2Fhir%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f972adc2012fc49b35124d080a000a0d44c95452/crates%2Fhir%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir%2Fsrc%2Flib.rs?ref=f972adc2012fc49b35124d080a000a0d44c95452", "patch": "@@ -1358,9 +1358,9 @@ impl Function {\n     /// Get this function's return type\n     pub fn ret_type(self, db: &dyn HirDatabase) -> Type {\n         let resolver = self.id.resolver(db.upcast());\n-        let ret_type = &db.function_data(self.id).ret_type;\n-        let ctx = hir_ty::TyLoweringContext::new(db, &resolver);\n-        let ty = ctx.lower_ty(ret_type);\n+        let substs = TyBuilder::placeholder_subst(db, self.id);\n+        let callable_sig = db.callable_item_signature(self.id.into()).substitute(Interner, &substs);\n+        let ty = callable_sig.ret().clone();\n         Type::new_with_resolver_inner(db, &resolver, ty)\n     }\n "}, {"sha": "f25e14e0fcdd84aa660532b9c3983fac4d7e2d0c", "filename": "crates/ide_completion/src/tests/expression.rs", "status": "modified", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/f972adc2012fc49b35124d080a000a0d44c95452/crates%2Fide_completion%2Fsrc%2Ftests%2Fexpression.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f972adc2012fc49b35124d080a000a0d44c95452/crates%2Fide_completion%2Fsrc%2Ftests%2Fexpression.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_completion%2Fsrc%2Ftests%2Fexpression.rs?ref=f972adc2012fc49b35124d080a000a0d44c95452", "patch": "@@ -602,3 +602,42 @@ fn func() {\n         \"#]],\n     );\n }\n+\n+#[test]\n+fn detail_impl_trait_in_return_position() {\n+    check_empty(\n+        r\"\n+//- minicore: sized\n+trait Trait<T> {}\n+fn foo<U>() -> impl Trait<U> {}\n+fn main() {\n+    self::$0\n+}\n+\",\n+        expect![[r\"\n+            tt Trait\n+            fn main() fn()\n+            fn foo()  fn() -> impl Trait<U>\n+        \"]],\n+    );\n+}\n+\n+#[test]\n+fn detail_async_fn() {\n+    // FIXME: #11438\n+    check_empty(\n+        r#\"\n+//- minicore: future, sized\n+trait Trait<T> {}\n+async fn foo() -> u8 {}\n+fn main() {\n+    self::$0\n+}\n+\"#,\n+        expect![[r\"\n+            tt Trait\n+            fn main() fn()\n+            fn foo()  async fn() -> impl Future<Output = u8>\n+        \"]],\n+    );\n+}"}]}