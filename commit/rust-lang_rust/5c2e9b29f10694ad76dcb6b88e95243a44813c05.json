{"sha": "5c2e9b29f10694ad76dcb6b88e95243a44813c05", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjMmU5YjI5ZjEwNjk0YWQ3NmRjYjZiODhlOTUyNDNhNDQ4MTNjMDU=", "commit": {"author": {"name": "Huon Wilson", "email": "dbau.pp+github@gmail.com", "date": "2013-04-20T04:34:18Z"}, "committer": {"name": "Huon Wilson", "email": "dbau.pp+github@gmail.com", "date": "2013-04-20T05:05:36Z"}, "message": "libcore: wrappers for size/align_of to act on values without needing explicit ::<type> annotations", "tree": {"sha": "789bb8712879f48e552d1eddfab22a290f5d3ce6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/789bb8712879f48e552d1eddfab22a290f5d3ce6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5c2e9b29f10694ad76dcb6b88e95243a44813c05", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5c2e9b29f10694ad76dcb6b88e95243a44813c05", "html_url": "https://github.com/rust-lang/rust/commit/5c2e9b29f10694ad76dcb6b88e95243a44813c05", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5c2e9b29f10694ad76dcb6b88e95243a44813c05/comments", "author": {"login": "huonw", "id": 1203825, "node_id": "MDQ6VXNlcjEyMDM4MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huonw", "html_url": "https://github.com/huonw", "followers_url": "https://api.github.com/users/huonw/followers", "following_url": "https://api.github.com/users/huonw/following{/other_user}", "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}", "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huonw/subscriptions", "organizations_url": "https://api.github.com/users/huonw/orgs", "repos_url": "https://api.github.com/users/huonw/repos", "events_url": "https://api.github.com/users/huonw/events{/privacy}", "received_events_url": "https://api.github.com/users/huonw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "huonw", "id": 1203825, "node_id": "MDQ6VXNlcjEyMDM4MjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1203825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huonw", "html_url": "https://github.com/huonw", "followers_url": "https://api.github.com/users/huonw/followers", "following_url": "https://api.github.com/users/huonw/following{/other_user}", "gists_url": "https://api.github.com/users/huonw/gists{/gist_id}", "starred_url": "https://api.github.com/users/huonw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huonw/subscriptions", "organizations_url": "https://api.github.com/users/huonw/orgs", "repos_url": "https://api.github.com/users/huonw/repos", "events_url": "https://api.github.com/users/huonw/events{/privacy}", "received_events_url": "https://api.github.com/users/huonw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8b3c09a1038c6623528fd7ebb1d365e475d63dfc", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b3c09a1038c6623528fd7ebb1d365e475d63dfc", "html_url": "https://github.com/rust-lang/rust/commit/8b3c09a1038c6623528fd7ebb1d365e475d63dfc"}], "stats": {"total": 58, "additions": 57, "deletions": 1}, "files": [{"sha": "c4ec83aa17662850995431fb814421166ac78703", "filename": "src/libcore/sys.rs", "status": "modified", "additions": 57, "deletions": 1, "changes": 58, "blob_url": "https://github.com/rust-lang/rust/blob/5c2e9b29f10694ad76dcb6b88e95243a44813c05/src%2Flibcore%2Fsys.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c2e9b29f10694ad76dcb6b88e95243a44813c05/src%2Flibcore%2Fsys.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fsys.rs?ref=5c2e9b29f10694ad76dcb6b88e95243a44813c05", "patch": "@@ -83,12 +83,24 @@ pub fn get_type_desc<T>() -> *TypeDesc {\n     unsafe { rusti::get_tydesc::<T>() as *TypeDesc }\n }\n \n+/// Returns a pointer to a type descriptor.\n+#[inline(always)]\n+pub fn get_type_desc_val<T>(_val: &T) -> *TypeDesc {\n+    get_type_desc::<T>()\n+}\n+\n /// Returns the size of a type\n #[inline(always)]\n pub fn size_of<T>() -> uint {\n     unsafe { rusti::size_of::<T>() }\n }\n \n+/// Returns the size of the type that `_val` points to\n+#[inline(always)]\n+pub fn size_of_val<T>(_val: &T) -> uint {\n+    size_of::<T>()\n+}\n+\n /**\n  * Returns the size of a type, or 1 if the actual size is zero.\n  *\n@@ -100,6 +112,13 @@ pub fn nonzero_size_of<T>() -> uint {\n     if s == 0 { 1 } else { s }\n }\n \n+/// Returns the size of the type of the value that `_val` points to\n+#[inline(always)]\n+pub fn nonzero_size_of_val<T>(_val: &T) -> uint {\n+    nonzero_size_of::<T>()\n+}\n+\n+\n /**\n  * Returns the ABI-required minimum alignment of a type\n  *\n@@ -111,12 +130,26 @@ pub fn min_align_of<T>() -> uint {\n     unsafe { rusti::min_align_of::<T>() }\n }\n \n+/// Returns the ABI-required minimum alignment of the type of the value that\n+/// `_val` points to\n+#[inline(always)]\n+pub fn min_align_of_val<T>(_val: &T) -> uint {\n+    min_align_of::<T>()\n+}\n+\n /// Returns the preferred alignment of a type\n #[inline(always)]\n pub fn pref_align_of<T>() -> uint {\n     unsafe { rusti::pref_align_of::<T>() }\n }\n \n+/// Returns the preferred alignment of the type of the value that\n+/// `_val` points to\n+#[inline(always)]\n+pub fn pref_align_of_val<T>(_val: &T) -> uint {\n+    pref_align_of::<T>()\n+}\n+\n /// Returns the refcount of a shared box (as just before calling this)\n #[inline(always)]\n pub fn refcount<T>(t: @T) -> uint {\n@@ -162,7 +195,7 @@ pub fn fail_assert(msg: &str, file: &str, line: uint) -> ! {\n #[cfg(test)]\n mod tests {\n     use cast;\n-    use sys::{Closure, pref_align_of, size_of, nonzero_size_of};\n+    use sys::*;\n \n     #[test]\n     fn size_of_basic() {\n@@ -188,6 +221,14 @@ mod tests {\n         assert!(size_of::<*uint>() == 8u);\n     }\n \n+    #[test]\n+    fn size_of_val_basic() {\n+        assert_eq!(size_of_val(&1u8), 1);\n+        assert_eq!(size_of_val(&1u16), 2);\n+        assert_eq!(size_of_val(&1u32), 4);\n+        assert_eq!(size_of_val(&1u64), 8);\n+    }\n+\n     #[test]\n     fn nonzero_size_of_basic() {\n         type Z = [i8, ..0];\n@@ -196,6 +237,14 @@ mod tests {\n         assert!(nonzero_size_of::<uint>() == size_of::<uint>());\n     }\n \n+    #[test]\n+    fn nonzero_size_of_val_basic() {\n+        let z = [0u8, ..0];\n+        assert_eq!(size_of_val(&z), 0u);\n+        assert_eq!(nonzero_size_of_val(&z), 1u);\n+        assert_eq!(nonzero_size_of_val(&1u), size_of_val(&1u));\n+    }\n+\n     #[test]\n     fn align_of_basic() {\n         assert!(pref_align_of::<u8>() == 1u);\n@@ -219,6 +268,13 @@ mod tests {\n         assert!(pref_align_of::<*uint>() == 8u);\n     }\n \n+    #[test]\n+    fn align_of_val_basic() {\n+        assert_eq!(pref_align_of_val(&1u8), 1u);\n+        assert_eq!(pref_align_of_val(&1u16), 2u);\n+        assert_eq!(pref_align_of_val(&1u32), 4u);\n+    }\n+\n     #[test]\n     fn synthesize_closure() {\n         unsafe {"}]}