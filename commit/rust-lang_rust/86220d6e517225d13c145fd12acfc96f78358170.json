{"sha": "86220d6e517225d13c145fd12acfc96f78358170", "node_id": "C_kwDOAAsO6NoAKDg2MjIwZDZlNTE3MjI1ZDEzYzE0NWZkMTJhY2ZjOTZmNzgzNTgxNzA", "commit": {"author": {"name": "Noah Lev", "email": "camelidcamel@gmail.com", "date": "2022-03-24T00:26:59Z"}, "committer": {"name": "Noah Lev", "email": "camelidcamel@gmail.com", "date": "2022-03-24T05:31:57Z"}, "message": "Fix rustfix panic on test\n\n`run-rustfix` applies all suggestions regardless of their Applicability.\nThere's a flag, `rustfix-only-machine-applicable`, that does what it\nsays, but then the produced `.fixed` file would have invalid code from\nthe suggestions that weren't applied. So, I moved the cases of postfix\nincrement, in which case multiple suggestions are given, to the\n`-notfixed` test, which does not run rustfix.\n\nI also changed the Applicability to Unspecified since MaybeIncorrect\nrequires that the code be valid, even if it's incorrect.", "tree": {"sha": "e8d5f4bcb5f800c7a654d5270bf543b8888b2bad", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e8d5f4bcb5f800c7a654d5270bf543b8888b2bad"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/86220d6e517225d13c145fd12acfc96f78358170", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/86220d6e517225d13c145fd12acfc96f78358170", "html_url": "https://github.com/rust-lang/rust/commit/86220d6e517225d13c145fd12acfc96f78358170", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/86220d6e517225d13c145fd12acfc96f78358170/comments", "author": {"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}, "committer": {"login": "camelid", "id": 37223377, "node_id": "MDQ6VXNlcjM3MjIzMzc3", "avatar_url": "https://avatars.githubusercontent.com/u/37223377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camelid", "html_url": "https://github.com/camelid", "followers_url": "https://api.github.com/users/camelid/followers", "following_url": "https://api.github.com/users/camelid/following{/other_user}", "gists_url": "https://api.github.com/users/camelid/gists{/gist_id}", "starred_url": "https://api.github.com/users/camelid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camelid/subscriptions", "organizations_url": "https://api.github.com/users/camelid/orgs", "repos_url": "https://api.github.com/users/camelid/repos", "events_url": "https://api.github.com/users/camelid/events{/privacy}", "received_events_url": "https://api.github.com/users/camelid/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "725cde42d5673d1957ad58c6b2fada28a6a4edbd", "url": "https://api.github.com/repos/rust-lang/rust/commits/725cde42d5673d1957ad58c6b2fada28a6a4edbd", "html_url": "https://github.com/rust-lang/rust/commit/725cde42d5673d1957ad58c6b2fada28a6a4edbd"}], "stats": {"total": 249, "additions": 135, "deletions": 114}, "files": [{"sha": "bab4ac9d08aa584a5fa757c69a90d329306cf514", "filename": "compiler/rustc_parse/src/parser/diagnostics.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/86220d6e517225d13c145fd12acfc96f78358170/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/86220d6e517225d13c145fd12acfc96f78358170/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs?ref=86220d6e517225d13c145fd12acfc96f78358170", "patch": "@@ -1326,7 +1326,7 @@ impl<'a> Parser<'a> {\n                 MultiSugg::emit_many(\n                     &mut err,\n                     \"use `+= 1` instead\",\n-                    Applicability::MaybeIncorrect,\n+                    Applicability::Unspecified,\n                     [sugg1, sugg2].into_iter(),\n                 )\n             }"}, {"sha": "24a5ac42ca6d05dd0017689ab89dd910db986ab1", "filename": "src/test/ui/parser/increment-autofix.fixed", "status": "modified", "additions": 14, "deletions": 19, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/86220d6e517225d13c145fd12acfc96f78358170/src%2Ftest%2Fui%2Fparser%2Fincrement-autofix.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/86220d6e517225d13c145fd12acfc96f78358170/src%2Ftest%2Fui%2Fparser%2Fincrement-autofix.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fincrement-autofix.fixed?ref=86220d6e517225d13c145fd12acfc96f78358170", "patch": "@@ -1,19 +1,5 @@\n // run-rustfix\n \n-fn post_regular() {\n-    let mut i = 0;\n-    { let tmp = i; i += 1; tmp }; //~ ERROR Rust has no postfix increment operator\n-    println!(\"{}\", i);\n-}\n-\n-fn post_while() {\n-    let mut i = 0;\n-    while { let tmp = i; i += 1; tmp } < 5 {\n-        //~^ ERROR Rust has no postfix increment operator\n-        println!(\"{}\", i);\n-    }\n-}\n-\n fn pre_regular() {\n     let mut i = 0;\n     i += 1; //~ ERROR Rust has no prefix increment operator\n@@ -28,9 +14,18 @@ fn pre_while() {\n     }\n }\n \n-fn main() {\n-    post_regular();\n-    post_while();\n-    pre_regular();\n-    pre_while();\n+fn pre_regular_tmp() {\n+    let mut tmp = 0;\n+    tmp += 1; //~ ERROR Rust has no prefix increment operator\n+    println!(\"{}\", tmp);\n }\n+\n+fn pre_while_tmp() {\n+    let mut tmp = 0;\n+    while { tmp += 1; tmp } < 5 {\n+        //~^ ERROR Rust has no prefix increment operator\n+        println!(\"{}\", tmp);\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "b1cfd09e9ec84f4ca8062e9f9a42c5ea01a28bf2", "filename": "src/test/ui/parser/increment-autofix.rs", "status": "modified", "additions": 11, "deletions": 32, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/86220d6e517225d13c145fd12acfc96f78358170/src%2Ftest%2Fui%2Fparser%2Fincrement-autofix.rs", "raw_url": "https://github.com/rust-lang/rust/raw/86220d6e517225d13c145fd12acfc96f78358170/src%2Ftest%2Fui%2Fparser%2Fincrement-autofix.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fincrement-autofix.rs?ref=86220d6e517225d13c145fd12acfc96f78358170", "patch": "@@ -1,52 +1,31 @@\n // run-rustfix\n \n-fn post_regular() {\n+fn pre_regular() {\n     let mut i = 0;\n-    i++; //~ ERROR Rust has no postfix increment operator\n+    ++i; //~ ERROR Rust has no prefix increment operator\n     println!(\"{}\", i);\n }\n \n-fn post_while() {\n+fn pre_while() {\n     let mut i = 0;\n-    while i++ < 5 {\n-        //~^ ERROR Rust has no postfix increment operator\n+    while ++i < 5 {\n+        //~^ ERROR Rust has no prefix increment operator\n         println!(\"{}\", i);\n     }\n }\n \n-fn post_regular_tmp() {\n+fn pre_regular_tmp() {\n     let mut tmp = 0;\n-    tmp++; //~ ERROR Rust has no postfix increment operator\n+    ++tmp; //~ ERROR Rust has no prefix increment operator\n     println!(\"{}\", tmp);\n }\n \n-fn post_while_tmp() {\n+fn pre_while_tmp() {\n     let mut tmp = 0;\n-    while tmp++ < 5 {\n-        //~^ ERROR Rust has no postfix increment operator\n-        println!(\"{}\", tmp);\n-    }\n-}\n-\n-fn pre_regular() {\n-    let mut i = 0;\n-    ++i; //~ ERROR Rust has no prefix increment operator\n-    println!(\"{}\", i);\n-}\n-\n-fn pre_while() {\n-    let mut i = 0;\n-    while ++i < 5 {\n+    while ++tmp < 5 {\n         //~^ ERROR Rust has no prefix increment operator\n-        println!(\"{}\", i);\n+        println!(\"{}\", tmp);\n     }\n }\n \n-fn main() {\n-    post_regular();\n-    post_while();\n-    post_regular_tmp();\n-    post_while_tmp();\n-    pre_regular();\n-    pre_while();\n-}\n+fn main() {}"}, {"sha": "a9dc70ad0d6b1293985bd2971e2a5ae3d4b2848b", "filename": "src/test/ui/parser/increment-autofix.stderr", "status": "modified", "additions": 20, "deletions": 53, "changes": 73, "blob_url": "https://github.com/rust-lang/rust/blob/86220d6e517225d13c145fd12acfc96f78358170/src%2Ftest%2Fui%2Fparser%2Fincrement-autofix.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/86220d6e517225d13c145fd12acfc96f78358170/src%2Ftest%2Fui%2Fparser%2Fincrement-autofix.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fincrement-autofix.stderr?ref=86220d6e517225d13c145fd12acfc96f78358170", "patch": "@@ -1,81 +1,48 @@\n-error: Rust has no postfix increment operator\n-  --> $DIR/increment-autofix.rs:5:6\n+error: Rust has no prefix increment operator\n+  --> $DIR/increment-autofix.rs:5:5\n    |\n-LL |     i++;\n-   |      ^^ not a valid postfix operator\n+LL |     ++i;\n+   |     ^^ not a valid prefix operator\n    |\n help: use `+= 1` instead\n    |\n-LL |     { let tmp = i; i += 1; tmp };\n-   |     +++++++++++  ~~~~~~~~~~~~~~~\n-LL -     i++;\n+LL -     ++i;\n LL +     i += 1;\n    | \n \n-error: Rust has no postfix increment operator\n-  --> $DIR/increment-autofix.rs:11:12\n-   |\n-LL |     while i++ < 5 {\n-   |            ^^ not a valid postfix operator\n-   |\n-help: use `+= 1` instead\n-   |\n-LL |     while { let tmp = i; i += 1; tmp } < 5 {\n-   |           +++++++++++  ~~~~~~~~~~~~~~~\n-LL -     while i++ < 5 {\n-LL +     while i += 1 < 5 {\n-   | \n-\n-error: Rust has no postfix increment operator\n-  --> $DIR/increment-autofix.rs:19:8\n-   |\n-LL |     tmp++;\n-   |        ^^ not a valid postfix operator\n-   |\n-help: use `+= 1` instead\n-   |\n-LL |     { let tmp_ = tmp; tmp += 1; tmp_ };\n-   |     ++++++++++++    ~~~~~~~~~~~~~~~~~~\n-LL -     tmp++;\n-LL +     tmp += 1;\n-   | \n-\n-error: Rust has no postfix increment operator\n-  --> $DIR/increment-autofix.rs:25:14\n+error: Rust has no prefix increment operator\n+  --> $DIR/increment-autofix.rs:11:11\n    |\n-LL |     while tmp++ < 5 {\n-   |              ^^ not a valid postfix operator\n+LL |     while ++i < 5 {\n+   |           ^^ not a valid prefix operator\n    |\n help: use `+= 1` instead\n    |\n-LL |     while { let tmp_ = tmp; tmp += 1; tmp_ } < 5 {\n-   |           ++++++++++++    ~~~~~~~~~~~~~~~~~~\n-LL -     while tmp++ < 5 {\n-LL +     while tmp += 1 < 5 {\n-   | \n+LL |     while { i += 1; i } < 5 {\n+   |           ~   +++++++++\n \n error: Rust has no prefix increment operator\n-  --> $DIR/increment-autofix.rs:33:5\n+  --> $DIR/increment-autofix.rs:19:5\n    |\n-LL |     ++i;\n+LL |     ++tmp;\n    |     ^^ not a valid prefix operator\n    |\n help: use `+= 1` instead\n    |\n-LL -     ++i;\n-LL +     i += 1;\n+LL -     ++tmp;\n+LL +     tmp += 1;\n    | \n \n error: Rust has no prefix increment operator\n-  --> $DIR/increment-autofix.rs:39:11\n+  --> $DIR/increment-autofix.rs:25:11\n    |\n-LL |     while ++i < 5 {\n+LL |     while ++tmp < 5 {\n    |           ^^ not a valid prefix operator\n    |\n help: use `+= 1` instead\n    |\n-LL |     while { i += 1; i } < 5 {\n-   |           ~   +++++++++\n+LL |     while { tmp += 1; tmp } < 5 {\n+   |           ~     +++++++++++\n \n-error: aborting due to 6 previous errors\n+error: aborting due to 4 previous errors\n "}, {"sha": "543f73bf772e147578dab1626d6d24faa11f171c", "filename": "src/test/ui/parser/increment-notfixed.rs", "status": "modified", "additions": 29, "deletions": 5, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/86220d6e517225d13c145fd12acfc96f78358170/src%2Ftest%2Fui%2Fparser%2Fincrement-notfixed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/86220d6e517225d13c145fd12acfc96f78358170/src%2Ftest%2Fui%2Fparser%2Fincrement-notfixed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fincrement-notfixed.rs?ref=86220d6e517225d13c145fd12acfc96f78358170", "patch": "@@ -6,6 +6,34 @@ struct Bar {\n     qux: i32,\n }\n \n+fn post_regular() {\n+    let mut i = 0;\n+    i++; //~ ERROR Rust has no postfix increment operator\n+    println!(\"{}\", i);\n+}\n+\n+fn post_while() {\n+    let mut i = 0;\n+    while i++ < 5 {\n+        //~^ ERROR Rust has no postfix increment operator\n+        println!(\"{}\", i);\n+    }\n+}\n+\n+fn post_regular_tmp() {\n+    let mut tmp = 0;\n+    tmp++; //~ ERROR Rust has no postfix increment operator\n+    println!(\"{}\", tmp);\n+}\n+\n+fn post_while_tmp() {\n+    let mut tmp = 0;\n+    while tmp++ < 5 {\n+        //~^ ERROR Rust has no postfix increment operator\n+        println!(\"{}\", tmp);\n+    }\n+}\n+\n fn post_field() {\n     let foo = Foo { bar: Bar { qux: 0 } };\n     foo.bar.qux++;\n@@ -30,8 +58,4 @@ fn pre_field() {\n     println!(\"{}\", foo.bar.qux);\n }\n \n-fn main() {\n-    post_field();\n-    post_field_tmp();\n-    pre_field();\n-}\n+fn main() {}"}, {"sha": "75fce91c6efb2bee216f5bc058c907bd430e9902", "filename": "src/test/ui/parser/increment-notfixed.stderr", "status": "modified", "additions": 60, "deletions": 4, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/86220d6e517225d13c145fd12acfc96f78358170/src%2Ftest%2Fui%2Fparser%2Fincrement-notfixed.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/86220d6e517225d13c145fd12acfc96f78358170/src%2Ftest%2Fui%2Fparser%2Fincrement-notfixed.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fincrement-notfixed.stderr?ref=86220d6e517225d13c145fd12acfc96f78358170", "patch": "@@ -1,5 +1,61 @@\n error: Rust has no postfix increment operator\n-  --> $DIR/increment-notfixed.rs:11:16\n+  --> $DIR/increment-notfixed.rs:11:6\n+   |\n+LL |     i++;\n+   |      ^^ not a valid postfix operator\n+   |\n+help: use `+= 1` instead\n+   |\n+LL |     { let tmp = i; i += 1; tmp };\n+   |     +++++++++++  ~~~~~~~~~~~~~~~\n+LL -     i++;\n+LL +     i += 1;\n+   | \n+\n+error: Rust has no postfix increment operator\n+  --> $DIR/increment-notfixed.rs:17:12\n+   |\n+LL |     while i++ < 5 {\n+   |            ^^ not a valid postfix operator\n+   |\n+help: use `+= 1` instead\n+   |\n+LL |     while { let tmp = i; i += 1; tmp } < 5 {\n+   |           +++++++++++  ~~~~~~~~~~~~~~~\n+LL -     while i++ < 5 {\n+LL +     while i += 1 < 5 {\n+   | \n+\n+error: Rust has no postfix increment operator\n+  --> $DIR/increment-notfixed.rs:25:8\n+   |\n+LL |     tmp++;\n+   |        ^^ not a valid postfix operator\n+   |\n+help: use `+= 1` instead\n+   |\n+LL |     { let tmp_ = tmp; tmp += 1; tmp_ };\n+   |     ++++++++++++    ~~~~~~~~~~~~~~~~~~\n+LL -     tmp++;\n+LL +     tmp += 1;\n+   | \n+\n+error: Rust has no postfix increment operator\n+  --> $DIR/increment-notfixed.rs:31:14\n+   |\n+LL |     while tmp++ < 5 {\n+   |              ^^ not a valid postfix operator\n+   |\n+help: use `+= 1` instead\n+   |\n+LL |     while { let tmp_ = tmp; tmp += 1; tmp_ } < 5 {\n+   |           ++++++++++++    ~~~~~~~~~~~~~~~~~~\n+LL -     while tmp++ < 5 {\n+LL +     while tmp += 1 < 5 {\n+   | \n+\n+error: Rust has no postfix increment operator\n+  --> $DIR/increment-notfixed.rs:39:16\n    |\n LL |     foo.bar.qux++;\n    |                ^^ not a valid postfix operator\n@@ -13,7 +69,7 @@ LL +     foo.bar.qux += 1;\n    | \n \n error: Rust has no postfix increment operator\n-  --> $DIR/increment-notfixed.rs:21:10\n+  --> $DIR/increment-notfixed.rs:49:10\n    |\n LL |     s.tmp++;\n    |          ^^ not a valid postfix operator\n@@ -27,7 +83,7 @@ LL +     s.tmp += 1;\n    | \n \n error: Rust has no prefix increment operator\n-  --> $DIR/increment-notfixed.rs:28:5\n+  --> $DIR/increment-notfixed.rs:56:5\n    |\n LL |     ++foo.bar.qux;\n    |     ^^ not a valid prefix operator\n@@ -38,5 +94,5 @@ LL -     ++foo.bar.qux;\n LL +     foo.bar.qux += 1;\n    | \n \n-error: aborting due to 3 previous errors\n+error: aborting due to 7 previous errors\n "}]}