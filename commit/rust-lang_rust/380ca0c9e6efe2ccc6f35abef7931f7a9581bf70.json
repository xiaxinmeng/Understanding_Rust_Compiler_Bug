{"sha": "380ca0c9e6efe2ccc6f35abef7931f7a9581bf70", "node_id": "C_kwDOAAsO6NoAKDM4MGNhMGM5ZTZlZmUyY2NjNmYzNWFiZWY3OTMxZjdhOTU4MWJmNzA", "commit": {"author": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2023-02-26T14:27:02Z"}, "committer": {"name": "Camille GILLOT", "email": "gillot.camille@gmail.com", "date": "2023-02-26T14:31:15Z"}, "message": "Move THIR printing to rustc_mir_build.", "tree": {"sha": "b71f54a52cbcf853e12acba194632ca4d148a12e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b71f54a52cbcf853e12acba194632ca4d148a12e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/380ca0c9e6efe2ccc6f35abef7931f7a9581bf70", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/380ca0c9e6efe2ccc6f35abef7931f7a9581bf70", "html_url": "https://github.com/rust-lang/rust/commit/380ca0c9e6efe2ccc6f35abef7931f7a9581bf70", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/380ca0c9e6efe2ccc6f35abef7931f7a9581bf70/comments", "author": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cjgillot", "id": 1822483, "node_id": "MDQ6VXNlcjE4MjI0ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/1822483?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjgillot", "html_url": "https://github.com/cjgillot", "followers_url": "https://api.github.com/users/cjgillot/followers", "following_url": "https://api.github.com/users/cjgillot/following{/other_user}", "gists_url": "https://api.github.com/users/cjgillot/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjgillot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjgillot/subscriptions", "organizations_url": "https://api.github.com/users/cjgillot/orgs", "repos_url": "https://api.github.com/users/cjgillot/repos", "events_url": "https://api.github.com/users/cjgillot/events{/privacy}", "received_events_url": "https://api.github.com/users/cjgillot/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "70fd012439d75fd6ce561a6518b9b8fd399f455f", "url": "https://api.github.com/repos/rust-lang/rust/commits/70fd012439d75fd6ce561a6518b9b8fd399f455f", "html_url": "https://github.com/rust-lang/rust/commit/70fd012439d75fd6ce561a6518b9b8fd399f455f"}], "stats": {"total": 53, "additions": 22, "deletions": 31}, "files": [{"sha": "5f320708c8416944466a25137159b95386baee11", "filename": "compiler/rustc_middle/src/thir.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/380ca0c9e6efe2ccc6f35abef7931f7a9581bf70/compiler%2Frustc_middle%2Fsrc%2Fthir.rs", "raw_url": "https://github.com/rust-lang/rust/raw/380ca0c9e6efe2ccc6f35abef7931f7a9581bf70/compiler%2Frustc_middle%2Fsrc%2Fthir.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fthir.rs?ref=380ca0c9e6efe2ccc6f35abef7931f7a9581bf70", "patch": "@@ -29,7 +29,6 @@ use rustc_target::asm::InlineAsmRegOrRegClass;\n use std::fmt;\n use std::ops::Index;\n \n-pub mod print;\n pub mod visit;\n \n macro_rules! thir_with_elements {"}, {"sha": "e10a264d385d0623e6eb7bbde6b9fced20c58e90", "filename": "compiler/rustc_mir_build/src/lib.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/380ca0c9e6efe2ccc6f35abef7931f7a9581bf70/compiler%2Frustc_mir_build%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/380ca0c9e6efe2ccc6f35abef7931f7a9581bf70/compiler%2Frustc_mir_build%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Flib.rs?ref=380ca0c9e6efe2ccc6f35abef7931f7a9581bf70", "patch": "@@ -38,6 +38,6 @@ pub fn provide(providers: &mut Providers) {\n     providers.thir_check_unsafety = check_unsafety::thir_check_unsafety;\n     providers.thir_check_unsafety_for_const_arg = check_unsafety::thir_check_unsafety_for_const_arg;\n     providers.thir_body = thir::cx::thir_body;\n-    providers.thir_tree = thir::cx::thir_tree;\n-    providers.thir_flat = thir::cx::thir_flat;\n+    providers.thir_tree = thir::print::thir_tree;\n+    providers.thir_flat = thir::print::thir_flat;\n }"}, {"sha": "b5e819db5f82bbf8447bf9fa940c41d6ec260f0f", "filename": "compiler/rustc_mir_build/src/thir/cx/mod.rs", "status": "modified", "additions": 0, "deletions": 17, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/380ca0c9e6efe2ccc6f35abef7931f7a9581bf70/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fcx%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/380ca0c9e6efe2ccc6f35abef7931f7a9581bf70/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fcx%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fcx%2Fmod.rs?ref=380ca0c9e6efe2ccc6f35abef7931f7a9581bf70", "patch": "@@ -52,23 +52,6 @@ pub(crate) fn thir_body(\n     Ok((tcx.alloc_steal_thir(cx.thir), expr))\n }\n \n-pub(crate) fn thir_tree(tcx: TyCtxt<'_>, owner_def: ty::WithOptConstParam<LocalDefId>) -> String {\n-    match thir_body(tcx, owner_def) {\n-        Ok((thir, _)) => {\n-            let thir = thir.steal();\n-            tcx.thir_tree_representation(&thir)\n-        }\n-        Err(_) => \"error\".into(),\n-    }\n-}\n-\n-pub(crate) fn thir_flat(tcx: TyCtxt<'_>, owner_def: ty::WithOptConstParam<LocalDefId>) -> String {\n-    match thir_body(tcx, owner_def) {\n-        Ok((thir, _)) => format!(\"{:#?}\", thir.steal()),\n-        Err(_) => \"error\".into(),\n-    }\n-}\n-\n struct Cx<'tcx> {\n     tcx: TyCtxt<'tcx>,\n     thir: Thir<'tcx>,"}, {"sha": "ca26cc13b5e877944c04280137c37dfbbb6541b1", "filename": "compiler/rustc_mir_build/src/thir/mod.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/380ca0c9e6efe2ccc6f35abef7931f7a9581bf70/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/380ca0c9e6efe2ccc6f35abef7931f7a9581bf70/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fmod.rs?ref=380ca0c9e6efe2ccc6f35abef7931f7a9581bf70", "patch": "@@ -5,9 +5,7 @@\n //! structures.\n \n pub(crate) mod constant;\n-\n pub(crate) mod cx;\n-\n pub(crate) mod pattern;\n-\n+pub(crate) mod print;\n mod util;"}, {"sha": "8028227aafd2acc4ac302aa06d757b1c0fc27227", "filename": "compiler/rustc_mir_build/src/thir/print.rs", "status": "renamed", "additions": 19, "deletions": 8, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/380ca0c9e6efe2ccc6f35abef7931f7a9581bf70/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fprint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/380ca0c9e6efe2ccc6f35abef7931f7a9581bf70/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fprint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_build%2Fsrc%2Fthir%2Fprint.rs?ref=380ca0c9e6efe2ccc6f35abef7931f7a9581bf70", "patch": "@@ -1,13 +1,24 @@\n-use crate::thir::*;\n-use crate::ty::{self, TyCtxt};\n-\n+use rustc_middle::thir::*;\n+use rustc_middle::ty::{self, TyCtxt};\n+use rustc_span::def_id::LocalDefId;\n use std::fmt::{self, Write};\n \n-impl<'tcx> TyCtxt<'tcx> {\n-    pub fn thir_tree_representation<'a>(self, thir: &'a Thir<'tcx>) -> String {\n-        let mut printer = ThirPrinter::new(thir);\n-        printer.print();\n-        printer.into_buffer()\n+pub(crate) fn thir_tree(tcx: TyCtxt<'_>, owner_def: ty::WithOptConstParam<LocalDefId>) -> String {\n+    match super::cx::thir_body(tcx, owner_def) {\n+        Ok((thir, _)) => {\n+            let thir = thir.steal();\n+            let mut printer = ThirPrinter::new(&thir);\n+            printer.print();\n+            printer.into_buffer()\n+        }\n+        Err(_) => \"error\".into(),\n+    }\n+}\n+\n+pub(crate) fn thir_flat(tcx: TyCtxt<'_>, owner_def: ty::WithOptConstParam<LocalDefId>) -> String {\n+    match super::cx::thir_body(tcx, owner_def) {\n+        Ok((thir, _)) => format!(\"{:#?}\", thir.steal()),\n+        Err(_) => \"error\".into(),\n     }\n }\n ", "previous_filename": "compiler/rustc_middle/src/thir/print.rs"}]}