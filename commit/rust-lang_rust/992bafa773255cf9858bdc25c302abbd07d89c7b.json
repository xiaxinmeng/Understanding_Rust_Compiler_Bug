{"sha": "992bafa773255cf9858bdc25c302abbd07d89c7b", "node_id": "C_kwDOAAsO6NoAKDk5MmJhZmE3NzMyNTVjZjk4NThiZGMyNWMzMDJhYmJkMDdkODljN2I", "commit": {"author": {"name": "DropDemBits", "email": "r3usrlnd@gmail.com", "date": "2023-01-17T21:25:46Z"}, "committer": {"name": "DropDemBits", "email": "r3usrlnd@gmail.com", "date": "2023-01-17T21:41:33Z"}, "message": "Fix change detection for relevant lang config opts", "tree": {"sha": "3e592106227dc49ab30af3e0075f84f59c3d5bd4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3e592106227dc49ab30af3e0075f84f59c3d5bd4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/992bafa773255cf9858bdc25c302abbd07d89c7b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE6GdU+O/nz/hLhxxS1VD437s5JTMFAmPHFhMACgkQ1VD437s5\nJTNHvQwAiSfCHtEM9B1U+4oGB/+sU5koTWopYwh/2mJbW3uCWpcunjqTeajR+9ON\nrSNEy2DHMcbVMX1QoLhQ98LODxJduQRILVMbf4MzyFQr3Fv7vvoaEuwtR6pKpV42\nBt2AuwUn6ReBqaDSfCanEr4pOrUFlbI/c2qQUPzht31N39I3xBN76b/qIyrlyAal\n03YBJZ4f+OamrcAk1q3/JW4x7vUNSBp9wQXRsU9gYaO3QuZVDVwtkmuKFVvmG+8a\n5P+o89EdOMZj2WB606YsRdnVe/AdFnkMXUEcLMnxdnnfRIxkGcSqn1w4QMAwBovd\nibeeA/vX8Ca8anZu8MEBJpes+rsYuoKHCm1is8XzHnnAlEKtM9zBALb9KGT0Zhvg\nbwkSEQkpF0d1snffbjqxUpqOCb/k9eMIKch+xPiSiPpfwBEsJL01o+t2VxO1c37J\n8W2OzOUtYuJCSvpa7rO4ig/D8zpnTZ9Z4ls41VS1z/O9sQeYBGs0tLoL7+s9gN4g\nTZxUTCgW\n=2rK/\n-----END PGP SIGNATURE-----", "payload": "tree 3e592106227dc49ab30af3e0075f84f59c3d5bd4\nparent 1c454736a4f593eebac2c43de9dfb50f9200c250\nauthor DropDemBits <r3usrlnd@gmail.com> 1673990746 -0500\ncommitter DropDemBits <r3usrlnd@gmail.com> 1673991693 -0500\n\nFix change detection for relevant lang config opts\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/992bafa773255cf9858bdc25c302abbd07d89c7b", "html_url": "https://github.com/rust-lang/rust/commit/992bafa773255cf9858bdc25c302abbd07d89c7b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/992bafa773255cf9858bdc25c302abbd07d89c7b/comments", "author": {"login": "DropDemBits", "id": 13354275, "node_id": "MDQ6VXNlcjEzMzU0Mjc1", "avatar_url": "https://avatars.githubusercontent.com/u/13354275?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DropDemBits", "html_url": "https://github.com/DropDemBits", "followers_url": "https://api.github.com/users/DropDemBits/followers", "following_url": "https://api.github.com/users/DropDemBits/following{/other_user}", "gists_url": "https://api.github.com/users/DropDemBits/gists{/gist_id}", "starred_url": "https://api.github.com/users/DropDemBits/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DropDemBits/subscriptions", "organizations_url": "https://api.github.com/users/DropDemBits/orgs", "repos_url": "https://api.github.com/users/DropDemBits/repos", "events_url": "https://api.github.com/users/DropDemBits/events{/privacy}", "received_events_url": "https://api.github.com/users/DropDemBits/received_events", "type": "User", "site_admin": false}, "committer": {"login": "DropDemBits", "id": 13354275, "node_id": "MDQ6VXNlcjEzMzU0Mjc1", "avatar_url": "https://avatars.githubusercontent.com/u/13354275?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DropDemBits", "html_url": "https://github.com/DropDemBits", "followers_url": "https://api.github.com/users/DropDemBits/followers", "following_url": "https://api.github.com/users/DropDemBits/following{/other_user}", "gists_url": "https://api.github.com/users/DropDemBits/gists{/gist_id}", "starred_url": "https://api.github.com/users/DropDemBits/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DropDemBits/subscriptions", "organizations_url": "https://api.github.com/users/DropDemBits/orgs", "repos_url": "https://api.github.com/users/DropDemBits/repos", "events_url": "https://api.github.com/users/DropDemBits/events{/privacy}", "received_events_url": "https://api.github.com/users/DropDemBits/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1c454736a4f593eebac2c43de9dfb50f9200c250", "url": "https://api.github.com/repos/rust-lang/rust/commits/1c454736a4f593eebac2c43de9dfb50f9200c250", "html_url": "https://github.com/rust-lang/rust/commit/1c454736a4f593eebac2c43de9dfb50f9200c250"}], "stats": {"total": 25, "additions": 19, "deletions": 6}, "files": [{"sha": "30ff97848299f2409c2d6d52ffbb802257379810", "filename": "editors/code/src/config.ts", "status": "modified", "additions": 19, "deletions": 6, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/992bafa773255cf9858bdc25c302abbd07d89c7b/editors%2Fcode%2Fsrc%2Fconfig.ts", "raw_url": "https://github.com/rust-lang/rust/raw/992bafa773255cf9858bdc25c302abbd07d89c7b/editors%2Fcode%2Fsrc%2Fconfig.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fconfig.ts?ref=992bafa773255cf9858bdc25c302abbd07d89c7b", "patch": "@@ -11,7 +11,9 @@ export type RunnableEnvCfg =\n \n export class Config {\n     readonly extensionId = \"rust-lang.rust-analyzer\";\n-    configureLang: vscode.Disposable | undefined;\n+    configureLang:\n+        | { handle: vscode.Disposable; typingContinueCommentsOnNewline: boolean }\n+        | undefined;\n \n     readonly rootSection = \"rust-analyzer\";\n     private readonly requiresReloadOpts = [\n@@ -43,7 +45,7 @@ export class Config {\n     }\n \n     dispose() {\n-        this.configureLang?.dispose();\n+        this.configureLang?.handle.dispose();\n     }\n \n     private refreshLogging() {\n@@ -86,7 +88,15 @@ export class Config {\n      * [1]: https://github.com/Microsoft/vscode/issues/11514#issuecomment-244707076\n      */\n     private configureLanguage() {\n-        if (this.configureLang) return;\n+        // Only need to dispose of the config if there's a change\n+        if (\n+            this.configureLang &&\n+            this.typingContinueCommentsOnNewline !==\n+                this.configureLang.typingContinueCommentsOnNewline\n+        ) {\n+            this.configureLang.handle.dispose();\n+            this.configureLang = undefined;\n+        }\n \n         let onEnterRules: vscode.OnEnterRule[] = [\n             {\n@@ -157,9 +167,12 @@ export class Config {\n             ];\n         }\n \n-        this.configureLang = vscode.languages.setLanguageConfiguration(\"rust\", {\n-            onEnterRules,\n-        });\n+        this.configureLang = {\n+            handle: vscode.languages.setLanguageConfiguration(\"rust\", {\n+                onEnterRules,\n+            }),\n+            typingContinueCommentsOnNewline: this.typingContinueCommentsOnNewline,\n+        };\n     }\n \n     // We don't do runtime config validation here for simplicity. More on stackoverflow:"}]}