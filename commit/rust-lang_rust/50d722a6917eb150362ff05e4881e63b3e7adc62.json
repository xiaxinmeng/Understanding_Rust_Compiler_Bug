{"sha": "50d722a6917eb150362ff05e4881e63b3e7adc62", "node_id": "C_kwDOAAsO6NoAKDUwZDcyMmE2OTE3ZWIxNTAzNjJmZjA1ZTQ4ODFlNjNiM2U3YWRjNjI", "commit": {"author": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-01-19T03:07:12Z"}, "committer": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2022-01-19T03:07:12Z"}, "message": "Simplify ring buffer pushes", "tree": {"sha": "662c5141f3c8437c3c3b80de52625aafc12ddaa1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/662c5141f3c8437c3c3b80de52625aafc12ddaa1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/50d722a6917eb150362ff05e4881e63b3e7adc62", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEERijF2Cz/ZdaBZKeK+boUO5X/bYIFAmHngGAACgkQ+boUO5X/\nbYL6lg//YgOjSQ4G1dPHRdm7NS53x1wk+LP9Og9xudhL2SeejzgWSnrwWWHKg7i9\nCCQ8bHvtGgt7UfnedUhxgxtSojPQ1Lu1XVuLa8cCXarTEtA1od7RC8W6llDnGLcA\nM7Kra+1W9I1sm/0u6nyRmCnKlG7nniOsFU51BYY1OqrxWvzXwFdFfWsoPUW15tHv\n9ffxpeCrKiR2J8pQISQyk7GY2SSvQkDw5ZLdBMUlN1iL4b4BLHpqaR/OCt9hclZI\nIUOKIACQzCWencRJwLl4Afn4Q3VpWaDHH/YAoRYbIOVRmqj6ybpXlDCjHjGjHin1\nKKykKwy94OmG9cVnCpwK3s1FpTMVqMtRE7wb4F3t3rvMHnAGaJlcQDZRoORPSpsq\nAuutpAj2v2X4fPJX4DRzR8n5sePULVDB8hRs9b2lTYjMd2t1fsijFs9LHL/9XRk1\nJ2TTf6NWiuCzGpOJAdeOO0ex5d9fYk1O3GY8x7+4ndlKv/0apsTW2JyAxiFTi+na\ndGOOg50CxCg3V/Nx7dqN6jXvVYajW0S64/RXzB/FxTqsG7Acgt85Ump1wexqW4qc\nrLz0EaU1xOpeE8OgvTX/fVCZ12d+nAnLsnB4yNJz3dhWz4x+BIDJap61n0CdQMwy\nYOGeSWxNLOVNvkFhkZXD62Hq6a2eYjvzfFTsZL5McVXjBCuPXew=\n=zXjy\n-----END PGP SIGNATURE-----", "payload": "tree 662c5141f3c8437c3c3b80de52625aafc12ddaa1\nparent e219b2b5f90bf48bf56533c16745f2ce85216a2c\nauthor David Tolnay <dtolnay@gmail.com> 1642561632 -0800\ncommitter David Tolnay <dtolnay@gmail.com> 1642561632 -0800\n\nSimplify ring buffer pushes\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/50d722a6917eb150362ff05e4881e63b3e7adc62", "html_url": "https://github.com/rust-lang/rust/commit/50d722a6917eb150362ff05e4881e63b3e7adc62", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/50d722a6917eb150362ff05e4881e63b3e7adc62/comments", "author": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e219b2b5f90bf48bf56533c16745f2ce85216a2c", "url": "https://api.github.com/repos/rust-lang/rust/commits/e219b2b5f90bf48bf56533c16745f2ce85216a2c", "html_url": "https://github.com/rust-lang/rust/commit/e219b2b5f90bf48bf56533c16745f2ce85216a2c"}], "stats": {"total": 19, "additions": 12, "deletions": 7}, "files": [{"sha": "43a3c792d4ac96a3820d646ea00de73a0148b463", "filename": "compiler/rustc_ast_pretty/src/pp.rs", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/50d722a6917eb150362ff05e4881e63b3e7adc62/compiler%2Frustc_ast_pretty%2Fsrc%2Fpp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50d722a6917eb150362ff05e4881e63b3e7adc62/compiler%2Frustc_ast_pretty%2Fsrc%2Fpp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_pretty%2Fsrc%2Fpp.rs?ref=50d722a6917eb150362ff05e4881e63b3e7adc62", "patch": "@@ -288,12 +288,11 @@ impl Printer {\n             self.left_total = 1;\n             self.right_total = 1;\n             self.right = self.left;\n-            self.buf.truncate(1);\n+            self.buf.clear();\n         } else {\n             self.right += 1;\n-            self.buf.advance_right();\n         }\n-        self.buf[self.right] = BufEntry { token: Token::Begin(b), size: -self.right_total };\n+        self.buf.push(BufEntry { token: Token::Begin(b), size: -self.right_total });\n         self.scan_stack.push_front(self.right);\n     }\n \n@@ -302,8 +301,7 @@ impl Printer {\n             self.print_end();\n         } else {\n             self.right += 1;\n-            self.buf.advance_right();\n-            self.buf[self.right] = BufEntry { token: Token::End, size: -1 };\n+            self.buf.push(BufEntry { token: Token::End, size: -1 });\n             self.scan_stack.push_front(self.right);\n         }\n     }\n@@ -329,9 +327,8 @@ impl Printer {\n             self.print_string(s);\n         } else {\n             self.right += 1;\n-            self.buf.advance_right();\n             let len = s.len() as isize;\n-            self.buf[self.right] = BufEntry { token: Token::String(s), size: len };\n+            self.buf.push(BufEntry { token: Token::String(s), size: len });\n             self.right_total += len;\n             self.check_stream();\n         }"}, {"sha": "94bb10382f8aff5c7ca38845a5e13f6489fe0079", "filename": "compiler/rustc_ast_pretty/src/pp/ring.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/50d722a6917eb150362ff05e4881e63b3e7adc62/compiler%2Frustc_ast_pretty%2Fsrc%2Fpp%2Fring.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50d722a6917eb150362ff05e4881e63b3e7adc62/compiler%2Frustc_ast_pretty%2Fsrc%2Fpp%2Fring.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_pretty%2Fsrc%2Fpp%2Fring.rs?ref=50d722a6917eb150362ff05e4881e63b3e7adc62", "patch": "@@ -22,6 +22,10 @@ impl<T> RingBuffer<T> {\n         RingBuffer { data: VecDeque::new(), offset: 0 }\n     }\n \n+    pub fn push(&mut self, value: T) {\n+        self.data.push_back(value);\n+    }\n+\n     pub fn advance_right(&mut self)\n     where\n         T: Default,\n@@ -34,6 +38,10 @@ impl<T> RingBuffer<T> {\n         self.offset += 1;\n     }\n \n+    pub fn clear(&mut self) {\n+        self.data.clear();\n+    }\n+\n     pub fn truncate(&mut self, len: usize) {\n         self.data.truncate(len);\n     }"}]}