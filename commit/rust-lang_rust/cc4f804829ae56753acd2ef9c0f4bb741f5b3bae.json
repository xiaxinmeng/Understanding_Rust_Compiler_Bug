{"sha": "cc4f804829ae56753acd2ef9c0f4bb741f5b3bae", "node_id": "C_kwDOAAsO6NoAKGNjNGY4MDQ4MjlhZTU2NzUzYWNkMmVmOWMwZjRiYjc0MWY1YjNiYWU", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2022-06-20T14:28:52Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2022-06-22T22:22:25Z"}, "message": "Move help popup into a pocket menu as well", "tree": {"sha": "4ff68c92ef2a7e3e9121676a8b6e734badf7a600", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4ff68c92ef2a7e3e9121676a8b6e734badf7a600"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae", "html_url": "https://github.com/rust-lang/rust/commit/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "10f4ce324baf7cfb7ce2b2096662b82b79204944", "url": "https://api.github.com/repos/rust-lang/rust/commits/10f4ce324baf7cfb7ce2b2096662b82b79204944", "html_url": "https://github.com/rust-lang/rust/commit/10f4ce324baf7cfb7ce2b2096662b82b79204944"}], "stats": {"total": 332, "additions": 173, "deletions": 159}, "files": [{"sha": "77062770c189d1cc1a9dc38c57badfde72f0fac5", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 41, "deletions": 33, "changes": 74, "blob_url": "https://github.com/rust-lang/rust/blob/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=cc4f804829ae56753acd2ef9c0f4bb741f5b3bae", "patch": "@@ -979,60 +979,69 @@ table,\n \tfont-weight: normal;\n }\n \n-body.blur > :not(#help) {\n-\tfilter: blur(8px);\n-\t-webkit-filter: blur(8px);\n-\topacity: .7;\n+.popover {\n+\tfont-size: 1rem;\n+\tposition: absolute;\n+\tright: 0;\n+\tz-index: 2;\n+\tdisplay: block;\n+\tmargin-top: 7px;\n+\tborder-radius: 3px;\n+\tborder: 1px solid;\n+\tfont-size: 1rem;\n }\n \n-#help {\n-\twidth: 100%;\n-\theight: 100vh;\n-\tposition: fixed;\n-\ttop: 0;\n-\tleft: 0;\n-\tdisplay: flex;\n-\tjustify-content: center;\n-\talign-items: center;\n+/* This rule is to draw the little arrow connecting the settings menu to the gear icon. */\n+.popover::before {\n+\tcontent: '';\n+\tposition: absolute;\n+\tright: 11px;\n+\tborder: solid;\n+\tborder-width: 1px 1px 0 0;\n+\tdisplay: inline-block;\n+\tpadding: 4px;\n+\ttransform: rotate(-45deg);\n+\ttop: -5px;\n }\n-#help > div {\n-\tflex: 0 0 auto;\n-\tbox-shadow: 0 0 6px rgba(0,0,0,.2);\n-\twidth: 550px;\n-\theight: auto;\n-\tborder: 1px solid;\n+\n+#help-button .popover {\n+\tmax-width: 600px;\n }\n-#help dt {\n+\n+#help-button .popover::before {\n+\tright: 48px;\n+}\n+\n+#help-button dt {\n \tfloat: left;\n \tclear: left;\n \tdisplay: block;\n \tmargin-right: 0.5rem;\n }\n-#help span.top, #help span.bottom {\n+#help-button span.top, #help-button span.bottom {\n \ttext-align: center;\n \tdisplay: block;\n \tfont-size: 1.125rem;\n-\n }\n-#help span.top {\n+#help-button span.top {\n \ttext-align: center;\n \tdisplay: block;\n \tmargin: 10px 0;\n \tborder-bottom: 1px solid;\n \tpadding-bottom: 4px;\n \tmargin-bottom: 6px;\n }\n-#help span.bottom {\n+#help-button span.bottom {\n \tclear: both;\n \tborder-top: 1px solid;\n }\n-#help dd { margin: 5px 35px; }\n-#help .infos { padding-left: 0; }\n-#help h1, #help h2 { margin-top: 0; }\n-#help > div div {\n+.side-by-side {\n+\ttext-align: initial;\n+}\n+.side-by-side > div {\n \twidth: 50%;\n \tfloat: left;\n-\tpadding: 0 20px 20px 17px;;\n+\tpadding: 0 20px 20px 17px;\n }\n \n .item-info .stab {\n@@ -1387,7 +1396,7 @@ pre.rust {\n #copy-path {\n \theight: 34px;\n }\n-#settings-menu > a, #help-button, #copy-path {\n+#settings-menu > a, #help-button > button, #copy-path {\n \tpadding: 5px;\n \twidth: 33px;\n \tborder: 1px solid;\n@@ -1397,9 +1406,8 @@ pre.rust {\n #settings-menu {\n \tpadding: 0;\n }\n-#settings-menu > a {\n+#settings-menu > a, #help-button > button {\n \tpadding: 5px;\n-\twidth: 100%;\n \theight: 100%;\n \tdisplay: block;\n }\n@@ -1416,7 +1424,7 @@ pre.rust {\n \tanimation: rotating 2s linear infinite;\n }\n \n-#help-button {\n+#help-button > button {\n \tfont-family: \"Fira Sans\", Arial, sans-serif;\n \ttext-align: center;\n \t/* Rare exception to specifying font sizes in rem. Since this is acting"}, {"sha": "e531e6ce6bbdeee1b6c74cf8690b7777df689ed9", "filename": "src/librustdoc/html/static/css/settings.css", "status": "modified", "additions": 0, "deletions": 21, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fsettings.css", "raw_url": "https://github.com/rust-lang/rust/raw/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fsettings.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fsettings.css?ref=cc4f804829ae56753acd2ef9c0f4bb741f5b3bae", "patch": "@@ -86,27 +86,6 @@ input:checked + .slider:before {\n \tdisplay: block;\n }\n \n-div#settings {\n-\tposition: absolute;\n-\tright: 0;\n-\tz-index: 1;\n-\tdisplay: block;\n-\tmargin-top: 7px;\n-\tborder-radius: 3px;\n-\tborder: 1px solid;\n-}\n #settings .setting-line {\n \tmargin: 1.2em 0.6em;\n }\n-/* This rule is to draw the little arrow connecting the settings menu to the gear icon. */\n-div#settings::before {\n-\tcontent: '';\n-\tposition: absolute;\n-\tright: 11px;\n-\tborder: solid;\n-\tborder-width: 1px 1px 0 0;\n-\tdisplay: inline-block;\n-\tpadding: 4px;\n-\ttransform: rotate(-45deg);\n-\ttop: -5px;\n-}"}, {"sha": "d27294657192c41a986e02a357e59b11dc7f730e", "filename": "src/librustdoc/html/static/css/themes/ayu.css", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "raw_url": "https://github.com/rust-lang/rust/raw/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css?ref=cc4f804829ae56753acd2ef9c0f4bb741f5b3bae", "patch": "@@ -5,7 +5,7 @@ Original by Dempfi (https://github.com/dempfi/ayu)\n \n /* General structure and fonts */\n \n-body, #settings-menu #settings, #settings-menu #settings::before {\n+body, .popover, .popover::before {\n \tbackground-color: #0f1419;\n \tcolor: #c5c5c5;\n }\n@@ -567,7 +567,7 @@ kbd {\n \tbox-shadow: inset 0 -1px 0 #5c6773;\n }\n \n-#settings-menu > a, #help-button {\n+#settings-menu > a, #help-button > button {\n \tborder-color: #5c6773;\n \tbackground-color: #0f1419;\n \tcolor: #fff;\n@@ -577,7 +577,8 @@ kbd {\n \tfilter: invert(100);\n }\n \n-#settings-menu #settings, #settings-menu #settings::before {\n+.popover, .popover::before,\n+#help-button span.top, #help-button span.bottom {\n \tborder-color: #5c6773;\n }\n \n@@ -592,7 +593,7 @@ kbd {\n }\n \n #settings-menu > a:hover, #settings-menu > a:focus,\n-#help-button:hover, #help-button:focus {\n+#help-button > button:hover, #help-button > button:focus {\n \tborder-color: #e0e0e0;\n }\n "}, {"sha": "48079ea2f3041f70186d22458e337bd24a8399f8", "filename": "src/librustdoc/html/static/css/themes/dark.css", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css?ref=cc4f804829ae56753acd2ef9c0f4bb741f5b3bae", "patch": "@@ -1,4 +1,4 @@\n-body, #settings-menu #settings, #settings-menu #settings::before {\n+body, .popover, .popover::before {\n \tbackground-color: #353535;\n \tcolor: #ddd;\n }\n@@ -442,18 +442,19 @@ kbd {\n \tbox-shadow: inset 0 -1px 0 #c6cbd1;\n }\n \n-#settings-menu > a, #help-button {\n+#settings-menu > a, #help-button > button {\n \tborder-color: #e0e0e0;\n \tbackground: #f0f0f0;\n \tcolor: #000;\n }\n \n #settings-menu > a:hover, #settings-menu > a:focus,\n-#help-button:hover, #help-button:focus {\n+#help-button > button:hover, #help-button > button:focus {\n \tborder-color: #ffb900;\n }\n \n-#settings-menu #settings, #settings-menu #settings::before {\n+.popover, .popover::before,\n+#help-button span.top, #help-button span.bottom {\n \tborder-color: #d2d2d2;\n }\n "}, {"sha": "f4016be96796374f548178463c2484271c7e28d4", "filename": "src/librustdoc/html/static/css/themes/light.css", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "raw_url": "https://github.com/rust-lang/rust/raw/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css?ref=cc4f804829ae56753acd2ef9c0f4bb741f5b3bae", "patch": "@@ -1,6 +1,6 @@\n /* General structure and fonts */\n \n-body, #settings-menu #settings, #settings-menu #settings::before {\n+body, .popover, .popover::before {\n \tbackground-color: white;\n \tcolor: black;\n }\n@@ -427,17 +427,18 @@ kbd {\n \tbox-shadow: inset 0 -1px 0 #c6cbd1;\n }\n \n-#settings-menu > a, #help-button {\n+#settings-menu > a, #help-button > button {\n \tborder-color: #e0e0e0;\n \tbackground-color: #fff;\n }\n \n #settings-menu > a:hover, #settings-menu > a:focus,\n-#help-button:hover, #help-button:focus {\n+#help-button > button:hover, #help-button > button:focus {\n \tborder-color: #717171;\n }\n \n-#settings-menu #settings, #settings-menu #settings::before {\n+.popover, .popover::before,\n+#help-button span.top, #help-button span.bottom {\n \tborder-color: #DDDDDD;\n }\n "}, {"sha": "1ea645d3e6594c7421ca93d8674078b0faa315ea", "filename": "src/librustdoc/html/static/js/main.js", "status": "modified", "additions": 106, "deletions": 70, "changes": 176, "blob_url": "https://github.com/rust-lang/rust/blob/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js?ref=cc4f804829ae56753acd2ef9c0f4bb741f5b3bae", "patch": "@@ -63,6 +63,24 @@ function showMain() {\n     removeClass(document.getElementById(MAIN_ID), \"hidden\");\n }\n \n+function elemIsInParent(elem, parent) {\n+    while (elem && elem !== document.body) {\n+        if (elem === parent) {\n+            return true;\n+        }\n+        elem = elem.parentElement;\n+    }\n+    return false;\n+}\n+\n+function blurHandler(event, parentElem, hideCallback) {\n+    if (!elemIsInParent(document.activeElement, parentElem) &&\n+        !elemIsInParent(event.relatedTarget, parentElem)\n+    ) {\n+        hideCallback();\n+    }\n+}\n+\n (function() {\n     window.rootPath = getVar(\"root-path\");\n     window.currentCrate = getVar(\"current-crate\");\n@@ -104,11 +122,16 @@ const MAIN_ID = \"main-content\";\n const SETTINGS_BUTTON_ID = \"settings-menu\";\n const ALTERNATIVE_DISPLAY_ID = \"alternative-display\";\n const NOT_DISPLAYED_ID = \"not-displayed\";\n+const HELP_BUTTON_ID = \"help-button\";\n \n function getSettingsButton() {\n     return document.getElementById(SETTINGS_BUTTON_ID);\n }\n \n+function getHelpButton() {\n+    return document.getElementById(HELP_BUTTON_ID);\n+}\n+\n // Returns the current URL without any query parameter or hash.\n function getNakedUrl() {\n     return window.location.href.split(\"?\")[0].split(\"#\")[0];\n@@ -381,55 +404,17 @@ function loadCss(cssFileName) {\n         openParentDetails(document.getElementById(id));\n     }\n \n-    function getHelpElement(build) {\n-        if (build) {\n-            buildHelperPopup();\n-        }\n-        return document.getElementById(\"help\");\n-    }\n-\n-    /**\n-     * Show the help popup.\n-     *\n-     * @param {boolean} display    - Whether to show or hide the popup\n-     * @param {Event}   ev         - The event that triggered this call\n-     * @param {Element} [help]     - The help element if it already exists\n-     */\n-    function displayHelp(display, ev, help) {\n-        if (display) {\n-            help = help ? help : getHelpElement(true);\n-            if (hasClass(help, \"hidden\")) {\n-                ev.preventDefault();\n-                removeClass(help, \"hidden\");\n-                addClass(document.body, \"blur\");\n-            }\n-        } else {\n-            // No need to build the help popup if we want to hide it in case it hasn't been\n-            // built yet...\n-            help = help ? help : getHelpElement(false);\n-            if (help && !hasClass(help, \"hidden\")) {\n-                ev.preventDefault();\n-                addClass(help, \"hidden\");\n-                removeClass(document.body, \"blur\");\n-            }\n-        }\n-    }\n-\n     function handleEscape(ev) {\n         searchState.clearInputTimeout();\n-        const help = getHelpElement(false);\n-        if (help && !hasClass(help, \"hidden\")) {\n-            displayHelp(false, ev, help);\n-        } else {\n-            switchDisplayedElement(null);\n-            if (browserSupportsHistoryApi()) {\n-                history.replaceState(null, window.currentCrate + \" - Rust\",\n-                    getNakedUrl() + window.location.hash);\n-            }\n-            ev.preventDefault();\n+        switchDisplayedElement(null);\n+        if (browserSupportsHistoryApi()) {\n+            history.replaceState(null, window.currentCrate + \" - Rust\",\n+                getNakedUrl() + window.location.hash);\n         }\n+        ev.preventDefault();\n         searchState.defocus();\n         window.hideSettings();\n+        hideHelp();\n     }\n \n     const disableShortcuts = getSettingValue(\"disable-shortcuts\") === \"true\";\n@@ -453,7 +438,6 @@ function loadCss(cssFileName) {\n \n             case \"s\":\n             case \"S\":\n-                displayHelp(false, ev);\n                 ev.preventDefault();\n                 searchState.focus();\n                 break;\n@@ -465,7 +449,7 @@ function loadCss(cssFileName) {\n                 break;\n \n             case \"?\":\n-                displayHelp(true, ev);\n+                showHelp();\n                 break;\n \n             default:\n@@ -796,9 +780,6 @@ function loadCss(cssFileName) {\n             elem.addEventListener(\"click\", f);\n         }\n     }\n-    handleClick(\"help-button\", ev => {\n-        displayHelp(true, ev);\n-    });\n     handleClick(MAIN_ID, () => {\n         hideSidebar();\n     });\n@@ -842,24 +823,16 @@ function loadCss(cssFileName) {\n         });\n     }\n \n-    let buildHelperPopup = () => {\n-        const popup = document.createElement(\"aside\");\n-        addClass(popup, \"hidden\");\n-        popup.id = \"help\";\n-\n-        popup.addEventListener(\"click\", ev => {\n-            if (ev.target === popup) {\n-                // Clicked the blurred zone outside the help popup; dismiss help.\n-                displayHelp(false, ev);\n-            }\n-        });\n+    function helpBlurHandler(event) {\n+        blurHandler(event, getHelpButton(), hideHelp);\n+    }\n \n+    function buildHelpMenu() {\n         const book_info = document.createElement(\"span\");\n         book_info.className = \"top\";\n         book_info.innerHTML = \"You can find more information in \\\n             <a href=\\\"https://doc.rust-lang.org/rustdoc/\\\">the rustdoc book</a>.\";\n \n-        const container = document.createElement(\"div\");\n         const shortcuts = [\n             [\"?\", \"Show this help dialog\"],\n             [\"S\", \"Focus the search field\"],\n@@ -895,23 +868,86 @@ function loadCss(cssFileName) {\n         addClass(div_infos, \"infos\");\n         div_infos.innerHTML = \"<h2>Search Tricks</h2>\" + infos;\n \n-        container.appendChild(book_info);\n-        container.appendChild(div_shortcuts);\n-        container.appendChild(div_infos);\n-\n         const rustdoc_version = document.createElement(\"span\");\n         rustdoc_version.className = \"bottom\";\n         const rustdoc_version_code = document.createElement(\"code\");\n         rustdoc_version_code.innerText = \"rustdoc \" + getVar(\"rustdoc-version\");\n         rustdoc_version.appendChild(rustdoc_version_code);\n \n+        const container = document.createElement(\"div\");\n+        container.className = \"popover\";\n+        container.style.display = \"none\";\n+\n+        const side_by_side = document.createElement(\"div\");\n+        side_by_side.className = \"side-by-side\";\n+        side_by_side.appendChild(div_shortcuts);\n+        side_by_side.appendChild(div_infos);\n+\n+        container.appendChild(book_info);\n+        container.appendChild(side_by_side);\n         container.appendChild(rustdoc_version);\n \n-        popup.appendChild(container);\n-        insertAfter(popup, document.querySelector(\"main\"));\n-        // So that it's only built once and then it'll do nothing when called!\n-        buildHelperPopup = () => {};\n-    };\n+        const help_button = getHelpButton();\n+        help_button.appendChild(container);\n+\n+        container.onblur = helpBlurHandler;\n+        container.onclick = event => {\n+            event.preventDefault();\n+        };\n+        help_button.onblur = helpBlurHandler;\n+        help_button.children[0].onblur = helpBlurHandler;\n+\n+        return container;\n+    }\n+\n+    /**\n+     * Returns the help menu element (not the button).\n+     *\n+     * @param {boolean} buildNeeded - If this argument is `false`, the help menu element won't be\n+     *                                built if it doesn't exist.\n+     *\n+     * @return {HTMLElement}\n+     */\n+    function getHelpMenu(buildNeeded) {\n+        let menu = getHelpButton().querySelector(\".popover\");\n+        if (!menu && buildNeeded) {\n+            menu = buildHelpMenu();\n+        }\n+        return menu;\n+    }\n+\n+    /**\n+     * Show the help popup menu.\n+     */\n+    function showHelp() {\n+        const menu = getHelpMenu(true);\n+        if (menu.style.display === \"none\") {\n+            menu.style.display = \"\";\n+        }\n+    }\n+\n+    /**\n+     * Hide the help popup menu.\n+     */\n+    function hideHelp() {\n+        const menu = getHelpMenu(false);\n+        if (menu && menu.style.display !== \"none\") {\n+            menu.style.display = \"none\";\n+        }\n+    }\n+\n+    document.querySelector(`#${HELP_BUTTON_ID} > button`).addEventListener(\"click\", event => {\n+        const target = event.target;\n+        if (target.tagName !== \"BUTTON\" || target.parentElement.id !== HELP_BUTTON_ID) {\n+            return;\n+        }\n+        const menu = getHelpMenu(true);\n+        if (menu.style.display !== \"none\") {\n+            hideHelp();\n+        } else {\n+            showHelp();\n+        }\n+    });\n \n     setMobileTopbar();\n     addSidebarItems();"}, {"sha": "2445773a96542fbbfacaf67cc6808863f262ac94", "filename": "src/librustdoc/html/static/js/settings.js", "status": "modified", "additions": 8, "deletions": 22, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsettings.js", "raw_url": "https://github.com/rust-lang/rust/raw/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsettings.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fsettings.js?ref=cc4f804829ae56753acd2ef9c0f4bb741f5b3bae", "patch": "@@ -1,6 +1,6 @@\n // Local js definitions:\n /* global getSettingValue, getVirtualKey, updateLocalStorage, updateSystemTheme */\n-/* global addClass, removeClass, onEach, onEachLazy */\n+/* global addClass, removeClass, onEach, onEachLazy, blurHandler, elemIsInParent */\n /* global MAIN_ID, getVar, getSettingsButton */\n \n \"use strict\";\n@@ -209,6 +209,7 @@\n         const innerHTML = `<div class=\"settings\">${buildSettingsPageSections(settings)}</div>`;\n         const el = document.createElement(elementKind);\n         el.id = \"settings\";\n+        el.className = \"popover\";\n         el.innerHTML = innerHTML;\n \n         if (isSettingsPage) {\n@@ -226,23 +227,8 @@\n         settingsMenu.style.display = \"\";\n     }\n \n-    function elemIsInParent(elem, parent) {\n-        while (elem && elem !== document.body) {\n-            if (elem === parent) {\n-                return true;\n-            }\n-            elem = elem.parentElement;\n-        }\n-        return false;\n-    }\n-\n-    function blurHandler(event) {\n-        const settingsButton = getSettingsButton();\n-        if (!elemIsInParent(document.activeElement, settingsButton) &&\n-            !elemIsInParent(event.relatedTarget, settingsButton)\n-        ) {\n-            window.hideSettings();\n-        }\n+    function settingsBlurHandler(event) {\n+        blurHandler(event, getSettingsButton(), window.hideSettings);\n     }\n \n     if (isSettingsPage) {\n@@ -268,12 +254,12 @@\n                 displaySettings();\n             }\n         };\n-        settingsButton.onblur = blurHandler;\n-        settingsButton.querySelector(\"a\").onblur = blurHandler;\n+        settingsButton.onblur = settingsBlurHandler;\n+        settingsButton.querySelector(\"a\").onblur = settingsBlurHandler;\n         onEachLazy(settingsMenu.querySelectorAll(\"input\"), el => {\n-            el.onblur = blurHandler;\n+            el.onblur = settingsBlurHandler;\n         });\n-        settingsMenu.onblur = blurHandler;\n+        settingsMenu.onblur = settingsBlurHandler;\n     }\n \n     // We now wait a bit for the web browser to end re-computing the DOM..."}, {"sha": "dfb3e4e6a2ccd5a93479bb2f3ae6a51a40bf663c", "filename": "src/librustdoc/html/templates/page.html", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html", "raw_url": "https://github.com/rust-lang/rust/raw/cc4f804829ae56753acd2ef9c0f4bb741f5b3bae/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html?ref=cc4f804829ae56753acd2ef9c0f4bb741f5b3bae", "patch": "@@ -119,7 +119,9 @@ <h2 class=\"location\"></h2>\n                                 spellcheck=\"false\" {# -#}\n                                 placeholder=\"Click or press \u2018S\u2019 to search, \u2018?\u2019 for more options\u2026\" {# -#}\n                                 type=\"search\"> {#- -#}\n-                            <button type=\"button\" id=\"help-button\" title=\"help\">?</button> {#- -#}\n+                            <div id=\"help-button\" title=\"help\" tabindex=\"-1\"> {#- -#}\n+                                <button type=\"button\">?</button> {#- -#}\n+                            </div> {#- -#}\n                             <div id=\"settings-menu\" tabindex=\"-1\">\n                                 <a href=\"{{page.root_path|safe}}settings.html\" title=\"settings\"> {#- -#}\n                                     <img width=\"22\" height=\"22\" alt=\"Change settings\" {# -#}"}]}