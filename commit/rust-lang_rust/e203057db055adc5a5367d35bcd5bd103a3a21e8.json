{"sha": "e203057db055adc5a5367d35bcd5bd103a3a21e8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmUyMDMwNTdkYjA1NWFkYzVhNTM2N2QzNWJjZDViZDEwM2EzYTIxZTg=", "commit": {"author": {"name": "Otavio Salvador", "email": "otavio@ossystems.com.br", "date": "2018-10-13T20:39:19Z"}, "committer": {"name": "Otavio Salvador", "email": "otavio@ossystems.com.br", "date": "2018-10-14T21:27:35Z"}, "message": "utils: rewrite `count_newlines` using `bytecount::count`\n\nThis uses a optimized byte count and also makes use of SIMD\ninstructions to optimize the processing of the byte arrays.\n\nSigned-off-by: Otavio Salvador <otavio@ossystems.com.br>", "tree": {"sha": "f871f02f89c96234c2bb2a75f9de7a108e4f4ca2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f871f02f89c96234c2bb2a75f9de7a108e4f4ca2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e203057db055adc5a5367d35bcd5bd103a3a21e8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e203057db055adc5a5367d35bcd5bd103a3a21e8", "html_url": "https://github.com/rust-lang/rust/commit/e203057db055adc5a5367d35bcd5bd103a3a21e8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e203057db055adc5a5367d35bcd5bd103a3a21e8/comments", "author": {"login": "otavio", "id": 25278, "node_id": "MDQ6VXNlcjI1Mjc4", "avatar_url": "https://avatars.githubusercontent.com/u/25278?v=4", "gravatar_id": "", "url": "https://api.github.com/users/otavio", "html_url": "https://github.com/otavio", "followers_url": "https://api.github.com/users/otavio/followers", "following_url": "https://api.github.com/users/otavio/following{/other_user}", "gists_url": "https://api.github.com/users/otavio/gists{/gist_id}", "starred_url": "https://api.github.com/users/otavio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/otavio/subscriptions", "organizations_url": "https://api.github.com/users/otavio/orgs", "repos_url": "https://api.github.com/users/otavio/repos", "events_url": "https://api.github.com/users/otavio/events{/privacy}", "received_events_url": "https://api.github.com/users/otavio/received_events", "type": "User", "site_admin": false}, "committer": {"login": "otavio", "id": 25278, "node_id": "MDQ6VXNlcjI1Mjc4", "avatar_url": "https://avatars.githubusercontent.com/u/25278?v=4", "gravatar_id": "", "url": "https://api.github.com/users/otavio", "html_url": "https://github.com/otavio", "followers_url": "https://api.github.com/users/otavio/followers", "following_url": "https://api.github.com/users/otavio/following{/other_user}", "gists_url": "https://api.github.com/users/otavio/gists{/gist_id}", "starred_url": "https://api.github.com/users/otavio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/otavio/subscriptions", "organizations_url": "https://api.github.com/users/otavio/orgs", "repos_url": "https://api.github.com/users/otavio/repos", "events_url": "https://api.github.com/users/otavio/events{/privacy}", "received_events_url": "https://api.github.com/users/otavio/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c4a8cdcdf1e4f574c80f04bc0c5b058c5a83b4f6", "url": "https://api.github.com/repos/rust-lang/rust/commits/c4a8cdcdf1e4f574c80f04bc0c5b058c5a83b4f6", "html_url": "https://github.com/rust-lang/rust/commit/c4a8cdcdf1e4f574c80f04bc0c5b058c5a83b4f6"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "be908dac46675e062a6c4979e46859a649ddbd08", "filename": "Cargo.lock", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/e203057db055adc5a5367d35bcd5bd103a3a21e8/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/e203057db055adc5a5367d35bcd5bd103a3a21e8/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=e203057db055adc5a5367d35bcd5bd103a3a21e8", "patch": "@@ -63,6 +63,11 @@ name = \"bitflags\"\n version = \"1.0.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"bytecount\"\n+version = \"0.3.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"byteorder\"\n version = \"1.2.6\"\n@@ -593,6 +598,7 @@ version = \"0.99.5\"\n dependencies = [\n  \"assert_cli 0.6.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"atty 0.2.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"bytecount 0.3.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"cargo_metadata 0.6.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"derive-new 0.5.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"diff 0.1.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -842,6 +848,7 @@ dependencies = [\n \"checksum backtrace 0.3.9 (registry+https://github.com/rust-lang/crates.io-index)\" = \"89a47830402e9981c5c41223151efcced65a0510c13097c769cede7efb34782a\"\n \"checksum backtrace-sys 0.1.24 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c66d56ac8dabd07f6aacdaf633f4b8262f5b3601a810a0dcddffd5c22c69daa0\"\n \"checksum bitflags 1.0.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"228047a76f468627ca71776ecdebd732a3423081fcf5125585bcd7c49886ce12\"\n+\"checksum bytecount 0.3.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"f861d9ce359f56dbcb6e0c2a1cb84e52ad732cadb57b806adeb3c7668caccbd8\"\n \"checksum byteorder 1.2.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"90492c5858dd7d2e78691cfb89f90d273a2800fc11d98f60786e5d87e2f83781\"\n \"checksum cargo_metadata 0.6.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"2d6809b327f87369e6f3651efd2c5a96c49847a3ed2559477ecba79014751ee1\"\n \"checksum cc 1.0.25 (registry+https://github.com/rust-lang/crates.io-index)\" = \"f159dfd43363c4d08055a07703eb7a3406b0dac4d0584d96965a3262db3c9d16\""}, {"sha": "e42b25a21916c3494c7f4303d3c12f8de8c3e7b5", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e203057db055adc5a5367d35bcd5bd103a3a21e8/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/e203057db055adc5a5367d35bcd5bd103a3a21e8/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=e203057db055adc5a5367d35bcd5bd103a3a21e8", "patch": "@@ -51,6 +51,7 @@ rustc-ap-rustc_target = \"272.0.0\"\n rustc-ap-syntax = \"272.0.0\"\n rustc-ap-syntax_pos = \"272.0.0\"\n failure = \"0.1.1\"\n+bytecount = { version = \"0.3\", features = [\"simd-accel\"] }\n \n [dev-dependencies]\n assert_cli = \"0.6\""}, {"sha": "772ed8cb1417b26c4174daf0b8f8aeb78218b39a", "filename": "src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/e203057db055adc5a5367d35bcd5bd103a3a21e8/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e203057db055adc5a5367d35bcd5bd103a3a21e8/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=e203057db055adc5a5367d35bcd5bd103a3a21e8", "patch": "@@ -17,6 +17,7 @@\n #[macro_use]\n extern crate derive_new;\n extern crate atty;\n+extern crate bytecount;\n extern crate diff;\n extern crate failure;\n extern crate itertools;"}, {"sha": "7ef9254a4820bfbff2125fe936c205c4365480eb", "filename": "src/utils.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/e203057db055adc5a5367d35bcd5bd103a3a21e8/src%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e203057db055adc5a5367d35bcd5bd103a3a21e8/src%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Futils.rs?ref=e203057db055adc5a5367d35bcd5bd103a3a21e8", "patch": "@@ -10,6 +10,8 @@\n \n use std::borrow::Cow;\n \n+use bytecount;\n+\n use rustc_target::spec::abi;\n use syntax::ast::{\n     self, Attribute, CrateSugar, MetaItem, MetaItemKind, NestedMetaItem, NestedMetaItemKind, Path,\n@@ -305,8 +307,8 @@ pub fn stmt_expr(stmt: &ast::Stmt) -> Option<&ast::Expr> {\n \n #[inline]\n pub fn count_newlines(input: &str) -> usize {\n-    // Using `as_bytes` to omit UTF-8 decoding\n-    input.as_bytes().iter().filter(|&&c| c == b'\\n').count()\n+    // Using bytes to omit UTF-8 decoding\n+    bytecount::count(input.as_bytes(), b'\\n')\n }\n \n // For format_missing and last_pos, need to use the source callsite (if applicable)."}]}