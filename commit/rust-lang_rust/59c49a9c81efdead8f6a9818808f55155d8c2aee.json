{"sha": "59c49a9c81efdead8f6a9818808f55155d8c2aee", "node_id": "C_kwDOAAsO6NoAKDU5YzQ5YTljODFlZmRlYWQ4ZjZhOTgxODgwOGY1NTE1NWQ4YzJhZWU", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2022-02-13T12:43:16Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-02-13T12:43:16Z"}, "message": "Merge #11442 #11460\n\n11442: fix(rename): Use text range of a mod name after macro expansion r=Veykril a=tysg\n\nFixes #11417. \n\n11460: fix: documentation of SsrParams r=Veykril a=nemethf\n\nFix #11429 by extending the documentation of SsrParms with the\r\nmandatory field 'selections'.  Copy its description from lsp_ext.rs.\n\nCo-authored-by: Tianyi Song <42670338+tysg@users.noreply.github.com>\nCo-authored-by: Felici\u00e1n N\u00e9meth <felician.nemeth@gmail.com>", "tree": {"sha": "5ee23aa4534b6ddcea45e25289d9497361d7084a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5ee23aa4534b6ddcea45e25289d9497361d7084a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/59c49a9c81efdead8f6a9818808f55155d8c2aee", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiCPzkCRBK7hj4Ov3rIwAAozgIAFOc90pVfS4l8dYMEy3a3GvS\nmw6napmQTaohMNAKLIqIyeQ/pEsVTRskZpY4TzpQ2Mbah1zaoUYP+dx1HJBBNmTV\nJ6p04ODJrGF1guYoc0NUc34I/RifC1Nw6vQbE9FQUOI/+e8adqBUHgRnUTUntroB\nDw/nC2ZMsNbdBTo6DUJoffj+GsaIAoq+uYBtPyFOpzqHsVVin0N26ixb3C7OnbAe\n21hDaavoCFqxvFz2RPQm/ApyWPaDbQza6Ld8eUYkPNPD/rogtelC0a/0576vM4i+\nqNQJluEVYCgQlSEJ8mRGCLYr4SQzx01fskdFUFVIFxAWDK8ZtDLoOsGr/vcVd4s=\n=L3x9\n-----END PGP SIGNATURE-----\n", "payload": "tree 5ee23aa4534b6ddcea45e25289d9497361d7084a\nparent e1acbd08cab164de2d6abacde2f8a4d6c5947274\nparent aa8c982c3a989672e59e2f9ca01dcac4afc668b3\nparent 7c7d6991dd78e5bde2cae7c1f4ecf8b917d8df8f\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1644756196 +0000\ncommitter GitHub <noreply@github.com> 1644756196 +0000\n\nMerge #11442 #11460\n\n11442: fix(rename): Use text range of a mod name after macro expansion r=Veykril a=tysg\n\nFixes #11417. \n\n11460: fix: documentation of SsrParams r=Veykril a=nemethf\n\nFix #11429 by extending the documentation of SsrParms with the\r\nmandatory field 'selections'.  Copy its description from lsp_ext.rs.\n\nCo-authored-by: Tianyi Song <42670338+tysg@users.noreply.github.com>\nCo-authored-by: Felici\u00e1n N\u00e9meth <felician.nemeth@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/59c49a9c81efdead8f6a9818808f55155d8c2aee", "html_url": "https://github.com/rust-lang/rust/commit/59c49a9c81efdead8f6a9818808f55155d8c2aee", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/59c49a9c81efdead8f6a9818808f55155d8c2aee/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e1acbd08cab164de2d6abacde2f8a4d6c5947274", "url": "https://api.github.com/repos/rust-lang/rust/commits/e1acbd08cab164de2d6abacde2f8a4d6c5947274", "html_url": "https://github.com/rust-lang/rust/commit/e1acbd08cab164de2d6abacde2f8a4d6c5947274"}, {"sha": "aa8c982c3a989672e59e2f9ca01dcac4afc668b3", "url": "https://api.github.com/repos/rust-lang/rust/commits/aa8c982c3a989672e59e2f9ca01dcac4afc668b3", "html_url": "https://github.com/rust-lang/rust/commit/aa8c982c3a989672e59e2f9ca01dcac4afc668b3"}, {"sha": "7c7d6991dd78e5bde2cae7c1f4ecf8b917d8df8f", "url": "https://api.github.com/repos/rust-lang/rust/commits/7c7d6991dd78e5bde2cae7c1f4ecf8b917d8df8f", "html_url": "https://github.com/rust-lang/rust/commit/7c7d6991dd78e5bde2cae7c1f4ecf8b917d8df8f"}], "stats": {"total": 51, "additions": 44, "deletions": 7}, "files": [{"sha": "daba317e427883861c4851ebdfde37f315d4d3d6", "filename": "crates/ide/src/rename.rs", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/59c49a9c81efdead8f6a9818808f55155d8c2aee/crates%2Fide%2Fsrc%2Frename.rs", "raw_url": "https://github.com/rust-lang/rust/raw/59c49a9c81efdead8f6a9818808f55155d8c2aee/crates%2Fide%2Fsrc%2Frename.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide%2Fsrc%2Frename.rs?ref=59c49a9c81efdead8f6a9818808f55155d8c2aee", "patch": "@@ -1133,6 +1133,34 @@ pub mod foo$0;\n         )\n     }\n \n+    #[test]\n+    fn test_rename_mod_in_macro() {\n+        check(\n+            \"bar\",\n+            r#\"\n+//- /foo.rs\n+\n+//- /lib.rs\n+macro_rules! submodule {\n+    ($name:ident) => {\n+        mod $name;\n+    };\n+}\n+\n+submodule!($0foo);\n+\"#,\n+            r#\"\n+macro_rules! submodule {\n+    ($name:ident) => {\n+        mod $name;\n+    };\n+}\n+\n+submodule!(bar);\n+\"#,\n+        )\n+    }\n+\n     #[test]\n     fn test_enum_variant_from_module_1() {\n         cov_mark::check!(rename_non_local);"}, {"sha": "404e17c022b67bb15e4e06c21d5927980d39f240", "filename": "crates/ide_db/src/rename.rs", "status": "modified", "additions": 14, "deletions": 7, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/59c49a9c81efdead8f6a9818808f55155d8c2aee/crates%2Fide_db%2Fsrc%2Frename.rs", "raw_url": "https://github.com/rust-lang/rust/raw/59c49a9c81efdead8f6a9818808f55155d8c2aee/crates%2Fide_db%2Fsrc%2Frename.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_db%2Fsrc%2Frename.rs?ref=59c49a9c81efdead8f6a9818808f55155d8c2aee", "patch": "@@ -188,16 +188,23 @@ fn rename_mod(\n         source_change.push_file_system_edit(move_file);\n     }\n \n-    if let Some(InFile { file_id, value: decl_source }) = module.declaration_source(sema.db) {\n-        let file_id = file_id.original_file(sema.db);\n-        match decl_source.name() {\n-            Some(name) => source_change.insert_source_edit(\n-                file_id,\n-                TextEdit::replace(name.syntax().text_range(), new_name.to_string()),\n-            ),\n+    if let Some(src) = module.declaration_source(sema.db) {\n+        let file_id = src.file_id.original_file(sema.db);\n+        match src.value.name() {\n+            Some(name) => {\n+                if let Some(file_range) =\n+                    src.with_value(name.syntax()).original_file_range_opt(sema.db)\n+                {\n+                    source_change.insert_source_edit(\n+                        file_id,\n+                        TextEdit::replace(file_range.range, new_name.to_string()),\n+                    )\n+                };\n+            }\n             _ => never!(\"Module source node is missing a name\"),\n         }\n     }\n+\n     let def = Definition::Module(module);\n     let usages = def.usages(sema).all();\n     let ref_edits = usages.iter().map(|(&file_id, references)| {"}, {"sha": "85df1188a8a779815138eab52e92c4e21f50d75c", "filename": "docs/dev/lsp-extensions.md", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/59c49a9c81efdead8f6a9818808f55155d8c2aee/docs%2Fdev%2Flsp-extensions.md", "raw_url": "https://github.com/rust-lang/rust/raw/59c49a9c81efdead8f6a9818808f55155d8c2aee/docs%2Fdev%2Flsp-extensions.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fdev%2Flsp-extensions.md?ref=59c49a9c81efdead8f6a9818808f55155d8c2aee", "patch": "@@ -278,6 +278,8 @@ interface SsrParams {\n     textDocument: TextDocumentIdentifier;\n     /// Position where SSR was invoked.\n     position: Position;\n+    /// Current selections. Search/replace will be restricted to these if non-empty.\n+    selections: Range[];\n }\n ```\n "}]}