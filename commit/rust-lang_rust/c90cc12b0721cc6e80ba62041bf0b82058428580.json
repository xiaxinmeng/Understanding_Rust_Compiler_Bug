{"sha": "c90cc12b0721cc6e80ba62041bf0b82058428580", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM5MGNjMTJiMDcyMWNjNmU4MGJhNjIwNDFiZjBiODIwNTg0Mjg1ODA=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-10-31T15:56:11Z"}, "committer": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2019-11-12T10:06:11Z"}, "message": "ci: move validate-toolstate.sh in the mingw-check image\n\nThe task was already run just there, so this cleans things up.", "tree": {"sha": "a2428da52b839fb71741a26485308e7d59689f00", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a2428da52b839fb71741a26485308e7d59689f00"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c90cc12b0721cc6e80ba62041bf0b82058428580", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE1JbYPtLJAsc22U9xPgar6Auq8ZwFAl3KhBwACgkQPgar6Auq\n8Zx90g//fPfCizu+uEMxatcqhf1VJFxxceIZTcKx65UOt9hyuIUN4UpRnDazY04a\ntPBsaLGFKsEI3jCTIcTK0LG9jkK7K7NPuNmYtrEs++LYL9LNA2R7D4YW8jmQboI7\nPDw+uAJNq0J3Ko+v1oERCG5on/Ow+tK7VRsi+DVnvII5mdt55fYd6OvcX58rc1E/\nRGwEoEZ5AYLnGita5/uAv/uvAnuA0oDd7snvsoc8xEcVTXtS5VIfNCAqH4tNG9V8\nrCfQHE2K5E+HmmKgXHuWmlaDGW8XhVk6oo1Vsa+HhxDqukpKUX4npdngzoGbgTkS\n+ChicM7z/Fgg2CkyK0MQebybZkbL9QxPLzajjP4IpwBhvwp9gP1iiaD35WbzO9xV\nWt9hG8/P0EQG0i1NYuu/EUjDG8dMDqBQ8Wqc/UW1mps+6KrzkOJnwKQ8umcZm9U5\nuWv7AaT9gBI26G2dLdt9ONWCH3uqMl9zH2YesL6uN9FzdIiOpi/40FtxqVHN8q8N\nbGu2jcBzr02UDNB1BKzIhPSnxuDS6rVNVJwm6M1QQ80a0xiRz9I7e5ecDybwJbQo\nf1jm4I9RHekxCX04QPNUmh6KdVNqh8ncN0wI0dbqYcGTaeczqpJHnyrQHznnmRjJ\nba1VItULgnZpCD/zZtAtbgWRXstCmzDZZJrLiS0tW1Qnh0xVXJA=\n=x+QW\n-----END PGP SIGNATURE-----", "payload": "tree a2428da52b839fb71741a26485308e7d59689f00\nparent e209ee42e99cd76d7fefd0c53fbd84f0d2123935\nauthor Pietro Albini <pietro@pietroalbini.org> 1572537371 +0100\ncommitter Pietro Albini <pietro@pietroalbini.org> 1573553171 +0100\n\nci: move validate-toolstate.sh in the mingw-check image\n\nThe task was already run just there, so this cleans things up.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c90cc12b0721cc6e80ba62041bf0b82058428580", "html_url": "https://github.com/rust-lang/rust/commit/c90cc12b0721cc6e80ba62041bf0b82058428580", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c90cc12b0721cc6e80ba62041bf0b82058428580/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e209ee42e99cd76d7fefd0c53fbd84f0d2123935", "url": "https://api.github.com/repos/rust-lang/rust/commits/e209ee42e99cd76d7fefd0c53fbd84f0d2123935", "html_url": "https://github.com/rust-lang/rust/commit/e209ee42e99cd76d7fefd0c53fbd84f0d2123935"}], "stats": {"total": 22, "additions": 9, "deletions": 13}, "files": [{"sha": "214c11fd69024ef191ed62d2f8342e1b385e103f", "filename": "src/ci/azure-pipelines/steps/run.yml", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c90cc12b0721cc6e80ba62041bf0b82058428580/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "raw_url": "https://github.com/rust-lang/rust/raw/c90cc12b0721cc6e80ba62041bf0b82058428580/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fazure-pipelines%2Fsteps%2Frun.yml?ref=c90cc12b0721cc6e80ba62041bf0b82058428580", "patch": "@@ -139,14 +139,6 @@ steps:\n   condition: and(succeeded(), not(variables.SKIP_JOB))\n   displayName: Install awscli\n \n-# As a quick smoke check on the otherwise very fast mingw-check linux builder\n-# check our own internal scripts.\n-- bash: src/ci/scripts/validate-toolstate.sh\n-  env:\n-    TOOLSTATE_REPO_ACCESS_TOKEN: $(TOOLSTATE_REPO_ACCESS_TOKEN)\n-  condition: and(succeeded(), not(variables.SKIP_JOB), eq(variables['IMAGE'], 'mingw-check'))\n-  displayName: Verify the publish_toolstate script works\n-\n - bash: src/ci/scripts/run-build-from-ci.sh\n   timeoutInMinutes: 600\n   env:"}, {"sha": "b2d96aed2a9e80370010739bd24f7da54eb66481", "filename": "src/ci/docker/mingw-check/Dockerfile", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/c90cc12b0721cc6e80ba62041bf0b82058428580/src%2Fci%2Fdocker%2Fmingw-check%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/c90cc12b0721cc6e80ba62041bf0b82058428580/src%2Fci%2Fdocker%2Fmingw-check%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fmingw-check%2FDockerfile?ref=c90cc12b0721cc6e80ba62041bf0b82058428580", "patch": "@@ -19,7 +19,10 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+COPY mingw-check/validate-toolstate.sh /scripts/\n+\n ENV RUN_CHECK_WITH_PARALLEL_QUERIES 1\n ENV SCRIPT python2.7 ../x.py check --target=i686-pc-windows-gnu --host=i686-pc-windows-gnu && \\\n            python2.7 ../x.py build --stage 0 src/tools/build-manifest && \\\n-           python2.7 ../x.py test --stage 0 src/tools/compiletest\n+           python2.7 ../x.py test --stage 0 src/tools/compiletest && \\\n+           /scripts/validate-toolstate.sh"}, {"sha": "2ebf1d6d5ae7f1882a0d3864bd0b7b9244681b34", "filename": "src/ci/docker/mingw-check/validate-toolstate.sh", "status": "renamed", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/c90cc12b0721cc6e80ba62041bf0b82058428580/src%2Fci%2Fdocker%2Fmingw-check%2Fvalidate-toolstate.sh", "raw_url": "https://github.com/rust-lang/rust/raw/c90cc12b0721cc6e80ba62041bf0b82058428580/src%2Fci%2Fdocker%2Fmingw-check%2Fvalidate-toolstate.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fmingw-check%2Fvalidate-toolstate.sh?ref=c90cc12b0721cc6e80ba62041bf0b82058428580", "patch": "@@ -4,15 +4,16 @@\n set -euo pipefail\n IFS=$'\\n\\t'\n \n-source \"$(cd \"$(dirname \"$0\")\" && pwd)/../shared.sh\"\n-\n+rm -rf rust-toolstate\n git clone --depth=1 https://github.com/rust-lang-nursery/rust-toolstate.git\n cd rust-toolstate\n-python2.7 \"${BUILD_SOURCESDIRECTORY}/src/tools/publish_toolstate.py\" \"$(git rev-parse HEAD)\" \"$(git log --format=%s -n1 HEAD)\" \"\" \"\"\n+python2.7 \"../../src/tools/publish_toolstate.py\" \"$(git rev-parse HEAD)\" \\\n+    \"$(git log --format=%s -n1 HEAD)\" \"\" \"\"\n # Only check maintainers if this build is supposed to publish toolstate.\n # Builds that are not supposed to publish don't have the access token.\n if [ -n \"${TOOLSTATE_PUBLISH+is_set}\" ]; then\n-  TOOLSTATE_VALIDATE_MAINTAINERS_REPO=rust-lang/rust python2.7 \"${BUILD_SOURCESDIRECTORY}/src/tools/publish_toolstate.py\"\n+  TOOLSTATE_VALIDATE_MAINTAINERS_REPO=rust-lang/rust python2.7 \\\n+      \"../../src/tools/publish_toolstate.py\"\n fi\n cd ..\n rm -rf rust-toolstate", "previous_filename": "src/ci/scripts/validate-toolstate.sh"}]}