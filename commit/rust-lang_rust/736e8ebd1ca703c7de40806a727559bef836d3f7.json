{"sha": "736e8ebd1ca703c7de40806a727559bef836d3f7", "node_id": "C_kwDOAAsO6NoAKDczNmU4ZWJkMWNhNzAzYzdkZTQwODA2YTcyNzU1OWJlZjgzNmQzZjc", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2021-10-23T03:28:22Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-10-23T03:28:22Z"}, "message": "Rollup merge of #89730 - crlf0710:type_changing_feature, r=jackh726\n\nadd feature flag for `type_changing_struct_update`\n\nThis implements the PR0 part of the mentoring notes within #86618.\n\noverrides the previous inactive #86646 pr.\n\nr? ```@nikomatsakis```", "tree": {"sha": "71d6b1ed91a078049dd1282e7ba854f01f1a144b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/71d6b1ed91a078049dd1282e7ba854f01f1a144b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/736e8ebd1ca703c7de40806a727559bef836d3f7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhc4FXCRBK7hj4Ov3rIwAAiNIIAGqzspQTUrTRTsWAaDekkxVR\nSuVeDq432K6KrZKFVeOg7b5X0e+2331gq6byLJsKwlLEtfHGs96xNwS8Y67I7iYr\noeApEjPFqU+w0lKmeGVbAA74IXAKny5n4zP6R1YUVQxyWW6SxlPXEk96g1xp89uO\nvLhVa5FuiROIyG+Db4lf50vB/+InfbU874ZP4N0INBnwCuBhHqtkmkqB53/MHJwn\n76BnO6I1Wtfny2caZkW1OrF3Gp5u2xzhh/dtA2dwRQ1Flsy0R6X2fQxTDkpcOyxu\n7bM6K9FJjjd7hWfehqcxWsde+vq7qhhZBMqKGr0jxlP1kAPBpO+QE2IN9Pig1eE=\n=ndL6\n-----END PGP SIGNATURE-----\n", "payload": "tree 71d6b1ed91a078049dd1282e7ba854f01f1a144b\nparent 0f81c7faf5f657704b2e29154af3c09aca7afd67\nparent 7d7ebf88057ad6e16331e02a86c5951ecd1f23db\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1634959702 +0200\ncommitter GitHub <noreply@github.com> 1634959702 +0200\n\nRollup merge of #89730 - crlf0710:type_changing_feature, r=jackh726\n\nadd feature flag for `type_changing_struct_update`\n\nThis implements the PR0 part of the mentoring notes within #86618.\n\noverrides the previous inactive #86646 pr.\n\nr? ```@nikomatsakis```\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/736e8ebd1ca703c7de40806a727559bef836d3f7", "html_url": "https://github.com/rust-lang/rust/commit/736e8ebd1ca703c7de40806a727559bef836d3f7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/736e8ebd1ca703c7de40806a727559bef836d3f7/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0f81c7faf5f657704b2e29154af3c09aca7afd67", "url": "https://api.github.com/repos/rust-lang/rust/commits/0f81c7faf5f657704b2e29154af3c09aca7afd67", "html_url": "https://github.com/rust-lang/rust/commit/0f81c7faf5f657704b2e29154af3c09aca7afd67"}, {"sha": "7d7ebf88057ad6e16331e02a86c5951ecd1f23db", "url": "https://api.github.com/repos/rust-lang/rust/commits/7d7ebf88057ad6e16331e02a86c5951ecd1f23db", "html_url": "https://github.com/rust-lang/rust/commit/7d7ebf88057ad6e16331e02a86c5951ecd1f23db"}], "stats": {"total": 43, "additions": 43, "deletions": 0}, "files": [{"sha": "2bbfb561ba59461a6ea310f6417673d5c497ffc0", "filename": "compiler/rustc_feature/src/active.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/736e8ebd1ca703c7de40806a727559bef836d3f7/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/736e8ebd1ca703c7de40806a727559bef836d3f7/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Factive.rs?ref=736e8ebd1ca703c7de40806a727559bef836d3f7", "patch": "@@ -684,6 +684,10 @@ declare_features! (\n     /// Allows using the `non_exhaustive_omitted_patterns` lint.\n     (active, non_exhaustive_omitted_patterns_lint, \"1.57.0\", Some(89554), None),\n \n+    /// Allows creation of instances of a struct by moving fields that have\n+    /// not changed from prior instances of the same struct (RFC #2528)\n+    (incomplete, type_changing_struct_update, \"1.58.0\", Some(86555), None),\n+\n     // -------------------------------------------------------------------------\n     // feature-group-end: actual feature gates\n     // -------------------------------------------------------------------------"}, {"sha": "476809c787f0a1c5e341f4fe4465fee940ba8557", "filename": "compiler/rustc_span/src/symbol.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/736e8ebd1ca703c7de40806a727559bef836d3f7/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/736e8ebd1ca703c7de40806a727559bef836d3f7/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs?ref=736e8ebd1ca703c7de40806a727559bef836d3f7", "patch": "@@ -1338,6 +1338,7 @@ symbols! {\n         type_alias_enum_variants,\n         type_alias_impl_trait,\n         type_ascription,\n+        type_changing_struct_update,\n         type_id,\n         type_length_limit,\n         type_macros,"}, {"sha": "520c1478f323481c3ce4e8985b5bd860526669e1", "filename": "src/test/ui/feature-gates/feature-gate-type_changing_struct_update.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/736e8ebd1ca703c7de40806a727559bef836d3f7/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-type_changing_struct_update.rs", "raw_url": "https://github.com/rust-lang/rust/raw/736e8ebd1ca703c7de40806a727559bef836d3f7/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-type_changing_struct_update.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-type_changing_struct_update.rs?ref=736e8ebd1ca703c7de40806a727559bef836d3f7", "patch": "@@ -0,0 +1,26 @@\n+#[derive(Debug)]\n+struct Machine<S> {\n+    state: S,\n+    common_field1: &'static str,\n+    common_field2: i32,\n+}\n+#[derive(Debug)]\n+struct State1;\n+#[derive(Debug, PartialEq)]\n+struct State2;\n+\n+fn update_to_state2() {\n+    let m1: Machine<State1> = Machine {\n+        state: State1,\n+        common_field1: \"hello\",\n+        common_field2: 2,\n+    };\n+    let m2: Machine<State2> = Machine {\n+        state: State2,\n+        ..m1 //~ ERROR mismatched types\n+    };\n+    // FIXME: this should trigger feature gate\n+    assert_eq!(State2, m2.state);\n+}\n+\n+fn main() {}"}, {"sha": "9934fe6816430e4d64403efe9459f14a291575ce", "filename": "src/test/ui/feature-gates/feature-gate-type_changing_struct_update.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/736e8ebd1ca703c7de40806a727559bef836d3f7/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-type_changing_struct_update.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/736e8ebd1ca703c7de40806a727559bef836d3f7/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-type_changing_struct_update.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-type_changing_struct_update.stderr?ref=736e8ebd1ca703c7de40806a727559bef836d3f7", "patch": "@@ -0,0 +1,12 @@\n+error[E0308]: mismatched types\n+  --> $DIR/feature-gate-type_changing_struct_update.rs:20:11\n+   |\n+LL |         ..m1\n+   |           ^^ expected struct `State2`, found struct `State1`\n+   |\n+   = note: expected struct `Machine<State2>`\n+              found struct `Machine<State1>`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}]}