{"sha": "424e8f0fd55b94a45ebe112dc77312e3fab1ebfe", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQyNGU4ZjBmZDU1Yjk0YTQ1ZWJlMTEyZGM3NzMxMmUzZmFiMWViZmU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-08-24T10:31:25Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-08-24T10:31:25Z"}, "message": "auto merge of #8679 : singingboyo/rust/json-to-impl, r=alexcrichton\n\nto_str, to_pretty_str, to_writer, and to_pretty_writer were at the top\r\nlevel of extra::json, this moves them into an impl for Json to match\r\nwith what's been done for the rest of libextra and libstd.  (or at least for vec and str)\r\n\r\nAlso meant changing some tests.\r\n\r\nCloses #8676.", "tree": {"sha": "cb56ed2b6d6122c93b72888ea508e9661693fe0b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cb56ed2b6d6122c93b72888ea508e9661693fe0b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/424e8f0fd55b94a45ebe112dc77312e3fab1ebfe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/424e8f0fd55b94a45ebe112dc77312e3fab1ebfe", "html_url": "https://github.com/rust-lang/rust/commit/424e8f0fd55b94a45ebe112dc77312e3fab1ebfe", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/424e8f0fd55b94a45ebe112dc77312e3fab1ebfe/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bb9c71fe82005d2d85f459988d9986f7c817717e", "url": "https://api.github.com/repos/rust-lang/rust/commits/bb9c71fe82005d2d85f459988d9986f7c817717e", "html_url": "https://github.com/rust-lang/rust/commit/bb9c71fe82005d2d85f459988d9986f7c817717e"}, {"sha": "3b9e2efd64c7683a4fd8dd9126cc0473dc2201af", "url": "https://api.github.com/repos/rust-lang/rust/commits/3b9e2efd64c7683a4fd8dd9126cc0473dc2201af", "html_url": "https://github.com/rust-lang/rust/commit/3b9e2efd64c7683a4fd8dd9126cc0473dc2201af"}], "stats": {"total": 126, "additions": 61, "deletions": 65}, "files": [{"sha": "a13836d87bd74f88462813e4decfa28341a9e653", "filename": "src/libextra/json.rs", "status": "modified", "additions": 60, "deletions": 64, "changes": 124, "blob_url": "https://github.com/rust-lang/rust/blob/424e8f0fd55b94a45ebe112dc77312e3fab1ebfe/src%2Flibextra%2Fjson.rs", "raw_url": "https://github.com/rust-lang/rust/raw/424e8f0fd55b94a45ebe112dc77312e3fab1ebfe/src%2Flibextra%2Fjson.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibextra%2Fjson.rs?ref=424e8f0fd55b94a45ebe112dc77312e3fab1ebfe", "patch": "@@ -459,26 +459,24 @@ impl<E: serialize::Encoder> serialize::Encodable<E> for Json {\n     }\n }\n \n-/// Encodes a json value into a io::writer\n-pub fn to_writer(wr: @io::Writer, json: &Json) {\n-    let mut encoder = Encoder(wr);\n-    json.encode(&mut encoder)\n-}\n-\n-/// Encodes a json value into a string\n-pub fn to_str(json: &Json) -> ~str {\n-    io::with_str_writer(|wr| to_writer(wr, json))\n-}\n+impl Json{\n+    /// Encodes a json value into a io::writer.  Uses a single line.\n+    pub fn to_writer(&self, wr: @io::Writer) {\n+        let mut encoder = Encoder(wr);\n+        self.encode(&mut encoder)\n+    }\n \n-/// Encodes a json value into a io::writer\n-pub fn to_pretty_writer(wr: @io::Writer, json: &Json) {\n-    let mut encoder = PrettyEncoder(wr);\n-    json.encode(&mut encoder)\n-}\n+    /// Encodes a json value into a io::writer.\n+    /// Pretty-prints in a more readable format.\n+    pub fn to_pretty_writer(&self, wr: @io::Writer) {\n+        let mut encoder = PrettyEncoder(wr);\n+        self.encode(&mut encoder)\n+    }\n \n-/// Encodes a json value into a string\n-pub fn to_pretty_str(json: &Json) -> ~str {\n-    io::with_str_writer(|wr| to_pretty_writer(wr, json))\n+    /// Encodes a json value into a string\n+    pub fn to_pretty_str(&self) -> ~str {\n+        io::with_str_writer(|wr| self.to_pretty_writer(wr))\n+    }\n }\n \n pub struct Parser<T> {\n@@ -1307,7 +1305,10 @@ impl<A:ToJson> ToJson for Option<A> {\n }\n \n impl to_str::ToStr for Json {\n-    fn to_str(&self) -> ~str { to_str(self) }\n+    /// Encodes a json value into a string\n+    fn to_str(&self) -> ~str {\n+      io::with_str_writer(|wr| self.to_writer(wr))\n+    }\n }\n \n impl to_str::ToStr for Error {\n@@ -1358,69 +1359,67 @@ mod tests {\n \n     #[test]\n     fn test_write_null() {\n-        assert_eq!(to_str(&Null), ~\"null\");\n-        assert_eq!(to_pretty_str(&Null), ~\"null\");\n+        assert_eq!(Null.to_str(), ~\"null\");\n+        assert_eq!(Null.to_pretty_str(), ~\"null\");\n     }\n \n \n     #[test]\n     fn test_write_number() {\n-        assert_eq!(to_str(&Number(3f)), ~\"3\");\n-        assert_eq!(to_pretty_str(&Number(3f)), ~\"3\");\n+        assert_eq!(Number(3f).to_str(), ~\"3\");\n+        assert_eq!(Number(3f).to_pretty_str(), ~\"3\");\n \n-        assert_eq!(to_str(&Number(3.1f)), ~\"3.1\");\n-        assert_eq!(to_pretty_str(&Number(3.1f)), ~\"3.1\");\n+        assert_eq!(Number(3.1f).to_str(), ~\"3.1\");\n+        assert_eq!(Number(3.1f).to_pretty_str(), ~\"3.1\");\n \n-        assert_eq!(to_str(&Number(-1.5f)), ~\"-1.5\");\n-        assert_eq!(to_pretty_str(&Number(-1.5f)), ~\"-1.5\");\n+        assert_eq!(Number(-1.5f).to_str(), ~\"-1.5\");\n+        assert_eq!(Number(-1.5f).to_pretty_str(), ~\"-1.5\");\n \n-        assert_eq!(to_str(&Number(0.5f)), ~\"0.5\");\n-        assert_eq!(to_pretty_str(&Number(0.5f)), ~\"0.5\");\n+        assert_eq!(Number(0.5f).to_str(), ~\"0.5\");\n+        assert_eq!(Number(0.5f).to_pretty_str(), ~\"0.5\");\n     }\n \n     #[test]\n     fn test_write_str() {\n-        assert_eq!(to_str(&String(~\"\")), ~\"\\\"\\\"\");\n-        assert_eq!(to_pretty_str(&String(~\"\")), ~\"\\\"\\\"\");\n+        assert_eq!(String(~\"\").to_str(), ~\"\\\"\\\"\");\n+        assert_eq!(String(~\"\").to_pretty_str(), ~\"\\\"\\\"\");\n \n-        assert_eq!(to_str(&String(~\"foo\")), ~\"\\\"foo\\\"\");\n-        assert_eq!(to_pretty_str(&String(~\"foo\")), ~\"\\\"foo\\\"\");\n+        assert_eq!(String(~\"foo\").to_str(), ~\"\\\"foo\\\"\");\n+        assert_eq!(String(~\"foo\").to_pretty_str(), ~\"\\\"foo\\\"\");\n     }\n \n     #[test]\n     fn test_write_bool() {\n-        assert_eq!(to_str(&Boolean(true)), ~\"true\");\n-        assert_eq!(to_pretty_str(&Boolean(true)), ~\"true\");\n+        assert_eq!(Boolean(true).to_str(), ~\"true\");\n+        assert_eq!(Boolean(true).to_pretty_str(), ~\"true\");\n \n-        assert_eq!(to_str(&Boolean(false)), ~\"false\");\n-        assert_eq!(to_pretty_str(&Boolean(false)), ~\"false\");\n+        assert_eq!(Boolean(false).to_str(), ~\"false\");\n+        assert_eq!(Boolean(false).to_pretty_str(), ~\"false\");\n     }\n \n     #[test]\n     fn test_write_list() {\n-        assert_eq!(to_str(&List(~[])), ~\"[]\");\n-        assert_eq!(to_pretty_str(&List(~[])), ~\"[]\");\n+        assert_eq!(List(~[]).to_str(), ~\"[]\");\n+        assert_eq!(List(~[]).to_pretty_str(), ~\"[]\");\n \n-        assert_eq!(to_str(&List(~[Boolean(true)])), ~\"[true]\");\n+        assert_eq!(List(~[Boolean(true)]).to_str(), ~\"[true]\");\n         assert_eq!(\n-            to_pretty_str(&List(~[Boolean(true)])),\n+            List(~[Boolean(true)]).to_pretty_str(),\n             ~\"\\\n             [\\n  \\\n                 true\\n\\\n             ]\"\n         );\n \n-        assert_eq!(to_str(&List(~[\n+        let longTestList = List(~[\n             Boolean(false),\n             Null,\n-            List(~[String(~\"foo\\nbar\"), Number(3.5f)])\n-        ])), ~\"[false,null,[\\\"foo\\\\nbar\\\",3.5]]\");\n+            List(~[String(~\"foo\\nbar\"), Number(3.5f)])]);\n+\n+        assert_eq!(longTestList.to_str(),\n+            ~\"[false,null,[\\\"foo\\\\nbar\\\",3.5]]\");\n         assert_eq!(\n-            to_pretty_str(&List(~[\n-                Boolean(false),\n-                Null,\n-                List(~[String(~\"foo\\nbar\"), Number(3.5f)])\n-            ])),\n+            longTestList.to_pretty_str(),\n             ~\"\\\n             [\\n  \\\n                 false,\\n  \\\n@@ -1435,28 +1434,30 @@ mod tests {\n \n     #[test]\n     fn test_write_object() {\n-        assert_eq!(to_str(&mk_object([])), ~\"{}\");\n-        assert_eq!(to_pretty_str(&mk_object([])), ~\"{}\");\n+        assert_eq!(mk_object([]).to_str(), ~\"{}\");\n+        assert_eq!(mk_object([]).to_pretty_str(), ~\"{}\");\n \n         assert_eq!(\n-            to_str(&mk_object([(~\"a\", Boolean(true))])),\n+            mk_object([(~\"a\", Boolean(true))]).to_str(),\n             ~\"{\\\"a\\\":true}\"\n         );\n         assert_eq!(\n-            to_pretty_str(&mk_object([(~\"a\", Boolean(true))])),\n+            mk_object([(~\"a\", Boolean(true))]).to_pretty_str(),\n             ~\"\\\n             {\\n  \\\n                 \\\"a\\\": true\\n\\\n             }\"\n         );\n \n-        assert_eq!(\n-            to_str(&mk_object([\n+        let complexObj = mk_object([\n                 (~\"b\", List(~[\n                     mk_object([(~\"c\", String(~\"\\x0c\\r\"))]),\n                     mk_object([(~\"d\", String(~\"\"))])\n                 ]))\n-            ])),\n+            ]);\n+\n+        assert_eq!(\n+            complexObj.to_str(),\n             ~\"{\\\n                 \\\"b\\\":[\\\n                     {\\\"c\\\":\\\"\\\\f\\\\r\\\"},\\\n@@ -1465,12 +1466,7 @@ mod tests {\n             }\"\n         );\n         assert_eq!(\n-            to_pretty_str(&mk_object([\n-                (~\"b\", List(~[\n-                    mk_object([(~\"c\", String(~\"\\x0c\\r\"))]),\n-                    mk_object([(~\"d\", String(~\"\"))])\n-                ]))\n-            ])),\n+            complexObj.to_pretty_str(),\n             ~\"\\\n             {\\n  \\\n                 \\\"b\\\": [\\n    \\\n@@ -1494,8 +1490,8 @@ mod tests {\n \n         // We can't compare the strings directly because the object fields be\n         // printed in a different order.\n-        assert_eq!(a.clone(), from_str(to_str(&a)).unwrap());\n-        assert_eq!(a.clone(), from_str(to_pretty_str(&a)).unwrap());\n+        assert_eq!(a.clone(), from_str(a.to_str()).unwrap());\n+        assert_eq!(a.clone(), from_str(a.to_pretty_str()).unwrap());\n     }\n \n     #[test]"}, {"sha": "ccade8f19bebc456104c316f15726333364555ac", "filename": "src/libextra/test.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/424e8f0fd55b94a45ebe112dc77312e3fab1ebfe/src%2Flibextra%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/424e8f0fd55b94a45ebe112dc77312e3fab1ebfe/src%2Flibextra%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibextra%2Ftest.rs?ref=424e8f0fd55b94a45ebe112dc77312e3fab1ebfe", "patch": "@@ -907,7 +907,7 @@ impl MetricMap {\n     /// Write MetricDiff to a file.\n     pub fn save(&self, p: &Path) {\n         let f = io::file_writer(p, [io::Create, io::Truncate]).unwrap();\n-        json::to_pretty_writer(f, &self.to_json());\n+        self.to_json().to_pretty_writer(f);\n     }\n \n     /// Compare against another MetricMap. Optionally compare all"}]}