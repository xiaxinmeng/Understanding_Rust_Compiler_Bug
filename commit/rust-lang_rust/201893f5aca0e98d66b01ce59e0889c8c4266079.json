{"sha": "201893f5aca0e98d66b01ce59e0889c8c4266079", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIwMTg5M2Y1YWNhMGU5OGQ2NmIwMWNlNTllMDg4OWM4YzQyNjYwNzk=", "commit": {"author": {"name": "Dylan DPC", "email": "dylan.dpc@gmail.com", "date": "2021-03-17T23:28:12Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-03-17T23:28:12Z"}, "message": "Rollup merge of #83204 - jethrogb:jb/sgx-c-build, r=joshtriplett,raoulstrackx\n\nSimplify C compilation for Fortanix-SGX target\n\ncc ``@raoulstrackx``", "tree": {"sha": "e9b72cb93f94776a0ca89684d997844bef5e6eec", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e9b72cb93f94776a0ca89684d997844bef5e6eec"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/201893f5aca0e98d66b01ce59e0889c8c4266079", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgUpCNCRBK7hj4Ov3rIwAAdHIIAE39T7syMcPllMbJGkM7CyGB\nc3WgehjYZd6pTBhH9FaOCla8fsntxaW8pu4H6AkqjG3CiYiQhtNDCD4z3ef9Ucdz\nkNMPIvpdCj3z+ypHFuwxVYEHpODCv4LrXjh2juSllrlSsMeAK2OgZZ0g37Ijr4t9\nMGP+2Yi4EOLZyhtfoGPV9HkZlMYDFCv0vSu+z5TzWa3b3DD2ore0I6HMpRmBINAj\nDWcaEca4zum2/tJe17zZ5kj4N264/pOaLK99BT9ehdPjjQfWdtH1h9KHZ8wUPTAy\nptXXs8AoeHQUdCQhVaGusFPq9wAM2XEvIvXMcrn6tfx139q41UIMwYyJsGFt/4c=\n=ci6F\n-----END PGP SIGNATURE-----\n", "payload": "tree e9b72cb93f94776a0ca89684d997844bef5e6eec\nparent 1e23ab5dec7f8fc18e64f530276c3a9c0b79628f\nparent 5bd50ef9be0d234224402ad080e55e4cf3b48546\nauthor Dylan DPC <dylan.dpc@gmail.com> 1616023692 +0100\ncommitter GitHub <noreply@github.com> 1616023692 +0100\n\nRollup merge of #83204 - jethrogb:jb/sgx-c-build, r=joshtriplett,raoulstrackx\n\nSimplify C compilation for Fortanix-SGX target\n\ncc ``@raoulstrackx``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/201893f5aca0e98d66b01ce59e0889c8c4266079", "html_url": "https://github.com/rust-lang/rust/commit/201893f5aca0e98d66b01ce59e0889c8c4266079", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/201893f5aca0e98d66b01ce59e0889c8c4266079/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1e23ab5dec7f8fc18e64f530276c3a9c0b79628f", "url": "https://api.github.com/repos/rust-lang/rust/commits/1e23ab5dec7f8fc18e64f530276c3a9c0b79628f", "html_url": "https://github.com/rust-lang/rust/commit/1e23ab5dec7f8fc18e64f530276c3a9c0b79628f"}, {"sha": "5bd50ef9be0d234224402ad080e55e4cf3b48546", "url": "https://api.github.com/repos/rust-lang/rust/commits/5bd50ef9be0d234224402ad080e55e4cf3b48546", "html_url": "https://github.com/rust-lang/rust/commit/5bd50ef9be0d234224402ad080e55e4cf3b48546"}], "stats": {"total": 24, "additions": 4, "deletions": 20}, "files": [{"sha": "de3a99f34fcfaf0a47f6d5f8ca6c8656a9e831c5", "filename": "src/ci/docker/host-x86_64/dist-various-2/Dockerfile", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/201893f5aca0e98d66b01ce59e0889c8c4266079/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/201893f5aca0e98d66b01ce59e0889c8c4266079/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2FDockerfile?ref=201893f5aca0e98d66b01ce59e0889c8c4266079", "patch": "@@ -45,10 +45,10 @@ ENV \\\n     CC_armv7_unknown_linux_gnueabi=arm-linux-gnueabi-gcc-8 \\\n     CXX_armv7_unknown_linux_gnueabi=arm-linux-gnueabi-g++-8 \\\n     AR_x86_64_fortanix_unknown_sgx=ar \\\n-    CC_x86_64_fortanix_unknown_sgx=x86_64-fortanix-unknown-sgx-clang-11 \\\n-    CFLAGS_x86_64_fortanix_unknown_sgx=\"-mlvi-hardening -mllvm -x86-experimental-lvi-inline-asm-hardening\" \\\n-    CXX_x86_64_fortanix_unknown_sgx=x86_64-fortanix-unknown-sgx-clang++-11 \\\n-    CXXFLAGS_x86_64_fortanix_unknown_sgx=\"-mlvi-hardening -mllvm -x86-experimental-lvi-inline-asm-hardening\" \\\n+    CC_x86_64_fortanix_unknown_sgx=clang-11 \\\n+    CFLAGS_x86_64_fortanix_unknown_sgx=\"-D__ELF__ -isystem/usr/include/x86_64-linux-gnu -mlvi-hardening -mllvm -x86-experimental-lvi-inline-asm-hardening\" \\\n+    CXX_x86_64_fortanix_unknown_sgx=clang++-11 \\\n+    CXXFLAGS_x86_64_fortanix_unknown_sgx=\"-D__ELF__ -isystem/usr/include/x86_64-linux-gnu -mlvi-hardening -mllvm -x86-experimental-lvi-inline-asm-hardening\" \\\n     AR_i686_unknown_freebsd=i686-unknown-freebsd11-ar \\\n     CC_i686_unknown_freebsd=i686-unknown-freebsd11-clang \\\n     CXX_i686_unknown_freebsd=i686-unknown-freebsd11-clang++ \\\n@@ -71,8 +71,6 @@ COPY host-x86_64/dist-various-2/build-solaris-toolchain.sh /tmp/\n RUN /tmp/build-solaris-toolchain.sh x86_64  amd64   solaris-i386\n RUN /tmp/build-solaris-toolchain.sh sparcv9 sparcv9 solaris-sparc\n COPY host-x86_64/dist-various-2/build-x86_64-fortanix-unknown-sgx-toolchain.sh /tmp/\n-COPY host-x86_64/dist-various-2/x86_64-fortanix-unknown-sgx-clang-wrap.sh /usr/bin/x86_64-fortanix-unknown-sgx-clang-11\n-RUN ln -s /usr/bin/x86_64-fortanix-unknown-sgx-clang-11 /usr/bin/x86_64-fortanix-unknown-sgx-clang++-11\n RUN /tmp/build-x86_64-fortanix-unknown-sgx-toolchain.sh\n \n COPY host-x86_64/dist-various-2/build-wasi-toolchain.sh /tmp/"}, {"sha": "c4ff44c37b1e35aa6e1a2d441d8fcfbaaaa305eb", "filename": "src/ci/docker/host-x86_64/dist-various-2/x86_64-fortanix-unknown-sgx-clang-wrap.sh", "status": "removed", "additions": 0, "deletions": 14, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/1e23ab5dec7f8fc18e64f530276c3a9c0b79628f/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2Fx86_64-fortanix-unknown-sgx-clang-wrap.sh", "raw_url": "https://github.com/rust-lang/rust/raw/1e23ab5dec7f8fc18e64f530276c3a9c0b79628f/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2Fx86_64-fortanix-unknown-sgx-clang-wrap.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-various-2%2Fx86_64-fortanix-unknown-sgx-clang-wrap.sh?ref=1e23ab5dec7f8fc18e64f530276c3a9c0b79628f", "patch": "@@ -1,14 +0,0 @@\n-#!/bin/bash\n-\n-args=(\"$@\")\n-\n-for i in \"${!args[@]}\"; do\n-    # x86_64-fortanix-unknown-sgx doesn't have a C sysroot for things like\n-    # stdint.h and the C++ STL. Unlike GCC, clang will not use the host's\n-    # sysroot instead. Force it.\n-    if [ \"${args[$i]}\" = \"--target=x86_64-fortanix-unknown-sgx\" ]; then\n-        args[$i]=\"--target=x86_64-unknown-linux-gnu\"\n-    fi\n-done\n-\n-exec \"${0/x86_64-fortanix-unknown-sgx-clang/clang}\" \"${args[@]}\""}]}