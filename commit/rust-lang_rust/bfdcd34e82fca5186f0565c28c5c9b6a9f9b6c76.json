{"sha": "bfdcd34e82fca5186f0565c28c5c9b6a9f9b6c76", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJmZGNkMzRlODJmY2E1MTg2ZjA1NjVjMjhjNWM5YjZhOWY5YjZjNzY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-02-08T14:41:02Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-02-08T14:41:02Z"}, "message": "Auto merge of #22054 - LeoTestard:include-parse-errors, r=alexcrichton\n\nMakes the compilation abort when a parse error is encountered while\r\ntrying to parse an item in an included file. The previous behaviour was\r\nto stop processing the file when a token that can't start an item was\r\nencountered, without producing any error. Fixes #21146.", "tree": {"sha": "fac01ba25394767610ca5cb624d091154a773609", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fac01ba25394767610ca5cb624d091154a773609"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bfdcd34e82fca5186f0565c28c5c9b6a9f9b6c76", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bfdcd34e82fca5186f0565c28c5c9b6a9f9b6c76", "html_url": "https://github.com/rust-lang/rust/commit/bfdcd34e82fca5186f0565c28c5c9b6a9f9b6c76", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bfdcd34e82fca5186f0565c28c5c9b6a9f9b6c76/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "725cc06464abda7a657780f12feaefb7f10333c6", "url": "https://api.github.com/repos/rust-lang/rust/commits/725cc06464abda7a657780f12feaefb7f10333c6", "html_url": "https://github.com/rust-lang/rust/commit/725cc06464abda7a657780f12feaefb7f10333c6"}, {"sha": "8f2ab66ab631a11113ac2fbb66384ce7c2fc34d5", "url": "https://api.github.com/repos/rust-lang/rust/commits/8f2ab66ab631a11113ac2fbb66384ce7c2fc34d5", "html_url": "https://github.com/rust-lang/rust/commit/8f2ab66ab631a11113ac2fbb66384ce7c2fc34d5"}], "stats": {"total": 34, "additions": 32, "deletions": 2}, "files": [{"sha": "7a3a3562bdfdcbd9ede0d2597241449c74371470", "filename": "src/libsyntax/ext/source_util.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/bfdcd34e82fca5186f0565c28c5c9b6a9f9b6c76/src%2Flibsyntax%2Fext%2Fsource_util.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bfdcd34e82fca5186f0565c28c5c9b6a9f9b6c76/src%2Flibsyntax%2Fext%2Fsource_util.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fsource_util.rs?ref=bfdcd34e82fca5186f0565c28c5c9b6a9f9b6c76", "patch": "@@ -111,10 +111,14 @@ pub fn expand_include<'cx>(cx: &'cx mut ExtCtxt, sp: Span, tts: &[ast::TokenTree\n         fn make_items(mut self: Box<ExpandResult<'a>>)\n                       -> Option<SmallVector<P<ast::Item>>> {\n             let mut ret = SmallVector::zero();\n-            loop {\n+            while self.p.token != token::Eof {\n                 match self.p.parse_item_with_outer_attributes() {\n                     Some(item) => ret.push(item),\n-                    None => break\n+                    None => self.p.span_fatal(\n+                        self.p.span,\n+                        &format!(\"expected item, found `{}`\",\n+                                 self.p.this_token_to_string())[]\n+                    )\n                 }\n             }\n             Some(ret)"}, {"sha": "1b740d112e9d318220b97a9bfd89393181660506", "filename": "src/test/auxiliary/issue-21146-inc.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/bfdcd34e82fca5186f0565c28c5c9b6a9f9b6c76/src%2Ftest%2Fauxiliary%2Fissue-21146-inc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bfdcd34e82fca5186f0565c28c5c9b6a9f9b6c76/src%2Ftest%2Fauxiliary%2Fissue-21146-inc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fauxiliary%2Fissue-21146-inc.rs?ref=bfdcd34e82fca5186f0565c28c5c9b6a9f9b6c76", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// include file for issue-21146.rs\n+\n+parse_error"}, {"sha": "4c6059c132add96f08b74f7cd5f6831b71e6140d", "filename": "src/test/compile-fail/issue-21146.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/bfdcd34e82fca5186f0565c28c5c9b6a9f9b6c76/src%2Ftest%2Fcompile-fail%2Fissue-21146.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bfdcd34e82fca5186f0565c28c5c9b6a9f9b6c76/src%2Ftest%2Fcompile-fail%2Fissue-21146.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fissue-21146.rs?ref=bfdcd34e82fca5186f0565c28c5c9b6a9f9b6c76", "patch": "@@ -0,0 +1,13 @@\n+// Copyright 2015 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// error-pattern: expected item, found `parse_error`\n+include!(\"../auxiliary/issue-21146-inc.rs\");\n+fn main() {}"}]}