{"sha": "e24045e5873a19690bda6a07a63912adfc375b13", "node_id": "C_kwDOAAsO6NoAKGUyNDA0NWU1ODczYTE5NjkwYmRhNmEwN2E2MzkxMmFkZmMzNzViMTM", "commit": {"author": {"name": "Tobias Kortkamp", "email": "t@tobik.me", "date": "2021-12-03T17:48:53Z"}, "committer": {"name": "Tobias Kortkamp", "email": "t@tobik.me", "date": "2021-12-03T17:49:42Z"}, "message": "Explain why libatomic is not needed on FreeBSD riscv64\n\nFrom Jessica Clarke (jrtc27@)", "tree": {"sha": "c028b0bebec814f894799a0ecd7b39a094e9dc34", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c028b0bebec814f894799a0ecd7b39a094e9dc34"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e24045e5873a19690bda6a07a63912adfc375b13", "comment_count": 0, "verification": {"verified": false, "reason": "no_user", "signature": "-----BEGIN PGP SIGNATURE-----\n\niNUEABYKAH0WIQSuor6Bha+H8NhS5NP0gVxfiT5lXQUCYapZG18UgAAAAAAuAChp\nc3N1ZXItZnByQG5vdGF0aW9ucy5vcGVucGdwLmZpZnRoaG9yc2VtYW4ubmV0QUVB\nMkJFODE4NUFGODdGMEQ4NTJFNEQzRjQ4MTVDNUY4OTNFNjU1RAAKCRD0gVxfiT5l\nXTrQAP4gGfOHLr/FXQiHQO2KPG/bnXa8jmcU/x07KqKS4j9bhAD/enZf4SvUqL5w\n/bAjViJMApq0S9rZNAlo8icV1iuypwU=\n=q7Va\n-----END PGP SIGNATURE-----", "payload": "tree c028b0bebec814f894799a0ecd7b39a094e9dc34\nparent 47474f10558a473258510b0e5dea13d607a5d34c\nauthor Tobias Kortkamp <t@tobik.me> 1638553733 +0100\ncommitter Tobias Kortkamp <t@tobik.me> 1638553782 +0100\n\nExplain why libatomic is not needed on FreeBSD riscv64\n\nFrom Jessica Clarke (jrtc27@)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e24045e5873a19690bda6a07a63912adfc375b13", "html_url": "https://github.com/rust-lang/rust/commit/e24045e5873a19690bda6a07a63912adfc375b13", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e24045e5873a19690bda6a07a63912adfc375b13/comments", "author": null, "committer": null, "parents": [{"sha": "47474f10558a473258510b0e5dea13d607a5d34c", "url": "https://api.github.com/repos/rust-lang/rust/commits/47474f10558a473258510b0e5dea13d607a5d34c", "html_url": "https://github.com/rust-lang/rust/commit/47474f10558a473258510b0e5dea13d607a5d34c"}], "stats": {"total": 14, "additions": 11, "deletions": 3}, "files": [{"sha": "3b6808d693f2176bfa8a8b48194face0ededc109", "filename": "compiler/rustc_llvm/build.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/e24045e5873a19690bda6a07a63912adfc375b13/compiler%2Frustc_llvm%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e24045e5873a19690bda6a07a63912adfc375b13/compiler%2Frustc_llvm%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_llvm%2Fbuild.rs?ref=e24045e5873a19690bda6a07a63912adfc375b13", "patch": "@@ -276,7 +276,10 @@ fn main() {\n         \"stdc++\"\n     };\n \n-    // RISC-V requires libatomic for sub-word atomic operations\n+    // RISC-V GCC erroneously requires libatomic for sub-word\n+    // atomic operations. FreeBSD uses Clang as its system\n+    // compiler and provides no libatomic in its base system so\n+    // does not want this.\n     if !target.contains(\"freebsd\") && target.starts_with(\"riscv\") {\n         println!(\"cargo:rustc-link-lib=atomic\");\n     }"}, {"sha": "4a754e6da12097293417c5f401728bf0c7e07ae2", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/e24045e5873a19690bda6a07a63912adfc375b13/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e24045e5873a19690bda6a07a63912adfc375b13/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=e24045e5873a19690bda6a07a63912adfc375b13", "patch": "@@ -250,8 +250,13 @@ impl Step for Llvm {\n         }\n \n         if !target.contains(\"freebsd\") && target.starts_with(\"riscv\") {\n-            // In RISC-V, using C++ atomics require linking to `libatomic` but the LLVM build\n-            // system check cannot detect this. Therefore it is set manually here.\n+            // RISC-V GCC erroneously requires linking against\n+            // `libatomic` when using 1-byte and 2-byte C++\n+            // atomics but the LLVM build system check cannot\n+            // detect this. Therefore it is set manually here.\n+            // FreeBSD uses Clang as its system compiler and\n+            // provides no libatomic in its base system so does\n+            // not want this.\n             if !builder.config.llvm_tools_enabled {\n                 cfg.define(\"CMAKE_EXE_LINKER_FLAGS\", \"-latomic\");\n             } else {"}]}