{"sha": "3c4a4c6ae9f62c960ba118b6e1941ba006d221d7", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNjNGE0YzZhZTlmNjJjOTYwYmExMThiNmUxOTQxYmEwMDZkMjIxZDc=", "commit": {"author": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-01-20T17:08:25Z"}, "committer": {"name": "Florian Diebold", "email": "flodiebold@gmail.com", "date": "2019-01-20T17:14:19Z"}, "message": "Fix panic on inferring field access on an enum", "tree": {"sha": "c8a345fb3117a17508e7f31a9f286f62903e7044", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c8a345fb3117a17508e7f31a9f286f62903e7044"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3c4a4c6ae9f62c960ba118b6e1941ba006d221d7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3c4a4c6ae9f62c960ba118b6e1941ba006d221d7", "html_url": "https://github.com/rust-lang/rust/commit/3c4a4c6ae9f62c960ba118b6e1941ba006d221d7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3c4a4c6ae9f62c960ba118b6e1941ba006d221d7/comments", "author": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flodiebold", "id": 906069, "node_id": "MDQ6VXNlcjkwNjA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/906069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flodiebold", "html_url": "https://github.com/flodiebold", "followers_url": "https://api.github.com/users/flodiebold/followers", "following_url": "https://api.github.com/users/flodiebold/following{/other_user}", "gists_url": "https://api.github.com/users/flodiebold/gists{/gist_id}", "starred_url": "https://api.github.com/users/flodiebold/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flodiebold/subscriptions", "organizations_url": "https://api.github.com/users/flodiebold/orgs", "repos_url": "https://api.github.com/users/flodiebold/repos", "events_url": "https://api.github.com/users/flodiebold/events{/privacy}", "received_events_url": "https://api.github.com/users/flodiebold/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1c296d54e3dcc36c1a778873f26035000a352ba2", "url": "https://api.github.com/repos/rust-lang/rust/commits/1c296d54e3dcc36c1a778873f26035000a352ba2", "html_url": "https://github.com/rust-lang/rust/commit/1c296d54e3dcc36c1a778873f26035000a352ba2"}], "stats": {"total": 26, "additions": 24, "deletions": 2}, "files": [{"sha": "c602450e1c8b3898794c921de8e55591f97f2d3e", "filename": "crates/ra_hir/src/ty.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/3c4a4c6ae9f62c960ba118b6e1941ba006d221d7/crates%2Fra_hir%2Fsrc%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3c4a4c6ae9f62c960ba118b6e1941ba006d221d7/crates%2Fra_hir%2Fsrc%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty.rs?ref=3c4a4c6ae9f62c960ba118b6e1941ba006d221d7", "patch": "@@ -688,9 +688,13 @@ pub(super) fn type_for_field(db: &impl HirDatabase, def_id: DefId, field: Name)\n         Def::Struct(s) => (s.variant_data(db), s.generic_params(db)),\n         Def::EnumVariant(ev) => (ev.variant_data(db), ev.parent_enum(db).generic_params(db)),\n         // TODO: unions\n+        Def::Enum(_) => {\n+            // this can happen in (invalid) code, but enums don't have fields themselves\n+            return None;\n+        }\n         _ => panic!(\n-            \"trying to get type for field in non-struct/variant {:?}\",\n-            def_id\n+            \"trying to get type for field {:?} in non-struct/variant {:?}\",\n+            field, def_id\n         ),\n     };\n     let module = def_id.module(db);"}, {"sha": "5aa24a29bfee675b45541d6b23de207b2edfb533", "filename": "crates/ra_hir/src/ty/tests.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/3c4a4c6ae9f62c960ba118b6e1941ba006d221d7/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3c4a4c6ae9f62c960ba118b6e1941ba006d221d7/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Ftests.rs?ref=3c4a4c6ae9f62c960ba118b6e1941ba006d221d7", "patch": "@@ -507,6 +507,20 @@ fn test() -> i128 {\n     );\n }\n \n+#[test]\n+fn no_panic_on_field_of_enum() {\n+    check_inference(\n+        r#\"\n+enum X {}\n+\n+fn test(x: X) {\n+    x.some_field;\n+}\n+\"#,\n+        \"no_panic_on_field_of_enum.txt\",\n+    );\n+}\n+\n fn infer(content: &str) -> String {\n     let (db, _, file_id) = MockDatabase::with_single_file(content);\n     let source_file = db.source_file(file_id);"}, {"sha": "4dca0b7f441abb94ac9d474405971b6c75d46861", "filename": "crates/ra_hir/src/ty/tests/data/no_panic_on_field_of_enum.txt", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/3c4a4c6ae9f62c960ba118b6e1941ba006d221d7/crates%2Fra_hir%2Fsrc%2Fty%2Ftests%2Fdata%2Fno_panic_on_field_of_enum.txt", "raw_url": "https://github.com/rust-lang/rust/raw/3c4a4c6ae9f62c960ba118b6e1941ba006d221d7/crates%2Fra_hir%2Fsrc%2Fty%2Ftests%2Fdata%2Fno_panic_on_field_of_enum.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Ftests%2Fdata%2Fno_panic_on_field_of_enum.txt?ref=3c4a4c6ae9f62c960ba118b6e1941ba006d221d7", "patch": "@@ -0,0 +1,4 @@\n+[20; 21) 'x': X\n+[26; 47) '{     ...eld; }': ()\n+[32; 33) 'x': X\n+[32; 44) 'x.some_field': [unknown]"}]}