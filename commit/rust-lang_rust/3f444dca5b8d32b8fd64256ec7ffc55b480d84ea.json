{"sha": "3f444dca5b8d32b8fd64256ec7ffc55b480d84ea", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNmNDQ0ZGNhNWI4ZDMyYjhmZDY0MjU2ZWM3ZmZjNTViNDgwZDg0ZWE=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2013-12-19T00:02:20Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2013-12-26T21:01:22Z"}, "message": "librustc: De-`@mut` `trait_refs`", "tree": {"sha": "3fa806b9c21d562f91923cff4253123dd8b8d39a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3fa806b9c21d562f91923cff4253123dd8b8d39a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3f444dca5b8d32b8fd64256ec7ffc55b480d84ea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3f444dca5b8d32b8fd64256ec7ffc55b480d84ea", "html_url": "https://github.com/rust-lang/rust/commit/3f444dca5b8d32b8fd64256ec7ffc55b480d84ea", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3f444dca5b8d32b8fd64256ec7ffc55b480d84ea/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "efdbd60a87d8a997df39907cf11ecfa5a8ba707e", "url": "https://api.github.com/repos/rust-lang/rust/commits/efdbd60a87d8a997df39907cf11ecfa5a8ba707e", "html_url": "https://github.com/rust-lang/rust/commit/efdbd60a87d8a997df39907cf11ecfa5a8ba707e"}], "stats": {"total": 12, "additions": 7, "deletions": 5}, "files": [{"sha": "c0a66ee81fd31cd4ff2927cd9b8b10af41e50b1d", "filename": "src/librustc/middle/ty.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/3f444dca5b8d32b8fd64256ec7ffc55b480d84ea/src%2Flibrustc%2Fmiddle%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3f444dca5b8d32b8fd64256ec7ffc55b480d84ea/src%2Flibrustc%2Fmiddle%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fty.rs?ref=3f444dca5b8d32b8fd64256ec7ffc55b480d84ea", "patch": "@@ -297,7 +297,7 @@ struct ctxt_ {\n \n     impl_trait_cache: RefCell<HashMap<ast::DefId, Option<@ty::TraitRef>>>,\n \n-    trait_refs: @mut HashMap<NodeId, @TraitRef>,\n+    trait_refs: RefCell<HashMap<NodeId, @TraitRef>>,\n     trait_defs: @mut HashMap<DefId, @TraitDef>,\n \n     /// Despite its name, `items` does not only map NodeId to an item but\n@@ -986,7 +986,7 @@ pub fn mk_ctxt(s: session::Session,\n         region_maps: region_maps,\n         node_types: @mut HashMap::new(),\n         node_type_substs: RefCell::new(HashMap::new()),\n-        trait_refs: @mut HashMap::new(),\n+        trait_refs: RefCell::new(HashMap::new()),\n         trait_defs: @mut HashMap::new(),\n         items: amap,\n         intrinsic_defs: @mut HashMap::new(),\n@@ -2654,7 +2654,8 @@ pub fn index_sty(sty: &sty) -> Option<mt> {\n }\n \n pub fn node_id_to_trait_ref(cx: ctxt, id: ast::NodeId) -> @ty::TraitRef {\n-    match cx.trait_refs.find(&id) {\n+    let trait_refs = cx.trait_refs.borrow();\n+    match trait_refs.get().find(&id) {\n        Some(&t) => t,\n        None => cx.sess.bug(\n            format!(\"node_id_to_trait_ref: no trait ref for node `{}`\","}, {"sha": "2391742ea9a0ee4b46aa52b206848805957f2739", "filename": "src/librustc/middle/typeck/collect.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3f444dca5b8d32b8fd64256ec7ffc55b480d84ea/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcollect.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3f444dca5b8d32b8fd64256ec7ffc55b480d84ea/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcollect.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcollect.rs?ref=3f444dca5b8d32b8fd64256ec7ffc55b480d84ea", "patch": "@@ -710,8 +710,9 @@ pub fn instantiate_trait_ref(ccx: &CrateCtxt,\n             let trait_ref =\n                 astconv::ast_path_to_trait_ref(\n                     ccx, &rscope, trait_did, Some(self_ty), &ast_trait_ref.path);\n-            ccx.tcx.trait_refs.insert(\n-                ast_trait_ref.ref_id, trait_ref);\n+\n+            let mut trait_refs = ccx.tcx.trait_refs.borrow_mut();\n+            trait_refs.get().insert(ast_trait_ref.ref_id, trait_ref);\n             return trait_ref;\n         }\n         _ => {"}]}