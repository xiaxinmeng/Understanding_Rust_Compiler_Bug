{"sha": "0e050fc3eba251f3debf964c7779c522e5639cd8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBlMDUwZmMzZWJhMjUxZjNkZWJmOTY0Yzc3NzljNTIyZTU2MzljZDg=", "commit": {"author": {"name": "Kirill Bulatov", "email": "mail4score@gmail.com", "date": "2020-11-10T21:40:07Z"}, "committer": {"name": "Kirill Bulatov", "email": "mail4score@gmail.com", "date": "2020-11-16T19:19:06Z"}, "message": "Allow to configure the merge behavior", "tree": {"sha": "a56bfe84df95870072bd3ad9e6747c8ed813d64a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a56bfe84df95870072bd3ad9e6747c8ed813d64a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0e050fc3eba251f3debf964c7779c522e5639cd8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0e050fc3eba251f3debf964c7779c522e5639cd8", "html_url": "https://github.com/rust-lang/rust/commit/0e050fc3eba251f3debf964c7779c522e5639cd8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0e050fc3eba251f3debf964c7779c522e5639cd8/comments", "author": {"login": "SomeoneToIgnore", "id": 2690773, "node_id": "MDQ6VXNlcjI2OTA3NzM=", "avatar_url": "https://avatars.githubusercontent.com/u/2690773?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SomeoneToIgnore", "html_url": "https://github.com/SomeoneToIgnore", "followers_url": "https://api.github.com/users/SomeoneToIgnore/followers", "following_url": "https://api.github.com/users/SomeoneToIgnore/following{/other_user}", "gists_url": "https://api.github.com/users/SomeoneToIgnore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SomeoneToIgnore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SomeoneToIgnore/subscriptions", "organizations_url": "https://api.github.com/users/SomeoneToIgnore/orgs", "repos_url": "https://api.github.com/users/SomeoneToIgnore/repos", "events_url": "https://api.github.com/users/SomeoneToIgnore/events{/privacy}", "received_events_url": "https://api.github.com/users/SomeoneToIgnore/received_events", "type": "User", "site_admin": false}, "committer": {"login": "SomeoneToIgnore", "id": 2690773, "node_id": "MDQ6VXNlcjI2OTA3NzM=", "avatar_url": "https://avatars.githubusercontent.com/u/2690773?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SomeoneToIgnore", "html_url": "https://github.com/SomeoneToIgnore", "followers_url": "https://api.github.com/users/SomeoneToIgnore/followers", "following_url": "https://api.github.com/users/SomeoneToIgnore/following{/other_user}", "gists_url": "https://api.github.com/users/SomeoneToIgnore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SomeoneToIgnore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SomeoneToIgnore/subscriptions", "organizations_url": "https://api.github.com/users/SomeoneToIgnore/orgs", "repos_url": "https://api.github.com/users/SomeoneToIgnore/repos", "events_url": "https://api.github.com/users/SomeoneToIgnore/events{/privacy}", "received_events_url": "https://api.github.com/users/SomeoneToIgnore/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1e458efe628215dfc07943f8dd39f66ac059d3de", "url": "https://api.github.com/repos/rust-lang/rust/commits/1e458efe628215dfc07943f8dd39f66ac059d3de", "html_url": "https://github.com/rust-lang/rust/commit/1e458efe628215dfc07943f8dd39f66ac059d3de"}], "stats": {"total": 11, "additions": 6, "deletions": 5}, "files": [{"sha": "58509fc5babf66758e639ce110afde5c5621150d", "filename": "crates/completion/src/completions/complete_magic.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/0e050fc3eba251f3debf964c7779c522e5639cd8/crates%2Fcompletion%2Fsrc%2Fcompletions%2Fcomplete_magic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e050fc3eba251f3debf964c7779c522e5639cd8/crates%2Fcompletion%2Fsrc%2Fcompletions%2Fcomplete_magic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fcompletion%2Fsrc%2Fcompletions%2Fcomplete_magic.rs?ref=0e050fc3eba251f3debf964c7779c522e5639cd8", "patch": "@@ -1,6 +1,6 @@\n //! TODO kb move this into the complete_unqualified_path when starts to work properly\n \n-use assists::utils::{insert_use, mod_path_to_ast, ImportScope, MergeBehaviour};\n+use assists::utils::{insert_use, mod_path_to_ast, ImportScope};\n use either::Either;\n use hir::{db::HirDatabase, MacroDef, ModuleDef, Query};\n use itertools::Itertools;\n@@ -48,10 +48,7 @@ pub(crate) fn complete_magic(acc: &mut Completions, ctx: &CompletionContext) ->\n             );\n             builder.replace(anchor.syntax().text_range(), correct_qualifier);\n \n-            // TODO kb: assists already have the merge behaviour setting, need to unite both\n-            // also consider a settings toggle for this particular feature?\n-            let rewriter =\n-                insert_use(&import_scope, mod_path_to_ast(&mod_path), Some(MergeBehaviour::Full));\n+            let rewriter = insert_use(&import_scope, mod_path_to_ast(&mod_path), ctx.config.merge);\n             let old_ast = rewriter.rewrite_root()?;\n             algo::diff(&old_ast, &rewriter.rewrite(&old_ast)).into_text_edit(&mut builder);\n "}, {"sha": "82874ff256a610cb37a4388bc69ea9a40fea70e7", "filename": "crates/completion/src/config.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0e050fc3eba251f3debf964c7779c522e5639cd8/crates%2Fcompletion%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0e050fc3eba251f3debf964c7779c522e5639cd8/crates%2Fcompletion%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fcompletion%2Fsrc%2Fconfig.rs?ref=0e050fc3eba251f3debf964c7779c522e5639cd8", "patch": "@@ -4,12 +4,15 @@\n //! module, and we use to statically check that we only produce snippet\n //! completions if we are allowed to.\n \n+use assists::utils::MergeBehaviour;\n+\n #[derive(Clone, Debug, PartialEq, Eq)]\n pub struct CompletionConfig {\n     pub enable_postfix_completions: bool,\n     pub add_call_parenthesis: bool,\n     pub add_call_argument_snippets: bool,\n     pub snippet_cap: Option<SnippetCap>,\n+    pub merge: Option<MergeBehaviour>,\n }\n \n impl CompletionConfig {\n@@ -30,6 +33,7 @@ impl Default for CompletionConfig {\n             add_call_parenthesis: true,\n             add_call_argument_snippets: true,\n             snippet_cap: Some(SnippetCap { _private: () }),\n+            merge: Some(MergeBehaviour::Full),\n         }\n     }\n }"}]}