{"sha": "691ce23479b08a292ad106606dab347306fc381f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY5MWNlMjM0NzliMDhhMjkyYWQxMDY2MDZkYWIzNDczMDZmYzM4MWY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-07-21T06:27:15Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-07-21T06:27:15Z"}, "message": "Auto merge of #27150 - retep998:where-are-my-files, r=alexcrichton\n\ncc #24570\r\n\r\nr? @alexcrichton", "tree": {"sha": "aa27fda2cab7a9c04c4aa00fce52fe8e466659b4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aa27fda2cab7a9c04c4aa00fce52fe8e466659b4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/691ce23479b08a292ad106606dab347306fc381f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/691ce23479b08a292ad106606dab347306fc381f", "html_url": "https://github.com/rust-lang/rust/commit/691ce23479b08a292ad106606dab347306fc381f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/691ce23479b08a292ad106606dab347306fc381f/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f9f0e44b339ee5f1336c3a250d3b962db21df7e6", "url": "https://api.github.com/repos/rust-lang/rust/commits/f9f0e44b339ee5f1336c3a250d3b962db21df7e6", "html_url": "https://github.com/rust-lang/rust/commit/f9f0e44b339ee5f1336c3a250d3b962db21df7e6"}, {"sha": "1e79917bda90d3b7ea53fc08b0c0c4862dfdca53", "url": "https://api.github.com/repos/rust-lang/rust/commits/1e79917bda90d3b7ea53fc08b0c0c4862dfdca53", "html_url": "https://github.com/rust-lang/rust/commit/1e79917bda90d3b7ea53fc08b0c0c4862dfdca53"}], "stats": {"total": 24, "additions": 15, "deletions": 9}, "files": [{"sha": "4ce6d53cf125c07d620de2ce333b45120445a9a1", "filename": "src/libstd/sys/windows/fs.rs", "status": "modified", "additions": 15, "deletions": 9, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/691ce23479b08a292ad106606dab347306fc381f/src%2Flibstd%2Fsys%2Fwindows%2Ffs.rs", "raw_url": "https://github.com/rust-lang/rust/raw/691ce23479b08a292ad106606dab347306fc381f/src%2Flibstd%2Fsys%2Fwindows%2Ffs.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fwindows%2Ffs.rs?ref=691ce23479b08a292ad106606dab347306fc381f", "patch": "@@ -369,10 +369,13 @@ impl FromInner<libc::HANDLE> for File {\n \n impl fmt::Debug for File {\n     fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n-        // FIXME(#24570): add more info here (e.g. path, mode)\n-        f.debug_struct(\"File\")\n-            .field(\"handle\", &self.handle.raw())\n-            .finish()\n+        // FIXME(#24570): add more info here (e.g. mode)\n+        let mut b = f.debug_struct(\"File\");\n+        b.field(\"handle\", &self.handle.raw());\n+        if let Ok(path) = get_path(&self) {\n+            b.field(\"path\", &path);\n+        }\n+        b.finish()\n     }\n }\n \n@@ -582,11 +585,7 @@ pub fn utimes(p: &Path, atime: u64, mtime: u64) -> io::Result<()> {\n     Ok(())\n }\n \n-pub fn canonicalize(p: &Path) -> io::Result<PathBuf> {\n-\n-    let mut opts = OpenOptions::new();\n-    opts.read(true);\n-    let f = try!(File::open(p, &opts));\n+fn get_path(f: &File) -> io::Result<PathBuf> {\n     super::fill_utf16_buf(|buf, sz| unsafe {\n         c::GetFinalPathNameByHandleW(f.handle.raw(), buf, sz,\n                                      libc::VOLUME_NAME_DOS)\n@@ -595,6 +594,13 @@ pub fn canonicalize(p: &Path) -> io::Result<PathBuf> {\n     })\n }\n \n+pub fn canonicalize(p: &Path) -> io::Result<PathBuf> {\n+    let mut opts = OpenOptions::new();\n+    opts.read(true);\n+    let f = try!(File::open(p, &opts));\n+    get_path(&f)\n+}\n+\n pub fn copy(from: &Path, to: &Path) -> io::Result<u64> {\n     unsafe extern \"system\" fn callback(\n         _TotalFileSize: libc::LARGE_INTEGER,"}]}