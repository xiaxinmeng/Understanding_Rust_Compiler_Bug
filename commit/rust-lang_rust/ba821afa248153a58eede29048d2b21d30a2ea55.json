{"sha": "ba821afa248153a58eede29048d2b21d30a2ea55", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJhODIxYWZhMjQ4MTUzYTU4ZWVkZTI5MDQ4ZDJiMjFkMzBhMmVhNTU=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-06-09T11:47:11Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-06-09T11:47:11Z"}, "message": "Merge #4815\n\n4815: Correctly parse <_> paths in patterns r=matklad a=matklad\n\ncloses #3659\n\n\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "a0b6651453194d06795ecb76e556baf5c6d082fd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a0b6651453194d06795ecb76e556baf5c6d082fd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ba821afa248153a58eede29048d2b21d30a2ea55", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJe33a/CRBK7hj4Ov3rIwAAdHIIAHRGOSgikz3U0GkgCUPB/Sei\nLV7dU20KNxTTKRfJwKPyclxRIi2KLgULHWRJEqJyHvdG/7mF02/iq7XVMRmj0VQ/\nrshikErNgDX0M6mYh7U0l3B8mPthcEnYJGpwxggV/Bb1W9LwIrX2LfQS1TF5KLzH\n2AWiN1W9+LnK0Vu33Bhh59oiHv2aVykkcUPMzF8Q40cGUXJg3phoTjGxRYHL3pbC\nPPxVQANsd4JufXLTqpBvVx8LcUeTI6WdNA5hYTpRPYDspo2qVshT+xWD6lc9eG9o\n7bcf716rVBHD8rOZBRP7DMiVb1KgPNnQJ8TCCc3iHQOaoIn8cMpIEMeGu0KDevQ=\n=mIuk\n-----END PGP SIGNATURE-----\n", "payload": "tree a0b6651453194d06795ecb76e556baf5c6d082fd\nparent d4d384e4c8355243d0f22c050e28f79d2593c618\nparent e8d50578ab2702ff5f0955285c979c6923f14f80\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1591703231 +0000\ncommitter GitHub <noreply@github.com> 1591703231 +0000\n\nMerge #4815\n\n4815: Correctly parse <_> paths in patterns r=matklad a=matklad\n\ncloses #3659\n\n\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ba821afa248153a58eede29048d2b21d30a2ea55", "html_url": "https://github.com/rust-lang/rust/commit/ba821afa248153a58eede29048d2b21d30a2ea55", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ba821afa248153a58eede29048d2b21d30a2ea55/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d4d384e4c8355243d0f22c050e28f79d2593c618", "url": "https://api.github.com/repos/rust-lang/rust/commits/d4d384e4c8355243d0f22c050e28f79d2593c618", "html_url": "https://github.com/rust-lang/rust/commit/d4d384e4c8355243d0f22c050e28f79d2593c618"}, {"sha": "e8d50578ab2702ff5f0955285c979c6923f14f80", "url": "https://api.github.com/repos/rust-lang/rust/commits/e8d50578ab2702ff5f0955285c979c6923f14f80", "html_url": "https://github.com/rust-lang/rust/commit/e8d50578ab2702ff5f0955285c979c6923f14f80"}], "stats": {"total": 123, "additions": 82, "deletions": 41}, "files": [{"sha": "428aa711e161aa0b7ee0ee6a91489d29ccf9ca42", "filename": "crates/ra_parser/src/grammar/paths.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ba821afa248153a58eede29048d2b21d30a2ea55/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fpaths.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba821afa248153a58eede29048d2b21d30a2ea55/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fpaths.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fpaths.rs?ref=ba821afa248153a58eede29048d2b21d30a2ea55", "patch": "@@ -3,7 +3,7 @@\n use super::*;\n \n pub(super) const PATH_FIRST: TokenSet =\n-    token_set![IDENT, SELF_KW, SUPER_KW, CRATE_KW, COLON, L_ANGLE];\n+    token_set![IDENT, T![self], T![super], T![crate], T![:], T![<]];\n \n pub(super) fn is_path_start(p: &Parser) -> bool {\n     is_use_path_start(p) || p.at(T![<])"}, {"sha": "427c0eb49c2fd04c67b09352ffd5917d2ab17af5", "filename": "crates/ra_parser/src/grammar/patterns.rs", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/ba821afa248153a58eede29048d2b21d30a2ea55/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fpatterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba821afa248153a58eede29048d2b21d30a2ea55/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fpatterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fpatterns.rs?ref=ba821afa248153a58eede29048d2b21d30a2ea55", "patch": "@@ -4,7 +4,7 @@ use super::*;\n \n pub(super) const PATTERN_FIRST: TokenSet = expressions::LITERAL_FIRST\n     .union(paths::PATH_FIRST)\n-    .union(token_set![BOX_KW, REF_KW, MUT_KW, L_PAREN, L_BRACK, AMP, UNDERSCORE, MINUS, DOT]);\n+    .union(token_set![T![box], T![ref], T![mut], T!['('], T!['['], T![&], T![_], T![-], T![.]]);\n \n pub(crate) fn pattern(p: &mut Parser) {\n     pattern_r(p, PAT_RECOVERY_SET);\n@@ -88,7 +88,9 @@ fn atom_pat(p: &mut Parser, recovery_set: TokenSet) -> Option<CompletedMarker> {\n             _ => bind_pat(p, true),\n         },\n \n-        _ if paths::is_use_path_start(p) => path_or_macro_pat(p),\n+        // test type_path_in_pattern\n+        // fn main() { let <_>::Foo = (); }\n+        _ if paths::is_path_start(p) => path_or_macro_pat(p),\n         _ if is_literal_pat_start(p) => literal_pat(p),\n \n         T![.] if p.at(T![..]) => dot_dot_pat(p),\n@@ -138,7 +140,7 @@ fn literal_pat(p: &mut Parser) -> CompletedMarker {\n //     let Bar(..) = ();\n // }\n fn path_or_macro_pat(p: &mut Parser) -> CompletedMarker {\n-    assert!(paths::is_use_path_start(p));\n+    assert!(paths::is_path_start(p));\n     let m = p.start();\n     paths::expr_path(p);\n     let kind = match p.current() {"}, {"sha": "48610a5ebbe2ae29c2cfc439c03a982ad96f944a", "filename": "crates/ra_syntax/test_data/parser/err/0024_many_type_parens.rast", "status": "modified", "additions": 37, "deletions": 37, "changes": 74, "blob_url": "https://github.com/rust-lang/rust/blob/ba821afa248153a58eede29048d2b21d30a2ea55/crates%2Fra_syntax%2Ftest_data%2Fparser%2Ferr%2F0024_many_type_parens.rast", "raw_url": "https://github.com/rust-lang/rust/raw/ba821afa248153a58eede29048d2b21d30a2ea55/crates%2Fra_syntax%2Ftest_data%2Fparser%2Ferr%2F0024_many_type_parens.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Ferr%2F0024_many_type_parens.rast?ref=ba821afa248153a58eede29048d2b21d30a2ea55", "patch": "@@ -180,44 +180,45 @@ SOURCE_FILE@0..240\n       EXPR_STMT@150..180\n         TUPLE_EXPR@150..180\n           L_PAREN@150..151 \"(\"\n-          BIN_EXPR@151..180\n-            BIN_EXPR@151..178\n-              BIN_EXPR@151..169\n-                BIN_EXPR@151..167\n-                  BIN_EXPR@151..164\n-                    FOR_EXPR@151..157\n-                      FOR_KW@151..154 \"for\"\n-                      ERROR@154..155\n-                        L_ANGLE@154..155 \"<\"\n-                      ERROR@155..157\n-                        LIFETIME@155..157 \"\\'a\"\n-                    R_ANGLE@157..158 \">\"\n-                    WHITESPACE@158..159 \" \"\n+          FOR_EXPR@151..180\n+            FOR_KW@151..154 \"for\"\n+            PATH_PAT@154..158\n+              PATH@154..158\n+                PATH_SEGMENT@154..158\n+                  L_ANGLE@154..155 \"<\"\n+                  ERROR@155..157\n+                    LIFETIME@155..157 \"\\'a\"\n+                  R_ANGLE@157..158 \">\"\n+            WHITESPACE@158..159 \" \"\n+            BIN_EXPR@159..180\n+              BIN_EXPR@159..178\n+                BIN_EXPR@159..169\n+                  BIN_EXPR@159..167\n                     PATH_EXPR@159..164\n                       PATH@159..164\n                         PATH_SEGMENT@159..164\n                           NAME_REF@159..164\n                             IDENT@159..164 \"Trait\"\n-                  L_ANGLE@164..165 \"<\"\n-                  ERROR@165..167\n-                    LIFETIME@165..167 \"\\'a\"\n-                R_ANGLE@167..168 \">\"\n-                ERROR@168..169\n-                  R_PAREN@168..169 \")\"\n-              WHITESPACE@169..170 \" \"\n-              PLUS@170..171 \"+\"\n-              WHITESPACE@171..172 \" \"\n-              PAREN_EXPR@172..178\n-                L_PAREN@172..173 \"(\"\n-                PATH_EXPR@173..177\n-                  PATH@173..177\n-                    PATH_SEGMENT@173..177\n-                      NAME_REF@173..177\n-                        IDENT@173..177 \"Copy\"\n-                R_PAREN@177..178 \")\"\n-            R_ANGLE@178..179 \">\"\n-            ERROR@179..180\n-              SEMICOLON@179..180 \";\"\n+                    L_ANGLE@164..165 \"<\"\n+                    ERROR@165..167\n+                      LIFETIME@165..167 \"\\'a\"\n+                  R_ANGLE@167..168 \">\"\n+                  ERROR@168..169\n+                    R_PAREN@168..169 \")\"\n+                WHITESPACE@169..170 \" \"\n+                PLUS@170..171 \"+\"\n+                WHITESPACE@171..172 \" \"\n+                PAREN_EXPR@172..178\n+                  L_PAREN@172..173 \"(\"\n+                  PATH_EXPR@173..177\n+                    PATH@173..177\n+                      PATH_SEGMENT@173..177\n+                        NAME_REF@173..177\n+                          IDENT@173..177 \"Copy\"\n+                  R_PAREN@177..178 \")\"\n+              R_ANGLE@178..179 \">\"\n+              ERROR@179..180\n+                SEMICOLON@179..180 \";\"\n       WHITESPACE@180..185 \"\\n    \"\n       LET_STMT@185..235\n         LET_KW@185..188 \"let\"\n@@ -302,13 +303,12 @@ error 146..146: expected expression\n error 147..147: expected SEMICOLON\n error 148..148: expected expression\n error 149..149: expected SEMICOLON\n-error 154..154: expected pattern\n-error 155..155: expected IN_KW\n-error 155..155: expected expression\n-error 157..157: expected a block\n+error 155..155: expected type\n+error 158..158: expected IN_KW\n error 165..165: expected expression\n error 168..168: expected expression\n error 179..179: expected expression\n+error 180..180: expected a block\n error 180..180: expected COMMA\n error 180..180: expected expression\n error 180..180: expected R_PAREN"}, {"sha": "8688992750d61d79b57dbdacdf0227dc0bc8559d", "filename": "crates/ra_syntax/test_data/parser/inline/ok/0164_type_path_in_pattern.rast", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/ba821afa248153a58eede29048d2b21d30a2ea55/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0164_type_path_in_pattern.rast", "raw_url": "https://github.com/rust-lang/rust/raw/ba821afa248153a58eede29048d2b21d30a2ea55/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0164_type_path_in_pattern.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0164_type_path_in_pattern.rast?ref=ba821afa248153a58eede29048d2b21d30a2ea55", "patch": "@@ -0,0 +1,38 @@\n+SOURCE_FILE@0..33\n+  FN_DEF@0..32\n+    FN_KW@0..2 \"fn\"\n+    WHITESPACE@2..3 \" \"\n+    NAME@3..7\n+      IDENT@3..7 \"main\"\n+    PARAM_LIST@7..9\n+      L_PAREN@7..8 \"(\"\n+      R_PAREN@8..9 \")\"\n+    WHITESPACE@9..10 \" \"\n+    BLOCK_EXPR@10..32\n+      L_CURLY@10..11 \"{\"\n+      WHITESPACE@11..12 \" \"\n+      LET_STMT@12..30\n+        LET_KW@12..15 \"let\"\n+        WHITESPACE@15..16 \" \"\n+        PATH_PAT@16..24\n+          PATH@16..24\n+            PATH@16..19\n+              PATH_SEGMENT@16..19\n+                L_ANGLE@16..17 \"<\"\n+                PLACEHOLDER_TYPE@17..18\n+                  UNDERSCORE@17..18 \"_\"\n+                R_ANGLE@18..19 \">\"\n+            COLON2@19..21 \"::\"\n+            PATH_SEGMENT@21..24\n+              NAME_REF@21..24\n+                IDENT@21..24 \"Foo\"\n+        WHITESPACE@24..25 \" \"\n+        EQ@25..26 \"=\"\n+        WHITESPACE@26..27 \" \"\n+        TUPLE_EXPR@27..29\n+          L_PAREN@27..28 \"(\"\n+          R_PAREN@28..29 \")\"\n+        SEMICOLON@29..30 \";\"\n+      WHITESPACE@30..31 \" \"\n+      R_CURLY@31..32 \"}\"\n+  WHITESPACE@32..33 \"\\n\""}, {"sha": "ebe26834d883feedb5b51c3516cacfe5ff12c1ef", "filename": "crates/ra_syntax/test_data/parser/inline/ok/0164_type_path_in_pattern.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ba821afa248153a58eede29048d2b21d30a2ea55/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0164_type_path_in_pattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ba821afa248153a58eede29048d2b21d30a2ea55/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0164_type_path_in_pattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0164_type_path_in_pattern.rs?ref=ba821afa248153a58eede29048d2b21d30a2ea55", "patch": "@@ -0,0 +1 @@\n+fn main() { let <_>::Foo = (); }"}]}