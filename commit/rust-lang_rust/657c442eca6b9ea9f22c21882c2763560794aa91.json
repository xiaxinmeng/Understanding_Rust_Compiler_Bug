{"sha": "657c442eca6b9ea9f22c21882c2763560794aa91", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY1N2M0NDJlY2E2YjllYTlmMjJjMjE4ODJjMjc2MzU2MDc5NGFhOTE=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2013-03-02T02:09:27Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2013-03-02T02:09:27Z"}, "message": "Merge remote branch 'nmatsakis/parser-perf-problem' into incoming", "tree": {"sha": "3ed640c6eaddb949d677b0ba9b21b8c081edb7df", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3ed640c6eaddb949d677b0ba9b21b8c081edb7df"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/657c442eca6b9ea9f22c21882c2763560794aa91", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/657c442eca6b9ea9f22c21882c2763560794aa91", "html_url": "https://github.com/rust-lang/rust/commit/657c442eca6b9ea9f22c21882c2763560794aa91", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/657c442eca6b9ea9f22c21882c2763560794aa91/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cab8ec242bc34dceb8aded6ec71ddf17e5966d86", "url": "https://api.github.com/repos/rust-lang/rust/commits/cab8ec242bc34dceb8aded6ec71ddf17e5966d86", "html_url": "https://github.com/rust-lang/rust/commit/cab8ec242bc34dceb8aded6ec71ddf17e5966d86"}, {"sha": "ca9549bdfc3dd969e9182d58038f90bbef026ded", "url": "https://api.github.com/repos/rust-lang/rust/commits/ca9549bdfc3dd969e9182d58038f90bbef026ded", "html_url": "https://github.com/rust-lang/rust/commit/ca9549bdfc3dd969e9182d58038f90bbef026ded"}], "stats": {"total": 46, "additions": 28, "deletions": 18}, "files": [{"sha": "038a2c7ae4b4000bb42d67bb3f422acea93ebc3e", "filename": "src/librustc/middle/trans/callee.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/657c442eca6b9ea9f22c21882c2763560794aa91/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcallee.rs", "raw_url": "https://github.com/rust-lang/rust/raw/657c442eca6b9ea9f22c21882c2763560794aa91/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcallee.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftrans%2Fcallee.rs?ref=657c442eca6b9ea9f22c21882c2763560794aa91", "patch": "@@ -731,7 +731,7 @@ pub fn trans_arg_expr(bcx: block,\n \n                     ast::by_copy => {\n                         debug!(\"by copy arg with type %s, storing to scratch\",\n-                               ty_to_str(ccx.tcx, arg_datum.ty));\n+                               bcx.ty_to_str(arg_datum.ty));\n                         let scratch = scratch_datum(bcx, arg_datum.ty, false);\n \n                         arg_datum.store_to_datum(bcx, arg_expr.id,"}, {"sha": "b00fa9d0a19485d1858b3bd1e4ef03ffa28d7e92", "filename": "src/libsyntax/ext/auto_encode.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/657c442eca6b9ea9f22c21882c2763560794aa91/src%2Flibsyntax%2Fext%2Fauto_encode.rs", "raw_url": "https://github.com/rust-lang/rust/raw/657c442eca6b9ea9f22c21882c2763560794aa91/src%2Flibsyntax%2Fext%2Fauto_encode.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fauto_encode.rs?ref=657c442eca6b9ea9f22c21882c2763560794aa91", "patch": "@@ -460,8 +460,8 @@ fn mk_impl(\n     let ty = cx.ty_path(\n         span,\n         ~[ident],\n-        generics.ty_params.map(\n-            |tp| cx.ty_path(span, ~[tp.ident], ~[])).to_vec()\n+        opt_vec::take_vec(generics.ty_params.map(\n+            |tp| cx.ty_path(span, ~[tp.ident], ~[])))\n     );\n \n     let generics = ast::Generics {"}, {"sha": "6e1406e364723ca2c37e53765c2e3113e3237dcc", "filename": "src/libsyntax/ext/pipes/ast_builder.rs", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/657c442eca6b9ea9f22c21882c2763560794aa91/src%2Flibsyntax%2Fext%2Fpipes%2Fast_builder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/657c442eca6b9ea9f22c21882c2763560794aa91/src%2Flibsyntax%2Fext%2Fpipes%2Fast_builder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fpipes%2Fast_builder.rs?ref=657c442eca6b9ea9f22c21882c2763560794aa91", "patch": "@@ -394,13 +394,15 @@ impl ext_ctxt_ast_builder for ext_ctxt {\n     }\n \n     fn ty_vars(&self, ty_params: &OptVec<ast::TyParam>) -> ~[@ast::Ty] {\n-        ty_params.map(|p| self.ty_path_ast_builder(\n-            path(~[p.ident], dummy_sp()))).to_vec()\n+        opt_vec::take_vec(\n+            ty_params.map(|p| self.ty_path_ast_builder(\n+                path(~[p.ident], dummy_sp()))))\n     }\n \n     fn ty_vars_global(&self,\n                       ty_params: &OptVec<ast::TyParam>) -> ~[@ast::Ty] {\n-        ty_params.map(|p| self.ty_path_ast_builder(\n-            path(~[p.ident], dummy_sp()))).to_vec()\n+        opt_vec::take_vec(\n+            ty_params.map(|p| self.ty_path_ast_builder(\n+                path(~[p.ident], dummy_sp()))))\n     }\n }"}, {"sha": "340e2614d2edcd1e3de6308a7785c651057d3836", "filename": "src/libsyntax/opt_vec.rs", "status": "modified", "additions": 13, "deletions": 5, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/657c442eca6b9ea9f22c21882c2763560794aa91/src%2Flibsyntax%2Fopt_vec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/657c442eca6b9ea9f22c21882c2763560794aa91/src%2Flibsyntax%2Fopt_vec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fopt_vec.rs?ref=657c442eca6b9ea9f22c21882c2763560794aa91", "patch": "@@ -31,6 +31,14 @@ pub fn with<T>(+t: T) -> OptVec<T> {\n     Vec(~[t])\n }\n \n+pub fn from<T>(+t: ~[T]) -> OptVec<T> {\n+    if t.len() == 0 {\n+        Empty\n+    } else {\n+        Vec(t)\n+    }\n+}\n+\n impl<T> OptVec<T> {\n     fn push(&mut self, +t: T) {\n         match *self {\n@@ -70,12 +78,12 @@ impl<T> OptVec<T> {\n             Vec(ref v) => v.len()\n         }\n     }\n+}\n \n-    pure fn to_vec(self) -> ~[T] {\n-        match self {\n-            Empty => ~[],\n-            Vec(v) => v\n-        }\n+pub fn take_vec<T>(+v: OptVec<T>) -> ~[T] {\n+    match v {\n+        Empty => ~[],\n+        Vec(v) => v\n     }\n }\n "}, {"sha": "6294243d486fd740009b66ba432a439ccfa0ff75", "filename": "src/libsyntax/parse/parser.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/657c442eca6b9ea9f22c21882c2763560794aa91/src%2Flibsyntax%2Fparse%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/657c442eca6b9ea9f22c21882c2763560794aa91/src%2Flibsyntax%2Fparse%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fparse%2Fparser.rs?ref=657c442eca6b9ea9f22c21882c2763560794aa91", "patch": "@@ -1157,7 +1157,7 @@ pub impl Parser {\n                     let remaining_exprs =\n                         self.parse_seq_to_end(token::RBRACKET,\n                             seq_sep_trailing_allowed(token::COMMA),\n-                            |p| p.parse_expr()).to_vec();\n+                            |p| p.parse_expr());\n                     ex = expr_vec(~[first_expr] + remaining_exprs, mutbl);\n                 } else {\n                     // Vector with one element.\n@@ -1419,7 +1419,7 @@ pub impl Parser {\n                 vec::append(\n                     self.parse_seq_to_before_end(\n                         ket, seq_sep_none(),\n-                        |p| p.parse_token_tree()).to_vec(),\n+                        |p| p.parse_token_tree()),\n                     // the close delimiter:\n                     ~[parse_any_tt_tok(self)])))\n           }\n@@ -2727,7 +2727,7 @@ pub impl Parser {\n         let result = self.parse_seq_to_gt(\n             Some(token::COMMA),\n             |p| p.parse_ty(false));\n-        result.to_vec()\n+        opt_vec::take_vec(result)\n     }\n \n     fn parse_fn_decl(parse_arg_fn: fn(Parser) -> arg_or_capture_item)\n@@ -2819,7 +2819,7 @@ pub impl Parser {\n                     args_or_capture_items =\n                         self.parse_seq_to_before_end(token::RPAREN,\n                                                      sep,\n-                                                     parse_arg_fn).to_vec();\n+                                                     parse_arg_fn);\n                 }\n                 token::RPAREN => {\n                     args_or_capture_items = ~[];\n@@ -2835,7 +2835,7 @@ pub impl Parser {\n             args_or_capture_items =\n                 self.parse_seq_to_before_end(token::RPAREN,\n                                              sep,\n-                                             parse_arg_fn).to_vec();\n+                                             parse_arg_fn);\n         }\n \n         self.expect(token::RPAREN);\n@@ -3032,7 +3032,7 @@ pub impl Parser {\n     fn parse_trait_ref_list(ket: token::Token) -> ~[@trait_ref] {\n         self.parse_seq_to_before_end(\n             ket, seq_sep_none(),\n-            |p| p.parse_trait_ref()).to_vec()\n+            |p| p.parse_trait_ref())\n     }\n \n     fn parse_item_struct() -> item_info {"}]}