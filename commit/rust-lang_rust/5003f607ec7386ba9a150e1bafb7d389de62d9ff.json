{"sha": "5003f607ec7386ba9a150e1bafb7d389de62d9ff", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUwMDNmNjA3ZWM3Mzg2YmE5YTE1MGUxYmFmYjdkMzg5ZGU2MmQ5ZmY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-08-22T15:31:28Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-08-22T15:31:28Z"}, "message": "auto merge of #8642 : sanxiyn/rust/arm-test, r=catamorphism\n\n`stdtest` and `extratest` expects to be able to write to `tmp` directory under the current working directory, so the first commit creates `tmp` directory and changes the directory before running tests.\r\n\r\nThe second commit adds `--bench` argument to test runs and copies metrics from the remote device.", "tree": {"sha": "9c4547669b8507a453c3703c927da8bf9d2b37bf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9c4547669b8507a453c3703c927da8bf9d2b37bf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5003f607ec7386ba9a150e1bafb7d389de62d9ff", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5003f607ec7386ba9a150e1bafb7d389de62d9ff", "html_url": "https://github.com/rust-lang/rust/commit/5003f607ec7386ba9a150e1bafb7d389de62d9ff", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5003f607ec7386ba9a150e1bafb7d389de62d9ff/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4e3dbf959a5124481d1e3ec9b0b30f48ac6dd4f0", "url": "https://api.github.com/repos/rust-lang/rust/commits/4e3dbf959a5124481d1e3ec9b0b30f48ac6dd4f0", "html_url": "https://github.com/rust-lang/rust/commit/4e3dbf959a5124481d1e3ec9b0b30f48ac6dd4f0"}, {"sha": "0276fe471a9336763b2aff537d9982004e570d7f", "url": "https://api.github.com/repos/rust-lang/rust/commits/0276fe471a9336763b2aff537d9982004e570d7f", "html_url": "https://github.com/rust-lang/rust/commit/0276fe471a9336763b2aff537d9982004e570d7f"}], "stats": {"total": 15, "additions": 9, "deletions": 6}, "files": [{"sha": "97e181712138047fea9e9f3a639f31e2272020fc", "filename": "mk/tests.mk", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/5003f607ec7386ba9a150e1bafb7d389de62d9ff/mk%2Ftests.mk", "raw_url": "https://github.com/rust-lang/rust/raw/5003f607ec7386ba9a150e1bafb7d389de62d9ff/mk%2Ftests.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Ftests.mk?ref=5003f607ec7386ba9a150e1bafb7d389de62d9ff", "patch": "@@ -144,8 +144,9 @@ CFG_ADB_TEST_DIR=/data/tmp\n \n $(info check: android device test dir $(CFG_ADB_TEST_DIR) ready \\\n  $(shell adb remount 1>/dev/null) \\\n- $(shell adb shell mkdir $(CFG_ADB_TEST_DIR) 1>/dev/null) \\\n- $(shell adb shell rm -rf $(CFG_ADB_TEST_DIR)/* 1>/dev/null) \\\n+ $(shell adb shell rm -r $(CFG_ADB_TEST_DIR) >/dev/null) \\\n+ $(shell adb shell mkdir $(CFG_ADB_TEST_DIR)) \\\n+ $(shell adb shell mkdir $(CFG_ADB_TEST_DIR)/tmp) \\\n  $(shell adb push $(S)src/etc/adb_run_wrapper.sh $(CFG_ADB_TEST_DIR) 1>/dev/null) \\\n  $(shell adb push $(CFG_ANDROID_CROSS_PATH)/arm-linux-androideabi/lib/armv7-a/libgnustl_shared.so \\\n                   $(CFG_ADB_TEST_DIR) 1>/dev/null) \\\n@@ -409,14 +410,16 @@ $$(call TEST_OK_FILE,$(1),$(2),$(3),$(4)): \\\n \t\t$(3)/stage$(1)/test/$(4)test-$(2)$$(X_$(2))\n \t@$$(call E, run: $$< via adb)\n \t@$(CFG_ADB) push $$< $(CFG_ADB_TEST_DIR)\n-\t@$(CFG_ADB) shell LD_LIBRARY_PATH=$(CFG_ADB_TEST_DIR) \\\n-        $(CFG_ADB_TEST_DIR)/`echo $$< | sed 's/.*\\///'` \\\n-\t\t--logfile $(CFG_ADB_TEST_DIR)/check-stage$(1)-T-$(2)-H-$(3)-$(4).log > \\\n-\t\ttmp/check-stage$(1)-T-$(2)-H-$(3)-$(4).tmp\n+\t@$(CFG_ADB) shell '(cd $(CFG_ADB_TEST_DIR); LD_LIBRARY_PATH=. \\\n+\t\t./$$(notdir $$<) \\\n+\t\t--logfile $(CFG_ADB_TEST_DIR)/check-stage$(1)-T-$(2)-H-$(3)-$(4).log \\\n+\t\t$$(call CRATE_TEST_BENCH_ARGS,$(1),$(2),$(3),$(4)))' \\\n+\t\t> tmp/check-stage$(1)-T-$(2)-H-$(3)-$(4).tmp\n \t@cat tmp/check-stage$(1)-T-$(2)-H-$(3)-$(4).tmp\n \t@touch tmp/check-stage$(1)-T-$(2)-H-$(3)-$(4).log\n \t@$(CFG_ADB) pull $(CFG_ADB_TEST_DIR)/check-stage$(1)-T-$(2)-H-$(3)-$(4).log tmp/\n \t@$(CFG_ADB) shell rm $(CFG_ADB_TEST_DIR)/check-stage$(1)-T-$(2)-H-$(3)-$(4).log\n+\t@$(CFG_ADB) pull $(CFG_ADB_TEST_DIR)/$$(call TEST_RATCHET_FILE,$(1),$(2),$(3),$(4)) tmp/\n \t@if grep -q \"result: ok\" tmp/check-stage$(1)-T-$(2)-H-$(3)-$(4).tmp; \\\n \tthen \\\n \t\trm tmp/check-stage$(1)-T-$(2)-H-$(3)-$(4).tmp; \\"}]}