{"sha": "843739ee988fc9060d3d55c2b6a8f222c2f728cb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg0MzczOWVlOTg4ZmM5MDYwZDNkNTVjMmI2YThmMjIyYzJmNzI4Y2I=", "commit": {"author": {"name": "Rafael \u00c1vila de Esp\u00edndola", "email": "respindola@mozilla.com", "date": "2011-05-18T20:15:30Z"}, "committer": {"name": "Rafael \u00c1vila de Esp\u00edndola", "email": "respindola@mozilla.com", "date": "2011-05-18T20:16:52Z"}, "message": "A quick hack to get the bots green while I refactor this code.", "tree": {"sha": "531c6a370630a4f230b60dcc20fb8765897776cf", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/531c6a370630a4f230b60dcc20fb8765897776cf"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/843739ee988fc9060d3d55c2b6a8f222c2f728cb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/843739ee988fc9060d3d55c2b6a8f222c2f728cb", "html_url": "https://github.com/rust-lang/rust/commit/843739ee988fc9060d3d55c2b6a8f222c2f728cb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/843739ee988fc9060d3d55c2b6a8f222c2f728cb/comments", "author": null, "committer": null, "parents": [{"sha": "13d9f6a2640815aa1fa2a299e0ab364cd292cbfa", "url": "https://api.github.com/repos/rust-lang/rust/commits/13d9f6a2640815aa1fa2a299e0ab364cd292cbfa", "html_url": "https://github.com/rust-lang/rust/commit/13d9f6a2640815aa1fa2a299e0ab364cd292cbfa"}], "stats": {"total": 36, "additions": 34, "deletions": 2}, "files": [{"sha": "07f52e7759dddce4536f2afa3a1a826cfdb06ad7", "filename": "src/rt/new_exit.ll", "status": "modified", "additions": 34, "deletions": 2, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/843739ee988fc9060d3d55c2b6a8f222c2f728cb/src%2Frt%2Fnew_exit.ll", "raw_url": "https://github.com/rust-lang/rust/raw/843739ee988fc9060d3d55c2b6a8f222c2f728cb/src%2Frt%2Fnew_exit.ll", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Fnew_exit.ll?ref=843739ee988fc9060d3d55c2b6a8f222c2f728cb", "patch": "@@ -1,11 +1,43 @@\n-declare fastcc i32 @rust_native_rust_1(i32, i32)\n+declare fastcc i32 @\"\\01rust_native_rust_local_copy\"(i32, i32)\n+\n+module asm \"\\09.globl rust_native_rust_local_copy\"\n+module asm \"\\09.balign 4\"\n+module asm \"rust_native_rust_local_copy:\"\n+module asm \"\\09.cfi_startproc\"\n+module asm \"\\09pushl %ebp\"\n+module asm \"\\09.cfi_def_cfa_offset 8\"\n+module asm \"\\09.cfi_offset %ebp, -8\"\n+module asm \"\\09pushl %edi\"\n+module asm \"\\09.cfi_def_cfa_offset 12\"\n+module asm \"\\09pushl %esi\"\n+module asm \"\\09.cfi_def_cfa_offset 16\"\n+module asm \"\\09pushl %ebx\"\n+module asm \"\\09.cfi_def_cfa_offset 20\"\n+module asm \"\\09movl  %esp, %ebp     # ebp = rust_sp\"\n+module asm \"\\09.cfi_def_cfa_register %ebp\"\n+module asm \"\\09movl  %esp, 16(%edx)\"\n+module asm \"\\09movl  12(%edx), %esp\"\n+module asm \"\\09subl  $4, %esp   # esp -= args\"\n+module asm \"\\09andl  $~0xf, %esp    # align esp down\"\n+module asm \"\\09movl  %edx, (%esp)\"\n+module asm \"\\09movl  %edx, %edi     # save task from edx to edi\"\n+module asm \"\\09call  *%ecx          # call *%ecx\"\n+module asm \"\\09movl  %edi, %edx     # restore edi-saved task to edx\"\n+module asm \"\\09movl  16(%edx), %esp\"\n+module asm \"\\09popl  %ebx\"\n+module asm \"\\09popl  %esi\"\n+module asm \"\\09popl  %edi\"\n+module asm \"\\09popl  %ebp\"\n+module asm \"\\09ret\"\n+module asm \"\\09.cfi_endproc\"\n+\n \n declare i32 @upcall_exit(i32)\n \n define void @rust_new_exit_task_glue(i32, i32, i32, i32, i32) {\n entry:\n   %5 = inttoptr i32 %0 to void (i32, i32, i32, i32)*\n   tail call fastcc void %5(i32 %1, i32 %2, i32 %3, i32 %4)\n-  %6 = tail call fastcc i32 @rust_native_rust_1(i32 ptrtoint (i32 (i32)* @upcall_exit to i32), i32 %2)\n+  %6 = tail call fastcc i32 @\"\\01rust_native_rust_local_copy\"(i32 ptrtoint (i32 (i32)* @upcall_exit to i32), i32 %2)\n   ret void\n }"}]}