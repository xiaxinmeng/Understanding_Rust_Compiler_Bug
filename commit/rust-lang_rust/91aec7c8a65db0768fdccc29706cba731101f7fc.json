{"sha": "91aec7c8a65db0768fdccc29706cba731101f7fc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkxYWVjN2M4YTY1ZGIwNzY4ZmRjY2MyOTcwNmNiYTczMTEwMWY3ZmM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-01-11T18:21:22Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2014-01-11T18:21:22Z"}, "message": "auto merge of #11470 : eminence/rust/rustpkg_help_test, r=alexcrichton\n\nIn general, you can run \"rustpkg help <cmd>\" to see some specific usage information for <cmd>.  However, this was handled in a very ad-hoc and buggy manner.  For example, running \"rustpkg help prefer\" would actually show you the usage information for the \"uninstall\" cmd.  Or \"rustpkg help test\" would show you the usage information for the \"build\" command.  Or \"rustpkg help list\" would just run the \"list\" command (and not show you anything usage information)\r\n\r\nThis commit attempts to fix this by making a new HelpCmd (and handling it explicitly)", "tree": {"sha": "8994b45e73cec6cd7ac674bab82e7c1785c00dc7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8994b45e73cec6cd7ac674bab82e7c1785c00dc7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/91aec7c8a65db0768fdccc29706cba731101f7fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/91aec7c8a65db0768fdccc29706cba731101f7fc", "html_url": "https://github.com/rust-lang/rust/commit/91aec7c8a65db0768fdccc29706cba731101f7fc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/91aec7c8a65db0768fdccc29706cba731101f7fc/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "29e82c65b47130fb431aaca0b33935ecfcd09d85", "url": "https://api.github.com/repos/rust-lang/rust/commits/29e82c65b47130fb431aaca0b33935ecfcd09d85", "html_url": "https://github.com/rust-lang/rust/commit/29e82c65b47130fb431aaca0b33935ecfcd09d85"}, {"sha": "dc21ca98331f181fabefe25f31464ff920f805fd", "url": "https://api.github.com/repos/rust-lang/rust/commits/dc21ca98331f181fabefe25f31464ff920f805fd", "html_url": "https://github.com/rust-lang/rust/commit/dc21ca98331f181fabefe25f31464ff920f805fd"}], "stats": {"total": 24, "additions": 21, "deletions": 3}, "files": [{"sha": "5362ca2c93235db4e9dd5b5fc96fc5ec6012a427", "filename": "src/librustpkg/context.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/91aec7c8a65db0768fdccc29706cba731101f7fc/src%2Flibrustpkg%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91aec7c8a65db0768fdccc29706cba731101f7fc/src%2Flibrustpkg%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Fcontext.rs?ref=91aec7c8a65db0768fdccc29706cba731101f7fc", "patch": "@@ -229,12 +229,13 @@ pub enum Command {\n     BuildCmd,\n     CleanCmd,\n     DoCmd,\n+    HelpCmd,\n     InfoCmd,\n+    InitCmd,\n     InstallCmd,\n     ListCmd,\n     PreferCmd,\n     TestCmd,\n-    InitCmd,\n     UninstallCmd,\n     UnpreferCmd,\n }\n@@ -246,6 +247,7 @@ impl FromStr for Command {\n             &\"build\" => Some(BuildCmd),\n             &\"clean\" => Some(CleanCmd),\n             &\"do\" => Some(DoCmd),\n+            &\"help\" => Some(HelpCmd),\n             &\"info\" => Some(InfoCmd),\n             &\"install\" => Some(InstallCmd),\n             &\"list\"    => Some(ListCmd),"}, {"sha": "3a5c79a62ab6eaf5c3935f684655d0efb8e9a578", "filename": "src/librustpkg/lib.rs", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/91aec7c8a65db0768fdccc29706cba731101f7fc/src%2Flibrustpkg%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91aec7c8a65db0768fdccc29706cba731101f7fc/src%2Flibrustpkg%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Flib.rs?ref=91aec7c8a65db0768fdccc29706cba731101f7fc", "patch": "@@ -43,7 +43,7 @@ use workspace::{each_pkg_parent_workspace, pkg_parent_workspaces, cwd_to_workspa\n use workspace::determine_destination;\n use context::{BuildContext, Trans, Nothing, Pretty, Analysis,\n               LLVMAssemble, LLVMCompileBitcode};\n-use context::{Command, BuildCmd, CleanCmd, DoCmd, InfoCmd, InstallCmd, ListCmd,\n+use context::{Command, BuildCmd, CleanCmd, DoCmd, HelpCmd, InfoCmd, InstallCmd, ListCmd,\n     PreferCmd, TestCmd, InitCmd, UninstallCmd, UnpreferCmd};\n use crate_id::CrateId;\n use package_source::PkgSrc;\n@@ -314,6 +314,18 @@ impl CtxMethods for BuildContext {\n \n                 self.do_cmd(args[0].clone(), args[1].clone());\n             }\n+            HelpCmd => {\n+                if args.len() != 1 {\n+                    return usage::general();\n+                }\n+                match FromStr::from_str(args[0]) {\n+                    Some(help_cmd) => usage::usage_for_command(help_cmd),\n+                    None => {\n+                        usage::general();\n+                        error(format!(\"{} is not a recognized command\", args[0]))\n+                    }\n+                }\n+            }\n             InfoCmd => {\n                 self.info();\n             }\n@@ -372,7 +384,7 @@ impl CtxMethods for BuildContext {\n             }\n             PreferCmd => {\n                 if args.len() < 1 {\n-                    return usage::uninstall();\n+                    return usage::prefer();\n                 }\n \n                 self.prefer(args[0], None);"}, {"sha": "04cc13d0650c951d703de65578c978744cebd698", "filename": "src/librustpkg/usage.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/91aec7c8a65db0768fdccc29706cba731101f7fc/src%2Flibrustpkg%2Fusage.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91aec7c8a65db0768fdccc29706cba731101f7fc/src%2Flibrustpkg%2Fusage.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Fusage.rs?ref=91aec7c8a65db0768fdccc29706cba731101f7fc", "patch": "@@ -16,6 +16,9 @@ pub fn general() {\n Where <cmd> is one of:\n     build, clean, do, info, install, list, prefer, test, uninstall, unprefer\n \n+For more help on a given command, you can run:\n+    rustpkg help <cmd>\n+\n Options:\n \n     -h, --help                  Display this message\n@@ -162,6 +165,7 @@ pub fn usage_for_command(command: Command){\n         BuildCmd => build(),\n         CleanCmd => clean(),\n         DoCmd => do_cmd(),\n+        HelpCmd => general(),\n         InfoCmd => info(),\n         InstallCmd => install(),\n         ListCmd => list(),"}]}