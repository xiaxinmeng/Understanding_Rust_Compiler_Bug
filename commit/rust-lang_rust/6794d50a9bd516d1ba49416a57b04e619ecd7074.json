{"sha": "6794d50a9bd516d1ba49416a57b04e619ecd7074", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY3OTRkNTBhOWJkNTE2ZDFiYTQ5NDE2YTU3YjA0ZTYxOWVjZDcwNzQ=", "commit": {"author": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2020-03-04T15:38:58Z"}, "committer": {"name": "Edwin Cheng", "email": "edwin0cheng@gmail.com", "date": "2020-03-04T15:41:14Z"}, "message": "Fixed whitespace bug", "tree": {"sha": "95c68f245d81eebe37bc9c871039858e1bca4dc5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/95c68f245d81eebe37bc9c871039858e1bca4dc5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6794d50a9bd516d1ba49416a57b04e619ecd7074", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6794d50a9bd516d1ba49416a57b04e619ecd7074", "html_url": "https://github.com/rust-lang/rust/commit/6794d50a9bd516d1ba49416a57b04e619ecd7074", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6794d50a9bd516d1ba49416a57b04e619ecd7074/comments", "author": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "committer": {"login": "edwin0cheng", "id": 11014119, "node_id": "MDQ6VXNlcjExMDE0MTE5", "avatar_url": "https://avatars.githubusercontent.com/u/11014119?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edwin0cheng", "html_url": "https://github.com/edwin0cheng", "followers_url": "https://api.github.com/users/edwin0cheng/followers", "following_url": "https://api.github.com/users/edwin0cheng/following{/other_user}", "gists_url": "https://api.github.com/users/edwin0cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/edwin0cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edwin0cheng/subscriptions", "organizations_url": "https://api.github.com/users/edwin0cheng/orgs", "repos_url": "https://api.github.com/users/edwin0cheng/repos", "events_url": "https://api.github.com/users/edwin0cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/edwin0cheng/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "028595548bea83508c9626835ac84409c83778ed", "url": "https://api.github.com/repos/rust-lang/rust/commits/028595548bea83508c9626835ac84409c83778ed", "html_url": "https://github.com/rust-lang/rust/commit/028595548bea83508c9626835ac84409c83778ed"}], "stats": {"total": 38, "additions": 35, "deletions": 3}, "files": [{"sha": "d8ee74faaaf8060f9835d63ed5edfafe4980df2a", "filename": "crates/ra_mbe/src/syntax_bridge.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/6794d50a9bd516d1ba49416a57b04e619ecd7074/crates%2Fra_mbe%2Fsrc%2Fsyntax_bridge.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6794d50a9bd516d1ba49416a57b04e619ecd7074/crates%2Fra_mbe%2Fsrc%2Fsyntax_bridge.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_mbe%2Fsrc%2Fsyntax_bridge.rs?ref=6794d50a9bd516d1ba49416a57b04e619ecd7074", "patch": "@@ -388,11 +388,12 @@ impl<'a> TreeSink for TtTreeSink<'a> {\n             return;\n         }\n \n+        let mut last = self.cursor;\n         for _ in 0..n_tokens {\n             if self.cursor.eof() {\n                 break;\n             }\n-\n+            last = self.cursor;\n             let text: SmolStr = match self.cursor.token_tree() {\n                 Some(tt::TokenTree::Leaf(leaf)) => {\n                     // Mark the range if needed\n@@ -441,11 +442,11 @@ impl<'a> TreeSink for TtTreeSink<'a> {\n         self.inner.token(kind, text);\n \n         // Add whitespace between adjoint puncts\n-        let next = self.cursor.bump();\n+        let next = last.bump();\n         if let (\n             Some(tt::TokenTree::Leaf(tt::Leaf::Punct(curr))),\n             Some(tt::TokenTree::Leaf(tt::Leaf::Punct(_))),\n-        ) = (self.cursor.token_tree(), next.token_tree())\n+        ) = (last.token_tree(), next.token_tree())\n         {\n             if curr.spacing == tt::Spacing::Alone {\n                 self.inner.token(WHITESPACE, \" \".into());"}, {"sha": "304867881d8ab7caabc76bceceee854982bd3eb6", "filename": "crates/ra_mbe/src/tests.rs", "status": "modified", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/6794d50a9bd516d1ba49416a57b04e619ecd7074/crates%2Fra_mbe%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6794d50a9bd516d1ba49416a57b04e619ecd7074/crates%2Fra_mbe%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_mbe%2Fsrc%2Ftests.rs?ref=6794d50a9bd516d1ba49416a57b04e619ecd7074", "patch": "@@ -838,6 +838,37 @@ fn test_tt_composite() {\n     .assert_expand_items(r#\"foo! { => }\"#, r#\"0\"#);\n }\n \n+#[test]\n+fn test_tt_composite2() {\n+    let node = parse_macro(\n+        r#\"\n+            macro_rules! foo {\n+                ($($tt:tt)*) => { abs!(=> $($tt)*) }\n+            }\n+    \"#,\n+    )\n+    .expand_items(r#\"foo!{#}\"#);\n+\n+    let res = format!(\"{:#?}\", &node);\n+    assert_eq_text!(\n+        res.trim(),\n+        r###\"MACRO_ITEMS@[0; 10)\n+  MACRO_CALL@[0; 10)\n+    PATH@[0; 3)\n+      PATH_SEGMENT@[0; 3)\n+        NAME_REF@[0; 3)\n+          IDENT@[0; 3) \"abs\"\n+    EXCL@[3; 4) \"!\"\n+    TOKEN_TREE@[4; 10)\n+      L_PAREN@[4; 5) \"(\"\n+      EQ@[5; 6) \"=\"\n+      R_ANGLE@[6; 7) \">\"\n+      WHITESPACE@[7; 8) \" \"\n+      POUND@[8; 9) \"#\"\n+      R_PAREN@[9; 10) \")\"\"###\n+    );\n+}\n+\n #[test]\n fn test_lifetime() {\n     parse_macro("}]}