{"sha": "662871f1ccdcd658a084925586ad1572f94dd102", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY2Mjg3MWYxY2NkY2Q2NThhMDg0OTI1NTg2YWQxNTcyZjk0ZGQxMDI=", "commit": {"author": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2020-06-15T19:24:39Z"}, "committer": {"name": "Mark Rousskov", "email": "mark.simulacrum@gmail.com", "date": "2020-08-13T19:18:13Z"}, "message": "Add no-opt standard library builders\n\nWe already have builders which built standard library *test*s without\noptimizations, but we previously did not have builders which built the standard\nlibrary itself without optimizations and then tested that.\n\nThis adds those builds for i686 and x86_64 linux.", "tree": {"sha": "8f7bd8ba90022077f2797eb8bf7edfca34fffb21", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8f7bd8ba90022077f2797eb8bf7edfca34fffb21"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/662871f1ccdcd658a084925586ad1572f94dd102", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/662871f1ccdcd658a084925586ad1572f94dd102", "html_url": "https://github.com/rust-lang/rust/commit/662871f1ccdcd658a084925586ad1572f94dd102", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/662871f1ccdcd658a084925586ad1572f94dd102/comments", "author": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Mark-Simulacrum", "id": 5047365, "node_id": "MDQ6VXNlcjUwNDczNjU=", "avatar_url": "https://avatars.githubusercontent.com/u/5047365?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mark-Simulacrum", "html_url": "https://github.com/Mark-Simulacrum", "followers_url": "https://api.github.com/users/Mark-Simulacrum/followers", "following_url": "https://api.github.com/users/Mark-Simulacrum/following{/other_user}", "gists_url": "https://api.github.com/users/Mark-Simulacrum/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mark-Simulacrum/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mark-Simulacrum/subscriptions", "organizations_url": "https://api.github.com/users/Mark-Simulacrum/orgs", "repos_url": "https://api.github.com/users/Mark-Simulacrum/repos", "events_url": "https://api.github.com/users/Mark-Simulacrum/events{/privacy}", "received_events_url": "https://api.github.com/users/Mark-Simulacrum/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1275cc15d6aa0597f0b3bbf8aa0750239f9da7b2", "url": "https://api.github.com/repos/rust-lang/rust/commits/1275cc15d6aa0597f0b3bbf8aa0750239f9da7b2", "html_url": "https://github.com/rust-lang/rust/commit/1275cc15d6aa0597f0b3bbf8aa0750239f9da7b2"}], "stats": {"total": 14, "additions": 12, "deletions": 2}, "files": [{"sha": "cb507dced4248c22c87c95be88e528b938038432", "filename": "src/ci/docker/host-x86_64/i686-gnu-nopt/Dockerfile", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/662871f1ccdcd658a084925586ad1572f94dd102/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu-nopt%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/662871f1ccdcd658a084925586ad1572f94dd102/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu-nopt%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu-nopt%2FDockerfile?ref=662871f1ccdcd658a084925586ad1572f94dd102", "patch": "@@ -19,8 +19,13 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+RUN mkdir -p /config\n+RUN echo \"[rust]\" > /config/nopt-std-config.toml\n+RUN echo \"optimize = false\" >> /config/nopt-std-config.toml\n+\n ENV RUST_CONFIGURE_ARGS --build=i686-unknown-linux-gnu --disable-optimize-tests\n-ENV SCRIPT python3 ../x.py --stage 2 test\n+ENV SCRIPT python3 ../x.py test --stage 0 --config /config/nopt-std-config.toml library/std \\\n+  && python3 ../x.py --stage 2 test\n \n # FIXME(#59637) takes too long on CI right now\n ENV NO_LLVM_ASSERTIONS=1 NO_DEBUG_ASSERTIONS=1"}, {"sha": "41e83c69e549f4809ecdeffb54351356101cfb1f", "filename": "src/ci/docker/host-x86_64/x86_64-gnu-nopt/Dockerfile", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/662871f1ccdcd658a084925586ad1572f94dd102/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-nopt%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/662871f1ccdcd658a084925586ad1572f94dd102/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-nopt%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-nopt%2FDockerfile?ref=662871f1ccdcd658a084925586ad1572f94dd102", "patch": "@@ -18,7 +18,12 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n+RUN mkdir -p /config\n+RUN echo \"[rust]\" > /config/nopt-std-config.toml\n+RUN echo \"optimize = false\" >> /config/nopt-std-config.toml\n+\n ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu \\\n   --disable-optimize-tests \\\n   --set rust.test-compare-mode\n-ENV SCRIPT python3 ../x.py --stage 2 test\n+ENV SCRIPT python3 ../x.py test --stage 0 --config /config/nopt-std-config.toml library/std \\\n+  && python3 ../x.py --stage 2 test"}]}