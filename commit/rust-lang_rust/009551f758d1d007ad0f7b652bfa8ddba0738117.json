{"sha": "009551f758d1d007ad0f7b652bfa8ddba0738117", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAwOTU1MWY3NThkMWQwMDdhZDBmN2I2NTJiZmE4ZGRiYTA3MzgxMTc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-08-16T16:58:13Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-08-16T16:58:13Z"}, "message": "Auto merge of #75472 - Mark-Simulacrum:mangling-config, r=eddyb\n\nAdd option to use the new symbol mangling in rustc/std\n\nI don't know if this causes problems in some cases -- maybe it should be on by default for at least rustc. I've never encountered problems with it other than tools not supporting it, though.\n\ncc @nnethercote\nr? @eddyb", "tree": {"sha": "aa5f84888857172542e9fd4df1e4854e48c960ac", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/aa5f84888857172542e9fd4df1e4854e48c960ac"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/009551f758d1d007ad0f7b652bfa8ddba0738117", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/009551f758d1d007ad0f7b652bfa8ddba0738117", "html_url": "https://github.com/rust-lang/rust/commit/009551f758d1d007ad0f7b652bfa8ddba0738117", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/009551f758d1d007ad0f7b652bfa8ddba0738117/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7a4fb355c6ce4e534e0998d83b68591bbe234ddb", "url": "https://api.github.com/repos/rust-lang/rust/commits/7a4fb355c6ce4e534e0998d83b68591bbe234ddb", "html_url": "https://github.com/rust-lang/rust/commit/7a4fb355c6ce4e534e0998d83b68591bbe234ddb"}, {"sha": "e09cca09acf7f146e7df754e74a5fc934af10de4", "url": "https://api.github.com/repos/rust-lang/rust/commits/e09cca09acf7f146e7df754e74a5fc934af10de4", "html_url": "https://github.com/rust-lang/rust/commit/e09cca09acf7f146e7df754e74a5fc934af10de4"}], "stats": {"total": 11, "additions": 11, "deletions": 0}, "files": [{"sha": "36587cc07844147be96b41801e9f6961fc7d5398", "filename": "config.toml.example", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/009551f758d1d007ad0f7b652bfa8ddba0738117/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/009551f758d1d007ad0f7b652bfa8ddba0738117/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=009551f758d1d007ad0f7b652bfa8ddba0738117", "patch": "@@ -475,6 +475,10 @@\n # This only applies from stage 1 onwards, and only for Windows targets.\n #control-flow-guard = false\n \n+# Enable symbol-mangling-version v0. This can be helpful when profiling rustc,\n+# as generics will be preserved in symbols (rather than erased into opaque T).\n+#new-symbol-mangling = false\n+\n # =============================================================================\n # Options for specific targets\n #"}, {"sha": "6446fa7550d537da81622f2cd37058b0dd992679", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/009551f758d1d007ad0f7b652bfa8ddba0738117/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/009551f758d1d007ad0f7b652bfa8ddba0738117/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=009551f758d1d007ad0f7b652bfa8ddba0738117", "patch": "@@ -859,6 +859,10 @@ impl<'a> Builder<'a> {\n             rustflags.arg(\"--cfg=bootstrap\");\n         }\n \n+        if self.config.rust_new_symbol_mangling {\n+            rustflags.arg(\"-Zsymbol-mangling-version=v0\");\n+        }\n+\n         // FIXME: It might be better to use the same value for both `RUSTFLAGS` and `RUSTDOCFLAGS`,\n         // but this breaks CI. At the very least, stage0 `rustdoc` needs `--cfg bootstrap`. See\n         // #71458."}, {"sha": "70b1c471ac3f0e6f11efc24d4d0b17a17a081354", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/009551f758d1d007ad0f7b652bfa8ddba0738117/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/009551f758d1d007ad0f7b652bfa8ddba0738117/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=009551f758d1d007ad0f7b652bfa8ddba0738117", "patch": "@@ -112,6 +112,7 @@ pub struct Config {\n     pub rust_verify_llvm_ir: bool,\n     pub rust_thin_lto_import_instr_limit: Option<u32>,\n     pub rust_remap_debuginfo: bool,\n+    pub rust_new_symbol_mangling: bool,\n \n     pub build: TargetSelection,\n     pub hosts: Vec<TargetSelection>,\n@@ -410,6 +411,7 @@ struct Rust {\n     test_compare_mode: Option<bool>,\n     llvm_libunwind: Option<bool>,\n     control_flow_guard: Option<bool>,\n+    new_symbol_mangling: Option<bool>,\n }\n \n /// TOML representation of how each build target is configured.\n@@ -637,6 +639,7 @@ impl Config {\n             debuginfo_level_tests = rust.debuginfo_level_tests;\n             optimize = rust.optimize;\n             ignore_git = rust.ignore_git;\n+            set(&mut config.rust_new_symbol_mangling, rust.new_symbol_mangling);\n             set(&mut config.rust_optimize_tests, rust.optimize_tests);\n             set(&mut config.codegen_tests, rust.codegen_tests);\n             set(&mut config.rust_rpath, rust.rpath);"}]}