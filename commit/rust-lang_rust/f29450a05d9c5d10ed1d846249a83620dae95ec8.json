{"sha": "f29450a05d9c5d10ed1d846249a83620dae95ec8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYyOTQ1MGEwNWQ5YzVkMTBlZDFkODQ2MjQ5YTgzNjIwZGFlOTVlYzg=", "commit": {"author": {"name": "Nikita Popov", "email": "nikita.ppv@gmail.com", "date": "2021-07-10T08:44:31Z"}, "committer": {"name": "Nikita Popov", "email": "nikita.ppv@gmail.com", "date": "2021-07-10T10:40:40Z"}, "message": "Use clang 12.0.1 on dist-x86_64/i686-linux\n\nThe LLD + ThinLTO __morestack bug has been fixed in 12.0.1, so\nwe can now update our clang version. This also means that we no\nlonger need to build Python 2.", "tree": {"sha": "f93b5017c6832619626418e40418bc07c0ee9c78", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f93b5017c6832619626418e40418bc07c0ee9c78"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f29450a05d9c5d10ed1d846249a83620dae95ec8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f29450a05d9c5d10ed1d846249a83620dae95ec8", "html_url": "https://github.com/rust-lang/rust/commit/f29450a05d9c5d10ed1d846249a83620dae95ec8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f29450a05d9c5d10ed1d846249a83620dae95ec8/comments", "author": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikic", "id": 216080, "node_id": "MDQ6VXNlcjIxNjA4MA==", "avatar_url": "https://avatars.githubusercontent.com/u/216080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikic", "html_url": "https://github.com/nikic", "followers_url": "https://api.github.com/users/nikic/followers", "following_url": "https://api.github.com/users/nikic/following{/other_user}", "gists_url": "https://api.github.com/users/nikic/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikic/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikic/subscriptions", "organizations_url": "https://api.github.com/users/nikic/orgs", "repos_url": "https://api.github.com/users/nikic/repos", "events_url": "https://api.github.com/users/nikic/events{/privacy}", "received_events_url": "https://api.github.com/users/nikic/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8eae2eb1d31da4b0bbdb80dcf2625535c3f147ae", "url": "https://api.github.com/repos/rust-lang/rust/commits/8eae2eb1d31da4b0bbdb80dcf2625535c3f147ae", "html_url": "https://github.com/rust-lang/rust/commit/8eae2eb1d31da4b0bbdb80dcf2625535c3f147ae"}], "stats": {"total": 12, "additions": 4, "deletions": 8}, "files": [{"sha": "42fda98bc7a4b1a9e02e9c665d155bb60bd6f4cb", "filename": "src/ci/docker/host-x86_64/dist-i686-linux/Dockerfile", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f29450a05d9c5d10ed1d846249a83620dae95ec8/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-i686-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/f29450a05d9c5d10ed1d846249a83620dae95ec8/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-i686-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-i686-linux%2FDockerfile?ref=f29450a05d9c5d10ed1d846249a83620dae95ec8", "patch": "@@ -69,8 +69,6 @@ COPY host-x86_64/dist-x86_64-linux/build-gcc.sh /tmp/\n RUN ./build-gcc.sh && apt-get remove -y gcc g++\n \n COPY host-x86_64/dist-x86_64-linux/build-python.sh /tmp/\n-# Build Python 2.7 needed for Clang 10.\n-RUN ./build-python.sh 2.7.12\n # Build Python 3 needed for LLVM 12.\n RUN ./build-python.sh 3.9.1\n \n@@ -97,7 +95,7 @@ ENV RUST_CONFIGURE_ARGS \\\n       --build=i686-unknown-linux-gnu \\\n       --set llvm.ninja=false \\\n       --set rust.jemalloc\n-ENV SCRIPT python2.7 ../x.py dist --build $HOSTS --host $HOSTS --target $HOSTS\n+ENV SCRIPT python3 ../x.py dist --build $HOSTS --host $HOSTS --target $HOSTS\n ENV CARGO_TARGET_I686_UNKNOWN_LINUX_GNU_LINKER=clang\n \n # This was added when we switched from gcc to clang. It's not clear why this is"}, {"sha": "8242e091cd4c7890999140b6762762cb81f40cff", "filename": "src/ci/docker/host-x86_64/dist-x86_64-linux/Dockerfile", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f29450a05d9c5d10ed1d846249a83620dae95ec8/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/f29450a05d9c5d10ed1d846249a83620dae95ec8/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2FDockerfile?ref=f29450a05d9c5d10ed1d846249a83620dae95ec8", "patch": "@@ -69,8 +69,6 @@ COPY host-x86_64/dist-x86_64-linux/build-gcc.sh /tmp/\n RUN ./build-gcc.sh && apt-get remove -y gcc g++\n \n COPY host-x86_64/dist-x86_64-linux/build-python.sh /tmp/\n-# Build Python 2.7 needed for Clang 10.\n-RUN ./build-python.sh 2.7.12\n # Build Python 3 needed for LLVM 12.\n RUN ./build-python.sh 3.9.1\n \n@@ -102,7 +100,7 @@ ENV RUST_CONFIGURE_ARGS \\\n       --set llvm.thin-lto=true \\\n       --set llvm.ninja=false \\\n       --set rust.jemalloc\n-ENV SCRIPT ../src/ci/pgo.sh python2.7 ../x.py dist \\\n+ENV SCRIPT ../src/ci/pgo.sh python3 ../x.py dist \\\n     --host $HOSTS --target $HOSTS \\\n     --include-default-paths \\\n     src/tools/build-manifest"}, {"sha": "b511d0263ab153119e79805a0d37a00fd6187e3d", "filename": "src/ci/docker/host-x86_64/dist-x86_64-linux/build-clang.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f29450a05d9c5d10ed1d846249a83620dae95ec8/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-clang.sh", "raw_url": "https://github.com/rust-lang/rust/raw/f29450a05d9c5d10ed1d846249a83620dae95ec8/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-clang.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fdist-x86_64-linux%2Fbuild-clang.sh?ref=f29450a05d9c5d10ed1d846249a83620dae95ec8", "patch": "@@ -4,7 +4,7 @@ set -ex\n \n source shared.sh\n \n-LLVM=llvmorg-10.0.0\n+LLVM=llvmorg-12.0.1\n \n mkdir llvm-project\n cd llvm-project"}, {"sha": "aa009a4eac6af877e4e4dc005a2fd9abd19d2f2b", "filename": "src/ci/pgo.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f29450a05d9c5d10ed1d846249a83620dae95ec8/src%2Fci%2Fpgo.sh", "raw_url": "https://github.com/rust-lang/rust/raw/f29450a05d9c5d10ed1d846249a83620dae95ec8/src%2Fci%2Fpgo.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fpgo.sh?ref=f29450a05d9c5d10ed1d846249a83620dae95ec8", "patch": "@@ -4,7 +4,7 @@ set -euxo pipefail\n \n rm -rf /tmp/rustc-pgo\n \n-python2.7 ../x.py build --target=$PGO_HOST --host=$PGO_HOST \\\n+python3 ../x.py build --target=$PGO_HOST --host=$PGO_HOST \\\n     --stage 2 library/std --rust-profile-generate=/tmp/rustc-pgo\n \n RUSTC_BOOTSTRAP=1 ./build/$PGO_HOST/stage2/bin/rustc --edition=2018 \\"}]}