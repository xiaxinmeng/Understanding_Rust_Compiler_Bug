{"sha": "c31f75209f0718e74b9ca48dab46c069c09744b1", "node_id": "C_kwDOAAsO6NoAKGMzMWY3NTIwOWYwNzE4ZTc0YjljYTQ4ZGFiNDZjMDY5YzA5NzQ0YjE", "commit": {"author": {"name": "nils", "email": "48135649+Nilstrieb@users.noreply.github.com", "date": "2023-03-28T10:51:12Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-03-28T10:51:12Z"}, "message": "Rollup merge of #108480 - Zoxc:rayon-tlv, r=cuviper\n\nUse Rayon's TLV directly\n\nThis accesses Rayon's `TLV` thread local directly avoiding wrapper functions. This makes rustc work with https://github.com/rust-lang/rustc-rayon/pull/10.\n\nr? `@cuviper`", "tree": {"sha": "7c106a1b6e1d8e2042f803be806c3ec650f432e9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7c106a1b6e1d8e2042f803be806c3ec650f432e9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c31f75209f0718e74b9ca48dab46c069c09744b1", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkIsagCRBK7hj4Ov3rIwAASMIIACbtyx3rozusXmeUhCxWKqc8\nNZDFLNtgH683poLSln9x8HqibO3Ert+zp5f6pbFCkZesuI0KdZRAD4XN8DQSE+NV\nm5SY3q199RXJ4zqtkIJHPzfa+MKWgwIwzk55u0eY1Bafe8rQ+t8fdjsjcvXp7NDm\naBx2/50ViavVJ34q9fjiDIo6KL7kpPFscnZhhagzJ9SpZXGjUr9bicB+VLwaFd2A\nbt8hynROE7IXphldtPxsmkgiovC+wGRhY9J29waVk5LkHEwOEbd2I36q6a/QuePO\n4AqX4ADNBJE/tG9HrwuPOczsOtMfOzbde1qa5PARQkXSYdW7Do30fQoCbtedYGA=\n=ct1k\n-----END PGP SIGNATURE-----\n", "payload": "tree 7c106a1b6e1d8e2042f803be806c3ec650f432e9\nparent 4bd33fdb4a40e82cf8572ca68a13e1e2fbef60f3\nparent 27c44d2e28d9e1e38526dd52ac2f07336aabe254\nauthor nils <48135649+Nilstrieb@users.noreply.github.com> 1680000672 +0200\ncommitter GitHub <noreply@github.com> 1680000672 +0200\n\nRollup merge of #108480 - Zoxc:rayon-tlv, r=cuviper\n\nUse Rayon's TLV directly\n\nThis accesses Rayon's `TLV` thread local directly avoiding wrapper functions. This makes rustc work with https://github.com/rust-lang/rustc-rayon/pull/10.\n\nr? `@cuviper`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c31f75209f0718e74b9ca48dab46c069c09744b1", "html_url": "https://github.com/rust-lang/rust/commit/c31f75209f0718e74b9ca48dab46c069c09744b1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c31f75209f0718e74b9ca48dab46c069c09744b1/comments", "author": {"login": "Nilstrieb", "id": 48135649, "node_id": "MDQ6VXNlcjQ4MTM1NjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/48135649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nilstrieb", "html_url": "https://github.com/Nilstrieb", "followers_url": "https://api.github.com/users/Nilstrieb/followers", "following_url": "https://api.github.com/users/Nilstrieb/following{/other_user}", "gists_url": "https://api.github.com/users/Nilstrieb/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nilstrieb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nilstrieb/subscriptions", "organizations_url": "https://api.github.com/users/Nilstrieb/orgs", "repos_url": "https://api.github.com/users/Nilstrieb/repos", "events_url": "https://api.github.com/users/Nilstrieb/events{/privacy}", "received_events_url": "https://api.github.com/users/Nilstrieb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4bd33fdb4a40e82cf8572ca68a13e1e2fbef60f3", "url": "https://api.github.com/repos/rust-lang/rust/commits/4bd33fdb4a40e82cf8572ca68a13e1e2fbef60f3", "html_url": "https://github.com/rust-lang/rust/commit/4bd33fdb4a40e82cf8572ca68a13e1e2fbef60f3"}, {"sha": "27c44d2e28d9e1e38526dd52ac2f07336aabe254", "url": "https://api.github.com/repos/rust-lang/rust/commits/27c44d2e28d9e1e38526dd52ac2f07336aabe254", "html_url": "https://github.com/rust-lang/rust/commit/27c44d2e28d9e1e38526dd52ac2f07336aabe254"}], "stats": {"total": 109, "additions": 38, "deletions": 71}, "files": [{"sha": "2c99399e6b08e50145c74b2ed10b8906321be273", "filename": "Cargo.lock", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/c31f75209f0718e74b9ca48dab46c069c09744b1/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/c31f75209f0718e74b9ca48dab46c069c09744b1/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=c31f75209f0718e74b9ca48dab46c069c09744b1", "patch": "@@ -2689,9 +2689,9 @@ checksum = \"ce23b50ad8242c51a442f3ff322d56b02f08852c77e4c0b4d3fd684abc89c683\"\n \n [[package]]\n name = \"indexmap\"\n-version = \"1.9.2\"\n+version = \"1.9.3\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"1885e79c1fc4b10f0e172c475f458b7f7b93061064d98c3293e98c5ba0c8b399\"\n+checksum = \"bd070e393353796e801d209ad339e89596eb4c8d430d18ede6a1cced8fafbd99\"\n dependencies = [\n  \"autocfg\",\n  \"hashbrown 0.12.3\",\n@@ -4160,21 +4160,19 @@ dependencies = [\n \n [[package]]\n name = \"rustc-rayon\"\n-version = \"0.4.0\"\n+version = \"0.5.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"1a79f0b0b2609e2eacf9758013f50e7176cb4b29fd6436a747b14a5362c8727a\"\n+checksum = \"eb81aadc8837ca6ecebe0fe1353f15df83b3b3cc2cf7a8afd571bc22aa121710\"\n dependencies = [\n- \"autocfg\",\n- \"crossbeam-deque\",\n  \"either\",\n  \"rustc-rayon-core\",\n ]\n \n [[package]]\n name = \"rustc-rayon-core\"\n-version = \"0.4.1\"\n+version = \"0.5.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"02269144a0db9bb55cf5d4a41a5a0e95b334b0b78b08269018ca9b0250718c30\"\n+checksum = \"67668daaf00e359c126f6dcb40d652d89b458a008c8afa727a42a2d20fca0b7f\"\n dependencies = [\n  \"crossbeam-channel\",\n  \"crossbeam-deque\","}, {"sha": "87e4ac2660579dd20595bd721021326b7a601101", "filename": "compiler/rustc_codegen_cranelift/Cargo.lock", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_codegen_cranelift%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_codegen_cranelift%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_cranelift%2FCargo.lock?ref=c31f75209f0718e74b9ca48dab46c069c09744b1", "patch": "@@ -235,9 +235,9 @@ dependencies = [\n \n [[package]]\n name = \"indexmap\"\n-version = \"1.9.2\"\n+version = \"1.9.3\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"1885e79c1fc4b10f0e172c475f458b7f7b93061064d98c3293e98c5ba0c8b399\"\n+checksum = \"bd070e393353796e801d209ad339e89596eb4c8d430d18ede6a1cced8fafbd99\"\n dependencies = [\n  \"autocfg\",\n  \"hashbrown\","}, {"sha": "5dadcaaec42ce718a278a967cf4290b320d278fb", "filename": "compiler/rustc_codegen_cranelift/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_codegen_cranelift%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_codegen_cranelift%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_cranelift%2FCargo.toml?ref=c31f75209f0718e74b9ca48dab46c069c09744b1", "patch": "@@ -25,7 +25,7 @@ target-lexicon = \"0.12.0\"\n gimli = { version = \"0.26.0\", default-features = false, features = [\"write\"]}\n object = { version = \"0.29.0\", default-features = false, features = [\"std\", \"read_core\", \"write\", \"archive\", \"coff\", \"elf\", \"macho\", \"pe\"] }\n \n-indexmap = \"1.9.1\"\n+indexmap = \"1.9.3\"\n libloading = { version = \"0.7.3\", optional = true }\n once_cell = \"1.10.0\"\n smallvec = \"1.8.1\""}, {"sha": "0b2b03da2080a72173290a19ea5e4cbb5d96e117", "filename": "compiler/rustc_data_structures/Cargo.toml", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_data_structures%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_data_structures%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_data_structures%2FCargo.toml?ref=c31f75209f0718e74b9ca48dab46c069c09744b1", "patch": "@@ -10,12 +10,12 @@ arrayvec = { version = \"0.7\", default-features = false }\n bitflags = \"1.2.1\"\n cfg-if = \"1.0\"\n ena = \"0.14.2\"\n-indexmap = { version = \"1.9.1\" }\n+indexmap = { version = \"1.9.3\" }\n jobserver_crate = { version = \"0.1.13\", package = \"jobserver\" }\n libc = \"0.2\"\n measureme = \"10.0.0\"\n-rayon-core = { version = \"0.4.0\", package = \"rustc-rayon-core\", optional = true }\n-rayon = { version = \"0.4.0\", package = \"rustc-rayon\", optional = true }\n+rustc-rayon-core = { version = \"0.5.0\", optional = true }\n+rustc-rayon = { version = \"0.5.0\", optional = true }\n rustc_graphviz = { path = \"../rustc_graphviz\" }\n rustc-hash = \"1.1.0\"\n rustc_index = { path = \"../rustc_index\", package = \"rustc_index\" }\n@@ -51,4 +51,4 @@ features = [\n memmap2 = \"0.2.1\"\n \n [features]\n-rustc_use_parallel_compiler = [\"indexmap/rustc-rayon\", \"rayon\", \"rayon-core\"]\n+rustc_use_parallel_compiler = [\"indexmap/rustc-rayon\", \"rustc-rayon\", \"rustc-rayon-core\"]"}, {"sha": "98d3ab87f9cbd4a60fc4d35ff8ccf7e61da31e0a", "filename": "compiler/rustc_interface/Cargo.toml", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_interface%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_interface%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2FCargo.toml?ref=c31f75209f0718e74b9ca48dab46c069c09744b1", "patch": "@@ -8,8 +8,8 @@ edition = \"2021\"\n [dependencies]\n libloading = \"0.7.1\"\n tracing = \"0.1\"\n-rustc-rayon-core = { version = \"0.4.0\", optional = true }\n-rayon = { version = \"0.4.0\", package = \"rustc-rayon\", optional = true }\n+rustc-rayon-core = { version = \"0.5.0\", optional = true }\n+rustc-rayon = { version = \"0.5.0\", optional = true }\n smallvec = { version = \"1.8.1\", features = [\"union\", \"may_dangle\"] }\n rustc_ast = { path = \"../rustc_ast\" }\n rustc_attr = { path = \"../rustc_attr\" }\n@@ -52,4 +52,4 @@ rustc_ty_utils = { path = \"../rustc_ty_utils\" }\n \n [features]\n llvm = ['rustc_codegen_llvm']\n-rustc_use_parallel_compiler = ['rayon', 'rustc-rayon-core', 'rustc_query_impl/rustc_use_parallel_compiler', 'rustc_errors/rustc_use_parallel_compiler']\n+rustc_use_parallel_compiler = ['rustc-rayon', 'rustc-rayon-core', 'rustc_query_impl/rustc_use_parallel_compiler', 'rustc_errors/rustc_use_parallel_compiler']"}, {"sha": "612903810d21191102ff746cdc5c53c319121595", "filename": "compiler/rustc_interface/src/util.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_interface%2Fsrc%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_interface%2Fsrc%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2Fsrc%2Futil.rs?ref=c31f75209f0718e74b9ca48dab46c069c09744b1", "patch": "@@ -183,7 +183,7 @@ pub(crate) fn run_in_thread_pool_with_globals<F: FnOnce() -> R + Send, R: Send>(\n                     .try_collect_active_jobs()\n                     .expect(\"active jobs shouldn't be locked in deadlock handler\")\n             });\n-            let registry = rustc_rayon_core::Registry::current();\n+            let registry = rayon_core::Registry::current();\n             thread::spawn(move || deadlock(query_map, &registry));\n         });\n     if let Some(size) = get_stack_size() {"}, {"sha": "5b2ec9029b16e1d87a1d261b0a5fd1000f547759", "filename": "compiler/rustc_middle/Cargo.toml", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_middle%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_middle%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2FCargo.toml?ref=c31f75209f0718e74b9ca48dab46c069c09744b1", "patch": "@@ -26,8 +26,8 @@ rustc_hir = { path = \"../rustc_hir\" }\n rustc_index = { path = \"../rustc_index\" }\n rustc_macros = { path = \"../rustc_macros\" }\n rustc_query_system = { path = \"../rustc_query_system\" }\n-rustc-rayon-core = { version = \"0.4.0\", optional = true }\n-rustc-rayon = { version = \"0.4.0\", optional = true }\n+rustc-rayon-core = { version = \"0.5.0\", optional = true }\n+rustc-rayon = { version = \"0.5.0\", optional = true }\n rustc_serialize = { path = \"../rustc_serialize\" }\n rustc_session = { path = \"../rustc_session\" }\n rustc_span = { path = \"../rustc_span\" }"}, {"sha": "fb0d909307e78d3d4a8ba651e8b2f930d1591988", "filename": "compiler/rustc_middle/src/ty/context/tls.rs", "status": "modified", "additions": 14, "deletions": 45, "changes": 59, "blob_url": "https://github.com/rust-lang/rust/blob/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext%2Ftls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext%2Ftls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fcontext%2Ftls.rs?ref=c31f75209f0718e74b9ca48dab46c069c09744b1", "patch": "@@ -4,6 +4,8 @@ use crate::dep_graph::TaskDepsRef;\n use crate::ty::query;\n use rustc_data_structures::sync::{self, Lock};\n use rustc_errors::Diagnostic;\n+#[cfg(not(parallel_compiler))]\n+use std::cell::Cell;\n use std::mem;\n use std::ptr;\n use thin_vec::ThinVec;\n@@ -47,52 +49,15 @@ impl<'a, 'tcx> ImplicitCtxt<'a, 'tcx> {\n     }\n }\n \n+// Import the thread-local variable from Rayon, which is preserved for Rayon jobs.\n #[cfg(parallel_compiler)]\n-mod tlv {\n-    use rustc_rayon_core as rayon_core;\n-    use std::ptr;\n-\n-    /// Gets Rayon's thread-local variable, which is preserved for Rayon jobs.\n-    /// This is used to get the pointer to the current `ImplicitCtxt`.\n-    #[inline]\n-    pub(super) fn get_tlv() -> *const () {\n-        ptr::from_exposed_addr(rayon_core::tlv::get())\n-    }\n-\n-    /// Sets Rayon's thread-local variable, which is preserved for Rayon jobs\n-    /// to `value` during the call to `f`. It is restored to its previous value after.\n-    /// This is used to set the pointer to the new `ImplicitCtxt`.\n-    #[inline]\n-    pub(super) fn with_tlv<F: FnOnce() -> R, R>(value: *const (), f: F) -> R {\n-        rayon_core::tlv::with(value.expose_addr(), f)\n-    }\n-}\n+use rayon_core::tlv::TLV;\n \n+// Otherwise define our own\n #[cfg(not(parallel_compiler))]\n-mod tlv {\n-    use std::cell::Cell;\n-    use std::ptr;\n-\n-    thread_local! {\n-        /// A thread local variable that stores a pointer to the current `ImplicitCtxt`.\n-        static TLV: Cell<*const ()> = const { Cell::new(ptr::null()) };\n-    }\n-\n-    /// Gets the pointer to the current `ImplicitCtxt`.\n-    #[inline]\n-    pub(super) fn get_tlv() -> *const () {\n-        TLV.with(|tlv| tlv.get())\n-    }\n-\n-    /// Sets TLV to `value` during the call to `f`.\n-    /// It is restored to its previous value after.\n-    /// This is used to set the pointer to the new `ImplicitCtxt`.\n-    #[inline]\n-    pub(super) fn with_tlv<F: FnOnce() -> R, R>(value: *const (), f: F) -> R {\n-        let old = TLV.replace(value);\n-        let _reset = rustc_data_structures::OnDrop(move || TLV.set(old));\n-        f()\n-    }\n+thread_local! {\n+    /// A thread local variable that stores a pointer to the current `ImplicitCtxt`.\n+    static TLV: Cell<*const ()> = const { Cell::new(ptr::null()) };\n }\n \n #[inline]\n@@ -111,7 +76,11 @@ pub fn enter_context<'a, 'tcx, F, R>(context: &ImplicitCtxt<'a, 'tcx>, f: F) ->\n where\n     F: FnOnce() -> R,\n {\n-    tlv::with_tlv(erase(context), f)\n+    TLV.with(|tlv| {\n+        let old = tlv.replace(erase(context));\n+        let _reset = rustc_data_structures::OnDrop(move || tlv.set(old));\n+        f()\n+    })\n }\n \n /// Allows access to the current `ImplicitCtxt` in a closure if one is available.\n@@ -120,7 +89,7 @@ pub fn with_context_opt<F, R>(f: F) -> R\n where\n     F: for<'a, 'tcx> FnOnce(Option<&ImplicitCtxt<'a, 'tcx>>) -> R,\n {\n-    let context = tlv::get_tlv();\n+    let context = TLV.get();\n     if context.is_null() {\n         f(None)\n     } else {"}, {"sha": "b107a3f03fe590997589a0ae83b80f4f6ec35e1c", "filename": "compiler/rustc_query_impl/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_query_impl%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_query_impl%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_impl%2FCargo.toml?ref=c31f75209f0718e74b9ca48dab46c069c09744b1", "patch": "@@ -16,7 +16,7 @@ rustc_index = { path = \"../rustc_index\" }\n rustc_macros = { path = \"../rustc_macros\" }\n rustc_middle = { path = \"../rustc_middle\" }\n rustc_query_system = { path = \"../rustc_query_system\" }\n-rustc-rayon-core = { version = \"0.4.0\", optional = true }\n+rustc-rayon-core = { version = \"0.5.0\", optional = true }\n rustc_serialize = { path = \"../rustc_serialize\" }\n rustc_session = { path = \"../rustc_session\" }\n rustc_span = { path = \"../rustc_span\" }"}, {"sha": "12b4a1143136bd9a4cbf812d2b2b5445356d3d5c", "filename": "compiler/rustc_query_system/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_query_system%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_query_system%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_system%2FCargo.toml?ref=c31f75209f0718e74b9ca48dab46c069c09744b1", "patch": "@@ -15,7 +15,7 @@ rustc_feature = { path = \"../rustc_feature\" }\n rustc_hir = { path = \"../rustc_hir\" }\n rustc_index = { path = \"../rustc_index\" }\n rustc_macros = { path = \"../rustc_macros\" }\n-rustc-rayon-core = { version = \"0.4.0\", optional = true }\n+rustc-rayon-core = { version = \"0.5.0\", optional = true }\n rustc_serialize = { path = \"../rustc_serialize\" }\n rustc_session = { path = \"../rustc_session\" }\n rustc_span = { path = \"../rustc_span\" }"}, {"sha": "a534b54070cd0bccd155fd18bbec89c68a821926", "filename": "compiler/rustc_query_system/src/query/job.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_query_system%2Fsrc%2Fquery%2Fjob.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_query_system%2Fsrc%2Fquery%2Fjob.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_query_system%2Fsrc%2Fquery%2Fjob.rs?ref=c31f75209f0718e74b9ca48dab46c069c09744b1", "patch": "@@ -18,11 +18,11 @@ use std::num::NonZeroU64;\n #[cfg(parallel_compiler)]\n use {\n     parking_lot::{Condvar, Mutex},\n+    rayon_core,\n     rustc_data_structures::fx::FxHashSet,\n     rustc_data_structures::sync::Lock,\n     rustc_data_structures::sync::Lrc,\n     rustc_data_structures::{jobserver, OnDrop},\n-    rustc_rayon_core as rayon_core,\n     rustc_span::DUMMY_SP,\n     std::iter,\n     std::process,"}, {"sha": "e4dbb8a637cea9fbc644dc1988700d69684d429c", "filename": "compiler/rustc_serialize/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_serialize%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_serialize%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_serialize%2FCargo.toml?ref=c31f75209f0718e74b9ca48dab46c069c09744b1", "patch": "@@ -4,7 +4,7 @@ version = \"0.0.0\"\n edition = \"2021\"\n \n [dependencies]\n-indexmap = \"1.9.1\"\n+indexmap = \"1.9.3\"\n smallvec = { version = \"1.8.1\", features = [\"union\", \"may_dangle\"] }\n thin-vec = \"0.2.12\"\n "}, {"sha": "a7c7575f392e6fdeab11daba9c47a4d4fa733e0b", "filename": "compiler/rustc_span/Cargo.toml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_span%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/c31f75209f0718e74b9ca48dab46c069c09744b1/compiler%2Frustc_span%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2FCargo.toml?ref=c31f75209f0718e74b9ca48dab46c069c09744b1", "patch": "@@ -18,4 +18,4 @@ tracing = \"0.1\"\n sha1 = \"0.10.0\"\n sha2 = \"0.10.1\"\n md5 = { package = \"md-5\", version = \"0.10.0\" }\n-indexmap = { version = \"1.9.1\" }\n+indexmap = { version = \"1.9.3\" }"}]}