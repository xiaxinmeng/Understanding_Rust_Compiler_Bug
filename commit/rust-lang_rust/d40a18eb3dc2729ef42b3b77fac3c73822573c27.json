{"sha": "d40a18eb3dc2729ef42b3b77fac3c73822573c27", "node_id": "C_kwDOAAsO6NoAKGQ0MGExOGViM2RjMjcyOWVmNDJiM2I3N2ZhYzNjNzM4MjI1NzNjMjc", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2022-08-24T13:33:56Z"}, "committer": {"name": "Guillaume Gomez", "email": "guillaume.gomez@huawei.com", "date": "2022-08-24T18:07:08Z"}, "message": "Remove the extra DOM level if there is only one child in rightside elements", "tree": {"sha": "633d5817c02fc848a1a3eb304ae63ae1481e14a5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/633d5817c02fc848a1a3eb304ae63ae1481e14a5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d40a18eb3dc2729ef42b3b77fac3c73822573c27", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d40a18eb3dc2729ef42b3b77fac3c73822573c27", "html_url": "https://github.com/rust-lang/rust/commit/d40a18eb3dc2729ef42b3b77fac3c73822573c27", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d40a18eb3dc2729ef42b3b77fac3c73822573c27/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "097b3823ddef9b29c62d62a3163e912498790b22", "url": "https://api.github.com/repos/rust-lang/rust/commits/097b3823ddef9b29c62d62a3163e912498790b22", "html_url": "https://github.com/rust-lang/rust/commit/097b3823ddef9b29c62d62a3163e912498790b22"}], "stats": {"total": 51, "additions": 37, "deletions": 14}, "files": [{"sha": "b1d2872019ef6f3b7d137e5abf3d4ca4d92bbe10", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 34, "deletions": 11, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/d40a18eb3dc2729ef42b3b77fac3c73822573c27/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d40a18eb3dc2729ef42b3b77fac3c73822573c27/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=d40a18eb3dc2729ef42b3b77fac3c73822573c27", "patch": "@@ -834,12 +834,13 @@ fn assoc_method(\n /// Note that it is possible for an unstable function to be const-stable. In that case, the span\n /// will include the const-stable version, but no stable version will be emitted, as a natural\n /// consequence of the above rules.\n-fn render_stability_since_raw(\n+fn render_stability_since_raw_with_extra(\n     w: &mut Buffer,\n     ver: Option<Symbol>,\n     const_stability: Option<ConstStability>,\n     containing_ver: Option<Symbol>,\n     containing_const_ver: Option<Symbol>,\n+    extra_class: &str,\n ) -> bool {\n     let stable_version = ver.filter(|inner| !inner.is_empty() && Some(*inner) != containing_ver);\n \n@@ -887,12 +888,30 @@ fn render_stability_since_raw(\n     }\n \n     if !stability.is_empty() {\n-        write!(w, r#\"<span class=\"since\" title=\"{}\">{}</span>\"#, title, stability);\n+        write!(w, r#\"<span class=\"since{extra_class}\" title=\"{title}\">{stability}</span>\"#);\n     }\n \n     !stability.is_empty()\n }\n \n+#[inline]\n+fn render_stability_since_raw(\n+    w: &mut Buffer,\n+    ver: Option<Symbol>,\n+    const_stability: Option<ConstStability>,\n+    containing_ver: Option<Symbol>,\n+    containing_const_ver: Option<Symbol>,\n+) -> bool {\n+    render_stability_since_raw_with_extra(\n+        w,\n+        ver,\n+        const_stability,\n+        containing_ver,\n+        containing_const_ver,\n+        \"\",\n+    )\n+}\n+\n fn render_assoc_item(\n     w: &mut Buffer,\n     item: &clean::Item,\n@@ -1675,25 +1694,29 @@ fn render_rightside(\n         RenderMode::Normal => (item.const_stability(tcx), containing_item.const_stable_since(tcx)),\n         RenderMode::ForDeref { .. } => (None, None),\n     };\n+    let src_href = cx.src_href(item);\n+    let has_src_ref = src_href.is_some();\n \n     let mut rightside = Buffer::new();\n-    let has_stability = render_stability_since_raw(\n+    let has_stability = render_stability_since_raw_with_extra(\n         &mut rightside,\n         item.stable_since(tcx),\n         const_stability,\n         containing_item.stable_since(tcx),\n         const_stable_since,\n+        if has_src_ref { \"\" } else { \" rightside\" },\n     );\n-    let mut srclink = Buffer::empty_from(w);\n-    if let Some(l) = cx.src_href(item) {\n-        write!(srclink, \"<a class=\\\"srclink\\\" href=\\\"{}\\\">source</a>\", l)\n-    }\n-    if has_stability && !srclink.is_empty() {\n-        rightside.write_str(\" \u00b7 \");\n+    if let Some(l) = src_href {\n+        if has_stability {\n+            write!(rightside, \" \u00b7 <a class=\\\"srclink\\\" href=\\\"{}\\\">source</a>\", l)\n+        } else {\n+            write!(rightside, \"<a class=\\\"srclink rightside\\\" href=\\\"{}\\\">source</a>\", l)\n+        }\n     }\n-    rightside.push_buffer(srclink);\n-    if !rightside.is_empty() {\n+    if has_stability && has_src_ref {\n         write!(w, \"<span class=\\\"rightside\\\">{}</span>\", rightside.into_inner());\n+    } else {\n+        w.push_buffer(rightside);\n     }\n }\n "}, {"sha": "f6614e89760303ac3bbce4a9712797f7bad095ac", "filename": "src/librustdoc/html/static/css/themes/ayu.css", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d40a18eb3dc2729ef42b3b77fac3c73822573c27/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "raw_url": "https://github.com/rust-lang/rust/raw/d40a18eb3dc2729ef42b3b77fac3c73822573c27/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css?ref=d40a18eb3dc2729ef42b3b77fac3c73822573c27", "patch": "@@ -199,7 +199,7 @@ details.rustdoc-toggle > summary::before {\n \tbackground: none;\n }\n \n-.rightside,\n+.rightside:not(a),\n .out-of-band {\n \tcolor: grey;\n }"}, {"sha": "d5cd47c3e19d5f00c5c4245c7bd1195e4ea937a3", "filename": "src/librustdoc/html/static/css/themes/dark.css", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d40a18eb3dc2729ef42b3b77fac3c73822573c27/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/d40a18eb3dc2729ef42b3b77fac3c73822573c27/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css?ref=d40a18eb3dc2729ef42b3b77fac3c73822573c27", "patch": "@@ -165,7 +165,7 @@ details.rustdoc-toggle > summary::before {\n \tbackground: none;\n }\n \n-.rightside,\n+.rightside:not(a),\n .out-of-band {\n \tcolor: grey;\n }"}, {"sha": "cff70268144f35852468925b80424e7c1fdcc47d", "filename": "src/librustdoc/html/static/css/themes/light.css", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d40a18eb3dc2729ef42b3b77fac3c73822573c27/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "raw_url": "https://github.com/rust-lang/rust/raw/d40a18eb3dc2729ef42b3b77fac3c73822573c27/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css?ref=d40a18eb3dc2729ef42b3b77fac3c73822573c27", "patch": "@@ -148,7 +148,7 @@ details.rustdoc-toggle > summary::before {\n .stab { background: #FFF5D6; border-color: #FFC600; }\n .stab.portability > code { background: none; }\n \n-.rightside,\n+.rightside:not(a),\n .out-of-band {\n \tcolor: grey;\n }"}]}