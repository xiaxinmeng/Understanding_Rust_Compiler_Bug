{"sha": "2ead65f0023825417f4d82d2e740bc43ee1f3749", "node_id": "C_kwDOAAsO6NoAKDJlYWQ2NWYwMDIzODI1NDE3ZjRkODJkMmU3NDBiYzQzZWUxZjM3NDk", "commit": {"author": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2022-08-16T01:04:01Z"}, "committer": {"name": "Josh Stone", "email": "jistone@redhat.com", "date": "2022-08-23T20:00:18Z"}, "message": "ci: Upgrade non-dist Linux testers from 16.04 to 22.04", "tree": {"sha": "8dc269fde79c8d6bf3d661536b490eb0a5a033de", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8dc269fde79c8d6bf3d661536b490eb0a5a033de"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2ead65f0023825417f4d82d2e740bc43ee1f3749", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2ead65f0023825417f4d82d2e740bc43ee1f3749", "html_url": "https://github.com/rust-lang/rust/commit/2ead65f0023825417f4d82d2e740bc43ee1f3749", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2ead65f0023825417f4d82d2e740bc43ee1f3749/comments", "author": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "committer": {"login": "cuviper", "id": 36186, "node_id": "MDQ6VXNlcjM2MTg2", "avatar_url": "https://avatars.githubusercontent.com/u/36186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cuviper", "html_url": "https://github.com/cuviper", "followers_url": "https://api.github.com/users/cuviper/followers", "following_url": "https://api.github.com/users/cuviper/following{/other_user}", "gists_url": "https://api.github.com/users/cuviper/gists{/gist_id}", "starred_url": "https://api.github.com/users/cuviper/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cuviper/subscriptions", "organizations_url": "https://api.github.com/users/cuviper/orgs", "repos_url": "https://api.github.com/users/cuviper/repos", "events_url": "https://api.github.com/users/cuviper/events{/privacy}", "received_events_url": "https://api.github.com/users/cuviper/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1cff5642037b83ce1239a624bbe617a9aa0d59b1", "url": "https://api.github.com/repos/rust-lang/rust/commits/1cff5642037b83ce1239a624bbe617a9aa0d59b1", "html_url": "https://github.com/rust-lang/rust/commit/1cff5642037b83ce1239a624bbe617a9aa0d59b1"}], "stats": {"total": 62, "additions": 16, "deletions": 46}, "files": [{"sha": "dd74726f856915a73311b92112066fe976d6e34a", "filename": "src/ci/docker/host-x86_64/i686-gnu-nopt/Dockerfile", "status": "modified", "additions": 3, "deletions": 10, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/2ead65f0023825417f4d82d2e740bc43ee1f3749/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu-nopt%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/2ead65f0023825417f4d82d2e740bc43ee1f3749/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu-nopt%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu-nopt%2FDockerfile?ref=2ead65f0023825417f4d82d2e740bc43ee1f3749", "patch": "@@ -1,5 +1,6 @@\n-FROM ubuntu:16.04\n+FROM ubuntu:22.04\n \n+ARG DEBIAN_FRONTEND=noninteractive\n RUN apt-get update && apt-get install -y --no-install-recommends \\\n   g++-multilib \\\n   make \\\n@@ -20,18 +21,10 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-COPY scripts/cmake.sh /scripts/\n-RUN /scripts/cmake.sh\n-\n RUN mkdir -p /config\n RUN echo \"[rust]\" > /config/nopt-std-config.toml\n RUN echo \"optimize = false\" >> /config/nopt-std-config.toml\n \n-# We are intentionally allowing an old toolchain on this builder (and that's\n-# incompatible with LLVM downloads today).\n-ENV NO_DOWNLOAD_CI_LLVM 1\n-\n-ENV RUST_CONFIGURE_ARGS --build=i686-unknown-linux-gnu --disable-optimize-tests \\\n-    --set llvm.allow-old-toolchain\n+ENV RUST_CONFIGURE_ARGS --build=i686-unknown-linux-gnu --disable-optimize-tests\n ENV SCRIPT python3 ../x.py test --stage 0 --config /config/nopt-std-config.toml library/std \\\n   && python3 ../x.py --stage 2 test"}, {"sha": "0c36cfd66bdef05ac0842102035c2288fc84b271", "filename": "src/ci/docker/host-x86_64/i686-gnu/Dockerfile", "status": "modified", "additions": 3, "deletions": 9, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/2ead65f0023825417f4d82d2e740bc43ee1f3749/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/2ead65f0023825417f4d82d2e740bc43ee1f3749/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fi686-gnu%2FDockerfile?ref=2ead65f0023825417f4d82d2e740bc43ee1f3749", "patch": "@@ -1,5 +1,6 @@\n-FROM ubuntu:16.04\n+FROM ubuntu:22.04\n \n+ARG DEBIAN_FRONTEND=noninteractive\n RUN apt-get update && apt-get install -y --no-install-recommends \\\n   g++-multilib \\\n   make \\\n@@ -20,14 +21,7 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-COPY scripts/cmake.sh /scripts/\n-RUN /scripts/cmake.sh\n-\n-# We are intentionally allowing an old toolchain on this builder (and that's\n-# incompatible with LLVM downloads today).\n-ENV NO_DOWNLOAD_CI_LLVM 1\n-ENV RUST_CONFIGURE_ARGS --build=i686-unknown-linux-gnu \\\n-    --set llvm.allow-old-toolchain\n+ENV RUST_CONFIGURE_ARGS --build=i686-unknown-linux-gnu\n # Exclude some tests that are unlikely to be platform specific, to speed up\n # this slow job.\n ENV SCRIPT python3 ../x.py --stage 2 test \\"}, {"sha": "d55d5b56ad3f5e8cccfced590d0d2c0a81dcbf0f", "filename": "src/ci/docker/host-x86_64/x86_64-gnu-aux/Dockerfile", "status": "modified", "additions": 3, "deletions": 10, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/2ead65f0023825417f4d82d2e740bc43ee1f3749/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-aux%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/2ead65f0023825417f4d82d2e740bc43ee1f3749/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-aux%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-aux%2FDockerfile?ref=2ead65f0023825417f4d82d2e740bc43ee1f3749", "patch": "@@ -1,5 +1,6 @@\n-FROM ubuntu:16.04\n+FROM ubuntu:22.04\n \n+ARG DEBIAN_FRONTEND=noninteractive\n RUN apt-get update && apt-get install -y --no-install-recommends \\\n   g++ \\\n   make \\\n@@ -23,13 +24,5 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-COPY scripts/cmake.sh /scripts/\n-RUN /scripts/cmake.sh\n-\n-# We are intentionally allowing an old toolchain on this builder (and that's\n-# incompatible with LLVM downloads today).\n-ENV NO_DOWNLOAD_CI_LLVM 1\n-\n-ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu \\\n-    --set llvm.allow-old-toolchain\n+ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu\n ENV RUST_CHECK_TARGET check-aux"}, {"sha": "80a004501a81bb590553c4d77e8861587f331d07", "filename": "src/ci/docker/host-x86_64/x86_64-gnu-distcheck/Dockerfile", "status": "modified", "additions": 4, "deletions": 8, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/2ead65f0023825417f4d82d2e740bc43ee1f3749/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-distcheck%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/2ead65f0023825417f4d82d2e740bc43ee1f3749/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-distcheck%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-distcheck%2FDockerfile?ref=2ead65f0023825417f4d82d2e740bc43ee1f3749", "patch": "@@ -1,5 +1,6 @@\n-FROM ubuntu:16.04\n+FROM ubuntu:22.04\n \n+ARG DEBIAN_FRONTEND=noninteractive\n RUN apt-get update && apt-get install -y --no-install-recommends \\\n   g++ \\\n   make \\\n@@ -19,14 +20,9 @@ RUN apt-get update && apt-get install -y --no-install-recommends \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-COPY scripts/cmake.sh /scripts/\n-RUN /scripts/cmake.sh\n-\n-# We are intentionally allowing an old toolchain on this builder (and that's\n-# incompatible with LLVM downloads today).\n+# We are disabling CI LLVM since distcheck is an offline build.\n ENV NO_DOWNLOAD_CI_LLVM 1\n \n-ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu --set rust.ignore-git=false \\\n-    --set llvm.allow-old-toolchain\n+ENV RUST_CONFIGURE_ARGS --build=x86_64-unknown-linux-gnu --set rust.ignore-git=false\n ENV SCRIPT python3 ../x.py --stage 2 test distcheck\n ENV DIST_SRC 1"}, {"sha": "ca23198cf90d317e5a2654c87ecf5b429781e6cb", "filename": "src/ci/docker/host-x86_64/x86_64-gnu-tools/Dockerfile", "status": "modified", "additions": 3, "deletions": 9, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/2ead65f0023825417f4d82d2e740bc43ee1f3749/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-tools%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/2ead65f0023825417f4d82d2e740bc43ee1f3749/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-tools%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fx86_64-gnu-tools%2FDockerfile?ref=2ead65f0023825417f4d82d2e740bc43ee1f3749", "patch": "@@ -1,5 +1,6 @@\n-FROM ubuntu:16.04\n+FROM ubuntu:22.04\n \n+ARG DEBIAN_FRONTEND=noninteractive\n RUN apt-get update && apt-get install -y --no-install-recommends \\\n   g++ \\\n   make \\\n@@ -27,6 +28,7 @@ RUN apt-get install -y \\\n   libdbus-1-3 \\\n   libexpat1 \\\n   libfontconfig1 \\\n+  libgbm1 \\\n   libgcc1 \\\n   libgconf-2-4 \\\n   libgdk-pixbuf2.0-0 \\\n@@ -59,9 +61,6 @@ RUN apt-get install -y \\\n COPY scripts/sccache.sh /scripts/\n RUN sh /scripts/sccache.sh\n \n-COPY scripts/cmake.sh /scripts/\n-RUN /scripts/cmake.sh\n-\n COPY host-x86_64/x86_64-gnu-tools/checktools.sh /tmp/\n \n RUN curl -sL https://nodejs.org/dist/v14.4.0/node-v14.4.0-linux-x64.tar.xz | tar -xJ\n@@ -80,12 +79,7 @@ COPY host-x86_64/x86_64-gnu-tools/browser-ui-test.version /tmp/\n # the local version of the package is different than the one used by the CI.\n RUN npm install -g browser-ui-test@$(head -n 1 /tmp/browser-ui-test.version) --unsafe-perm=true\n \n-# We are intentionally allowing an old toolchain on this builder (and that's\n-# incompatible with LLVM downloads today).\n-ENV NO_DOWNLOAD_CI_LLVM 1\n-\n ENV RUST_CONFIGURE_ARGS \\\n-  --set llvm.allow-old-toolchain \\\n   --build=x86_64-unknown-linux-gnu \\\n   --save-toolstates=/tmp/toolstate/toolstates.json\n "}]}