{"sha": "0250f0244b320b1cecabc05c108178171c733f6c", "node_id": "C_kwDOAAsO6NoAKDAyNTBmMDI0NGIzMjBiMWNlY2FiYzA1YzEwODE3ODE3MWM3MzNmNmM", "commit": {"author": {"name": "Maybe Waffle", "email": "waffle.lapkin@gmail.com", "date": "2022-07-26T10:17:15Z"}, "committer": {"name": "Maybe Waffle", "email": "waffle.lapkin@gmail.com", "date": "2022-10-09T13:07:20Z"}, "message": "allow or avoid for loops over option in compiler and tests", "tree": {"sha": "d569df0fe44e755c8d03770e614ff26c355ce212", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d569df0fe44e755c8d03770e614ff26c355ce212"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0250f0244b320b1cecabc05c108178171c733f6c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0250f0244b320b1cecabc05c108178171c733f6c", "html_url": "https://github.com/rust-lang/rust/commit/0250f0244b320b1cecabc05c108178171c733f6c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0250f0244b320b1cecabc05c108178171c733f6c/comments", "author": {"login": "WaffleLapkin", "id": 38225716, "node_id": "MDQ6VXNlcjM4MjI1NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/38225716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WaffleLapkin", "html_url": "https://github.com/WaffleLapkin", "followers_url": "https://api.github.com/users/WaffleLapkin/followers", "following_url": "https://api.github.com/users/WaffleLapkin/following{/other_user}", "gists_url": "https://api.github.com/users/WaffleLapkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/WaffleLapkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WaffleLapkin/subscriptions", "organizations_url": "https://api.github.com/users/WaffleLapkin/orgs", "repos_url": "https://api.github.com/users/WaffleLapkin/repos", "events_url": "https://api.github.com/users/WaffleLapkin/events{/privacy}", "received_events_url": "https://api.github.com/users/WaffleLapkin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "WaffleLapkin", "id": 38225716, "node_id": "MDQ6VXNlcjM4MjI1NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/38225716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WaffleLapkin", "html_url": "https://github.com/WaffleLapkin", "followers_url": "https://api.github.com/users/WaffleLapkin/followers", "following_url": "https://api.github.com/users/WaffleLapkin/following{/other_user}", "gists_url": "https://api.github.com/users/WaffleLapkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/WaffleLapkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WaffleLapkin/subscriptions", "organizations_url": "https://api.github.com/users/WaffleLapkin/orgs", "repos_url": "https://api.github.com/users/WaffleLapkin/repos", "events_url": "https://api.github.com/users/WaffleLapkin/events{/privacy}", "received_events_url": "https://api.github.com/users/WaffleLapkin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8ca57b54c19b22b6037b44619e5773a6a378d808", "url": "https://api.github.com/repos/rust-lang/rust/commits/8ca57b54c19b22b6037b44619e5773a6a378d808", "html_url": "https://github.com/rust-lang/rust/commit/8ca57b54c19b22b6037b44619e5773a6a378d808"}], "stats": {"total": 29, "additions": 14, "deletions": 15}, "files": [{"sha": "c6c80e613e30d9aad27ce00341bbaa05f3e08e0a", "filename": "compiler/rustc_ast/src/visit.rs", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/0250f0244b320b1cecabc05c108178171c733f6c/compiler%2Frustc_ast%2Fsrc%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0250f0244b320b1cecabc05c108178171c733f6c/compiler%2Frustc_ast%2Fsrc%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fvisit.rs?ref=0250f0244b320b1cecabc05c108178171c733f6c", "patch": "@@ -244,14 +244,12 @@ pub trait Visitor<'ast>: Sized {\n \n #[macro_export]\n macro_rules! walk_list {\n-    ($visitor: expr, $method: ident, $list: expr) => {\n-        for elem in $list {\n-            $visitor.$method(elem)\n-        }\n-    };\n-    ($visitor: expr, $method: ident, $list: expr, $($extra_args: expr),*) => {\n-        for elem in $list {\n-            $visitor.$method(elem, $($extra_args,)*)\n+    ($visitor: expr, $method: ident, $list: expr $(, $($extra_args: expr),* )?) => {\n+        {\n+            #[cfg_attr(not(bootstrap), allow(for_loop_over_fallibles))]\n+            for elem in $list {\n+                $visitor.$method(elem $(, $($extra_args,)* )?)\n+            }\n         }\n     }\n }"}, {"sha": "6a0fe7784fbcc37b8193d198ab9ed227d3b8a12d", "filename": "src/test/ui/drop/dropck_legal_cycles.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/0250f0244b320b1cecabc05c108178171c733f6c/src%2Ftest%2Fui%2Fdrop%2Fdropck_legal_cycles.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0250f0244b320b1cecabc05c108178171c733f6c/src%2Ftest%2Fui%2Fdrop%2Fdropck_legal_cycles.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fdrop%2Fdropck_legal_cycles.rs?ref=0250f0244b320b1cecabc05c108178171c733f6c", "patch": "@@ -1017,7 +1017,7 @@ impl<'a> Children<'a> for HM<'a> {\n         where C: Context + PrePost<Self>, Self: Sized\n     {\n         if let Some(ref hm) = self.contents.get() {\n-            for (k, v) in hm.iter().nth(index / 2) {\n+            if let Some((k, v)) = hm.iter().nth(index / 2) {\n                 [k, v][index % 2].descend_into_self(context);\n             }\n         }\n@@ -1032,7 +1032,7 @@ impl<'a> Children<'a> for VD<'a> {\n         where C: Context + PrePost<Self>, Self: Sized\n     {\n         if let Some(ref vd) = self.contents.get() {\n-            for r in vd.iter().nth(index) {\n+            if let Some(r) = vd.iter().nth(index) {\n                 r.descend_into_self(context);\n             }\n         }\n@@ -1047,7 +1047,7 @@ impl<'a> Children<'a> for VM<'a> {\n         where C: Context + PrePost<VM<'a>>\n     {\n         if let Some(ref vd) = self.contents.get() {\n-            for (_idx, r) in vd.iter().nth(index) {\n+            if let Some((_idx, r)) = vd.iter().nth(index) {\n                 r.descend_into_self(context);\n             }\n         }\n@@ -1062,7 +1062,7 @@ impl<'a> Children<'a> for LL<'a> {\n         where C: Context + PrePost<LL<'a>>\n     {\n         if let Some(ref ll) = self.contents.get() {\n-            for r in ll.iter().nth(index) {\n+            if let Some(r) = ll.iter().nth(index) {\n                 r.descend_into_self(context);\n             }\n         }\n@@ -1077,7 +1077,7 @@ impl<'a> Children<'a> for BH<'a> {\n         where C: Context + PrePost<BH<'a>>\n     {\n         if let Some(ref bh) = self.contents.get() {\n-            for r in bh.iter().nth(index) {\n+            if let Some(r) = bh.iter().nth(index) {\n                 r.descend_into_self(context);\n             }\n         }\n@@ -1092,7 +1092,7 @@ impl<'a> Children<'a> for BTM<'a> {\n         where C: Context + PrePost<BTM<'a>>\n     {\n         if let Some(ref bh) = self.contents.get() {\n-            for (k, v) in bh.iter().nth(index / 2) {\n+            if let Some((k, v)) = bh.iter().nth(index / 2) {\n                 [k, v][index % 2].descend_into_self(context);\n             }\n         }\n@@ -1107,7 +1107,7 @@ impl<'a> Children<'a> for BTS<'a> {\n         where C: Context + PrePost<BTS<'a>>\n     {\n         if let Some(ref bh) = self.contents.get() {\n-            for r in bh.iter().nth(index) {\n+            if let Some(r) = bh.iter().nth(index) {\n                 r.descend_into_self(context);\n             }\n         }"}, {"sha": "880558eb5b69740fb7f0d112caf8bf86877ee1e7", "filename": "src/test/ui/issues/issue-30371.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/0250f0244b320b1cecabc05c108178171c733f6c/src%2Ftest%2Fui%2Fissues%2Fissue-30371.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0250f0244b320b1cecabc05c108178171c733f6c/src%2Ftest%2Fui%2Fissues%2Fissue-30371.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-30371.rs?ref=0250f0244b320b1cecabc05c108178171c733f6c", "patch": "@@ -1,5 +1,6 @@\n // run-pass\n #![allow(unreachable_code)]\n+#![allow(for_loop_over_fallibles)]\n #![deny(unused_variables)]\n \n fn main() {"}]}