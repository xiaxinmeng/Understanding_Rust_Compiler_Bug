{"sha": "cf708558b758f4473c4f35986d9492ace7bf906d", "node_id": "C_kwDOAAsO6NoAKGNmNzA4NTU4Yjc1OGY0NDczYzRmMzU5ODZkOTQ5MmFjZTdiZjkwNmQ", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-10-23T06:13:18Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-10-23T06:13:18Z"}, "message": "Auto merge of #90188 - matthiaskrgr:rollup-74cwv5c, r=matthiaskrgr\n\nRollup of 11 pull requests\n\nSuccessful merges:\n\n - #83233 (Implement split_array and split_array_mut)\n - #88300 (Stabilise unix_process_wait_more, extra ExitStatusExt methods)\n - #89416 (nice_region_error: Include lifetime placeholders in error output)\n - #89468 (Report fatal lexer errors in `--cfg` command line arguments)\n - #89730 (add feature flag for `type_changing_struct_update`)\n - #89920 (Implement -Z location-detail flag)\n - #90070 (Add edition configuration to compiletest)\n - #90087 (Sync rustfmt subtree)\n - #90117 (Make RSplit<T, P>: Clone not require T: Clone)\n - #90122 (CI: make docker cache download and `docker load` time out after 10 minutes)\n - #90166 (Add comment documenting why we can't use a simpler solution)\n\nFailed merges:\n\nr? `@ghost`\n`@rustbot` modify labels: rollup", "tree": {"sha": "2f4b1fb7cff6c2182d10cc4903ed7826f9a72e06", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2f4b1fb7cff6c2182d10cc4903ed7826f9a72e06"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cf708558b758f4473c4f35986d9492ace7bf906d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cf708558b758f4473c4f35986d9492ace7bf906d", "html_url": "https://github.com/rust-lang/rust/commit/cf708558b758f4473c4f35986d9492ace7bf906d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cf708558b758f4473c4f35986d9492ace7bf906d/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a3f7c4db0373aa077f86cdd1bf11122845d3b65a", "url": "https://api.github.com/repos/rust-lang/rust/commits/a3f7c4db0373aa077f86cdd1bf11122845d3b65a", "html_url": "https://github.com/rust-lang/rust/commit/a3f7c4db0373aa077f86cdd1bf11122845d3b65a"}, {"sha": "a05a1294d08e285f7039293298d9170fb3117013", "url": "https://api.github.com/repos/rust-lang/rust/commits/a05a1294d08e285f7039293298d9170fb3117013", "html_url": "https://github.com/rust-lang/rust/commit/a05a1294d08e285f7039293298d9170fb3117013"}], "stats": {"total": 4521, "additions": 3500, "deletions": 1021}, "files": [{"sha": "41275accbe9625ef764e089e548eb4bf02a1276a", "filename": "Cargo.lock", "status": "modified", "additions": 37, "deletions": 43, "changes": 80, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -265,14 +265,23 @@ version = \"1.0.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"81a18687293a1546b67c246452202bbbf143d239cb43494cc163da14979082da\"\n \n+[[package]]\n+name = \"camino\"\n+version = \"1.0.5\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"52d74260d9bf6944e2208aa46841b4b8f0d7ffc0849a06837b2f510337f86b2b\"\n+dependencies = [\n+ \"serde\",\n+]\n+\n [[package]]\n name = \"cargo\"\n version = \"0.58.0\"\n dependencies = [\n  \"anyhow\",\n  \"atty\",\n  \"bytesize\",\n- \"cargo-platform\",\n+ \"cargo-platform 0.1.2\",\n  \"cargo-test-macro\",\n  \"cargo-test-support\",\n  \"cargo-util\",\n@@ -374,6 +383,15 @@ dependencies = [\n  \"serde\",\n ]\n \n+[[package]]\n+name = \"cargo-platform\"\n+version = \"0.1.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"cbdb825da8a5df079a43676dbe042702f1707b1109f713a01420fbb4cc71fa27\"\n+dependencies = [\n+ \"serde\",\n+]\n+\n [[package]]\n name = \"cargo-test-macro\"\n version = \"0.1.0\"\n@@ -421,23 +439,24 @@ dependencies = [\n \n [[package]]\n name = \"cargo_metadata\"\n-version = \"0.8.2\"\n+version = \"0.12.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"700b3731fd7d357223d0000f4dbf1808401b694609035c3c411fbc0cd375c426\"\n+checksum = \"d5a5f7b42f606b7f23674f6f4d877628350682bc40687d3fae65679a58d55345\"\n dependencies = [\n- \"semver 0.9.0\",\n+ \"semver 0.11.0\",\n  \"serde\",\n- \"serde_derive\",\n  \"serde_json\",\n ]\n \n [[package]]\n name = \"cargo_metadata\"\n-version = \"0.12.0\"\n+version = \"0.14.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"d5a5f7b42f606b7f23674f6f4d877628350682bc40687d3fae65679a58d55345\"\n+checksum = \"c297bd3135f558552f99a0daa180876984ea2c4ffa7470314540dff8c654109a\"\n dependencies = [\n- \"semver 0.11.0\",\n+ \"camino\",\n+ \"cargo-platform 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"semver 1.0.3\",\n  \"serde\",\n  \"serde_json\",\n ]\n@@ -1070,9 +1089,9 @@ dependencies = [\n \n [[package]]\n name = \"env_logger\"\n-version = \"0.6.2\"\n+version = \"0.7.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"aafcde04e90a5226a6443b7aabdb016ba2f8307c847d524724bd9b346dd1a2d3\"\n+checksum = \"44533bbbb3bb3c1fa17d9f2e4e38bbbaf8396ba82193c4cb1b6445d711445d36\"\n dependencies = [\n  \"atty\",\n  \"humantime 1.3.0\",\n@@ -1083,12 +1102,12 @@ dependencies = [\n \n [[package]]\n name = \"env_logger\"\n-version = \"0.7.1\"\n+version = \"0.8.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"44533bbbb3bb3c1fa17d9f2e4e38bbbaf8396ba82193c4cb1b6445d711445d36\"\n+checksum = \"a19187fea3ac7e84da7dacf48de0c45d63c6a76f9490dae389aead16c243fce3\"\n dependencies = [\n  \"atty\",\n- \"humantime 1.3.0\",\n+ \"humantime 2.0.1\",\n  \"log\",\n  \"regex\",\n  \"termcolor\",\n@@ -1698,15 +1717,6 @@ version = \"0.1.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"5b141fdc7836c525d4d594027d318c84161ca17aaf8113ab1f81ab93ae897485\"\n \n-[[package]]\n-name = \"itertools\"\n-version = \"0.8.2\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"f56a2d0bc861f9165be4eb3442afd3c236d8a98afd426f65d92324ae1091a484\"\n-dependencies = [\n- \"either\",\n-]\n-\n [[package]]\n name = \"itertools\"\n version = \"0.9.0\"\n@@ -4673,19 +4683,19 @@ dependencies = [\n \n [[package]]\n name = \"rustfmt-nightly\"\n-version = \"1.4.37\"\n+version = \"1.4.38\"\n dependencies = [\n  \"annotate-snippets\",\n  \"anyhow\",\n  \"bytecount\",\n- \"cargo_metadata 0.8.2\",\n+ \"cargo_metadata 0.14.0\",\n  \"derive-new\",\n  \"diff\",\n  \"dirs\",\n- \"env_logger 0.6.2\",\n+ \"env_logger 0.8.4\",\n  \"getopts\",\n  \"ignore\",\n- \"itertools 0.8.2\",\n+ \"itertools 0.9.0\",\n  \"lazy_static\",\n  \"log\",\n  \"regex\",\n@@ -4768,23 +4778,13 @@ dependencies = [\n  \"libc\",\n ]\n \n-[[package]]\n-name = \"semver\"\n-version = \"0.9.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"1d7eb9ef2c18661902cc47e535f9bc51b78acd254da71d375c2f6720d9a40403\"\n-dependencies = [\n- \"semver-parser 0.7.0\",\n- \"serde\",\n-]\n-\n [[package]]\n name = \"semver\"\n version = \"0.11.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"f301af10236f6df4160f7c3f04eec6dbc70ace82d23326abad5edee88801c6b6\"\n dependencies = [\n- \"semver-parser 0.10.2\",\n+ \"semver-parser\",\n  \"serde\",\n ]\n \n@@ -4797,12 +4797,6 @@ dependencies = [\n  \"serde\",\n ]\n \n-[[package]]\n-name = \"semver-parser\"\n-version = \"0.7.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"388a1df253eca08550bef6c72392cfe7c30914bf41df5269b68cbd6ff8f570a3\"\n-\n [[package]]\n name = \"semver-parser\"\n version = \"0.10.2\""}, {"sha": "b5e97ec8fe0f466e94fbd39520bda32633831dda", "filename": "compiler/rustc_const_eval/src/interpret/intrinsics/caller_location.rs", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fintrinsics%2Fcaller_location.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fintrinsics%2Fcaller_location.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Finterpret%2Fintrinsics%2Fcaller_location.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -80,10 +80,17 @@ impl<'mir, 'tcx: 'mir, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n         line: u32,\n         col: u32,\n     ) -> MPlaceTy<'tcx, M::PointerTag> {\n-        let file =\n-            self.allocate_str(&filename.as_str(), MemoryKind::CallerLocation, Mutability::Not);\n-        let line = Scalar::from_u32(line);\n-        let col = Scalar::from_u32(col);\n+        let loc_details = &self.tcx.sess.opts.debugging_opts.location_detail;\n+        let file = if loc_details.file {\n+            self.allocate_str(&filename.as_str(), MemoryKind::CallerLocation, Mutability::Not)\n+        } else {\n+            // FIXME: This creates a new allocation each time. It might be preferable to\n+            // perform this allocation only once, and re-use the `MPlaceTy`.\n+            // See https://github.com/rust-lang/rust/pull/89920#discussion_r730012398\n+            self.allocate_str(\"<redacted>\", MemoryKind::CallerLocation, Mutability::Not)\n+        };\n+        let line = if loc_details.line { Scalar::from_u32(line) } else { Scalar::from_u32(0) };\n+        let col = if loc_details.column { Scalar::from_u32(col) } else { Scalar::from_u32(0) };\n \n         // Allocate memory for `CallerLocation` struct.\n         let loc_ty = self"}, {"sha": "e17604740f0319eedad22501bae4622fc1f2bedc", "filename": "compiler/rustc_errors/src/emitter.rs", "status": "modified", "additions": 17, "deletions": 4, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_errors%2Fsrc%2Femitter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_errors%2Fsrc%2Femitter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_errors%2Fsrc%2Femitter.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -15,7 +15,7 @@ use rustc_span::{MultiSpan, SourceFile, Span};\n use crate::snippet::{Annotation, AnnotationType, Line, MultilineAnnotation, Style, StyledString};\n use crate::styled_buffer::StyledBuffer;\n use crate::{\n-    CodeSuggestion, Diagnostic, DiagnosticId, Level, SubDiagnostic, SubstitutionHighlight,\n+    CodeSuggestion, Diagnostic, DiagnosticId, Handler, Level, SubDiagnostic, SubstitutionHighlight,\n     SuggestionStyle,\n };\n \n@@ -523,14 +523,27 @@ impl Emitter for EmitterWriter {\n     }\n }\n \n-/// An emitter that does nothing when emitting a diagnostic.\n-pub struct SilentEmitter;\n+/// An emitter that does nothing when emitting a non-fatal diagnostic.\n+/// Fatal diagnostics are forwarded to `fatal_handler` to avoid silent\n+/// failures of rustc, as witnessed e.g. in issue #89358.\n+pub struct SilentEmitter {\n+    pub fatal_handler: Handler,\n+    pub fatal_note: Option<String>,\n+}\n \n impl Emitter for SilentEmitter {\n     fn source_map(&self) -> Option<&Lrc<SourceMap>> {\n         None\n     }\n-    fn emit_diagnostic(&mut self, _: &Diagnostic) {}\n+    fn emit_diagnostic(&mut self, d: &Diagnostic) {\n+        if d.level == Level::Fatal {\n+            let mut d = d.clone();\n+            if let Some(ref note) = self.fatal_note {\n+                d.note(note);\n+            }\n+            self.fatal_handler.emit_diagnostic(&d);\n+        }\n+    }\n }\n \n /// Maximum number of lines we will print for a multiline suggestion; arbitrary."}, {"sha": "2bbfb561ba59461a6ea310f6417673d5c497ffc0", "filename": "compiler/rustc_feature/src/active.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_feature%2Fsrc%2Factive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_feature%2Fsrc%2Factive.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -684,6 +684,10 @@ declare_features! (\n     /// Allows using the `non_exhaustive_omitted_patterns` lint.\n     (active, non_exhaustive_omitted_patterns_lint, \"1.57.0\", Some(89554), None),\n \n+    /// Allows creation of instances of a struct by moving fields that have\n+    /// not changed from prior instances of the same struct (RFC #2528)\n+    (incomplete, type_changing_struct_update, \"1.58.0\", Some(86555), None),\n+\n     // -------------------------------------------------------------------------\n     // feature-group-end: actual feature gates\n     // -------------------------------------------------------------------------"}, {"sha": "b9e7ee12bc86df55872e82a103729820232a1483", "filename": "compiler/rustc_infer/src/infer/error_reporting/nice_region_error/trait_impl_difference.rs", "status": "modified", "additions": 48, "deletions": 11, "changes": 59, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Ftrait_impl_difference.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Ftrait_impl_difference.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Ftrait_impl_difference.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -9,10 +9,13 @@ use rustc_hir as hir;\n use rustc_hir::def::Res;\n use rustc_hir::def_id::DefId;\n use rustc_hir::intravisit::Visitor;\n-use rustc_middle::ty::error::ExpectedFound;\n-use rustc_middle::ty::{self, Ty, TyCtxt};\n+use rustc_middle::ty::print::RegionHighlightMode;\n+use rustc_middle::ty::{self, Ty, TyCtxt, TypeFoldable, TypeVisitor};\n+\n use rustc_span::{MultiSpan, Span, Symbol};\n \n+use std::ops::ControlFlow;\n+\n impl<'a, 'tcx> NiceRegionError<'a, 'tcx> {\n     /// Print the error message for lifetime errors when the `impl` doesn't conform to the `trait`.\n     pub(super) fn try_report_impl_not_conforming_to_trait(&self) -> Option<ErrorReported> {\n@@ -69,6 +72,47 @@ impl<'a, 'tcx> NiceRegionError<'a, 'tcx> {\n             .tcx()\n             .sess\n             .struct_span_err(sp, \"`impl` item signature doesn't match `trait` item signature\");\n+\n+        // Mark all unnamed regions in the type with a number.\n+        // This diagnostic is called in response to lifetime errors, so be informative.\n+        struct HighlightBuilder<'tcx> {\n+            highlight: RegionHighlightMode,\n+            tcx: TyCtxt<'tcx>,\n+            counter: usize,\n+        }\n+\n+        impl HighlightBuilder<'tcx> {\n+            fn build(tcx: TyCtxt<'tcx>, ty: Ty<'tcx>) -> RegionHighlightMode {\n+                let mut builder =\n+                    HighlightBuilder { highlight: RegionHighlightMode::default(), counter: 1, tcx };\n+                builder.visit_ty(ty);\n+                builder.highlight\n+            }\n+        }\n+\n+        impl<'tcx> ty::fold::TypeVisitor<'tcx> for HighlightBuilder<'tcx> {\n+            fn tcx_for_anon_const_substs(&self) -> Option<TyCtxt<'tcx>> {\n+                Some(self.tcx)\n+            }\n+\n+            fn visit_region(&mut self, r: ty::Region<'tcx>) -> ControlFlow<Self::BreakTy> {\n+                if !r.has_name() && self.counter <= 3 {\n+                    self.highlight.highlighting_region(r, self.counter);\n+                    self.counter += 1;\n+                }\n+                r.super_visit_with(self)\n+            }\n+        }\n+\n+        let expected_highlight = HighlightBuilder::build(self.tcx(), expected);\n+        let expected = self\n+            .infcx\n+            .extract_inference_diagnostics_data(expected.into(), Some(expected_highlight))\n+            .name;\n+        let found_highlight = HighlightBuilder::build(self.tcx(), found);\n+        let found =\n+            self.infcx.extract_inference_diagnostics_data(found.into(), Some(found_highlight)).name;\n+\n         err.span_label(sp, &format!(\"found `{}`\", found));\n         err.span_label(trait_sp, &format!(\"expected `{}`\", expected));\n \n@@ -96,15 +140,8 @@ impl<'a, 'tcx> NiceRegionError<'a, 'tcx> {\n             );\n         }\n \n-        if let Some((expected, found)) =\n-            self.infcx.expected_found_str_ty(ExpectedFound { expected, found })\n-        {\n-            // Highlighted the differences when showing the \"expected/found\" note.\n-            err.note_expected_found(&\"\", expected, &\"\", found);\n-        } else {\n-            // This fallback shouldn't be necessary, but let's keep it in just in case.\n-            err.note(&format!(\"expected `{}`\\n   found `{}`\", expected, found));\n-        }\n+        err.note(&format!(\"expected `{}`\\n   found `{}`\", expected, found));\n+\n         err.span_help(\n             type_param_span,\n             \"the lifetime requirements from the `impl` do not correspond to the requirements in \\"}, {"sha": "81585f8f4e49c492e802ca855a645a40a4f7e6ea", "filename": "compiler/rustc_interface/src/interface.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_interface%2Fsrc%2Finterface.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_interface%2Fsrc%2Finterface.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2Fsrc%2Finterface.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -75,7 +75,10 @@ pub fn parse_cfgspecs(cfgspecs: Vec<String>) -> FxHashSet<(String, Option<String\n         let cfg = cfgspecs\n             .into_iter()\n             .map(|s| {\n-                let sess = ParseSess::with_silent_emitter();\n+                let sess = ParseSess::with_silent_emitter(Some(format!(\n+                    \"this error occurred on the command line: `--cfg={}`\",\n+                    s\n+                )));\n                 let filename = FileName::cfg_spec_source_code(&s);\n                 let mut parser = new_parser_from_source_str(&sess, filename, s.to_string());\n "}, {"sha": "dab4d485e2d0b22d2c20c8e1e31a1dfd35e7ce26", "filename": "compiler/rustc_interface/src/tests.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_interface%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_interface%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_interface%2Fsrc%2Ftests.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -5,7 +5,9 @@ use rustc_errors::{emitter::HumanReadableErrorType, registry, ColorConfig};\n use rustc_session::config::InstrumentCoverage;\n use rustc_session::config::Strip;\n use rustc_session::config::{build_configuration, build_session_options, to_crate_config};\n-use rustc_session::config::{rustc_optgroups, ErrorOutputType, ExternLocation, Options, Passes};\n+use rustc_session::config::{\n+    rustc_optgroups, ErrorOutputType, ExternLocation, LocationDetail, Options, Passes,\n+};\n use rustc_session::config::{CFGuard, ExternEntry, LinkerPluginLto, LtoCli, SwitchWithOptPath};\n use rustc_session::config::{\n     Externs, OutputType, OutputTypes, SymbolManglingVersion, WasiExecModel,\n@@ -733,6 +735,7 @@ fn test_debugging_options_tracking_hash() {\n     tracked!(instrument_mcount, true);\n     tracked!(link_only, true);\n     tracked!(llvm_plugins, vec![String::from(\"plugin_name\")]);\n+    tracked!(location_detail, LocationDetail { file: true, line: false, column: false });\n     tracked!(merge_functions, Some(MergeFunctions::Disabled));\n     tracked!(mir_emit_retag, true);\n     tracked!(mir_opt_level, Some(4));"}, {"sha": "299dfed9d5dcea7845f2898b3cb612e1ddc96d80", "filename": "compiler/rustc_session/src/config.rs", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Fconfig.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -174,6 +174,20 @@ impl LinkerPluginLto {\n     }\n }\n \n+/// The different settings that can be enabled via the `-Z location-detail` flag.\n+#[derive(Clone, PartialEq, Hash, Debug)]\n+pub struct LocationDetail {\n+    pub file: bool,\n+    pub line: bool,\n+    pub column: bool,\n+}\n+\n+impl LocationDetail {\n+    pub fn all() -> Self {\n+        Self { file: true, line: true, column: true }\n+    }\n+}\n+\n #[derive(Clone, PartialEq, Hash, Debug)]\n pub enum SwitchWithOptPath {\n     Enabled(Option<PathBuf>),\n@@ -2422,7 +2436,7 @@ crate mod dep_tracking {\n     use super::LdImpl;\n     use super::{\n         CFGuard, CrateType, DebugInfo, ErrorOutputType, InstrumentCoverage, LinkerPluginLto,\n-        LtoCli, OptLevel, OutputType, OutputTypes, Passes, SourceFileHashAlgorithm,\n+        LocationDetail, LtoCli, OptLevel, OutputType, OutputTypes, Passes, SourceFileHashAlgorithm,\n         SwitchWithOptPath, SymbolManglingVersion, TrimmedDefPaths,\n     };\n     use crate::lint;\n@@ -2513,6 +2527,7 @@ crate mod dep_tracking {\n         Option<LdImpl>,\n         OutputType,\n         RealFileName,\n+        LocationDetail,\n     );\n \n     impl<T1, T2> DepTrackingHash for (T1, T2)"}, {"sha": "782055b9a77da2a68c5a90a24497dd06d3d7ddf5", "filename": "compiler/rustc_session/src/options.rs", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_session%2Fsrc%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Foptions.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -368,6 +368,8 @@ mod desc {\n         \"either a boolean (`yes`, `no`, `on`, `off`, etc), `thin`, `fat`, or omitted\";\n     pub const parse_linker_plugin_lto: &str =\n         \"either a boolean (`yes`, `no`, `on`, `off`, etc), or the path to the linker plugin\";\n+    pub const parse_location_detail: &str =\n+        \"comma seperated list of location details to track: `file`, `line`, or `column`\";\n     pub const parse_switch_with_opt_path: &str =\n         \"an optional path to the profiling data output directory\";\n     pub const parse_merge_functions: &str = \"one of: `disabled`, `trampolines`, or `aliases`\";\n@@ -484,6 +486,25 @@ mod parse {\n         }\n     }\n \n+    crate fn parse_location_detail(ld: &mut LocationDetail, v: Option<&str>) -> bool {\n+        if let Some(v) = v {\n+            ld.line = false;\n+            ld.file = false;\n+            ld.column = false;\n+            for s in v.split(',') {\n+                match s {\n+                    \"file\" => ld.file = true,\n+                    \"line\" => ld.line = true,\n+                    \"column\" => ld.column = true,\n+                    _ => return false,\n+                }\n+            }\n+            true\n+        } else {\n+            false\n+        }\n+    }\n+\n     crate fn parse_opt_comma_list(slot: &mut Option<Vec<String>>, v: Option<&str>) -> bool {\n         match v {\n             Some(s) => {\n@@ -1152,6 +1173,9 @@ options! {\n         \"a list LLVM plugins to enable (space separated)\"),\n     llvm_time_trace: bool = (false, parse_bool, [UNTRACKED],\n         \"generate JSON tracing data file from LLVM data (default: no)\"),\n+    location_detail: LocationDetail = (LocationDetail::all(), parse_location_detail, [TRACKED],\n+        \"comma seperated list of location details to be tracked when using caller_location \\\n+        valid options are `file`, `line`, and `column` (default: all)\"),\n     ls: bool = (false, parse_bool, [UNTRACKED],\n         \"list the symbols defined by a library crate (default: no)\"),\n     macro_backtrace: bool = (false, parse_bool, [UNTRACKED],"}, {"sha": "f7246641dca3e952f8369c034a92c80de8988265", "filename": "compiler/rustc_session/src/parse.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_session%2Fsrc%2Fparse.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_session%2Fsrc%2Fparse.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Fparse.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -174,9 +174,14 @@ impl ParseSess {\n         }\n     }\n \n-    pub fn with_silent_emitter() -> Self {\n+    pub fn with_silent_emitter(fatal_note: Option<String>) -> Self {\n         let sm = Lrc::new(SourceMap::new(FilePathMapping::empty()));\n-        let handler = Handler::with_emitter(false, None, Box::new(SilentEmitter));\n+        let fatal_handler = Handler::with_tty_emitter(ColorConfig::Auto, false, None, None);\n+        let handler = Handler::with_emitter(\n+            false,\n+            None,\n+            Box::new(SilentEmitter { fatal_handler, fatal_note }),\n+        );\n         ParseSess::with_span_handler(handler, sm)\n     }\n "}, {"sha": "476809c787f0a1c5e341f4fe4465fee940ba8557", "filename": "compiler/rustc_span/src/symbol.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_span%2Fsrc%2Fsymbol.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -1338,6 +1338,7 @@ symbols! {\n         type_alias_enum_variants,\n         type_alias_impl_trait,\n         type_ascription,\n+        type_changing_struct_update,\n         type_id,\n         type_length_limit,\n         type_macros,"}, {"sha": "73340fda2cbccc26b2a387039dabdb757a484534", "filename": "library/core/src/array/mod.rs", "status": "modified", "additions": 78, "deletions": 0, "changes": 78, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/library%2Fcore%2Fsrc%2Farray%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/library%2Fcore%2Fsrc%2Farray%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Farray%2Fmod.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -500,6 +500,84 @@ impl<T, const N: usize> [T; N] {\n         // items.\n         unsafe { collect_into_array_unchecked(&mut self.iter_mut()) }\n     }\n+\n+    /// Divides one array reference into two at an index.\n+    ///\n+    /// The first will contain all indices from `[0, M)` (excluding\n+    /// the index `M` itself) and the second will contain all\n+    /// indices from `[M, N)` (excluding the index `N` itself).\n+    ///\n+    /// # Panics\n+    ///\n+    /// Panics if `M > N`.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(split_array)]\n+    ///\n+    /// let v = [1, 2, 3, 4, 5, 6];\n+    ///\n+    /// {\n+    ///    let (left, right) = v.split_array_ref::<0>();\n+    ///    assert_eq!(left, &[]);\n+    ///    assert_eq!(right, &[1, 2, 3, 4, 5, 6]);\n+    /// }\n+    ///\n+    /// {\n+    ///     let (left, right) = v.split_array_ref::<2>();\n+    ///     assert_eq!(left, &[1, 2]);\n+    ///     assert_eq!(right, &[3, 4, 5, 6]);\n+    /// }\n+    ///\n+    /// {\n+    ///     let (left, right) = v.split_array_ref::<6>();\n+    ///     assert_eq!(left, &[1, 2, 3, 4, 5, 6]);\n+    ///     assert_eq!(right, &[]);\n+    /// }\n+    /// ```\n+    #[unstable(\n+        feature = \"split_array\",\n+        reason = \"return type should have array as 2nd element\",\n+        issue = \"90091\"\n+    )]\n+    #[inline]\n+    pub fn split_array_ref<const M: usize>(&self) -> (&[T; M], &[T]) {\n+        (&self[..]).split_array_ref::<M>()\n+    }\n+\n+    /// Divides one mutable array reference into two at an index.\n+    ///\n+    /// The first will contain all indices from `[0, M)` (excluding\n+    /// the index `M` itself) and the second will contain all\n+    /// indices from `[M, N)` (excluding the index `N` itself).\n+    ///\n+    /// # Panics\n+    ///\n+    /// Panics if `M > N`.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(split_array)]\n+    ///\n+    /// let mut v = [1, 0, 3, 0, 5, 6];\n+    /// let (left, right) = v.split_array_mut::<2>();\n+    /// assert_eq!(left, &mut [1, 0][..]);\n+    /// assert_eq!(right, &mut [3, 0, 5, 6]);\n+    /// left[1] = 2;\n+    /// right[1] = 4;\n+    /// assert_eq!(v, [1, 2, 3, 4, 5, 6]);\n+    /// ```\n+    #[unstable(\n+        feature = \"split_array\",\n+        reason = \"return type should have array as 2nd element\",\n+        issue = \"90091\"\n+    )]\n+    #[inline]\n+    pub fn split_array_mut<const M: usize>(&mut self) -> (&mut [T; M], &mut [T]) {\n+        (&mut self[..]).split_array_mut::<M>()\n+    }\n }\n \n /// Pulls `N` items from `iter` and returns them as an array. If the iterator"}, {"sha": "07ecae7830351eac72860ea614923af9ab9d8ec1", "filename": "library/core/src/slice/iter.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/library%2Fcore%2Fsrc%2Fslice%2Fiter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/library%2Fcore%2Fsrc%2Fslice%2Fiter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fslice%2Fiter.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -839,7 +839,6 @@ impl<T, P> FusedIterator for SplitInclusiveMut<'_, T, P> where P: FnMut(&T) -> b\n /// [`rsplit`]: slice::rsplit\n /// [slices]: slice\n #[stable(feature = \"slice_rsplit\", since = \"1.27.0\")]\n-#[derive(Clone)] // Is this correct, or does it incorrectly require `T: Clone`?\n pub struct RSplit<'a, T: 'a, P>\n where\n     P: FnMut(&T) -> bool,\n@@ -867,6 +866,17 @@ where\n     }\n }\n \n+// FIXME(#26925) Remove in favor of `#[derive(Clone)]`\n+#[stable(feature = \"slice_rsplit\", since = \"1.27.0\")]\n+impl<T, P> Clone for RSplit<'_, T, P>\n+where\n+    P: Clone + FnMut(&T) -> bool,\n+{\n+    fn clone(&self) -> Self {\n+        RSplit { inner: self.inner.clone() }\n+    }\n+}\n+\n #[stable(feature = \"slice_rsplit\", since = \"1.27.0\")]\n impl<'a, T, P> Iterator for RSplit<'a, T, P>\n where"}, {"sha": "aaa00653b99c274cc6fda272fe74402d3143bfaa", "filename": "library/core/src/slice/mod.rs", "status": "modified", "additions": 74, "deletions": 0, "changes": 74, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/library%2Fcore%2Fsrc%2Fslice%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/library%2Fcore%2Fsrc%2Fslice%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fslice%2Fmod.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -1665,6 +1665,80 @@ impl<T> [T] {\n         unsafe { (from_raw_parts_mut(ptr, mid), from_raw_parts_mut(ptr.add(mid), len - mid)) }\n     }\n \n+    /// Divides one slice into an array and a remainder slice at an index.\n+    ///\n+    /// The array will contain all indices from `[0, N)` (excluding\n+    /// the index `N` itself) and the slice will contain all\n+    /// indices from `[N, len)` (excluding the index `len` itself).\n+    ///\n+    /// # Panics\n+    ///\n+    /// Panics if `N > len`.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(split_array)]\n+    ///\n+    /// let v = &[1, 2, 3, 4, 5, 6][..];\n+    ///\n+    /// {\n+    ///    let (left, right) = v.split_array_ref::<0>();\n+    ///    assert_eq!(left, &[]);\n+    ///    assert_eq!(right, [1, 2, 3, 4, 5, 6]);\n+    /// }\n+    ///\n+    /// {\n+    ///     let (left, right) = v.split_array_ref::<2>();\n+    ///     assert_eq!(left, &[1, 2]);\n+    ///     assert_eq!(right, [3, 4, 5, 6]);\n+    /// }\n+    ///\n+    /// {\n+    ///     let (left, right) = v.split_array_ref::<6>();\n+    ///     assert_eq!(left, &[1, 2, 3, 4, 5, 6]);\n+    ///     assert_eq!(right, []);\n+    /// }\n+    /// ```\n+    #[unstable(feature = \"split_array\", reason = \"new API\", issue = \"90091\")]\n+    #[inline]\n+    pub fn split_array_ref<const N: usize>(&self) -> (&[T; N], &[T]) {\n+        let (a, b) = self.split_at(N);\n+        // SAFETY: a points to [T; N]? Yes it's [T] of length N (checked by split_at)\n+        unsafe { (&*(a.as_ptr() as *const [T; N]), b) }\n+    }\n+\n+    /// Divides one mutable slice into an array and a remainder slice at an index.\n+    ///\n+    /// The array will contain all indices from `[0, N)` (excluding\n+    /// the index `N` itself) and the slice will contain all\n+    /// indices from `[N, len)` (excluding the index `len` itself).\n+    ///\n+    /// # Panics\n+    ///\n+    /// Panics if `N > len`.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(split_array)]\n+    ///\n+    /// let mut v = &mut [1, 0, 3, 0, 5, 6][..];\n+    /// let (left, right) = v.split_array_mut::<2>();\n+    /// assert_eq!(left, &mut [1, 0]);\n+    /// assert_eq!(right, [3, 0, 5, 6]);\n+    /// left[1] = 2;\n+    /// right[1] = 4;\n+    /// assert_eq!(v, [1, 2, 3, 4, 5, 6]);\n+    /// ```\n+    #[unstable(feature = \"split_array\", reason = \"new API\", issue = \"90091\")]\n+    #[inline]\n+    pub fn split_array_mut<const N: usize>(&mut self) -> (&mut [T; N], &mut [T]) {\n+        let (a, b) = self.split_at_mut(N);\n+        // SAFETY: a points to [T; N]? Yes it's [T] of length N (checked by split_at_mut)\n+        unsafe { (&mut *(a.as_mut_ptr() as *mut [T; N]), b) }\n+    }\n+\n     /// Returns an iterator over subslices separated by elements that match\n     /// `pred`. The matched element is not contained in the subslices.\n     ///"}, {"sha": "1d4307ca0fbda2bc54484822c0a2ce5ba9ad81d7", "filename": "library/core/tests/array.rs", "status": "modified", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/library%2Fcore%2Ftests%2Farray.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/library%2Fcore%2Ftests%2Farray.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Farray.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -436,3 +436,36 @@ where\n     std::panic::set_hook(prev_hook);\n     result\n }\n+\n+#[test]\n+fn array_split_array_mut() {\n+    let mut v = [1, 2, 3, 4, 5, 6];\n+\n+    {\n+        let (left, right) = v.split_array_mut::<0>();\n+        assert_eq!(left, &mut []);\n+        assert_eq!(right, &mut [1, 2, 3, 4, 5, 6]);\n+    }\n+\n+    {\n+        let (left, right) = v.split_array_mut::<6>();\n+        assert_eq!(left, &mut [1, 2, 3, 4, 5, 6]);\n+        assert_eq!(right, &mut []);\n+    }\n+}\n+\n+#[should_panic]\n+#[test]\n+fn array_split_array_ref_out_of_bounds() {\n+    let v = [1, 2, 3, 4, 5, 6];\n+\n+    v.split_array_ref::<7>();\n+}\n+\n+#[should_panic]\n+#[test]\n+fn array_split_array_mut_out_of_bounds() {\n+    let mut v = [1, 2, 3, 4, 5, 6];\n+\n+    v.split_array_mut::<7>();\n+}"}, {"sha": "507a79c3de1c480b2f01bdb7b8d9727d93295baa", "filename": "library/core/tests/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/library%2Fcore%2Ftests%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/library%2Fcore%2Ftests%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Flib.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -70,6 +70,7 @@\n #![feature(integer_atomics)]\n #![feature(int_roundings)]\n #![feature(slice_group_by)]\n+#![feature(split_array)]\n #![feature(trusted_random_access)]\n #![feature(unsize)]\n #![feature(unzip_option)]"}, {"sha": "7a008345243c0d6265bd254adf3313fa6431188b", "filename": "library/core/tests/slice.rs", "status": "modified", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/library%2Fcore%2Ftests%2Fslice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/library%2Fcore%2Ftests%2Fslice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Ftests%2Fslice.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -2191,3 +2191,36 @@ mod swap_panics {\n         x.swap(2, 5);\n     }\n }\n+\n+#[test]\n+fn slice_split_array_mut() {\n+    let v = &mut [1, 2, 3, 4, 5, 6][..];\n+\n+    {\n+        let (left, right) = v.split_array_mut::<0>();\n+        assert_eq!(left, &mut []);\n+        assert_eq!(right, [1, 2, 3, 4, 5, 6]);\n+    }\n+\n+    {\n+        let (left, right) = v.split_array_mut::<6>();\n+        assert_eq!(left, &mut [1, 2, 3, 4, 5, 6]);\n+        assert_eq!(right, []);\n+    }\n+}\n+\n+#[should_panic]\n+#[test]\n+fn slice_split_array_ref_out_of_bounds() {\n+    let v = &[1, 2, 3, 4, 5, 6][..];\n+\n+    v.split_array_ref::<7>();\n+}\n+\n+#[should_panic]\n+#[test]\n+fn slice_split_array_mut_out_of_bounds() {\n+    let v = &mut [1, 2, 3, 4, 5, 6][..];\n+\n+    v.split_array_mut::<7>();\n+}"}, {"sha": "9b94615d24773b002c31129dfccaa51b78a31574", "filename": "library/std/src/os/unix/process.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/library%2Fstd%2Fsrc%2Fos%2Funix%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/library%2Fstd%2Fsrc%2Fos%2Funix%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fos%2Funix%2Fprocess.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -239,27 +239,27 @@ pub trait ExitStatusExt: Sealed {\n     fn signal(&self) -> Option<i32>;\n \n     /// If the process was terminated by a signal, says whether it dumped core.\n-    #[unstable(feature = \"unix_process_wait_more\", issue = \"80695\")]\n+    #[stable(feature = \"unix_process_wait_more\", since = \"1.58.0\")]\n     fn core_dumped(&self) -> bool;\n \n     /// If the process was stopped by a signal, returns that signal.\n     ///\n     /// In other words, if `WIFSTOPPED`, this returns `WSTOPSIG`.  This is only possible if the status came from\n     /// a `wait` system call which was passed `WUNTRACED`, and was then converted into an `ExitStatus`.\n-    #[unstable(feature = \"unix_process_wait_more\", issue = \"80695\")]\n+    #[stable(feature = \"unix_process_wait_more\", since = \"1.58.0\")]\n     fn stopped_signal(&self) -> Option<i32>;\n \n     /// Whether the process was continued from a stopped status.\n     ///\n     /// Ie, `WIFCONTINUED`.  This is only possible if the status came from a `wait` system call\n     /// which was passed `WCONTINUED`, and was then converted into an `ExitStatus`.\n-    #[unstable(feature = \"unix_process_wait_more\", issue = \"80695\")]\n+    #[stable(feature = \"unix_process_wait_more\", since = \"1.58.0\")]\n     fn continued(&self) -> bool;\n \n     /// Returns the underlying raw `wait` status.\n     ///\n     /// The returned integer is a **wait status, not an exit status**.\n-    #[unstable(feature = \"unix_process_wait_more\", issue = \"80695\")]\n+    #[stable(feature = \"unix_process_wait_more\", since = \"1.58.0\")]\n     fn into_raw(self) -> i32;\n }\n "}, {"sha": "b5209aa690b4c6837a36ac5eb7c569361059c877", "filename": "library/std/src/sys/windows/os.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fos.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fos.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fos.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -281,6 +281,10 @@ pub fn temp_dir() -> PathBuf {\n #[cfg(not(target_vendor = \"uwp\"))]\n fn home_dir_crt() -> Option<PathBuf> {\n     unsafe {\n+        // The magic constant -4 can be used as the token passed to GetUserProfileDirectoryW below\n+        // instead of us having to go through these multiple steps to get a token. However this is\n+        // not implemented on Windows 7, only Windows 8 and up. When we drop support for Windows 7\n+        // we can simplify this code. See #90144 for details.\n         use crate::sys::handle::Handle;\n \n         let me = c::GetCurrentProcess();"}, {"sha": "b1dacf79d269598d593a3429f567c49b471e549c", "filename": "src/ci/docker/run.sh", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Fci%2Fdocker%2Frun.sh", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Fci%2Fdocker%2Frun.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Frun.sh?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -70,8 +70,13 @@ if [ -f \"$docker_dir/$image/Dockerfile\" ]; then\n       echo \"Attempting to download $url\"\n       rm -f /tmp/rustci_docker_cache\n       set +e\n-      retry curl -y 30 -Y 10 --connect-timeout 30 -f -L -C - -o /tmp/rustci_docker_cache \"$url\"\n-      loaded_images=$(docker load -i /tmp/rustci_docker_cache | sed 's/.* sha/sha/')\n+      retry curl --max-time 600 -y 30 -Y 10 --connect-timeout 30 -f -L -C - \\\n+        -o /tmp/rustci_docker_cache \"$url\"\n+      echo \"Loading images into docker\"\n+      # docker load sometimes hangs in the CI, so time out after 10 minutes with TERM,\n+      # KILL after 12 minutes\n+      loaded_images=$(/usr/bin/timeout -k 720 600 docker load -i /tmp/rustci_docker_cache \\\n+        | sed 's/.* sha/sha/')\n       set -e\n       echo \"Downloaded containers:\\n$loaded_images\"\n     fi"}, {"sha": "08d937cc28200fc266785d350720c229ff72f2ed", "filename": "src/doc/unstable-book/src/compiler-flags/location-detail.md", "status": "added", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Flocation-detail.md", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Flocation-detail.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Flocation-detail.md?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,43 @@\n+# `location-detail`\n+\n+The tracking issue for this feature is: [#70580](https://github.com/rust-lang/rust/issues/70580).\n+\n+------------------------\n+\n+Option `-Z location-detail=val` controls what location details are tracked when\n+using `caller_location`. This allows users to control what location details\n+are printed as part of panic messages, by allowing them to exclude any combination\n+of filenames, line numbers, and column numbers. This option is intended to provide\n+users with a way to mitigate the size impact of `#[track_caller]`.\n+\n+This option supports a comma separated list of location details to be included. Valid options\n+within this list are:\n+\n+- `file` - the filename of the panic will be included in the panic output\n+- `line` - the source line of the panic will be included in the panic output\n+- `column` - the source column of the panic will be included in the panic output\n+\n+Any combination of these three options are supported. If this option is not specified,\n+all three are included by default.\n+\n+An example of a panic output when using `-Z location-detail=line`:\n+```text\n+panicked at 'Process blink had a fault', <redacted>:323:0\n+```\n+\n+The code size savings from this option are two-fold. First, the `&'static str` values\n+for each path to a file containing a panic are removed from the binary. For projects\n+with deep directory structures and many files with panics, this can add up. This category\n+of savings can only be realized by excluding filenames from the panic output. Second,\n+savings can be realized by allowing multiple panics to be fused into a single panicking\n+branch. It is often the case that within a single file, multiple panics with the same\n+panic message exist -- e.g. two calls to `Option::unwrap()` in a single line, or\n+two calls to `Result::expect()` on adjacent lines. If column and line information\n+are included in the `Location` struct passed to the panic handler, these branches cannot\n+be fused, as the output is different depending on which panic occurs. However if line\n+and column information is identical for all panics, these branches can be fused, which\n+can lead to substantial code size savings, especially for small embedded binaries with\n+many panics.\n+\n+The savings from this option are amplified when combined with the use of `-Zbuild-std`, as\n+otherwise paths for panics within the standard library are still included in your binary."}, {"sha": "149142f63ae1441498636353001f86496f23b2cc", "filename": "src/test/ui/conditional-compilation/cfg-arg-invalid-7.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fconditional-compilation%2Fcfg-arg-invalid-7.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fconditional-compilation%2Fcfg-arg-invalid-7.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconditional-compilation%2Fcfg-arg-invalid-7.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,5 @@\n+// Regression test for issue #89358.\n+\n+// compile-flags: --cfg a\"\n+// error-pattern: unterminated double quote string\n+// error-pattern: this error occurred on the command line"}, {"sha": "919709c847019e9eeabd96d0852245ddb4d1fc04", "filename": "src/test/ui/conditional-compilation/cfg-arg-invalid-7.stderr", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fconditional-compilation%2Fcfg-arg-invalid-7.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fconditional-compilation%2Fcfg-arg-invalid-7.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconditional-compilation%2Fcfg-arg-invalid-7.stderr?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,4 @@\n+error[E0765]: unterminated double quote string\n+  |\n+  = note: this error occurred on the command line: `--cfg=a\"`\n+"}, {"sha": "520c1478f323481c3ce4e8985b5bd860526669e1", "filename": "src/test/ui/feature-gates/feature-gate-type_changing_struct_update.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-type_changing_struct_update.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-type_changing_struct_update.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-type_changing_struct_update.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,26 @@\n+#[derive(Debug)]\n+struct Machine<S> {\n+    state: S,\n+    common_field1: &'static str,\n+    common_field2: i32,\n+}\n+#[derive(Debug)]\n+struct State1;\n+#[derive(Debug, PartialEq)]\n+struct State2;\n+\n+fn update_to_state2() {\n+    let m1: Machine<State1> = Machine {\n+        state: State1,\n+        common_field1: \"hello\",\n+        common_field2: 2,\n+    };\n+    let m2: Machine<State2> = Machine {\n+        state: State2,\n+        ..m1 //~ ERROR mismatched types\n+    };\n+    // FIXME: this should trigger feature gate\n+    assert_eq!(State2, m2.state);\n+}\n+\n+fn main() {}"}, {"sha": "9934fe6816430e4d64403efe9459f14a291575ce", "filename": "src/test/ui/feature-gates/feature-gate-type_changing_struct_update.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-type_changing_struct_update.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-type_changing_struct_update.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ffeature-gates%2Ffeature-gate-type_changing_struct_update.stderr?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,12 @@\n+error[E0308]: mismatched types\n+  --> $DIR/feature-gate-type_changing_struct_update.rs:20:11\n+   |\n+LL |         ..m1\n+   |           ^^ expected struct `State2`, found struct `State1`\n+   |\n+   = note: expected struct `Machine<State2>`\n+              found struct `Machine<State1>`\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0308`."}, {"sha": "0546b6b51b27342f71de3f2bbf09ef055d7f4c0b", "filename": "src/test/ui/in-band-lifetimes/mismatched_trait_impl-2.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fin-band-lifetimes%2Fmismatched_trait_impl-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fin-band-lifetimes%2Fmismatched_trait_impl-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fin-band-lifetimes%2Fmismatched_trait_impl-2.stderr?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -2,15 +2,15 @@ error: `impl` item signature doesn't match `trait` item signature\n   --> $DIR/mismatched_trait_impl-2.rs:8:5\n    |\n LL |     fn deref(&self) -> &dyn Trait {\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found `fn(&Struct) -> &dyn Trait`\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found `fn(&'1 Struct) -> &'1 (dyn Trait + '1)`\n    |\n   ::: $SRC_DIR/core/src/ops/deref.rs:LL:COL\n    |\n LL |     fn deref(&self) -> &Self::Target;\n-   |     --------------------------------- expected `fn(&Struct) -> &(dyn Trait + 'static)`\n+   |     --------------------------------- expected `fn(&'1 Struct) -> &'1 (dyn Trait + 'static)`\n    |\n-   = note: expected `fn(&Struct) -> &(dyn Trait + 'static)`\n-              found `fn(&Struct) -> &dyn Trait`\n+   = note: expected `fn(&'1 Struct) -> &'1 (dyn Trait + 'static)`\n+              found `fn(&'1 Struct) -> &'1 (dyn Trait + '1)`\n    = help: the lifetime requirements from the `impl` do not correspond to the requirements in the `trait`\n    = help: verify the lifetime relationships in the `trait` and `impl` between the `self` argument, the other inputs and its output\n "}, {"sha": "c7a90c57add836b83d5f75a39b565a2693c58521", "filename": "src/test/ui/in-band-lifetimes/mismatched_trait_impl.nll.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fin-band-lifetimes%2Fmismatched_trait_impl.nll.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fin-band-lifetimes%2Fmismatched_trait_impl.nll.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fin-band-lifetimes%2Fmismatched_trait_impl.nll.stderr?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -2,13 +2,13 @@ error: `impl` item signature doesn't match `trait` item signature\n   --> $DIR/mismatched_trait_impl.rs:9:5\n    |\n LL |     fn foo(&self, x: &'a u32, y: &u32) -> &'a u32;\n-   |     ---------------------------------------------- expected `fn(&i32, &'a u32, &u32) -> &'a u32`\n+   |     ---------------------------------------------- expected `fn(&'1 i32, &'a u32, &'2 u32) -> &'a u32`\n ...\n LL |     fn foo(&self, x: &u32, y: &'a u32) -> &'a u32 {\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found `fn(&i32, &u32, &u32) -> &u32`\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found `fn(&'1 i32, &'2 u32, &'3 u32) -> &'3 u32`\n    |\n-   = note: expected `fn(&i32, &'a u32, &u32) -> &'a u32`\n-              found `fn(&i32, &u32, &u32) -> &u32`\n+   = note: expected `fn(&'1 i32, &'a u32, &'2 u32) -> &'a u32`\n+              found `fn(&'1 i32, &'2 u32, &'3 u32) -> &'3 u32`\n    = help: the lifetime requirements from the `impl` do not correspond to the requirements in the `trait`\n    = help: verify the lifetime relationships in the `trait` and `impl` between the `self` argument, the other inputs and its output\n "}, {"sha": "84e5339122ead338eee30d7ad1e85c932e43d22f", "filename": "src/test/ui/in-band-lifetimes/mismatched_trait_impl.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fin-band-lifetimes%2Fmismatched_trait_impl.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fin-band-lifetimes%2Fmismatched_trait_impl.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fin-band-lifetimes%2Fmismatched_trait_impl.stderr?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -2,13 +2,13 @@ error: `impl` item signature doesn't match `trait` item signature\n   --> $DIR/mismatched_trait_impl.rs:9:5\n    |\n LL |     fn foo(&self, x: &'a u32, y: &u32) -> &'a u32;\n-   |     ---------------------------------------------- expected `fn(&i32, &'a u32, &u32) -> &'a u32`\n+   |     ---------------------------------------------- expected `fn(&'1 i32, &'a u32, &'2 u32) -> &'a u32`\n ...\n LL |     fn foo(&self, x: &u32, y: &'a u32) -> &'a u32 {\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found `fn(&i32, &u32, &u32) -> &u32`\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found `fn(&'1 i32, &'2 u32, &'3 u32) -> &'3 u32`\n    |\n-   = note: expected `fn(&i32, &'a u32, &u32) -> &'a u32`\n-              found `fn(&i32, &u32, &u32) -> &u32`\n+   = note: expected `fn(&'1 i32, &'a u32, &'2 u32) -> &'a u32`\n+              found `fn(&'1 i32, &'2 u32, &'3 u32) -> &'3 u32`\n    = help: the lifetime requirements from the `impl` do not correspond to the requirements in the `trait`\n    = help: verify the lifetime relationships in the `trait` and `impl` between the `self` argument, the other inputs and its output\n "}, {"sha": "911da742957220f52c25c95a7a3abe3f42ac40f6", "filename": "src/test/ui/iterators/rsplit-clone.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fiterators%2Frsplit-clone.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fiterators%2Frsplit-clone.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fiterators%2Frsplit-clone.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,11 @@\n+// check-pass\n+\n+// RSplit<T, P> previously required T: Clone in order to be Clone\n+\n+struct NotClone;\n+\n+fn main() {\n+    let elements = [NotClone, NotClone, NotClone];\n+    let rsplit = elements.rsplit(|_| false);\n+    rsplit.clone();\n+}"}, {"sha": "3040a8512ce1d9b9fbf050796590fb78de9b45d8", "filename": "src/test/ui/lifetimes/lifetime-mismatch-between-trait-and-impl.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Flifetimes%2Flifetime-mismatch-between-trait-and-impl.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Flifetimes%2Flifetime-mismatch-between-trait-and-impl.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Flifetimes%2Flifetime-mismatch-between-trait-and-impl.stderr?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -2,13 +2,13 @@ error: `impl` item signature doesn't match `trait` item signature\n   --> $DIR/lifetime-mismatch-between-trait-and-impl.rs:6:5\n    |\n LL |     fn foo<'a>(x: &i32, y: &'a i32) -> &'a i32;\n-   |     ------------------------------------------- expected `fn(&i32, &'a i32) -> &'a i32`\n+   |     ------------------------------------------- expected `fn(&'1 i32, &'a i32) -> &'a i32`\n ...\n LL |     fn foo<'a>(x: &'a i32, y: &'a i32) -> &'a i32 {\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found `fn(&i32, &i32) -> &i32`\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found `fn(&'1 i32, &'1 i32) -> &'1 i32`\n    |\n-   = note: expected `fn(&i32, &'a i32) -> &'a i32`\n-              found `fn(&i32, &i32) -> &i32`\n+   = note: expected `fn(&'1 i32, &'a i32) -> &'a i32`\n+              found `fn(&'1 i32, &'1 i32) -> &'1 i32`\n    = help: the lifetime requirements from the `impl` do not correspond to the requirements in the `trait`\n    = help: verify the lifetime relationships in the `trait` and `impl` between the `self` argument, the other inputs and its output\n "}, {"sha": "2a2c23c94212f17f434c0e287e70c28ee2f845f2", "filename": "src/test/ui/mismatched_types/issue-75361-mismatched-impl.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fmismatched_types%2Fissue-75361-mismatched-impl.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fmismatched_types%2Fissue-75361-mismatched-impl.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fmismatched_types%2Fissue-75361-mismatched-impl.stderr?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -2,13 +2,13 @@ error: `impl` item signature doesn't match `trait` item signature\n   --> $DIR/issue-75361-mismatched-impl.rs:18:3\n    |\n LL |   fn adjacent_edges(&self) -> Box<dyn MyTrait<Item = &Self::EdgeType>>;\n-   |   --------------------------------------------------------------------- expected `fn(&T) -> Box<(dyn MyTrait<Item = &T> + 'static)>`\n+   |   --------------------------------------------------------------------- expected `fn(&'1 T) -> Box<(dyn MyTrait<Item = &'1 T> + 'static)>`\n ...\n LL |   fn adjacent_edges(&self) -> Box<dyn MyTrait<Item = &Self::EdgeType> + '_> {\n-   |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found `fn(&T) -> Box<dyn MyTrait<Item = &T>>`\n+   |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found `fn(&'1 T) -> Box<(dyn MyTrait<Item = &'1 T> + '1)>`\n    |\n-   = note: expected `fn(&T) -> Box<(dyn MyTrait<Item = &T> + 'static)>`\n-              found `fn(&T) -> Box<dyn MyTrait<Item = &T>>`\n+   = note: expected `fn(&'1 T) -> Box<(dyn MyTrait<Item = &'1 T> + 'static)>`\n+              found `fn(&'1 T) -> Box<(dyn MyTrait<Item = &'1 T> + '1)>`\n help: the lifetime requirements from the `impl` do not correspond to the requirements in the `trait`\n   --> $DIR/issue-75361-mismatched-impl.rs:12:55\n    |"}, {"sha": "673e638ca0d6beb2e750c9a256789388a6010b0b", "filename": "src/test/ui/panics/location-detail-panic-no-column.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-column.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-column.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-column.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,7 @@\n+// run-fail\n+// check-run-results\n+// compile-flags: -Zlocation-detail=line,file\n+\n+fn main() {\n+    panic!(\"column-redacted\");\n+}"}, {"sha": "9f35623fba392b39e3d4abd1c11a507f5612529d", "filename": "src/test/ui/panics/location-detail-panic-no-column.run.stderr", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-column.run.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-column.run.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-column.run.stderr?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,2 @@\n+thread 'main' panicked at 'column-redacted', $DIR/location-detail-panic-no-column.rs:6:0\n+note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace"}, {"sha": "0e5d52cfd1534c356d8e8e69c994212d0b98b651", "filename": "src/test/ui/panics/location-detail-panic-no-file.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-file.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-file.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-file.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,7 @@\n+// run-fail\n+// check-run-results\n+// compile-flags: -Zlocation-detail=line,column\n+\n+fn main() {\n+    panic!(\"file-redacted\");\n+}"}, {"sha": "1e07e3a07afd5ba8dbf403b5ba7f4170c2aadc63", "filename": "src/test/ui/panics/location-detail-panic-no-file.run.stderr", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-file.run.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-file.run.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-file.run.stderr?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,2 @@\n+thread 'main' panicked at 'file-redacted', <redacted>:6:5\n+note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace"}, {"sha": "57f6d0ebcb9fac09f38a18bdc855924a9393bf8c", "filename": "src/test/ui/panics/location-detail-panic-no-line.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-line.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-line.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-line.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,7 @@\n+// run-fail\n+// check-run-results\n+// compile-flags: -Zlocation-detail=file,column\n+\n+fn main() {\n+    panic!(\"line-redacted\");\n+}"}, {"sha": "cc3f1624c49abdab8d5c0c5e5e954034099ce257", "filename": "src/test/ui/panics/location-detail-panic-no-line.run.stderr", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-line.run.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-line.run.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-panic-no-line.run.stderr?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,2 @@\n+thread 'main' panicked at 'line-redacted', $DIR/location-detail-panic-no-line.rs:0:5\n+note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace"}, {"sha": "d7f96f058e082edd95b0cb5f78ce14fc2ef6ed7a", "filename": "src/test/ui/panics/location-detail-unwrap-no-file.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-unwrap-no-file.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-unwrap-no-file.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-unwrap-no-file.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,8 @@\n+// run-fail\n+// check-run-results\n+// compile-flags: -Zlocation-detail=line,column\n+\n+fn main() {\n+    let opt: Option<u32> = None;\n+    opt.unwrap();\n+}"}, {"sha": "f8f84b5c49a22a03b90bd1f53fc39918f90ec913", "filename": "src/test/ui/panics/location-detail-unwrap-no-file.run.stderr", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-unwrap-no-file.run.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-unwrap-no-file.run.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpanics%2Flocation-detail-unwrap-no-file.run.stderr?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,2 @@\n+thread 'main' panicked at 'called `Option::unwrap()` on a `None` value', <redacted>:7:9\n+note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace"}, {"sha": "118b2cf3ecd857a2a3f6d5a43c5cc182927345a6", "filename": "src/test/ui/traits/param-without-lifetime-constraint.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Ftraits%2Fparam-without-lifetime-constraint.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Ftraits%2Fparam-without-lifetime-constraint.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fparam-without-lifetime-constraint.stderr?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -2,13 +2,13 @@ error: `impl` item signature doesn't match `trait` item signature\n   --> $DIR/param-without-lifetime-constraint.rs:14:5\n    |\n LL |     fn get_relation(&self) -> To;\n-   |     ----------------------------- expected `fn(&Article) -> &ProofReader`\n+   |     ----------------------------- expected `fn(&'1 Article) -> &'2 ProofReader`\n ...\n LL |     fn get_relation(&self) -> &ProofReader {\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found `fn(&Article) -> &ProofReader`\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found `fn(&'1 Article) -> &'1 ProofReader`\n    |\n-   = note: expected `fn(&Article) -> &ProofReader`\n-              found `fn(&Article) -> &ProofReader`\n+   = note: expected `fn(&'1 Article) -> &'2 ProofReader`\n+              found `fn(&'1 Article) -> &'1 ProofReader`\n help: the lifetime requirements from the `impl` do not correspond to the requirements in the `trait`\n   --> $DIR/param-without-lifetime-constraint.rs:10:31\n    |"}, {"sha": "85fada3b87c38a6cb8a50d18d6659f97c32d12ed", "filename": "src/test/ui/traits/self-without-lifetime-constraint.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Ftraits%2Fself-without-lifetime-constraint.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftest%2Fui%2Ftraits%2Fself-without-lifetime-constraint.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftraits%2Fself-without-lifetime-constraint.stderr?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -2,13 +2,13 @@ error: `impl` item signature doesn't match `trait` item signature\n   --> $DIR/self-without-lifetime-constraint.rs:45:5\n    |\n LL |     fn column_result(value: ValueRef<'_>) -> FromSqlResult<Self, &Self>;\n-   |     -------------------------------------------------------------------- expected `fn(ValueRef<'_>) -> Result<(&str, &&str), FromSqlError>`\n+   |     -------------------------------------------------------------------- expected `fn(ValueRef<'1>) -> Result<(&'2 str, &'1 &'2 str), FromSqlError>`\n ...\n LL |     fn column_result(value: ValueRef<'_>) -> FromSqlResult<&str, &&str> {\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found `fn(ValueRef<'_>) -> Result<(&str, &&str), FromSqlError>`\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found `fn(ValueRef<'1>) -> Result<(&'1 str, &'1 &'1 str), FromSqlError>`\n    |\n-   = note: expected `fn(ValueRef<'_>) -> Result<(&str, &&str), _>`\n-              found `fn(ValueRef<'_>) -> Result<(&str, &&str), _>`\n+   = note: expected `fn(ValueRef<'1>) -> Result<(&'2 str, &'1 &'2 str), FromSqlError>`\n+              found `fn(ValueRef<'1>) -> Result<(&'1 str, &'1 &'1 str), FromSqlError>`\n help: the lifetime requirements from the `impl` do not correspond to the requirements in the `trait`\n   --> $DIR/self-without-lifetime-constraint.rs:41:60\n    |"}, {"sha": "82fe790a576ab04c8fccc84af8bb1ebc1c1fcdb1", "filename": "src/tools/compiletest/src/common.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fcommon.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -349,6 +349,9 @@ pub struct Config {\n     /// The current Rust channel\n     pub channel: String,\n \n+    /// The default Rust edition\n+    pub edition: Option<String>,\n+\n     // Configuration for various run-make tests frobbing things like C compilers\n     // or querying about various LLVM component information.\n     pub cc: String,"}, {"sha": "98d1ee19f69a1ca8bdfb88a533d2d6c41eb5a34b", "filename": "src/tools/compiletest/src/header.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fheader.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -222,6 +222,7 @@ impl TestProps {\n     /// `//[foo]`), then the property is ignored unless `cfg` is\n     /// `Some(\"foo\")`.\n     fn load_from(&mut self, testfile: &Path, cfg: Option<&str>, config: &Config) {\n+        let mut has_edition = false;\n         if !testfile.is_dir() {\n             let file = File::open(testfile).unwrap();\n \n@@ -240,6 +241,7 @@ impl TestProps {\n \n                 if let Some(edition) = config.parse_edition(ln) {\n                     self.compile_flags.push(format!(\"--edition={}\", edition));\n+                    has_edition = true;\n                     if edition == \"2021\" {\n                         self.compile_flags.push(\"-Zunstable-options\".to_string());\n                     }\n@@ -391,6 +393,10 @@ impl TestProps {\n                 }\n             }\n         }\n+\n+        if let (Some(edition), false) = (&config.edition, has_edition) {\n+            self.compile_flags.push(format!(\"--edition={}\", edition));\n+        }\n     }\n \n     fn update_fail_mode(&mut self, ln: &str, config: &Config) {"}, {"sha": "58cde108b33221987b025fd0e5dcae64f8c5e8ff", "filename": "src/tools/compiletest/src/main.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -147,7 +147,8 @@ pub fn parse_config(args: Vec<String>) -> Config {\n         )\n         .optflag(\"\", \"force-rerun\", \"rerun tests even if the inputs are unchanged\")\n         .optflag(\"h\", \"help\", \"show this message\")\n-        .reqopt(\"\", \"channel\", \"current Rust channel\", \"CHANNEL\");\n+        .reqopt(\"\", \"channel\", \"current Rust channel\", \"CHANNEL\")\n+        .optopt(\"\", \"edition\", \"default Rust edition\", \"EDITION\");\n \n     let (argv0, args_) = args.split_first().unwrap();\n     if args.len() == 1 || args[1] == \"-h\" || args[1] == \"--help\" {\n@@ -282,6 +283,7 @@ pub fn parse_config(args: Vec<String>) -> Config {\n         rustfix_coverage: matches.opt_present(\"rustfix-coverage\"),\n         has_tidy,\n         channel: matches.opt_str(\"channel\").unwrap(),\n+        edition: matches.opt_str(\"edition\"),\n \n         cc: matches.opt_str(\"cc\").unwrap(),\n         cxx: matches.opt_str(\"cxx\").unwrap(),"}, {"sha": "f4dd394445301c165bc285166a12974c44381931", "filename": "src/tools/rustfmt/.github/workflows/upload-assets.yml", "status": "modified", "additions": 15, "deletions": 14, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2F.github%2Fworkflows%2Fupload-assets.yml", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2F.github%2Fworkflows%2Fupload-assets.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2F.github%2Fworkflows%2Fupload-assets.yml?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -1,8 +1,10 @@\n name: upload\n \n on:\n+  push:\n   release:\n     types: [created]\n+  workflow_dispatch:\n \n jobs:\n   build-release:\n@@ -14,42 +16,40 @@ jobs:\n           - build: linux-x86_64\n             os: ubuntu-latest\n             rust: nightly\n+            target: x86_64-unknown-linux-gnu\n           - build: macos-x86_64\n             os: macos-latest\n             rust: nightly\n+            target: x86_64-apple-darwin\n           - build: windows-x86_64-gnu\n             os: windows-latest\n             rust: nightly-x86_64-gnu\n+            target: x86_64-pc-windows-gnu\n           - build: windows-x86_64-msvc\n             os: windows-latest\n             rust: nightly-x86_64-msvc\n+            target: x86_64-pc-windows-msvc\n     runs-on: ${{ matrix.os }}\n     steps:\n       - uses: actions/checkout@v2\n \n-      - name: Install Rust\n-        uses: actions-rs/toolchain@v1\n-        with:\n-          profile: minimal\n-          toolchain: ${{ matrix.rust }}\n-          override: true\n+        # Run build\n+      - name: install rustup\n+        run: |\n+          curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs > rustup-init.sh\n+          sh rustup-init.sh -y --default-toolchain none\n+          rustup target add ${{ matrix.target }}\n \n       - name: Add mingw64 to path for x86_64-gnu\n         run: echo \"C:\\msys64\\mingw64\\bin\" >> $GITHUB_PATH\n         if: matrix.rust == 'nightly-x86_64-gnu'\n         shell: bash\n \n-      - name: Install cargo-make\n-        uses: actions-rs/cargo@v1\n-        with:\n-          command: install\n-          args: --force cargo-make\n-\n       - name: Build release binaries\n         uses: actions-rs/cargo@v1\n         with:\n-          command: make\n-          args: release\n+          command: build\n+          args: --release\n \n       - name: Build archive\n         shell: bash\n@@ -70,6 +70,7 @@ jobs:\n           fi\n \n       - name: Upload Release Asset\n+        if: github.event_name == 'release'\n         uses: actions/upload-release-asset@v1\n         env:\n           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}"}, {"sha": "c05e8d4896ac707d2c23b24d12eda006355a01be", "filename": "src/tools/rustfmt/.github/workflows/windows.yml", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2F.github%2Fworkflows%2Fwindows.yml", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2F.github%2Fworkflows%2Fwindows.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2F.github%2Fworkflows%2Fwindows.yml?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -54,9 +54,6 @@ jobs:\n       if: matrix.target == 'x86_64-pc-windows-gnu' && matrix.channel == 'nightly'\n       shell: bash\n \n-    - name: cargo-make\n-      run: cargo install --force cargo-make\n-\n     - name: build\n       run: |\n         rustc -Vv"}, {"sha": "71cf88f79e67b674ecf7abc54035fabaa4c84539", "filename": "src/tools/rustfmt/.gitignore", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2F.gitignore", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2F.gitignore", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2F.gitignore?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -5,6 +5,7 @@\n # Generated by Cargo\n # will have compiled files and executables\n /target\n+tests/cargo-fmt/**/target\n \n # Remove Cargo.lock from gitignore if creating an executable, leave it for libraries\n # More information here http://doc.crates.io/guide.html#cargotoml-vs-cargolock"}, {"sha": "b59438dc4fe78a11483f61b2c69b875a006c2f16", "filename": "src/tools/rustfmt/CHANGELOG.md", "status": "modified", "additions": 67, "deletions": 0, "changes": 67, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2FCHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2FCHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2FCHANGELOG.md?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -2,6 +2,73 @@\n \n ## [Unreleased]\n \n+## [1.4.38] 2021-10-20\n+\n+### Changed\n+\n+- Switched from `rustc-ap-*` crates to `rustc_private` for consumption model of rustc internals\n+- `annotate-snippets` updated to v0.8 [PR #4762](https://github.com/rust-lang/rustfmt/pull/4762)\n+- Greatly improved the performance of `cargo fmt` in large workspaces utilizing the `--all` flag by updating to a newer version of `cargo_metadata` that leverages updated `cargo` output from v1.51+ [PR #4997](https://github.com/rust-lang/rustfmt/pull/4997)\n+- Improved formatting of long slice patterns [#4530](https://github.com/rust-lang/rustfmt/issues/4530)\n+  - **Note you must have `version = Two` in your configuration to take advantage of the new formatting**\n+- Stabilized `match_block_trailing_comma` configuration option [#3380](https://github.com/rust-lang/rustfmt/issues/3380) - [https://rust-lang.github.io/rustfmt/?version=v1.4.38&search=#match_block_trailing_comma](https://rust-lang.github.io/rustfmt/?version=v1.4.38&search=#match_block_trailing_comma)\n+- Stabilized `disable_all_formatting` configuration option [#5026](https://github.com/rust-lang/rustfmt/pull/5026) - [https://rust-lang.github.io/rustfmt/?version=v1.4.38&search=#disable_all_formatting](https://rust-lang.github.io/rustfmt/?version=v1.4.38&search=#disable_all_formatting)\n+- Various improvements to the configuration documentation website [https://rust-lang.github.io/rustfmt/?version=v1.4.38]([https://rust-lang.github.io/rustfmt/?version=v1.4.38])\n+- Addressed various clippy and rustc warnings\n+\n+\n+### Fixed\n+\n+- Resolved issue where specious whitespace would be inserted when a block style comment was terminated within string literal processing [#4312](https://github.com/rust-lang/rustfmt/issues/4312)\n+- Nested out-of-line mods are again parsed and formatted [#4874](https://github.com/rust-lang/rustfmt/issues/4874)\n+- Accepts `2021` for edition value from rustfmt command line [PR #4847](https://github.com/rust-lang/rustfmt/pull/4847)\n+- Unstable command line options are no longer displayed in `--help` text on stable [PR #4798](https://github.com/rust-lang/rustfmt/issues/4798)\n+- Stopped panicking on patterns in match arms which start with non-ascii characters [#4868](https://github.com/rust-lang/rustfmt/issues/4868)\n+- Stopped stripping defaults on const params [#4816](https://github.com/rust-lang/rustfmt/issues/4816)\n+- Fixed issue with dropped content with GAT aliases with self bounds in impls [#4911](https://github.com/rust-lang/rustfmt/issues/4911)\n+- Stopped removing generic args on associated type constraints [#4943](https://github.com/rust-lang/rustfmt/issues/4943)\n+- Stopped dropping visibility on certain trait and impl items [#4960](https://github.com/rust-lang/rustfmt/issues/4960)\n+- Fixed dropping of qualified paths in struct patterns [#4908](https://github.com/rust-lang/rustfmt/issues/4908) and [#5005](https://github.com/rust-lang/rustfmt/issues/5005)\n+- Fixed bug in line width calculation that was causing specious formatting of certain patterns [#4031](https://github.com/rust-lang/rustfmt/issues/4031)\n+  - **Note that this bug fix may cause observable formatting changes in cases where code had been formatted with prior versions of rustfmt that contained the bug**\n+- Fixed bug where rustfmt would drop parameter attributes if they were too long in certain cases [#4579](https://github.com/rust-lang/rustfmt/issues/4579)\n+- Resolved idempotency issue with extern body elements [#4963](https://github.com/rust-lang/rustfmt/issues/4963)\n+- rustfmt will now handle doc-style comments on function parameters, since they could appear with certain macro usage patterns even though it's generally invalid syntax [#4936](https://github.com/rust-lang/rustfmt/issues/4936)\n+- Fixed bug in `match_block_trailing_comma` where commas were not added to the blocks of bodies whose arm had a guard that did not fit on the same line as the pattern [#4998](https://github.com/rust-lang/rustfmt/pull/4998)\n+- Fixed bug in cases where derive attributes started with a block style comment [#4984](https://github.com/rust-lang/rustfmt/issues/4984)\n+- Fixed issue where the struct rest could be lost when `struct_field_align_threshold` was enabled [#4926](https://github.com/rust-lang/rustfmt/issues/4926)\n+- Handles cases where certain control flow type expressions have comments between patterns/keywords and the pattern ident contains the keyword [#5009](https://github.com/rust-lang/rustfmt/issues/5009)\n+- Handles tuple structs that have explicit visibilities and start with a block style comment [#5011](https://github.com/rust-lang/rustfmt/issues/5011)\n+- Handles leading line-style comments in certain types of macro calls [#4615](https://github.com/rust-lang/rustfmt/issues/4615)\n+\n+\n+### Added\n+- Granular width heuristic options made available for user control [PR #4782](https://github.com/rust-lang/rustfmt/pull/4782). This includes the following:\n+  - [`array_width`](https://rust-lang.github.io/rustfmt/?version=v1.4.38&search=#array_width)\n+  - [`attr_fn_like_width`](https://rust-lang.github.io/rustfmt/?version=v1.4.38&search=#attr_fn_like_width)\n+  - [`chain_width`](https://rust-lang.github.io/rustfmt/?version=v1.4.38&search=#chain_width)\n+  - [`fn_call_width`](https://rust-lang.github.io/rustfmt/?version=v1.4.38&search=#fn_call_width)\n+  - [`single_line_if_else_max_width`](https://rust-lang.github.io/rustfmt/?version=v1.4.38&search=#single_line_if_else_max_width)\n+  - [`struct_lit_width`](https://rust-lang.github.io/rustfmt/?version=v1.4.38&search=#struct_lit_width)\n+  - [`struct_variant_width`](https://rust-lang.github.io/rustfmt/?version=v1.4.38&search=#struct_variant_width)\n+\n+Note this hit the rustup distributions prior to the v1.4.38 release as part of an out-of-cycle updates, but is listed in this version because the feature was not in the other v1.4.37 releases. See also the `use_small_heuristics` section on the configuration site for more information\n+[https://rust-lang.github.io/rustfmt/?version=v1.4.38&search=#use_small_heuristics](https://rust-lang.github.io/rustfmt/?version=v1.4.38&search=#use_small_heuristics)\n+\n+- New `One` variant added to `imports_granularity` configuration option which can be used to reformat all imports into a single use statement [#4669](https://github.com/rust-lang/rustfmt/issues/4669)\n+- rustfmt will now skip files that are annotated with `@generated` at the top of the file [#3958](https://github.com/rust-lang/rustfmt/issues/3958)\n+- New configuration option `hex_literal_case` that allows user to control the casing utilized for hex literals [PR #4903](https://github.com/rust-lang/rustfmt/pull/4903)\n+\n+See the section on the configuration site for more information\n+https://rust-lang.github.io/rustfmt/?version=v1.4.38&search=#hex_literal_case\n+\n+- `cargo fmt` now directly supports the `--check` flag, which means it's now possible to run `cargo fmt --check` instead of the more verbose `cargo fmt -- --check` [#3888](https://github.com/rust-lang/rustfmt/issues/3888)\n+\n+### Install/Download Options\n+- **rustup (nightly)** - *pending*\n+- **GitHub Release Binaries** - [Release v1.4.38](https://github.com/rust-lang/rustfmt/releases/tag/v1.4.38)\n+- **Build from source** - [Tag v1.4.38](https://github.com/rust-lang/rustfmt/tree/v1.4.38), see instructions for how to [install rustfmt from source][install-from-source]\n+\n ## [1.4.37] 2021-04-03\n \n ### Changed"}, {"sha": "2ef83ddd1ae6c1b6e89361f47705a00304bb1c0f", "filename": "src/tools/rustfmt/Cargo.lock", "status": "modified", "additions": 93, "deletions": 279, "changes": 372, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2FCargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2FCargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2FCargo.lock?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -35,21 +35,6 @@ version = \"1.0.25\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"9267dff192e68f3399525901e709a48c1d3982c9c072fa32f2127a0cb0babf14\"\n \n-[[package]]\n-name = \"arrayref\"\n-version = \"0.3.5\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"0d382e583f07208808f6b1249e60848879ba3543f57c32277bf52d69c2f0f0ee\"\n-\n-[[package]]\n-name = \"arrayvec\"\n-version = \"0.4.12\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"cd9fd44efafa8690358b7408d253adf110036b88f55672a933f01d616ad9b1b9\"\n-dependencies = [\n- \"nodrop\",\n-]\n-\n [[package]]\n name = \"atty\"\n version = \"0.2.13\"\n@@ -62,58 +47,16 @@ dependencies = [\n \n [[package]]\n name = \"autocfg\"\n-version = \"0.1.7\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"1d49d90015b3c36167a20fe2810c5cd875ad504b39cff3d4eae7977e6b7c1cb2\"\n-\n-[[package]]\n-name = \"backtrace\"\n-version = \"0.3.40\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"924c76597f0d9ca25d762c25a4d369d51267536465dc5064bdf0eb073ed477ea\"\n-dependencies = [\n- \"backtrace-sys\",\n- \"cfg-if 0.1.10\",\n- \"libc\",\n- \"rustc-demangle\",\n-]\n-\n-[[package]]\n-name = \"backtrace-sys\"\n-version = \"0.1.32\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"5d6575f128516de27e3ce99689419835fce9643a9b215a14d2b5b685be018491\"\n-dependencies = [\n- \"cc\",\n- \"libc\",\n-]\n-\n-[[package]]\n-name = \"base64\"\n-version = \"0.10.1\"\n+version = \"1.0.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"0b25d992356d2eb0ed82172f5248873db5560c4721f564b13cb5193bda5e668e\"\n-dependencies = [\n- \"byteorder\",\n-]\n+checksum = \"cdb031dd78e28731d87d56cc8ffef4a8f36ca26c38fe2de700543e627f8a464a\"\n \n [[package]]\n name = \"bitflags\"\n version = \"1.2.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"cf1de2fe8c75bc145a2f577add951f8134889b4795d47466a54a5c846d691693\"\n \n-[[package]]\n-name = \"blake2b_simd\"\n-version = \"0.5.8\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"5850aeee1552f495dd0250014cf64b82b7c8879a89d83b33bbdace2cc4f63182\"\n-dependencies = [\n- \"arrayref\",\n- \"arrayvec\",\n- \"constant_time_eq\",\n-]\n-\n [[package]]\n name = \"bstr\"\n version = \"0.2.8\"\n@@ -125,36 +68,43 @@ dependencies = [\n \n [[package]]\n name = \"bytecount\"\n-version = \"0.6.0\"\n+version = \"0.6.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"b0017894339f586ccb943b01b9555de56770c11cda818e7e3d8bd93f4ed7f46e\"\n+checksum = \"72feb31ffc86498dacdbd0fcebb56138e7177a8cc5cea4516031d15ae85a742e\"\n dependencies = [\n- \"packed_simd\",\n+ \"packed_simd_2\",\n ]\n \n [[package]]\n-name = \"byteorder\"\n-version = \"1.3.2\"\n+name = \"camino\"\n+version = \"1.0.5\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"a7c3dd8985a7111efc5c80b44e23ecdd8c007de8ade3b96595387e812b957cf5\"\n+checksum = \"52d74260d9bf6944e2208aa46841b4b8f0d7ffc0849a06837b2f510337f86b2b\"\n+dependencies = [\n+ \"serde\",\n+]\n \n [[package]]\n-name = \"cargo_metadata\"\n-version = \"0.8.2\"\n+name = \"cargo-platform\"\n+version = \"0.1.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"700b3731fd7d357223d0000f4dbf1808401b694609035c3c411fbc0cd375c426\"\n+checksum = \"0226944a63d1bf35a3b5f948dd7c59e263db83695c9e8bffc4037de02e30f1d7\"\n dependencies = [\n- \"semver\",\n  \"serde\",\n- \"serde_derive\",\n- \"serde_json\",\n ]\n \n [[package]]\n-name = \"cc\"\n-version = \"1.0.46\"\n+name = \"cargo_metadata\"\n+version = \"0.14.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"0213d356d3c4ea2c18c40b037c3be23cd639825c18f25ee670ac7813beeef99c\"\n+checksum = \"c297bd3135f558552f99a0daa180876984ea2c4ffa7470314540dff8c654109a\"\n+dependencies = [\n+ \"camino\",\n+ \"cargo-platform\",\n+ \"semver\",\n+ \"serde\",\n+ \"serde_json\",\n+]\n \n [[package]]\n name = \"cfg-if\"\n@@ -183,48 +133,14 @@ dependencies = [\n  \"vec_map\",\n ]\n \n-[[package]]\n-name = \"cloudabi\"\n-version = \"0.0.3\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"ddfc5b9aa5d4507acaf872de71051dfd0e309860e88966e1051e462a077aac4f\"\n-dependencies = [\n- \"bitflags\",\n-]\n-\n-[[package]]\n-name = \"constant_time_eq\"\n-version = \"0.1.4\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"995a44c877f9212528ccc74b21a232f66ad69001e40ede5bcee2ac9ef2657120\"\n-\n-[[package]]\n-name = \"crossbeam-channel\"\n-version = \"0.4.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"acec9a3b0b3559f15aee4f90746c4e5e293b701c0f7d3925d24e01645267b68c\"\n-dependencies = [\n- \"crossbeam-utils 0.7.0\",\n-]\n-\n [[package]]\n name = \"crossbeam-utils\"\n-version = \"0.6.6\"\n+version = \"0.8.3\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"04973fa96e96579258a5091af6003abde64af786b860f18622b82e026cca60e6\"\n-dependencies = [\n- \"cfg-if 0.1.10\",\n- \"lazy_static\",\n-]\n-\n-[[package]]\n-name = \"crossbeam-utils\"\n-version = \"0.7.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"ce446db02cdc3165b94ae73111e570793400d0794e46125cc4056c81cbb039f4\"\n+checksum = \"e7e9d99fa91428effe99c5c6d4634cdeba32b8cf784fc428a2a687f61a952c49\"\n dependencies = [\n  \"autocfg\",\n- \"cfg-if 0.1.10\",\n+ \"cfg-if 1.0.0\",\n  \"lazy_static\",\n ]\n \n@@ -257,11 +173,10 @@ dependencies = [\n \n [[package]]\n name = \"dirs-sys\"\n-version = \"0.3.4\"\n+version = \"0.3.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"afa0b23de8fd801745c471deffa6e12d248f962c9fd4b4c33787b055599bde7b\"\n+checksum = \"03d86534ed367a67548dc68113a0f5db55432fdfbb6e6f9d77704397d95d5780\"\n dependencies = [\n- \"cfg-if 0.1.10\",\n  \"libc\",\n  \"redox_users\",\n  \"winapi\",\n@@ -275,9 +190,9 @@ checksum = \"bb1f6b1ce1c140482ea30ddd3335fc0024ac7ee112895426e0a629a6c20adfe3\"\n \n [[package]]\n name = \"env_logger\"\n-version = \"0.6.2\"\n+version = \"0.8.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"aafcde04e90a5226a6443b7aabdb016ba2f8307c847d524724bd9b346dd1a2d3\"\n+checksum = \"54532e3223c5af90a6a757c90b5c5521564b07e5e7a958681bcd2afad421cdcd\"\n dependencies = [\n  \"atty\",\n  \"humantime\",\n@@ -286,40 +201,12 @@ dependencies = [\n  \"termcolor\",\n ]\n \n-[[package]]\n-name = \"failure\"\n-version = \"0.1.6\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"f8273f13c977665c5db7eb2b99ae520952fe5ac831ae4cd09d80c4c7042b5ed9\"\n-dependencies = [\n- \"backtrace\",\n- \"failure_derive\",\n-]\n-\n-[[package]]\n-name = \"failure_derive\"\n-version = \"0.1.8\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"aa4da3c766cd7a0db8242e326e9e4e081edd567072893ed320008189715366a4\"\n-dependencies = [\n- \"proc-macro2\",\n- \"quote\",\n- \"syn\",\n- \"synstructure\",\n-]\n-\n [[package]]\n name = \"fnv\"\n version = \"1.0.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"2fad85553e09a6f881f739c29f0b00b0f01357c743266d478b68951ce23285f3\"\n \n-[[package]]\n-name = \"fuchsia-cprng\"\n-version = \"0.1.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"a06f77d526c1a601b7c4cdd98f54b5eaabffc14d5f2f0296febdc7f357c6d3ba\"\n-\n [[package]]\n name = \"getopts\"\n version = \"0.2.21\"\n@@ -329,11 +216,22 @@ dependencies = [\n  \"unicode-width\",\n ]\n \n+[[package]]\n+name = \"getrandom\"\n+version = \"0.2.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"7fcd999463524c52659517fe2cea98493cfe485d10565e7b0fb07dbba7ad2753\"\n+dependencies = [\n+ \"cfg-if 1.0.0\",\n+ \"libc\",\n+ \"wasi\",\n+]\n+\n [[package]]\n name = \"globset\"\n-version = \"0.4.4\"\n+version = \"0.4.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"925aa2cac82d8834e2b2a4415b6f6879757fb5c0928fc445ae76461a12eed8f2\"\n+checksum = \"c152169ef1e421390738366d2f796655fec62621dabbd0fd476f905934061e4a\"\n dependencies = [\n  \"aho-corasick\",\n  \"bstr\",\n@@ -353,36 +251,33 @@ dependencies = [\n \n [[package]]\n name = \"humantime\"\n-version = \"1.3.0\"\n+version = \"2.1.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"df004cfca50ef23c36850aaaa59ad52cc70d0e90243c3c7737a4dd32dc7a3c4f\"\n-dependencies = [\n- \"quick-error\",\n-]\n+checksum = \"9a3a5bfb195931eeb336b2a7b4d761daec841b97f947d34394601737a7bba5e4\"\n \n [[package]]\n name = \"ignore\"\n-version = \"0.4.11\"\n+version = \"0.4.17\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"522daefc3b69036f80c7d2990b28ff9e0471c683bad05ca258e0a01dd22c5a1e\"\n+checksum = \"b287fb45c60bb826a0dc68ff08742b9d88a2fea13d6e0c286b3172065aaf878c\"\n dependencies = [\n- \"crossbeam-channel\",\n+ \"crossbeam-utils\",\n  \"globset\",\n  \"lazy_static\",\n  \"log\",\n  \"memchr\",\n  \"regex\",\n  \"same-file\",\n- \"thread_local 1.0.1\",\n+ \"thread_local\",\n  \"walkdir\",\n  \"winapi-util\",\n ]\n \n [[package]]\n name = \"itertools\"\n-version = \"0.8.0\"\n+version = \"0.9.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"5b8467d9c1cebe26feb08c640139247fac215782d35371ade9a2136ed6085358\"\n+checksum = \"284f18f85651fe11e8a991b2adb42cb078325c996ed026d994719efcfca1d54b\"\n dependencies = [\n  \"either\",\n ]\n@@ -405,6 +300,12 @@ version = \"0.2.77\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"f2f96b10ec2560088a8e76961b00d47107b3a625fecb76dedb29ee7ccbf98235\"\n \n+[[package]]\n+name = \"libm\"\n+version = \"0.1.4\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"7fc7aa29613bd6a620df431842069224d8bc9011086b1db4c0e0cd47fa03ec9a\"\n+\n [[package]]\n name = \"log\"\n version = \"0.4.14\"\n@@ -421,18 +322,13 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"88579771288728879b57485cc7d6b07d648c9f0141eb955f8ab7f9d45394468e\"\n \n [[package]]\n-name = \"nodrop\"\n-version = \"0.1.14\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"72ef4a56884ca558e5ddb05a1d1e7e1bfd9a68d9ed024c21704cc98872dae1bb\"\n-\n-[[package]]\n-name = \"packed_simd\"\n-version = \"0.3.3\"\n+name = \"packed_simd_2\"\n+version = \"0.3.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"a85ea9fc0d4ac0deb6fe7911d38786b32fc11119afd9e9d38b84ff691ce64220\"\n+checksum = \"3278e0492f961fd4ae70909f56b2723a7e8d01a228427294e19cdfdebda89a17\"\n dependencies = [\n  \"cfg-if 0.1.10\",\n+ \"libm\",\n ]\n \n [[package]]\n@@ -463,19 +359,13 @@ dependencies = [\n \n [[package]]\n name = \"proc-macro2\"\n-version = \"1.0.6\"\n+version = \"1.0.26\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"9c9e470a8dc4aeae2dee2f335e8f533e2d4b347e1434e5671afc49b054592f27\"\n+checksum = \"a152013215dca273577e18d2bf00fa862b89b24169fb78c4c95aeb07992c9cec\"\n dependencies = [\n  \"unicode-xid\",\n ]\n \n-[[package]]\n-name = \"quick-error\"\n-version = \"1.2.2\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"9274b940887ce9addde99c4eee6b5c44cc494b182b97e73dc8ffdcb3397fd3f0\"\n-\n [[package]]\n name = \"quote\"\n version = \"1.0.6\"\n@@ -486,95 +376,41 @@ dependencies = [\n ]\n \n [[package]]\n-name = \"rand_core\"\n-version = \"0.3.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"7a6fdeb83b075e8266dcc8762c22776f6877a63111121f5f8c7411e5be7eed4b\"\n-dependencies = [\n- \"rand_core 0.4.2\",\n-]\n-\n-[[package]]\n-name = \"rand_core\"\n-version = \"0.4.2\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"9c33a3c44ca05fa6f1807d8e6743f3824e8509beca625669633be0acbdf509dc\"\n-\n-[[package]]\n-name = \"rand_os\"\n-version = \"0.1.3\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"7b75f676a1e053fc562eafbb47838d67c84801e38fc1ba459e8f180deabd5071\"\n-dependencies = [\n- \"cloudabi\",\n- \"fuchsia-cprng\",\n- \"libc\",\n- \"rand_core 0.4.2\",\n- \"rdrand\",\n- \"winapi\",\n-]\n-\n-[[package]]\n-name = \"rdrand\"\n-version = \"0.4.0\"\n+name = \"redox_syscall\"\n+version = \"0.2.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"678054eb77286b51581ba43620cc911abf02758c91f93f479767aed0f90458b2\"\n+checksum = \"05ec8ca9416c5ea37062b502703cd7fcb207736bc294f6e0cf367ac6fc234570\"\n dependencies = [\n- \"rand_core 0.3.1\",\n+ \"bitflags\",\n ]\n \n-[[package]]\n-name = \"redox_syscall\"\n-version = \"0.1.56\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"2439c63f3f6139d1b57529d16bc3b8bb855230c8efcc5d3a896c8bea7c3b1e84\"\n-\n [[package]]\n name = \"redox_users\"\n-version = \"0.3.1\"\n+version = \"0.4.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"4ecedbca3bf205f8d8f5c2b44d83cd0690e39ee84b951ed649e9f1841132b66d\"\n+checksum = \"528532f3d801c87aec9def2add9ca802fe569e44a544afe633765267840abe64\"\n dependencies = [\n- \"failure\",\n- \"rand_os\",\n+ \"getrandom\",\n  \"redox_syscall\",\n- \"rust-argon2\",\n ]\n \n [[package]]\n name = \"regex\"\n-version = \"1.3.1\"\n+version = \"1.4.3\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"dc220bd33bdce8f093101afe22a037b8eb0e5af33592e6a9caafff0d4cb81cbd\"\n+checksum = \"d9251239e129e16308e70d853559389de218ac275b515068abc96829d05b948a\"\n dependencies = [\n  \"aho-corasick\",\n  \"memchr\",\n  \"regex-syntax\",\n- \"thread_local 0.3.6\",\n+ \"thread_local\",\n ]\n \n [[package]]\n name = \"regex-syntax\"\n-version = \"0.6.12\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"11a7e20d1cce64ef2fed88b66d347f88bd9babb82845b2b858f3edbf59a4f716\"\n-\n-[[package]]\n-name = \"rust-argon2\"\n-version = \"0.5.1\"\n+version = \"0.6.22\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"4ca4eaef519b494d1f2848fc602d18816fed808a981aedf4f1f00ceb7c9d32cf\"\n-dependencies = [\n- \"base64\",\n- \"blake2b_simd\",\n- \"crossbeam-utils 0.6.6\",\n-]\n-\n-[[package]]\n-name = \"rustc-demangle\"\n-version = \"0.1.16\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"4c691c0e608126e00913e33f0ccf3727d5fc84573623b8d65b2df340b5201783\"\n+checksum = \"b5eb417147ba9860a96cfe72a0b93bf88fee1744b5636ec99ab20c1aa9376581\"\n \n [[package]]\n name = \"rustc-workspace-hack\"\n@@ -593,7 +429,7 @@ dependencies = [\n \n [[package]]\n name = \"rustfmt-nightly\"\n-version = \"1.4.37\"\n+version = \"1.4.38\"\n dependencies = [\n  \"annotate-snippets\",\n  \"anyhow\",\n@@ -639,34 +475,27 @@ dependencies = [\n \n [[package]]\n name = \"semver\"\n-version = \"0.9.0\"\n+version = \"1.0.4\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"1d7eb9ef2c18661902cc47e535f9bc51b78acd254da71d375c2f6720d9a40403\"\n+checksum = \"568a8e6258aa33c13358f81fd834adb854c6f7c9468520910a9b1e8fac068012\"\n dependencies = [\n- \"semver-parser\",\n  \"serde\",\n ]\n \n-[[package]]\n-name = \"semver-parser\"\n-version = \"0.7.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"388a1df253eca08550bef6c72392cfe7c30914bf41df5269b68cbd6ff8f570a3\"\n-\n [[package]]\n name = \"serde\"\n-version = \"1.0.101\"\n+version = \"1.0.126\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"9796c9b7ba2ffe7a9ce53c2287dfc48080f4b2b362fcc245a259b3a7201119dd\"\n+checksum = \"ec7505abeacaec74ae4778d9d9328fe5a5d04253220a85c4ee022239fc996d03\"\n dependencies = [\n  \"serde_derive\",\n ]\n \n [[package]]\n name = \"serde_derive\"\n-version = \"1.0.101\"\n+version = \"1.0.126\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"4b133a43a1ecd55d4086bd5b4dc6c1751c68b1bfbeba7a5040442022c7e7c02e\"\n+checksum = \"963a7dbc9895aeac7ac90e74f34a5d5261828f79df35cbed41e10189d3804d43\"\n dependencies = [\n  \"proc-macro2\",\n  \"quote\",\n@@ -675,9 +504,9 @@ dependencies = [\n \n [[package]]\n name = \"serde_json\"\n-version = \"1.0.41\"\n+version = \"1.0.59\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"2f72eb2a68a7dc3f9a691bfda9305a1c017a6215e5a4545c258500d2099a37c2\"\n+checksum = \"dcac07dbffa1c65e7f816ab9eba78eb142c6d44410f4eeba1e26e4f5dfa56b95\"\n dependencies = [\n  \"itoa\",\n  \"ryu\",\n@@ -716,9 +545,9 @@ dependencies = [\n \n [[package]]\n name = \"syn\"\n-version = \"1.0.11\"\n+version = \"1.0.65\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"dff0acdb207ae2fe6d5976617f887eb1e35a2ba52c13c7234c790960cdad9238\"\n+checksum = \"f3a1d708c221c5a612956ef9f75b37e454e88d1f7b899fbd3a18d4252012d663\"\n dependencies = [\n  \"proc-macro2\",\n  \"quote\",\n@@ -736,18 +565,6 @@ dependencies = [\n  \"syn\",\n ]\n \n-[[package]]\n-name = \"synstructure\"\n-version = \"0.12.1\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"3f085a5855930c0441ca1288cf044ea4aecf4f43a91668abdb870b4ba546a203\"\n-dependencies = [\n- \"proc-macro2\",\n- \"quote\",\n- \"syn\",\n- \"unicode-xid\",\n-]\n-\n [[package]]\n name = \"term\"\n version = \"0.6.1\"\n@@ -796,15 +613,6 @@ dependencies = [\n  \"syn\",\n ]\n \n-[[package]]\n-name = \"thread_local\"\n-version = \"0.3.6\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"c6b53e329000edc2b34dbe8545fd20e55a333362d0a321909685a19bd28c3f1b\"\n-dependencies = [\n- \"lazy_static\",\n-]\n-\n [[package]]\n name = \"thread_local\"\n version = \"1.0.1\"\n@@ -870,6 +678,12 @@ dependencies = [\n  \"winapi-util\",\n ]\n \n+[[package]]\n+name = \"wasi\"\n+version = \"0.10.2+wasi-snapshot-preview1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"fd6fbd9a79829dd1ad0cc20627bf1ed606756a7f77edff7b66b7064f9cb327c6\"\n+\n [[package]]\n name = \"winapi\"\n version = \"0.3.8\""}, {"sha": "8d9c4a7fb20cd93264f5459a7997cb9ca7cbc4df", "filename": "src/tools/rustfmt/Cargo.toml", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2FCargo.toml?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -1,7 +1,7 @@\n [package]\n \n name = \"rustfmt-nightly\"\n-version = \"1.4.37\"\n+version = \"1.4.38\"\n description = \"Tool to find and fix Rust formatting issues\"\n repository = \"https://github.com/rust-lang/rustfmt\"\n readme = \"README.md\"\n@@ -33,7 +33,7 @@ rustfmt-format-diff = []\n generic-simd = [\"bytecount/generic-simd\"]\n \n [dependencies]\n-itertools = \"0.8\"\n+itertools = \"0.9\"\n toml = \"0.5\"\n serde = { version = \"1.0\", features = [\"derive\"] }\n serde_json = \"1.0\"\n@@ -42,15 +42,15 @@ regex = \"1.0\"\n term = \"0.6\"\n diff = \"0.1\"\n log = \"0.4.14\"\n-env_logger = \"0.6\"\n+env_logger = \"0.8\"\n getopts = \"0.2\"\n derive-new = \"0.5\"\n-cargo_metadata = \"0.8\"\n+cargo_metadata = \"0.14\"\n bytecount = \"0.6\"\n unicode-width = \"0.1.5\"\n unicode_categories = \"0.1.1\"\n dirs = \"2.0.1\"\n-ignore = \"0.4.11\"\n+ignore = \"0.4.17\"\n annotate-snippets = { version = \"0.8\", features = [\"color\"] }\n structopt = \"0.3\"\n rustfmt-config_proc_macro = { version = \"0.2\", path = \"config_proc_macro\" }"}, {"sha": "7a77dbe154b60f2f55224cfeae2cb41f2127c53c", "filename": "src/tools/rustfmt/Configurations.md", "status": "modified", "additions": 65, "deletions": 5, "changes": 70, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2FConfigurations.md", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2FConfigurations.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2FConfigurations.md?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -521,11 +521,13 @@ fn main() {\n \n ## `disable_all_formatting`\n \n-Don't reformat anything\n+Don't reformat anything.\n+\n+Note that this option may be soft-deprecated in the future once the [ignore](#ignore) option is stabilized. Nightly toolchain users are encouraged to use [ignore](#ignore) instead when possible.\n \n - **Default value**: `false`\n - **Possible values**: `true`, `false`\n-- **Stable**: No (tracking issue: #3388)\n+- **Stable**: Yes\n \n ## `edition`\n \n@@ -924,6 +926,15 @@ fn add_one(x: i32) -> i32 {\n }\n ```\n \n+## `format_generated_files`\n+\n+Format generated files. A file is considered generated\n+if any of the first five lines contains `@generated` marker.\n+\n+- **Default value**: `false`\n+- **Possible values**: `true`, `false`\n+- **Stable**: No\n+\n ## `format_macro_matchers`\n \n Format the metavariable matching patterns in macros.\n@@ -1047,6 +1058,13 @@ fn lorem() -> usize {\n \n See also: [`tab_spaces`](#tab_spaces).\n \n+## `hex_literal_case`\n+\n+Control the case of the letters in hexadecimal literal values\n+\n+- **Default value**: `Preserve`\n+- **Possible values**: `Upper`, `Lower`\n+- **Stable**: No\n \n ## `hide_parse_errors`\n \n@@ -1610,7 +1628,7 @@ Put a trailing comma after a block based match arm (non-block arms are not affec\n \n - **Default value**: `false`\n - **Possible values**: `true`, `false`\n-- **Stable**: No (tracking issue: #3380)\n+- **Stable**: Yes\n \n #### `false` (default):\n \n@@ -1668,6 +1686,9 @@ pub enum Foo {}\n #### `false`:\n \n ```rust\n+#[derive(Eq, PartialEq, Debug, Copy, Clone)]\n+pub enum Bar {}\n+\n #[derive(Eq, PartialEq)]\n #[derive(Debug)]\n #[derive(Copy, Clone)]\n@@ -1679,7 +1700,7 @@ pub enum Foo {}\n How imports should be grouped into `use` statements. Imports will be merged or split to the configured level of granularity.\n \n - **Default value**: `Preserve`\n-- **Possible values**: `Preserve`, `Crate`, `Module`, `Item`\n+- **Possible values**: `Preserve`, `Crate`, `Module`, `Item`, `One`\n - **Stable**: No\n \n #### `Preserve` (default):\n@@ -1733,6 +1754,23 @@ use qux::h;\n use qux::i;\n ```\n \n+#### `One`:\n+\n+Merge all imports into a single `use` statement as long as they have the same visibility.\n+\n+```rust\n+pub use foo::{x, y};\n+use {\n+    bar::{\n+        a,\n+        b::{self, f, g},\n+        c,\n+        d::e,\n+    },\n+    qux::{h, i},\n+};\n+```\n+\n ## `merge_imports`\n \n This option is deprecated. Use `imports_granularity = \"Crate\"` instead.\n@@ -1824,6 +1862,9 @@ Convert `#![doc]` and `#[doc]` attributes to `//!` and `///` doc comments.\n #![doc = \"Example documentation\"]\n \n #[doc = \"Example item documentation\"]\n+pub enum Bar {}\n+\n+/// Example item documentation\n pub enum Foo {}\n ```\n \n@@ -1938,6 +1979,8 @@ fn main() {\n #### `false`:\n ```rust\n fn main() {\n+    (foo());\n+\n     ((((foo()))));\n }\n ```\n@@ -1963,6 +2006,14 @@ impl Iterator for Dummy {\n \n     type Item = i32;\n }\n+\n+impl Iterator for Dummy {\n+    type Item = i32;\n+\n+    fn next(&mut self) -> Option<Self::Item> {\n+        None\n+    }\n+}\n ```\n \n #### `true`\n@@ -2519,7 +2570,8 @@ fn main() {\n     let x = 1;\n     let y = 2;\n     let z = 3;\n-    let a = Foo { x: x, y: y, z: z };\n+    let a = Foo { x, y, z };\n+    let b = Foo { x: x, y: y, z: z };\n }\n ```\n \n@@ -2688,6 +2740,8 @@ Replace uses of the try! macro by the ? shorthand\n \n ```rust\n fn main() {\n+    let lorem = ipsum.map(|dolor| dolor.sit())?;\n+\n     let lorem = try!(ipsum.map(|dolor| dolor.sit()));\n }\n ```\n@@ -2759,6 +2813,12 @@ Break comments to fit on the line\n #### `false` (default):\n \n ```rust\n+// Lorem ipsum dolor sit amet, consectetur adipiscing elit,\n+// sed do eiusmod tempor incididunt ut labore et dolore\n+// magna aliqua. Ut enim ad minim veniam, quis nostrud\n+// exercitation ullamco laboris nisi ut aliquip ex ea\n+// commodo consequat.\n+\n // Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.\n ```\n "}, {"sha": "b3dda091e0a9607e75c79e3551c1ae59f85c60df", "filename": "src/tools/rustfmt/appveyor.yml", "status": "modified", "additions": 1, "deletions": 48, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fappveyor.yml", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fappveyor.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fappveyor.yml?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -1,55 +1,8 @@\n-# This is based on https://github.com/japaric/rust-everywhere/blob/master/appveyor.yml\n-# and modified (mainly removal of deployment) to suit rustfmt.\n-\n environment:\n   global:\n     PROJECT_NAME: rustfmt\n-  matrix:\n-    # Stable channel\n-    # - TARGET: i686-pc-windows-gnu\n-    #   CHANNEL: stable\n-    # - TARGET: i686-pc-windows-msvc\n-    #   CHANNEL: stable\n-    # - TARGET: x86_64-pc-windows-gnu\n-    #   CHANNEL: stable\n-    # - TARGET: x86_64-pc-windows-msvc\n-    #   CHANNEL: stable\n-    # Beta channel\n-    # - TARGET: i686-pc-windows-gnu\n-    #   CHANNEL: beta\n-    # - TARGET: i686-pc-windows-msvc\n-    #   CHANNEL: beta\n-    # - TARGET: x86_64-pc-windows-gnu\n-    #   CHANNEL: beta\n-    # - TARGET: x86_64-pc-windows-msvc\n-    #   CHANNEL: beta\n-    # Nightly channel\n-    - TARGET: i686-pc-windows-gnu\n-      CHANNEL: nightly\n-    - TARGET: i686-pc-windows-msvc\n-      CHANNEL: nightly\n-    - TARGET: x86_64-pc-windows-gnu\n-      CHANNEL: nightly\n-    - TARGET: x86_64-pc-windows-msvc\n-      CHANNEL: nightly\n-\n-# Install Rust and Cargo\n-# (Based on from https://github.com/rust-lang/libc/blob/master/appveyor.yml)\n-install:\n-  - appveyor-retry appveyor DownloadFile https://win.rustup.rs/ -FileName rustup-init.exe\n-  - if \"%TARGET%\" == \"i686-pc-windows-gnu\" set PATH=%PATH%;C:\\msys64\\mingw32\\bin\n-  - if \"%TARGET%\" == \"x86_64-pc-windows-gnu\" set PATH=%PATH%;C:\\msys64\\mingw64\\bin\n-  - set PATH=%PATH%;C:\\Users\\appveyor\\.cargo\\bin\n-  - rustup-init.exe --default-host %TARGET% --default-toolchain %CHANNEL% -y\n-  - rustc -Vv\n-  - cargo -V\n \n-# ???\n build: false\n \n test_script:\n-  - set CFG_RELEASE_CHANNEL=nightly\n-  - set CFG_RELEASE=nightly\n-  - cargo build --verbose\n-  - cargo test\n-  - cargo test -- --ignored\n+  - echo Why does no one have access to delete me?"}, {"sha": "4fa932d4c762ee77ae19489a6c62d05bc64c27c2", "filename": "src/tools/rustfmt/docs/index.html", "status": "modified", "additions": 165, "deletions": 45, "changes": 210, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fdocs%2Findex.html", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fdocs%2Findex.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fdocs%2Findex.html?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -2,9 +2,13 @@\n <html>\n     <head>\n       <meta name=\"viewport\" content=\"width=device-width\">\n+      <title>Rustfmt</title>\n       <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.css\" />\n+      <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/styles/github-gist.min.css\">\n       <script src=\"https://cdn.jsdelivr.net/npm/marked/marked.min.js\"></script>\n       <script src=\"https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js\"></script>\n+      <script src=\"https://unpkg.com/vue-async-computed@3.8.1\"></script>\n+      <script src=\"https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/highlight.min.js\"></script>\n       <script src=\"https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js\"></script>\n       <style>\n         @media (max-width: 767px) {\n@@ -38,6 +42,15 @@\n         .searchCondition > div {\n           margin-right: 30px;\n         }\n+        .header-link {\n+          position: relative;\n+        }\n+        .header-link:hover::before {\n+          position: absolute;\n+          left: -2em;\n+          padding-right: 0.5em;\n+          content: '\\2002\\00a7\\2002';\n+        }\n       </style>\n     </head>\n     <body>\n@@ -59,70 +72,170 @@\n                   <label for=\"stable\">stable: </label>\n                   <input type=\"checkbox\" id=\"stable\" v-model=\"shouldStable\">\n               </div>\n+              <div>\n+                  <label for=\"viewVersion\">version: </label>\n+                  <select name=\"viewVersion\" id=\"viewVersion\" v-model=\"viewVersion\">\n+                    <option v-for=\"option in versionOptions\" v-bind:value=\"option\">\n+                      {{ option }}\n+                    </option>\n+                  </select>\n+              </div>\n             </div>\n             <div v-html=\"aboutHtml\"></div>\n             <div v-html=\"configurationAboutHtml\"></div>\n             <div v-html=\"outputHtml\"></div>\n           </article>\n         </div>\n         <script>\n-            const ConfigurationMdUrl = 'https://raw.githubusercontent.com/rust-lang/rustfmt/master/Configurations.md';\n+            const RusfmtTagsUrl = 'https://api.github.com/repos/rust-lang/rustfmt/tags';\n+            const RustfmtLatestUrl = 'https://api.github.com/repos/rust-lang/rustfmt/releases/latest';\n             const UrlHash = window.location.hash.replace(/^#/, '');\n+            const queryParams = new URLSearchParams(window.location.search);\n+            const searchParam = queryParams.get('search');\n+            const searchTerm = null !== searchParam ? searchParam : '';\n+            const versionParam = queryParams.get('version');\n+            const parseVersionParam = (version) => {\n+              if (version === 'master') return 'master';\n+              if (version.startsWith('v')) return version;\n+              return `v${version}`;\n+            };\n+            const versionNumber = null !== versionParam ? parseVersionParam(versionParam) : 'master';\n             new Vue({\n               el: '#app',\n-              data() {\n-                const configurationDescriptions = [];\n-                configurationDescriptions.links = {};\n-                return {\n-                  aboutHtml: '',\n-                  configurationAboutHtml: '',\n-                  searchCondition: UrlHash,\n-                  configurationDescriptions,\n-                  shouldStable: false\n-                }\n+              data: {\n+                aboutHtml: '',\n+                configurationAboutHtml: '',\n+                configurationDescriptions: [],\n+                searchCondition: searchTerm,\n+                shouldStable: false,\n+                viewVersion: versionNumber,\n+                oldViewVersion: undefined,\n+                versionOptions: ['master'],\n+                scrolledOnce: false,\n               },\n-              computed: {\n-                outputHtml() {\n-                  const ast = this.configurationDescriptions\n-                                  .filter(({ head, text, stable }) => {\n+              asyncComputed: {\n+                async updateVersion() {\n+                  let latest;\n+                  try {\n+                    latest = (await axios.get(RustfmtLatestUrl)).data;\n+                  } catch(err) {\n+                      console.log(err);\n+                    return;\n+                  }\n+                  if (versionParam == null) {\n+                    this.viewVersion = latest.name;\n+                  }\n+                },\n+                async outputHtml() {\n+                  if (this.viewVersion !== this.oldViewVersion) {\n+                    const ConfigurationMdUrl =\n+                      `https://raw.githubusercontent.com/rust-lang/rustfmt/${this.viewVersion}/Configurations.md`;\n+                    let res;\n+                    try {\n+                      res = await axios.get(ConfigurationMdUrl).catch(e => { throw e });\n+                    } catch(e) {\n+                      this.handleReqFailure(e);\n+                      return;\n+                    }\n+                    const {\n+                      about,\n+                      configurationAbout,\n+                      configurationDescriptions\n+                    } = parseMarkdownAst(res.data);\n+                    this.aboutHtml = marked.parser(about);\n+                    this.configurationAboutHtml = marked.parser(configurationAbout);\n+                    this.configurationDescriptions = configurationDescriptions;\n+                    this.oldViewVersion = this.viewVersion;\n+                  }\n \n-                                    if (\n-                                      text.includes(this.searchCondition) === false &&\n-                                      head.includes(this.searchCondition) === false\n-                                    ) {\n-                                      return false;\n-                                    }\n-                                    return (this.shouldStable)\n-                                      ? stable === true\n-                                      : true;\n-                                  })\n-                                  .reduce((stack, { value }) => {\n-                                    return stack.concat(value);\n-                                  }, []);\n+                  const ast = this.configurationDescriptions\n+                      .filter(({ head, text, stable }) => {\n+                        if (text.includes(this.searchCondition) === false &&\n+                          head.includes(this.searchCondition) === false) {\n+                          return false;\n+                        }\n+                        return (this.shouldStable)\n+                          ? stable === true\n+                          : true;\n+                      })\n+                      .reduce((stack, { value }) => {\n+                        return stack.concat(value);\n+                      }, []);\n                   ast.links = {};\n-                  return marked.parser(ast);\n+\n+                  queryParams.set('version', this.viewVersion);\n+                  queryParams.set('search', this.searchCondition);\n+                  const curUrl = window.location.pathname +\n+                    '?' + queryParams.toString() + window.location.hash;\n+                  history.pushState(null, '', curUrl);\n+\n+                  const renderer = new marked.Renderer();\n+                  renderer.heading = function(text, level) {\n+                    const id = htmlToId(text);\n+                    return `<h${level}>\n+                              <a id=\"${id}\" href=\"#${id}\" name=\"${id}\" class=\"header-link\">${text}</a>\n+                            </h${level}>`;\n+                  };\n+\n+                  return marked.parser(ast, {\n+                    highlight(code, lang) {\n+                      return hljs.highlight(lang ? lang : 'rust', code).value;\n+                    },\n+                    headerIds: true,\n+                    headerPrefix: '',\n+                    renderer,\n+                  });\n                 }\n               },\n               created: async function() {\n-                const res = await axios.get(ConfigurationMdUrl);\n-                const {\n-                  about,\n-                  configurationAbout,\n-                  configurationDescriptions\n-                } = parseMarkdownAst(res.data);\n-                this.aboutHtml = marked.parser(about);\n-                this.configurationAboutHtml = marked.parser(configurationAbout);\n-                this.configurationDescriptions = configurationDescriptions;\n+                let tags;\n+                try {\n+                  tags = (await axios.get(RusfmtTagsUrl)).data;\n+                } catch(e) {\n+                  this.handleReqFailure(e);\n+                  return;\n+                }\n+\n+                const excludedTagVersions = new Set(['v0.7', 'v0.8.1']);\n+\n+                const tagOptions = tags\n+                  .map(tag => tag.name)\n+                  .filter(tag => tag.startsWith('v') && !excludedTagVersions.has(tag));\n+                this.versionOptions = this.versionOptions.concat(tagOptions);\n               },\n-              mounted() {\n+              updated() {\n                 if (UrlHash === '') return;\n-                const interval = setInterval(() => {\n+                this.$nextTick(() => {\n                   const target = document.querySelector(`#${UrlHash}`);\n-                  if (target != null) {\n+                  if (target != null && !this.scrolledOnce) {\n                     target.scrollIntoView(true);\n-                    clearInterval(interval);\n+                    this.scrolledOnce = true;\n                   }\n-                }, 100);\n+                });\n+              },\n+              methods: {\n+                handleReqFailure(e) {\n+                  if (e.response.status === 404) {\n+                    this.aboutHtml =\n+                      \"<p>Failed to get configuration options for this version, please select the version from the dropdown above.</p>\";\n+                  } else if (\n+                    e.response.status === 403 &&\n+                    e.response.headers[\"X-RateLimit-Remaining\"] === 0\n+                  ) {\n+                    const resetDate = new Date(\n+                      e.response.headers['X-RateLimit-Reset'] * 1000\n+                    ).toLocaleString();\n+                    this.aboutHtml =\n+                      `<p>You have hit the GitHub API rate limit; documentation cannot be updated.` +\n+                      `<p>The rate limit will be reset at ${resetDate}.</p>`;\n+                  } else {\n+                    this.aboutHtml =\n+                      `<p>Ecountered an error when fetching documentation data:</p>` +\n+                      `<pre><code>${e.response.data}</code></pre>` +\n+                      `<p>We would appreciate <a href=\"https://github.com/rust-lang/rustfmt/issues/new?template=bug_report.md\">a bug report</a>.` +\n+                      `<p>Try refreshing the page.</p>`;\n+                  }\n+                }\n               }\n             });\n             const extractDepthOnes = (ast) => {\n@@ -155,7 +268,9 @@\n                     head: val[0].text,\n                     value: val,\n                     stable: val.some((elem) => {\n-                      return !!elem.text && elem.text.includes(\"**Stable**: Yes\")\n+                      return elem.type === \"list\" &&\n+                        !!elem.raw &&\n+                        elem.raw.includes(\"**Stable**: Yes\");\n                     }),\n                     text: val.reduce((result, next) => {\n                       return next.text != null\n@@ -186,6 +301,11 @@\n                 configurationDescriptions\n               };\n             }\n+            function htmlToId(text) {\n+              const tmpl = document.createElement('template');\n+              tmpl.innerHTML = text.trim();\n+              return encodeURIComponent(CSS.escape(tmpl.content.textContent));\n+            }\n         </script>\n     </body>\n-</html>\n\\ No newline at end of file\n+</html>"}, {"sha": "b19ecbdb07c4f425540264a618144618e7acbcab", "filename": "src/tools/rustfmt/rust-toolchain", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Frust-toolchain", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Frust-toolchain", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Frust-toolchain?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -1,3 +1,3 @@\n [toolchain]\n-channel = \"nightly-2021-07-23\"\n+channel = \"nightly-2021-10-20\"\n components = [\"rustc-dev\"]"}, {"sha": "a5982820e3ded6f2de868975ac9003ee441623f4", "filename": "src/tools/rustfmt/src/attr.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fattr.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -13,6 +13,7 @@ use crate::lists::{definitive_tactic, itemize_list, write_list, ListFormatting,\n use crate::overflow;\n use crate::rewrite::{Rewrite, RewriteContext};\n use crate::shape::Shape;\n+use crate::source_map::SpanUtils;\n use crate::types::{rewrite_path, PathContext};\n use crate::utils::{count_newlines, mk_sp};\n \n@@ -116,7 +117,9 @@ fn format_derive(\n                 |span| span.lo(),\n                 |span| span.hi(),\n                 |span| Some(context.snippet(*span).to_owned()),\n-                attr.span.lo(),\n+                // We update derive attribute spans to start after the opening '('\n+                // This helps us focus parsing to just what's inside #[derive(...)]\n+                context.snippet_provider.span_after(attr.span, \"(\"),\n                 attr.span.hi(),\n                 false,\n             );"}, {"sha": "1bcc5c0dada3bd0695d9fd5c8167890ab7eff255", "filename": "src/tools/rustfmt/src/bin/main.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fbin%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fbin%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fbin%2Fmain.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -121,7 +121,7 @@ fn make_opts() -> Options {\n          found reverts to the input file path\",\n         \"[Path for the configuration file]\",\n     );\n-    opts.optopt(\"\", \"edition\", \"Rust edition to use\", \"[2015|2018]\");\n+    opts.optopt(\"\", \"edition\", \"Rust edition to use\", \"[2015|2018|2021]\");\n     opts.optopt(\n         \"\",\n         \"color\","}, {"sha": "1d423ac34919b421a31e4f77f4e63030746082a6", "filename": "src/tools/rustfmt/src/cargo-fmt/main.rs", "status": "modified", "additions": 39, "deletions": 254, "changes": 293, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fcargo-fmt%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fcargo-fmt%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fcargo-fmt%2Fmain.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -17,6 +17,10 @@ use std::str;\n \n use structopt::StructOpt;\n \n+#[path = \"test/mod.rs\"]\n+#[cfg(test)]\n+mod cargo_fmt_tests;\n+\n #[derive(StructOpt, Debug)]\n #[structopt(\n     bin_name = \"cargo fmt\",\n@@ -36,7 +40,7 @@ pub struct Opts {\n     #[structopt(long = \"version\")]\n     version: bool,\n \n-    /// Specify package to format (only usable in workspaces)\n+    /// Specify package to format\n     #[structopt(short = \"p\", long = \"package\", value_name = \"package\")]\n     packages: Vec<String>,\n \n@@ -53,9 +57,13 @@ pub struct Opts {\n     #[structopt(name = \"rustfmt_options\", raw(true))]\n     rustfmt_options: Vec<String>,\n \n-    /// Format all packages (only usable in workspaces)\n+    /// Format all packages, and also their local path-based dependencies\n     #[structopt(long = \"all\")]\n     format_all: bool,\n+\n+    /// Run rustfmt in check mode\n+    #[structopt(long = \"check\")]\n+    check: bool,\n }\n \n fn main() {\n@@ -104,6 +112,12 @@ fn execute() -> i32 {\n \n     let strategy = CargoFmtStrategy::from_opts(&opts);\n     let mut rustfmt_args = opts.rustfmt_options;\n+    if opts.check {\n+        let check_flag = \"--check\";\n+        if !rustfmt_args.iter().any(|o| o == check_flag) {\n+            rustfmt_args.push(check_flag.to_owned());\n+        }\n+    }\n     if let Some(message_format) = opts.message_format {\n         if let Err(msg) = convert_message_format_to_rustfmt_args(&message_format, &mut rustfmt_args)\n         {\n@@ -346,7 +360,7 @@ fn get_targets_root_only(\n     manifest_path: Option<&Path>,\n     targets: &mut BTreeSet<Target>,\n ) -> Result<(), io::Error> {\n-    let metadata = get_cargo_metadata(manifest_path, false)?;\n+    let metadata = get_cargo_metadata(manifest_path)?;\n     let workspace_root_path = PathBuf::from(&metadata.workspace_root).canonicalize()?;\n     let (in_workspace_root, current_dir_manifest) = if let Some(target_manifest) = manifest_path {\n         (\n@@ -390,34 +404,29 @@ fn get_targets_recursive(\n     mut targets: &mut BTreeSet<Target>,\n     visited: &mut BTreeSet<String>,\n ) -> Result<(), io::Error> {\n-    let metadata = get_cargo_metadata(manifest_path, false)?;\n-    let metadata_with_deps = get_cargo_metadata(manifest_path, true)?;\n-\n-    for package in metadata.packages {\n+    let metadata = get_cargo_metadata(manifest_path)?;\n+    for package in &metadata.packages {\n         add_targets(&package.targets, &mut targets);\n \n-        // Look for local dependencies.\n-        for dependency in package.dependencies {\n-            if dependency.source.is_some() || visited.contains(&dependency.name) {\n+        // Look for local dependencies using information available since cargo v1.51\n+        // It's theoretically possible someone could use a newer version of rustfmt with\n+        // a much older version of `cargo`, but we don't try to explicitly support that scenario.\n+        // If someone reports an issue with path-based deps not being formatted, be sure to\n+        // confirm their version of `cargo` (not `cargo-fmt`) is >= v1.51\n+        // https://github.com/rust-lang/cargo/pull/8994\n+        for dependency in &package.dependencies {\n+            if dependency.path.is_none() || visited.contains(&dependency.name) {\n                 continue;\n             }\n \n-            let dependency_package = metadata_with_deps\n-                .packages\n-                .iter()\n-                .find(|p| p.name == dependency.name && p.source.is_none());\n-            let manifest_path = if let Some(dep_pkg) = dependency_package {\n-                PathBuf::from(&dep_pkg.manifest_path)\n-            } else {\n-                let mut package_manifest_path = PathBuf::from(&package.manifest_path);\n-                package_manifest_path.pop();\n-                package_manifest_path.push(&dependency.name);\n-                package_manifest_path.push(\"Cargo.toml\");\n-                package_manifest_path\n-            };\n-\n-            if manifest_path.exists() {\n-                visited.insert(dependency.name);\n+            let manifest_path = PathBuf::from(dependency.path.as_ref().unwrap()).join(\"Cargo.toml\");\n+            if manifest_path.exists()\n+                && !metadata\n+                    .packages\n+                    .iter()\n+                    .any(|p| p.manifest_path.eq(&manifest_path))\n+            {\n+                visited.insert(dependency.name.to_owned());\n                 get_targets_recursive(Some(&manifest_path), &mut targets, visited)?;\n             }\n         }\n@@ -431,8 +440,7 @@ fn get_targets_with_hitlist(\n     hitlist: &[String],\n     targets: &mut BTreeSet<Target>,\n ) -> Result<(), io::Error> {\n-    let metadata = get_cargo_metadata(manifest_path, false)?;\n-\n+    let metadata = get_cargo_metadata(manifest_path)?;\n     let mut workspace_hitlist: BTreeSet<&String> = BTreeSet::from_iter(hitlist);\n \n     for package in metadata.packages {\n@@ -517,18 +525,13 @@ fn run_rustfmt(\n         .unwrap_or(SUCCESS))\n }\n \n-fn get_cargo_metadata(\n-    manifest_path: Option<&Path>,\n-    include_deps: bool,\n-) -> Result<cargo_metadata::Metadata, io::Error> {\n+fn get_cargo_metadata(manifest_path: Option<&Path>) -> Result<cargo_metadata::Metadata, io::Error> {\n     let mut cmd = cargo_metadata::MetadataCommand::new();\n-    if !include_deps {\n-        cmd.no_deps();\n-    }\n+    cmd.no_deps();\n     if let Some(manifest_path) = manifest_path {\n         cmd.manifest_path(manifest_path);\n     }\n-    cmd.other_options(&[String::from(\"--offline\")]);\n+    cmd.other_options(vec![String::from(\"--offline\")]);\n \n     match cmd.exec() {\n         Ok(metadata) => Ok(metadata),\n@@ -541,221 +544,3 @@ fn get_cargo_metadata(\n         }\n     }\n }\n-\n-#[cfg(test)]\n-mod cargo_fmt_tests {\n-    use super::*;\n-\n-    #[test]\n-    fn default_options() {\n-        let empty: Vec<String> = vec![];\n-        let o = Opts::from_iter(&empty);\n-        assert_eq!(false, o.quiet);\n-        assert_eq!(false, o.verbose);\n-        assert_eq!(false, o.version);\n-        assert_eq!(empty, o.packages);\n-        assert_eq!(empty, o.rustfmt_options);\n-        assert_eq!(false, o.format_all);\n-        assert_eq!(None, o.manifest_path);\n-        assert_eq!(None, o.message_format);\n-    }\n-\n-    #[test]\n-    fn good_options() {\n-        let o = Opts::from_iter(&[\n-            \"test\",\n-            \"-q\",\n-            \"-p\",\n-            \"p1\",\n-            \"-p\",\n-            \"p2\",\n-            \"--message-format\",\n-            \"short\",\n-            \"--\",\n-            \"--edition\",\n-            \"2018\",\n-        ]);\n-        assert_eq!(true, o.quiet);\n-        assert_eq!(false, o.verbose);\n-        assert_eq!(false, o.version);\n-        assert_eq!(vec![\"p1\", \"p2\"], o.packages);\n-        assert_eq!(vec![\"--edition\", \"2018\"], o.rustfmt_options);\n-        assert_eq!(false, o.format_all);\n-        assert_eq!(Some(String::from(\"short\")), o.message_format);\n-    }\n-\n-    #[test]\n-    fn unexpected_option() {\n-        assert!(\n-            Opts::clap()\n-                .get_matches_from_safe(&[\"test\", \"unexpected\"])\n-                .is_err()\n-        );\n-    }\n-\n-    #[test]\n-    fn unexpected_flag() {\n-        assert!(\n-            Opts::clap()\n-                .get_matches_from_safe(&[\"test\", \"--flag\"])\n-                .is_err()\n-        );\n-    }\n-\n-    #[test]\n-    fn mandatory_separator() {\n-        assert!(\n-            Opts::clap()\n-                .get_matches_from_safe(&[\"test\", \"--check\"])\n-                .is_err()\n-        );\n-        assert!(\n-            !Opts::clap()\n-                .get_matches_from_safe(&[\"test\", \"--\", \"--check\"])\n-                .is_err()\n-        );\n-    }\n-\n-    #[test]\n-    fn multiple_packages_one_by_one() {\n-        let o = Opts::from_iter(&[\n-            \"test\",\n-            \"-p\",\n-            \"package1\",\n-            \"--package\",\n-            \"package2\",\n-            \"-p\",\n-            \"package3\",\n-        ]);\n-        assert_eq!(3, o.packages.len());\n-    }\n-\n-    #[test]\n-    fn multiple_packages_grouped() {\n-        let o = Opts::from_iter(&[\n-            \"test\",\n-            \"--package\",\n-            \"package1\",\n-            \"package2\",\n-            \"-p\",\n-            \"package3\",\n-            \"package4\",\n-        ]);\n-        assert_eq!(4, o.packages.len());\n-    }\n-\n-    #[test]\n-    fn empty_packages_1() {\n-        assert!(Opts::clap().get_matches_from_safe(&[\"test\", \"-p\"]).is_err());\n-    }\n-\n-    #[test]\n-    fn empty_packages_2() {\n-        assert!(\n-            Opts::clap()\n-                .get_matches_from_safe(&[\"test\", \"-p\", \"--\", \"--check\"])\n-                .is_err()\n-        );\n-    }\n-\n-    #[test]\n-    fn empty_packages_3() {\n-        assert!(\n-            Opts::clap()\n-                .get_matches_from_safe(&[\"test\", \"-p\", \"--verbose\"])\n-                .is_err()\n-        );\n-    }\n-\n-    #[test]\n-    fn empty_packages_4() {\n-        assert!(\n-            Opts::clap()\n-                .get_matches_from_safe(&[\"test\", \"-p\", \"--check\"])\n-                .is_err()\n-        );\n-    }\n-\n-    mod convert_message_format_to_rustfmt_args_tests {\n-        use super::*;\n-\n-        #[test]\n-        fn invalid_message_format() {\n-            assert_eq!(\n-                convert_message_format_to_rustfmt_args(\"awesome\", &mut vec![]),\n-                Err(String::from(\n-                    \"invalid --message-format value: awesome. Allowed values are: short|json|human\"\n-                )),\n-            );\n-        }\n-\n-        #[test]\n-        fn json_message_format_and_check_arg() {\n-            let mut args = vec![String::from(\"--check\")];\n-            assert_eq!(\n-                convert_message_format_to_rustfmt_args(\"json\", &mut args),\n-                Err(String::from(\n-                    \"cannot include --check arg when --message-format is set to json\"\n-                )),\n-            );\n-        }\n-\n-        #[test]\n-        fn json_message_format_and_emit_arg() {\n-            let mut args = vec![String::from(\"--emit\"), String::from(\"checkstyle\")];\n-            assert_eq!(\n-                convert_message_format_to_rustfmt_args(\"json\", &mut args),\n-                Err(String::from(\n-                    \"cannot include --emit arg when --message-format is set to json\"\n-                )),\n-            );\n-        }\n-\n-        #[test]\n-        fn json_message_format() {\n-            let mut args = vec![String::from(\"--edition\"), String::from(\"2018\")];\n-            assert!(convert_message_format_to_rustfmt_args(\"json\", &mut args).is_ok());\n-            assert_eq!(\n-                args,\n-                vec![\n-                    String::from(\"--edition\"),\n-                    String::from(\"2018\"),\n-                    String::from(\"--emit\"),\n-                    String::from(\"json\")\n-                ]\n-            );\n-        }\n-\n-        #[test]\n-        fn human_message_format() {\n-            let exp_args = vec![String::from(\"--emit\"), String::from(\"json\")];\n-            let mut act_args = exp_args.clone();\n-            assert!(convert_message_format_to_rustfmt_args(\"human\", &mut act_args).is_ok());\n-            assert_eq!(act_args, exp_args);\n-        }\n-\n-        #[test]\n-        fn short_message_format() {\n-            let mut args = vec![String::from(\"--check\")];\n-            assert!(convert_message_format_to_rustfmt_args(\"short\", &mut args).is_ok());\n-            assert_eq!(args, vec![String::from(\"--check\"), String::from(\"-l\")]);\n-        }\n-\n-        #[test]\n-        fn short_message_format_included_short_list_files_flag() {\n-            let mut args = vec![String::from(\"--check\"), String::from(\"-l\")];\n-            assert!(convert_message_format_to_rustfmt_args(\"short\", &mut args).is_ok());\n-            assert_eq!(args, vec![String::from(\"--check\"), String::from(\"-l\")]);\n-        }\n-\n-        #[test]\n-        fn short_message_format_included_long_list_files_flag() {\n-            let mut args = vec![String::from(\"--check\"), String::from(\"--files-with-diff\")];\n-            assert!(convert_message_format_to_rustfmt_args(\"short\", &mut args).is_ok());\n-            assert_eq!(\n-                args,\n-                vec![String::from(\"--check\"), String::from(\"--files-with-diff\")]\n-            );\n-        }\n-    }\n-}"}, {"sha": "bf44924f13c31cdc56fa9779969791d6910418ee", "filename": "src/tools/rustfmt/src/cargo-fmt/test/message_format.rs", "status": "added", "additions": 80, "deletions": 0, "changes": 80, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fcargo-fmt%2Ftest%2Fmessage_format.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fcargo-fmt%2Ftest%2Fmessage_format.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fcargo-fmt%2Ftest%2Fmessage_format.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,80 @@\n+use super::*;\n+\n+#[test]\n+fn invalid_message_format() {\n+    assert_eq!(\n+        convert_message_format_to_rustfmt_args(\"awesome\", &mut vec![]),\n+        Err(String::from(\n+            \"invalid --message-format value: awesome. Allowed values are: short|json|human\"\n+        )),\n+    );\n+}\n+\n+#[test]\n+fn json_message_format_and_check_arg() {\n+    let mut args = vec![String::from(\"--check\")];\n+    assert_eq!(\n+        convert_message_format_to_rustfmt_args(\"json\", &mut args),\n+        Err(String::from(\n+            \"cannot include --check arg when --message-format is set to json\"\n+        )),\n+    );\n+}\n+\n+#[test]\n+fn json_message_format_and_emit_arg() {\n+    let mut args = vec![String::from(\"--emit\"), String::from(\"checkstyle\")];\n+    assert_eq!(\n+        convert_message_format_to_rustfmt_args(\"json\", &mut args),\n+        Err(String::from(\n+            \"cannot include --emit arg when --message-format is set to json\"\n+        )),\n+    );\n+}\n+\n+#[test]\n+fn json_message_format() {\n+    let mut args = vec![String::from(\"--edition\"), String::from(\"2018\")];\n+    assert!(convert_message_format_to_rustfmt_args(\"json\", &mut args).is_ok());\n+    assert_eq!(\n+        args,\n+        vec![\n+            String::from(\"--edition\"),\n+            String::from(\"2018\"),\n+            String::from(\"--emit\"),\n+            String::from(\"json\")\n+        ]\n+    );\n+}\n+\n+#[test]\n+fn human_message_format() {\n+    let exp_args = vec![String::from(\"--emit\"), String::from(\"json\")];\n+    let mut act_args = exp_args.clone();\n+    assert!(convert_message_format_to_rustfmt_args(\"human\", &mut act_args).is_ok());\n+    assert_eq!(act_args, exp_args);\n+}\n+\n+#[test]\n+fn short_message_format() {\n+    let mut args = vec![String::from(\"--check\")];\n+    assert!(convert_message_format_to_rustfmt_args(\"short\", &mut args).is_ok());\n+    assert_eq!(args, vec![String::from(\"--check\"), String::from(\"-l\")]);\n+}\n+\n+#[test]\n+fn short_message_format_included_short_list_files_flag() {\n+    let mut args = vec![String::from(\"--check\"), String::from(\"-l\")];\n+    assert!(convert_message_format_to_rustfmt_args(\"short\", &mut args).is_ok());\n+    assert_eq!(args, vec![String::from(\"--check\"), String::from(\"-l\")]);\n+}\n+\n+#[test]\n+fn short_message_format_included_long_list_files_flag() {\n+    let mut args = vec![String::from(\"--check\"), String::from(\"--files-with-diff\")];\n+    assert!(convert_message_format_to_rustfmt_args(\"short\", &mut args).is_ok());\n+    assert_eq!(\n+        args,\n+        vec![String::from(\"--check\"), String::from(\"--files-with-diff\")]\n+    );\n+}"}, {"sha": "360503632c7ed2ce2a42529a2e22265f2588fbd2", "filename": "src/tools/rustfmt/src/cargo-fmt/test/mod.rs", "status": "added", "additions": 137, "deletions": 0, "changes": 137, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fcargo-fmt%2Ftest%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fcargo-fmt%2Ftest%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fcargo-fmt%2Ftest%2Fmod.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,137 @@\n+use super::*;\n+\n+mod message_format;\n+mod targets;\n+\n+#[test]\n+fn default_options() {\n+    let empty: Vec<String> = vec![];\n+    let o = Opts::from_iter(&empty);\n+    assert_eq!(false, o.quiet);\n+    assert_eq!(false, o.verbose);\n+    assert_eq!(false, o.version);\n+    assert_eq!(false, o.check);\n+    assert_eq!(empty, o.packages);\n+    assert_eq!(empty, o.rustfmt_options);\n+    assert_eq!(false, o.format_all);\n+    assert_eq!(None, o.manifest_path);\n+    assert_eq!(None, o.message_format);\n+}\n+\n+#[test]\n+fn good_options() {\n+    let o = Opts::from_iter(&[\n+        \"test\",\n+        \"-q\",\n+        \"-p\",\n+        \"p1\",\n+        \"-p\",\n+        \"p2\",\n+        \"--message-format\",\n+        \"short\",\n+        \"--check\",\n+        \"--\",\n+        \"--edition\",\n+        \"2018\",\n+    ]);\n+    assert_eq!(true, o.quiet);\n+    assert_eq!(false, o.verbose);\n+    assert_eq!(false, o.version);\n+    assert_eq!(true, o.check);\n+    assert_eq!(vec![\"p1\", \"p2\"], o.packages);\n+    assert_eq!(vec![\"--edition\", \"2018\"], o.rustfmt_options);\n+    assert_eq!(false, o.format_all);\n+    assert_eq!(Some(String::from(\"short\")), o.message_format);\n+}\n+\n+#[test]\n+fn unexpected_option() {\n+    assert!(\n+        Opts::clap()\n+            .get_matches_from_safe(&[\"test\", \"unexpected\"])\n+            .is_err()\n+    );\n+}\n+\n+#[test]\n+fn unexpected_flag() {\n+    assert!(\n+        Opts::clap()\n+            .get_matches_from_safe(&[\"test\", \"--flag\"])\n+            .is_err()\n+    );\n+}\n+\n+#[test]\n+fn mandatory_separator() {\n+    assert!(\n+        Opts::clap()\n+            .get_matches_from_safe(&[\"test\", \"--emit\"])\n+            .is_err()\n+    );\n+    assert!(\n+        !Opts::clap()\n+            .get_matches_from_safe(&[\"test\", \"--\", \"--emit\"])\n+            .is_err()\n+    );\n+}\n+\n+#[test]\n+fn multiple_packages_one_by_one() {\n+    let o = Opts::from_iter(&[\n+        \"test\",\n+        \"-p\",\n+        \"package1\",\n+        \"--package\",\n+        \"package2\",\n+        \"-p\",\n+        \"package3\",\n+    ]);\n+    assert_eq!(3, o.packages.len());\n+}\n+\n+#[test]\n+fn multiple_packages_grouped() {\n+    let o = Opts::from_iter(&[\n+        \"test\",\n+        \"--package\",\n+        \"package1\",\n+        \"package2\",\n+        \"-p\",\n+        \"package3\",\n+        \"package4\",\n+    ]);\n+    assert_eq!(4, o.packages.len());\n+}\n+\n+#[test]\n+fn empty_packages_1() {\n+    assert!(Opts::clap().get_matches_from_safe(&[\"test\", \"-p\"]).is_err());\n+}\n+\n+#[test]\n+fn empty_packages_2() {\n+    assert!(\n+        Opts::clap()\n+            .get_matches_from_safe(&[\"test\", \"-p\", \"--\", \"--check\"])\n+            .is_err()\n+    );\n+}\n+\n+#[test]\n+fn empty_packages_3() {\n+    assert!(\n+        Opts::clap()\n+            .get_matches_from_safe(&[\"test\", \"-p\", \"--verbose\"])\n+            .is_err()\n+    );\n+}\n+\n+#[test]\n+fn empty_packages_4() {\n+    assert!(\n+        Opts::clap()\n+            .get_matches_from_safe(&[\"test\", \"-p\", \"--check\"])\n+            .is_err()\n+    );\n+}"}, {"sha": "b7e7fabdf7156e5e8a1587bc0f168791e7478002", "filename": "src/tools/rustfmt/src/cargo-fmt/test/targets.rs", "status": "added", "additions": 134, "deletions": 0, "changes": 134, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fcargo-fmt%2Ftest%2Ftargets.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fcargo-fmt%2Ftest%2Ftargets.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fcargo-fmt%2Ftest%2Ftargets.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,134 @@\n+use super::*;\n+\n+struct ExpTarget {\n+    path: &'static str,\n+    edition: &'static str,\n+    kind: &'static str,\n+}\n+\n+mod all_targets {\n+    use super::*;\n+\n+    fn assert_correct_targets_loaded(\n+        manifest_suffix: &str,\n+        source_root: &str,\n+        exp_targets: &[ExpTarget],\n+        exp_num_targets: usize,\n+    ) {\n+        let root_path = Path::new(\"tests/cargo-fmt/source\").join(source_root);\n+        let get_path = |exp: &str| PathBuf::from(&root_path).join(exp).canonicalize().unwrap();\n+        let manifest_path = Path::new(&root_path).join(manifest_suffix);\n+        let targets = get_targets(&CargoFmtStrategy::All, Some(manifest_path.as_path()))\n+            .expect(\"Targets should have been loaded\");\n+\n+        assert_eq!(targets.len(), exp_num_targets);\n+\n+        for target in exp_targets {\n+            assert!(targets.contains(&Target {\n+                path: get_path(target.path),\n+                edition: target.edition.to_owned(),\n+                kind: target.kind.to_owned(),\n+            }));\n+        }\n+    }\n+\n+    mod different_crate_and_dir_names {\n+        use super::*;\n+\n+        fn assert_correct_targets_loaded(manifest_suffix: &str) {\n+            let exp_targets = vec![\n+                ExpTarget {\n+                    path: \"dependency-dir-name/subdep-dir-name/src/lib.rs\",\n+                    edition: \"2018\",\n+                    kind: \"lib\",\n+                },\n+                ExpTarget {\n+                    path: \"dependency-dir-name/src/lib.rs\",\n+                    edition: \"2018\",\n+                    kind: \"lib\",\n+                },\n+                ExpTarget {\n+                    path: \"src/main.rs\",\n+                    edition: \"2018\",\n+                    kind: \"main\",\n+                },\n+            ];\n+            super::assert_correct_targets_loaded(\n+                manifest_suffix,\n+                \"divergent-crate-dir-names\",\n+                &exp_targets,\n+                3,\n+            );\n+        }\n+\n+        #[test]\n+        fn correct_targets_from_root() {\n+            assert_correct_targets_loaded(\"Cargo.toml\");\n+        }\n+\n+        #[test]\n+        fn correct_targets_from_sub_local_dep() {\n+            assert_correct_targets_loaded(\"dependency-dir-name/Cargo.toml\");\n+        }\n+    }\n+\n+    mod workspaces {\n+        use super::*;\n+\n+        fn assert_correct_targets_loaded(manifest_suffix: &str) {\n+            let exp_targets = vec![\n+                ExpTarget {\n+                    path: \"ws/a/src/main.rs\",\n+                    edition: \"2018\",\n+                    kind: \"bin\",\n+                },\n+                ExpTarget {\n+                    path: \"ws/b/src/main.rs\",\n+                    edition: \"2018\",\n+                    kind: \"bin\",\n+                },\n+                ExpTarget {\n+                    path: \"ws/c/src/lib.rs\",\n+                    edition: \"2018\",\n+                    kind: \"lib\",\n+                },\n+                ExpTarget {\n+                    path: \"ws/a/d/src/lib.rs\",\n+                    edition: \"2018\",\n+                    kind: \"lib\",\n+                },\n+                ExpTarget {\n+                    path: \"e/src/main.rs\",\n+                    edition: \"2018\",\n+                    kind: \"main\",\n+                },\n+                ExpTarget {\n+                    path: \"ws/a/d/f/src/lib.rs\",\n+                    edition: \"2018\",\n+                    kind: \"lib\",\n+                },\n+            ];\n+            super::assert_correct_targets_loaded(\n+                manifest_suffix,\n+                \"workspaces/path-dep-above\",\n+                &exp_targets,\n+                6,\n+            );\n+        }\n+\n+        #[test]\n+        fn includes_outside_workspace_deps() {\n+            assert_correct_targets_loaded(\"ws/Cargo.toml\");\n+        }\n+\n+        #[test]\n+        fn includes_workspace_from_dep_above() {\n+            assert_correct_targets_loaded(\"e/Cargo.toml\");\n+        }\n+\n+        #[test]\n+        fn includes_all_packages_from_workspace_subdir() {\n+            assert_correct_targets_loaded(\"ws/a/d/f/Cargo.toml\");\n+        }\n+    }\n+}"}, {"sha": "dc4f4516252b122267dfb3030bdc01324deeba3a", "filename": "src/tools/rustfmt/src/comment.rs", "status": "modified", "additions": 32, "deletions": 36, "changes": 68, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fcomment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fcomment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fcomment.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -10,7 +10,8 @@ use crate::rewrite::RewriteContext;\n use crate::shape::{Indent, Shape};\n use crate::string::{rewrite_string, StringFormat};\n use crate::utils::{\n-    count_newlines, first_line_width, last_line_width, trim_left_preserve_layout, unicode_str_width,\n+    count_newlines, first_line_width, last_line_width, trim_left_preserve_layout,\n+    trimmed_last_line_width, unicode_str_width,\n };\n use crate::{ErrorKind, FormattingError};\n \n@@ -171,11 +172,12 @@ pub(crate) fn combine_strs_with_missing_comments(\n         String::with_capacity(prev_str.len() + next_str.len() + shape.indent.width() + 128);\n     result.push_str(prev_str);\n     let mut allow_one_line = !prev_str.contains('\\n') && !next_str.contains('\\n');\n-    let first_sep = if prev_str.is_empty() || next_str.is_empty() {\n-        \"\"\n-    } else {\n-        \" \"\n-    };\n+    let first_sep =\n+        if prev_str.is_empty() || next_str.is_empty() || trimmed_last_line_width(prev_str) == 0 {\n+            \"\"\n+        } else {\n+            \" \"\n+        };\n     let mut one_line_width =\n         last_line_width(prev_str) + first_line_width(next_str) + first_sep.len();\n \n@@ -184,7 +186,7 @@ pub(crate) fn combine_strs_with_missing_comments(\n     let missing_comment = rewrite_missing_comment(span, shape, context)?;\n \n     if missing_comment.is_empty() {\n-        if allow_extend && prev_str.len() + first_sep.len() + next_str.len() <= shape.width {\n+        if allow_extend && one_line_width <= shape.width {\n             result.push_str(first_sep);\n         } else if !prev_str.is_empty() {\n             result.push_str(&indent.to_string_with_newline(config))\n@@ -392,28 +394,26 @@ fn identify_comment(\n     }\n }\n \n-/// Attributes for code blocks in rustdoc.\n-/// See <https://doc.rust-lang.org/rustdoc/print.html#attributes>.\n+/// Enum indicating if the code block contains rust based on attributes\n enum CodeBlockAttribute {\n     Rust,\n-    Ignore,\n-    Text,\n-    ShouldPanic,\n-    NoRun,\n-    CompileFail,\n+    NotRust,\n }\n \n impl CodeBlockAttribute {\n-    fn new(attribute: &str) -> CodeBlockAttribute {\n-        match attribute {\n-            \"rust\" | \"\" => CodeBlockAttribute::Rust,\n-            \"ignore\" => CodeBlockAttribute::Ignore,\n-            \"text\" => CodeBlockAttribute::Text,\n-            \"should_panic\" => CodeBlockAttribute::ShouldPanic,\n-            \"no_run\" => CodeBlockAttribute::NoRun,\n-            \"compile_fail\" => CodeBlockAttribute::CompileFail,\n-            _ => CodeBlockAttribute::Text,\n+    /// Parse comma separated attributes list. Return rust only if all\n+    /// attributes are valid rust attributes\n+    /// See <https://doc.rust-lang.org/rustdoc/print.html#attributes>\n+    fn new(attributes: &str) -> CodeBlockAttribute {\n+        for attribute in attributes.split(\",\") {\n+            match attribute.trim() {\n+                \"\" | \"rust\" | \"should_panic\" | \"no_run\" | \"edition2015\" | \"edition2018\"\n+                | \"edition2021\" => (),\n+                \"ignore\" | \"compile_fail\" | \"text\" => return CodeBlockAttribute::NotRust,\n+                _ => return CodeBlockAttribute::NotRust,\n+            }\n         }\n+        CodeBlockAttribute::Rust\n     }\n }\n \n@@ -647,25 +647,21 @@ impl<'a> CommentRewrite<'a> {\n         } else if self.code_block_attr.is_some() {\n             if line.starts_with(\"```\") {\n                 let code_block = match self.code_block_attr.as_ref().unwrap() {\n-                    CodeBlockAttribute::Ignore | CodeBlockAttribute::Text => {\n-                        trim_custom_comment_prefix(&self.code_block_buffer)\n-                    }\n-                    _ if self.code_block_buffer.is_empty() => String::new(),\n-                    _ => {\n+                    CodeBlockAttribute::Rust\n+                        if self.fmt.config.format_code_in_doc_comments()\n+                            && !self.code_block_buffer.is_empty() =>\n+                    {\n                         let mut config = self.fmt.config.clone();\n                         config.set().wrap_comments(false);\n-                        if config.format_code_in_doc_comments() {\n-                            if let Some(s) =\n-                                crate::format_code_block(&self.code_block_buffer, &config, false)\n-                            {\n-                                trim_custom_comment_prefix(&s.snippet)\n-                            } else {\n-                                trim_custom_comment_prefix(&self.code_block_buffer)\n-                            }\n+                        if let Some(s) =\n+                            crate::format_code_block(&self.code_block_buffer, &config, false)\n+                        {\n+                            trim_custom_comment_prefix(&s.snippet)\n                         } else {\n                             trim_custom_comment_prefix(&self.code_block_buffer)\n                         }\n                     }\n+                    _ => trim_custom_comment_prefix(&self.code_block_buffer),\n                 };\n                 if !code_block.is_empty() {\n                     self.result.push_str(&self.comment_line_separator);"}, {"sha": "c5419d860c94312952f19dcaf26130e7cf1bfa35", "filename": "src/tools/rustfmt/src/config/mod.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fconfig%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fconfig%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fconfig%2Fmod.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -69,6 +69,8 @@ create_config! {\n     format_macro_matchers: bool, false, false,\n         \"Format the metavariable matching patterns in macros\";\n     format_macro_bodies: bool, true, false, \"Format the bodies of macros\";\n+    hex_literal_case: HexLiteralCase, HexLiteralCase::Preserve, false,\n+        \"Format hexadecimal integer literals\";\n \n     // Single line expressions and items\n     empty_item_single_line: bool, true, false,\n@@ -125,7 +127,7 @@ create_config! {\n         \"Add trailing semicolon after break, continue and return\";\n     trailing_comma: SeparatorTactic, SeparatorTactic::Vertical, false,\n         \"How to handle trailing commas for lists\";\n-    match_block_trailing_comma: bool, false, false,\n+    match_block_trailing_comma: bool, false, true,\n         \"Put a trailing comma after a block based match arm (non-block arms are not affected)\";\n     blank_lines_upper_bound: usize, 1, false,\n         \"Maximum number of blank lines which can be put between items\";\n@@ -136,6 +138,7 @@ create_config! {\n     inline_attribute_width: usize, 0, false,\n         \"Write an item and its attribute on the same line \\\n         if their combined width is below a threshold\";\n+    format_generated_files: bool, false, false, \"Format generated files\";\n \n     // Options that can change the source code beyond whitespace/blocks (somewhat linty things)\n     merge_derives: bool, true, true, \"Merge multiple `#[derive(...)]` into a single one\";\n@@ -152,7 +155,7 @@ create_config! {\n         \"Require a specific version of rustfmt\";\n     unstable_features: bool, false, false,\n             \"Enables unstable features. Only available on nightly channel\";\n-    disable_all_formatting: bool, false, false, \"Don't reformat anything\";\n+    disable_all_formatting: bool, false, true, \"Don't reformat anything\";\n     skip_children: bool, false, false, \"Don't reformat out of line modules\";\n     hide_parse_errors: bool, false, false, \"Hide errors from the parser\";\n     error_on_line_overflow: bool, false, false, \"Error if unable to get all lines within max_width\";\n@@ -569,6 +572,7 @@ license_template_path = \"\"\n format_strings = false\n format_macro_matchers = false\n format_macro_bodies = true\n+hex_literal_case = \"Preserve\"\n empty_item_single_line = true\n struct_lit_single_line = true\n fn_single_line = false\n@@ -604,6 +608,7 @@ blank_lines_lower_bound = 0\n edition = \"2015\"\n version = \"One\"\n inline_attribute_width = 0\n+format_generated_files = false\n merge_derives = true\n use_try_shorthand = false\n use_field_init_shorthand = false"}, {"sha": "e92f8e8a53152e666cec884eae3a8808bcf40d18", "filename": "src/tools/rustfmt/src/config/options.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fconfig%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fconfig%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fconfig%2Foptions.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -125,6 +125,19 @@ pub enum ImportGranularity {\n     Module,\n     /// Use one `use` statement per imported item.\n     Item,\n+    /// Use one `use` statement including all items.\n+    One,\n+}\n+\n+/// Controls how rustfmt should handle case in hexadecimal literals.\n+#[config_type]\n+pub enum HexLiteralCase {\n+    /// Leave the literal as-is\n+    Preserve,\n+    /// Ensure all literals use uppercase lettering\n+    Upper,\n+    /// Ensure all literals use lowercase lettering\n+    Lower,\n }\n \n #[config_type]"}, {"sha": "7f1dd363f9379a3bd971dbf87c93e4a0955a0cab", "filename": "src/tools/rustfmt/src/expr.rs", "status": "modified", "additions": 37, "deletions": 9, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fexpr.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -13,7 +13,7 @@ use crate::comment::{\n     rewrite_missing_comment, CharClasses, FindUncommented,\n };\n use crate::config::lists::*;\n-use crate::config::{Config, ControlBraceStyle, IndentStyle, Version};\n+use crate::config::{Config, ControlBraceStyle, HexLiteralCase, IndentStyle, Version};\n use crate::lists::{\n     definitive_tactic, itemize_list, shape_for_tactic, struct_lit_formatting, struct_lit_shape,\n     struct_lit_tactic, write_list, ListFormatting, Separator,\n@@ -822,7 +822,7 @@ impl<'a> ControlFlow<'a> {\n             let pat_string = pat.rewrite(context, pat_shape)?;\n             let comments_lo = context\n                 .snippet_provider\n-                .span_after(self.span, self.connector.trim());\n+                .span_after(self.span.with_lo(pat.span.hi()), self.connector.trim());\n             let comments_span = mk_sp(comments_lo, expr.span.lo());\n             return rewrite_assign_rhs_with_comments(\n                 context,\n@@ -1168,6 +1168,7 @@ pub(crate) fn rewrite_literal(\n ) -> Option<String> {\n     match l.kind {\n         ast::LitKind::Str(_, ast::StrStyle::Cooked) => rewrite_string_lit(context, l.span, shape),\n+        ast::LitKind::Int(..) => rewrite_int_lit(context, l, shape),\n         _ => wrap_str(\n             context.snippet(l.span).to_owned(),\n             context.config.max_width(),\n@@ -1202,6 +1203,36 @@ fn rewrite_string_lit(context: &RewriteContext<'_>, span: Span, shape: Shape) ->\n     )\n }\n \n+fn rewrite_int_lit(context: &RewriteContext<'_>, lit: &ast::Lit, shape: Shape) -> Option<String> {\n+    let span = lit.span;\n+    let symbol = lit.token.symbol.as_str();\n+\n+    if symbol.starts_with(\"0x\") {\n+        let hex_lit = match context.config.hex_literal_case() {\n+            HexLiteralCase::Preserve => None,\n+            HexLiteralCase::Upper => Some(symbol[2..].to_ascii_uppercase()),\n+            HexLiteralCase::Lower => Some(symbol[2..].to_ascii_lowercase()),\n+        };\n+        if let Some(hex_lit) = hex_lit {\n+            return wrap_str(\n+                format!(\n+                    \"0x{}{}\",\n+                    hex_lit,\n+                    lit.token.suffix.map_or(String::new(), |s| s.to_string())\n+                ),\n+                context.config.max_width(),\n+                shape,\n+            );\n+        }\n+    }\n+\n+    wrap_str(\n+        context.snippet(span).to_owned(),\n+        context.config.max_width(),\n+        shape,\n+    )\n+}\n+\n fn choose_separator_tactic(context: &RewriteContext<'_>, span: Span) -> Option<SeparatorTactic> {\n     if context.inside_macro() {\n         if span_ends_with_comma(context, span) {\n@@ -1497,12 +1528,12 @@ fn rewrite_struct_lit<'a>(\n     let path_shape = shape.sub_width(2)?;\n     let path_str = rewrite_path(context, PathContext::Expr, None, path, path_shape)?;\n \n-    let has_base = match struct_rest {\n+    let has_base_or_rest = match struct_rest {\n         ast::StructRest::None if fields.is_empty() => return Some(format!(\"{} {{}}\", path_str)),\n         ast::StructRest::Rest(_) if fields.is_empty() => {\n             return Some(format!(\"{} {{ .. }}\", path_str));\n         }\n-        ast::StructRest::Base(_) => true,\n+        ast::StructRest::Rest(_) | ast::StructRest::Base(_) => true,\n         _ => false,\n     };\n \n@@ -1511,7 +1542,7 @@ fn rewrite_struct_lit<'a>(\n \n     let one_line_width = h_shape.map_or(0, |shape| shape.width);\n     let body_lo = context.snippet_provider.span_after(span, \"{\");\n-    let fields_str = if struct_lit_can_be_aligned(fields, has_base)\n+    let fields_str = if struct_lit_can_be_aligned(fields, has_base_or_rest)\n         && context.config.struct_field_align_threshold() > 0\n     {\n         rewrite_with_alignment(\n@@ -1583,10 +1614,7 @@ fn rewrite_struct_lit<'a>(\n             nested_shape,\n             tactic,\n             context,\n-            force_no_trailing_comma\n-                || has_base\n-                || !context.use_block_indent()\n-                || matches!(struct_rest, ast::StructRest::Rest(_)),\n+            force_no_trailing_comma || has_base_or_rest || !context.use_block_indent(),\n         );\n \n         write_list(&item_vec, &fmt)?"}, {"sha": "9ef47b887cadb8809345b1dc196017bbbad92c59", "filename": "src/tools/rustfmt/src/formatting.rs", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fformatting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fformatting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fformatting.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -10,6 +10,7 @@ use rustc_span::Span;\n use self::newline_style::apply_newline_style;\n use crate::comment::{CharClasses, FullCodeCharKind};\n use crate::config::{Config, FileName, Verbosity};\n+use crate::formatting::generated::is_generated_file;\n use crate::issues::BadIssueSeeker;\n use crate::modules::Module;\n use crate::syntux::parser::{DirectoryOwnership, Parser, ParserError};\n@@ -18,6 +19,7 @@ use crate::utils::count_newlines;\n use crate::visitor::FmtVisitor;\n use crate::{modules, source_file, ErrorKind, FormatReport, Input, Session};\n \n+mod generated;\n mod newline_style;\n \n // A map of the files of a crate, with their new content\n@@ -103,7 +105,12 @@ fn format_project<T: FormatHandler>(\n     context.parse_session.set_silent_emitter();\n \n     for (path, module) in files {\n-        let should_ignore = !input_is_stdin && context.ignore_file(&path);\n+        let source_file = context.parse_session.span_to_file_contents(module.span);\n+        let src = source_file.src.as_ref().expect(\"SourceFile without src\");\n+\n+        let should_ignore = (!input_is_stdin && context.ignore_file(&path))\n+            || (!config.format_generated_files() && is_generated_file(src));\n+\n         if (config.skip_children() && path != main_file) || should_ignore {\n             continue;\n         }"}, {"sha": "58f43f17ee15f5c4b12af2dda56ae182efbc542a", "filename": "src/tools/rustfmt/src/formatting/generated.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fformatting%2Fgenerated.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fformatting%2Fgenerated.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fformatting%2Fgenerated.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,7 @@\n+/// Returns `true` if the given span is a part of generated files.\n+pub(super) fn is_generated_file(original_snippet: &str) -> bool {\n+    original_snippet\n+        .lines()\n+        .take(5) // looking for marker only in the beginning of the file\n+        .any(|line| line.contains(\"@generated\"))\n+}"}, {"sha": "5ac799366894de843dd6250a97adc2786a1cc1e4", "filename": "src/tools/rustfmt/src/imports.rs", "status": "modified", "additions": 128, "deletions": 18, "changes": 146, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fimports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fimports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fimports.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -138,6 +138,29 @@ impl UseSegment {\n         }\n     }\n \n+    // Check if self == other with their aliases removed.\n+    fn equal_except_alias(&self, other: &Self) -> bool {\n+        match (self, other) {\n+            (UseSegment::Ident(ref s1, _), UseSegment::Ident(ref s2, _)) => s1 == s2,\n+            (UseSegment::Slf(_), UseSegment::Slf(_))\n+            | (UseSegment::Super(_), UseSegment::Super(_))\n+            | (UseSegment::Crate(_), UseSegment::Crate(_))\n+            | (UseSegment::Glob, UseSegment::Glob) => true,\n+            (UseSegment::List(ref list1), UseSegment::List(ref list2)) => list1 == list2,\n+            _ => false,\n+        }\n+    }\n+\n+    fn get_alias(&self) -> Option<&str> {\n+        match self {\n+            UseSegment::Ident(_, a)\n+            | UseSegment::Slf(a)\n+            | UseSegment::Super(a)\n+            | UseSegment::Crate(a) => a.as_deref(),\n+            _ => None,\n+        }\n+    }\n+\n     fn from_path_segment(\n         context: &RewriteContext<'_>,\n         path_seg: &ast::PathSegment,\n@@ -558,6 +581,7 @@ impl UseTree {\n                 SharedPrefix::Module => {\n                     self.path[..self.path.len() - 1] == other.path[..other.path.len() - 1]\n                 }\n+                SharedPrefix::One => true,\n             }\n         }\n     }\n@@ -598,7 +622,7 @@ impl UseTree {\n     fn merge(&mut self, other: &UseTree, merge_by: SharedPrefix) {\n         let mut prefix = 0;\n         for (a, b) in self.path.iter().zip(other.path.iter()) {\n-            if *a == *b {\n+            if a.equal_except_alias(b) {\n                 prefix += 1;\n             } else {\n                 break;\n@@ -633,14 +657,20 @@ fn merge_rest(\n             return Some(new_path);\n         }\n     } else if len == 1 {\n-        let rest = if a.len() == len { &b[1..] } else { &a[1..] };\n-        return Some(vec![\n-            b[0].clone(),\n-            UseSegment::List(vec![\n-                UseTree::from_path(vec![UseSegment::Slf(None)], DUMMY_SP),\n-                UseTree::from_path(rest.to_vec(), DUMMY_SP),\n-            ]),\n-        ]);\n+        let (common, rest) = if a.len() == len {\n+            (&a[0], &b[1..])\n+        } else {\n+            (&b[0], &a[1..])\n+        };\n+        let mut list = vec![UseTree::from_path(\n+            vec![UseSegment::Slf(common.get_alias().map(ToString::to_string))],\n+            DUMMY_SP,\n+        )];\n+        match rest {\n+            [UseSegment::List(rest_list)] => list.extend(rest_list.clone()),\n+            _ => list.push(UseTree::from_path(rest.to_vec(), DUMMY_SP)),\n+        }\n+        return Some(vec![b[0].clone(), UseSegment::List(list)]);\n     } else {\n         len -= 1;\n     }\n@@ -655,18 +685,54 @@ fn merge_rest(\n }\n \n fn merge_use_trees_inner(trees: &mut Vec<UseTree>, use_tree: UseTree, merge_by: SharedPrefix) {\n-    let similar_trees = trees\n-        .iter_mut()\n-        .filter(|tree| tree.share_prefix(&use_tree, merge_by));\n+    struct SimilarTree<'a> {\n+        similarity: usize,\n+        path_len: usize,\n+        tree: &'a mut UseTree,\n+    }\n+\n+    let similar_trees = trees.iter_mut().filter_map(|tree| {\n+        if tree.share_prefix(&use_tree, merge_by) {\n+            // In the case of `SharedPrefix::One`, `similarity` is used for deciding with which\n+            // tree `use_tree` should be merge.\n+            // In other cases `similarity` won't be used, so set it to `0` as a dummy value.\n+            let similarity = if merge_by == SharedPrefix::One {\n+                tree.path\n+                    .iter()\n+                    .zip(&use_tree.path)\n+                    .take_while(|(a, b)| a.equal_except_alias(b))\n+                    .count()\n+            } else {\n+                0\n+            };\n+\n+            let path_len = tree.path.len();\n+            Some(SimilarTree {\n+                similarity,\n+                tree,\n+                path_len,\n+            })\n+        } else {\n+            None\n+        }\n+    });\n+\n     if use_tree.path.len() == 1 && merge_by == SharedPrefix::Crate {\n-        if let Some(tree) = similar_trees.min_by_key(|tree| tree.path.len()) {\n-            if tree.path.len() == 1 {\n+        if let Some(tree) = similar_trees.min_by_key(|tree| tree.path_len) {\n+            if tree.path_len == 1 {\n+                return;\n+            }\n+        }\n+    } else if merge_by == SharedPrefix::One {\n+        if let Some(sim_tree) = similar_trees.max_by_key(|tree| tree.similarity) {\n+            if sim_tree.similarity > 0 {\n+                sim_tree.tree.merge(&use_tree, merge_by);\n                 return;\n             }\n         }\n-    } else if let Some(tree) = similar_trees.max_by_key(|tree| tree.path.len()) {\n-        if tree.path.len() > 1 {\n-            tree.merge(&use_tree, merge_by);\n+    } else if let Some(sim_tree) = similar_trees.max_by_key(|tree| tree.path_len) {\n+        if sim_tree.path_len > 1 {\n+            sim_tree.tree.merge(&use_tree, merge_by);\n             return;\n         }\n     }\n@@ -880,6 +946,7 @@ impl Rewrite for UseTree {\n pub(crate) enum SharedPrefix {\n     Crate,\n     Module,\n+    One,\n }\n \n #[cfg(test)]\n@@ -904,7 +971,7 @@ mod test {\n             }\n \n             fn eat(&mut self, c: char) {\n-                assert!(self.input.next().unwrap() == c);\n+                assert_eq!(self.input.next().unwrap(), c);\n             }\n \n             fn push_segment(\n@@ -1094,6 +1161,49 @@ mod test {\n         );\n     }\n \n+    #[test]\n+    fn test_use_tree_merge_one() {\n+        test_merge!(One, [\"a\", \"b\"], [\"{a, b}\"]);\n+\n+        test_merge!(One, [\"a::{aa, ab}\", \"b\", \"a\"], [\"{a::{self, aa, ab}, b}\"]);\n+\n+        test_merge!(One, [\"a as x\", \"b as y\"], [\"{a as x, b as y}\"]);\n+\n+        test_merge!(\n+            One,\n+            [\"a::{aa as xa, ab}\", \"b\", \"a\"],\n+            [\"{a::{self, aa as xa, ab}, b}\"]\n+        );\n+\n+        test_merge!(\n+            One,\n+            [\"a\", \"a::{aa, ab::{aba, abb}}\"],\n+            [\"a::{self, aa, ab::{aba, abb}}\"]\n+        );\n+\n+        test_merge!(One, [\"a\", \"b::{ba, *}\"], [\"{a, b::{ba, *}}\"]);\n+\n+        test_merge!(One, [\"a\", \"b\", \"a::aa\"], [\"{a::{self, aa}, b}\"]);\n+\n+        test_merge!(\n+            One,\n+            [\"a::aa::aaa\", \"a::ac::aca\", \"a::aa::*\"],\n+            [\"a::{aa::{aaa, *}, ac::aca}\"]\n+        );\n+\n+        test_merge!(\n+            One,\n+            [\"a\", \"b::{ba, bb}\", \"a::{aa::*, ab::aba}\"],\n+            [\"{a::{self, aa::*, ab::aba}, b::{ba, bb}}\"]\n+        );\n+\n+        test_merge!(\n+            One,\n+            [\"b\", \"a::ac::{aca, acb}\", \"a::{aa::*, ab}\"],\n+            [\"{a::{aa::*, ab, ac::{aca, acb}}, b}\"]\n+        );\n+    }\n+\n     #[test]\n     fn test_flatten_use_trees() {\n         assert_eq!("}, {"sha": "1cb1a2701c36bf24f78109c56c45d320c4da2806", "filename": "src/tools/rustfmt/src/items.rs", "status": "modified", "additions": 73, "deletions": 73, "changes": 146, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fitems.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -174,14 +174,14 @@ pub(crate) struct FnSig<'a> {\n     constness: ast::Const,\n     defaultness: ast::Defaultness,\n     unsafety: ast::Unsafe,\n-    visibility: ast::Visibility,\n+    visibility: &'a ast::Visibility,\n }\n \n impl<'a> FnSig<'a> {\n     pub(crate) fn from_method_sig(\n         method_sig: &'a ast::FnSig,\n         generics: &'a ast::Generics,\n-        visibility: ast::Visibility,\n+        visibility: &'a ast::Visibility,\n     ) -> FnSig<'a> {\n         FnSig {\n             unsafety: method_sig.header.unsafety,\n@@ -204,7 +204,7 @@ impl<'a> FnSig<'a> {\n         match *fn_kind {\n             visit::FnKind::Fn(fn_ctxt, _, fn_sig, vis, _) => match fn_ctxt {\n                 visit::FnCtxt::Assoc(..) => {\n-                    let mut fn_sig = FnSig::from_method_sig(fn_sig, generics, vis.clone());\n+                    let mut fn_sig = FnSig::from_method_sig(fn_sig, generics, vis);\n                     fn_sig.defaultness = defaultness;\n                     fn_sig\n                 }\n@@ -216,7 +216,7 @@ impl<'a> FnSig<'a> {\n                     is_async: Cow::Borrowed(&fn_sig.header.asyncness),\n                     defaultness,\n                     unsafety: fn_sig.header.unsafety,\n-                    visibility: vis.clone(),\n+                    visibility: vis,\n                 },\n             },\n             _ => unreachable!(),\n@@ -323,6 +323,7 @@ impl<'a> FmtVisitor<'a> {\n         indent: Indent,\n         ident: symbol::Ident,\n         sig: &ast::FnSig,\n+        vis: &ast::Visibility,\n         generics: &ast::Generics,\n         span: Span,\n     ) -> Option<String> {\n@@ -334,7 +335,7 @@ impl<'a> FmtVisitor<'a> {\n             &context,\n             indent,\n             ident,\n-            &FnSig::from_method_sig(sig, generics, DEFAULT_VISIBILITY),\n+            &FnSig::from_method_sig(sig, generics, vis),\n             span,\n             FnBraceStyle::None,\n         )?;\n@@ -1474,12 +1475,17 @@ fn format_tuple_struct(\n         format_empty_struct_or_tuple(context, inner_span, offset, &mut result, \"(\", \")\");\n     } else {\n         let shape = Shape::indented(offset, context.config).sub_width(1)?;\n+        let lo = if let Some(generics) = struct_parts.generics {\n+            generics.span.hi()\n+        } else {\n+            struct_parts.ident.span.hi()\n+        };\n         result = overflow::rewrite_with_parens(\n             context,\n             &result,\n             fields.iter(),\n             shape,\n-            span,\n+            mk_sp(lo, span.hi()),\n             context.config.fn_call_width(),\n             None,\n         )?;\n@@ -1503,7 +1509,7 @@ fn format_tuple_struct(\n     Some(result)\n }\n \n-fn rewrite_type<R: Rewrite>(\n+pub(crate) fn rewrite_type<R: Rewrite>(\n     context: &RewriteContext<'_>,\n     indent: Indent,\n     ident: symbol::Ident,\n@@ -1760,7 +1766,7 @@ impl<'a> StaticParts<'a> {\n         };\n         StaticParts {\n             prefix: \"const\",\n-            vis: &DEFAULT_VISIBILITY,\n+            vis: &ti.vis,\n             ident: ti.ident,\n             ty,\n             mutability: ast::Mutability::Not,\n@@ -1847,29 +1853,6 @@ fn rewrite_static(\n         Some(format!(\"{}{};\", prefix, ty_str))\n     }\n }\n-\n-pub(crate) fn rewrite_type_alias(\n-    ident: symbol::Ident,\n-    ty_opt: Option<&ptr::P<ast::Ty>>,\n-    generics: &ast::Generics,\n-    generic_bounds_opt: Option<&ast::GenericBounds>,\n-    context: &RewriteContext<'_>,\n-    indent: Indent,\n-    vis: &ast::Visibility,\n-    span: Span,\n-) -> Option<String> {\n-    rewrite_type(\n-        context,\n-        indent,\n-        ident,\n-        vis,\n-        generics,\n-        generic_bounds_opt,\n-        ty_opt,\n-        span,\n-    )\n-}\n-\n struct OpaqueType<'a> {\n     bounds: &'a ast::GenericBounds,\n }\n@@ -1883,32 +1866,7 @@ impl<'a> Rewrite for OpaqueType<'a> {\n     }\n }\n \n-pub(crate) fn rewrite_opaque_impl_type(\n-    context: &RewriteContext<'_>,\n-    ident: symbol::Ident,\n-    generics: &ast::Generics,\n-    generic_bounds: &ast::GenericBounds,\n-    indent: Indent,\n-) -> Option<String> {\n-    let ident_str = rewrite_ident(context, ident);\n-    // 5 = \"type \"\n-    let generics_shape = Shape::indented(indent, context.config).offset_left(5)?;\n-    let generics_str = rewrite_generics(context, ident_str, generics, generics_shape)?;\n-    let prefix = format!(\"type {} =\", generics_str);\n-    let rhs = OpaqueType {\n-        bounds: generic_bounds,\n-    };\n-\n-    rewrite_assign_rhs(\n-        context,\n-        &prefix,\n-        &rhs,\n-        Shape::indented(indent, context.config).sub_width(1)?,\n-    )\n-    .map(|s| s + \";\")\n-}\n-\n-pub(crate) fn rewrite_associated_impl_type(\n+pub(crate) fn rewrite_impl_type(\n     ident: symbol::Ident,\n     vis: &ast::Visibility,\n     defaultness: ast::Defaultness,\n@@ -1918,7 +1876,25 @@ pub(crate) fn rewrite_associated_impl_type(\n     indent: Indent,\n     span: Span,\n ) -> Option<String> {\n-    let result = rewrite_type_alias(ident, ty_opt, generics, None, context, indent, vis, span)?;\n+    // Opaque type\n+    let result = if let Some(rustc_ast::ast::Ty {\n+        kind: ast::TyKind::ImplTrait(_, ref bounds),\n+        ..\n+    }) = ty_opt.map(|t| &**t)\n+    {\n+        rewrite_type(\n+            context,\n+            indent,\n+            ident,\n+            &DEFAULT_VISIBILITY,\n+            generics,\n+            None,\n+            Some(&OpaqueType { bounds }),\n+            span,\n+        )\n+    } else {\n+        rewrite_type(context, indent, ident, vis, generics, None, ty_opt, span)\n+    }?;\n \n     match defaultness {\n         ast::Defaultness::Default(..) => Some(format!(\"default {}\", result)),\n@@ -1995,14 +1971,17 @@ impl Rewrite for ast::Param {\n         let param_attrs_result = self\n             .attrs\n             .rewrite(context, Shape::legacy(shape.width, shape.indent))?;\n-        let (span, has_multiple_attr_lines) = if !self.attrs.is_empty() {\n+        // N.B. Doc comments aren't typically valid syntax, but could appear\n+        // in the presence of certain macros - https://github.com/rust-lang/rustfmt/issues/4936\n+        let (span, has_multiple_attr_lines, has_doc_comments) = if !self.attrs.is_empty() {\n             let num_attrs = self.attrs.len();\n             (\n                 mk_sp(self.attrs[num_attrs - 1].span.hi(), self.pat.span.lo()),\n                 param_attrs_result.contains('\\n'),\n+                self.attrs.iter().any(|a| a.is_doc_comment()),\n             )\n         } else {\n-            (mk_sp(self.span.lo(), self.span.lo()), false)\n+            (mk_sp(self.span.lo(), self.span.lo()), false, false)\n         };\n \n         if let Some(ref explicit_self) = self.to_self() {\n@@ -2015,15 +1994,16 @@ impl Rewrite for ast::Param {\n                 has_multiple_attr_lines,\n             )\n         } else if is_named_param(self) {\n+            let param_name = &self\n+                .pat\n+                .rewrite(context, Shape::legacy(shape.width, shape.indent))?;\n             let mut result = combine_strs_with_missing_comments(\n                 context,\n                 &param_attrs_result,\n-                &self\n-                    .pat\n-                    .rewrite(context, Shape::legacy(shape.width, shape.indent))?,\n+                param_name,\n                 span,\n                 shape,\n-                !has_multiple_attr_lines,\n+                !has_multiple_attr_lines && !has_doc_comments,\n             )?;\n \n             if !is_empty_infer(&*self.ty, self.pat.span) {\n@@ -2034,10 +2014,30 @@ impl Rewrite for ast::Param {\n                 result.push_str(&after_comment);\n                 let overhead = last_line_width(&result);\n                 let max_width = shape.width.checked_sub(overhead)?;\n-                let ty_str = self\n+                if let Some(ty_str) = self\n                     .ty\n-                    .rewrite(context, Shape::legacy(max_width, shape.indent))?;\n-                result.push_str(&ty_str);\n+                    .rewrite(context, Shape::legacy(max_width, shape.indent))\n+                {\n+                    result.push_str(&ty_str);\n+                } else {\n+                    result = combine_strs_with_missing_comments(\n+                        context,\n+                        &(param_attrs_result + &shape.to_string_with_newline(context.config)),\n+                        param_name,\n+                        span,\n+                        shape,\n+                        !has_multiple_attr_lines,\n+                    )?;\n+                    result.push_str(&before_comment);\n+                    result.push_str(colon_spaces(context.config));\n+                    result.push_str(&after_comment);\n+                    let overhead = last_line_width(&result);\n+                    let max_width = shape.width.checked_sub(overhead)?;\n+                    let ty_str = self\n+                        .ty\n+                        .rewrite(context, Shape::legacy(max_width, shape.indent))?;\n+                    result.push_str(&ty_str);\n+                }\n             }\n \n             Some(result)\n@@ -3146,7 +3146,7 @@ impl Rewrite for ast::ForeignItem {\n                         context,\n                         shape.indent,\n                         self.ident,\n-                        &FnSig::from_method_sig(&fn_sig, generics, self.vis.clone()),\n+                        &FnSig::from_method_sig(&fn_sig, generics, &self.vis),\n                         span,\n                         FnBraceStyle::None,\n                     )\n@@ -3170,14 +3170,14 @@ impl Rewrite for ast::ForeignItem {\n             ast::ForeignItemKind::TyAlias(ref ty_alias_kind) => {\n                 let ast::TyAliasKind(_, ref generics, ref generic_bounds, ref type_default) =\n                     **ty_alias_kind;\n-                rewrite_type_alias(\n-                    self.ident,\n-                    type_default.as_ref(),\n-                    generics,\n-                    Some(generic_bounds),\n+                rewrite_type(\n                     &context,\n                     shape.indent,\n+                    self.ident,\n                     &self.vis,\n+                    generics,\n+                    Some(generic_bounds),\n+                    type_default.as_ref(),\n                     self.span,\n                 )\n             }"}, {"sha": "c04b4787616933e84528d1695a386eefce5769ab", "filename": "src/tools/rustfmt/src/lists.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Flists.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Flists.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Flists.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -367,9 +367,9 @@ where\n             result.push_str(&comment);\n \n             if !inner_item.is_empty() {\n-                if tactic == DefinitiveListTactic::Vertical || tactic == DefinitiveListTactic::Mixed\n-                {\n-                    // We cannot keep pre-comments on the same line if the comment if normalized.\n+                use DefinitiveListTactic::*;\n+                if matches!(tactic, Vertical | Mixed | SpecialMacro(_)) {\n+                    // We cannot keep pre-comments on the same line if the comment is normalized.\n                     let keep_comment = if formatting.config.normalize_comments()\n                         || item.pre_comment_style == ListItemCommentStyle::DifferentLine\n                     {\n@@ -389,7 +389,7 @@ where\n                         line_len = item.item.as_ref().map_or(0, |s| unicode_str_width(&s));\n                     }\n                 } else {\n-                    result.push(' ');\n+                    result.push(' ')\n                 }\n             }\n             item_max_width = None;"}, {"sha": "5a6ed0ec06e55a37ca203bafdbd9625a2ad3ce4c", "filename": "src/tools/rustfmt/src/matches.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fmatches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fmatches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fmatches.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -409,6 +409,7 @@ fn rewrite_match_body(\n             }\n             result.push_str(&nested_indent_str);\n             result.push_str(&body_str);\n+            result.push_str(&comma);\n             return Some(result);\n         }\n "}, {"sha": "28edcb784b40ee17030a7660087803dfc347b866", "filename": "src/tools/rustfmt/src/missed_spans.rs", "status": "modified", "additions": 12, "deletions": 8, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fmissed_spans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fmissed_spans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fmissed_spans.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -51,21 +51,25 @@ impl<'a> FmtVisitor<'a> {\n     }\n \n     pub(crate) fn format_missing_with_indent(&mut self, end: BytePos) {\n+        self.format_missing_indent(end, true)\n+    }\n+\n+    pub(crate) fn format_missing_no_indent(&mut self, end: BytePos) {\n+        self.format_missing_indent(end, false)\n+    }\n+\n+    fn format_missing_indent(&mut self, end: BytePos, should_indent: bool) {\n         let config = self.config;\n         self.format_missing_inner(end, |this, last_snippet, snippet| {\n             this.push_str(last_snippet.trim_end());\n             if last_snippet == snippet && !this.output_at_start() {\n                 // No new lines in the snippet.\n                 this.push_str(\"\\n\");\n             }\n-            let indent = this.block_indent.to_string(config);\n-            this.push_str(&indent);\n-        })\n-    }\n-\n-    pub(crate) fn format_missing_no_indent(&mut self, end: BytePos) {\n-        self.format_missing_inner(end, |this, last_snippet, _| {\n-            this.push_str(last_snippet.trim_end());\n+            if should_indent {\n+                let indent = this.block_indent.to_string(config);\n+                this.push_str(&indent);\n+            }\n         })\n     }\n "}, {"sha": "ac24181c7805258b89c053d6c444a65709f79af6", "filename": "src/tools/rustfmt/src/overflow.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Foverflow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Foverflow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Foverflow.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -77,6 +77,7 @@ pub(crate) enum OverflowableItem<'a> {\n     FieldDef(&'a ast::FieldDef),\n     TuplePatField(&'a TuplePatField<'a>),\n     Ty(&'a ast::Ty),\n+    Pat(&'a ast::Pat),\n }\n \n impl<'a> Rewrite for OverflowableItem<'a> {\n@@ -116,6 +117,7 @@ impl<'a> OverflowableItem<'a> {\n             OverflowableItem::FieldDef(sf) => f(*sf),\n             OverflowableItem::TuplePatField(pat) => f(*pat),\n             OverflowableItem::Ty(ty) => f(*ty),\n+            OverflowableItem::Pat(pat) => f(*pat),\n         }\n     }\n \n@@ -232,7 +234,7 @@ macro_rules! impl_into_overflowable_item_for_rustfmt_types {\n     }\n }\n \n-impl_into_overflowable_item_for_ast_node!(Expr, GenericParam, NestedMetaItem, FieldDef, Ty);\n+impl_into_overflowable_item_for_ast_node!(Expr, GenericParam, NestedMetaItem, FieldDef, Ty, Pat);\n impl_into_overflowable_item_for_rustfmt_types!([MacroArg], [SegmentParam, TuplePatField]);\n \n pub(crate) fn into_overflowable_list<'a, T>("}, {"sha": "ba8d8024a9707c34ef31c4eae24665eb99f5f39d", "filename": "src/tools/rustfmt/src/patterns.rs", "status": "modified", "additions": 18, "deletions": 6, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fpatterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fpatterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fpatterns.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -4,6 +4,7 @@ use rustc_span::{BytePos, Span};\n \n use crate::comment::{combine_strs_with_missing_comments, FindUncommented};\n use crate::config::lists::*;\n+use crate::config::Version;\n use crate::expr::{can_be_overflowed_expr, rewrite_unary_prefix, wrap_struct_field};\n use crate::lists::{\n     definitive_tactic, itemize_list, shape_for_tactic, struct_lit_formatting, struct_lit_shape,\n@@ -226,12 +227,13 @@ impl Rewrite for Pat {\n             PatKind::Path(ref q_self, ref path) => {\n                 rewrite_path(context, PathContext::Expr, q_self.as_ref(), path, shape)\n             }\n-            PatKind::TupleStruct(_, ref path, ref pat_vec) => {\n-                let path_str = rewrite_path(context, PathContext::Expr, None, path, shape)?;\n+            PatKind::TupleStruct(ref q_self, ref path, ref pat_vec) => {\n+                let path_str =\n+                    rewrite_path(context, PathContext::Expr, q_self.as_ref(), path, shape)?;\n                 rewrite_tuple_pat(pat_vec, Some(path_str), self.span, context, shape)\n             }\n             PatKind::Lit(ref expr) => expr.rewrite(context, shape),\n-            PatKind::Slice(ref slice_pat) => {\n+            PatKind::Slice(ref slice_pat) if context.config.version() == Version::One => {\n                 let rw: Vec<String> = slice_pat\n                     .iter()\n                     .map(|p| {\n@@ -244,8 +246,17 @@ impl Rewrite for Pat {\n                     .collect();\n                 Some(format!(\"[{}]\", rw.join(\", \")))\n             }\n-            PatKind::Struct(_, ref path, ref fields, ellipsis) => {\n-                rewrite_struct_pat(path, fields, ellipsis, self.span, context, shape)\n+            PatKind::Slice(ref slice_pat) => overflow::rewrite_with_square_brackets(\n+                context,\n+                \"\",\n+                slice_pat.iter(),\n+                shape,\n+                self.span,\n+                None,\n+                None,\n+            ),\n+            PatKind::Struct(ref qself, ref path, ref fields, ellipsis) => {\n+                rewrite_struct_pat(qself, path, fields, ellipsis, self.span, context, shape)\n             }\n             PatKind::MacCall(ref mac) => {\n                 rewrite_macro(mac, None, context, shape, MacroPosition::Pat)\n@@ -258,6 +269,7 @@ impl Rewrite for Pat {\n }\n \n fn rewrite_struct_pat(\n+    qself: &Option<ast::QSelf>,\n     path: &ast::Path,\n     fields: &[ast::PatField],\n     ellipsis: bool,\n@@ -267,7 +279,7 @@ fn rewrite_struct_pat(\n ) -> Option<String> {\n     // 2 =  ` {`\n     let path_shape = shape.sub_width(2)?;\n-    let path_str = rewrite_path(context, PathContext::Expr, None, path, path_shape)?;\n+    let path_str = rewrite_path(context, PathContext::Expr, qself.as_ref(), path, path_shape)?;\n \n     if fields.is_empty() && !ellipsis {\n         return Some(format!(\"{} {{}}\", path_str));"}, {"sha": "2c58350d4feb6d8e0bf9a3cbfc15d084a0af73a7", "filename": "src/tools/rustfmt/src/reorder.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Freorder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Freorder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Freorder.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -113,6 +113,7 @@ fn rewrite_reorderable_or_regroupable_items(\n                     merge_use_trees(normalized_items, SharedPrefix::Module)\n                 }\n                 ImportGranularity::Item => flatten_use_trees(normalized_items),\n+                ImportGranularity::One => merge_use_trees(normalized_items, SharedPrefix::One),\n                 ImportGranularity::Preserve => normalized_items,\n             };\n "}, {"sha": "8e6c75a3744ac6a8e4b1e0c6a7460f664ff09b0d", "filename": "src/tools/rustfmt/src/spanned.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fspanned.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fspanned.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fspanned.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -104,7 +104,7 @@ impl Spanned for ast::Arm {\n impl Spanned for ast::Param {\n     fn span(&self) -> Span {\n         if crate::items::is_named_param(self) {\n-            mk_sp(self.pat.span.lo(), self.ty.span.hi())\n+            mk_sp(crate::items::span_lo_for_param(self), self.ty.span.hi())\n         } else {\n             self.ty.span\n         }"}, {"sha": "946c076d9f2d1fdf388b19156c5c2a7b5ca254e0", "filename": "src/tools/rustfmt/src/syntux/session.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fsyntux%2Fsession.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fsyntux%2Fsession.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fsyntux%2Fsession.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -175,6 +175,12 @@ impl ParseSess {\n         self.parse_sess.source_map().span_to_filename(span).into()\n     }\n \n+    pub(crate) fn span_to_file_contents(&self, span: Span) -> Lrc<rustc_span::SourceFile> {\n+        self.parse_sess\n+            .source_map()\n+            .lookup_source_file(span.data().lo)\n+    }\n+\n     pub(crate) fn span_to_first_line_string(&self, span: Span) -> String {\n         let file_lines = self.parse_sess.source_map().span_to_lines(span).ok();\n "}, {"sha": "48d61289a9b8f34a25d89237f5842a1d4245ed29", "filename": "src/tools/rustfmt/src/test/mod.rs", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Ftest%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Ftest%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Ftest%2Fmod.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -469,11 +469,6 @@ fn stdin_works_with_modified_lines() {\n #[test]\n fn stdin_disable_all_formatting_test() {\n     init_log();\n-    match option_env!(\"CFG_RELEASE_CHANNEL\") {\n-        None | Some(\"nightly\") => {}\n-        // These tests require nightly.\n-        _ => return,\n-    }\n     let input = String::from(\"fn main() { println!(\\\"This should not be formatted.\\\"); }\");\n     let mut child = Command::new(rustfmt().to_str().unwrap())\n         .stdin(Stdio::piped())\n@@ -694,7 +689,7 @@ fn read_significant_comments(file_name: &Path) -> HashMap<String, String> {\n     reader\n         .lines()\n         .map(|line| line.expect(\"failed getting line\"))\n-        .take_while(|line| line_regex.is_match(line))\n+        .filter(|line| line_regex.is_match(line))\n         .filter_map(|line| {\n             regex.captures_iter(&line).next().map(|capture| {\n                 ("}, {"sha": "62c05ba078c56facce55f848d2b4cee53e0a1c78", "filename": "src/tools/rustfmt/src/types.rs", "status": "modified", "additions": 78, "deletions": 57, "changes": 135, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Ftypes.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -169,31 +169,38 @@ impl<'a> Rewrite for SegmentParam<'a> {\n             SegmentParam::Const(const_) => const_.rewrite(context, shape),\n             SegmentParam::LifeTime(lt) => lt.rewrite(context, shape),\n             SegmentParam::Type(ty) => ty.rewrite(context, shape),\n-            SegmentParam::Binding(assoc_ty_constraint) => {\n-                let mut result = match assoc_ty_constraint.kind {\n-                    ast::AssocTyConstraintKind::Bound { .. } => {\n-                        format!(\"{}: \", rewrite_ident(context, assoc_ty_constraint.ident))\n-                    }\n-                    ast::AssocTyConstraintKind::Equality { .. } => {\n-                        match context.config.type_punctuation_density() {\n-                            TypeDensity::Wide => {\n-                                format!(\"{} = \", rewrite_ident(context, assoc_ty_constraint.ident))\n-                            }\n-                            TypeDensity::Compressed => {\n-                                format!(\"{}=\", rewrite_ident(context, assoc_ty_constraint.ident))\n-                            }\n-                        }\n-                    }\n-                };\n+            SegmentParam::Binding(atc) => atc.rewrite(context, shape),\n+        }\n+    }\n+}\n \n-                let budget = shape.width.checked_sub(result.len())?;\n-                let rewrite = assoc_ty_constraint\n-                    .kind\n-                    .rewrite(context, Shape::legacy(budget, shape.indent + result.len()))?;\n-                result.push_str(&rewrite);\n-                Some(result)\n-            }\n+impl Rewrite for ast::AssocTyConstraint {\n+    fn rewrite(&self, context: &RewriteContext<'_>, shape: Shape) -> Option<String> {\n+        use ast::AssocTyConstraintKind::{Bound, Equality};\n+\n+        let mut result = String::with_capacity(128);\n+        result.push_str(rewrite_ident(context, self.ident));\n+\n+        if let Some(ref gen_args) = self.gen_args {\n+            let budget = shape.width.checked_sub(result.len())?;\n+            let shape = Shape::legacy(budget, shape.indent + result.len());\n+            let gen_str = rewrite_generic_args(gen_args, context, shape, gen_args.span())?;\n+            result.push_str(&gen_str);\n         }\n+\n+        let infix = match (&self.kind, context.config.type_punctuation_density()) {\n+            (Bound { .. }, _) => \": \",\n+            (Equality { .. }, TypeDensity::Wide) => \" = \",\n+            (Equality { .. }, TypeDensity::Compressed) => \"=\",\n+        };\n+        result.push_str(infix);\n+\n+        let budget = shape.width.checked_sub(result.len())?;\n+        let shape = Shape::legacy(budget, shape.indent + result.len());\n+        let rewrite = self.kind.rewrite(context, shape)?;\n+        result.push_str(&rewrite);\n+\n+        Some(result)\n     }\n }\n \n@@ -235,21 +242,9 @@ fn rewrite_segment(\n     };\n \n     if let Some(ref args) = segment.args {\n+        let generics_str = rewrite_generic_args(args, context, shape, mk_sp(*span_lo, span_hi))?;\n         match **args {\n             ast::GenericArgs::AngleBracketed(ref data) if !data.args.is_empty() => {\n-                let param_list = data\n-                    .args\n-                    .iter()\n-                    .map(|x| match x {\n-                        ast::AngleBracketedArg::Arg(generic_arg) => {\n-                            SegmentParam::from_generic_arg(generic_arg)\n-                        }\n-                        ast::AngleBracketedArg::Constraint(constraint) => {\n-                            SegmentParam::Binding(constraint)\n-                        }\n-                    })\n-                    .collect::<Vec<_>>();\n-\n                 // HACK: squeeze out the span between the identifier and the parameters.\n                 // The hack is requried so that we don't remove the separator inside macro calls.\n                 // This does not work in the presence of comment, hoping that people are\n@@ -265,33 +260,14 @@ fn rewrite_segment(\n                 };\n                 result.push_str(separator);\n \n-                let generics_str = overflow::rewrite_with_angle_brackets(\n-                    context,\n-                    \"\",\n-                    param_list.iter(),\n-                    shape,\n-                    mk_sp(*span_lo, span_hi),\n-                )?;\n-\n                 // Update position of last bracket.\n                 *span_lo = context\n                     .snippet_provider\n                     .span_after(mk_sp(*span_lo, span_hi), \"<\");\n-\n-                result.push_str(&generics_str)\n-            }\n-            ast::GenericArgs::Parenthesized(ref data) => {\n-                result.push_str(&format_function_type(\n-                    data.inputs.iter().map(|x| &**x),\n-                    &data.output,\n-                    false,\n-                    data.span,\n-                    context,\n-                    shape,\n-                )?);\n             }\n             _ => (),\n         }\n+        result.push_str(&generics_str)\n     }\n \n     Some(result)\n@@ -484,6 +460,41 @@ impl Rewrite for ast::GenericArg {\n     }\n }\n \n+fn rewrite_generic_args(\n+    gen_args: &ast::GenericArgs,\n+    context: &RewriteContext<'_>,\n+    shape: Shape,\n+    span: Span,\n+) -> Option<String> {\n+    match gen_args {\n+        ast::GenericArgs::AngleBracketed(ref data) if !data.args.is_empty() => {\n+            let args = data\n+                .args\n+                .iter()\n+                .map(|x| match x {\n+                    ast::AngleBracketedArg::Arg(generic_arg) => {\n+                        SegmentParam::from_generic_arg(generic_arg)\n+                    }\n+                    ast::AngleBracketedArg::Constraint(constraint) => {\n+                        SegmentParam::Binding(constraint)\n+                    }\n+                })\n+                .collect::<Vec<_>>();\n+\n+            overflow::rewrite_with_angle_brackets(context, \"\", args.iter(), shape, span)\n+        }\n+        ast::GenericArgs::Parenthesized(ref data) => format_function_type(\n+            data.inputs.iter().map(|x| &**x),\n+            &data.output,\n+            false,\n+            data.span,\n+            context,\n+            shape,\n+        ),\n+        _ => Some(\"\".to_owned()),\n+    }\n+}\n+\n fn rewrite_bounded_lifetime(\n     lt: &ast::Lifetime,\n     bounds: &[ast::GenericBound],\n@@ -566,13 +577,23 @@ impl Rewrite for ast::GenericParam {\n         if let ast::GenericParamKind::Const {\n             ref ty,\n             kw_span: _,\n-            default: _,\n+            default,\n         } = &self.kind\n         {\n             result.push_str(\"const \");\n             result.push_str(rewrite_ident(context, self.ident));\n             result.push_str(\": \");\n             result.push_str(&ty.rewrite(context, shape)?);\n+            if let Some(default) = default {\n+                let eq_str = match context.config.type_punctuation_density() {\n+                    TypeDensity::Compressed => \"=\",\n+                    TypeDensity::Wide => \" = \",\n+                };\n+                result.push_str(eq_str);\n+                let budget = shape.width.checked_sub(result.len())?;\n+                let rewrite = default.rewrite(context, Shape::legacy(budget, shape.indent))?;\n+                result.push_str(&rewrite);\n+            }\n         } else {\n             result.push_str(rewrite_ident(context, self.ident));\n         }"}, {"sha": "d854d90b40b6d9d33e7f7ff4917d8c872c97f6a5", "filename": "src/tools/rustfmt/src/visitor.rs", "status": "modified", "additions": 23, "deletions": 40, "changes": 63, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fvisitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Fsrc%2Fvisitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Fvisitor.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -3,17 +3,17 @@ use std::rc::Rc;\n \n use rustc_ast::{ast, token::DelimToken, visit, AstLike};\n use rustc_data_structures::sync::Lrc;\n-use rustc_span::{symbol, BytePos, Pos, Span, DUMMY_SP};\n+use rustc_span::{symbol, BytePos, Pos, Span};\n \n use crate::attr::*;\n use crate::comment::{contains_comment, rewrite_comment, CodeCharKind, CommentCodeSlices};\n use crate::config::Version;\n use crate::config::{BraceStyle, Config};\n use crate::coverage::transform_missing_snippet;\n use crate::items::{\n-    format_impl, format_trait, format_trait_alias, is_mod_decl, is_use_item,\n-    rewrite_associated_impl_type, rewrite_extern_crate, rewrite_opaque_impl_type,\n-    rewrite_opaque_type, rewrite_type_alias, FnBraceStyle, FnSig, StaticParts, StructParts,\n+    format_impl, format_trait, format_trait_alias, is_mod_decl, is_use_item, rewrite_extern_crate,\n+    rewrite_impl_type, rewrite_opaque_type, rewrite_type, FnBraceStyle, FnSig, StaticParts,\n+    StructParts,\n };\n use crate::macros::{macro_style, rewrite_macro, rewrite_macro_def, MacroPosition};\n use crate::modules::Module;\n@@ -568,6 +568,7 @@ impl<'b, 'a: 'b> FmtVisitor<'a> {\n                             indent,\n                             item.ident,\n                             &fn_signature,\n+                            &item.vis,\n                             generics,\n                             item.span,\n                         );\n@@ -579,14 +580,14 @@ impl<'b, 'a: 'b> FmtVisitor<'a> {\n                         **alias_kind;\n                     match ty {\n                         Some(ty) => {\n-                            let rewrite = rewrite_type_alias(\n-                                item.ident,\n-                                Some(&*ty),\n-                                generics,\n-                                Some(generic_bounds),\n+                            let rewrite = rewrite_type(\n                                 &self.get_context(),\n                                 self.block_indent,\n+                                item.ident,\n                                 &item.vis,\n+                                generics,\n+                                Some(generic_bounds),\n+                                Some(&*ty),\n                                 item.span,\n                             );\n                             self.push_rewrite(item.span, rewrite);\n@@ -641,14 +642,9 @@ impl<'b, 'a: 'b> FmtVisitor<'a> {\n                 let ast::FnKind(defaultness, ref sig, ref generics, ref block) = **fn_kind;\n                 if let Some(ref body) = block {\n                     let inner_attrs = inner_attributes(&ti.attrs);\n-                    let vis = ast::Visibility {\n-                        kind: ast::VisibilityKind::Inherited,\n-                        span: DUMMY_SP,\n-                        tokens: None,\n-                    };\n                     let fn_ctxt = visit::FnCtxt::Assoc(visit::AssocCtxt::Trait);\n                     self.visit_fn(\n-                        visit::FnKind::Fn(fn_ctxt, ti.ident, sig, &vis, Some(body)),\n+                        visit::FnKind::Fn(fn_ctxt, ti.ident, sig, &ti.vis, Some(body)),\n                         generics,\n                         &sig.decl,\n                         ti.span,\n@@ -658,21 +654,21 @@ impl<'b, 'a: 'b> FmtVisitor<'a> {\n                 } else {\n                     let indent = self.block_indent;\n                     let rewrite =\n-                        self.rewrite_required_fn(indent, ti.ident, sig, generics, ti.span);\n+                        self.rewrite_required_fn(indent, ti.ident, sig, &ti.vis, generics, ti.span);\n                     self.push_rewrite(ti.span, rewrite);\n                 }\n             }\n             ast::AssocItemKind::TyAlias(ref ty_alias_kind) => {\n                 let ast::TyAliasKind(_, ref generics, ref generic_bounds, ref type_default) =\n                     **ty_alias_kind;\n-                let rewrite = rewrite_type_alias(\n-                    ti.ident,\n-                    type_default.as_ref(),\n-                    generics,\n-                    Some(generic_bounds),\n+                let rewrite = rewrite_type(\n                     &self.get_context(),\n                     self.block_indent,\n+                    ti.ident,\n                     &ti.vis,\n+                    generics,\n+                    Some(generic_bounds),\n+                    type_default.as_ref(),\n                     ti.span,\n                 );\n                 self.push_rewrite(ti.span, rewrite);\n@@ -708,15 +704,16 @@ impl<'b, 'a: 'b> FmtVisitor<'a> {\n                 } else {\n                     let indent = self.block_indent;\n                     let rewrite =\n-                        self.rewrite_required_fn(indent, ii.ident, sig, generics, ii.span);\n+                        self.rewrite_required_fn(indent, ii.ident, sig, &ii.vis, generics, ii.span);\n                     self.push_rewrite(ii.span, rewrite);\n                 }\n             }\n             ast::AssocItemKind::Const(..) => self.visit_static(&StaticParts::from_impl_item(ii)),\n             ast::AssocItemKind::TyAlias(ref ty_alias_kind) => {\n                 let ast::TyAliasKind(defaultness, ref generics, _, ref ty) = **ty_alias_kind;\n-                let rewrite_associated = || {\n-                    rewrite_associated_impl_type(\n+                self.push_rewrite(\n+                    ii.span,\n+                    rewrite_impl_type(\n                         ii.ident,\n                         &ii.vis,\n                         defaultness,\n@@ -725,22 +722,8 @@ impl<'b, 'a: 'b> FmtVisitor<'a> {\n                         &self.get_context(),\n                         self.block_indent,\n                         ii.span,\n-                    )\n-                };\n-                let rewrite = match ty {\n-                    None => rewrite_associated(),\n-                    Some(ty) => match ty.kind {\n-                        ast::TyKind::ImplTrait(_, ref bounds) => rewrite_opaque_impl_type(\n-                            &self.get_context(),\n-                            ii.ident,\n-                            generics,\n-                            bounds,\n-                            self.block_indent,\n-                        ),\n-                        _ => rewrite_associated(),\n-                    },\n-                };\n-                self.push_rewrite(ii.span, rewrite);\n+                    ),\n+                );\n             }\n             ast::AssocItemKind::MacCall(ref mac) => {\n                 self.visit_mac(mac, Some(ii.ident), MacroPosition::Item);"}, {"sha": "315364a64573a9c8b62d43ef098c3e1e274f3a9f", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/divergent-crate-dir-names/Cargo.toml", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2FCargo.toml?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,13 @@\n+[package]\n+name = \"cargo-fmt-test\"\n+version = \"0.1.0\"\n+authors = [\"calebcartwright\"]\n+edition = \"2018\"\n+\n+[dependencies]\n+indexmap = \"1.0.2\"\n+\n+[workspace]\n+members = [\n+  \"dependency-dir-name\",\n+]\n\\ No newline at end of file"}, {"sha": "4493882bf40a2ebb4402412295809bc3c114fceb", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/divergent-crate-dir-names/dependency-dir-name/Cargo.toml", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2Fdependency-dir-name%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2Fdependency-dir-name%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2Fdependency-dir-name%2FCargo.toml?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,10 @@\n+[package]\n+name = \"dependency-crate-name\"\n+version = \"0.1.0\"\n+authors = [\"calebcartwright\"]\n+edition = \"2018\"\n+\n+[dependencies]\n+subdep-crate-name = { path = \"subdep-dir-name\" }\n+indexmap = \"1.0.2\"\n+rusty-hook = \"0.8.4\"\n\\ No newline at end of file"}, {"sha": "e93b18d725b9d3809dbedb15c14f530975233df3", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/divergent-crate-dir-names/dependency-dir-name/src/lib.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2Fdependency-dir-name%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2Fdependency-dir-name%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2Fdependency-dir-name%2Fsrc%2Flib.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,7 @@\n+#[cfg(test)]\n+mod tests {\n+#[test]\n+fn it_works() {\n+    assert_eq!(2 + 2, 4);\n+}\n+}"}, {"sha": "7dad09f4077b2e0d5746ce7b8c45559439195951", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/divergent-crate-dir-names/dependency-dir-name/subdep-dir-name/Cargo.toml", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2Fdependency-dir-name%2Fsubdep-dir-name%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2Fdependency-dir-name%2Fsubdep-dir-name%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2Fdependency-dir-name%2Fsubdep-dir-name%2FCargo.toml?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,7 @@\n+[package]\n+name = \"subdep-crate-name\"\n+version = \"0.1.0\"\n+authors = [\"calebcartwright\"]\n+edition = \"2018\"\n+\n+[dependencies]"}, {"sha": "1c08c1c4fd3869b3ec1f5a75e9eff15a1760e1d8", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/divergent-crate-dir-names/dependency-dir-name/subdep-dir-name/src/lib.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2Fdependency-dir-name%2Fsubdep-dir-name%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2Fdependency-dir-name%2Fsubdep-dir-name%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2Fdependency-dir-name%2Fsubdep-dir-name%2Fsrc%2Flib.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,7 @@\n+#[cfg(test)]\n+mod tests {\n+#[test]\n+fn sub_test_that_works() {\n+    assert_eq!(3 + 3, 6);\n+}\n+ }"}, {"sha": "f5c339a8dd1414567a06d41d0ba1786b66c3d815", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/divergent-crate-dir-names/src/main.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fdivergent-crate-dir-names%2Fsrc%2Fmain.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,3 @@\n+fn main() {\n+println!(\"Hello, world!\");\n+}"}, {"sha": "eaf1d76f999d426ceea1604c670c0a8883aa4b01", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/workspaces/path-dep-above/e/Cargo.toml", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fe%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fe%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fe%2FCargo.toml?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,8 @@\n+[package]\n+name = \"e\"\n+version = \"0.1.0\"\n+edition = \"2018\"\n+[dependencies]\n+c = { path = \"../ws/c\" }\n+\n+[workspace]"}, {"sha": "1c26a3895f37e165af2d84d8fa3e07a170e9ea4f", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/workspaces/path-dep-above/e/src/main.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fe%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fe%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fe%2Fsrc%2Fmain.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1 @@\n+struct E{   }"}, {"sha": "202739b613b8f64ce002bf46ddb386d942c4fbef", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/workspaces/path-dep-above/ws/Cargo.toml", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2FCargo.toml?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,5 @@\n+[workspace]\n+members = [\n+    \"a\",\n+    \"b\"\n+] \n\\ No newline at end of file"}, {"sha": "712a113448fb1add7e9c0cefdabcf63558c4b8b6", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/workspaces/path-dep-above/ws/a/Cargo.toml", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2FCargo.toml?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,6 @@\n+[package]\n+name = \"a\"\n+version = \"0.1.0\"\n+edition = \"2018\"\n+[dependencies]\n+d = { path = \"./d\" }"}, {"sha": "fb0f06fe5fce1bd460e8f049fcdba683e24a9279", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/workspaces/path-dep-above/ws/a/d/Cargo.toml", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2Fd%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2Fd%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2Fd%2FCargo.toml?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,7 @@\n+[package]\n+name = \"d\"\n+version = \"0.1.0\"\n+edition = \"2018\"\n+[dependencies]\n+e = { path = \"../../../e\" }\n+f = { path = \"f\" }"}, {"sha": "5c4fa5617886f9ed0902a4b4fa64cd16adcdd304", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/workspaces/path-dep-above/ws/a/d/f/Cargo.toml", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2Fd%2Ff%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2Fd%2Ff%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2Fd%2Ff%2FCargo.toml?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,4 @@\n+[package]\n+name = \"f\"\n+version = \"0.1.0\"\n+edition = \"2018\""}, {"sha": "c655c4d5e1a82205b657253c19336192e8be4539", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/workspaces/path-dep-above/ws/a/d/f/src/lib.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2Fd%2Ff%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2Fd%2Ff%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2Fd%2Ff%2Fsrc%2Flib.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1 @@\n+struct F{   }\n\\ No newline at end of file"}, {"sha": "04e6e4cb94022970de8349030fab8064d8cd2c2e", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/workspaces/path-dep-above/ws/a/d/src/lib.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2Fd%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2Fd%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2Fd%2Fsrc%2Flib.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1 @@\n+struct D{   }\n\\ No newline at end of file"}, {"sha": "04e6e4cb94022970de8349030fab8064d8cd2c2e", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/workspaces/path-dep-above/ws/a/src/main.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fa%2Fsrc%2Fmain.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1 @@\n+struct D{   }\n\\ No newline at end of file"}, {"sha": "47a24ff4f275398dbe9a1ad24f951f9539050445", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/workspaces/path-dep-above/ws/b/Cargo.toml", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fb%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fb%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fb%2FCargo.toml?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,6 @@\n+[package]\n+name = \"b\"\n+version = \"0.1.0\"\n+edition = \"2018\"\n+[dependencies]\n+c = { path = \"../c\" }"}, {"sha": "4833bbc69b48ebe1c36055cf9579fb592b7a2bbb", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/workspaces/path-dep-above/ws/b/src/main.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fb%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fb%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fb%2Fsrc%2Fmain.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1 @@\n+struct B{   }\n\\ No newline at end of file"}, {"sha": "49fa6c395eb6cdeb3c90ea73266a7ff5a513ffab", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/workspaces/path-dep-above/ws/c/Cargo.toml", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fc%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fc%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fc%2FCargo.toml?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,4 @@\n+[package]\n+name = \"c\"\n+version = \"0.1.0\"\n+edition = \"2018\""}, {"sha": "1245ac91d60a4ed8141ed4bc435d57189a5da0e4", "filename": "src/tools/rustfmt/tests/cargo-fmt/source/workspaces/path-dep-above/ws/c/src/lib.rs", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fc%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fc%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fcargo-fmt%2Fsource%2Fworkspaces%2Fpath-dep-above%2Fws%2Fc%2Fsrc%2Flib.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1 @@\n+struct C{   }\n\\ No newline at end of file"}, {"sha": "3804bf3215b19829888292948cdd5953676ab780", "filename": "src/tools/rustfmt/tests/source/binop-separator-back/bitwise.rs", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Fbitwise.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Fbitwise.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Fbitwise.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,14 @@\n+// rustfmt-binop_separator: Back\n+\n+fn main() {\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ ^ abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ & abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ | abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ << abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ >> abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+\n+}"}, {"sha": "50a27127445df1835adf47504f01c212d229f70b", "filename": "src/tools/rustfmt/tests/source/binop-separator-back/comp.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Fcomp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Fcomp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Fcomp.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,23 @@\n+// rustfmt-binop_separator: Back\n+\n+fn main() {\n+    if abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ < abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ {\n+        //\n+    }\n+\n+    if abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ <= abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ {\n+        //\n+    }\n+\n+    if abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ > abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ {\n+        //\n+    }\n+\n+    if abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ >= abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ {\n+        //\n+    }\n+\n+    if abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ == abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ {\n+        //\n+    }\n+}"}, {"sha": "8c297e5a675078154cac98329ceb8347bbd4e4cc", "filename": "src/tools/rustfmt/tests/source/binop-separator-back/logic.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Flogic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Flogic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Flogic.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,7 @@\n+// rustfmt-binop_separator: Back\n+\n+fn main() {\n+    if abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ && abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ || abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ {\n+        //\n+    }\n+}"}, {"sha": "3af4aad16051eac18074237d37d651f731359eb4", "filename": "src/tools/rustfmt/tests/source/binop-separator-back/math.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Fmath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Fmath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Fmath.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,7 @@\n+// rustfmt-binop_separator: Back\n+\n+fn main() {\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ + abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ + abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ + abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ + abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ + abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ + abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ + abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ * abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ - abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ / abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ + abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ * abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ * abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ / abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ / abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ + abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+}"}, {"sha": "a8c3b5cdd9b16ba73b84ae589af7983cd932cf44", "filename": "src/tools/rustfmt/tests/source/binop-separator-back/patterns.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Fpatterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Fpatterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Fpatterns.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,9 @@\n+// rustfmt-binop_separator: Back\n+\n+fn main() {\n+    match val {\n+    ThisIsA::ReallyLongPatternNameToHelpOverflowTheNextValueOntoTheNextLine | ThisIsA::SecondValueSeparatedByAPipe | ThisIsA::ThirdValueSeparatedByAPipe => {\n+    //\n+    }\n+    }\n+}"}, {"sha": "bdd3de9922b093f8addbf8b45210662ce46517ce", "filename": "src/tools/rustfmt/tests/source/binop-separator-back/range.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Frange.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Frange.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fbinop-separator-back%2Frange.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,7 @@\n+// rustfmt-binop_separator: Back\n+\n+fn main() {\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ..abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ..=abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+}"}, {"sha": "dec1e00d117b46d8fa8def4719557d6d113256d2", "filename": "src/tools/rustfmt/tests/source/configs/format_generated_files/false.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fconfigs%2Fformat_generated_files%2Ffalse.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fconfigs%2Fformat_generated_files%2Ffalse.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fconfigs%2Fformat_generated_files%2Ffalse.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,8 @@\n+// @generated\n+// rustfmt-format_generated_files: false\n+\n+fn main()\n+{\n+    println!(\"hello, world\")\n+    ;\n+}"}, {"sha": "a25ddc25a6a447856da69f9691cbc16fc6c92987", "filename": "src/tools/rustfmt/tests/source/configs/format_generated_files/true.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fconfigs%2Fformat_generated_files%2Ftrue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fconfigs%2Fformat_generated_files%2Ftrue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fconfigs%2Fformat_generated_files%2Ftrue.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,8 @@\n+// @generated\n+// rustfmt-format_generated_files: true\n+\n+fn main()\n+{\n+    println!(\"hello, world\")\n+    ;\n+}"}, {"sha": "ce307b3aa521e29a192f36c2257cda2de18cb260", "filename": "src/tools/rustfmt/tests/source/hex_literal_lower.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fhex_literal_lower.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fhex_literal_lower.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fhex_literal_lower.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,5 @@\n+// rustfmt-hex_literal_case: Lower\n+fn main() {\n+    let h1 = 0xCAFE_5EA7;\n+    let h2 = 0xCAFE_F00Du32;\n+}"}, {"sha": "b1092ad71ba136af32ba6afc94a4eb4b6ca386d3", "filename": "src/tools/rustfmt/tests/source/hex_literal_upper.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fhex_literal_upper.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fhex_literal_upper.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fhex_literal_upper.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,5 @@\n+// rustfmt-hex_literal_case: Upper\n+fn main() {\n+    let h1 = 0xCaFE_5ea7;\n+    let h2 = 0xCAFE_F00Du32;\n+}"}, {"sha": "dcd1f0cd5b09de29ed9f0eec68745c0488aa438c", "filename": "src/tools/rustfmt/tests/source/impls.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fimpls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fimpls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fimpls.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -13,6 +13,14 @@ pub impl Foo for Bar {\n     // Comment 3\n }\n \n+#[inherent]\n+impl Visible for Bar {\n+    pub const C: i32;\n+    pub type T;\n+    pub fn f();\n+    pub fn g() {}\n+}\n+\n pub unsafe impl<'a, 'b, X, Y: Foo<Bar>> !Foo<'a, X> for Bar<'b, Y> where X: Foo<'a, Z> {\n     fn foo() { \"hi\" }    \n }"}, {"sha": "c21707df3954578051937a642dbc98ab32333b44", "filename": "src/tools/rustfmt/tests/source/imports_granularity_one.rs", "status": "added", "additions": 60, "deletions": 0, "changes": 60, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fimports_granularity_one.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fimports_granularity_one.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fimports_granularity_one.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,60 @@\n+// rustfmt-imports_granularity: One\n+\n+use b;\n+use a::ac::{aca, acb};\n+use a::{aa::*, ab};\n+\n+use a as x;\n+use b::ba;\n+use a::{aa, ab};\n+\n+use a::aa::aaa;\n+use a::ab::aba as x;\n+use a::aa::*;\n+\n+use a::aa;\n+use a::ad::ada;\n+#[cfg(test)]\n+use a::{ab, ac::aca};\n+use b;\n+#[cfg(test)]\n+use b::{\n+    ba, bb,\n+    bc::bca::{bcaa, bcab},\n+};\n+\n+pub use a::aa;\n+pub use a::ae;\n+use a::{ab, ac, ad};\n+use b::ba;\n+pub use b::{bb, bc::bca};\n+\n+use a::aa::aaa;\n+use a::ac::{aca, acb};\n+use a::{aa::*, ab};\n+use b::{\n+    ba,\n+    bb::{self, bba},\n+};\n+\n+use crate::a;\n+use crate::b::ba;\n+use c::ca;\n+\n+use super::a;\n+use c::ca;\n+use super::b::ba;\n+\n+use crate::a;\n+use super::b;\n+use c::{self, ca};\n+\n+use a::{\n+    // some comment\n+    aa::{aaa, aab},\n+    ab,\n+    // another comment\n+    ac::aca,\n+};\n+use b as x;\n+use a::ad::ada;"}, {"sha": "315073db6af5a99864f3f418bd6a19fb3f95e33d", "filename": "src/tools/rustfmt/tests/source/issue-3158.rs", "status": "added", "additions": 74, "deletions": 0, "changes": 74, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-3158.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-3158.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-3158.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,74 @@\n+// rustfmt-format_code_in_doc_comments: true\n+\n+/// Should format\n+/// ```rust\n+/// assert!( false );\n+/// ```\n+///\n+/// Should format\n+/// ```rust,should_panic\n+/// assert!( false );\n+/// ```\n+///\n+/// Should format\n+/// ```rust,should_panic,edition2018\n+/// assert!( false );\n+/// ```\n+///\n+/// Should format\n+/// ```rust , should_panic , edition2018\n+/// assert!( false );\n+/// ```\n+///\n+/// Should not format\n+/// ```ignore\n+/// assert!( false );\n+/// ```\n+///\n+/// Should not format (not all are rust)\n+/// ```rust,ignore\n+/// assert!( false );\n+/// ```\n+///\n+/// Should not format (rust compile_fail)\n+/// ```compile_fail\n+/// assert!( false );\n+/// ```\n+///\n+/// Should not format (rust compile_fail)\n+/// ```rust,compile_fail\n+/// assert!( false );\n+/// ```\n+///\n+/// Various unspecified ones that should format\n+/// ```\n+/// assert!( false );\n+/// ```\n+///\n+/// ```,\n+/// assert!( false );\n+/// ```\n+///\n+/// ```,,,,,\n+/// assert!( false );\n+/// ```\n+///\n+/// ```,,,  rust  ,,\n+/// assert!( false );\n+/// ```\n+///\n+/// Should not format\n+/// ```,,,  rust  ,  ignore,\n+/// assert!( false );\n+/// ```\n+///\n+/// Few empty ones\n+/// ```\n+/// ```\n+///\n+/// ```rust\n+/// ```\n+///\n+/// ```ignore\n+/// ```\n+fn foo() {}"}, {"sha": "9d2882abb3c1ccd0a45a60d37b896d13c2e868ff", "filename": "src/tools/rustfmt/tests/source/issue-4530.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4530.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4530.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4530.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,4 @@\n+// rustfmt-version: Two\n+fn main() {\n+    let [aaaaaaaaaaaaaaaaaaaaaaaaaa, bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb, cccccccccccccccccccccccccc, ddddddddddddddddddddddddd] = panic!();\n+}"}, {"sha": "89af5d1239dd07db1b06d2ff5d1b862d2a7e52b5", "filename": "src/tools/rustfmt/tests/source/issue-4615/minimum_example.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4615%2Fminimum_example.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4615%2Fminimum_example.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4615%2Fminimum_example.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,4 @@\n+info!(//debug\n+    \"{}: sending function_code={:04x} data={:04x} crc=0x{:04X} data={:02X?}\",\n+    self.name, function_code, data, crc, output_cmd\n+);"}, {"sha": "43d540c4a5d72441c5df11299ff0f074bf01d42d", "filename": "src/tools/rustfmt/tests/source/issue-4816/lib.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4816%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4816%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4816%2Flib.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,10 @@\n+#![feature(const_generics_defaults)]\n+struct Foo<const N: usize    =  1, const N2: usize =           2>;\n+struct Bar<const N: usize, const N2: usize = {      N + \n+1 }>;\n+struct Lots<const N1BlahFooUwU: usize = { 10 + 28 + 1872 / 10 * 3 },const N2SecondParamOhmyyy: usize = { N1BlahFooUwU / 2 + 10 * 2 },>;\n+struct NamesRHard<const N: usize = { 1 + 1 + 1 + 1 + 1 + 1 }>;\n+struct FooBar<\n+    const LessThan100ButClose: usize = {1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1}\n+>;\n+struct FooBarrrrrrrr<const N: usize        =           {13478234326456456444323871+ 1+ 1+ 1+ 1+ 1+ 1+ 1+ 1+ 1+ 1+ 1+ 1+ 1+1+1+1 + 1},>;"}, {"sha": "e55e41bd1a58a377141b9b68e317e5885d96d40d", "filename": "src/tools/rustfmt/tests/source/issue-4926/deeply_nested_struct.rs", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fdeeply_nested_struct.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fdeeply_nested_struct.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fdeeply_nested_struct.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,35 @@\n+\n+// rustfmt-struct_field_align_threshold: 30\n+\n+struct X {\n+    a: i32,\n+    b: i32,\n+    c: i32,\n+}\n+\n+fn test(x: X) {\n+    let d = {\n+        let e = {\n+            let f = {\n+                let g = {\n+                    let h = {\n+                        let i = {\n+                            let j = {\n+                                matches!(\n+                                    x,\n+                                    X { a: 1_000, b: 1_000, .. }\n+                                )\n+                            };\n+                            j\n+                        };\n+                        i\n+                    };\n+                    h\n+                };\n+                g\n+            };\n+            f\n+        };\n+        e\n+    };\n+}\n\\ No newline at end of file"}, {"sha": "516699fa2b8bc0193ef42e3da20201e9959040f7", "filename": "src/tools/rustfmt/tests/source/issue-4926/deeply_nested_struct_with_long_field_names.rs", "status": "added", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fdeeply_nested_struct_with_long_field_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fdeeply_nested_struct_with_long_field_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fdeeply_nested_struct_with_long_field_names.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,43 @@\n+// rustfmt-struct_field_align_threshold: 30\n+\n+struct X {\n+    really_really_long_field_a: i32,\n+    really_really_really_long_field_b: i32,\n+    really_really_really_really_long_field_c: i32,\n+    really_really_really_really_really_long_field_d: i32,\n+    really_really_really_really_really_really_long_field_e: i32,\n+    f: i32,\n+}\n+\n+fn test(x: X) {\n+    let d = {\n+        let e = {\n+            let f = {\n+                let g = {\n+                    let h = {\n+                        let i = {\n+                            let j = {\n+                                matches!(\n+                                    x,\n+                                    X {\n+                                        really_really_long_field_a: 10,\n+                                        really_really_really_long_field_b: 10,\n+                                        really_really_really_really_long_field_c: 10,\n+                                        really_really_really_really_really_long_field_d: 10,\n+                                        really_really_really_really_really_really_long_field_e: 10, ..\n+                                    }\n+                                )\n+                            };\n+                            j\n+                        };\n+                        i\n+                    };\n+                    h\n+                };\n+                g\n+            };\n+            f\n+        };\n+        e\n+    };\n+}"}, {"sha": "38fd6f02cf0691e4ca7dd209381fa8a411504aa1", "filename": "src/tools/rustfmt/tests/source/issue-4926/deeply_nested_struct_with_many_fields.rs", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fdeeply_nested_struct_with_many_fields.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fdeeply_nested_struct_with_many_fields.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fdeeply_nested_struct_with_many_fields.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,44 @@\n+// rustfmt-struct_field_align_threshold: 30\n+\n+struct X {\n+    a: i32,\n+    b: i32,\n+    c: i32,\n+    d: i32,\n+    e: i32,\n+    f: i32,\n+    g: i32,\n+    h: i32,\n+    i: i32,\n+    j: i32,\n+    k: i32,\n+}\n+\n+fn test(x: X) {\n+    let d = {\n+        let e = {\n+            let f = {\n+                let g = {\n+                    let h = {\n+                        let i = {\n+                            let j = {\n+                                matches!(\n+                                    x,\n+                                    X {\n+                                        a: 1_000, b: 1_000, c: 1_000, d: 1_000, e: 1_000, f: 1_000, g: 1_000, h: 1_000, i: 1_000, j: 1_000, ..\n+                                    }\n+                                )\n+                            };\n+                            j\n+                        };\n+                        i\n+                    };\n+                    h\n+                };\n+                g\n+            };\n+            f\n+        };\n+        e\n+    };\n+}"}, {"sha": "336378537df38a619eb9daa5150929f278fc68d5", "filename": "src/tools/rustfmt/tests/source/issue-4926/enum_struct_field.rs", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fenum_struct_field.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fenum_struct_field.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fenum_struct_field.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,35 @@\n+// rustfmt-struct_field_align_threshold: 30\n+// rustfmt-enum_discrim_align_threshold: 30\n+// rustfmt-imports_layout: HorizontalVertical\n+\n+#[derive(Default)]\n+struct InnerStructA { bbbbbbbbb: i32, cccccccc: i32 }\n+\n+enum SomeEnumNamedD {\n+    E(InnerStructA),\n+    F {\n+        ggggggggggggggggggggggggg: bool,\n+        h: bool,\n+    }\n+}\n+\n+impl SomeEnumNamedD {\n+    fn f_variant() -> Self {\n+        Self::F { ggggggggggggggggggggggggg: true, h: true }\n+    }\n+}\n+\n+fn main() {\n+    let kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk = SomeEnumNamedD::f_variant();\n+    let something_we_care_about = matches!(\n+        kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk,\n+        SomeEnumNamedD::F {\n+            ggggggggggggggggggggggggg: true,\n+            ..\n+        }\n+    );\n+\n+    if something_we_care_about {\n+        println!(\"Yup it happened\");\n+    }\n+}"}, {"sha": "2c3045dea489e0f11698451f9f4bfa0b797cfdfa", "filename": "src/tools/rustfmt/tests/source/issue-4926/minimum_example.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fminimum_example.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fminimum_example.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fminimum_example.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,10 @@\n+// rustfmt-struct_field_align_threshold: 30\n+\n+struct X { a: i32, b: i32 }\n+\n+fn test(x: X) {\n+    let y = matches!(x, X {\n+        a: 1,\n+        ..\n+    });\n+}"}, {"sha": "b8a37f0714ee6030eed7a460f502942087881ca8", "filename": "src/tools/rustfmt/tests/source/issue-4926/struct_with_long_field_names.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fstruct_with_long_field_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fstruct_with_long_field_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fstruct_with_long_field_names.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,21 @@\n+// rustfmt-struct_field_align_threshold: 30\n+\n+struct X {\n+    really_really_long_field_a: i32,\n+    really_really_really_long_field_b: i32,\n+    really_really_really_really_long_field_c: i32,\n+    really_really_really_really_really_long_field_d: i32,\n+    really_really_really_really_really_really_long_field_e: i32,\n+    f: i32,\n+}\n+\n+fn test(x: X) {\n+    let y = matches!(x, X {\n+        really_really_long_field_a: 10,\n+        really_really_really_long_field_b: 10,\n+        really_really_really_really_long_field_c: 10,\n+        really_really_really_really_really_long_field_d: 10,\n+        really_really_really_really_really_really_long_field_e: 10,\n+        ..\n+    });\n+}"}, {"sha": "4adfd3b306296bc176d688373d081af0b82e9f5b", "filename": "src/tools/rustfmt/tests/source/issue-4926/struct_with_many_fields.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fstruct_with_many_fields.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fstruct_with_many_fields.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4926%2Fstruct_with_many_fields.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,21 @@\n+// rustfmt-struct_field_align_threshold: 30\n+\n+struct X {\n+    a: i32,\n+    b: i32,\n+    c: i32,\n+    d: i32,\n+    e: i32,\n+    f: i32,\n+    g: i32,\n+    h: i32,\n+    i: i32,\n+    j: i32,\n+    k: i32,\n+}\n+\n+fn test(x: X) {\n+    let y = matches!(x, X {\n+        a: 1_000, b: 1_000, c: 1_000, d: 1_000, e: 1_000, f: 1_000, g: 1_000, h: 1_000, i: 1_000, j: 1_000, ..\n+    });\n+}\n\\ No newline at end of file"}, {"sha": "677f873771691771851b48efa740cc090e791867", "filename": "src/tools/rustfmt/tests/source/issue-4984/minimum_example.rs", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4984%2Fminimum_example.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4984%2Fminimum_example.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4984%2Fminimum_example.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,2 @@\n+#[derive(/*Debug, */Clone)]\n+struct Foo;"}, {"sha": "73921dd173547711d0966743203ae07b7203c87e", "filename": "src/tools/rustfmt/tests/source/issue-4984/multi_line_derive.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4984%2Fmulti_line_derive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4984%2Fmulti_line_derive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4984%2Fmulti_line_derive.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,20 @@\n+#[derive(\n+/* ---------- Some really important comment that just had to go inside the derive --------- */\n+Debug, Clone, Eq, PartialEq,\n+)]\n+struct Foo {\n+    a: i32,\n+    b: T,\n+}\n+\n+#[derive(\n+/*\n+    Some really important comment that just had to go inside the derive.\n+    Also had to be put over multiple lines\n+*/\n+Debug, Clone, Eq, PartialEq,\n+)]\n+struct Bar {\n+    a: i32,\n+    b: T,\n+}"}, {"sha": "eb474a723d01609e077785456d1fad06cb3b45fc", "filename": "src/tools/rustfmt/tests/source/issue-4984/multiple_comments_within.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4984%2Fmultiple_comments_within.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4984%2Fmultiple_comments_within.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-4984%2Fmultiple_comments_within.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,8 @@\n+#[derive(\n+/* ---------- Some really important comment that just had to go inside the derive --------- */\n+Debug, Clone,/* Another comment */Eq, PartialEq,\n+)]\n+struct Foo {\n+    a: i32,\n+    b: T,\n+}"}, {"sha": "b48292164e43ab4b13d9f4e22a97d3c2ec1af769", "filename": "src/tools/rustfmt/tests/source/issue-5011.rs", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-5011.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-5011.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue-5011.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,12 @@\n+pub(crate) struct ASlash(\n+    // hello\n+    i32\n+);\n+\n+pub(crate) struct AStar(\n+    /* hello */\n+    i32\n+);\n+\n+pub(crate) struct BStar(/* hello */ i32);\n+"}, {"sha": "11ded074c3455d57fc4e2f03da75123edf992ac7", "filename": "src/tools/rustfmt/tests/source/issue_4032.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4032.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4032.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4032.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,4 @@\n+fn a1(#[aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa] a: u8) {}\n+fn b1(#[aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa] bb: u8) {}\n+fn a2(#[aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa] a: u8) {}\n+fn b2(#[aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa] bb: u8) {}"}, {"sha": "2b887fadb621c32df0ed07d6aa74d879ad299a66", "filename": "src/tools/rustfmt/tests/source/issue_4257.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4257.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4257.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4257.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,13 @@\n+#![feature(generic_associated_types)]\n+#![allow(incomplete_features)]\n+\n+trait Trait<T> {\n+    type Type<'a> where T: 'a;\n+    fn foo(x: &T) -> Self::Type<'_>;\n+}\n+impl<T> Trait<T> for () {\n+    type Type<'a> where T: 'a = &'a T;\n+    fn foo(x: &T) -> Self::Type<'_> {\n+        x\n+    }\n+}"}, {"sha": "b28cc7cdd12fede29107857764ebe2bfaa194484", "filename": "src/tools/rustfmt/tests/source/issue_4322.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4322.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4322.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4322.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,3 @@\n+trait Bar {\n+  type X<'a> where Self: 'a;\n+}"}, {"sha": "73f345233ba7718037878698017baa4b09f4c84e", "filename": "src/tools/rustfmt/tests/source/issue_4579.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4579.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4579.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4579.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,15 @@\n+// rustfmt-hard_tabs: true\n+\n+#[macro_export]\n+macro_rules! main {\n+\t() => {\n+\t\t#[spirv(fragment)]\n+\t\tpub fn main_fs(\n+\t\t\tmut out_color: ::spirv_std::storage_class::Output<Vec4>,\n+\t\t\t#[spirv(descriptor_set = 1)]iChannelResolution: ::spirv_std::storage_class::UniformConstant<\n+\t\t\t\t[::spirv_std::glam::Vec3A; 4],\n+\t\t\t>,\n+\t\t) {\n+\t\t}\n+\t};\n+}"}, {"sha": "21ef6c6c491ac0296f15187f6c49176c2ae053c3", "filename": "src/tools/rustfmt/tests/source/issue_4911.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4911.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4911.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4911.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,6 @@\n+#![feature(generic_associated_types)]\n+#![feature(min_type_alias_impl_trait)]\n+\n+impl SomeTrait for SomeType {\n+    type SomeGAT<'a> where Self: 'a = impl SomeOtherTrait;\n+}\n\\ No newline at end of file"}, {"sha": "0793b7b4fe1cca55947c31fbf259d15a3e8175e6", "filename": "src/tools/rustfmt/tests/source/issue_4943.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4943.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4943.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4943.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,9 @@\n+#![feature(generic_associated_types)]\n+\n+impl SomeStruct {\n+    fn process<T>(v: T) -> <Self as GAT>::R<T>\n+    where Self: GAT<R<T> = T>\n+    {\n+        SomeStruct::do_something(v)\n+    }\n+}"}, {"sha": "8011c601b654f4b72ca68c6c27968f99d615bd08", "filename": "src/tools/rustfmt/tests/source/issue_4954.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4954.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4954.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4954.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,5 @@\n+trait Foo {\n+  type Arg<'a>;\n+}\n+\n+struct Bar<T>(T) where for<'a> T: Foo<Arg<'a> = ()>;"}, {"sha": "32e1f6cd41bf6c014ba8d7e3b736afc9e0356d14", "filename": "src/tools/rustfmt/tests/source/issue_4963.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4963.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4963.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fissue_4963.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,5 @@\n+mod test {\n+    extern \"C\" {fn test();}\n+}\n+\n+extern \"C\" {fn test();}\n\\ No newline at end of file"}, {"sha": "baa05b79c16175e5001ef80682b31d8cff0fe80b", "filename": "src/tools/rustfmt/tests/source/match-block-trailing-comma.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fmatch-block-trailing-comma.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fmatch-block-trailing-comma.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Fmatch-block-trailing-comma.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -8,6 +8,14 @@ fn foo() {\n             \"line1\";\n             \"line2\"\n         }\n+        ThisIsA::Guard if true => {\n+            \"line1\";\n+            \"line2\"\n+        }\n+        ThisIsA::ReallyLongPattern(ThatWillForce::TheGuard, ToWrapOnto::TheFollowingLine) if true => {\n+            \"line1\";\n+            \"line2\"\n+        }\n         b => (aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,\n               bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb),\n     }"}, {"sha": "b6db9e1590d416a932db52ac89999b221e75d544", "filename": "src/tools/rustfmt/tests/source/trait.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Ftrait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Ftrait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Fsource%2Ftrait.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -174,3 +174,10 @@ Send\n     + DDDDDDDD\n     + DDDDDDDDD\n     + EEEEEEE;\n+\n+trait Visible {\n+    pub const C: i32;\n+    pub type T;\n+    pub fn f();\n+    pub fn g() {}\n+}"}, {"sha": "ce32c05ef703f183624c0f3cdeeb3975285c15b2", "filename": "src/tools/rustfmt/tests/target/binop-separator-back/bitwise.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Fbitwise.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Fbitwise.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Fbitwise.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,18 @@\n+// rustfmt-binop_separator: Back\n+\n+fn main() {\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ ^\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ &\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ |\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ <<\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ >>\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+}"}, {"sha": "efd837bcfe389ee458d5a79f5bdc9a45bcc5ecb6", "filename": "src/tools/rustfmt/tests/target/binop-separator-back/comp.rs", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Fcomp.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Fcomp.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Fcomp.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,33 @@\n+// rustfmt-binop_separator: Back\n+\n+fn main() {\n+    if abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ <\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\n+    {\n+        //\n+    }\n+\n+    if abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ <=\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\n+    {\n+        //\n+    }\n+\n+    if abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ >\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\n+    {\n+        //\n+    }\n+\n+    if abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ >=\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\n+    {\n+        //\n+    }\n+\n+    if abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ ==\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\n+    {\n+        //\n+    }\n+}"}, {"sha": "5f69fd5f55e4afee47f06803697158de72b65b02", "filename": "src/tools/rustfmt/tests/target/binop-separator-back/logic.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Flogic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Flogic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Flogic.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,10 @@\n+// rustfmt-binop_separator: Back\n+\n+fn main() {\n+    if abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ &&\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ ||\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\n+    {\n+        //\n+    }\n+}"}, {"sha": "7a3f27e733b2c8e14e794cfb90bbaeb0525a2068", "filename": "src/tools/rustfmt/tests/target/binop-separator-back/math.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Fmath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Fmath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Fmath.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,23 @@\n+// rustfmt-binop_separator: Back\n+\n+fn main() {\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ +\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ +\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ +\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ +\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ +\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ +\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ +\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ *\n+            abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ -\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ /\n+            abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ +\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ *\n+            abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ *\n+            abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ /\n+            abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ /\n+            abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ +\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+}"}, {"sha": "2e59713526a028e4a6dd97a8957061dba029cdff", "filename": "src/tools/rustfmt/tests/target/binop-separator-back/patterns.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Fpatterns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Fpatterns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Fpatterns.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,11 @@\n+// rustfmt-binop_separator: Back\n+\n+fn main() {\n+    match val {\n+        ThisIsA::ReallyLongPatternNameToHelpOverflowTheNextValueOntoTheNextLine |\n+        ThisIsA::SecondValueSeparatedByAPipe |\n+        ThisIsA::ThirdValueSeparatedByAPipe => {\n+            //\n+        }\n+    }\n+}"}, {"sha": "19e5a81cd9cd153820386aede794e8cfed5605ee", "filename": "src/tools/rustfmt/tests/target/binop-separator-back/range.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Frange.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Frange.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fbinop-separator-back%2Frange.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,9 @@\n+// rustfmt-binop_separator: Back\n+\n+fn main() {\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ..\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+\n+    let value = abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ..=\n+        abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ;\n+}"}, {"sha": "dec1e00d117b46d8fa8def4719557d6d113256d2", "filename": "src/tools/rustfmt/tests/target/configs/format_generated_files/false.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fconfigs%2Fformat_generated_files%2Ffalse.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fconfigs%2Fformat_generated_files%2Ffalse.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fconfigs%2Fformat_generated_files%2Ffalse.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,8 @@\n+// @generated\n+// rustfmt-format_generated_files: false\n+\n+fn main()\n+{\n+    println!(\"hello, world\")\n+    ;\n+}"}, {"sha": "5fea7e8b34139a8445add0912b0e4f99f246ba1c", "filename": "src/tools/rustfmt/tests/target/configs/format_generated_files/true.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fconfigs%2Fformat_generated_files%2Ftrue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fconfigs%2Fformat_generated_files%2Ftrue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fconfigs%2Fformat_generated_files%2Ftrue.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,6 @@\n+// @generated\n+// rustfmt-format_generated_files: true\n+\n+fn main() {\n+    println!(\"hello, world\");\n+}"}, {"sha": "5c27fded1674308ed1ab255c3ad12cbf336661f6", "filename": "src/tools/rustfmt/tests/target/hex_literal_lower.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fhex_literal_lower.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fhex_literal_lower.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fhex_literal_lower.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,5 @@\n+// rustfmt-hex_literal_case: Lower\n+fn main() {\n+    let h1 = 0xcafe_5ea7;\n+    let h2 = 0xcafe_f00du32;\n+}"}, {"sha": "e8774d0bb24eb0e30f7c3570ff888d685f5ea755", "filename": "src/tools/rustfmt/tests/target/hex_literal_preserve.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fhex_literal_preserve.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fhex_literal_preserve.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fhex_literal_preserve.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,5 @@\n+// rustfmt-hex_literal_case: Preserve\n+fn main() {\n+    let h1 = 0xcAfE_5Ea7;\n+    let h2 = 0xCaFe_F00du32;\n+}"}, {"sha": "48bb93d2c1c08d7efc11ca562f5cd732f3cc0ee1", "filename": "src/tools/rustfmt/tests/target/hex_literal_upper.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fhex_literal_upper.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fhex_literal_upper.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fhex_literal_upper.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,5 @@\n+// rustfmt-hex_literal_case: Upper\n+fn main() {\n+    let h1 = 0xCAFE_5EA7;\n+    let h2 = 0xCAFE_F00Du32;\n+}"}, {"sha": "99e02990e417775ba8a9821a501e9ce0d4f0f960", "filename": "src/tools/rustfmt/tests/target/impls.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fimpls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fimpls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fimpls.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -21,6 +21,14 @@ pub impl Foo for Bar {\n     // Comment 3\n }\n \n+#[inherent]\n+impl Visible for Bar {\n+    pub const C: i32;\n+    pub type T;\n+    pub fn f();\n+    pub fn g() {}\n+}\n+\n pub unsafe impl<'a, 'b, X, Y: Foo<Bar>> !Foo<'a, X> for Bar<'b, Y>\n where\n     X: Foo<'a, Z>,"}, {"sha": "78ec5e7325c50b7ed4de203d9b434b7ee62287c5", "filename": "src/tools/rustfmt/tests/target/imports_granularity_one.rs", "status": "added", "additions": 79, "deletions": 0, "changes": 79, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fimports_granularity_one.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fimports_granularity_one.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fimports_granularity_one.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,79 @@\n+// rustfmt-imports_granularity: One\n+\n+use {\n+    a::{\n+        aa::*,\n+        ab,\n+        ac::{aca, acb},\n+    },\n+    b,\n+};\n+\n+use {\n+    a::{self as x, aa, ab},\n+    b::ba,\n+};\n+\n+use a::{\n+    aa::{aaa, *},\n+    ab::aba as x,\n+};\n+\n+#[cfg(test)]\n+use a::{ab, ac::aca};\n+#[cfg(test)]\n+use b::{\n+    ba, bb,\n+    bc::bca::{bcaa, bcab},\n+};\n+use {\n+    a::{aa, ad::ada},\n+    b,\n+};\n+\n+pub use {\n+    a::{aa, ae},\n+    b::{bb, bc::bca},\n+};\n+use {\n+    a::{ab, ac, ad},\n+    b::ba,\n+};\n+\n+use {\n+    a::{\n+        aa::{aaa, *},\n+        ab,\n+        ac::{aca, acb},\n+    },\n+    b::{\n+        ba,\n+        bb::{self, bba},\n+    },\n+};\n+\n+use {\n+    crate::{a, b::ba},\n+    c::ca,\n+};\n+\n+use {\n+    super::{a, b::ba},\n+    c::ca,\n+};\n+\n+use {\n+    super::b,\n+    crate::a,\n+    c::{self, ca},\n+};\n+\n+use {\n+    a::{\n+        aa::{aaa, aab},\n+        ab,\n+        ac::aca,\n+        ad::ada,\n+    },\n+    b as x,\n+};"}, {"sha": "4bbbdc1d039224eed7ad7dbeb510ba53f2689fda", "filename": "src/tools/rustfmt/tests/target/issue-3158.rs", "status": "added", "additions": 74, "deletions": 0, "changes": 74, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-3158.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-3158.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-3158.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,74 @@\n+// rustfmt-format_code_in_doc_comments: true\n+\n+/// Should format\n+/// ```rust\n+/// assert!(false);\n+/// ```\n+///\n+/// Should format\n+/// ```rust,should_panic\n+/// assert!(false);\n+/// ```\n+///\n+/// Should format\n+/// ```rust,should_panic,edition2018\n+/// assert!(false);\n+/// ```\n+///\n+/// Should format\n+/// ```rust , should_panic , edition2018\n+/// assert!(false);\n+/// ```\n+///\n+/// Should not format\n+/// ```ignore\n+/// assert!( false );\n+/// ```\n+///\n+/// Should not format (not all are rust)\n+/// ```rust,ignore\n+/// assert!( false );\n+/// ```\n+///\n+/// Should not format (rust compile_fail)\n+/// ```compile_fail\n+/// assert!( false );\n+/// ```\n+///\n+/// Should not format (rust compile_fail)\n+/// ```rust,compile_fail\n+/// assert!( false );\n+/// ```\n+///\n+/// Various unspecified ones that should format\n+/// ```\n+/// assert!(false);\n+/// ```\n+///\n+/// ```,\n+/// assert!(false);\n+/// ```\n+///\n+/// ```,,,,,\n+/// assert!(false);\n+/// ```\n+///\n+/// ```,,,  rust  ,,\n+/// assert!(false);\n+/// ```\n+///\n+/// Should not format\n+/// ```,,,  rust  ,  ignore,\n+/// assert!( false );\n+/// ```\n+///\n+/// Few empty ones\n+/// ```\n+/// ```\n+///\n+/// ```rust\n+/// ```\n+///\n+/// ```ignore\n+/// ```\n+fn foo() {}"}, {"sha": "296dc559a9343175b9c3d2164e7c5620c68eec73", "filename": "src/tools/rustfmt/tests/target/issue-4530.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4530.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4530.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4530.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,9 @@\n+// rustfmt-version: Two\n+fn main() {\n+    let [\n+        aaaaaaaaaaaaaaaaaaaaaaaaaa,\n+        bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb,\n+        cccccccccccccccccccccccccc,\n+        ddddddddddddddddddddddddd,\n+    ] = panic!();\n+}"}, {"sha": "223b89b812d3d67eb047cf8ec39a6ac62f7ca44e", "filename": "src/tools/rustfmt/tests/target/issue-4615/minimum_example.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4615%2Fminimum_example.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4615%2Fminimum_example.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4615%2Fminimum_example.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,5 @@\n+info!(\n+    //debug\n+    \"{}: sending function_code={:04x} data={:04x} crc=0x{:04X} data={:02X?}\",\n+    self.name, function_code, data, crc, output_cmd\n+);"}, {"sha": "246e775e1febcf304b866155f0a4e64b863e903e", "filename": "src/tools/rustfmt/tests/target/issue-4816/lib.rs", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4816%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4816%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4816%2Flib.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,35 @@\n+#![feature(const_generics_defaults)]\n+struct Foo<const N: usize = 1, const N2: usize = 2>;\n+struct Bar<const N: usize, const N2: usize = { N + 1 }>;\n+struct Lots<\n+    const N1BlahFooUwU: usize = { 10 + 28 + 1872 / 10 * 3 },\n+    const N2SecondParamOhmyyy: usize = { N1BlahFooUwU / 2 + 10 * 2 },\n+>;\n+struct NamesRHard<const N: usize = { 1 + 1 + 1 + 1 + 1 + 1 }>;\n+struct FooBar<\n+    const LessThan100ButClose: usize = {\n+        1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1\n+    },\n+>;\n+struct FooBarrrrrrrr<\n+    const N: usize = {\n+        13478234326456456444323871\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+            + 1\n+    },\n+>;"}, {"sha": "023b323cb2796f65af8362c4e0da4d6c2c227bf9", "filename": "src/tools/rustfmt/tests/target/issue-4908-2.rs", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4908-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4908-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4908-2.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,20 @@\n+#![feature(more_qualified_paths)]\n+\n+fn main() {\n+    // destructure through a qualified path\n+    let <Foo as A>::Assoc { br } = StructStruct { br: 2 };\n+}\n+\n+struct StructStruct {\n+    br: i8,\n+}\n+\n+struct Foo;\n+\n+trait A {\n+    type Assoc;\n+}\n+\n+impl A for Foo {\n+    type Assoc = StructStruct;\n+}"}, {"sha": "ac5357abe2a18b91f1a89fd174fcd798f8770ddc", "filename": "src/tools/rustfmt/tests/target/issue-4908.rs", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4908.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4908.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4908.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,34 @@\n+#![feature(more_qualified_paths)]\n+\n+mod foo_bar {\n+    pub enum Example {\n+        Example1 {},\n+        Example2 {},\n+    }\n+}\n+\n+fn main() {\n+    foo!(crate::foo_bar::Example, Example1);\n+\n+    let i1 = foo_bar::Example::Example1 {};\n+\n+    assert_eq!(i1.foo_example(), 1);\n+\n+    let i2 = foo_bar::Example::Example2 {};\n+\n+    assert_eq!(i2.foo_example(), 2);\n+}\n+\n+#[macro_export]\n+macro_rules! foo {\n+    ($struct:path, $variant:ident) => {\n+        impl $struct {\n+            pub fn foo_example(&self) -> i32 {\n+                match self {\n+                    <$struct>::$variant { .. } => 1,\n+                    _ => 2,\n+                }\n+            }\n+        }\n+    };\n+}"}, {"sha": "072cf2f6674a1c81ec8b49a971dfda070eb5ec21", "filename": "src/tools/rustfmt/tests/target/issue-4926/deeply_nested_struct.rs", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fdeeply_nested_struct.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fdeeply_nested_struct.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fdeeply_nested_struct.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,38 @@\n+// rustfmt-struct_field_align_threshold: 30\n+\n+struct X {\n+    a: i32,\n+    b: i32,\n+    c: i32,\n+}\n+\n+fn test(x: X) {\n+    let d = {\n+        let e = {\n+            let f = {\n+                let g = {\n+                    let h = {\n+                        let i = {\n+                            let j = {\n+                                matches!(\n+                                    x,\n+                                    X {\n+                                        a: 1_000,\n+                                        b: 1_000,\n+                                        ..\n+                                    }\n+                                )\n+                            };\n+                            j\n+                        };\n+                        i\n+                    };\n+                    h\n+                };\n+                g\n+            };\n+            f\n+        };\n+        e\n+    };\n+}"}, {"sha": "c7bc7f7296d6b542ac59a9123e196afedb8f5bb6", "filename": "src/tools/rustfmt/tests/target/issue-4926/deeply_nested_struct_with_long_field_names.rs", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fdeeply_nested_struct_with_long_field_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fdeeply_nested_struct_with_long_field_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fdeeply_nested_struct_with_long_field_names.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,44 @@\n+// rustfmt-struct_field_align_threshold: 30\n+\n+struct X {\n+    really_really_long_field_a: i32,\n+    really_really_really_long_field_b: i32,\n+    really_really_really_really_long_field_c: i32,\n+    really_really_really_really_really_long_field_d: i32,\n+    really_really_really_really_really_really_long_field_e: i32,\n+    f: i32,\n+}\n+\n+fn test(x: X) {\n+    let d = {\n+        let e = {\n+            let f = {\n+                let g = {\n+                    let h = {\n+                        let i = {\n+                            let j = {\n+                                matches!(\n+                                    x,\n+                                    X {\n+                                        really_really_long_field_a: 10,\n+                                        really_really_really_long_field_b: 10,\n+                                        really_really_really_really_long_field_c: 10,\n+                                        really_really_really_really_really_long_field_d: 10,\n+                                        really_really_really_really_really_really_long_field_e: 10,\n+                                        ..\n+                                    }\n+                                )\n+                            };\n+                            j\n+                        };\n+                        i\n+                    };\n+                    h\n+                };\n+                g\n+            };\n+            f\n+        };\n+        e\n+    };\n+}"}, {"sha": "69793162519a7b10a25c3b4a03b0222cb952b8ae", "filename": "src/tools/rustfmt/tests/target/issue-4926/deeply_nested_struct_with_many_fields.rs", "status": "added", "additions": 54, "deletions": 0, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fdeeply_nested_struct_with_many_fields.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fdeeply_nested_struct_with_many_fields.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fdeeply_nested_struct_with_many_fields.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,54 @@\n+// rustfmt-struct_field_align_threshold: 30\n+\n+struct X {\n+    a: i32,\n+    b: i32,\n+    c: i32,\n+    d: i32,\n+    e: i32,\n+    f: i32,\n+    g: i32,\n+    h: i32,\n+    i: i32,\n+    j: i32,\n+    k: i32,\n+}\n+\n+fn test(x: X) {\n+    let d = {\n+        let e = {\n+            let f = {\n+                let g = {\n+                    let h = {\n+                        let i = {\n+                            let j = {\n+                                matches!(\n+                                    x,\n+                                    X {\n+                                        a: 1_000,\n+                                        b: 1_000,\n+                                        c: 1_000,\n+                                        d: 1_000,\n+                                        e: 1_000,\n+                                        f: 1_000,\n+                                        g: 1_000,\n+                                        h: 1_000,\n+                                        i: 1_000,\n+                                        j: 1_000,\n+                                        ..\n+                                    }\n+                                )\n+                            };\n+                            j\n+                        };\n+                        i\n+                    };\n+                    h\n+                };\n+                g\n+            };\n+            f\n+        };\n+        e\n+    };\n+}"}, {"sha": "2471df84653c94060ede65396e38935d910363cb", "filename": "src/tools/rustfmt/tests/target/issue-4926/enum_struct_field.rs", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fenum_struct_field.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fenum_struct_field.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fenum_struct_field.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,41 @@\n+// rustfmt-struct_field_align_threshold: 30\n+// rustfmt-enum_discrim_align_threshold: 30\n+// rustfmt-imports_layout: HorizontalVertical\n+\n+#[derive(Default)]\n+struct InnerStructA {\n+    bbbbbbbbb: i32,\n+    cccccccc:  i32,\n+}\n+\n+enum SomeEnumNamedD {\n+    E(InnerStructA),\n+    F {\n+        ggggggggggggggggggggggggg: bool,\n+        h:                         bool,\n+    },\n+}\n+\n+impl SomeEnumNamedD {\n+    fn f_variant() -> Self {\n+        Self::F {\n+            ggggggggggggggggggggggggg: true,\n+            h:                         true,\n+        }\n+    }\n+}\n+\n+fn main() {\n+    let kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk = SomeEnumNamedD::f_variant();\n+    let something_we_care_about = matches!(\n+        kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk,\n+        SomeEnumNamedD::F {\n+            ggggggggggggggggggggggggg: true,\n+            ..\n+        }\n+    );\n+\n+    if something_we_care_about {\n+        println!(\"Yup it happened\");\n+    }\n+}"}, {"sha": "06e18427465c9070c9eb200dfb0cfb621cac6dfb", "filename": "src/tools/rustfmt/tests/target/issue-4926/minimum_example.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fminimum_example.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fminimum_example.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fminimum_example.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,10 @@\n+// rustfmt-struct_field_align_threshold: 30\n+\n+struct X {\n+    a: i32,\n+    b: i32,\n+}\n+\n+fn test(x: X) {\n+    let y = matches!(x, X { a: 1, .. });\n+}"}, {"sha": "ac4674ab5d5207bf74edc56e42f7e0dd17c4c18a", "filename": "src/tools/rustfmt/tests/target/issue-4926/struct_with_long_field_names.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fstruct_with_long_field_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fstruct_with_long_field_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fstruct_with_long_field_names.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,24 @@\n+// rustfmt-struct_field_align_threshold: 30\n+\n+struct X {\n+    really_really_long_field_a: i32,\n+    really_really_really_long_field_b: i32,\n+    really_really_really_really_long_field_c: i32,\n+    really_really_really_really_really_long_field_d: i32,\n+    really_really_really_really_really_really_long_field_e: i32,\n+    f: i32,\n+}\n+\n+fn test(x: X) {\n+    let y = matches!(\n+        x,\n+        X {\n+            really_really_long_field_a: 10,\n+            really_really_really_long_field_b: 10,\n+            really_really_really_really_long_field_c: 10,\n+            really_really_really_really_really_long_field_d: 10,\n+            really_really_really_really_really_really_long_field_e: 10,\n+            ..\n+        }\n+    );\n+}"}, {"sha": "96dfe14bf7dd1c92c1d35c60cbe0f2af3f293f62", "filename": "src/tools/rustfmt/tests/target/issue-4926/struct_with_many_fields.rs", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fstruct_with_many_fields.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fstruct_with_many_fields.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4926%2Fstruct_with_many_fields.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,34 @@\n+// rustfmt-struct_field_align_threshold: 30\n+\n+struct X {\n+    a: i32,\n+    b: i32,\n+    c: i32,\n+    d: i32,\n+    e: i32,\n+    f: i32,\n+    g: i32,\n+    h: i32,\n+    i: i32,\n+    j: i32,\n+    k: i32,\n+}\n+\n+fn test(x: X) {\n+    let y = matches!(\n+        x,\n+        X {\n+            a: 1_000,\n+            b: 1_000,\n+            c: 1_000,\n+            d: 1_000,\n+            e: 1_000,\n+            f: 1_000,\n+            g: 1_000,\n+            h: 1_000,\n+            i: 1_000,\n+            j: 1_000,\n+            ..\n+        }\n+    );\n+}"}, {"sha": "f0599c5d694b29df53672314d64dff63c9f225df", "filename": "src/tools/rustfmt/tests/target/issue-4984/minimum_example.rs", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4984%2Fminimum_example.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4984%2Fminimum_example.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4984%2Fminimum_example.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,2 @@\n+#[derive(/*Debug, */ Clone)]\n+struct Foo;"}, {"sha": "5fbd9784adc97c5f0841c556f5fa695c218afebb", "filename": "src/tools/rustfmt/tests/target/issue-4984/multi_line_derive.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4984%2Fmulti_line_derive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4984%2Fmulti_line_derive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4984%2Fmulti_line_derive.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,26 @@\n+#[derive(\n+    /* ---------- Some really important comment that just had to go inside the derive --------- */\n+    Debug,\n+    Clone,\n+    Eq,\n+    PartialEq,\n+)]\n+struct Foo {\n+    a: i32,\n+    b: T,\n+}\n+\n+#[derive(\n+    /*\n+        Some really important comment that just had to go inside the derive.\n+        Also had to be put over multiple lines\n+    */\n+    Debug,\n+    Clone,\n+    Eq,\n+    PartialEq,\n+)]\n+struct Bar {\n+    a: i32,\n+    b: T,\n+}"}, {"sha": "d2924f0d0f2e2534ed8a8d85b6f49f40eaa8081c", "filename": "src/tools/rustfmt/tests/target/issue-4984/multiple_comments_within.rs", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4984%2Fmultiple_comments_within.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4984%2Fmultiple_comments_within.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4984%2Fmultiple_comments_within.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,11 @@\n+#[derive(\n+    /* ---------- Some really important comment that just had to go inside the derive --------- */\n+    Debug,\n+    Clone,\n+    /* Another comment */ Eq,\n+    PartialEq,\n+)]\n+struct Foo {\n+    a: i32,\n+    b: T,\n+}"}, {"sha": "e46ee511084fe9286191db52b46d32ce0addbeea", "filename": "src/tools/rustfmt/tests/target/issue-4984/should_not_change.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4984%2Fshould_not_change.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4984%2Fshould_not_change.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-4984%2Fshould_not_change.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,5 @@\n+#[derive(Clone, Debug, Eq, PartialEq)]\n+struct Foo;\n+\n+#[derive(Clone)]\n+struct Bar;"}, {"sha": "11cc645fa53561522fbe6e67bb68cdb80db5ea2b", "filename": "src/tools/rustfmt/tests/target/issue-5005/minimum_example.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5005%2Fminimum_example.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5005%2Fminimum_example.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5005%2Fminimum_example.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,9 @@\n+#![feature(more_qualified_paths)]\n+macro_rules! show {\n+    ($ty:ty, $ex:expr) => {\n+        match $ex {\n+            <$ty>::A(_val) => println!(\"got a\"), // formatting should not remove <$ty>::\n+            <$ty>::B => println!(\"got b\"),\n+        }\n+    };\n+}"}, {"sha": "55836f4bf52c784e95c0ae5354c209e707f7b0fc", "filename": "src/tools/rustfmt/tests/target/issue-5009/1_minimum_example.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F1_minimum_example.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F1_minimum_example.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F1_minimum_example.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,4 @@\n+fn main() {\n+    // the \"in\" inside the pattern produced invalid syntax\n+    for variable_in_here /* ... */ in 0..1 {}\n+}"}, {"sha": "d83590c6852fb47480ab7568d76e439536f0abdb", "filename": "src/tools/rustfmt/tests/target/issue-5009/2_many_in_connectors_in_pattern.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F2_many_in_connectors_in_pattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F2_many_in_connectors_in_pattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F2_many_in_connectors_in_pattern.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,3 @@\n+fn main() {\n+    for in_in_in_in_in_in_in_in /* ... */ in 0..1 {}\n+}"}, {"sha": "9c800723939bd310e0dd982dc4f8d6f99eccada5", "filename": "src/tools/rustfmt/tests/target/issue-5009/3_nested_for_loop_with_connector_in_pattern.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F3_nested_for_loop_with_connector_in_pattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F3_nested_for_loop_with_connector_in_pattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F3_nested_for_loop_with_connector_in_pattern.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,5 @@\n+fn main() {\n+    for variable_in_x /* ... */ in 0..1 {\n+        for variable_in_y /* ... */ in 0..1 {}\n+    }\n+}"}, {"sha": "a716d0d3082a5f8505921eda406312792c1d1bda", "filename": "src/tools/rustfmt/tests/target/issue-5009/4_nested_for_loop_with_if_elseif_else.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F4_nested_for_loop_with_if_elseif_else.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F4_nested_for_loop_with_if_elseif_else.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F4_nested_for_loop_with_if_elseif_else.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,13 @@\n+fn main() {\n+    for variable_in_x /* ... */ in 0..1 {\n+        for variable_in_y /* ... */ in 0..1 {\n+            if false {\n+\n+            } else if false {\n+\n+            } else {\n+\n+            }\n+        }\n+    }\n+}"}, {"sha": "41ea46d4cb9b8fa9a108ff14262d22c2583dc9e9", "filename": "src/tools/rustfmt/tests/target/issue-5009/5_nested_for_loop_with_connector_in_if_elseif_else.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F5_nested_for_loop_with_connector_in_if_elseif_else.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F5_nested_for_loop_with_connector_in_if_elseif_else.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F5_nested_for_loop_with_connector_in_if_elseif_else.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,15 @@\n+fn main() {\n+    let in_ = false;\n+\n+    for variable_in_x /* ... */ in 0..1 {\n+        for variable_in_y /* ... */ in 0..1 {\n+            if in_ {\n+\n+            } else if in_ {\n+\n+            } else {\n+\n+            }\n+        }\n+    }\n+}"}, {"sha": "789e54f7e5fb5bfe1747082f93f71c06e6d5b361", "filename": "src/tools/rustfmt/tests/target/issue-5009/6_deeply_nested_for_loop_with_connector_in_pattern.rs", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F6_deeply_nested_for_loop_with_connector_in_pattern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F6_deeply_nested_for_loop_with_connector_in_pattern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5009%2F6_deeply_nested_for_loop_with_connector_in_pattern.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,32 @@\n+fn main() {\n+    for variable_in_a /* ... */ in 0..1 {\n+        for variable_in_b /* ... */ in 0..1 {\n+            for variable_in_c /* ... */ in 0..1 {\n+                for variable_in_d /* ... */ in 0..1 {\n+                    for variable_in_e /* ... */ in 0..1 {\n+                        for variable_in_f /* ... */ in 0..1 {\n+                            for variable_in_g /* ... */ in 0..1 {\n+                                for variable_in_h /* ... */ in 0..1 {\n+                                    for variable_in_i /* ... */ in 0..1 {\n+                                        for variable_in_j /* ... */ in 0..1 {\n+                                            for variable_in_k /* ... */ in 0..1 {\n+                                                for variable_in_l /* ... */ in 0..1 {\n+                                                    for variable_in_m /* ... */ in 0..1 {\n+                                                        for variable_in_n /* ... */ in 0..1 {\n+                                                            for variable_in_o /* ... */ in 0..1 {\n+                                                            }\n+                                                        }\n+                                                    }\n+                                                }\n+                                            }\n+                                        }\n+                                    }\n+                                }\n+                            }\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+    }\n+}"}, {"sha": "9ad4a1929bdbf808932b7ba835b8041cb0f9537a", "filename": "src/tools/rustfmt/tests/target/issue-5011.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5011.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5011.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue-5011.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,8 @@\n+pub(crate) struct ASlash(\n+    // hello\n+    i32,\n+);\n+\n+pub(crate) struct AStar(/* hello */ i32);\n+\n+pub(crate) struct BStar(/* hello */ i32);"}, {"sha": "065d5395c7e73ad161d330877ec4445ed32951f6", "filename": "src/tools/rustfmt/tests/target/issue_4031.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4031.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4031.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4031.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,21 @@\n+fn foo() {\n+    with_woff2_glyf_table(\"tests/fonts/woff2/SFNT-TTF-Composite.woff2\", |glyf| {\n+        let actual = glyf\n+            .records\n+            .iter()\n+            .map(|glyph| match glyph {\n+                GlyfRecord::Parsed(\n+                    found @ Glyph {\n+                        data: GlyphData::Composite { .. },\n+                        ..\n+                    },\n+                ) => Some(found),\n+                _ => None,\n+            })\n+            .find(|candidate| candidate.is_some())\n+            .unwrap()\n+            .unwrap();\n+\n+        assert_eq!(*actual, expected)\n+    });\n+}"}, {"sha": "2e7e624ca6e6dbc343a2230874a778eb09041404", "filename": "src/tools/rustfmt/tests/target/issue_4032.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4032.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4032.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4032.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,18 @@\n+fn a1(\n+    #[aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa]\n+    a: u8,\n+) {\n+}\n+fn b1(\n+    #[aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa]\n+    bb: u8,\n+) {\n+}\n+fn a2(\n+    #[aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa] a: u8,\n+) {\n+}\n+fn b2(\n+    #[aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa] bb: u8,\n+) {\n+}"}, {"sha": "4a58c3946e12dae2c3ac6c441c60bc5c9b8b6f1f", "filename": "src/tools/rustfmt/tests/target/issue_4110.rs", "status": "added", "additions": 55, "deletions": 0, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4110.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4110.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4110.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,55 @@\n+fn bindings() {\n+    let err = match (place_desc, explanation) {\n+        (\n+            Some(ref name),\n+            BorrowExplanation::MustBeValidFor {\n+                category:\n+                    category @ (ConstraintCategory::Return\n+                    | ConstraintCategory::CallArgument\n+                    | ConstraintCategory::OpaqueType),\n+                from_closure: false,\n+                ref region_name,\n+                span,\n+                ..\n+            },\n+        ) if borrow_spans.for_generator() | borrow_spans.for_closure() => self\n+            .report_escaping_closure_capture(\n+                borrow_spans,\n+                borrow_span,\n+                region_name,\n+                category,\n+                span,\n+                &format!(\"`{}`\", name),\n+            ),\n+        (\n+            ref name,\n+            BorrowExplanation::MustBeValidFor {\n+                category: ConstraintCategory::Assignment,\n+                from_closure: false,\n+                region_name:\n+                    RegionName {\n+                        source: RegionNameSource::AnonRegionFromUpvar(upvar_span, ref upvar_name),\n+                        ..\n+                    },\n+                span,\n+                ..\n+            },\n+        ) => self.report_escaping_data(borrow_span, name, upvar_span, upvar_name, span),\n+        (Some(name), explanation) => self.report_local_value_does_not_live_long_enough(\n+            location,\n+            &name,\n+            &borrow,\n+            drop_span,\n+            borrow_spans,\n+            explanation,\n+        ),\n+        (None, explanation) => self.report_temporary_value_does_not_live_long_enough(\n+            location,\n+            &borrow,\n+            drop_span,\n+            borrow_spans,\n+            proper_span,\n+            explanation,\n+        ),\n+    };\n+}"}, {"sha": "1ebaaf2b6001814bc4bc7c9f2d16b3e440b81a66", "filename": "src/tools/rustfmt/tests/target/issue_4257.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4257.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4257.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4257.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,18 @@\n+#![feature(generic_associated_types)]\n+#![allow(incomplete_features)]\n+\n+trait Trait<T> {\n+    type Type<'a>\n+    where\n+        T: 'a;\n+    fn foo(x: &T) -> Self::Type<'_>;\n+}\n+impl<T> Trait<T> for () {\n+    type Type<'a>\n+    where\n+        T: 'a,\n+    = &'a T;\n+    fn foo(x: &T) -> Self::Type<'_> {\n+        x\n+    }\n+}"}, {"sha": "0ec0547119f474c35e88f9b49a6a4a685278f429", "filename": "src/tools/rustfmt/tests/target/issue_4322.rs", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4322.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4322.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4322.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,5 @@\n+trait Bar {\n+    type X<'a>\n+    where\n+        Self: 'a;\n+}"}, {"sha": "7b0a5f3a62e49085e9377f957045134f38f17be1", "filename": "src/tools/rustfmt/tests/target/issue_4579.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4579.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4579.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4579.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,16 @@\n+// rustfmt-hard_tabs: true\n+\n+#[macro_export]\n+macro_rules! main {\n+\t() => {\n+\t\t#[spirv(fragment)]\n+\t\tpub fn main_fs(\n+\t\t\tmut out_color: ::spirv_std::storage_class::Output<Vec4>,\n+\t\t\t#[spirv(descriptor_set = 1)]\n+\t\t\tiChannelResolution: ::spirv_std::storage_class::UniformConstant<\n+\t\t\t\t[::spirv_std::glam::Vec3A; 4],\n+\t\t\t>,\n+\t\t) {\n+\t\t}\n+\t};\n+}"}, {"sha": "890a62267ce6456a015eab74bb5d27bbb5675a7f", "filename": "src/tools/rustfmt/tests/target/issue_4911.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4911.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4911.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4911.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,9 @@\n+#![feature(generic_associated_types)]\n+#![feature(min_type_alias_impl_trait)]\n+\n+impl SomeTrait for SomeType {\n+    type SomeGAT<'a>\n+    where\n+        Self: 'a,\n+    = impl SomeOtherTrait;\n+}"}, {"sha": "c19e505fd03ad6b5c145f0aca15b8f6c3ce867a1", "filename": "src/tools/rustfmt/tests/target/issue_4936.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4936.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4936.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4936.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,10 @@\n+#[discard_params_doc]\n+trait Trait {\n+    fn foo(\n+        &self,\n+        /// some docs\n+        bar: String,\n+        /// another docs\n+        baz: i32,\n+    );\n+}"}, {"sha": "318f7ebed6e064ada327a9791caa7e106bf89109", "filename": "src/tools/rustfmt/tests/target/issue_4943.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4943.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4943.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4943.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,10 @@\n+#![feature(generic_associated_types)]\n+\n+impl SomeStruct {\n+    fn process<T>(v: T) -> <Self as GAT>::R<T>\n+    where\n+        Self: GAT<R<T> = T>,\n+    {\n+        SomeStruct::do_something(v)\n+    }\n+}"}, {"sha": "aa5e79befe9c875275db0ff8371af863db428cef", "filename": "src/tools/rustfmt/tests/target/issue_4954.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4954.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4954.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4954.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,7 @@\n+trait Foo {\n+    type Arg<'a>;\n+}\n+\n+struct Bar<T>(T)\n+where\n+    for<'a> T: Foo<Arg<'a> = ()>;"}, {"sha": "0c3c13579c13b0f2024bd40df149feded89ba4cd", "filename": "src/tools/rustfmt/tests/target/issue_4963.rs", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4963.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4963.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fissue_4963.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1,9 @@\n+mod test {\n+    extern \"C\" {\n+        fn test();\n+    }\n+}\n+\n+extern \"C\" {\n+    fn test();\n+}"}, {"sha": "5ab433a2e6cf65d8fff85bbbf19a136e7b181e51", "filename": "src/tools/rustfmt/tests/target/match-block-trailing-comma.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fmatch-block-trailing-comma.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fmatch-block-trailing-comma.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Fmatch-block-trailing-comma.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -8,6 +8,16 @@ fn foo() {\n             \"line1\";\n             \"line2\"\n         },\n+        ThisIsA::Guard if true => {\n+            \"line1\";\n+            \"line2\"\n+        },\n+        ThisIsA::ReallyLongPattern(ThatWillForce::TheGuard, ToWrapOnto::TheFollowingLine)\n+            if true =>\n+        {\n+            \"line1\";\n+            \"line2\"\n+        },\n         b => (\n             aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,\n             bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb,"}, {"sha": "7f067991b267b6e905ccdc23299b78b59ccd8552", "filename": "src/tools/rustfmt/tests/target/trait.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Ftrait.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Ftrait.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftests%2Ftarget%2Ftrait.rs?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -211,3 +211,10 @@ where\n         + DDDDDDDD\n         + DDDDDDDDD\n         + EEEEEEE;\n+\n+trait Visible {\n+    pub const C: i32;\n+    pub type T;\n+    pub fn f();\n+    pub fn g() {}\n+}"}, {"sha": "fa0824ac53c0a9c130636512c0271fc3f0e9c0e6", "filename": "src/tools/rustfmt/triagebot.toml", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftriagebot.toml", "raw_url": "https://github.com/rust-lang/rust/raw/cf708558b758f4473c4f35986d9492ace7bf906d/src%2Ftools%2Frustfmt%2Ftriagebot.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Ftriagebot.toml?ref=cf708558b758f4473c4f35986d9492ace7bf906d", "patch": "@@ -0,0 +1 @@\n+[assign]"}]}