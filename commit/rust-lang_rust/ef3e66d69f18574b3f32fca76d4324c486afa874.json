{"sha": "ef3e66d69f18574b3f32fca76d4324c486afa874", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVmM2U2NmQ2OWYxODU3NGIzZjMyZmNhNzZkNDMyNGM0ODZhZmE4NzQ=", "commit": {"author": {"name": "Giles Cope", "email": "gilescope@gmail.com", "date": "2019-08-19T12:25:06Z"}, "committer": {"name": "Giles Cope", "email": "gilescope@gmail.com", "date": "2019-08-19T16:14:38Z"}, "message": "Fix suggestion from move async to async move.", "tree": {"sha": "81b55492a5db8687768eb242413746e25406de6d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/81b55492a5db8687768eb242413746e25406de6d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ef3e66d69f18574b3f32fca76d4324c486afa874", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ef3e66d69f18574b3f32fca76d4324c486afa874", "html_url": "https://github.com/rust-lang/rust/commit/ef3e66d69f18574b3f32fca76d4324c486afa874", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ef3e66d69f18574b3f32fca76d4324c486afa874/comments", "author": {"login": "gilescope", "id": 803976, "node_id": "MDQ6VXNlcjgwMzk3Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/803976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gilescope", "html_url": "https://github.com/gilescope", "followers_url": "https://api.github.com/users/gilescope/followers", "following_url": "https://api.github.com/users/gilescope/following{/other_user}", "gists_url": "https://api.github.com/users/gilescope/gists{/gist_id}", "starred_url": "https://api.github.com/users/gilescope/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gilescope/subscriptions", "organizations_url": "https://api.github.com/users/gilescope/orgs", "repos_url": "https://api.github.com/users/gilescope/repos", "events_url": "https://api.github.com/users/gilescope/events{/privacy}", "received_events_url": "https://api.github.com/users/gilescope/received_events", "type": "User", "site_admin": false}, "committer": {"login": "gilescope", "id": 803976, "node_id": "MDQ6VXNlcjgwMzk3Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/803976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gilescope", "html_url": "https://github.com/gilescope", "followers_url": "https://api.github.com/users/gilescope/followers", "following_url": "https://api.github.com/users/gilescope/following{/other_user}", "gists_url": "https://api.github.com/users/gilescope/gists{/gist_id}", "starred_url": "https://api.github.com/users/gilescope/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gilescope/subscriptions", "organizations_url": "https://api.github.com/users/gilescope/orgs", "repos_url": "https://api.github.com/users/gilescope/repos", "events_url": "https://api.github.com/users/gilescope/events{/privacy}", "received_events_url": "https://api.github.com/users/gilescope/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9dd5c191993aab6c2f1538eb8ab69afdc4b6e67a", "url": "https://api.github.com/repos/rust-lang/rust/commits/9dd5c191993aab6c2f1538eb8ab69afdc4b6e67a", "html_url": "https://github.com/rust-lang/rust/commit/9dd5c191993aab6c2f1538eb8ab69afdc4b6e67a"}], "stats": {"total": 42, "additions": 41, "deletions": 1}, "files": [{"sha": "247783c420e251d6d32b79835fba3e1dbb303379", "filename": "src/librustc_mir/borrow_check/conflict_errors.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/ef3e66d69f18574b3f32fca76d4324c486afa874/src%2Flibrustc_mir%2Fborrow_check%2Fconflict_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ef3e66d69f18574b3f32fca76d4324c486afa874/src%2Flibrustc_mir%2Fborrow_check%2Fconflict_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fconflict_errors.rs?ref=ef3e66d69f18574b3f32fca76d4324c486afa874", "patch": "@@ -1190,7 +1190,16 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n         );\n \n         let suggestion = match tcx.sess.source_map().span_to_snippet(args_span) {\n-            Ok(string) => format!(\"move {}\", string),\n+            Ok(mut string) => {\n+                if string.starts_with(\"async \") {\n+                    string.insert_str(6, \"move \");\n+                } else if string.starts_with(\"async|\") {\n+                    string.insert_str(5, \" move\");\n+                } else {\n+                    string.insert_str(0, \"move \");\n+                };\n+                string\n+            },\n             Err(_) => \"move |<args>| <body>\".to_string()\n         };\n "}, {"sha": "d2fa5d0a3d0f189b5507dd4c6c1566f866fbba5c", "filename": "src/test/ui/async-await/async-borrowck-escaping-closure-error.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/ef3e66d69f18574b3f32fca76d4324c486afa874/src%2Ftest%2Fui%2Fasync-await%2Fasync-borrowck-escaping-closure-error.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ef3e66d69f18574b3f32fca76d4324c486afa874/src%2Ftest%2Fui%2Fasync-await%2Fasync-borrowck-escaping-closure-error.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fasync-borrowck-escaping-closure-error.rs?ref=ef3e66d69f18574b3f32fca76d4324c486afa874", "patch": "@@ -0,0 +1,10 @@\n+// edition:2018\n+#![feature(async_closure,async_await)]\n+fn foo() -> Box<dyn std::future::Future<Output = u32>> {\n+    let x = 0u32;\n+    Box::new((async || x)())\n+    //~^ ERROR E0373\n+}\n+\n+fn main() {\n+}"}, {"sha": "8bcfcf989208e05fbdbd5eba66d2176e1f09c824", "filename": "src/test/ui/async-await/async-borrowck-escaping-closure-error.stderr", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/ef3e66d69f18574b3f32fca76d4324c486afa874/src%2Ftest%2Fui%2Fasync-await%2Fasync-borrowck-escaping-closure-error.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/ef3e66d69f18574b3f32fca76d4324c486afa874/src%2Ftest%2Fui%2Fasync-await%2Fasync-borrowck-escaping-closure-error.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fasync-await%2Fasync-borrowck-escaping-closure-error.stderr?ref=ef3e66d69f18574b3f32fca76d4324c486afa874", "patch": "@@ -0,0 +1,21 @@\n+error[E0373]: closure may outlive the current function, but it borrows `x`, which is owned by the current function\n+  --> $DIR/async-borrowck-escaping-closure-error.rs:5:15\n+   |\n+LL |     Box::new((async || x)())\n+   |               ^^^^^^^^ - `x` is borrowed here\n+   |               |\n+   |               may outlive borrowed value `x`\n+   |\n+note: closure is returned here\n+  --> $DIR/async-borrowck-escaping-closure-error.rs:5:5\n+   |\n+LL |     Box::new((async || x)())\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^\n+help: to force the closure to take ownership of `x` (and any other referenced variables), use the `move` keyword\n+   |\n+LL |     Box::new((async move || x)())\n+   |               ^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0373`."}]}