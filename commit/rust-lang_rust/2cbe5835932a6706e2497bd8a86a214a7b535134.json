{"sha": "2cbe5835932a6706e2497bd8a86a214a7b535134", "node_id": "C_kwDOAAsO6NoAKDJjYmU1ODM1OTMyYTY3MDZlMjQ5N2JkOGE4NmEyMTRhN2I1MzUxMzQ", "commit": {"author": {"name": "lcnr", "email": "rust@lcnr.de", "date": "2023-02-20T11:01:44Z"}, "committer": {"name": "lcnr", "email": "rust@lcnr.de", "date": "2023-02-20T11:58:11Z"}, "message": "`const` generic -> const parameter in err msg", "tree": {"sha": "0984b9642a3228d52e44826011285ebd254f1b22", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0984b9642a3228d52e44826011285ebd254f1b22"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2cbe5835932a6706e2497bd8a86a214a7b535134", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2cbe5835932a6706e2497bd8a86a214a7b535134", "html_url": "https://github.com/rust-lang/rust/commit/2cbe5835932a6706e2497bd8a86a214a7b535134", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2cbe5835932a6706e2497bd8a86a214a7b535134/comments", "author": {"login": "lcnr", "id": 29864074, "node_id": "MDQ6VXNlcjI5ODY0MDc0", "avatar_url": "https://avatars.githubusercontent.com/u/29864074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lcnr", "html_url": "https://github.com/lcnr", "followers_url": "https://api.github.com/users/lcnr/followers", "following_url": "https://api.github.com/users/lcnr/following{/other_user}", "gists_url": "https://api.github.com/users/lcnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lcnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lcnr/subscriptions", "organizations_url": "https://api.github.com/users/lcnr/orgs", "repos_url": "https://api.github.com/users/lcnr/repos", "events_url": "https://api.github.com/users/lcnr/events{/privacy}", "received_events_url": "https://api.github.com/users/lcnr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "lcnr", "id": 29864074, "node_id": "MDQ6VXNlcjI5ODY0MDc0", "avatar_url": "https://avatars.githubusercontent.com/u/29864074?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lcnr", "html_url": "https://github.com/lcnr", "followers_url": "https://api.github.com/users/lcnr/followers", "following_url": "https://api.github.com/users/lcnr/following{/other_user}", "gists_url": "https://api.github.com/users/lcnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/lcnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lcnr/subscriptions", "organizations_url": "https://api.github.com/users/lcnr/orgs", "repos_url": "https://api.github.com/users/lcnr/repos", "events_url": "https://api.github.com/users/lcnr/events{/privacy}", "received_events_url": "https://api.github.com/users/lcnr/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7e253a7fb2e2e050021fed32da6fa2ec7bcea0fb", "url": "https://api.github.com/repos/rust-lang/rust/commits/7e253a7fb2e2e050021fed32da6fa2ec7bcea0fb", "html_url": "https://github.com/rust-lang/rust/commit/7e253a7fb2e2e050021fed32da6fa2ec7bcea0fb"}], "stats": {"total": 21, "additions": 9, "deletions": 12}, "files": [{"sha": "630becc09d26e482b976c15f90427cec30294a72", "filename": "compiler/rustc_hir_analysis/src/astconv/generics.rs", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/2cbe5835932a6706e2497bd8a86a214a7b535134/compiler%2Frustc_hir_analysis%2Fsrc%2Fastconv%2Fgenerics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2cbe5835932a6706e2497bd8a86a214a7b535134/compiler%2Frustc_hir_analysis%2Fsrc%2Fastconv%2Fgenerics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_analysis%2Fsrc%2Fastconv%2Fgenerics.rs?ref=2cbe5835932a6706e2497bd8a86a214a7b535134", "patch": "@@ -6,7 +6,7 @@ use crate::astconv::{\n use crate::errors::AssocTypeBindingNotAllowed;\n use crate::structured_errors::{GenericArgsInfo, StructuredDiagnostic, WrongNumberOfGenericArgs};\n use rustc_ast::ast::ParamKindOrd;\n-use rustc_errors::{struct_span_err, Applicability, Diagnostic, MultiSpan};\n+use rustc_errors::{struct_span_err, Applicability, Diagnostic, ErrorGuaranteed, MultiSpan};\n use rustc_hir as hir;\n use rustc_hir::def::{DefKind, Res};\n use rustc_hir::def_id::DefId;\n@@ -26,7 +26,7 @@ fn generic_arg_mismatch_err(\n     param: &GenericParamDef,\n     possible_ordering_error: bool,\n     help: Option<&str>,\n-) {\n+) -> ErrorGuaranteed {\n     let sess = tcx.sess;\n     let mut err = struct_span_err!(\n         sess,\n@@ -70,9 +70,9 @@ fn generic_arg_mismatch_err(\n         ) => match path.res {\n             Res::Err => {\n                 add_braces_suggestion(arg, &mut err);\n-                err.set_primary_message(\"unresolved item provided when a constant was expected\")\n+                return err\n+                    .set_primary_message(\"unresolved item provided when a constant was expected\")\n                     .emit();\n-                return;\n             }\n             Res::Def(DefKind::TyParam, src_def_id) => {\n                 if let Some(param_local_id) = param.def_id.as_local() {\n@@ -81,7 +81,7 @@ fn generic_arg_mismatch_err(\n                     if param_type.is_suggestable(tcx, false) {\n                         err.span_suggestion(\n                             tcx.def_span(src_def_id),\n-                            \"consider changing this type parameter to be a `const` generic\",\n+                            \"consider changing this type parameter to a const parameter\",\n                             format!(\"const {}: {}\", param_name, param_type),\n                             Applicability::MaybeIncorrect,\n                         );\n@@ -137,7 +137,7 @@ fn generic_arg_mismatch_err(\n         }\n     }\n \n-    err.emit();\n+    err.emit()\n }\n \n /// Creates the relevant generic argument substitutions"}, {"sha": "cee34e3b7159372c46c44e06a75c29b9c0dfe8d5", "filename": "tests/ui/const-generics/early/invalid-const-arguments.stderr", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/2cbe5835932a6706e2497bd8a86a214a7b535134/tests%2Fui%2Fconst-generics%2Fearly%2Finvalid-const-arguments.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2cbe5835932a6706e2497bd8a86a214a7b535134/tests%2Fui%2Fconst-generics%2Fearly%2Finvalid-const-arguments.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fconst-generics%2Fearly%2Finvalid-const-arguments.stderr?ref=2cbe5835932a6706e2497bd8a86a214a7b535134", "patch": "@@ -49,12 +49,9 @@ error[E0747]: type provided when a constant was expected\n   --> $DIR/invalid-const-arguments.rs:10:19\n    |\n LL | impl<N> Foo for B<N> {}\n-   |                   ^\n-   |\n-help: consider changing this type parameter to be a `const` generic\n-   |\n-LL | impl<const N: u8> Foo for B<N> {}\n-   |      ~~~~~~~~~~~\n+   |      -            ^\n+   |      |\n+   |      help: consider changing this type parameter to a const parameter: `const N: u8`\n \n error[E0747]: unresolved item provided when a constant was expected\n   --> $DIR/invalid-const-arguments.rs:14:32"}]}