{"sha": "488199d88f7248d6109448ab3fb588407f5e4cac", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ4ODE5OWQ4OGY3MjQ4ZDYxMDk0NDhhYjNmYjU4ODQwN2Y1ZTRjYWM=", "commit": {"author": {"name": "Martin Carton", "email": "cartonmartin+github@gmail.com", "date": "2016-05-09T11:15:33Z"}, "committer": {"name": "Martin Carton", "email": "cartonmartin+github@gmail.com", "date": "2016-05-09T11:15:33Z"}, "message": "Merge pull request #884 from oli-obk/needless_ref2\n\nAdd a `needless_borrow` lint", "tree": {"sha": "c12a3002eadec884821b448527675180c35f6c8e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c12a3002eadec884821b448527675180c35f6c8e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/488199d88f7248d6109448ab3fb588407f5e4cac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/488199d88f7248d6109448ab3fb588407f5e4cac", "html_url": "https://github.com/rust-lang/rust/commit/488199d88f7248d6109448ab3fb588407f5e4cac", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/488199d88f7248d6109448ab3fb588407f5e4cac/comments", "author": {"login": "mcarton", "id": 3751788, "node_id": "MDQ6VXNlcjM3NTE3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/3751788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarton", "html_url": "https://github.com/mcarton", "followers_url": "https://api.github.com/users/mcarton/followers", "following_url": "https://api.github.com/users/mcarton/following{/other_user}", "gists_url": "https://api.github.com/users/mcarton/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarton/subscriptions", "organizations_url": "https://api.github.com/users/mcarton/orgs", "repos_url": "https://api.github.com/users/mcarton/repos", "events_url": "https://api.github.com/users/mcarton/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mcarton", "id": 3751788, "node_id": "MDQ6VXNlcjM3NTE3ODg=", "avatar_url": "https://avatars.githubusercontent.com/u/3751788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mcarton", "html_url": "https://github.com/mcarton", "followers_url": "https://api.github.com/users/mcarton/followers", "following_url": "https://api.github.com/users/mcarton/following{/other_user}", "gists_url": "https://api.github.com/users/mcarton/gists{/gist_id}", "starred_url": "https://api.github.com/users/mcarton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mcarton/subscriptions", "organizations_url": "https://api.github.com/users/mcarton/orgs", "repos_url": "https://api.github.com/users/mcarton/repos", "events_url": "https://api.github.com/users/mcarton/events{/privacy}", "received_events_url": "https://api.github.com/users/mcarton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d70e7bb5fc96f56e7ef14bdfeeb3176a4bbffc7f", "url": "https://api.github.com/repos/rust-lang/rust/commits/d70e7bb5fc96f56e7ef14bdfeeb3176a4bbffc7f", "html_url": "https://github.com/rust-lang/rust/commit/d70e7bb5fc96f56e7ef14bdfeeb3176a4bbffc7f"}, {"sha": "ba8653a8da189aaa629bd1e70c09146e23671328", "url": "https://api.github.com/repos/rust-lang/rust/commits/ba8653a8da189aaa629bd1e70c09146e23671328", "html_url": "https://github.com/rust-lang/rust/commit/ba8653a8da189aaa629bd1e70c09146e23671328"}], "stats": {"total": 157, "additions": 120, "deletions": 37}, "files": [{"sha": "3fb3c6869485f35b6f794ba823dbfdb5193f5d0c", "filename": "CHANGELOG.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/CHANGELOG.md", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/CHANGELOG.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/CHANGELOG.md?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -149,6 +149,7 @@ All notable changes to this project will be documented in this file.\n [`mutex_atomic`]: https://github.com/Manishearth/rust-clippy/wiki#mutex_atomic\n [`mutex_integer`]: https://github.com/Manishearth/rust-clippy/wiki#mutex_integer\n [`needless_bool`]: https://github.com/Manishearth/rust-clippy/wiki#needless_bool\n+[`needless_borrow`]: https://github.com/Manishearth/rust-clippy/wiki#needless_borrow\n [`needless_lifetimes`]: https://github.com/Manishearth/rust-clippy/wiki#needless_lifetimes\n [`needless_range_loop`]: https://github.com/Manishearth/rust-clippy/wiki#needless_range_loop\n [`needless_return`]: https://github.com/Manishearth/rust-clippy/wiki#needless_return"}, {"sha": "8f3519c95c43fb7e2045831fa3484f792e5631f3", "filename": "README.md", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -17,7 +17,7 @@ Table of contents:\n \n ## Lints\n \n-There are 146 lints included in this crate:\n+There are 147 lints included in this crate:\n \n name                                                                                                                 | default | meaning\n ---------------------------------------------------------------------------------------------------------------------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n@@ -97,6 +97,7 @@ name\n [mutex_atomic](https://github.com/Manishearth/rust-clippy/wiki#mutex_atomic)                                         | warn    | using a Mutex where an atomic value could be used instead\n [mutex_integer](https://github.com/Manishearth/rust-clippy/wiki#mutex_integer)                                       | allow   | using a Mutex for an integer type\n [needless_bool](https://github.com/Manishearth/rust-clippy/wiki#needless_bool)                                       | warn    | if-statements with plain booleans in the then- and else-clause, e.g. `if p { true } else { false }`\n+[needless_borrow](https://github.com/Manishearth/rust-clippy/wiki#needless_borrow)                                   | warn    | taking a reference that is going to be automatically dereferenced\n [needless_lifetimes](https://github.com/Manishearth/rust-clippy/wiki#needless_lifetimes)                             | warn    | using explicit lifetimes for references in function arguments when elision rules would allow omitting them\n [needless_range_loop](https://github.com/Manishearth/rust-clippy/wiki#needless_range_loop)                           | warn    | for-looping over a range of indices where an iterator over items would do\n [needless_return](https://github.com/Manishearth/rust-clippy/wiki#needless_return)                                   | warn    | using a return statement like `return expr;` where an expression would suffice"}, {"sha": "ce2b9a7d6c00e530b1c33d3e76b8ff6fe5268f66", "filename": "src/array_indexing.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Farray_indexing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Farray_indexing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Farray_indexing.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -67,7 +67,7 @@ impl LateLintPass for ArrayIndexing {\n                 let size = ConstInt::Infer(size as u64);\n \n                 // Index is a constant uint\n-                let const_index = eval_const_expr_partial(cx.tcx, &index, ExprTypeChecked, None);\n+                let const_index = eval_const_expr_partial(cx.tcx, index, ExprTypeChecked, None);\n                 if let Ok(ConstVal::Integral(const_index)) = const_index {\n                     if size <= const_index {\n                         utils::span_lint(cx, OUT_OF_BOUNDS_INDEXING, e.span, \"const index is out of bounds\");"}, {"sha": "c56cf4dcd29237a623a853cbb9c819558b8f4f00", "filename": "src/block_in_if_condition.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fblock_in_if_condition.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fblock_in_if_condition.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fblock_in_if_condition.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -59,7 +59,7 @@ impl<'v> Visitor<'v> for ExVisitor<'v> {\n                 }\n             };\n             if complex {\n-                self.found_block = Some(&expr);\n+                self.found_block = Some(expr);\n                 return;\n             }\n         }"}, {"sha": "9ab806f66ec559fdca5cf1c6bdfe705e6633b578", "filename": "src/booleans.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fbooleans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fbooleans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbooleans.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -221,7 +221,7 @@ fn suggest(cx: &LateContext, suggestion: &Bool, terminals: &[&Expr]) -> String {\n                         s.push('(');\n                     }\n                 }\n-                s.push_str(&snip(&terminals[n as usize]));\n+                s.push_str(&snip(terminals[n as usize]));\n                 if brackets {\n                     if let ExprBinary(..) = terminals[n as usize].node {\n                         s.push(')');\n@@ -319,7 +319,7 @@ impl<'a, 'tcx> NonminimalBoolVisitor<'a, 'tcx> {\n             }\n             let mut improvements = Vec::new();\n             'simplified: for suggestion in &simplified {\n-                let simplified_stats = terminal_stats(&suggestion);\n+                let simplified_stats = terminal_stats(suggestion);\n                 let mut improvement = false;\n                 for i in 0..32 {\n                     // ignore any \"simplifications\" that end up requiring a terminal more often than in the original expression"}, {"sha": "96956d1793b6fafcde17dd1b6ed4e9633d9693fc", "filename": "src/consts.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fconsts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fconsts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fconsts.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -164,14 +164,14 @@ impl PartialOrd for Constant {\n                 }\n             }\n             (&Constant::Bool(ref l), &Constant::Bool(ref r)) => Some(l.cmp(r)),\n-            (&Constant::Vec(ref l), &Constant::Vec(ref r)) => l.partial_cmp(&r),\n+            (&Constant::Tuple(ref l), &Constant::Tuple(ref r)) |\n+            (&Constant::Vec(ref l), &Constant::Vec(ref r)) => l.partial_cmp(r),\n             (&Constant::Repeat(ref lv, ref ls), &Constant::Repeat(ref rv, ref rs)) => {\n                 match lv.partial_cmp(rv) {\n                     Some(Equal) => Some(ls.cmp(rs)),\n                     x => x,\n                 }\n             }\n-            (&Constant::Tuple(ref l), &Constant::Tuple(ref r)) => l.partial_cmp(r),\n             _ => None, //TODO: Are there any useful inter-type orderings?\n         }\n     }"}, {"sha": "aa9f243e8c7fc383374b2812b0ba95da1fd9e3af", "filename": "src/copies.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fcopies.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fcopies.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcopies.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -142,7 +142,7 @@ fn lint_match_arms(cx: &LateContext, expr: &Expr) {\n     };\n \n     if let ExprMatch(_, ref arms, MatchSource::Normal) = expr.node {\n-        if let Some((i, j)) = search_same(&arms, hash, eq) {\n+        if let Some((i, j)) = search_same(arms, hash, eq) {\n             span_note_and_lint(cx,\n                                MATCH_SAME_ARMS,\n                                j.body.span,\n@@ -256,8 +256,8 @@ fn search_same<T, Hash, Eq>(exprs: &[T], hash: Hash, eq: Eq) -> Option<(&T, &T)>\n         match map.entry(hash(expr)) {\n             Entry::Occupied(o) => {\n                 for o in o.get() {\n-                    if eq(&o, expr) {\n-                        return Some((&o, expr));\n+                    if eq(o, expr) {\n+                        return Some((o, expr));\n                     }\n                 }\n             }"}, {"sha": "858affd2bbb1bf891d0c163a0d0fa15556dccb2b", "filename": "src/cyclomatic_complexity.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fcyclomatic_complexity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fcyclomatic_complexity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcyclomatic_complexity.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -58,7 +58,7 @@ impl CyclomaticComplexity {\n             divergence: 0,\n             short_circuits: 0,\n             returns: 0,\n-            tcx: &cx.tcx,\n+            tcx: cx.tcx,\n         };\n         helper.visit_block(block);\n         let CCHelper { match_arms, divergence, short_circuits, returns, .. } = helper;"}, {"sha": "a1f2c5e1441d149c4f0faf4c802b1c6deb2fa61a", "filename": "src/enum_variants.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fenum_variants.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fenum_variants.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fenum_variants.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -68,9 +68,9 @@ impl EarlyLintPass for EnumVariantNames {\n             for var in &def.variants {\n                 let name = var2str(var);\n \n-                let pre_match = partial_match(&pre, &name);\n+                let pre_match = partial_match(pre, &name);\n                 pre = &pre[..pre_match];\n-                let pre_camel = camel_case_until(&pre);\n+                let pre_camel = camel_case_until(pre);\n                 pre = &pre[..pre_camel];\n                 while let Some((next, last)) = name[pre.len()..].chars().zip(pre.chars().rev()).next() {\n                     if next.is_lowercase() {\n@@ -82,10 +82,10 @@ impl EarlyLintPass for EnumVariantNames {\n                     }\n                 }\n \n-                let post_match = partial_rmatch(&post, &name);\n+                let post_match = partial_rmatch(post, &name);\n                 let post_end = post.len() - post_match;\n                 post = &post[post_end..];\n-                let post_camel = camel_case_from(&post);\n+                let post_camel = camel_case_from(post);\n                 post = &post[post_camel..];\n             }\n             let (what, value) = match (pre.is_empty(), post.is_empty()) {"}, {"sha": "9dae856764a197c6f6405d6e83288d36c092de16", "filename": "src/len_zero.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Flen_zero.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Flen_zero.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flen_zero.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -184,7 +184,7 @@ fn has_is_empty(cx: &LateContext, expr: &Expr) -> bool {\n         })\n     }\n \n-    let ty = &walk_ptrs_ty(&cx.tcx.expr_ty(expr));\n+    let ty = &walk_ptrs_ty(cx.tcx.expr_ty(expr));\n     match ty.sty {\n         ty::TyTrait(_) => {\n             cx.tcx"}, {"sha": "e5d374a560fbc266b4ab4e4d17e9dbfbac967a92", "filename": "src/lib.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -96,6 +96,7 @@ pub mod mut_mut;\n pub mod mut_reference;\n pub mod mutex_atomic;\n pub mod needless_bool;\n+pub mod needless_borrow;\n pub mod needless_update;\n pub mod neg_multiply;\n pub mod new_without_default;\n@@ -140,7 +141,7 @@ pub fn plugin_registrar(reg: &mut Registry) {\n                 (\"clippy.toml\", false)\n             };\n \n-            let (conf, errors) = utils::conf::read_conf(&file_name, must_exist);\n+            let (conf, errors) = utils::conf::read_conf(file_name, must_exist);\n \n             // all conf errors are non-fatal, we just use the default conf in case of error\n             for error in errors {\n@@ -210,6 +211,7 @@ pub fn plugin_registrar(reg: &mut Registry) {\n     reg.register_late_lint_pass(box zero_div_zero::ZeroDivZeroPass);\n     reg.register_late_lint_pass(box mutex_atomic::MutexAtomic);\n     reg.register_late_lint_pass(box needless_update::NeedlessUpdatePass);\n+    reg.register_late_lint_pass(box needless_borrow::NeedlessBorrow);\n     reg.register_late_lint_pass(box no_effect::NoEffectPass);\n     reg.register_late_lint_pass(box map_clone::MapClonePass);\n     reg.register_late_lint_pass(box temporary_assignment::TemporaryAssignmentPass);\n@@ -364,6 +366,7 @@ pub fn plugin_registrar(reg: &mut Registry) {\n         mutex_atomic::MUTEX_ATOMIC,\n         needless_bool::BOOL_COMPARISON,\n         needless_bool::NEEDLESS_BOOL,\n+        needless_borrow::NEEDLESS_BORROW,\n         needless_update::NEEDLESS_UPDATE,\n         neg_multiply::NEG_MULTIPLY,\n         new_without_default::NEW_WITHOUT_DEFAULT,"}, {"sha": "b9771e18ffc1fe5a21500b8f1bb37e5ec7f958dd", "filename": "src/lifetimes.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Flifetimes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Flifetimes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flifetimes.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -46,7 +46,7 @@ impl LintPass for LifetimePass {\n impl LateLintPass for LifetimePass {\n     fn check_item(&mut self, cx: &LateContext, item: &Item) {\n         if let ItemFn(ref decl, _, _, _, ref generics, _) = item.node {\n-            check_fn_inner(cx, decl, None, &generics, item.span);\n+            check_fn_inner(cx, decl, None, generics, item.span);\n         }\n     }\n \n@@ -102,7 +102,7 @@ fn check_fn_inner(cx: &LateContext, decl: &FnDecl, slf: Option<&ExplicitSelf>, g\n                   span,\n                   \"explicit lifetimes given in parameter types where they could be elided\");\n     }\n-    report_extra_lifetimes(cx, decl, &generics, slf);\n+    report_extra_lifetimes(cx, decl, generics, slf);\n }\n \n fn could_use_elision<'a, T: Iterator<Item = &'a Lifetime>>(cx: &LateContext, func: &FnDecl, slf: Option<&ExplicitSelf>,"}, {"sha": "2384c8453037b37276998b06b6a82a87df0ac9b9", "filename": "src/loops.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Floops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Floops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Floops.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -328,7 +328,7 @@ fn check_for_loop(cx: &LateContext, pat: &Pat, arg: &Expr, body: &Expr, expr: &E\n /// Check for looping over a range and then indexing a sequence with it.\n /// The iteratee must be a range literal.\n fn check_for_loop_range(cx: &LateContext, pat: &Pat, arg: &Expr, body: &Expr, expr: &Expr) {\n-    if let Some(UnsugaredRange { start: Some(ref start), ref end, .. }) = unsugar_range(&arg) {\n+    if let Some(UnsugaredRange { start: Some(ref start), ref end, .. }) = unsugar_range(arg) {\n         // the var must be a single name\n         if let PatKind::Ident(_, ref ident, _) = pat.node {\n             let mut visitor = VarVisitor {\n@@ -363,7 +363,7 @@ fn check_for_loop_range(cx: &LateContext, pat: &Pat, arg: &Expr, body: &Expr, ex\n                 };\n \n                 let take: Cow<_> = if let Some(ref end) = *end {\n-                    if is_len_call(&end, &indexed) {\n+                    if is_len_call(end, &indexed) {\n                         \"\".into()\n                     } else {\n                         format!(\".take({})\", snippet(cx, end.span, \"..\")).into()\n@@ -422,10 +422,10 @@ fn is_len_call(expr: &Expr, var: &Name) -> bool {\n \n fn check_for_loop_reverse_range(cx: &LateContext, arg: &Expr, expr: &Expr) {\n     // if this for loop is iterating over a two-sided range...\n-    if let Some(UnsugaredRange { start: Some(ref start), end: Some(ref end), limits }) = unsugar_range(&arg) {\n+    if let Some(UnsugaredRange { start: Some(ref start), end: Some(ref end), limits }) = unsugar_range(arg) {\n         // ...and both sides are compile-time constant integers...\n-        if let Ok(start_idx) = eval_const_expr_partial(&cx.tcx, start, ExprTypeChecked, None) {\n-            if let Ok(end_idx) = eval_const_expr_partial(&cx.tcx, end, ExprTypeChecked, None) {\n+        if let Ok(start_idx) = eval_const_expr_partial(cx.tcx, start, ExprTypeChecked, None) {\n+            if let Ok(end_idx) = eval_const_expr_partial(cx.tcx, end, ExprTypeChecked, None) {\n                 // ...and the start index is greater than the end index,\n                 // this loop will never run. This is often confusing for developers\n                 // who think that this will iterate from the larger value to the"}, {"sha": "db4ccf2dcdbe2a9ae474c4e9e7879a2d0749ff16", "filename": "src/matches.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fmatches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fmatches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmatches.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -461,8 +461,8 @@ pub fn overlapping<T>(ranges: &[SpannedRange<T>]) -> Option<(&SpannedRange<T>, &\n     let mut values = Vec::with_capacity(2 * ranges.len());\n \n     for r in ranges {\n-        values.push(Kind::Start(r.node.0, &r));\n-        values.push(Kind::End(r.node.1, &r));\n+        values.push(Kind::Start(r.node.0, r));\n+        values.push(Kind::End(r.node.1, r));\n     }\n \n     values.sort();\n@@ -475,7 +475,7 @@ pub fn overlapping<T>(ranges: &[SpannedRange<T>]) -> Option<(&SpannedRange<T>, &\n                 }\n             }\n             (&Kind::End(a, _), &Kind::Start(b, _)) if a != b => (),\n-            _ => return Some((&a.range(), &b.range())),\n+            _ => return Some((a.range(), b.range())),\n         }\n     }\n "}, {"sha": "5b86aab1aa1a0c43f7787fa590428412dbb911f8", "filename": "src/methods.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fmethods.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fmethods.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmethods.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -365,7 +365,7 @@ impl LateLintPass for MethodsPass {\n                     lint_cstring_as_ptr(cx, expr, &arglists[0][0], &arglists[1][0]);\n                 }\n \n-                lint_or_fun_call(cx, expr, &name.node.as_str(), &args);\n+                lint_or_fun_call(cx, expr, &name.node.as_str(), args);\n \n                 let self_ty = cx.tcx.expr_ty_adjusted(&args[0]);\n                 if args.len() == 1 && name.node.as_str() == \"clone\" {\n@@ -420,7 +420,7 @@ impl LateLintPass for MethodsPass {\n \n                     // check conventions w.r.t. conversion method names and predicates\n                     let ty = cx.tcx.lookup_item_type(cx.tcx.map.local_def_id(item.id)).ty;\n-                    let is_copy = is_copy(cx, &ty, &item);\n+                    let is_copy = is_copy(cx, ty, item);\n                     for &(ref conv, self_kinds) in &CONVENTIONS {\n                         if conv.check(&name.as_str()) &&\n                            !self_kinds.iter().any(|k| k.matches(&sig.explicit_self.node, is_copy)) {"}, {"sha": "25747157c0f1677c816092fa899545cb0a42b66f", "filename": "src/misc.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fmisc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fmisc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmisc.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -424,7 +424,7 @@ fn is_used(cx: &LateContext, expr: &Expr) -> bool {\n         match parent.node {\n             ExprAssign(_, ref rhs) |\n             ExprAssignOp(_, _, ref rhs) => **rhs == *expr,\n-            _ => is_used(cx, &parent),\n+            _ => is_used(cx, parent),\n         }\n     } else {\n         true"}, {"sha": "f6aee54d90b35ed890c1afbda51b0dd07b78b158", "filename": "src/mut_reference.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fmut_reference.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fmut_reference.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmut_reference.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -39,13 +39,13 @@ impl LateLintPass for UnnecessaryMutPassed {\n                                                            If this happened, the compiler would have \\\n                                                            aborted the compilation long ago\");\n                 if let ExprPath(_, ref path) = fn_expr.node {\n-                    check_arguments(cx, &arguments, function_type, &path.to_string());\n+                    check_arguments(cx, arguments, function_type, &path.to_string());\n                 }\n             }\n             ExprMethodCall(ref name, _, ref arguments) => {\n                 let method_call = MethodCall::expr(e.id);\n                 let method_type = borrowed_table.method_map.get(&method_call).expect(\"This should never happen.\");\n-                check_arguments(cx, &arguments, method_type.ty, &name.node.as_str())\n+                check_arguments(cx, arguments, method_type.ty, &name.node.as_str())\n             }\n             _ => (),\n         }"}, {"sha": "294a12dad99779606a1c98c54b62a58f2f810a5d", "filename": "src/needless_borrow.rs", "status": "added", "additions": 50, "deletions": 0, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fneedless_borrow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fneedless_borrow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fneedless_borrow.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -0,0 +1,50 @@\n+//! Checks for needless address of operations (`&`)\n+//!\n+//! This lint is **warn** by default\n+\n+use rustc::lint::*;\n+use rustc::hir::*;\n+use rustc::ty::TyRef;\n+use utils::{span_lint, in_macro};\n+\n+/// **What it does:** This lint checks for address of operations (`&`) that are going to be dereferenced immediately by the compiler\n+///\n+/// **Why is this bad?** Suggests that the receiver of the expression borrows the expression\n+///\n+/// **Known problems:**\n+///\n+/// **Example:** `let x: &i32 = &&&&&&5;`\n+declare_lint! {\n+    pub NEEDLESS_BORROW,\n+    Warn,\n+    \"taking a reference that is going to be automatically dereferenced\"\n+}\n+\n+#[derive(Copy,Clone)]\n+pub struct NeedlessBorrow;\n+\n+impl LintPass for NeedlessBorrow {\n+    fn get_lints(&self) -> LintArray {\n+        lint_array!(NEEDLESS_BORROW)\n+    }\n+}\n+\n+impl LateLintPass for NeedlessBorrow {\n+    fn check_expr(&mut self, cx: &LateContext, e: &Expr) {\n+        if in_macro(cx, e.span) {\n+            return;\n+        }\n+        if let ExprAddrOf(MutImmutable, ref inner) = e.node {\n+            if let TyRef(..) = cx.tcx.expr_ty(inner).sty {\n+                let ty = cx.tcx.expr_ty(e);\n+                let adj_ty = cx.tcx.expr_ty_adjusted(e);\n+                if ty != adj_ty {\n+                    span_lint(cx,\n+                              NEEDLESS_BORROW,\n+                              e.span,\n+                              \"this expression borrows a reference that is immediately dereferenced by the compiler\");\n+                }\n+            }\n+        }\n+    }\n+}"}, {"sha": "9d2139fe42281ff74e34563101a20507e5d9d32a", "filename": "src/non_expressive_names.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fnon_expressive_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fnon_expressive_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fnon_expressive_names.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -249,7 +249,7 @@ impl EarlyLintPass for NonExpressiveNames {\n                 let mut visitor = SimilarNamesLocalVisitor {\n                     names: Vec::new(),\n                     cx: cx,\n-                    lint: &self,\n+                    lint: self,\n                     single_char_names: Vec::new(),\n                 };\n                 // initialize with function arguments"}, {"sha": "4b6439c4eb36b55bb12d239d7d9667fdcce6c443", "filename": "src/shadow.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fshadow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Fshadow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fshadow.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -278,7 +278,7 @@ fn check_expr(cx: &LateContext, expr: &Expr, bindings: &mut Vec<(Name, Span)>) {\n             let len = bindings.len();\n             for ref arm in arms {\n                 for ref pat in &arm.pats {\n-                    check_pat(cx, &pat, &Some(&**init), pat.span, bindings);\n+                    check_pat(cx, pat, &Some(&**init), pat.span, bindings);\n                     // This is ugly, but needed to get the right type\n                     if let Some(ref guard) = arm.guard {\n                         check_expr(cx, guard, bindings);"}, {"sha": "f63538e974d005815e185d8b97e2463e79c717f7", "filename": "src/types.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/src%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftypes.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -910,7 +910,7 @@ fn upcast_comparison_bounds_err(cx: &LateContext, span: &Span, rel: comparisons:\n         if let Some(norm_rhs_val) = node_as_const_fullint(cx, rhs) {\n             if rel == Rel::Eq || rel == Rel::Ne {\n                 if norm_rhs_val < lb || norm_rhs_val > ub {\n-                    err_upcast_comparison(cx, &span, lhs, rel == Rel::Ne);\n+                    err_upcast_comparison(cx, span, lhs, rel == Rel::Ne);\n                 }\n             } else if match rel {\n                 Rel::Lt => {\n@@ -929,7 +929,7 @@ fn upcast_comparison_bounds_err(cx: &LateContext, span: &Span, rel: comparisons:\n                 }\n                 Rel::Eq | Rel::Ne => unreachable!(),\n             } {\n-                err_upcast_comparison(cx, &span, lhs, true)\n+                err_upcast_comparison(cx, span, lhs, true)\n             } else if match rel {\n                 Rel::Lt => {\n                     if invert {\n@@ -947,7 +947,7 @@ fn upcast_comparison_bounds_err(cx: &LateContext, span: &Span, rel: comparisons:\n                 }\n                 Rel::Eq | Rel::Ne => unreachable!(),\n             } {\n-                err_upcast_comparison(cx, &span, lhs, false)\n+                err_upcast_comparison(cx, span, lhs, false)\n             }\n         }\n     }"}, {"sha": "c932f8f9a0fe06992e2b76e704520ab16f7a70bb", "filename": "tests/compile-fail/eta.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/tests%2Fcompile-fail%2Feta.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/tests%2Fcompile-fail%2Feta.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Feta.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -18,6 +18,7 @@ fn main() {\n     //~| SUGGESTION let c = Some(1u8).map({1+2; foo});\n     let d = Some(1u8).map(|a| foo((|b| foo2(b))(a))); //is adjusted?\n     all(&[1, 2, 3], &&2, |x, y| below(x, y)); //is adjusted\n+    //~^ WARN needless_borrow\n     unsafe {\n         Some(1u8).map(|a| unsafe_fn(a)); // unsafe fn\n     }"}, {"sha": "242691aa268a7af5b2bbb65bad48b7c14183374d", "filename": "tests/compile-fail/needless_borrow.rs", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/488199d88f7248d6109448ab3fb588407f5e4cac/tests%2Fcompile-fail%2Fneedless_borrow.rs", "raw_url": "https://github.com/rust-lang/rust/raw/488199d88f7248d6109448ab3fb588407f5e4cac/tests%2Fcompile-fail%2Fneedless_borrow.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fneedless_borrow.rs?ref=488199d88f7248d6109448ab3fb588407f5e4cac", "patch": "@@ -0,0 +1,27 @@\n+#![feature(plugin)]\n+#![plugin(clippy)]\n+\n+fn x(y: &i32) -> i32 {\n+    *y\n+}\n+\n+#[deny(clippy)]\n+#[allow(unused_variables)]\n+fn main() {\n+    let a = 5;\n+    let b = x(&a);\n+    let c = x(&&a); //~ ERROR: needless_borrow\n+    let s = &String::from(\"hi\");\n+    let s_ident = f(&s); // should not error, because `&String` implements Copy, but `String` does not\n+    let g_val = g(&Vec::new()); // should not error, because `&Vec<T>` derefs to `&[T]`\n+    let vec = Vec::new();\n+    let vec_val = g(&vec); // should not error, because `&Vec<T>` derefs to `&[T]`\n+}\n+\n+fn f<T:Copy>(y: &T) -> T {\n+    *y\n+}\n+\n+fn g(y: &[u8]) -> u8 {\n+    y[0]\n+}"}]}