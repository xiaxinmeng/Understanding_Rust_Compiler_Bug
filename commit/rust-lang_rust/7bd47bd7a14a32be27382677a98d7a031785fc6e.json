{"sha": "7bd47bd7a14a32be27382677a98d7a031785fc6e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdiZDQ3YmQ3YTE0YTMyYmUyNzM4MjY3N2E5OGQ3YTAzMTc4NWZjNmU=", "commit": {"author": {"name": "Eric Arellano", "email": "ericarellano@me.com", "date": "2020-12-07T20:39:30Z"}, "committer": {"name": "Eric Arellano", "email": "ericarellano@me.com", "date": "2020-12-07T21:00:21Z"}, "message": "Dogfood 'str_split_once() with linkchecker", "tree": {"sha": "8e456e00b38c08c83c3ac4a2c8a53f63a20b01de", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8e456e00b38c08c83c3ac4a2c8a53f63a20b01de"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7bd47bd7a14a32be27382677a98d7a031785fc6e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7bd47bd7a14a32be27382677a98d7a031785fc6e", "html_url": "https://github.com/rust-lang/rust/commit/7bd47bd7a14a32be27382677a98d7a031785fc6e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7bd47bd7a14a32be27382677a98d7a031785fc6e/comments", "author": {"login": "Eric-Arellano", "id": 14852634, "node_id": "MDQ6VXNlcjE0ODUyNjM0", "avatar_url": "https://avatars.githubusercontent.com/u/14852634?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Eric-Arellano", "html_url": "https://github.com/Eric-Arellano", "followers_url": "https://api.github.com/users/Eric-Arellano/followers", "following_url": "https://api.github.com/users/Eric-Arellano/following{/other_user}", "gists_url": "https://api.github.com/users/Eric-Arellano/gists{/gist_id}", "starred_url": "https://api.github.com/users/Eric-Arellano/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Eric-Arellano/subscriptions", "organizations_url": "https://api.github.com/users/Eric-Arellano/orgs", "repos_url": "https://api.github.com/users/Eric-Arellano/repos", "events_url": "https://api.github.com/users/Eric-Arellano/events{/privacy}", "received_events_url": "https://api.github.com/users/Eric-Arellano/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Eric-Arellano", "id": 14852634, "node_id": "MDQ6VXNlcjE0ODUyNjM0", "avatar_url": "https://avatars.githubusercontent.com/u/14852634?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Eric-Arellano", "html_url": "https://github.com/Eric-Arellano", "followers_url": "https://api.github.com/users/Eric-Arellano/followers", "following_url": "https://api.github.com/users/Eric-Arellano/following{/other_user}", "gists_url": "https://api.github.com/users/Eric-Arellano/gists{/gist_id}", "starred_url": "https://api.github.com/users/Eric-Arellano/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Eric-Arellano/subscriptions", "organizations_url": "https://api.github.com/users/Eric-Arellano/orgs", "repos_url": "https://api.github.com/users/Eric-Arellano/repos", "events_url": "https://api.github.com/users/Eric-Arellano/events{/privacy}", "received_events_url": "https://api.github.com/users/Eric-Arellano/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d6baf3875cb9a3bbf3ebd2f7b33ab7f204b5908e", "url": "https://api.github.com/repos/rust-lang/rust/commits/d6baf3875cb9a3bbf3ebd2f7b33ab7f204b5908e", "html_url": "https://github.com/rust-lang/rust/commit/d6baf3875cb9a3bbf3ebd2f7b33ab7f204b5908e"}], "stats": {"total": 13, "additions": 8, "deletions": 5}, "files": [{"sha": "dcfe1bb803fbae13960f68f7b06fd057a8dd36cc", "filename": "src/tools/linkchecker/main.rs", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/7bd47bd7a14a32be27382677a98d7a031785fc6e/src%2Ftools%2Flinkchecker%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7bd47bd7a14a32be27382677a98d7a031785fc6e/src%2Ftools%2Flinkchecker%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Flinkchecker%2Fmain.rs?ref=7bd47bd7a14a32be27382677a98d7a031785fc6e", "patch": "@@ -14,6 +14,8 @@\n //! A few exceptions are allowed as there's known bugs in rustdoc, but this\n //! should catch the majority of \"broken link\" cases.\n \n+#![feature(str_split_once)]\n+\n use std::collections::hash_map::Entry;\n use std::collections::{HashMap, HashSet};\n use std::env;\n@@ -232,11 +234,12 @@ fn check(cache: &mut Cache, root: &Path, file: &Path, errors: &mut bool) -> Opti\n         {\n             return;\n         }\n-        let mut parts = url.splitn(2, '#');\n-        let url = parts.next().unwrap();\n-        let fragment = parts.next();\n-        let mut parts = url.splitn(2, '?');\n-        let url = parts.next().unwrap();\n+        let (url, fragment) = match url.split_once('#') {\n+            None => (url, None),\n+            Some((url, fragment)) => (url, Some(fragment)),\n+        };\n+        // NB: the `splitn` always succeeds, even if the delimiter is not present.\n+        let url = url.splitn(2, '?').next().unwrap();\n \n         // Once we've plucked out the URL, parse it using our base url and\n         // then try to extract a file path."}]}