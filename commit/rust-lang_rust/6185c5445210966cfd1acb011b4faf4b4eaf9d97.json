{"sha": "6185c5445210966cfd1acb011b4faf4b4eaf9d97", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYxODVjNTQ0NTIxMDk2NmNmZDFhY2IwMTFiNGZhZjRiNGVhZjlkOTc=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-12-31T16:49:27Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-12-31T16:49:27Z"}, "message": "Auto merge of #38737 - keeperofdakeys:proc-macro-derive-Dec-16, r=jseyfried\n\nFix panic when using a macros 1.1 custom derive on a struct containing a macro invocation\n\nFixes #38706\n\nr? @jseyfried", "tree": {"sha": "00faeba85299705870a3f8ab2985c101873c9187", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/00faeba85299705870a3f8ab2985c101873c9187"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6185c5445210966cfd1acb011b4faf4b4eaf9d97", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6185c5445210966cfd1acb011b4faf4b4eaf9d97", "html_url": "https://github.com/rust-lang/rust/commit/6185c5445210966cfd1acb011b4faf4b4eaf9d97", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6185c5445210966cfd1acb011b4faf4b4eaf9d97/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ca0cc27ab6569c1afbd6aa1e3ab7b925b226b679", "url": "https://api.github.com/repos/rust-lang/rust/commits/ca0cc27ab6569c1afbd6aa1e3ab7b925b226b679", "html_url": "https://github.com/rust-lang/rust/commit/ca0cc27ab6569c1afbd6aa1e3ab7b925b226b679"}, {"sha": "e9b5839918a1e36ef923a88f71c67da2d9f7b9e1", "url": "https://api.github.com/repos/rust-lang/rust/commits/e9b5839918a1e36ef923a88f71c67da2d9f7b9e1", "html_url": "https://github.com/rust-lang/rust/commit/e9b5839918a1e36ef923a88f71c67da2d9f7b9e1"}], "stats": {"total": 62, "additions": 60, "deletions": 2}, "files": [{"sha": "47033f74e0e33628fa51fc8b98ae39129af77828", "filename": "src/librustc_resolve/macros.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6185c5445210966cfd1acb011b4faf4b4eaf9d97/src%2Flibrustc_resolve%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6185c5445210966cfd1acb011b4faf4b4eaf9d97/src%2Flibrustc_resolve%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_resolve%2Fmacros.rs?ref=6185c5445210966cfd1acb011b4faf4b4eaf9d97", "patch": "@@ -28,7 +28,7 @@ use syntax::ext::expand::{Expansion, mark_tts};\n use syntax::ext::hygiene::Mark;\n use syntax::ext::tt::macro_rules;\n use syntax::feature_gate::{emit_feature_err, GateIssue};\n-use syntax::fold::Folder;\n+use syntax::fold::{self, Folder};\n use syntax::ptr::P;\n use syntax::symbol::keywords;\n use syntax::util::lev_distance::find_best_match_for_name;\n@@ -117,6 +117,10 @@ impl<'a> base::Resolver for Resolver<'a> {\n                 }\n                 path\n             }\n+\n+            fn fold_mac(&mut self, mac: ast::Mac) -> ast::Mac {\n+                fold::noop_fold_mac(mac, self)\n+            }\n         }\n \n         EliminateCrateVar(self).fold_item(item).expect_one(\"\")"}, {"sha": "64ec460a5246042bab26d3b5c6c8c910b513a60e", "filename": "src/libsyntax_ext/deriving/custom.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6185c5445210966cfd1acb011b4faf4b4eaf9d97/src%2Flibsyntax_ext%2Fderiving%2Fcustom.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6185c5445210966cfd1acb011b4faf4b4eaf9d97/src%2Flibsyntax_ext%2Fderiving%2Fcustom.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fderiving%2Fcustom.rs?ref=6185c5445210966cfd1acb011b4faf4b4eaf9d97", "patch": "@@ -12,7 +12,7 @@ use std::panic;\n \n use errors::FatalError;\n use proc_macro::{TokenStream, __internal};\n-use syntax::ast::{self, ItemKind, Attribute};\n+use syntax::ast::{self, ItemKind, Attribute, Mac};\n use syntax::attr::{mark_used, mark_known};\n use syntax::codemap::Span;\n use syntax::ext::base::*;\n@@ -28,6 +28,8 @@ impl<'a> Visitor<'a> for MarkAttrs<'a> {\n             mark_known(attr);\n         }\n     }\n+\n+    fn visit_mac(&mut self, _mac: &Mac) {}\n }\n \n pub struct CustomDerive {"}, {"sha": "a9257cb4c8b789f9c08119172be6baffe4a6f75c", "filename": "src/test/run-pass-fulldeps/proc-macro/auxiliary/derive-nothing.rs", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/6185c5445210966cfd1acb011b4faf4b4eaf9d97/src%2Ftest%2Frun-pass-fulldeps%2Fproc-macro%2Fauxiliary%2Fderive-nothing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6185c5445210966cfd1acb011b4faf4b4eaf9d97/src%2Ftest%2Frun-pass-fulldeps%2Fproc-macro%2Fauxiliary%2Fderive-nothing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass-fulldeps%2Fproc-macro%2Fauxiliary%2Fderive-nothing.rs?ref=6185c5445210966cfd1acb011b4faf4b4eaf9d97", "patch": "@@ -0,0 +1,24 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// no-prefer-dynamic\n+\n+#![crate_type = \"proc-macro\"]\n+#![feature(proc_macro)]\n+#![feature(proc_macro_lib)]\n+\n+extern crate proc_macro;\n+\n+use proc_macro::TokenStream;\n+\n+#[proc_macro_derive(Nothing)]\n+pub fn nothing(input: TokenStream) -> TokenStream {\n+    \"\".parse().unwrap()\n+}"}, {"sha": "818308b05a44e7170bf5ace803b6cd3b29cfd8af", "filename": "src/test/run-pass-fulldeps/proc-macro/struct-field-macro.rs", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/6185c5445210966cfd1acb011b4faf4b4eaf9d97/src%2Ftest%2Frun-pass-fulldeps%2Fproc-macro%2Fstruct-field-macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6185c5445210966cfd1acb011b4faf4b4eaf9d97/src%2Ftest%2Frun-pass-fulldeps%2Fproc-macro%2Fstruct-field-macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass-fulldeps%2Fproc-macro%2Fstruct-field-macro.rs?ref=6185c5445210966cfd1acb011b4faf4b4eaf9d97", "patch": "@@ -0,0 +1,28 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// aux-build:derive-nothing.rs\n+// ignore-stage1\n+\n+#![feature(proc_macro)]\n+\n+#[macro_use]\n+extern crate derive_nothing;\n+\n+macro_rules! int {\n+    () => { i32 }\n+}\n+\n+#[derive(Nothing)]\n+struct S {\n+    x: int!(),\n+}\n+\n+fn main() {}"}]}