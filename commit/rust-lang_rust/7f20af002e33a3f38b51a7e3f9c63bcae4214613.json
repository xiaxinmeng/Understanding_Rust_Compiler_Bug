{"sha": "7f20af002e33a3f38b51a7e3f9c63bcae4214613", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdmMjBhZjAwMmUzM2EzZjM4YjUxYTdlM2Y5YzYzYmNhZTQyMTQ2MTM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-06-13T10:03:05Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-06-13T10:03:05Z"}, "message": "Auto merge of #51527 - kennytm:do-not-auto-hide-inherent-impl, r=GuillaumeGomez\n\nDon't auto-hide inherent impls even if `rustdoc-collapse == true`.\n\nThis PR changes the auto-collapse behavior when a page is first loaded:\n\n* Inherent impls will never be collapsed by default (new behavior).\n* Trait impls will always be collapsed by default, same as before.\n* Other items are collapsed according to localStorage, same as before.\n\nThis should be much more useful since there is no hint what the content of a collapsed inherent impl would be (try to collapse everything in https://doc.rust-lang.org/std/vec/struct.Vec.html and guess where a method like `try_reserve` or `splice` would be).\n\nManually clicking the global [-]/[+] will still collapse/expand everything.", "tree": {"sha": "07088a06b0145fe96d3f1f1a0ff808031a53b070", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/07088a06b0145fe96d3f1f1a0ff808031a53b070"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7f20af002e33a3f38b51a7e3f9c63bcae4214613", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7f20af002e33a3f38b51a7e3f9c63bcae4214613", "html_url": "https://github.com/rust-lang/rust/commit/7f20af002e33a3f38b51a7e3f9c63bcae4214613", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7f20af002e33a3f38b51a7e3f9c63bcae4214613/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8398ab82e5d6623f49f054af848f1553f429d307", "url": "https://api.github.com/repos/rust-lang/rust/commits/8398ab82e5d6623f49f054af848f1553f429d307", "html_url": "https://github.com/rust-lang/rust/commit/8398ab82e5d6623f49f054af848f1553f429d307"}, {"sha": "ca65a5e485761ed06e88756d9066156109b0755f", "url": "https://api.github.com/repos/rust-lang/rust/commits/ca65a5e485761ed06e88756d9066156109b0755f", "html_url": "https://github.com/rust-lang/rust/commit/ca65a5e485761ed06e88756d9066156109b0755f"}], "stats": {"total": 49, "additions": 25, "deletions": 24}, "files": [{"sha": "ed6745cd7f52529ee086e983af85a91b520bab46", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 25, "deletions": 24, "changes": 49, "blob_url": "https://github.com/rust-lang/rust/blob/7f20af002e33a3f38b51a7e3f9c63bcae4214613/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/7f20af002e33a3f38b51a7e3f9c63bcae4214613/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=7f20af002e33a3f38b51a7e3f9c63bcae4214613", "patch": "@@ -1775,7 +1775,7 @@\n         }\n     }\n \n-    function toggleAllDocs(pageId) {\n+    function toggleAllDocs(pageId, fromAutoCollapse) {\n         var toggle = document.getElementById(\"toggle-all-docs\");\n         if (!toggle) {\n             return;\n@@ -1787,20 +1787,23 @@\n                 e.innerHTML = labelForToggleButton(false);\n             });\n             toggle.title = \"collapse all docs\";\n-            onEach(document.getElementsByClassName(\"collapse-toggle\"), function(e) {\n-                collapseDocs(e, \"show\");\n-            });\n+            if (fromAutoCollapse !== true) {\n+                onEach(document.getElementsByClassName(\"collapse-toggle\"), function(e) {\n+                    collapseDocs(e, \"show\");\n+                });\n+            }\n         } else {\n             updateLocalStorage(\"rustdoc-collapse\", \"true\");\n             addClass(toggle, \"will-expand\");\n             onEveryMatchingChild(toggle, \"inner\", function(e) {\n                 e.innerHTML = labelForToggleButton(true);\n             });\n             toggle.title = \"expand all docs\";\n-\n-            onEach(document.getElementsByClassName(\"collapse-toggle\"), function(e) {\n-                collapseDocs(e, \"hide\", pageId);\n-            });\n+            if (fromAutoCollapse !== true) {\n+                onEach(document.getElementsByClassName(\"collapse-toggle\"), function(e) {\n+                    collapseDocs(e, \"hide\", pageId);\n+                });\n+            }\n         }\n     }\n \n@@ -1921,17 +1924,19 @@\n         }\n     }\n \n-    function autoCollapseAllImpls(pageId) {\n-        // Automatically minimize all non-inherent impls\n-        onEach(document.getElementsByClassName('impl'), function(n) {\n-            // inherent impl ids are like 'impl' or impl-<number>'\n-            var inherent = (n.id.match(/^impl(?:-\\d+)?$/) !== null);\n-            if (!inherent) {\n-                onEach(n.childNodes, function(m) {\n-                    if (hasClass(m, \"collapse-toggle\")) {\n-                        collapseDocs(m, \"hide\", pageId);\n-                    }\n-                });\n+    function autoCollapse(pageId, collapse) {\n+        if (collapse) {\n+            toggleAllDocs(pageId, true);\n+        }\n+        onEach(document.getElementsByClassName(\"collapse-toggle\"), function(e) {\n+            // inherent impl ids are like 'impl' or impl-<number>'.\n+            // they will never be hidden by default.\n+            var n = e.parentNode;\n+            if (n.id.match(/^impl(?:-\\d+)?$/) === null) {\n+                // Automatically minimize all non-inherent impls\n+                if (collapse || hasClass(n, 'impl')) {\n+                    collapseDocs(e, \"hide\", pageId);\n+                }\n             }\n         });\n     }\n@@ -2044,8 +2049,6 @@\n         }\n     });\n \n-    autoCollapseAllImpls(getPageId());\n-\n     function createToggleWrapper(tog) {\n         var span = document.createElement('span');\n         span.className = 'toggle-label';\n@@ -2175,9 +2178,7 @@\n         hideSidebar();\n     };\n \n-    if (getCurrentValue(\"rustdoc-collapse\") === \"true\") {\n-        toggleAllDocs(getPageId());\n-    }\n+    autoCollapse(getPageId(), getCurrentValue(\"rustdoc-collapse\") === \"true\");\n }());\n \n // Sets the focus on the search bar at the top of the page"}]}