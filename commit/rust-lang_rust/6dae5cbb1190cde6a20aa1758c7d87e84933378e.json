{"sha": "6dae5cbb1190cde6a20aa1758c7d87e84933378e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjZkYWU1Y2JiMTE5MGNkZTZhMjBhYTE3NThjN2Q4N2U4NDkzMzM3OGU=", "commit": {"author": {"name": "Kirill Bulatov", "email": "mail4score@gmail.com", "date": "2020-02-02T12:06:51Z"}, "committer": {"name": "Kirill Bulatov", "email": "mail4score@gmail.com", "date": "2020-02-02T12:06:51Z"}, "message": "Require ModPath for importing", "tree": {"sha": "a2ff09d550a6c8e057d4340d63b5c957fa134590", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a2ff09d550a6c8e057d4340d63b5c957fa134590"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6dae5cbb1190cde6a20aa1758c7d87e84933378e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6dae5cbb1190cde6a20aa1758c7d87e84933378e", "html_url": "https://github.com/rust-lang/rust/commit/6dae5cbb1190cde6a20aa1758c7d87e84933378e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6dae5cbb1190cde6a20aa1758c7d87e84933378e/comments", "author": {"login": "SomeoneToIgnore", "id": 2690773, "node_id": "MDQ6VXNlcjI2OTA3NzM=", "avatar_url": "https://avatars.githubusercontent.com/u/2690773?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SomeoneToIgnore", "html_url": "https://github.com/SomeoneToIgnore", "followers_url": "https://api.github.com/users/SomeoneToIgnore/followers", "following_url": "https://api.github.com/users/SomeoneToIgnore/following{/other_user}", "gists_url": "https://api.github.com/users/SomeoneToIgnore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SomeoneToIgnore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SomeoneToIgnore/subscriptions", "organizations_url": "https://api.github.com/users/SomeoneToIgnore/orgs", "repos_url": "https://api.github.com/users/SomeoneToIgnore/repos", "events_url": "https://api.github.com/users/SomeoneToIgnore/events{/privacy}", "received_events_url": "https://api.github.com/users/SomeoneToIgnore/received_events", "type": "User", "site_admin": false}, "committer": {"login": "SomeoneToIgnore", "id": 2690773, "node_id": "MDQ6VXNlcjI2OTA3NzM=", "avatar_url": "https://avatars.githubusercontent.com/u/2690773?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SomeoneToIgnore", "html_url": "https://github.com/SomeoneToIgnore", "followers_url": "https://api.github.com/users/SomeoneToIgnore/followers", "following_url": "https://api.github.com/users/SomeoneToIgnore/following{/other_user}", "gists_url": "https://api.github.com/users/SomeoneToIgnore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SomeoneToIgnore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SomeoneToIgnore/subscriptions", "organizations_url": "https://api.github.com/users/SomeoneToIgnore/orgs", "repos_url": "https://api.github.com/users/SomeoneToIgnore/repos", "events_url": "https://api.github.com/users/SomeoneToIgnore/events{/privacy}", "received_events_url": "https://api.github.com/users/SomeoneToIgnore/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a9669a5505939c28fd97e53e1bbb1571c2408cf1", "url": "https://api.github.com/repos/rust-lang/rust/commits/a9669a5505939c28fd97e53e1bbb1571c2408cf1", "html_url": "https://github.com/rust-lang/rust/commit/a9669a5505939c28fd97e53e1bbb1571c2408cf1"}], "stats": {"total": 102, "additions": 65, "deletions": 37}, "files": [{"sha": "96a494c93980dfd7eff626af6128d73e3b1f2efe", "filename": "crates/ra_assists/src/assists/add_import.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6dae5cbb1190cde6a20aa1758c7d87e84933378e/crates%2Fra_assists%2Fsrc%2Fassists%2Fadd_import.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6dae5cbb1190cde6a20aa1758c7d87e84933378e/crates%2Fra_assists%2Fsrc%2Fassists%2Fadd_import.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fassists%2Fadd_import.rs?ref=6dae5cbb1190cde6a20aa1758c7d87e84933378e", "patch": "@@ -1,4 +1,4 @@\n-use hir::{self, db::HirDatabase};\n+use hir::{self, db::HirDatabase, ModPath};\n use ra_syntax::{\n     ast::{self, NameOwner},\n     AstNode, Direction, SmolStr,\n@@ -21,9 +21,10 @@ pub fn auto_import_text_edit(\n     // The statement to use as anchor (last resort)\n     anchor: &SyntaxNode,\n     // The path to import as a sequence of strings\n-    target: &[SmolStr],\n+    path_to_import: &ModPath,\n     edit: &mut TextEditBuilder,\n ) {\n+    let target = path_to_import.to_string().split(\"::\").map(SmolStr::new).collect::<Vec<_>>();\n     let container = position.ancestors().find_map(|n| {\n         if let Some(module) = ast::Module::cast(n.clone()) {\n             return module.item_list().map(|it| it.syntax().clone());\n@@ -32,8 +33,8 @@ pub fn auto_import_text_edit(\n     });\n \n     if let Some(container) = container {\n-        let action = best_action_for_target(container, anchor.clone(), target);\n-        make_assist(&action, target, edit);\n+        let action = best_action_for_target(container, anchor.clone(), &target);\n+        make_assist(&action, &target, edit);\n     }\n }\n "}, {"sha": "9e874aebba24cba4613e6f675dcfc816d8b208bb", "filename": "crates/ra_assists/src/assists/auto_import.rs", "status": "modified", "additions": 3, "deletions": 6, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/6dae5cbb1190cde6a20aa1758c7d87e84933378e/crates%2Fra_assists%2Fsrc%2Fassists%2Fauto_import.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6dae5cbb1190cde6a20aa1758c7d87e84933378e/crates%2Fra_assists%2Fsrc%2Fassists%2Fauto_import.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fassists%2Fauto_import.rs?ref=6dae5cbb1190cde6a20aa1758c7d87e84933378e", "patch": "@@ -1,7 +1,6 @@\n-use hir::db::HirDatabase;\n+use hir::{db::HirDatabase, ModPath};\n use ra_syntax::{\n     ast::{self, AstNode},\n-    SmolStr,\n     SyntaxKind::USE_ITEM,\n     SyntaxNode,\n };\n@@ -58,7 +57,6 @@ pub(crate) fn auto_import<F: ImportsLocator>(\n         .filter_map(|module_def| module_with_name_to_import.find_use_path(ctx.db, module_def))\n         .filter(|use_path| !use_path.segments.is_empty())\n         .take(20)\n-        .map(|import| import.to_string())\n         .collect::<std::collections::BTreeSet<_>>();\n     if proposed_imports.is_empty() {\n         return None;\n@@ -76,11 +74,10 @@ pub(crate) fn auto_import<F: ImportsLocator>(\n     )\n }\n \n-fn import_to_action(import: String, position: &SyntaxNode, anchor: &SyntaxNode) -> ActionBuilder {\n+fn import_to_action(import: ModPath, position: &SyntaxNode, anchor: &SyntaxNode) -> ActionBuilder {\n     let mut action_builder = ActionBuilder::default();\n     action_builder.label(format!(\"Import `{}`\", &import));\n-    let import_segments = import.split(\"::\").map(SmolStr::new).collect::<Vec<_>>();\n-    auto_import_text_edit(position, anchor, &import_segments, action_builder.text_edit_builder());\n+    auto_import_text_edit(position, anchor, &import, action_builder.text_edit_builder());\n     action_builder\n }\n "}, {"sha": "64b55860d934cf3698610632d9198bbba07014c9", "filename": "crates/ra_hir/src/lib.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/6dae5cbb1190cde6a20aa1758c7d87e84933378e/crates%2Fra_hir%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6dae5cbb1190cde6a20aa1758c7d87e84933378e/crates%2Fra_hir%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Flib.rs?ref=6dae5cbb1190cde6a20aa1758c7d87e84933378e", "patch": "@@ -59,6 +59,7 @@ pub use hir_def::{\n     ModuleDefId, // FIXME this is exposed and should be used for implementing the `TestImportsLocator` in `ra_assists` only, should be removed later along with the trait and the implementation.\n };\n pub use hir_expand::{\n-    name::Name, HirFileId, InFile, MacroCallId, MacroCallLoc, MacroDefId, MacroFile, Origin,\n+    name::{known, Name},\n+    HirFileId, InFile, MacroCallId, MacroCallLoc, MacroDefId, MacroFile, Origin,\n };\n pub use hir_ty::{display::HirDisplay, CallableDef};"}, {"sha": "a150b899f2c436cf74a489b0d332e8df344b86ce", "filename": "crates/ra_hir_def/src/path.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/6dae5cbb1190cde6a20aa1758c7d87e84933378e/crates%2Fra_hir_def%2Fsrc%2Fpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6dae5cbb1190cde6a20aa1758c7d87e84933378e/crates%2Fra_hir_def%2Fsrc%2Fpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Fpath.rs?ref=6dae5cbb1190cde6a20aa1758c7d87e84933378e", "patch": "@@ -16,13 +16,13 @@ use ra_syntax::ast;\n \n use crate::{type_ref::TypeRef, InFile};\n \n-#[derive(Debug, Clone, PartialEq, Eq, Hash)]\n+#[derive(Debug, Clone, PartialEq, Eq, PartialOrd, Ord, Hash)]\n pub struct ModPath {\n     pub kind: PathKind,\n     pub segments: Vec<Name>,\n }\n \n-#[derive(Debug, Clone, PartialEq, Eq, Hash)]\n+#[derive(Debug, Clone, PartialEq, Eq, PartialOrd, Ord, Hash)]\n pub enum PathKind {\n     Plain,\n     /// `self::` is `Super(0)`"}, {"sha": "44b47ec91c625c903975ffd65897e48180df0e75", "filename": "crates/ra_hir_expand/src/name.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6dae5cbb1190cde6a20aa1758c7d87e84933378e/crates%2Fra_hir_expand%2Fsrc%2Fname.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6dae5cbb1190cde6a20aa1758c7d87e84933378e/crates%2Fra_hir_expand%2Fsrc%2Fname.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_expand%2Fsrc%2Fname.rs?ref=6dae5cbb1190cde6a20aa1758c7d87e84933378e", "patch": "@@ -143,6 +143,9 @@ pub mod known {\n         std,\n         core,\n         alloc,\n+        hash,\n+        fmt,\n+        io,\n         iter,\n         ops,\n         future,\n@@ -167,6 +170,9 @@ pub mod known {\n         Neg,\n         Not,\n         Index,\n+        Display,\n+        Iterator,\n+        Hasher,\n         // Builtin macros\n         file,\n         column,"}, {"sha": "fe07959845d0f3795df808b7a8d9acfc1362d277", "filename": "crates/ra_ide/src/completion/complete_scope.rs", "status": "modified", "additions": 47, "deletions": 24, "changes": 71, "blob_url": "https://github.com/rust-lang/rust/blob/6dae5cbb1190cde6a20aa1758c7d87e84933378e/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcomplete_scope.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6dae5cbb1190cde6a20aa1758c7d87e84933378e/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcomplete_scope.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fcompletion%2Fcomplete_scope.rs?ref=6dae5cbb1190cde6a20aa1758c7d87e84933378e", "patch": "@@ -6,6 +6,7 @@ use ra_text_edit::TextEditBuilder;\n use rustc_hash::FxHashMap;\n \n use crate::completion::{CompletionContext, CompletionItem, CompletionKind, Completions};\n+use hir::{ModPath, PathKind};\n \n pub(super) fn complete_scope(acc: &mut Completions, ctx: &CompletionContext) {\n     if !ctx.is_trivial_path {\n@@ -54,58 +55,80 @@ pub(super) fn complete_scope(acc: &mut Completions, ctx: &CompletionContext) {\n     }\n }\n \n-fn build_import_label(name: &str, path: &[SmolStr]) -> String {\n+fn build_import_label(name: &str, path: &ModPath) -> String {\n     let mut buf = String::with_capacity(64);\n     buf.push_str(name);\n     buf.push_str(\" (\");\n-    fmt_import_path(path, &mut buf);\n+    buf.push_str(&path.to_string());\n     buf.push_str(\")\");\n     buf\n }\n \n-fn fmt_import_path(path: &[SmolStr], buf: &mut String) {\n-    let mut segments = path.iter();\n-    if let Some(s) = segments.next() {\n-        buf.push_str(&s);\n-    }\n-    for s in segments {\n-        buf.push_str(\"::\");\n-        buf.push_str(&s);\n-    }\n-}\n-\n #[derive(Debug, Clone, Default)]\n pub(crate) struct ImportResolver {\n     // todo: use fst crate or something like that\n-    dummy_names: Vec<(SmolStr, Vec<SmolStr>)>,\n+    dummy_names: Vec<(SmolStr, ModPath)>,\n }\n \n impl ImportResolver {\n     pub(crate) fn new() -> Self {\n         let dummy_names = vec![\n-            (SmolStr::new(\"fmt\"), vec![SmolStr::new(\"std\"), SmolStr::new(\"fmt\")]),\n-            (SmolStr::new(\"io\"), vec![SmolStr::new(\"std\"), SmolStr::new(\"io\")]),\n-            (SmolStr::new(\"iter\"), vec![SmolStr::new(\"std\"), SmolStr::new(\"iter\")]),\n-            (SmolStr::new(\"hash\"), vec![SmolStr::new(\"std\"), SmolStr::new(\"hash\")]),\n+            (\n+                SmolStr::new(\"fmt\"),\n+                ModPath { kind: PathKind::Plain, segments: vec![hir::known::std, hir::known::fmt] },\n+            ),\n+            (\n+                SmolStr::new(\"io\"),\n+                ModPath { kind: PathKind::Plain, segments: vec![hir::known::std, hir::known::io] },\n+            ),\n+            (\n+                SmolStr::new(\"iter\"),\n+                ModPath {\n+                    kind: PathKind::Plain,\n+                    segments: vec![hir::known::std, hir::known::iter],\n+                },\n+            ),\n+            (\n+                SmolStr::new(\"hash\"),\n+                ModPath {\n+                    kind: PathKind::Plain,\n+                    segments: vec![hir::known::std, hir::known::hash],\n+                },\n+            ),\n             (\n                 SmolStr::new(\"Debug\"),\n-                vec![SmolStr::new(\"std\"), SmolStr::new(\"fmt\"), SmolStr::new(\"Debug\")],\n+                ModPath {\n+                    kind: PathKind::Plain,\n+                    segments: vec![hir::known::std, hir::known::fmt, hir::known::Debug],\n+                },\n             ),\n             (\n                 SmolStr::new(\"Display\"),\n-                vec![SmolStr::new(\"std\"), SmolStr::new(\"fmt\"), SmolStr::new(\"Display\")],\n+                ModPath {\n+                    kind: PathKind::Plain,\n+                    segments: vec![hir::known::std, hir::known::fmt, hir::known::Display],\n+                },\n             ),\n             (\n                 SmolStr::new(\"Hash\"),\n-                vec![SmolStr::new(\"std\"), SmolStr::new(\"hash\"), SmolStr::new(\"Hash\")],\n+                ModPath {\n+                    kind: PathKind::Plain,\n+                    segments: vec![hir::known::std, hir::known::hash, hir::known::Hash],\n+                },\n             ),\n             (\n                 SmolStr::new(\"Hasher\"),\n-                vec![SmolStr::new(\"std\"), SmolStr::new(\"hash\"), SmolStr::new(\"Hasher\")],\n+                ModPath {\n+                    kind: PathKind::Plain,\n+                    segments: vec![hir::known::std, hir::known::hash, hir::known::Hasher],\n+                },\n             ),\n             (\n                 SmolStr::new(\"Iterator\"),\n-                vec![SmolStr::new(\"std\"), SmolStr::new(\"iter\"), SmolStr::new(\"Iterator\")],\n+                ModPath {\n+                    kind: PathKind::Plain,\n+                    segments: vec![hir::known::std, hir::known::iter, hir::known::Iterator],\n+                },\n             ),\n         ];\n \n@@ -115,7 +138,7 @@ impl ImportResolver {\n     // Returns a map of importable items filtered by name.\n     // The map associates item name with its full path.\n     // todo: should return Resolutions\n-    pub(crate) fn all_names(&self, name: &str) -> FxHashMap<SmolStr, Vec<SmolStr>> {\n+    pub(crate) fn all_names(&self, name: &str) -> FxHashMap<SmolStr, ModPath> {\n         if name.len() > 1 {\n             self.dummy_names.iter().filter(|(n, _)| n.contains(name)).cloned().collect()\n         } else {"}]}