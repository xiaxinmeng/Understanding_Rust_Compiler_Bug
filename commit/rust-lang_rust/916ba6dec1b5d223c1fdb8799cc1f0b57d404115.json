{"sha": "916ba6dec1b5d223c1fdb8799cc1f0b57d404115", "node_id": "C_kwDOAAsO6NoAKDkxNmJhNmRlYzFiNWQyMjNjMWZkYjg3OTljYzFmMGI1N2Q0MDQxMTU", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-05-15T08:58:40Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-05-15T08:58:40Z"}, "message": "Rollup merge of #111548 - calebcartwright:by-ref-tokentree2, r=compiler-errors\n\nadd util function to TokenStream to eliminate some clones\n\nAnother proposed change in the same vein as #111492 trying to get rid of some clones.\n\nThis adds a TokenStream helper function so that rustdoc can directly get a chunks iterator over the underlying token trees so that it no longer needs the clones and vec.", "tree": {"sha": "d3aec1af8a078bb24f7dde317792ff88d8c28172", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d3aec1af8a078bb24f7dde317792ff88d8c28172"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/916ba6dec1b5d223c1fdb8799cc1f0b57d404115", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkYfRACRBK7hj4Ov3rIwAAFO4IAGWRIPXTKouxqCdahJZr3lOn\nS1LdTn9+p3j9wtuiDDLZlsT88Qb3Z/Px2lMeLj6GAo2oIpi9CJvJGL8dP1NiIH4e\nvnt8uiu7mNbNMqhfIWQwsdZKKZ67OGp6GycjK8XQa/3s9wnKNV5AjKmUGovi0LET\n594MOV9oUX6ZzHlmxeYhaJnxSoQKDEnnlWN5Benj1TC4qZJ9ggI3+T4Bgne5+QDb\n3xC6nu3pqTD9K9H+TAXyWzDwrr7JCnK6EiWF7hzJwIVkXE6j71Y0q4gVfh9PujYd\nv2yFu3b9tyrY+hWcmuA6yxvxbmw/2Y8Kc7s9UbryNIv71pQ2BbyEUWF9/+IOTiA=\n=VKtj\n-----END PGP SIGNATURE-----\n", "payload": "tree d3aec1af8a078bb24f7dde317792ff88d8c28172\nparent be8718a80bd3a45a03efbe534578df359f765472\nparent 00c3f7552ebaef26165da93ef2c88a09ba70d5c2\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1684141120 +0200\ncommitter GitHub <noreply@github.com> 1684141120 +0200\n\nRollup merge of #111548 - calebcartwright:by-ref-tokentree2, r=compiler-errors\n\nadd util function to TokenStream to eliminate some clones\n\nAnother proposed change in the same vein as #111492 trying to get rid of some clones.\n\nThis adds a TokenStream helper function so that rustdoc can directly get a chunks iterator over the underlying token trees so that it no longer needs the clones and vec.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/916ba6dec1b5d223c1fdb8799cc1f0b57d404115", "html_url": "https://github.com/rust-lang/rust/commit/916ba6dec1b5d223c1fdb8799cc1f0b57d404115", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/916ba6dec1b5d223c1fdb8799cc1f0b57d404115/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "be8718a80bd3a45a03efbe534578df359f765472", "url": "https://api.github.com/repos/rust-lang/rust/commits/be8718a80bd3a45a03efbe534578df359f765472", "html_url": "https://github.com/rust-lang/rust/commit/be8718a80bd3a45a03efbe534578df359f765472"}, {"sha": "00c3f7552ebaef26165da93ef2c88a09ba70d5c2", "url": "https://api.github.com/repos/rust-lang/rust/commits/00c3f7552ebaef26165da93ef2c88a09ba70d5c2", "html_url": "https://github.com/rust-lang/rust/commit/00c3f7552ebaef26165da93ef2c88a09ba70d5c2"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "db296aa44db2b6edc65f820c55f62132c7bad6c7", "filename": "compiler/rustc_ast/src/tokenstream.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/916ba6dec1b5d223c1fdb8799cc1f0b57d404115/compiler%2Frustc_ast%2Fsrc%2Ftokenstream.rs", "raw_url": "https://github.com/rust-lang/rust/raw/916ba6dec1b5d223c1fdb8799cc1f0b57d404115/compiler%2Frustc_ast%2Fsrc%2Ftokenstream.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Ftokenstream.rs?ref=916ba6dec1b5d223c1fdb8799cc1f0b57d404115", "patch": "@@ -551,6 +551,10 @@ impl TokenStream {\n             vec_mut.extend(stream_iter);\n         }\n     }\n+\n+    pub fn chunks(&self, chunk_size: usize) -> core::slice::Chunks<'_, TokenTree> {\n+        self.0.chunks(chunk_size)\n+    }\n }\n \n /// By-reference iterator over a [`TokenStream`], that produces `&TokenTree`"}, {"sha": "17aa6b38e389c3fba44ec5ec42aa9548fdb9bc02", "filename": "src/librustdoc/clean/utils.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/916ba6dec1b5d223c1fdb8799cc1f0b57d404115/src%2Flibrustdoc%2Fclean%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/916ba6dec1b5d223c1fdb8799cc1f0b57d404115/src%2Flibrustdoc%2Fclean%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Futils.rs?ref=916ba6dec1b5d223c1fdb8799cc1f0b57d404115", "patch": "@@ -594,9 +594,8 @@ pub(super) fn display_macro_source(\n     def_id: DefId,\n     vis: ty::Visibility<DefId>,\n ) -> String {\n-    let tts: Vec<_> = def.body.tokens.clone().into_trees().collect();\n     // Extract the spans of all matchers. They represent the \"interface\" of the macro.\n-    let matchers = tts.chunks(4).map(|arm| &arm[0]);\n+    let matchers = def.body.tokens.chunks(4).map(|arm| &arm[0]);\n \n     if def.macro_rules {\n         format!(\"macro_rules! {} {{\\n{}}}\", name, render_macro_arms(cx.tcx, matchers, \";\"))"}]}