{"sha": "b3583193531c124e36aa1813cf5f8b8e667d016c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIzNTgzMTkzNTMxYzEyNGUzNmFhMTgxM2NmNWY4YjhlNjY3ZDAxNmM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-05-15T12:26:50Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-05-15T12:26:50Z"}, "message": "Auto merge of #33612 - royalstream:royalstream-enc-enum-ptr, r=michaelwoerister\n\ngdb Pretty Print: generic encoded was failing on reference/pointer types\n\nIf you debug this program using **gdb**\n```rust\nfn main() {\n    let x = 10;\n    let y = Some(&x);\n    // additional code\n}\n```\nAnd you try to print **y**'s value from the debugger, you get the following:\n```\n(gdb) print y\nPython Exception <class 'gdb.error'> Cannot convert value to int.:\n$1 = {RUST$ENCODED$ENUM$0$None = Some = {0x7fff5fbff97c}}\n```\nWhat happens is that inside **debugger_pretty_printers_common.py** the method `is_null_variant` doesn't have any special handling for pointer values so it ends up calling `.as_integer()` on `discriminant_val` (which holds a pointer) and fails.\n\nConsidering it needs to handle pointers and return _true_ when the pointer is _null_, I modified the `.as_integer()` method in **gdb_rust_pretty_printing.py** to take pointers into consideration.\n\nAfter this modification **gdb** prints **y** like this:\n```\n(gdb) print y\n$1 = Some = {0x7fff5fbff97c}\n```\nNow, it would be nice to print something useful (instead of a pointer address) but the pretty printer doesn't currently handle references/pointers so that's a completely different subject.", "tree": {"sha": "6dc9e451e04dffefe9d51b9b587afd96cc88631d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6dc9e451e04dffefe9d51b9b587afd96cc88631d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b3583193531c124e36aa1813cf5f8b8e667d016c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b3583193531c124e36aa1813cf5f8b8e667d016c", "html_url": "https://github.com/rust-lang/rust/commit/b3583193531c124e36aa1813cf5f8b8e667d016c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b3583193531c124e36aa1813cf5f8b8e667d016c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1a26d2364f9da1667ca0098d3cc4a213d131f481", "url": "https://api.github.com/repos/rust-lang/rust/commits/1a26d2364f9da1667ca0098d3cc4a213d131f481", "html_url": "https://github.com/rust-lang/rust/commit/1a26d2364f9da1667ca0098d3cc4a213d131f481"}, {"sha": "04baf2593e782dafc979cfbfb6c9994e3a0d1e78", "url": "https://api.github.com/repos/rust-lang/rust/commits/04baf2593e782dafc979cfbfb6c9994e3a0d1e78", "html_url": "https://github.com/rust-lang/rust/commit/04baf2593e782dafc979cfbfb6c9994e3a0d1e78"}], "stats": {"total": 2, "additions": 2, "deletions": 0}, "files": [{"sha": "38c9fbf98281a1c42c66fb57782b74fa51f4fddd", "filename": "src/etc/gdb_rust_pretty_printing.py", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b3583193531c124e36aa1813cf5f8b8e667d016c/src%2Fetc%2Fgdb_rust_pretty_printing.py", "raw_url": "https://github.com/rust-lang/rust/raw/b3583193531c124e36aa1813cf5f8b8e667d016c/src%2Fetc%2Fgdb_rust_pretty_printing.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fetc%2Fgdb_rust_pretty_printing.py?ref=b3583193531c124e36aa1813cf5f8b8e667d016c", "patch": "@@ -70,6 +70,8 @@ def get_child_at_index(self, index):\n         return child\n \n     def as_integer(self):\n+        if self.gdb_val.type.code == gdb.TYPE_CODE_PTR:\n+            return int(str(self.gdb_val), 0)\n         return int(self.gdb_val)\n \n     def get_wrapped_value(self):"}]}