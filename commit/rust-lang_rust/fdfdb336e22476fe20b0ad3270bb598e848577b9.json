{"sha": "fdfdb336e22476fe20b0ad3270bb598e848577b9", "node_id": "C_kwDOAAsO6NoAKGZkZmRiMzM2ZTIyNDc2ZmUyMGIwYWQzMjcwYmI1OThlODQ4NTc3Yjk", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-04-08T09:48:25Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-04-08T09:48:25Z"}, "message": "Rollup merge of #95782 - ChrisDenton:pipe-buffer-size, r=thomcc\n\nWindows: Increase a pipe's buffer capacity to 64kb\n\nThis brings it inline with typical Linux defaults: https://www.man7.org/linux/man-pages/man7/pipe.7.html\n\n> Since Linux 2.6.11, the pipe capacity is 16 pages (i.e., 65,536 bytes in a system with a page size of 4096 bytes).\n\nThis may also help with #45572 and #95759 but does not fix either issue. It simply makes them much less likely to be encountered.", "tree": {"sha": "da59501ea9f3093e8e61badaf9ad86fb82958677", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/da59501ea9f3093e8e61badaf9ad86fb82958677"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fdfdb336e22476fe20b0ad3270bb598e848577b9", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiUATqCRBK7hj4Ov3rIwAAFsQIAEsdjn5yhULJ6cD6SPAc5N8i\nI6Ep8Vci/vHUZbnnvZpLNjlpF0XX45a/yY1MvRzAlDVP33RsFk5m2k1RYYE0i8cA\nogoETaPpnVFauzPPpugeeKlgj/AtbI3Ln6Ka2UdTC2v78DjM6Hr3LM7dkkhcXhmA\ncbQ0OgkAuw1rGtjeSJcyGGyISkJL+2jvO8kD+/meGGjqDywSivtdeRolg6rEfQyu\nW/IDvxX79rWejpHdzVtBm+uh0Mz/fe7xi+V3Bbn+d1hqKMXBWQV8s92Orwf746k9\nfocrRI++NthBngipnFcrZe+NBzpVzH8upkKk4WiGvt9WOnQ0xHbP5FcyCxekekc=\n=cONY\n-----END PGP SIGNATURE-----\n", "payload": "tree da59501ea9f3093e8e61badaf9ad86fb82958677\nparent 1f80881a94f12c457b2e7058047c5c17566e2520\nparent 6a4b44426b7fd04592e618a93378510963ceda11\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1649411305 +0200\ncommitter GitHub <noreply@github.com> 1649411305 +0200\n\nRollup merge of #95782 - ChrisDenton:pipe-buffer-size, r=thomcc\n\nWindows: Increase a pipe's buffer capacity to 64kb\n\nThis brings it inline with typical Linux defaults: https://www.man7.org/linux/man-pages/man7/pipe.7.html\n\n> Since Linux 2.6.11, the pipe capacity is 16 pages (i.e., 65,536 bytes in a system with a page size of 4096 bytes).\n\nThis may also help with #45572 and #95759 but does not fix either issue. It simply makes them much less likely to be encountered.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fdfdb336e22476fe20b0ad3270bb598e848577b9", "html_url": "https://github.com/rust-lang/rust/commit/fdfdb336e22476fe20b0ad3270bb598e848577b9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fdfdb336e22476fe20b0ad3270bb598e848577b9/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1f80881a94f12c457b2e7058047c5c17566e2520", "url": "https://api.github.com/repos/rust-lang/rust/commits/1f80881a94f12c457b2e7058047c5c17566e2520", "html_url": "https://github.com/rust-lang/rust/commit/1f80881a94f12c457b2e7058047c5c17566e2520"}, {"sha": "6a4b44426b7fd04592e618a93378510963ceda11", "url": "https://api.github.com/repos/rust-lang/rust/commits/6a4b44426b7fd04592e618a93378510963ceda11", "html_url": "https://github.com/rust-lang/rust/commit/6a4b44426b7fd04592e618a93378510963ceda11"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "09d1dd55989e19fbab6ad7eb4a0e737b3403ed7f", "filename": "library/std/src/sys/windows/pipe.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/fdfdb336e22476fe20b0ad3270bb598e848577b9/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fpipe.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fdfdb336e22476fe20b0ad3270bb598e848577b9/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fpipe.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fsys%2Fwindows%2Fpipe.rs?ref=fdfdb336e22476fe20b0ad3270bb598e848577b9", "patch": "@@ -53,6 +53,9 @@ pub struct Pipes {\n /// with `OVERLAPPED` instances, but also works out ok if it's only ever used\n /// once at a time (which we do indeed guarantee).\n pub fn anon_pipe(ours_readable: bool, their_handle_inheritable: bool) -> io::Result<Pipes> {\n+    // A 64kb pipe capacity is the same as a typical Linux default.\n+    const PIPE_BUFFER_CAPACITY: u32 = 64 * 1024;\n+\n     // Note that we specifically do *not* use `CreatePipe` here because\n     // unfortunately the anonymous pipes returned do not support overlapped\n     // operations. Instead, we create a \"hopefully unique\" name and create a\n@@ -91,8 +94,8 @@ pub fn anon_pipe(ours_readable: bool, their_handle_inheritable: bool) -> io::Res\n                     | c::PIPE_WAIT\n                     | reject_remote_clients_flag,\n                 1,\n-                4096,\n-                4096,\n+                PIPE_BUFFER_CAPACITY,\n+                PIPE_BUFFER_CAPACITY,\n                 0,\n                 ptr::null_mut(),\n             );"}]}