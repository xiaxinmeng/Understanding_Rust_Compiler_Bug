{"sha": "b9824e18c2b02d74bd1bf646fea5f05477ca5071", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI5ODI0ZTE4YzJiMDJkNzRiZDFiZjY0NmZlYTVmMDU0NzdjYTUwNzE=", "commit": {"author": {"name": "Brendan Zabarauskas", "email": "bjzaba@yahoo.com.au", "date": "2013-05-08T15:38:39Z"}, "committer": {"name": "Brendan Zabarauskas", "email": "bjzaba@yahoo.com.au", "date": "2013-05-14T21:02:43Z"}, "message": "Add Scheme-style `cond!` macro to syntax::ext::expand\n\nAddresses issue #6037", "tree": {"sha": "855c8c7f4c9f59d9790a4ee9ac74bf7d0f587735", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/855c8c7f4c9f59d9790a4ee9ac74bf7d0f587735"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b9824e18c2b02d74bd1bf646fea5f05477ca5071", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b9824e18c2b02d74bd1bf646fea5f05477ca5071", "html_url": "https://github.com/rust-lang/rust/commit/b9824e18c2b02d74bd1bf646fea5f05477ca5071", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b9824e18c2b02d74bd1bf646fea5f05477ca5071/comments", "author": {"login": "brendanzab", "id": 695077, "node_id": "MDQ6VXNlcjY5NTA3Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/695077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brendanzab", "html_url": "https://github.com/brendanzab", "followers_url": "https://api.github.com/users/brendanzab/followers", "following_url": "https://api.github.com/users/brendanzab/following{/other_user}", "gists_url": "https://api.github.com/users/brendanzab/gists{/gist_id}", "starred_url": "https://api.github.com/users/brendanzab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brendanzab/subscriptions", "organizations_url": "https://api.github.com/users/brendanzab/orgs", "repos_url": "https://api.github.com/users/brendanzab/repos", "events_url": "https://api.github.com/users/brendanzab/events{/privacy}", "received_events_url": "https://api.github.com/users/brendanzab/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brendanzab", "id": 695077, "node_id": "MDQ6VXNlcjY5NTA3Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/695077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brendanzab", "html_url": "https://github.com/brendanzab", "followers_url": "https://api.github.com/users/brendanzab/followers", "following_url": "https://api.github.com/users/brendanzab/following{/other_user}", "gists_url": "https://api.github.com/users/brendanzab/gists{/gist_id}", "starred_url": "https://api.github.com/users/brendanzab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brendanzab/subscriptions", "organizations_url": "https://api.github.com/users/brendanzab/orgs", "repos_url": "https://api.github.com/users/brendanzab/repos", "events_url": "https://api.github.com/users/brendanzab/events{/privacy}", "received_events_url": "https://api.github.com/users/brendanzab/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d217174987466010cd8810179c5fdb7ae4a126d0", "url": "https://api.github.com/repos/rust-lang/rust/commits/d217174987466010cd8810179c5fdb7ae4a126d0", "html_url": "https://github.com/rust-lang/rust/commit/d217174987466010cd8810179c5fdb7ae4a126d0"}], "stats": {"total": 134, "additions": 105, "deletions": 29}, "files": [{"sha": "30edd535a881e663bccda5803ac7fd54b8f17eb3", "filename": "src/libstd/fun_treemap.rs", "status": "modified", "additions": 23, "deletions": 28, "changes": 51, "blob_url": "https://github.com/rust-lang/rust/blob/b9824e18c2b02d74bd1bf646fea5f05477ca5071/src%2Flibstd%2Ffun_treemap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9824e18c2b02d74bd1bf646fea5f05477ca5071/src%2Flibstd%2Ffun_treemap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Ffun_treemap.rs?ref=b9824e18c2b02d74bd1bf646fea5f05477ca5071", "patch": "@@ -33,45 +33,40 @@ enum TreeNode<K, V> {\n pub fn init<K, V>() -> Treemap<K, V> { @Empty }\n \n /// Insert a value into the map\n-pub fn insert<K:Copy + Eq + Ord,V:Copy>(m: Treemap<K, V>, k: K, v: V)\n-  -> Treemap<K, V> {\n+pub fn insert<K:Copy + Eq + Ord,V:Copy>(m: Treemap<K, V>, k: K, v: V) -> Treemap<K, V> {\n     @match m {\n-       @Empty => Node(@k, @v, @Empty, @Empty),\n-       @Node(@copy kk, vv, left, right) => {\n-         if k < kk {\n-             Node(@kk, vv, insert(left, k, v), right)\n-         } else if k == kk {\n-             Node(@kk, @v, left, right)\n-         } else { Node(@kk, vv, left, insert(right, k, v)) }\n-       }\n-     }\n+        @Empty => Node(@k, @v, @Empty, @Empty),\n+        @Node(@copy kk, vv, left, right) => cond!(\n+            | k <  kk { Node(@kk, vv, insert(left, k, v), right) }\n+            | k == kk { Node(@kk, @v, left, right)               }\n+            _         { Node(@kk, vv, left, insert(right, k, v)) }\n+        )\n+    }\n }\n \n /// Find a value based on the key\n pub fn find<K:Eq + Ord,V:Copy>(m: Treemap<K, V>, k: K) -> Option<V> {\n     match *m {\n-      Empty => None,\n-      Node(@ref kk, @copy v, left, right) => {\n-        if k == *kk {\n-            Some(v)\n-        } else if k < *kk { find(left, k) } else { find(right, k) }\n-      }\n+        Empty => None,\n+        Node(@ref kk, @copy v, left, right) => cond!(\n+            | k == *kk { Some(v)        }\n+            | k <  *kk { find(left, k)  }\n+            _          { find(right, k) }\n+        )\n     }\n }\n \n /// Visit all pairs in the map in order.\n pub fn traverse<K, V: Copy>(m: Treemap<K, V>, f: &fn(&K, &V)) {\n     match *m {\n-      Empty => (),\n-      /*\n-        Previously, this had what looked like redundant\n-        matches to me, so I changed it. but that may be a\n-        de-optimization -- tjc\n-       */\n-      Node(@ref k, @ref v, left, right) => {\n-        traverse(left, f);\n-        f(k, v);\n-        traverse(right, f);\n-      }\n+        Empty => (),\n+        // Previously, this had what looked like redundant\n+        // matches to me, so I changed it. but that may be a\n+        // de-optimization -- tjc\n+        Node(@ref k, @ref v, left, right) => {\n+            traverse(left, f);\n+            f(k, v);\n+            traverse(right, f);\n+        }\n     }\n }"}, {"sha": "d29791449b61c5612f17e326d8c825f46fc4cede", "filename": "src/libstd/std.rc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/b9824e18c2b02d74bd1bf646fea5f05477ca5071/src%2Flibstd%2Fstd.rc", "raw_url": "https://github.com/rust-lang/rust/raw/b9824e18c2b02d74bd1bf646fea5f05477ca5071/src%2Flibstd%2Fstd.rc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fstd.rc?ref=b9824e18c2b02d74bd1bf646fea5f05477ca5071", "patch": "@@ -63,6 +63,7 @@ pub mod flatpipes;\n \n pub mod bitv;\n pub mod deque;\n+#[cfg(not(stage0))]\n pub mod fun_treemap;\n pub mod list;\n pub mod priority_queue;"}, {"sha": "ad1da0a8685e0678df664f895dcf534011eac94a", "filename": "src/libsyntax/ext/expand.rs", "status": "modified", "additions": 35, "deletions": 1, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/b9824e18c2b02d74bd1bf646fea5f05477ca5071/src%2Flibsyntax%2Fext%2Fexpand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9824e18c2b02d74bd1bf646fea5f05477ca5071/src%2Flibsyntax%2Fext%2Fexpand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fext%2Fexpand.rs?ref=b9824e18c2b02d74bd1bf646fea5f05477ca5071", "patch": "@@ -542,7 +542,41 @@ pub fn core_macros() -> ~str {\n         }\n     )\n \n-\n+    //\n+    // A scheme-style conditional that helps to improve code clarity in some instances when\n+    // the `if`, `else if`, and `else` keywords obscure predicates undesirably.\n+    //\n+    // # Example\n+    //\n+    // ~~~\n+    // let clamped =\n+    //     if x > mx { mx }\n+    //     else if x < mn { mn }\n+    //     else { x };\n+    // ~~~\n+    //\n+    // Using `cond!`, the above could be written as:\n+    //\n+    // ~~~\n+    // let clamped = cond!(\n+    //     | x > mx { mx }\n+    //     | x < mn { mn }\n+    //     _        { x  }\n+    // );\n+    // ~~~\n+    //\n+    // The optional default case is denoted by `_`.\n+    //\n+    macro_rules! cond (\n+        ($( | $pred:expr $body:block)+ _ $default:block ) => (\n+            $(if $pred $body else)+\n+            $default\n+        );\n+        // for if the default case was ommitted\n+        ( $( | $pred:expr $body:block )+ ) => (\n+            $(if $pred $body)else+\n+        );\n+    )\n }\";\n }\n "}, {"sha": "b8280c30e08f0de744c058c2be744c9f5c946196", "filename": "src/test/run-pass/cond-macro-no-default.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/b9824e18c2b02d74bd1bf646fea5f05477ca5071/src%2Ftest%2Frun-pass%2Fcond-macro-no-default.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9824e18c2b02d74bd1bf646fea5f05477ca5071/src%2Ftest%2Frun-pass%2Fcond-macro-no-default.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fcond-macro-no-default.rs?ref=b9824e18c2b02d74bd1bf646fea5f05477ca5071", "patch": "@@ -0,0 +1,23 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn clamp<T:Copy + Ord + Signed>(x: T, mn: T, mx: T) -> T {\n+    cond!(\n+        | x > mx { return mx; }\n+        | x < mn { return mn; }\n+    )\n+    return x;\n+}\n+\n+fn main() {\n+    assert_eq!(clamp(1, 2, 4), 2);\n+    assert_eq!(clamp(8, 2, 4), 4);\n+    assert_eq!(clamp(3, 2, 4), 3);\n+}\n\\ No newline at end of file"}, {"sha": "ebe1cbbfd82775ae041ac6b0fd20df239ba09694", "filename": "src/test/run-pass/cond-macro.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/b9824e18c2b02d74bd1bf646fea5f05477ca5071/src%2Ftest%2Frun-pass%2Fcond-macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b9824e18c2b02d74bd1bf646fea5f05477ca5071/src%2Ftest%2Frun-pass%2Fcond-macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fcond-macro.rs?ref=b9824e18c2b02d74bd1bf646fea5f05477ca5071", "patch": "@@ -0,0 +1,23 @@\n+// Copyright 2013 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+fn clamp<T:Copy + Ord + Signed>(x: T, mn: T, mx: T) -> T {\n+    cond!(\n+        | x > mx { mx }\n+        | x < mn { mn }\n+        _        { x  }\n+    )\n+}\n+\n+fn main() {\n+    assert_eq!(clamp(1, 2, 4), 2);\n+    assert_eq!(clamp(8, 2, 4), 4);\n+    assert_eq!(clamp(3, 2, 4), 3);\n+}\n\\ No newline at end of file"}]}