{"sha": "cf81975d7765bf0cf82fee9f3e991c880f77cd13", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNmODE5NzVkNzc2NWJmMGNmODJmZWU5ZjNlOTkxYzg4MGY3N2NkMTM=", "commit": {"author": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-10-10T12:04:14Z"}, "committer": {"name": "flip1995", "email": "hello@philkrones.com", "date": "2020-10-10T12:04:14Z"}, "message": "Fix two ICEs caused by ty.is_{sized,freeze}", "tree": {"sha": "c70d1edfa4d56bede4f8959b6c585fb1e62b174c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c70d1edfa4d56bede4f8959b6c585fb1e62b174c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cf81975d7765bf0cf82fee9f3e991c880f77cd13", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEqv54U47RUUXZfOLnLO/Nsn7QvnkFAl+Boz4ACgkQLO/Nsn7Q\nvnkKkQ//cieZhZ1k5r1nuscb6671ZDuzaCSwYIJilB2zgEdc638dZo5KQE7Fd469\nOQhiePx8yaUnRWHD6usHrWNY6B2OVyE/TV5gjvscmIuE9kfHk+Y01aaxopuCkIvy\nFC7eE1AGgRY+QhXy0H47JQXh5rw6Pl62XyCvQ9cBH7/sOa2AMu66gYsWC2UrIFXf\nwSvdGCknBFDr1qqcHFBPZRS449j4FxPag/p9X3bZyDWPUvaUM0AEljbx+HoCKGjn\nvQ8vjwqdsdAhVuvkRUmz2p+SB152ct0E9qss7KTlZADYoRZ67lt+EJztljvrnYIr\n0yEiCf1OhCb6qT2jBfYjYsU112u7j+Mn/wj7kX2m6xP3l3p9oJKEiLRhYQoiqRQp\nIRElgVap3olowgIvfWv/U8fYYuUoDxbUNljD7MhifsqCfdsW9GHVE5/I1hOvDNZl\nSAxjYCnrU2trBnItubxiHS6BgAdh3BmwWpG6gyxk4O+inga7Qg9RB5pzU+YIiLu0\nJSuA503n4ZNOC5RXGjw69O87+meIdTAzKvkU0CjCVeXiQevmKeR4IwfBAG+nTEI8\ndv78mRRmu3EOwNaBI2rApZJLpOnA0r1dBfi3Du7lQM2VWPvRR+3SsUYO7NR6Mn+c\n4kI8uczBmUL8uCoEfcJTuwFVl8VIQE3epmMDD4jAy9Ld1g774v0=\n=vK0O\n-----END PGP SIGNATURE-----", "payload": "tree c70d1edfa4d56bede4f8959b6c585fb1e62b174c\nparent dbc02854fce1f783599e3f98b6ee6b9a136d9e96\nauthor flip1995 <hello@philkrones.com> 1602331454 +0200\ncommitter flip1995 <hello@philkrones.com> 1602331454 +0200\n\nFix two ICEs caused by ty.is_{sized,freeze}\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cf81975d7765bf0cf82fee9f3e991c880f77cd13", "html_url": "https://github.com/rust-lang/rust/commit/cf81975d7765bf0cf82fee9f3e991c880f77cd13", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cf81975d7765bf0cf82fee9f3e991c880f77cd13/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dbc02854fce1f783599e3f98b6ee6b9a136d9e96", "url": "https://api.github.com/repos/rust-lang/rust/commits/dbc02854fce1f783599e3f98b6ee6b9a136d9e96", "html_url": "https://github.com/rust-lang/rust/commit/dbc02854fce1f783599e3f98b6ee6b9a136d9e96"}], "stats": {"total": 14, "additions": 8, "deletions": 6}, "files": [{"sha": "4525b12689fa76cba77811b0d876180d671b4913", "filename": "clippy_lints/src/mut_key.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf81975d7765bf0cf82fee9f3e991c880f77cd13/clippy_lints%2Fsrc%2Fmut_key.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf81975d7765bf0cf82fee9f3e991c880f77cd13/clippy_lints%2Fsrc%2Fmut_key.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fmut_key.rs?ref=cf81975d7765bf0cf82fee9f3e991c880f77cd13", "patch": "@@ -1,6 +1,7 @@\n use crate::utils::{match_def_path, paths, span_lint, trait_ref_of_method};\n use rustc_hir as hir;\n use rustc_lint::{LateContext, LateLintPass};\n+use rustc_middle::ty::TypeFoldable;\n use rustc_middle::ty::{Adt, Array, RawPtr, Ref, Slice, Tuple, Ty, TypeAndMut};\n use rustc_session::{declare_lint_pass, declare_tool_lint};\n use rustc_span::source_map::Span;\n@@ -120,7 +121,11 @@ fn is_mutable_type<'tcx>(cx: &LateContext<'tcx>, ty: Ty<'tcx>, span: Span) -> bo\n             size.try_eval_usize(cx.tcx, cx.param_env).map_or(true, |u| u != 0) && is_mutable_type(cx, inner_ty, span)\n         },\n         Tuple(..) => ty.tuple_fields().any(|ty| is_mutable_type(cx, ty, span)),\n-        Adt(..) => cx.tcx.layout_of(cx.param_env.and(ty)).is_ok() && !ty.is_freeze(cx.tcx.at(span), cx.param_env),\n+        Adt(..) => {\n+            cx.tcx.layout_of(cx.param_env.and(ty)).is_ok()\n+                && !ty.has_escaping_bound_vars()\n+                && !ty.is_freeze(cx.tcx.at(span), cx.param_env)\n+        },\n         _ => false,\n     }\n }"}, {"sha": "9a948af8bfc4edd84ac222013149cfab77bd00e2", "filename": "clippy_lints/src/types.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/cf81975d7765bf0cf82fee9f3e991c880f77cd13/clippy_lints%2Fsrc%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf81975d7765bf0cf82fee9f3e991c880f77cd13/clippy_lints%2Fsrc%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftypes.rs?ref=cf81975d7765bf0cf82fee9f3e991c880f77cd13", "patch": "@@ -17,6 +17,7 @@ use rustc_hir::{\n use rustc_lint::{LateContext, LateLintPass, LintContext};\n use rustc_middle::hir::map::Map;\n use rustc_middle::lint::in_external_macro;\n+use rustc_middle::ty::TypeFoldable;\n use rustc_middle::ty::{self, InferTy, Ty, TyCtxt, TyS, TypeckResults};\n use rustc_session::{declare_lint_pass, declare_tool_lint, impl_lint_pass};\n use rustc_span::hygiene::{ExpnKind, MacroKind};\n@@ -541,11 +542,7 @@ impl Types {\n                                 _ => None,\n                             });\n                             let ty_ty = hir_ty_to_ty(cx.tcx, boxed_ty);\n-                            // HACK(flip1995): This is a fix for an ICE occuring when `ty_ty` is a\n-                            // trait object with a lifetime, e.g. `dyn T<'_>`. Since trait objects\n-                            // don't have a known size, this shouldn't introduce FNs. But there\n-                            // should be a better solution.\n-                            if !matches!(ty_ty.kind(), ty::Dynamic(..));\n+                            if !ty_ty.has_escaping_bound_vars();\n                             if ty_ty.is_sized(cx.tcx.at(ty.span), cx.param_env);\n                             if let Ok(ty_ty_size) = cx.layout_of(ty_ty).map(|l| l.size.bytes());\n                             if ty_ty_size <= self.vec_box_size_threshold;"}]}