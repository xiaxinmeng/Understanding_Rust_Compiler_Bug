{"sha": "f4dc348ad580cb5958f724a1a5ac7b538ef35515", "node_id": "C_kwDOAAsO6NoAKGY0ZGMzNDhhZDU4MGNiNTk1OGY3MjRhMWE1YWM3YjUzOGVmMzU1MTU", "commit": {"author": {"name": "dswij", "email": "dswijj@gmail.com", "date": "2022-01-10T04:45:01Z"}, "committer": {"name": "dswij", "email": "dswijj@gmail.com", "date": "2022-01-10T04:45:22Z"}, "message": "`trait_duplication_in_bounds` Update description and add test", "tree": {"sha": "fac2e3ffa1c8ef5209b2d16976bc7857f68f6fc1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fac2e3ffa1c8ef5209b2d16976bc7857f68f6fc1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f4dc348ad580cb5958f724a1a5ac7b538ef35515", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f4dc348ad580cb5958f724a1a5ac7b538ef35515", "html_url": "https://github.com/rust-lang/rust/commit/f4dc348ad580cb5958f724a1a5ac7b538ef35515", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f4dc348ad580cb5958f724a1a5ac7b538ef35515/comments", "author": {"login": "dswij", "id": 44697459, "node_id": "MDQ6VXNlcjQ0Njk3NDU5", "avatar_url": "https://avatars.githubusercontent.com/u/44697459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dswij", "html_url": "https://github.com/dswij", "followers_url": "https://api.github.com/users/dswij/followers", "following_url": "https://api.github.com/users/dswij/following{/other_user}", "gists_url": "https://api.github.com/users/dswij/gists{/gist_id}", "starred_url": "https://api.github.com/users/dswij/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dswij/subscriptions", "organizations_url": "https://api.github.com/users/dswij/orgs", "repos_url": "https://api.github.com/users/dswij/repos", "events_url": "https://api.github.com/users/dswij/events{/privacy}", "received_events_url": "https://api.github.com/users/dswij/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dswij", "id": 44697459, "node_id": "MDQ6VXNlcjQ0Njk3NDU5", "avatar_url": "https://avatars.githubusercontent.com/u/44697459?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dswij", "html_url": "https://github.com/dswij", "followers_url": "https://api.github.com/users/dswij/followers", "following_url": "https://api.github.com/users/dswij/following{/other_user}", "gists_url": "https://api.github.com/users/dswij/gists{/gist_id}", "starred_url": "https://api.github.com/users/dswij/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dswij/subscriptions", "organizations_url": "https://api.github.com/users/dswij/orgs", "repos_url": "https://api.github.com/users/dswij/repos", "events_url": "https://api.github.com/users/dswij/events{/privacy}", "received_events_url": "https://api.github.com/users/dswij/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f690978023d7465d05abe9a1288100f192e74193", "url": "https://api.github.com/repos/rust-lang/rust/commits/f690978023d7465d05abe9a1288100f192e74193", "html_url": "https://github.com/rust-lang/rust/commit/f690978023d7465d05abe9a1288100f192e74193"}], "stats": {"total": 61, "additions": 40, "deletions": 21}, "files": [{"sha": "6369aafe3f9734ec605be603f4eb30d700cace9d", "filename": "clippy_lints/src/trait_bounds.rs", "status": "modified", "additions": 16, "deletions": 13, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/f4dc348ad580cb5958f724a1a5ac7b538ef35515/clippy_lints%2Fsrc%2Ftrait_bounds.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4dc348ad580cb5958f724a1a5ac7b538ef35515/clippy_lints%2Fsrc%2Ftrait_bounds.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ftrait_bounds.rs?ref=f4dc348ad580cb5958f724a1a5ac7b538ef35515", "patch": "@@ -121,7 +121,14 @@ impl<'tcx> LateLintPass<'tcx> for TraitBounds {\n                         .filter_map(get_trait_res_span_from_bound)\n                         .for_each(|(trait_item_res, span)| {\n                             if self_bounds_set.get(&trait_item_res).is_some() {\n-                                emit_lint(cx, span);\n+                                span_lint_and_help(\n+                                    cx,\n+                                    TRAIT_DUPLICATION_IN_BOUNDS,\n+                                    span,\n+                                    \"this trait bound is already specified in trait declaration\",\n+                                    None,\n+                                    \"consider removing this trait bound\",\n+                                );\n                             }\n                         });\n                 }\n@@ -242,21 +249,17 @@ fn check_trait_bound_duplication(cx: &LateContext<'_>, gen: &'_ Generics<'_>) {\n                     if let Some((_, span_direct)) = trait_resolutions_direct\n                                                 .iter()\n                                                 .find(|(res_direct, _)| *res_direct == res_where) {\n-                        emit_lint(cx, *span_direct);\n+                        span_lint_and_help(\n+                            cx,\n+                            TRAIT_DUPLICATION_IN_BOUNDS,\n+                            *span_direct,\n+                            \"this trait bound is already specified in the where clause\",\n+                            None,\n+                            \"consider removing this trait bound\",\n+                        );\n                     }\n                 }\n             }\n         }\n     }\n }\n-\n-fn emit_lint(cx: &LateContext<'_>, span: Span) {\n-    span_lint_and_help(\n-        cx,\n-        TRAIT_DUPLICATION_IN_BOUNDS,\n-        span,\n-        \"this trait bound is already specified in the where clause\",\n-        None,\n-        \"consider removing this trait bound\",\n-    );\n-}"}, {"sha": "2edb202892afcaf4c1b65a7b3e91337a8779f3b8", "filename": "tests/ui/trait_duplication_in_bounds.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f4dc348ad580cb5958f724a1a5ac7b538ef35515/tests%2Fui%2Ftrait_duplication_in_bounds.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f4dc348ad580cb5958f724a1a5ac7b538ef35515/tests%2Fui%2Ftrait_duplication_in_bounds.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftrait_duplication_in_bounds.rs?ref=f4dc348ad580cb5958f724a1a5ac7b538ef35515", "patch": "@@ -41,6 +41,8 @@ trait U: Default {\n }\n \n trait ZZ: Default {\n+    fn g();\n+    fn h();\n     fn f()\n     where\n         Self: Default + Clone;\n@@ -50,6 +52,12 @@ trait BadTrait: Default + Clone {\n     fn f()\n     where\n         Self: Default + Clone;\n+    fn g()\n+    where\n+        Self: Default;\n+    fn h()\n+    where\n+        Self: Copy;\n }\n \n #[derive(Default, Clone)]"}, {"sha": "e0c7a7ec618ed932223b8fb8a17f3e5ca61b0eab", "filename": "tests/ui/trait_duplication_in_bounds.stderr", "status": "modified", "additions": 16, "deletions": 8, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/f4dc348ad580cb5958f724a1a5ac7b538ef35515/tests%2Fui%2Ftrait_duplication_in_bounds.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/f4dc348ad580cb5958f724a1a5ac7b538ef35515/tests%2Fui%2Ftrait_duplication_in_bounds.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftrait_duplication_in_bounds.stderr?ref=f4dc348ad580cb5958f724a1a5ac7b538ef35515", "patch": "@@ -19,37 +19,45 @@ LL | fn bad_foo<T: Clone + Default, Z: Copy>(arg0: T, arg1: Z)\n    |\n    = help: consider removing this trait bound\n \n-error: this trait bound is already specified in the where clause\n+error: this trait bound is already specified in trait declaration\n   --> $DIR/trait_duplication_in_bounds.rs:34:15\n    |\n LL |         Self: Default;\n    |               ^^^^^^^\n    |\n    = help: consider removing this trait bound\n \n-error: this trait bound is already specified in the where clause\n-  --> $DIR/trait_duplication_in_bounds.rs:46:15\n+error: this trait bound is already specified in trait declaration\n+  --> $DIR/trait_duplication_in_bounds.rs:48:15\n    |\n LL |         Self: Default + Clone;\n    |               ^^^^^^^\n    |\n    = help: consider removing this trait bound\n \n-error: this trait bound is already specified in the where clause\n-  --> $DIR/trait_duplication_in_bounds.rs:52:15\n+error: this trait bound is already specified in trait declaration\n+  --> $DIR/trait_duplication_in_bounds.rs:54:15\n    |\n LL |         Self: Default + Clone;\n    |               ^^^^^^^\n    |\n    = help: consider removing this trait bound\n \n-error: this trait bound is already specified in the where clause\n-  --> $DIR/trait_duplication_in_bounds.rs:52:25\n+error: this trait bound is already specified in trait declaration\n+  --> $DIR/trait_duplication_in_bounds.rs:54:25\n    |\n LL |         Self: Default + Clone;\n    |                         ^^^^^\n    |\n    = help: consider removing this trait bound\n \n-error: aborting due to 6 previous errors\n+error: this trait bound is already specified in trait declaration\n+  --> $DIR/trait_duplication_in_bounds.rs:57:15\n+   |\n+LL |         Self: Default;\n+   |               ^^^^^^^\n+   |\n+   = help: consider removing this trait bound\n+\n+error: aborting due to 7 previous errors\n "}]}