{"sha": "fc83a0cb57eaad7104cc8861ba354fc76da79684", "node_id": "C_kwDOAAsO6NoAKGZjODNhMGNiNTdlYWFkNzEwNGNjODg2MWJhMzU0ZmM3NmRhNzk2ODQ", "commit": {"author": {"name": "Luqman Aden", "email": "me@luqman.ca", "date": "2022-08-07T11:03:28Z"}, "committer": {"name": "Luqman Aden", "email": "me@luqman.ca", "date": "2022-08-07T11:03:28Z"}, "message": "Don't ICE while suggesting updating item path.\n\nWhen an item isn't found, we may suggest an appropriate import to\n`use`. Along with that, we also suggest updating the path to work\nwith the `use`. Unfortunately, if the code in question originates\nfrom a macro, the span used to indicate which part of the path\nneeds updating may not be suitable and cause an ICE. Since, such\ncode is not adjustable directly by the user without modifying the\nmacro, just skip the suggestion in such cases.", "tree": {"sha": "997de8fc4764164bcf3f3f4efaa874dd0c0f612e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/997de8fc4764164bcf3f3f4efaa874dd0c0f612e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fc83a0cb57eaad7104cc8861ba354fc76da79684", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fc83a0cb57eaad7104cc8861ba354fc76da79684", "html_url": "https://github.com/rust-lang/rust/commit/fc83a0cb57eaad7104cc8861ba354fc76da79684", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fc83a0cb57eaad7104cc8861ba354fc76da79684/comments", "author": {"login": "luqmana", "id": 287063, "node_id": "MDQ6VXNlcjI4NzA2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luqmana", "html_url": "https://github.com/luqmana", "followers_url": "https://api.github.com/users/luqmana/followers", "following_url": "https://api.github.com/users/luqmana/following{/other_user}", "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}", "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions", "organizations_url": "https://api.github.com/users/luqmana/orgs", "repos_url": "https://api.github.com/users/luqmana/repos", "events_url": "https://api.github.com/users/luqmana/events{/privacy}", "received_events_url": "https://api.github.com/users/luqmana/received_events", "type": "User", "site_admin": false}, "committer": {"login": "luqmana", "id": 287063, "node_id": "MDQ6VXNlcjI4NzA2Mw==", "avatar_url": "https://avatars.githubusercontent.com/u/287063?v=4", "gravatar_id": "", "url": "https://api.github.com/users/luqmana", "html_url": "https://github.com/luqmana", "followers_url": "https://api.github.com/users/luqmana/followers", "following_url": "https://api.github.com/users/luqmana/following{/other_user}", "gists_url": "https://api.github.com/users/luqmana/gists{/gist_id}", "starred_url": "https://api.github.com/users/luqmana/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/luqmana/subscriptions", "organizations_url": "https://api.github.com/users/luqmana/orgs", "repos_url": "https://api.github.com/users/luqmana/repos", "events_url": "https://api.github.com/users/luqmana/events{/privacy}", "received_events_url": "https://api.github.com/users/luqmana/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e141246cbbce2a6001f3181d3d0f661bbfd9c7ea", "url": "https://api.github.com/repos/rust-lang/rust/commits/e141246cbbce2a6001f3181d3d0f661bbfd9c7ea", "html_url": "https://github.com/rust-lang/rust/commit/e141246cbbce2a6001f3181d3d0f661bbfd9c7ea"}], "stats": {"total": 15, "additions": 9, "deletions": 6}, "files": [{"sha": "325b0458638af1712904cc1e05edaf0c2259bfc4", "filename": "compiler/rustc_resolve/src/diagnostics.rs", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/fc83a0cb57eaad7104cc8861ba354fc76da79684/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc83a0cb57eaad7104cc8861ba354fc76da79684/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fdiagnostics.rs?ref=fc83a0cb57eaad7104cc8861ba354fc76da79684", "patch": "@@ -2544,12 +2544,15 @@ fn show_candidates(\n                 Applicability::MaybeIncorrect,\n             );\n             if let [first, .., last] = &path[..] {\n-                err.span_suggestion_verbose(\n-                    first.ident.span.until(last.ident.span),\n-                    &format!(\"if you import `{}`, refer to it directly\", last.ident),\n-                    \"\",\n-                    Applicability::Unspecified,\n-                );\n+                let sp = first.ident.span.until(last.ident.span);\n+                if sp.can_be_used_for_suggestions() {\n+                    err.span_suggestion_verbose(\n+                        sp,\n+                        &format!(\"if you import `{}`, refer to it directly\", last.ident),\n+                        \"\",\n+                        Applicability::Unspecified,\n+                    );\n+                }\n             }\n         } else {\n             msg.push(':');"}]}