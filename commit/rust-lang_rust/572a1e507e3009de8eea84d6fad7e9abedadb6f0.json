{"sha": "572a1e507e3009de8eea84d6fad7e9abedadb6f0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU3MmExZTUwN2UzMDA5ZGU4ZWVhODRkNmZhZDdlOWFiZWRhZGI2ZjA=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-05-30T08:36:41Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-05-30T08:36:41Z"}, "message": "Merge #1347\n\n1347: Add status buffer function to emacs integration r=flodiebold a=flodiebold\n\nAlso fix a minor race condition in the 'extend selection' initialization.\n\nCo-authored-by: Florian Diebold <flodiebold@gmail.com>", "tree": {"sha": "d4873495d9b94fd996f84b8ce3087eaf4a0addff", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d4873495d9b94fd996f84b8ce3087eaf4a0addff"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/572a1e507e3009de8eea84d6fad7e9abedadb6f0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/572a1e507e3009de8eea84d6fad7e9abedadb6f0", "html_url": "https://github.com/rust-lang/rust/commit/572a1e507e3009de8eea84d6fad7e9abedadb6f0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/572a1e507e3009de8eea84d6fad7e9abedadb6f0/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "615b59aea09d4bd55c3e3a72e9aab86810107ca6", "url": "https://api.github.com/repos/rust-lang/rust/commits/615b59aea09d4bd55c3e3a72e9aab86810107ca6", "html_url": "https://github.com/rust-lang/rust/commit/615b59aea09d4bd55c3e3a72e9aab86810107ca6"}, {"sha": "f2c191e9737c50659f0891dc36349c7b0539932f", "url": "https://api.github.com/repos/rust-lang/rust/commits/f2c191e9737c50659f0891dc36349c7b0539932f", "html_url": "https://github.com/rust-lang/rust/commit/f2c191e9737c50659f0891dc36349c7b0539932f"}], "stats": {"total": 34, "additions": 34, "deletions": 0}, "files": [{"sha": "71bc20f17f6118e42d89cfc4772ecd168f5ea9d3", "filename": "editors/emacs/ra-emacs-lsp.el", "status": "modified", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/572a1e507e3009de8eea84d6fad7e9abedadb6f0/editors%2Femacs%2Fra-emacs-lsp.el", "raw_url": "https://github.com/rust-lang/rust/raw/572a1e507e3009de8eea84d6fad7e9abedadb6f0/editors%2Femacs%2Fra-emacs-lsp.el", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Femacs%2Fra-emacs-lsp.el?ref=572a1e507e3009de8eea84d6fad7e9abedadb6f0", "patch": "@@ -134,6 +134,13 @@\n                             '(rust-analyzer-extend-selection))))\n \n (with-eval-after-load 'expand-region\n+  ;; add the expansion for all existing rust-mode buffers. If expand-region is\n+  ;; loaded lazily, it might be loaded when the first rust buffer is opened, and\n+  ;; then it's too late for the hook for that buffer\n+  (dolist (buf (buffer-list))\n+    (with-current-buffer buf\n+      (when (eq 'rust-mode major-mode)\n+        (rust-analyzer--add-er-expansion))))\n   (add-hook 'rust-mode-hook 'rust-analyzer--add-er-expansion))\n \n ;; runnables\n@@ -170,5 +177,32 @@\n                          (rust-analyzer--select-runnable))))\n   (rust-analyzer-run (or runnable rust-analyzer--last-runnable)))\n \n+;; analyzer status buffer\n+(define-derived-mode rust-analyzer-status-mode special-mode \"Rust-Analyzer-Status\"\n+  \"Mode for the rust-analyzer status buffer.\")\n+\n+(defvar-local rust-analyzer--status-buffer-workspace nil)\n+\n+(defun rust-analyzer-status ()\n+  \"Displays status information for rust-analyzer.\"\n+  (interactive)\n+  (let* ((workspace (lsp-find-workspace 'rust-analyzer (buffer-file-name)))\n+         (buf (get-buffer-create (concat \"*rust-analyzer status \" (with-lsp-workspace workspace (lsp-workspace-root)) \"*\"))))\n+    (with-current-buffer buf\n+      (rust-analyzer-status-mode)\n+      (setq rust-analyzer--status-buffer-workspace workspace)\n+      (rust-analyzer-status-buffer-refresh))\n+    (pop-to-buffer buf)))\n+\n+(defun rust-analyzer-status-buffer-refresh ()\n+  (interactive)\n+  (when rust-analyzer--status-buffer-workspace\n+    (let ((inhibit-read-only t))\n+      (erase-buffer)\n+      (insert (with-lsp-workspace rust-analyzer--status-buffer-workspace\n+                (lsp-send-request (lsp-make-request\n+                                   \"rust-analyzer/analyzerStatus\")))))))\n+\n+\n (provide 'ra-emacs-lsp)\n ;;; ra-emacs-lsp.el ends here"}]}