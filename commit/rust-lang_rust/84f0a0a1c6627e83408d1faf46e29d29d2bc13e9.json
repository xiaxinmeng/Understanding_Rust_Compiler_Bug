{"sha": "84f0a0a1c6627e83408d1faf46e29d29d2bc13e9", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg0ZjBhMGExYzY2MjdlODM0MDhkMWZhZjQ2ZTI5ZDI5ZDJiYzEzZTk=", "commit": {"author": {"name": "Aman Arora", "email": "me@aman-arora.com", "date": "2021-01-26T09:08:23Z"}, "committer": {"name": "Aman Arora", "email": "me@aman-arora.com", "date": "2021-02-02T03:52:25Z"}, "message": "New migration", "tree": {"sha": "5de2de9f475360324cc102fb8b683382d788f02f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5de2de9f475360324cc102fb8b683382d788f02f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/84f0a0a1c6627e83408d1faf46e29d29d2bc13e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/84f0a0a1c6627e83408d1faf46e29d29d2bc13e9", "html_url": "https://github.com/rust-lang/rust/commit/84f0a0a1c6627e83408d1faf46e29d29d2bc13e9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/84f0a0a1c6627e83408d1faf46e29d29d2bc13e9/comments", "author": {"login": "arora-aman", "id": 4193035, "node_id": "MDQ6VXNlcjQxOTMwMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4193035?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arora-aman", "html_url": "https://github.com/arora-aman", "followers_url": "https://api.github.com/users/arora-aman/followers", "following_url": "https://api.github.com/users/arora-aman/following{/other_user}", "gists_url": "https://api.github.com/users/arora-aman/gists{/gist_id}", "starred_url": "https://api.github.com/users/arora-aman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arora-aman/subscriptions", "organizations_url": "https://api.github.com/users/arora-aman/orgs", "repos_url": "https://api.github.com/users/arora-aman/repos", "events_url": "https://api.github.com/users/arora-aman/events{/privacy}", "received_events_url": "https://api.github.com/users/arora-aman/received_events", "type": "User", "site_admin": false}, "committer": {"login": "arora-aman", "id": 4193035, "node_id": "MDQ6VXNlcjQxOTMwMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4193035?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arora-aman", "html_url": "https://github.com/arora-aman", "followers_url": "https://api.github.com/users/arora-aman/followers", "following_url": "https://api.github.com/users/arora-aman/following{/other_user}", "gists_url": "https://api.github.com/users/arora-aman/gists{/gist_id}", "starred_url": "https://api.github.com/users/arora-aman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arora-aman/subscriptions", "organizations_url": "https://api.github.com/users/arora-aman/orgs", "repos_url": "https://api.github.com/users/arora-aman/repos", "events_url": "https://api.github.com/users/arora-aman/events{/privacy}", "received_events_url": "https://api.github.com/users/arora-aman/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8f15cc1d88e2a4fdc41984da6178a8c2c92b1e2b", "url": "https://api.github.com/repos/rust-lang/rust/commits/8f15cc1d88e2a4fdc41984da6178a8c2c92b1e2b", "html_url": "https://github.com/rust-lang/rust/commit/8f15cc1d88e2a4fdc41984da6178a8c2c92b1e2b"}], "stats": {"total": 58, "additions": 29, "deletions": 29}, "files": [{"sha": "04a9e65e6647d9dda6b9346e823e5a081c40d447", "filename": "compiler/rustc_typeck/src/check/upvar.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/84f0a0a1c6627e83408d1faf46e29d29d2bc13e9/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fupvar.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84f0a0a1c6627e83408d1faf46e29d29d2bc13e9/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fupvar.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fupvar.rs?ref=84f0a0a1c6627e83408d1faf46e29d29d2bc13e9", "patch": "@@ -1270,7 +1270,7 @@ fn migration_suggestion_for_2229(tcx: TyCtxt<'_>, need_migrations: &Vec<hir::Hir\n         need_migrations.iter().map(|v| format!(\"{}\", var_name(tcx, *v))).collect::<Vec<_>>();\n     let migrations_list_concat = need_migrations_strings.join(\", \");\n \n-    format!(\"let ({}) = ({});\", migrations_list_concat, migrations_list_concat)\n+    format!(\"drop(&({}));\", migrations_list_concat)\n }\n \n /// Helper function to determine if we need to escalate CaptureKind from"}, {"sha": "02b373620966e239c17fbae278a91d3f2aff9101", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/insignificant_drop.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/84f0a0a1c6627e83408d1faf46e29d29d2bc13e9/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84f0a0a1c6627e83408d1faf46e29d29d2bc13e9/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop.rs?ref=84f0a0a1c6627e83408d1faf46e29d29d2bc13e9", "patch": "@@ -12,7 +12,7 @@ fn test1_all_need_migration() {\n \n     let c = || {\n     //~^ERROR: drop order affected for closure because of `capture_disjoint_fields`\n-    //~| NOTE: let (t, t1, t2) = (t, t1, t2);\n+    //~| NOTE: drop(&(t, t1, t2));\n         let _t = t.0;\n         let _t1 = t1.0;\n         let _t2 = t2.0;\n@@ -30,7 +30,7 @@ fn test2_only_precise_paths_need_migration() {\n \n     let c = || {\n     //~^ERROR: drop order affected for closure because of `capture_disjoint_fields`\n-    //~| NOTE: let (t, t1) = (t, t1);\n+    //~| NOTE: drop(&(t, t1));\n         let _t = t.0;\n         let _t1 = t1.0;\n         let _t2 = t2;\n@@ -46,7 +46,7 @@ fn test3_only_by_value_need_migration() {\n     let t1 = (String::new(), String::new());\n     let c = || {\n     //~^ERROR: drop order affected for closure because of `capture_disjoint_fields`\n-    //~| NOTE: let (t) = (t);\n+    //~| NOTE: drop(&(t));\n         let _t = t.0;\n         println!(\"{}\", t1.1);\n     };\n@@ -64,7 +64,7 @@ fn test4_only_non_copy_types_need_migration() {\n \n     let c = || {\n     //~^ERROR: drop order affected for closure because of `capture_disjoint_fields`\n-    //~| NOTE: let (t) = (t);\n+    //~| NOTE: drop(&(t));\n         let _t = t.0;\n         let _t1 = t1.0;\n     };\n@@ -82,7 +82,7 @@ fn test5_only_drop_types_need_migration() {\n \n     let c = || {\n     //~^ERROR: drop order affected for closure because of `capture_disjoint_fields`\n-    //~| NOTE: let (t) = (t);\n+    //~| NOTE: drop(&(t));\n         let _t = t.0;\n         let _s = s.0;\n     };\n@@ -97,7 +97,7 @@ fn test6_move_closures_non_copy_types_might_need_migration() {\n     let t1 = (String::new(), String::new());\n     let c = move || {\n     //~^ERROR: drop order affected for closure because of `capture_disjoint_fields`\n-    //~| NOTE: let (t1, t) = (t1, t);\n+    //~| NOTE: drop(&(t1, t));\n         println!(\"{} {}\", t1.1, t.1);\n     };\n \n@@ -112,7 +112,7 @@ fn test7_drop_non_drop_aggregate_need_migration() {\n \n     let c = || {\n     //~^ERROR: drop order affected for closure because of `capture_disjoint_fields`\n-    //~| NOTE: let (t) = (t);\n+    //~| NOTE: drop(&(t));\n         let _t = t.0;\n     };\n "}, {"sha": "656c132c12deeaf7630723734c8910c5539f90ac", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/insignificant_drop.stderr", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/84f0a0a1c6627e83408d1faf46e29d29d2bc13e9/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/84f0a0a1c6627e83408d1faf46e29d29d2bc13e9/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Finsignificant_drop.stderr?ref=84f0a0a1c6627e83408d1faf46e29d29d2bc13e9", "patch": "@@ -16,7 +16,7 @@ note: the lint level is defined here\n    |\n LL | #![deny(disjoint_capture_drop_reorder)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   = note: let (t, t1, t2) = (t, t1, t2);\n+   = note: drop(&(t, t1, t2));\n \n error: drop order affected for closure because of `capture_disjoint_fields`\n   --> $DIR/insignificant_drop.rs:31:13\n@@ -31,7 +31,7 @@ LL | |         let _t2 = t2;\n LL | |     };\n    | |_____^\n    |\n-   = note: let (t, t1) = (t, t1);\n+   = note: drop(&(t, t1));\n \n error: drop order affected for closure because of `capture_disjoint_fields`\n   --> $DIR/insignificant_drop.rs:47:13\n@@ -45,7 +45,7 @@ LL | |         println!(\"{}\", t1.1);\n LL | |     };\n    | |_____^\n    |\n-   = note: let (t) = (t);\n+   = note: drop(&(t));\n \n error: drop order affected for closure because of `capture_disjoint_fields`\n   --> $DIR/insignificant_drop.rs:65:13\n@@ -59,7 +59,7 @@ LL | |         let _t1 = t1.0;\n LL | |     };\n    | |_____^\n    |\n-   = note: let (t) = (t);\n+   = note: drop(&(t));\n \n error: drop order affected for closure because of `capture_disjoint_fields`\n   --> $DIR/insignificant_drop.rs:83:13\n@@ -73,7 +73,7 @@ LL | |         let _s = s.0;\n LL | |     };\n    | |_____^\n    |\n-   = note: let (t) = (t);\n+   = note: drop(&(t));\n \n error: drop order affected for closure because of `capture_disjoint_fields`\n   --> $DIR/insignificant_drop.rs:98:13\n@@ -86,7 +86,7 @@ LL | |         println!(\"{} {}\", t1.1, t.1);\n LL | |     };\n    | |_____^\n    |\n-   = note: let (t1, t) = (t1, t);\n+   = note: drop(&(t1, t));\n \n error: drop order affected for closure because of `capture_disjoint_fields`\n   --> $DIR/insignificant_drop.rs:113:13\n@@ -99,7 +99,7 @@ LL | |         let _t = t.0;\n LL | |     };\n    | |_____^\n    |\n-   = note: let (t) = (t);\n+   = note: drop(&(t));\n \n error: aborting due to 7 previous errors\n "}, {"sha": "ed5e4ea8be01182e7af538000f9dae4e34869858", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/significant_drop.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/84f0a0a1c6627e83408d1faf46e29d29d2bc13e9/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fsignificant_drop.rs", "raw_url": "https://github.com/rust-lang/rust/raw/84f0a0a1c6627e83408d1faf46e29d29d2bc13e9/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fsignificant_drop.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fsignificant_drop.rs?ref=84f0a0a1c6627e83408d1faf46e29d29d2bc13e9", "patch": "@@ -23,7 +23,7 @@ fn test1_all_need_migration() {\n \n     let c = || {\n     //~^ERROR: drop order affected for closure because of `capture_disjoint_fields`\n-    //~| NOTE: let (t, t1, t2) = (t, t1, t2);\n+    //~| NOTE: drop(&(t, t1, t2));\n         let _t = t.0;\n         let _t1 = t1.0;\n         let _t2 = t2.0;\n@@ -41,7 +41,7 @@ fn test2_only_precise_paths_need_migration() {\n \n     let c = || {\n     //~^ERROR: drop order affected for closure because of `capture_disjoint_fields`\n-    //~| NOTE: let (t, t1) = (t, t1);\n+    //~| NOTE: drop(&(t, t1));\n         let _t = t.0;\n         let _t1 = t1.0;\n         let _t2 = t2;\n@@ -57,7 +57,7 @@ fn test3_only_by_value_need_migration() {\n     let t1 = (Foo(0), Foo(0));\n     let c = || {\n     //~^ERROR: drop order affected for closure because of `capture_disjoint_fields`\n-    //~| NOTE: let (t) = (t);\n+    //~| NOTE: drop(&(t));\n         let _t = t.0;\n         println!(\"{:?}\", t1.1);\n     };\n@@ -74,7 +74,7 @@ fn test4_type_contains_drop_need_migration() {\n \n     let c = || {\n     //~^ERROR: drop order affected for closure because of `capture_disjoint_fields`\n-    //~| NOTE: let (t) = (t);\n+    //~| NOTE: drop(&(t));\n         let _t = t.0;\n     };\n \n@@ -89,7 +89,7 @@ fn test5_drop_non_drop_aggregate_need_migration() {\n \n     let c = || {\n     //~^ERROR: drop order affected for closure because of `capture_disjoint_fields`\n-    //~| NOTE: let (t) = (t);\n+    //~| NOTE: drop(&(t));\n         let _t = t.0;\n     };\n \n@@ -104,7 +104,7 @@ fn test6_significant_insignificant_drop_aggregate_need_migration() {\n \n     let c = || {\n     //~^ERROR: drop order affected for closure because of `capture_disjoint_fields`\n-    //~| NOTE: let (t) = (t);\n+    //~| NOTE: drop(&(t));\n         let _t = t.1;\n     };\n \n@@ -119,7 +119,7 @@ fn test7_move_closures_non_copy_types_might_need_migration() {\n \n     let c = move || {\n     //~^ERROR: drop order affected for closure because of `capture_disjoint_fields`\n-    //~| NOTE: let (t1, t) = (t1, t);\n+    //~| NOTE: drop(&(t1, t));\n         println!(\"{:?} {:?}\", t1.1, t.1);\n     };\n "}, {"sha": "6c21b27b493ba579f3bf69fa9ac31dde94dda3e2", "filename": "src/test/ui/closures/2229_closure_analysis/migrations/significant_drop.stderr", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/84f0a0a1c6627e83408d1faf46e29d29d2bc13e9/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fsignificant_drop.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/84f0a0a1c6627e83408d1faf46e29d29d2bc13e9/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fsignificant_drop.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fclosures%2F2229_closure_analysis%2Fmigrations%2Fsignificant_drop.stderr?ref=84f0a0a1c6627e83408d1faf46e29d29d2bc13e9", "patch": "@@ -16,7 +16,7 @@ note: the lint level is defined here\n    |\n LL | #![deny(disjoint_capture_drop_reorder)]\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-   = note: let (t, t1, t2) = (t, t1, t2);\n+   = note: drop(&(t, t1, t2));\n \n error: drop order affected for closure because of `capture_disjoint_fields`\n   --> $DIR/significant_drop.rs:42:13\n@@ -31,7 +31,7 @@ LL | |         let _t2 = t2;\n LL | |     };\n    | |_____^\n    |\n-   = note: let (t, t1) = (t, t1);\n+   = note: drop(&(t, t1));\n \n error: drop order affected for closure because of `capture_disjoint_fields`\n   --> $DIR/significant_drop.rs:58:13\n@@ -45,7 +45,7 @@ LL | |         println!(\"{:?}\", t1.1);\n LL | |     };\n    | |_____^\n    |\n-   = note: let (t) = (t);\n+   = note: drop(&(t));\n \n error: drop order affected for closure because of `capture_disjoint_fields`\n   --> $DIR/significant_drop.rs:75:13\n@@ -58,7 +58,7 @@ LL | |         let _t = t.0;\n LL | |     };\n    | |_____^\n    |\n-   = note: let (t) = (t);\n+   = note: drop(&(t));\n \n error: drop order affected for closure because of `capture_disjoint_fields`\n   --> $DIR/significant_drop.rs:90:13\n@@ -71,7 +71,7 @@ LL | |         let _t = t.0;\n LL | |     };\n    | |_____^\n    |\n-   = note: let (t) = (t);\n+   = note: drop(&(t));\n \n error: drop order affected for closure because of `capture_disjoint_fields`\n   --> $DIR/significant_drop.rs:105:13\n@@ -84,7 +84,7 @@ LL | |         let _t = t.1;\n LL | |     };\n    | |_____^\n    |\n-   = note: let (t) = (t);\n+   = note: drop(&(t));\n \n error: drop order affected for closure because of `capture_disjoint_fields`\n   --> $DIR/significant_drop.rs:120:13\n@@ -97,7 +97,7 @@ LL | |         println!(\"{:?} {:?}\", t1.1, t.1);\n LL | |     };\n    | |_____^\n    |\n-   = note: let (t1, t) = (t1, t);\n+   = note: drop(&(t1, t));\n \n error: aborting due to 7 previous errors\n "}]}