{"sha": "6e1613a0c534f385e8df4b9a5cffdec29be22972", "node_id": "C_kwDOAAsO6NoAKDZlMTYxM2EwYzUzNGYzODVlOGRmNGI5YTVjZmZkZWMyOWJlMjI5NzI", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-10-28T05:06:45Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-10-28T05:06:45Z"}, "message": "Rollup merge of #103585 - GuillaumeGomez:source-line-css, r=notriddle\n\nMigrate source line numbers CSS to CSS variables\n\nPart of https://github.com/rust-lang/rust/pull/98460.\n\nNo UI changes.\n\nr? ``@notriddle``", "tree": {"sha": "bcb5aec99fc7a011f2af6fb479eb8b449fb9d5c8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bcb5aec99fc7a011f2af6fb479eb8b449fb9d5c8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6e1613a0c534f385e8df4b9a5cffdec29be22972", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjW2NlCRBK7hj4Ov3rIwAAFt8IALNbolGgXbhCy95guQMtZXTG\nhE1OQL7XEOyNYAfW3TcHNXFOYRd2xcS9pr/eJ/+SYrEs6X2gX4Li0htQKUdQX4DN\nQv35lHtkntg1YO2K0mf1eo8e3ThhdmsJ5iYxlPRhztXbcWZZMN5DdBGDy5oWY1q6\nFshZxwgyfKtccbAy5lbMaCPERxVrIPflsed9EgUq/OmJdqcoo9oTO/YYtIPvcHtS\nYH7CL6g36ZybXq6rrLzBCgCt04iv4za9pCcp09jrlZNP+7Aw+CMPHrDT6TQWDPic\nWlxz0+/Lj47GEIvQxWUhhk9ddXUUz81+xsk/60gkDbOQmYc5OSXELMbqNrYvpLE=\n=bt54\n-----END PGP SIGNATURE-----\n", "payload": "tree bcb5aec99fc7a011f2af6fb479eb8b449fb9d5c8\nparent cdd7afeaadf1c48eafb4dff4452439fa5d13a775\nparent 71e824de26189c514150840cae493f596e362f1c\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1666933605 +0200\ncommitter GitHub <noreply@github.com> 1666933605 +0200\n\nRollup merge of #103585 - GuillaumeGomez:source-line-css, r=notriddle\n\nMigrate source line numbers CSS to CSS variables\n\nPart of https://github.com/rust-lang/rust/pull/98460.\n\nNo UI changes.\n\nr? ``@notriddle``\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6e1613a0c534f385e8df4b9a5cffdec29be22972", "html_url": "https://github.com/rust-lang/rust/commit/6e1613a0c534f385e8df4b9a5cffdec29be22972", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6e1613a0c534f385e8df4b9a5cffdec29be22972/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cdd7afeaadf1c48eafb4dff4452439fa5d13a775", "url": "https://api.github.com/repos/rust-lang/rust/commits/cdd7afeaadf1c48eafb4dff4452439fa5d13a775", "html_url": "https://github.com/rust-lang/rust/commit/cdd7afeaadf1c48eafb4dff4452439fa5d13a775"}, {"sha": "71e824de26189c514150840cae493f596e362f1c", "url": "https://api.github.com/repos/rust-lang/rust/commits/71e824de26189c514150840cae493f596e362f1c", "html_url": "https://github.com/rust-lang/rust/commit/71e824de26189c514150840cae493f596e362f1c"}], "stats": {"total": 92, "additions": 60, "deletions": 32}, "files": [{"sha": "c1c37f5b11da20aec75c436001a512788e0fef3d", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/6e1613a0c534f385e8df4b9a5cffdec29be22972/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/6e1613a0c534f385e8df4b9a5cffdec29be22972/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=6e1613a0c534f385e8df4b9a5cffdec29be22972", "patch": "@@ -571,10 +571,18 @@ ul.block, .block li {\n \tpadding: 13px 8px;\n \tborder-top-left-radius: 5px;\n \tborder-bottom-left-radius: 5px;\n+\tborder-color: var(--example-line-numbers-border-color);\n }\n \n .src-line-numbers span {\n \tcursor: pointer;\n+\tcolor: var(--src-line-numbers-span-color);\n+}\n+.src-line-numbers .line-highlighted {\n+\tbackground-color: var(--src-line-number-highlighted-background-color);\n+}\n+.src-line-numbers :target {\n+\tbackground-color: transparent;\n }\n \n .search-loading {"}, {"sha": "fdfdb3e196672560d05b7c55503d2e619e9357a8", "filename": "src/librustdoc/html/static/css/themes/ayu.css", "status": "modified", "additions": 3, "deletions": 9, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/6e1613a0c534f385e8df4b9a5cffdec29be22972/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "raw_url": "https://github.com/rust-lang/rust/raw/6e1613a0c534f385e8df4b9a5cffdec29be22972/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fayu.css?ref=6e1613a0c534f385e8df4b9a5cffdec29be22972", "patch": "@@ -55,6 +55,9 @@ Original by Dempfi (https://github.com/dempfi/ayu)\n \t--code-highlight-question-mark-color: #ff9011;\n \t--code-highlight-comment-color: #788797;\n \t--code-highlight-doc-comment-color: #a1ac88;\n+\t--example-line-numbers-border-color: none;\n+\t--src-line-numbers-span-color: #5c6773;\n+\t--src-line-number-highlighted-background-color: rgba(255, 236, 164, 0.06);\n }\n \n .slider {\n@@ -112,10 +115,8 @@ pre, .rustdoc.source .example-wrap {\n \tcolor: #ff7733;\n }\n \n-.src-line-numbers span { color: #5c6773; }\n .src-line-numbers .line-highlighted {\n \tcolor: #708090;\n-\tbackground-color: rgba(255, 236, 164, 0.06);\n \tpadding-right: 4px;\n \tborder-right: 1px solid #ffb44c;\n }\n@@ -170,13 +171,6 @@ details.rustdoc-toggle > summary::before {\n \tcolor: #788797;\n }\n \n-.src-line-numbers :target { background-color: transparent; }\n-\n-pre.example-line-numbers {\n-\tcolor: #5c67736e;\n-\tborder: none;\n-}\n-\n a.test-arrow {\n \tfont-size: 100%;\n \tcolor: #788797;"}, {"sha": "361d3d4a22597f985247b5f6ca56b67b3d242b04", "filename": "src/librustdoc/html/static/css/themes/dark.css", "status": "modified", "additions": 3, "deletions": 11, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6e1613a0c534f385e8df4b9a5cffdec29be22972/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "raw_url": "https://github.com/rust-lang/rust/raw/6e1613a0c534f385e8df4b9a5cffdec29be22972/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Fdark.css?ref=6e1613a0c534f385e8df4b9a5cffdec29be22972", "patch": "@@ -50,6 +50,9 @@\n \t--code-highlight-question-mark-color: #ff9011;\n \t--code-highlight-comment-color: #8d8d8b;\n \t--code-highlight-doc-comment-color: #8ca375;\n+\t--example-line-numbers-border-color: #4a4949;\n+\t--src-line-numbers-span-color: #3b91e2;\n+\t--src-line-number-highlighted-background-color: #0a042f;\n }\n \n .slider {\n@@ -69,11 +72,6 @@ input:focus + .slider {\n \t\tdrop-shadow(0 -1px 0 #fff)\n }\n \n-.src-line-numbers span { color: #3B91E2; }\n-.src-line-numbers .line-highlighted {\n-\tbackground-color: #0a042f !important;\n-}\n-\n .content .item-info::before { color: #ccc; }\n \n body.source .example-wrap pre.rust a {\n@@ -95,12 +93,6 @@ details.rustdoc-toggle > summary::before {\n \tfilter: invert(69%) sepia(60%) saturate(6613%) hue-rotate(184deg) brightness(100%) contrast(91%);\n }\n \n-.src-line-numbers :target { background-color: transparent; }\n-\n-pre.example-line-numbers {\n-\tborder-color: #4a4949;\n-}\n-\n a.test-arrow {\n \tcolor: #dedede;\n \tbackground-color: rgba(78, 139, 202, 0.2);"}, {"sha": "5eb4bbcf834bbd3dde3f24a70d46fe11295c239b", "filename": "src/librustdoc/html/static/css/themes/light.css", "status": "modified", "additions": 3, "deletions": 11, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/6e1613a0c534f385e8df4b9a5cffdec29be22972/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "raw_url": "https://github.com/rust-lang/rust/raw/6e1613a0c534f385e8df4b9a5cffdec29be22972/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Fthemes%2Flight.css?ref=6e1613a0c534f385e8df4b9a5cffdec29be22972", "patch": "@@ -50,6 +50,9 @@\n \t--code-highlight-question-mark-color: #ff9011;\n \t--code-highlight-comment-color: #8e908c;\n \t--code-highlight-doc-comment-color: #4d4d4c;\n+\t--example-line-numbers-border-color: #c7c7c7;\n+\t--src-line-numbers-span-color: #c67e2d;\n+\t--src-line-number-highlighted-background-color: #fdffd3;\n }\n \n .slider {\n@@ -68,11 +71,6 @@ input:focus + .slider {\n \t */\n }\n \n-.src-line-numbers span { color: #c67e2d; }\n-.src-line-numbers .line-highlighted {\n-\tbackground-color: #FDFFD3 !important;\n-}\n-\n .content .item-info::before { color: #ccc; }\n \n body.source .example-wrap pre.rust a {\n@@ -90,12 +88,6 @@ body.source .example-wrap pre.rust a {\n \tfilter: invert(44%) sepia(18%) saturate(23%) hue-rotate(317deg) brightness(96%) contrast(93%);\n }\n \n-.src-line-numbers :target { background-color: transparent; }\n-\n-pre.example-line-numbers {\n-\tborder-color: #c7c7c7;\n-}\n-\n a.test-arrow {\n \tcolor: #f5f5f5;\n \tbackground-color: rgba(78, 139, 202, 0.2);"}, {"sha": "a2dac2aa681d553058bb1c9397afa492d55533f4", "filename": "src/test/rustdoc-gui/source-code-page.goml", "status": "modified", "additions": 43, "deletions": 1, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/6e1613a0c534f385e8df4b9a5cffdec29be22972/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "raw_url": "https://github.com/rust-lang/rust/raw/6e1613a0c534f385e8df4b9a5cffdec29be22972/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsource-code-page.goml?ref=6e1613a0c534f385e8df4b9a5cffdec29be22972", "patch": "@@ -1,5 +1,6 @@\n // Checks that the interactions with the source code pages are working as expected.\n goto: \"file://\" + |DOC_PATH| + \"/src/test_docs/lib.rs.html\"\n+show-text: true\n // Check that we can click on the line number.\n click: \".src-line-numbers > span:nth-child(4)\" // This is the span for line 4.\n // Ensure that the page URL was updated.\n@@ -12,6 +13,48 @@ assert-attribute: (\".src-line-numbers > span:nth-child(4)\", {\"class\": \"line-high\n assert-attribute: (\".src-line-numbers > span:nth-child(5)\", {\"class\": \"line-highlighted\"})\n assert-attribute: (\".src-line-numbers > span:nth-child(6)\", {\"class\": \"line-highlighted\"})\n assert-attribute-false: (\".src-line-numbers > span:nth-child(7)\", {\"class\": \"line-highlighted\"})\n+\n+define-function: (\n+    \"check-colors\",\n+    (theme, color, background_color, highlight_color, highlight_background_color),\n+    [\n+        (\"local-storage\", {\"rustdoc-theme\": |theme|, \"rustdoc-use-system-theme\": \"false\"}),\n+        (\"reload\"),\n+        (\"assert-css\", (\n+            \".src-line-numbers > span:not(.line-highlighted)\",\n+            {\"color\": |color|, \"background-color\": |background_color|},\n+            ALL,\n+        )),\n+        (\"assert-css\", (\n+            \".src-line-numbers > span.line-highlighted\",\n+            {\"color\": |highlight_color|, \"background-color\": |highlight_background_color|},\n+            ALL,\n+        )),\n+    ],\n+)\n+\n+call-function: (\"check-colors\", {\n+    \"theme\": \"ayu\",\n+    \"color\": \"rgb(92, 103, 115)\",\n+    \"background_color\": \"rgba(0, 0, 0, 0)\",\n+    \"highlight_color\": \"rgb(112, 128, 144)\",\n+    \"highlight_background_color\": \"rgba(255, 236, 164, 0.06)\",\n+})\n+call-function: (\"check-colors\", {\n+    \"theme\": \"dark\",\n+    \"color\": \"rgb(59, 145, 226)\",\n+    \"background_color\": \"rgba(0, 0, 0, 0)\",\n+    \"highlight_color\": \"rgb(59, 145, 226)\",\n+    \"highlight_background_color\": \"rgb(10, 4, 47)\",\n+})\n+call-function: (\"check-colors\", {\n+    \"theme\": \"light\",\n+    \"color\": \"rgb(198, 126, 45)\",\n+    \"background_color\": \"rgba(0, 0, 0, 0)\",\n+    \"highlight_color\": \"rgb(198, 126, 45)\",\n+    \"highlight_background_color\": \"rgb(253, 255, 211)\",\n+})\n+\n // This is to ensure that the content is correctly align with the line numbers.\n compare-elements-position: (\"//*[@id='1']\", \".rust > code > span\", (\"y\"))\n \n@@ -20,7 +63,6 @@ assert-css: (\".src-line-numbers\", {\"text-align\": \"right\"})\n \n // Now let's check that clicking on something else than the line number doesn't\n // do anything (and certainly not add a `#NaN` to the URL!).\n-show-text: true\n goto: \"file://\" + |DOC_PATH| + \"/src/test_docs/lib.rs.html\"\n // We use this assert-position to know where we will click.\n assert-position: (\"//*[@id='1']\", {\"x\": 104, \"y\": 112})"}]}