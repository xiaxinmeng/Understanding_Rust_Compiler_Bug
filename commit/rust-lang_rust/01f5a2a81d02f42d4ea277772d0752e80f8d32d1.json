{"sha": "01f5a2a81d02f42d4ea277772d0752e80f8d32d1", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAxZjVhMmE4MWQwMmY0MmQ0ZWEyNzc3NzJkMDc1MmU4MGY4ZDMyZDE=", "commit": {"author": {"name": "Rich Kadel", "email": "richkadel@google.com", "date": "2021-02-04T00:26:25Z"}, "committer": {"name": "Rich Kadel", "email": "richkadel@google.com", "date": "2021-02-11T19:40:29Z"}, "message": "Ensures `make` tests run under /bin/dash, like CI, and fixes a Makefile\n\nUpdates `tools.mk` to explicitly require `SHELL := /bin/dash`, since CI\nuses `dash` but other environments (including developer local machines)\nmay default to `bash`.\n\nReplaces bash-specific shell command in one Makefile with a\ndash-compatible alternative, and re-enables the affected Makefile test.\n\nRemoves apparently redundant definition of `UNAME`.", "tree": {"sha": "14f776dd90ffe4fab6b8911f3d0aff13afaaef87", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/14f776dd90ffe4fab6b8911f3d0aff13afaaef87"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/01f5a2a81d02f42d4ea277772d0752e80f8d32d1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/01f5a2a81d02f42d4ea277772d0752e80f8d32d1", "html_url": "https://github.com/rust-lang/rust/commit/01f5a2a81d02f42d4ea277772d0752e80f8d32d1", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/01f5a2a81d02f42d4ea277772d0752e80f8d32d1/comments", "author": {"login": "richkadel", "id": 3827298, "node_id": "MDQ6VXNlcjM4MjcyOTg=", "avatar_url": "https://avatars.githubusercontent.com/u/3827298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/richkadel", "html_url": "https://github.com/richkadel", "followers_url": "https://api.github.com/users/richkadel/followers", "following_url": "https://api.github.com/users/richkadel/following{/other_user}", "gists_url": "https://api.github.com/users/richkadel/gists{/gist_id}", "starred_url": "https://api.github.com/users/richkadel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/richkadel/subscriptions", "organizations_url": "https://api.github.com/users/richkadel/orgs", "repos_url": "https://api.github.com/users/richkadel/repos", "events_url": "https://api.github.com/users/richkadel/events{/privacy}", "received_events_url": "https://api.github.com/users/richkadel/received_events", "type": "User", "site_admin": false}, "committer": {"login": "richkadel", "id": 3827298, "node_id": "MDQ6VXNlcjM4MjcyOTg=", "avatar_url": "https://avatars.githubusercontent.com/u/3827298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/richkadel", "html_url": "https://github.com/richkadel", "followers_url": "https://api.github.com/users/richkadel/followers", "following_url": "https://api.github.com/users/richkadel/following{/other_user}", "gists_url": "https://api.github.com/users/richkadel/gists{/gist_id}", "starred_url": "https://api.github.com/users/richkadel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/richkadel/subscriptions", "organizations_url": "https://api.github.com/users/richkadel/orgs", "repos_url": "https://api.github.com/users/richkadel/repos", "events_url": "https://api.github.com/users/richkadel/events{/privacy}", "received_events_url": "https://api.github.com/users/richkadel/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "26e5bcd22025a0d949b76766af76e92ed4434199", "url": "https://api.github.com/repos/rust-lang/rust/commits/26e5bcd22025a0d949b76766af76e92ed4434199", "html_url": "https://github.com/rust-lang/rust/commit/26e5bcd22025a0d949b76766af76e92ed4434199"}], "stats": {"total": 11, "additions": 7, "deletions": 4}, "files": [{"sha": "31583eaa8fee5bacd556d2f9d960512029bfccc6", "filename": "src/test/run-make-fulldeps/coverage-reports/Makefile", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/01f5a2a81d02f42d4ea277772d0752e80f8d32d1/src%2Ftest%2Frun-make-fulldeps%2Fcoverage-reports%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/01f5a2a81d02f42d4ea277772d0752e80f8d32d1/src%2Ftest%2Frun-make-fulldeps%2Fcoverage-reports%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fcoverage-reports%2FMakefile?ref=01f5a2a81d02f42d4ea277772d0752e80f8d32d1", "patch": "@@ -1,4 +1,3 @@\n-# ignore-test Broken; accidentally silently ignored on Linux CI; FIXME(#81688)\n # needs-profiler-support\n # ignore-windows-gnu\n # min-llvm-version: 11.0\n@@ -128,7 +127,7 @@ endif\n \t\t\t$$( \\\n \t\t\t\tfor file in $(TMPDIR)/rustdoc-$@/*/rust_out; \\\n \t\t\t\tdo \\\n-\t\t\t\t[[ -x $$file ]] && printf \"%s %s \" -object $$file; \\\n+\t\t\t\t[ -x \"$$file\" ] && printf \"%s %s \" -object $$file; \\\n \t\t\t\tdone \\\n \t\t\t) \\\n \t\t2> \"$(TMPDIR)\"/show_coverage_stderr.$@.txt \\"}, {"sha": "38643aaf9021e383d8129ebdec669631bc8c8f41", "filename": "src/test/run-make-fulldeps/coverage/coverage_tools.mk", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/01f5a2a81d02f42d4ea277772d0752e80f8d32d1/src%2Ftest%2Frun-make-fulldeps%2Fcoverage%2Fcoverage_tools.mk", "raw_url": "https://github.com/rust-lang/rust/raw/01f5a2a81d02f42d4ea277772d0752e80f8d32d1/src%2Ftest%2Frun-make-fulldeps%2Fcoverage%2Fcoverage_tools.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fcoverage%2Fcoverage_tools.mk?ref=01f5a2a81d02f42d4ea277772d0752e80f8d32d1", "patch": "@@ -12,5 +12,3 @@\n # Enabling `-C link-dead-code` is not necessary when compiling with `-Z instrument-coverage`,\n # due to improvements in the coverage map generation, to add unreachable functions known to Rust.\n # Therefore, `-C link-dead-code` is no longer automatically enabled.\n-\n-UNAME = $(shell uname)"}, {"sha": "29ca30a7cd89bc12e380aae94f939812e3ce8a4e", "filename": "src/test/run-make-fulldeps/tools.mk", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/01f5a2a81d02f42d4ea277772d0752e80f8d32d1/src%2Ftest%2Frun-make-fulldeps%2Ftools.mk", "raw_url": "https://github.com/rust-lang/rust/raw/01f5a2a81d02f42d4ea277772d0752e80f8d32d1/src%2Ftest%2Frun-make-fulldeps%2Ftools.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Ftools.mk?ref=01f5a2a81d02f42d4ea277772d0752e80f8d32d1", "patch": "@@ -21,6 +21,12 @@ CGREP := \"$(S)/src/etc/cat-and-grep.sh\"\n # diff with common flags for multi-platform diffs against text output\n DIFF := diff -u --strip-trailing-cr\n \n+# CI platforms use `/bin/dash`. When compiling in other environments, the\n+# default may be different (for example, may default to `/bin/bash`), and syntax\n+# and results could be different. Ensure Makefile `$(shell ...)` invocations\n+# always run in `dash`.\n+SHELL := /bin/dash\n+\n # This is the name of the binary we will generate and run; use this\n # e.g. for `$(CC) -o $(RUN_BINFILE)`.\n RUN_BINFILE = $(TMPDIR)/$(1)"}]}