{"sha": "8b9700898bb65620e8e5d00f268d42598525ab59", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhiOTcwMDg5OGJiNjU2MjBlOGU1ZDAwZjI2OGQ0MjU5ODUyNWFiNTk=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2016-08-05T14:12:59Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-08-05T14:12:59Z"}, "message": "Rollup merge of #35328 - trixnz:update-error-62, r=jonathandturner\n\nUpdate error format for E0062\n\nFixes #35217 as part of #35233\n\nThere seems to be an issue with the old format ignoring the labels which results in the incorrect line being rendered in the old format. I spoke with @jonathandturner about this and it seems to be a bug. Pertinent information [here](https://gist.github.com/trixnz/ad11e68687529e164427df8f8eb63116).\n\nr? @jonathandturner", "tree": {"sha": "b1d7135be1c1158caf5a5bdd3547412f9fe9de0a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b1d7135be1c1158caf5a5bdd3547412f9fe9de0a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8b9700898bb65620e8e5d00f268d42598525ab59", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8b9700898bb65620e8e5d00f268d42598525ab59", "html_url": "https://github.com/rust-lang/rust/commit/8b9700898bb65620e8e5d00f268d42598525ab59", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8b9700898bb65620e8e5d00f268d42598525ab59/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "31da06bebb721b7c1d93bf7e4802b95852acca4f", "url": "https://api.github.com/repos/rust-lang/rust/commits/31da06bebb721b7c1d93bf7e4802b95852acca4f", "html_url": "https://github.com/rust-lang/rust/commit/31da06bebb721b7c1d93bf7e4802b95852acca4f"}, {"sha": "0214ec248b2835a17c845c742d0e7697262ca72e", "url": "https://api.github.com/repos/rust-lang/rust/commits/0214ec248b2835a17c845c742d0e7697262ca72e", "html_url": "https://github.com/rust-lang/rust/commit/0214ec248b2835a17c845c742d0e7697262ca72e"}], "stats": {"total": 24, "additions": 20, "deletions": 4}, "files": [{"sha": "97788c9fb33997e8c8dd54e23d98a462708647d4", "filename": "src/librustc_typeck/check/mod.rs", "status": "modified", "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/8b9700898bb65620e8e5d00f268d42598525ab59/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8b9700898bb65620e8e5d00f268d42598525ab59/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fmod.rs?ref=8b9700898bb65620e8e5d00f268d42598525ab59", "patch": "@@ -3069,6 +3069,8 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n             remaining_fields.insert(field.name, field);\n         }\n \n+        let mut seen_fields = FnvHashMap();\n+\n         let mut error_happened = false;\n \n         // Typecheck each field.\n@@ -3077,13 +3079,25 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n \n             if let Some(v_field) = remaining_fields.remove(&field.name.node) {\n                 expected_field_type = self.field_ty(field.span, v_field, substs);\n+\n+                seen_fields.insert(field.name.node, field.span);\n             } else {\n                 error_happened = true;\n                 expected_field_type = tcx.types.err;\n                 if let Some(_) = variant.find_field_named(field.name.node) {\n-                    span_err!(self.tcx.sess, field.name.span, E0062,\n-                        \"field `{}` specified more than once\",\n-                        field.name.node);\n+                    let mut err = struct_span_err!(self.tcx.sess,\n+                                                field.name.span,\n+                                                E0062,\n+                                                \"field `{}` specified more than once\",\n+                                                field.name.node);\n+\n+                    err.span_label(field.name.span, &format!(\"used more than once\"));\n+\n+                    if let Some(prev_span) = seen_fields.get(&field.name.node) {\n+                        err.span_label(*prev_span, &format!(\"first use of `{}`\", field.name.node));\n+                    }\n+\n+                    err.emit();\n                 } else {\n                     self.report_unknown_field(adt_ty, variant, field, ast_fields);\n                 }"}, {"sha": "822d93e52d588c5688a7ecc759dd023b9ee5cf1d", "filename": "src/test/compile-fail/E0062.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/8b9700898bb65620e8e5d00f268d42598525ab59/src%2Ftest%2Fcompile-fail%2FE0062.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8b9700898bb65620e8e5d00f268d42598525ab59/src%2Ftest%2Fcompile-fail%2FE0062.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2FE0062.rs?ref=8b9700898bb65620e8e5d00f268d42598525ab59", "patch": "@@ -14,7 +14,9 @@ struct Foo {\n \n fn main() {\n     let x = Foo {\n+        x: 0, //~ NOTE first use of `x`\n         x: 0,\n-        x: 0, //~ ERROR E0062\n+        //~^ ERROR E0062\n+        //~| NOTE used more than once\n     };\n }"}]}