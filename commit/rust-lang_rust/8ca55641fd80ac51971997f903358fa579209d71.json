{"sha": "8ca55641fd80ac51971997f903358fa579209d71", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhjYTU1NjQxZmQ4MGFjNTE5NzE5OTdmOTAzMzU4ZmE1NzkyMDlkNzE=", "commit": {"author": {"name": "varkor", "email": "github@varkor.com", "date": "2020-01-10T13:31:36Z"}, "committer": {"name": "varkor", "email": "github@varkor.com", "date": "2020-01-10T13:31:36Z"}, "message": "Clarify suggestion for E0013", "tree": {"sha": "ce15e75d3207f2c927ff1d14b699ad757951ca08", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ce15e75d3207f2c927ff1d14b699ad757951ca08"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8ca55641fd80ac51971997f903358fa579209d71", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8ca55641fd80ac51971997f903358fa579209d71", "html_url": "https://github.com/rust-lang/rust/commit/8ca55641fd80ac51971997f903358fa579209d71", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8ca55641fd80ac51971997f903358fa579209d71/comments", "author": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2d8d559bbecf6272eb41f8a800e319238aa9d621", "url": "https://api.github.com/repos/rust-lang/rust/commits/2d8d559bbecf6272eb41f8a800e319238aa9d621", "html_url": "https://github.com/rust-lang/rust/commit/2d8d559bbecf6272eb41f8a800e319238aa9d621"}], "stats": {"total": 51, "additions": 35, "deletions": 16}, "files": [{"sha": "e41880928275071b34a73b6e81b550e4932e4234", "filename": "src/librustc_mir/transform/check_consts/ops.rs", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/8ca55641fd80ac51971997f903358fa579209d71/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fops.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8ca55641fd80ac51971997f903358fa579209d71/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fops.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fcheck_consts%2Fops.rs?ref=8ca55641fd80ac51971997f903358fa579209d71", "patch": "@@ -350,16 +350,18 @@ impl NonConstOp for StaticAccess {\n             item.tcx.sess,\n             span,\n             E0013,\n-            \"{}s cannot refer to statics, use \\\n-                                        a constant instead\",\n+            \"{}s cannot refer to statics\",\n             item.const_kind()\n         );\n+        err.help(\n+            \"consider extracting the value of the `static` to a `const`, and referring to that\",\n+        );\n         if item.tcx.sess.teach(&err.get_code().unwrap()) {\n             err.note(\n-                \"Static and const variables can refer to other const variables. \\\n-                    But a const variable cannot refer to a static variable.\",\n+                \"`static` and `const` variables can refer to other `const` variables. \\\n+                    A `const` variable, however, cannot refer to a `static` variable.\",\n             );\n-            err.help(\"To fix this, the value can be extracted as a const and then used.\");\n+            err.help(\"To fix this, the value can be extracted to a `const` and then used.\");\n         }\n         err.emit();\n     }"}, {"sha": "df793d7dd7ec947a4833a7e8d1dd4eb44f60b36c", "filename": "src/test/ui/consts/const-fn-not-safe-for-const.stderr", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8ca55641fd80ac51971997f903358fa579209d71/src%2Ftest%2Fui%2Fconsts%2Fconst-fn-not-safe-for-const.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8ca55641fd80ac51971997f903358fa579209d71/src%2Ftest%2Fui%2Fconsts%2Fconst-fn-not-safe-for-const.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fconst-fn-not-safe-for-const.stderr?ref=8ca55641fd80ac51971997f903358fa579209d71", "patch": "@@ -4,17 +4,21 @@ error[E0015]: calls in constant functions are limited to constant functions, tup\n LL |     random()\n    |     ^^^^^^^^\n \n-error[E0013]: constant functions cannot refer to statics, use a constant instead\n+error[E0013]: constant functions cannot refer to statics\n   --> $DIR/const-fn-not-safe-for-const.rs:20:5\n    |\n LL |     Y\n    |     ^\n+   |\n+   = help: consider extracting the value of the `static` to a `const`, and referring to that\n \n-error[E0013]: constant functions cannot refer to statics, use a constant instead\n+error[E0013]: constant functions cannot refer to statics\n   --> $DIR/const-fn-not-safe-for-const.rs:25:6\n    |\n LL |     &Y\n    |      ^\n+   |\n+   = help: consider extracting the value of the `static` to a `const`, and referring to that\n \n error: aborting due to 3 previous errors\n "}, {"sha": "e45d8b6c740e0cf909ee28051d982cb8cc070fc9", "filename": "src/test/ui/issues/issue-17718-const-bad-values.stderr", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/8ca55641fd80ac51971997f903358fa579209d71/src%2Ftest%2Fui%2Fissues%2Fissue-17718-const-bad-values.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8ca55641fd80ac51971997f903358fa579209d71/src%2Ftest%2Fui%2Fissues%2Fissue-17718-const-bad-values.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-17718-const-bad-values.stderr?ref=8ca55641fd80ac51971997f903358fa579209d71", "patch": "@@ -7,17 +7,21 @@ LL | const C1: &'static mut [usize] = &mut [];\n    = note: for more information, see https://github.com/rust-lang/rust/issues/57349\n    = help: add `#![feature(const_mut_refs)]` to the crate attributes to enable\n \n-error[E0013]: constants cannot refer to statics, use a constant instead\n+error[E0013]: constants cannot refer to statics\n   --> $DIR/issue-17718-const-bad-values.rs:5:46\n    |\n LL | const C2: &'static mut usize = unsafe { &mut S };\n    |                                              ^\n+   |\n+   = help: consider extracting the value of the `static` to a `const`, and referring to that\n \n-error[E0013]: constants cannot refer to statics, use a constant instead\n+error[E0013]: constants cannot refer to statics\n   --> $DIR/issue-17718-const-bad-values.rs:5:46\n    |\n LL | const C2: &'static mut usize = unsafe { &mut S };\n    |                                              ^\n+   |\n+   = help: consider extracting the value of the `static` to a `const`, and referring to that\n \n error[E0658]: references in constants may only refer to immutable values\n   --> $DIR/issue-17718-const-bad-values.rs:5:41"}, {"sha": "e3c3b369ffb320418a9df9558aa176d1ee1ae0eb", "filename": "src/test/ui/issues/issue-17718-references.stderr", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/8ca55641fd80ac51971997f903358fa579209d71/src%2Ftest%2Fui%2Fissues%2Fissue-17718-references.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8ca55641fd80ac51971997f903358fa579209d71/src%2Ftest%2Fui%2Fissues%2Fissue-17718-references.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-17718-references.stderr?ref=8ca55641fd80ac51971997f903358fa579209d71", "patch": "@@ -1,20 +1,26 @@\n-error[E0013]: constants cannot refer to statics, use a constant instead\n+error[E0013]: constants cannot refer to statics\n   --> $DIR/issue-17718-references.rs:9:29\n    |\n LL | const T2: &'static usize = &S;\n    |                             ^\n+   |\n+   = help: consider extracting the value of the `static` to a `const`, and referring to that\n \n-error[E0013]: constants cannot refer to statics, use a constant instead\n+error[E0013]: constants cannot refer to statics\n   --> $DIR/issue-17718-references.rs:14:19\n    |\n LL | const T6: usize = S;\n    |                   ^\n+   |\n+   = help: consider extracting the value of the `static` to a `const`, and referring to that\n \n-error[E0013]: constants cannot refer to statics, use a constant instead\n+error[E0013]: constants cannot refer to statics\n   --> $DIR/issue-17718-references.rs:19:33\n    |\n LL | const T10: Struct = Struct { a: S };\n    |                                 ^\n+   |\n+   = help: consider extracting the value of the `static` to a `const`, and referring to that\n \n error: aborting due to 3 previous errors\n "}, {"sha": "f712a2eedb7e9cdb095ad83c20fb752ee11ba689", "filename": "src/test/ui/issues/issue-18118-2.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/8ca55641fd80ac51971997f903358fa579209d71/src%2Ftest%2Fui%2Fissues%2Fissue-18118-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8ca55641fd80ac51971997f903358fa579209d71/src%2Ftest%2Fui%2Fissues%2Fissue-18118-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-18118-2.rs?ref=8ca55641fd80ac51971997f903358fa579209d71", "patch": "@@ -1,7 +1,6 @@\n pub fn main() {\n     const z: &'static isize = {\n         static p: isize = 3;\n-        &p\n-        //~^ ERROR constants cannot refer to statics, use a constant instead\n+        &p //~ ERROR constants cannot refer to statics\n     };\n }"}, {"sha": "4fc3ca78f961c4e086df6ec297d38f5f22883c55", "filename": "src/test/ui/issues/issue-18118-2.stderr", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/8ca55641fd80ac51971997f903358fa579209d71/src%2Ftest%2Fui%2Fissues%2Fissue-18118-2.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8ca55641fd80ac51971997f903358fa579209d71/src%2Ftest%2Fui%2Fissues%2Fissue-18118-2.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-18118-2.stderr?ref=8ca55641fd80ac51971997f903358fa579209d71", "patch": "@@ -1,8 +1,10 @@\n-error[E0013]: constants cannot refer to statics, use a constant instead\n+error[E0013]: constants cannot refer to statics\n   --> $DIR/issue-18118-2.rs:4:10\n    |\n LL |         &p\n    |          ^\n+   |\n+   = help: consider extracting the value of the `static` to a `const`, and referring to that\n \n error: aborting due to previous error\n "}, {"sha": "502825e9766e3d90af04bd09c311cdfccecbdc26", "filename": "src/test/ui/issues/issue-52060.stderr", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/8ca55641fd80ac51971997f903358fa579209d71/src%2Ftest%2Fui%2Fissues%2Fissue-52060.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8ca55641fd80ac51971997f903358fa579209d71/src%2Ftest%2Fui%2Fissues%2Fissue-52060.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissues%2Fissue-52060.stderr?ref=8ca55641fd80ac51971997f903358fa579209d71", "patch": "@@ -1,8 +1,10 @@\n-error[E0013]: constants cannot refer to statics, use a constant instead\n+error[E0013]: constants cannot refer to statics\n   --> $DIR/issue-52060.rs:4:26\n    |\n LL | static B: [u32; 1] = [0; A.len()];\n    |                          ^\n+   |\n+   = help: consider extracting the value of the `static` to a `const`, and referring to that\n \n error[E0080]: evaluation of constant value failed\n   --> $DIR/issue-52060.rs:4:26"}]}