{"sha": "6985d13a9783bb7181b6c43e83465e7630e48ec2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY5ODVkMTNhOTc4M2JiNzE4MWI2YzQzZTgzNDY1ZTc2MzBlNDhlYzI=", "commit": {"author": {"name": "ThibsG", "email": "thibsg@pm.me", "date": "2021-03-28T07:35:44Z"}, "committer": {"name": "ThibsG", "email": "thibsg@pm.me", "date": "2021-03-28T07:37:59Z"}, "message": "Take into account sub modules", "tree": {"sha": "2b801783e88209dfcb4342260223c72b7c82138e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2b801783e88209dfcb4342260223c72b7c82138e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/6985d13a9783bb7181b6c43e83465e7630e48ec2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/6985d13a9783bb7181b6c43e83465e7630e48ec2", "html_url": "https://github.com/rust-lang/rust/commit/6985d13a9783bb7181b6c43e83465e7630e48ec2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/6985d13a9783bb7181b6c43e83465e7630e48ec2/comments", "author": {"login": "ThibsG", "id": 12683889, "node_id": "MDQ6VXNlcjEyNjgzODg5", "avatar_url": "https://avatars.githubusercontent.com/u/12683889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThibsG", "html_url": "https://github.com/ThibsG", "followers_url": "https://api.github.com/users/ThibsG/followers", "following_url": "https://api.github.com/users/ThibsG/following{/other_user}", "gists_url": "https://api.github.com/users/ThibsG/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThibsG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThibsG/subscriptions", "organizations_url": "https://api.github.com/users/ThibsG/orgs", "repos_url": "https://api.github.com/users/ThibsG/repos", "events_url": "https://api.github.com/users/ThibsG/events{/privacy}", "received_events_url": "https://api.github.com/users/ThibsG/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ThibsG", "id": 12683889, "node_id": "MDQ6VXNlcjEyNjgzODg5", "avatar_url": "https://avatars.githubusercontent.com/u/12683889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThibsG", "html_url": "https://github.com/ThibsG", "followers_url": "https://api.github.com/users/ThibsG/followers", "following_url": "https://api.github.com/users/ThibsG/following{/other_user}", "gists_url": "https://api.github.com/users/ThibsG/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThibsG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThibsG/subscriptions", "organizations_url": "https://api.github.com/users/ThibsG/orgs", "repos_url": "https://api.github.com/users/ThibsG/repos", "events_url": "https://api.github.com/users/ThibsG/events{/privacy}", "received_events_url": "https://api.github.com/users/ThibsG/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1768efa33344022c550f3cfcd30ede168bcf3143", "url": "https://api.github.com/repos/rust-lang/rust/commits/1768efa33344022c550f3cfcd30ede168bcf3143", "html_url": "https://github.com/rust-lang/rust/commit/1768efa33344022c550f3cfcd30ede168bcf3143"}], "stats": {"total": 44, "additions": 34, "deletions": 10}, "files": [{"sha": "901f7642a127102017c5a33fb66f15c303e86596", "filename": "clippy_lints/src/single_component_path_imports.rs", "status": "modified", "additions": 15, "deletions": 9, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/6985d13a9783bb7181b6c43e83465e7630e48ec2/clippy_lints%2Fsrc%2Fsingle_component_path_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6985d13a9783bb7181b6c43e83465e7630e48ec2/clippy_lints%2Fsrc%2Fsingle_component_path_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fsingle_component_path_imports.rs?ref=6985d13a9783bb7181b6c43e83465e7630e48ec2", "patch": "@@ -1,7 +1,6 @@\n use clippy_utils::diagnostics::span_lint_and_sugg;\n use clippy_utils::in_macro;\n-use if_chain::if_chain;\n-use rustc_ast::{Crate, Item, ItemKind, UseTreeKind};\n+use rustc_ast::{Crate, Item, ItemKind, ModKind, UseTreeKind};\n use rustc_errors::Applicability;\n use rustc_lint::{EarlyContext, EarlyLintPass};\n use rustc_session::{declare_tool_lint, impl_lint_pass};\n@@ -83,13 +82,19 @@ impl EarlyLintPass for SingleComponentPathImports {\n \n impl SingleComponentPathImports {\n     fn track_uses(&mut self, item: &Item) {\n-        if_chain! {\n-            if !in_macro(item.span);\n-            if !item.vis.kind.is_pub();\n-            if let ItemKind::Use(use_tree) = &item.kind;\n-            if let segments = &use_tree.prefix.segments;\n+        if in_macro(item.span) || item.vis.kind.is_pub() {\n+            return;\n+        }\n+\n+        match &item.kind {\n+            ItemKind::Mod(_, ModKind::Loaded(ref items, ..)) => {\n+                for item in items.iter() {\n+                    self.track_uses(&item);\n+                }\n+            },\n+            ItemKind::Use(use_tree) => {\n+                let segments = &use_tree.prefix.segments;\n \n-            then {\n                 // keep track of `use some_module;` usages\n                 if segments.len() == 1 {\n                     if let UseTreeKind::Simple(None, _, _) = use_tree.kind {\n@@ -117,7 +122,8 @@ impl SingleComponentPathImports {\n                         }\n                     }\n                 }\n-            }\n+            },\n+            _ => {},\n         }\n     }\n }"}, {"sha": "226d2b315d7a3a51faee9848c755376987700cc1", "filename": "tests/ui/single_component_path_imports.fixed", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6985d13a9783bb7181b6c43e83465e7630e48ec2/tests%2Fui%2Fsingle_component_path_imports.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/6985d13a9783bb7181b6c43e83465e7630e48ec2/tests%2Fui%2Fsingle_component_path_imports.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_component_path_imports.fixed?ref=6985d13a9783bb7181b6c43e83465e7630e48ec2", "patch": "@@ -19,3 +19,9 @@ fn main() {\n     // False positive #5154, shouldn't trigger lint.\n     m!();\n }\n+\n+mod hello_mod {\n+    \n+    #[allow(dead_code)]\n+    fn hello_mod() {}\n+}"}, {"sha": "88bf7f1fc5ab01871af24e6dfab4310228ae3d1a", "filename": "tests/ui/single_component_path_imports.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/6985d13a9783bb7181b6c43e83465e7630e48ec2/tests%2Fui%2Fsingle_component_path_imports.rs", "raw_url": "https://github.com/rust-lang/rust/raw/6985d13a9783bb7181b6c43e83465e7630e48ec2/tests%2Fui%2Fsingle_component_path_imports.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_component_path_imports.rs?ref=6985d13a9783bb7181b6c43e83465e7630e48ec2", "patch": "@@ -19,3 +19,9 @@ fn main() {\n     // False positive #5154, shouldn't trigger lint.\n     m!();\n }\n+\n+mod hello_mod {\n+    use regex;\n+    #[allow(dead_code)]\n+    fn hello_mod() {}\n+}"}, {"sha": "646e6d3647acc57d1c951c11b0dde00777638333", "filename": "tests/ui/single_component_path_imports.stderr", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/6985d13a9783bb7181b6c43e83465e7630e48ec2/tests%2Fui%2Fsingle_component_path_imports.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/6985d13a9783bb7181b6c43e83465e7630e48ec2/tests%2Fui%2Fsingle_component_path_imports.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fsingle_component_path_imports.stderr?ref=6985d13a9783bb7181b6c43e83465e7630e48ec2", "patch": "@@ -6,5 +6,11 @@ LL | use regex;\n    |\n    = note: `-D clippy::single-component-path-imports` implied by `-D warnings`\n \n-error: aborting due to previous error\n+error: this import is redundant\n+  --> $DIR/single_component_path_imports.rs:24:5\n+   |\n+LL |     use regex;\n+   |     ^^^^^^^^^^ help: remove it entirely\n+\n+error: aborting due to 2 previous errors\n "}]}