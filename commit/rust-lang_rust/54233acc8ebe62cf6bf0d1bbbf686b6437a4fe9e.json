{"sha": "54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU0MjMzYWNjOGViZTYyY2Y2YmYwZDFiYmJmNjg2YjY0MzdhNGZlOWU=", "commit": {"author": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-06-17T07:56:54Z"}, "committer": {"name": "topecongiro", "email": "seuchida@gmail.com", "date": "2017-06-17T07:56:54Z"}, "message": "Format source codes", "tree": {"sha": "45781c0db9b762b57fada536e767114edab6834a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/45781c0db9b762b57fada536e767114edab6834a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e", "html_url": "https://github.com/rust-lang/rust/commit/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "92634a8f69ed3d11c70ed0e0a0e406a0e5511149", "url": "https://api.github.com/repos/rust-lang/rust/commits/92634a8f69ed3d11c70ed0e0a0e406a0e5511149", "html_url": "https://github.com/rust-lang/rust/commit/92634a8f69ed3d11c70ed0e0a0e406a0e5511149"}], "stats": {"total": 217, "additions": 99, "deletions": 118}, "files": [{"sha": "9b27c92c270a6306d7e0bca1117ca9b7324bf32d", "filename": "src/chains.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Fchains.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Fchains.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fchains.rs?ref=54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e", "patch": "@@ -183,10 +183,9 @@ pub fn rewrite_chain(expr: &ast::Expr, context: &RewriteContext, shape: Shape) -\n \n     // Total of all items excluding the last.\n     let last_non_try_index = rewrites.len() - (1 + trailing_try_num);\n-    let almost_total = rewrites[..last_non_try_index].iter().fold(\n-        0,\n-        |a, b| a + first_line_width(b),\n-    ) + parent_rewrite.len();\n+    let almost_total = rewrites[..last_non_try_index]\n+        .iter()\n+        .fold(0, |a, b| a + first_line_width(b)) + parent_rewrite.len();\n     let one_line_len = rewrites.iter().fold(0, |a, r| a + first_line_width(r)) +\n         parent_rewrite.len();\n "}, {"sha": "d8189df363cbd0597f040f52a0ce1c192bf5cf63", "filename": "src/comment.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Fcomment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Fcomment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomment.rs?ref=54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e", "patch": "@@ -45,10 +45,9 @@ pub enum CommentStyle<'a> {\n \n fn custom_opener(s: &str) -> &str {\n     s.lines().next().map_or(\"\", |first_line| {\n-        first_line.find(' ').map_or(\n-            first_line,\n-            |space_index| &first_line[0..space_index + 1],\n-        )\n+        first_line\n+            .find(' ')\n+            .map_or(first_line, |space_index| &first_line[0..space_index + 1])\n     })\n }\n "}, {"sha": "b69e8bbd42eaf4b6b5472b7322c494098429139f", "filename": "src/expr.rs", "status": "modified", "additions": 22, "deletions": 33, "changes": 55, "blob_url": "https://github.com/rust-lang/rust/blob/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e", "patch": "@@ -1077,10 +1077,8 @@ impl<'a> ControlFlow<'a> {\n \n             let new_width = try_opt!(new_width.checked_sub(if_str.len()));\n             let else_expr = &else_node.stmts[0];\n-            let else_str = try_opt!(else_expr.rewrite(\n-                context,\n-                Shape::legacy(new_width, Indent::empty()),\n-            ));\n+            let else_str =\n+                try_opt!(else_expr.rewrite(context, Shape::legacy(new_width, Indent::empty())));\n \n             if if_str.contains('\\n') || else_str.contains('\\n') {\n                 return None;\n@@ -1298,19 +1296,17 @@ impl<'a> Rewrite for ControlFlow<'a> {\n \n             let between_kwd_else_block = mk_sp(\n                 self.block.span.hi,\n-                context.codemap.span_before(\n-                    mk_sp(self.block.span.hi, else_block.span.lo),\n-                    \"else\",\n-                ),\n+                context\n+                    .codemap\n+                    .span_before(mk_sp(self.block.span.hi, else_block.span.lo), \"else\"),\n             );\n             let between_kwd_else_block_comment =\n                 extract_comment(between_kwd_else_block, context, shape);\n \n             let after_else = mk_sp(\n-                context.codemap.span_after(\n-                    mk_sp(self.block.span.hi, else_block.span.lo),\n-                    \"else\",\n-                ),\n+                context\n+                    .codemap\n+                    .span_after(mk_sp(self.block.span.hi, else_block.span.lo), \"else\"),\n                 else_block.span.lo,\n             );\n             let after_else_comment = extract_comment(after_else, context, shape);\n@@ -1328,10 +1324,9 @@ impl<'a> Rewrite for ControlFlow<'a> {\n                 write!(\n                     &mut result,\n                     \"{}else{}\",\n-                    between_kwd_else_block_comment.as_ref().map_or(\n-                        between_sep,\n-                        |s| &**s,\n-                    ),\n+                    between_kwd_else_block_comment\n+                        .as_ref()\n+                        .map_or(between_sep, |s| &**s),\n                     after_else_comment.as_ref().map_or(after_sep, |s| &**s)\n                 ).ok()\n             );\n@@ -1478,10 +1473,9 @@ fn rewrite_match(\n \n     let arm_indent_str = arm_shape.indent.to_string(context.config);\n \n-    let open_brace_pos = context.codemap.span_after(\n-        mk_sp(cond.span.hi, arm_start_pos(&arms[0])),\n-        \"{\",\n-    );\n+    let open_brace_pos = context\n+        .codemap\n+        .span_after(mk_sp(cond.span.hi, arm_start_pos(&arms[0])), \"{\");\n \n     for (i, arm) in arms.iter().enumerate() {\n         // Make sure we get the stuff between arms.\n@@ -2051,10 +2045,8 @@ where\n \n fn need_block_indent(s: &str, shape: Shape) -> bool {\n     s.lines().skip(1).any(|s| {\n-        s.find(|c| !char::is_whitespace(c)).map_or(\n-            false,\n-            |w| w + 1 < shape.indent.width(),\n-        )\n+        s.find(|c| !char::is_whitespace(c))\n+            .map_or(false, |w| w + 1 < shape.indent.width())\n     })\n }\n \n@@ -2271,10 +2263,8 @@ fn can_be_overflowed<'a, T>(context: &RewriteContext, args: &[&T]) -> bool\n where\n     T: Rewrite + Spanned + ToExpr + 'a,\n {\n-    args.last().map_or(\n-        false,\n-        |x| x.can_be_overflowed(context, args.len()),\n-    )\n+    args.last()\n+        .map_or(false, |x| x.can_be_overflowed(context, args.len()))\n }\n \n pub fn can_be_overflowed_expr(context: &RewriteContext, expr: &ast::Expr, args_len: usize) -> bool {\n@@ -2541,10 +2531,9 @@ fn rewrite_field(context: &RewriteContext, field: &ast::Field, shape: Shape) ->\n             Some(e) => Some(format!(\"{}{}{}{}\", attrs_str, name, separator, e)),\n             None => {\n                 let expr_offset = shape.indent.block_indent(context.config);\n-                let expr = field.expr.rewrite(\n-                    context,\n-                    Shape::indented(expr_offset, context.config),\n-                );\n+                let expr = field\n+                    .expr\n+                    .rewrite(context, Shape::indented(expr_offset, context.config));\n                 expr.map(|s| {\n                     format!(\n                         \"{}{}:\\n{}{}\",\n@@ -2729,7 +2718,7 @@ pub fn rewrite_assign_rhs<S: Into<String>>(\n             0\n         };\n     // 1 = space between operator and rhs.\n-    let orig_shape = try_opt!(shape.block_indent(0).offset_left(last_line_width + 1));\n+    let orig_shape = try_opt!(shape.offset_left(last_line_width + 1));\n     let rhs = match ex.node {\n         ast::ExprKind::Mac(ref mac) => {\n             match rewrite_macro(mac, None, context, orig_shape, MacroPosition::Expression) {"}, {"sha": "40d57ac45d7a9e8c42efc71dfcb0ec7c53ba70d5", "filename": "src/items.rs", "status": "modified", "additions": 42, "deletions": 44, "changes": 86, "blob_url": "https://github.com/rust-lang/rust/blob/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e", "patch": "@@ -488,10 +488,12 @@ impl<'a> FmtVisitor<'a> {\n \n         let context = self.get_context();\n         let indent = self.block_indent;\n-        let mut result = try_opt!(field.node.attrs.rewrite(\n-            &context,\n-            Shape::indented(indent, self.config),\n-        ));\n+        let mut result = try_opt!(\n+            field\n+                .node\n+                .attrs\n+                .rewrite(&context, Shape::indented(indent, self.config))\n+        );\n         if !result.is_empty() {\n             let shape = Shape {\n                 width: context.config.max_width(),\n@@ -1436,10 +1438,10 @@ impl Rewrite for ast::StructField {\n \n         let name = self.ident;\n         let vis = format_visibility(&self.vis);\n-        let mut attr_str = try_opt!(self.attrs.rewrite(\n-            context,\n-            Shape::indented(shape.indent, context.config),\n-        ));\n+        let mut attr_str = try_opt!(\n+            self.attrs\n+                .rewrite(context, Shape::indented(shape.indent, context.config))\n+        );\n         // Try format missing comments after attributes\n         let missing_comment = if !self.attrs.is_empty() {\n             rewrite_missing_comment_on_field(\n@@ -1470,10 +1472,8 @@ impl Rewrite for ast::StructField {\n \n         let type_offset = shape.indent.block_indent(context.config);\n         let rewrite_type_in_next_line = || {\n-            self.ty.rewrite(\n-                context,\n-                Shape::indented(type_offset, context.config),\n-            )\n+            self.ty\n+                .rewrite(context, Shape::indented(type_offset, context.config))\n         };\n \n         let last_line_width = last_line_width(&result) + type_annotation_spacing.1.len();\n@@ -1670,10 +1670,10 @@ fn is_empty_infer(context: &RewriteContext, ty: &ast::Ty) -> bool {\n impl Rewrite for ast::Arg {\n     fn rewrite(&self, context: &RewriteContext, shape: Shape) -> Option<String> {\n         if is_named_arg(self) {\n-            let mut result = try_opt!(self.pat.rewrite(\n-                context,\n-                Shape::legacy(shape.width, shape.indent),\n-            ));\n+            let mut result = try_opt!(\n+                self.pat\n+                    .rewrite(context, Shape::legacy(shape.width, shape.indent))\n+            );\n \n             if !is_empty_infer(context, &*self.ty) {\n                 if context.config.space_before_type_annotation() {\n@@ -1872,17 +1872,17 @@ fn rewrite_fn_base(\n     let generics_str = try_opt!(rewrite_generics(context, generics, shape, g_span));\n     result.push_str(&generics_str);\n \n-    let snuggle_angle_bracket = generics_str.lines().last().map_or(\n-        false,\n-        |l| l.trim_left().len() == 1,\n-    );\n+    let snuggle_angle_bracket = generics_str\n+        .lines()\n+        .last()\n+        .map_or(false, |l| l.trim_left().len() == 1);\n \n     // Note that the width and indent don't really matter, we'll re-layout the\n     // return type later anyway.\n-    let ret_str = try_opt!(fd.output.rewrite(\n-        &context,\n-        Shape::indented(indent, context.config),\n-    ));\n+    let ret_str = try_opt!(\n+        fd.output\n+            .rewrite(&context, Shape::indented(indent, context.config))\n+    );\n \n     let multi_line_ret_str = ret_str.contains('\\n');\n     let ret_str_len = if multi_line_ret_str { 0 } else { ret_str.len() };\n@@ -1942,10 +1942,10 @@ fn rewrite_fn_base(\n     }\n \n     // A conservative estimation, to goal is to be over all parens in generics\n-    let args_start = generics.ty_params.last().map_or(\n-        span.lo,\n-        |tp| end_typaram(tp),\n-    );\n+    let args_start = generics\n+        .ty_params\n+        .last()\n+        .map_or(span.lo, |tp| end_typaram(tp));\n     let args_span = mk_sp(\n         context.codemap.span_after(mk_sp(args_start, span.hi), \"(\"),\n         span_for_return(&fd.output).lo,\n@@ -1987,10 +1987,10 @@ fn rewrite_fn_base(\n         }\n         // If the last line of args contains comment, we cannot put the closing paren\n         // on the same line.\n-        if arg_str.lines().last().map_or(\n-            false,\n-            |last_line| last_line.contains(\"//\"),\n-        )\n+        if arg_str\n+            .lines()\n+            .last()\n+            .map_or(false, |last_line| last_line.contains(\"//\"))\n         {\n             args_last_line_contains_comment = true;\n             result.push('\\n');\n@@ -2048,10 +2048,10 @@ fn rewrite_fn_base(\n         if multi_line_ret_str || ret_should_indent {\n             // Now that we know the proper indent and width, we need to\n             // re-layout the return type.\n-            let ret_str = try_opt!(fd.output.rewrite(\n-                context,\n-                Shape::indented(ret_indent, context.config),\n-            ));\n+            let ret_str = try_opt!(\n+                fd.output\n+                    .rewrite(context, Shape::indented(ret_indent, context.config))\n+            );\n             result.push_str(&ret_str);\n         } else {\n             result.push_str(&ret_str);\n@@ -2063,14 +2063,12 @@ fn rewrite_fn_base(\n             let snippet_hi = span.hi;\n             let snippet = context.snippet(mk_sp(snippet_lo, snippet_hi));\n             // Try to preserve the layout of the original snippet.\n-            let original_starts_with_newline = snippet.find(|c| c != ' ').map_or(\n-                false,\n-                |i| snippet[i..].starts_with('\\n'),\n-            );\n-            let original_ends_with_newline = snippet.rfind(|c| c != ' ').map_or(\n-                false,\n-                |i| snippet[i..].ends_with('\\n'),\n-            );\n+            let original_starts_with_newline = snippet\n+                .find(|c| c != ' ')\n+                .map_or(false, |i| snippet[i..].starts_with('\\n'));\n+            let original_ends_with_newline = snippet\n+                .rfind(|c| c != ' ')\n+                .map_or(false, |i| snippet[i..].ends_with('\\n'));\n             let snippet = snippet.trim();\n             if !snippet.is_empty() {\n                 result.push(if original_starts_with_newline {"}, {"sha": "d176ef01f9b57a033dbed7f348a85343a186c40e", "filename": "src/lists.rs", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Flists.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Flists.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flists.rs?ref=54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e", "patch": "@@ -125,17 +125,15 @@ pub struct ListItem {\n impl ListItem {\n     pub fn is_multiline(&self) -> bool {\n         self.item.as_ref().map_or(false, |s| s.contains('\\n')) || self.pre_comment.is_some() ||\n-            self.post_comment.as_ref().map_or(\n-                false,\n-                |s| s.contains('\\n'),\n-            )\n+            self.post_comment\n+                .as_ref()\n+                .map_or(false, |s| s.contains('\\n'))\n     }\n \n     pub fn has_line_pre_comment(&self) -> bool {\n-        self.pre_comment.as_ref().map_or(\n-            false,\n-            |comment| comment.starts_with(\"//\"),\n-        )\n+        self.pre_comment\n+            .as_ref()\n+            .map_or(false, |comment| comment.starts_with(\"//\"))\n     }\n \n     pub fn from_str<S: Into<String>>(s: S) -> ListItem {"}, {"sha": "419dea87a330ea33bc8a568b33a5b52cfd55022b", "filename": "src/macros.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Fmacros.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Fmacros.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmacros.rs?ref=54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e", "patch": "@@ -219,10 +219,9 @@ pub fn rewrite_macro(\n                 let rewrite = try_opt!(rewrite_array(\n                     expr_vec.iter().map(|x| &**x),\n                     mk_sp(\n-                        context.codemap.span_after(\n-                            mac.span,\n-                            original_style.opener(),\n-                        ),\n+                        context\n+                            .codemap\n+                            .span_after(mac.span, original_style.opener()),\n                         mac.span.hi - BytePos(1),\n                     ),\n                     context,"}, {"sha": "fb0e298bbbf42a60c0963f0e963a9b4e9f9a6f4c", "filename": "src/missed_spans.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Fmissed_spans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Fmissed_spans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmissed_spans.rs?ref=54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e", "patch": "@@ -146,11 +146,9 @@ impl<'a> FmtVisitor<'a> {\n                 let subslice_num_lines = subslice.chars().filter(|c| *c == '\\n').count();\n \n                 if rewrite_next_comment &&\n-                    !self.config.file_lines().intersects_range(\n-                        file_name,\n-                        cur_line,\n-                        cur_line + subslice_num_lines,\n-                    )\n+                    !self.config\n+                        .file_lines()\n+                        .intersects_range(file_name, cur_line, cur_line + subslice_num_lines)\n                 {\n                     rewrite_next_comment = false;\n                 }"}, {"sha": "39b35de20b2130905f1cd533b6bef0f651734e8a", "filename": "src/types.rs", "status": "modified", "additions": 14, "deletions": 12, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftypes.rs?ref=54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e", "patch": "@@ -172,10 +172,11 @@ impl<'a> Rewrite for SegmentParam<'a> {\n                     TypeDensity::Compressed => format!(\"{}=\", binding.ident),\n                 };\n                 let budget = try_opt!(shape.width.checked_sub(result.len()));\n-                let rewrite = try_opt!(binding.ty.rewrite(\n-                    context,\n-                    Shape::legacy(budget, shape.indent + result.len()),\n-                ));\n+                let rewrite = try_opt!(\n+                    binding\n+                        .ty\n+                        .rewrite(context, Shape::legacy(budget, shape.indent + result.len()))\n+                );\n                 result.push_str(&rewrite);\n                 Some(result)\n             }\n@@ -448,10 +449,9 @@ impl Rewrite for ast::WherePredicate {\n                 // 3 = \" = \".len()\n                 let used_width = 3 + lhs_ty_str.len();\n                 let budget = try_opt!(shape.width.checked_sub(used_width));\n-                let rhs_ty_str = try_opt!(rhs_ty.rewrite(\n-                    context,\n-                    Shape::legacy(budget, shape.indent + used_width),\n-                ));\n+                let rhs_ty_str = try_opt!(\n+                    rhs_ty.rewrite(context, Shape::legacy(budget, shape.indent + used_width))\n+                );\n                 format!(\"{} = {}\", lhs_ty_str, rhs_ty_str)\n             }\n         };\n@@ -651,10 +651,12 @@ impl Rewrite for ast::Ty {\n                         format!(\n                             \"&{}{}\",\n                             mut_str,\n-                            try_opt!(mt.ty.rewrite(\n-                                context,\n-                                Shape::legacy(budget, shape.indent + 1 + mut_len),\n-                            ))\n+                            try_opt!(\n+                                mt.ty.rewrite(\n+                                    context,\n+                                    Shape::legacy(budget, shape.indent + 1 + mut_len),\n+                                )\n+                            )\n                         )\n                     }\n                 })"}, {"sha": "d20b4e971b54a5ab77b31109a37c8ada8989e13e", "filename": "src/visitor.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Fvisitor.rs", "raw_url": "https://github.com/rust-lang/rust/raw/54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e/src%2Fvisitor.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fvisitor.rs?ref=54233acc8ebe62cf6bf0d1bbbf686b6437a4fe9e", "patch": "@@ -290,10 +290,9 @@ impl<'a> FmtVisitor<'a> {\n             ast::ItemKind::Impl(..) => {\n                 self.format_missing_with_indent(source!(self, item.span).lo);\n                 let snippet = self.get_context().snippet(item.span);\n-                let where_span_end =\n-                    snippet\n-                        .find_uncommented(\"{\")\n-                        .map(|x| (BytePos(x as u32)) + source!(self, item.span).lo);\n+                let where_span_end = snippet\n+                    .find_uncommented(\"{\")\n+                    .map(|x| (BytePos(x as u32)) + source!(self, item.span).lo);\n                 if let Some(impl_str) = format_impl(\n                     &self.get_context(),\n                     item,"}]}