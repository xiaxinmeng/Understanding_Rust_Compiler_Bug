{"sha": "b740a04dc49b32185e69a2128bcb8425d82b0c66", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI3NDBhMDRkYzQ5YjMyMTg1ZTY5YTIxMjhiY2I4NDI1ZDgyYjBjNjY=", "commit": {"author": {"name": "xFrednet", "email": "xFrednet@gmail.com", "date": "2021-05-12T16:47:32Z"}, "committer": {"name": "xFrednet", "email": "xFrednet@gmail.com", "date": "2021-05-12T16:47:32Z"}, "message": "Metadata collection collecting configuration deprecation reason", "tree": {"sha": "689f0c07d5522d92adaf66d831e542a2bd095aeb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/689f0c07d5522d92adaf66d831e542a2bd095aeb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b740a04dc49b32185e69a2128bcb8425d82b0c66", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b740a04dc49b32185e69a2128bcb8425d82b0c66", "html_url": "https://github.com/rust-lang/rust/commit/b740a04dc49b32185e69a2128bcb8425d82b0c66", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b740a04dc49b32185e69a2128bcb8425d82b0c66/comments", "author": {"login": "xFrednet", "id": 17087237, "node_id": "MDQ6VXNlcjE3MDg3MjM3", "avatar_url": "https://avatars.githubusercontent.com/u/17087237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xFrednet", "html_url": "https://github.com/xFrednet", "followers_url": "https://api.github.com/users/xFrednet/followers", "following_url": "https://api.github.com/users/xFrednet/following{/other_user}", "gists_url": "https://api.github.com/users/xFrednet/gists{/gist_id}", "starred_url": "https://api.github.com/users/xFrednet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xFrednet/subscriptions", "organizations_url": "https://api.github.com/users/xFrednet/orgs", "repos_url": "https://api.github.com/users/xFrednet/repos", "events_url": "https://api.github.com/users/xFrednet/events{/privacy}", "received_events_url": "https://api.github.com/users/xFrednet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xFrednet", "id": 17087237, "node_id": "MDQ6VXNlcjE3MDg3MjM3", "avatar_url": "https://avatars.githubusercontent.com/u/17087237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xFrednet", "html_url": "https://github.com/xFrednet", "followers_url": "https://api.github.com/users/xFrednet/followers", "following_url": "https://api.github.com/users/xFrednet/following{/other_user}", "gists_url": "https://api.github.com/users/xFrednet/gists{/gist_id}", "starred_url": "https://api.github.com/users/xFrednet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xFrednet/subscriptions", "organizations_url": "https://api.github.com/users/xFrednet/orgs", "repos_url": "https://api.github.com/users/xFrednet/repos", "events_url": "https://api.github.com/users/xFrednet/events{/privacy}", "received_events_url": "https://api.github.com/users/xFrednet/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b03642e51f4c1cfc51858dd792aa689b0e6597d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/b03642e51f4c1cfc51858dd792aa689b0e6597d7", "html_url": "https://github.com/rust-lang/rust/commit/b03642e51f4c1cfc51858dd792aa689b0e6597d7"}], "stats": {"total": 28, "additions": 20, "deletions": 8}, "files": [{"sha": "25163bb9f37973c1f18dd5fb53e9f60da64cc60e", "filename": "clippy_lints/src/utils/conf.rs", "status": "modified", "additions": 15, "deletions": 6, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/b740a04dc49b32185e69a2128bcb8425d82b0c66/clippy_lints%2Fsrc%2Futils%2Fconf.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b740a04dc49b32185e69a2128bcb8425d82b0c66/clippy_lints%2Fsrc%2Futils%2Fconf.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Fconf.rs?ref=b740a04dc49b32185e69a2128bcb8425d82b0c66", "patch": "@@ -97,11 +97,20 @@ macro_rules! define_Conf {\n             pub(crate) fn get_configuration_metadata() -> Vec<ClippyConfigurationBasicInfo> {\n                 vec![\n                     $(\n-                        ClippyConfigurationBasicInfo {\n-                            name: stringify!($name),\n-                            config_type: stringify!($ty),\n-                            default: stringify!($default),\n-                            doc_comment: $doc,\n+                        {\n+                            #[allow(unused_mut, unused_assignments)]\n+                            let mut deprecation_reason = None;\n+\n+                            // only set if a deprecation reason was set\n+                            $(deprecation_reason = Some(stringify!($dep));)?\n+\n+                            ClippyConfigurationBasicInfo {\n+                                name: stringify!($name),\n+                                config_type: stringify!($ty),\n+                                default: stringify!($default),\n+                                doc_comment: $doc,\n+                                deprecation_reason,\n+                            }\n                         },\n                     )+\n                 ]\n@@ -118,7 +127,7 @@ define_Conf! {\n     (blacklisted_names: Vec<String> = [\"foo\", \"baz\", \"quux\"].iter().map(ToString::to_string).collect()),\n     /// Lint: COGNITIVE_COMPLEXITY. The maximum cognitive complexity a function can have\n     (cognitive_complexity_threshold: u64 = 25),\n-    /// Lint: CYCLOMATIC_COMPLEXITY. Use the Cognitive Complexity lint instead.\n+    /// DEPRECATED LINT: CYCLOMATIC_COMPLEXITY. Use the Cognitive Complexity lint instead.\n     #[conf_deprecated(\"Please use `cognitive-complexity-threshold` instead\")]\n     (cyclomatic_complexity_threshold: Option<u64> = None),\n     /// Lint: DOC_MARKDOWN. The list of words this lint should not consider as identifiers needing ticks"}, {"sha": "bd0de8ad0341afac71a041040903a05513f50342", "filename": "clippy_lints/src/utils/internal_lints/metadata_collector.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b740a04dc49b32185e69a2128bcb8425d82b0c66/clippy_lints%2Fsrc%2Futils%2Finternal_lints%2Fmetadata_collector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b740a04dc49b32185e69a2128bcb8425d82b0c66/clippy_lints%2Fsrc%2Futils%2Finternal_lints%2Fmetadata_collector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Futils%2Finternal_lints%2Fmetadata_collector.rs?ref=b740a04dc49b32185e69a2128bcb8425d82b0c66", "patch": "@@ -267,6 +267,7 @@ pub(crate) struct ClippyConfigurationBasicInfo {\n     pub config_type: &'static str,\n     pub default: &'static str,\n     pub doc_comment: &'static str,\n+    pub deprecation_reason: Option<&'static str>,\n }\n \n #[derive(Debug, Clone, Default)]\n@@ -276,6 +277,7 @@ struct ClippyConfiguration {\n     doc: String,\n     config_type: &'static str,\n     default: String,\n+    deprecation_reason: Option<&'static str>,\n }\n \n fn collect_configs() -> Vec<ClippyConfiguration> {\n@@ -291,18 +293,19 @@ fn collect_configs() -> Vec<ClippyConfiguration> {\n                 doc,\n                 config_type: x.config_type,\n                 default: clarify_default(x.default),\n+                deprecation_reason: x.deprecation_reason,\n             }\n         })\n         .collect()\n }\n \n fn clarify_default(default: &'static str) -> String {\n-    if let Some((_start, init))  = default.split_once('[') {\n+    if let Some((_start, init)) = default.split_once('[') {\n         if let Some((init, _end)) = init.split_once(']') {\n             return format!(\"[{}]\", init);\n         }\n     }\n-    \n+\n     default.to_string()\n }\n "}]}