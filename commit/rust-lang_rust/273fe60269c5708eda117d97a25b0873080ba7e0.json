{"sha": "273fe60269c5708eda117d97a25b0873080ba7e0", "node_id": "C_kwDOAAsO6NoAKDI3M2ZlNjAyNjljNTcwOGVkYTExN2Q5N2EyNWIwODczMDgwYmE3ZTA", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-12-22T18:36:13Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-12-22T18:36:13Z"}, "message": "Rollup merge of #105983 - compiler-errors:issue-105981, r=tmiasko\n\nAdd a missing early return in drop tracking `handle_uninhabited_return`\n\nThis return is needed so we don't call `Ty::is_inhabited_from` from a type with ty/ct vars in it.\n\nFixes #105981", "tree": {"sha": "7894febd55d504806ff9aae3d36adf38758be2ab", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7894febd55d504806ff9aae3d36adf38758be2ab"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/273fe60269c5708eda117d97a25b0873080ba7e0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjpKOdCRBK7hj4Ov3rIwAAHNgIAIMsQw4OQ1T8bxyO38llZBdb\n89bO6t5vuXMLOFgUIF81z3qb2p3dp0W/BYRKHudjcu50XFzbgAMGeY/K+mt/kwKe\nSmzWuTeTDjD8eZRM5XaaGGGn9efleuEH/15vDsXaSMQkkaPZHoPxWCAgPGGbWEyX\ntf3a387VBi1tCv1xqD/07pEQr+QmgOP/gjAxvlpSlF0KrkcTgVM/sREHSR/EsARf\n5XMb1Z4cjgjgWKFUsPrTVpQ6n+OkJroY8GWVDOg44K3vfeLveqR8w/IasZMgJUQ7\n2CQHBQoMIDEHtweb4wPEoVxtjDae5M+pwiKrGz3Ih1AB6KxCAGK9WnJgH6tJilk=\n=VtMl\n-----END PGP SIGNATURE-----\n", "payload": "tree 7894febd55d504806ff9aae3d36adf38758be2ab\nparent 548d49c7897e91ff6f703c00b3a2ff269b894fdc\nparent 51ba7b4e43179f1262c7684ad3c0a04ddb703e9d\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1671734173 +0100\ncommitter GitHub <noreply@github.com> 1671734173 +0100\n\nRollup merge of #105983 - compiler-errors:issue-105981, r=tmiasko\n\nAdd a missing early return in drop tracking `handle_uninhabited_return`\n\nThis return is needed so we don't call `Ty::is_inhabited_from` from a type with ty/ct vars in it.\n\nFixes #105981\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/273fe60269c5708eda117d97a25b0873080ba7e0", "html_url": "https://github.com/rust-lang/rust/commit/273fe60269c5708eda117d97a25b0873080ba7e0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/273fe60269c5708eda117d97a25b0873080ba7e0/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "548d49c7897e91ff6f703c00b3a2ff269b894fdc", "url": "https://api.github.com/repos/rust-lang/rust/commits/548d49c7897e91ff6f703c00b3a2ff269b894fdc", "html_url": "https://github.com/rust-lang/rust/commit/548d49c7897e91ff6f703c00b3a2ff269b894fdc"}, {"sha": "51ba7b4e43179f1262c7684ad3c0a04ddb703e9d", "url": "https://api.github.com/repos/rust-lang/rust/commits/51ba7b4e43179f1262c7684ad3c0a04ddb703e9d", "html_url": "https://github.com/rust-lang/rust/commit/51ba7b4e43179f1262c7684ad3c0a04ddb703e9d"}], "stats": {"total": 94, "additions": 94, "deletions": 0}, "files": [{"sha": "16806fdba4fbc2113c766be2ed489c032b5f1fda", "filename": "compiler/rustc_hir_typeck/src/generator_interior/drop_ranges/cfg_build.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/273fe60269c5708eda117d97a25b0873080ba7e0/compiler%2Frustc_hir_typeck%2Fsrc%2Fgenerator_interior%2Fdrop_ranges%2Fcfg_build.rs", "raw_url": "https://github.com/rust-lang/rust/raw/273fe60269c5708eda117d97a25b0873080ba7e0/compiler%2Frustc_hir_typeck%2Fsrc%2Fgenerator_interior%2Fdrop_ranges%2Fcfg_build.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_hir_typeck%2Fsrc%2Fgenerator_interior%2Fdrop_ranges%2Fcfg_build.rs?ref=273fe60269c5708eda117d97a25b0873080ba7e0", "patch": "@@ -233,6 +233,7 @@ impl<'a, 'tcx> DropRangeVisitor<'a, 'tcx> {\n             self.tcx()\n                 .sess\n                 .delay_span_bug(expr.span, format!(\"could not resolve infer vars in `{ty}`\"));\n+            return;\n         }\n         let ty = self.tcx().erase_regions(ty);\n         let m = self.tcx().parent_module(expr.hir_id).to_def_id();"}, {"sha": "a6589348d301eed4fab5fa461a68a89d616624df", "filename": "src/test/ui/generator/unresolved-ct-var-drop-tracking.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/273fe60269c5708eda117d97a25b0873080ba7e0/src%2Ftest%2Fui%2Fgenerator%2Funresolved-ct-var-drop-tracking.rs", "raw_url": "https://github.com/rust-lang/rust/raw/273fe60269c5708eda117d97a25b0873080ba7e0/src%2Ftest%2Fui%2Fgenerator%2Funresolved-ct-var-drop-tracking.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fgenerator%2Funresolved-ct-var-drop-tracking.rs?ref=273fe60269c5708eda117d97a25b0873080ba7e0", "patch": "@@ -0,0 +1,15 @@\n+// incremental\n+// edition:2021\n+// compile-flags: -Zdrop-tracking\n+\n+fn main() {\n+    let _ = async {\n+        let s = std::array::from_fn(|_| ()).await;\n+        //~^ ERROR `[(); _]` is not a future\n+        //~| ERROR type inside `async` block must be known in this context\n+        //~| ERROR type inside `async` block must be known in this context\n+        //~| ERROR type inside `async` block must be known in this context\n+        //~| ERROR type inside `async` block must be known in this context\n+        //~| ERROR type inside `async` block must be known in this context\n+    };\n+}"}, {"sha": "9e1fed54c548a5e3d5e2cb0f70997241a0fdb082", "filename": "src/test/ui/generator/unresolved-ct-var-drop-tracking.stderr", "status": "added", "additions": 78, "deletions": 0, "changes": 78, "blob_url": "https://github.com/rust-lang/rust/blob/273fe60269c5708eda117d97a25b0873080ba7e0/src%2Ftest%2Fui%2Fgenerator%2Funresolved-ct-var-drop-tracking.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/273fe60269c5708eda117d97a25b0873080ba7e0/src%2Ftest%2Fui%2Fgenerator%2Funresolved-ct-var-drop-tracking.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fgenerator%2Funresolved-ct-var-drop-tracking.stderr?ref=273fe60269c5708eda117d97a25b0873080ba7e0", "patch": "@@ -0,0 +1,78 @@\n+error[E0277]: `[(); _]` is not a future\n+  --> $DIR/unresolved-ct-var-drop-tracking.rs:7:44\n+   |\n+LL |         let s = std::array::from_fn(|_| ()).await;\n+   |                 ---------------------------^^^^^^\n+   |                 |                          |\n+   |                 |                          `[(); _]` is not a future\n+   |                 |                          help: remove the `.await`\n+   |                 this call returns `[(); _]`\n+   |\n+   = help: the trait `Future` is not implemented for `[(); _]`\n+   = note: [(); _] must be a future or must implement `IntoFuture` to be awaited\n+   = note: required for `[(); _]` to implement `IntoFuture`\n+\n+error[E0698]: type inside `async` block must be known in this context\n+  --> $DIR/unresolved-ct-var-drop-tracking.rs:7:17\n+   |\n+LL |         let s = std::array::from_fn(|_| ()).await;\n+   |                 ^^^^^^^^^^^^^^^^^^^ cannot infer the value of const parameter `N` declared on the function `from_fn`\n+   |\n+note: the type is part of the `async` block because of this `await`\n+  --> $DIR/unresolved-ct-var-drop-tracking.rs:7:44\n+   |\n+LL |         let s = std::array::from_fn(|_| ()).await;\n+   |                                            ^^^^^^\n+\n+error[E0698]: type inside `async` block must be known in this context\n+  --> $DIR/unresolved-ct-var-drop-tracking.rs:7:17\n+   |\n+LL |         let s = std::array::from_fn(|_| ()).await;\n+   |                 ^^^^^^^^^^^^^^^^^^^ cannot infer the value of const parameter `N` declared on the function `from_fn`\n+   |\n+note: the type is part of the `async` block because of this `await`\n+  --> $DIR/unresolved-ct-var-drop-tracking.rs:7:44\n+   |\n+LL |         let s = std::array::from_fn(|_| ()).await;\n+   |                                            ^^^^^^\n+\n+error[E0698]: type inside `async` block must be known in this context\n+  --> $DIR/unresolved-ct-var-drop-tracking.rs:7:17\n+   |\n+LL |         let s = std::array::from_fn(|_| ()).await;\n+   |                 ^^^^^^^^^^^^^^^^^^^ cannot infer the value of const parameter `N` declared on the function `from_fn`\n+   |\n+note: the type is part of the `async` block because of this `await`\n+  --> $DIR/unresolved-ct-var-drop-tracking.rs:7:44\n+   |\n+LL |         let s = std::array::from_fn(|_| ()).await;\n+   |                                            ^^^^^^\n+\n+error[E0698]: type inside `async` block must be known in this context\n+  --> $DIR/unresolved-ct-var-drop-tracking.rs:7:17\n+   |\n+LL |         let s = std::array::from_fn(|_| ()).await;\n+   |                 ^^^^^^^^^^^^^^^^^^^ cannot infer the value of const parameter `N` declared on the function `from_fn`\n+   |\n+note: the type is part of the `async` block because of this `await`\n+  --> $DIR/unresolved-ct-var-drop-tracking.rs:7:44\n+   |\n+LL |         let s = std::array::from_fn(|_| ()).await;\n+   |                                            ^^^^^^\n+\n+error[E0698]: type inside `async` block must be known in this context\n+  --> $DIR/unresolved-ct-var-drop-tracking.rs:7:17\n+   |\n+LL |         let s = std::array::from_fn(|_| ()).await;\n+   |                 ^^^^^^^^^^^^^^^^^^^ cannot infer the value of const parameter `N` declared on the function `from_fn`\n+   |\n+note: the type is part of the `async` block because of this `await`\n+  --> $DIR/unresolved-ct-var-drop-tracking.rs:7:44\n+   |\n+LL |         let s = std::array::from_fn(|_| ()).await;\n+   |                                            ^^^^^^\n+\n+error: aborting due to 6 previous errors\n+\n+Some errors have detailed explanations: E0277, E0698.\n+For more information about an error, try `rustc --explain E0277`."}]}