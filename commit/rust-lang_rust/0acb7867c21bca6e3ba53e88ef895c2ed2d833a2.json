{"sha": "0acb7867c21bca6e3ba53e88ef895c2ed2d833a2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBhY2I3ODY3YzIxYmNhNmUzYmE1M2U4OGVmODk1YzJlZDJkODMzYTI=", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-03-28T00:04:58Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2019-03-28T02:35:30Z"}, "message": "Do not suggest borrowing when the span comes from a macro", "tree": {"sha": "738a3bf0fb24b296c614dc08780b809f495c5266", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/738a3bf0fb24b296c614dc08780b809f495c5266"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0acb7867c21bca6e3ba53e88ef895c2ed2d833a2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0acb7867c21bca6e3ba53e88ef895c2ed2d833a2", "html_url": "https://github.com/rust-lang/rust/commit/0acb7867c21bca6e3ba53e88ef895c2ed2d833a2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0acb7867c21bca6e3ba53e88ef895c2ed2d833a2/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4c27fb19ba15a2e45485e601a79914c6280196b0", "url": "https://api.github.com/repos/rust-lang/rust/commits/4c27fb19ba15a2e45485e601a79914c6280196b0", "html_url": "https://github.com/rust-lang/rust/commit/4c27fb19ba15a2e45485e601a79914c6280196b0"}], "stats": {"total": 12, "additions": 5, "deletions": 7}, "files": [{"sha": "302c093d12fab630d0862355a1d276f783319475", "filename": "src/librustc_typeck/check/demand.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/0acb7867c21bca6e3ba53e88ef895c2ed2d833a2/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0acb7867c21bca6e3ba53e88ef895c2ed2d833a2/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fdemand.rs?ref=0acb7867c21bca6e3ba53e88ef895c2ed2d833a2", "patch": "@@ -10,7 +10,7 @@ use rustc::hir::Node;\n use rustc::hir::{Item, ItemKind, print};\n use rustc::ty::{self, Ty, AssociatedItem};\n use rustc::ty::adjustment::AllowTwoPhase;\n-use errors::{Applicability, DiagnosticBuilder, SourceMapper};\n+use errors::{Applicability, DiagnosticBuilder};\n \n use super::method::probe;\n \n@@ -271,9 +271,10 @@ impl<'a, 'gcx, 'tcx> FnCtxt<'a, 'gcx, 'tcx> {\n                  expected: Ty<'tcx>)\n                  -> Option<(Span, &'static str, String)> {\n         let cm = self.sess().source_map();\n-        // Use the callsite's span if this is a macro call. #41858\n-        let sp = cm.call_span_if_macro(expr.span);\n+        let sp = expr.span;\n         if !cm.span_to_filename(sp).is_real() {\n+            // Ignore if span is from within a macro #41858, #58298. We previously used the macro\n+            // call span, but that breaks down when the type error comes from multiple calls down.\n             return None;\n         }\n "}, {"sha": "996d80a07e058ed2d471b7bf7309fe6acb61d9c2", "filename": "src/test/ui/span/coerce-suggestions.stderr", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/0acb7867c21bca6e3ba53e88ef895c2ed2d833a2/src%2Ftest%2Fui%2Fspan%2Fcoerce-suggestions.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/0acb7867c21bca6e3ba53e88ef895c2ed2d833a2/src%2Ftest%2Fui%2Fspan%2Fcoerce-suggestions.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fspan%2Fcoerce-suggestions.stderr?ref=0acb7867c21bca6e3ba53e88ef895c2ed2d833a2", "patch": "@@ -50,10 +50,7 @@ error[E0308]: mismatched types\n   --> $DIR/coerce-suggestions.rs:21:9\n    |\n LL |     s = format!(\"foo\");\n-   |         ^^^^^^^^^^^^^^\n-   |         |\n-   |         expected mutable reference, found struct `std::string::String`\n-   |         help: consider mutably borrowing here: `&mut format!(\"foo\")`\n+   |         ^^^^^^^^^^^^^^ expected mutable reference, found struct `std::string::String`\n    |\n    = note: expected type `&mut std::string::String`\n               found type `std::string::String`"}]}