{"sha": "35a53b229f383db60eac08b19338424c45f4206a", "node_id": "C_kwDOAAsO6NoAKDM1YTUzYjIyOWYzODNkYjYwZWFjMDhiMTkzMzg0MjRjNDVmNDIwNmE", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-01-20T22:37:34Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-01-20T22:37:34Z"}, "message": "Rollup merge of #93067 - jsha:fix-scroll-padding-top, r=GuillaumeGomez\n\nrustdoc mobile: fix scroll offset when jumping to internal id\n\nFollowup to #92692. The semantics of `scroll-margin-top` are a little surprising - the attribute needs to be applied to the element that gets scrolled into the viewport, not the scrolling element.\n\nThis fixes an issue where clicking on a method (or other item) from the sidebar takes you to a scroll position where the topbar covers up the method name.\n\nI'm interested in ideas for how to test this with browser-ui-test, but I think it doesn't yet have what I need. What I need is an assert that `<element>.getBoundingClientRect().y` is > 45.\n\nDemo: https://rustdoc.crud.net/jsha/fix-scroll-padding-top/std/string/struct.String.html#method.extend_from_within\n\nr? `@GuillaumeGomez`", "tree": {"sha": "be0b501a0a107d97ec2948acf1a2e74e97b89d33", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/be0b501a0a107d97ec2948acf1a2e74e97b89d33"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/35a53b229f383db60eac08b19338424c45f4206a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJh6eQuCRBK7hj4Ov3rIwAAROsIAJ+AzMGMBgO0W6APoqJSJbUV\ng6A0mMNac8pQ+OhCFopWD/735PQtOMgObKJ7MnkK2sDvXdNCq297fdgeo3SE93wY\noUXHqy+JMz+DOYlNzggs27If8qjKdoYtgbuw8YXmH4vFNAOAUqtAT/861iboqzT6\nQ2Y6HWwJoPbNbkYapVI3s0Tp2uV0u3W/LNv91o/5zJrqs/tvTNY6BnZgNqm5yxS7\n/XKaWpdcAC7kH7V287k25aaw9QCUuJJTPYauAWLAfuZjORDzFieelzeOlxFyQXtY\nXvJwV7lGHnX8yacy9YFmheTVPPGdQ2I6B7M6gNK29hpA2YeCMb0M/RIzKl1uXf0=\n=tw/y\n-----END PGP SIGNATURE-----\n", "payload": "tree be0b501a0a107d97ec2948acf1a2e74e97b89d33\nparent dc393b2eccedb985cdba5d451b2df41ef422cd78\nparent 801ac0e24ff6269fe71d22d29b8482e2117b2f82\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1642718254 +0100\ncommitter GitHub <noreply@github.com> 1642718254 +0100\n\nRollup merge of #93067 - jsha:fix-scroll-padding-top, r=GuillaumeGomez\n\nrustdoc mobile: fix scroll offset when jumping to internal id\n\nFollowup to #92692. The semantics of `scroll-margin-top` are a little surprising - the attribute needs to be applied to the element that gets scrolled into the viewport, not the scrolling element.\n\nThis fixes an issue where clicking on a method (or other item) from the sidebar takes you to a scroll position where the topbar covers up the method name.\n\nI'm interested in ideas for how to test this with browser-ui-test, but I think it doesn't yet have what I need. What I need is an assert that `<element>.getBoundingClientRect().y` is > 45.\n\nDemo: https://rustdoc.crud.net/jsha/fix-scroll-padding-top/std/string/struct.String.html#method.extend_from_within\n\nr? `@GuillaumeGomez`\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/35a53b229f383db60eac08b19338424c45f4206a", "html_url": "https://github.com/rust-lang/rust/commit/35a53b229f383db60eac08b19338424c45f4206a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/35a53b229f383db60eac08b19338424c45f4206a/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dc393b2eccedb985cdba5d451b2df41ef422cd78", "url": "https://api.github.com/repos/rust-lang/rust/commits/dc393b2eccedb985cdba5d451b2df41ef422cd78", "html_url": "https://github.com/rust-lang/rust/commit/dc393b2eccedb985cdba5d451b2df41ef422cd78"}, {"sha": "801ac0e24ff6269fe71d22d29b8482e2117b2f82", "url": "https://api.github.com/repos/rust-lang/rust/commits/801ac0e24ff6269fe71d22d29b8482e2117b2f82", "html_url": "https://github.com/rust-lang/rust/commit/801ac0e24ff6269fe71d22d29b8482e2117b2f82"}], "stats": {"total": 15, "additions": 14, "deletions": 1}, "files": [{"sha": "aacbbeee2497c32fab5438fb17cbd702897df5da", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/35a53b229f383db60eac08b19338424c45f4206a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/35a53b229f383db60eac08b19338424c45f4206a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=35a53b229f383db60eac08b19338424c45f4206a", "patch": "@@ -1735,12 +1735,19 @@ details.rustdoc-toggle[open] > summary.hideme::after {\n }\n \n @media (max-width: 700px) {\n+\t/* When linking to an item with an `id` (for instance, by clicking a link in the sidebar,\n+\t   or visiting a URL with a fragment like `#method.new`, we don't want the item to be obscured\n+\t   by the topbar. Anything with an `id` gets scroll-margin-top equal to .mobile-topbar's size.\n+\t*/\n+\t*[id] {\n+\t\tscroll-margin-top: 45px;\n+\t}\n+\n \t.rustdoc {\n \t\tpadding-top: 0px;\n \t\t/* Sidebar should overlay main content, rather than pushing main content to the right.\n \t\t   Turn off `display: flex` on the body element. */\n \t\tdisplay: block;\n-\t\tscroll-margin-top: 45px;\n \t}\n \n \tmain {"}, {"sha": "680822b6ecb8c075eb457b4f43ac3388e184cddd", "filename": "src/test/rustdoc-gui/sidebar-mobile.goml", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/35a53b229f383db60eac08b19338424c45f4206a/src%2Ftest%2Frustdoc-gui%2Fsidebar-mobile.goml", "raw_url": "https://github.com/rust-lang/rust/raw/35a53b229f383db60eac08b19338424c45f4206a/src%2Ftest%2Frustdoc-gui%2Fsidebar-mobile.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsidebar-mobile.goml?ref=35a53b229f383db60eac08b19338424c45f4206a", "patch": "@@ -29,3 +29,9 @@ assert-css: (\".sidebar\", {\"display\": \"block\", \"left\": \"-1000px\"})\n \n // Check that the topbar is visible\n assert-property: (\".mobile-topbar\", {\"clientHeight\": \"45\"})\n+\n+// Check that clicking an element from the sidebar scrolls to the right place\n+// so the target is not obscured by the topbar.\n+click: \".sidebar-menu-toggle\"\n+click: \".sidebar-links a\"\n+assert-position: (\"#method\\.must_use\", {\"y\": 45})"}]}