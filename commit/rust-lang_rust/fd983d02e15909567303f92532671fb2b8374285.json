{"sha": "fd983d02e15909567303f92532671fb2b8374285", "node_id": "MDY6Q29tbWl0NzI0NzEyOmZkOTgzZDAyZTE1OTA5NTY3MzAzZjkyNTMyNjcxZmIyYjgzNzQyODU=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2016-11-12T20:02:40Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2016-11-12T20:02:40Z"}, "message": "Auto merge of #37611 - Mark-Simulacrum:tari-nodejs-runner-detect, r=alexcrichton\n\ncompile-test: allow overriding nodejs binary location\n\nAdd a command-line argument to manually specify which nodejs binary should be used,\nwhich disables the default search.\n\nOriginal work done by @tari.\n\nFixes #34188.", "tree": {"sha": "93b5842721346ef5fc431d6ea8420c45e940d1c0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/93b5842721346ef5fc431d6ea8420c45e940d1c0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fd983d02e15909567303f92532671fb2b8374285", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fd983d02e15909567303f92532671fb2b8374285", "html_url": "https://github.com/rust-lang/rust/commit/fd983d02e15909567303f92532671fb2b8374285", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fd983d02e15909567303f92532671fb2b8374285/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "026add5f06191dfbd592a4f02bb4a38866553c63", "url": "https://api.github.com/repos/rust-lang/rust/commits/026add5f06191dfbd592a4f02bb4a38866553c63", "html_url": "https://github.com/rust-lang/rust/commit/026add5f06191dfbd592a4f02bb4a38866553c63"}, {"sha": "c524c50edf85b3489734beb6b6619082307de116", "url": "https://api.github.com/repos/rust-lang/rust/commits/c524c50edf85b3489734beb6b6619082307de116", "html_url": "https://github.com/rust-lang/rust/commit/c524c50edf85b3489734beb6b6619082307de116"}], "stats": {"total": 22, "additions": 14, "deletions": 8}, "files": [{"sha": "50c703a7354092e4910d951ba20478d65e42fde6", "filename": "src/bootstrap/config.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/fd983d02e15909567303f92532671fb2b8374285/src%2Fbootstrap%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fd983d02e15909567303f92532671fb2b8374285/src%2Fbootstrap%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fconfig.rs?ref=fd983d02e15909567303f92532671fb2b8374285", "patch": "@@ -129,6 +129,7 @@ struct Build {\n     submodules: Option<bool>,\n     gdb: Option<String>,\n     vendor: Option<bool>,\n+    nodejs: Option<String>,\n }\n \n /// TOML representation of how the LLVM build is configured.\n@@ -234,6 +235,7 @@ impl Config {\n         }\n         config.rustc = build.rustc.map(PathBuf::from);\n         config.cargo = build.cargo.map(PathBuf::from);\n+        config.nodejs = build.nodejs.map(PathBuf::from);\n         config.gdb = build.gdb.map(PathBuf::from);\n         set(&mut config.compiler_docs, build.compiler_docs);\n         set(&mut config.docs, build.docs);"}, {"sha": "a541ba0b2f3fdad203f18452ebf716c2efe49d49", "filename": "src/bootstrap/sanity.rs", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/fd983d02e15909567303f92532671fb2b8374285/src%2Fbootstrap%2Fsanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fd983d02e15909567303f92532671fb2b8374285/src%2Fbootstrap%2Fsanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fsanity.rs?ref=fd983d02e15909567303f92532671fb2b8374285", "patch": "@@ -81,15 +81,16 @@ pub fn check(build: &mut Build) {\n \n     need_cmd(\"python\".as_ref());\n \n-    // Look for the nodejs command, needed for emscripten testing\n-    if let Some(node) = have_cmd(\"node\".as_ref()) {\n-        build.config.nodejs = Some(node);\n-    } else if let Some(node) = have_cmd(\"nodejs\".as_ref()) {\n-        build.config.nodejs = Some(node);\n-    }\n \n     if let Some(ref s) = build.config.nodejs {\n         need_cmd(s.as_ref());\n+    } else {\n+        // Look for the nodejs command, needed for emscripten testing\n+        if let Some(node) = have_cmd(\"node\".as_ref()) {\n+            build.config.nodejs = Some(node);\n+        } else if let Some(node) = have_cmd(\"nodejs\".as_ref()) {\n+            build.config.nodejs = Some(node);\n+        }\n     }\n \n     if let Some(ref gdb) = build.config.gdb {"}, {"sha": "4c024434e17c6adacaa62acf9fc709509c50b909", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/fd983d02e15909567303f92532671fb2b8374285/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fd983d02e15909567303f92532671fb2b8374285/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=fd983d02e15909567303f92532671fb2b8374285", "patch": "@@ -1456,8 +1456,11 @@ actual:\\n\\\n \n         // If this is emscripten, then run tests under nodejs\n         if self.config.target.contains(\"emscripten\") {\n-            let nodejs = self.config.nodejs.clone().unwrap_or(\"nodejs\".to_string());\n-            args.push(nodejs);\n+            if let Some(ref p) = self.config.nodejs {\n+                args.push(p.clone());\n+            } else {\n+                self.fatal(\"no NodeJS binary found (--nodejs)\");\n+            }\n         }\n \n         let exe_file = self.make_exe_name();"}]}