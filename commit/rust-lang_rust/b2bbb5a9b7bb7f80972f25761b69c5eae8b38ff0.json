{"sha": "b2bbb5a9b7bb7f80972f25761b69c5eae8b38ff0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIyYmJiNWE5YjdiYjdmODA5NzJmMjU3NjFiNjljNWVhZThiMzhmZjA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-06-16T17:43:24Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-06-16T17:43:24Z"}, "message": "Auto merge of #51584 - QuietMisdreavus:globs-and-crosses, r=ollie27\n\nrustdoc: process cross-crate glob re-exports\n\nTurns out, we were deliberately ignoring glob re-exports when they were occurring across crates, even though we were fully processing them for local re-exports. This will at least bring the two into parity.\n\nFixes https://github.com/rust-lang/rust/issues/51252", "tree": {"sha": "bc4fb88d95b621f7231fd3c2413306d818dc02c6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bc4fb88d95b621f7231fd3c2413306d818dc02c6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b2bbb5a9b7bb7f80972f25761b69c5eae8b38ff0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b2bbb5a9b7bb7f80972f25761b69c5eae8b38ff0", "html_url": "https://github.com/rust-lang/rust/commit/b2bbb5a9b7bb7f80972f25761b69c5eae8b38ff0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b2bbb5a9b7bb7f80972f25761b69c5eae8b38ff0/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "253205658edc477a0b429f3ce25a92099dc7ddc4", "url": "https://api.github.com/repos/rust-lang/rust/commits/253205658edc477a0b429f3ce25a92099dc7ddc4", "html_url": "https://github.com/rust-lang/rust/commit/253205658edc477a0b429f3ce25a92099dc7ddc4"}, {"sha": "042f1df198c6be96f08afe8b2e938ddfbeba0330", "url": "https://api.github.com/repos/rust-lang/rust/commits/042f1df198c6be96f08afe8b2e938ddfbeba0330", "html_url": "https://github.com/rust-lang/rust/commit/042f1df198c6be96f08afe8b2e938ddfbeba0330"}], "stats": {"total": 60, "additions": 60, "deletions": 0}, "files": [{"sha": "80eb2d1e214fbd9146574d9ec49240a4ae8c295b", "filename": "src/librustdoc/clean/inline.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/b2bbb5a9b7bb7f80972f25761b69c5eae8b38ff0/src%2Flibrustdoc%2Fclean%2Finline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2bbb5a9b7bb7f80972f25761b69c5eae8b38ff0/src%2Flibrustdoc%2Fclean%2Finline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Finline.rs?ref=b2bbb5a9b7bb7f80972f25761b69c5eae8b38ff0", "patch": "@@ -116,6 +116,23 @@ pub fn try_inline(cx: &DocContext, def: Def, name: ast::Name, visited: &mut FxHa\n     Some(ret)\n }\n \n+pub fn try_inline_glob(cx: &DocContext, def: Def, visited: &mut FxHashSet<DefId>)\n+    -> Option<Vec<clean::Item>>\n+{\n+    if def == Def::Err { return None }\n+    let did = def.def_id();\n+    if did.is_local() { return None }\n+\n+    match def {\n+        Def::Mod(did) => {\n+            let m = build_module(cx, did, visited);\n+            Some(m.items)\n+        }\n+        // glob imports on things like enums aren't inlined even for local exports, so just bail\n+        _ => None,\n+    }\n+}\n+\n pub fn load_attrs(cx: &DocContext, did: DefId) -> clean::Attributes {\n     cx.tcx.get_attrs(did).clean(cx)\n }"}, {"sha": "15c2e7b72f65c58d196cd37f8bdd0c82857c0adf", "filename": "src/librustdoc/clean/mod.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b2bbb5a9b7bb7f80972f25761b69c5eae8b38ff0/src%2Flibrustdoc%2Fclean%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2bbb5a9b7bb7f80972f25761b69c5eae8b38ff0/src%2Flibrustdoc%2Fclean%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Fmod.rs?ref=b2bbb5a9b7bb7f80972f25761b69c5eae8b38ff0", "patch": "@@ -3862,6 +3862,13 @@ impl Clean<Vec<Item>> for doctree::Import {\n         });\n         let path = self.path.clean(cx);\n         let inner = if self.glob {\n+            if !denied {\n+                let mut visited = FxHashSet();\n+                if let Some(items) = inline::try_inline_glob(cx, path.def, &mut visited) {\n+                    return items;\n+                }\n+            }\n+\n             Import::Glob(resolve_use_source(cx, path))\n         } else {\n             let name = self.name;"}, {"sha": "5067ce9e9a341f350fab84c5967d90b5239af0ea", "filename": "src/test/rustdoc/inline_cross/auxiliary/cross-glob.rs", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/b2bbb5a9b7bb7f80972f25761b69c5eae8b38ff0/src%2Ftest%2Frustdoc%2Finline_cross%2Fauxiliary%2Fcross-glob.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2bbb5a9b7bb7f80972f25761b69c5eae8b38ff0/src%2Ftest%2Frustdoc%2Finline_cross%2Fauxiliary%2Fcross-glob.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Finline_cross%2Fauxiliary%2Fcross-glob.rs?ref=b2bbb5a9b7bb7f80972f25761b69c5eae8b38ff0", "patch": "@@ -0,0 +1,15 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![crate_name = \"inner\"]\n+\n+pub struct SomeStruct;\n+\n+pub fn some_fn() {}"}, {"sha": "21cf158c13b0353de107b3698fb62e43029a48d3", "filename": "src/test/rustdoc/inline_cross/cross-glob.rs", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/b2bbb5a9b7bb7f80972f25761b69c5eae8b38ff0/src%2Ftest%2Frustdoc%2Finline_cross%2Fcross-glob.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b2bbb5a9b7bb7f80972f25761b69c5eae8b38ff0/src%2Ftest%2Frustdoc%2Finline_cross%2Fcross-glob.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Finline_cross%2Fcross-glob.rs?ref=b2bbb5a9b7bb7f80972f25761b69c5eae8b38ff0", "patch": "@@ -0,0 +1,21 @@\n+// Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// aux-build:cross-glob.rs\n+// build-aux-docs\n+// ignore-cross-compile\n+\n+extern crate inner;\n+\n+// @has cross_glob/struct.SomeStruct.html\n+// @has cross_glob/fn.some_fn.html\n+// @!has cross_glob/index.html '//code' 'pub use inner::*;'\n+#[doc(inline)]\n+pub use inner::*;"}]}