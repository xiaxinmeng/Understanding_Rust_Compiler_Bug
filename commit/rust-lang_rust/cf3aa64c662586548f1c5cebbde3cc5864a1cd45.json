{"sha": "cf3aa64c662586548f1c5cebbde3cc5864a1cd45", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNmM2FhNjRjNjYyNTg2NTQ4ZjFjNWNlYmJkZTNjYzU4NjRhMWNkNDU=", "commit": {"author": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2020-11-08T16:35:59Z"}, "committer": {"name": "bjorn3", "email": "bjorn3@users.noreply.github.com", "date": "2020-11-08T16:35:59Z"}, "message": "Better build dir layout\n\nIt now matches the layout used by rustc itself", "tree": {"sha": "a8bd37e3a87a81b5a6e1508571516e1d00fe1d10", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a8bd37e3a87a81b5a6e1508571516e1d00fe1d10"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/cf3aa64c662586548f1c5cebbde3cc5864a1cd45", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/cf3aa64c662586548f1c5cebbde3cc5864a1cd45", "html_url": "https://github.com/rust-lang/rust/commit/cf3aa64c662586548f1c5cebbde3cc5864a1cd45", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/cf3aa64c662586548f1c5cebbde3cc5864a1cd45/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "df45a06f8959cb5ba52b5ba1d76df42527c1a448", "url": "https://api.github.com/repos/rust-lang/rust/commits/df45a06f8959cb5ba52b5ba1d76df42527c1a448", "html_url": "https://github.com/rust-lang/rust/commit/df45a06f8959cb5ba52b5ba1d76df42527c1a448"}], "stats": {"total": 30, "additions": 17, "deletions": 13}, "files": [{"sha": "de54bf67f4a19b7208613335ef998e05c42cb361", "filename": "Readme.md", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cf3aa64c662586548f1c5cebbde3cc5864a1cd45/Readme.md", "raw_url": "https://github.com/rust-lang/rust/raw/cf3aa64c662586548f1c5cebbde3cc5864a1cd45/Readme.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Readme.md?ref=cf3aa64c662586548f1c5cebbde3cc5864a1cd45", "patch": "@@ -51,7 +51,7 @@ This should build and run your project with rustc_codegen_cranelift instead of t\n > You should prefer using the Cargo method.\n \n ```bash\n-$ $cg_clif_dir/build/cg_clif my_crate.rs\n+$ $cg_clif_dir/build/bin/cg_clif my_crate.rs\n ```\n \n ### Jit mode\n@@ -68,7 +68,7 @@ $ $cg_clif_dir/build/cargo.sh jit\n or\n \n ```bash\n-$ $cg_clif_dir/build/cg_clif --jit my_crate.rs\n+$ $cg_clif_dir/build/bin/cg_clif --jit my_crate.rs\n ```\n \n ### Shell\n@@ -77,7 +77,7 @@ These are a few functions that allow you to easily run rust code from the shell\n \n ```bash\n function jit_naked() {\n-    echo \"$@\" | $cg_clif_dir/build/cg_clif - --jit\n+    echo \"$@\" | $cg_clif_dir/build/bin/cg_clif - --jit\n }\n \n function jit() {"}, {"sha": "3d77d1d87291c54fe9af4b7a062a62c1b131cafe", "filename": "build.sh", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cf3aa64c662586548f1c5cebbde3cc5864a1cd45/build.sh", "raw_url": "https://github.com/rust-lang/rust/raw/cf3aa64c662586548f1c5cebbde3cc5864a1cd45/build.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build.sh?ref=cf3aa64c662586548f1c5cebbde3cc5864a1cd45", "patch": "@@ -36,7 +36,9 @@ fi\n \n rm -rf \"$target_dir\"\n mkdir \"$target_dir\"\n-cp -a target/$CHANNEL/cg_clif{,_build_sysroot} target/$CHANNEL/*rustc_codegen_cranelift* \"$target_dir/\"\n+mkdir \"$target_dir\"/bin \"$target_dir\"/lib\n+cp -a target/$CHANNEL/cg_clif{,_build_sysroot} \"$target_dir\"/bin\n+cp -a target/$CHANNEL/*rustc_codegen_cranelift* \"$target_dir\"/lib\n cp -a rust-toolchain scripts/config.sh scripts/cargo.sh \"$target_dir\"\n \n if [[ \"$build_sysroot\" == \"1\" ]]; then"}, {"sha": "0223cf74e81b439eb3daa31228bd6aa60ec4c578", "filename": "build_sysroot/build_sysroot.sh", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/cf3aa64c662586548f1c5cebbde3cc5864a1cd45/build_sysroot%2Fbuild_sysroot.sh", "raw_url": "https://github.com/rust-lang/rust/raw/cf3aa64c662586548f1c5cebbde3cc5864a1cd45/build_sysroot%2Fbuild_sysroot.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/build_sysroot%2Fbuild_sysroot.sh?ref=cf3aa64c662586548f1c5cebbde3cc5864a1cd45", "patch": "@@ -10,7 +10,7 @@ dir=$(pwd)\n \n # Use rustc with cg_clif as hotpluggable backend instead of the custom cg_clif driver so that\n # build scripts are still compiled using cg_llvm.\n-export RUSTC=$dir\"/cg_clif_build_sysroot\"\n+export RUSTC=$dir\"/bin/cg_clif_build_sysroot\"\n export RUSTFLAGS=$RUSTFLAGS\" --clif\"\n \n cd \"$(dirname \"$0\")\"\n@@ -35,6 +35,6 @@ else\n fi\n \n # Copy files to sysroot\n-mkdir -p \"$dir/sysroot/lib/rustlib/$TARGET_TRIPLE/lib/\"\n-cp -a \"target/$TARGET_TRIPLE/$sysroot_channel/deps/\"* \"$dir/sysroot/lib/rustlib/$TARGET_TRIPLE/lib/\"\n-rm \"$dir/sysroot/lib/rustlib/$TARGET_TRIPLE/lib/\"*.{rmeta,d}\n+mkdir -p \"$dir/lib/rustlib/$TARGET_TRIPLE/lib/\"\n+cp -a \"target/$TARGET_TRIPLE/$sysroot_channel/deps/\"* \"$dir/lib/rustlib/$TARGET_TRIPLE/lib/\"\n+rm \"$dir/lib/rustlib/$TARGET_TRIPLE/lib/\"*.{rmeta,d}"}, {"sha": "1ac6bf265b42a185cb61588aab11ffe9357560b0", "filename": "scripts/config.sh", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/cf3aa64c662586548f1c5cebbde3cc5864a1cd45/scripts%2Fconfig.sh", "raw_url": "https://github.com/rust-lang/rust/raw/cf3aa64c662586548f1c5cebbde3cc5864a1cd45/scripts%2Fconfig.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/scripts%2Fconfig.sh?ref=cf3aa64c662586548f1c5cebbde3cc5864a1cd45", "patch": "@@ -43,17 +43,17 @@ fi\n \n dir=$(cd \"$(dirname \"${BASH_SOURCE[0]}\")\"; pwd)\n \n-export RUSTC=$dir\"/cg_clif\"\n+export RUSTC=$dir\"/bin/cg_clif\"\n export RUSTFLAGS=$linker\" \"$RUSTFLAGS\n export RUSTDOCFLAGS=$linker' -Cpanic=abort -Zpanic-abort-tests '\\\n-'-Zcodegen-backend='$dir'/librustc_codegen_cranelift.'$dylib_ext' --sysroot '$dir'/sysroot'\n+'-Zcodegen-backend='$dir'/lib/librustc_codegen_cranelift.'$dylib_ext' --sysroot '$dir\n \n # FIXME remove once the atomic shim is gone\n if [[ $(uname) == 'Darwin' ]]; then\n    export RUSTFLAGS=\"$RUSTFLAGS -Clink-arg=-undefined -Clink-arg=dynamic_lookup\"\n fi\n \n-export LD_LIBRARY_PATH=\"$dir:$(rustc --print sysroot)/lib:$dir/target/out:$dir/sysroot/lib/rustlib/$TARGET_TRIPLE/lib\"\n+export LD_LIBRARY_PATH=\"$dir/lib:$(rustc --print sysroot)/lib:$dir/target/out:$dir/sysroot/lib/rustlib/$TARGET_TRIPLE/lib\"\n export DYLD_LIBRARY_PATH=$LD_LIBRARY_PATH\n \n export CG_CLIF_DISPLAY_CG_TIME=1"}, {"sha": "db69541b226cf8aba2167bfba8ea9569d73637db", "filename": "scripts/test_bootstrap.sh", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/cf3aa64c662586548f1c5cebbde3cc5864a1cd45/scripts%2Ftest_bootstrap.sh", "raw_url": "https://github.com/rust-lang/rust/raw/cf3aa64c662586548f1c5cebbde3cc5864a1cd45/scripts%2Ftest_bootstrap.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/scripts%2Ftest_bootstrap.sh?ref=cf3aa64c662586548f1c5cebbde3cc5864a1cd45", "patch": "@@ -48,7 +48,7 @@ cat > config.toml <<EOF\n ninja = false\n \n [build]\n-rustc = \"$(pwd)/../build/cg_clif\"\n+rustc = \"$(pwd)/../build/bin/cg_clif\"\n cargo = \"$(rustup which cargo)\"\n full-bootstrap = true\n local-rebuild = true"}, {"sha": "891353e4b317c5b04c73065be4137d74c0818631", "filename": "src/bin/cg_clif.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/cf3aa64c662586548f1c5cebbde3cc5864a1cd45/src%2Fbin%2Fcg_clif.rs", "raw_url": "https://github.com/rust-lang/rust/raw/cf3aa64c662586548f1c5cebbde3cc5864a1cd45/src%2Fbin%2Fcg_clif.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbin%2Fcg_clif.rs?ref=cf3aa64c662586548f1c5cebbde3cc5864a1cd45", "patch": "@@ -32,7 +32,9 @@ impl rustc_driver::Callbacks for CraneliftPassesCallbacks {\n                     .unwrap()\n                     .parent()\n                     .unwrap()\n-                    .join(\"sysroot\"),\n+                    .parent()\n+                    .unwrap()\n+                    .to_owned(),\n             ),\n         );\n     }"}]}