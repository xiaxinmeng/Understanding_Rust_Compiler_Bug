{"sha": "535bd7ccf73bcea549ddb7b01e7b3c4f35c6e856", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUzNWJkN2NjZjczYmNlYTU0OWRkYjdiMDFlN2IzYzRmMzVjNmU4NTY=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-08-12T19:23:44Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2018-08-12T19:23:44Z"}, "message": "remove useless loop", "tree": {"sha": "cd2c3c11ee38b4f9637dca6c44821fa27f4c6ead", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cd2c3c11ee38b4f9637dca6c44821fa27f4c6ead"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/535bd7ccf73bcea549ddb7b01e7b3c4f35c6e856", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/535bd7ccf73bcea549ddb7b01e7b3c4f35c6e856", "html_url": "https://github.com/rust-lang/rust/commit/535bd7ccf73bcea549ddb7b01e7b3c4f35c6e856", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/535bd7ccf73bcea549ddb7b01e7b3c4f35c6e856/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b518fd0ef91d8ca3d9814b335c7be8684d1692a9", "url": "https://api.github.com/repos/rust-lang/rust/commits/b518fd0ef91d8ca3d9814b335c7be8684d1692a9", "html_url": "https://github.com/rust-lang/rust/commit/b518fd0ef91d8ca3d9814b335c7be8684d1692a9"}], "stats": {"total": 45, "additions": 21, "deletions": 24}, "files": [{"sha": "4b250acfaf3e65077b2887ce2666e91a841895a7", "filename": "crates/server/src/main.rs", "status": "modified", "additions": 21, "deletions": 24, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/535bd7ccf73bcea549ddb7b01e7b3c4f35c6e856/crates%2Fserver%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/535bd7ccf73bcea549ddb7b01e7b3c4f35c6e856/crates%2Fserver%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fserver%2Fsrc%2Fmain.rs?ref=535bd7ccf73bcea549ddb7b01e7b3c4f35c6e856", "patch": "@@ -72,33 +72,30 @@ fn main_inner() -> Result<()> {\n }\n \n fn initialize(io: &mut Io) -> Result<()> {\n-    loop {\n-        match io.recv()? {\n-            RawMsg::Notification(n) =>\n-                bail!(\"expected initialize request, got {:?}\", n),\n-            RawMsg::Response(res) =>\n-                bail!(\"expected initialize request, got {:?}\", res),\n+    match io.recv()? {\n+        RawMsg::Notification(n) =>\n+            bail!(\"expected initialize request, got {:?}\", n),\n+        RawMsg::Response(res) =>\n+            bail!(\"expected initialize request, got {:?}\", res),\n \n-            RawMsg::Request(req) => {\n-                let mut req = Some(req);\n-                dispatch::handle_request::<req::Initialize, _>(&mut req, |_params, resp| {\n-                    let res = req::InitializeResult { capabilities: caps::SERVER_CAPABILITIES };\n-                    let resp = resp.into_response(Ok(res))?;\n-                    io.send(RawMsg::Response(resp));\n-                    Ok(())\n-                })?;\n-                if let Some(req) = req {\n-                    bail!(\"expected initialize request, got {:?}\", req)\n-                }\n-                match io.recv()? {\n-                    RawMsg::Notification(n) => {\n-                        if n.method != \"initialized\" {\n-                            bail!(\"expected initialized notification\");\n-                        }\n+        RawMsg::Request(req) => {\n+            let mut req = Some(req);\n+            dispatch::handle_request::<req::Initialize, _>(&mut req, |_params, resp| {\n+                let res = req::InitializeResult { capabilities: caps::SERVER_CAPABILITIES };\n+                let resp = resp.into_response(Ok(res))?;\n+                io.send(RawMsg::Response(resp));\n+                Ok(())\n+            })?;\n+            if let Some(req) = req {\n+                bail!(\"expected initialize request, got {:?}\", req)\n+            }\n+            match io.recv()? {\n+                RawMsg::Notification(n) => {\n+                    if n.method != \"initialized\" {\n+                        bail!(\"expected initialized notification\");\n                     }\n-                    _ => bail!(\"expected initialized notification\"),\n                 }\n-                break;\n+                _ => bail!(\"expected initialized notification\"),\n             }\n         }\n     }"}]}