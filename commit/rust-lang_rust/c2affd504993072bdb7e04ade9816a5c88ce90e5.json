{"sha": "c2affd504993072bdb7e04ade9816a5c88ce90e5", "node_id": "C_kwDOAAsO6NoAKGMyYWZmZDUwNDk5MzA3MmJkYjdlMDRhZGU5ODE2YTVjODhjZTkwZTU", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2022-11-02T00:00:40Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-11-02T00:00:40Z"}, "message": "Rollup merge of #103839 - Nilstrieb:print-list, r=compiler-errors\n\nPrint valid `--print` requests if request is invalid\n\nWhen someone makes a typo, it can be useful to see the valid options. This is also useful if someone wants to find out about all the options.", "tree": {"sha": "c41889bbbcbce1d27875da5943665f2ad35006cd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c41889bbbcbce1d27875da5943665f2ad35006cd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c2affd504993072bdb7e04ade9816a5c88ce90e5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjYbMoCRBK7hj4Ov3rIwAAZBgIAKfa46PYV5VLVTevdtlm14kq\nxSmQAyZkfLc5dwnbyiJCcO+m7aaspeCeDbvBm3Acl4fFl38gVQQZuyjkc4XPCNs5\n125WfsaUhsleVppzuOsnSu1N0jf/L+phJUfF6qhZXKy4UTe8tCMuEBdpG/1m53i4\nUZDdePp/Wzb7OiYh8LeMpkd9r2p+NxIpzuPY1FPTYB7Ff2RUppRaf78YFzzbazTy\n/yOk8uf+bcrj5fUAaSGvfuNN/YKW8EjcqhRRfAfuCr9ezcbOltyr5mwoBuqSDgnI\ne9OjETO7qe/dDF/oPdpVjqK9+VV+flp3xyd95n5wpP7Z+W0rDPPu0S/CBIRrFic=\n=sVGS\n-----END PGP SIGNATURE-----\n", "payload": "tree c41889bbbcbce1d27875da5943665f2ad35006cd\nparent 617f246e2133455b5dce719f968d282895d77f88\nparent b20d969516f2ade620ac0420ce3425e167684179\nauthor Manish Goregaokar <manishsmail@gmail.com> 1667347240 -0400\ncommitter GitHub <noreply@github.com> 1667347240 -0400\n\nRollup merge of #103839 - Nilstrieb:print-list, r=compiler-errors\n\nPrint valid `--print` requests if request is invalid\n\nWhen someone makes a typo, it can be useful to see the valid options. This is also useful if someone wants to find out about all the options.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c2affd504993072bdb7e04ade9816a5c88ce90e5", "html_url": "https://github.com/rust-lang/rust/commit/c2affd504993072bdb7e04ade9816a5c88ce90e5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c2affd504993072bdb7e04ade9816a5c88ce90e5/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "617f246e2133455b5dce719f968d282895d77f88", "url": "https://api.github.com/repos/rust-lang/rust/commits/617f246e2133455b5dce719f968d282895d77f88", "html_url": "https://github.com/rust-lang/rust/commit/617f246e2133455b5dce719f968d282895d77f88"}, {"sha": "b20d969516f2ade620ac0420ce3425e167684179", "url": "https://api.github.com/repos/rust-lang/rust/commits/b20d969516f2ade620ac0420ce3425e167684179", "html_url": "https://github.com/rust-lang/rust/commit/b20d969516f2ade620ac0420ce3425e167684179"}], "stats": {"total": 67, "additions": 44, "deletions": 23}, "files": [{"sha": "bd1f85a9d0693f6a640647ba331f6ffb84063e97", "filename": "compiler/rustc_session/src/config.rs", "status": "modified", "additions": 38, "deletions": 23, "changes": 61, "blob_url": "https://github.com/rust-lang/rust/blob/c2affd504993072bdb7e04ade9816a5c88ce90e5/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2affd504993072bdb7e04ade9816a5c88ce90e5/compiler%2Frustc_session%2Fsrc%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_session%2Fsrc%2Fconfig.rs?ref=c2affd504993072bdb7e04ade9816a5c88ce90e5", "patch": "@@ -1789,34 +1789,49 @@ fn collect_print_requests(\n         cg.target_feature = String::new();\n     }\n \n-    prints.extend(matches.opt_strs(\"print\").into_iter().map(|s| match &*s {\n-        \"crate-name\" => PrintRequest::CrateName,\n-        \"file-names\" => PrintRequest::FileNames,\n-        \"sysroot\" => PrintRequest::Sysroot,\n-        \"target-libdir\" => PrintRequest::TargetLibdir,\n-        \"cfg\" => PrintRequest::Cfg,\n-        \"calling-conventions\" => PrintRequest::CallingConventions,\n-        \"target-list\" => PrintRequest::TargetList,\n-        \"target-cpus\" => PrintRequest::TargetCPUs,\n-        \"target-features\" => PrintRequest::TargetFeatures,\n-        \"relocation-models\" => PrintRequest::RelocationModels,\n-        \"code-models\" => PrintRequest::CodeModels,\n-        \"tls-models\" => PrintRequest::TlsModels,\n-        \"native-static-libs\" => PrintRequest::NativeStaticLibs,\n-        \"stack-protector-strategies\" => PrintRequest::StackProtectorStrategies,\n-        \"target-spec-json\" => {\n-            if unstable_opts.unstable_options {\n-                PrintRequest::TargetSpec\n-            } else {\n+    const PRINT_REQUESTS: &[(&str, PrintRequest)] = &[\n+        (\"crate-name\", PrintRequest::CrateName),\n+        (\"file-names\", PrintRequest::FileNames),\n+        (\"sysroot\", PrintRequest::Sysroot),\n+        (\"target-libdir\", PrintRequest::TargetLibdir),\n+        (\"cfg\", PrintRequest::Cfg),\n+        (\"calling-conventions\", PrintRequest::CallingConventions),\n+        (\"target-list\", PrintRequest::TargetList),\n+        (\"target-cpus\", PrintRequest::TargetCPUs),\n+        (\"target-features\", PrintRequest::TargetFeatures),\n+        (\"relocation-models\", PrintRequest::RelocationModels),\n+        (\"code-models\", PrintRequest::CodeModels),\n+        (\"tls-models\", PrintRequest::TlsModels),\n+        (\"native-static-libs\", PrintRequest::NativeStaticLibs),\n+        (\"stack-protector-strategies\", PrintRequest::StackProtectorStrategies),\n+        (\"target-spec-json\", PrintRequest::TargetSpec),\n+        (\"link-args\", PrintRequest::LinkArgs),\n+    ];\n+\n+    prints.extend(matches.opt_strs(\"print\").into_iter().map(|req| {\n+        match PRINT_REQUESTS.iter().find(|&&(name, _)| name == req) {\n+            Some((_, PrintRequest::TargetSpec)) => {\n+                if unstable_opts.unstable_options {\n+                    PrintRequest::TargetSpec\n+                } else {\n+                    early_error(\n+                        error_format,\n+                        \"the `-Z unstable-options` flag must also be passed to \\\n+                     enable the target-spec-json print option\",\n+                    );\n+                }\n+            }\n+            Some(&(_, print_request)) => print_request,\n+            None => {\n+                let prints =\n+                    PRINT_REQUESTS.iter().map(|(name, _)| format!(\"`{name}`\")).collect::<Vec<_>>();\n+                let prints = prints.join(\", \");\n                 early_error(\n                     error_format,\n-                    \"the `-Z unstable-options` flag must also be passed to \\\n-                     enable the target-spec-json print option\",\n+                    &format!(\"unknown print request `{req}`. Valid print requests are: {prints}\"),\n                 );\n             }\n         }\n-        \"link-args\" => PrintRequest::LinkArgs,\n-        req => early_error(error_format, &format!(\"unknown print request `{req}`\")),\n     }));\n \n     prints"}, {"sha": "c325e536e7c5ddae75a10df485cf4e151fe73868", "filename": "src/test/run-make/valid-print-requests/Makefile", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c2affd504993072bdb7e04ade9816a5c88ce90e5/src%2Ftest%2Frun-make%2Fvalid-print-requests%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/c2affd504993072bdb7e04ade9816a5c88ce90e5/src%2Ftest%2Frun-make%2Fvalid-print-requests%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fvalid-print-requests%2FMakefile?ref=c2affd504993072bdb7e04ade9816a5c88ce90e5", "patch": "@@ -0,0 +1,4 @@\n+include ../../run-make-fulldeps/tools.mk\n+\n+all:\n+\t$(RUSTC) --print uwu 2>&1 | diff - valid-print-requests.stderr"}, {"sha": "85782866d125a2e25bc21952e2f107225075dd75", "filename": "src/test/run-make/valid-print-requests/valid-print-requests.stderr", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c2affd504993072bdb7e04ade9816a5c88ce90e5/src%2Ftest%2Frun-make%2Fvalid-print-requests%2Fvalid-print-requests.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c2affd504993072bdb7e04ade9816a5c88ce90e5/src%2Ftest%2Frun-make%2Fvalid-print-requests%2Fvalid-print-requests.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Fvalid-print-requests%2Fvalid-print-requests.stderr?ref=c2affd504993072bdb7e04ade9816a5c88ce90e5", "patch": "@@ -0,0 +1,2 @@\n+error: unknown print request `uwu`. Valid print requests are: `crate-name`, `file-names`, `sysroot`, `target-libdir`, `cfg`, `calling-conventions`, `target-list`, `target-cpus`, `target-features`, `relocation-models`, `code-models`, `tls-models`, `native-static-libs`, `stack-protector-strategies`, `target-spec-json`, `link-args`\n+"}]}