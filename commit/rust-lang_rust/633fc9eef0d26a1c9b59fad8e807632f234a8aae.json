{"sha": "633fc9eef0d26a1c9b59fad8e807632f234a8aae", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYzM2ZjOWVlZjBkMjZhMWM5YjU5ZmFkOGU4MDc2MzJmMjM0YThhYWU=", "commit": {"author": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2019-04-12T10:30:21Z"}, "committer": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2019-04-12T10:30:41Z"}, "message": "Revert PR #59401 to fix issue #59652 (a stable-to-beta regression).\n\nThis is result of squashing two revert commits:\n\nRevert \"compile all crates under test w/ -Zemit-stack-sizes\"\n\nThis reverts commit 7d365cf27f4249fc9b61ba8abfc813abe43f1cb7.\n\nRevert \"bootstrap: build compiler-builtins with -Z emit-stack-sizes\"\n\nThis reverts commit 8b8488ce8fc047282e7159343f30609417f9fa39.", "tree": {"sha": "e0a82b7947e9aec27b92f1a9a15573b3c39b6014", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e0a82b7947e9aec27b92f1a9a15573b3c39b6014"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/633fc9eef0d26a1c9b59fad8e807632f234a8aae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/633fc9eef0d26a1c9b59fad8e807632f234a8aae", "html_url": "https://github.com/rust-lang/rust/commit/633fc9eef0d26a1c9b59fad8e807632f234a8aae", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/633fc9eef0d26a1c9b59fad8e807632f234a8aae/comments", "author": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2226c09699a96520238e162777f44504f4a0a1a7", "url": "https://api.github.com/repos/rust-lang/rust/commits/2226c09699a96520238e162777f44504f4a0a1a7", "html_url": "https://github.com/rust-lang/rust/commit/2226c09699a96520238e162777f44504f4a0a1a7"}], "stats": {"total": 31, "additions": 0, "deletions": 31}, "files": [{"sha": "a76584093fc760acd40ba40dee4574a9e58973d7", "filename": "src/bootstrap/bin/rustc.rs", "status": "modified", "additions": 0, "deletions": 27, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/633fc9eef0d26a1c9b59fad8e807632f234a8aae/src%2Fbootstrap%2Fbin%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/633fc9eef0d26a1c9b59fad8e807632f234a8aae/src%2Fbootstrap%2Fbin%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbin%2Frustc.rs?ref=633fc9eef0d26a1c9b59fad8e807632f234a8aae", "patch": "@@ -187,33 +187,6 @@ fn main() {\n             cmd.arg(\"-C\").arg(format!(\"debug-assertions={}\", debug_assertions));\n         }\n \n-        // Build all crates in the `std` facade with `-Z emit-stack-sizes` to add stack usage\n-        // information.\n-        //\n-        // When you use this `-Z` flag with Cargo you get stack usage information on all crates\n-        // compiled from source, and when you are using LTO you also get information on pre-compiled\n-        // crates like `core` and `std`, even if they were not compiled with `-Z emit-stack-sizes`.\n-        // However, there's an exception: `compiler_builtins`. This crate is special and doesn't\n-        // participate in LTO because it's always linked as a separate object file. For this reason\n-        // it's impossible to get stack usage information about `compiler-builtins` using\n-        // `RUSTFLAGS` + Cargo, or `cargo rustc`.\n-        //\n-        // To make the stack usage information of all crates under the `std` facade available to\n-        // Cargo based stack usage analysis tools, in both LTO and non-LTO mode, we compile them\n-        // with the `-Z emit-stack-sizes` flag. The `RUSTC_EMIT_STACK_SIZES` var helps us apply this\n-        // flag only to the crates in the `std` facade. The `-Z` flag is known to currently work\n-        // with targets that produce ELF files so we limit its use flag to those targets.\n-        //\n-        // NOTE(japaric) if this ever causes problem with an LLVM upgrade or any PR feel free to\n-        // remove it or comment it out\n-        if env::var_os(\"RUSTC_EMIT_STACK_SIZES\").is_some()\n-            && (target.contains(\"-linux-\")\n-                || target.contains(\"-none-eabi\")\n-                || target.ends_with(\"-none-elf\"))\n-        {\n-            cmd.arg(\"-Zemit-stack-sizes\");\n-        }\n-\n         if let Ok(s) = env::var(\"RUSTC_CODEGEN_UNITS\") {\n             cmd.arg(\"-C\").arg(format!(\"codegen-units={}\", s));\n         }"}, {"sha": "66443d472d334718ce0b8bd3d8a05dcf4738139f", "filename": "src/bootstrap/compile.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/633fc9eef0d26a1c9b59fad8e807632f234a8aae/src%2Fbootstrap%2Fcompile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/633fc9eef0d26a1c9b59fad8e807632f234a8aae/src%2Fbootstrap%2Fcompile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcompile.rs?ref=633fc9eef0d26a1c9b59fad8e807632f234a8aae", "patch": "@@ -97,8 +97,6 @@ impl Step for Std {\n         let _folder = builder.fold_output(|| format!(\"stage{}-std\", compiler.stage));\n         builder.info(&format!(\"Building stage{} std artifacts ({} -> {})\", compiler.stage,\n                 &compiler.host, target));\n-        // compile with `-Z emit-stack-sizes`; see bootstrap/src/rustc.rs for more details\n-        cargo.env(\"RUSTC_EMIT_STACK_SIZES\", \"1\");\n         run_cargo(builder,\n                   &mut cargo,\n                   &libstd_stamp(builder, compiler, target),\n@@ -397,8 +395,6 @@ impl Step for Test {\n         let _folder = builder.fold_output(|| format!(\"stage{}-test\", compiler.stage));\n         builder.info(&format!(\"Building stage{} test artifacts ({} -> {})\", compiler.stage,\n                 &compiler.host, target));\n-        // compile with `-Z emit-stack-sizes`; see bootstrap/src/rustc.rs for more details\n-        cargo.env(\"RUSTC_EMIT_STACK_SIZES\", \"1\");\n         run_cargo(builder,\n                   &mut cargo,\n                   &libtest_stamp(builder, compiler, target),"}]}