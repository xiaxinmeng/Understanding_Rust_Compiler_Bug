{"sha": "996bc9abb53fca2c55ecd77b60d200687ad82da4", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk5NmJjOWFiYjUzZmNhMmM1NWVjZDc3YjYwZDIwMDY4N2FkODJkYTQ=", "commit": {"author": {"name": "David Wood", "email": "david@davidtw.co", "date": "2020-06-22T11:53:40Z"}, "committer": {"name": "David Wood", "email": "david@davidtw.co", "date": "2020-07-20T10:23:22Z"}, "message": "mir: avoid double substitution\n\nThis commit avoids a natural, free-range double substitution error by\nmonomorphizing the projection element before getting the type.\n\nSigned-off-by: David Wood <david@davidtw.co>", "tree": {"sha": "c16194a9c5941f8032525da0d75fbd3eac8c94c5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c16194a9c5941f8032525da0d75fbd3eac8c94c5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/996bc9abb53fca2c55ecd77b60d200687ad82da4", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEfgm2/wUjk9OnjxlyJZLnbIc4H9kFAl8VcJoACgkQJZLnbIc4\nH9ke2RAAkkCLEmUPEnph0qAA7NylXwebT14272+ne8/xzlBNXIFecixIQE4qSXcQ\nZ8nlhDOOATtfXohay9meNCMJG72DrKTdWKehH88pYRNbW/ehuzvqJDrsxYwtoP20\ncJPRqxHYmVACkS//O+2m3GtyiFJNb0uTMnRiZZB8FHoyk+VOmO2/sJhVyW+NuU+9\nx4IByVtTAmS0NS85GNZDhoHAYiT+FjtOmC5/rOMA3EoLJ+wVFu1mUS5Euu0zq9hV\nZ0htazytIYOCyu3Y+wWaIsCPwHuxzh7YcY+pTcIhpIRDIBezF+CN31ZFhJJD30Kg\nAtFasMAn/oKpDEjwA/Zl0taVRM3NU/imrn3IUxhCp4nH58cZyNUmhex5kIE1ALP3\nHnx5NVjyTFmnn15vcRu6+VhyTbbRlQPKaO0Qpq1POXdgVR1886TS4ZARsT35gap4\nydstXsbnuDROdd4tztymXB+tjljTxkkHnY8T5c7uvA763WWcc3HkXpCkcf7KITdn\nFWfWjpL/DtdVsWZrvvSuY7aWaxJ5JQ2xrpcWOsU7EqhnoRbcU6Rkehq3P9hpz7Hw\n8EDFI0Yh9UCgKm6c5QXSEcYcEbCOo2yRLB/zQapzDVGLex5l1LoC2F0V6O4KvU8I\n49ghhBgIzPJAifHPCHux+f+1YxnWwYUESctMwDo1dm6ZxVlxuBI=\n=8kJ2\n-----END PGP SIGNATURE-----", "payload": "tree c16194a9c5941f8032525da0d75fbd3eac8c94c5\nparent 05630b06fdf76c25c6ccf2e9ac3567592eae6c67\nauthor David Wood <david@davidtw.co> 1592826820 +0100\ncommitter David Wood <david@davidtw.co> 1595240602 +0100\n\nmir: avoid double substitution\n\nThis commit avoids a natural, free-range double substitution error by\nmonomorphizing the projection element before getting the type.\n\nSigned-off-by: David Wood <david@davidtw.co>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/996bc9abb53fca2c55ecd77b60d200687ad82da4", "html_url": "https://github.com/rust-lang/rust/commit/996bc9abb53fca2c55ecd77b60d200687ad82da4", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/996bc9abb53fca2c55ecd77b60d200687ad82da4/comments", "author": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidtwco", "id": 1295100, "node_id": "MDQ6VXNlcjEyOTUxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/1295100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidtwco", "html_url": "https://github.com/davidtwco", "followers_url": "https://api.github.com/users/davidtwco/followers", "following_url": "https://api.github.com/users/davidtwco/following{/other_user}", "gists_url": "https://api.github.com/users/davidtwco/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidtwco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidtwco/subscriptions", "organizations_url": "https://api.github.com/users/davidtwco/orgs", "repos_url": "https://api.github.com/users/davidtwco/repos", "events_url": "https://api.github.com/users/davidtwco/events{/privacy}", "received_events_url": "https://api.github.com/users/davidtwco/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "05630b06fdf76c25c6ccf2e9ac3567592eae6c67", "url": "https://api.github.com/repos/rust-lang/rust/commits/05630b06fdf76c25c6ccf2e9ac3567592eae6c67", "html_url": "https://github.com/rust-lang/rust/commit/05630b06fdf76c25c6ccf2e9ac3567592eae6c67"}], "stats": {"total": 3, "additions": 1, "deletions": 2}, "files": [{"sha": "2e386c1e5946bf141e409900e7eaba4a88338c19", "filename": "src/librustc_codegen_ssa/mir/analyze.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/996bc9abb53fca2c55ecd77b60d200687ad82da4/src%2Flibrustc_codegen_ssa%2Fmir%2Fanalyze.rs", "raw_url": "https://github.com/rust-lang/rust/raw/996bc9abb53fca2c55ecd77b60d200687ad82da4/src%2Flibrustc_codegen_ssa%2Fmir%2Fanalyze.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fmir%2Fanalyze.rs?ref=996bc9abb53fca2c55ecd77b60d200687ad82da4", "patch": "@@ -124,8 +124,7 @@ impl<Bx: BuilderMethods<'a, 'tcx>> LocalAnalyzer<'mir, 'a, 'tcx, Bx> {\n                 let base_ty = self.fx.monomorphize(&base_ty);\n \n                 // ZSTs don't require any actual memory access.\n-                let elem_ty = base_ty.projection_ty(cx.tcx(), elem).ty;\n-                let elem_ty = self.fx.monomorphize(&elem_ty);\n+                let elem_ty = base_ty.projection_ty(cx.tcx(), self.fx.monomorphize(&elem)).ty;\n                 let span = self.fx.mir.local_decls[place_ref.local].source_info.span;\n                 if cx.spanned_layout_of(elem_ty, span).is_zst() {\n                     return;"}]}