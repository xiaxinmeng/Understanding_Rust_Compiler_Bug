{"sha": "201fbac8a97ba240ba6112c8f3ceca9ed1f23a3d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIwMWZiYWM4YTk3YmEyNDBiYTYxMTJjOGYzY2VjYTllZDFmMjNhM2Q=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2021-03-27T17:50:55Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2021-03-27T17:50:55Z"}, "message": "Fix handling of multi-cursor snippets\n\nThis allows one snippet per TextEdit, multiple in the same TextEdit\nare still broken", "tree": {"sha": "a42dff4c49d713a6d57140800d3dd3254a7d3dcc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a42dff4c49d713a6d57140800d3dd3254a7d3dcc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/201fbac8a97ba240ba6112c8f3ceca9ed1f23a3d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/201fbac8a97ba240ba6112c8f3ceca9ed1f23a3d", "html_url": "https://github.com/rust-lang/rust/commit/201fbac8a97ba240ba6112c8f3ceca9ed1f23a3d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/201fbac8a97ba240ba6112c8f3ceca9ed1f23a3d/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e39979aa91c8c08219e35a74ae5aa7aa5d8bc4d6", "url": "https://api.github.com/repos/rust-lang/rust/commits/e39979aa91c8c08219e35a74ae5aa7aa5d8bc4d6", "html_url": "https://github.com/rust-lang/rust/commit/e39979aa91c8c08219e35a74ae5aa7aa5d8bc4d6"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "c8e71341a7da3d90024258be249509169adc99c6", "filename": "editors/code/src/snippets.ts", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/201fbac8a97ba240ba6112c8f3ceca9ed1f23a3d/editors%2Fcode%2Fsrc%2Fsnippets.ts", "raw_url": "https://github.com/rust-lang/rust/raw/201fbac8a97ba240ba6112c8f3ceca9ed1f23a3d/editors%2Fcode%2Fsrc%2Fsnippets.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fsnippets.ts?ref=201fbac8a97ba240ba6112c8f3ceca9ed1f23a3d", "patch": "@@ -29,7 +29,7 @@ async function editorFromUri(uri: vscode.Uri): Promise<vscode.TextEditor | undef\n }\n \n export async function applySnippetTextEdits(editor: vscode.TextEditor, edits: vscode.TextEdit[]) {\n-    let selection: vscode.Selection | undefined = undefined;\n+    let selections: vscode.Selection[] = [];\n     let lineDelta = 0;\n     await editor.edit((builder) => {\n         for (const indel of edits) {\n@@ -44,18 +44,18 @@ export async function applySnippetTextEdits(editor: vscode.TextEditor, edits: vs\n                     indel.range.start.character + placeholderStart\n                     : prefix.length - lastNewline - 1;\n                 const endColumn = startColumn + placeholderLength;\n-                selection = new vscode.Selection(\n+                selections.push(new vscode.Selection(\n                     new vscode.Position(startLine, startColumn),\n                     new vscode.Position(startLine, endColumn),\n-                );\n+                ));\n                 builder.replace(indel.range, newText);\n             } else {\n-                lineDelta = countLines(indel.newText) - (indel.range.end.line - indel.range.start.line);\n                 builder.replace(indel.range, indel.newText);\n             }\n+            lineDelta = countLines(indel.newText) - (indel.range.end.line - indel.range.start.line);\n         }\n     });\n-    if (selection) editor.selection = selection;\n+    if (selections.length > 0) editor.selections = selections;\n }\n \n function parseSnippet(snip: string): [string, [number, number]] | undefined {"}]}