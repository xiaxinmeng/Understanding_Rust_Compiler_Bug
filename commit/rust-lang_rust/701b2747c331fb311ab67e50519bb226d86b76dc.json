{"sha": "701b2747c331fb311ab67e50519bb226d86b76dc", "node_id": "C_kwDOAAsO6NoAKDcwMWIyNzQ3YzMzMWZiMzExYWI2N2U1MDUxOWJiMjI2ZDg2Yjc2ZGM", "commit": {"author": {"name": "bjorn3", "email": "17426603+bjorn3@users.noreply.github.com", "date": "2022-08-17T13:03:32Z"}, "committer": {"name": "bjorn3", "email": "17426603+bjorn3@users.noreply.github.com", "date": "2022-08-17T13:03:32Z"}, "message": "Remove optimize_function\n\nIt currently doesn't have any optimizations at all.", "tree": {"sha": "7d4d5e3aab0a7b91b5f90f53df241be9ad77c2fc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7d4d5e3aab0a7b91b5f90f53df241be9ad77c2fc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/701b2747c331fb311ab67e50519bb226d86b76dc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/701b2747c331fb311ab67e50519bb226d86b76dc", "html_url": "https://github.com/rust-lang/rust/commit/701b2747c331fb311ab67e50519bb226d86b76dc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/701b2747c331fb311ab67e50519bb226d86b76dc/comments", "author": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bjorn3", "id": 17426603, "node_id": "MDQ6VXNlcjE3NDI2NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/17426603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bjorn3", "html_url": "https://github.com/bjorn3", "followers_url": "https://api.github.com/users/bjorn3/followers", "following_url": "https://api.github.com/users/bjorn3/following{/other_user}", "gists_url": "https://api.github.com/users/bjorn3/gists{/gist_id}", "starred_url": "https://api.github.com/users/bjorn3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bjorn3/subscriptions", "organizations_url": "https://api.github.com/users/bjorn3/orgs", "repos_url": "https://api.github.com/users/bjorn3/repos", "events_url": "https://api.github.com/users/bjorn3/events{/privacy}", "received_events_url": "https://api.github.com/users/bjorn3/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1cac888e4361aea0abbaf8c0ee52509f1742bfe0", "url": "https://api.github.com/repos/rust-lang/rust/commits/1cac888e4361aea0abbaf8c0ee52509f1742bfe0", "html_url": "https://github.com/rust-lang/rust/commit/1cac888e4361aea0abbaf8c0ee52509f1742bfe0"}], "stats": {"total": 30, "additions": 1, "deletions": 29}, "files": [{"sha": "2603da19182805f76dc7f6f5e09cc66901ea74d3", "filename": "src/base.rs", "status": "modified", "additions": 1, "deletions": 12, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/701b2747c331fb311ab67e50519bb226d86b76dc/src%2Fbase.rs", "raw_url": "https://github.com/rust-lang/rust/raw/701b2747c331fb311ab67e50519bb226d86b76dc/src%2Fbase.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbase.rs?ref=701b2747c331fb311ab67e50519bb226d86b76dc", "patch": "@@ -148,7 +148,7 @@ fn compile_fn<'tcx>(\n ) {\n     let tcx = cx.tcx;\n \n-    let mut clif_comments = codegened_func.clif_comments;\n+    let clif_comments = codegened_func.clif_comments;\n \n     // Store function in context\n     let context = cached_context;\n@@ -165,17 +165,6 @@ fn compile_fn<'tcx>(\n     // invalidate it when it would change.\n     context.domtree.clear();\n \n-    // Perform rust specific optimizations\n-    tcx.sess.time(\"optimize clif ir\", || {\n-        crate::optimize::optimize_function(\n-            tcx,\n-            module.isa(),\n-            codegened_func.instance,\n-            context,\n-            &mut clif_comments,\n-        );\n-    });\n-\n     #[cfg(any())] // This is never true\n     let _clif_guard = {\n         use std::fmt::Write;"}, {"sha": "0df7e82294bd23521b72225d3746116488cac4d3", "filename": "src/optimize/mod.rs", "status": "modified", "additions": 0, "deletions": 17, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/701b2747c331fb311ab67e50519bb226d86b76dc/src%2Foptimize%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/701b2747c331fb311ab67e50519bb226d86b76dc/src%2Foptimize%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Foptimize%2Fmod.rs?ref=701b2747c331fb311ab67e50519bb226d86b76dc", "patch": "@@ -1,20 +1,3 @@\n //! Various optimizations specific to cg_clif\n \n-use cranelift_codegen::isa::TargetIsa;\n-\n-use crate::prelude::*;\n-\n pub(crate) mod peephole;\n-\n-pub(crate) fn optimize_function<'tcx>(\n-    tcx: TyCtxt<'tcx>,\n-    isa: &dyn TargetIsa,\n-    instance: Instance<'tcx>,\n-    ctx: &mut Context,\n-    clif_comments: &mut crate::pretty_clif::CommentWriter,\n-) {\n-    // FIXME classify optimizations over opt levels once we have more\n-\n-    crate::pretty_clif::write_clif_file(tcx, \"preopt\", isa, instance, &ctx.func, &*clif_comments);\n-    crate::base::verify_func(tcx, &*clif_comments, &ctx.func);\n-}"}]}