{"sha": "843c5e361e1b392f89f71ac26a951f8dfd84e43a", "node_id": "C_kwDOAAsO6NoAKDg0M2M1ZTM2MWUxYjM5MmY4OWY3MWFjMjZhOTUxZjhkZmQ4NGU0M2E", "commit": {"author": {"name": "Scott McMurray", "email": "scottmcm@users.noreply.github.com", "date": "2023-03-29T07:04:14Z"}, "committer": {"name": "Scott McMurray", "email": "scottmcm@users.noreply.github.com", "date": "2023-03-29T07:27:24Z"}, "message": "Rename `IndexVec::last` \u2192 `last_index`\n\nAs I've been trying to replace a `Vec` with an `IndexVec`, having `last` exist on both but returning very different types makes the transition a bit awkward -- the errors are later, where you get things like \"there's no `ty` method on `mir::Field`\" rather than a more localized error like \"hey, there's no `last` on `IndexVec`\".\n\nSo I propose renaming `last` to `last_index` to help distinguish `Vec::last`, which returns an element, and `IndexVec::last_index`, which returns an index.\n\n(Similarly, `Iterator::last` also returns an element, not an index.)", "tree": {"sha": "5106cd6b277eee2df25859b85fc1576721683ff8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5106cd6b277eee2df25859b85fc1576721683ff8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/843c5e361e1b392f89f71ac26a951f8dfd84e43a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/843c5e361e1b392f89f71ac26a951f8dfd84e43a", "html_url": "https://github.com/rust-lang/rust/commit/843c5e361e1b392f89f71ac26a951f8dfd84e43a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/843c5e361e1b392f89f71ac26a951f8dfd84e43a/comments", "author": {"login": "scottmcm", "id": 18526288, "node_id": "MDQ6VXNlcjE4NTI2Mjg4", "avatar_url": "https://avatars.githubusercontent.com/u/18526288?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scottmcm", "html_url": "https://github.com/scottmcm", "followers_url": "https://api.github.com/users/scottmcm/followers", "following_url": "https://api.github.com/users/scottmcm/following{/other_user}", "gists_url": "https://api.github.com/users/scottmcm/gists{/gist_id}", "starred_url": "https://api.github.com/users/scottmcm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scottmcm/subscriptions", "organizations_url": "https://api.github.com/users/scottmcm/orgs", "repos_url": "https://api.github.com/users/scottmcm/repos", "events_url": "https://api.github.com/users/scottmcm/events{/privacy}", "received_events_url": "https://api.github.com/users/scottmcm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "scottmcm", "id": 18526288, "node_id": "MDQ6VXNlcjE4NTI2Mjg4", "avatar_url": "https://avatars.githubusercontent.com/u/18526288?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scottmcm", "html_url": "https://github.com/scottmcm", "followers_url": "https://api.github.com/users/scottmcm/followers", "following_url": "https://api.github.com/users/scottmcm/following{/other_user}", "gists_url": "https://api.github.com/users/scottmcm/gists{/gist_id}", "starred_url": "https://api.github.com/users/scottmcm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scottmcm/subscriptions", "organizations_url": "https://api.github.com/users/scottmcm/orgs", "repos_url": "https://api.github.com/users/scottmcm/repos", "events_url": "https://api.github.com/users/scottmcm/events{/privacy}", "received_events_url": "https://api.github.com/users/scottmcm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "acd27bb5572553a4dc9a2d6f21d9a3a68ff8a233", "url": "https://api.github.com/repos/rust-lang/rust/commits/acd27bb5572553a4dc9a2d6f21d9a3a68ff8a233", "html_url": "https://github.com/rust-lang/rust/commit/acd27bb5572553a4dc9a2d6f21d9a3a68ff8a233"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "40c848de2beedc23a39d1e4ab60fdcf04897f1b9", "filename": "compiler/rustc_const_eval/src/transform/promote_consts.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/843c5e361e1b392f89f71ac26a951f8dfd84e43a/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fpromote_consts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/843c5e361e1b392f89f71ac26a951f8dfd84e43a/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fpromote_consts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_const_eval%2Fsrc%2Ftransform%2Fpromote_consts.rs?ref=843c5e361e1b392f89f71ac26a951f8dfd84e43a", "patch": "@@ -707,7 +707,7 @@ impl<'a, 'tcx> Promoter<'a, 'tcx> {\n     }\n \n     fn assign(&mut self, dest: Local, rvalue: Rvalue<'tcx>, span: Span) {\n-        let last = self.promoted.basic_blocks.last().unwrap();\n+        let last = self.promoted.basic_blocks.last_index().unwrap();\n         let data = &mut self.promoted[last];\n         data.statements.push(Statement {\n             source_info: SourceInfo::outermost(span),\n@@ -800,7 +800,7 @@ impl<'a, 'tcx> Promoter<'a, 'tcx> {\n                         self.visit_operand(arg, loc);\n                     }\n \n-                    let last = self.promoted.basic_blocks.last().unwrap();\n+                    let last = self.promoted.basic_blocks.last_index().unwrap();\n                     let new_target = self.new_block();\n \n                     *self.promoted[last].terminator_mut() = Terminator {"}, {"sha": "acf883fe90cecabc0d58c9b28d44ecee44eff93e", "filename": "compiler/rustc_index/src/vec.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/843c5e361e1b392f89f71ac26a951f8dfd84e43a/compiler%2Frustc_index%2Fsrc%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/843c5e361e1b392f89f71ac26a951f8dfd84e43a/compiler%2Frustc_index%2Fsrc%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_index%2Fsrc%2Fvec.rs?ref=843c5e361e1b392f89f71ac26a951f8dfd84e43a", "patch": "@@ -216,7 +216,7 @@ impl<I: Idx, T> IndexVec<I, T> {\n     }\n \n     #[inline]\n-    pub fn last(&self) -> Option<I> {\n+    pub fn last_index(&self) -> Option<I> {\n         self.len().checked_sub(1).map(I::new)\n     }\n "}, {"sha": "59b506e7345537ed738a00b7a7f02dfa3bf3bc53", "filename": "compiler/rustc_mir_transform/src/coverage/tests.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/843c5e361e1b392f89f71ac26a951f8dfd84e43a/compiler%2Frustc_mir_transform%2Fsrc%2Fcoverage%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/843c5e361e1b392f89f71ac26a951f8dfd84e43a/compiler%2Frustc_mir_transform%2Fsrc%2Fcoverage%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_mir_transform%2Fsrc%2Fcoverage%2Ftests.rs?ref=843c5e361e1b392f89f71ac26a951f8dfd84e43a", "patch": "@@ -65,7 +65,7 @@ impl<'tcx> MockBlocks<'tcx> {\n     }\n \n     fn push(&mut self, kind: TerminatorKind<'tcx>) -> BasicBlock {\n-        let next_lo = if let Some(last) = self.blocks.last() {\n+        let next_lo = if let Some(last) = self.blocks.last_index() {\n             self.blocks[last].terminator().source_info.span.hi()\n         } else {\n             BytePos(1)"}, {"sha": "717905e55e5730e752e6bc1353cba77fe4848799", "filename": "compiler/rustc_trait_selection/src/solve/search_graph/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/843c5e361e1b392f89f71ac26a951f8dfd84e43a/compiler%2Frustc_trait_selection%2Fsrc%2Fsolve%2Fsearch_graph%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/843c5e361e1b392f89f71ac26a951f8dfd84e43a/compiler%2Frustc_trait_selection%2Fsrc%2Fsolve%2Fsearch_graph%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Fsolve%2Fsearch_graph%2Fmod.rs?ref=843c5e361e1b392f89f71ac26a951f8dfd84e43a", "patch": "@@ -54,7 +54,7 @@ impl<'tcx> SearchGraph<'tcx> {\n     /// Whether we're currently in a cycle. This should only be used\n     /// for debug assertions.\n     pub(super) fn in_cycle(&self) -> bool {\n-        if let Some(stack_depth) = self.stack.last() {\n+        if let Some(stack_depth) = self.stack.last_index() {\n             // Either the current goal on the stack is the root of a cycle...\n             if self.stack[stack_depth].has_been_used {\n                 return true;"}]}