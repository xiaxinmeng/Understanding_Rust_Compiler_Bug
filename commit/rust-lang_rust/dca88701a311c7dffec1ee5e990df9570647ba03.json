{"sha": "dca88701a311c7dffec1ee5e990df9570647ba03", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRjYTg4NzAxYTMxMWM3ZGZmZWMxZWU1ZTk5MGRmOTU3MDY0N2JhMDM=", "commit": {"author": {"name": "Young-il Choi", "email": "duddlf.choi@samsung.com", "date": "2013-05-01T09:49:19Z"}, "committer": {"name": "Young-il Choi", "email": "duddlf.choi@samsung.com", "date": "2013-05-01T09:49:19Z"}, "message": "mk: install-runtime-target added to install.mk (pushing shared library to android target)", "tree": {"sha": "86d22c0cb299fa34a0ccc4aae912794a7a9892f0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/86d22c0cb299fa34a0ccc4aae912794a7a9892f0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dca88701a311c7dffec1ee5e990df9570647ba03", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dca88701a311c7dffec1ee5e990df9570647ba03", "html_url": "https://github.com/rust-lang/rust/commit/dca88701a311c7dffec1ee5e990df9570647ba03", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dca88701a311c7dffec1ee5e990df9570647ba03/comments", "author": {"login": "yichoi", "id": 3222276, "node_id": "MDQ6VXNlcjMyMjIyNzY=", "avatar_url": "https://avatars.githubusercontent.com/u/3222276?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yichoi", "html_url": "https://github.com/yichoi", "followers_url": "https://api.github.com/users/yichoi/followers", "following_url": "https://api.github.com/users/yichoi/following{/other_user}", "gists_url": "https://api.github.com/users/yichoi/gists{/gist_id}", "starred_url": "https://api.github.com/users/yichoi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yichoi/subscriptions", "organizations_url": "https://api.github.com/users/yichoi/orgs", "repos_url": "https://api.github.com/users/yichoi/repos", "events_url": "https://api.github.com/users/yichoi/events{/privacy}", "received_events_url": "https://api.github.com/users/yichoi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "yichoi", "id": 3222276, "node_id": "MDQ6VXNlcjMyMjIyNzY=", "avatar_url": "https://avatars.githubusercontent.com/u/3222276?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yichoi", "html_url": "https://github.com/yichoi", "followers_url": "https://api.github.com/users/yichoi/followers", "following_url": "https://api.github.com/users/yichoi/following{/other_user}", "gists_url": "https://api.github.com/users/yichoi/gists{/gist_id}", "starred_url": "https://api.github.com/users/yichoi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yichoi/subscriptions", "organizations_url": "https://api.github.com/users/yichoi/orgs", "repos_url": "https://api.github.com/users/yichoi/repos", "events_url": "https://api.github.com/users/yichoi/events{/privacy}", "received_events_url": "https://api.github.com/users/yichoi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bfccfdc78065752079a3863db19ca7148ade3e6f", "url": "https://api.github.com/repos/rust-lang/rust/commits/bfccfdc78065752079a3863db19ca7148ade3e6f", "html_url": "https://github.com/rust-lang/rust/commit/bfccfdc78065752079a3863db19ca7148ade3e6f"}], "stats": {"total": 63, "additions": 63, "deletions": 0}, "files": [{"sha": "693589980ce039b34e523c4f2ea6c4cf8e863d33", "filename": "mk/install.mk", "status": "modified", "additions": 63, "deletions": 0, "changes": 63, "blob_url": "https://github.com/rust-lang/rust/blob/dca88701a311c7dffec1ee5e990df9570647ba03/mk%2Finstall.mk", "raw_url": "https://github.com/rust-lang/rust/raw/dca88701a311c7dffec1ee5e990df9570647ba03/mk%2Finstall.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Finstall.mk?ref=dca88701a311c7dffec1ee5e990df9570647ba03", "patch": "@@ -154,3 +154,66 @@ uninstall:\n         done\n \t$(Q)rm -Rf $(PHL)/rustc\n \t$(Q)rm -f $(PREFIX_ROOT)/share/man/man1/rustc.1\n+\n+# target platform specific variables\n+# for arm-linux-androidabi\n+define DEF_ADB_STATUS\n+CFG_ADB_DEVICE=$(1)\n+endef\n+\n+$(foreach target,$(CFG_TARGET_TRIPLES), \\\n+  $(if $(findstring $(target),\"arm-linux-androideabi\"), \\\n+    $(if $(findstring adb,$(shell which adb)), \\\n+      $(if $(findstring device,$(shell adb devices 2>/dev/null | grep -E '^[A-Za-z0-9]+[[:blank:]]+device')), \\\n+        $(info install: install-runtime-target for arm-linux-androideabi enabled \\\n+          $(info install: android device attached) \\\n+          $(eval $(call DEF_ADB_STATUS, true))), \\\n+        $(info install: install-runtime-target for arm-linux-androideabi disabled \\\n+          $(info install: android device not attached) \\\n+          $(eval $(call DEF_ADB_STATUS, false))) \\\n+      ), \\\n+      $(info install: install-runtime-target for arm-linux-androideabi disabled \\\n+        $(info install: adb not found) \\\n+        $(eval $(call DEF_ADB_STATUS, false))) \\\n+    ), \\\n+  ) \\\n+)\n+\n+ifeq ($(CFG_ADB_DEVICE),true)\n+\n+ifdef VERBOSE\n+ ADB = adb $(1)\n+ ADB_PUSH = adb push $(1) $(2)\n+ ADB_SHELL = adb shell $(1) $(2) \n+else\n+ ADB = $(Q)$(call E, adb $(1)) && adb $(1) 1>/dev/null 2>/dev/null\n+ ADB_PUSH = $(Q)$(call E, adb push $(1)) && adb push $(1) $(2) 1>/dev/null 2>/dev/null\n+ ADB_SHELL = $(Q)$(call E, adb shell $(1) $(2)) && adb shell $(1) $(2) 1>/dev/null 2>/dev/null\n+endif\n+\n+define INSTALL_RUNTIME_TARGET_N\n+install-runtime-target-$(1)-host-$(2): $$(TSREQ$$(ISTAGE)_T_$(1)_H_$(2)) $$(SREQ$$(ISTAGE)_T_$(1)_H_$(2))\n+\t$(Q)$(call ADB_PUSH,$$(TL$(1)$(2))/$$(CFG_RUNTIME_$(1)),/system/lib)\n+\t$(Q)$(call ADB_PUSH,$$(TL$(1)$(2))/$$(CORELIB_GLOB_$(1)),/system/lib)\n+\t$(Q)$(call ADB_PUSH,$$(TL$(1)$(2))/$$(STDLIB_GLOB_$(1)),/system/lib)\n+endef\n+\n+define INSTALL_RUNTIME_TARGET_CLEANUP_N\n+install-runtime-target-$(1)-cleanup:\n+\t$(Q)$(call ADB,remount)\n+\t$(Q)$(call ADB_SHELL,rm,/system/lib/$(CFG_RUNTIME_$(1)))\n+\t$(Q)$(call ADB_SHELL,rm,/system/lib/$(CORELIB_GLOB_$(1)))\n+\t$(Q)$(call ADB_SHELL,rm,/system/lib/$(STDLIB_GLOB_$(1)))\n+endef\n+\n+$(eval $(call INSTALL_RUNTIME_TARGET_N,arm-linux-androideabi,$(CFG_BUILD_TRIPLE)))\n+$(eval $(call INSTALL_RUNTIME_TARGET_CLEANUP_N,arm-linux-androideabi))\n+\n+install-runtime-target: \\\n+\tinstall-runtime-target-arm-linux-androideabi-cleanup \\\n+\tinstall-runtime-target-arm-linux-androideabi-host-$(CFG_BUILD_TRIPLE)\n+\n+else\n+install-runtime-target: \n+\t@echo\n+endif"}]}