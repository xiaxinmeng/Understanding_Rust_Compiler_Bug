{"sha": "2facd9517f0c58430514b9e4aa41f5996c994747", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJmYWNkOTUxN2YwYzU4NDMwNTE0YjllNGFhNDFmNTk5NmM5OTQ3NDc=", "commit": {"author": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2020-12-08T12:47:58Z"}, "committer": {"name": "Lukas Wirth", "email": "lukastw97@gmail.com", "date": "2020-12-08T12:47:58Z"}, "message": "Escape string literals in Attr::from_src", "tree": {"sha": "38b6790b6e7c422a8989f158a2f1b80ee1e1dc81", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/38b6790b6e7c422a8989f158a2f1b80ee1e1dc81"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2facd9517f0c58430514b9e4aa41f5996c994747", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2facd9517f0c58430514b9e4aa41f5996c994747", "html_url": "https://github.com/rust-lang/rust/commit/2facd9517f0c58430514b9e4aa41f5996c994747", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2facd9517f0c58430514b9e4aa41f5996c994747/comments", "author": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Veykril", "id": 3757771, "node_id": "MDQ6VXNlcjM3NTc3NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/3757771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Veykril", "html_url": "https://github.com/Veykril", "followers_url": "https://api.github.com/users/Veykril/followers", "following_url": "https://api.github.com/users/Veykril/following{/other_user}", "gists_url": "https://api.github.com/users/Veykril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Veykril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Veykril/subscriptions", "organizations_url": "https://api.github.com/users/Veykril/orgs", "repos_url": "https://api.github.com/users/Veykril/repos", "events_url": "https://api.github.com/users/Veykril/events{/privacy}", "received_events_url": "https://api.github.com/users/Veykril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7a338e520729d5198fb233c6d94d33f1ae365b24", "url": "https://api.github.com/repos/rust-lang/rust/commits/7a338e520729d5198fb233c6d94d33f1ae365b24", "html_url": "https://github.com/rust-lang/rust/commit/7a338e520729d5198fb233c6d94d33f1ae365b24"}], "stats": {"total": 18, "additions": 6, "deletions": 12}, "files": [{"sha": "12f4b02e2990171aa14c5995b282d2a94e9c545e", "filename": "crates/hir_def/src/attr.rs", "status": "modified", "additions": 5, "deletions": 11, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/2facd9517f0c58430514b9e4aa41f5996c994747/crates%2Fhir_def%2Fsrc%2Fattr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2facd9517f0c58430514b9e4aa41f5996c994747/crates%2Fhir_def%2Fsrc%2Fattr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fattr.rs?ref=2facd9517f0c58430514b9e4aa41f5996c994747", "patch": "@@ -166,16 +166,16 @@ impl Attrs {\n     }\n \n     pub fn docs(&self) -> Option<Documentation> {\n-        let mut docs = String::new();\n-        self.by_key(\"doc\")\n+        let docs = self\n+            .by_key(\"doc\")\n             .attrs()\n             .flat_map(|attr| match attr.input.as_ref()? {\n                 AttrInput::Literal(s) => Some(s),\n                 AttrInput::TokenTree(_) => None,\n             })\n             .intersperse(&SmolStr::new_inline(\"\\n\"))\n-            // No FromIterator<SmolStr> for String\n-            .for_each(|s| docs.push_str(s.as_str()));\n+            .map(|it| it.as_str())\n+            .collect::<String>();\n         if docs.is_empty() {\n             None\n         } else {\n@@ -202,14 +202,8 @@ impl Attr {\n     fn from_src(ast: ast::Attr, hygiene: &Hygiene) -> Option<Attr> {\n         let path = ModPath::from_src(ast.path()?, hygiene)?;\n         let input = if let Some(lit) = ast.literal() {\n-            // FIXME: escape?\n             let value = match lit.kind() {\n-                ast::LiteralKind::String(string) if string.is_raw() => {\n-                    let text = string.text().as_str();\n-                    let text = &text[string.text_range_between_quotes()?\n-                        - string.syntax().text_range().start()];\n-                    text.into()\n-                }\n+                ast::LiteralKind::String(string) => string.value()?.into(),\n                 _ => lit.syntax().first_token()?.text().trim_matches('\"').into(),\n             };\n             Some(AttrInput::Literal(value))"}, {"sha": "e80b593aabc57ab11de5095fb291acd5611535e0", "filename": "crates/hir_def/src/nameres/tests/mod_resolution.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2facd9517f0c58430514b9e4aa41f5996c994747/crates%2Fhir_def%2Fsrc%2Fnameres%2Ftests%2Fmod_resolution.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2facd9517f0c58430514b9e4aa41f5996c994747/crates%2Fhir_def%2Fsrc%2Fnameres%2Ftests%2Fmod_resolution.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fhir_def%2Fsrc%2Fnameres%2Ftests%2Fmod_resolution.rs?ref=2facd9517f0c58430514b9e4aa41f5996c994747", "patch": "@@ -372,7 +372,7 @@ fn module_resolution_explicit_path_mod_rs_with_win_separator() {\n     check(\n         r#\"\n //- /main.rs\n-#[path = \"module\\bar\\mod.rs\"]\n+#[path = r\"module\\bar\\mod.rs\"]\n mod foo;\n \n //- /module/bar/mod.rs"}]}