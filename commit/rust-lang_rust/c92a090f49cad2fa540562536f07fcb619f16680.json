{"sha": "c92a090f49cad2fa540562536f07fcb619f16680", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM5MmEwOTBmNDljYWQyZmE1NDA1NjI1MzZmMDdmY2I2MTlmMTY2ODA=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-01-06T21:25:13Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-01-06T21:25:13Z"}, "message": "Merge #2753\n\n2753: Fix a problem with `Durability` of libraries r=matklad a=michalt\n\nWhen processing a change with added libraries, we used\r\n`Default::default` for `SourceRoot` which sets `is_library` to false.\r\nSince we use `is_library` to decide whether to use low or high\r\ndurability, I believe that this caused us to mark many library\r\ndependencies as having low durability and thus increased the size of the\r\ngraph that salsa needed to verify on every change.\r\n\r\nBased on my initial tests this speeds up the `CrateDefMapQuery` on\r\nrust-analyzer from about ~64ms to ~14ms and reduces the number of\r\nvalidations for the query from over 60k to about 7k.\r\n\r\nSigned-off-by: Michal Terepeta <michal.terepeta@gmail.com>\n\nCo-authored-by: Michal Terepeta <michal.terepeta@gmail.com>", "tree": {"sha": "6a28cc8aa0172f54b0a0e659b9f45eca7aac7f91", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6a28cc8aa0172f54b0a0e659b9f45eca7aac7f91"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c92a090f49cad2fa540562536f07fcb619f16680", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeE6W5CRBK7hj4Ov3rIwAAdHIIAJUSYzHRxedyPwy1/WHtQ06+\nswbUg6jZmoyhMZY8z5yIYUZGz/u93mfx+W8yy8/e7D6PzoGK7/tsxvUlK0joKJcN\nJoPcSXQdrIAflvpgn9U+JhlRm+/JgQLs2F9Hk46qY3pH6CHFmgn2OoBrMxQiLrqM\n6lMZzLlUsOtoevVMK6hODTKCwxx5EDfBuMEvlqiZ3xgzt1Eyi+h3qKE6wf427h5S\nQ+AolREYNoThg7Sl96KbZlKv1yheI509QzZtxZUIAwp5udYZ4TmL5Rt78aB4lyYo\nkO10q/M4te4p5v/lIIE1XG2UNsXCGssGM1uAi16DZSlMptf9p1AdX5uAnVrtKsQ=\n=dMbL\n-----END PGP SIGNATURE-----\n", "payload": "tree 6a28cc8aa0172f54b0a0e659b9f45eca7aac7f91\nparent 07340a62cc1b34efcebfc9f4cfc42f655edd2fc8\nparent be967b94e15f238a6fe806e93359e302c43d0e45\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1578345913 +0000\ncommitter GitHub <noreply@github.com> 1578345913 +0000\n\nMerge #2753\n\n2753: Fix a problem with `Durability` of libraries r=matklad a=michalt\n\nWhen processing a change with added libraries, we used\r\n`Default::default` for `SourceRoot` which sets `is_library` to false.\r\nSince we use `is_library` to decide whether to use low or high\r\ndurability, I believe that this caused us to mark many library\r\ndependencies as having low durability and thus increased the size of the\r\ngraph that salsa needed to verify on every change.\r\n\r\nBased on my initial tests this speeds up the `CrateDefMapQuery` on\r\nrust-analyzer from about ~64ms to ~14ms and reduces the number of\r\nvalidations for the query from over 60k to about 7k.\r\n\r\nSigned-off-by: Michal Terepeta <michal.terepeta@gmail.com>\n\nCo-authored-by: Michal Terepeta <michal.terepeta@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c92a090f49cad2fa540562536f07fcb619f16680", "html_url": "https://github.com/rust-lang/rust/commit/c92a090f49cad2fa540562536f07fcb619f16680", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c92a090f49cad2fa540562536f07fcb619f16680/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "07340a62cc1b34efcebfc9f4cfc42f655edd2fc8", "url": "https://api.github.com/repos/rust-lang/rust/commits/07340a62cc1b34efcebfc9f4cfc42f655edd2fc8", "html_url": "https://github.com/rust-lang/rust/commit/07340a62cc1b34efcebfc9f4cfc42f655edd2fc8"}, {"sha": "be967b94e15f238a6fe806e93359e302c43d0e45", "url": "https://api.github.com/repos/rust-lang/rust/commits/be967b94e15f238a6fe806e93359e302c43d0e45", "html_url": "https://github.com/rust-lang/rust/commit/be967b94e15f238a6fe806e93359e302c43d0e45"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "8b197d642d0ab76a919631abc35e11aff1115f38", "filename": "crates/ra_ide/src/change.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c92a090f49cad2fa540562536f07fcb619f16680/crates%2Fra_ide%2Fsrc%2Fchange.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c92a090f49cad2fa540562536f07fcb619f16680/crates%2Fra_ide%2Fsrc%2Fchange.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_ide%2Fsrc%2Fchange.rs?ref=c92a090f49cad2fa540562536f07fcb619f16680", "patch": "@@ -201,7 +201,7 @@ impl RootDatabase {\n                 libraries.push(library.root_id);\n                 self.set_source_root_with_durability(\n                     library.root_id,\n-                    Default::default(),\n+                    Arc::new(SourceRoot::new_library()),\n                     Durability::HIGH,\n                 );\n                 self.set_library_symbols_with_durability("}]}