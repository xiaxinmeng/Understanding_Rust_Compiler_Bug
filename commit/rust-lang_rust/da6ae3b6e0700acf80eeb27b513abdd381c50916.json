{"sha": "da6ae3b6e0700acf80eeb27b513abdd381c50916", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRhNmFlM2I2ZTA3MDBhY2Y4MGVlYjI3YjUxM2FiZGQzODFjNTA5MTY=", "commit": {"author": {"name": "Veetaha", "email": "gerzoh1@gmail.com", "date": "2020-02-13T20:21:19Z"}, "committer": {"name": "Veetaha", "email": "gerzoh1@gmail.com", "date": "2020-02-13T20:21:19Z"}, "message": "vscode: replaced DownloadFileError with NestedError itself for simplicity", "tree": {"sha": "b8787cb2e9ddd7988449c358904f83a8dee2e893", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b8787cb2e9ddd7988449c358904f83a8dee2e893"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/da6ae3b6e0700acf80eeb27b513abdd381c50916", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/da6ae3b6e0700acf80eeb27b513abdd381c50916", "html_url": "https://github.com/rust-lang/rust/commit/da6ae3b6e0700acf80eeb27b513abdd381c50916", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/da6ae3b6e0700acf80eeb27b513abdd381c50916/comments", "author": null, "committer": null, "parents": [{"sha": "a3febc1c574b9f99120b0e5bc860bf2458d0b919", "url": "https://api.github.com/repos/rust-lang/rust/commits/a3febc1c574b9f99120b0e5bc860bf2458d0b919", "html_url": "https://github.com/rust-lang/rust/commit/a3febc1c574b9f99120b0e5bc860bf2458d0b919"}], "stats": {"total": 13, "additions": 7, "deletions": 6}, "files": [{"sha": "591de0d31a40a29d9a1d092098dafd8e75db0617", "filename": "editors/code/src/installation/download_file.ts", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/da6ae3b6e0700acf80eeb27b513abdd381c50916/editors%2Fcode%2Fsrc%2Finstallation%2Fdownload_file.ts", "raw_url": "https://github.com/rust-lang/rust/raw/da6ae3b6e0700acf80eeb27b513abdd381c50916/editors%2Fcode%2Fsrc%2Finstallation%2Fdownload_file.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Finstallation%2Fdownload_file.ts?ref=da6ae3b6e0700acf80eeb27b513abdd381c50916", "patch": "@@ -7,8 +7,6 @@ import { NestedError } from \"ts-nested-error\";\n \n const pipeline = util.promisify(stream.pipeline);\n \n-class DownloadFileError extends NestedError {}\n-\n /**\n  * Downloads file from `url` and stores it at `destFilePath` with `destFilePermissions`.\n  * `onProgress` callback is called on recieveing each chunk of bytes\n@@ -21,13 +19,13 @@ export async function downloadFile(\n     destFilePermissions: number,\n     onProgress: (readBytes: number, totalBytes: number) => void\n ): Promise<void> {\n-    const res = await fetch(url).catch(DownloadFileError.rethrow(\"Failed at initial fetch\"));\n+    const res = await fetch(url).catch(NestedError.rethrow(\"Failed at initial fetch\"));\n \n     if (!res.ok) {\n         console.log(\"Error\", res.status, \"while downloading file from\", url);\n         console.dir({ body: await res.text(), headers: res.headers }, { depth: 3 });\n \n-        throw new DownloadFileError(`Got response ${res.status}`);\n+        throw new NestedError(`Got response ${res.status}`);\n     }\n \n     const totalBytes = Number(res.headers.get('content-length'));\n@@ -43,9 +41,12 @@ export async function downloadFile(\n \n     const destFileStream = fs.createWriteStream(destFilePath, { mode: destFilePermissions });\n \n-    await pipeline(res.body, destFileStream).catch(DownloadFileError.rethrow(\"Piping file error\"));\n+    await pipeline(res.body, destFileStream).catch(NestedError.rethrow(\"Piping file error\"));\n     return new Promise<void>(resolve => {\n-        destFileStream.on(\"close\", resolve); // details on workaround: https://github.com/rust-analyzer/rust-analyzer/pull/3092#discussion_r378191131\n+        destFileStream.on(\"close\", resolve);\n         destFileStream.destroy();\n+\n+        // Details on workaround: https://github.com/rust-analyzer/rust-analyzer/pull/3092#discussion_r378191131\n+        // Issue at nodejs repo: https://github.com/nodejs/node/issues/31776\n     });\n }"}]}