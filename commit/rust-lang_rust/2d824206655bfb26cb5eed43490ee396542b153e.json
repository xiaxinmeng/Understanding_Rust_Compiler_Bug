{"sha": "2d824206655bfb26cb5eed43490ee396542b153e", "node_id": "C_kwDOAAsO6NoAKDJkODI0MjA2NjU1YmZiMjZjYjVlZWQ0MzQ5MGVlMzk2NTQyYjE1M2U", "commit": {"author": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2023-01-15T22:36:46Z"}, "committer": {"name": "Esteban K\u00fcber", "email": "esteban@kuber.com.ar", "date": "2023-01-17T01:58:32Z"}, "message": "Teach parser to understand fake anonymous enum syntax\n\nParse `-> Ty | OtherTy`.\nParse type ascription in top level patterns.", "tree": {"sha": "0b46bf3dc0a6684a48c025d8f0ff0c298a107204", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0b46bf3dc0a6684a48c025d8f0ff0c298a107204"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2d824206655bfb26cb5eed43490ee396542b153e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2d824206655bfb26cb5eed43490ee396542b153e", "html_url": "https://github.com/rust-lang/rust/commit/2d824206655bfb26cb5eed43490ee396542b153e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2d824206655bfb26cb5eed43490ee396542b153e/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ae4d89dfb51535c1c43052ef848564bd2323c9ca", "url": "https://api.github.com/repos/rust-lang/rust/commits/ae4d89dfb51535c1c43052ef848564bd2323c9ca", "html_url": "https://github.com/rust-lang/rust/commit/ae4d89dfb51535c1c43052ef848564bd2323c9ca"}], "stats": {"total": 310, "additions": 270, "deletions": 40}, "files": [{"sha": "3aad51325dcd6c98a9ca4d736eb29d1debe5ceed", "filename": "compiler/rustc_ast/src/ast.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_ast%2Fsrc%2Fast.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_ast%2Fsrc%2Fast.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fast.rs?ref=2d824206655bfb26cb5eed43490ee396542b153e", "patch": "@@ -2096,6 +2096,9 @@ pub enum TyKind {\n     Err,\n     /// Placeholder for a `va_list`.\n     CVarArgs,\n+    /// Placeholder for \"anonymous enums\", which don't exist, but keeping their\n+    /// information around lets us produce better diagnostics.\n+    AnonEnum(Vec<P<Ty>>),\n }\n \n impl TyKind {"}, {"sha": "894885cf0fea7cd2fe23bbc192c22de101e242ed", "filename": "compiler/rustc_ast/src/mut_visit.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_ast%2Fsrc%2Fmut_visit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_ast%2Fsrc%2Fmut_visit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fmut_visit.rs?ref=2d824206655bfb26cb5eed43490ee396542b153e", "patch": "@@ -470,7 +470,7 @@ pub fn noop_visit_ty<T: MutVisitor>(ty: &mut P<Ty>, vis: &mut T) {\n             vis.visit_fn_decl(decl);\n             vis.visit_span(decl_span);\n         }\n-        TyKind::Tup(tys) => visit_vec(tys, |ty| vis.visit_ty(ty)),\n+        TyKind::AnonEnum(tys) | TyKind::Tup(tys) => visit_vec(tys, |ty| vis.visit_ty(ty)),\n         TyKind::Paren(ty) => vis.visit_ty(ty),\n         TyKind::Path(qself, path) => {\n             vis.visit_qself(qself);"}, {"sha": "1ab70f0309c0142e2ef9c41b5745906e24c817e1", "filename": "compiler/rustc_ast/src/visit.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_ast%2Fsrc%2Fvisit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_ast%2Fsrc%2Fvisit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast%2Fsrc%2Fvisit.rs?ref=2d824206655bfb26cb5eed43490ee396542b153e", "patch": "@@ -400,8 +400,8 @@ pub fn walk_ty<'a, V: Visitor<'a>>(visitor: &mut V, typ: &'a Ty) {\n             walk_list!(visitor, visit_lifetime, opt_lifetime, LifetimeCtxt::Ref);\n             visitor.visit_ty(&mutable_type.ty)\n         }\n-        TyKind::Tup(tuple_element_types) => {\n-            walk_list!(visitor, visit_ty, tuple_element_types);\n+        TyKind::AnonEnum(tys) | TyKind::Tup(tys) => {\n+            walk_list!(visitor, visit_ty, tys);\n         }\n         TyKind::BareFn(function_declaration) => {\n             walk_list!(visitor, visit_generic_param, &function_declaration.generic_params);"}, {"sha": "a60d02002da33d6648a6ce81cf920401afd53096", "filename": "compiler/rustc_ast_lowering/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_lowering%2Fsrc%2Flib.rs?ref=2d824206655bfb26cb5eed43490ee396542b153e", "patch": "@@ -1235,6 +1235,7 @@ impl<'a, 'hir> LoweringContext<'a, 'hir> {\n         let kind = match &t.kind {\n             TyKind::Infer => hir::TyKind::Infer,\n             TyKind::Err => hir::TyKind::Err,\n+            TyKind::AnonEnum(_) => hir::TyKind::Err,\n             TyKind::Slice(ty) => hir::TyKind::Slice(self.lower_ty(ty, itctx)),\n             TyKind::Ptr(mt) => hir::TyKind::Ptr(self.lower_mt(mt, itctx)),\n             TyKind::Ref(region, mt) => {"}, {"sha": "3f9b96a6158a16fb62b38d029068225a3ca8e138", "filename": "compiler/rustc_ast_pretty/src/pprust/state.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_ast_pretty%2Fsrc%2Fpprust%2Fstate.rs?ref=2d824206655bfb26cb5eed43490ee396542b153e", "patch": "@@ -1041,6 +1041,9 @@ impl<'a> State<'a> {\n                 }\n                 self.pclose();\n             }\n+            ast::TyKind::AnonEnum(elts) => {\n+                self.strsep(\"|\", false, Inconsistent, elts, |s, ty| s.print_type(ty));\n+            }\n             ast::TyKind::Paren(typ) => {\n                 self.popen();\n                 self.print_type(typ);"}, {"sha": "07bd76dc39ba9fee87694b885a0ed2ea207c785b", "filename": "compiler/rustc_parse/src/parser/diagnostics.rs", "status": "modified", "additions": 37, "deletions": 13, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs?ref=2d824206655bfb26cb5eed43490ee396542b153e", "patch": "@@ -2372,7 +2372,7 @@ impl<'a> Parser<'a> {\n \n     /// Some special error handling for the \"top-level\" patterns in a match arm,\n     /// `for` loop, `let`, &c. (in contrast to subpatterns within such).\n-    pub(crate) fn maybe_recover_colon_colon_in_pat_typo(\n+    pub(crate) fn maybe_recover_colon_colon_in_pat_typo_or_anon_enum(\n         &mut self,\n         mut first_pat: P<Pat>,\n         expected: Expected,\n@@ -2383,26 +2383,41 @@ impl<'a> Parser<'a> {\n         if !matches!(first_pat.kind, PatKind::Ident(_, _, None) | PatKind::Path(..))\n             || !self.look_ahead(1, |token| token.is_ident() && !token.is_reserved_ident())\n         {\n+            let mut snapshot_type = self.create_snapshot_for_diagnostic();\n+            snapshot_type.bump(); // `:`\n+            match snapshot_type.parse_ty() {\n+                Err(inner_err) => {\n+                    inner_err.cancel();\n+                }\n+                Ok(ty) => {\n+                    let Err(mut err) = self.expected_one_of_not_found(&[], &[]) else {\n+                        return first_pat;\n+                    };\n+                    err.span_label(ty.span, \"specifying the type of a pattern isn't supported\");\n+                    self.restore_snapshot(snapshot_type);\n+                    let span = first_pat.span.to(ty.span);\n+                    first_pat = self.mk_pat(span, PatKind::Wild);\n+                    err.emit();\n+                }\n+            }\n             return first_pat;\n         }\n         // The pattern looks like it might be a path with a `::` -> `:` typo:\n         // `match foo { bar:baz => {} }`\n-        let span = self.token.span;\n+        let colon_span = self.token.span;\n         // We only emit \"unexpected `:`\" error here if we can successfully parse the\n         // whole pattern correctly in that case.\n-        let snapshot = self.create_snapshot_for_diagnostic();\n+        let mut snapshot_pat = self.create_snapshot_for_diagnostic();\n+        let mut snapshot_type = self.create_snapshot_for_diagnostic();\n \n         // Create error for \"unexpected `:`\".\n         match self.expected_one_of_not_found(&[], &[]) {\n             Err(mut err) => {\n-                self.bump(); // Skip the `:`.\n-                match self.parse_pat_no_top_alt(expected) {\n+                snapshot_pat.bump(); // Skip the `:`.\n+                snapshot_type.bump(); // Skip the `:`.\n+                match snapshot_pat.parse_pat_no_top_alt(expected) {\n                     Err(inner_err) => {\n-                        // Carry on as if we had not done anything, callers will emit a\n-                        // reasonable error.\n                         inner_err.cancel();\n-                        err.cancel();\n-                        self.restore_snapshot(snapshot);\n                     }\n                     Ok(mut pat) => {\n                         // We've parsed the rest of the pattern.\n@@ -2466,22 +2481,31 @@ impl<'a> Parser<'a> {\n                             _ => {}\n                         }\n                         if show_sugg {\n-                            err.span_suggestion(\n-                                span,\n+                            err.span_suggestion_verbose(\n+                                colon_span.until(self.look_ahead(1, |t| t.span)),\n                                 \"maybe write a path separator here\",\n                                 \"::\",\n                                 Applicability::MaybeIncorrect,\n                             );\n                         } else {\n                             first_pat = self.mk_pat(new_span, PatKind::Wild);\n                         }\n-                        err.emit();\n+                        self.restore_snapshot(snapshot_pat);\n                     }\n                 }\n+                match snapshot_type.parse_ty() {\n+                    Err(inner_err) => {\n+                        inner_err.cancel();\n+                    }\n+                    Ok(ty) => {\n+                        err.span_label(ty.span, \"specifying the type of a pattern isn't supported\");\n+                        self.restore_snapshot(snapshot_type);\n+                    }\n+                }\n+                err.emit();\n             }\n             _ => {\n                 // Carry on as if we had not done anything. This should be unreachable.\n-                self.restore_snapshot(snapshot);\n             }\n         };\n         first_pat"}, {"sha": "e5411538eea220ce5ff179026be98d677b08dc67", "filename": "compiler/rustc_parse/src/parser/pat.rs", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fpat.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fpat.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fpat.rs?ref=2d824206655bfb26cb5eed43490ee396542b153e", "patch": "@@ -116,7 +116,8 @@ impl<'a> Parser<'a> {\n \n             // Check if the user wrote `foo:bar` instead of `foo::bar`.\n             if ra == RecoverColon::Yes {\n-                first_pat = self.maybe_recover_colon_colon_in_pat_typo(first_pat, expected);\n+                first_pat =\n+                    self.maybe_recover_colon_colon_in_pat_typo_or_anon_enum(first_pat, expected);\n             }\n \n             if let Some(leading_vert_span) = leading_vert_span {"}, {"sha": "72994df6f9f46fc69ef488bc232eafe360340192", "filename": "compiler/rustc_parse/src/parser/ty.rs", "status": "modified", "additions": 63, "deletions": 4, "changes": 67, "blob_url": "https://github.com/rust-lang/rust/blob/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fty.rs?ref=2d824206655bfb26cb5eed43490ee396542b153e", "patch": "@@ -11,6 +11,7 @@ use rustc_ast::{\n     self as ast, BareFnTy, FnRetTy, GenericBound, GenericBounds, GenericParam, Generics, Lifetime,\n     MacCall, MutTy, Mutability, PolyTraitRef, TraitBoundModifier, TraitObjectSyntax, Ty, TyKind,\n };\n+use rustc_ast_pretty::pprust;\n use rustc_errors::{pluralize, struct_span_err, Applicability, PResult};\n use rustc_span::source_map::Span;\n use rustc_span::symbol::{kw, sym, Ident};\n@@ -43,17 +44,24 @@ pub(super) enum AllowPlus {\n     No,\n }\n \n-#[derive(PartialEq)]\n+#[derive(PartialEq, Clone, Copy)]\n pub(super) enum RecoverQPath {\n     Yes,\n     No,\n }\n \n+#[derive(PartialEq, Clone, Copy)]\n pub(super) enum RecoverQuestionMark {\n     Yes,\n     No,\n }\n \n+#[derive(PartialEq, Clone, Copy)]\n+pub(super) enum RecoverAnonEnum {\n+    Yes,\n+    No,\n+}\n+\n /// Signals whether parsing a type should recover `->`.\n ///\n /// More specifically, when parsing a function like:\n@@ -86,7 +94,7 @@ impl RecoverReturnSign {\n }\n \n // Is `...` (`CVarArgs`) legal at this level of type parsing?\n-#[derive(PartialEq)]\n+#[derive(PartialEq, Clone, Copy)]\n enum AllowCVariadic {\n     Yes,\n     No,\n@@ -111,6 +119,7 @@ impl<'a> Parser<'a> {\n             RecoverReturnSign::Yes,\n             None,\n             RecoverQuestionMark::Yes,\n+            RecoverAnonEnum::No,\n         )\n     }\n \n@@ -125,6 +134,7 @@ impl<'a> Parser<'a> {\n             RecoverReturnSign::Yes,\n             Some(ty_params),\n             RecoverQuestionMark::Yes,\n+            RecoverAnonEnum::No,\n         )\n     }\n \n@@ -139,6 +149,7 @@ impl<'a> Parser<'a> {\n             RecoverReturnSign::Yes,\n             None,\n             RecoverQuestionMark::Yes,\n+            RecoverAnonEnum::Yes,\n         )\n     }\n \n@@ -156,6 +167,7 @@ impl<'a> Parser<'a> {\n             RecoverReturnSign::Yes,\n             None,\n             RecoverQuestionMark::Yes,\n+            RecoverAnonEnum::No,\n         )\n     }\n \n@@ -169,6 +181,7 @@ impl<'a> Parser<'a> {\n             RecoverReturnSign::Yes,\n             None,\n             RecoverQuestionMark::No,\n+            RecoverAnonEnum::No,\n         )\n     }\n \n@@ -180,6 +193,7 @@ impl<'a> Parser<'a> {\n             RecoverReturnSign::Yes,\n             None,\n             RecoverQuestionMark::No,\n+            RecoverAnonEnum::No,\n         )\n     }\n \n@@ -192,6 +206,7 @@ impl<'a> Parser<'a> {\n             RecoverReturnSign::OnlyFatArrow,\n             None,\n             RecoverQuestionMark::Yes,\n+            RecoverAnonEnum::No,\n         )\n     }\n \n@@ -211,6 +226,7 @@ impl<'a> Parser<'a> {\n                 recover_return_sign,\n                 None,\n                 RecoverQuestionMark::Yes,\n+                RecoverAnonEnum::Yes,\n             )?;\n             FnRetTy::Ty(ty)\n         } else if recover_return_sign.can_recover(&self.token.kind) {\n@@ -232,6 +248,7 @@ impl<'a> Parser<'a> {\n                 recover_return_sign,\n                 None,\n                 RecoverQuestionMark::Yes,\n+                RecoverAnonEnum::Yes,\n             )?;\n             FnRetTy::Ty(ty)\n         } else {\n@@ -247,6 +264,7 @@ impl<'a> Parser<'a> {\n         recover_return_sign: RecoverReturnSign,\n         ty_generics: Option<&Generics>,\n         recover_question_mark: RecoverQuestionMark,\n+        recover_anon_enum: RecoverAnonEnum,\n     ) -> PResult<'a, P<Ty>> {\n         let allow_qpath_recovery = recover_qpath == RecoverQPath::Yes;\n         maybe_recover_from_interpolated_ty_qpath!(self, allow_qpath_recovery);\n@@ -325,14 +343,55 @@ impl<'a> Parser<'a> {\n         let mut ty = self.mk_ty(span, kind);\n \n         // Try to recover from use of `+` with incorrect priority.\n-        if matches!(allow_plus, AllowPlus::Yes) {\n+        if allow_plus == AllowPlus::Yes {\n             self.maybe_recover_from_bad_type_plus(&ty)?;\n         } else {\n             self.maybe_report_ambiguous_plus(impl_dyn_multi, &ty);\n         }\n-        if let RecoverQuestionMark::Yes = recover_question_mark {\n+        if RecoverQuestionMark::Yes == recover_question_mark {\n             ty = self.maybe_recover_from_question_mark(ty);\n         }\n+        if recover_anon_enum == RecoverAnonEnum::Yes\n+            && self.check_noexpect(&token::BinOp(token::Or))\n+            && self.look_ahead(1, |t| t.can_begin_type())\n+        {\n+            let mut pipes = vec![self.token.span];\n+            let mut types = vec![ty];\n+            loop {\n+                if !self.eat(&token::BinOp(token::Or)) {\n+                    break;\n+                }\n+                pipes.push(self.prev_token.span);\n+                types.push(self.parse_ty_common(\n+                    allow_plus,\n+                    allow_c_variadic,\n+                    recover_qpath,\n+                    recover_return_sign,\n+                    ty_generics,\n+                    recover_question_mark,\n+                    RecoverAnonEnum::No,\n+                )?);\n+            }\n+            let mut err = self.struct_span_err(pipes, \"anonymous enums are not supported\");\n+            for ty in &types {\n+                err.span_label(ty.span, \"\");\n+            }\n+            err.help(&format!(\n+                \"create a named `enum` and use it here instead:\\nenum Name {{\\n{}\\n}}\",\n+                types\n+                    .iter()\n+                    .enumerate()\n+                    .map(|(i, t)| format!(\n+                        \"    Variant{}({}),\",\n+                        i + 1, // Lets not confuse people with zero-indexing :)\n+                        pprust::to_string(|s| s.print_type(&t)),\n+                    ))\n+                    .collect::<Vec<_>>()\n+                    .join(\"\\n\"),\n+            ));\n+            err.emit();\n+            return Ok(self.mk_ty(lo.to(self.prev_token.span), TyKind::AnonEnum(types)));\n+        }\n         if allow_qpath_recovery { self.maybe_recover_from_bad_qpath(ty) } else { Ok(ty) }\n     }\n "}, {"sha": "312bd8839e0d0ed9a5b82dd19ec935c97b278f5b", "filename": "compiler/rustc_passes/src/hir_stats.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_passes%2Fsrc%2Fhir_stats.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d824206655bfb26cb5eed43490ee396542b153e/compiler%2Frustc_passes%2Fsrc%2Fhir_stats.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_passes%2Fsrc%2Fhir_stats.rs?ref=2d824206655bfb26cb5eed43490ee396542b153e", "patch": "@@ -579,6 +579,7 @@ impl<'v> ast_visit::Visitor<'v> for StatCollector<'v> {\n             [\n                 Slice,\n                 Array,\n+                AnonEnum,\n                 Ptr,\n                 Ref,\n                 BareFn,"}, {"sha": "f065ec680d724bd68ce0d9010721c3a232f19b13", "filename": "src/tools/rustfmt/src/types.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/2d824206655bfb26cb5eed43490ee396542b153e/src%2Ftools%2Frustfmt%2Fsrc%2Ftypes.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d824206655bfb26cb5eed43490ee396542b153e/src%2Ftools%2Frustfmt%2Fsrc%2Ftypes.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Frustfmt%2Fsrc%2Ftypes.rs?ref=2d824206655bfb26cb5eed43490ee396542b153e", "patch": "@@ -839,7 +839,9 @@ impl Rewrite for ast::Ty {\n                 })\n             }\n             ast::TyKind::CVarArgs => Some(\"...\".to_owned()),\n-            ast::TyKind::Err => Some(context.snippet(self.span).to_owned()),\n+            ast::TyKind::AnonEnum(_) | ast::TyKind::Err => {\n+                Some(context.snippet(self.span).to_owned())\n+            }\n             ast::TyKind::Typeof(ref anon_const) => rewrite_call(\n                 context,\n                 \"typeof\","}, {"sha": "a8b5e8359d99612f0b5deb817236b6f9ec5523e7", "filename": "tests/ui/parser/anon-enums.rs", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/2d824206655bfb26cb5eed43490ee396542b153e/tests%2Fui%2Fparser%2Fanon-enums.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2d824206655bfb26cb5eed43490ee396542b153e/tests%2Fui%2Fparser%2Fanon-enums.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fanon-enums.rs?ref=2d824206655bfb26cb5eed43490ee396542b153e", "patch": "@@ -0,0 +1,19 @@\n+fn foo(x: bool | i32) -> i32 | f64 {\n+//~^ ERROR anonymous enums are not supported\n+//~| ERROR anonymous enums are not supported\n+    match x {\n+        x: i32 => x, //~ ERROR expected\n+        //~^ ERROR failed to resolve\n+        true => 42.,\n+        false => 0.333,\n+    }\n+}\n+\n+fn main() {\n+    match foo(true) {\n+        42: i32 => (), //~ ERROR expected\n+        _: f64 => (), //~ ERROR expected\n+        x: i32 => (), //~ ERROR expected\n+        //~^ ERROR failed to resolve\n+    }\n+}"}, {"sha": "4febf2df0dc72a967ab661ebb4abd67cd8b5e05a", "filename": "tests/ui/parser/anon-enums.stderr", "status": "added", "additions": 81, "deletions": 0, "changes": 81, "blob_url": "https://github.com/rust-lang/rust/blob/2d824206655bfb26cb5eed43490ee396542b153e/tests%2Fui%2Fparser%2Fanon-enums.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2d824206655bfb26cb5eed43490ee396542b153e/tests%2Fui%2Fparser%2Fanon-enums.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fanon-enums.stderr?ref=2d824206655bfb26cb5eed43490ee396542b153e", "patch": "@@ -0,0 +1,81 @@\n+error: anonymous enums are not supported\n+  --> $DIR/anon-enums.rs:1:16\n+   |\n+LL | fn foo(x: bool | i32) -> i32 | f64 {\n+   |           ---- ^ ---\n+   |\n+   = help: create a named `enum` and use it here instead:\n+           enum Name {\n+               Variant1(bool),\n+               Variant2(i32),\n+           }\n+\n+error: anonymous enums are not supported\n+  --> $DIR/anon-enums.rs:1:30\n+   |\n+LL | fn foo(x: bool | i32) -> i32 | f64 {\n+   |                          --- ^ ---\n+   |\n+   = help: create a named `enum` and use it here instead:\n+           enum Name {\n+               Variant1(i32),\n+               Variant2(f64),\n+           }\n+\n+error: expected one of `@` or `|`, found `:`\n+  --> $DIR/anon-enums.rs:5:10\n+   |\n+LL |         x: i32 => x,\n+   |          ^ --- specifying the type of a pattern isn't supported\n+   |          |\n+   |          expected one of `@` or `|`\n+   |\n+help: maybe write a path separator here\n+   |\n+LL |         x::i32 => x,\n+   |          ~~\n+\n+error: expected one of `...`, `..=`, `..`, or `|`, found `:`\n+  --> $DIR/anon-enums.rs:14:11\n+   |\n+LL |         42: i32 => (),\n+   |           ^ --- specifying the type of a pattern isn't supported\n+   |           |\n+   |           expected one of `...`, `..=`, `..`, or `|`\n+\n+error: expected `|`, found `:`\n+  --> $DIR/anon-enums.rs:15:10\n+   |\n+LL |         _: f64 => (),\n+   |          ^ --- specifying the type of a pattern isn't supported\n+   |          |\n+   |          expected `|`\n+\n+error: expected one of `@` or `|`, found `:`\n+  --> $DIR/anon-enums.rs:16:10\n+   |\n+LL |         x: i32 => (),\n+   |          ^ --- specifying the type of a pattern isn't supported\n+   |          |\n+   |          expected one of `@` or `|`\n+   |\n+help: maybe write a path separator here\n+   |\n+LL |         x::i32 => (),\n+   |          ~~\n+\n+error[E0433]: failed to resolve: use of undeclared crate or module `x`\n+  --> $DIR/anon-enums.rs:5:9\n+   |\n+LL |         x: i32 => x,\n+   |         ^ use of undeclared crate or module `x`\n+\n+error[E0433]: failed to resolve: use of undeclared crate or module `x`\n+  --> $DIR/anon-enums.rs:16:9\n+   |\n+LL |         x: i32 => (),\n+   |         ^ use of undeclared crate or module `x`\n+\n+error: aborting due to 8 previous errors\n+\n+For more information about this error, try `rustc --explain E0433`."}, {"sha": "ed05bfe8b0a32cc804dc51b59d056405dcc9e7c6", "filename": "tests/ui/parser/issues/issue-87086-colon-path-sep.stderr", "status": "modified", "additions": 54, "deletions": 18, "changes": 72, "blob_url": "https://github.com/rust-lang/rust/blob/2d824206655bfb26cb5eed43490ee396542b153e/tests%2Fui%2Fparser%2Fissues%2Fissue-87086-colon-path-sep.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/2d824206655bfb26cb5eed43490ee396542b153e/tests%2Fui%2Fparser%2Fissues%2Fissue-87086-colon-path-sep.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fparser%2Fissues%2Fissue-87086-colon-path-sep.stderr?ref=2d824206655bfb26cb5eed43490ee396542b153e", "patch": "@@ -2,82 +2,118 @@ error: expected one of `@` or `|`, found `:`\n   --> $DIR/issue-87086-colon-path-sep.rs:17:12\n    |\n LL |         Foo:Bar => {}\n-   |            ^\n+   |            ^--- specifying the type of a pattern isn't supported\n    |            |\n    |            expected one of `@` or `|`\n-   |            help: maybe write a path separator here: `::`\n+   |\n+help: maybe write a path separator here\n+   |\n+LL |         Foo::Bar => {}\n+   |            ~~\n \n error: expected one of `!`, `(`, `...`, `..=`, `..`, `::`, `{`, or `|`, found `:`\n   --> $DIR/issue-87086-colon-path-sep.rs:23:17\n    |\n LL |         qux::Foo:Bar => {}\n-   |                 ^\n+   |                 ^--- specifying the type of a pattern isn't supported\n    |                 |\n    |                 expected one of 8 possible tokens\n-   |                 help: maybe write a path separator here: `::`\n+   |\n+help: maybe write a path separator here\n+   |\n+LL |         qux::Foo::Bar => {}\n+   |                 ~~\n \n error: expected one of `@` or `|`, found `:`\n   --> $DIR/issue-87086-colon-path-sep.rs:29:12\n    |\n LL |         qux:Foo::Baz => {}\n-   |            ^\n+   |            ^-------- specifying the type of a pattern isn't supported\n    |            |\n    |            expected one of `@` or `|`\n-   |            help: maybe write a path separator here: `::`\n+   |\n+help: maybe write a path separator here\n+   |\n+LL |         qux::Foo::Baz => {}\n+   |            ~~\n \n error: expected one of `@` or `|`, found `:`\n   --> $DIR/issue-87086-colon-path-sep.rs:35:12\n    |\n LL |         qux: Foo::Baz if true => {}\n-   |            ^\n+   |            ^ -------- specifying the type of a pattern isn't supported\n    |            |\n    |            expected one of `@` or `|`\n-   |            help: maybe write a path separator here: `::`\n+   |\n+help: maybe write a path separator here\n+   |\n+LL |         qux::Foo::Baz if true => {}\n+   |            ~~\n \n error: expected one of `@` or `|`, found `:`\n   --> $DIR/issue-87086-colon-path-sep.rs:40:15\n    |\n LL |     if let Foo:Bar = f() {\n-   |               ^\n+   |               ^--- specifying the type of a pattern isn't supported\n    |               |\n    |               expected one of `@` or `|`\n-   |               help: maybe write a path separator here: `::`\n+   |\n+help: maybe write a path separator here\n+   |\n+LL |     if let Foo::Bar = f() {\n+   |               ~~\n \n error: expected one of `@` or `|`, found `:`\n   --> $DIR/issue-87086-colon-path-sep.rs:48:16\n    |\n LL |         ref qux: Foo::Baz => {}\n-   |                ^\n+   |                ^ -------- specifying the type of a pattern isn't supported\n    |                |\n    |                expected one of `@` or `|`\n-   |                help: maybe write a path separator here: `::`\n+   |\n+help: maybe write a path separator here\n+   |\n+LL |         ref qux::Foo::Baz => {}\n+   |                ~~\n \n error: expected one of `@` or `|`, found `:`\n   --> $DIR/issue-87086-colon-path-sep.rs:57:16\n    |\n LL |         mut qux: Foo::Baz => {}\n-   |                ^\n+   |                ^ -------- specifying the type of a pattern isn't supported\n    |                |\n    |                expected one of `@` or `|`\n-   |                help: maybe write a path separator here: `::`\n+   |\n+help: maybe write a path separator here\n+   |\n+LL |         mut qux::Foo::Baz => {}\n+   |                ~~\n \n error: expected one of `@` or `|`, found `:`\n   --> $DIR/issue-87086-colon-path-sep.rs:68:12\n    |\n LL |         Foo:Bar::Baz => {}\n-   |            ^\n+   |            ^-------- specifying the type of a pattern isn't supported\n    |            |\n    |            expected one of `@` or `|`\n-   |            help: maybe write a path separator here: `::`\n+   |\n+help: maybe write a path separator here\n+   |\n+LL |         Foo::Bar::Baz => {}\n+   |            ~~\n \n error: expected one of `@` or `|`, found `:`\n   --> $DIR/issue-87086-colon-path-sep.rs:75:12\n    |\n LL |         Foo:Bar => {}\n-   |            ^\n+   |            ^--- specifying the type of a pattern isn't supported\n    |            |\n    |            expected one of `@` or `|`\n-   |            help: maybe write a path separator here: `::`\n+   |\n+help: maybe write a path separator here\n+   |\n+LL |         Foo::Bar => {}\n+   |            ~~\n \n error[E0433]: failed to resolve: `Bar` is a variant, not a module\n   --> $DIR/issue-87086-colon-path-sep.rs:68:13"}]}