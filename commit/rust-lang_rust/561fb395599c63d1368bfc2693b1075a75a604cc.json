{"sha": "561fb395599c63d1368bfc2693b1075a75a604cc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU2MWZiMzk1NTk5YzYzZDEzNjhiZmMyNjkzYjEwNzVhNzVhNjA0Y2M=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-04-09T06:05:49Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-04-09T06:05:49Z"}, "message": "Auto merge of #49778 - tamird:install-relative-prefix, r=Mark-Simulacrum\n\nrustbuild: canonicalize prefix `install_sh`\n\nTesting:\n```\n  $ git diff\n  diff --git a/config.toml.example b/config.toml.example\n  index 9dd3002506..b47bc490cd 100644\n  --- a/config.toml.example\n  +++ b/config.toml.example\n  @@ -196,7 +196,7 @@\n   [install]\n\n   # Instead of installing to /usr/local, install to this path instead.\n  -#prefix = \"/usr/local\"\n  +prefix = \"install-prefix\"\n\n   # Where to install system configuration files\n   # If this is a relative path, it will get installed in `prefix` above\n  $ mkdir install-prefix\n  $ ./x.py install -i --stage 0 --config config.toml.example\n  ...\n  $ ls install-prefix/\n  bin\tlib\tshare\n```\n\nCloses #36989.\n\nr? @Mark-Simulacrum", "tree": {"sha": "8a36c702c9f31bc214e65bffb15c9247c048135b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/8a36c702c9f31bc214e65bffb15c9247c048135b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/561fb395599c63d1368bfc2693b1075a75a604cc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/561fb395599c63d1368bfc2693b1075a75a604cc", "html_url": "https://github.com/rust-lang/rust/commit/561fb395599c63d1368bfc2693b1075a75a604cc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/561fb395599c63d1368bfc2693b1075a75a604cc/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8ae79efce3e43eadecd032cf38b2372b4cba7b62", "url": "https://api.github.com/repos/rust-lang/rust/commits/8ae79efce3e43eadecd032cf38b2372b4cba7b62", "html_url": "https://github.com/rust-lang/rust/commit/8ae79efce3e43eadecd032cf38b2372b4cba7b62"}, {"sha": "94879023ad6965ed6a2a3f0d50a961ef31e47c9a", "url": "https://api.github.com/repos/rust-lang/rust/commits/94879023ad6965ed6a2a3f0d50a961ef31e47c9a", "html_url": "https://github.com/rust-lang/rust/commit/94879023ad6965ed6a2a3f0d50a961ef31e47c9a"}], "stats": {"total": 4, "additions": 3, "deletions": 1}, "files": [{"sha": "d71fdb8a30c70d01be928a1fa2d0e30127b674c5", "filename": "src/bootstrap/install.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/561fb395599c63d1368bfc2693b1075a75a604cc/src%2Fbootstrap%2Finstall.rs", "raw_url": "https://github.com/rust-lang/rust/raw/561fb395599c63d1368bfc2693b1075a75a604cc/src%2Fbootstrap%2Finstall.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Finstall.rs?ref=561fb395599c63d1368bfc2693b1075a75a604cc", "patch": "@@ -72,7 +72,9 @@ fn install_sh(\n     let bindir_default = PathBuf::from(\"bin\");\n     let libdir_default = PathBuf::from(\"lib\");\n     let mandir_default = datadir_default.join(\"man\");\n-    let prefix = build.config.prefix.as_ref().unwrap_or(&prefix_default);\n+    let prefix = build.config.prefix.as_ref().map_or(prefix_default, |p| {\n+        fs::canonicalize(p).expect(&format!(\"could not canonicalize {}\", p.display()))\n+    });\n     let sysconfdir = build.config.sysconfdir.as_ref().unwrap_or(&sysconfdir_default);\n     let datadir = build.config.datadir.as_ref().unwrap_or(&datadir_default);\n     let docdir = build.config.docdir.as_ref().unwrap_or(&docdir_default);"}]}