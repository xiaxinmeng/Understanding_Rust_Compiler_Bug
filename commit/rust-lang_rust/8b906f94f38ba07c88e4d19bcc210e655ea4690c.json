{"sha": "8b906f94f38ba07c88e4d19bcc210e655ea4690c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhiOTA2Zjk0ZjM4YmEwN2M4OGU0ZDE5YmNjMjEwZTY1NWVhNDY5MGM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-05-03T07:26:55Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-05-03T07:26:55Z"}, "message": "Auto merge of #4053 - euclio:too-many-args-span, r=flip1995\n\nremove function body from \"too many args\" span\n\nchangelog: Remove the function body from the \"too many arguments\" span.", "tree": {"sha": "970ef62e88f9e3a95df267dd31df8de8eee481a0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/970ef62e88f9e3a95df267dd31df8de8eee481a0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8b906f94f38ba07c88e4d19bcc210e655ea4690c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8b906f94f38ba07c88e4d19bcc210e655ea4690c", "html_url": "https://github.com/rust-lang/rust/commit/8b906f94f38ba07c88e4d19bcc210e655ea4690c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8b906f94f38ba07c88e4d19bcc210e655ea4690c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8151a17422c503ebb52e96d83bf4ce10b2d187e0", "url": "https://api.github.com/repos/rust-lang/rust/commits/8151a17422c503ebb52e96d83bf4ce10b2d187e0", "html_url": "https://github.com/rust-lang/rust/commit/8151a17422c503ebb52e96d83bf4ce10b2d187e0"}, {"sha": "92535061120c35454542ed64d09e3ec7d9be9f98", "url": "https://api.github.com/repos/rust-lang/rust/commits/92535061120c35454542ed64d09e3ec7d9be9f98", "html_url": "https://github.com/rust-lang/rust/commit/92535061120c35454542ed64d09e3ec7d9be9f98"}], "stats": {"total": 79, "additions": 63, "deletions": 16}, "files": [{"sha": "67af615bf762b0e20fcfc88ea1ddcf24d9ce5f0d", "filename": "clippy_lints/src/functions.rs", "status": "modified", "additions": 17, "deletions": 2, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/8b906f94f38ba07c88e4d19bcc210e655ea4690c/clippy_lints%2Fsrc%2Ffunctions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8b906f94f38ba07c88e4d19bcc210e655ea4690c/clippy_lints%2Fsrc%2Ffunctions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Ffunctions.rs?ref=8b906f94f38ba07c88e4d19bcc210e655ea4690c", "patch": "@@ -1,4 +1,6 @@\n-use crate::utils::{iter_input_pats, snippet, span_lint, type_is_unsafe_function};\n+use std::convert::TryFrom;\n+\n+use crate::utils::{iter_input_pats, snippet, snippet_opt, span_lint, type_is_unsafe_function};\n use matches::matches;\n use rustc::hir;\n use rustc::hir::def::Def;\n@@ -8,7 +10,7 @@ use rustc::ty;\n use rustc::{declare_tool_lint, impl_lint_pass};\n use rustc_data_structures::fx::FxHashSet;\n use rustc_target::spec::abi::Abi;\n-use syntax::source_map::Span;\n+use syntax::source_map::{BytePos, Span};\n \n declare_clippy_lint! {\n     /// **What it does:** Checks for functions with too many parameters.\n@@ -162,6 +164,19 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for Functions {\n \n impl<'a, 'tcx> Functions {\n     fn check_arg_number(self, cx: &LateContext<'_, '_>, decl: &hir::FnDecl, span: Span) {\n+        // Remove the function body from the span. We can't use `SourceMap::def_span` because the\n+        // argument list might span multiple lines.\n+        let span = if let Some(snippet) = snippet_opt(cx, span) {\n+            let snippet = snippet.split('{').nth(0).unwrap_or(\"\").trim_end();\n+            if snippet.is_empty() {\n+                span\n+            } else {\n+                span.with_hi(BytePos(span.lo().0 + u32::try_from(snippet.len()).unwrap()))\n+            }\n+        } else {\n+            span\n+        };\n+\n         let args = decl.inputs.len() as u64;\n         if args > self.threshold {\n             span_lint("}, {"sha": "f8de18dc6243ea2a0c1e7a300214405ecb39c172", "filename": "tests/ui/functions.rs", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/8b906f94f38ba07c88e4d19bcc210e655ea4690c/tests%2Fui%2Ffunctions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8b906f94f38ba07c88e4d19bcc210e655ea4690c/tests%2Fui%2Ffunctions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ffunctions.rs?ref=8b906f94f38ba07c88e4d19bcc210e655ea4690c", "patch": "@@ -7,6 +7,26 @@ fn good(_one: u32, _two: u32, _three: &str, _four: bool, _five: f32, _six: f32,\n \n fn bad(_one: u32, _two: u32, _three: &str, _four: bool, _five: f32, _six: f32, _seven: bool, _eight: ()) {}\n \n+#[rustfmt::skip]\n+fn bad_multiline(\n+    one: u32,\n+    two: u32,\n+    three: &str,\n+    four: bool,\n+    five: f32,\n+    six: f32,\n+    seven: bool,\n+    eight: ()\n+) {\n+    let _one = one;\n+    let _two = two;\n+    let _three = three;\n+    let _four = four;\n+    let _five = five;\n+    let _six = six;\n+    let _seven = seven;\n+}\n+\n // don't lint extern fns\n extern \"C\" fn extern_fn(\n     _one: u32,"}, {"sha": "10d72fb96b1d497702b4725429a5c880003f3bd6", "filename": "tests/ui/functions.stderr", "status": "modified", "additions": 26, "deletions": 14, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/8b906f94f38ba07c88e4d19bcc210e655ea4690c/tests%2Fui%2Ffunctions.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/8b906f94f38ba07c88e4d19bcc210e655ea4690c/tests%2Fui%2Ffunctions.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ffunctions.stderr?ref=8b906f94f38ba07c88e4d19bcc210e655ea4690c", "patch": "@@ -2,77 +2,89 @@ error: this function has too many arguments (8/7)\n   --> $DIR/functions.rs:8:1\n    |\n LL | fn bad(_one: u32, _two: u32, _three: &str, _four: bool, _five: f32, _six: f32, _seven: bool, _eight: ()) {}\n-   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = note: `-D clippy::too-many-arguments` implied by `-D warnings`\n \n error: this function has too many arguments (8/7)\n-  --> $DIR/functions.rs:25:5\n+  --> $DIR/functions.rs:11:1\n+   |\n+LL | / fn bad_multiline(\n+LL | |     one: u32,\n+LL | |     two: u32,\n+LL | |     three: &str,\n+...  |\n+LL | |     eight: ()\n+LL | | ) {\n+   | |_^\n+\n+error: this function has too many arguments (8/7)\n+  --> $DIR/functions.rs:45:5\n    |\n LL |     fn bad(_one: u32, _two: u32, _three: &str, _four: bool, _five: f32, _six: f32, _seven: bool, _eight: ());\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: this function has too many arguments (8/7)\n-  --> $DIR/functions.rs:34:5\n+  --> $DIR/functions.rs:54:5\n    |\n LL |     fn bad_method(_one: u32, _two: u32, _three: &str, _four: bool, _five: f32, _six: f32, _seven: bool, _eight: ()) {}\n-   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n error: this public function dereferences a raw pointer but is not marked `unsafe`\n-  --> $DIR/functions.rs:43:34\n+  --> $DIR/functions.rs:63:34\n    |\n LL |         println!(\"{}\", unsafe { *p });\n    |                                  ^\n    |\n    = note: `-D clippy::not-unsafe-ptr-arg-deref` implied by `-D warnings`\n \n error: this public function dereferences a raw pointer but is not marked `unsafe`\n-  --> $DIR/functions.rs:44:35\n+  --> $DIR/functions.rs:64:35\n    |\n LL |         println!(\"{:?}\", unsafe { p.as_ref() });\n    |                                   ^\n \n error: this public function dereferences a raw pointer but is not marked `unsafe`\n-  --> $DIR/functions.rs:45:33\n+  --> $DIR/functions.rs:65:33\n    |\n LL |         unsafe { std::ptr::read(p) };\n    |                                 ^\n \n error: this public function dereferences a raw pointer but is not marked `unsafe`\n-  --> $DIR/functions.rs:56:30\n+  --> $DIR/functions.rs:76:30\n    |\n LL |     println!(\"{}\", unsafe { *p });\n    |                              ^\n \n error: this public function dereferences a raw pointer but is not marked `unsafe`\n-  --> $DIR/functions.rs:57:31\n+  --> $DIR/functions.rs:77:31\n    |\n LL |     println!(\"{:?}\", unsafe { p.as_ref() });\n    |                               ^\n \n error: this public function dereferences a raw pointer but is not marked `unsafe`\n-  --> $DIR/functions.rs:58:29\n+  --> $DIR/functions.rs:78:29\n    |\n LL |     unsafe { std::ptr::read(p) };\n    |                             ^\n \n error: this public function dereferences a raw pointer but is not marked `unsafe`\n-  --> $DIR/functions.rs:67:34\n+  --> $DIR/functions.rs:87:34\n    |\n LL |         println!(\"{}\", unsafe { *p });\n    |                                  ^\n \n error: this public function dereferences a raw pointer but is not marked `unsafe`\n-  --> $DIR/functions.rs:68:35\n+  --> $DIR/functions.rs:88:35\n    |\n LL |         println!(\"{:?}\", unsafe { p.as_ref() });\n    |                                   ^\n \n error: this public function dereferences a raw pointer but is not marked `unsafe`\n-  --> $DIR/functions.rs:69:33\n+  --> $DIR/functions.rs:89:33\n    |\n LL |         unsafe { std::ptr::read(p) };\n    |                                 ^\n \n-error: aborting due to 12 previous errors\n+error: aborting due to 13 previous errors\n "}]}