{"sha": "d227f18c2eb7c1d21d590ea4d8708d8dc5d01308", "node_id": "C_kwDOAAsO6NoAKGQyMjdmMThjMmViN2MxZDIxZDU5MGVhNGQ4NzA4ZDhkYzVkMDEzMDg", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-01-31T08:20:21Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2023-01-31T08:20:21Z"}, "message": "Auto merge of #10225 - evantypanski:et/issue10132, r=flip1995\n\n[`unused_io_amount`]: Lint with `is_ok` and `is_err`\n\nFixes #10132\n\nchangelog: Apply [`unused_io_amount`] lint to `is_ok` and `is_err` without checking read/write amount", "tree": {"sha": "21c840a4e3022ebb1226a7a0e81d9090e65bc1c6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/21c840a4e3022ebb1226a7a0e81d9090e65bc1c6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d227f18c2eb7c1d21d590ea4d8708d8dc5d01308", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d227f18c2eb7c1d21d590ea4d8708d8dc5d01308", "html_url": "https://github.com/rust-lang/rust/commit/d227f18c2eb7c1d21d590ea4d8708d8dc5d01308", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d227f18c2eb7c1d21d590ea4d8708d8dc5d01308/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e1224cd4cdc99a8fc4594aeef6455bf463a76b34", "url": "https://api.github.com/repos/rust-lang/rust/commits/e1224cd4cdc99a8fc4594aeef6455bf463a76b34", "html_url": "https://github.com/rust-lang/rust/commit/e1224cd4cdc99a8fc4594aeef6455bf463a76b34"}, {"sha": "f9f75e093259384ec2d9fb83cbc799a27d894fea", "url": "https://api.github.com/repos/rust-lang/rust/commits/f9f75e093259384ec2d9fb83cbc799a27d894fea", "html_url": "https://github.com/rust-lang/rust/commit/f9f75e093259384ec2d9fb83cbc799a27d894fea"}], "stats": {"total": 54, "additions": 47, "deletions": 7}, "files": [{"sha": "0e526c216beeadda0306b2ffdc825bbfdedea4f0", "filename": "clippy_lints/src/unused_io_amount.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d227f18c2eb7c1d21d590ea4d8708d8dc5d01308/clippy_lints%2Fsrc%2Funused_io_amount.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d227f18c2eb7c1d21d590ea4d8708d8dc5d01308/clippy_lints%2Fsrc%2Funused_io_amount.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Funused_io_amount.rs?ref=d227f18c2eb7c1d21d590ea4d8708d8dc5d01308", "patch": "@@ -65,7 +65,7 @@ impl<'tcx> LateLintPass<'tcx> for UnusedIoAmount {\n                 }\n             },\n             hir::ExprKind::MethodCall(path, arg_0, ..) => match path.ident.as_str() {\n-                \"expect\" | \"unwrap\" | \"unwrap_or\" | \"unwrap_or_else\" => {\n+                \"expect\" | \"unwrap\" | \"unwrap_or\" | \"unwrap_or_else\" | \"is_ok\" | \"is_err\" => {\n                     check_map_error(cx, arg_0, expr);\n                 },\n                 _ => (),"}, {"sha": "8d3e094b75967bf6741d58d38f4df882b3fb42be", "filename": "tests/ui/unused_io_amount.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/d227f18c2eb7c1d21d590ea4d8708d8dc5d01308/tests%2Fui%2Funused_io_amount.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d227f18c2eb7c1d21d590ea4d8708d8dc5d01308/tests%2Fui%2Funused_io_amount.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funused_io_amount.rs?ref=d227f18c2eb7c1d21d590ea4d8708d8dc5d01308", "patch": "@@ -63,6 +63,14 @@ fn combine_or(file: &str) -> Result<(), Error> {\n     Ok(())\n }\n \n+fn is_ok_err<T: io::Read + io::Write>(s: &mut T) {\n+    s.write(b\"ok\").is_ok();\n+    s.write(b\"err\").is_err();\n+    let mut buf = [0u8; 0];\n+    s.read(&mut buf).is_ok();\n+    s.read(&mut buf).is_err();\n+}\n+\n async fn bad_async_write<W: AsyncWrite + Unpin>(w: &mut W) {\n     w.write(b\"hello world\").await.unwrap();\n }"}, {"sha": "0865c5213f6873e94cc8dfa3eb5b1e0e5fe48ae7", "filename": "tests/ui/unused_io_amount.stderr", "status": "modified", "additions": 38, "deletions": 6, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/d227f18c2eb7c1d21d590ea4d8708d8dc5d01308/tests%2Fui%2Funused_io_amount.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/d227f18c2eb7c1d21d590ea4d8708d8dc5d01308/tests%2Fui%2Funused_io_amount.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Funused_io_amount.stderr?ref=d227f18c2eb7c1d21d590ea4d8708d8dc5d01308", "patch": "@@ -82,50 +82,82 @@ LL | |         .expect(\"error\");\n error: written amount is not handled\n   --> $DIR/unused_io_amount.rs:67:5\n    |\n+LL |     s.write(b\"ok\").is_ok();\n+   |     ^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = help: use `Write::write_all` instead, or handle partial writes\n+\n+error: written amount is not handled\n+  --> $DIR/unused_io_amount.rs:68:5\n+   |\n+LL |     s.write(b\"err\").is_err();\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = help: use `Write::write_all` instead, or handle partial writes\n+\n+error: read amount is not handled\n+  --> $DIR/unused_io_amount.rs:70:5\n+   |\n+LL |     s.read(&mut buf).is_ok();\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = help: use `Read::read_exact` instead, or handle partial reads\n+\n+error: read amount is not handled\n+  --> $DIR/unused_io_amount.rs:71:5\n+   |\n+LL |     s.read(&mut buf).is_err();\n+   |     ^^^^^^^^^^^^^^^^^^^^^^^^^\n+   |\n+   = help: use `Read::read_exact` instead, or handle partial reads\n+\n+error: written amount is not handled\n+  --> $DIR/unused_io_amount.rs:75:5\n+   |\n LL |     w.write(b\"hello world\").await.unwrap();\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: use `AsyncWriteExt::write_all` instead, or handle partial writes\n \n error: read amount is not handled\n-  --> $DIR/unused_io_amount.rs:72:5\n+  --> $DIR/unused_io_amount.rs:80:5\n    |\n LL |     r.read(&mut buf[..]).await.unwrap();\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: use `AsyncReadExt::read_exact` instead, or handle partial reads\n \n error: written amount is not handled\n-  --> $DIR/unused_io_amount.rs:85:9\n+  --> $DIR/unused_io_amount.rs:93:9\n    |\n LL |         w.write(b\"hello world\").await?;\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: use `AsyncWriteExt::write_all` instead, or handle partial writes\n \n error: read amount is not handled\n-  --> $DIR/unused_io_amount.rs:93:9\n+  --> $DIR/unused_io_amount.rs:101:9\n    |\n LL |         r.read(&mut buf[..]).await.or(Err(Error::Kind))?;\n    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: use `AsyncReadExt::read_exact` instead, or handle partial reads\n \n error: written amount is not handled\n-  --> $DIR/unused_io_amount.rs:101:5\n+  --> $DIR/unused_io_amount.rs:109:5\n    |\n LL |     w.write(b\"hello world\").await.unwrap();\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: use `AsyncWriteExt::write_all` instead, or handle partial writes\n \n error: read amount is not handled\n-  --> $DIR/unused_io_amount.rs:106:5\n+  --> $DIR/unused_io_amount.rs:114:5\n    |\n LL |     r.read(&mut buf[..]).await.unwrap();\n    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |\n    = help: use `AsyncReadExt::read_exact` instead, or handle partial reads\n \n-error: aborting due to 16 previous errors\n+error: aborting due to 20 previous errors\n "}]}