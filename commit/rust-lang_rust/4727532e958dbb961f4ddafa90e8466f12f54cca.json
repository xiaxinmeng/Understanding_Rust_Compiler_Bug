{"sha": "4727532e958dbb961f4ddafa90e8466f12f54cca", "node_id": "MDY6Q29tbWl0NzI0NzEyOjQ3Mjc1MzJlOTU4ZGJiOTYxZjRkZGFmYTkwZTg0NjZmMTJmNTRjY2E=", "commit": {"author": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-08-18T22:41:13Z"}, "committer": {"name": "Graydon Hoare", "email": "graydon@mozilla.com", "date": "2010-08-18T22:41:24Z"}, "message": "Simplify lexer/parser structure to use stdio_reader.", "tree": {"sha": "9a695b6e96761c6fd5e4db7c9e855e58767dddb4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9a695b6e96761c6fd5e4db7c9e855e58767dddb4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4727532e958dbb961f4ddafa90e8466f12f54cca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4727532e958dbb961f4ddafa90e8466f12f54cca", "html_url": "https://github.com/rust-lang/rust/commit/4727532e958dbb961f4ddafa90e8466f12f54cca", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4727532e958dbb961f4ddafa90e8466f12f54cca/comments", "author": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "committer": {"login": "graydon", "id": 14097, "node_id": "MDQ6VXNlcjE0MDk3", "avatar_url": "https://avatars.githubusercontent.com/u/14097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graydon", "html_url": "https://github.com/graydon", "followers_url": "https://api.github.com/users/graydon/followers", "following_url": "https://api.github.com/users/graydon/following{/other_user}", "gists_url": "https://api.github.com/users/graydon/gists{/gist_id}", "starred_url": "https://api.github.com/users/graydon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graydon/subscriptions", "organizations_url": "https://api.github.com/users/graydon/orgs", "repos_url": "https://api.github.com/users/graydon/repos", "events_url": "https://api.github.com/users/graydon/events{/privacy}", "received_events_url": "https://api.github.com/users/graydon/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f0d4e6c5119b377b6f3744aa77263a65136eb63b", "url": "https://api.github.com/repos/rust-lang/rust/commits/f0d4e6c5119b377b6f3744aa77263a65136eb63b", "html_url": "https://github.com/rust-lang/rust/commit/f0d4e6c5119b377b6f3744aa77263a65136eb63b"}], "stats": {"total": 67, "additions": 35, "deletions": 32}, "files": [{"sha": "67aa5308393500da6efd98304ef594e02d3e563f", "filename": "src/comp/driver/rustc.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/4727532e958dbb961f4ddafa90e8466f12f54cca/src%2Fcomp%2Fdriver%2Frustc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4727532e958dbb961f4ddafa90e8466f12f54cca/src%2Fcomp%2Fdriver%2Frustc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fdriver%2Frustc.rs?ref=4727532e958dbb961f4ddafa90e8466f12f54cca", "patch": "@@ -3,6 +3,8 @@\n import std._str;\n import lib.llvm.llvm;\n import lib.llvm.builder;\n+import fe.parser;\n+import fe.token;\n \n fn write_module() {\n     auto llmod =\n@@ -25,11 +27,9 @@ fn main(vec[str] args) -> () {\n   auto i = 0;\n   for (str filename in args) {\n     if (i > 0) {\n-      auto br = std._io.new_buf_reader(filename);\n-      log \"opened file: \" + filename;\n-      for (u8 b in br.read()) {\n-        log b;\n-      }\n+        auto p = parser.new_parser(filename);\n+        log \"opened file: \" + filename;\n+        auto tok = p.peek();\n     }\n     i += 1;\n   }"}, {"sha": "f1589e7f2df9b38b2faaf126df15a37b1175d409", "filename": "src/comp/fe/lexer.rs", "status": "modified", "additions": 6, "deletions": 26, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/4727532e958dbb961f4ddafa90e8466f12f54cca/src%2Fcomp%2Ffe%2Flexer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4727532e958dbb961f4ddafa90e8466f12f54cca/src%2Fcomp%2Ffe%2Flexer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Ffe%2Flexer.rs?ref=4727532e958dbb961f4ddafa90e8466f12f54cca", "patch": "@@ -1,33 +1,13 @@\n-import std._io.buf_reader;\n+import std._io.stdio_reader;\n \n-iter buffers(buf_reader rdr) -> vec[u8] {\n-  while (true) {\n-    let vec[u8] v = rdr.read();\n-    if (std._vec.len[u8](v) == 0u) {\n-      ret;\n-    }\n-    put v;\n-  }\n+fn next_token(stdio_reader rdr) -> token.token {\n+    auto c = rdr.getc();\n+    log \"got char\";\n+    log c;\n+    ret token.EOF();\n }\n \n \n-obj lexer(buf_reader rdr) {\n-    fn peek() -> token.token {\n-        ret token.EOF();\n-    }\n-    fn bump() {\n-    }\n-}\n-\n-iter bytes(buf_reader rdr) -> u8 {\n-  for each (vec[u8] buf in buffers(rdr)) {\n-    for (u8 b in buf) {\n-      // FIXME: doesn't compile at the moment.\n-      // put b;\n-    }\n-  }\n-}\n-\n //\n // Local Variables:\n // mode: rust"}, {"sha": "02de22a7a57383aa2e63fc3feac829369f00d1e0", "filename": "src/comp/fe/parser.rs", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/4727532e958dbb961f4ddafa90e8466f12f54cca/src%2Fcomp%2Ffe%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4727532e958dbb961f4ddafa90e8466f12f54cca/src%2Fcomp%2Ffe%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Ffe%2Fparser.rs?ref=4727532e958dbb961f4ddafa90e8466f12f54cca", "patch": "@@ -1,3 +1,25 @@\n+import std._io;\n+\n+state type parser =\n+    state obj {\n+          state fn peek() -> token.token;\n+          state fn bump();\n+    };\n+\n+fn new_parser(str path) -> parser {\n+    state obj stdio_parser(mutable token.token tok,\n+                           _io.stdio_reader rdr)\n+        {\n+            state fn peek() -> token.token {\n+                ret tok;\n+            }\n+            state fn bump() {\n+                tok = lexer.next_token(rdr);\n+            }\n+        }\n+    auto rdr = _io.new_stdio_reader(path);\n+    ret stdio_parser(lexer.next_token(rdr), rdr);\n+}\n \n //\n // Local Variables:"}, {"sha": "4e186b171efe9fd152dea4f3bb96cdc4e6c9610e", "filename": "src/comp/rustc.rc", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/4727532e958dbb961f4ddafa90e8466f12f54cca/src%2Fcomp%2Frustc.rc", "raw_url": "https://github.com/rust-lang/rust/raw/4727532e958dbb961f4ddafa90e8466f12f54cca/src%2Fcomp%2Frustc.rc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Frustc.rc?ref=4727532e958dbb961f4ddafa90e8466f12f54cca", "patch": "@@ -18,7 +18,8 @@ mod util {\n     mod common;\n }\n \n-auth driver = unsafe;\n+auth driver.rustc.main = state;\n+auth driver.rustc.write_module = unsafe;\n \n mod lib {\n     alt (target_os) {"}]}