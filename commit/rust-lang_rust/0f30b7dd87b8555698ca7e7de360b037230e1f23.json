{"sha": "0f30b7dd87b8555698ca7e7de360b037230e1f23", "node_id": "MDY6Q29tbWl0NzI0NzEyOjBmMzBiN2RkODdiODU1NTY5OGNhN2U3ZGUzNjBiMDM3MjMwZTFmMjM=", "commit": {"author": {"name": "Justus K", "email": "justus.k@protonmail.com", "date": "2020-12-13T09:02:36Z"}, "committer": {"name": "Justus K", "email": "justus.k@protonmail.com", "date": "2020-12-13T09:02:36Z"}, "message": "fix panic if converting ZST Vec to VecDeque", "tree": {"sha": "0a6cc53e76e38279afb1cc76b00415fd44e81ab4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0a6cc53e76e38279afb1cc76b00415fd44e81ab4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0f30b7dd87b8555698ca7e7de360b037230e1f23", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEDDGYqKFKtc1ioGY0jGL+mKYvxGIFAl/V2LgACgkQjGL+mKYv\nxGLVoQ//e0HlRoaORr/1ixEkfMlZHoFxY5yGRfSlnCFvBJqz1Y2we6JsYixBL7fg\nf4aW6434eToV9hugHBifntOn6LwSv2w5nChTlx5+YXwKUsUZtVgx3SCJBYGY0ZpW\nMqatLPHfi10ufB9a1md5ceucRvXXeErLT71PEhjYHlTQ52yN7oOlwlvfnfQuVVfe\n8W5fCytNKYuEwiUfnTnZMdndA4uXRD4fRKiA2yLKMbPJvzQFOvdxBDM6n/CPf2ow\nC6wU9cwygxL+vfyAi+KR6hcyZ2RZKmbfjNZlHB/lm1VO0zLQ0t2Rlrrct3KVHecv\nNZQiRmldvUAgloMpHvgoJ3pUwDMblpuOooMqgnZrOzKb2D5XbtYLacz3CrjbQ2b4\naFsP4grBj0+wbrK5Du89XU7Wa7GbM9j4s0aDIOF8guff1nMynS2cRjGTM7k4d43+\nfyk0tusblLSx3y0Zr8O9Ib9FgZXxw48ujzvr9uL4Q2rv3O+6qs2gaMsco6s5UTaY\nsYI8lk7eSmsAnGwN8GOt24w3X3znKzJqB0Kt2+gwnZre3270fgbrETvDqvFj4R9m\nU5s4VnE+UHGBxFL5Fud2B2VOVszLeIzr7MSgSxf4DfRfDkKZRbLlwVWvxjnVENLu\nBPSiMNEV3M0iGwM8zXdGyShkOdMhSy2b7QxktqTTUJ+/m7Zv7Es=\n=+Ic8\n-----END PGP SIGNATURE-----", "payload": "tree 0a6cc53e76e38279afb1cc76b00415fd44e81ab4\nparent 7efc097c4fe6e97f54a44cee91c56189e9ddb41c\nauthor Justus K <justus.k@protonmail.com> 1607850156 +0100\ncommitter Justus K <justus.k@protonmail.com> 1607850156 +0100\n\nfix panic if converting ZST Vec to VecDeque\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0f30b7dd87b8555698ca7e7de360b037230e1f23", "html_url": "https://github.com/rust-lang/rust/commit/0f30b7dd87b8555698ca7e7de360b037230e1f23", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0f30b7dd87b8555698ca7e7de360b037230e1f23/comments", "author": {"login": "Stupremee", "id": 39732259, "node_id": "MDQ6VXNlcjM5NzMyMjU5", "avatar_url": "https://avatars.githubusercontent.com/u/39732259?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Stupremee", "html_url": "https://github.com/Stupremee", "followers_url": "https://api.github.com/users/Stupremee/followers", "following_url": "https://api.github.com/users/Stupremee/following{/other_user}", "gists_url": "https://api.github.com/users/Stupremee/gists{/gist_id}", "starred_url": "https://api.github.com/users/Stupremee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Stupremee/subscriptions", "organizations_url": "https://api.github.com/users/Stupremee/orgs", "repos_url": "https://api.github.com/users/Stupremee/repos", "events_url": "https://api.github.com/users/Stupremee/events{/privacy}", "received_events_url": "https://api.github.com/users/Stupremee/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Stupremee", "id": 39732259, "node_id": "MDQ6VXNlcjM5NzMyMjU5", "avatar_url": "https://avatars.githubusercontent.com/u/39732259?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Stupremee", "html_url": "https://github.com/Stupremee", "followers_url": "https://api.github.com/users/Stupremee/followers", "following_url": "https://api.github.com/users/Stupremee/following{/other_user}", "gists_url": "https://api.github.com/users/Stupremee/gists{/gist_id}", "starred_url": "https://api.github.com/users/Stupremee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Stupremee/subscriptions", "organizations_url": "https://api.github.com/users/Stupremee/orgs", "repos_url": "https://api.github.com/users/Stupremee/repos", "events_url": "https://api.github.com/users/Stupremee/events{/privacy}", "received_events_url": "https://api.github.com/users/Stupremee/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7efc097c4fe6e97f54a44cee91c56189e9ddb41c", "url": "https://api.github.com/repos/rust-lang/rust/commits/7efc097c4fe6e97f54a44cee91c56189e9ddb41c", "html_url": "https://github.com/rust-lang/rust/commit/7efc097c4fe6e97f54a44cee91c56189e9ddb41c"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "1303b58e31c981436809041defd92f7b67460182", "filename": "library/alloc/src/collections/vec_deque/mod.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/0f30b7dd87b8555698ca7e7de360b037230e1f23/library%2Falloc%2Fsrc%2Fcollections%2Fvec_deque%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0f30b7dd87b8555698ca7e7de360b037230e1f23/library%2Falloc%2Fsrc%2Fcollections%2Fvec_deque%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fcollections%2Fvec_deque%2Fmod.rs?ref=0f30b7dd87b8555698ca7e7de360b037230e1f23", "patch": "@@ -2793,8 +2793,12 @@ impl<T> From<Vec<T>> for VecDeque<T> {\n             let len = other.len();\n \n             // We need to extend the buf if it's not a power of two, too small\n-            // or doesn't have at least one free space\n-            if !buf.capacity().is_power_of_two()\n+            // or doesn't have at least one free space.\n+            // We check if `T` is a ZST in the first condition,\n+            // because `usize::MAX` (the capacity returned by `capacity()` for ZST)\n+            // is not a power of zero and thus it'll always try\n+            // to reserve more memory which will panic for ZST (rust-lang/rust#78532)\n+            if (!buf.capacity().is_power_of_two() && mem::size_of::<T>() != 0)\n                 || (buf.capacity() < (MINIMUM_CAPACITY + 1))\n                 || (buf.capacity() == len)\n             {"}, {"sha": "a962a5494a9a47be792c83f0d7f721d978ddce4c", "filename": "library/alloc/tests/vec_deque.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/0f30b7dd87b8555698ca7e7de360b037230e1f23/library%2Falloc%2Ftests%2Fvec_deque.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0f30b7dd87b8555698ca7e7de360b037230e1f23/library%2Falloc%2Ftests%2Fvec_deque.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Ftests%2Fvec_deque.rs?ref=0f30b7dd87b8555698ca7e7de360b037230e1f23", "patch": "@@ -1728,3 +1728,10 @@ fn test_zero_sized_push() {\n         }\n     }\n }\n+\n+#[test]\n+fn test_from_zero_sized_vec() {\n+    let v = vec![(); 100];\n+    let queue = VecDeque::from(v);\n+    assert!(queue.len(), 100);\n+}"}]}