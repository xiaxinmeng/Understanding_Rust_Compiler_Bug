{"sha": "a1ee7e956565c05b48586bf3379cdb0b2767c3c0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmExZWU3ZTk1NjU2NWMwNWI0ODU4NmJmMzM3OWNkYjBiMjc2N2MzYzA=", "commit": {"author": {"name": "Seiichi Uchida", "email": "seuchida@gmail.com", "date": "2018-12-20T04:30:58Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-12-20T04:30:58Z"}, "message": "Merge pull request #3258 from scampi/version-gate\n\nClarify version gate used for #3229", "tree": {"sha": "e6c988322e648c498c0becc95180403b221e172e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e6c988322e648c498c0becc95180403b221e172e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a1ee7e956565c05b48586bf3379cdb0b2767c3c0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcGxsCCRBK7hj4Ov3rIwAAdHIIAINFBDquaFGHfIInbZXCBcNW\n1d54SOjetBBBqgMjDWxl1F/Vteq6D+2vPOGpNWoZH8AM0dkUGYs+EKOg64sbduMk\n4Df1piEiJdQPHaMg84cId35yvRU8oL6hHZD3pPLfsB96vEb2S1fuJWhBdSiL+kVi\n0UXgCn6Hmh5Ky6j5mZHKWGi81jSkwUzsuXaVixvPv2xl7y+O0E1HA1lgqEre/jLl\nWsjeKhXGOpxGREjvaWiQEek2SoVatvtYo/mGMwDDxeNAB3ul0fF0C0r9Yen1g8na\nhbAWl4rjc4lt6yF+Zooh2uVozxKXqD3jz1uhMT/TO2AeCl85mMEK8z3459cz/YQ=\n=y4ep\n-----END PGP SIGNATURE-----\n", "payload": "tree e6c988322e648c498c0becc95180403b221e172e\nparent 3f6ea7788b5c65c00e995d04622533554a13dd38\nparent e3052624933f779e93b287578a61b501f59143a1\nauthor Seiichi Uchida <seuchida@gmail.com> 1545280258 +0900\ncommitter GitHub <noreply@github.com> 1545280258 +0900\n\nMerge pull request #3258 from scampi/version-gate\n\nClarify version gate used for #3229"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a1ee7e956565c05b48586bf3379cdb0b2767c3c0", "html_url": "https://github.com/rust-lang/rust/commit/a1ee7e956565c05b48586bf3379cdb0b2767c3c0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a1ee7e956565c05b48586bf3379cdb0b2767c3c0/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3f6ea7788b5c65c00e995d04622533554a13dd38", "url": "https://api.github.com/repos/rust-lang/rust/commits/3f6ea7788b5c65c00e995d04622533554a13dd38", "html_url": "https://github.com/rust-lang/rust/commit/3f6ea7788b5c65c00e995d04622533554a13dd38"}, {"sha": "e3052624933f779e93b287578a61b501f59143a1", "url": "https://api.github.com/repos/rust-lang/rust/commits/e3052624933f779e93b287578a61b501f59143a1", "html_url": "https://github.com/rust-lang/rust/commit/e3052624933f779e93b287578a61b501f59143a1"}], "stats": {"total": 34, "additions": 31, "deletions": 3}, "files": [{"sha": "1cf6a86e54696327f0604e6faa1a452791b14871", "filename": "Contributing.md", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/a1ee7e956565c05b48586bf3379cdb0b2767c3c0/Contributing.md", "raw_url": "https://github.com/rust-lang/rust/raw/a1ee7e956565c05b48586bf3379cdb0b2767c3c0/Contributing.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Contributing.md?ref=a1ee7e956565c05b48586bf3379cdb0b2767c3c0", "patch": "@@ -91,6 +91,31 @@ Please try to avoid leaving `TODO`s in the code. There are a few around, but I\n wish there weren't. You can leave `FIXME`s, preferably with an issue number.\n \n \n+### Version-gate formatting changes\n+\n+A change that introduces a different code-formatting should be gated on the\n+`version` configuration. This is to ensure the formatting of the current major\n+release is preserved, while allowing fixes to be implemented for the next\n+release.\n+\n+This is done by conditionally guarding the change like so:\n+\n+```rust\n+if config.version() == Version::One { // if the current major release is 1.x\n+    // current formatting\n+} else {\n+    // new formatting\n+}\n+```\n+\n+This allows the user to apply the next formatting explicitly via the\n+configuration, while being stable by default.\n+\n+When the next major release is done, the code block of the previous formatting\n+can be deleted, e.g., the first block in the example above when going from `1.x`\n+to `2.x`.\n+\n+\n ### A quick tour of Rustfmt\n \n Rustfmt is basically a pretty printer - that is, its mode of operation is to"}, {"sha": "5d3b2dd548b7a15c057329afd92b19355f1dbc52", "filename": "src/matches.rs", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/a1ee7e956565c05b48586bf3379cdb0b2767c3c0/src%2Fmatches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a1ee7e956565c05b48586bf3379cdb0b2767c3c0/src%2Fmatches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmatches.rs?ref=a1ee7e956565c05b48586bf3379cdb0b2767c3c0", "patch": "@@ -413,12 +413,15 @@ fn rewrite_match_body(\n             } else {\n                 \"\"\n             };\n-            let semicolon =\n-                if context.config.version() == Version::Two && semicolon_for_expr(context, body) {\n+            let semicolon = if context.config.version() == Version::One {\n+                \"\"\n+            } else {\n+                if semicolon_for_expr(context, body) {\n                     \";\"\n                 } else {\n                     \"\"\n-                };\n+                }\n+            };\n             (\"{\", format!(\"{}{}}}{}\", semicolon, indent_str, comma))\n         } else {\n             (\"\", String::from(\",\"))"}]}