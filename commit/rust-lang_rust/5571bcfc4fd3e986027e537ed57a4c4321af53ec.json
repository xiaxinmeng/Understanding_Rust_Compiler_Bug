{"sha": "5571bcfc4fd3e986027e537ed57a4c4321af53ec", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU1NzFiY2ZjNGZkM2U5ODYwMjdlNTM3ZWQ1N2E0YzQzMjFhZjUzZWM=", "commit": {"author": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2020-09-26T18:40:41Z"}, "committer": {"name": "Aaron Hill", "email": "aa1ronham@gmail.com", "date": "2020-09-28T17:44:46Z"}, "message": "Require #[repr(C)] on MiriFrame", "tree": {"sha": "490f508fe80565c5ac6ce9bfd39865fceec5c053", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/490f508fe80565c5ac6ce9bfd39865fceec5c053"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5571bcfc4fd3e986027e537ed57a4c4321af53ec", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7J9Gc3TfBwj2K399tAh+UQ6YsWQFAl9yIQ4ACgkQtAh+UQ6Y\nsWTM1Q/+MvJQnwL9dc7ZmlMnkZlsgHR+HwTL7jM73pTQ+vJvfqscuZfqR0RVeZE/\n7rVSU4sxYnjAvSCnDRorPxdmSt6VSPsQ+NQwGbbJZ2MgJ8GUh4Ju6Sb9qfxcJPea\n16zTCijecLmG5+cgPP3JfRPsrbe/XQTnzntXYAYXe3/uy80ZXFaX2KjmmAsuRUUn\nHdmBblgLXb4XeOQ3y4vNz2TeM0oZZ/cdpfQnTrEbjN0oE9tDijuYBk0I8HVU9gIv\nK7e98/UHG2lPqVp9UcyNzGjS/FaSWOSXJNOPmxw6c6VG5MkJ91zjSQp8vtYHhKBU\nlsZb2uVKSiCyja89R7WOIbfJ4nzjLCfPVz2WraC+OTRPvmvN5FEwhn+sO1dGQceI\nyk/hqdXsBukaBThOxNvYEqdNrHEs1iodSjD6HnFWDMjoXim08CYxfsVfQuoxJDTj\ng8hzHAzJv6yuoAJll2ffLCq50moxVnn+N1ligtYO4udME6GrZlWPbaokob0J+rBi\nH9d1nLvDnTF6uTSVywOSYOQg1rcVkELyddIc7xUEhbgaJ8UT8FXxsY9LUvz6Gux2\n1GSyAhOh681NveqF7RJVZ4AwnhXnBHXEJjIi3DPkICAGzDlPe/dhB7SV/neHvU2F\nLdjAvD0tNPr5Hzf+5U3kv7N7ubdI+2aEir2MDwaBC1RG6vzUVeI=\n=S+qZ\n-----END PGP SIGNATURE-----", "payload": "tree 490f508fe80565c5ac6ce9bfd39865fceec5c053\nparent dba7f135495a4358472bac6c2704703e957ac68d\nauthor Aaron Hill <aa1ronham@gmail.com> 1601145641 -0400\ncommitter Aaron Hill <aa1ronham@gmail.com> 1601315086 -0400\n\nRequire #[repr(C)] on MiriFrame\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5571bcfc4fd3e986027e537ed57a4c4321af53ec", "html_url": "https://github.com/rust-lang/rust/commit/5571bcfc4fd3e986027e537ed57a4c4321af53ec", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5571bcfc4fd3e986027e537ed57a4c4321af53ec/comments", "author": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Aaron1011", "id": 1408859, "node_id": "MDQ6VXNlcjE0MDg4NTk=", "avatar_url": "https://avatars.githubusercontent.com/u/1408859?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Aaron1011", "html_url": "https://github.com/Aaron1011", "followers_url": "https://api.github.com/users/Aaron1011/followers", "following_url": "https://api.github.com/users/Aaron1011/following{/other_user}", "gists_url": "https://api.github.com/users/Aaron1011/gists{/gist_id}", "starred_url": "https://api.github.com/users/Aaron1011/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Aaron1011/subscriptions", "organizations_url": "https://api.github.com/users/Aaron1011/orgs", "repos_url": "https://api.github.com/users/Aaron1011/repos", "events_url": "https://api.github.com/users/Aaron1011/events{/privacy}", "received_events_url": "https://api.github.com/users/Aaron1011/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dba7f135495a4358472bac6c2704703e957ac68d", "url": "https://api.github.com/repos/rust-lang/rust/commits/dba7f135495a4358472bac6c2704703e957ac68d", "html_url": "https://github.com/rust-lang/rust/commit/dba7f135495a4358472bac6c2704703e957ac68d"}], "stats": {"total": 27, "additions": 17, "deletions": 10}, "files": [{"sha": "b84102598c1555c8a9d18e03a1143c705fd6149c", "filename": "README.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5571bcfc4fd3e986027e537ed57a4c4321af53ec/README.md", "raw_url": "https://github.com/rust-lang/rust/raw/5571bcfc4fd3e986027e537ed57a4c4321af53ec/README.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/README.md?ref=5571bcfc4fd3e986027e537ed57a4c4321af53ec", "patch": "@@ -277,6 +277,7 @@ extern \"Rust\" {\n     /// and `MiriFrame` should be declared as follows:\n     ///\n     /// ```rust\n+    /// #[repr(C)]\n     /// struct MiriFrame {\n     ///     // The name of the function being executed, encoded in UTF-8\n     ///     name: Box<[u8]>,"}, {"sha": "75cd61b0f59e7e7eeae0de3e23d50e0b4653867a", "filename": "src/shims/backtrace.rs", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/5571bcfc4fd3e986027e537ed57a4c4321af53ec/src%2Fshims%2Fbacktrace.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5571bcfc4fd3e986027e537ed57a4c4321af53ec/src%2Fshims%2Fbacktrace.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fshims%2Fbacktrace.rs?ref=5571bcfc4fd3e986027e537ed57a4c4321af53ec", "patch": "@@ -1,6 +1,6 @@\n use crate::*;\n use helpers::check_arg_count;\n-use rustc_middle::ty::TypeAndMut;\n+use rustc_middle::ty::{self, TypeAndMut};\n use rustc_ast::ast::Mutability;\n use rustc_span::BytePos;\n use rustc_target::abi::Size;\n@@ -105,7 +105,12 @@ pub trait EvalContextExt<'mir, 'tcx: 'mir>: crate::MiriEvalContextExt<'mir, 'tcx\n         let lineno_alloc = Scalar::from_u32(lineno);\n         let colno_alloc = Scalar::from_u32(colno);\n \n-        let dest = this.force_allocation_maybe_sized(dest, MemPlaceMeta::None)?.0;\n+        let dest = this.force_allocation(dest)?;\n+        if let ty::Adt(adt, _) = dest.layout.ty.kind() {\n+            if !adt.repr.c() {\n+                throw_ub_format!(\"miri_resolve_frame must be declared with a `#[repr(C)]` return type\");\n+            }\n+        }\n \n         this.write_immediate(name_alloc.to_ref(), this.mplace_field(dest, 0)?.into())?;\n         this.write_immediate(filename_alloc.to_ref(), this.mplace_field(dest, 1)?.into())?;"}, {"sha": "a58fb83d92f76d2b75dab9c85c6fa59eb412ab86", "filename": "tests/run-pass/backtrace-api.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/5571bcfc4fd3e986027e537ed57a4c4321af53ec/tests%2Frun-pass%2Fbacktrace-api.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5571bcfc4fd3e986027e537ed57a4c4321af53ec/tests%2Frun-pass%2Fbacktrace-api.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Fbacktrace-api.rs?ref=5571bcfc4fd3e986027e537ed57a4c4321af53ec", "patch": "@@ -7,6 +7,7 @@ extern \"Rust\" {\n }\n \n #[derive(Debug)]\n+#[repr(C)]\n struct MiriFrame {\n     name: Box<[u8]>,\n     filename: Box<[u8]>,"}, {"sha": "92c5331d6143a8f30f8b00778c448805ee5c941d", "filename": "tests/run-pass/backtrace-api.stderr", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5571bcfc4fd3e986027e537ed57a4c4321af53ec/tests%2Frun-pass%2Fbacktrace-api.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/5571bcfc4fd3e986027e537ed57a4c4321af53ec/tests%2Frun-pass%2Fbacktrace-api.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Fbacktrace-api.stderr?ref=5571bcfc4fd3e986027e537ed57a4c4321af53ec", "patch": "@@ -1,7 +1,7 @@\n-$DIR/backtrace-api.rs:19:59 (func_c)\n-$DIR/backtrace-api.rs:18:53 (func_b::<u8>)\n-$DIR/backtrace-api.rs:17:50 (func_a)\n-$DIR/backtrace-api.rs:23:18 (main)\n+$DIR/backtrace-api.rs:20:59 (func_c)\n+$DIR/backtrace-api.rs:19:53 (func_b::<u8>)\n+$DIR/backtrace-api.rs:18:50 (func_a)\n+$DIR/backtrace-api.rs:24:18 (main)\n RUSTLIB/src/rust/library/core/src/ops/function.rs:LL:COL (<fn() as std::ops::FnOnce<()>>::call_once - shim(fn()))\n RUSTLIB/src/rust/library/std/src/sys_common/backtrace.rs:LL:COL (std::sys_common::backtrace::__rust_begin_short_backtrace::<fn(), ()>)\n RUSTLIB/src/rust/library/std/src/rt.rs:LL:COL (std::rt::lang_start::<()>::{{closure}}#0)"}, {"sha": "e4130ade62e0859b73acf6cc35df1ffbf6fcbf6f", "filename": "tests/run-pass/backtrace-api.stdout", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/5571bcfc4fd3e986027e537ed57a4c4321af53ec/tests%2Frun-pass%2Fbacktrace-api.stdout", "raw_url": "https://github.com/rust-lang/rust/raw/5571bcfc4fd3e986027e537ed57a4c4321af53ec/tests%2Frun-pass%2Fbacktrace-api.stdout", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Fbacktrace-api.stdout?ref=5571bcfc4fd3e986027e537ed57a4c4321af53ec", "patch": "@@ -1,4 +1,4 @@\n-$DIR/backtrace-api.rs:19:59 (func_c)\n-$DIR/backtrace-api.rs:18:53 (func_b::<u8>)\n-$DIR/backtrace-api.rs:17:50 (func_a)\n-$DIR/backtrace-api.rs:23:18 (main)\n+$DIR/backtrace-api.rs:20:59 (func_c)\n+$DIR/backtrace-api.rs:19:53 (func_b::<u8>)\n+$DIR/backtrace-api.rs:18:50 (func_a)\n+$DIR/backtrace-api.rs:24:18 (main)"}]}