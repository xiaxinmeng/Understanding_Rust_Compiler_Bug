{"sha": "f86b078e2df79968e40185c91b0dce81bc580872", "node_id": "MDY6Q29tbWl0NzI0NzEyOmY4NmIwNzhlMmRmNzk5NjhlNDAxODVjOTFiMGRjZTgxYmM1ODA4NzI=", "commit": {"author": {"name": "Arlo Siemsen", "email": "arsiem@microsoft.com", "date": "2020-03-31T05:17:15Z"}, "committer": {"name": "Arlo Siemsen", "email": "arsiem@microsoft.com", "date": "2020-04-02T21:13:19Z"}, "message": "Add hash of source files in debug info\n\n* Adds either an MD5 or SHA1 hash to the debug info.\n* Adds new unstable option `-Z src-hash-algorithm` to control the hashing algorithm.", "tree": {"sha": "18e3d3337427fa4105ede99f581124d3c97f3c31", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/18e3d3337427fa4105ede99f581124d3c97f3c31"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f86b078e2df79968e40185c91b0dce81bc580872", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f86b078e2df79968e40185c91b0dce81bc580872", "html_url": "https://github.com/rust-lang/rust/commit/f86b078e2df79968e40185c91b0dce81bc580872", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f86b078e2df79968e40185c91b0dce81bc580872/comments", "author": {"login": "arlosi", "id": 704597, "node_id": "MDQ6VXNlcjcwNDU5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/704597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arlosi", "html_url": "https://github.com/arlosi", "followers_url": "https://api.github.com/users/arlosi/followers", "following_url": "https://api.github.com/users/arlosi/following{/other_user}", "gists_url": "https://api.github.com/users/arlosi/gists{/gist_id}", "starred_url": "https://api.github.com/users/arlosi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arlosi/subscriptions", "organizations_url": "https://api.github.com/users/arlosi/orgs", "repos_url": "https://api.github.com/users/arlosi/repos", "events_url": "https://api.github.com/users/arlosi/events{/privacy}", "received_events_url": "https://api.github.com/users/arlosi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "arlosi", "id": 704597, "node_id": "MDQ6VXNlcjcwNDU5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/704597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arlosi", "html_url": "https://github.com/arlosi", "followers_url": "https://api.github.com/users/arlosi/followers", "following_url": "https://api.github.com/users/arlosi/following{/other_user}", "gists_url": "https://api.github.com/users/arlosi/gists{/gist_id}", "starred_url": "https://api.github.com/users/arlosi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arlosi/subscriptions", "organizations_url": "https://api.github.com/users/arlosi/orgs", "repos_url": "https://api.github.com/users/arlosi/repos", "events_url": "https://api.github.com/users/arlosi/events{/privacy}", "received_events_url": "https://api.github.com/users/arlosi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "537ccdf3ac44c8c7a8d36cbdbe6fb224afabb7ae", "url": "https://api.github.com/repos/rust-lang/rust/commits/537ccdf3ac44c8c7a8d36cbdbe6fb224afabb7ae", "html_url": "https://github.com/rust-lang/rust/commit/537ccdf3ac44c8c7a8d36cbdbe6fb224afabb7ae"}], "stats": {"total": 424, "additions": 332, "deletions": 92}, "files": [{"sha": "64c60ab7b4ed5e57c25a650f86a036b7237bf097", "filename": "Cargo.lock", "status": "modified", "additions": 44, "deletions": 20, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -87,12 +87,6 @@ dependencies = [\n  \"scoped_threadpool\",\n ]\n \n-[[package]]\n-name = \"arrayref\"\n-version = \"0.3.5\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"0d382e583f07208808f6b1249e60848879ba3543f57c32277bf52d69c2f0f0ee\"\n-\n [[package]]\n name = \"arrayvec\"\n version = \"0.4.7\"\n@@ -187,11 +181,22 @@ dependencies = [\n \n [[package]]\n name = \"block-buffer\"\n-version = \"0.3.3\"\n+version = \"0.7.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"c0940dc441f31689269e10ac70eb1002a3a1d3ad1390e030043662eb7fe4688b\"\n+dependencies = [\n+ \"block-padding\",\n+ \"byte-tools\",\n+ \"byteorder\",\n+ \"generic-array\",\n+]\n+\n+[[package]]\n+name = \"block-padding\"\n+version = \"0.1.5\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"a076c298b9ecdb530ed9d967e74a6027d6a7478924520acddcddc24c1c8ab3ab\"\n+checksum = \"fa79dedbb091f449f1f39e53edf88d5dbe95f895dae6135a8d7b881fb5af73f5\"\n dependencies = [\n- \"arrayref\",\n  \"byte-tools\",\n ]\n \n@@ -240,9 +245,9 @@ version = \"0.1.0\"\n \n [[package]]\n name = \"byte-tools\"\n-version = \"0.2.0\"\n+version = \"0.3.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"560c32574a12a89ecd91f5e742165893f86e3ab98d21f8ea548658eb9eef5f40\"\n+checksum = \"e3b5ca7a04898ad4bcd41c90c5285445ff5b791899bb1b0abdd2a2aa791211d7\"\n \n [[package]]\n name = \"bytecount\"\n@@ -897,9 +902,9 @@ checksum = \"524cbf6897b527295dff137cec09ecf3a05f4fddffd7dfcd1585403449e74198\"\n \n [[package]]\n name = \"digest\"\n-version = \"0.7.6\"\n+version = \"0.8.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"03b072242a8cbaf9c145665af9d250c59af3b958f83ed6824e13533cf76d5b90\"\n+checksum = \"f3d0c8c8752312f9713efd397ff63acb9f85585afbf179282e720e7704954dd5\"\n dependencies = [\n  \"generic-array\",\n ]\n@@ -1226,9 +1231,9 @@ dependencies = [\n \n [[package]]\n name = \"generic-array\"\n-version = \"0.9.0\"\n+version = \"0.12.3\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"ef25c5683767570c2bbd7deba372926a55eaae9982d7726ee2a1050239d45b9d\"\n+checksum = \"c68f0274ae0e023facc3c97b2e00f076be70e254bc851d972503b328db79b2ec\"\n dependencies = [\n  \"typenum\",\n ]\n@@ -1962,6 +1967,17 @@ version = \"0.1.8\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"7ffc5c5338469d4d3ea17d269fa8ea3512ad247247c30bd2df69e68309ed0a08\"\n \n+[[package]]\n+name = \"md-5\"\n+version = \"0.8.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"a18af3dcaf2b0219366cdb4e2af65a6101457b415c3d1a5c71dd9c2b7c77b9c8\"\n+dependencies = [\n+ \"block-buffer\",\n+ \"digest\",\n+ \"opaque-debug\",\n+]\n+\n [[package]]\n name = \"mdbook\"\n version = \"0.3.5\"\n@@ -2250,6 +2266,12 @@ version = \"1.1.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"d6a04cb71e910d0034815600180f62a95bf6e67942d7ab52a166a68c7d7e9cd0\"\n \n+[[package]]\n+name = \"opaque-debug\"\n+version = \"0.2.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"2839e79665f131bdb5782e51f2c6c9599c133c6098982a54c794358bf432529c\"\n+\n [[package]]\n name = \"open\"\n version = \"1.2.1\"\n@@ -2467,9 +2489,9 @@ dependencies = [\n \n [[package]]\n name = \"pest_meta\"\n-version = \"2.1.0\"\n+version = \"2.1.3\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"f5a3492a4ed208ffc247adcdcc7ba2a95be3104f58877d0d02f0df39bf3efb5e\"\n+checksum = \"54be6e404f5317079812fc8f9f5279de376d8856929e21c184ecf6bbd692a11d\"\n dependencies = [\n  \"maplit\",\n  \"pest\",\n@@ -4155,11 +4177,13 @@ dependencies = [\n  \"arena\",\n  \"cfg-if\",\n  \"log\",\n+ \"md-5\",\n  \"rustc_data_structures\",\n  \"rustc_index\",\n  \"rustc_macros\",\n  \"scoped-tls\",\n  \"serialize\",\n+ \"sha-1\",\n  \"unicode-width\",\n ]\n \n@@ -4535,14 +4559,14 @@ dependencies = [\n \n [[package]]\n name = \"sha-1\"\n-version = \"0.7.0\"\n+version = \"0.8.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"51b9d1f3b5de8a167ab06834a7c883bd197f2191e1dda1a22d9ccfeedbf9aded\"\n+checksum = \"f7d94d0bede923b3cea61f3f1ff57ff8cdfd77b400fb8f9998949e0cf04163df\"\n dependencies = [\n  \"block-buffer\",\n- \"byte-tools\",\n  \"digest\",\n  \"fake-simd\",\n+ \"opaque-debug\",\n ]\n \n [[package]]"}, {"sha": "5a7d0655a440aec788bee1d2c6565ed2797c2e00", "filename": "src/doc/unstable-book/src/compiler-flags/src-hash-algorithm.md", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fsrc-hash-algorithm.md", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fsrc-hash-algorithm.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fdoc%2Funstable-book%2Fsrc%2Fcompiler-flags%2Fsrc-hash-algorithm.md?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -0,0 +1,11 @@\n+# `src-hash-algorithm`\n+\n+The tracking issue for this feature is: [#70401](https://github.com/rust-lang/rust/issues/70401).\n+\n+------------------------\n+\n+The `-Z src-hash-algorithm` compiler flag controls which algorithm is used when hashing each source file. The hash is stored in the debug info and can be used by a debugger to verify the source code matches the executable.\n+\n+Supported hash algorithms are: `md5`, and `sha1`. Note that not all hash algorithms are supported by all debug info formats.\n+\n+By default, the compiler chooses the hash algorithm based on the target specification."}, {"sha": "700f25d35bc1dcdb5c5aa8a02f5f583fe0d999b8", "filename": "src/librustc_codegen_llvm/debuginfo/metadata.rs", "status": "modified", "additions": 31, "deletions": 3, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fmetadata.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fmetadata.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fdebuginfo%2Fmetadata.rs?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -41,7 +41,7 @@ use rustc_middle::ty::{self, AdtKind, ParamEnv, Ty, TyCtxt};\n use rustc_middle::{bug, span_bug};\n use rustc_session::config::{self, DebugInfo};\n use rustc_span::symbol::{Interner, Symbol};\n-use rustc_span::{self, FileName, Span};\n+use rustc_span::{self, FileName, SourceFileHash, Span};\n use rustc_target::abi::{Abi, Align, DiscriminantKind, HasDataLayout, Integer, LayoutOf};\n use rustc_target::abi::{Int, Pointer, F32, F64};\n use rustc_target::abi::{Primitive, Size, VariantIdx, Variants};\n@@ -751,13 +751,23 @@ pub fn type_metadata(cx: &CodegenCx<'ll, 'tcx>, t: Ty<'tcx>, usage_site_span: Sp\n     metadata\n }\n \n+fn hex_encode(data: &[u8]) -> String {\n+    let mut hex_string = String::with_capacity(data.len() * 2);\n+    for byte in data.iter() {\n+        write!(&mut hex_string, \"{:02x}\", byte).unwrap();\n+    }\n+    hex_string\n+}\n+\n pub fn file_metadata(\n     cx: &CodegenCx<'ll, '_>,\n     file_name: &FileName,\n     defining_crate: CrateNum,\n ) -> &'ll DIFile {\n     debug!(\"file_metadata: file_name: {}, defining_crate: {}\", file_name, defining_crate);\n \n+    let source_file = cx.sess().source_map().get_source_file(file_name);\n+    let hash = source_file.as_ref().map(|f| &f.src_hash);\n     let file_name = Some(file_name.to_string());\n     let directory = if defining_crate == LOCAL_CRATE {\n         Some(cx.sess().working_dir.0.to_string_lossy().to_string())\n@@ -766,17 +776,18 @@ pub fn file_metadata(\n         // independent of the compiler's working directory one way or another.\n         None\n     };\n-    file_metadata_raw(cx, file_name, directory)\n+    file_metadata_raw(cx, file_name, directory, hash)\n }\n \n pub fn unknown_file_metadata(cx: &CodegenCx<'ll, '_>) -> &'ll DIFile {\n-    file_metadata_raw(cx, None, None)\n+    file_metadata_raw(cx, None, None, None)\n }\n \n fn file_metadata_raw(\n     cx: &CodegenCx<'ll, '_>,\n     file_name: Option<String>,\n     directory: Option<String>,\n+    hash: Option<&SourceFileHash>,\n ) -> &'ll DIFile {\n     let key = (file_name, directory);\n \n@@ -789,13 +800,27 @@ fn file_metadata_raw(\n             let file_name = file_name.as_deref().unwrap_or(\"<unknown>\");\n             let directory = directory.as_deref().unwrap_or(\"\");\n \n+            let (hash_kind, hash_value) = match hash {\n+                Some(hash) => {\n+                    let kind = match hash.kind {\n+                        rustc_span::SourceFileHashAlgorithm::Md5 => llvm::ChecksumKind::MD5,\n+                        rustc_span::SourceFileHashAlgorithm::Sha1 => llvm::ChecksumKind::SHA1,\n+                    };\n+                    (kind, hex_encode(hash.hash_bytes()))\n+                }\n+                None => (llvm::ChecksumKind::None, String::new()),\n+            };\n+\n             let file_metadata = unsafe {\n                 llvm::LLVMRustDIBuilderCreateFile(\n                     DIB(cx),\n                     file_name.as_ptr().cast(),\n                     file_name.len(),\n                     directory.as_ptr().cast(),\n                     directory.len(),\n+                    hash_kind,\n+                    hash_value.as_ptr().cast(),\n+                    hash_value.len(),\n                 )\n             };\n \n@@ -920,6 +945,9 @@ pub fn compile_unit_metadata(\n             name_in_debuginfo.len(),\n             work_dir.as_ptr().cast(),\n             work_dir.len(),\n+            llvm::ChecksumKind::None,\n+            ptr::null(),\n+            0,\n         );\n \n         let unit_metadata = llvm::LLVMRustDIBuilderCreateCompileUnit("}, {"sha": "aeb34e5c9c95444d065ea9dedc658da315ee4196", "filename": "src/librustc_codegen_llvm/llvm/ffi.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fllvm%2Fffi.rs?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -546,6 +546,15 @@ pub enum ThreadLocalMode {\n     LocalExec,\n }\n \n+/// LLVMRustChecksumKind\n+#[derive(Copy, Clone)]\n+#[repr(C)]\n+pub enum ChecksumKind {\n+    None,\n+    MD5,\n+    SHA1,\n+}\n+\n extern \"C\" {\n     type Opaque;\n }\n@@ -1640,6 +1649,9 @@ extern \"C\" {\n         FilenameLen: size_t,\n         Directory: *const c_char,\n         DirectoryLen: size_t,\n+        CSKind: ChecksumKind,\n+        Checksum: *const c_char,\n+        ChecksumLen: size_t,\n     ) -> &'a DIFile;\n \n     pub fn LLVMRustDIBuilderCreateSubroutineType("}, {"sha": "02bf1aded3bc367a7d066c2a6bd6cafe55763c31", "filename": "src/librustc_interface/util.rs", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_interface%2Futil.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_interface%2Futil.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_interface%2Futil.rs?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -22,7 +22,7 @@ use rustc_session::parse::CrateConfig;\n use rustc_session::CrateDisambiguator;\n use rustc_session::{config, early_error, filesearch, output, DiagnosticOutput, Session};\n use rustc_span::edition::Edition;\n-use rustc_span::source_map::{FileLoader, RealFileLoader, SourceMap};\n+use rustc_span::source_map::{FileLoader, SourceMap};\n use rustc_span::symbol::{sym, Symbol};\n use smallvec::SmallVec;\n use std::env;\n@@ -62,15 +62,13 @@ pub fn create_session(\n     lint_caps: FxHashMap<lint::LintId, lint::Level>,\n     descriptions: Registry,\n ) -> (Lrc<Session>, Lrc<Box<dyn CodegenBackend>>, Lrc<SourceMap>) {\n-    let loader = file_loader.unwrap_or(box RealFileLoader);\n-    let source_map = Lrc::new(SourceMap::with_file_loader(loader, sopts.file_path_mapping()));\n-    let mut sess = session::build_session_with_source_map(\n+    let (mut sess, source_map) = session::build_session_with_source_map(\n         sopts,\n         input_path,\n         descriptions,\n-        source_map.clone(),\n         diagnostic_output,\n         lint_caps,\n+        file_loader,\n     );\n \n     let codegen_backend = get_codegen_backend(&sess);"}, {"sha": "300aac19e51b03af8a075c8670ac0804dd535aa2", "filename": "src/librustc_middle/ich/impls_syntax.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_middle%2Fich%2Fimpls_syntax.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_middle%2Fich%2Fimpls_syntax.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_middle%2Fich%2Fimpls_syntax.rs?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -61,7 +61,7 @@ impl<'a> HashStable<StableHashingContext<'a>> for SourceFile {\n             cnum,\n             // Do not hash the source as it is not encoded\n             src: _,\n-            src_hash,\n+            ref src_hash,\n             external_src: _,\n             start_pos,\n             end_pos: _,"}, {"sha": "58a03dbe388e65aeafd2af3f5e32171d3ed9f1f5", "filename": "src/librustc_session/config.rs", "status": "modified", "additions": 19, "deletions": 11, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_session%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_session%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_session%2Fconfig.rs?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -18,9 +18,10 @@ use rustc_feature::UnstableFeatures;\n use rustc_span::edition::{Edition, DEFAULT_EDITION, EDITION_NAME_LIST};\n use rustc_span::source_map::{FileName, FilePathMapping};\n use rustc_span::symbol::{sym, Symbol};\n+use rustc_span::SourceFileHashAlgorithm;\n \n use rustc_errors::emitter::HumanReadableErrorType;\n-use rustc_errors::{ColorConfig, FatalError, Handler, HandlerFlags};\n+use rustc_errors::{ColorConfig, HandlerFlags};\n \n use std::collections::btree_map::{\n     Iter as BTreeMapIter, Keys as BTreeMapKeysIter, Values as BTreeMapValuesIter,\n@@ -748,25 +749,30 @@ pub fn build_configuration(sess: &Session, mut user_cfg: CrateConfig) -> CrateCo\n     user_cfg\n }\n \n-pub fn build_target_config(opts: &Options, sp: &Handler) -> Config {\n+pub fn build_target_config(opts: &Options, error_format: ErrorOutputType) -> Config {\n     let target = Target::search(&opts.target_triple).unwrap_or_else(|e| {\n-        sp.struct_fatal(&format!(\"Error loading target specification: {}\", e))\n-            .help(\"Use `--print target-list` for a list of built-in targets\")\n-            .emit();\n-        FatalError.raise();\n+        early_error(\n+            error_format,\n+            &format!(\n+                \"Error loading target specification: {}. \\\n+            Use `--print target-list` for a list of built-in targets\",\n+                e\n+            ),\n+        )\n     });\n \n     let ptr_width = match &target.target_pointer_width[..] {\n         \"16\" => 16,\n         \"32\" => 32,\n         \"64\" => 64,\n-        w => sp\n-            .fatal(&format!(\n+        w => early_error(\n+            error_format,\n+            &format!(\n                 \"target specification was invalid: \\\n              unrecognized target-pointer-width {}\",\n                 w\n-            ))\n-            .raise(),\n+            ),\n+        ),\n     };\n \n     Config { target, ptr_width }\n@@ -1971,7 +1977,8 @@ impl PpMode {\n crate mod dep_tracking {\n     use super::{\n         CFGuard, CrateType, DebugInfo, ErrorOutputType, LinkerPluginLto, LtoCli, OptLevel,\n-        OutputTypes, Passes, Sanitizer, SwitchWithOptPath, SymbolManglingVersion,\n+        OutputTypes, Passes, Sanitizer, SourceFileHashAlgorithm, SwitchWithOptPath,\n+        SymbolManglingVersion,\n     };\n     use crate::lint;\n     use crate::utils::NativeLibraryKind;\n@@ -2049,6 +2056,7 @@ crate mod dep_tracking {\n     impl_dep_tracking_hash_via_hash!(LinkerPluginLto);\n     impl_dep_tracking_hash_via_hash!(SwitchWithOptPath);\n     impl_dep_tracking_hash_via_hash!(SymbolManglingVersion);\n+    impl_dep_tracking_hash_via_hash!(Option<SourceFileHashAlgorithm>);\n \n     impl_dep_tracking_hash_for_sortable_vec_of!(String);\n     impl_dep_tracking_hash_for_sortable_vec_of!(PathBuf);"}, {"sha": "3962e30335db2902bb4d201f1917369f157e6693", "filename": "src/librustc_session/options.rs", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_session%2Foptions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_session%2Foptions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_session%2Foptions.rs?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -10,6 +10,7 @@ use rustc_target::spec::{LinkerFlavor, MergeFunctions, PanicStrategy, RelroLevel\n \n use rustc_feature::UnstableFeatures;\n use rustc_span::edition::Edition;\n+use rustc_span::SourceFileHashAlgorithm;\n \n use std::collections::BTreeMap;\n \n@@ -283,12 +284,14 @@ macro_rules! options {\n             Some(\"one of: `disabled`, `trampolines`, or `aliases`\");\n         pub const parse_symbol_mangling_version: Option<&str> =\n             Some(\"either `legacy` or `v0` (RFC 2603)\");\n+        pub const parse_src_file_hash: Option<&str> =\n+            Some(\"either `md5`, or `sha1`\");\n     }\n \n     #[allow(dead_code)]\n     mod $mod_set {\n         use super::{$struct_name, Passes, Sanitizer, LtoCli, LinkerPluginLto, SwitchWithOptPath,\n-            SymbolManglingVersion, CFGuard};\n+            SymbolManglingVersion, CFGuard, SourceFileHashAlgorithm};\n         use rustc_target::spec::{LinkerFlavor, MergeFunctions, PanicStrategy, RelroLevel};\n         use std::path::PathBuf;\n         use std::str::FromStr;\n@@ -622,6 +625,14 @@ macro_rules! options {\n             };\n             true\n         }\n+\n+        fn parse_src_file_hash(slot: &mut Option<SourceFileHashAlgorithm>, v: Option<&str>) -> bool {\n+            match v.and_then(|s| SourceFileHashAlgorithm::from_str(s).ok()) {\n+                Some(hash_kind) => *slot = Some(hash_kind),\n+                _ => return false,\n+            }\n+            true\n+        }\n     }\n ) }\n \n@@ -961,4 +972,6 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n         \"use new LLVM pass manager\"),\n     link_native_libraries: Option<bool> = (None, parse_opt_bool, [UNTRACKED],\n         \"Link native libraries in the linker invocation.\"),\n+    src_hash_algorithm: Option<SourceFileHashAlgorithm> = (None, parse_src_file_hash, [TRACKED],\n+        \"hash algorithm of source files in debug info (`md5`, or `sha1`)\"),\n }"}, {"sha": "914a4503b5280c843865566bb7fda157fcbdd95a", "filename": "src/librustc_session/session.rs", "status": "modified", "additions": 30, "deletions": 26, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_session%2Fsession.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_session%2Fsession.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_session%2Fsession.rs?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -20,7 +20,8 @@ use rustc_errors::emitter::{Emitter, EmitterWriter, HumanReadableErrorType};\n use rustc_errors::json::JsonEmitter;\n use rustc_errors::{Applicability, DiagnosticBuilder, DiagnosticId, ErrorReported};\n use rustc_span::edition::Edition;\n-use rustc_span::source_map::{self, MultiSpan, Span};\n+use rustc_span::source_map::{self, FileLoader, MultiSpan, RealFileLoader, SourceMap, Span};\n+use rustc_span::SourceFileHashAlgorithm;\n use rustc_target::spec::{PanicStrategy, RelroLevel, Target, TargetTriple};\n \n use std::cell::{self, RefCell};\n@@ -854,16 +855,15 @@ pub fn build_session(\n     local_crate_source_file: Option<PathBuf>,\n     registry: rustc_errors::registry::Registry,\n ) -> Session {\n-    let file_path_mapping = sopts.file_path_mapping();\n-\n     build_session_with_source_map(\n         sopts,\n         local_crate_source_file,\n         registry,\n-        Lrc::new(source_map::SourceMap::new(file_path_mapping)),\n         DiagnosticOutput::Default,\n         Default::default(),\n+        None,\n     )\n+    .0\n }\n \n fn default_emitter(\n@@ -940,10 +940,10 @@ pub fn build_session_with_source_map(\n     sopts: config::Options,\n     local_crate_source_file: Option<PathBuf>,\n     registry: rustc_errors::registry::Registry,\n-    source_map: Lrc<source_map::SourceMap>,\n     diagnostics_output: DiagnosticOutput,\n-    lint_caps: FxHashMap<lint::LintId, lint::Level>,\n-) -> Session {\n+    driver_lint_caps: FxHashMap<lint::LintId, lint::Level>,\n+    file_loader: Option<Box<dyn FileLoader + Send + Sync + 'static>>,\n+) -> (Session, Lrc<SourceMap>) {\n     // FIXME: This is not general enough to make the warning lint completely override\n     // normal diagnostic warnings, since the warning lint can also be denied and changed\n     // later via the source code.\n@@ -961,23 +961,33 @@ pub fn build_session_with_source_map(\n         DiagnosticOutput::Default => None,\n         DiagnosticOutput::Raw(write) => Some(write),\n     };\n+\n+    let target_cfg = config::build_target_config(&sopts, sopts.error_format);\n+    let host_triple = TargetTriple::from_triple(config::host_triple());\n+    let host = Target::search(&host_triple).unwrap_or_else(|e| {\n+        early_error(sopts.error_format, &format!(\"Error loading host specification: {}\", e))\n+    });\n+\n+    let loader = file_loader.unwrap_or(Box::new(RealFileLoader));\n+    let hash_kind = sopts.debugging_opts.src_hash_algorithm.unwrap_or_else(|| {\n+        if target_cfg.target.options.is_like_msvc {\n+            SourceFileHashAlgorithm::Sha1\n+        } else {\n+            SourceFileHashAlgorithm::Md5\n+        }\n+    });\n+    let source_map = Lrc::new(SourceMap::with_file_loader_and_hash_kind(\n+        loader,\n+        sopts.file_path_mapping(),\n+        hash_kind,\n+    ));\n     let emitter = default_emitter(&sopts, registry, &source_map, write_dest);\n \n-    let diagnostic_handler = rustc_errors::Handler::with_emitter_and_flags(\n+    let span_diagnostic = rustc_errors::Handler::with_emitter_and_flags(\n         emitter,\n         sopts.debugging_opts.diagnostic_handler_flags(can_emit_warnings),\n     );\n \n-    build_session_(sopts, local_crate_source_file, diagnostic_handler, source_map, lint_caps)\n-}\n-\n-fn build_session_(\n-    sopts: config::Options,\n-    local_crate_source_file: Option<PathBuf>,\n-    span_diagnostic: rustc_errors::Handler,\n-    source_map: Lrc<source_map::SourceMap>,\n-    driver_lint_caps: FxHashMap<lint::LintId, lint::Level>,\n-) -> Session {\n     let self_profiler = if let SwitchWithOptPath::Enabled(ref d) = sopts.debugging_opts.self_profile\n     {\n         let directory =\n@@ -999,13 +1009,7 @@ fn build_session_(\n         None\n     };\n \n-    let host_triple = TargetTriple::from_triple(config::host_triple());\n-    let host = Target::search(&host_triple).unwrap_or_else(|e| {\n-        span_diagnostic.fatal(&format!(\"Error loading host specification: {}\", e)).raise()\n-    });\n-    let target_cfg = config::build_target_config(&sopts, &span_diagnostic);\n-\n-    let parse_sess = ParseSess::with_span_handler(span_diagnostic, source_map);\n+    let parse_sess = ParseSess::with_span_handler(span_diagnostic, source_map.clone());\n     let sysroot = match &sopts.maybe_sysroot {\n         Some(sysroot) => sysroot.clone(),\n         None => filesearch::get_or_default_sysroot(),\n@@ -1098,7 +1102,7 @@ fn build_session_(\n \n     validate_commandline_args_with_session_available(&sess);\n \n-    sess\n+    (sess, source_map)\n }\n \n // If it is useful to have a Session available already for validating a"}, {"sha": "1c2721260d69b5f1f7366766613c743a76476147", "filename": "src/librustc_span/Cargo.toml", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_span%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_span%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_span%2FCargo.toml?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -19,3 +19,5 @@ scoped-tls = \"1.0\"\n unicode-width = \"0.1.4\"\n cfg-if = \"0.1.2\"\n log = \"0.4\"\n+sha-1 = \"0.8\"\n+md-5 = \"0.8\""}, {"sha": "0d9f3f214fb21afa031497863edd1726a9e085e7", "filename": "src/librustc_span/lib.rs", "status": "modified", "additions": 77, "deletions": 12, "changes": 89, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_span%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_span%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_span%2Flib.rs?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -47,9 +47,14 @@ use std::borrow::Cow;\n use std::cell::RefCell;\n use std::cmp::{self, Ordering};\n use std::fmt;\n-use std::hash::{Hash, Hasher};\n+use std::hash::Hash;\n use std::ops::{Add, Sub};\n use std::path::PathBuf;\n+use std::str::FromStr;\n+\n+use md5::Md5;\n+use sha1::Digest;\n+use sha1::Sha1;\n \n #[cfg(test)]\n mod tests;\n@@ -874,6 +879,70 @@ impl ExternalSource {\n #[derive(Debug)]\n pub struct OffsetOverflowError;\n \n+#[derive(Copy, Clone, Debug, PartialEq, Eq, PartialOrd, Ord, Hash, RustcEncodable, RustcDecodable)]\n+pub enum SourceFileHashAlgorithm {\n+    Md5,\n+    Sha1,\n+}\n+\n+impl FromStr for SourceFileHashAlgorithm {\n+    type Err = ();\n+\n+    fn from_str(s: &str) -> Result<SourceFileHashAlgorithm, ()> {\n+        match s {\n+            \"md5\" => Ok(SourceFileHashAlgorithm::Md5),\n+            \"sha1\" => Ok(SourceFileHashAlgorithm::Sha1),\n+            _ => Err(()),\n+        }\n+    }\n+}\n+\n+rustc_data_structures::impl_stable_hash_via_hash!(SourceFileHashAlgorithm);\n+\n+/// The hash of the on-disk source file used for debug info.\n+#[derive(Copy, Clone, PartialEq, Eq, Debug, RustcEncodable, RustcDecodable)]\n+#[derive(HashStable_Generic)]\n+pub struct SourceFileHash {\n+    pub kind: SourceFileHashAlgorithm,\n+    value: [u8; 20],\n+}\n+\n+impl SourceFileHash {\n+    pub fn new(kind: SourceFileHashAlgorithm, src: &str) -> SourceFileHash {\n+        let mut hash = SourceFileHash { kind, value: Default::default() };\n+        let len = hash.hash_len();\n+        let value = &mut hash.value[..len];\n+        let data = src.as_bytes();\n+        match kind {\n+            SourceFileHashAlgorithm::Md5 => {\n+                value.copy_from_slice(&Md5::digest(data));\n+            }\n+            SourceFileHashAlgorithm::Sha1 => {\n+                value.copy_from_slice(&Sha1::digest(data));\n+            }\n+        }\n+        hash\n+    }\n+\n+    /// Check if the stored hash matches the hash of the string.\n+    pub fn matches(&self, src: &str) -> bool {\n+        Self::new(self.kind, src) == *self\n+    }\n+\n+    /// The bytes of the hash.\n+    pub fn hash_bytes(&self) -> &[u8] {\n+        let len = self.hash_len();\n+        &self.value[..len]\n+    }\n+\n+    fn hash_len(&self) -> usize {\n+        match self.kind {\n+            SourceFileHashAlgorithm::Md5 => 16,\n+            SourceFileHashAlgorithm::Sha1 => 20,\n+        }\n+    }\n+}\n+\n /// A single source in the `SourceMap`.\n #[derive(Clone)]\n pub struct SourceFile {\n@@ -889,7 +958,7 @@ pub struct SourceFile {\n     /// The complete source code.\n     pub src: Option<Lrc<String>>,\n     /// The source code's hash.\n-    pub src_hash: u128,\n+    pub src_hash: SourceFileHash,\n     /// The external source code (used for external crates, which will have a `None`\n     /// value as `self.src`.\n     pub external_src: Lock<ExternalSource>,\n@@ -987,7 +1056,8 @@ impl Decodable for SourceFile {\n             let name: FileName = d.read_struct_field(\"name\", 0, |d| Decodable::decode(d))?;\n             let name_was_remapped: bool =\n                 d.read_struct_field(\"name_was_remapped\", 1, |d| Decodable::decode(d))?;\n-            let src_hash: u128 = d.read_struct_field(\"src_hash\", 2, |d| Decodable::decode(d))?;\n+            let src_hash: SourceFileHash =\n+                d.read_struct_field(\"src_hash\", 2, |d| Decodable::decode(d))?;\n             let start_pos: BytePos =\n                 d.read_struct_field(\"start_pos\", 3, |d| Decodable::decode(d))?;\n             let end_pos: BytePos = d.read_struct_field(\"end_pos\", 4, |d| Decodable::decode(d))?;\n@@ -1062,14 +1132,12 @@ impl SourceFile {\n         unmapped_path: FileName,\n         mut src: String,\n         start_pos: BytePos,\n+        hash_kind: SourceFileHashAlgorithm,\n     ) -> Self {\n+        // Compute the file hash before any normalization.\n+        let src_hash = SourceFileHash::new(hash_kind, &src);\n         let normalized_pos = normalize_src(&mut src, start_pos);\n \n-        let src_hash = {\n-            let mut hasher: StableHasher = StableHasher::new();\n-            hasher.write(src.as_bytes());\n-            hasher.finish::<u128>()\n-        };\n         let name_hash = {\n             let mut hasher: StableHasher = StableHasher::new();\n             name.hash(&mut hasher);\n@@ -1125,10 +1193,7 @@ impl SourceFile {\n             } = &mut *external_src\n             {\n                 if let Some(src) = src {\n-                    let mut hasher: StableHasher = StableHasher::new();\n-                    hasher.write(src.as_bytes());\n-\n-                    if hasher.finish::<u128>() == self.src_hash {\n+                    if self.src_hash.matches(&src) {\n                         *src_kind = ExternalSourceKind::Present(Lrc::new(src));\n                         return true;\n                     }"}, {"sha": "49e2144b3e38011a74ee4411af56d68530518cb9", "filename": "src/librustc_span/source_map.rs", "status": "modified", "additions": 12, "deletions": 7, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_span%2Fsource_map.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibrustc_span%2Fsource_map.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_span%2Fsource_map.rs?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -141,27 +141,31 @@ pub struct SourceMap {\n     // This is used to apply the file path remapping as specified via\n     // `--remap-path-prefix` to all `SourceFile`s allocated within this `SourceMap`.\n     path_mapping: FilePathMapping,\n+\n+    /// The algorithm used for hashing the contents of each source file.\n+    hash_kind: SourceFileHashAlgorithm,\n }\n \n impl SourceMap {\n     pub fn new(path_mapping: FilePathMapping) -> SourceMap {\n-        SourceMap {\n-            used_address_space: AtomicU32::new(0),\n-            files: Default::default(),\n-            file_loader: Box::new(RealFileLoader),\n+        Self::with_file_loader_and_hash_kind(\n+            Box::new(RealFileLoader),\n             path_mapping,\n-        }\n+            SourceFileHashAlgorithm::Md5,\n+        )\n     }\n \n-    pub fn with_file_loader(\n+    pub fn with_file_loader_and_hash_kind(\n         file_loader: Box<dyn FileLoader + Sync + Send>,\n         path_mapping: FilePathMapping,\n+        hash_kind: SourceFileHashAlgorithm,\n     ) -> SourceMap {\n         SourceMap {\n             used_address_space: AtomicU32::new(0),\n             files: Default::default(),\n             file_loader,\n             path_mapping,\n+            hash_kind,\n         }\n     }\n \n@@ -275,6 +279,7 @@ impl SourceMap {\n                     unmapped_path,\n                     src,\n                     Pos::from_usize(start_pos),\n+                    self.hash_kind,\n                 ));\n \n                 let mut files = self.files.borrow_mut();\n@@ -296,7 +301,7 @@ impl SourceMap {\n         &self,\n         filename: FileName,\n         name_was_remapped: bool,\n-        src_hash: u128,\n+        src_hash: SourceFileHash,\n         name_hash: u128,\n         source_len: usize,\n         cnum: CrateNum,"}, {"sha": "e80d16bb0c7ab83b3c8609cf82d7294ab13a9a56", "filename": "src/libserialize/serialize.rs", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibserialize%2Fserialize.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Flibserialize%2Fserialize.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibserialize%2Fserialize.rs?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -706,6 +706,30 @@ impl<T: Decodable> Decodable for Vec<T> {\n     }\n }\n \n+impl Encodable for [u8; 20] {\n+    fn encode<S: Encoder>(&self, s: &mut S) -> Result<(), S::Error> {\n+        s.emit_seq(self.len(), |s| {\n+            for (i, e) in self.iter().enumerate() {\n+                s.emit_seq_elt(i, |s| e.encode(s))?\n+            }\n+            Ok(())\n+        })\n+    }\n+}\n+\n+impl Decodable for [u8; 20] {\n+    fn decode<D: Decoder>(d: &mut D) -> Result<[u8; 20], D::Error> {\n+        d.read_seq(|d, len| {\n+            assert!(len == 20);\n+            let mut v = [0u8; 20];\n+            for i in 0..len {\n+                v[i] = d.read_seq_elt(i, |d| Decodable::decode(d))?;\n+            }\n+            Ok(v)\n+        })\n+    }\n+}\n+\n impl<'a, T: Encodable> Encodable for Cow<'a, [T]>\n where\n     [T]: ToOwned<Owned = Vec<T>>,"}, {"sha": "21094b3252089efa43882f23fc125d2698cac530", "filename": "src/rustllvm/RustWrapper.cpp", "status": "modified", "additions": 27, "deletions": 2, "changes": 29, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Frustllvm%2FRustWrapper.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Frustllvm%2FRustWrapper.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustllvm%2FRustWrapper.cpp?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -640,6 +640,25 @@ static DICompileUnit::DebugEmissionKind fromRust(LLVMRustDebugEmissionKind Kind)\n   }\n }\n \n+enum class LLVMRustChecksumKind {\n+  None,\n+  MD5,\n+  SHA1,\n+};\n+\n+static Optional<DIFile::ChecksumKind> fromRust(LLVMRustChecksumKind Kind) {\n+  switch (Kind) {\n+  case LLVMRustChecksumKind::None:\n+    return None;\n+  case LLVMRustChecksumKind::MD5:\n+    return DIFile::ChecksumKind::CSK_MD5;\n+  case LLVMRustChecksumKind::SHA1:\n+    return DIFile::ChecksumKind::CSK_SHA1;\n+  default:\n+    report_fatal_error(\"bad ChecksumKind.\");\n+  }\n+}\n+\n extern \"C\" uint32_t LLVMRustDebugMetadataVersion() {\n   return DEBUG_METADATA_VERSION;\n }\n@@ -686,9 +705,15 @@ extern \"C\" LLVMMetadataRef LLVMRustDIBuilderCreateCompileUnit(\n extern \"C\" LLVMMetadataRef LLVMRustDIBuilderCreateFile(\n     LLVMRustDIBuilderRef Builder,\n     const char *Filename, size_t FilenameLen,\n-    const char *Directory, size_t DirectoryLen) {\n+    const char *Directory, size_t DirectoryLen, LLVMRustChecksumKind CSKind,\n+    const char *Checksum, size_t ChecksumLen) {\n+  Optional<DIFile::ChecksumKind> llvmCSKind = fromRust(CSKind);\n+  Optional<DIFile::ChecksumInfo<StringRef>> CSInfo{};\n+  if (llvmCSKind)\n+    CSInfo.emplace(*llvmCSKind, StringRef{Checksum, ChecksumLen});\n   return wrap(Builder->createFile(StringRef(Filename, FilenameLen),\n-                                  StringRef(Directory, DirectoryLen)));\n+                                  StringRef(Directory, DirectoryLen),\n+                                  CSInfo));\n }\n \n extern \"C\" LLVMMetadataRef"}, {"sha": "20475bab0fc923251aad63eabb643ad96c7a529b", "filename": "src/test/codegen/remap_path_prefix/main.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Ftest%2Fcodegen%2Fremap_path_prefix%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Ftest%2Fcodegen%2Fremap_path_prefix%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fremap_path_prefix%2Fmain.rs?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -22,7 +22,7 @@ fn main() {\n }\n \n // Here we check that local debuginfo is mapped correctly.\n-// CHECK: !DIFile(filename: \"/the/src/remap_path_prefix/main.rs\", directory: \"/the/cwd/\")\n+// CHECK: !DIFile(filename: \"/the/src/remap_path_prefix/main.rs\", directory: \"/the/cwd/\"\n \n // And here that debuginfo from other crates are expanded to absolute paths.\n-// CHECK: !DIFile(filename: \"/the/aux-src/remap_path_prefix_aux.rs\", directory: \"\")\n+// CHECK: !DIFile(filename: \"/the/aux-src/remap_path_prefix_aux.rs\", directory: \"\""}, {"sha": "7a9d2ca9b6bbdb67ba8504273c489626ac49a2d6", "filename": "src/test/codegen/remap_path_prefix/xcrate-generic.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Ftest%2Fcodegen%2Fremap_path_prefix%2Fxcrate-generic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Ftest%2Fcodegen%2Fremap_path_prefix%2Fxcrate-generic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fremap_path_prefix%2Fxcrate-generic.rs?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -11,4 +11,4 @@ pub fn foo() {\n }\n \n // Here we check that local debuginfo is mapped correctly.\n-// CHECK: !DIFile(filename: \"/the/aux-src/xcrate-generic.rs\", directory: \"\")\n+// CHECK: !DIFile(filename: \"/the/aux-src/xcrate-generic.rs\", directory: \"\""}, {"sha": "64be1127786f104258570bfbb9d408a2fafadeaa", "filename": "src/test/codegen/src-hash-algorithm/src-hash-algorithm-md5.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Ftest%2Fcodegen%2Fsrc-hash-algorithm%2Fsrc-hash-algorithm-md5.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Ftest%2Fcodegen%2Fsrc-hash-algorithm%2Fsrc-hash-algorithm-md5.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fsrc-hash-algorithm%2Fsrc-hash-algorithm-md5.rs?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -0,0 +1,6 @@\n+// compile-flags: -g -Z src-hash-algorithm=md5\n+\n+#![crate_type = \"lib\"]\n+\n+pub fn test() {}\n+// CHECK: checksumkind: CSK_MD5"}, {"sha": "54e07152142ec35b389eedd2b0d439fef37b7e92", "filename": "src/test/codegen/src-hash-algorithm/src-hash-algorithm-sha1.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Ftest%2Fcodegen%2Fsrc-hash-algorithm%2Fsrc-hash-algorithm-sha1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Ftest%2Fcodegen%2Fsrc-hash-algorithm%2Fsrc-hash-algorithm-sha1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcodegen%2Fsrc-hash-algorithm%2Fsrc-hash-algorithm-sha1.rs?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -0,0 +1,6 @@\n+// compile-flags: -g -Z src-hash-algorithm=sha1\n+\n+#![crate_type = \"lib\"]\n+\n+pub fn test() {}\n+// CHECK: checksumkind: CSK_SHA1"}, {"sha": "62dc965b55f995986711e9ab22cc8421ee2c0754", "filename": "src/tools/tidy/src/deps.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/f86b078e2df79968e40185c91b0dce81bc580872/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f86b078e2df79968e40185c91b0dce81bc580872/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Fdeps.rs?ref=f86b078e2df79968e40185c91b0dce81bc580872", "patch": "@@ -26,7 +26,6 @@ const LICENSES: &[&str] = &[\n const EXCEPTIONS: &[(&str, &str)] = &[\n     (\"mdbook\", \"MPL-2.0\"),                  // mdbook\n     (\"openssl\", \"Apache-2.0\"),              // cargo, mdbook\n-    (\"arrayref\", \"BSD-2-Clause\"),           // mdbook via handlebars via pest\n     (\"toml-query\", \"MPL-2.0\"),              // mdbook\n     (\"toml-query_derive\", \"MPL-2.0\"),       // mdbook\n     (\"is-match\", \"MPL-2.0\"),                // mdbook\n@@ -74,6 +73,9 @@ const WHITELIST: &[&str] = &[\n     \"backtrace\",\n     \"backtrace-sys\",\n     \"bitflags\",\n+    \"block-buffer\",\n+    \"block-padding\",\n+    \"byte-tools\",\n     \"byteorder\",\n     \"c2-chacha\",\n     \"cc\",\n@@ -87,15 +89,18 @@ const WHITELIST: &[&str] = &[\n     \"crossbeam-queue\",\n     \"crossbeam-utils\",\n     \"datafrog\",\n+    \"digest\",\n     \"dlmalloc\",\n     \"either\",\n     \"ena\",\n     \"env_logger\",\n+    \"fake-simd\",\n     \"filetime\",\n     \"flate2\",\n     \"fortanix-sgx-abi\",\n     \"fuchsia-zircon\",\n     \"fuchsia-zircon-sys\",\n+    \"generic-array\",\n     \"getopts\",\n     \"getrandom\",\n     \"hashbrown\",\n@@ -111,13 +116,15 @@ const WHITELIST: &[&str] = &[\n     \"lock_api\",\n     \"log\",\n     \"log_settings\",\n+    \"md-5\",\n     \"measureme\",\n     \"memchr\",\n     \"memmap\",\n     \"memoffset\",\n     \"miniz_oxide\",\n     \"nodrop\",\n     \"num_cpus\",\n+    \"opaque-debug\",\n     \"parking_lot\",\n     \"parking_lot_core\",\n     \"pkg-config\",\n@@ -150,6 +157,7 @@ const WHITELIST: &[&str] = &[\n     \"semver-parser\",\n     \"serde\",\n     \"serde_derive\",\n+    \"sha-1\",\n     \"smallvec\",\n     \"stable_deref_trait\",\n     \"syn\",\n@@ -159,6 +167,7 @@ const WHITELIST: &[&str] = &[\n     \"termion\",\n     \"termize\",\n     \"thread_local\",\n+    \"typenum\",\n     \"ucd-util\",\n     \"unicode-normalization\",\n     \"unicode-script\","}]}