{"sha": "b59fbfdbe1c31768ca12a0f899e6db74396e9ba5", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI1OWZiZmRiZTFjMzE3NjhjYTEyYTBmODk5ZTZkYjc0Mzk2ZTliYTU=", "commit": {"author": {"name": "varkor", "email": "github@varkor.com", "date": "2017-12-19T01:54:00Z"}, "committer": {"name": "varkor", "email": "github@varkor.com", "date": "2017-12-19T01:54:00Z"}, "message": "Move source-output conflict checking into  `compile_input`", "tree": {"sha": "e861c566084c7b8a9031069870eec73368d0ff88", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e861c566084c7b8a9031069870eec73368d0ff88"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b59fbfdbe1c31768ca12a0f899e6db74396e9ba5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b59fbfdbe1c31768ca12a0f899e6db74396e9ba5", "html_url": "https://github.com/rust-lang/rust/commit/b59fbfdbe1c31768ca12a0f899e6db74396e9ba5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b59fbfdbe1c31768ca12a0f899e6db74396e9ba5/comments", "author": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "varkor", "id": 3943692, "node_id": "MDQ6VXNlcjM5NDM2OTI=", "avatar_url": "https://avatars.githubusercontent.com/u/3943692?v=4", "gravatar_id": "", "url": "https://api.github.com/users/varkor", "html_url": "https://github.com/varkor", "followers_url": "https://api.github.com/users/varkor/followers", "following_url": "https://api.github.com/users/varkor/following{/other_user}", "gists_url": "https://api.github.com/users/varkor/gists{/gist_id}", "starred_url": "https://api.github.com/users/varkor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/varkor/subscriptions", "organizations_url": "https://api.github.com/users/varkor/orgs", "repos_url": "https://api.github.com/users/varkor/repos", "events_url": "https://api.github.com/users/varkor/events{/privacy}", "received_events_url": "https://api.github.com/users/varkor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c76cdce3d953759a53d4990af0f5fb472cbc04de", "url": "https://api.github.com/repos/rust-lang/rust/commits/c76cdce3d953759a53d4990af0f5fb472cbc04de", "html_url": "https://github.com/rust-lang/rust/commit/c76cdce3d953759a53d4990af0f5fb472cbc04de"}], "stats": {"total": 32, "additions": 17, "deletions": 15}, "files": [{"sha": "a288ff6316f8316e77bd576ecbc350bf68b84d81", "filename": "src/librustc_driver/driver.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/b59fbfdbe1c31768ca12a0f899e6db74396e9ba5/src%2Flibrustc_driver%2Fdriver.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b59fbfdbe1c31768ca12a0f899e6db74396e9ba5/src%2Flibrustc_driver%2Fdriver.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Fdriver.rs?ref=b59fbfdbe1c31768ca12a0f899e6db74396e9ba5", "patch": "@@ -71,6 +71,7 @@ use profile;\n \n pub fn compile_input(sess: &Session,\n                      cstore: &CStore,\n+                     input_path: &Option<PathBuf>,\n                      input: &Input,\n                      outdir: &Option<PathBuf>,\n                      output: &Option<PathBuf>,\n@@ -142,6 +143,20 @@ pub fn compile_input(sess: &Session,\n         };\n \n         let outputs = build_output_filenames(input, outdir, output, &krate.attrs, sess);\n+\n+        // Ensure the source file isn't accidentally overwritten during compilation.\n+        match *input_path {\n+            Some(ref input_path) => {\n+                if outputs.contains_path(input_path) && sess.opts.will_create_output_file() {\n+                    sess.err(&format!(\n+                        \"the input file \\\"{}\\\" would be overwritten by the generated executable\",\n+                        input_path.display()));\n+                    return Err(CompileIncomplete::Stopped);\n+                }\n+            },\n+            None => {}\n+        }\n+\n         let crate_name =\n             ::rustc_trans_utils::link::find_crate_name(Some(sess), &krate.attrs, input);\n         let ExpansionResult { expanded_crate, defs, analysis, resolutions, mut hir_forest } = {"}, {"sha": "60857505c7ac5277ed5aa97d29cb67fd14e2958c", "filename": "src/librustc_driver/lib.rs", "status": "modified", "additions": 1, "deletions": 14, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/b59fbfdbe1c31768ca12a0f899e6db74396e9ba5/src%2Flibrustc_driver%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b59fbfdbe1c31768ca12a0f899e6db74396e9ba5/src%2Flibrustc_driver%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_driver%2Flib.rs?ref=b59fbfdbe1c31768ca12a0f899e6db74396e9ba5", "patch": "@@ -237,20 +237,6 @@ pub fn run_compiler<'a>(args: &[String],\n     rustc_trans::init(&sess);\n     rustc_lint::register_builtins(&mut sess.lint_store.borrow_mut(), Some(&sess));\n \n-    // Ensure the source file isn't accidentally overwritten during compilation.\n-    match input_file_path {\n-        Some(input_file_path) => {\n-            if driver::build_output_filenames(&input, &odir, &ofile, &[], &sess)\n-                .contains_path(&input_file_path) && sess.opts.will_create_output_file() {\n-                sess.err(&format!(\n-                    \"the input file \\\"{}\\\" would be overwritten by the generated executable\",\n-                    input_file_path.display()));\n-                return (Err(CompileIncomplete::Stopped), Some(sess));\n-            }\n-        },\n-        None => {}\n-    }\n-\n     let mut cfg = config::build_configuration(&sess, cfg);\n     target_features::add_configuration(&mut cfg, &sess);\n     sess.parse_sess.config = cfg;\n@@ -266,6 +252,7 @@ pub fn run_compiler<'a>(args: &[String],\n     let control = callbacks.build_controller(&sess, &matches);\n     (driver::compile_input(&sess,\n                            &cstore,\n+                           &input_file_path,\n                            &input,\n                            &odir,\n                            &ofile,"}, {"sha": "06d00dec626931157e10ea67f90707722d5ae1e2", "filename": "src/librustdoc/test.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b59fbfdbe1c31768ca12a0f899e6db74396e9ba5/src%2Flibrustdoc%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b59fbfdbe1c31768ca12a0f899e6db74396e9ba5/src%2Flibrustdoc%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Ftest.rs?ref=b59fbfdbe1c31768ca12a0f899e6db74396e9ba5", "patch": "@@ -263,7 +263,7 @@ fn run_test(test: &str, cratename: &str, filename: &FileName, cfgs: Vec<String>,\n     }\n \n     let res = panic::catch_unwind(AssertUnwindSafe(|| {\n-        driver::compile_input(&sess, &cstore, &input, &out, &None, None, &control)\n+        driver::compile_input(&sess, &cstore, &None, &input, &out, &None, None, &control)\n     }));\n \n     let compile_result = match res {"}]}