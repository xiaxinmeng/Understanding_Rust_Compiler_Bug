{"sha": "91b8b9ba4be1de6f6b974f2994a2b722e5794762", "node_id": "C_kwDOAAsO6NoAKDkxYjhiOWJhNGJlMWRlNmY2Yjk3NGYyOTk0YTJiNzIyZTU3OTQ3NjI", "commit": {"author": {"name": "Dylan DPC", "email": "99973273+Dylan-DPC@users.noreply.github.com", "date": "2022-07-28T11:08:30Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-07-28T11:08:30Z"}, "message": "Rollup merge of #99714 - ouz-a:issue_57961, r=oli-obk\n\nFix regression introduced with #99383\n\nFixes #99642", "tree": {"sha": "35f6ea28b9e224d16ec8374ebb1382bdeba90523", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/35f6ea28b9e224d16ec8374ebb1382bdeba90523"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/91b8b9ba4be1de6f6b974f2994a2b722e5794762", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJi4m4uCRBK7hj4Ov3rIwAA4ZMIADXM1EHVphLM1ZxH43lelYGD\neZS9YOcYeoY/L96MErh7tPvfnJB9gpu34pPYZPk0TXKeIH2LaUVJt/spEbeLdI3J\nnRYEB5uMbGZBSF/ez34OU1domM79YkJ5s4s9Mag7BZ5NZexq9r6lhI9FGwbBMQhI\nxxroQFekCP/I3KHxpmZVVGcXJOV4BT+OWCBXoTuyoa9d5mcG8+sebwzpHZH28ZR2\nyPe0Q4/OyGMNirrt+rY6eg0ZPRjFaJsepPwJJElFxvoXT6O/VowWDpizghqa77CH\niStCoDoVhjF5vbIiuCtEnljf1XbH/YumpQlMUc5VBJ1UN6Bh47WvzrkzFJ+l40I=\n=5UfL\n-----END PGP SIGNATURE-----\n", "payload": "tree 35f6ea28b9e224d16ec8374ebb1382bdeba90523\nparent 48316dfea1914d25189fa441e7310449ed76a446\nparent 8716eae3b16cda362186765ad739ca56331728cf\nauthor Dylan DPC <99973273+Dylan-DPC@users.noreply.github.com> 1659006510 +0530\ncommitter GitHub <noreply@github.com> 1659006510 +0530\n\nRollup merge of #99714 - ouz-a:issue_57961, r=oli-obk\n\nFix regression introduced with #99383\n\nFixes #99642\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/91b8b9ba4be1de6f6b974f2994a2b722e5794762", "html_url": "https://github.com/rust-lang/rust/commit/91b8b9ba4be1de6f6b974f2994a2b722e5794762", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/91b8b9ba4be1de6f6b974f2994a2b722e5794762/comments", "author": {"login": "Dylan-DPC", "id": 99973273, "node_id": "U_kgDOBfV4mQ", "avatar_url": "https://avatars.githubusercontent.com/u/99973273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Dylan-DPC", "html_url": "https://github.com/Dylan-DPC", "followers_url": "https://api.github.com/users/Dylan-DPC/followers", "following_url": "https://api.github.com/users/Dylan-DPC/following{/other_user}", "gists_url": "https://api.github.com/users/Dylan-DPC/gists{/gist_id}", "starred_url": "https://api.github.com/users/Dylan-DPC/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Dylan-DPC/subscriptions", "organizations_url": "https://api.github.com/users/Dylan-DPC/orgs", "repos_url": "https://api.github.com/users/Dylan-DPC/repos", "events_url": "https://api.github.com/users/Dylan-DPC/events{/privacy}", "received_events_url": "https://api.github.com/users/Dylan-DPC/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "48316dfea1914d25189fa441e7310449ed76a446", "url": "https://api.github.com/repos/rust-lang/rust/commits/48316dfea1914d25189fa441e7310449ed76a446", "html_url": "https://github.com/rust-lang/rust/commit/48316dfea1914d25189fa441e7310449ed76a446"}, {"sha": "8716eae3b16cda362186765ad739ca56331728cf", "url": "https://api.github.com/repos/rust-lang/rust/commits/8716eae3b16cda362186765ad739ca56331728cf", "html_url": "https://github.com/rust-lang/rust/commit/8716eae3b16cda362186765ad739ca56331728cf"}], "stats": {"total": 40, "additions": 32, "deletions": 8}, "files": [{"sha": "49c9ba459632d2138b74c45619e0e82d0479154b", "filename": "compiler/rustc_traits/src/evaluate_obligation.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/91b8b9ba4be1de6f6b974f2994a2b722e5794762/compiler%2Frustc_traits%2Fsrc%2Fevaluate_obligation.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91b8b9ba4be1de6f6b974f2994a2b722e5794762/compiler%2Frustc_traits%2Fsrc%2Fevaluate_obligation.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_traits%2Fsrc%2Fevaluate_obligation.rs?ref=91b8b9ba4be1de6f6b974f2994a2b722e5794762", "patch": "@@ -1,4 +1,4 @@\n-use rustc_infer::infer::TyCtxtInferExt;\n+use rustc_infer::infer::{DefiningAnchor, TyCtxtInferExt};\n use rustc_middle::ty::query::Providers;\n use rustc_middle::ty::{ParamEnvAnd, TyCtxt};\n use rustc_span::source_map::DUMMY_SP;\n@@ -16,7 +16,9 @@ fn evaluate_obligation<'tcx>(\n     canonical_goal: CanonicalPredicateGoal<'tcx>,\n ) -> Result<EvaluationResult, OverflowError> {\n     debug!(\"evaluate_obligation(canonical_goal={:#?})\", canonical_goal);\n-    tcx.infer_ctxt().enter_with_canonical(\n+    // HACK This bubble is required for this tests to pass:\n+    // impl-trait/issue99642.rs\n+    tcx.infer_ctxt().with_opaque_type_inference(DefiningAnchor::Bubble).enter_with_canonical(\n         DUMMY_SP,\n         &canonical_goal,\n         |ref infcx, goal, _canonical_inference_vars| {"}, {"sha": "d895b647db0b144a8462330a83fdd4325c99e887", "filename": "compiler/rustc_traits/src/type_op.rs", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/91b8b9ba4be1de6f6b974f2994a2b722e5794762/compiler%2Frustc_traits%2Fsrc%2Ftype_op.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91b8b9ba4be1de6f6b974f2994a2b722e5794762/compiler%2Frustc_traits%2Fsrc%2Ftype_op.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_traits%2Fsrc%2Ftype_op.rs?ref=91b8b9ba4be1de6f6b974f2994a2b722e5794762", "patch": "@@ -2,7 +2,7 @@ use rustc_hir as hir;\n use rustc_hir::def_id::DefId;\n use rustc_infer::infer::at::ToTrace;\n use rustc_infer::infer::canonical::{Canonical, QueryResponse};\n-use rustc_infer::infer::{InferCtxt, TyCtxtInferExt};\n+use rustc_infer::infer::{DefiningAnchor, InferCtxt, TyCtxtInferExt};\n use rustc_infer::traits::TraitEngineExt as _;\n use rustc_middle::ty::query::Providers;\n use rustc_middle::ty::subst::{GenericArg, Subst, UserSelfTy, UserSubsts};\n@@ -258,10 +258,15 @@ fn type_op_prove_predicate<'tcx>(\n     tcx: TyCtxt<'tcx>,\n     canonicalized: Canonical<'tcx, ParamEnvAnd<'tcx, ProvePredicate<'tcx>>>,\n ) -> Result<&'tcx Canonical<'tcx, QueryResponse<'tcx, ()>>, NoSolution> {\n-    tcx.infer_ctxt().enter_canonical_trait_query(&canonicalized, |infcx, fulfill_cx, key| {\n-        type_op_prove_predicate_with_cause(infcx, fulfill_cx, key, ObligationCause::dummy());\n-        Ok(())\n-    })\n+    // HACK This bubble is required for this test to pass:\n+    // impl-trait/issue-99642.rs\n+    tcx.infer_ctxt().with_opaque_type_inference(DefiningAnchor::Bubble).enter_canonical_trait_query(\n+        &canonicalized,\n+        |infcx, fulfill_cx, key| {\n+            type_op_prove_predicate_with_cause(infcx, fulfill_cx, key, ObligationCause::dummy());\n+            Ok(())\n+        },\n+    )\n }\n \n /// The core of the `type_op_prove_predicate` query: for diagnostics purposes in NLL HRTB errors,"}, {"sha": "0e88b363338a951f2a1a88fafaf2fd36036ad966", "filename": "src/test/ui/impl-trait/issue-99642-2.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/91b8b9ba4be1de6f6b974f2994a2b722e5794762/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-99642-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91b8b9ba4be1de6f6b974f2994a2b722e5794762/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-99642-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-99642-2.rs?ref=91b8b9ba4be1de6f6b974f2994a2b722e5794762", "patch": "@@ -0,0 +1,8 @@\n+// check-pass\n+\n+#![feature(type_alias_impl_trait)]\n+type Opq = impl Sized;\n+fn test() -> impl Iterator<Item = Opq> {\n+    Box::new(0..) as Box<dyn Iterator<Item = _>>\n+}\n+fn main(){}"}, {"sha": "75af60491e43836a233fef461d2cbd1ce7c10107", "filename": "src/test/ui/impl-trait/issue-99642.rs", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/91b8b9ba4be1de6f6b974f2994a2b722e5794762/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-99642.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91b8b9ba4be1de6f6b974f2994a2b722e5794762/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-99642.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fimpl-trait%2Fissue-99642.rs?ref=91b8b9ba4be1de6f6b974f2994a2b722e5794762", "patch": "@@ -0,0 +1,7 @@\n+// check-pass\n+\n+fn test() -> impl Iterator<Item = impl Sized> {\n+    Box::new(0..) as Box<dyn Iterator<Item = _>>\n+}\n+\n+fn main() {}"}, {"sha": "d20b1cc6d851bb135b3dd00fd87cc535e20c9141", "filename": "src/test/ui/type-alias-impl-trait/issue-53398-cyclic-types.stderr", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/91b8b9ba4be1de6f6b974f2994a2b722e5794762/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fissue-53398-cyclic-types.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/91b8b9ba4be1de6f6b974f2994a2b722e5794762/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fissue-53398-cyclic-types.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Ftype-alias-impl-trait%2Fissue-53398-cyclic-types.stderr?ref=91b8b9ba4be1de6f6b974f2994a2b722e5794762", "patch": "@@ -1,8 +1,10 @@\n-error[E0275]: overflow evaluating the requirement `<fn() -> Foo {foo} as FnOnce<()>>::Output == fn() -> Foo {foo}`\n+error[E0275]: overflow evaluating the requirement `fn() -> Foo {foo}: Sized`\n   --> $DIR/issue-53398-cyclic-types.rs:5:13\n    |\n LL | fn foo() -> Foo {\n    |             ^^^\n+   |\n+   = help: consider increasing the recursion limit by adding a `#![recursion_limit = \"256\"]` attribute to your crate (`issue_53398_cyclic_types`)\n \n error: aborting due to previous error\n "}]}