{"sha": "d652917f5f925ce20ca72fc12997449fe455e2af", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ2NTI5MTdmNWY5MjVjZTIwY2E3MmZjMTI5OTc0NDlmZTQ1NWUyYWY=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-12-15T19:11:33Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2018-12-15T19:11:33Z"}, "message": "Auto merge of #56847 - pietroalbini:fix-broken-toolstate, r=pietroalbini\n\nRevert merge of #56758 - Manishearth:emoji-status-toolstate\n\n#56758 is breaking master.\n\nr? @ghost\ncc @Manishearth @kennytm", "tree": {"sha": "d740cb11e92b888d3f89da3c42d31962c68fe20d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d740cb11e92b888d3f89da3c42d31962c68fe20d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d652917f5f925ce20ca72fc12997449fe455e2af", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d652917f5f925ce20ca72fc12997449fe455e2af", "html_url": "https://github.com/rust-lang/rust/commit/d652917f5f925ce20ca72fc12997449fe455e2af", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d652917f5f925ce20ca72fc12997449fe455e2af/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "44d3fb3ab2024f0f35568cadced296ba11220e9e", "url": "https://api.github.com/repos/rust-lang/rust/commits/44d3fb3ab2024f0f35568cadced296ba11220e9e", "html_url": "https://github.com/rust-lang/rust/commit/44d3fb3ab2024f0f35568cadced296ba11220e9e"}, {"sha": "e771a7d3533664b5b0c6e8430d1d8e41cdfb8d68", "url": "https://api.github.com/repos/rust-lang/rust/commits/e771a7d3533664b5b0c6e8430d1d8e41cdfb8d68", "html_url": "https://github.com/rust-lang/rust/commit/e771a7d3533664b5b0c6e8430d1d8e41cdfb8d68"}], "stats": {"total": 32, "additions": 7, "deletions": 25}, "files": [{"sha": "4ade87f5d65bd2c167175bcf27ca178a28df1b50", "filename": "src/tools/publish_toolstate.py", "status": "modified", "additions": 7, "deletions": 25, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/d652917f5f925ce20ca72fc12997449fe455e2af/src%2Ftools%2Fpublish_toolstate.py", "raw_url": "https://github.com/rust-lang/rust/raw/d652917f5f925ce20ca72fc12997449fe455e2af/src%2Ftools%2Fpublish_toolstate.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fpublish_toolstate.py?ref=d652917f5f925ce20ca72fc12997449fe455e2af", "patch": "@@ -34,16 +34,6 @@\n     'rust-by-example': '@steveklabnik @marioidival @projektir',\n }\n \n-EMOJI = {\n-    'miri': '\ud83d\udef0\ufe0f',\n-    'clippy-driver': '\ud83d\udcce',\n-    'rls': '\ud83d\udcbb',\n-    'rustfmt': '\ud83d\udcdd',\n-    'book': '\ud83d\udcd6',\n-    'nomicon': '\ud83d\udc7f',\n-    'reference': '\ud83d\udcda',\n-    'rust-by-example': '\ud83d\udc69\u200d\ud83c\udfeb',\n-}\n \n def read_current_status(current_commit, path):\n     '''Reads build status of `current_commit` from content of `history/*.tsv`\n@@ -73,12 +63,13 @@ def update_latest(\n         }\n \n         slug = 'rust-lang/rust'\n-        long_message = textwrap.dedent('''\\\n+        message = textwrap.dedent('''\\\n+            \ud83d\udce3 Toolstate changed by {}!\n+\n             Tested on commit {}@{}.\n             Direct link to PR: <{}>\n \n-        ''').format(slug, current_commit, relevant_pr_url)\n-        emoji_status = []\n+        ''').format(relevant_pr_number, slug, current_commit, relevant_pr_url)\n         anything_changed = False\n         for status in latest:\n             tool = status['tool']\n@@ -90,18 +81,12 @@ def update_latest(\n                 status[os] = new\n                 if new > old:\n                     changed = True\n-                    long_message += '\ud83c\udf89 {} on {}: {} \u2192 {}.\\n' \\\n-                        .format(tool, os, old, new)\n-                    emoji = \"{}\ud83c\udf89\".format(EMOJI.get(tool))\n-                    if msg not in emoji_status:\n-                        emoji_status += [msg]\n+                    message += '\ud83c\udf89 {} on {}: {} \u2192 {} (cc {}, @rust-lang/infra).\\n' \\\n+                        .format(tool, os, old, new, MAINTAINERS.get(tool))\n                 elif new < old:\n                     changed = True\n-                    long_message += '\ud83d\udc94 {} on {}: {} \u2192 {} (cc {}, @rust-lang/infra).\\n' \\\n+                    message += '\ud83d\udc94 {} on {}: {} \u2192 {} (cc {}, @rust-lang/infra).\\n' \\\n                         .format(tool, os, old, new, MAINTAINERS.get(tool))\n-                    emoji = \"{}\ud83d\udc94\".format(EMOJI.get(tool))\n-                    if msg not in emoji_status:\n-                        emoji_status += [msg]\n \n             if changed:\n                 status['commit'] = current_commit\n@@ -111,9 +96,6 @@ def update_latest(\n         if not anything_changed:\n             return ''\n \n-        short_message = \"\ud83d\udce3 Toolstate changed by {}! ({})\"\n-            .format(relevant_pr_number, '/'.join(emoji_status))\n-        message = short_message + \"\\n\\n\" + long_message\n         f.seek(0)\n         f.truncate(0)\n         json.dump(latest, f, indent=4, separators=(',', ': '))"}]}