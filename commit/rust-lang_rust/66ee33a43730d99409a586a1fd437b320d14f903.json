{"sha": "66ee33a43730d99409a586a1fd437b320d14f903", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY2ZWUzM2E0MzczMGQ5OTQwOWE1ODZhMWZkNDM3YjMyMGQxNGY5MDM=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-02-11T19:04:43Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-02-11T19:13:25Z"}, "message": "compiletest: Delete the executable immediately after running.\n\nThis should save a lot of space on musl test cases (whose standard library\nare linked statically).", "tree": {"sha": "a206b37e90a0e744a79f36a3dcde89de04bbdce8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a206b37e90a0e744a79f36a3dcde89de04bbdce8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/66ee33a43730d99409a586a1fd437b320d14f903", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlqAldUACgkQ/vbIBR0O\nATw62RAAtBRpBrB1rQoKOHHODMQXQh8J0q/YieU/MSgzjmanLgbb6HymsPw3q8vT\nyl9PSCg84rrrj4VcjoImDSdOTkOgAqjbKyO7bze2fEY4WmY0rdQ8L/ao0qkbp7EV\nH5PPdt2+EeITbKdS0pgjE7F8I0SXUQDp+Q4ZjvMOCIg+qRPLEJjY9NnD8D+1IO/F\n/CI3G+gNjSpgBqGUKr+gFwLDSZRS9Wr6e23qGqjotroPYk2jv4pv+vHsbNOjR2yh\n1YsKHgVteNmnKIJS+c4hUk8M3sTA3Jib0cuwTqGHQHZXa830q4l9guD6gcTgQ7Yj\nRyjcQu8wTD6vmoNgiTbvn3R+IBjJrm0q7W2R2xhQztPOW+XMyCb5hc2q7Vr+BGOo\nno6Yhy5ETwfnKO5qU7c1YQmJl0OE7vQZsLp9uaPbIzO9c0ptxQ5u/DomAaxS8O8y\niFh+2M/79cGMIDwqRMPV3SIDxZoyP4m1vt8kYIHTCcXOWMz9tPY7WEKxEBkfq1OB\nezr+mqbKTptuoUU5TqNyaxxtWUfp2nRb0EXt3Kbg532mGGBr6fk3Yi08Oxwwn+RF\nUmgwKEv6+//bwgT0wD+SM5WMkG5my66cRaE4zmF9RKcAyeRevWXnNlTR66QhTlJk\nlGEzpRmgHfmvof0vL16jVGa+eRi9wAJZYMQbSKnb0MnSGhDcoeg=\n=IGvJ\n-----END PGP SIGNATURE-----", "payload": "tree a206b37e90a0e744a79f36a3dcde89de04bbdce8\nparent 0bb8935136098dde90d6dcbf24237fd7e2fe569f\nauthor kennytm <kennytm@gmail.com> 1518375883 +0800\ncommitter kennytm <kennytm@gmail.com> 1518376405 +0800\n\ncompiletest: Delete the executable immediately after running.\n\nThis should save a lot of space on musl test cases (whose standard library\nare linked statically).\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/66ee33a43730d99409a586a1fd437b320d14f903", "html_url": "https://github.com/rust-lang/rust/commit/66ee33a43730d99409a586a1fd437b320d14f903", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/66ee33a43730d99409a586a1fd437b320d14f903/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0bb8935136098dde90d6dcbf24237fd7e2fe569f", "url": "https://api.github.com/repos/rust-lang/rust/commits/0bb8935136098dde90d6dcbf24237fd7e2fe569f", "html_url": "https://github.com/rust-lang/rust/commit/0bb8935136098dde90d6dcbf24237fd7e2fe569f"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "940721f1cc1f0ae5f42d6233e32d1d748ab6a7ea", "filename": "src/tools/compiletest/src/runtest.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/66ee33a43730d99409a586a1fd437b320d14f903/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/66ee33a43730d99409a586a1fd437b320d14f903/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fruntest.rs?ref=66ee33a43730d99409a586a1fd437b320d14f903", "patch": "@@ -1343,7 +1343,7 @@ impl<'test> TestCx<'test> {\n     fn exec_compiled_test(&self) -> ProcRes {\n         let env = &self.props.exec_env;\n \n-        match &*self.config.target {\n+        let proc_res = match &*self.config.target {\n             // This is pretty similar to below, we're transforming:\n             //\n             //      program arg1 arg2\n@@ -1398,7 +1398,13 @@ impl<'test> TestCx<'test> {\n                     None,\n                 )\n             }\n-        }\n+        };\n+\n+        // delete the executable after running it to save space.\n+        // it is ok if the deletion failed.\n+        let _ = fs::remove_file(self.make_exe_name());\n+\n+        proc_res\n     }\n \n     /// For each `aux-build: foo/bar` annotation, we check to find the"}]}