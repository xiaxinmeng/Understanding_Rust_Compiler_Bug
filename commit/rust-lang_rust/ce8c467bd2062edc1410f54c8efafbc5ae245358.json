{"sha": "ce8c467bd2062edc1410f54c8efafbc5ae245358", "node_id": "MDY6Q29tbWl0NzI0NzEyOmNlOGM0NjdiZDIwNjJlZGMxNDEwZjU0YzhlZmFmYmM1YWUyNDUzNTg=", "commit": {"author": {"name": "klutzy", "email": "klutzytheklutzy@gmail.com", "date": "2014-04-16T05:29:02Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-05-14T00:24:08Z"}, "message": "compiletest: Test `--pretty expanded`\n\nAfter testing `--pretty normal`, it tries to run `--pretty expanded` and\ntypecheck output.\nHere we don't check convergence since it really diverges: for every\niteration, some extra lines (e.g.`extern crate std`) are inserted.\n\nSome tests are `ignore-pretty`-ed since they cause various issues\nwith `--pretty expanded`.", "tree": {"sha": "83779aab5e765490af2d6fc9768a2de5f4e0bffd", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/83779aab5e765490af2d6fc9768a2de5f4e0bffd"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ce8c467bd2062edc1410f54c8efafbc5ae245358", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ce8c467bd2062edc1410f54c8efafbc5ae245358", "html_url": "https://github.com/rust-lang/rust/commit/ce8c467bd2062edc1410f54c8efafbc5ae245358", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ce8c467bd2062edc1410f54c8efafbc5ae245358/comments", "author": {"login": "klutzy", "id": 1589355, "node_id": "MDQ6VXNlcjE1ODkzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1589355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/klutzy", "html_url": "https://github.com/klutzy", "followers_url": "https://api.github.com/users/klutzy/followers", "following_url": "https://api.github.com/users/klutzy/following{/other_user}", "gists_url": "https://api.github.com/users/klutzy/gists{/gist_id}", "starred_url": "https://api.github.com/users/klutzy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/klutzy/subscriptions", "organizations_url": "https://api.github.com/users/klutzy/orgs", "repos_url": "https://api.github.com/users/klutzy/repos", "events_url": "https://api.github.com/users/klutzy/events{/privacy}", "received_events_url": "https://api.github.com/users/klutzy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "96eeda9708605a60635229d45587f79f9a334ded", "url": "https://api.github.com/repos/rust-lang/rust/commits/96eeda9708605a60635229d45587f79f9a334ded", "html_url": "https://github.com/rust-lang/rust/commit/96eeda9708605a60635229d45587f79f9a334ded"}], "stats": {"total": 37, "additions": 31, "deletions": 6}, "files": [{"sha": "bd909c8f0693f4e80cbec70ac88761c390b3fdca", "filename": "src/compiletest/runtest.rs", "status": "modified", "additions": 20, "deletions": 5, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Fcompiletest%2Fruntest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Fcompiletest%2Fruntest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcompiletest%2Fruntest.rs?ref=ce8c467bd2062edc1410f54c8efafbc5ae245358", "patch": "@@ -157,9 +157,7 @@ fn run_pretty_test(config: &Config, props: &TestProps, testfile: &Path) {\n     let mut round = 0;\n     while round < rounds {\n         logv(config, format!(\"pretty-printing round {}\", round));\n-        let proc_res = print_source(config,\n-                                    testfile,\n-                                    (*srcs.get(round)).clone());\n+        let proc_res = print_source(config, props, testfile, (*srcs.get(round)).clone(), \"normal\");\n \n         if !proc_res.status.success() {\n             fatal_ProcRes(format!(\"pretty-printing failed in round {}\", round),\n@@ -197,10 +195,27 @@ fn run_pretty_test(config: &Config, props: &TestProps, testfile: &Path) {\n         fatal_ProcRes(\"pretty-printed source does not typecheck\".to_owned(), &proc_res);\n     }\n \n+    // additionally, run `--pretty expanded` and try to build it.\n+    let proc_res = print_source(config, props, testfile, (*srcs.get(round)).clone(), \"expanded\");\n+    if !proc_res.status.success() {\n+        fatal_ProcRes(format!(\"pretty-printing (expanded) failed\"), &proc_res);\n+    }\n+\n+    let ProcRes{ stdout: expanded_src, .. } = proc_res;\n+    let proc_res = typecheck_source(config, props, testfile, expanded_src);\n+    if !proc_res.status.success() {\n+        fatal_ProcRes(format!(\"pretty-printed source (expanded) does not typecheck\"), &proc_res);\n+    }\n+\n     return;\n \n-    fn print_source(config: &Config, testfile: &Path, src: ~str) -> ProcRes {\n-        compose_and_run(config, testfile, make_pp_args(config, testfile),\n+    fn print_source(config: &Config,\n+                    props: &TestProps,\n+                    testfile: &Path,\n+                    src: ~str,\n+                    pretty_type: &str) -> ProcRes {\n+        compose_and_run(config, testfile,\n+                        make_pp_args(config, props, testfile, pretty_type.to_owned()),\n                         Vec::new(), config.compile_lib_path, Some(src))\n     }\n "}, {"sha": "70ef4a0c0c3d307e9895ccbe78cc4560f8977ce6", "filename": "src/test/run-fail/run-unexported-tests.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-fail%2Frun-unexported-tests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-fail%2Frun-unexported-tests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-fail%2Frun-unexported-tests.rs?ref=ce8c467bd2062edc1410f54c8efafbc5ae245358", "patch": "@@ -11,6 +11,7 @@\n // error-pattern:runned an unexported test\n // compile-flags:--test\n // check-stdout\n+// ignore-pretty: does not work well with `--test`\n \n mod m {\n     pub fn exported() { }"}, {"sha": "b628f101fd5766b67e7315d0d5d8291ff5ee2aef", "filename": "src/test/run-fail/test-fail.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-fail%2Ftest-fail.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-fail%2Ftest-fail.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-fail%2Ftest-fail.rs?ref=ce8c467bd2062edc1410f54c8efafbc5ae245358", "patch": "@@ -11,6 +11,7 @@\n // check-stdout\n // error-pattern:task 'test_foo' failed at\n // compile-flags: --test\n+// ignore-pretty: does not work well with `--test`\n \n #[test]\n fn test_foo() {"}, {"sha": "8c9cd2d63cb4758f4c29f40e3e2435294872a126", "filename": "src/test/run-fail/test-tasks-invalid-value.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-fail%2Ftest-tasks-invalid-value.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-fail%2Ftest-tasks-invalid-value.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-fail%2Ftest-tasks-invalid-value.rs?ref=ce8c467bd2062edc1410f54c8efafbc5ae245358", "patch": "@@ -14,6 +14,7 @@\n // error-pattern:should be a positive integer\n // compile-flags: --test\n // exec-env:RUST_TEST_TASKS=foo\n+// ignore-pretty: does not work well with `--test`\n \n #[test]\n fn do_nothing() {}"}, {"sha": "2d5bbd43e826f23b38212dc5f4e7bf00333546f5", "filename": "src/test/run-pass-fulldeps/quote-unused-sp-no-warning.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-pass-fulldeps%2Fquote-unused-sp-no-warning.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-pass-fulldeps%2Fquote-unused-sp-no-warning.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass-fulldeps%2Fquote-unused-sp-no-warning.rs?ref=ce8c467bd2062edc1410f54c8efafbc5ae245358", "patch": "@@ -9,6 +9,8 @@\n // except according to those terms.\n \n // ignore-android\n+// ignore-pretty: does not work well with `--test`\n+\n #![feature(quote)]\n #![deny(unused_variable)]\n "}, {"sha": "ee90cfd3475b1a87adb269be2f0f71a80173e20f", "filename": "src/test/run-pass/hygienic-labels-in-let.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-pass%2Fhygienic-labels-in-let.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-pass%2Fhygienic-labels-in-let.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fhygienic-labels-in-let.rs?ref=ce8c467bd2062edc1410f54c8efafbc5ae245358", "patch": "@@ -8,6 +8,8 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+// ignore-pretty: pprust doesn't print hygiene output\n+\n #![feature(macro_rules)]\n \n macro_rules! loop_x {"}, {"sha": "4d445db302b0bffb2191520020bdd71616ec1f2f", "filename": "src/test/run-pass/ifmt.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-pass%2Fifmt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-pass%2Fifmt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fifmt.rs?ref=ce8c467bd2062edc1410f54c8efafbc5ae245358", "patch": "@@ -8,6 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n+// ignore-pretty: `--pretty expand` creates unnecessary `unsafe` block\n \n #![feature(macro_rules, managed_boxes)]\n #![deny(warnings)]"}, {"sha": "2f78513b95cf9c7f132ca72c4d5ecb226d190b7a", "filename": "src/test/run-pass/shebang.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-pass%2Fshebang.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-pass%2Fshebang.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fshebang.rs?ref=ce8c467bd2062edc1410f54c8efafbc5ae245358", "patch": "@@ -9,6 +9,6 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-// pp-exact\n+// ignore-pretty: `expand` addes some preludes before shebang\n \n pub fn main() { println!(\"Hello World\"); }"}, {"sha": "309325ab7db4a1fca09d2efbc931833e2f8a8124", "filename": "src/test/run-pass/test-ignore-cfg.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-pass%2Ftest-ignore-cfg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-pass%2Ftest-ignore-cfg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Ftest-ignore-cfg.rs?ref=ce8c467bd2062edc1410f54c8efafbc5ae245358", "patch": "@@ -9,6 +9,7 @@\n // except according to those terms.\n \n // compile-flags: --test --cfg ignorecfg\n+// ignore-pretty: does not work well with `--test`\n \n #[test]\n #[ignore(cfg(ignorecfg))]"}, {"sha": "05d5506f0a6b0df599d135befd9596f544789979", "filename": "src/test/run-pass/test-runner-hides-main.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-pass%2Ftest-runner-hides-main.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ce8c467bd2062edc1410f54c8efafbc5ae245358/src%2Ftest%2Frun-pass%2Ftest-runner-hides-main.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Ftest-runner-hides-main.rs?ref=ce8c467bd2062edc1410f54c8efafbc5ae245358", "patch": "@@ -10,6 +10,7 @@\n \n // compile-flags:--test\n // ignore-win32 #10872\n+// ignore-pretty: does not work well with `--test`\n \n // Building as a test runner means that a synthetic main will be run,\n // not ours"}]}