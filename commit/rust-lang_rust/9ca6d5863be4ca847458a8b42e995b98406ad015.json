{"sha": "9ca6d5863be4ca847458a8b42e995b98406ad015", "node_id": "MDY6Q29tbWl0NzI0NzEyOjljYTZkNTg2M2JlNGNhODQ3NDU4YThiNDJlOTk1Yjk4NDA2YWQwMTU=", "commit": {"author": {"name": "Justus K", "email": "justus.k@protonmail.com", "date": "2021-05-02T17:39:33Z"}, "committer": {"name": "Justus K", "email": "justus.k@protonmail.com", "date": "2021-05-02T19:16:50Z"}, "message": "Do not print visibility in external traits", "tree": {"sha": "7aa341a7cfa2287ccfc3bc6c2771c7c043a7df04", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7aa341a7cfa2287ccfc3bc6c2771c7c043a7df04"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9ca6d5863be4ca847458a8b42e995b98406ad015", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEDDGYqKFKtc1ioGY0jGL+mKYvxGIFAmCO+qoACgkQjGL+mKYv\nxGK05A/9GPe+4TqDhyMcmrlgGIr+XmxbqyWkYb4+VULLgO5UZdcRl6CwHMDToaFH\n+VMT5L5waxCxF1fhkn5Xu9aDa7STN6ZvcArOoLmCOxyMNQZ/uQY2Cl6qKonmlWlt\nvBMvf91q4FSenwLogVaemmQUWFEZ+KsPsLPEIVOPijd/rvrceI1cIyolWACkQwKJ\nH49ZB68JgU8Ys4G78Zy6WRyR3wJKVPejwLYbQ89h4v9h+ymuWjiaL7oxhgZnXn+d\nVNGdkLGTC/SRjQsBsEVEB6tM/7fmnkfAnIpBuwabM20hRIfgcHih3ow4xPjZUpaG\n5inifJP0qZbUPfr5gID62B6OPM/YNKTM0ZcOKd/JjTrLozGNNXuJcarMBAkPVXpA\nmiv4WNtqwTkyICiMtSe8jFV3cEpKYEezkz0rYQZbL7ay60i6JgdUmm8B4zmw2het\nKkZcOZBa9qK/sdgdReo91rYSPB5JzRUcjq7E7W2mVinUCap77fxEbTGgih2//Er4\no7OkolioA2MnSw/z4hNNG/WDwfBJX64QWninIwRBYm2PhaDAwm5iCOFZEnHnULNd\nUID1HjI3IAP/cvY9PYd5CTcl3ctfeXnZaTxLjXztT5xHO0niboMKrOX+wORZ/7QZ\nfcDXa9jOtLotVhIW+TzwTyavRLer/5Fg7ty6V7JwURKeI3gM0E4=\n=yU3a\n-----END PGP SIGNATURE-----", "payload": "tree 7aa341a7cfa2287ccfc3bc6c2771c7c043a7df04\nparent 89ebad52a8b5a6d89d66a158d377cd7505ec4b48\nauthor Justus K <justus.k@protonmail.com> 1619977173 +0200\ncommitter Justus K <justus.k@protonmail.com> 1619983010 +0200\n\nDo not print visibility in external traits\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9ca6d5863be4ca847458a8b42e995b98406ad015", "html_url": "https://github.com/rust-lang/rust/commit/9ca6d5863be4ca847458a8b42e995b98406ad015", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9ca6d5863be4ca847458a8b42e995b98406ad015/comments", "author": {"login": "Stupremee", "id": 39732259, "node_id": "MDQ6VXNlcjM5NzMyMjU5", "avatar_url": "https://avatars.githubusercontent.com/u/39732259?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Stupremee", "html_url": "https://github.com/Stupremee", "followers_url": "https://api.github.com/users/Stupremee/followers", "following_url": "https://api.github.com/users/Stupremee/following{/other_user}", "gists_url": "https://api.github.com/users/Stupremee/gists{/gist_id}", "starred_url": "https://api.github.com/users/Stupremee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Stupremee/subscriptions", "organizations_url": "https://api.github.com/users/Stupremee/orgs", "repos_url": "https://api.github.com/users/Stupremee/repos", "events_url": "https://api.github.com/users/Stupremee/events{/privacy}", "received_events_url": "https://api.github.com/users/Stupremee/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Stupremee", "id": 39732259, "node_id": "MDQ6VXNlcjM5NzMyMjU5", "avatar_url": "https://avatars.githubusercontent.com/u/39732259?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Stupremee", "html_url": "https://github.com/Stupremee", "followers_url": "https://api.github.com/users/Stupremee/followers", "following_url": "https://api.github.com/users/Stupremee/following{/other_user}", "gists_url": "https://api.github.com/users/Stupremee/gists{/gist_id}", "starred_url": "https://api.github.com/users/Stupremee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Stupremee/subscriptions", "organizations_url": "https://api.github.com/users/Stupremee/orgs", "repos_url": "https://api.github.com/users/Stupremee/repos", "events_url": "https://api.github.com/users/Stupremee/events{/privacy}", "received_events_url": "https://api.github.com/users/Stupremee/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "89ebad52a8b5a6d89d66a158d377cd7505ec4b48", "url": "https://api.github.com/repos/rust-lang/rust/commits/89ebad52a8b5a6d89d66a158d377cd7505ec4b48", "html_url": "https://github.com/rust-lang/rust/commit/89ebad52a8b5a6d89d66a158d377cd7505ec4b48"}], "stats": {"total": 27, "additions": 24, "deletions": 3}, "files": [{"sha": "0ff7e8c4d83198ebdc9cf2b1bd89022af8f86ee8", "filename": "src/librustdoc/clean/inline.rs", "status": "modified", "additions": 13, "deletions": 3, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/9ca6d5863be4ca847458a8b42e995b98406ad015/src%2Flibrustdoc%2Fclean%2Finline.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ca6d5863be4ca847458a8b42e995b98406ad015/src%2Flibrustdoc%2Fclean%2Finline.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean%2Finline.rs?ref=9ca6d5863be4ca847458a8b42e995b98406ad015", "patch": "@@ -19,7 +19,7 @@ use crate::clean::{self, Attributes, AttributesExt, GetDefId, ToSource};\n use crate::core::DocContext;\n use crate::formats::item_type::ItemType;\n \n-use super::Clean;\n+use super::{Clean, Visibility};\n \n type Attrs<'hir> = rustc_middle::ty::Attributes<'hir>;\n \n@@ -193,8 +193,18 @@ crate fn record_extern_fqn(cx: &mut DocContext<'_>, did: DefId, kind: ItemType)\n }\n \n crate fn build_external_trait(cx: &mut DocContext<'_>, did: DefId) -> clean::Trait {\n-    let trait_items =\n-        cx.tcx.associated_items(did).in_definition_order().map(|item| item.clean(cx)).collect();\n+    let trait_items = cx\n+        .tcx\n+        .associated_items(did)\n+        .in_definition_order()\n+        .map(|item| {\n+            // When building an external trait, the cleaned trait will have all items public,\n+            // which causes methods to have a `pub` prefix, which is invalid since items in traits\n+            // can not have a visibility prefix. Thus we override the visibility here manually.\n+            // See https://github.com/rust-lang/rust/issues/81274\n+            clean::Item { visibility: Visibility::Inherited, ..item.clean(cx) }\n+        })\n+        .collect();\n \n     let predicates = cx.tcx.predicates_of(did);\n     let generics = (cx.tcx.generics_of(did), predicates).clean(cx);"}, {"sha": "1e8d0b8e02a93d8c0e7966fe31ba782aea3dd443", "filename": "src/test/rustdoc/auxiliary/trait-visibility.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/9ca6d5863be4ca847458a8b42e995b98406ad015/src%2Ftest%2Frustdoc%2Fauxiliary%2Ftrait-visibility.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ca6d5863be4ca847458a8b42e995b98406ad015/src%2Ftest%2Frustdoc%2Fauxiliary%2Ftrait-visibility.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fauxiliary%2Ftrait-visibility.rs?ref=9ca6d5863be4ca847458a8b42e995b98406ad015", "patch": "@@ -0,0 +1,3 @@\n+pub trait Bar {\n+    fn foo();\n+}"}, {"sha": "8ba3ee03a74f3dba69aabb51a9ab7f95ef2c8fef", "filename": "src/test/rustdoc/trait-visibility.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9ca6d5863be4ca847458a8b42e995b98406ad015/src%2Ftest%2Frustdoc%2Ftrait-visibility.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ca6d5863be4ca847458a8b42e995b98406ad015/src%2Ftest%2Frustdoc%2Ftrait-visibility.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Ftrait-visibility.rs?ref=9ca6d5863be4ca847458a8b42e995b98406ad015", "patch": "@@ -0,0 +1,8 @@\n+// aux-build:trait-visibility.rs\n+\n+#![crate_name = \"foo\"]\n+\n+extern crate trait_visibility;\n+\n+// @has foo/trait.Bar.html '//a[@href=\"#tymethod.foo\"]/..' \"fn foo()\"\n+pub use trait_visibility::Bar;"}]}