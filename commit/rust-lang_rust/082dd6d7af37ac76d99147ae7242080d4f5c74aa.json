{"sha": "082dd6d7af37ac76d99147ae7242080d4f5c74aa", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA4MmRkNmQ3YWYzN2FjNzZkOTkxNDdhZTcyNDIwODBkNGY1Yzc0YWE=", "commit": {"author": {"name": "Stjepan Glavina", "email": "stjepang@gmail.com", "date": "2018-02-28T19:50:26Z"}, "committer": {"name": "Stjepan Glavina", "email": "stjepang@gmail.com", "date": "2018-02-28T19:52:38Z"}, "message": "Fix a few run-pass tests", "tree": {"sha": "cb74380564fcafa53bd805f75ed15bcaf97d7df9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cb74380564fcafa53bd805f75ed15bcaf97d7df9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/082dd6d7af37ac76d99147ae7242080d4f5c74aa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/082dd6d7af37ac76d99147ae7242080d4f5c74aa", "html_url": "https://github.com/rust-lang/rust/commit/082dd6d7af37ac76d99147ae7242080d4f5c74aa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/082dd6d7af37ac76d99147ae7242080d4f5c74aa/comments", "author": null, "committer": null, "parents": [{"sha": "27fae2b24af48041ceea6e04c7f217d3db372164", "url": "https://api.github.com/repos/rust-lang/rust/commits/27fae2b24af48041ceea6e04c7f217d3db372164", "html_url": "https://github.com/rust-lang/rust/commit/27fae2b24af48041ceea6e04c7f217d3db372164"}], "stats": {"total": 13, "additions": 5, "deletions": 8}, "files": [{"sha": "48a0d4a99ecc9e97a5e15d8bd6f55e6b2751ddb3", "filename": "src/test/run-pass/tls-init-on-init.rs", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/082dd6d7af37ac76d99147ae7242080d4f5c74aa/src%2Ftest%2Frun-pass%2Ftls-init-on-init.rs", "raw_url": "https://github.com/rust-lang/rust/raw/082dd6d7af37ac76d99147ae7242080d4f5c74aa/src%2Ftest%2Frun-pass%2Ftls-init-on-init.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Ftls-init-on-init.rs?ref=082dd6d7af37ac76d99147ae7242080d4f5c74aa", "patch": "@@ -10,10 +10,9 @@\n \n // ignore-emscripten no threads support\n \n-#![feature(thread_local_state)]\n-#![allow(deprecated)]\n+#![feature(thread_local_try_with)]\n \n-use std::thread::{self, LocalKeyState};\n+use std::thread;\n use std::sync::atomic::{AtomicUsize, Ordering, ATOMIC_USIZE_INIT};\n \n struct Foo { cnt: usize }\n@@ -38,10 +37,8 @@ impl Drop for Foo {\n             FOO.with(|foo| assert_eq!(foo.cnt, 0));\n         } else {\n             assert_eq!(self.cnt, 0);\n-            match FOO.state() {\n-                LocalKeyState::Valid => panic!(\"should not be in valid state\"),\n-                LocalKeyState::Uninitialized |\n-                LocalKeyState::Destroyed => {}\n+            if FOO.try_with(|_| ()).is_ok() {\n+                panic!(\"should not be in valid state\");\n             }\n         }\n     }"}, {"sha": "552f4c5e829e157655c6b4f8b7ba1c6d18239409", "filename": "src/test/run-pass/tls-try-with.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/082dd6d7af37ac76d99147ae7242080d4f5c74aa/src%2Ftest%2Frun-pass%2Ftls-try-with.rs", "raw_url": "https://github.com/rust-lang/rust/raw/082dd6d7af37ac76d99147ae7242080d4f5c74aa/src%2Ftest%2Frun-pass%2Ftls-try-with.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Ftls-try-with.rs?ref=082dd6d7af37ac76d99147ae7242080d4f5c74aa", "patch": "@@ -10,7 +10,7 @@\n \n // ignore-emscripten no threads support\n \n-#![feature(thread_local_state)]\n+#![feature(thread_local_try_with)]\n \n use std::thread;\n "}]}