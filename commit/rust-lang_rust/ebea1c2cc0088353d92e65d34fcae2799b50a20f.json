{"sha": "ebea1c2cc0088353d92e65d34fcae2799b50a20f", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViZWExYzJjYzAwODgzNTNkOTJlNjVkMzRmY2FlMjc5OWI1MGEyMGY=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-05-11T13:11:04Z"}, "committer": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-06-22T23:29:29Z"}, "message": "let_chains: Add feature gate.", "tree": {"sha": "4e49dc43f65b19402d9ea1127738e0c1236055ea", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4e49dc43f65b19402d9ea1127738e0c1236055ea"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ebea1c2cc0088353d92e65d34fcae2799b50a20f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ebea1c2cc0088353d92e65d34fcae2799b50a20f", "html_url": "https://github.com/rust-lang/rust/commit/ebea1c2cc0088353d92e65d34fcae2799b50a20f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ebea1c2cc0088353d92e65d34fcae2799b50a20f/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c9fb6390859bb1d2aca957528c121c2f99b74f42", "url": "https://api.github.com/repos/rust-lang/rust/commits/c9fb6390859bb1d2aca957528c121c2f99b74f42", "html_url": "https://github.com/rust-lang/rust/commit/c9fb6390859bb1d2aca957528c121c2f99b74f42"}], "stats": {"total": 32, "additions": 31, "deletions": 1}, "files": [{"sha": "1f64f1a68885c6feef59df78c78cd8c3bd26b408", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 30, "deletions": 1, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/ebea1c2cc0088353d92e65d34fcae2799b50a20f/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebea1c2cc0088353d92e65d34fcae2799b50a20f/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=ebea1c2cc0088353d92e65d34fcae2799b50a20f", "patch": "@@ -560,6 +560,9 @@ declare_features! (\n     // Allows calling constructor functions in `const fn`.\n     (active, const_constructor, \"1.37.0\", Some(61456), None),\n \n+    // Allows `if/while p && let q = r && ...` chains.\n+    (active, let_chains, \"1.37.0\", Some(53667), None),\n+\n     // #[repr(transparent)] on enums.\n     (active, transparent_enums, \"1.37.0\", Some(60405), None),\n \n@@ -577,7 +580,8 @@ declare_features! (\n const INCOMPLETE_FEATURES: &[Symbol] = &[\n     sym::impl_trait_in_bindings,\n     sym::generic_associated_types,\n-    sym::const_generics\n+    sym::const_generics,\n+    sym::let_chains,\n ];\n \n declare_features! (\n@@ -1936,6 +1940,27 @@ impl<'a> PostExpansionVisitor<'a> {\n             Err(mut err) => err.emit(),\n         }\n     }\n+\n+    /// Recurse into all places where a `let` expression would be feature gated\n+    /// and emit gate post errors for those.\n+    fn find_and_gate_lets(&mut self, e: &'a ast::Expr) {\n+        match &e.node {\n+            ast::ExprKind::Paren(e) => {\n+                self.find_and_gate_lets(e);\n+            }\n+            ast::ExprKind::Binary(op, lhs, rhs) if op.node == ast::BinOpKind::And => {\n+                self.find_and_gate_lets(lhs);\n+                self.find_and_gate_lets(rhs);\n+            }\n+            ast::ExprKind::Let(..) => {\n+                gate_feature_post!(\n+                    &self, let_chains, e.span,\n+                    \"`let` expressions in this position are experimental\"\n+                );\n+            }\n+            _ => {}\n+        }\n+    }\n }\n \n impl<'a> Visitor<'a> for PostExpansionVisitor<'a> {\n@@ -2133,6 +2158,10 @@ impl<'a> Visitor<'a> for PostExpansionVisitor<'a> {\n \n     fn visit_expr(&mut self, e: &'a ast::Expr) {\n         match e.node {\n+            ast::ExprKind::If(ref e, ..) | ast::ExprKind::While(ref e, ..) => match e.node {\n+                ast::ExprKind::Let(..) => {} // Stable!,\n+                _ => self.find_and_gate_lets(e),\n+            }\n             ast::ExprKind::Box(_) => {\n                 gate_feature_post!(&self, box_syntax, e.span, EXPLAIN_BOX_SYNTAX);\n             }"}, {"sha": "756bc8c29d8287b739ffe87528a64970f434ffd4", "filename": "src/libsyntax_pos/symbol.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/ebea1c2cc0088353d92e65d34fcae2799b50a20f/src%2Flibsyntax_pos%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ebea1c2cc0088353d92e65d34fcae2799b50a20f/src%2Flibsyntax_pos%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_pos%2Fsymbol.rs?ref=ebea1c2cc0088353d92e65d34fcae2799b50a20f", "patch": "@@ -354,6 +354,7 @@ symbols! {\n         label_break_value,\n         lang,\n         lang_items,\n+        let_chains,\n         lhs,\n         lib,\n         lifetime,"}]}