{"sha": "56f51b35e8b4252aa0d10e9ac3d26e4b821e12a0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU2ZjUxYjM1ZThiNDI1MmFhMGQxMGU5YWMzZDI2ZTRiODIxZTEyYTA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-08-23T11:51:50Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-08-23T11:51:50Z"}, "message": "Auto merge of #4409 - jeremystucki:export, r=phansch\n\n[Doc] Ignore lines starting with #\n\nResolves #4353\n\nchangelog: none", "tree": {"sha": "62ca543b484cd4af1ffd5ff07105f98ace61b060", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/62ca543b484cd4af1ffd5ff07105f98ace61b060"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/56f51b35e8b4252aa0d10e9ac3d26e4b821e12a0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/56f51b35e8b4252aa0d10e9ac3d26e4b821e12a0", "html_url": "https://github.com/rust-lang/rust/commit/56f51b35e8b4252aa0d10e9ac3d26e4b821e12a0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/56f51b35e8b4252aa0d10e9ac3d26e4b821e12a0/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a175ca4e8eea35b268b3e55be482abfb5d0f6610", "url": "https://api.github.com/repos/rust-lang/rust/commits/a175ca4e8eea35b268b3e55be482abfb5d0f6610", "html_url": "https://github.com/rust-lang/rust/commit/a175ca4e8eea35b268b3e55be482abfb5d0f6610"}, {"sha": "df211ff467e386e346662874ccb6128f7089bd0e", "url": "https://api.github.com/repos/rust-lang/rust/commits/df211ff467e386e346662874ccb6128f7089bd0e", "html_url": "https://github.com/rust-lang/rust/commit/df211ff467e386e346662874ccb6128f7089bd0e"}], "stats": {"total": 13, "additions": 12, "deletions": 1}, "files": [{"sha": "e8fc4d84ea4f3b878fc88fdf727c7694c9a30f31", "filename": "util/export.py", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/56f51b35e8b4252aa0d10e9ac3d26e4b821e12a0/util%2Fexport.py", "raw_url": "https://github.com/rust-lang/rust/raw/56f51b35e8b4252aa0d10e9ac3d26e4b821e12a0/util%2Fexport.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/util%2Fexport.py?ref=56f51b35e8b4252aa0d10e9ac3d26e4b821e12a0", "patch": "@@ -10,13 +10,24 @@\n from lintlib import parse_all, log\n \n lint_subheadline = re.compile(r'''^\\*\\*([\\w\\s]+?)[:?.!]?\\*\\*(.*)''')\n+rust_code_block = re.compile(r'''```rust.+?```''', flags=re.DOTALL)\n \n CONF_TEMPLATE = \"\"\"\\\n This lint has the following configuration variables:\n \n * `%s: %s`: %s (defaults to `%s`).\"\"\"\n \n \n+def parse_code_block(match):\n+    lines = []\n+\n+    for line in match.group(0).split('\\n'):\n+        if not line.startswith('# '):\n+            lines.append(line)\n+\n+    return '\\n'.join(lines)\n+\n+\n def parse_lint_def(lint):\n     lint_dict = {}\n     lint_dict['id'] = lint.name\n@@ -44,7 +55,7 @@ def parse_lint_def(lint):\n         lint_dict['docs'][last_section] += text + \"\\n\"\n \n     for section in lint_dict['docs']:\n-        lint_dict['docs'][section] = lint_dict['docs'][section].strip()\n+        lint_dict['docs'][section] = re.sub(rust_code_block, parse_code_block, lint_dict['docs'][section].strip())\n \n     return lint_dict\n "}]}