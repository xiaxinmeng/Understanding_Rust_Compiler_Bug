{"sha": "5b7d0f389f1ae4177f675a5ac535226ef92027a3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjViN2QwZjM4OWYxYWU0MTc3ZjY3NWE1YWM1MzUyMjZlZjkyMDI3YTM=", "commit": {"author": {"name": "Eduard-Mihai Burtescu", "email": "edy.burt@gmail.com", "date": "2019-10-29T17:46:18Z"}, "committer": {"name": "Eduard-Mihai Burtescu", "email": "edy.burt@gmail.com", "date": "2019-12-03T13:28:18Z"}, "message": "rustc_codegen_llvm: move NoReturn attribute to apply_attrs_llfn.", "tree": {"sha": "5b1634d87c05de4320d20fe8c9f37aa3a48b62f0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5b1634d87c05de4320d20fe8c9f37aa3a48b62f0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5b7d0f389f1ae4177f675a5ac535226ef92027a3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5b7d0f389f1ae4177f675a5ac535226ef92027a3", "html_url": "https://github.com/rust-lang/rust/commit/5b7d0f389f1ae4177f675a5ac535226ef92027a3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5b7d0f389f1ae4177f675a5ac535226ef92027a3/comments", "author": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "committer": {"login": "eddyb", "id": 77424, "node_id": "MDQ6VXNlcjc3NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/77424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eddyb", "html_url": "https://github.com/eddyb", "followers_url": "https://api.github.com/users/eddyb/followers", "following_url": "https://api.github.com/users/eddyb/following{/other_user}", "gists_url": "https://api.github.com/users/eddyb/gists{/gist_id}", "starred_url": "https://api.github.com/users/eddyb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eddyb/subscriptions", "organizations_url": "https://api.github.com/users/eddyb/orgs", "repos_url": "https://api.github.com/users/eddyb/repos", "events_url": "https://api.github.com/users/eddyb/events{/privacy}", "received_events_url": "https://api.github.com/users/eddyb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "95b944210f8964f24a64dbb7d723b622eb3b0a4e", "url": "https://api.github.com/repos/rust-lang/rust/commits/95b944210f8964f24a64dbb7d723b622eb3b0a4e", "html_url": "https://github.com/rust-lang/rust/commit/95b944210f8964f24a64dbb7d723b622eb3b0a4e"}], "stats": {"total": 12, "additions": 5, "deletions": 7}, "files": [{"sha": "4ad58b9a9f7a63fa1d0ae9e573c9262f117f8366", "filename": "src/librustc_codegen_llvm/abi.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/5b7d0f389f1ae4177f675a5ac535226ef92027a3/src%2Flibrustc_codegen_llvm%2Fabi.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5b7d0f389f1ae4177f675a5ac535226ef92027a3/src%2Flibrustc_codegen_llvm%2Fabi.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fabi.rs?ref=5b7d0f389f1ae4177f675a5ac535226ef92027a3", "patch": "@@ -388,6 +388,11 @@ impl<'tcx> FnAbiLlvmExt<'tcx> for FnAbi<'tcx, Ty<'tcx>> {\n     }\n \n     fn apply_attrs_llfn(&self, cx: &CodegenCx<'ll, 'tcx>, llfn: &'ll Value) {\n+        // FIXME(eddyb) can this also be applied to callsites?\n+        if self.ret.layout.abi.is_uninhabited() {\n+            llvm::Attribute::NoReturn.apply_llfn(llvm::AttributePlace::Function, llfn);\n+        }\n+\n         let mut i = 0;\n         let mut apply = |attrs: &ArgAttributes, ty: Option<&Type>| {\n             attrs.apply_llfn(llvm::AttributePlace::Argument(i), llfn, ty);"}, {"sha": "8b6fedc87db968b35a5ac02ca0b60b91c4bf2687", "filename": "src/librustc_codegen_llvm/declare.rs", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/5b7d0f389f1ae4177f675a5ac535226ef92027a3/src%2Flibrustc_codegen_llvm%2Fdeclare.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5b7d0f389f1ae4177f675a5ac535226ef92027a3/src%2Flibrustc_codegen_llvm%2Fdeclare.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fdeclare.rs?ref=5b7d0f389f1ae4177f675a5ac535226ef92027a3", "patch": "@@ -98,14 +98,7 @@ impl DeclareMethods<'tcx> for CodegenCx<'ll, 'tcx> {\n         debug!(\"declare_rust_fn(name={:?}, fn_abi={:?})\", name, fn_abi);\n \n         let llfn = declare_raw_fn(self, name, fn_abi.llvm_cconv(), fn_abi.llvm_type(self));\n-\n-        // FIXME(eddyb) move into `FnAbi::apply_attrs_llfn`.\n-        if fn_abi.ret.layout.abi.is_uninhabited() {\n-            llvm::Attribute::NoReturn.apply_llfn(Function, llfn);\n-        }\n-\n         fn_abi.apply_attrs_llfn(self, llfn);\n-\n         llfn\n     }\n "}]}