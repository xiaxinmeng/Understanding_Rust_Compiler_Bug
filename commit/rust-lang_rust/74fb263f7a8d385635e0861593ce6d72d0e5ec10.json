{"sha": "74fb263f7a8d385635e0861593ce6d72d0e5ec10", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc0ZmIyNjNmN2E4ZDM4NTYzNWUwODYxNTkzY2U2ZDcyZDBlNWVjMTA=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-03-26T13:58:10Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-03-26T13:58:10Z"}, "message": "auto merge of #5546 : nikomatsakis/rust/ty_region-useful-span, r=catamorphism\n\nr? @catamorphism", "tree": {"sha": "3bb1f03ef6087dc2e45d35c9c2db52b0deeec1ad", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3bb1f03ef6087dc2e45d35c9c2db52b0deeec1ad"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/74fb263f7a8d385635e0861593ce6d72d0e5ec10", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/74fb263f7a8d385635e0861593ce6d72d0e5ec10", "html_url": "https://github.com/rust-lang/rust/commit/74fb263f7a8d385635e0861593ce6d72d0e5ec10", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/74fb263f7a8d385635e0861593ce6d72d0e5ec10/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "51eb7dc8a719f6ae05a563109b3bbccee319263e", "url": "https://api.github.com/repos/rust-lang/rust/commits/51eb7dc8a719f6ae05a563109b3bbccee319263e", "html_url": "https://github.com/rust-lang/rust/commit/51eb7dc8a719f6ae05a563109b3bbccee319263e"}, {"sha": "057c40d5bd3dc700af7d99a2dfeba0fe6c2ba119", "url": "https://api.github.com/repos/rust-lang/rust/commits/057c40d5bd3dc700af7d99a2dfeba0fe6c2ba119", "html_url": "https://github.com/rust-lang/rust/commit/057c40d5bd3dc700af7d99a2dfeba0fe6c2ba119"}], "stats": {"total": 29, "additions": 18, "deletions": 11}, "files": [{"sha": "bab652a3d1e2f1ea89a43b4c137c699467fcb988", "filename": "src/librustc/middle/borrowck/gather_loans.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/74fb263f7a8d385635e0861593ce6d72d0e5ec10/src%2Flibrustc%2Fmiddle%2Fborrowck%2Fgather_loans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/74fb263f7a8d385635e0861593ce6d72d0e5ec10/src%2Flibrustc%2Fmiddle%2Fborrowck%2Fgather_loans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fborrowck%2Fgather_loans.rs?ref=74fb263f7a8d385635e0861593ce6d72d0e5ec10", "patch": "@@ -145,7 +145,7 @@ fn req_loans_in_expr(ex: @ast::expr,\n \n         // make sure that the thing we are pointing out stays valid\n         // for the lifetime `scope_r` of the resulting ptr:\n-        let scope_r = ty_region(tcx.ty(ex));\n+        let scope_r = ty_region(tcx, ex.span, tcx.ty(ex));\n         self.guarantee_valid(base_cmt, mutbl, scope_r);\n         visit::visit_expr(ex, self, vt);\n       }\n@@ -599,7 +599,8 @@ pub impl GatherLoanCtxt {\n                     // find the region of the resulting pointer (note that\n                     // the type of such a pattern will *always* be a\n                     // region pointer)\n-                    let scope_r = ty_region(self.tcx().ty(pat));\n+                    let scope_r = ty_region(self.tcx(), pat.span,\n+                                            self.tcx().ty(pat));\n \n                     // if the scope of the region ptr turns out to be\n                     // specific to this arm, wrap the categorization with"}, {"sha": "44245e0b4e1f8ff9d7294349283f2b31dda8723c", "filename": "src/librustc/middle/ty.rs", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/74fb263f7a8d385635e0861593ce6d72d0e5ec10/src%2Flibrustc%2Fmiddle%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/74fb263f7a8d385635e0861593ce6d72d0e5ec10/src%2Flibrustc%2Fmiddle%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fty.rs?ref=74fb263f7a8d385635e0861593ce6d72d0e5ec10", "patch": "@@ -2794,13 +2794,18 @@ pub fn ty_vstore(ty: t) -> vstore {\n     }\n }\n \n-pub fn ty_region(ty: t) -> Region {\n+pub fn ty_region(tcx: ctxt,\n+                 span: span,\n+                 ty: t) -> Region {\n     match get(ty).sty {\n-      ty_rptr(r, _) => r,\n-      ty_evec(_, vstore_slice(r)) => r,\n-      ty_estr(vstore_slice(r)) => r,\n-      ref s => fail!(fmt!(\"ty_region() invoked on in appropriate ty: %?\",\n-          (*s)))\n+        ty_rptr(r, _) => r,\n+        ty_evec(_, vstore_slice(r)) => r,\n+        ty_estr(vstore_slice(r)) => r,\n+        ref s => {\n+            tcx.sess.span_bug(\n+                span,\n+                fmt!(\"ty_region() invoked on in appropriate ty: %?\", s));\n+        }\n     }\n }\n "}, {"sha": "3a02c19dbaf83ef3c23e12aa6bae4ff5be01c025", "filename": "src/librustc/middle/typeck/check/regionck.rs", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/74fb263f7a8d385635e0861593ce6d72d0e5ec10/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fregionck.rs", "raw_url": "https://github.com/rust-lang/rust/raw/74fb263f7a8d385635e0861593ce6d72d0e5ec10/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fregionck.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Ftypeck%2Fcheck%2Fregionck.rs?ref=74fb263f7a8d385635e0861593ce6d72d0e5ec10", "patch": "@@ -616,8 +616,9 @@ pub mod guarantor {\n         // mk_subr should never fail.\n         let rptr_ty = rcx.resolve_node_type(id);\n         if !ty::type_is_error(rptr_ty) {\n-            debug!(\"rptr_ty=%s\", ty_to_str(rcx.fcx.ccx.tcx, rptr_ty));\n-            let r = ty::ty_region(rptr_ty);\n+            let tcx = rcx.fcx.ccx.tcx;\n+            debug!(\"rptr_ty=%s\", ty_to_str(tcx, rptr_ty));\n+            let r = ty::ty_region(tcx, span, rptr_ty);\n             infallibly_mk_subr(rcx, true, span, r, bound);\n         }\n     }\n@@ -890,7 +891,7 @@ pub mod guarantor {\n             ast::pat_region(p) => {\n                 let rptr_ty = rcx.resolve_node_type(pat.id);\n                 if !ty::type_is_error(rptr_ty) {\n-                    let r = ty::ty_region(rptr_ty);\n+                    let r = ty::ty_region(rcx.fcx.tcx(), pat.span, rptr_ty);\n                     link_ref_bindings_in_pat(rcx, p, Some(r));\n                 }\n             }"}]}