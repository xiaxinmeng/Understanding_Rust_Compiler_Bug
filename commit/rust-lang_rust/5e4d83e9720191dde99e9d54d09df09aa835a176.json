{"sha": "5e4d83e9720191dde99e9d54d09df09aa835a176", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVlNGQ4M2U5NzIwMTkxZGRlOTllOWQ1NGQwOWRmMDlhYTgzNWExNzY=", "commit": {"author": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2019-05-27T21:37:18Z"}, "committer": {"name": "Santiago Pastorino", "email": "spastorino@gmail.com", "date": "2019-05-28T16:50:55Z"}, "message": "Rename Place::local to Place::local_or_deref_local", "tree": {"sha": "e896cc391dc3f78db8040b321325cd453edd29f1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e896cc391dc3f78db8040b321325cd453edd29f1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5e4d83e9720191dde99e9d54d09df09aa835a176", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5e4d83e9720191dde99e9d54d09df09aa835a176", "html_url": "https://github.com/rust-lang/rust/commit/5e4d83e9720191dde99e9d54d09df09aa835a176", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5e4d83e9720191dde99e9d54d09df09aa835a176/comments", "author": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "committer": {"login": "spastorino", "id": 52642, "node_id": "MDQ6VXNlcjUyNjQy", "avatar_url": "https://avatars.githubusercontent.com/u/52642?v=4", "gravatar_id": "", "url": "https://api.github.com/users/spastorino", "html_url": "https://github.com/spastorino", "followers_url": "https://api.github.com/users/spastorino/followers", "following_url": "https://api.github.com/users/spastorino/following{/other_user}", "gists_url": "https://api.github.com/users/spastorino/gists{/gist_id}", "starred_url": "https://api.github.com/users/spastorino/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/spastorino/subscriptions", "organizations_url": "https://api.github.com/users/spastorino/orgs", "repos_url": "https://api.github.com/users/spastorino/repos", "events_url": "https://api.github.com/users/spastorino/events{/privacy}", "received_events_url": "https://api.github.com/users/spastorino/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7da118581c9dc839c8bf3fbb622bab9ce32bbf38", "url": "https://api.github.com/repos/rust-lang/rust/commits/7da118581c9dc839c8bf3fbb622bab9ce32bbf38", "html_url": "https://github.com/rust-lang/rust/commit/7da118581c9dc839c8bf3fbb622bab9ce32bbf38"}], "stats": {"total": 26, "additions": 14, "deletions": 12}, "files": [{"sha": "d70470fe261a2fe4b0b79e90a8cbde4acd4bc126", "filename": "src/librustc/mir/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5e4d83e9720191dde99e9d54d09df09aa835a176/src%2Flibrustc%2Fmir%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e4d83e9720191dde99e9d54d09df09aa835a176/src%2Flibrustc%2Fmir%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmir%2Fmod.rs?ref=5e4d83e9720191dde99e9d54d09df09aa835a176", "patch": "@@ -2040,7 +2040,7 @@ impl<'tcx> Place<'tcx> {\n     /// a single deref of a local.\n     //\n     // FIXME: can we safely swap the semantics of `fn base_local` below in here instead?\n-    pub fn local(&self) -> Option<Local> {\n+    pub fn local_or_deref_local(&self) -> Option<Local> {\n         match self {\n             Place::Base(PlaceBase::Local(local)) |\n             Place::Projection(box Projection {"}, {"sha": "f464e58e36b15ed11a88b5c2dca0f98673efc119", "filename": "src/librustc_mir/borrow_check/conflict_errors.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/5e4d83e9720191dde99e9d54d09df09aa835a176/src%2Flibrustc_mir%2Fborrow_check%2Fconflict_errors.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e4d83e9720191dde99e9d54d09df09aa835a176/src%2Flibrustc_mir%2Fborrow_check%2Fconflict_errors.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Fconflict_errors.rs?ref=5e4d83e9720191dde99e9d54d09df09aa835a176", "patch": "@@ -1616,7 +1616,7 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n                             );\n \n                             // Find the local from the operand.\n-                            let assigned_from_local = match assigned_from.local() {\n+                            let assigned_from_local = match assigned_from.local_or_deref_local() {\n                                 Some(local) => local,\n                                 None => continue,\n                             };\n@@ -1672,7 +1672,7 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n                     );\n \n                     // Find the local from the rvalue.\n-                    let assigned_from_local = match assigned_from.local() {\n+                    let assigned_from_local = match assigned_from.local_or_deref_local() {\n                         Some(local) => local,\n                         None => continue,\n                     };\n@@ -1735,7 +1735,7 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n                         assigned_from,\n                     );\n \n-                    if let Some(assigned_from_local) = assigned_from.local() {\n+                    if let Some(assigned_from_local) = assigned_from.local_or_deref_local() {\n                         debug!(\n                             \"annotate_argument_and_return_for_borrow: assigned_from_local={:?}\",\n                             assigned_from_local,"}, {"sha": "5a22c81a5d0578f1d83b52458e1c9b279f73b2f0", "filename": "src/librustc_mir/borrow_check/error_reporting.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/5e4d83e9720191dde99e9d54d09df09aa835a176/src%2Flibrustc_mir%2Fborrow_check%2Ferror_reporting.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e4d83e9720191dde99e9d54d09df09aa835a176/src%2Flibrustc_mir%2Fborrow_check%2Ferror_reporting.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fborrow_check%2Ferror_reporting.rs?ref=5e4d83e9720191dde99e9d54d09df09aa835a176", "patch": "@@ -37,15 +37,15 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n         diag: &mut DiagnosticBuilder<'_>,\n     ) {\n         debug!(\"add_moved_or_invoked_closure_note: location={:?} place={:?}\", location, place);\n-        let mut target = place.local();\n+        let mut target = place.local_or_deref_local();\n         for stmt in &self.mir[location.block].statements[location.statement_index..] {\n             debug!(\"add_moved_or_invoked_closure_note: stmt={:?} target={:?}\", stmt, target);\n             if let StatementKind::Assign(into, box Rvalue::Use(from)) = &stmt.kind {\n                 debug!(\"add_fnonce_closure_note: into={:?} from={:?}\", into, from);\n                 match from {\n                     Operand::Copy(ref place) |\n-                    Operand::Move(ref place) if target == place.local() =>\n-                        target = into.local(),\n+                    Operand::Move(ref place) if target == place.local_or_deref_local() =>\n+                        target = into.local_or_deref_local(),\n                     _ => {},\n                 }\n             }\n@@ -69,8 +69,8 @@ impl<'cx, 'gcx, 'tcx> MirBorrowckCtxt<'cx, 'gcx, 'tcx> {\n             if self.infcx.tcx.parent(id) == self.infcx.tcx.lang_items().fn_once_trait() {\n                 let closure = match args.first() {\n                     Some(Operand::Copy(ref place)) |\n-                    Some(Operand::Move(ref place)) if target == place.local() =>\n-                        place.local().unwrap(),\n+                    Some(Operand::Move(ref place)) if target == place.local_or_deref_local() =>\n+                        place.local_or_deref_local().unwrap(),\n                     _ => return,\n                 };\n "}, {"sha": "685db7713cac16dd5f3e713e3b5db6e44d02e74e", "filename": "src/librustc_mir/build/expr/as_rvalue.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/5e4d83e9720191dde99e9d54d09df09aa835a176/src%2Flibrustc_mir%2Fbuild%2Fexpr%2Fas_rvalue.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e4d83e9720191dde99e9d54d09df09aa835a176/src%2Flibrustc_mir%2Fbuild%2Fexpr%2Fas_rvalue.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fbuild%2Fexpr%2Fas_rvalue.rs?ref=5e4d83e9720191dde99e9d54d09df09aa835a176", "patch": "@@ -528,7 +528,7 @@ impl<'a, 'gcx, 'tcx> Builder<'a, 'gcx, 'tcx> {\n             }) => {\n                 // Not projected from the implicit `self` in a closure.\n                 debug_assert!(\n-                    match base.local() {\n+                    match base.local_or_deref_local() {\n                         Some(local) => local == Local::new(1),\n                         None => false,\n                     },"}, {"sha": "5dde9812d605c0303246a35806ea16eaa656f8ed", "filename": "src/librustc_mir/dataflow/impls/storage_liveness.rs", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/5e4d83e9720191dde99e9d54d09df09aa835a176/src%2Flibrustc_mir%2Fdataflow%2Fimpls%2Fstorage_liveness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5e4d83e9720191dde99e9d54d09df09aa835a176/src%2Flibrustc_mir%2Fdataflow%2Fimpls%2Fstorage_liveness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Fdataflow%2Fimpls%2Fstorage_liveness.rs?ref=5e4d83e9720191dde99e9d54d09df09aa835a176", "patch": "@@ -46,8 +46,10 @@ impl<'a, 'tcx> BitDenotation<'tcx> for MaybeStorageLive<'a, 'tcx> {\n                          sets: &mut BlockSets<'_, Local>,\n                          loc: Location) {\n         match &self.mir[loc.block].terminator().kind {\n-            TerminatorKind::Drop { location, .. } => if let Some(l) = location.local() {\n-                sets.kill(l);\n+            TerminatorKind::Drop { location, .. } => {\n+                if let Some(l) = location.local_or_deref_local() {\n+                    sets.kill(l);\n+                }\n             }\n             _ => (),\n         }"}]}