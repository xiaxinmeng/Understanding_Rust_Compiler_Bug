{"sha": "ad8c7b6705d94bdf9293fbfe0c4d386d5f7e81a2", "node_id": "C_kwDOAAsO6NoAKGFkOGM3YjY3MDVkOTRiZGY5MjkzZmJmZTBjNGQzODZkNWY3ZTgxYTI", "commit": {"author": {"name": "Maybe Waffle", "email": "waffle.lapkin@gmail.com", "date": "2023-04-20T19:24:04Z"}, "committer": {"name": "Maybe Waffle", "email": "waffle.lapkin@gmail.com", "date": "2023-04-20T19:54:10Z"}, "message": "Simplify `bits_for_tags` impl", "tree": {"sha": "63e0af38da3a549ddd143eabee22cfc8a596cd33", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/63e0af38da3a549ddd143eabee22cfc8a596cd33"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ad8c7b6705d94bdf9293fbfe0c4d386d5f7e81a2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ad8c7b6705d94bdf9293fbfe0c4d386d5f7e81a2", "html_url": "https://github.com/rust-lang/rust/commit/ad8c7b6705d94bdf9293fbfe0c4d386d5f7e81a2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ad8c7b6705d94bdf9293fbfe0c4d386d5f7e81a2/comments", "author": {"login": "WaffleLapkin", "id": 38225716, "node_id": "MDQ6VXNlcjM4MjI1NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/38225716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WaffleLapkin", "html_url": "https://github.com/WaffleLapkin", "followers_url": "https://api.github.com/users/WaffleLapkin/followers", "following_url": "https://api.github.com/users/WaffleLapkin/following{/other_user}", "gists_url": "https://api.github.com/users/WaffleLapkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/WaffleLapkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WaffleLapkin/subscriptions", "organizations_url": "https://api.github.com/users/WaffleLapkin/orgs", "repos_url": "https://api.github.com/users/WaffleLapkin/repos", "events_url": "https://api.github.com/users/WaffleLapkin/events{/privacy}", "received_events_url": "https://api.github.com/users/WaffleLapkin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "WaffleLapkin", "id": 38225716, "node_id": "MDQ6VXNlcjM4MjI1NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/38225716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WaffleLapkin", "html_url": "https://github.com/WaffleLapkin", "followers_url": "https://api.github.com/users/WaffleLapkin/followers", "following_url": "https://api.github.com/users/WaffleLapkin/following{/other_user}", "gists_url": "https://api.github.com/users/WaffleLapkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/WaffleLapkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WaffleLapkin/subscriptions", "organizations_url": "https://api.github.com/users/WaffleLapkin/orgs", "repos_url": "https://api.github.com/users/WaffleLapkin/repos", "events_url": "https://api.github.com/users/WaffleLapkin/events{/privacy}", "received_events_url": "https://api.github.com/users/WaffleLapkin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7cfecf26f77f0d2c3d83be946d4da6ab997c939e", "url": "https://api.github.com/repos/rust-lang/rust/commits/7cfecf26f77f0d2c3d83be946d4da6ab997c939e", "html_url": "https://github.com/rust-lang/rust/commit/7cfecf26f77f0d2c3d83be946d4da6ab997c939e"}], "stats": {"total": 16, "additions": 3, "deletions": 13}, "files": [{"sha": "2914eece6796bd3892d7f6ea212e540a6245f156", "filename": "compiler/rustc_data_structures/src/tagged_ptr.rs", "status": "modified", "additions": 3, "deletions": 13, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/ad8c7b6705d94bdf9293fbfe0c4d386d5f7e81a2/compiler%2Frustc_data_structures%2Fsrc%2Ftagged_ptr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ad8c7b6705d94bdf9293fbfe0c4d386d5f7e81a2/compiler%2Frustc_data_structures%2Fsrc%2Ftagged_ptr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_data_structures%2Fsrc%2Ftagged_ptr.rs?ref=ad8c7b6705d94bdf9293fbfe0c4d386d5f7e81a2", "patch": "@@ -155,7 +155,9 @@ pub const fn bits_for_tags(mut tags: &[usize]) -> u32 {\n     while let &[tag, ref rest @ ..] = tags {\n         tags = rest;\n \n-        let b = bits_for_tag(tag);\n+        // bits required to represent `tag`,\n+        // position of the most significant 1\n+        let b = usize::BITS - tag.leading_zeros();\n         if b > bits {\n             bits = b;\n         }\n@@ -164,18 +166,6 @@ pub const fn bits_for_tags(mut tags: &[usize]) -> u32 {\n     bits\n }\n \n-/// Returns `(size_of::<usize>() * 8) - tag.leading_zeros()`\n-const fn bits_for_tag(mut tag: usize) -> u32 {\n-    let mut bits = 0;\n-\n-    while tag > 0 {\n-        bits += 1;\n-        tag >>= 1;\n-    }\n-\n-    bits\n-}\n-\n unsafe impl<T: ?Sized + Aligned> Pointer for Box<T> {\n     const BITS: u32 = bits_for::<Self::Target>();\n "}]}