{"sha": "87b714b61948e55acb1ef75557d42ad2c98f224e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg3YjcxNGI2MTk0OGU1NWFjYjFlZjc1NTU3ZDQyYWQyYzk4ZjIyNGU=", "commit": {"author": {"name": "Pietro Albini", "email": "pietro@pietroalbini.org", "date": "2018-07-01T19:18:49Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-07-01T19:18:49Z"}, "message": "Rollup merge of #51921 - japaric:panic-impl-error, r=nagisa\n\nimprove the error message when `#[panic_implementation]` is missing\n\ncloses #51341\n\nr? @nagisa\ncc @phil-opp", "tree": {"sha": "4edea8f7c8d0456af4697d8ca2d117ec1a45d44c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4edea8f7c8d0456af4697d8ca2d117ec1a45d44c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/87b714b61948e55acb1ef75557d42ad2c98f224e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJbOSkZCRBK7hj4Ov3rIwAAdHIIAH4g95hEim33G8Mn4ILpA1Ai\nf3lylFtOmlHRnpSdZPmzB6fI88NYnpDEYanZzm/ZJMS987zHEk8GhQcryxPTve2Q\nuTGCfIjXknsjDpHM7T794803zGIFsTFliMEEPt1mfM5PEz0Kzom6uYnXETwiNG46\nooyIE4QUWGeVZVdMq2164ySM9X36NxhdzapVGSH7BSldYJgRiqXnDzhCBj+BEcfM\ne7YkV+FbMyamfhu7wWS2dgYysyk/D9y8OxcHRDIRtMyd0fbSMgpTk8gPqiTVT8+U\nRcLayV9kvttcn6e0W9wDLgIl8QO6O7WdSeeJPoSpOkjBXRAPIWSVrfHN/tnEVp8=\n=V9b9\n-----END PGP SIGNATURE-----\n", "payload": "tree 4edea8f7c8d0456af4697d8ca2d117ec1a45d44c\nparent 3f5d2fd8504a1f3b5351292840a9d0863e0622be\nparent ee52862460000e89b29bfc9d57944b03904d0ff5\nauthor Pietro Albini <pietro@pietroalbini.org> 1530472729 +0200\ncommitter GitHub <noreply@github.com> 1530472729 +0200\n\nRollup merge of #51921 - japaric:panic-impl-error, r=nagisa\n\nimprove the error message when `#[panic_implementation]` is missing\n\ncloses #51341\n\nr? @nagisa\ncc @phil-opp\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/87b714b61948e55acb1ef75557d42ad2c98f224e", "html_url": "https://github.com/rust-lang/rust/commit/87b714b61948e55acb1ef75557d42ad2c98f224e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/87b714b61948e55acb1ef75557d42ad2c98f224e/comments", "author": {"login": "pietroalbini", "id": 2299951, "node_id": "MDQ6VXNlcjIyOTk5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/2299951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pietroalbini", "html_url": "https://github.com/pietroalbini", "followers_url": "https://api.github.com/users/pietroalbini/followers", "following_url": "https://api.github.com/users/pietroalbini/following{/other_user}", "gists_url": "https://api.github.com/users/pietroalbini/gists{/gist_id}", "starred_url": "https://api.github.com/users/pietroalbini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pietroalbini/subscriptions", "organizations_url": "https://api.github.com/users/pietroalbini/orgs", "repos_url": "https://api.github.com/users/pietroalbini/repos", "events_url": "https://api.github.com/users/pietroalbini/events{/privacy}", "received_events_url": "https://api.github.com/users/pietroalbini/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3f5d2fd8504a1f3b5351292840a9d0863e0622be", "url": "https://api.github.com/repos/rust-lang/rust/commits/3f5d2fd8504a1f3b5351292840a9d0863e0622be", "html_url": "https://github.com/rust-lang/rust/commit/3f5d2fd8504a1f3b5351292840a9d0863e0622be"}, {"sha": "ee52862460000e89b29bfc9d57944b03904d0ff5", "url": "https://api.github.com/repos/rust-lang/rust/commits/ee52862460000e89b29bfc9d57944b03904d0ff5", "html_url": "https://github.com/rust-lang/rust/commit/ee52862460000e89b29bfc9d57944b03904d0ff5"}], "stats": {"total": 30, "additions": 26, "deletions": 4}, "files": [{"sha": "180e75df1a66ec55545fbae6c6f97807c020a132", "filename": "src/librustc/middle/weak_lang_items.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/87b714b61948e55acb1ef75557d42ad2c98f224e/src%2Flibrustc%2Fmiddle%2Fweak_lang_items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87b714b61948e55acb1ef75557d42ad2c98f224e/src%2Flibrustc%2Fmiddle%2Fweak_lang_items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fweak_lang_items.rs?ref=87b714b61948e55acb1ef75557d42ad2c98f224e", "patch": "@@ -112,9 +112,13 @@ fn verify<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n         if missing.contains(&lang_items::$item) &&\n            !whitelisted(tcx, lang_items::$item) &&\n            items.$name().is_none() {\n-            tcx.sess.err(&format!(\"language item required, but not found: `{}`\",\n-                                  stringify!($name)));\n-\n+            if lang_items::$item == lang_items::PanicImplLangItem {\n+                tcx.sess.err(&format!(\"`#[panic_implementation]` function required, \\\n+                                        but not found\"));\n+            } else {\n+                tcx.sess.err(&format!(\"language item required, but not found: `{}`\",\n+                                        stringify!($name)));\n+            }\n         }\n     )*\n }"}, {"sha": "b11081a3e3bbe40773162e9fb4fcca69d2e68519", "filename": "src/test/compile-fail/panic-implementation-missing.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/87b714b61948e55acb1ef75557d42ad2c98f224e/src%2Ftest%2Fcompile-fail%2Fpanic-implementation-missing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87b714b61948e55acb1ef75557d42ad2c98f224e/src%2Ftest%2Fcompile-fail%2Fpanic-implementation-missing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fpanic-implementation-missing.rs?ref=87b714b61948e55acb1ef75557d42ad2c98f224e", "patch": "@@ -0,0 +1,18 @@\n+// Copyright 2018 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+// error-pattern: `#[panic_implementation]` function required, but not found\n+\n+#![feature(lang_items)]\n+#![no_main]\n+#![no_std]\n+\n+#[lang = \"eh_personality\"]\n+fn eh() {}"}, {"sha": "42972c40674b68e31e67d93f9fa24c83f59e6ad1", "filename": "src/test/compile-fail/weak-lang-item.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/87b714b61948e55acb1ef75557d42ad2c98f224e/src%2Ftest%2Fcompile-fail%2Fweak-lang-item.rs", "raw_url": "https://github.com/rust-lang/rust/raw/87b714b61948e55acb1ef75557d42ad2c98f224e/src%2Ftest%2Fcompile-fail%2Fweak-lang-item.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fweak-lang-item.rs?ref=87b714b61948e55acb1ef75557d42ad2c98f224e", "patch": "@@ -9,7 +9,7 @@\n // except according to those terms.\n \n // aux-build:weak-lang-items.rs\n-// error-pattern: language item required, but not found: `panic_impl`\n+// error-pattern: `#[panic_implementation]` function required, but not found\n // error-pattern: language item required, but not found: `eh_personality`\n // ignore-wasm32-bare compiled with panic=abort, personality not required\n "}]}