{"sha": "013d47b19b25b94e9740f725425bc836bac6efde", "node_id": "MDY6Q29tbWl0NzI0NzEyOjAxM2Q0N2IxOWIyNWI5NGU5NzQwZjcyNTQyNWJjODM2YmFjNmVmZGU=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-07-20T16:23:31Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2015-07-20T16:23:31Z"}, "message": "syntax: Suppress panic message on `fatal`\n\nThis commit ensures that the rustc thread does not leak a panic message whenever\na call to `fatal` happens. This already happens for the main rustc thread as\npart of the `rustc_driver::monitor` function, but the compiler also spawns\nthreads for other operations like `-C codegen-units`, and sometimes errors are\nemitted on these threads as well. To ensure that there's a consistent\nerror-handling experience across threads this unifies these two to never print\nthe panic message in the case of a normal and expected fatal error.\n\nThis should also fix the flaky `asm-src-loc-codegen-units.rs` test as the output\nis sometimes garbled if diagnostics are printed while the panic message is also\nbeing printed.", "tree": {"sha": "3471feb8b88006f8ea76871307ba11b414b54979", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3471feb8b88006f8ea76871307ba11b414b54979"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/013d47b19b25b94e9740f725425bc836bac6efde", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/013d47b19b25b94e9740f725425bc836bac6efde", "html_url": "https://github.com/rust-lang/rust/commit/013d47b19b25b94e9740f725425bc836bac6efde", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/013d47b19b25b94e9740f725425bc836bac6efde/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b5dad7dcb22ed6bf8ebaae56b4339bd64f6983eb", "url": "https://api.github.com/repos/rust-lang/rust/commits/b5dad7dcb22ed6bf8ebaae56b4339bd64f6983eb", "html_url": "https://github.com/rust-lang/rust/commit/b5dad7dcb22ed6bf8ebaae56b4339bd64f6983eb"}], "stats": {"total": 5, "additions": 5, "deletions": 0}, "files": [{"sha": "e95813e44babe0b6cb636d7925728019cbc26c3d", "filename": "src/libsyntax/diagnostic.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/013d47b19b25b94e9740f725425bc836bac6efde/src%2Flibsyntax%2Fdiagnostic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/013d47b19b25b94e9740f725425bc836bac6efde/src%2Flibsyntax%2Fdiagnostic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fdiagnostic.rs?ref=013d47b19b25b94e9740f725425bc836bac6efde", "patch": "@@ -208,6 +208,10 @@ impl Handler {\n     }\n     pub fn fatal(&self, msg: &str) -> ! {\n         self.emit.borrow_mut().emit(None, msg, None, Fatal);\n+\n+        // Suppress the fatal error message from the panic below as we've\n+        // already terminated in our own \"legitimate\" fashion.\n+        io::set_panic(Box::new(io::sink()));\n         panic!(FatalError);\n     }\n     pub fn err(&self, msg: &str) {"}, {"sha": "d93af5da13c1e2803a2aa263e9340d3df035a42b", "filename": "src/libsyntax/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/013d47b19b25b94e9740f725425bc836bac6efde/src%2Flibsyntax%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/013d47b19b25b94e9740f725425bc836bac6efde/src%2Flibsyntax%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Flib.rs?ref=013d47b19b25b94e9740f725425bc836bac6efde", "patch": "@@ -32,6 +32,7 @@\n #![feature(libc)]\n #![feature(ref_slice)]\n #![feature(rustc_private)]\n+#![feature(set_stdio)]\n #![feature(staged_api)]\n #![feature(str_char)]\n #![feature(str_escape)]"}]}