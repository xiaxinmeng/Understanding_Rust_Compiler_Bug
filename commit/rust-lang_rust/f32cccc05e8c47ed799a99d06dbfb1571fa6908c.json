{"sha": "f32cccc05e8c47ed799a99d06dbfb1571fa6908c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYzMmNjY2MwNWU4YzQ3ZWQ3OTlhOTlkMDZkYmZiMTU3MWZhNjkwOGM=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-03-12T18:38:09Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2020-03-12T18:38:09Z"}, "message": "rename panic_if_ intrinsics to assert_", "tree": {"sha": "55457d7bbb7b51c58bd008db62e9a8ea968c72e9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/55457d7bbb7b51c58bd008db62e9a8ea968c72e9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f32cccc05e8c47ed799a99d06dbfb1571fa6908c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f32cccc05e8c47ed799a99d06dbfb1571fa6908c", "html_url": "https://github.com/rust-lang/rust/commit/f32cccc05e8c47ed799a99d06dbfb1571fa6908c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f32cccc05e8c47ed799a99d06dbfb1571fa6908c/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "23de8275c9b5e5812dc54a12bdba6d80870d9dc8", "url": "https://api.github.com/repos/rust-lang/rust/commits/23de8275c9b5e5812dc54a12bdba6d80870d9dc8", "html_url": "https://github.com/rust-lang/rust/commit/23de8275c9b5e5812dc54a12bdba6d80870d9dc8"}], "stats": {"total": 36, "additions": 27, "deletions": 9}, "files": [{"sha": "953b7a986514d36a89e173f302fe09fa6ee21452", "filename": "src/libcore/intrinsics.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/f32cccc05e8c47ed799a99d06dbfb1571fa6908c/src%2Flibcore%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f32cccc05e8c47ed799a99d06dbfb1571fa6908c/src%2Flibcore%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fintrinsics.rs?ref=f32cccc05e8c47ed799a99d06dbfb1571fa6908c", "patch": "@@ -1005,17 +1005,23 @@ extern \"rust-intrinsic\" {\n \n     /// A guard for unsafe functions that cannot ever be executed if `T` is uninhabited:\n     /// This will statically either panic, or do nothing.\n+    #[cfg(bootstrap)]\n     pub fn panic_if_uninhabited<T>();\n \n+    /// A guard for unsafe functions that cannot ever be executed if `T` is uninhabited:\n+    /// This will statically either panic, or do nothing.\n+    #[cfg(not(bootstrap))]\n+    pub fn assert_inhabited<T>();\n+\n     /// A guard for unsafe functions that cannot ever be executed if `T` does not permit\n     /// zero-initialization: This will statically either panic, or do nothing.\n     #[cfg(not(bootstrap))]\n-    pub fn panic_if_zero_invalid<T>();\n+    pub fn assert_zero_valid<T>();\n \n     /// A guard for unsafe functions that cannot ever be executed if `T` has invalid\n     /// bit patterns: This will statically either panic, or do nothing.\n     #[cfg(not(bootstrap))]\n-    pub fn panic_if_any_invalid<T>();\n+    pub fn assert_uninit_valid<T>();\n \n     /// Gets a reference to a static `Location` indicating where it was called.\n     #[rustc_const_unstable(feature = \"const_caller_location\", issue = \"47809\")]"}, {"sha": "bf39d56fc115c6e8bea5760a28a877e0a3d1a25f", "filename": "src/libcore/mem/maybe_uninit.rs", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/f32cccc05e8c47ed799a99d06dbfb1571fa6908c/src%2Flibcore%2Fmem%2Fmaybe_uninit.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f32cccc05e8c47ed799a99d06dbfb1571fa6908c/src%2Flibcore%2Fmem%2Fmaybe_uninit.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fmem%2Fmaybe_uninit.rs?ref=f32cccc05e8c47ed799a99d06dbfb1571fa6908c", "patch": "@@ -495,7 +495,10 @@ impl<T> MaybeUninit<T> {\n     #[inline(always)]\n     #[rustc_diagnostic_item = \"assume_init\"]\n     pub unsafe fn assume_init(self) -> T {\n+        #[cfg(bootstrap)]\n         intrinsics::panic_if_uninhabited::<T>();\n+        #[cfg(not(bootstrap))]\n+        intrinsics::assert_inhabited::<T>();\n         ManuallyDrop::into_inner(self.value)\n     }\n \n@@ -559,7 +562,10 @@ impl<T> MaybeUninit<T> {\n     #[unstable(feature = \"maybe_uninit_extra\", issue = \"63567\")]\n     #[inline(always)]\n     pub unsafe fn read(&self) -> T {\n+        #[cfg(bootstrap)]\n         intrinsics::panic_if_uninhabited::<T>();\n+        #[cfg(not(bootstrap))]\n+        intrinsics::assert_inhabited::<T>();\n         self.as_ptr().read()\n     }\n \n@@ -621,7 +627,10 @@ impl<T> MaybeUninit<T> {\n     #[unstable(feature = \"maybe_uninit_ref\", issue = \"63568\")]\n     #[inline(always)]\n     pub unsafe fn get_ref(&self) -> &T {\n+        #[cfg(bootstrap)]\n         intrinsics::panic_if_uninhabited::<T>();\n+        #[cfg(not(bootstrap))]\n+        intrinsics::assert_inhabited::<T>();\n         &*self.value\n     }\n \n@@ -739,7 +748,10 @@ impl<T> MaybeUninit<T> {\n     #[unstable(feature = \"maybe_uninit_ref\", issue = \"63568\")]\n     #[inline(always)]\n     pub unsafe fn get_mut(&mut self) -> &mut T {\n+        #[cfg(bootstrap)]\n         intrinsics::panic_if_uninhabited::<T>();\n+        #[cfg(not(bootstrap))]\n+        intrinsics::assert_inhabited::<T>();\n         &mut *self.value\n     }\n "}, {"sha": "e65150af59f81ab96f86fd749f63b3158fca9b2c", "filename": "src/libcore/mem/mod.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f32cccc05e8c47ed799a99d06dbfb1571fa6908c/src%2Flibcore%2Fmem%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f32cccc05e8c47ed799a99d06dbfb1571fa6908c/src%2Flibcore%2Fmem%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fmem%2Fmod.rs?ref=f32cccc05e8c47ed799a99d06dbfb1571fa6908c", "patch": "@@ -497,7 +497,7 @@ pub const fn needs_drop<T>() -> bool {\n #[rustc_diagnostic_item = \"mem_zeroed\"]\n pub unsafe fn zeroed<T>() -> T {\n     #[cfg(not(bootstrap))]\n-    intrinsics::panic_if_zero_invalid::<T>();\n+    intrinsics::assert_zero_valid::<T>();\n     #[cfg(bootstrap)]\n     intrinsics::panic_if_uninhabited::<T>();\n     intrinsics::init()\n@@ -533,7 +533,7 @@ pub unsafe fn zeroed<T>() -> T {\n #[rustc_diagnostic_item = \"mem_uninitialized\"]\n pub unsafe fn uninitialized<T>() -> T {\n     #[cfg(not(bootstrap))]\n-    intrinsics::panic_if_any_invalid::<T>();\n+    intrinsics::assert_uninit_valid::<T>();\n     #[cfg(bootstrap)]\n     intrinsics::panic_if_uninhabited::<T>();\n     intrinsics::uninit()"}, {"sha": "eef06c357947717b4a5b8b3e4c8eeb3ce42549c2", "filename": "src/librustc_codegen_ssa/mir/block.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f32cccc05e8c47ed799a99d06dbfb1571fa6908c/src%2Flibrustc_codegen_ssa%2Fmir%2Fblock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f32cccc05e8c47ed799a99d06dbfb1571fa6908c/src%2Flibrustc_codegen_ssa%2Fmir%2Fblock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_ssa%2Fmir%2Fblock.rs?ref=f32cccc05e8c47ed799a99d06dbfb1571fa6908c", "patch": "@@ -449,7 +449,7 @@ impl<'a, 'tcx, Bx: BuilderMethods<'a, 'tcx>> FunctionCx<'a, 'tcx, Bx> {\n         destination: &Option<(mir::Place<'tcx>, mir::BasicBlock)>,\n         cleanup: Option<mir::BasicBlock>,\n     ) -> bool {\n-        // Emit a panic or a no-op for `panic_if_uninhabited`.\n+        // Emit a panic or a no-op for `assert_*` intrinsics.\n         // These are intrinsics that compile to panics so that we can get a message\n         // which mentions the offending type, even from a const context.\n         #[derive(Debug, PartialEq)]\n@@ -460,9 +460,9 @@ impl<'a, 'tcx, Bx: BuilderMethods<'a, 'tcx>> FunctionCx<'a, 'tcx, Bx> {\n         };\n         let panic_intrinsic = intrinsic.and_then(|i| match i {\n             // FIXME: Move to symbols instead of strings.\n-            \"panic_if_uninhabited\" => Some(PanicIntrinsic::IfUninhabited),\n-            \"panic_if_zero_invalid\" => Some(PanicIntrinsic::IfZeroInvalid),\n-            \"panic_if_any_invalid\" => Some(PanicIntrinsic::IfAnyInvalid),\n+            \"assert_inhabited\" => Some(PanicIntrinsic::IfUninhabited),\n+            \"assert_zero_valid\" => Some(PanicIntrinsic::IfZeroInvalid),\n+            \"assert_uninit_valid\" => Some(PanicIntrinsic::IfAnyInvalid),\n             _ => None,\n         });\n         if let Some(intrinsic) = panic_intrinsic {"}, {"sha": "dac67c2f5a27d6de650fffc1a9b7788ae3aac6cf", "filename": "src/librustc_typeck/check/intrinsic.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f32cccc05e8c47ed799a99d06dbfb1571fa6908c/src%2Flibrustc_typeck%2Fcheck%2Fintrinsic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f32cccc05e8c47ed799a99d06dbfb1571fa6908c/src%2Flibrustc_typeck%2Fcheck%2Fintrinsic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fintrinsic.rs?ref=f32cccc05e8c47ed799a99d06dbfb1571fa6908c", "patch": "@@ -147,7 +147,7 @@ pub fn check_intrinsic_type(tcx: TyCtxt<'_>, it: &hir::ForeignItem<'_>) {\n             ),\n             \"rustc_peek\" => (1, vec![param(0)], param(0)),\n             \"caller_location\" => (0, vec![], tcx.caller_location_ty()),\n-            \"panic_if_uninhabited\" | \"panic_if_zero_invalid\" | \"panic_if_any_invalid\" => {\n+            \"assert_inhabited\" | \"assert_zero_valid\" | \"assert_uninit_valid\" => {\n                 (1, Vec::new(), tcx.mk_unit())\n             }\n             \"init\" => (1, Vec::new(), param(0)),"}]}