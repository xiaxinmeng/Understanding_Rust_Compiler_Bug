{"sha": "c9825f7087adcd9a132d896853b562087e0421a9", "node_id": "C_kwDOAAsO6NoAKGM5ODI1ZjcwODdhZGNkOWExMzJkODk2ODUzYjU2MjA4N2UwNDIxYTk", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-12-31T23:22:06Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2022-12-31T23:22:06Z"}, "message": "Auto merge of #106336 - matthiaskrgr:rollup-4p6bgwf, r=matthiaskrgr\n\nRollup of 4 pull requests\n\nSuccessful merges:\n\n - #106280 (docs: add link to `Path::join` in `PathBuf::push`)\n - #106297 (rustdoc: merge scrape-help CSS)\n - #106328 (Add comment explaining what the GUI scrape-examples-fonts test is about)\n - #106334 (Fix tidy unittest.)\n\nFailed merges:\n\nr? `@ghost`\n`@rustbot` modify labels: rollup", "tree": {"sha": "947e4a678506afd4654519248348c11273f1f6c3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/947e4a678506afd4654519248348c11273f1f6c3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c9825f7087adcd9a132d896853b562087e0421a9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c9825f7087adcd9a132d896853b562087e0421a9", "html_url": "https://github.com/rust-lang/rust/commit/c9825f7087adcd9a132d896853b562087e0421a9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c9825f7087adcd9a132d896853b562087e0421a9/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "574b64a97f52162f965bc201e47f0af8279ca65d", "url": "https://api.github.com/repos/rust-lang/rust/commits/574b64a97f52162f965bc201e47f0af8279ca65d", "html_url": "https://github.com/rust-lang/rust/commit/574b64a97f52162f965bc201e47f0af8279ca65d"}, {"sha": "0b3c3c9b6491c5090ecf2ab45639f2cfd878ae35", "url": "https://api.github.com/repos/rust-lang/rust/commits/0b3c3c9b6491c5090ecf2ab45639f2cfd878ae35", "html_url": "https://github.com/rust-lang/rust/commit/0b3c3c9b6491c5090ecf2ab45639f2cfd878ae35"}], "stats": {"total": 61, "additions": 48, "deletions": 13}, "files": [{"sha": "ef8a14be73d18dd0b4af57c6835639efdb98d16f", "filename": "library/std/src/path.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/c9825f7087adcd9a132d896853b562087e0421a9/library%2Fstd%2Fsrc%2Fpath.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9825f7087adcd9a132d896853b562087e0421a9/library%2Fstd%2Fsrc%2Fpath.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fstd%2Fsrc%2Fpath.rs?ref=c9825f7087adcd9a132d896853b562087e0421a9", "patch": "@@ -1246,6 +1246,9 @@ impl PathBuf {\n     ///   and `path` is not empty, the new path is normalized: all references\n     ///   to `.` and `..` are removed.\n     ///\n+    /// Consider using [`Path::join`] if you need a new `PathBuf` instead of\n+    /// using this function on a cloned `PathBuf`.\n+    ///\n     /// # Examples\n     ///\n     /// Pushing a relative path extends the existing path:"}, {"sha": "b54bf43262198e558353410c81d9ae201aeb020f", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c9825f7087adcd9a132d896853b562087e0421a9/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9825f7087adcd9a132d896853b562087e0421a9/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=c9825f7087adcd9a132d896853b562087e0421a9", "patch": "@@ -662,6 +662,7 @@ impl<'a> Builder<'a> {\n                 crate::toolstate::ToolStateCheck,\n                 test::ExpandYamlAnchors,\n                 test::Tidy,\n+                test::TidySelfTest,\n                 test::Ui,\n                 test::RunPassValgrind,\n                 test::MirOpt,"}, {"sha": "ea906be7e3ac255f58fc0d1ddb780bc82b8edc60", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/rust-lang/rust/blob/c9825f7087adcd9a132d896853b562087e0421a9/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9825f7087adcd9a132d896853b562087e0421a9/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=c9825f7087adcd9a132d896853b562087e0421a9", "patch": "@@ -1143,6 +1143,40 @@ help: to skip test's attempt to check tidiness, pass `--exclude src/tools/tidy`\n     }\n }\n \n+/// Runs tidy's own tests.\n+#[derive(Debug, Copy, Clone, PartialEq, Eq, Hash)]\n+pub struct TidySelfTest;\n+\n+impl Step for TidySelfTest {\n+    type Output = ();\n+    const DEFAULT: bool = true;\n+    const ONLY_HOSTS: bool = true;\n+\n+    fn should_run(run: ShouldRun<'_>) -> ShouldRun<'_> {\n+        run.alias(\"tidyselftest\")\n+    }\n+\n+    fn make_run(run: RunConfig<'_>) {\n+        run.builder.ensure(TidySelfTest);\n+    }\n+\n+    fn run(self, builder: &Builder<'_>) {\n+        let bootstrap_host = builder.config.build;\n+        let compiler = builder.compiler(0, bootstrap_host);\n+        let cargo = tool::prepare_tool_cargo(\n+            builder,\n+            compiler,\n+            Mode::ToolBootstrap,\n+            bootstrap_host,\n+            \"test\",\n+            \"src/tools/tidy\",\n+            SourceType::InTree,\n+            &[],\n+        );\n+        try_run(builder, &mut cargo.into());\n+    }\n+}\n+\n #[derive(Debug, Copy, Clone, PartialEq, Eq, Hash)]\n pub struct ExpandYamlAnchors;\n "}, {"sha": "c340294fc7375304c83e0e5a5e15270a46e667d1", "filename": "src/ci/docker/host-x86_64/mingw-check-tidy/Dockerfile", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c9825f7087adcd9a132d896853b562087e0421a9/src%2Fci%2Fdocker%2Fhost-x86_64%2Fmingw-check-tidy%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/c9825f7087adcd9a132d896853b562087e0421a9/src%2Fci%2Fdocker%2Fhost-x86_64%2Fmingw-check-tidy%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fhost-x86_64%2Fmingw-check-tidy%2FDockerfile?ref=c9825f7087adcd9a132d896853b562087e0421a9", "patch": "@@ -33,4 +33,4 @@ COPY host-x86_64/mingw-check/validate-toolstate.sh /scripts/\n COPY host-x86_64/mingw-check/validate-error-codes.sh /scripts/\n \n ENV RUN_CHECK_WITH_PARALLEL_QUERIES 1\n-ENV SCRIPT python3 ../x.py test --stage 0 src/tools/tidy\n+ENV SCRIPT python3 ../x.py test --stage 0 src/tools/tidy tidyselftest"}, {"sha": "b5f1581321edc084bd2f7c08710037846a0d5e51", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 6, "deletions": 10, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/c9825f7087adcd9a132d896853b562087e0421a9/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/c9825f7087adcd9a132d896853b562087e0421a9/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=c9825f7087adcd9a132d896853b562087e0421a9", "patch": "@@ -1861,9 +1861,13 @@ in storage.js\n \tfont-size: 12px;\n \tposition: relative;\n \tbottom: 1px;\n-\tborder-width: 1px;\n-\tborder-style: solid;\n+\tborder: 1px solid var(--scrape-example-help-border-color);\n \tborder-radius: 50px;\n+\tcolor: var(--scrape-example-help-color);\n+}\n+.scraped-example-list .scrape-help:hover {\n+\tborder-color: var(--scrape-example-help-hover-border-color);\n+\tcolor: var(--scrape-example-help-hover-color);\n }\n \n .scraped-example {\n@@ -1955,14 +1959,6 @@ in storage.js\n .scraped-example .example-wrap .rust span.highlight.focus {\n \tbackground: var(--scrape-example-code-line-highlight-focus);\n }\n-.scraped-example-list .scrape-help {\n-\tborder-color: var(--scrape-example-help-border-color);\n-\tcolor: var(--scrape-example-help-color);\n-}\n-.scraped-example-list .scrape-help:hover {\n-\tborder-color: var(--scrape-example-help-hover-border-color);\n-\tcolor: var(--scrape-example-help-hover-color);\n-}\n \n .more-examples-toggle {\n \tmax-width: calc(100% + 25px);"}, {"sha": "142f337cb74e4d5780367a1801af87d50a9548cd", "filename": "src/test/rustdoc-gui/scrape-examples-fonts.goml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/c9825f7087adcd9a132d896853b562087e0421a9/src%2Ftest%2Frustdoc-gui%2Fscrape-examples-fonts.goml", "raw_url": "https://github.com/rust-lang/rust/raw/c9825f7087adcd9a132d896853b562087e0421a9/src%2Ftest%2Frustdoc-gui%2Fscrape-examples-fonts.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fscrape-examples-fonts.goml?ref=c9825f7087adcd9a132d896853b562087e0421a9", "patch": "@@ -1,3 +1,4 @@\n+// This test ensures that the correct font is used in scraped examples.\n goto: \"file://\" + |DOC_PATH| + \"/scrape_examples/fn.test_many.html\"\n \n store-value: (font, '\"Fira Sans\", Arial, NanumBarunGothic, sans-serif')"}, {"sha": "7701dce2df1731057bacc80f8d27f2f5eb31d08e", "filename": "src/tools/tidy/src/features/version/tests.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c9825f7087adcd9a132d896853b562087e0421a9/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures%2Fversion%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c9825f7087adcd9a132d896853b562087e0421a9/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures%2Fversion%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Ftidy%2Fsrc%2Ffeatures%2Fversion%2Ftests.rs?ref=c9825f7087adcd9a132d896853b562087e0421a9", "patch": "@@ -12,8 +12,8 @@ fn test_try_from_invalid_version() {\n \n #[test]\n fn test_try_from_single() {\n-    assert_eq!(\"1.32.0\".parse(), Ok(Version { parts: [1, 32, 0] }));\n-    assert_eq!(\"1.0.0\".parse(), Ok(Version { parts: [1, 0, 0] }));\n+    assert_eq!(\"1.32.0\".parse(), Ok(Version::Explicit { parts: [1, 32, 0] }));\n+    assert_eq!(\"1.0.0\".parse(), Ok(Version::Explicit { parts: [1, 0, 0] }));\n }\n \n #[test]"}]}