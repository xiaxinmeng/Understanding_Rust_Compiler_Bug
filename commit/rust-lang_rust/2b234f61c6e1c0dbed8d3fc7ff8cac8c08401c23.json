{"sha": "2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23", "node_id": "MDY6Q29tbWl0NzI0NzEyOjJiMjM0ZjYxYzZlMWMwZGJlZDhkM2ZjN2ZmOGNhYzhjMDg0MDFjMjM=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-01-13T03:00:03Z"}, "committer": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-01-13T03:00:03Z"}, "message": "const stabilize .", "tree": {"sha": "29cfd0b56d63e2048f4f51601bcf3b8399bd128b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/29cfd0b56d63e2048f4f51601bcf3b8399bd128b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23", "html_url": "https://github.com/rust-lang/rust/commit/2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "75a369c5b11459baa6bf7734eeb6135998a0a7de", "url": "https://api.github.com/repos/rust-lang/rust/commits/75a369c5b11459baa6bf7734eeb6135998a0a7de", "html_url": "https://github.com/rust-lang/rust/commit/75a369c5b11459baa6bf7734eeb6135998a0a7de"}], "stats": {"total": 72, "additions": 48, "deletions": 24}, "files": [{"sha": "8879112fcf0b96bff209558af0c6dcbef975b7a5", "filename": "src/libcore/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23/src%2Flibcore%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23/src%2Flibcore%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Flib.rs?ref=2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23", "patch": "@@ -114,6 +114,7 @@\n #![feature(const_slice_len)]\n #![feature(const_str_as_bytes)]\n #![feature(const_str_len)]\n+#![cfg_attr(stage0, feature(const_let))]\n #![cfg_attr(stage0, feature(const_int_rotate))]\n #![feature(const_int_conversion)]\n #![feature(const_transmute)]"}, {"sha": "aaf944df66855cf34ac5ef3c85d43b8dc5061e4b", "filename": "src/libcore/num/bignum.rs", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23/src%2Flibcore%2Fnum%2Fbignum.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23/src%2Flibcore%2Fnum%2Fbignum.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fnum%2Fbignum.rs?ref=2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23", "patch": "@@ -46,6 +46,7 @@ macro_rules! impl_full_ops {\n     ($($ty:ty: add($addfn:path), mul/div($bigty:ident);)*) => (\n         $(\n             impl FullOps for $ty {\n+                #[cfg(stage0)]\n                 fn full_add(self, other: $ty, carry: bool) -> (bool, $ty) {\n                     // this cannot overflow, the output is between 0 and 2*2^nbits - 1\n                     // FIXME will LLVM optimize this into ADC or similar???\n@@ -55,6 +56,14 @@ macro_rules! impl_full_ops {\n                     };\n                     (carry1 || carry2, v)\n                 }\n+                #[cfg(not(stage0))]\n+                fn full_add(self, other: $ty, carry: bool) -> (bool, $ty) {\n+                    // this cannot overflow, the output is between 0 and 2*2^nbits - 1\n+                    // FIXME will LLVM optimize this into ADC or similar???\n+                    let (v, carry1) = intrinsics::add_with_overflow(self, other);\n+                    let (v, carry2) = intrinsics::add_with_overflow(v, if carry {1} else {0});\n+                    (carry1 || carry2, v)\n+                }\n \n                 fn full_mul(self, other: $ty, carry: $ty) -> ($ty, $ty) {\n                     // this cannot overflow, the output is between 0 and 2^nbits * (2^nbits - 1)"}, {"sha": "6827364c0f805d34f153596b93d8cefe9cefe5f3", "filename": "src/libcore/num/mod.rs", "status": "modified", "additions": 34, "deletions": 22, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23/src%2Flibcore%2Fnum%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23/src%2Flibcore%2Fnum%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fnum%2Fmod.rs?ref=2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23", "patch": "@@ -1340,13 +1340,15 @@ assert_eq!(\", stringify!($SelfT), \"::MAX.overflowing_add(1), (\", stringify!($Sel\n \"::MIN, true));\", $EndFeature, \"\n ```\"),\n             #[stable(feature = \"wrapping\", since = \"1.7.0\")]\n-            #[rustc_const_unstable(feature = \"const_int_overflowing\")]\n+            #[cfg_attr(stage0, rustc_const_unstable(feature = \"const_int_overflowing\"))]\n             #[inline]\n             pub const fn overflowing_add(self, rhs: Self) -> (Self, bool) {\n+                #[cfg(stage0)]\n                 let (a, b) = unsafe {\n-                    intrinsics::add_with_overflow(self as $ActualT,\n-                                                  rhs as $ActualT)\n+                    intrinsics::add_with_overflow(self as $ActualT, rhs as $ActualT)\n                 };\n+                #[cfg(not(stage0))]\n+                let (a, b) = intrinsics::add_with_overflow(self as $ActualT, rhs as $ActualT);\n                 (a as Self, b)\n             }\n         }\n@@ -1369,13 +1371,15 @@ assert_eq!(\", stringify!($SelfT), \"::MIN.overflowing_sub(1), (\", stringify!($Sel\n \"::MAX, true));\", $EndFeature, \"\n ```\"),\n             #[stable(feature = \"wrapping\", since = \"1.7.0\")]\n-            #[rustc_const_unstable(feature = \"const_int_overflowing\")]\n+            #[cfg_attr(stage0, rustc_const_unstable(feature = \"const_int_overflowing\"))]\n             #[inline]\n             pub const fn overflowing_sub(self, rhs: Self) -> (Self, bool) {\n+                #[cfg(stage0)]\n                 let (a, b) = unsafe {\n-                    intrinsics::sub_with_overflow(self as $ActualT,\n-                                                  rhs as $ActualT)\n+                    intrinsics::sub_with_overflow(self as $ActualT, rhs as $ActualT)\n                 };\n+                #[cfg(not(stage0))]\n+                let (a, b) = intrinsics::sub_with_overflow(self as $ActualT, rhs as $ActualT);\n                 (a as Self, b)\n             }\n         }\n@@ -1396,13 +1400,15 @@ assert_eq!(1_000_000_000i32.overflowing_mul(10), (1410065408, true));\",\n $EndFeature, \"\n ```\"),\n             #[stable(feature = \"wrapping\", since = \"1.7.0\")]\n-            #[rustc_const_unstable(feature = \"const_int_overflowing\")]\n+            #[cfg_attr(stage0, rustc_const_unstable(feature = \"const_int_overflowing\"))]\n             #[inline]\n             pub const fn overflowing_mul(self, rhs: Self) -> (Self, bool) {\n+                #[cfg(stage0)]\n                 let (a, b) = unsafe {\n-                    intrinsics::mul_with_overflow(self as $ActualT,\n-                                                  rhs as $ActualT)\n+                    intrinsics::mul_with_overflow(self as $ActualT, rhs as $ActualT)\n                 };\n+                #[cfg(not(stage0))]\n+                let (a, b) = intrinsics::mul_with_overflow(self as $ActualT, rhs as $ActualT);\n                 (a as Self, b)\n             }\n         }\n@@ -1585,7 +1591,7 @@ assert_eq!(0x1i32.overflowing_shl(36), (0x10, true));\",\n $EndFeature, \"\n ```\"),\n             #[stable(feature = \"wrapping\", since = \"1.7.0\")]\n-            #[rustc_const_unstable(feature = \"const_int_overflowing\")]\n+            #[cfg_attr(stage0, rustc_const_unstable(feature = \"const_int_overflowing\"))]\n             #[inline]\n             pub const fn overflowing_shl(self, rhs: u32) -> (Self, bool) {\n                 (self.wrapping_shl(rhs), (rhs > ($BITS - 1)))\n@@ -1609,7 +1615,7 @@ assert_eq!(0x10i32.overflowing_shr(36), (0x1, true));\",\n $EndFeature, \"\n ```\"),\n             #[stable(feature = \"wrapping\", since = \"1.7.0\")]\n-            #[rustc_const_unstable(feature = \"const_int_overflowing\")]\n+            #[cfg_attr(stage0, rustc_const_unstable(feature = \"const_int_overflowing\"))]\n             #[inline]\n             pub const fn overflowing_shr(self, rhs: u32) -> (Self, bool) {\n                 (self.wrapping_shr(rhs), (rhs > ($BITS - 1)))\n@@ -3213,13 +3219,15 @@ assert_eq!(5\", stringify!($SelfT), \".overflowing_add(2), (7, false));\n assert_eq!(\", stringify!($SelfT), \"::MAX.overflowing_add(1), (0, true));\", $EndFeature, \"\n ```\"),\n             #[stable(feature = \"wrapping\", since = \"1.7.0\")]\n-            #[rustc_const_unstable(feature = \"const_int_overflowing\")]\n+            #[cfg_attr(stage0, rustc_const_unstable(feature = \"const_int_overflowing\"))]\n             #[inline]\n             pub const fn overflowing_add(self, rhs: Self) -> (Self, bool) {\n+                #[cfg(stage0)]\n                 let (a, b) = unsafe {\n-                    intrinsics::add_with_overflow(self as $ActualT,\n-                                                  rhs as $ActualT)\n+                    intrinsics::add_with_overflow(self as $ActualT, rhs as $ActualT)\n                 };\n+                #[cfg(not(stage0))]\n+                let (a, b) = intrinsics::add_with_overflow(self as $ActualT, rhs as $ActualT);\n                 (a as Self, b)\n             }\n         }\n@@ -3243,13 +3251,15 @@ assert_eq!(0\", stringify!($SelfT), \".overflowing_sub(1), (\", stringify!($SelfT),\n $EndFeature, \"\n ```\"),\n             #[stable(feature = \"wrapping\", since = \"1.7.0\")]\n-            #[rustc_const_unstable(feature = \"const_int_overflowing\")]\n+            #[cfg_attr(stage0, rustc_const_unstable(feature = \"const_int_overflowing\"))]\n             #[inline]\n             pub const fn overflowing_sub(self, rhs: Self) -> (Self, bool) {\n+                #[cfg(stage0)]\n                 let (a, b) = unsafe {\n-                    intrinsics::sub_with_overflow(self as $ActualT,\n-                                                  rhs as $ActualT)\n+                    intrinsics::sub_with_overflow(self as $ActualT, rhs as $ActualT)\n                 };\n+                #[cfg(not(stage0))]\n+                let (a, b) = intrinsics::sub_with_overflow(self as $ActualT, rhs as $ActualT);\n                 (a as Self, b)\n             }\n         }\n@@ -3272,13 +3282,15 @@ $EndFeature, \"\n         /// assert_eq!(1_000_000_000u32.overflowing_mul(10), (1410065408, true));\n         /// ```\n         #[stable(feature = \"wrapping\", since = \"1.7.0\")]\n-        #[rustc_const_unstable(feature = \"const_int_overflowing\")]\n+        #[cfg_attr(stage0, rustc_const_unstable(feature = \"const_int_overflowing\"))]\n         #[inline]\n         pub const fn overflowing_mul(self, rhs: Self) -> (Self, bool) {\n+            #[cfg(stage0)]\n             let (a, b) = unsafe {\n-                intrinsics::mul_with_overflow(self as $ActualT,\n-                                              rhs as $ActualT)\n+                intrinsics::mul_with_overflow(self as $ActualT, rhs as $ActualT)\n             };\n+            #[cfg(not(stage0))]\n+            let (a, b) = intrinsics::mul_with_overflow(self as $ActualT, rhs as $ActualT);\n             (a as Self, b)\n         }\n \n@@ -3436,7 +3448,7 @@ Basic usage\n assert_eq!(0x1\", stringify!($SelfT), \".overflowing_shl(132), (0x10, true));\", $EndFeature, \"\n ```\"),\n             #[stable(feature = \"wrapping\", since = \"1.7.0\")]\n-            #[rustc_const_unstable(feature = \"const_int_overflowing\")]\n+            #[cfg_attr(stage0, rustc_const_unstable(feature = \"const_int_overflowing\"))]\n             #[inline]\n             pub const fn overflowing_shl(self, rhs: u32) -> (Self, bool) {\n                 (self.wrapping_shl(rhs), (rhs > ($BITS - 1)))\n@@ -3461,7 +3473,7 @@ Basic usage\n assert_eq!(0x10\", stringify!($SelfT), \".overflowing_shr(132), (0x1, true));\", $EndFeature, \"\n ```\"),\n             #[stable(feature = \"wrapping\", since = \"1.7.0\")]\n-            #[rustc_const_unstable(feature = \"const_int_overflowing\")]\n+            #[cfg_attr(stage0, rustc_const_unstable(feature = \"const_int_overflowing\"))]\n             #[inline]\n             pub const fn overflowing_shr(self, rhs: u32) -> (Self, bool) {\n                 (self.wrapping_shr(rhs), (rhs > ($BITS - 1)))"}, {"sha": "059b88a4d702ae923cff4541b5ba0aa5c5b4a703", "filename": "src/librustc_mir/transform/qualify_min_const_fn.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23/src%2Flibrustc_mir%2Ftransform%2Fqualify_min_const_fn.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23/src%2Flibrustc_mir%2Ftransform%2Fqualify_min_const_fn.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fqualify_min_const_fn.rs?ref=2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23", "patch": "@@ -374,6 +374,9 @@ fn is_intrinsic_whitelisted(tcx: TyCtxt<'a, 'tcx, 'tcx>, def_id: DefId) -> bool\n         | \"min_align_of\"\n         | \"needs_drop\"\n         // Arithmetic:\n+        | \"add_with_overflow\" // ~> .overflowing_add\n+        | \"sub_with_overflow\" // ~> .overflowing_sub\n+        | \"mul_with_overflow\" // ~> .overflowing_mul\n         | \"overflowing_add\" // ~> .wrapping_add\n         | \"overflowing_sub\" // ~> .wrapping_sub\n         | \"overflowing_mul\" // ~> .wrapping_mul"}, {"sha": "9f323b9116d6fd7cc3723a6828fe62f556e98b2b", "filename": "src/librustc_typeck/check/intrinsic.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23/src%2Flibrustc_typeck%2Fcheck%2Fintrinsic.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23/src%2Flibrustc_typeck%2Fcheck%2Fintrinsic.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_typeck%2Fcheck%2Fintrinsic.rs?ref=2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23", "patch": "@@ -70,6 +70,7 @@ fn equate_intrinsic_type<'a, 'tcx>(\n pub fn intrisic_operation_unsafety(intrinsic: &str) -> hir::Unsafety {\n     match intrinsic {\n         \"size_of\" | \"min_align_of\" | \"needs_drop\" |\n+        \"add_with_overflow\" | \"sub_with_overflow\" | \"mul_with_overflow\" |\n         \"overflowing_add\" | \"overflowing_sub\" | \"overflowing_mul\" |\n         \"rotate_left\" | \"rotate_right\" |\n         \"ctpop\" | \"ctlz\" | \"cttz\" | \"bswap\" | \"bitreverse\""}, {"sha": "289b1236cf1e214149afed505a62170ab7aea49a", "filename": "src/test/run-pass/const-int-overflowing.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23/src%2Ftest%2Frun-pass%2Fconst-int-overflowing.rs", "raw_url": "https://github.com/rust-lang/rust/raw/2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23/src%2Ftest%2Frun-pass%2Fconst-int-overflowing.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fconst-int-overflowing.rs?ref=2b234f61c6e1c0dbed8d3fc7ff8cac8c08401c23", "patch": "@@ -1,5 +1,3 @@\n-#![feature(const_int_overflowing)]\n-\n const ADD_A: (u32, bool) = 5u32.overflowing_add(2);\n const ADD_B: (u32, bool) = u32::max_value().overflowing_add(1);\n "}]}