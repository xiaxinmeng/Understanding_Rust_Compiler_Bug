{"sha": "f17d972014625eae13ac6d7fe98ff82a110a14d3", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYxN2Q5NzIwMTQ2MjVlYWUxM2FjNmQ3ZmU5OGZmODJhMTEwYTE0ZDM=", "commit": {"author": {"name": "xales", "email": "xales@naveria.com", "date": "2014-01-29T02:05:57Z"}, "committer": {"name": "xales", "email": "xales@naveria.com", "date": "2014-01-30T01:31:03Z"}, "message": "Remove seldom-used std::reference functions.", "tree": {"sha": "a540265f6339b1b9197bbb44f940ac37ca88ac7e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a540265f6339b1b9197bbb44f940ac37ca88ac7e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f17d972014625eae13ac6d7fe98ff82a110a14d3", "comment_count": 9, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f17d972014625eae13ac6d7fe98ff82a110a14d3", "html_url": "https://github.com/rust-lang/rust/commit/f17d972014625eae13ac6d7fe98ff82a110a14d3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f17d972014625eae13ac6d7fe98ff82a110a14d3/comments", "author": {"login": "xales", "id": 341605, "node_id": "MDQ6VXNlcjM0MTYwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/341605?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xales", "html_url": "https://github.com/xales", "followers_url": "https://api.github.com/users/xales/followers", "following_url": "https://api.github.com/users/xales/following{/other_user}", "gists_url": "https://api.github.com/users/xales/gists{/gist_id}", "starred_url": "https://api.github.com/users/xales/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xales/subscriptions", "organizations_url": "https://api.github.com/users/xales/orgs", "repos_url": "https://api.github.com/users/xales/repos", "events_url": "https://api.github.com/users/xales/events{/privacy}", "received_events_url": "https://api.github.com/users/xales/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xales", "id": 341605, "node_id": "MDQ6VXNlcjM0MTYwNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/341605?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xales", "html_url": "https://github.com/xales", "followers_url": "https://api.github.com/users/xales/followers", "following_url": "https://api.github.com/users/xales/following{/other_user}", "gists_url": "https://api.github.com/users/xales/gists{/gist_id}", "starred_url": "https://api.github.com/users/xales/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xales/subscriptions", "organizations_url": "https://api.github.com/users/xales/orgs", "repos_url": "https://api.github.com/users/xales/repos", "events_url": "https://api.github.com/users/xales/events{/privacy}", "received_events_url": "https://api.github.com/users/xales/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d547f7ac216966240d90dd9b24fe2797dbec09e2", "url": "https://api.github.com/repos/rust-lang/rust/commits/d547f7ac216966240d90dd9b24fe2797dbec09e2", "html_url": "https://github.com/rust-lang/rust/commit/d547f7ac216966240d90dd9b24fe2797dbec09e2"}], "stats": {"total": 47, "additions": 8, "deletions": 39}, "files": [{"sha": "7075007c546a1a09b77dd21dd946fab844d65bc5", "filename": "src/libextra/arc.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f17d972014625eae13ac6d7fe98ff82a110a14d3/src%2Flibextra%2Farc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f17d972014625eae13ac6d7fe98ff82a110a14d3/src%2Flibextra%2Farc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibextra%2Farc.rs?ref=f17d972014625eae13ac6d7fe98ff82a110a14d3", "patch": "@@ -1,4 +1,4 @@\n-// Copyright 2012-2013 The Rust Project Developers. See the COPYRIGHT\n+// Copyright 2012-2014 The Rust Project Developers. See the COPYRIGHT\n // file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //\n@@ -47,7 +47,6 @@ use sync::{Mutex, RWLock};\n use std::cast;\n use std::sync::arc::UnsafeArc;\n use std::task;\n-use std::reference;\n \n /// As sync::condvar, a mechanism for unlock-and-descheduling and signaling.\n pub struct Condvar<'a> {\n@@ -465,7 +464,7 @@ impl<T:Freeze + Send> RWArc<T> {\n             // of this cast is removing the mutability.)\n             let new_data = data;\n             // Downgrade ensured the token belonged to us. Just a sanity check.\n-            assert!(reference::ref_eq(&(*state).data, new_data));\n+            assert!((&(*state).data as *T as uint) == (new_data as *mut T as uint));\n             // Produce new token\n             RWReadMode {\n                 data: new_data,"}, {"sha": "ca1574e17606357cf9c9b0c434f9ce484535865b", "filename": "src/libextra/sync.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/f17d972014625eae13ac6d7fe98ff82a110a14d3/src%2Flibextra%2Fsync.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f17d972014625eae13ac6d7fe98ff82a110a14d3/src%2Flibextra%2Fsync.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibextra%2Fsync.rs?ref=f17d972014625eae13ac6d7fe98ff82a110a14d3", "patch": "@@ -1,4 +1,4 @@\n-// Copyright 2012-2013 The Rust Project Developers. See the COPYRIGHT\n+// Copyright 2012-2014 The Rust Project Developers. See the COPYRIGHT\n // file at the top-level directory of this distribution and at\n // http://rust-lang.org/COPYRIGHT.\n //\n@@ -18,7 +18,6 @@\n  */\n \n \n-use std::reference;\n use std::comm;\n use std::unstable::sync::Exclusive;\n use std::sync::arc::UnsafeArc;\n@@ -634,7 +633,7 @@ impl RWLock {\n     /// To be called inside of the write_downgrade block.\n     pub fn downgrade<'a>(&self, token: RWLockWriteMode<'a>)\n                          -> RWLockReadMode<'a> {\n-        if !reference::ref_eq(self, token.lock) {\n+        if !((self as *RWLock) == (token.lock as *RWLock)) {\n             fail!(\"Can't downgrade() with a different rwlock's write_mode!\");\n         }\n         unsafe {"}, {"sha": "d7a7011319ae9afbd9f4d044b8f771dde7c73b1c", "filename": "src/libstd/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/f17d972014625eae13ac6d7fe98ff82a110a14d3/src%2Flibstd%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f17d972014625eae13ac6d7fe98ff82a110a14d3/src%2Flibstd%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Flib.rs?ref=f17d972014625eae13ac6d7fe98ff82a110a14d3", "patch": "@@ -123,7 +123,7 @@ pub mod send_str;\n pub mod ptr;\n pub mod owned;\n pub mod managed;\n-pub mod reference;\n+mod reference;\n pub mod rc;\n pub mod gc;\n "}, {"sha": "91f03f02892e35a6c06f5d4f2296b514c2b60f5e", "filename": "src/libstd/reference.rs", "status": "modified", "additions": 0, "deletions": 25, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/f17d972014625eae13ac6d7fe98ff82a110a14d3/src%2Flibstd%2Freference.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f17d972014625eae13ac6d7fe98ff82a110a14d3/src%2Flibstd%2Freference.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Freference.rs?ref=f17d972014625eae13ac6d7fe98ff82a110a14d3", "patch": "@@ -13,18 +13,6 @@\n #[cfg(not(test))]\n use prelude::*;\n \n-/// Cast a region pointer - &T - to a uint.\n-#[inline]\n-pub fn to_uint<T>(thing: &T) -> uint {\n-    thing as *T as uint\n-}\n-\n-/// Determine if two borrowed pointers point to the same thing.\n-#[inline]\n-pub fn ref_eq<'a, 'b, T>(thing: &'a T, other: &'b T) -> bool {\n-    (thing as *T) == (other as *T)\n-}\n-\n // Equality for region pointers\n #[cfg(not(test))]\n impl<'a, T: Eq> Eq for &'a T {\n@@ -71,16 +59,3 @@ impl<'a, T: TotalEq> TotalEq for &'a T {\n     fn equals(&self, other: & &'a T) -> bool { (**self).equals(*other) }\n }\n \n-#[cfg(test)]\n-mod tests {\n-    use super::ref_eq;\n-\n-    #[test]\n-    fn test_ref_eq() {\n-        let x = 1;\n-        let y = 1;\n-\n-        assert!(ref_eq(&x, &x));\n-        assert!(!ref_eq(&x, &y));\n-    }\n-}"}, {"sha": "7c43e64f17b15b6e6ed39cad779d0fe3c5a65944", "filename": "src/libstd/rt/task.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f17d972014625eae13ac6d7fe98ff82a110a14d3/src%2Flibstd%2Frt%2Ftask.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f17d972014625eae13ac6d7fe98ff82a110a14d3/src%2Flibstd%2Frt%2Ftask.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Frt%2Ftask.rs?ref=f17d972014625eae13ac6d7fe98ff82a110a14d3", "patch": "@@ -14,7 +14,6 @@\n //! to implement this.\n \n use any::AnyOwnExt;\n-use reference;\n use cast;\n use cleanup;\n use clone::Clone;\n@@ -287,7 +286,7 @@ impl Task {\n \n impl Drop for Task {\n     fn drop(&mut self) {\n-        rtdebug!(\"called drop for a task: {}\", reference::to_uint(self));\n+        rtdebug!(\"called drop for a task: {}\", self as *mut Task as uint);\n         rtassert!(self.destroyed);\n     }\n }"}, {"sha": "fe1be6d06db83cce39d251bba32657a582da970c", "filename": "src/test/run-pass/borrowck-borrow-from-expr-block.rs", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/f17d972014625eae13ac6d7fe98ff82a110a14d3/src%2Ftest%2Frun-pass%2Fborrowck-borrow-from-expr-block.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f17d972014625eae13ac6d7fe98ff82a110a14d3/src%2Ftest%2Frun-pass%2Fborrowck-borrow-from-expr-block.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fborrowck-borrow-from-expr-block.rs?ref=f17d972014625eae13ac6d7fe98ff82a110a14d3", "patch": "@@ -10,7 +10,6 @@\n \n #[feature(managed_boxes)];\n \n-use std::reference;\n use std::ptr;\n \n fn borrow(x: &int, f: |x: &int|) {\n@@ -20,7 +19,7 @@ fn borrow(x: &int, f: |x: &int|) {\n fn test1(x: @~int) {\n     borrow(&*(*x).clone(), |p| {\n         let x_a = ptr::to_unsafe_ptr(&**x);\n-        assert!((x_a as uint) != reference::to_uint(p));\n+        assert!((x_a as uint) != (p as *int as uint));\n         assert_eq!(unsafe{*x_a}, *p);\n     })\n }"}, {"sha": "a831cd1da69d52d3f04d01b14291e2e5d027f3cd", "filename": "src/test/run-pass/cast-region-to-uint.rs", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f17d972014625eae13ac6d7fe98ff82a110a14d3/src%2Ftest%2Frun-pass%2Fcast-region-to-uint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f17d972014625eae13ac6d7fe98ff82a110a14d3/src%2Ftest%2Frun-pass%2Fcast-region-to-uint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fcast-region-to-uint.rs?ref=f17d972014625eae13ac6d7fe98ff82a110a14d3", "patch": "@@ -8,9 +8,7 @@\n // option. This file may not be copied, modified, or distributed\n // except according to those terms.\n \n-use std::reference;\n-\n pub fn main() {\n     let x = 3;\n-    info!(\"&x={:x}\", reference::to_uint(&x));\n+    info!(\"&x={:x}\", (&x as *int as uint));\n }"}]}