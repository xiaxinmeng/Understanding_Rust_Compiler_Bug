{"sha": "e4eceba7d35817494623429a8c43c47cb885c0c2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU0ZWNlYmE3ZDM1ODE3NDk0NjIzNDI5YThjNDNjNDdjYjg4NWMwYzI=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-04-15T11:34:34Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-04-15T11:34:34Z"}, "message": "Auto merge of #1336 - RalfJung:instance-sanity, r=RalfJung\n\ntighten Instance sanity check\n\nLet's see if we can get away with this...", "tree": {"sha": "cbbc55c45b8b6962db9f2952f85bdc1b5cac5990", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cbbc55c45b8b6962db9f2952f85bdc1b5cac5990"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e4eceba7d35817494623429a8c43c47cb885c0c2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e4eceba7d35817494623429a8c43c47cb885c0c2", "html_url": "https://github.com/rust-lang/rust/commit/e4eceba7d35817494623429a8c43c47cb885c0c2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e4eceba7d35817494623429a8c43c47cb885c0c2/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fbea3e57f34c7d30f6c18b435a37db70df49fc9e", "url": "https://api.github.com/repos/rust-lang/rust/commits/fbea3e57f34c7d30f6c18b435a37db70df49fc9e", "html_url": "https://github.com/rust-lang/rust/commit/fbea3e57f34c7d30f6c18b435a37db70df49fc9e"}, {"sha": "a85dab42ea2f5704260232112d240b1ee51017be", "url": "https://api.github.com/repos/rust-lang/rust/commits/a85dab42ea2f5704260232112d240b1ee51017be", "html_url": "https://github.com/rust-lang/rust/commit/a85dab42ea2f5704260232112d240b1ee51017be"}], "stats": {"total": 24, "additions": 15, "deletions": 9}, "files": [{"sha": "d430062a153336a2f87ea2380c5a10d5ffdbe74f", "filename": "tests/run-pass/time.rs", "status": "modified", "additions": 15, "deletions": 9, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/e4eceba7d35817494623429a8c43c47cb885c0c2/tests%2Frun-pass%2Ftime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e4eceba7d35817494623429a8c43c47cb885c0c2/tests%2Frun-pass%2Ftime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Ftime.rs?ref=e4eceba7d35817494623429a8c43c47cb885c0c2", "patch": "@@ -1,33 +1,39 @@\n // compile-flags: -Zmiri-disable-isolation\n \n-use std::time::{SystemTime, Instant};\n+use std::time::{SystemTime, Instant, Duration};\n+\n+fn duration_sanity(diff: Duration) {\n+    // On my laptop, I observed times around 15-40ms. Add 10x lee-way both ways.\n+    assert!(diff.as_millis() > 1);\n+    assert!(diff.as_millis() < 500);\n+}\n \n fn main() {\n     // Check `SystemTime`.\n     let now1 = SystemTime::now();\n+    let seconds_since_epoch = now1.duration_since(SystemTime::UNIX_EPOCH).unwrap().as_secs();\n+    let years_since_epoch = seconds_since_epoch / 3600 / 24 / 365;\n+    let year = 1970 + years_since_epoch;\n+    assert!(2020 <= year && year < 2100);\n     // Do some work to make time pass.\n     for _ in 0..10 { drop(vec![42]); }\n     let now2 = SystemTime::now();\n     assert!(now2 > now1);\n+    // Sanity-check the difference we got.\n     let diff = now2.duration_since(now1).unwrap();\n     assert_eq!(now1 + diff, now2);\n     assert_eq!(now2 - diff, now1);\n-    // Sanity-check the time we got.\n-    let seconds_since_epoch = now1.duration_since(SystemTime::UNIX_EPOCH).unwrap().as_secs();\n-    let years_since_epoch = seconds_since_epoch / 3600 / 24 / 365;\n-    let year = 1970 + years_since_epoch;\n-    assert!(2020 <= year && year < 2100);\n+    duration_sanity(diff);\n \n     // Check `Instant`.\n     let now1 = Instant::now();\n     // Do some work to make time pass.\n     for _ in 0..10 { drop(vec![42]); }\n     let now2 = Instant::now();\n     assert!(now2 > now1);\n+    // Sanity-check the difference we got.\n     let diff = now2.duration_since(now1);\n     assert_eq!(now1 + diff, now2);\n     assert_eq!(now2 - diff, now1);\n-    // Sanity-check the difference we got.\n-    assert!(diff.as_micros() > 1);\n-    assert!(diff.as_micros() < 1_000_000);\n+    duration_sanity(diff);\n }"}]}