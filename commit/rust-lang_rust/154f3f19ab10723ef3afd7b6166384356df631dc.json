{"sha": "154f3f19ab10723ef3afd7b6166384356df631dc", "node_id": "MDY6Q29tbWl0NzI0NzEyOjE1NGYzZjE5YWIxMDcyM2VmM2FmZDdiNjE2NjM4NDM1NmRmNjMxZGM=", "commit": {"author": {"name": "Oliver Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2020-02-12T12:47:00Z"}, "committer": {"name": "Oliver Scherer", "email": "github35764891676564198441@oli-obk.de", "date": "2020-03-11T08:10:49Z"}, "message": "Don't print all zsts as their type as it makes no sense for more complex examples (e.g. structs)", "tree": {"sha": "73bec1faa177e4df1822419809f8961c1c110eb0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/73bec1faa177e4df1822419809f8961c1c110eb0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/154f3f19ab10723ef3afd7b6166384356df631dc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/154f3f19ab10723ef3afd7b6166384356df631dc", "html_url": "https://github.com/rust-lang/rust/commit/154f3f19ab10723ef3afd7b6166384356df631dc", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/154f3f19ab10723ef3afd7b6166384356df631dc/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1191eb45859041b467d4e0bd8accca3e164b1dad", "url": "https://api.github.com/repos/rust-lang/rust/commits/1191eb45859041b467d4e0bd8accca3e164b1dad", "html_url": "https://github.com/rust-lang/rust/commit/1191eb45859041b467d4e0bd8accca3e164b1dad"}], "stats": {"total": 29, "additions": 23, "deletions": 6}, "files": [{"sha": "d1aee1290c9b35b4ce7721285c43dd5081fa89d9", "filename": "src/librustc/ty/print/pretty.rs", "status": "modified", "additions": 20, "deletions": 3, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/154f3f19ab10723ef3afd7b6166384356df631dc/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/154f3f19ab10723ef3afd7b6166384356df631dc/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Fprint%2Fpretty.rs?ref=154f3f19ab10723ef3afd7b6166384356df631dc", "patch": "@@ -999,12 +999,29 @@ pub trait PrettyPrinter<'tcx>:\n                 };\n                 p!(print_value_path(instance.def_id(), instance.substs));\n             }\n-            // For zsts just print their type as their value gives no extra information\n-            (Scalar::Raw { size: 0, .. }, _) => p!(print(ty)),\n+            // For function type zsts just printing the type is enough\n+            (Scalar::Raw { size: 0, .. }, ty::FnDef(..)) => p!(print(ty)),\n+            // Empty tuples are frequently occurring, so don't print the fallback.\n+            (Scalar::Raw { size: 0, .. }, ty::Tuple(ts)) if ts.is_empty() => p!(write(\"()\")),\n+            // Zero element arrays have a trivial representation.\n+            (\n+                Scalar::Raw { size: 0, .. },\n+                ty::Array(\n+                    _,\n+                    ty::Const {\n+                        val: ty::ConstKind::Value(ConstValue::Scalar(Scalar::Raw { data: 0, .. })),\n+                        ..\n+                    },\n+                ),\n+            ) => p!(write(\"[]\")),\n             // Nontrivial types with scalar bit representation\n             (Scalar::Raw { data, size }, _) => {\n                 let print = |mut this: Self| {\n-                    write!(this, \"transmute(0x{:01$x})\", data, size as usize * 2)?;\n+                    if size == 0 {\n+                        write!(this, \"transmute(())\")?;\n+                    } else {\n+                        write!(this, \"transmute(0x{:01$x})\", data, size as usize * 2)?;\n+                    }\n                     Ok(this)\n                 };\n                 self = if print_ty {"}, {"sha": "e427fd55ad6807a82d9e2cb342ad84e50eddd75b", "filename": "src/test/mir-opt/simplify-locals-removes-unused-consts.rs", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/154f3f19ab10723ef3afd7b6166384356df631dc/src%2Ftest%2Fmir-opt%2Fsimplify-locals-removes-unused-consts.rs", "raw_url": "https://github.com/rust-lang/rust/raw/154f3f19ab10723ef3afd7b6166384356df631dc/src%2Ftest%2Fmir-opt%2Fsimplify-locals-removes-unused-consts.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Fsimplify-locals-removes-unused-consts.rs?ref=154f3f19ab10723ef3afd7b6166384356df631dc", "patch": "@@ -38,7 +38,7 @@ fn main() {\n //   _2 = const ();\n //   StorageLive(_3);\n //   _3 = const ();\n-//   _1 = const ((), ());\n+//   _1 = const {transmute(()): ((), ())};\n //   StorageDead(_3);\n //   StorageDead(_2);\n //   StorageDead(_1);\n@@ -49,7 +49,7 @@ fn main() {\n //   _7 = const ();\n //   StorageDead(_7);\n //   StorageDead(_6);\n-//   _4 = const use_zst(const ((), ())) -> bb1;\n+//   _4 = const use_zst(const {transmute(()): ((), ())}) -> bb1;\n // }\n // bb1: {\n //   StorageDead(_4);\n@@ -75,7 +75,7 @@ fn main() {\n // }\n // bb0: {\n //   StorageLive(_1);\n-//   _1 = const use_zst(const ((), ())) -> bb1;\n+//   _1 = const use_zst(const {transmute(()): ((), ())}) -> bb1;\n // }\n // bb1: {\n //   StorageDead(_1);"}]}