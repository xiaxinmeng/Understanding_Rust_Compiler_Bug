{"sha": "dae331d921d94da76a4ef240463d8b83b77121fb", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRhZTMzMWQ5MjFkOTRkYTc2YTRlZjI0MDQ2M2Q4YjgzYjc3MTIxZmI=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-05-28T22:20:00Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-05-28T22:20:00Z"}, "message": "Rollup merge of #61195 - davidtwco:seg-fault-mangler, r=eddyb\n\nSpecial-case `.llvm` in mangler\n\nFixes #60925 and fixes #53912.\n\nr? @michaelwoerister\ncc @eddyb", "tree": {"sha": "c4b01098da67fd7281fb3cd53ad010b495c5e015", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c4b01098da67fd7281fb3cd53ad010b495c5e015"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dae331d921d94da76a4ef240463d8b83b77121fb", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJc7bQQCRBK7hj4Ov3rIwAAdHIIACk6H/3Kgt2MVONUuEBxSyH8\nrDQhfVdjyt6EHQCFq3SdFZBTGsdYCh/olxjQ/OXHlU7zwwgiWFBmLuE8oxTJH57K\nbzg8cVQn6yphFF98ky2QLn3bq0OJc1aLgrNLzljr5J2hG53Ba+GNLhstvJGpEWhH\nEUcwrxpQ187xg0rCddbUySOK2Kndrxxz9ydV2KOklTxxYvlhUVl9dEODaJgK20+h\nER6yPP7xXTI6+vLt5QhgaC4fxI87rdBiiK2fk6Nt3XkO3Z4S4PiRNWYpCrgiw1RT\nFUQ13upiDF0J5vQNQYXKXErFqkenochV6JYNyl1xlOODgzjU/RQSCmNWVXDJrXo=\n=ZO7a\n-----END PGP SIGNATURE-----\n", "payload": "tree c4b01098da67fd7281fb3cd53ad010b495c5e015\nparent 745af720bb9824b5a1810d1326a3c4bbc8eef1e5\nparent 9c34473ecf87a6f541b9f6404b782eaa484033d7\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1559082000 +0200\ncommitter GitHub <noreply@github.com> 1559082000 +0200\n\nRollup merge of #61195 - davidtwco:seg-fault-mangler, r=eddyb\n\nSpecial-case `.llvm` in mangler\n\nFixes #60925 and fixes #53912.\n\nr? @michaelwoerister\ncc @eddyb\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dae331d921d94da76a4ef240463d8b83b77121fb", "html_url": "https://github.com/rust-lang/rust/commit/dae331d921d94da76a4ef240463d8b83b77121fb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dae331d921d94da76a4ef240463d8b83b77121fb/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "745af720bb9824b5a1810d1326a3c4bbc8eef1e5", "url": "https://api.github.com/repos/rust-lang/rust/commits/745af720bb9824b5a1810d1326a3c4bbc8eef1e5", "html_url": "https://github.com/rust-lang/rust/commit/745af720bb9824b5a1810d1326a3c4bbc8eef1e5"}, {"sha": "9c34473ecf87a6f541b9f6404b782eaa484033d7", "url": "https://api.github.com/repos/rust-lang/rust/commits/9c34473ecf87a6f541b9f6404b782eaa484033d7", "html_url": "https://github.com/rust-lang/rust/commit/9c34473ecf87a6f541b9f6404b782eaa484033d7"}], "stats": {"total": 87, "additions": 87, "deletions": 0}, "files": [{"sha": "211d725e39d57a824ede97f95eb3cc4b97a9ffc3", "filename": "src/librustc_codegen_utils/symbol_names.rs", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/dae331d921d94da76a4ef240463d8b83b77121fb/src%2Flibrustc_codegen_utils%2Fsymbol_names.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dae331d921d94da76a4ef240463d8b83b77121fb/src%2Flibrustc_codegen_utils%2Fsymbol_names.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_utils%2Fsymbol_names.rs?ref=dae331d921d94da76a4ef240463d8b83b77121fb", "patch": "@@ -629,6 +629,9 @@ impl fmt::Write for SymbolPrinter<'_, '_> {\n                 // for ':' and '-'\n                 '-' | ':' => self.path.temp_buf.push('.'),\n \n+                // Avoid segmentation fault on some platforms, see #60925.\n+                'm' if self.path.temp_buf.ends_with(\".llv\") => self.path.temp_buf.push_str(\"$6d$\"),\n+\n                 // These are legal symbols\n                 'a'..='z' | 'A'..='Z' | '0'..='9' | '_' | '.' | '$' => self.path.temp_buf.push(c),\n "}, {"sha": "d2347c3077cf33a11bc191c161fdea8b4acbc939", "filename": "src/test/ui/issue-53912.rs", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/rust-lang/rust/blob/dae331d921d94da76a4ef240463d8b83b77121fb/src%2Ftest%2Fui%2Fissue-53912.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dae331d921d94da76a4ef240463d8b83b77121fb/src%2Ftest%2Fui%2Fissue-53912.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fissue-53912.rs?ref=dae331d921d94da76a4ef240463d8b83b77121fb", "patch": "@@ -0,0 +1,37 @@\n+// compile-pass\n+\n+// This test is the same code as in ui/symbol-names/issue-60925.rs but this checks that the\n+// reproduction compiles successfully and doesn't segfault, whereas that test just checks that the\n+// symbol mangling fix produces the correct result.\n+\n+fn dummy() {}\n+\n+mod llvm {\n+    pub(crate) struct Foo;\n+}\n+mod foo {\n+    pub(crate) struct Foo<T>(T);\n+\n+    impl Foo<::llvm::Foo> {\n+        pub(crate) fn foo() {\n+            for _ in 0..0 {\n+                for _ in &[::dummy()] {\n+                    ::dummy();\n+                    ::dummy();\n+                    ::dummy();\n+                }\n+            }\n+        }\n+    }\n+\n+    pub(crate) fn foo() {\n+        Foo::foo();\n+        Foo::foo();\n+    }\n+}\n+\n+pub fn foo() {\n+    foo::foo();\n+}\n+\n+fn main() {}"}, {"sha": "e9f763ad7cf67ca425d8c2911e5c7e5e803fa4b4", "filename": "src/test/ui/symbol-names/issue-60925.rs", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/rust-lang/rust/blob/dae331d921d94da76a4ef240463d8b83b77121fb/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dae331d921d94da76a4ef240463d8b83b77121fb/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.rs?ref=dae331d921d94da76a4ef240463d8b83b77121fb", "patch": "@@ -0,0 +1,39 @@\n+#![feature(rustc_attrs)]\n+\n+// This test is the same code as in ui/issue-53912.rs but this test checks that the symbol mangling\n+// fix produces the correct result, whereas that test just checks that the reproduction compiles\n+// successfully and doesn't segfault\n+\n+fn dummy() {}\n+\n+mod llvm {\n+    pub(crate) struct Foo;\n+}\n+mod foo {\n+    pub(crate) struct Foo<T>(T);\n+\n+    impl Foo<::llvm::Foo> {\n+        #[rustc_symbol_name]\n+//~^ ERROR _ZN11issue_609253foo36Foo$LT$issue_60925..llv$6d$..Foo$GT$3foo17h059a991a004536adE\n+        pub(crate) fn foo() {\n+            for _ in 0..0 {\n+                for _ in &[::dummy()] {\n+                    ::dummy();\n+                    ::dummy();\n+                    ::dummy();\n+                }\n+            }\n+        }\n+    }\n+\n+    pub(crate) fn foo() {\n+        Foo::foo();\n+        Foo::foo();\n+    }\n+}\n+\n+pub fn foo() {\n+    foo::foo();\n+}\n+\n+fn main() {}"}, {"sha": "84a18745e2ea7cce95fb722ed783603012bfb70d", "filename": "src/test/ui/symbol-names/issue-60925.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/dae331d921d94da76a4ef240463d8b83b77121fb/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/dae331d921d94da76a4ef240463d8b83b77121fb/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fsymbol-names%2Fissue-60925.stderr?ref=dae331d921d94da76a4ef240463d8b83b77121fb", "patch": "@@ -0,0 +1,8 @@\n+error: symbol-name(_ZN11issue_609253foo36Foo$LT$issue_60925..llv$6d$..Foo$GT$3foo17h059a991a004536adE)\n+  --> $DIR/issue-60925.rs:16:9\n+   |\n+LL |         #[rustc_symbol_name]\n+   |         ^^^^^^^^^^^^^^^^^^^^\n+\n+error: aborting due to previous error\n+"}]}