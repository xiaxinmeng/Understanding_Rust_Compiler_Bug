{"sha": "50754578f63e3d2b5fc1035303cbefb5db7d1fdf", "node_id": "C_kwDOAAsO6NoAKDUwNzU0NTc4ZjYzZTNkMmI1ZmMxMDM1MzAzY2JlZmI1ZGI3ZDFmZGY", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-05-04T06:09:06Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-05-04T06:09:06Z"}, "message": "Rollup merge of #111070 - WaffleLapkin:break_ribs, r=lcnr\n\nDon't suffix `RibKind` variants\n\nThis PR\n- Removes `use RibKind::*`\n- Renames `RibKind::{SomethingRibKind => Something}`\n\nIt seems unnecessary to have \"RibKind\" in the end of all variants, if we can just use it as a normal enum. Additionally previously it was weird that `MacroDefinition` is the only unsuffixed variant.", "tree": {"sha": "3fb3b941bae251b874a1771c54b08f6bfbf5cc5e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3fb3b941bae251b874a1771c54b08f6bfbf5cc5e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/50754578f63e3d2b5fc1035303cbefb5db7d1fdf", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkU0wCCRBK7hj4Ov3rIwAAkB0IAAe/xd25H1nZuCWZRqU1M8M1\nQJyHWwpPvMXTMs47R1R5TOJD0ALWKpzGZiciDL+GhiLKAwO1e6ahk0COkWvxUGav\nZVAumGIMnkGRk0qlg6vv+C63WhreDiAlR7YQLhFtAxeZEqwoINdUtiZ7D0nr30rW\nRT+svCLEKB1FqzMDTS8i7mSK+K5kRUZhBO9XG9W7vSGFfj/REHGOvrsnW7RDvLKu\n4tt6nreqrOJ3XvGc04DY0gap2p2/Z4C/gyVutdJisj42+E/aAToqKgPILjpoPzuR\nt2s/sv66ejAi3okizLcKm6sdcw9nyTqNRTz1BpS36+TqDL9iyv6EWQQzOdQPHEo=\n=nmt1\n-----END PGP SIGNATURE-----\n", "payload": "tree 3fb3b941bae251b874a1771c54b08f6bfbf5cc5e\nparent b194b43bd1ffdb6708b3eaa50c52d0a8c2199500\nparent 0fa59204e5b70bcf473a4ca56ac8ceea362d7dff\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1683180546 +0200\ncommitter GitHub <noreply@github.com> 1683180546 +0200\n\nRollup merge of #111070 - WaffleLapkin:break_ribs, r=lcnr\n\nDon't suffix `RibKind` variants\n\nThis PR\n- Removes `use RibKind::*`\n- Renames `RibKind::{SomethingRibKind => Something}`\n\nIt seems unnecessary to have \"RibKind\" in the end of all variants, if we can just use it as a normal enum. Additionally previously it was weird that `MacroDefinition` is the only unsuffixed variant.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/50754578f63e3d2b5fc1035303cbefb5db7d1fdf", "html_url": "https://github.com/rust-lang/rust/commit/50754578f63e3d2b5fc1035303cbefb5db7d1fdf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/50754578f63e3d2b5fc1035303cbefb5db7d1fdf/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b194b43bd1ffdb6708b3eaa50c52d0a8c2199500", "url": "https://api.github.com/repos/rust-lang/rust/commits/b194b43bd1ffdb6708b3eaa50c52d0a8c2199500", "html_url": "https://github.com/rust-lang/rust/commit/b194b43bd1ffdb6708b3eaa50c52d0a8c2199500"}, {"sha": "0fa59204e5b70bcf473a4ca56ac8ceea362d7dff", "url": "https://api.github.com/repos/rust-lang/rust/commits/0fa59204e5b70bcf473a4ca56ac8ceea362d7dff", "html_url": "https://github.com/rust-lang/rust/commit/0fa59204e5b70bcf473a4ca56ac8ceea362d7dff"}], "stats": {"total": 229, "additions": 113, "deletions": 116}, "files": [{"sha": "2db1d83d4fd5815dfb2983dbbc35e053e7bead1e", "filename": "compiler/rustc_resolve/src/ident.rs", "status": "modified", "additions": 33, "deletions": 34, "changes": 67, "blob_url": "https://github.com/rust-lang/rust/blob/50754578f63e3d2b5fc1035303cbefb5db7d1fdf/compiler%2Frustc_resolve%2Fsrc%2Fident.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50754578f63e3d2b5fc1035303cbefb5db7d1fdf/compiler%2Frustc_resolve%2Fsrc%2Fident.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Fident.rs?ref=50754578f63e3d2b5fc1035303cbefb5db7d1fdf", "patch": "@@ -24,7 +24,6 @@ use crate::{ResolutionError, Resolver, Scope, ScopeSet, Segment, ToNameBinding,\n \n use Determinacy::*;\n use Namespace::*;\n-use RibKind::*;\n \n type Visibility = ty::Visibility<LocalDefId>;\n \n@@ -324,8 +323,8 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n             }\n \n             module = match ribs[i].kind {\n-                ModuleRibKind(module) => module,\n-                MacroDefinition(def) if def == self.macro_def(ident.span.ctxt()) => {\n+                RibKind::Module(module) => module,\n+                RibKind::MacroDefinition(def) if def == self.macro_def(ident.span.ctxt()) => {\n                     // If an invocation of this macro created `ident`, give up on `ident`\n                     // and switch to `ident`'s source from the macro definition.\n                     ident.span.remove_mark();\n@@ -1084,7 +1083,7 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n         let ribs = &all_ribs[rib_index + 1..];\n \n         // An invalid forward use of a generic parameter from a previous default.\n-        if let ForwardGenericParamBanRibKind = all_ribs[rib_index].kind {\n+        if let RibKind::ForwardGenericParamBan = all_ribs[rib_index].kind {\n             if let Some(span) = finalize {\n                 let res_error = if rib_ident.name == kw::SelfUpper {\n                     ResolutionError::SelfInGenericParamDefault\n@@ -1104,14 +1103,14 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n \n                 for rib in ribs {\n                     match rib.kind {\n-                        NormalRibKind\n-                        | ClosureOrAsyncRibKind\n-                        | ModuleRibKind(..)\n-                        | MacroDefinition(..)\n-                        | ForwardGenericParamBanRibKind => {\n+                        RibKind::Normal\n+                        | RibKind::ClosureOrAsync\n+                        | RibKind::Module(..)\n+                        | RibKind::MacroDefinition(..)\n+                        | RibKind::ForwardGenericParamBan => {\n                             // Nothing to do. Continue.\n                         }\n-                        ItemRibKind(_) | AssocItemRibKind => {\n+                        RibKind::Item(_) | RibKind::AssocItem => {\n                             // This was an attempt to access an upvar inside a\n                             // named function item. This is not allowed, so we\n                             // report an error.\n@@ -1123,7 +1122,7 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n                                 res_err = Some((span, CannotCaptureDynamicEnvironmentInFnItem));\n                             }\n                         }\n-                        ConstantItemRibKind(_, item) => {\n+                        RibKind::ConstantItem(_, item) => {\n                             // Still doesn't deal with upvars\n                             if let Some(span) = finalize {\n                                 let (span, resolution_error) =\n@@ -1152,13 +1151,13 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n                             }\n                             return Res::Err;\n                         }\n-                        ConstParamTyRibKind => {\n+                        RibKind::ConstParamTy => {\n                             if let Some(span) = finalize {\n                                 self.report_error(span, ParamInTyOfConstParam(rib_ident.name));\n                             }\n                             return Res::Err;\n                         }\n-                        InlineAsmSymRibKind => {\n+                        RibKind::InlineAsmSym => {\n                             if let Some(span) = finalize {\n                                 self.report_error(span, InvalidAsmSym);\n                             }\n@@ -1177,18 +1176,18 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n             | Res::SelfCtor(_) => {\n                 for rib in ribs {\n                     let has_generic_params: HasGenericParams = match rib.kind {\n-                        NormalRibKind\n-                        | ClosureOrAsyncRibKind\n-                        | ModuleRibKind(..)\n-                        | MacroDefinition(..)\n-                        | InlineAsmSymRibKind\n-                        | AssocItemRibKind\n-                        | ForwardGenericParamBanRibKind => {\n+                        RibKind::Normal\n+                        | RibKind::ClosureOrAsync\n+                        | RibKind::Module(..)\n+                        | RibKind::MacroDefinition(..)\n+                        | RibKind::InlineAsmSym\n+                        | RibKind::AssocItem\n+                        | RibKind::ForwardGenericParamBan => {\n                             // Nothing to do. Continue.\n                             continue;\n                         }\n \n-                        ConstantItemRibKind(trivial, _) => {\n+                        RibKind::ConstantItem(trivial, _) => {\n                             let features = self.tcx.sess.features_untracked();\n                             // HACK(min_const_generics): We currently only allow `N` or `{ N }`.\n                             if !(trivial == ConstantHasGenerics::Yes\n@@ -1229,8 +1228,8 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n                         }\n \n                         // This was an attempt to use a type parameter outside its scope.\n-                        ItemRibKind(has_generic_params) => has_generic_params,\n-                        ConstParamTyRibKind => {\n+                        RibKind::Item(has_generic_params) => has_generic_params,\n+                        RibKind::ConstParamTy => {\n                             if let Some(span) = finalize {\n                                 self.report_error(\n                                     span,\n@@ -1256,15 +1255,15 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n             Res::Def(DefKind::ConstParam, _) => {\n                 for rib in ribs {\n                     let has_generic_params = match rib.kind {\n-                        NormalRibKind\n-                        | ClosureOrAsyncRibKind\n-                        | ModuleRibKind(..)\n-                        | MacroDefinition(..)\n-                        | InlineAsmSymRibKind\n-                        | AssocItemRibKind\n-                        | ForwardGenericParamBanRibKind => continue,\n-\n-                        ConstantItemRibKind(trivial, _) => {\n+                        RibKind::Normal\n+                        | RibKind::ClosureOrAsync\n+                        | RibKind::Module(..)\n+                        | RibKind::MacroDefinition(..)\n+                        | RibKind::InlineAsmSym\n+                        | RibKind::AssocItem\n+                        | RibKind::ForwardGenericParamBan => continue,\n+\n+                        RibKind::ConstantItem(trivial, _) => {\n                             let features = self.tcx.sess.features_untracked();\n                             // HACK(min_const_generics): We currently only allow `N` or `{ N }`.\n                             if !(trivial == ConstantHasGenerics::Yes\n@@ -1287,8 +1286,8 @@ impl<'a, 'tcx> Resolver<'a, 'tcx> {\n                             continue;\n                         }\n \n-                        ItemRibKind(has_generic_params) => has_generic_params,\n-                        ConstParamTyRibKind => {\n+                        RibKind::Item(has_generic_params) => has_generic_params,\n+                        RibKind::ConstParamTy => {\n                             if let Some(span) = finalize {\n                                 self.report_error(\n                                     span,"}, {"sha": "f876b8c7ae0de44480adab713e52fd0db590210c", "filename": "compiler/rustc_resolve/src/late.rs", "status": "modified", "additions": 78, "deletions": 80, "changes": 158, "blob_url": "https://github.com/rust-lang/rust/blob/50754578f63e3d2b5fc1035303cbefb5db7d1fdf/compiler%2Frustc_resolve%2Fsrc%2Flate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50754578f63e3d2b5fc1035303cbefb5db7d1fdf/compiler%2Frustc_resolve%2Fsrc%2Flate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate.rs?ref=50754578f63e3d2b5fc1035303cbefb5db7d1fdf", "patch": "@@ -6,8 +6,6 @@\n //! If you wonder why there's no `early.rs`, that's because it's split into three files -\n //! `build_reduced_graph.rs`, `macros.rs` and `imports.rs`.\n \n-use RibKind::*;\n-\n use crate::{path_names_to_string, rustdoc, BindingError, Finalize, LexicalScopeBinding};\n use crate::{Module, ModuleOrUniformRoot, NameBinding, ParentScope, PathResult};\n use crate::{ResolutionError, Resolver, Segment, UseError};\n@@ -133,75 +131,75 @@ enum RecordPartialRes {\n #[derive(Copy, Clone, Debug)]\n pub(crate) enum RibKind<'a> {\n     /// No restriction needs to be applied.\n-    NormalRibKind,\n+    Normal,\n \n     /// We passed through an impl or trait and are now in one of its\n     /// methods or associated types. Allow references to ty params that impl or trait\n     /// binds. Disallow any other upvars (including other ty params that are\n     /// upvars).\n-    AssocItemRibKind,\n+    AssocItem,\n \n     /// We passed through a closure. Disallow labels.\n-    ClosureOrAsyncRibKind,\n+    ClosureOrAsync,\n \n     /// We passed through an item scope. Disallow upvars.\n-    ItemRibKind(HasGenericParams),\n+    Item(HasGenericParams),\n \n     /// We're in a constant item. Can't refer to dynamic stuff.\n     ///\n     /// The item may reference generic parameters in trivial constant expressions.\n     /// All other constants aren't allowed to use generic params at all.\n-    ConstantItemRibKind(ConstantHasGenerics, Option<(Ident, ConstantItemKind)>),\n+    ConstantItem(ConstantHasGenerics, Option<(Ident, ConstantItemKind)>),\n \n     /// We passed through a module.\n-    ModuleRibKind(Module<'a>),\n+    Module(Module<'a>),\n \n     /// We passed through a `macro_rules!` statement\n     MacroDefinition(DefId),\n \n     /// All bindings in this rib are generic parameters that can't be used\n     /// from the default of a generic parameter because they're not declared\n     /// before said generic parameter. Also see the `visit_generics` override.\n-    ForwardGenericParamBanRibKind,\n+    ForwardGenericParamBan,\n \n     /// We are inside of the type of a const parameter. Can't refer to any\n     /// parameters.\n-    ConstParamTyRibKind,\n+    ConstParamTy,\n \n     /// We are inside a `sym` inline assembly operand. Can only refer to\n     /// globals.\n-    InlineAsmSymRibKind,\n+    InlineAsmSym,\n }\n \n impl RibKind<'_> {\n     /// Whether this rib kind contains generic parameters, as opposed to local\n     /// variables.\n     pub(crate) fn contains_params(&self) -> bool {\n         match self {\n-            NormalRibKind\n-            | ClosureOrAsyncRibKind\n-            | ConstantItemRibKind(..)\n-            | ModuleRibKind(_)\n-            | MacroDefinition(_)\n-            | ConstParamTyRibKind\n-            | InlineAsmSymRibKind => false,\n-            AssocItemRibKind | ItemRibKind(_) | ForwardGenericParamBanRibKind => true,\n+            RibKind::Normal\n+            | RibKind::ClosureOrAsync\n+            | RibKind::ConstantItem(..)\n+            | RibKind::Module(_)\n+            | RibKind::MacroDefinition(_)\n+            | RibKind::ConstParamTy\n+            | RibKind::InlineAsmSym => false,\n+            RibKind::AssocItem | RibKind::Item(_) | RibKind::ForwardGenericParamBan => true,\n         }\n     }\n \n     /// This rib forbids referring to labels defined in upwards ribs.\n     fn is_label_barrier(self) -> bool {\n         match self {\n-            NormalRibKind | MacroDefinition(..) => false,\n-\n-            AssocItemRibKind\n-            | ClosureOrAsyncRibKind\n-            | ItemRibKind(..)\n-            | ConstantItemRibKind(..)\n-            | ModuleRibKind(..)\n-            | ForwardGenericParamBanRibKind\n-            | ConstParamTyRibKind\n-            | InlineAsmSymRibKind => true,\n+            RibKind::Normal | RibKind::MacroDefinition(..) => false,\n+\n+            RibKind::AssocItem\n+            | RibKind::ClosureOrAsync\n+            | RibKind::Item(..)\n+            | RibKind::ConstantItem(..)\n+            | RibKind::Module(..)\n+            | RibKind::ForwardGenericParamBan\n+            | RibKind::ConstParamTy\n+            | RibKind::InlineAsmSym => true,\n         }\n     }\n }\n@@ -702,7 +700,7 @@ impl<'a: 'ast, 'ast, 'tcx> Visitor<'ast> for LateResolutionVisitor<'a, '_, 'ast,\n                     let span = ty.span.shrink_to_lo().to(path.span.shrink_to_lo());\n                     self.with_generic_param_rib(\n                         &[],\n-                        NormalRibKind,\n+                        RibKind::Normal,\n                         LifetimeRibKind::Generics {\n                             binder: ty.id,\n                             kind: LifetimeBinderKind::PolyTrait,\n@@ -740,7 +738,7 @@ impl<'a: 'ast, 'ast, 'tcx> Visitor<'ast> for LateResolutionVisitor<'a, '_, 'ast,\n                 let span = ty.span.shrink_to_lo().to(bare_fn.decl_span.shrink_to_lo());\n                 self.with_generic_param_rib(\n                     &bare_fn.generic_params,\n-                    NormalRibKind,\n+                    RibKind::Normal,\n                     LifetimeRibKind::Generics {\n                         binder: ty.id,\n                         kind: LifetimeBinderKind::BareFnType,\n@@ -780,7 +778,7 @@ impl<'a: 'ast, 'ast, 'tcx> Visitor<'ast> for LateResolutionVisitor<'a, '_, 'ast,\n         let span = tref.span.shrink_to_lo().to(tref.trait_ref.path.span.shrink_to_lo());\n         self.with_generic_param_rib(\n             &tref.bound_generic_params,\n-            NormalRibKind,\n+            RibKind::Normal,\n             LifetimeRibKind::Generics {\n                 binder: tref.trait_ref.ref_id,\n                 kind: LifetimeBinderKind::PolyTrait,\n@@ -804,7 +802,7 @@ impl<'a: 'ast, 'ast, 'tcx> Visitor<'ast> for LateResolutionVisitor<'a, '_, 'ast,\n             ForeignItemKind::TyAlias(box TyAlias { ref generics, .. }) => {\n                 self.with_generic_param_rib(\n                     &generics.params,\n-                    ItemRibKind(HasGenericParams::Yes(generics.span)),\n+                    RibKind::Item(HasGenericParams::Yes(generics.span)),\n                     LifetimeRibKind::Generics {\n                         binder: foreign_item.id,\n                         kind: LifetimeBinderKind::Item,\n@@ -816,7 +814,7 @@ impl<'a: 'ast, 'ast, 'tcx> Visitor<'ast> for LateResolutionVisitor<'a, '_, 'ast,\n             ForeignItemKind::Fn(box Fn { ref generics, .. }) => {\n                 self.with_generic_param_rib(\n                     &generics.params,\n-                    ItemRibKind(HasGenericParams::Yes(generics.span)),\n+                    RibKind::Item(HasGenericParams::Yes(generics.span)),\n                     LifetimeRibKind::Generics {\n                         binder: foreign_item.id,\n                         kind: LifetimeBinderKind::Function,\n@@ -870,9 +868,9 @@ impl<'a: 'ast, 'ast, 'tcx> Visitor<'ast> for LateResolutionVisitor<'a, '_, 'ast,\n         debug!(\"(resolving function) entering function\");\n \n         // Create a value rib for the function.\n-        self.with_rib(ValueNS, ClosureOrAsyncRibKind, |this| {\n+        self.with_rib(ValueNS, RibKind::ClosureOrAsync, |this| {\n             // Create a label rib for the function.\n-            this.with_label_rib(ClosureOrAsyncRibKind, |this| {\n+            this.with_label_rib(RibKind::ClosureOrAsync, |this| {\n                 match fn_kind {\n                     FnKind::Fn(_, _, sig, _, generics, body) => {\n                         this.visit_generics(generics);\n@@ -1129,7 +1127,7 @@ impl<'a: 'ast, 'ast, 'tcx> Visitor<'ast> for LateResolutionVisitor<'a, '_, 'ast,\n                 let span = predicate_span.shrink_to_lo().to(bounded_ty.span.shrink_to_lo());\n                 this.with_generic_param_rib(\n                     &bound_generic_params,\n-                    NormalRibKind,\n+                    RibKind::Normal,\n                     LifetimeRibKind::Generics {\n                         binder: bounded_ty.id,\n                         kind: LifetimeBinderKind::WhereBound,\n@@ -1175,9 +1173,9 @@ impl<'a: 'ast, 'ast, 'tcx> Visitor<'ast> for LateResolutionVisitor<'a, '_, 'ast,\n \n     fn visit_inline_asm_sym(&mut self, sym: &'ast InlineAsmSym) {\n         // This is similar to the code for AnonConst.\n-        self.with_rib(ValueNS, InlineAsmSymRibKind, |this| {\n-            this.with_rib(TypeNS, InlineAsmSymRibKind, |this| {\n-                this.with_label_rib(InlineAsmSymRibKind, |this| {\n+        self.with_rib(ValueNS, RibKind::InlineAsmSym, |this| {\n+            this.with_rib(TypeNS, RibKind::InlineAsmSym, |this| {\n+                this.with_label_rib(RibKind::InlineAsmSym, |this| {\n                     this.smart_resolve_path(sym.id, &sym.qself, &sym.path, PathSource::Expr(None));\n                     visit::walk_inline_asm_sym(this, sym);\n                 });\n@@ -1202,7 +1200,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n         // although it may be useful to track other components as well for diagnostics.\n         let graph_root = resolver.graph_root;\n         let parent_scope = ParentScope::module(graph_root, resolver);\n-        let start_rib_kind = ModuleRibKind(graph_root);\n+        let start_rib_kind = RibKind::Module(graph_root);\n         LateResolutionVisitor {\n             r: resolver,\n             parent_scope,\n@@ -1306,8 +1304,8 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n         if let Some(module) = self.r.get_module(self.r.local_def_id(id).to_def_id()) {\n             // Move down in the graph.\n             let orig_module = replace(&mut self.parent_scope.module, module);\n-            self.with_rib(ValueNS, ModuleRibKind(module), |this| {\n-                this.with_rib(TypeNS, ModuleRibKind(module), |this| {\n+            self.with_rib(ValueNS, RibKind::Module(module), |this| {\n+                this.with_rib(TypeNS, RibKind::Module(module), |this| {\n                     let ret = f(this);\n                     this.parent_scope.module = orig_module;\n                     ret\n@@ -1324,8 +1322,8 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n         // provide previous type parameters as they're built. We\n         // put all the parameters on the ban list and then remove\n         // them one by one as they are processed and become available.\n-        let mut forward_ty_ban_rib = Rib::new(ForwardGenericParamBanRibKind);\n-        let mut forward_const_ban_rib = Rib::new(ForwardGenericParamBanRibKind);\n+        let mut forward_ty_ban_rib = Rib::new(RibKind::ForwardGenericParamBan);\n+        let mut forward_const_ban_rib = Rib::new(RibKind::ForwardGenericParamBan);\n         for param in params.iter() {\n             match param.kind {\n                 GenericParamKind::Type { .. } => {\n@@ -1386,8 +1384,8 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n                         // Const parameters can't have param bounds.\n                         assert!(param.bounds.is_empty());\n \n-                        this.ribs[TypeNS].push(Rib::new(ConstParamTyRibKind));\n-                        this.ribs[ValueNS].push(Rib::new(ConstParamTyRibKind));\n+                        this.ribs[TypeNS].push(Rib::new(RibKind::ConstParamTy));\n+                        this.ribs[ValueNS].push(Rib::new(RibKind::ConstParamTy));\n                         this.with_lifetime_rib(LifetimeRibKind::ConstGeneric, |this| {\n                             this.visit_ty(ty)\n                         });\n@@ -2109,7 +2107,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n         for i in (0..self.label_ribs.len()).rev() {\n             let rib = &self.label_ribs[i];\n \n-            if let MacroDefinition(def) = rib.kind {\n+            if let RibKind::MacroDefinition(def) = rib.kind {\n                 // If an invocation of this macro created `ident`, give up on `ident`\n                 // and switch to `ident`'s source from the macro definition.\n                 if def == self.r.macro_def(label.span.ctxt()) {\n@@ -2157,7 +2155,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n         self.with_current_self_item(item, |this| {\n             this.with_generic_param_rib(\n                 &generics.params,\n-                ItemRibKind(HasGenericParams::Yes(generics.span)),\n+                RibKind::Item(HasGenericParams::Yes(generics.span)),\n                 LifetimeRibKind::Generics {\n                     binder: item.id,\n                     kind: LifetimeBinderKind::Item,\n@@ -2238,7 +2236,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n             ItemKind::TyAlias(box TyAlias { ref generics, .. }) => {\n                 self.with_generic_param_rib(\n                     &generics.params,\n-                    ItemRibKind(HasGenericParams::Yes(generics.span)),\n+                    RibKind::Item(HasGenericParams::Yes(generics.span)),\n                     LifetimeRibKind::Generics {\n                         binder: item.id,\n                         kind: LifetimeBinderKind::Item,\n@@ -2251,7 +2249,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n             ItemKind::Fn(box Fn { ref generics, .. }) => {\n                 self.with_generic_param_rib(\n                     &generics.params,\n-                    ItemRibKind(HasGenericParams::Yes(generics.span)),\n+                    RibKind::Item(HasGenericParams::Yes(generics.span)),\n                     LifetimeRibKind::Generics {\n                         binder: item.id,\n                         kind: LifetimeBinderKind::Function,\n@@ -2290,7 +2288,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n                 // Create a new rib for the trait-wide type parameters.\n                 self.with_generic_param_rib(\n                     &generics.params,\n-                    ItemRibKind(HasGenericParams::Yes(generics.span)),\n+                    RibKind::Item(HasGenericParams::Yes(generics.span)),\n                     LifetimeRibKind::Generics {\n                         binder: item.id,\n                         kind: LifetimeBinderKind::Item,\n@@ -2311,7 +2309,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n                 // Create a new rib for the trait-wide type parameters.\n                 self.with_generic_param_rib(\n                     &generics.params,\n-                    ItemRibKind(HasGenericParams::Yes(generics.span)),\n+                    RibKind::Item(HasGenericParams::Yes(generics.span)),\n                     LifetimeRibKind::Generics {\n                         binder: item.id,\n                         kind: LifetimeBinderKind::Item,\n@@ -2414,11 +2412,11 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n         let mut seen_lifetimes = FxHashSet::default();\n \n         // We also can't shadow bindings from the parent item\n-        if let AssocItemRibKind = kind {\n+        if let RibKind::AssocItem = kind {\n             let mut add_bindings_for_ns = |ns| {\n                 let parent_rib = self.ribs[ns]\n                     .iter()\n-                    .rfind(|r| matches!(r.kind, ItemRibKind(_)))\n+                    .rfind(|r| matches!(r.kind, RibKind::Item(_)))\n                     .expect(\"associated item outside of an item\");\n                 seen_bindings.extend(parent_rib.bindings.keys().map(|ident| (*ident, ident.span)));\n             };\n@@ -2507,8 +2505,8 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n             };\n \n             let res = match kind {\n-                ItemRibKind(..) | AssocItemRibKind => Res::Def(def_kind, def_id.to_def_id()),\n-                NormalRibKind => {\n+                RibKind::Item(..) | RibKind::AssocItem => Res::Def(def_kind, def_id.to_def_id()),\n+                RibKind::Normal => {\n                     if self.r.tcx.sess.features_untracked().non_lifetime_binders {\n                         Res::Def(def_kind, def_id.to_def_id())\n                     } else {\n@@ -2554,7 +2552,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n     }\n \n     fn with_static_rib(&mut self, f: impl FnOnce(&mut Self)) {\n-        let kind = ItemRibKind(HasGenericParams::No);\n+        let kind = RibKind::Item(HasGenericParams::No);\n         self.with_rib(ValueNS, kind, |this| this.with_rib(TypeNS, kind, f))\n     }\n \n@@ -2574,15 +2572,15 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n         item: Option<(Ident, ConstantItemKind)>,\n         f: impl FnOnce(&mut Self),\n     ) {\n-        self.with_rib(ValueNS, ConstantItemRibKind(may_use_generics, item), |this| {\n+        self.with_rib(ValueNS, RibKind::ConstantItem(may_use_generics, item), |this| {\n             this.with_rib(\n                 TypeNS,\n-                ConstantItemRibKind(\n+                RibKind::ConstantItem(\n                     may_use_generics.force_yes_if(is_repeat == IsRepeatExpr::Yes),\n                     item,\n                 ),\n                 |this| {\n-                    this.with_label_rib(ConstantItemRibKind(may_use_generics, item), f);\n+                    this.with_label_rib(RibKind::ConstantItem(may_use_generics, item), f);\n                 },\n             )\n         });\n@@ -2614,7 +2612,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n             |this: &mut Self, generics: &Generics, kind, item: &'ast AssocItem| {\n                 this.with_generic_param_rib(\n                     &generics.params,\n-                    AssocItemRibKind,\n+                    RibKind::AssocItem,\n                     LifetimeRibKind::Generics { binder: item.id, span: generics.span, kind },\n                     |this| visit::walk_assoc_item(this, item, AssocCtxt::Trait),\n                 );\n@@ -2695,7 +2693,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n     }\n \n     fn with_self_rib_ns(&mut self, ns: Namespace, self_res: Res, f: impl FnOnce(&mut Self)) {\n-        let mut self_type_rib = Rib::new(NormalRibKind);\n+        let mut self_type_rib = Rib::new(RibKind::Normal);\n \n         // Plain insert (no renaming, since types are not currently hygienic)\n         self_type_rib.bindings.insert(Ident::with_dummy_span(kw::SelfUpper), self_res);\n@@ -2721,7 +2719,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n         // If applicable, create a rib for the type parameters.\n         self.with_generic_param_rib(\n             &generics.params,\n-            ItemRibKind(HasGenericParams::Yes(generics.span)),\n+            RibKind::Item(HasGenericParams::Yes(generics.span)),\n             LifetimeRibKind::Generics {\n                 span: generics.span,\n                 binder: item_id,\n@@ -2835,7 +2833,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n                 // We also need a new scope for the impl item type parameters.\n                 self.with_generic_param_rib(\n                     &generics.params,\n-                    AssocItemRibKind,\n+                    RibKind::AssocItem,\n                     LifetimeRibKind::Generics {\n                         binder: item.id,\n                         span: generics.span,\n@@ -2863,7 +2861,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n                 // We also need a new scope for the impl item type parameters.\n                 self.with_generic_param_rib(\n                     &generics.params,\n-                    AssocItemRibKind,\n+                    RibKind::AssocItem,\n                     LifetimeRibKind::Generics {\n                         binder: item.id,\n                         span: generics.span,\n@@ -3135,7 +3133,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n     }\n \n     fn resolve_arm(&mut self, arm: &'ast Arm) {\n-        self.with_rib(ValueNS, NormalRibKind, |this| {\n+        self.with_rib(ValueNS, RibKind::Normal, |this| {\n             this.resolve_pattern_top(&arm.pat, PatternSource::Match);\n             walk_list!(this, visit_expr, &arm.guard);\n             this.visit_expr(&arm.body);\n@@ -3857,7 +3855,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n                 diagnostics::signal_label_shadowing(self.r.tcx.sess, orig_span, label.ident)\n             }\n \n-            self.with_label_rib(NormalRibKind, |this| {\n+            self.with_label_rib(RibKind::Normal, |this| {\n                 let ident = label.ident.normalize_to_macro_rules();\n                 this.label_ribs.last_mut().unwrap().bindings.insert(ident, id);\n                 f(this);\n@@ -3880,11 +3878,11 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n         let mut num_macro_definition_ribs = 0;\n         if let Some(anonymous_module) = anonymous_module {\n             debug!(\"(resolving block) found anonymous module, moving down\");\n-            self.ribs[ValueNS].push(Rib::new(ModuleRibKind(anonymous_module)));\n-            self.ribs[TypeNS].push(Rib::new(ModuleRibKind(anonymous_module)));\n+            self.ribs[ValueNS].push(Rib::new(RibKind::Module(anonymous_module)));\n+            self.ribs[TypeNS].push(Rib::new(RibKind::Module(anonymous_module)));\n             self.parent_scope.module = anonymous_module;\n         } else {\n-            self.ribs[ValueNS].push(Rib::new(NormalRibKind));\n+            self.ribs[ValueNS].push(Rib::new(RibKind::Normal));\n         }\n \n         let prev = self.diagnostic_metadata.current_block_could_be_bare_struct_literal.take();\n@@ -3901,8 +3899,8 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n                 && let ItemKind::MacroDef(..) = item.kind {\n                 num_macro_definition_ribs += 1;\n                 let res = self.r.local_def_id(item.id).to_def_id();\n-                self.ribs[ValueNS].push(Rib::new(MacroDefinition(res)));\n-                self.label_ribs.push(Rib::new(MacroDefinition(res)));\n+                self.ribs[ValueNS].push(Rib::new(RibKind::MacroDefinition(res)));\n+                self.label_ribs.push(Rib::new(RibKind::MacroDefinition(res)));\n             }\n \n             self.visit_stmt(stmt);\n@@ -3989,7 +3987,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n             }\n \n             ExprKind::If(ref cond, ref then, ref opt_else) => {\n-                self.with_rib(ValueNS, NormalRibKind, |this| {\n+                self.with_rib(ValueNS, RibKind::Normal, |this| {\n                     let old = this.diagnostic_metadata.in_if_condition.replace(cond);\n                     this.visit_expr(cond);\n                     this.diagnostic_metadata.in_if_condition = old;\n@@ -4006,7 +4004,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n \n             ExprKind::While(ref cond, ref block, label) => {\n                 self.with_resolved_label(label, expr.id, |this| {\n-                    this.with_rib(ValueNS, NormalRibKind, |this| {\n+                    this.with_rib(ValueNS, RibKind::Normal, |this| {\n                         let old = this.diagnostic_metadata.in_if_condition.replace(cond);\n                         this.visit_expr(cond);\n                         this.diagnostic_metadata.in_if_condition = old;\n@@ -4017,7 +4015,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n \n             ExprKind::ForLoop(ref pat, ref iter_expr, ref block, label) => {\n                 self.visit_expr(iter_expr);\n-                self.with_rib(ValueNS, NormalRibKind, |this| {\n+                self.with_rib(ValueNS, RibKind::Normal, |this| {\n                     this.resolve_pattern_top(pat, PatternSource::For);\n                     this.resolve_labeled_block(label, expr.id, block);\n                 });\n@@ -4073,8 +4071,8 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n                 ref body,\n                 ..\n             }) => {\n-                self.with_rib(ValueNS, NormalRibKind, |this| {\n-                    this.with_label_rib(ClosureOrAsyncRibKind, |this| {\n+                self.with_rib(ValueNS, RibKind::Normal, |this| {\n+                    this.with_label_rib(RibKind::ClosureOrAsync, |this| {\n                         // Resolve arguments:\n                         this.resolve_params(&fn_decl.inputs);\n                         // No need to resolve return type --\n@@ -4098,7 +4096,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n             }) => {\n                 self.with_generic_param_rib(\n                     &generic_params,\n-                    NormalRibKind,\n+                    RibKind::Normal,\n                     LifetimeRibKind::Generics {\n                         binder: expr.id,\n                         kind: LifetimeBinderKind::Closure,\n@@ -4109,7 +4107,7 @@ impl<'a: 'ast, 'b, 'ast, 'tcx> LateResolutionVisitor<'a, 'b, 'ast, 'tcx> {\n             }\n             ExprKind::Closure(..) => visit::walk_expr(self, expr),\n             ExprKind::Async(..) => {\n-                self.with_label_rib(ClosureOrAsyncRibKind, |this| visit::walk_expr(this, expr));\n+                self.with_label_rib(RibKind::ClosureOrAsync, |this| visit::walk_expr(this, expr));\n             }\n             ExprKind::Repeat(ref elem, ref ct) => {\n                 self.visit_expr(elem);"}, {"sha": "42d498c7ee0b6e912e4003c3d485097c127e1790", "filename": "compiler/rustc_resolve/src/late/diagnostics.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/50754578f63e3d2b5fc1035303cbefb5db7d1fdf/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/50754578f63e3d2b5fc1035303cbefb5db7d1fdf/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_resolve%2Fsrc%2Flate%2Fdiagnostics.rs?ref=50754578f63e3d2b5fc1035303cbefb5db7d1fdf", "patch": "@@ -605,7 +605,7 @@ impl<'a: 'ast, 'ast, 'tcx> LateResolutionVisitor<'a, '_, 'ast, 'tcx> {\n         }\n \n         // Try to find in last block rib\n-        if let Some(rib) = &self.last_block_rib && let RibKind::NormalRibKind = rib.kind {\n+        if let Some(rib) = &self.last_block_rib && let RibKind::Normal = rib.kind {\n             for (ident, &res) in &rib.bindings {\n                 if let Res::Local(_) = res && path.len() == 1 &&\n                     ident.span.eq_ctxt(path[0].ident.span) &&\n@@ -1690,7 +1690,7 @@ impl<'a: 'ast, 'ast, 'tcx> LateResolutionVisitor<'a, '_, 'ast, 'tcx> {\n                 }\n \n                 // Items in scope\n-                if let RibKind::ModuleRibKind(module) = rib.kind {\n+                if let RibKind::Module(module) = rib.kind {\n                     // Items from this module\n                     self.r.add_module_candidates(module, &mut names, &filter_fn, Some(ctxt));\n "}]}