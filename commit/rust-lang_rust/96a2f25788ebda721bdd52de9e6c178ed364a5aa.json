{"sha": "96a2f25788ebda721bdd52de9e6c178ed364a5aa", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk2YTJmMjU3ODhlYmRhNzIxYmRkNTJkZTllNmMxNzhlZDM2NGE1YWE=", "commit": {"author": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2016-03-14T05:55:55Z"}, "committer": {"name": "Nick Cameron", "email": "ncameron@mozilla.com", "date": "2016-03-14T05:55:55Z"}, "message": "Keep empty extern blocks on one line\n\nCloses #462", "tree": {"sha": "3c24389e6027c0aa69a643c7ab1e345c5611edd0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3c24389e6027c0aa69a643c7ab1e345c5611edd0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/96a2f25788ebda721bdd52de9e6c178ed364a5aa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/96a2f25788ebda721bdd52de9e6c178ed364a5aa", "html_url": "https://github.com/rust-lang/rust/commit/96a2f25788ebda721bdd52de9e6c178ed364a5aa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/96a2f25788ebda721bdd52de9e6c178ed364a5aa/comments", "author": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nrc", "id": 762626, "node_id": "MDQ6VXNlcjc2MjYyNg==", "avatar_url": "https://avatars.githubusercontent.com/u/762626?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nrc", "html_url": "https://github.com/nrc", "followers_url": "https://api.github.com/users/nrc/followers", "following_url": "https://api.github.com/users/nrc/following{/other_user}", "gists_url": "https://api.github.com/users/nrc/gists{/gist_id}", "starred_url": "https://api.github.com/users/nrc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nrc/subscriptions", "organizations_url": "https://api.github.com/users/nrc/orgs", "repos_url": "https://api.github.com/users/nrc/repos", "events_url": "https://api.github.com/users/nrc/events{/privacy}", "received_events_url": "https://api.github.com/users/nrc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "204e732c1bfa2909bcd4bb85430e1f537a99d9c0", "url": "https://api.github.com/repos/rust-lang/rust/commits/204e732c1bfa2909bcd4bb85430e1f537a99d9c0", "html_url": "https://github.com/rust-lang/rust/commit/204e732c1bfa2909bcd4bb85430e1f537a99d9c0"}], "stats": {"total": 29, "additions": 20, "deletions": 9}, "files": [{"sha": "d70f780df5a1d0ececb34547c7b2577881d2a677", "filename": "src/items.rs", "status": "modified", "additions": 14, "deletions": 9, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/96a2f25788ebda721bdd52de9e6c178ed364a5aa/src%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96a2f25788ebda721bdd52de9e6c178ed364a5aa/src%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fitems.rs?ref=96a2f25788ebda721bdd52de9e6c178ed364a5aa", "patch": "@@ -84,19 +84,24 @@ impl<'a> FmtVisitor<'a> {\n         self.buffer.push_str(&::utils::format_abi(fm.abi));\n \n         let snippet = self.snippet(span);\n-        let brace_pos = snippet.find_uncommented(\"{\").unwrap() as u32;\n+        let brace_pos = snippet.find_uncommented(\"{\").unwrap();\n \n-        // FIXME: this skips comments between the extern keyword and the opening\n-        // brace.\n-        self.last_pos = span.lo + BytePos(brace_pos);\n-        self.block_indent = self.block_indent.block_indent(self.config);\n+        if fm.items.is_empty() && !contains_comment(&snippet[brace_pos..]) {\n+            self.buffer.push_str(\"{\");\n+        } else {\n+            // FIXME: this skips comments between the extern keyword and the opening\n+            // brace.\n+            self.last_pos = span.lo + BytePos(brace_pos as u32);\n+            self.block_indent = self.block_indent.block_indent(self.config);\n \n-        for item in &fm.items {\n-            self.format_foreign_item(&*item);\n+            for item in &fm.items {\n+                self.format_foreign_item(&*item);\n+            }\n+\n+            self.block_indent = self.block_indent.block_unindent(self.config);\n+            self.format_missing_with_indent(span.hi - BytePos(1));\n         }\n \n-        self.block_indent = self.block_indent.block_unindent(self.config);\n-        self.format_missing_with_indent(span.hi - BytePos(1));\n         self.buffer.push_str(\"}\");\n         self.last_pos = span.hi;\n     }"}, {"sha": "347612dd8f1aa954527c705959801bb822ad8edb", "filename": "tests/source/extern.rs", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/96a2f25788ebda721bdd52de9e6c178ed364a5aa/tests%2Fsource%2Fextern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96a2f25788ebda721bdd52de9e6c178ed364a5aa/tests%2Fsource%2Fextern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fextern.rs?ref=96a2f25788ebda721bdd52de9e6c178ed364a5aa", "patch": "@@ -34,3 +34,7 @@ libc::c_long;\n                                file: *mut FILE)\n                               -> *mut FILE;\n    }\n+\n+extern {\n+\n+}"}, {"sha": "e25e8b01cd4b9469bc14ca6e1e1d72252388d0b1", "filename": "tests/target/extern.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/96a2f25788ebda721bdd52de9e6c178ed364a5aa/tests%2Ftarget%2Fextern.rs", "raw_url": "https://github.com/rust-lang/rust/raw/96a2f25788ebda721bdd52de9e6c178ed364a5aa/tests%2Ftarget%2Fextern.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fextern.rs?ref=96a2f25788ebda721bdd52de9e6c178ed364a5aa", "patch": "@@ -45,3 +45,5 @@ extern \"C\" {\n                    file: *mut FILE)\n                    -> *mut FILE;\n }\n+\n+extern \"C\" {}"}]}