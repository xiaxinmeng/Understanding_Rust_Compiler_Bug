{"sha": "4f38538d7585caed83bb6a95ede130f407ca7d3f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRmMzg1MzhkNzU4NWNhZWQ4M2JiNmE5NWVkZTEzMGY0MDdjYTdkM2Y=", "commit": {"author": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-11-03T11:59:13Z"}, "committer": {"name": "Philipp Hansch", "email": "dev@phansch.net", "date": "2018-11-03T12:43:35Z"}, "message": "RIIR update lints: Generate lint group registrations", "tree": {"sha": "128e2ebb0cd5e247d030979b8c37b1279302134b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/128e2ebb0cd5e247d030979b8c37b1279302134b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4f38538d7585caed83bb6a95ede130f407ca7d3f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEvUKv4zqIn2RHUgCKtvoGpuDiZlsFAlvdl/cACgkQtvoGpuDi\nZluhsRAAvBJ8Ip9mU194iJyW2tR5jiY7krO3q/pfwC1NcIbdumt8nJBX65rbraq7\nH5IOA1UeLfws7Leug9B7OClbi5L/68XszAR70pT9J6SNr9v8hW4Biu09kWRRCHVr\n4CJPOdU95t/ulCI2x3ObLsTCOS6TJk7Vf0F0xGn9fjm+IplAVJ01qggztXC7Sk6F\n4uIT0qjpOAnciNUGwtb2pcxIO1Asihy8eernQTfiKwVa15dhloPSB7BpzMDtla93\noGNR3yvJ81jL2qQ62yMHgd8e4mmIxApyvkzFw4hlkXIgoVbexj59Ff7voDuRLB91\nlOgZQyCmF8CetU5e5C4WJtPnjdYuOYbU9Rouulro1REfnxDWer4O46rN3mGR+OpD\nbwFXPaIeAKJGgXPjGx+aZvcKNakUqBaGmpahQ10DDzpAlyFeUTU23nk2KEDux5Mn\n8imk+vSz1/dwMaLDDBtu/e3Lg0sBDKvTbpCeOCgetyue/7AzenvHq8aUwnea0jQ/\ncPaZPEw/4aLT8N99k+Fe5ESSnlrm+IwwkrH0rYDS+ZKI8gh6N8g/pGRRf3tLVtWe\nnKtbQm8BsVoKvuK/8Nnu48pK5l4wjrNePPzgmZ6pjIkzxuXwCEPs2QQJDZ3RmHrW\nJX45lJkY9qqhyap9JCNOd9pCeO6FTMqRCQPxYCnQ2W/qETwV9cQ=\n=YAM3\n-----END PGP SIGNATURE-----", "payload": "tree 128e2ebb0cd5e247d030979b8c37b1279302134b\nparent 6e3320c7efc9cdaa1ddb3865181ec017d9f5de26\nauthor Philipp Hansch <dev@phansch.net> 1541246353 +0100\ncommitter Philipp Hansch <dev@phansch.net> 1541249015 +0100\n\nRIIR update lints: Generate lint group registrations\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4f38538d7585caed83bb6a95ede130f407ca7d3f", "html_url": "https://github.com/rust-lang/rust/commit/4f38538d7585caed83bb6a95ede130f407ca7d3f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4f38538d7585caed83bb6a95ede130f407ca7d3f/comments", "author": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "phansch", "id": 2042399, "node_id": "MDQ6VXNlcjIwNDIzOTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2042399?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phansch", "html_url": "https://github.com/phansch", "followers_url": "https://api.github.com/users/phansch/followers", "following_url": "https://api.github.com/users/phansch/following{/other_user}", "gists_url": "https://api.github.com/users/phansch/gists{/gist_id}", "starred_url": "https://api.github.com/users/phansch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phansch/subscriptions", "organizations_url": "https://api.github.com/users/phansch/orgs", "repos_url": "https://api.github.com/users/phansch/repos", "events_url": "https://api.github.com/users/phansch/events{/privacy}", "received_events_url": "https://api.github.com/users/phansch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6e3320c7efc9cdaa1ddb3865181ec017d9f5de26", "url": "https://api.github.com/repos/rust-lang/rust/commits/6e3320c7efc9cdaa1ddb3865181ec017d9f5de26", "html_url": "https://github.com/rust-lang/rust/commit/6e3320c7efc9cdaa1ddb3865181ec017d9f5de26"}], "stats": {"total": 58, "additions": 58, "deletions": 0}, "files": [{"sha": "f16ea14a3de5591d5d66a90e0091582b55a585a0", "filename": "clippy_dev/src/lib.rs", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/4f38538d7585caed83bb6a95ede130f407ca7d3f/clippy_dev%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f38538d7585caed83bb6a95ede130f407ca7d3f/clippy_dev%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Flib.rs?ref=4f38538d7585caed83bb6a95ede130f407ca7d3f", "patch": "@@ -72,6 +72,19 @@ impl Lint {\n     }\n }\n \n+/// Generates the Vec items for `register_lint_group` calls in `clippy_lints/src/lib.rs`.\n+pub fn gen_lint_group_list(lints: Vec<Lint>) -> Vec<String> {\n+    lints.into_iter()\n+        .filter_map(|l| {\n+            if l.is_internal() || l.deprecation.is_some() {\n+                None\n+            } else {\n+                Some(format!(\"        {}::{},\", l.module, l.name.to_uppercase()))\n+            }\n+        })\n+        .sorted()\n+}\n+\n /// Generates the `pub mod module_name` list in `clippy_lints/src/lib.rs`.\n pub fn gen_modules_list(lints: Vec<Lint>) -> Vec<String> {\n     lints.into_iter()\n@@ -390,3 +403,18 @@ fn test_gen_modules_list() {\n     ];\n     assert_eq!(expected, gen_modules_list(lints));\n }\n+\n+#[test]\n+fn test_gen_lint_group_list() {\n+    let lints = vec![\n+        Lint::new(\"abc\", \"group1\", \"abc\", None, \"module_name\"),\n+        Lint::new(\"should_assert_eq\", \"group1\", \"abc\", None, \"module_name\"),\n+        Lint::new(\"should_assert_eq2\", \"group2\", \"abc\", Some(\"abc\"), \"deprecated\"),\n+        Lint::new(\"incorrect_internal\", \"internal_style\", \"abc\", None, \"module_name\"),\n+    ];\n+    let expected = vec![\n+        \"        module_name::ABC,\".to_string(),\n+        \"        module_name::SHOULD_ASSERT_EQ,\".to_string(),\n+    ];\n+    assert_eq!(expected, gen_lint_group_list(lints));\n+}"}, {"sha": "128feaa8aea2f7b3c717f87f787bbee525005a7d", "filename": "clippy_dev/src/main.rs", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/rust-lang/rust/blob/4f38538d7585caed83bb6a95ede130f407ca7d3f/clippy_dev%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4f38538d7585caed83bb6a95ede130f407ca7d3f/clippy_dev%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fmain.rs?ref=4f38538d7585caed83bb6a95ede130f407ca7d3f", "patch": "@@ -98,4 +98,34 @@ fn update_lints() {\n         false,\n         || { gen_modules_list(lint_list.clone()) }\n     );\n+\n+    // Generate lists of lints in the clippy::all lint group\n+    replace_region_in_file(\n+        \"../clippy_lints/src/lib.rs\",\n+        r#\"reg.register_lint_group\\(\"clippy::all\"\"#,\n+        r#\"\\]\\);\"#,\n+        false,\n+        || {\n+            // clippy::all should only include the following lint groups:\n+            let all_group_lints = usable_lints.clone().into_iter().filter(|l| {\n+                l.group == \"correctness\" ||\n+                  l.group == \"style\" ||\n+                  l.group == \"complexity\" ||\n+                  l.group == \"perf\"\n+            }).collect();\n+\n+            gen_lint_group_list(all_group_lints)\n+        }\n+    );\n+\n+    // Generate the list of lints for all other lint groups\n+    for (lint_group, lints) in Lint::by_lint_group(&usable_lints) {\n+        replace_region_in_file(\n+            \"../clippy_lints/src/lib.rs\",\n+            &format!(\"reg.register_lint_group\\\\(\\\"clippy::{}\\\"\", lint_group),\n+            r#\"\\]\\);\"#,\n+            false,\n+            || { gen_lint_group_list(lints.clone()) }\n+        );\n+    }\n }"}]}