{"sha": "433d471a1a06b5852c7f6b5d276725933d8ddce6", "node_id": "C_kwDOAAsO6NoAKDQzM2Q0NzFhMWEwNmI1ODUyYzdmNmI1ZDI3NjcyNTkzM2Q4ZGRjZTY", "commit": {"author": {"name": "Weihang Lo", "email": "me@weihanglo.tw", "date": "2022-11-24T00:58:58Z"}, "committer": {"name": "Weihang Lo", "email": "me@weihanglo.tw", "date": "2022-11-24T00:59:04Z"}, "message": "rustc_codegen_ssa: write `.dwp` in a streaming fashion", "tree": {"sha": "9907b66ff95cf86897e9ba48a3718c289003db79", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9907b66ff95cf86897e9ba48a3718c289003db79"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/433d471a1a06b5852c7f6b5d276725933d8ddce6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEfYTqB0fBJAwqFtKm19vxiYJegucFAmN+wd8ACgkQ19vxiYJe\ngueENQ//QVM9mnfaPj5Qh3Vmi7ustd3dAnHJ2nMagM50tqWRihcHzG9HhwWLXJhB\nGFmX8xUbG3/D+Hxcc4t/1SAzZEc2pvufNO7fD1Fkds8YVw78+ylhhZ2RAgexQSx6\n/lRE6iFwMKx5fBoFJ1eDK14kXxuU1Hkk6zb07LK9YTTaf37+U9YONr6/FR1uK9km\nBPpFNfrVCHX1Cw6EN5680Y69gJN90RzTgakFB4SESmsGyagtmHG8kj2y0qoyrMcV\nifW7enICAy3MyAa2+8KU3u1WKhe9q6t4/45zzcmafkB1Mx7cLyIaFwLyA7KPfpwi\nwXTGS9+23vEfm2VObumNJgnUgJOZ4CVOIioxMMDOi/vngEkxHr9506X3MuQIWHuq\nHgYujiz7x3nOgMVS5w/09WRu3E70MvAD/CwQuz7YM2SXUzsZ1SjTmwJNn+RJ8Hh3\nlv/1A+aKDknZY1t+ZrBIC7gH+nSLCRZJm0dn7e3OCbImawtgP5XpX+IUQRCBe2pm\nfdpp6gmjOvs+xXyuke2PqFLPgt2TuDh4yi3mzCn8d+TMLIN/dnMQpSw5Gw0s9TwI\nLsHa56EhXTt0RH0LIbveq36lX6QxdnJyiRBRG1nVmkdlZ4II5Enpk6dw7CYTQtPF\nYfxxWIXhYmcDkmP6JdTKSforeLxojtRAz9OEijpOQTxrjhmUu58=\n=B5ib\n-----END PGP SIGNATURE-----", "payload": "tree 9907b66ff95cf86897e9ba48a3718c289003db79\nparent 70f8737b2f5d3bf7d6b784fad00b663b7ff9feda\nauthor Weihang Lo <me@weihanglo.tw> 1669251538 +0000\ncommitter Weihang Lo <me@weihanglo.tw> 1669251544 +0000\n\nrustc_codegen_ssa: write `.dwp` in a streaming fashion\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/433d471a1a06b5852c7f6b5d276725933d8ddce6", "html_url": "https://github.com/rust-lang/rust/commit/433d471a1a06b5852c7f6b5d276725933d8ddce6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/433d471a1a06b5852c7f6b5d276725933d8ddce6/comments", "author": {"login": "weihanglo", "id": 14314532, "node_id": "MDQ6VXNlcjE0MzE0NTMy", "avatar_url": "https://avatars.githubusercontent.com/u/14314532?v=4", "gravatar_id": "", "url": "https://api.github.com/users/weihanglo", "html_url": "https://github.com/weihanglo", "followers_url": "https://api.github.com/users/weihanglo/followers", "following_url": "https://api.github.com/users/weihanglo/following{/other_user}", "gists_url": "https://api.github.com/users/weihanglo/gists{/gist_id}", "starred_url": "https://api.github.com/users/weihanglo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/weihanglo/subscriptions", "organizations_url": "https://api.github.com/users/weihanglo/orgs", "repos_url": "https://api.github.com/users/weihanglo/repos", "events_url": "https://api.github.com/users/weihanglo/events{/privacy}", "received_events_url": "https://api.github.com/users/weihanglo/received_events", "type": "User", "site_admin": false}, "committer": {"login": "weihanglo", "id": 14314532, "node_id": "MDQ6VXNlcjE0MzE0NTMy", "avatar_url": "https://avatars.githubusercontent.com/u/14314532?v=4", "gravatar_id": "", "url": "https://api.github.com/users/weihanglo", "html_url": "https://github.com/weihanglo", "followers_url": "https://api.github.com/users/weihanglo/followers", "following_url": "https://api.github.com/users/weihanglo/following{/other_user}", "gists_url": "https://api.github.com/users/weihanglo/gists{/gist_id}", "starred_url": "https://api.github.com/users/weihanglo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/weihanglo/subscriptions", "organizations_url": "https://api.github.com/users/weihanglo/orgs", "repos_url": "https://api.github.com/users/weihanglo/repos", "events_url": "https://api.github.com/users/weihanglo/events{/privacy}", "received_events_url": "https://api.github.com/users/weihanglo/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "70f8737b2f5d3bf7d6b784fad00b663b7ff9feda", "url": "https://api.github.com/repos/rust-lang/rust/commits/70f8737b2f5d3bf7d6b784fad00b663b7ff9feda", "html_url": "https://github.com/rust-lang/rust/commit/70f8737b2f5d3bf7d6b784fad00b663b7ff9feda"}], "stats": {"total": 9, "additions": 5, "deletions": 4}, "files": [{"sha": "762430c6187216b8ff2b66ee8832eef2a9c921e4", "filename": "compiler/rustc_codegen_ssa/src/back/link.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/433d471a1a06b5852c7f6b5d276725933d8ddce6/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/433d471a1a06b5852c7f6b5d276725933d8ddce6/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_ssa%2Fsrc%2Fback%2Flink.rs?ref=433d471a1a06b5852c7f6b5d276725933d8ddce6", "patch": "@@ -676,17 +676,18 @@ fn link_dwarf_object<'a>(\n             thorin::MissingReferencedObjectBehaviour::Skip,\n         )?;\n \n-        let output = package.finish()?.write()?;\n-        let mut output_stream = BufWriter::new(\n+        let output_stream = BufWriter::new(\n             OpenOptions::new()\n                 .read(true)\n                 .write(true)\n                 .create(true)\n                 .truncate(true)\n                 .open(dwp_out_filename)?,\n         );\n-        output_stream.write_all(&output)?;\n-        output_stream.flush()?;\n+        let mut output_stream = object::write::StreamingBuffer::new(output_stream);\n+        package.finish()?.emit(&mut output_stream)?;\n+        output_stream.result()?;\n+        output_stream.into_inner().flush()?;\n \n         Ok(())\n     }) {"}]}