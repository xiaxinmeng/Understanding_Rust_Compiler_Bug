{"sha": "a952708b6c91678c24bfe58f1215c51e2656a4c2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmE5NTI3MDhiNmM5MTY3OGMyNGJmZTU4ZjEyMTVjNTFlMjY1NmE0YzI=", "commit": {"author": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2019-11-06T05:13:43Z"}, "committer": {"name": "Michael Wright", "email": "mikerite@lavabit.com", "date": "2019-11-06T05:33:56Z"}, "message": "Fix crash in `use-self` lint\n\nFixes #4727", "tree": {"sha": "3f8af32047b79edbf79fe5dd30fee17124985565", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3f8af32047b79edbf79fe5dd30fee17124985565"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a952708b6c91678c24bfe58f1215c51e2656a4c2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a952708b6c91678c24bfe58f1215c51e2656a4c2", "html_url": "https://github.com/rust-lang/rust/commit/a952708b6c91678c24bfe58f1215c51e2656a4c2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a952708b6c91678c24bfe58f1215c51e2656a4c2/comments", "author": null, "committer": null, "parents": [{"sha": "eae7b997dd41e397a2c01a5b6724d0b38353e686", "url": "https://api.github.com/repos/rust-lang/rust/commits/eae7b997dd41e397a2c01a5b6724d0b38353e686", "html_url": "https://github.com/rust-lang/rust/commit/eae7b997dd41e397a2c01a5b6724d0b38353e686"}], "stats": {"total": 65, "additions": 63, "deletions": 2}, "files": [{"sha": "941a974a828e0bc9c5d6c3440275c0b7fa010c51", "filename": "clippy_lints/src/use_self.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a952708b6c91678c24bfe58f1215c51e2656a4c2/clippy_lints%2Fsrc%2Fuse_self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a952708b6c91678c24bfe58f1215c51e2656a4c2/clippy_lints%2Fsrc%2Fuse_self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fuse_self.rs?ref=a952708b6c91678c24bfe58f1215c51e2656a4c2", "patch": "@@ -223,7 +223,7 @@ struct UseSelfVisitor<'a, 'tcx> {\n \n impl<'a, 'tcx> Visitor<'tcx> for UseSelfVisitor<'a, 'tcx> {\n     fn visit_path(&mut self, path: &'tcx Path, _id: HirId) {\n-        if path.segments.len() >= 2 {\n+        if path.segments.len() >= 2 && !path.segments.iter().any(|p| p.ident.span.is_dummy()) {\n             let last_but_one = &path.segments[path.segments.len() - 2];\n             if last_but_one.ident.name != kw::SelfUpper {\n                 let enum_def_id = match path.res {"}, {"sha": "952a322e325f430260428809688e56773802d966", "filename": "tests/ui/crashes/ice-4727-aux.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/a952708b6c91678c24bfe58f1215c51e2656a4c2/tests%2Fui%2Fcrashes%2Fice-4727-aux.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a952708b6c91678c24bfe58f1215c51e2656a4c2/tests%2Fui%2Fcrashes%2Fice-4727-aux.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcrashes%2Fice-4727-aux.rs?ref=a952708b6c91678c24bfe58f1215c51e2656a4c2", "patch": "@@ -0,0 +1,13 @@\n+//ignore-test\n+\n+// This file is used by the ice-4727 test but isn't itself a test.\n+//\n+pub trait Trait {\n+    fn fun(par: &str) -> &str;\n+}\n+\n+impl Trait for str {\n+    fn fun(par: &str) -> &str {\n+        &par[0..1]\n+    }\n+}"}, {"sha": "d94384929017638c6699746b7d93f45b589f146b", "filename": "tests/ui/crashes/ice-4727.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/a952708b6c91678c24bfe58f1215c51e2656a4c2/tests%2Fui%2Fcrashes%2Fice-4727.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a952708b6c91678c24bfe58f1215c51e2656a4c2/tests%2Fui%2Fcrashes%2Fice-4727.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fcrashes%2Fice-4727.rs?ref=a952708b6c91678c24bfe58f1215c51e2656a4c2", "patch": "@@ -0,0 +1,8 @@\n+// run-pass\n+\n+#![warn(clippy::use_self)]\n+\n+#[path = \"ice-4727-aux.rs\"]\n+mod aux;\n+\n+fn main() {}"}, {"sha": "84a77581abe909e925aff081141eef71e274e2a5", "filename": "tests/ui/use_self.fixed", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/a952708b6c91678c24bfe58f1215c51e2656a4c2/tests%2Fui%2Fuse_self.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/a952708b6c91678c24bfe58f1215c51e2656a4c2/tests%2Fui%2Fuse_self.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuse_self.fixed?ref=a952708b6c91678c24bfe58f1215c51e2656a4c2", "patch": "@@ -332,3 +332,17 @@ mod issue3567 {\n         }\n     }\n }\n+\n+// Test with paths in ranges\n+mod paths_in_ranges {\n+    struct S {}\n+\n+    impl S {\n+        const A: usize = 0;\n+        const B: usize = 1;\n+\n+        fn f<'a>(&self, p: &'a [u8]) -> &'a [u8] {\n+            &p[Self::A..Self::B]\n+        }\n+    }\n+}"}, {"sha": "d937f129ad4af2842979e70484a2d5db0b67cf7e", "filename": "tests/ui/use_self.rs", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/a952708b6c91678c24bfe58f1215c51e2656a4c2/tests%2Fui%2Fuse_self.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a952708b6c91678c24bfe58f1215c51e2656a4c2/tests%2Fui%2Fuse_self.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuse_self.rs?ref=a952708b6c91678c24bfe58f1215c51e2656a4c2", "patch": "@@ -332,3 +332,17 @@ mod issue3567 {\n         }\n     }\n }\n+\n+// Test with paths in ranges\n+mod paths_in_ranges {\n+    struct S {}\n+\n+    impl S {\n+        const A: usize = 0;\n+        const B: usize = 1;\n+\n+        fn f<'a>(&self, p: &'a [u8]) -> &'a [u8] {\n+            &p[S::A..S::B]\n+        }\n+    }\n+}"}, {"sha": "f24bb1dfada6288cdb811f55d17e78343d42c538", "filename": "tests/ui/use_self.stderr", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/a952708b6c91678c24bfe58f1215c51e2656a4c2/tests%2Fui%2Fuse_self.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/a952708b6c91678c24bfe58f1215c51e2656a4c2/tests%2Fui%2Fuse_self.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fuse_self.stderr?ref=a952708b6c91678c24bfe58f1215c51e2656a4c2", "patch": "@@ -222,5 +222,17 @@ error: unnecessary structure name repetition\n LL |             TestStruct::from_something()\n    |             ^^^^^^^^^^ help: use the applicable keyword: `Self`\n \n-error: aborting due to 36 previous errors\n+error: unnecessary structure name repetition\n+  --> $DIR/use_self.rs:345:16\n+   |\n+LL |             &p[S::A..S::B]\n+   |                ^ help: use the applicable keyword: `Self`\n+\n+error: unnecessary structure name repetition\n+  --> $DIR/use_self.rs:345:22\n+   |\n+LL |             &p[S::A..S::B]\n+   |                      ^ help: use the applicable keyword: `Self`\n+\n+error: aborting due to 38 previous errors\n "}]}