{"sha": "05ef5bcb53516436bb38cdb8601a8c4482e9ccce", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA1ZWY1YmNiNTM1MTY0MzZiYjM4Y2RiODYwMWE4YzQ0ODJlOWNjY2U=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-04-24T03:57:08Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-04-24T03:57:08Z"}, "message": "Rollup merge of #50118 - GuillaumeGomez:search-bar-bug, r=QuietMisdreavus\n\nfix search bar bug\n\nFixes #50064.\n\nr? @QuietMisdreavus", "tree": {"sha": "4bfd69de7992f3e3fd6c6425f68cc193fd56c292", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4bfd69de7992f3e3fd6c6425f68cc193fd56c292"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/05ef5bcb53516436bb38cdb8601a8c4482e9ccce", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJa3qsUCRBK7hj4Ov3rIwAAdHIIAKElILnfN7Hvn5FzYlPGZKsw\nLCKdmJPliJgQJfsDruAuRQGHC3EUWA5gn7PfexA/dMaPrxcRwKnkNRqK6EAUj/Sl\nHMtEhTej2sjZLg7GPNbhyedph3R2X4ZB2togOSK7JO76ZzCKE48LZqQ+T6yt5kVh\nb1REfJI+0wFPRU2EKjc68pN6FARv8PDCfTxd6RQvPUl2ji9QJ5pzIdyccDUHxFLT\nzqhZGy0d72ya/BPNRAXHk6MxKkw8NV+83zMuS51Sb7meHrCEYNGMWMffOa1kyLNT\nRCw4Ut2tmUCkvC1oTE7fUoWq5PHlI/l/txOFpDeynOMIu0MbAAPZ+N/7vm8JTF4=\n=RNSH\n-----END PGP SIGNATURE-----\n", "payload": "tree 4bfd69de7992f3e3fd6c6425f68cc193fd56c292\nparent 7c552a299db51ba35f7a47d0dabd24d6b7ee241b\nparent f33af5c4dedb10bf4eaee0ce2e83c6f05d07692f\nauthor kennytm <kennytm@gmail.com> 1524542228 +0800\ncommitter GitHub <noreply@github.com> 1524542228 +0800\n\nRollup merge of #50118 - GuillaumeGomez:search-bar-bug, r=QuietMisdreavus\n\nfix search bar bug\n\nFixes #50064.\n\nr? @QuietMisdreavus\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/05ef5bcb53516436bb38cdb8601a8c4482e9ccce", "html_url": "https://github.com/rust-lang/rust/commit/05ef5bcb53516436bb38cdb8601a8c4482e9ccce", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/05ef5bcb53516436bb38cdb8601a8c4482e9ccce/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7c552a299db51ba35f7a47d0dabd24d6b7ee241b", "url": "https://api.github.com/repos/rust-lang/rust/commits/7c552a299db51ba35f7a47d0dabd24d6b7ee241b", "html_url": "https://github.com/rust-lang/rust/commit/7c552a299db51ba35f7a47d0dabd24d6b7ee241b"}, {"sha": "f33af5c4dedb10bf4eaee0ce2e83c6f05d07692f", "url": "https://api.github.com/repos/rust-lang/rust/commits/f33af5c4dedb10bf4eaee0ce2e83c6f05d07692f", "html_url": "https://github.com/rust-lang/rust/commit/f33af5c4dedb10bf4eaee0ce2e83c6f05d07692f"}], "stats": {"total": 28, "additions": 18, "deletions": 10}, "files": [{"sha": "ef8bf2244d97763186352b7593fb50a3da93dd4a", "filename": "src/librustdoc/html/static/main.js", "status": "modified", "additions": 18, "deletions": 10, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/05ef5bcb53516436bb38cdb8601a8c4482e9ccce/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/05ef5bcb53516436bb38cdb8601a8c4482e9ccce/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fmain.js?ref=05ef5bcb53516436bb38cdb8601a8c4482e9ccce", "patch": "@@ -1375,13 +1375,17 @@\n \n         function search(e) {\n             var params = getQueryStringParams();\n-            var query = getQuery(document.getElementsByClassName('search-input')[0].value.trim());\n+            var search_input = document.getElementsByClassName('search-input')[0];\n+            var query = getQuery(search_input.value.trim());\n \n             if (e) {\n                 e.preventDefault();\n             }\n \n             if (!query.query || query.id === currentResults) {\n+                if (query.query.length > 0) {\n+                    putBackSearch(search_input);\n+                }\n                 return;\n             }\n \n@@ -2072,19 +2076,23 @@\n         };\n     });\n \n+    function putBackSearch(search_input) {\n+        if (search_input.value !== \"\") {\n+            addClass(document.getElementById(\"main\"), \"hidden\");\n+            removeClass(document.getElementById(\"search\"), \"hidden\");\n+            if (browserSupportsHistoryApi()) {\n+                history.replaceState(search_input.value,\n+                                     \"\",\n+                                     \"?search=\" + encodeURIComponent(search_input.value));\n+            }\n+        }\n+    }\n+\n     var search_input = document.getElementsByClassName(\"search-input\")[0];\n \n     if (search_input) {\n         search_input.onfocus = function() {\n-            if (search_input.value !== \"\") {\n-                addClass(document.getElementById(\"main\"), \"hidden\");\n-                removeClass(document.getElementById(\"search\"), \"hidden\");\n-                if (browserSupportsHistoryApi()) {\n-                    history.replaceState(search_input.value,\n-                                         \"\",\n-                                         \"?search=\" + encodeURIComponent(search_input.value));\n-                }\n-            }\n+            putBackSearch(this);\n         };\n     }\n "}]}