{"sha": "ed7ceebfe07c674933b002beda88391ad5cd6066", "node_id": "MDY6Q29tbWl0NzI0NzEyOmVkN2NlZWJmZTA3YzY3NDkzM2IwMDJiZWRhODgzOTFhZDVjZDYwNjY=", "commit": {"author": {"name": "Seiichi Uchida", "email": "seuchida@gmail.com", "date": "2017-10-07T13:17:01Z"}, "committer": {"name": "Seiichi Uchida", "email": "seuchida@gmail.com", "date": "2017-10-07T13:45:33Z"}, "message": "Faster last_line_extendable()", "tree": {"sha": "d8d9a34c046ddfddd8aea34af5d16ac1abeead4d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d8d9a34c046ddfddd8aea34af5d16ac1abeead4d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ed7ceebfe07c674933b002beda88391ad5cd6066", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ed7ceebfe07c674933b002beda88391ad5cd6066", "html_url": "https://github.com/rust-lang/rust/commit/ed7ceebfe07c674933b002beda88391ad5cd6066", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ed7ceebfe07c674933b002beda88391ad5cd6066/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d38b3acee148f1ee5b4b7284bc68f89e5c09bbfc", "url": "https://api.github.com/repos/rust-lang/rust/commits/d38b3acee148f1ee5b4b7284bc68f89e5c09bbfc", "html_url": "https://github.com/rust-lang/rust/commit/d38b3acee148f1ee5b4b7284bc68f89e5c09bbfc"}], "stats": {"total": 18, "additions": 12, "deletions": 6}, "files": [{"sha": "3106df9ed8b2ff8f703085b491c5ed2fba7f4d0d", "filename": "src/utils.rs", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/ed7ceebfe07c674933b002beda88391ad5cd6066/src%2Futils.rs", "raw_url": "https://github.com/rust-lang/rust/raw/ed7ceebfe07c674933b002beda88391ad5cd6066/src%2Futils.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Futils.rs?ref=ed7ceebfe07c674933b002beda88391ad5cd6066", "patch": "@@ -171,12 +171,18 @@ pub fn trimmed_last_line_width(s: &str) -> usize {\n \n #[inline]\n pub fn last_line_extendable(s: &str) -> bool {\n-    s.lines().last().map_or(false, |s| {\n-        s.ends_with(\"\\\"#\")\n-            || s.trim()\n-                .chars()\n-                .all(|c| c == ')' || c == ']' || c == '}' || c == '?')\n-    })\n+    if s.ends_with(\"\\\"#\") {\n+        return true;\n+    }\n+    for c in s.chars().rev() {\n+        match c {\n+            ')' | ']' | '}' | '?' => continue,\n+            '\\n' => break,\n+            _ if c.is_whitespace() => continue,\n+            _ => return false,\n+        }\n+    }\n+    true\n }\n \n #[inline]"}]}