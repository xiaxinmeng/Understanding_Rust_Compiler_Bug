{"sha": "4ee11cd210ccb9a9be04ccab731cdaac5f4dea4c", "node_id": "MDY6Q29tbWl0NzI0NzEyOjRlZTExY2QyMTBjY2I5YTliZTA0Y2NhYjczMWNkYWFjNWY0ZGVhNGM=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-11-04T18:52:07Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2015-11-04T18:52:07Z"}, "message": "Auto merge of #29536 - sanxiyn:unused-assign-arg, r=alexcrichton\n\nFix #29136.", "tree": {"sha": "0b32a26aca9891a0a24ab677fd71f986f68828c7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0b32a26aca9891a0a24ab677fd71f986f68828c7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4ee11cd210ccb9a9be04ccab731cdaac5f4dea4c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4ee11cd210ccb9a9be04ccab731cdaac5f4dea4c", "html_url": "https://github.com/rust-lang/rust/commit/4ee11cd210ccb9a9be04ccab731cdaac5f4dea4c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4ee11cd210ccb9a9be04ccab731cdaac5f4dea4c/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8fa8684b4c70989fefd42399d9cdce8627722e3c", "url": "https://api.github.com/repos/rust-lang/rust/commits/8fa8684b4c70989fefd42399d9cdce8627722e3c", "html_url": "https://github.com/rust-lang/rust/commit/8fa8684b4c70989fefd42399d9cdce8627722e3c"}, {"sha": "61e5b6dfdbb34d9569ebddc6af09cb5a5beb605a", "url": "https://api.github.com/repos/rust-lang/rust/commits/61e5b6dfdbb34d9569ebddc6af09cb5a5beb605a", "html_url": "https://github.com/rust-lang/rust/commit/61e5b6dfdbb34d9569ebddc6af09cb5a5beb605a"}], "stats": {"total": 30, "additions": 26, "deletions": 4}, "files": [{"sha": "b25ad66fd1fa57be9fd117e3e3e8d14e09a1d650", "filename": "src/librustc/middle/liveness.rs", "status": "modified", "additions": 16, "deletions": 4, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/4ee11cd210ccb9a9be04ccab731cdaac5f4dea4c/src%2Flibrustc%2Fmiddle%2Fliveness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4ee11cd210ccb9a9be04ccab731cdaac5f4dea4c/src%2Flibrustc%2Fmiddle%2Fliveness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmiddle%2Fliveness.rs?ref=4ee11cd210ccb9a9be04ccab731cdaac5f4dea4c", "patch": "@@ -1555,7 +1555,11 @@ impl<'a, 'tcx> Liveness<'a, 'tcx> {\n                 // Ignore unused self.\n                 let name = path1.node;\n                 if name != special_idents::self_.name {\n-                    self.warn_about_unused(sp, p_id, entry_ln, var);\n+                    if !self.warn_about_unused(sp, p_id, entry_ln, var) {\n+                        if self.live_on_entry(entry_ln, var).is_none() {\n+                            self.report_dead_assign(p_id, sp, var, true);\n+                        }\n+                    }\n                 }\n             })\n         }\n@@ -1609,11 +1613,19 @@ impl<'a, 'tcx> Liveness<'a, 'tcx> {\n                               ln: LiveNode,\n                               var: Variable) {\n         if self.live_on_exit(ln, var).is_none() {\n-            let r = self.should_warn(var);\n-            if let Some(name) = r {\n+            self.report_dead_assign(id, sp, var, false);\n+        }\n+    }\n+\n+    fn report_dead_assign(&self, id: NodeId, sp: Span, var: Variable, is_argument: bool) {\n+        if let Some(name) = self.should_warn(var) {\n+            if is_argument {\n+                self.ir.tcx.sess.add_lint(lint::builtin::UNUSED_ASSIGNMENTS, id, sp,\n+                    format!(\"value passed to `{}` is never read\", name));\n+            } else {\n                 self.ir.tcx.sess.add_lint(lint::builtin::UNUSED_ASSIGNMENTS, id, sp,\n                     format!(\"value assigned to `{}` is never read\", name));\n             }\n         }\n     }\n- }\n+}"}, {"sha": "ddd8fc68c43a3ef8caaab3a9c61f8ab45659b507", "filename": "src/test/compile-fail/liveness-dead.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/4ee11cd210ccb9a9be04ccab731cdaac5f4dea4c/src%2Ftest%2Fcompile-fail%2Fliveness-dead.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4ee11cd210ccb9a9be04ccab731cdaac5f4dea4c/src%2Ftest%2Fcompile-fail%2Fliveness-dead.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Fliveness-dead.rs?ref=4ee11cd210ccb9a9be04ccab731cdaac5f4dea4c", "patch": "@@ -27,4 +27,14 @@ fn f3() {\n     x = 4; //~ ERROR: value assigned to `x` is never read\n }\n \n+fn f4(mut x: i32) { //~ ERROR: value passed to `x` is never read\n+    x = 4;\n+    x.clone();\n+}\n+\n+fn f5(mut x: i32) {\n+    x.clone();\n+    x = 4; //~ ERROR: value assigned to `x` is never read\n+}\n+\n fn main() {}"}]}