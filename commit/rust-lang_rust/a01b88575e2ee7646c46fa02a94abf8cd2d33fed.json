{"sha": "a01b88575e2ee7646c46fa02a94abf8cd2d33fed", "node_id": "C_kwDOAAsO6NoAKGEwMWI4ODU3NWUyZWU3NjQ2YzQ2ZmEwMmE5NGFiZjhjZDJkMzNmZWQ", "commit": {"author": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-10-18T18:14:01Z"}, "committer": {"name": "Michael Howell", "email": "michael@notriddle.com", "date": "2022-10-18T19:01:53Z"}, "message": "rustdoc: remove class name `location` from sidebar sibling nav\n\nThis change tweaks the CSS to apply most of its styles to `.sidebar h2`,\ncleaning up a few redundant rules from `.mobile-topbar .location` and\nrestoring useful navigation aids in mobile mode.", "tree": {"sha": "2e4bbb8cf8eed4e7775670a50768c17ba62ac883", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2e4bbb8cf8eed4e7775670a50768c17ba62ac883"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a01b88575e2ee7646c46fa02a94abf8cd2d33fed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a01b88575e2ee7646c46fa02a94abf8cd2d33fed", "html_url": "https://github.com/rust-lang/rust/commit/a01b88575e2ee7646c46fa02a94abf8cd2d33fed", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a01b88575e2ee7646c46fa02a94abf8cd2d33fed/comments", "author": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "notriddle", "id": 1593513, "node_id": "MDQ6VXNlcjE1OTM1MTM=", "avatar_url": "https://avatars.githubusercontent.com/u/1593513?v=4", "gravatar_id": "", "url": "https://api.github.com/users/notriddle", "html_url": "https://github.com/notriddle", "followers_url": "https://api.github.com/users/notriddle/followers", "following_url": "https://api.github.com/users/notriddle/following{/other_user}", "gists_url": "https://api.github.com/users/notriddle/gists{/gist_id}", "starred_url": "https://api.github.com/users/notriddle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/notriddle/subscriptions", "organizations_url": "https://api.github.com/users/notriddle/orgs", "repos_url": "https://api.github.com/users/notriddle/repos", "events_url": "https://api.github.com/users/notriddle/events{/privacy}", "received_events_url": "https://api.github.com/users/notriddle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e94827e5b09b5b098ea10d0c57a84892fc73b5a7", "url": "https://api.github.com/repos/rust-lang/rust/commits/e94827e5b09b5b098ea10d0c57a84892fc73b5a7", "html_url": "https://github.com/rust-lang/rust/commit/e94827e5b09b5b098ea10d0c57a84892fc73b5a7"}], "stats": {"total": 77, "additions": 39, "deletions": 38}, "files": [{"sha": "eeec6f8fee7786f0eebe53520149afc3e900a8a9", "filename": "src/librustdoc/html/render/mod.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a01b88575e2ee7646c46fa02a94abf8cd2d33fed/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a01b88575e2ee7646c46fa02a94abf8cd2d33fed/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender%2Fmod.rs?ref=a01b88575e2ee7646c46fa02a94abf8cd2d33fed", "patch": "@@ -1884,7 +1884,7 @@ fn print_sidebar(cx: &Context<'_>, it: &clean::Item, buffer: &mut Buffer) {\n     if !it.is_mod() {\n         let path: String = cx.current.iter().map(|s| s.as_str()).intersperse(\"::\").collect();\n \n-        write!(buffer, \"<h2 class=\\\"location\\\"><a href=\\\"index.html\\\">In {}</a></h2>\", path);\n+        write!(buffer, \"<h2><a href=\\\"index.html\\\">In {}</a></h2>\", path);\n     }\n \n     // Closes sidebar-elems div."}, {"sha": "0dd77ff8d9d382f75d671ea949c713057566d423", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 18, "deletions": 25, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/a01b88575e2ee7646c46fa02a94abf8cd2d33fed/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/a01b88575e2ee7646c46fa02a94abf8cd2d33fed/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=a01b88575e2ee7646c46fa02a94abf8cd2d33fed", "patch": "@@ -171,7 +171,7 @@ h1.fqn {\n \t Rustdoc-generated h2 section headings (e.g. \"Implementations\", \"Required Methods\", etc)\n \tUnderlines elsewhere in the documentation break up visual flow and tend to invert\n \tsection hierarchies. */\n-h2,\n+.content h2,\n .top-doc .docblock > h3,\n .top-doc .docblock > h4 {\n \tborder-bottom: 1px solid var(--headings-border-bottom-color);\n@@ -397,15 +397,6 @@ img {\n \tleft: 0;\n }\n \n-.sidebar-elems,\n-.sidebar > .location {\n-\tpadding-left: 24px;\n-}\n-\n-.sidebar .location {\n-\toverflow-wrap: anywhere;\n-}\n-\n .rustdoc.source .sidebar {\n \twidth: 50px;\n \tmin-width: 0px;\n@@ -504,8 +495,8 @@ ul.block, .block li {\n }\n \n .block a,\n-.sidebar h3 a,\n-h2.location a {\n+.sidebar h2 a,\n+.sidebar h3 a {\n \tdisplay: block;\n \tpadding: 0.25rem;\n \tmargin-left: -0.25rem;\n@@ -515,8 +506,7 @@ h2.location a {\n }\n \n .sidebar h2 {\n-\tborder-bottom: none;\n-\tfont-weight: 500;\n+\toverflow-wrap: anywhere;\n \tpadding: 0;\n \tmargin: 0;\n \tmargin-top: 0.7rem;\n@@ -525,11 +515,15 @@ h2.location a {\n \n .sidebar h3 {\n \tfont-size: 1.125rem; /* 18px */\n-\tfont-weight: 500;\n \tpadding: 0;\n \tmargin: 0;\n }\n \n+.sidebar-elems,\n+.sidebar > h2 {\n+\tpadding-left: 24px;\n+}\n+\n .sidebar a, .sidebar .current {\n \tcolor: var(--sidebar-link-color);\n }\n@@ -1798,25 +1792,24 @@ in storage.js plus the media query with (min-width: 701px)\n \t\twidth: 0;\n \t}\n \n-\t.mobile-topbar .location a {\n-\t\tpadding: 0;\n-\t\tmargin: 0;\n-\t}\n-\n-\t.mobile-topbar .location {\n-\t\tborder: none;\n-\t\tpadding: 0;\n+\t.mobile-topbar h2 {\n+\t\tpadding-bottom: 0;\n \t\tmargin: auto 0.5em auto auto;\n-\t\ttext-overflow: ellipsis;\n \t\toverflow: hidden;\n-\t\twhite-space: nowrap;\n \t\t/* Rare exception to specifying font sizes in rem. Since the topbar\n \t\t   height is specified in pixels, this also has to be specified in\n \t\t   pixels to avoid overflowing the topbar when the user sets a bigger\n \t\t   font size. */\n \t\tfont-size: 24px;\n \t}\n \n+\t.mobile-topbar h2 a {\n+\t\tdisplay: block;\n+\t\ttext-overflow: ellipsis;\n+\t\toverflow: hidden;\n+\t\twhite-space: nowrap;\n+\t}\n+\n \t.mobile-topbar .logo-container {\n \t\tmax-height: 45px;\n \t}"}, {"sha": "b9a99e1e7991961d092d135165054d6c2a1972f5", "filename": "src/librustdoc/html/static/js/main.js", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a01b88575e2ee7646c46fa02a94abf8cd2d33fed/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "raw_url": "https://github.com/rust-lang/rust/raw/a01b88575e2ee7646c46fa02a94abf8cd2d33fed/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fjs%2Fmain.js?ref=a01b88575e2ee7646c46fa02a94abf8cd2d33fed", "patch": "@@ -55,7 +55,7 @@ function blurHandler(event, parentElem, hideCallback) {\n function setMobileTopbar() {\n     // FIXME: It would be nicer to generate this text content directly in HTML,\n     // but with the current code it's hard to get the right information in the right place.\n-    const mobileLocationTitle = document.querySelector(\".mobile-topbar h2.location\");\n+    const mobileLocationTitle = document.querySelector(\".mobile-topbar h2\");\n     const locationTitle = document.querySelector(\".sidebar h2.location\");\n     if (mobileLocationTitle && locationTitle) {\n         mobileLocationTitle.innerHTML = locationTitle.innerHTML;"}, {"sha": "20a314a1c00e3d628206abcdc30d838d85baa38e", "filename": "src/librustdoc/html/templates/page.html", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a01b88575e2ee7646c46fa02a94abf8cd2d33fed/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html", "raw_url": "https://github.com/rust-lang/rust/raw/a01b88575e2ee7646c46fa02a94abf8cd2d33fed/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Ftemplates%2Fpage.html?ref=a01b88575e2ee7646c46fa02a94abf8cd2d33fed", "patch": "@@ -85,7 +85,7 @@\n             {%- endif -%}\n             </div> {#- -#}\n         </a> {#- -#}\n-        <h2 class=\"location\"></h2> {#- -#}\n+        <h2></h2> {#- -#}\n     </nav> {#- -#}\n     {%- endif -%}\n     <nav class=\"sidebar\"> {#- -#}"}, {"sha": "704542a39d21b5678c50f3227306c0ab4842cda0", "filename": "src/test/rustdoc-gui/mobile.goml", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a01b88575e2ee7646c46fa02a94abf8cd2d33fed/src%2Ftest%2Frustdoc-gui%2Fmobile.goml", "raw_url": "https://github.com/rust-lang/rust/raw/a01b88575e2ee7646c46fa02a94abf8cd2d33fed/src%2Ftest%2Frustdoc-gui%2Fmobile.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fmobile.goml?ref=a01b88575e2ee7646c46fa02a94abf8cd2d33fed", "patch": "@@ -12,7 +12,7 @@ assert-css: (\".main-heading\", {\n   \"flex-direction\": \"column\"\n })\n \n-assert-property: (\".mobile-topbar h2.location\", {\"offsetHeight\": 36})\n+assert-property: (\".mobile-topbar h2\", {\"offsetHeight\": 36})\n \n // Note: We can't use assert-text here because the 'Since' is set by CSS and\n // is therefore not part of the DOM."}, {"sha": "453873f1b81b6f36270e0f751bd7511d1fb797e8", "filename": "src/test/rustdoc-gui/sidebar-mobile.goml", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/a01b88575e2ee7646c46fa02a94abf8cd2d33fed/src%2Ftest%2Frustdoc-gui%2Fsidebar-mobile.goml", "raw_url": "https://github.com/rust-lang/rust/raw/a01b88575e2ee7646c46fa02a94abf8cd2d33fed/src%2Ftest%2Frustdoc-gui%2Fsidebar-mobile.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsidebar-mobile.goml?ref=a01b88575e2ee7646c46fa02a94abf8cd2d33fed", "patch": "@@ -23,6 +23,11 @@ assert-css: (\".sidebar\", {\"display\": \"block\", \"left\": \"-1000px\"})\n click: \".sidebar-menu-toggle\"\n assert-css: (\".sidebar\", {\"left\": \"0px\"})\n \n+// Make sure the \"struct Foo\" header is hidden, since the mobile topbar already does it.\n+assert-css: (\"//nav[contains(@class, 'sidebar')]//h2/a[text()='Foo']/parent::h2\", {\"display\": \"none\"})\n+// Make sure the global navigation is still here.\n+assert-css: (\"//nav[contains(@class, 'sidebar')]//h2/a[text()='In test_docs']/parent::h2\", {\"display\": \"block\"})\n+\n // Click elsewhere.\n click: \"body\"\n assert-css: (\".sidebar\", {\"display\": \"block\", \"left\": \"-1000px\"})\n@@ -39,7 +44,7 @@ assert-position: (\"#method\\.must_use\", {\"y\": 45})\n // Check that the bottom-most item on the sidebar menu can be scrolled fully into view.\n click: \".sidebar-menu-toggle\"\n scroll-to: \".block.keyword li:nth-child(1)\"\n-compare-elements-position-near: (\".block.keyword li:nth-child(1)\", \".mobile-topbar\", {\"y\": 543})\n+compare-elements-position-near: (\".block.keyword li:nth-child(1)\", \".mobile-topbar\", {\"y\": 543.19})\n \n // Now checking the background color of the sidebar.\n show-text: true"}, {"sha": "c92561b0de14fd182ed1030823cb3cb03894063f", "filename": "src/test/rustdoc-gui/sidebar.goml", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/a01b88575e2ee7646c46fa02a94abf8cd2d33fed/src%2Ftest%2Frustdoc-gui%2Fsidebar.goml", "raw_url": "https://github.com/rust-lang/rust/raw/a01b88575e2ee7646c46fa02a94abf8cd2d33fed/src%2Ftest%2Frustdoc-gui%2Fsidebar.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Fsidebar.goml?ref=a01b88575e2ee7646c46fa02a94abf8cd2d33fed", "patch": "@@ -9,6 +9,7 @@ reload:\n assert-text: (\".sidebar > .location\", \"Crate test_docs\")\n // In modules, we only have one \"location\" element.\n assert-count: (\".sidebar .location\", 1)\n+assert-count: (\".sidebar h2\", 1)\n assert-text: (\"#all-types\", \"All Items\")\n assert-css: (\"#all-types\", {\"color\": \"rgb(53, 109, 164)\"})\n // We check that we have the crates list and that the \"current\" on is \"test_docs\".\n@@ -28,7 +29,8 @@ assert-text: (\"#structs + .item-table .item-left > a\", \"Foo\")\n click: \"#structs + .item-table .item-left > a\"\n \n // PAGE: struct.Foo.html\n-assert-count: (\".sidebar .location\", 2)\n+assert-count: (\".sidebar .location\", 1)\n+assert-count: (\".sidebar h2\", 2)\n // We check that there is no crate listed outside of the top level.\n assert-false: \".sidebar-elems > .crate\"\n \n@@ -60,10 +62,11 @@ assert-text: (\"#functions + .item-table .item-left > a\", \"foobar\")\n click: \"#functions + .item-table .item-left > a\"\n \n // PAGE: fn.foobar.html\n-// In items containing no items (like functions or constants) and in modules, we have one\n-// \"location\" elements.\n-assert-count: (\".sidebar .location\", 1)\n-assert-text: (\".sidebar .sidebar-elems .location\", \"In lib2\")\n+// In items containing no items (like functions or constants) and in modules, we have no\n+// \"location\" elements. Only the parent module h2.\n+assert-count: (\".sidebar .location\", 0)\n+assert-count: (\".sidebar h2\", 1)\n+assert-text: (\".sidebar .sidebar-elems h2\", \"In lib2\")\n // We check that we don't have the crate list.\n assert-false: \".sidebar-elems > .crate\"\n "}, {"sha": "fce3002e7508f89d1f4fe0f5b7f9377d9498c67a", "filename": "src/test/rustdoc-gui/type-declation-overflow.goml", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/a01b88575e2ee7646c46fa02a94abf8cd2d33fed/src%2Ftest%2Frustdoc-gui%2Ftype-declation-overflow.goml", "raw_url": "https://github.com/rust-lang/rust/raw/a01b88575e2ee7646c46fa02a94abf8cd2d33fed/src%2Ftest%2Frustdoc-gui%2Ftype-declation-overflow.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Ftype-declation-overflow.goml?ref=a01b88575e2ee7646c46fa02a94abf8cd2d33fed", "patch": "@@ -32,6 +32,6 @@ assert-property: (\".item-decl pre\", {\"scrollWidth\": \"950\"})\n size: (600, 600)\n goto: \"file://\" + |DOC_PATH| + \"/lib2/too_long/struct.SuperIncrediblyLongLongLongLongLongLongLongGigaGigaGigaMegaLongLongLongStructName.html\"\n // It shouldn't have an overflow in the topbar either.\n-store-property: (scrollWidth, \".mobile-topbar .location\", \"scrollWidth\")\n-assert-property: (\".mobile-topbar .location\", {\"clientWidth\": |scrollWidth|})\n-assert-css: (\".mobile-topbar .location\", {\"overflow-x\": \"hidden\"})\n+store-property: (scrollWidth, \".mobile-topbar h2\", \"scrollWidth\")\n+assert-property: (\".mobile-topbar h2\", {\"clientWidth\": |scrollWidth|})\n+assert-css: (\".mobile-topbar h2\", {\"overflow-x\": \"hidden\"})"}]}