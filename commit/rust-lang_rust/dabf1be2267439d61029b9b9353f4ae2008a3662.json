{"sha": "dabf1be2267439d61029b9b9353f4ae2008a3662", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRhYmYxYmUyMjY3NDM5ZDYxMDI5YjliOTM1M2Y0YWUyMDA4YTM2NjI=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-09-01T21:17:11Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-09-01T21:20:02Z"}, "message": "Add a benchmark for cross-task kernel memory region synchronization\n\nVectors are allocated from the kernel's memory region, which has some heinous\nsynchronization. This is a stress test of vector allocation in many tasks.", "tree": {"sha": "829e2e385c0847879ab4c1f80152cb044d5c3d35", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/829e2e385c0847879ab4c1f80152cb044d5c3d35"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dabf1be2267439d61029b9b9353f4ae2008a3662", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dabf1be2267439d61029b9b9353f4ae2008a3662", "html_url": "https://github.com/rust-lang/rust/commit/dabf1be2267439d61029b9b9353f4ae2008a3662", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dabf1be2267439d61029b9b9353f4ae2008a3662/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "30447e10919685c490aa5211bbe0dd3059bc8bb4", "url": "https://api.github.com/repos/rust-lang/rust/commits/30447e10919685c490aa5211bbe0dd3059bc8bb4", "html_url": "https://github.com/rust-lang/rust/commit/30447e10919685c490aa5211bbe0dd3059bc8bb4"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "8450405e01cd22bd66914e4d08cd90da52d7dcfc", "filename": "src/test/bench/task-perf-vector-party.rs", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/dabf1be2267439d61029b9b9353f4ae2008a3662/src%2Ftest%2Fbench%2Ftask-perf-vector-party.rs", "raw_url": "https://github.com/rust-lang/rust/raw/dabf1be2267439d61029b9b9353f4ae2008a3662/src%2Ftest%2Fbench%2Ftask-perf-vector-party.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fbench%2Ftask-perf-vector-party.rs?ref=dabf1be2267439d61029b9b9353f4ae2008a3662", "patch": "@@ -0,0 +1,28 @@\n+// Vectors are allocated in the Rust kernel's memory region, use of\n+// which requires some amount of synchronization. This test exercises\n+// that synchronization by spawning a number of tasks and then\n+// allocating and freeing vectors.\n+\n+use std;\n+import std::vec;\n+import std::uint;\n+import std::istr;\n+import std::task;\n+\n+fn f(n: uint) {\n+    for each i in uint::range(0u, n) {\n+        let v: [u8] = [];\n+        vec::reserve(v, 1000u);\n+    }\n+}\n+\n+fn main(args: [istr]) {\n+    let n = if vec::len(args) < 2u {\n+        100u\n+    } else {\n+        uint::parse_buf(istr::bytes(args[1]), 10u)\n+    };\n+    for each i in uint::range(0u, 100u) {\n+        task::spawn(bind f(n));\n+    }\n+}\n\\ No newline at end of file"}]}