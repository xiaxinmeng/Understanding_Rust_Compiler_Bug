{"sha": "b65c2afdfd9aaee977302516c9ef177861abfe74", "node_id": "C_kwDOAAsO6NoAKGI2NWMyYWZkZmQ5YWFlZTk3NzMwMjUxNmM5ZWYxNzc4NjFhYmZlNzQ", "commit": {"author": {"name": "Ximin Luo", "email": "infinity0@debian.org", "date": "2023-05-19T04:21:59Z"}, "committer": {"name": "liushuyu", "email": "liushuyu011@gmail.com", "date": "2023-05-29T16:57:03Z"}, "message": "Fix linkage for large binaries on mips64 platforms ...\n\n... by enabling xgot feature\n\nCo-Authored-By: Zixing Liu <zixing.liu@canonical.com>", "tree": {"sha": "181e5c651a1efd1a20c03f30b0c85e5335000ec3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/181e5c651a1efd1a20c03f30b0c85e5335000ec3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b65c2afdfd9aaee977302516c9ef177861abfe74", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE6x/rcKrl3aOwzUVJI9HORTRBlDcFAmR02WEACgkQI9HORTRB\nlDfOcw/+Og1Xo101khdwy4d5Gcpg9ZbwYmglKp2lPMGg8sIOkJpz1FPSss6aQpj+\nwS/r1D1uml/nWcmGh83Jj64LCWNv5OqqiK1lo1gIBYc6r/hSkvZ6mE7rwETXLorO\nuVj4LNhZupoRBeB4N9n/n/lxgcDJNmk/KwGpGA4qfJRMH74167HeCRYypnO/fJpD\n+S9F7lBU45qLwgjGBtZDlKBd7kHQwEdfgklVkgptVf54ej7EuPx7Kmghbzf01IYy\n6SgV5lXgQj/oSzXUwtTIstFTfhNF0DJigNXssa5KQghzThCkcQS4l8kcOqF2gIto\nDzqax23I75PRJM6cHS3UOzA3J3jfbeTxzqm95U9UkTTj0orQBLMszhpJSOX0JstX\nv9f1B8eAffrP1bX3oKwLYGcAQLAtT+0y3/WUM9LIQvt1ItVlAX9EdLr3rzfezpHa\nURfJC18//fIBM86OdNSzcCQbfioa46ePlgRrvXtI9qO4/rbli6KitfUAntOOge3N\nzZg6LSqTnjjzC0kiDEbtulRC2lxN7EwT45gyDLFWddT/pSSF5yeaQlbxXMPngz6U\nEN+O25sX0Whi0VovOkqOy+VxmcnkZJWTxPy+BOEipD+mPAyzrilAcfiw50cAKUyd\nu8Nr67B3PDej8OCyzwTbKUGNxZlo7TfTjY2Ka3KE0o29u9UEK/E=\n=cppA\n-----END PGP SIGNATURE-----", "payload": "tree 181e5c651a1efd1a20c03f30b0c85e5335000ec3\nparent 498553fc04f6a3fdc53412320f4e913bc53bc267\nauthor Ximin Luo <infinity0@debian.org> 1684470119 -0600\ncommitter liushuyu <liushuyu011@gmail.com> 1685379423 -0600\n\nFix linkage for large binaries on mips64 platforms ...\n\n... by enabling xgot feature\n\nCo-Authored-By: Zixing Liu <zixing.liu@canonical.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b65c2afdfd9aaee977302516c9ef177861abfe74", "html_url": "https://github.com/rust-lang/rust/commit/b65c2afdfd9aaee977302516c9ef177861abfe74", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b65c2afdfd9aaee977302516c9ef177861abfe74/comments", "author": {"login": "infinity0", "id": 78398, "node_id": "MDQ6VXNlcjc4Mzk4", "avatar_url": "https://avatars.githubusercontent.com/u/78398?v=4", "gravatar_id": "", "url": "https://api.github.com/users/infinity0", "html_url": "https://github.com/infinity0", "followers_url": "https://api.github.com/users/infinity0/followers", "following_url": "https://api.github.com/users/infinity0/following{/other_user}", "gists_url": "https://api.github.com/users/infinity0/gists{/gist_id}", "starred_url": "https://api.github.com/users/infinity0/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/infinity0/subscriptions", "organizations_url": "https://api.github.com/users/infinity0/orgs", "repos_url": "https://api.github.com/users/infinity0/repos", "events_url": "https://api.github.com/users/infinity0/events{/privacy}", "received_events_url": "https://api.github.com/users/infinity0/received_events", "type": "User", "site_admin": false}, "committer": {"login": "liushuyu", "id": 6829345, "node_id": "MDQ6VXNlcjY4MjkzNDU=", "avatar_url": "https://avatars.githubusercontent.com/u/6829345?v=4", "gravatar_id": "", "url": "https://api.github.com/users/liushuyu", "html_url": "https://github.com/liushuyu", "followers_url": "https://api.github.com/users/liushuyu/followers", "following_url": "https://api.github.com/users/liushuyu/following{/other_user}", "gists_url": "https://api.github.com/users/liushuyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/liushuyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/liushuyu/subscriptions", "organizations_url": "https://api.github.com/users/liushuyu/orgs", "repos_url": "https://api.github.com/users/liushuyu/repos", "events_url": "https://api.github.com/users/liushuyu/events{/privacy}", "received_events_url": "https://api.github.com/users/liushuyu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "498553fc04f6a3fdc53412320f4e913bc53bc267", "url": "https://api.github.com/repos/rust-lang/rust/commits/498553fc04f6a3fdc53412320f4e913bc53bc267", "html_url": "https://github.com/rust-lang/rust/commit/498553fc04f6a3fdc53412320f4e913bc53bc267"}], "stats": {"total": 22, "additions": 16, "deletions": 6}, "files": [{"sha": "b9df0046b12bafb9c3d07306ac701789f836123e", "filename": "compiler/rustc_target/src/spec/mips64_unknown_linux_gnuabi64.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b65c2afdfd9aaee977302516c9ef177861abfe74/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmips64_unknown_linux_gnuabi64.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b65c2afdfd9aaee977302516c9ef177861abfe74/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmips64_unknown_linux_gnuabi64.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmips64_unknown_linux_gnuabi64.rs?ref=b65c2afdfd9aaee977302516c9ef177861abfe74", "patch": "@@ -12,7 +12,7 @@ pub fn target() -> Target {\n             endian: Endian::Big,\n             // NOTE(mips64r2) matches C toolchain\n             cpu: \"mips64r2\".into(),\n-            features: \"+mips64r2\".into(),\n+            features: \"+mips64r2,+xgot\".into(),\n             max_atomic_width: Some(64),\n             mcount: \"_mcount\".into(),\n "}, {"sha": "57ad8c47399b3cacef97d7c4fffdfe4ece82f936", "filename": "compiler/rustc_target/src/spec/mips64el_unknown_linux_gnuabi64.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/b65c2afdfd9aaee977302516c9ef177861abfe74/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmips64el_unknown_linux_gnuabi64.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b65c2afdfd9aaee977302516c9ef177861abfe74/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmips64el_unknown_linux_gnuabi64.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_target%2Fsrc%2Fspec%2Fmips64el_unknown_linux_gnuabi64.rs?ref=b65c2afdfd9aaee977302516c9ef177861abfe74", "patch": "@@ -10,7 +10,7 @@ pub fn target() -> Target {\n             abi: \"abi64\".into(),\n             // NOTE(mips64r2) matches C toolchain\n             cpu: \"mips64r2\".into(),\n-            features: \"+mips64r2\".into(),\n+            features: \"+mips64r2,+xgot\".into(),\n             max_atomic_width: Some(64),\n             mcount: \"_mcount\".into(),\n "}, {"sha": "de484f3a571a13aec1c1d1d50134e7895cf5a52d", "filename": "src/bootstrap/bootstrap.py", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/b65c2afdfd9aaee977302516c9ef177861abfe74/src%2Fbootstrap%2Fbootstrap.py", "raw_url": "https://github.com/rust-lang/rust/raw/b65c2afdfd9aaee977302516c9ef177861abfe74/src%2Fbootstrap%2Fbootstrap.py", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbootstrap.py?ref=b65c2afdfd9aaee977302516c9ef177861abfe74", "patch": "@@ -877,6 +877,12 @@ def build_bootstrap(self, color, verbose_count):\n \n         # preserve existing RUSTFLAGS\n         env.setdefault(\"RUSTFLAGS\", \"\")\n+        # we need to explicitly add +xgot here so that we can successfully bootstrap\n+        # a usable stage1 compiler\n+        # FIXME: remove this if condition on the next bootstrap bump\n+        # cfg(bootstrap)\n+        if self.build_triple().startswith('mips'):\n+            env[\"RUSTFLAGS\"] += \" -Ctarget-feature=+xgot\"\n         target_features = []\n         if self.get_toml(\"crt-static\", build_section) == \"true\":\n             target_features += [\"+crt-static\"]"}, {"sha": "27469b22980ab45b124c4fea66f7f0a8538aff3b", "filename": "tests/assembly/asm/mips-types.rs", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/b65c2afdfd9aaee977302516c9ef177861abfe74/tests%2Fassembly%2Fasm%2Fmips-types.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b65c2afdfd9aaee977302516c9ef177861abfe74/tests%2Fassembly%2Fasm%2Fmips-types.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fassembly%2Fasm%2Fmips-types.rs?ref=b65c2afdfd9aaee977302516c9ef177861abfe74", "patch": "@@ -72,7 +72,7 @@ macro_rules! check_reg { ($func:ident, $ty:ty, $reg:tt, $mov:literal) => {\n \n // mips32-LABEL: sym_static_32:\n // mips32: #APP\n-// mips32: lw $3, %got(extern_static)\n+// mips32: lw $3, %got(extern_static)($gp)\n // mips32: #NO_APP\n #[cfg(mips32)]\n #[no_mangle]\n@@ -82,7 +82,7 @@ pub unsafe fn sym_static_32() {\n \n // mips32-LABEL: sym_fn_32:\n // mips32: #APP\n-// mips32: lw $3, %got(extern_func)\n+// mips32: lw $3, %got(extern_func)($gp)\n // mips32: #NO_APP\n #[cfg(mips32)]\n #[no_mangle]\n@@ -92,7 +92,9 @@ pub unsafe fn sym_fn_32() {\n \n // mips64-LABEL: sym_static_64:\n // mips64: #APP\n-// mips64: ld $3, %got_disp(extern_static)\n+// mips64: lui    $3, %got_hi(extern_static)\n+// mips64: daddu  $3, $3, $gp\n+// mips64: ld     $3, %got_lo(extern_static)($3)\n // mips64: #NO_APP\n #[cfg(mips64)]\n #[no_mangle]\n@@ -102,7 +104,9 @@ pub unsafe fn sym_static_64() {\n \n // mips64-LABEL: sym_fn_64:\n // mips64: #APP\n-// mips64: ld $3, %got_disp(extern_func)\n+// mips64: lui    $3, %got_hi(extern_func)\n+// mips64: daddu  $3, $3, $gp\n+// mips64: ld     $3, %got_lo(extern_func)($3)\n // mips64: #NO_APP\n #[cfg(mips64)]\n #[no_mangle]"}]}