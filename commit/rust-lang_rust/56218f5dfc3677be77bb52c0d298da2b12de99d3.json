{"sha": "56218f5dfc3677be77bb52c0d298da2b12de99d3", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU2MjE4ZjVkZmMzNjc3YmU3N2JiNTJjMGQyOThkYTJiMTJkZTk5ZDM=", "commit": {"author": {"name": "Simon Sapin", "email": "simon.sapin@exyr.org", "date": "2014-07-19T15:46:14Z"}, "committer": {"name": "Simon Sapin", "email": "simon.sapin@exyr.org", "date": "2014-07-19T15:46:14Z"}, "message": "Implement FromBase64 for &[u8].\n\nThe algorithm was already based on bytes internally.\n\nAlso use byte literals instead of casting u8 to char for matching.", "tree": {"sha": "f8944348915ef525c71adfb76d04edf934f95cff", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f8944348915ef525c71adfb76d04edf934f95cff"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/56218f5dfc3677be77bb52c0d298da2b12de99d3", "comment_count": 5, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/56218f5dfc3677be77bb52c0d298da2b12de99d3", "html_url": "https://github.com/rust-lang/rust/commit/56218f5dfc3677be77bb52c0d298da2b12de99d3", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/56218f5dfc3677be77bb52c0d298da2b12de99d3/comments", "author": {"login": "SimonSapin", "id": 291359, "node_id": "MDQ6VXNlcjI5MTM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/291359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SimonSapin", "html_url": "https://github.com/SimonSapin", "followers_url": "https://api.github.com/users/SimonSapin/followers", "following_url": "https://api.github.com/users/SimonSapin/following{/other_user}", "gists_url": "https://api.github.com/users/SimonSapin/gists{/gist_id}", "starred_url": "https://api.github.com/users/SimonSapin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SimonSapin/subscriptions", "organizations_url": "https://api.github.com/users/SimonSapin/orgs", "repos_url": "https://api.github.com/users/SimonSapin/repos", "events_url": "https://api.github.com/users/SimonSapin/events{/privacy}", "received_events_url": "https://api.github.com/users/SimonSapin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "SimonSapin", "id": 291359, "node_id": "MDQ6VXNlcjI5MTM1OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/291359?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SimonSapin", "html_url": "https://github.com/SimonSapin", "followers_url": "https://api.github.com/users/SimonSapin/followers", "following_url": "https://api.github.com/users/SimonSapin/following{/other_user}", "gists_url": "https://api.github.com/users/SimonSapin/gists{/gist_id}", "starred_url": "https://api.github.com/users/SimonSapin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SimonSapin/subscriptions", "organizations_url": "https://api.github.com/users/SimonSapin/orgs", "repos_url": "https://api.github.com/users/SimonSapin/repos", "events_url": "https://api.github.com/users/SimonSapin/events{/privacy}", "received_events_url": "https://api.github.com/users/SimonSapin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e0a6e2b41421928206cc71be27da1239b4598ed1", "url": "https://api.github.com/repos/rust-lang/rust/commits/e0a6e2b41421928206cc71be27da1239b4598ed1", "html_url": "https://github.com/rust-lang/rust/commit/e0a6e2b41421928206cc71be27da1239b4598ed1"}], "stats": {"total": 46, "additions": 29, "deletions": 17}, "files": [{"sha": "79c1d6554113f1b665e6c7e381c582f4aaf30d7d", "filename": "src/libserialize/base64.rs", "status": "modified", "additions": 29, "deletions": 17, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/56218f5dfc3677be77bb52c0d298da2b12de99d3/src%2Flibserialize%2Fbase64.rs", "raw_url": "https://github.com/rust-lang/rust/raw/56218f5dfc3677be77bb52c0d298da2b12de99d3/src%2Flibserialize%2Fbase64.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibserialize%2Fbase64.rs?ref=56218f5dfc3677be77bb52c0d298da2b12de99d3", "patch": "@@ -161,15 +161,15 @@ pub trait FromBase64 {\n /// Errors that can occur when decoding a base64 encoded string\n pub enum FromBase64Error {\n     /// The input contained a character not part of the base64 format\n-    InvalidBase64Character(char, uint),\n+    InvalidBase64Byte(u8, uint),\n     /// The input had an invalid length\n     InvalidBase64Length,\n }\n \n impl fmt::Show for FromBase64Error {\n     fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n         match *self {\n-            InvalidBase64Character(ch, idx) =>\n+            InvalidBase64Byte(ch, idx) =>\n                 write!(f, \"Invalid character '{}' at position {}\", ch, idx),\n             InvalidBase64Length => write!(f, \"Invalid length\"),\n         }\n@@ -205,24 +205,31 @@ impl<'a> FromBase64 for &'a str {\n      * }\n      * ```\n      */\n+    #[inline]\n+    fn from_base64(&self) -> Result<Vec<u8>, FromBase64Error> {\n+        self.as_bytes().from_base64()\n+    }\n+}\n+\n+impl<'a> FromBase64 for &'a [u8] {\n     fn from_base64(&self) -> Result<Vec<u8>, FromBase64Error> {\n         let mut r = Vec::new();\n         let mut buf: u32 = 0;\n         let mut modulus = 0i;\n \n-        let mut it = self.bytes().enumerate();\n-        for (idx, byte) in it {\n+        let mut it = self.iter().enumerate();\n+        for (idx, &byte) in it {\n             let val = byte as u32;\n \n-            match byte as char {\n-                'A'..'Z' => buf |= val - 0x41,\n-                'a'..'z' => buf |= val - 0x47,\n-                '0'..'9' => buf |= val + 0x04,\n-                '+'|'-' => buf |= 0x3E,\n-                '/'|'_' => buf |= 0x3F,\n-                '\\r'|'\\n' => continue,\n-                '=' => break,\n-                _ => return Err(InvalidBase64Character(self.char_at(idx), idx)),\n+            match byte {\n+                b'A'..b'Z' => buf |= val - 0x41,\n+                b'a'..b'z' => buf |= val - 0x47,\n+                b'0'..b'9' => buf |= val + 0x04,\n+                b'+' | b'-' => buf |= 0x3E,\n+                b'/' | b'_' => buf |= 0x3F,\n+                b'\\r' | b'\\n' => continue,\n+                b'=' => break,\n+                _ => return Err(InvalidBase64Byte(self[idx], idx)),\n             }\n \n             buf <<= 6;\n@@ -235,10 +242,10 @@ impl<'a> FromBase64 for &'a str {\n             }\n         }\n \n-        for (idx, byte) in it {\n-            match byte as char {\n-                '='|'\\r'|'\\n' => continue,\n-                _ => return Err(InvalidBase64Character(self.char_at(idx), idx)),\n+        for (idx, &byte) in it {\n+            match byte {\n+                b'=' | b'\\r' | b'\\n' => continue,\n+                _ => return Err(InvalidBase64Byte(self[idx], idx)),\n             }\n         }\n \n@@ -308,6 +315,11 @@ mod tests {\n         assert_eq!(\"Zm9vYmFy\".from_base64().unwrap().as_slice(), \"foobar\".as_bytes());\n     }\n \n+    #[test]\n+    fn test_from_base64_bytes() {\n+        assert_eq!(b\"Zm9vYmFy\".from_base64().unwrap().as_slice(), \"foobar\".as_bytes());\n+    }\n+\n     #[test]\n     fn test_from_base64_newlines() {\n         assert_eq!(\"Zm9v\\r\\nYmFy\".from_base64().unwrap().as_slice(),"}]}