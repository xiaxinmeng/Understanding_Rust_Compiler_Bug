{"sha": "dc7076b52e2464a703de7d87fa6c60b8fc98ada9", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRjNzA3NmI1MmUyNDY0YTcwM2RlN2Q4N2ZhNmM2MGI4ZmM5OGFkYTk=", "commit": {"author": {"name": "Jan-Erik Rediger", "email": "janerik@fnordig.de", "date": "2016-07-21T09:24:35Z"}, "committer": {"name": "Jan-Erik Rediger", "email": "janerik@fnordig.de", "date": "2016-07-29T08:29:44Z"}, "message": "[LLVM-3.9] Pass correct relocation model flag", "tree": {"sha": "14ca8b5e5b4382e3c4de567e921b39d778d8ff62", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/14ca8b5e5b4382e3c4de567e921b39d778d8ff62"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/dc7076b52e2464a703de7d87fa6c60b8fc98ada9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/dc7076b52e2464a703de7d87fa6c60b8fc98ada9", "html_url": "https://github.com/rust-lang/rust/commit/dc7076b52e2464a703de7d87fa6c60b8fc98ada9", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/dc7076b52e2464a703de7d87fa6c60b8fc98ada9/comments", "author": {"login": "badboy", "id": 2129, "node_id": "MDQ6VXNlcjIxMjk=", "avatar_url": "https://avatars.githubusercontent.com/u/2129?v=4", "gravatar_id": "", "url": "https://api.github.com/users/badboy", "html_url": "https://github.com/badboy", "followers_url": "https://api.github.com/users/badboy/followers", "following_url": "https://api.github.com/users/badboy/following{/other_user}", "gists_url": "https://api.github.com/users/badboy/gists{/gist_id}", "starred_url": "https://api.github.com/users/badboy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/badboy/subscriptions", "organizations_url": "https://api.github.com/users/badboy/orgs", "repos_url": "https://api.github.com/users/badboy/repos", "events_url": "https://api.github.com/users/badboy/events{/privacy}", "received_events_url": "https://api.github.com/users/badboy/received_events", "type": "User", "site_admin": false}, "committer": {"login": "badboy", "id": 2129, "node_id": "MDQ6VXNlcjIxMjk=", "avatar_url": "https://avatars.githubusercontent.com/u/2129?v=4", "gravatar_id": "", "url": "https://api.github.com/users/badboy", "html_url": "https://github.com/badboy", "followers_url": "https://api.github.com/users/badboy/followers", "following_url": "https://api.github.com/users/badboy/following{/other_user}", "gists_url": "https://api.github.com/users/badboy/gists{/gist_id}", "starred_url": "https://api.github.com/users/badboy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/badboy/subscriptions", "organizations_url": "https://api.github.com/users/badboy/orgs", "repos_url": "https://api.github.com/users/badboy/repos", "events_url": "https://api.github.com/users/badboy/events{/privacy}", "received_events_url": "https://api.github.com/users/badboy/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2c92756dde884bbfa5efef9b4cbd846882a7d46e", "url": "https://api.github.com/repos/rust-lang/rust/commits/2c92756dde884bbfa5efef9b4cbd846882a7d46e", "html_url": "https://github.com/rust-lang/rust/commit/2c92756dde884bbfa5efef9b4cbd846882a7d46e"}], "stats": {"total": 14, "additions": 13, "deletions": 1}, "files": [{"sha": "af29ef3d39c2e4908ec5e82e4d3fe25a692a7100", "filename": "configure", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/dc7076b52e2464a703de7d87fa6c60b8fc98ada9/configure", "raw_url": "https://github.com/rust-lang/rust/raw/dc7076b52e2464a703de7d87fa6c60b8fc98ada9/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=dc7076b52e2464a703de7d87fa6c60b8fc98ada9", "patch": "@@ -1020,6 +1020,11 @@ then\n             err \"bad LLVM version: $LLVM_VERSION, need >=3.7\"\n             ;;\n     esac\n+\n+    if \"$CFG_LLVM_ROOT/bin/llvm-mc\" -help | grep \"-relocation-model\"; then\n+        CFG_LLVM_MC_HAS_RELOCATION_MODEL=1\n+        putvar CFG_LLVM_MC_HAS_RELOCATION_MODEL\n+    fi\n fi\n \n # Even when the user overrides the choice of CC, still try to detect"}, {"sha": "d601cab7221f4f097859c2336bbac41ae96df0c0", "filename": "mk/platform.mk", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/dc7076b52e2464a703de7d87fa6c60b8fc98ada9/mk%2Fplatform.mk", "raw_url": "https://github.com/rust-lang/rust/raw/dc7076b52e2464a703de7d87fa6c60b8fc98ada9/mk%2Fplatform.mk", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mk%2Fplatform.mk?ref=dc7076b52e2464a703de7d87fa6c60b8fc98ada9", "patch": "@@ -221,12 +221,19 @@ define CFG_MAKE_TOOLCHAIN\n     LLVM_MC_RELOCATION_MODEL=\"default\"\n   endif\n \n+  # LLVM changed this flag in 3.9\n+  ifdef CFG_LLVM_MC_HAS_RELOCATION_MODEL\n+    LLVM_MC_RELOC_FLAG := -relocation-model=$$(LLVM_MC_RELOCATION_MODEL)\n+  else\n+    LLVM_MC_RELOC_FLAG := -position-independent\n+  endif\n+\n   # We're using llvm-mc as our assembler because it supports\n   # .cfi pseudo-ops on mac\n   CFG_ASSEMBLE_$(1)=$$(CPP_$(1)) -E $$(2) | \\\n                     $$(LLVM_MC_$$(CFG_BUILD)) \\\n                     -assemble \\\n-                    -relocation-model=$$(LLVM_MC_RELOCATION_MODEL) \\\n+                    $$(LLVM_MC_RELOC_FLAG) \\\n                     -filetype=obj \\\n                     -triple=$(1) \\\n                     -o=$$(1)"}]}