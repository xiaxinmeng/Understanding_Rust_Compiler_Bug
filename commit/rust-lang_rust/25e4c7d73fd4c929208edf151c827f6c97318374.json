{"sha": "25e4c7d73fd4c929208edf151c827f6c97318374", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI1ZTRjN2Q3M2ZkNGM5MjkyMDhlZGYxNTFjODI3ZjZjOTczMTgzNzQ=", "commit": {"author": {"name": "Yoshitomo Nakanishi", "email": "yurayura.rounin.3@gmail.com", "date": "2021-07-13T13:57:47Z"}, "committer": {"name": "Yoshitomo Nakanishi", "email": "yurayura.rounin.3@gmail.com", "date": "2021-07-13T14:18:31Z"}, "message": "`default_numeric_fallback`: Add rustfix tests", "tree": {"sha": "eeb5c1b332b4217c4932a7779e9aa32214716e69", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/eeb5c1b332b4217c4932a7779e9aa32214716e69"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/25e4c7d73fd4c929208edf151c827f6c97318374", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/25e4c7d73fd4c929208edf151c827f6c97318374", "html_url": "https://github.com/rust-lang/rust/commit/25e4c7d73fd4c929208edf151c827f6c97318374", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/25e4c7d73fd4c929208edf151c827f6c97318374/comments", "author": {"login": "Y-Nak", "id": 6376004, "node_id": "MDQ6VXNlcjYzNzYwMDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6376004?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Y-Nak", "html_url": "https://github.com/Y-Nak", "followers_url": "https://api.github.com/users/Y-Nak/followers", "following_url": "https://api.github.com/users/Y-Nak/following{/other_user}", "gists_url": "https://api.github.com/users/Y-Nak/gists{/gist_id}", "starred_url": "https://api.github.com/users/Y-Nak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Y-Nak/subscriptions", "organizations_url": "https://api.github.com/users/Y-Nak/orgs", "repos_url": "https://api.github.com/users/Y-Nak/repos", "events_url": "https://api.github.com/users/Y-Nak/events{/privacy}", "received_events_url": "https://api.github.com/users/Y-Nak/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Y-Nak", "id": 6376004, "node_id": "MDQ6VXNlcjYzNzYwMDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/6376004?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Y-Nak", "html_url": "https://github.com/Y-Nak", "followers_url": "https://api.github.com/users/Y-Nak/followers", "following_url": "https://api.github.com/users/Y-Nak/following{/other_user}", "gists_url": "https://api.github.com/users/Y-Nak/gists{/gist_id}", "starred_url": "https://api.github.com/users/Y-Nak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Y-Nak/subscriptions", "organizations_url": "https://api.github.com/users/Y-Nak/orgs", "repos_url": "https://api.github.com/users/Y-Nak/repos", "events_url": "https://api.github.com/users/Y-Nak/events{/privacy}", "received_events_url": "https://api.github.com/users/Y-Nak/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4e8cd4d346c13b0ef873f69c213ba96dc5bab5bf", "url": "https://api.github.com/repos/rust-lang/rust/commits/4e8cd4d346c13b0ef873f69c213ba96dc5bab5bf", "html_url": "https://github.com/rust-lang/rust/commit/4e8cd4d346c13b0ef873f69c213ba96dc5bab5bf"}], "stats": {"total": 464, "additions": 411, "deletions": 53}, "files": [{"sha": "e719a1b0abf8744dd2f483d542c9c017e96e6b67", "filename": "clippy_lints/src/default_numeric_fallback.rs", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/25e4c7d73fd4c929208edf151c827f6c97318374/clippy_lints%2Fsrc%2Fdefault_numeric_fallback.rs", "raw_url": "https://github.com/rust-lang/rust/raw/25e4c7d73fd4c929208edf151c827f6c97318374/clippy_lints%2Fsrc%2Fdefault_numeric_fallback.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fdefault_numeric_fallback.rs?ref=25e4c7d73fd4c929208edf151c827f6c97318374", "patch": "@@ -1,5 +1,6 @@\n use clippy_utils::diagnostics::span_lint_and_sugg;\n-use clippy_utils::source::snippet;\n+use clippy_utils::numeric_literal;\n+use clippy_utils::source::snippet_opt;\n use if_chain::if_chain;\n use rustc_ast::ast::{LitFloatType, LitIntType, LitKind};\n use rustc_errors::Applicability;\n@@ -80,14 +81,23 @@ impl<'a, 'tcx> NumericFallbackVisitor<'a, 'tcx> {\n                             LitKind::Int(_, LitIntType::Unsuffixed) | LitKind::Float(_, LitFloatType::Unsuffixed));\n                 if !ty_bound.is_numeric();\n                 then {\n-                    let suffix = match lit_ty.kind() {\n-                        ty::Int(IntTy::I32) => \"i32\",\n-                        ty::Float(FloatTy::F64) => \"f64\",\n+                    let (suffix, is_float) = match lit_ty.kind() {\n+                        ty::Int(IntTy::I32) => (\"i32\", false),\n+                        ty::Float(FloatTy::F64) => (\"f64\", true),\n                         // Default numeric fallback never results in other types.\n                         _ => return,\n                     };\n \n-                    let sugg = format!(\"{}_{}\", snippet(self.cx, lit.span, \"\"), suffix);\n+                    let src = if let Some(src) = snippet_opt(self.cx, lit.span) {\n+                        src\n+                    } else {\n+                        match lit.node {\n+                            LitKind::Int(src, _) => format!(\"{}\", src),\n+                            LitKind::Float(src, _) => format!(\"{}\", src),\n+                            _ => return,\n+                        }\n+                    };\n+                    let sugg = numeric_literal::format(&src, Some(suffix), is_float);\n                     span_lint_and_sugg(\n                         self.cx,\n                         DEFAULT_NUMERIC_FALLBACK,"}, {"sha": "1b0e7544e79c6289f17b6d48b9f1a0dc7c51e579", "filename": "tests/ui/default_numeric_fallback_f64.fixed", "status": "added", "additions": 174, "deletions": 0, "changes": 174, "blob_url": "https://github.com/rust-lang/rust/blob/25e4c7d73fd4c929208edf151c827f6c97318374/tests%2Fui%2Fdefault_numeric_fallback_f64.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/25e4c7d73fd4c929208edf151c827f6c97318374/tests%2Fui%2Fdefault_numeric_fallback_f64.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdefault_numeric_fallback_f64.fixed?ref=25e4c7d73fd4c929208edf151c827f6c97318374", "patch": "@@ -0,0 +1,174 @@\n+// run-rustfix\n+// aux-build:macro_rules.rs\n+\n+#![warn(clippy::default_numeric_fallback)]\n+#![allow(unused)]\n+#![allow(clippy::never_loop)]\n+#![allow(clippy::no_effect)]\n+#![allow(clippy::unnecessary_operation)]\n+#![allow(clippy::branches_sharing_code)]\n+#![allow(clippy::match_single_binding)]\n+\n+#[macro_use]\n+extern crate macro_rules;\n+\n+mod basic_expr {\n+    fn test() {\n+        // Should lint unsuffixed literals typed `f64`.\n+        let x = 0.12_f64;\n+        let x = [1.0_f64, 2.0_f64, 3.0_f64];\n+        let x = if true { (1.0_f64, 2.0_f64) } else { (3.0_f64, 4.0_f64) };\n+        let x = match 1.0_f64 {\n+            _ => 1.0_f64,\n+        };\n+\n+        // Should NOT lint suffixed literals.\n+        let x = 0.12_f64;\n+\n+        // Should NOT lint literals in init expr if `Local` has a type annotation.\n+        let x: f64 = 0.1;\n+        let x: [f64; 3] = [1., 2., 3.];\n+        let x: (f64, f64) = if true { (1., 2.) } else { (3., 4.) };\n+        let x: _ = 1.;\n+    }\n+}\n+\n+mod nested_local {\n+    fn test() {\n+        let x: _ = {\n+            // Should lint this because this literal is not bound to any types.\n+            let y = 1.0_f64;\n+\n+            // Should NOT lint this because this literal is bound to `_` of outer `Local`.\n+            1.\n+        };\n+\n+        let x: _ = if true {\n+            // Should lint this because this literal is not bound to any types.\n+            let y = 1.0_f64;\n+\n+            // Should NOT lint this because this literal is bound to `_` of outer `Local`.\n+            1.\n+        } else {\n+            // Should lint this because this literal is not bound to any types.\n+            let y = 1.0_f64;\n+\n+            // Should NOT lint this because this literal is bound to `_` of outer `Local`.\n+            2.\n+        };\n+    }\n+}\n+\n+mod function_def {\n+    fn ret_f64() -> f64 {\n+        // Even though the output type is specified,\n+        // this unsuffixed literal is linted to reduce heuristics and keep codebase simple.\n+        1.0_f64\n+    }\n+\n+    fn test() {\n+        // Should lint this because return type is inferred to `f64` and NOT bound to a concrete\n+        // type.\n+        let f = || -> _ { 1.0_f64 };\n+\n+        // Even though the output type is specified,\n+        // this unsuffixed literal is linted to reduce heuristics and keep codebase simple.\n+        let f = || -> f64 { 1.0_f64 };\n+    }\n+}\n+\n+mod function_calls {\n+    fn concrete_arg(f: f64) {}\n+\n+    fn generic_arg<T>(t: T) {}\n+\n+    fn test() {\n+        // Should NOT lint this because the argument type is bound to a concrete type.\n+        concrete_arg(1.);\n+\n+        // Should lint this because the argument type is inferred to `f64` and NOT bound to a concrete type.\n+        generic_arg(1.0_f64);\n+\n+        // Should lint this because the argument type is inferred to `f64` and NOT bound to a concrete type.\n+        let x: _ = generic_arg(1.0_f64);\n+    }\n+}\n+\n+mod struct_ctor {\n+    struct ConcreteStruct {\n+        x: f64,\n+    }\n+\n+    struct GenericStruct<T> {\n+        x: T,\n+    }\n+\n+    fn test() {\n+        // Should NOT lint this because the field type is bound to a concrete type.\n+        ConcreteStruct { x: 1. };\n+\n+        // Should lint this because the field type is inferred to `f64` and NOT bound to a concrete type.\n+        GenericStruct { x: 1.0_f64 };\n+\n+        // Should lint this because the field type is inferred to `f64` and NOT bound to a concrete type.\n+        let _ = GenericStruct { x: 1.0_f64 };\n+    }\n+}\n+\n+mod enum_ctor {\n+    enum ConcreteEnum {\n+        X(f64),\n+    }\n+\n+    enum GenericEnum<T> {\n+        X(T),\n+    }\n+\n+    fn test() {\n+        // Should NOT lint this because the field type is bound to a concrete type.\n+        ConcreteEnum::X(1.);\n+\n+        // Should lint this because the field type is inferred to `f64` and NOT bound to a concrete type.\n+        GenericEnum::X(1.0_f64);\n+    }\n+}\n+\n+mod method_calls {\n+    struct StructForMethodCallTest {}\n+\n+    impl StructForMethodCallTest {\n+        fn concrete_arg(&self, f: f64) {}\n+\n+        fn generic_arg<T>(&self, t: T) {}\n+    }\n+\n+    fn test() {\n+        let s = StructForMethodCallTest {};\n+\n+        // Should NOT lint this because the argument type is bound to a concrete type.\n+        s.concrete_arg(1.);\n+\n+        // Should lint this because the argument type is bound to a concrete type.\n+        s.generic_arg(1.0_f64);\n+    }\n+}\n+\n+mod in_macro {\n+    macro_rules! internal_macro {\n+        () => {\n+            let x = 22.0_f64;\n+        };\n+    }\n+\n+    // Should lint in internal macro.\n+    fn internal() {\n+        internal_macro!();\n+    }\n+\n+    // Should NOT lint in external macro.\n+    fn external() {\n+        default_numeric_fallback!();\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "e9687777bbd0bed95d74767187deb9566e5e8167", "filename": "tests/ui/default_numeric_fallback_f64.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/25e4c7d73fd4c929208edf151c827f6c97318374/tests%2Fui%2Fdefault_numeric_fallback_f64.rs", "raw_url": "https://github.com/rust-lang/rust/raw/25e4c7d73fd4c929208edf151c827f6c97318374/tests%2Fui%2Fdefault_numeric_fallback_f64.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdefault_numeric_fallback_f64.rs?ref=25e4c7d73fd4c929208edf151c827f6c97318374", "patch": "@@ -1,3 +1,4 @@\n+// run-rustfix\n // aux-build:macro_rules.rs\n \n #![warn(clippy::default_numeric_fallback)]\n@@ -6,7 +7,6 @@\n #![allow(clippy::no_effect)]\n #![allow(clippy::unnecessary_operation)]\n #![allow(clippy::branches_sharing_code)]\n-#![allow(clippy::branches_sharing_code)]\n #![allow(clippy::match_single_binding)]\n \n #[macro_use]"}, {"sha": "961c7cb57c523f2746985606bb43cd4f8a55eb64", "filename": "tests/ui/default_numeric_fallback_f64.stderr", "status": "modified", "additions": 22, "deletions": 22, "changes": 44, "blob_url": "https://github.com/rust-lang/rust/blob/25e4c7d73fd4c929208edf151c827f6c97318374/tests%2Fui%2Fdefault_numeric_fallback_f64.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/25e4c7d73fd4c929208edf151c827f6c97318374/tests%2Fui%2Fdefault_numeric_fallback_f64.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdefault_numeric_fallback_f64.stderr?ref=25e4c7d73fd4c929208edf151c827f6c97318374", "patch": "@@ -10,133 +10,133 @@ error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:19:18\n    |\n LL |         let x = [1., 2., 3.];\n-   |                  ^^ help: consider adding suffix: `1._f64`\n+   |                  ^^ help: consider adding suffix: `1.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:19:22\n    |\n LL |         let x = [1., 2., 3.];\n-   |                      ^^ help: consider adding suffix: `2._f64`\n+   |                      ^^ help: consider adding suffix: `2.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:19:26\n    |\n LL |         let x = [1., 2., 3.];\n-   |                          ^^ help: consider adding suffix: `3._f64`\n+   |                          ^^ help: consider adding suffix: `3.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:20:28\n    |\n LL |         let x = if true { (1., 2.) } else { (3., 4.) };\n-   |                            ^^ help: consider adding suffix: `1._f64`\n+   |                            ^^ help: consider adding suffix: `1.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:20:32\n    |\n LL |         let x = if true { (1., 2.) } else { (3., 4.) };\n-   |                                ^^ help: consider adding suffix: `2._f64`\n+   |                                ^^ help: consider adding suffix: `2.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:20:46\n    |\n LL |         let x = if true { (1., 2.) } else { (3., 4.) };\n-   |                                              ^^ help: consider adding suffix: `3._f64`\n+   |                                              ^^ help: consider adding suffix: `3.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:20:50\n    |\n LL |         let x = if true { (1., 2.) } else { (3., 4.) };\n-   |                                                  ^^ help: consider adding suffix: `4._f64`\n+   |                                                  ^^ help: consider adding suffix: `4.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:21:23\n    |\n LL |         let x = match 1. {\n-   |                       ^^ help: consider adding suffix: `1._f64`\n+   |                       ^^ help: consider adding suffix: `1.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:22:18\n    |\n LL |             _ => 1.,\n-   |                  ^^ help: consider adding suffix: `1._f64`\n+   |                  ^^ help: consider adding suffix: `1.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:40:21\n    |\n LL |             let y = 1.;\n-   |                     ^^ help: consider adding suffix: `1._f64`\n+   |                     ^^ help: consider adding suffix: `1.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:48:21\n    |\n LL |             let y = 1.;\n-   |                     ^^ help: consider adding suffix: `1._f64`\n+   |                     ^^ help: consider adding suffix: `1.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:54:21\n    |\n LL |             let y = 1.;\n-   |                     ^^ help: consider adding suffix: `1._f64`\n+   |                     ^^ help: consider adding suffix: `1.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:66:9\n    |\n LL |         1.\n-   |         ^^ help: consider adding suffix: `1._f64`\n+   |         ^^ help: consider adding suffix: `1.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:72:27\n    |\n LL |         let f = || -> _ { 1. };\n-   |                           ^^ help: consider adding suffix: `1._f64`\n+   |                           ^^ help: consider adding suffix: `1.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:76:29\n    |\n LL |         let f = || -> f64 { 1. };\n-   |                             ^^ help: consider adding suffix: `1._f64`\n+   |                             ^^ help: consider adding suffix: `1.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:90:21\n    |\n LL |         generic_arg(1.);\n-   |                     ^^ help: consider adding suffix: `1._f64`\n+   |                     ^^ help: consider adding suffix: `1.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:93:32\n    |\n LL |         let x: _ = generic_arg(1.);\n-   |                                ^^ help: consider adding suffix: `1._f64`\n+   |                                ^^ help: consider adding suffix: `1.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:111:28\n    |\n LL |         GenericStruct { x: 1. };\n-   |                            ^^ help: consider adding suffix: `1._f64`\n+   |                            ^^ help: consider adding suffix: `1.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:114:36\n    |\n LL |         let _ = GenericStruct { x: 1. };\n-   |                                    ^^ help: consider adding suffix: `1._f64`\n+   |                                    ^^ help: consider adding suffix: `1.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:132:24\n    |\n LL |         GenericEnum::X(1.);\n-   |                        ^^ help: consider adding suffix: `1._f64`\n+   |                        ^^ help: consider adding suffix: `1.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:152:23\n    |\n LL |         s.generic_arg(1.);\n-   |                       ^^ help: consider adding suffix: `1._f64`\n+   |                       ^^ help: consider adding suffix: `1.0_f64`\n \n error: default numeric fallback might occur\n   --> $DIR/default_numeric_fallback_f64.rs:159:21\n    |\n LL |             let x = 22.;\n-   |                     ^^^ help: consider adding suffix: `22._f64`\n+   |                     ^^^ help: consider adding suffix: `22.0_f64`\n ...\n LL |         internal_macro!();\n    |         ------------------ in this macro invocation"}, {"sha": "55c082fcb19fb7f1b563539721f9a89b111ba14b", "filename": "tests/ui/default_numeric_fallback_i32.fixed", "status": "added", "additions": 173, "deletions": 0, "changes": 173, "blob_url": "https://github.com/rust-lang/rust/blob/25e4c7d73fd4c929208edf151c827f6c97318374/tests%2Fui%2Fdefault_numeric_fallback_i32.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/25e4c7d73fd4c929208edf151c827f6c97318374/tests%2Fui%2Fdefault_numeric_fallback_i32.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdefault_numeric_fallback_i32.fixed?ref=25e4c7d73fd4c929208edf151c827f6c97318374", "patch": "@@ -0,0 +1,173 @@\n+// run-rustfix\n+// aux-build:macro_rules.rs\n+\n+#![warn(clippy::default_numeric_fallback)]\n+#![allow(unused)]\n+#![allow(clippy::never_loop)]\n+#![allow(clippy::no_effect)]\n+#![allow(clippy::unnecessary_operation)]\n+#![allow(clippy::branches_sharing_code)]\n+\n+#[macro_use]\n+extern crate macro_rules;\n+\n+mod basic_expr {\n+    fn test() {\n+        // Should lint unsuffixed literals typed `i32`.\n+        let x = 22_i32;\n+        let x = [1_i32, 2_i32, 3_i32];\n+        let x = if true { (1_i32, 2_i32) } else { (3_i32, 4_i32) };\n+        let x = match 1_i32 {\n+            1_i32 => 1_i32,\n+            _ => 2_i32,\n+        };\n+\n+        // Should NOT lint suffixed literals.\n+        let x = 22_i32;\n+\n+        // Should NOT lint literals in init expr if `Local` has a type annotation.\n+        let x: [i32; 3] = [1, 2, 3];\n+        let x: (i32, i32) = if true { (1, 2) } else { (3, 4) };\n+        let x: _ = 1;\n+    }\n+}\n+\n+mod nested_local {\n+    fn test() {\n+        let x: _ = {\n+            // Should lint this because this literal is not bound to any types.\n+            let y = 1_i32;\n+\n+            // Should NOT lint this because this literal is bound to `_` of outer `Local`.\n+            1\n+        };\n+\n+        let x: _ = if true {\n+            // Should lint this because this literal is not bound to any types.\n+            let y = 1_i32;\n+\n+            // Should NOT lint this because this literal is bound to `_` of outer `Local`.\n+            1\n+        } else {\n+            // Should lint this because this literal is not bound to any types.\n+            let y = 1_i32;\n+\n+            // Should NOT lint this because this literal is bound to `_` of outer `Local`.\n+            2\n+        };\n+    }\n+}\n+\n+mod function_def {\n+    fn ret_i32() -> i32 {\n+        // Even though the output type is specified,\n+        // this unsuffixed literal is linted to reduce heuristics and keep codebase simple.\n+        1_i32\n+    }\n+\n+    fn test() {\n+        // Should lint this because return type is inferred to `i32` and NOT bound to a concrete\n+        // type.\n+        let f = || -> _ { 1_i32 };\n+\n+        // Even though the output type is specified,\n+        // this unsuffixed literal is linted to reduce heuristics and keep codebase simple.\n+        let f = || -> i32 { 1_i32 };\n+    }\n+}\n+\n+mod function_calls {\n+    fn concrete_arg(x: i32) {}\n+\n+    fn generic_arg<T>(t: T) {}\n+\n+    fn test() {\n+        // Should NOT lint this because the argument type is bound to a concrete type.\n+        concrete_arg(1);\n+\n+        // Should lint this because the argument type is inferred to `i32` and NOT bound to a concrete type.\n+        generic_arg(1_i32);\n+\n+        // Should lint this because the argument type is inferred to `i32` and NOT bound to a concrete type.\n+        let x: _ = generic_arg(1_i32);\n+    }\n+}\n+\n+mod struct_ctor {\n+    struct ConcreteStruct {\n+        x: i32,\n+    }\n+\n+    struct GenericStruct<T> {\n+        x: T,\n+    }\n+\n+    fn test() {\n+        // Should NOT lint this because the field type is bound to a concrete type.\n+        ConcreteStruct { x: 1 };\n+\n+        // Should lint this because the field type is inferred to `i32` and NOT bound to a concrete type.\n+        GenericStruct { x: 1_i32 };\n+\n+        // Should lint this because the field type is inferred to `i32` and NOT bound to a concrete type.\n+        let _ = GenericStruct { x: 1_i32 };\n+    }\n+}\n+\n+mod enum_ctor {\n+    enum ConcreteEnum {\n+        X(i32),\n+    }\n+\n+    enum GenericEnum<T> {\n+        X(T),\n+    }\n+\n+    fn test() {\n+        // Should NOT lint this because the field type is bound to a concrete type.\n+        ConcreteEnum::X(1);\n+\n+        // Should lint this because the field type is inferred to `i32` and NOT bound to a concrete type.\n+        GenericEnum::X(1_i32);\n+    }\n+}\n+\n+mod method_calls {\n+    struct StructForMethodCallTest {}\n+\n+    impl StructForMethodCallTest {\n+        fn concrete_arg(&self, x: i32) {}\n+\n+        fn generic_arg<T>(&self, t: T) {}\n+    }\n+\n+    fn test() {\n+        let s = StructForMethodCallTest {};\n+\n+        // Should NOT lint this because the argument type is bound to a concrete type.\n+        s.concrete_arg(1);\n+\n+        // Should lint this because the argument type is bound to a concrete type.\n+        s.generic_arg(1_i32);\n+    }\n+}\n+\n+mod in_macro {\n+    macro_rules! internal_macro {\n+        () => {\n+            let x = 22_i32;\n+        };\n+    }\n+\n+    // Should lint in internal macro.\n+    fn internal() {\n+        internal_macro!();\n+    }\n+\n+    // Should NOT lint in external macro.\n+    fn external() {\n+        default_numeric_fallback!();\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "e0a4828ce9ff636aed3c8c510e6e094b9f370826", "filename": "tests/ui/default_numeric_fallback_i32.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/25e4c7d73fd4c929208edf151c827f6c97318374/tests%2Fui%2Fdefault_numeric_fallback_i32.rs", "raw_url": "https://github.com/rust-lang/rust/raw/25e4c7d73fd4c929208edf151c827f6c97318374/tests%2Fui%2Fdefault_numeric_fallback_i32.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdefault_numeric_fallback_i32.rs?ref=25e4c7d73fd4c929208edf151c827f6c97318374", "patch": "@@ -1,3 +1,4 @@\n+// run-rustfix\n // aux-build:macro_rules.rs\n \n #![warn(clippy::default_numeric_fallback)]"}, {"sha": "5edf48b202087d01335588de9b0a7823926030ea", "filename": "tests/ui/default_numeric_fallback_i32.stderr", "status": "modified", "additions": 25, "deletions": 25, "changes": 50, "blob_url": "https://github.com/rust-lang/rust/blob/25e4c7d73fd4c929208edf151c827f6c97318374/tests%2Fui%2Fdefault_numeric_fallback_i32.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/25e4c7d73fd4c929208edf151c827f6c97318374/tests%2Fui%2Fdefault_numeric_fallback_i32.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fdefault_numeric_fallback_i32.stderr?ref=25e4c7d73fd4c929208edf151c827f6c97318374", "patch": "@@ -1,151 +1,151 @@\n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:16:17\n+  --> $DIR/default_numeric_fallback_i32.rs:17:17\n    |\n LL |         let x = 22;\n    |                 ^^ help: consider adding suffix: `22_i32`\n    |\n    = note: `-D clippy::default-numeric-fallback` implied by `-D warnings`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:17:18\n+  --> $DIR/default_numeric_fallback_i32.rs:18:18\n    |\n LL |         let x = [1, 2, 3];\n    |                  ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:17:21\n+  --> $DIR/default_numeric_fallback_i32.rs:18:21\n    |\n LL |         let x = [1, 2, 3];\n    |                     ^ help: consider adding suffix: `2_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:17:24\n+  --> $DIR/default_numeric_fallback_i32.rs:18:24\n    |\n LL |         let x = [1, 2, 3];\n    |                        ^ help: consider adding suffix: `3_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:18:28\n+  --> $DIR/default_numeric_fallback_i32.rs:19:28\n    |\n LL |         let x = if true { (1, 2) } else { (3, 4) };\n    |                            ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:18:31\n+  --> $DIR/default_numeric_fallback_i32.rs:19:31\n    |\n LL |         let x = if true { (1, 2) } else { (3, 4) };\n    |                               ^ help: consider adding suffix: `2_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:18:44\n+  --> $DIR/default_numeric_fallback_i32.rs:19:44\n    |\n LL |         let x = if true { (1, 2) } else { (3, 4) };\n    |                                            ^ help: consider adding suffix: `3_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:18:47\n+  --> $DIR/default_numeric_fallback_i32.rs:19:47\n    |\n LL |         let x = if true { (1, 2) } else { (3, 4) };\n    |                                               ^ help: consider adding suffix: `4_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:19:23\n+  --> $DIR/default_numeric_fallback_i32.rs:20:23\n    |\n LL |         let x = match 1 {\n    |                       ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:20:13\n+  --> $DIR/default_numeric_fallback_i32.rs:21:13\n    |\n LL |             1 => 1,\n    |             ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:20:18\n+  --> $DIR/default_numeric_fallback_i32.rs:21:18\n    |\n LL |             1 => 1,\n    |                  ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:21:18\n+  --> $DIR/default_numeric_fallback_i32.rs:22:18\n    |\n LL |             _ => 2,\n    |                  ^ help: consider adding suffix: `2_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:38:21\n+  --> $DIR/default_numeric_fallback_i32.rs:39:21\n    |\n LL |             let y = 1;\n    |                     ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:46:21\n+  --> $DIR/default_numeric_fallback_i32.rs:47:21\n    |\n LL |             let y = 1;\n    |                     ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:52:21\n+  --> $DIR/default_numeric_fallback_i32.rs:53:21\n    |\n LL |             let y = 1;\n    |                     ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:64:9\n+  --> $DIR/default_numeric_fallback_i32.rs:65:9\n    |\n LL |         1\n    |         ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:70:27\n+  --> $DIR/default_numeric_fallback_i32.rs:71:27\n    |\n LL |         let f = || -> _ { 1 };\n    |                           ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:74:29\n+  --> $DIR/default_numeric_fallback_i32.rs:75:29\n    |\n LL |         let f = || -> i32 { 1 };\n    |                             ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:88:21\n+  --> $DIR/default_numeric_fallback_i32.rs:89:21\n    |\n LL |         generic_arg(1);\n    |                     ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:91:32\n+  --> $DIR/default_numeric_fallback_i32.rs:92:32\n    |\n LL |         let x: _ = generic_arg(1);\n    |                                ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:109:28\n+  --> $DIR/default_numeric_fallback_i32.rs:110:28\n    |\n LL |         GenericStruct { x: 1 };\n    |                            ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:112:36\n+  --> $DIR/default_numeric_fallback_i32.rs:113:36\n    |\n LL |         let _ = GenericStruct { x: 1 };\n    |                                    ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:130:24\n+  --> $DIR/default_numeric_fallback_i32.rs:131:24\n    |\n LL |         GenericEnum::X(1);\n    |                        ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:150:23\n+  --> $DIR/default_numeric_fallback_i32.rs:151:23\n    |\n LL |         s.generic_arg(1);\n    |                       ^ help: consider adding suffix: `1_i32`\n \n error: default numeric fallback might occur\n-  --> $DIR/default_numeric_fallback_i32.rs:157:21\n+  --> $DIR/default_numeric_fallback_i32.rs:158:21\n    |\n LL |             let x = 22;\n    |                     ^^ help: consider adding suffix: `22_i32`"}]}