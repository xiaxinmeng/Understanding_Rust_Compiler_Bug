{"sha": "9221bd9c97047d9eac21867f5a11651080e2b88f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkyMjFiZDljOTcwNDdkOWVhYzIxODY3ZjVhMTE2NTEwODBlMmI4OGY=", "commit": {"author": {"name": "sinkuu", "email": "sinkuu@sinkuu.xyz", "date": "2017-10-18T05:06:38Z"}, "committer": {"name": "sinkuu", "email": "sinkuu@sinkuu.xyz", "date": "2017-10-18T05:06:38Z"}, "message": "Add test", "tree": {"sha": "3c11f36c695a1aa293a4cef499a8ca816f4f438e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/3c11f36c695a1aa293a4cef499a8ca816f4f438e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9221bd9c97047d9eac21867f5a11651080e2b88f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9221bd9c97047d9eac21867f5a11651080e2b88f", "html_url": "https://github.com/rust-lang/rust/commit/9221bd9c97047d9eac21867f5a11651080e2b88f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9221bd9c97047d9eac21867f5a11651080e2b88f/comments", "author": {"login": "sinkuu", "id": 7091080, "node_id": "MDQ6VXNlcjcwOTEwODA=", "avatar_url": "https://avatars.githubusercontent.com/u/7091080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinkuu", "html_url": "https://github.com/sinkuu", "followers_url": "https://api.github.com/users/sinkuu/followers", "following_url": "https://api.github.com/users/sinkuu/following{/other_user}", "gists_url": "https://api.github.com/users/sinkuu/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinkuu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinkuu/subscriptions", "organizations_url": "https://api.github.com/users/sinkuu/orgs", "repos_url": "https://api.github.com/users/sinkuu/repos", "events_url": "https://api.github.com/users/sinkuu/events{/privacy}", "received_events_url": "https://api.github.com/users/sinkuu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sinkuu", "id": 7091080, "node_id": "MDQ6VXNlcjcwOTEwODA=", "avatar_url": "https://avatars.githubusercontent.com/u/7091080?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sinkuu", "html_url": "https://github.com/sinkuu", "followers_url": "https://api.github.com/users/sinkuu/followers", "following_url": "https://api.github.com/users/sinkuu/following{/other_user}", "gists_url": "https://api.github.com/users/sinkuu/gists{/gist_id}", "starred_url": "https://api.github.com/users/sinkuu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sinkuu/subscriptions", "organizations_url": "https://api.github.com/users/sinkuu/orgs", "repos_url": "https://api.github.com/users/sinkuu/repos", "events_url": "https://api.github.com/users/sinkuu/events{/privacy}", "received_events_url": "https://api.github.com/users/sinkuu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b4ea47d23e88b6bd9859b10daf3f482290379a90", "url": "https://api.github.com/repos/rust-lang/rust/commits/b4ea47d23e88b6bd9859b10daf3f482290379a90", "html_url": "https://github.com/rust-lang/rust/commit/b4ea47d23e88b6bd9859b10daf3f482290379a90"}], "stats": {"total": 27, "additions": 23, "deletions": 4}, "files": [{"sha": "67337afd3e70107eedbca7f1fcecbe84d1eff44f", "filename": "mini-macro/src/lib.rs", "status": "modified", "additions": 22, "deletions": 4, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/9221bd9c97047d9eac21867f5a11651080e2b88f/mini-macro%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9221bd9c97047d9eac21867f5a11651080e2b88f/mini-macro%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/mini-macro%2Fsrc%2Flib.rs?ref=9221bd9c97047d9eac21867f5a11651080e2b88f", "patch": "@@ -1,21 +1,39 @@\n-#![feature(plugin_registrar, rustc_private)]\n+#![feature(plugin_registrar, rustc_private, quote)]\n \n extern crate rustc_plugin;\n extern crate syntax;\n \n+use rustc_plugin::Registry;\n+use syntax::ast::MetaItem;\n use syntax::codemap::Span;\n-use syntax::tokenstream::TokenTree;\n-use syntax::ext::base::{ExtCtxt, MacEager, MacResult};\n+use syntax::ext::base::{Annotatable, ExtCtxt, MacEager, MacResult, SyntaxExtension};\n use syntax::ext::build::AstBuilder; // trait for expr_usize\n-use rustc_plugin::Registry;\n+use syntax::symbol::Symbol;\n+use syntax::tokenstream::TokenTree;\n \n fn expand_macro(cx: &mut ExtCtxt, sp: Span, _: &[TokenTree]) -> Box<MacResult + 'static> {\n     let e = cx.expr_usize(sp, 42);\n     let e = cx.expr_mut_addr_of(sp, e);\n     MacEager::expr(cx.expr_mut_addr_of(sp, e))\n }\n \n+fn expand_attr_macro(cx: &mut ExtCtxt, _: Span, _: &MetaItem, annotated: Annotatable) -> Vec<Annotatable> {\n+    vec![\n+        Annotatable::Item(\n+            quote_item!(\n+                cx,\n+                #[allow(unused)] fn needless_take_by_value(s: String) { println!(\"{}\", s.len()); }\n+            ).unwrap()\n+        ),\n+        annotated,\n+    ]\n+}\n+\n #[plugin_registrar]\n pub fn plugin_registrar(reg: &mut Registry) {\n     reg.register_macro(\"mini_macro\", expand_macro);\n+    reg.register_syntax_extension(\n+        Symbol::intern(\"mini_macro_attr\"),\n+        SyntaxExtension::MultiModifier(Box::new(expand_attr_macro)),\n+    );\n }"}, {"sha": "f52c778a49dc69fdf427aedd65d1b16389d9c4bd", "filename": "tests/run-pass/procedural_macro.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/9221bd9c97047d9eac21867f5a11651080e2b88f/tests%2Frun-pass%2Fprocedural_macro.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9221bd9c97047d9eac21867f5a11651080e2b88f/tests%2Frun-pass%2Fprocedural_macro.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Frun-pass%2Fprocedural_macro.rs?ref=9221bd9c97047d9eac21867f5a11651080e2b88f", "patch": "@@ -2,6 +2,7 @@\n #![plugin(clippy_mini_macro_test)]\n \n #[deny(warnings)]\n+#[mini_macro_attr]\n fn main() {\n     let _ = mini_macro!();\n }"}]}