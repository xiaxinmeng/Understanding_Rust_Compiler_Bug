{"sha": "3bbe95ca0cb50260aa23a507642af05a83652a4e", "node_id": "C_kwDOAAsO6NoAKDNiYmU5NWNhMGNiNTAyNjBhYTIzYTUwNzY0MmFmMDVhODM2NTJhNGU", "commit": {"author": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-07-24T19:33:26Z"}, "committer": {"name": "Michael Goulet", "email": "michael@errs.io", "date": "2022-07-24T19:35:53Z"}, "message": "Combine redundant obligation cause codes", "tree": {"sha": "a55a19954a66b17b824c769d45fa704ed84b5d65", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a55a19954a66b17b824c769d45fa704ed84b5d65"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3bbe95ca0cb50260aa23a507642af05a83652a4e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3bbe95ca0cb50260aa23a507642af05a83652a4e", "html_url": "https://github.com/rust-lang/rust/commit/3bbe95ca0cb50260aa23a507642af05a83652a4e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3bbe95ca0cb50260aa23a507642af05a83652a4e/comments", "author": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "compiler-errors", "id": 3674314, "node_id": "MDQ6VXNlcjM2NzQzMTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/3674314?v=4", "gravatar_id": "", "url": "https://api.github.com/users/compiler-errors", "html_url": "https://github.com/compiler-errors", "followers_url": "https://api.github.com/users/compiler-errors/followers", "following_url": "https://api.github.com/users/compiler-errors/following{/other_user}", "gists_url": "https://api.github.com/users/compiler-errors/gists{/gist_id}", "starred_url": "https://api.github.com/users/compiler-errors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/compiler-errors/subscriptions", "organizations_url": "https://api.github.com/users/compiler-errors/orgs", "repos_url": "https://api.github.com/users/compiler-errors/repos", "events_url": "https://api.github.com/users/compiler-errors/events{/privacy}", "received_events_url": "https://api.github.com/users/compiler-errors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2bbcdc73339c2b7c3e57c2fc0d3bc574945c0023", "url": "https://api.github.com/repos/rust-lang/rust/commits/2bbcdc73339c2b7c3e57c2fc0d3bc574945c0023", "html_url": "https://github.com/rust-lang/rust/commit/2bbcdc73339c2b7c3e57c2fc0d3bc574945c0023"}], "stats": {"total": 218, "additions": 80, "deletions": 138}, "files": [{"sha": "e06af1fac0699660dc6a13cb21a6e6b3ecc6d2d7", "filename": "compiler/rustc_infer/src/infer/error_reporting/mod.rs", "status": "modified", "additions": 28, "deletions": 20, "changes": 48, "blob_url": "https://github.com/rust-lang/rust/blob/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fmod.rs?ref=3bbe95ca0cb50260aa23a507642af05a83652a4e", "patch": "@@ -1883,7 +1883,7 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n             exp_span, exp_found.expected, exp_found.found,\n         );\n \n-        if let ObligationCauseCode::CompareImplMethodObligation { .. } = cause.code() {\n+        if let ObligationCauseCode::CompareImplItemObligation { .. } = cause.code() {\n             return;\n         }\n \n@@ -2351,24 +2351,18 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n             GenericKind::Projection(ref p) => format!(\"the associated type `{}`\", p),\n         };\n \n-        match origin {\n-            Some(SubregionOrigin::CompareImplMethodObligation {\n-                span,\n-                impl_item_def_id,\n-                trait_item_def_id,\n-            } | SubregionOrigin::CompareImplTypeObligation {\n+        if let Some(SubregionOrigin::CompareImplItemObligation {\n+            span,\n+            impl_item_def_id,\n+            trait_item_def_id,\n+        }) = origin\n+        {\n+            return self.report_extra_impl_obligation(\n                 span,\n                 impl_item_def_id,\n                 trait_item_def_id,\n-            }) => {\n-                return self.report_extra_impl_obligation(\n-                    span,\n-                    impl_item_def_id,\n-                    trait_item_def_id,\n-                    &format!(\"`{}: {}`\", bound_kind, sub),\n-                );\n-            }\n-            _ => {}\n+                &format!(\"`{}: {}`\", bound_kind, sub),\n+            );\n         }\n \n         fn binding_suggestion<'tcx, S: fmt::Display>(\n@@ -2794,8 +2788,15 @@ impl<'tcx> ObligationCauseExt<'tcx> for ObligationCause<'tcx> {\n         use self::FailureCode::*;\n         use crate::traits::ObligationCauseCode::*;\n         match self.code() {\n-            CompareImplMethodObligation { .. } => Error0308(\"method not compatible with trait\"),\n-            CompareImplTypeObligation { .. } => Error0308(\"type not compatible with trait\"),\n+            CompareImplItemObligation { kind: ty::AssocKind::Fn, .. } => {\n+                Error0308(\"method not compatible with trait\")\n+            }\n+            CompareImplItemObligation { kind: ty::AssocKind::Type, .. } => {\n+                Error0308(\"type not compatible with trait\")\n+            }\n+            CompareImplItemObligation { kind: ty::AssocKind::Const, .. } => {\n+                Error0308(\"const not compatible with trait\")\n+            }\n             MatchExpressionArm(box MatchExpressionArmCause { source, .. }) => {\n                 Error0308(match source {\n                     hir::MatchSource::TryDesugar => \"`?` operator has incompatible types\",\n@@ -2829,8 +2830,15 @@ impl<'tcx> ObligationCauseExt<'tcx> for ObligationCause<'tcx> {\n     fn as_requirement_str(&self) -> &'static str {\n         use crate::traits::ObligationCauseCode::*;\n         match self.code() {\n-            CompareImplMethodObligation { .. } => \"method type is compatible with trait\",\n-            CompareImplTypeObligation { .. } => \"associated type is compatible with trait\",\n+            CompareImplItemObligation { kind: ty::AssocKind::Fn, .. } => {\n+                \"method type is compatible with trait\"\n+            }\n+            CompareImplItemObligation { kind: ty::AssocKind::Type, .. } => {\n+                \"associated type is compatible with trait\"\n+            }\n+            CompareImplItemObligation { kind: ty::AssocKind::Const, .. } => {\n+                \"const is compatible with trait\"\n+            }\n             ExprAssignable => \"expression is assignable\",\n             IfExpression { .. } => \"`if` and `else` have incompatible types\",\n             IfExpressionWithNoElse => \"`if` missing an `else` returns `()`\","}, {"sha": "da465a764299270ec845383fc8547f869631bef8", "filename": "compiler/rustc_infer/src/infer/error_reporting/nice_region_error/trait_impl_difference.rs", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Ftrait_impl_difference.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Ftrait_impl_difference.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnice_region_error%2Ftrait_impl_difference.rs?ref=3bbe95ca0cb50260aa23a507642af05a83652a4e", "patch": "@@ -3,7 +3,7 @@\n use crate::infer::error_reporting::nice_region_error::NiceRegionError;\n use crate::infer::lexical_region_resolve::RegionResolutionError;\n use crate::infer::Subtype;\n-use crate::traits::ObligationCauseCode::{CompareImplMethodObligation, CompareImplTypeObligation};\n+use crate::traits::ObligationCauseCode::CompareImplItemObligation;\n use rustc_errors::{ErrorGuaranteed, MultiSpan};\n use rustc_hir as hir;\n use rustc_hir::def::Res;\n@@ -33,8 +33,7 @@ impl<'a, 'tcx> NiceRegionError<'a, 'tcx> {\n             && let (Subtype(sup_trace), Subtype(sub_trace)) = (&sup_origin, &sub_origin)\n             && let sub_expected_found @ Some((sub_expected, sub_found)) = sub_trace.values.ty()\n             && let sup_expected_found @ Some(_) = sup_trace.values.ty()\n-            && let CompareImplMethodObligation { trait_item_def_id, .. }\n-                 | CompareImplTypeObligation { trait_item_def_id, .. } = sub_trace.cause.code()\n+            && let CompareImplItemObligation { trait_item_def_id, .. } = sub_trace.cause.code()\n             && sup_expected_found == sub_expected_found\n         {\n             let guar ="}, {"sha": "c1940c5c0824a3e096f40f61e0622f0b1cbe6015", "filename": "compiler/rustc_infer/src/infer/error_reporting/note.rs", "status": "modified", "additions": 2, "deletions": 16, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnote.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnote.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Ferror_reporting%2Fnote.rs?ref=3bbe95ca0cb50260aa23a507642af05a83652a4e", "patch": "@@ -86,13 +86,7 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n                     \"...so that the declared lifetime parameter bounds are satisfied\",\n                 );\n             }\n-            infer::CompareImplMethodObligation { span, .. } => {\n-                label_or_note(\n-                    span,\n-                    \"...so that the definition in impl matches the definition from the trait\",\n-                );\n-            }\n-            infer::CompareImplTypeObligation { span, .. } => {\n+            infer::CompareImplItemObligation { span, .. } => {\n                 label_or_note(\n                     span,\n                     \"...so that the definition in impl matches the definition from the trait\",\n@@ -329,15 +323,7 @@ impl<'a, 'tcx> InferCtxt<'a, 'tcx> {\n                 );\n                 err\n             }\n-            infer::CompareImplMethodObligation { span, impl_item_def_id, trait_item_def_id } => {\n-                self.report_extra_impl_obligation(\n-                    span,\n-                    impl_item_def_id,\n-                    trait_item_def_id,\n-                    &format!(\"`{}: {}`\", sup, sub),\n-                )\n-            }\n-            infer::CompareImplTypeObligation { span, impl_item_def_id, trait_item_def_id } => self\n+            infer::CompareImplItemObligation { span, impl_item_def_id, trait_item_def_id } => self\n                 .report_extra_impl_obligation(\n                     span,\n                     impl_item_def_id,"}, {"sha": "5e7c0661728aaa4ea9c8a92dd796ed17cab8dcdd", "filename": "compiler/rustc_infer/src/infer/mod.rs", "status": "modified", "additions": 5, "deletions": 22, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_infer%2Fsrc%2Finfer%2Fmod.rs?ref=3bbe95ca0cb50260aa23a507642af05a83652a4e", "patch": "@@ -405,15 +405,7 @@ pub enum SubregionOrigin<'tcx> {\n \n     /// Comparing the signature and requirements of an impl method against\n     /// the containing trait.\n-    CompareImplMethodObligation {\n-        span: Span,\n-        impl_item_def_id: LocalDefId,\n-        trait_item_def_id: DefId,\n-    },\n-\n-    /// Comparing the signature and requirements of an impl associated type\n-    /// against the containing trait\n-    CompareImplTypeObligation { span: Span, impl_item_def_id: LocalDefId, trait_item_def_id: DefId },\n+    CompareImplItemObligation { span: Span, impl_item_def_id: LocalDefId, trait_item_def_id: DefId },\n \n     /// Checking that the bounds of a trait's associated type hold for a given impl\n     CheckAssociatedTypeBounds {\n@@ -1945,8 +1937,7 @@ impl<'tcx> SubregionOrigin<'tcx> {\n             ReborrowUpvar(a, _) => a,\n             DataBorrowed(_, a) => a,\n             ReferenceOutlivesReferent(_, a) => a,\n-            CompareImplMethodObligation { span, .. } => span,\n-            CompareImplTypeObligation { span, .. } => span,\n+            CompareImplItemObligation { span, .. } => span,\n             CheckAssociatedTypeBounds { ref parent, .. } => parent.span(),\n         }\n     }\n@@ -1960,19 +1951,11 @@ impl<'tcx> SubregionOrigin<'tcx> {\n                 SubregionOrigin::ReferenceOutlivesReferent(ref_type, cause.span)\n             }\n \n-            traits::ObligationCauseCode::CompareImplMethodObligation {\n-                impl_item_def_id,\n-                trait_item_def_id,\n-            } => SubregionOrigin::CompareImplMethodObligation {\n-                span: cause.span,\n-                impl_item_def_id,\n-                trait_item_def_id,\n-            },\n-\n-            traits::ObligationCauseCode::CompareImplTypeObligation {\n+            traits::ObligationCauseCode::CompareImplItemObligation {\n                 impl_item_def_id,\n                 trait_item_def_id,\n-            } => SubregionOrigin::CompareImplTypeObligation {\n+                kind: _,\n+            } => SubregionOrigin::CompareImplItemObligation {\n                 span: cause.span,\n                 impl_item_def_id,\n                 trait_item_def_id,"}, {"sha": "72b848c3ee2dd150728d09ba9a05e1d556597b2a", "filename": "compiler/rustc_middle/src/traits/mod.rs", "status": "modified", "additions": 2, "deletions": 10, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_middle%2Fsrc%2Ftraits%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_middle%2Fsrc%2Ftraits%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Ftraits%2Fmod.rs?ref=3bbe95ca0cb50260aa23a507642af05a83652a4e", "patch": "@@ -311,18 +311,10 @@ pub enum ObligationCauseCode<'tcx> {\n     },\n \n     /// Error derived when matching traits/impls; see ObligationCause for more details\n-    CompareImplConstObligation,\n-\n-    /// Error derived when matching traits/impls; see ObligationCause for more details\n-    CompareImplMethodObligation {\n-        impl_item_def_id: LocalDefId,\n-        trait_item_def_id: DefId,\n-    },\n-\n-    /// Error derived when matching traits/impls; see ObligationCause for more details\n-    CompareImplTypeObligation {\n+    CompareImplItemObligation {\n         impl_item_def_id: LocalDefId,\n         trait_item_def_id: DefId,\n+        kind: ty::AssocKind,\n     },\n \n     /// Checking that the bounds of a trait's associated type hold for a given impl"}, {"sha": "eb732148e3eb4ad7f1122de80a3799d3cbe27318", "filename": "compiler/rustc_middle/src/ty/assoc.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_middle%2Fsrc%2Fty%2Fassoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_middle%2Fsrc%2Fty%2Fassoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fassoc.rs?ref=3bbe95ca0cb50260aa23a507642af05a83652a4e", "patch": "@@ -105,6 +105,16 @@ impl AssocKind {\n     }\n }\n \n+impl std::fmt::Display for AssocKind {\n+    fn fmt(&self, f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {\n+        match self {\n+            AssocKind::Fn => write!(f, \"method\"),\n+            AssocKind::Const => write!(f, \"associated const\"),\n+            AssocKind::Type => write!(f, \"associated type\"),\n+        }\n+    }\n+}\n+\n /// A list of `ty::AssocItem`s in definition order that allows for efficient lookup by name.\n ///\n /// When doing lookup by name, we try to postpone hygienic comparison for as long as possible since"}, {"sha": "91246051316fa42ec6cb440f78323913af29e240", "filename": "compiler/rustc_middle/src/ty/error.rs", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_middle%2Fsrc%2Fty%2Ferror.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_middle%2Fsrc%2Fty%2Ferror.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Ferror.rs?ref=3bbe95ca0cb50260aa23a507642af05a83652a4e", "patch": "@@ -660,12 +660,8 @@ impl<T> Trait<T> for X {\n                     | hir::Node::ImplItem(hir::ImplItem { kind: hir::ImplItemKind::Fn(..), .. }),\n             )\n         );\n-        let impl_comparison = matches!(\n-            cause_code,\n-            ObligationCauseCode::CompareImplMethodObligation { .. }\n-                | ObligationCauseCode::CompareImplTypeObligation { .. }\n-                | ObligationCauseCode::CompareImplConstObligation\n-        );\n+        let impl_comparison =\n+            matches!(cause_code, ObligationCauseCode::CompareImplItemObligation { .. });\n         let assoc = self.associated_item(proj_ty.item_def_id);\n         if !callable_scope || impl_comparison {\n             // We do not want to suggest calling functions when the reason of the"}, {"sha": "7467d9cf995f4c0ecf421edbc6f434036e0062eb", "filename": "compiler/rustc_middle/src/ty/structural_impls.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_middle%2Fsrc%2Fty%2Fstructural_impls.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_middle%2Fsrc%2Fty%2Fstructural_impls.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fty%2Fstructural_impls.rs?ref=3bbe95ca0cb50260aa23a507642af05a83652a4e", "patch": "@@ -224,6 +224,7 @@ TrivialTypeTraversalAndLiftImpls! {\n     // general `Region`.\n     crate::ty::BoundRegionKind,\n     crate::ty::AssocItem,\n+    crate::ty::AssocKind,\n     crate::ty::Placeholder<crate::ty::BoundRegionKind>,\n     crate::ty::ClosureKind,\n     crate::ty::FreeRegion,"}, {"sha": "41c5087c43d42a15c5dd2ffc9d5b664bb352d76a", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/mod.rs", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs?ref=3bbe95ca0cb50260aa23a507642af05a83652a4e", "patch": "@@ -301,13 +301,10 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n                         span = obligation.cause.span;\n                     }\n                 }\n-                if let ObligationCauseCode::CompareImplMethodObligation {\n-                    impl_item_def_id,\n-                    trait_item_def_id,\n-                }\n-                | ObligationCauseCode::CompareImplTypeObligation {\n+                if let ObligationCauseCode::CompareImplItemObligation {\n                     impl_item_def_id,\n                     trait_item_def_id,\n+                    kind: _,\n                 } = *obligation.cause.code()\n                 {\n                     self.report_extra_impl_obligation("}, {"sha": "89d7c050c408bc757fbf9ef9d277f41e0c39fe60", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/suggestions.rs", "status": "modified", "additions": 4, "deletions": 36, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fsuggestions.rs?ref=3bbe95ca0cb50260aa23a507642af05a83652a4e", "patch": "@@ -2682,11 +2682,11 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n                     )\n                 });\n             }\n-            ObligationCauseCode::CompareImplMethodObligation { trait_item_def_id, .. } => {\n+            ObligationCauseCode::CompareImplItemObligation { trait_item_def_id, kind, .. } => {\n                 let item_name = self.tcx.item_name(trait_item_def_id);\n                 let msg = format!(\n-                    \"the requirement `{}` appears on the impl method `{}` but not on the \\\n-                     corresponding trait method\",\n+                    \"the requirement `{}` appears on the `impl`'s {kind} `{}` but not on the \\\n+                     corresponding trait's {kind}\",\n                     predicate, item_name,\n                 );\n                 let sp = self\n@@ -2697,7 +2697,7 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n                 let mut assoc_span: MultiSpan = sp.into();\n                 assoc_span.push_span_label(\n                     sp,\n-                    format!(\"this trait method doesn't have the requirement `{}`\", predicate),\n+                    format!(\"this trait's {kind} doesn't have the requirement `{}`\", predicate),\n                 );\n                 if let Some(ident) = self\n                     .tcx\n@@ -2708,38 +2708,6 @@ impl<'a, 'tcx> InferCtxtExt<'tcx> for InferCtxt<'a, 'tcx> {\n                 }\n                 err.span_note(assoc_span, &msg);\n             }\n-            ObligationCauseCode::CompareImplTypeObligation { trait_item_def_id, .. } => {\n-                let item_name = self.tcx.item_name(trait_item_def_id);\n-                let msg = format!(\n-                    \"the requirement `{}` appears on the associated impl type `{}` but not on the \\\n-                     corresponding associated trait type\",\n-                    predicate, item_name,\n-                );\n-                let sp = self.tcx.def_span(trait_item_def_id);\n-                let mut assoc_span: MultiSpan = sp.into();\n-                assoc_span.push_span_label(\n-                    sp,\n-                    format!(\n-                        \"this trait associated type doesn't have the requirement `{}`\",\n-                        predicate,\n-                    ),\n-                );\n-                if let Some(ident) = self\n-                    .tcx\n-                    .opt_associated_item(trait_item_def_id)\n-                    .and_then(|i| self.tcx.opt_item_ident(i.container.id()))\n-                {\n-                    assoc_span.push_span_label(ident.span, \"in this trait\");\n-                }\n-                err.span_note(assoc_span, &msg);\n-            }\n-            ObligationCauseCode::CompareImplConstObligation => {\n-                err.note(&format!(\n-                    \"the requirement `{}` appears on the associated impl constant \\\n-                     but not on the corresponding associated trait constant\",\n-                    predicate\n-                ));\n-            }\n             ObligationCauseCode::TrivialBound => {\n                 err.help(\"see issue #48214\");\n                 if tcx.sess.opts.unstable_features.is_nightly_build() {"}, {"sha": "04f2eb459cf430bf37e96945db277feee65a0482", "filename": "compiler/rustc_typeck/src/astconv/mod.rs", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/rust-lang/rust/blob/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fastconv%2Fmod.rs?ref=3bbe95ca0cb50260aa23a507642af05a83652a4e", "patch": "@@ -1150,17 +1150,12 @@ impl<'o, 'tcx> dyn AstConv<'tcx> + 'o {\n             .expect(\"missing associated type\");\n \n         if !assoc_item.vis.is_accessible_from(def_scope, tcx) {\n-            let kind = match assoc_item.kind {\n-                ty::AssocKind::Type => \"type\",\n-                ty::AssocKind::Const => \"const\",\n-                _ => unreachable!(),\n-            };\n             tcx.sess\n                 .struct_span_err(\n                     binding.span,\n-                    &format!(\"associated {kind} `{}` is private\", binding.item_name),\n+                    &format!(\"{} `{}` is private\", assoc_item.kind, binding.item_name),\n                 )\n-                .span_label(binding.span, &format!(\"private associated {kind}\"))\n+                .span_label(binding.span, &format!(\"private {}\", assoc_item.kind))\n                 .emit();\n         }\n         tcx.check_stability(assoc_item.def_id, Some(hir_ref_id), binding.span, None);"}, {"sha": "af77efc3c2d57434692c14e091bf1605358c0d10", "filename": "compiler/rustc_typeck/src/check/compare_method.rs", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bbe95ca0cb50260aa23a507642af05a83652a4e/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_typeck%2Fsrc%2Fcheck%2Fcompare_method.rs?ref=3bbe95ca0cb50260aa23a507642af05a83652a4e", "patch": "@@ -90,9 +90,10 @@ fn compare_predicate_entailment<'tcx>(\n     let mut cause = ObligationCause::new(\n         impl_m_span,\n         impl_m_hir_id,\n-        ObligationCauseCode::CompareImplMethodObligation {\n+        ObligationCauseCode::CompareImplItemObligation {\n             impl_item_def_id: impl_m.def_id.expect_local(),\n             trait_item_def_id: trait_m.def_id,\n+            kind: impl_m.kind,\n         },\n     );\n \n@@ -223,9 +224,10 @@ fn compare_predicate_entailment<'tcx>(\n             let cause = ObligationCause::new(\n                 span,\n                 impl_m_hir_id,\n-                ObligationCauseCode::CompareImplMethodObligation {\n+                ObligationCauseCode::CompareImplItemObligation {\n                     impl_item_def_id: impl_m.def_id.expect_local(),\n                     trait_item_def_id: trait_m.def_id,\n+                    kind: impl_m.kind,\n                 },\n             );\n             ocx.register_obligation(traits::Obligation::new(cause, param_env, predicate));\n@@ -1079,7 +1081,11 @@ pub(crate) fn compare_const_impl<'tcx>(\n         let mut cause = ObligationCause::new(\n             impl_c_span,\n             impl_c_hir_id,\n-            ObligationCauseCode::CompareImplConstObligation,\n+            ObligationCauseCode::CompareImplItemObligation {\n+                impl_item_def_id: impl_c.def_id.expect_local(),\n+                trait_item_def_id: trait_c.def_id,\n+                kind: impl_c.kind,\n+            },\n         );\n \n         // There is no \"body\" here, so just pass dummy id.\n@@ -1249,9 +1255,10 @@ fn compare_type_predicate_entailment<'tcx>(\n             let cause = ObligationCause::new(\n                 span,\n                 impl_ty_hir_id,\n-                ObligationCauseCode::CompareImplTypeObligation {\n+                ObligationCauseCode::CompareImplItemObligation {\n                     impl_item_def_id: impl_ty.def_id.expect_local(),\n                     trait_item_def_id: trait_ty.def_id,\n+                    kind: impl_ty.kind,\n                 },\n             );\n             ocx.register_obligations(obligations);"}, {"sha": "63bac96135b42f4c9763d253924ab3bf40e44f67", "filename": "src/test/ui/associated-consts/associated-const-impl-wrong-lifetime.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3bbe95ca0cb50260aa23a507642af05a83652a4e/src%2Ftest%2Fui%2Fassociated-consts%2Fassociated-const-impl-wrong-lifetime.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bbe95ca0cb50260aa23a507642af05a83652a4e/src%2Ftest%2Fui%2Fassociated-consts%2Fassociated-const-impl-wrong-lifetime.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fassociated-consts%2Fassociated-const-impl-wrong-lifetime.rs?ref=3bbe95ca0cb50260aa23a507642af05a83652a4e", "patch": "@@ -5,7 +5,7 @@ trait Foo {\n \n impl<'a> Foo for &'a () {\n     const NAME: &'a str = \"unit\";\n-    //~^ ERROR mismatched types [E0308]\n+    //~^ ERROR const not compatible with trait\n }\n \n fn main() {}"}, {"sha": "de1d9589e99615bcdc0c271f143d670c3c27f046", "filename": "src/test/ui/associated-consts/associated-const-impl-wrong-lifetime.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3bbe95ca0cb50260aa23a507642af05a83652a4e/src%2Ftest%2Fui%2Fassociated-consts%2Fassociated-const-impl-wrong-lifetime.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3bbe95ca0cb50260aa23a507642af05a83652a4e/src%2Ftest%2Fui%2Fassociated-consts%2Fassociated-const-impl-wrong-lifetime.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fassociated-consts%2Fassociated-const-impl-wrong-lifetime.stderr?ref=3bbe95ca0cb50260aa23a507642af05a83652a4e", "patch": "@@ -1,4 +1,4 @@\n-error[E0308]: mismatched types\n+error[E0308]: const not compatible with trait\n   --> $DIR/associated-const-impl-wrong-lifetime.rs:7:5\n    |\n LL |     const NAME: &'a str = \"unit\";"}, {"sha": "ce79c635add69ac2e94f8c8e6fd6125980115109", "filename": "src/test/ui/generic-associated-types/impl_bounds.stderr", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/3bbe95ca0cb50260aa23a507642af05a83652a4e/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fimpl_bounds.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3bbe95ca0cb50260aa23a507642af05a83652a4e/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fimpl_bounds.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fgeneric-associated-types%2Fimpl_bounds.stderr?ref=3bbe95ca0cb50260aa23a507642af05a83652a4e", "patch": "@@ -47,14 +47,14 @@ note: required because of the requirements on the impl of `Copy` for `Fooy<T>`\n    |\n LL | #[derive(Copy, Clone)]\n    |          ^^^^\n-note: the requirement `Fooy<T>: Copy` appears on the associated impl type `C` but not on the corresponding associated trait type\n-  --> $DIR/impl_bounds.rs:7:5\n+note: the requirement `Fooy<T>: Copy` appears on the `impl`'s associated type `C` but not on the corresponding trait's associated type\n+  --> $DIR/impl_bounds.rs:7:10\n    |\n LL | trait Foo {\n    |       --- in this trait\n ...\n LL |     type C where Self: Clone;\n-   |     ^^^^^^ this trait associated type doesn't have the requirement `Fooy<T>: Copy`\n+   |          ^ this trait's associated type doesn't have the requirement `Fooy<T>: Copy`\n    = note: this error originates in the derive macro `Copy` (in Nightly builds, run with -Z macro-backtrace for more info)\n help: consider restricting type parameter `T`\n    |\n@@ -72,14 +72,14 @@ note: required because of the requirements on the impl of `Copy` for `Fooy<T>`\n    |\n LL | #[derive(Copy, Clone)]\n    |          ^^^^\n-note: the requirement `Fooy<T>: Copy` appears on the impl method `d` but not on the corresponding trait method\n+note: the requirement `Fooy<T>: Copy` appears on the `impl`'s method `d` but not on the corresponding trait's method\n   --> $DIR/impl_bounds.rs:8:8\n    |\n LL | trait Foo {\n    |       --- in this trait\n ...\n LL |     fn d() where Self: Clone;\n-   |        ^ this trait method doesn't have the requirement `Fooy<T>: Copy`\n+   |        ^ this trait's method doesn't have the requirement `Fooy<T>: Copy`\n    = note: this error originates in the derive macro `Copy` (in Nightly builds, run with -Z macro-backtrace for more info)\n help: consider restricting type parameter `T`\n    |"}, {"sha": "e13ae80f918b2be0fb9d0e341cd95421866e4fa7", "filename": "src/test/ui/nll/trait-associated-constant.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3bbe95ca0cb50260aa23a507642af05a83652a4e/src%2Ftest%2Fui%2Fnll%2Ftrait-associated-constant.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3bbe95ca0cb50260aa23a507642af05a83652a4e/src%2Ftest%2Fui%2Fnll%2Ftrait-associated-constant.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Ftrait-associated-constant.rs?ref=3bbe95ca0cb50260aa23a507642af05a83652a4e", "patch": "@@ -19,7 +19,7 @@ struct FailStruct { }\n \n impl<'a: 'b, 'b, 'c> Anything<'a, 'b> for FailStruct {\n     const AC: Option<&'c str> = None;\n-    //~^ ERROR: mismatched types\n+    //~^ ERROR: const not compatible with trait\n }\n \n struct OKStruct2 { }"}, {"sha": "ae0ffd904e7996e496e9ccf18adfe3ecb9feac32", "filename": "src/test/ui/nll/trait-associated-constant.stderr", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/3bbe95ca0cb50260aa23a507642af05a83652a4e/src%2Ftest%2Fui%2Fnll%2Ftrait-associated-constant.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3bbe95ca0cb50260aa23a507642af05a83652a4e/src%2Ftest%2Fui%2Fnll%2Ftrait-associated-constant.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fnll%2Ftrait-associated-constant.stderr?ref=3bbe95ca0cb50260aa23a507642af05a83652a4e", "patch": "@@ -1,4 +1,4 @@\n-error[E0308]: mismatched types\n+error[E0308]: const not compatible with trait\n   --> $DIR/trait-associated-constant.rs:21:5\n    |\n LL |     const AC: Option<&'c str> = None;"}]}