{"sha": "1db95a2354ecca1c841446dca019c6c26a37bbcf", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFkYjk1YTIzNTRlY2NhMWM4NDE0NDZkY2EwMTljNmMyNmEzN2JiY2Y=", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2017-11-08T09:09:16Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2017-11-08T09:09:16Z"}, "message": "Rollup merge of #45766 - GuillaumeGomez:trait-methods-list, r=QuietMisdreavus\n\nAdd more elements in the sidebar\n\nFixes #45740.\n\nr? @rust-lang/docs", "tree": {"sha": "f4ec0c0b897b9fc6048ec20ac6c27349242f09f2", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f4ec0c0b897b9fc6048ec20ac6c27349242f09f2"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1db95a2354ecca1c841446dca019c6c26a37bbcf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1db95a2354ecca1c841446dca019c6c26a37bbcf", "html_url": "https://github.com/rust-lang/rust/commit/1db95a2354ecca1c841446dca019c6c26a37bbcf", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1db95a2354ecca1c841446dca019c6c26a37bbcf/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0f6e0107c3c6d7152eb870f5bced2ea5b1743626", "url": "https://api.github.com/repos/rust-lang/rust/commits/0f6e0107c3c6d7152eb870f5bced2ea5b1743626", "html_url": "https://github.com/rust-lang/rust/commit/0f6e0107c3c6d7152eb870f5bced2ea5b1743626"}, {"sha": "ac398a33a9fa982739f8476a80c1ee3f442d1bd9", "url": "https://api.github.com/repos/rust-lang/rust/commits/ac398a33a9fa982739f8476a80c1ee3f442d1bd9", "html_url": "https://github.com/rust-lang/rust/commit/ac398a33a9fa982739f8476a80c1ee3f442d1bd9"}], "stats": {"total": 229, "additions": 198, "deletions": 31}, "files": [{"sha": "eb59c57603aaed77eb0a1946e12b1ecf65cd17dd", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 139, "deletions": 31, "changes": 170, "blob_url": "https://github.com/rust-lang/rust/blob/1db95a2354ecca1c841446dca019c6c26a37bbcf/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1db95a2354ecca1c841446dca019c6c26a37bbcf/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=1db95a2354ecca1c841446dca019c6c26a37bbcf", "patch": "@@ -2498,7 +2498,7 @@ fn item_trait(w: &mut fmt::Formatter, cx: &Context, it: &clean::Item,\n \n         if !foreign.is_empty() {\n             write!(w, \"\n-                <h2 id='foreign-impls' class='section-header'>\n+                <h2 id='foreign-impls' class='small-section-header'>\n                   Implementations on Foreign Types<a href='#foreign-impls' class='anchor'></a>\n                 </h2>\n             \")?;\n@@ -3591,7 +3591,8 @@ fn sidebar_assoc_items(it: &clean::Item) -> String {\n             let mut links = HashSet::new();\n             let ret = v.iter()\n                        .filter_map(|i| if let Some(ref i) = i.inner_impl().trait_ {\n-                           let out = format!(\"{:#}\", i).replace(\"<\", \"&lt;\").replace(\">\", \"&gt;\");\n+                           let i_display = format!(\"{:#}\", i);\n+                           let out = Escape(&i_display);\n                            let encoded = small_url_encode(&format!(\"{:#}\", i));\n                            let generated = format!(\"<a href=\\\"#impl-{}\\\">{}</a>\", encoded, out);\n                            if !links.contains(&generated) && links.insert(generated.clone()) {\n@@ -3617,11 +3618,12 @@ fn sidebar_assoc_items(it: &clean::Item) -> String {\n fn sidebar_struct(fmt: &mut fmt::Formatter, it: &clean::Item,\n                   s: &clean::Struct) -> fmt::Result {\n     let mut sidebar = String::new();\n+    let fields = get_struct_fields_name(&s.fields);\n \n-    if s.fields.iter()\n-               .any(|f| if let clean::StructFieldItem(..) = f.inner { true } else { false }) {\n+    if !fields.is_empty() {\n         if let doctree::Plain = s.struct_type {\n-            sidebar.push_str(\"<li><a href=\\\"#fields\\\">Fields</a></li>\");\n+            sidebar.push_str(&format!(\"<a class=\\\"sidebar-title\\\" href=\\\"#fields\\\">Fields</a>\\\n+                                       <div class=\\\"sidebar-links\\\">{}</div>\", fields));\n         }\n     }\n \n@@ -3633,40 +3635,122 @@ fn sidebar_struct(fmt: &mut fmt::Formatter, it: &clean::Item,\n     Ok(())\n }\n \n+fn extract_for_impl_name(item: &clean::Item) -> Option<(String, String)> {\n+    match item.inner {\n+        clean::ItemEnum::ImplItem(ref i) => {\n+            if let Some(ref trait_) = i.trait_ {\n+                Some((format!(\"{:#}\", i.for_), format!(\"{:#}\", trait_)))\n+            } else {\n+                None\n+            }\n+        },\n+        _ => None,\n+    }\n+}\n+\n fn sidebar_trait(fmt: &mut fmt::Formatter, it: &clean::Item,\n                  t: &clean::Trait) -> fmt::Result {\n     let mut sidebar = String::new();\n \n-    let has_types = t.items.iter().any(|m| m.is_associated_type());\n-    let has_consts = t.items.iter().any(|m| m.is_associated_const());\n-    let has_required = t.items.iter().any(|m| m.is_ty_method());\n-    let has_provided = t.items.iter().any(|m| m.is_method());\n+    let types = t.items\n+                 .iter()\n+                 .filter_map(|m| {\n+                     match m.name {\n+                         Some(ref name) if m.is_associated_type() => {\n+                             Some(format!(\"<a href=\\\"#associatedtype.{name}\\\">{name}</a>\",\n+                                          name=name))\n+                         }\n+                         _ => None,\n+                     }\n+                 })\n+                 .collect::<String>();\n+    let consts = t.items\n+                  .iter()\n+                  .filter_map(|m| {\n+                      match m.name {\n+                          Some(ref name) if m.is_associated_const() => {\n+                              Some(format!(\"<a href=\\\"#associatedconstant.{name}\\\">{name}</a>\",\n+                                           name=name))\n+                          }\n+                          _ => None,\n+                      }\n+                  })\n+                  .collect::<String>();\n+    let required = t.items\n+                    .iter()\n+                    .filter_map(|m| {\n+                        match m.name {\n+                            Some(ref name) if m.is_ty_method() => {\n+                                Some(format!(\"<a href=\\\"#tymethod.{name}\\\">{name}</a>\",\n+                                             name=name))\n+                            }\n+                            _ => None,\n+                        }\n+                    })\n+                    .collect::<String>();\n+    let provided = t.items\n+                    .iter()\n+                    .filter_map(|m| {\n+                        match m.name {\n+                            Some(ref name) if m.is_method() => {\n+                                Some(format!(\"<a href=\\\"#method.{name}\\\">{name}</a>\", name=name))\n+                            }\n+                            _ => None,\n+                        }\n+                    })\n+                    .collect::<String>();\n \n-    if has_types {\n-        sidebar.push_str(\"<li><a href=\\\"#associated-types\\\">Associated Types</a></li>\");\n+    if !types.is_empty() {\n+        sidebar.push_str(&format!(\"<a class=\\\"sidebar-title\\\" href=\\\"#associated-types\\\">\\\n+                                   Associated Types</a><div class=\\\"sidebar-links\\\">{}</div>\",\n+                                  types));\n     }\n-    if has_consts {\n-        sidebar.push_str(\"<li><a href=\\\"#associated-const\\\">Associated Constants</a></li>\");\n+    if !consts.is_empty() {\n+        sidebar.push_str(&format!(\"<a class=\\\"sidebar-title\\\" href=\\\"#associated-const\\\">\\\n+                                   Associated Constants</a><div class=\\\"sidebar-links\\\">{}</div>\",\n+                                  consts));\n     }\n-    if has_required {\n-        sidebar.push_str(\"<li><a href=\\\"#required-methods\\\">Required Methods</a></li>\");\n+    if !required.is_empty() {\n+        sidebar.push_str(&format!(\"<a class=\\\"sidebar-title\\\" href=\\\"#required-methods\\\">\\\n+                                   Required Methods</a><div class=\\\"sidebar-links\\\">{}</div>\",\n+                                  required));\n     }\n-    if has_provided {\n-        sidebar.push_str(\"<li><a href=\\\"#provided-methods\\\">Provided Methods</a></li>\");\n+    if !provided.is_empty() {\n+        sidebar.push_str(&format!(\"<a class=\\\"sidebar-title\\\" href=\\\"#provided-methods\\\">\\\n+                                   Provided Methods</a><div class=\\\"sidebar-links\\\">{}</div>\",\n+                                  provided));\n     }\n \n     let c = cache();\n \n     if let Some(implementors) = c.implementors.get(&it.def_id) {\n-        if implementors.iter().any(|i| i.impl_.for_.def_id()\n-                                   .map_or(false, |d| !c.paths.contains_key(&d)))\n-        {\n-            sidebar.push_str(\"<li><a href=\\\"#foreign-impls\\\">\\\n-                             Implementations on Foreign Types</a></li>\");\n-        }\n-    }\n-\n-    sidebar.push_str(\"<li><a href=\\\"#implementors\\\">Implementors</a></li>\");\n+        let res = implementors.iter()\n+                              .filter(|i| i.impl_.for_.def_id()\n+                                                      .map_or(false, |d| !c.paths.contains_key(&d)))\n+                              .filter_map(|i| {\n+                                  if let Some(item) = implementor2item(&c, i) {\n+                                      match extract_for_impl_name(&item) {\n+                                          Some((ref name, ref url)) => {\n+                                              Some(format!(\"<a href=\\\"#impl-{}\\\">{}</a>\",\n+                                                           small_url_encode(url),\n+                                                           Escape(name)))\n+                                          }\n+                                          _ => None,\n+                                      }\n+                                  } else {\n+                                      None\n+                                  }\n+                              })\n+                              .collect::<String>();\n+        if !res.is_empty() {\n+            sidebar.push_str(&format!(\"<a class=\\\"sidebar-title\\\" href=\\\"#foreign-impls\\\">\\\n+                                       Implementations on Foreign Types</a><div \\\n+                                       class=\\\"sidebar-links\\\">{}</div>\",\n+                                      res));\n+        }\n+    }\n+\n+    sidebar.push_str(\"<a class=\\\"sidebar-title\\\" href=\\\"#implementors\\\">Implementors</a>\");\n \n     sidebar.push_str(&sidebar_assoc_items(it));\n \n@@ -3693,13 +3777,29 @@ fn sidebar_typedef(fmt: &mut fmt::Formatter, it: &clean::Item,\n     Ok(())\n }\n \n+fn get_struct_fields_name(fields: &[clean::Item]) -> String {\n+    fields.iter()\n+          .filter(|f| if let clean::StructFieldItem(..) = f.inner {\n+              true\n+          } else {\n+              false\n+          })\n+          .filter_map(|f| match f.name {\n+              Some(ref name) => Some(format!(\"<a href=\\\"#structfield.{name}\\\">\\\n+                                              {name}</a>\", name=name)),\n+              _ => None,\n+          })\n+          .collect()\n+}\n+\n fn sidebar_union(fmt: &mut fmt::Formatter, it: &clean::Item,\n                  u: &clean::Union) -> fmt::Result {\n     let mut sidebar = String::new();\n+    let fields = get_struct_fields_name(&u.fields);\n \n-    if u.fields.iter()\n-               .any(|f| if let clean::StructFieldItem(..) = f.inner { true } else { false }) {\n-        sidebar.push_str(\"<li><a href=\\\"#fields\\\">Fields</a></li>\");\n+    if !fields.is_empty() {\n+        sidebar.push_str(&format!(\"<a class=\\\"sidebar-title\\\" href=\\\"#fields\\\">Fields</a>\\\n+                                   <div class=\\\"sidebar-links\\\">{}</div>\", fields));\n     }\n \n     sidebar.push_str(&sidebar_assoc_items(it));\n@@ -3714,8 +3814,16 @@ fn sidebar_enum(fmt: &mut fmt::Formatter, it: &clean::Item,\n                 e: &clean::Enum) -> fmt::Result {\n     let mut sidebar = String::new();\n \n-    if !e.variants.is_empty() {\n-        sidebar.push_str(\"<li><a href=\\\"#variants\\\">Variants</a></li>\");\n+    let variants = e.variants.iter()\n+                             .filter_map(|v| match v.name {\n+                                 Some(ref name) => Some(format!(\"<a href=\\\"#variant.{name}\\\">{name}\\\n+                                                                 </a>\", name = name)),\n+                                 _ => None,\n+                             })\n+                             .collect::<String>();\n+    if !variants.is_empty() {\n+        sidebar.push_str(&format!(\"<a class=\\\"sidebar-title\\\" href=\\\"#variants\\\">Variants</a>\\\n+                                   <div class=\\\"sidebar-links\\\">{}</div>\", variants));\n     }\n \n     sidebar.push_str(&sidebar_assoc_items(it));"}, {"sha": "9be40441e9d4f60fef5f4ed16be864662ace2691", "filename": "src/test/rustdoc/sidebar-items.rs", "status": "added", "additions": 59, "deletions": 0, "changes": 59, "blob_url": "https://github.com/rust-lang/rust/blob/1db95a2354ecca1c841446dca019c6c26a37bbcf/src%2Ftest%2Frustdoc%2Fsidebar-items.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1db95a2354ecca1c841446dca019c6c26a37bbcf/src%2Ftest%2Frustdoc%2Fsidebar-items.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fsidebar-items.rs?ref=1db95a2354ecca1c841446dca019c6c26a37bbcf", "patch": "@@ -0,0 +1,59 @@\n+// Copyright 2017 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#![crate_name = \"foo\"]\n+\n+// @has foo/trait.Foo.html\n+// @has - '//*[@class=\"sidebar-title\"][@href=\"#required-methods\"]' 'Required Methods'\n+// @has - '//*[@class=\"sidebar-links\"]/a' 'bar'\n+// @has - '//*[@class=\"sidebar-title\"][@href=\"#provided-methods\"]' 'Provided Methods'\n+// @has - '//*[@class=\"sidebar-links\"]/a' 'foo'\n+// @has - '//*[@class=\"sidebar-title\"][@href=\"#associated-const\"]' 'Associated Constants'\n+// @has - '//*[@class=\"sidebar-links\"]/a' 'BAR'\n+// @has - '//*[@class=\"sidebar-title\"][@href=\"#associated-types\"]' 'Associated Types'\n+// @has - '//*[@class=\"sidebar-links\"]/a' 'Output'\n+pub trait Foo {\n+    const BAR: u32 = 0;\n+    type Output: ?Sized;\n+\n+    fn foo() {}\n+    fn bar() -> Self::Output;\n+}\n+\n+// @has foo/struct.Bar.html\n+// @has - '//*[@class=\"sidebar-title\"][@href=\"#fields\"]' 'Fields'\n+// @has - '//*[@class=\"sidebar-links\"]/a[@href=\"#structfield.f\"]' 'f'\n+// @has - '//*[@class=\"sidebar-links\"]/a[@href=\"#structfield.u\"]' 'u'\n+// @!has - '//*[@class=\"sidebar-links\"]/a' 'w'\n+pub struct Bar {\n+    pub f: u32,\n+    pub u: u32,\n+    w: u32,\n+}\n+\n+// @has foo/enum.En.html\n+// @has - '//*[@class=\"sidebar-title\"][@href=\"#variants\"]' 'Variants'\n+// @has - '//*[@class=\"sidebar-links\"]/a' 'foo'\n+// @has - '//*[@class=\"sidebar-links\"]/a' 'bar'\n+pub enum En {\n+    foo,\n+    bar,\n+}\n+\n+// @has foo/union.MyUnion.html\n+// @has - '//*[@class=\"sidebar-title\"][@href=\"#fields\"]' 'Fields'\n+// @has - '//*[@class=\"sidebar-links\"]/a[@href=\"#structfield.f1\"]' 'f1'\n+// @has - '//*[@class=\"sidebar-links\"]/a[@href=\"#structfield.f2\"]' 'f2'\n+// @!has - '//*[@class=\"sidebar-links\"]/a' 'w'\n+pub union MyUnion {\n+    pub f1: u32,\n+    pub f2: f32,\n+    w: u32,\n+}"}]}