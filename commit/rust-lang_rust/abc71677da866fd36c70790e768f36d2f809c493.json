{"sha": "abc71677da866fd36c70790e768f36d2f809c493", "node_id": "MDY6Q29tbWl0NzI0NzEyOmFiYzcxNjc3ZGE4NjZmZDM2YzcwNzkwZTc2OGYzNmQyZjgwOWM0OTM=", "commit": {"author": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2020-09-16T20:19:45Z"}, "committer": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2020-09-16T21:17:51Z"}, "message": "Test that `const_precise_live_drops` can't be depended upon stably", "tree": {"sha": "18ebf9dcc69cda45b65189e48024896c9854d3f7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/18ebf9dcc69cda45b65189e48024896c9854d3f7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/abc71677da866fd36c70790e768f36d2f809c493", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/abc71677da866fd36c70790e768f36d2f809c493", "html_url": "https://github.com/rust-lang/rust/commit/abc71677da866fd36c70790e768f36d2f809c493", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/abc71677da866fd36c70790e768f36d2f809c493/comments", "author": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1e1257b8f87d1e3073020df27765dc57fcf2c0cd", "url": "https://api.github.com/repos/rust-lang/rust/commits/1e1257b8f87d1e3073020df27765dc57fcf2c0cd", "html_url": "https://github.com/rust-lang/rust/commit/1e1257b8f87d1e3073020df27765dc57fcf2c0cd"}], "stats": {"total": 57, "additions": 57, "deletions": 0}, "files": [{"sha": "651462d7ef19c4476e10e5b34f7d1dc2f9e2b630", "filename": "src/test/ui/consts/stable-precise-live-drops-in-libcore.rs", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/abc71677da866fd36c70790e768f36d2f809c493/src%2Ftest%2Fui%2Fconsts%2Fstable-precise-live-drops-in-libcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/abc71677da866fd36c70790e768f36d2f809c493/src%2Ftest%2Fui%2Fconsts%2Fstable-precise-live-drops-in-libcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fstable-precise-live-drops-in-libcore.rs?ref=abc71677da866fd36c70790e768f36d2f809c493", "patch": "@@ -0,0 +1,22 @@\n+#![stable(feature = \"core\", since = \"1.6.0\")]\n+#![feature(staged_api)]\n+#![feature(const_precise_live_drops, const_fn)]\n+\n+enum Either<T, S> {\n+    Left(T),\n+    Right(S),\n+}\n+\n+impl<T> Either<T, T> {\n+    #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[rustc_const_stable(feature = \"foo\", since = \"1.0.0\")]\n+    pub const fn unwrap(self) -> T {\n+        //~^ ERROR destructors cannot be evaluated at compile-time\n+        match self {\n+            Self::Left(t) => t,\n+            Self::Right(t) => t,\n+        }\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "a3f513541dd6a6ebd2b73c49458c7537326a4afd", "filename": "src/test/ui/consts/stable-precise-live-drops-in-libcore.stderr", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/abc71677da866fd36c70790e768f36d2f809c493/src%2Ftest%2Fui%2Fconsts%2Fstable-precise-live-drops-in-libcore.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/abc71677da866fd36c70790e768f36d2f809c493/src%2Ftest%2Fui%2Fconsts%2Fstable-precise-live-drops-in-libcore.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Fstable-precise-live-drops-in-libcore.stderr?ref=abc71677da866fd36c70790e768f36d2f809c493", "patch": "@@ -0,0 +1,12 @@\n+error[E0493]: destructors cannot be evaluated at compile-time\n+  --> $DIR/stable-precise-live-drops-in-libcore.rs:13:25\n+   |\n+LL |     pub const fn unwrap(self) -> T {\n+   |                         ^^^^ constant functions cannot evaluate destructors\n+...\n+LL |     }\n+   |     - value is dropped here\n+\n+error: aborting due to previous error\n+\n+For more information about this error, try `rustc --explain E0493`."}, {"sha": "619084eaa517a1895a5d286b93a996840c77557c", "filename": "src/test/ui/consts/unstable-precise-live-drops-in-libcore.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/abc71677da866fd36c70790e768f36d2f809c493/src%2Ftest%2Fui%2Fconsts%2Funstable-precise-live-drops-in-libcore.rs", "raw_url": "https://github.com/rust-lang/rust/raw/abc71677da866fd36c70790e768f36d2f809c493/src%2Ftest%2Fui%2Fconsts%2Funstable-precise-live-drops-in-libcore.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fconsts%2Funstable-precise-live-drops-in-libcore.rs?ref=abc71677da866fd36c70790e768f36d2f809c493", "patch": "@@ -0,0 +1,23 @@\n+// check-pass\n+\n+#![stable(feature = \"core\", since = \"1.6.0\")]\n+#![feature(staged_api)]\n+#![feature(const_precise_live_drops)]\n+\n+enum Either<T, S> {\n+    Left(T),\n+    Right(S),\n+}\n+\n+impl<T> Either<T, T> {\n+    #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[rustc_const_unstable(feature = \"foo\", issue = \"none\")]\n+    pub const fn unwrap(self) -> T {\n+        match self {\n+            Self::Left(t) => t,\n+            Self::Right(t) => t,\n+        }\n+    }\n+}\n+\n+fn main() {}"}]}