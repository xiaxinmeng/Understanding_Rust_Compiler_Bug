{"sha": "c825e08571136deb5643ccd42bddf76b799ea93b", "node_id": "C_kwDOAAsO6NoAKGM4MjVlMDg1NzExMzZkZWI1NjQzY2NkNDJiZGRmNzZiNzk5ZWE5M2I", "commit": {"author": {"name": "Rafael Rivera", "email": "rafael@withinwindows.com", "date": "2023-02-07T05:17:06Z"}, "committer": {"name": "Rafael Rivera", "email": "rafael@withinwindows.com", "date": "2023-02-07T05:17:06Z"}, "message": "Specify dlltool prefix when generating import libs", "tree": {"sha": "105089d487bbc50f957f72ad511167d5a9d400c4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/105089d487bbc50f957f72ad511167d5a9d400c4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c825e08571136deb5643ccd42bddf76b799ea93b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c825e08571136deb5643ccd42bddf76b799ea93b", "html_url": "https://github.com/rust-lang/rust/commit/c825e08571136deb5643ccd42bddf76b799ea93b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c825e08571136deb5643ccd42bddf76b799ea93b/comments", "author": {"login": "riverar", "id": 475132, "node_id": "MDQ6VXNlcjQ3NTEzMg==", "avatar_url": "https://avatars.githubusercontent.com/u/475132?v=4", "gravatar_id": "", "url": "https://api.github.com/users/riverar", "html_url": "https://github.com/riverar", "followers_url": "https://api.github.com/users/riverar/followers", "following_url": "https://api.github.com/users/riverar/following{/other_user}", "gists_url": "https://api.github.com/users/riverar/gists{/gist_id}", "starred_url": "https://api.github.com/users/riverar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/riverar/subscriptions", "organizations_url": "https://api.github.com/users/riverar/orgs", "repos_url": "https://api.github.com/users/riverar/repos", "events_url": "https://api.github.com/users/riverar/events{/privacy}", "received_events_url": "https://api.github.com/users/riverar/received_events", "type": "User", "site_admin": false}, "committer": {"login": "riverar", "id": 475132, "node_id": "MDQ6VXNlcjQ3NTEzMg==", "avatar_url": "https://avatars.githubusercontent.com/u/475132?v=4", "gravatar_id": "", "url": "https://api.github.com/users/riverar", "html_url": "https://github.com/riverar", "followers_url": "https://api.github.com/users/riverar/followers", "following_url": "https://api.github.com/users/riverar/following{/other_user}", "gists_url": "https://api.github.com/users/riverar/gists{/gist_id}", "starred_url": "https://api.github.com/users/riverar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/riverar/subscriptions", "organizations_url": "https://api.github.com/users/riverar/orgs", "repos_url": "https://api.github.com/users/riverar/repos", "events_url": "https://api.github.com/users/riverar/events{/privacy}", "received_events_url": "https://api.github.com/users/riverar/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "044a28a4091f2e1a5883f7fa990223f8b200a2cd", "url": "https://api.github.com/repos/rust-lang/rust/commits/044a28a4091f2e1a5883f7fa990223f8b200a2cd", "html_url": "https://github.com/rust-lang/rust/commit/044a28a4091f2e1a5883f7fa990223f8b200a2cd"}], "stats": {"total": 8, "additions": 8, "deletions": 0}, "files": [{"sha": "dd3268d7780c6acdc18a7a537e17d5b340dbb9c3", "filename": "compiler/rustc_codegen_llvm/src/back/archive.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/c825e08571136deb5643ccd42bddf76b799ea93b/compiler%2Frustc_codegen_llvm%2Fsrc%2Fback%2Farchive.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c825e08571136deb5643ccd42bddf76b799ea93b/compiler%2Frustc_codegen_llvm%2Fsrc%2Fback%2Farchive.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_codegen_llvm%2Fsrc%2Fback%2Farchive.rs?ref=c825e08571136deb5643ccd42bddf76b799ea93b", "patch": "@@ -183,6 +183,12 @@ impl ArchiveBuilderBuilder for LlvmArchiveBuilderBuilder {\n             // able to control the *exact* spelling of each of the symbols that are being imported:\n             // hence we don't want `dlltool` adding leading underscores automatically.\n             let dlltool = find_binutils_dlltool(sess);\n+            let temp_prefix = {\n+                let mut path = PathBuf::from(&output_path);\n+                path.pop();\n+                path.push(lib_name);\n+                path\n+            };\n             let result = std::process::Command::new(dlltool)\n                 .args([\n                     \"-d\",\n@@ -192,6 +198,8 @@ impl ArchiveBuilderBuilder for LlvmArchiveBuilderBuilder {\n                     \"-l\",\n                     output_path.to_str().unwrap(),\n                     \"--no-leading-underscore\",\n+                    \"--temp-prefix\",\n+                    temp_prefix.to_str().unwrap(),\n                 ])\n                 .output();\n "}]}