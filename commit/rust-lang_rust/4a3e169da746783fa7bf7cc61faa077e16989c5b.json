{"sha": "4a3e169da746783fa7bf7cc61faa077e16989c5b", "node_id": "C_kwDOAAsO6NoAKDRhM2UxNjlkYTc0Njc4M2ZhN2JmN2NjNjFmYWEwNzdlMTY5ODljNWI", "commit": {"author": {"name": "Sage Mitchell", "email": "dev@mx00s.com", "date": "2022-09-03T03:52:28Z"}, "committer": {"name": "Sage Mitchell", "email": "dev@mx00s.com", "date": "2022-09-04T15:07:53Z"}, "message": "Make `char::is_lowercase` and `char::is_uppercase` const\n\nImplements #101400.", "tree": {"sha": "ac1171870d8d87d7904785ff52db9808aedcf31b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ac1171870d8d87d7904785ff52db9808aedcf31b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/4a3e169da746783fa7bf7cc61faa077e16989c5b", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEs9hX5gDsx8ZkW964PfAIyjJfApcFAmMUv0kACgkQPfAIyjJf\nApedHg/9G7Wma25GxCNyOz3d1NdL5YvxPLfqcV7kUVNpj2FvpSo0g0wSCHh0aQU9\nZOCRd95u09RH28n4KxQedZWomGEoUNov4jXeWTnIzFvAV7cUPPHWv1ds3h08fYfd\nN8zMbZnbjSPW1ROpvmXZ0e6TLxFVFT3c7djQ11CpCFk5K5WzxS6aUwVCAUGMsMGm\n1T1+yqWPIjTZ/MoJnmKpXicNz96PnD2H4bvainvlkTexci4LBJE+/mvgtfolB/SS\nvo5MxbBA/9fAfWXHZgpaOg74XwXJ0sCIYTRN7+TLtXlG168r+4dCGLDHb/Hr9FQQ\ntFx23uyFdVY7V/8y+fnVDLoR5chdzjD7/k6PnqT7Q57eHoEHsTUy0KHNV2bVA50X\nxaCnyBvKh0XtxepDCKY3tkg9bmV5Ex7Hdx7EckhJaPlzZCGJfmoOMukEwqTcgYyq\nVl/u8EcfctXUNSXclz0FSio7K+1v46+rRtJAXmpmaXCcP5luaf8gdNtuEBHyayLu\nrU2E1LY9B4dp86vT4kLha2opjnE4LqQGQxKtIag+rK1VKOs1ERgLFY7gZuUcMIEr\nQojv7KXrD9OsRD2wodd6bElYrzoFHRm5RITYfeMUII+Tdq1zjbGTkNhLAiQrOqEH\nUTsv1446U9QIx36u2ExDBH2Jr30mhMwg+a49HephLK8ToGn0f4Q=\n=qH7y\n-----END PGP SIGNATURE-----", "payload": "tree ac1171870d8d87d7904785ff52db9808aedcf31b\nparent b11bf65e4aaa125952b6479a63f36e9e83efc32c\nauthor Sage Mitchell <dev@mx00s.com> 1662177148 -0700\ncommitter Sage Mitchell <dev@mx00s.com> 1662304073 -0700\n\nMake `char::is_lowercase` and `char::is_uppercase` const\n\nImplements #101400.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/4a3e169da746783fa7bf7cc61faa077e16989c5b", "html_url": "https://github.com/rust-lang/rust/commit/4a3e169da746783fa7bf7cc61faa077e16989c5b", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/4a3e169da746783fa7bf7cc61faa077e16989c5b/comments", "author": {"login": "mx00s", "id": 59317985, "node_id": "MDQ6VXNlcjU5MzE3OTg1", "avatar_url": "https://avatars.githubusercontent.com/u/59317985?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mx00s", "html_url": "https://github.com/mx00s", "followers_url": "https://api.github.com/users/mx00s/followers", "following_url": "https://api.github.com/users/mx00s/following{/other_user}", "gists_url": "https://api.github.com/users/mx00s/gists{/gist_id}", "starred_url": "https://api.github.com/users/mx00s/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mx00s/subscriptions", "organizations_url": "https://api.github.com/users/mx00s/orgs", "repos_url": "https://api.github.com/users/mx00s/repos", "events_url": "https://api.github.com/users/mx00s/events{/privacy}", "received_events_url": "https://api.github.com/users/mx00s/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mx00s", "id": 59317985, "node_id": "MDQ6VXNlcjU5MzE3OTg1", "avatar_url": "https://avatars.githubusercontent.com/u/59317985?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mx00s", "html_url": "https://github.com/mx00s", "followers_url": "https://api.github.com/users/mx00s/followers", "following_url": "https://api.github.com/users/mx00s/following{/other_user}", "gists_url": "https://api.github.com/users/mx00s/gists{/gist_id}", "starred_url": "https://api.github.com/users/mx00s/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mx00s/subscriptions", "organizations_url": "https://api.github.com/users/mx00s/orgs", "repos_url": "https://api.github.com/users/mx00s/repos", "events_url": "https://api.github.com/users/mx00s/events{/privacy}", "received_events_url": "https://api.github.com/users/mx00s/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b11bf65e4aaa125952b6479a63f36e9e83efc32c", "url": "https://api.github.com/repos/rust-lang/rust/commits/b11bf65e4aaa125952b6479a63f36e9e83efc32c", "html_url": "https://github.com/rust-lang/rust/commit/b11bf65e4aaa125952b6479a63f36e9e83efc32c"}], "stats": {"total": 82, "additions": 55, "deletions": 27}, "files": [{"sha": "b7a63b7c675666d627f4ac9c504b89955390a56c", "filename": "library/core/src/char/methods.rs", "status": "modified", "additions": 20, "deletions": 2, "changes": 22, "blob_url": "https://github.com/rust-lang/rust/blob/4a3e169da746783fa7bf7cc61faa077e16989c5b/library%2Fcore%2Fsrc%2Fchar%2Fmethods.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a3e169da746783fa7bf7cc61faa077e16989c5b/library%2Fcore%2Fsrc%2Fchar%2Fmethods.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Fchar%2Fmethods.rs?ref=4a3e169da746783fa7bf7cc61faa077e16989c5b", "patch": "@@ -746,10 +746,19 @@ impl char {\n     /// assert!(!'\u4e2d'.is_lowercase());\n     /// assert!(!' '.is_lowercase());\n     /// ```\n+    ///\n+    /// In a const context:\n+    ///\n+    /// ```\n+    /// #![feature(const_unicode_case_lookup)]\n+    /// const CAPITAL_DELTA_IS_LOWERCASE: bool = '\u0394'.is_lowercase();\n+    /// assert!(!CAPITAL_DELTA_IS_LOWERCASE);\n+    /// ```\n     #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[rustc_const_unstable(feature = \"const_unicode_case_lookup\", issue = \"101400\")]\n     #[inline]\n-    pub fn is_lowercase(self) -> bool {\n+    pub const fn is_lowercase(self) -> bool {\n         match self {\n             'a'..='z' => true,\n             c => c > '\\x7f' && unicode::Lowercase(c),\n@@ -779,10 +788,19 @@ impl char {\n     /// assert!(!'\u4e2d'.is_uppercase());\n     /// assert!(!' '.is_uppercase());\n     /// ```\n+    ///\n+    /// In a const context:\n+    ///\n+    /// ```\n+    /// #![feature(const_unicode_case_lookup)]\n+    /// const CAPITAL_DELTA_IS_UPPERCASE: bool = '\u0394'.is_uppercase();\n+    /// assert!(CAPITAL_DELTA_IS_UPPERCASE);\n+    /// ```\n     #[must_use]\n     #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[rustc_const_unstable(feature = \"const_unicode_case_lookup\", issue = \"101400\")]\n     #[inline]\n-    pub fn is_uppercase(self) -> bool {\n+    pub const fn is_uppercase(self) -> bool {\n         match self {\n             'A'..='Z' => true,\n             c => c > '\\x7f' && unicode::Uppercase(c),"}, {"sha": "5b1e2045fff63e07df043843dfdd1872b635abdf", "filename": "library/core/src/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/4a3e169da746783fa7bf7cc61faa077e16989c5b/library%2Fcore%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a3e169da746783fa7bf7cc61faa077e16989c5b/library%2Fcore%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Flib.rs?ref=4a3e169da746783fa7bf7cc61faa077e16989c5b", "patch": "@@ -143,6 +143,7 @@\n #![feature(const_type_id)]\n #![feature(const_type_name)]\n #![feature(const_default_impls)]\n+#![feature(const_unicode_case_lookup)]\n #![feature(const_unsafecell_get_mut)]\n #![feature(core_panic)]\n #![feature(duration_consts_float)]"}, {"sha": "2bbedf0e2d2933e818f644d7dede5785bf14cbd7", "filename": "library/core/src/unicode/unicode_data.rs", "status": "modified", "additions": 18, "deletions": 15, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/4a3e169da746783fa7bf7cc61faa077e16989c5b/library%2Fcore%2Fsrc%2Funicode%2Funicode_data.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a3e169da746783fa7bf7cc61faa077e16989c5b/library%2Fcore%2Fsrc%2Funicode%2Funicode_data.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Fcore%2Fsrc%2Funicode%2Funicode_data.rs?ref=4a3e169da746783fa7bf7cc61faa077e16989c5b", "patch": "@@ -1,7 +1,8 @@\n ///! This file is generated by src/tools/unicode-table-generator; do not edit manually!\n \n+#[rustc_const_unstable(feature = \"const_unicode_case_lookup\", issue = \"101400\")]\n #[inline(always)]\n-fn bitset_search<\n+const fn bitset_search<\n     const N: usize,\n     const CHUNK_SIZE: usize,\n     const N1: usize,\n@@ -17,14 +18,14 @@ fn bitset_search<\n     let bucket_idx = (needle / 64) as usize;\n     let chunk_map_idx = bucket_idx / CHUNK_SIZE;\n     let chunk_piece = bucket_idx % CHUNK_SIZE;\n-    let chunk_idx = if let Some(&v) = chunk_idx_map.get(chunk_map_idx) {\n-        v\n+    let chunk_idx = if chunk_map_idx < chunk_idx_map.len() {\n+        chunk_idx_map[chunk_map_idx]\n     } else {\n         return false;\n     };\n     let idx = bitset_chunk_idx[chunk_idx as usize][chunk_piece] as usize;\n-    let word = if let Some(word) = bitset_canonical.get(idx) {\n-        *word\n+    let word = if idx < bitset_canonical.len() {\n+        bitset_canonical[idx]\n     } else {\n         let (real_idx, mapping) = bitset_canonicalized[idx - bitset_canonical.len()];\n         let mut word = bitset_canonical[real_idx as usize];\n@@ -318,14 +319,14 @@ pub mod grapheme_extend {\n \n #[rustfmt::skip]\n pub mod lowercase {\n-    static BITSET_CHUNKS_MAP: [u8; 123] = [\n+    const BITSET_CHUNKS_MAP: [u8; 123] = [\n         14, 17, 0, 0, 9, 0, 0, 12, 13, 10, 0, 16, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n         0, 0, 0, 4, 1, 0, 15, 0, 8, 0, 0, 11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n         0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 18, 0,\n         3, 0, 0, 7,\n     ];\n-    static BITSET_INDEX_CHUNKS: [[u8; 16]; 19] = [\n+    const BITSET_INDEX_CHUNKS: [[u8; 16]; 19] = [\n         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 59, 0, 0],\n         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 16, 14, 55, 0],\n@@ -346,7 +347,7 @@ pub mod lowercase {\n         [16, 49, 2, 20, 66, 9, 57, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n         [63, 39, 54, 12, 73, 61, 18, 1, 6, 62, 71, 19, 68, 69, 3, 44],\n     ];\n-    static BITSET_CANONICAL: [u64; 55] = [\n+    const BITSET_CANONICAL: [u64; 55] = [\n         0b0000000000000000000000000000000000000000000000000000000000000000,\n         0b1111111111111111110000000000000000000000000011111111111111111111,\n         0b1010101010101010101010101010101010101010101010101010100000000010,\n@@ -403,13 +404,14 @@ pub mod lowercase {\n         0b1110011111111111111111111111111111111111111111110000000000000000,\n         0b1110101111000000000000000000000000001111111111111111111111111100,\n     ];\n-    static BITSET_MAPPING: [(u8, u8); 20] = [\n+    const BITSET_MAPPING: [(u8, u8); 20] = [\n         (0, 64), (1, 188), (1, 183), (1, 176), (1, 109), (1, 124), (1, 126), (1, 66), (1, 70),\n         (1, 77), (2, 146), (2, 144), (2, 83), (3, 12), (3, 6), (4, 156), (4, 78), (5, 187),\n         (6, 132), (7, 93),\n     ];\n \n-    pub fn lookup(c: char) -> bool {\n+    #[rustc_const_unstable(feature = \"const_unicode_case_lookup\", issue = \"101400\")]\n+    pub const fn lookup(c: char) -> bool {\n         super::bitset_search(\n             c as u32,\n             &BITSET_CHUNKS_MAP,\n@@ -454,14 +456,14 @@ pub mod n {\n \n #[rustfmt::skip]\n pub mod uppercase {\n-    static BITSET_CHUNKS_MAP: [u8; 125] = [\n+    const BITSET_CHUNKS_MAP: [u8; 125] = [\n         12, 15, 6, 6, 0, 6, 6, 2, 4, 11, 6, 16, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,\n         6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 8, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,\n         6, 6, 6, 5, 6, 14, 6, 10, 6, 6, 1, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,\n         6, 7, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 13, 6, 6,\n         6, 6, 9, 6, 3,\n     ];\n-    static BITSET_INDEX_CHUNKS: [[u8; 16]; 17] = [\n+    const BITSET_INDEX_CHUNKS: [[u8; 16]; 17] = [\n         [43, 43, 5, 34, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 5, 1],\n         [43, 43, 5, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43],\n         [43, 43, 39, 43, 43, 43, 43, 43, 17, 17, 62, 17, 42, 29, 24, 23],\n@@ -480,7 +482,7 @@ pub mod uppercase {\n         [57, 19, 2, 18, 10, 47, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43],\n         [57, 37, 17, 27, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43],\n     ];\n-    static BITSET_CANONICAL: [u64; 43] = [\n+    const BITSET_CANONICAL: [u64; 43] = [\n         0b0000011111111111111111111111111000000000000000000000000000000000,\n         0b0000000000111111111111111111111111111111111111111111111111111111,\n         0b0101010101010101010101010101010101010101010101010101010000000001,\n@@ -525,13 +527,14 @@ pub mod uppercase {\n         0b1111011111111111000000000000000000000000000000000000000000000000,\n         0b1111111100000000111111110000000000111111000000001111111100000000,\n     ];\n-    static BITSET_MAPPING: [(u8, u8); 25] = [\n+    const BITSET_MAPPING: [(u8, u8); 25] = [\n         (0, 187), (0, 177), (0, 171), (0, 167), (0, 164), (0, 32), (0, 47), (0, 51), (0, 121),\n         (0, 117), (0, 109), (1, 150), (1, 148), (1, 142), (1, 134), (1, 131), (1, 64), (2, 164),\n         (2, 146), (2, 20), (3, 146), (3, 140), (3, 134), (4, 178), (4, 171),\n     ];\n \n-    pub fn lookup(c: char) -> bool {\n+    #[rustc_const_unstable(feature = \"const_unicode_case_lookup\", issue = \"101400\")]\n+    pub const fn lookup(c: char) -> bool {\n         super::bitset_search(\n             c as u32,\n             &BITSET_CHUNKS_MAP,"}, {"sha": "727ae3e9f78f16037eca6869b3fd84db25191e0a", "filename": "src/tools/unicode-table-generator/src/range_search.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/4a3e169da746783fa7bf7cc61faa077e16989c5b/src%2Ftools%2Funicode-table-generator%2Fsrc%2Frange_search.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a3e169da746783fa7bf7cc61faa077e16989c5b/src%2Ftools%2Funicode-table-generator%2Fsrc%2Frange_search.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Funicode-table-generator%2Fsrc%2Frange_search.rs?ref=4a3e169da746783fa7bf7cc61faa077e16989c5b", "patch": "@@ -1,5 +1,6 @@\n+#[rustc_const_unstable(feature = \"const_unicode_case_lookup\", issue = \"101400\")]\n #[inline(always)]\n-fn bitset_search<\n+const fn bitset_search<\n     const N: usize,\n     const CHUNK_SIZE: usize,\n     const N1: usize,\n@@ -15,14 +16,14 @@ fn bitset_search<\n     let bucket_idx = (needle / 64) as usize;\n     let chunk_map_idx = bucket_idx / CHUNK_SIZE;\n     let chunk_piece = bucket_idx % CHUNK_SIZE;\n-    let chunk_idx = if let Some(&v) = chunk_idx_map.get(chunk_map_idx) {\n-        v\n+    let chunk_idx = if chunk_map_idx < chunk_idx_map.len() {\n+        chunk_idx_map[chunk_map_idx]\n     } else {\n         return false;\n     };\n     let idx = bitset_chunk_idx[chunk_idx as usize][chunk_piece] as usize;\n-    let word = if let Some(word) = bitset_canonical.get(idx) {\n-        *word\n+    let word = if idx < bitset_canonical.len() {\n+        bitset_canonical[idx]\n     } else {\n         let (real_idx, mapping) = bitset_canonicalized[idx - bitset_canonical.len()];\n         let mut word = bitset_canonical[real_idx as usize];"}, {"sha": "5a0aabf62834e6fa8247cee9bcf68ed5c62a83a9", "filename": "src/tools/unicode-table-generator/src/raw_emitter.rs", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/4a3e169da746783fa7bf7cc61faa077e16989c5b/src%2Ftools%2Funicode-table-generator%2Fsrc%2Fraw_emitter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/4a3e169da746783fa7bf7cc61faa077e16989c5b/src%2Ftools%2Funicode-table-generator%2Fsrc%2Fraw_emitter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Funicode-table-generator%2Fsrc%2Fraw_emitter.rs?ref=4a3e169da746783fa7bf7cc61faa077e16989c5b", "patch": "@@ -76,15 +76,15 @@ impl RawEmitter {\n \n         writeln!(\n             &mut self.file,\n-            \"static BITSET_CANONICAL: [u64; {}] = [{}];\",\n+            \"const BITSET_CANONICAL: [u64; {}] = [{}];\",\n             canonicalized.canonical_words.len(),\n             fmt_list(canonicalized.canonical_words.iter().map(|v| Bits(*v))),\n         )\n         .unwrap();\n         self.bytes_used += 8 * canonicalized.canonical_words.len();\n         writeln!(\n             &mut self.file,\n-            \"static BITSET_MAPPING: [(u8, u8); {}] = [{}];\",\n+            \"const BITSET_MAPPING: [(u8, u8); {}] = [{}];\",\n             canonicalized.canonicalized_words.len(),\n             fmt_list(&canonicalized.canonicalized_words),\n         )\n@@ -96,7 +96,12 @@ impl RawEmitter {\n \n         self.blank_line();\n \n-        writeln!(&mut self.file, \"pub fn lookup(c: char) -> bool {{\").unwrap();\n+        writeln!(\n+            &mut self.file,\n+            r#\"#[rustc_const_unstable(feature = \"const_unicode_case_lookup\", issue = \"101400\")]\"#\n+        )\n+        .unwrap();\n+        writeln!(&mut self.file, \"pub const fn lookup(c: char) -> bool {{\").unwrap();\n         writeln!(&mut self.file, \"    super::bitset_search(\",).unwrap();\n         writeln!(&mut self.file, \"        c as u32,\").unwrap();\n         writeln!(&mut self.file, \"        &BITSET_CHUNKS_MAP,\").unwrap();\n@@ -130,15 +135,15 @@ impl RawEmitter {\n \n         writeln!(\n             &mut self.file,\n-            \"static BITSET_CHUNKS_MAP: [u8; {}] = [{}];\",\n+            \"const BITSET_CHUNKS_MAP: [u8; {}] = [{}];\",\n             chunk_indices.len(),\n             fmt_list(&chunk_indices),\n         )\n         .unwrap();\n         self.bytes_used += chunk_indices.len();\n         writeln!(\n             &mut self.file,\n-            \"static BITSET_INDEX_CHUNKS: [[u8; {}]; {}] = [{}];\",\n+            \"const BITSET_INDEX_CHUNKS: [[u8; {}]; {}] = [{}];\",\n             chunk_length,\n             chunks.len(),\n             fmt_list(chunks.iter()),"}]}