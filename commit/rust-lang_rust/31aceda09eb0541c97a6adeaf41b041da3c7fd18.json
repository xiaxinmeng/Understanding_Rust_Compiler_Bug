{"sha": "31aceda09eb0541c97a6adeaf41b041da3c7fd18", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMxYWNlZGEwOWViMDU0MWM5N2E2YWRlYWY0MWIwNDFkYTNjN2ZkMTg=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2010-08-19T23:15:37Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2010-08-19T23:15:37Z"}, "message": "Export glue as stabs on Windows as well", "tree": {"sha": "141999f652ca94939b2bd787b65aa335e99194ec", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/141999f652ca94939b2bd787b65aa335e99194ec"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/31aceda09eb0541c97a6adeaf41b041da3c7fd18", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/31aceda09eb0541c97a6adeaf41b041da3c7fd18", "html_url": "https://github.com/rust-lang/rust/commit/31aceda09eb0541c97a6adeaf41b041da3c7fd18", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/31aceda09eb0541c97a6adeaf41b041da3c7fd18/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "09ebda7ce5720e76aa38b75a5361d9a9306f5d83", "url": "https://api.github.com/repos/rust-lang/rust/commits/09ebda7ce5720e76aa38b75a5361d9a9306f5d83", "html_url": "https://github.com/rust-lang/rust/commit/09ebda7ce5720e76aa38b75a5361d9a9306f5d83"}], "stats": {"total": 18, "additions": 13, "deletions": 5}, "files": [{"sha": "3e95be2c3f0b5467bbabbd197ccaa5db0f3fff70", "filename": "src/boot/be/pe.ml", "status": "modified", "additions": 13, "deletions": 5, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/31aceda09eb0541c97a6adeaf41b041da3c7fd18/src%2Fboot%2Fbe%2Fpe.ml", "raw_url": "https://github.com/rust-lang/rust/raw/31aceda09eb0541c97a6adeaf41b041da3c7fd18/src%2Fboot%2Fbe%2Fpe.ml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fboot%2Fbe%2Fpe.ml?ref=31aceda09eb0541c97a6adeaf41b041da3c7fd18", "patch": "@@ -785,18 +785,26 @@ let crate_exports (sem:Semant.ctxt) : pe_export array =\n   in\n \n   (* Make some fake symbol table entries to aid in debugging. *)\n-  let export_stab (node_id, fixup) =\n-    let name = Hashtbl.find sem.Semant.ctxt_all_item_names node_id in\n+  let export_stab name fixup =\n     {\n       pe_export_name_fixup = new_fixup \"export name fixup\";\n-      pe_export_name = \"rust$\" ^ (Ast.sprintf_name () name);\n+      pe_export_name = \"rust$\" ^ name;\n       pe_export_address_fixup = fixup\n     }\n   in\n+  let export_stab_of_fn (node_id, fixup) =\n+    let name = Hashtbl.find sem.Semant.ctxt_all_item_names node_id in\n+    export_stab (\"fn$\" ^ (Semant.string_of_name name)) fixup\n+  in\n+  let export_stab_of_glue (glue, code) =\n+    export_stab (Semant.glue_str sem glue) code.Semant.code_fixup\n+  in\n \n   let stabs =\n-    let pairs = htab_pairs sem.Semant.ctxt_fn_fixups in\n-    Array.of_list (List.map export_stab pairs)\n+    Array.of_list (List.concat [\n+      (List.map export_stab_of_fn (htab_pairs sem.Semant.ctxt_fn_fixups));\n+      (List.map export_stab_of_glue (htab_pairs sem.Semant.ctxt_glue_code))\n+    ])\n   in\n \n     Array.concat"}]}