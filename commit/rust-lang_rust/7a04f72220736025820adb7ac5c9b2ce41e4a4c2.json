{"sha": "7a04f72220736025820adb7ac5c9b2ce41e4a4c2", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdhMDRmNzIyMjA3MzYwMjU4MjBhZGI3YWM1YzliMmNlNDFlNGE0YzI=", "commit": {"author": {"name": "Daiki Ihara", "email": "sasurau4@gmail.com", "date": "2021-06-21T09:42:25Z"}, "committer": {"name": "Daiki Ihara", "email": "sasurau4@gmail.com", "date": "2021-06-21T09:42:25Z"}, "message": "Fix pointed out", "tree": {"sha": "42b46857f32de044330d9dbd1b2bdf2844901e88", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/42b46857f32de044330d9dbd1b2bdf2844901e88"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7a04f72220736025820adb7ac5c9b2ce41e4a4c2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7a04f72220736025820adb7ac5c9b2ce41e4a4c2", "html_url": "https://github.com/rust-lang/rust/commit/7a04f72220736025820adb7ac5c9b2ce41e4a4c2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7a04f72220736025820adb7ac5c9b2ce41e4a4c2/comments", "author": {"login": "sasurau4", "id": 13580199, "node_id": "MDQ6VXNlcjEzNTgwMTk5", "avatar_url": "https://avatars.githubusercontent.com/u/13580199?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sasurau4", "html_url": "https://github.com/sasurau4", "followers_url": "https://api.github.com/users/sasurau4/followers", "following_url": "https://api.github.com/users/sasurau4/following{/other_user}", "gists_url": "https://api.github.com/users/sasurau4/gists{/gist_id}", "starred_url": "https://api.github.com/users/sasurau4/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sasurau4/subscriptions", "organizations_url": "https://api.github.com/users/sasurau4/orgs", "repos_url": "https://api.github.com/users/sasurau4/repos", "events_url": "https://api.github.com/users/sasurau4/events{/privacy}", "received_events_url": "https://api.github.com/users/sasurau4/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sasurau4", "id": 13580199, "node_id": "MDQ6VXNlcjEzNTgwMTk5", "avatar_url": "https://avatars.githubusercontent.com/u/13580199?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sasurau4", "html_url": "https://github.com/sasurau4", "followers_url": "https://api.github.com/users/sasurau4/followers", "following_url": "https://api.github.com/users/sasurau4/following{/other_user}", "gists_url": "https://api.github.com/users/sasurau4/gists{/gist_id}", "starred_url": "https://api.github.com/users/sasurau4/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sasurau4/subscriptions", "organizations_url": "https://api.github.com/users/sasurau4/orgs", "repos_url": "https://api.github.com/users/sasurau4/repos", "events_url": "https://api.github.com/users/sasurau4/events{/privacy}", "received_events_url": "https://api.github.com/users/sasurau4/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cd1ef8de1829d7ec17015f5cd02b476cd0d1d889", "url": "https://api.github.com/repos/rust-lang/rust/commits/cd1ef8de1829d7ec17015f5cd02b476cd0d1d889", "html_url": "https://github.com/rust-lang/rust/commit/cd1ef8de1829d7ec17015f5cd02b476cd0d1d889"}], "stats": {"total": 21, "additions": 16, "deletions": 5}, "files": [{"sha": "6a9a84da01437445b2f8f9f4bc37f9f1fc6dc1b9", "filename": "crates/ide_assists/src/handlers/extract_function.rs", "status": "modified", "additions": 16, "deletions": 5, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/7a04f72220736025820adb7ac5c9b2ce41e4a4c2/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fextract_function.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7a04f72220736025820adb7ac5c9b2ce41e4a4c2/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fextract_function.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fide_assists%2Fsrc%2Fhandlers%2Fextract_function.rs?ref=7a04f72220736025820adb7ac5c9b2ce41e4a4c2", "patch": "@@ -109,10 +109,15 @@ pub(crate) fn extract_function(acc: &mut Assists, ctx: &AssistContext) -> Option\n \n             let new_indent = IndentLevel::from_node(&insert_after);\n             let old_indent = fun.body.indent_level();\n+            let is_body_contains_await = body_contains_await(&fun.body);\n \n-            builder.replace(target_range, format_replacement(ctx, &fun, old_indent));\n+            builder.replace(\n+                target_range,\n+                format_replacement(ctx, &fun, old_indent, is_body_contains_await),\n+            );\n \n-            let fn_def = format_function(ctx, module, &fun, old_indent, new_indent);\n+            let fn_def =\n+                format_function(ctx, module, &fun, old_indent, new_indent, is_body_contains_await);\n             let insert_offset = insert_after.text_range().end();\n             match ctx.config.snippet_cap {\n                 Some(cap) => builder.insert_snippet(cap, insert_offset, fn_def),\n@@ -954,7 +959,12 @@ fn scope_for_fn_insertion_node(node: &SyntaxNode, anchor: Anchor) -> Option<Synt\n     last_ancestor\n }\n \n-fn format_replacement(ctx: &AssistContext, fun: &Function, indent: IndentLevel) -> String {\n+fn format_replacement(\n+    ctx: &AssistContext,\n+    fun: &Function,\n+    indent: IndentLevel,\n+    is_body_contains_await: bool,\n+) -> String {\n     let ret_ty = fun.return_type(ctx);\n \n     let args = fun.params.iter().map(|param| param.to_arg(ctx));\n@@ -994,7 +1004,7 @@ fn format_replacement(ctx: &AssistContext, fun: &Function, indent: IndentLevel)\n         }\n     }\n     format_to!(buf, \"{}\", expr);\n-    if body_contains_await(&fun.body) {\n+    if is_body_contains_await {\n         buf.push_str(\".await\");\n     }\n     if fun.ret_ty.is_unit()\n@@ -1125,12 +1135,13 @@ fn format_function(\n     fun: &Function,\n     old_indent: IndentLevel,\n     new_indent: IndentLevel,\n+    is_body_contains_await: bool,\n ) -> String {\n     let mut fn_def = String::new();\n     let params = make_param_list(ctx, module, fun);\n     let ret_ty = make_ret_ty(ctx, module, fun);\n     let body = make_body(ctx, old_indent, new_indent, fun);\n-    let async_kw = if body_contains_await(&fun.body) { \"async \" } else { \"\" };\n+    let async_kw = if is_body_contains_await { \"async \" } else { \"\" };\n     match ctx.config.snippet_cap {\n         Some(_) => format_to!(fn_def, \"\\n\\n{}{}fn $0{}{}\", new_indent, async_kw, fun.name, params),\n         None => format_to!(fn_def, \"\\n\\n{}{}fn {}{}\", new_indent, async_kw, fun.name, params),"}]}