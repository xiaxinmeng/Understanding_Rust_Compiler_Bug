{"sha": "99a731d2656923daa708513324b1a6418a1d3fb7", "node_id": "C_kwDOAAsO6NoAKDk5YTczMWQyNjU2OTIzZGFhNzA4NTEzMzI0YjFhNjQxOGExZDNmYjc", "commit": {"author": {"name": "Philipp Krones", "email": "hello@philkrones.com", "date": "2022-06-06T11:25:11Z"}, "committer": {"name": "Philipp Krones", "email": "hello@philkrones.com", "date": "2022-06-06T14:17:58Z"}, "message": "Book: Improve sync documentation\n\n- Move doc about defining remotes to the front and use the defined\n  remotes in the further documentation\n- Don't recommend pushing to the remote repo directly\n- Add some clarifying comments", "tree": {"sha": "4a3d502165661259c573ef4d6b9649f6d7134908", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4a3d502165661259c573ef4d6b9649f6d7134908"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/99a731d2656923daa708513324b1a6418a1d3fb7", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIyBAABCAAdFiEEij1UXJ/PQTcb99vTHKDfKvWdaKUFAmKeDJYACgkQHKDfKvWd\naKVJZw/3T92Q3cQprZcGO+CLKx4VgKkZW0xRh1sdsbAVQPAzJrfUqhJWp8Tc7loF\nnN7Mo37ulpzYLx4JZS6vI83O1FDq82oQPcVFRcGpsrp4ZKAR/+Rcl0j/GNQ4i4ZF\n8lB2JJ5xigh5uEjVUa3NAK92+VLNgQcxEYg10mtDEVU3t4CROtMuzsh8TgNMAJom\nNebPDfSKna1jvOV3rWjXZ9SV4kb1vwZ2EVW+LyGCwBBL0tRi0Sy8mE1vkELMlm0n\ngghRIn/LrKqdE3GI35jYkGZymEFGy6X/roo2n2vv3jpR4swPgS4MMcT9v+IJNubm\nu37shKAVzrYNrMqs6z0fW2RnzGyfSG1UzKKKQw17Mze6Vs6HVymGdT/Yu57FL971\nsgbuf6Wa/ifMwXMklgAg1ZGq78HerujJIazWMTt6HWuaghGUQgBHauIaSg3HnJpi\nSYQutZoal/ldsp670vOru5hW+lzDRNHEirjhfb3y55vIcZPbung5cogHyxkOQyOm\nhy9Jsr+fXXLpi1BiVZ4kctIT8SclcdWbnZS5E7YBzztrtN9Jl0TwgEOSFG1e9lQ1\nrj7w29kkZ8IZwoeOrq2xHjCIEy/6M4uztGucVvzmr2L+yJ7YwsDbIdLKd20Trp0r\n5ao5FK8hZYbSHs7fuAB97o8+B35tozA2HdqGIOIPht0HRsDufA==\n=+lT+\n-----END PGP SIGNATURE-----", "payload": "tree 4a3d502165661259c573ef4d6b9649f6d7134908\nparent 93056599220db45a67e3ba82484af4718456fefa\nauthor Philipp Krones <hello@philkrones.com> 1654514711 +0200\ncommitter Philipp Krones <hello@philkrones.com> 1654525078 +0200\n\nBook: Improve sync documentation\n\n- Move doc about defining remotes to the front and use the defined\n  remotes in the further documentation\n- Don't recommend pushing to the remote repo directly\n- Add some clarifying comments\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/99a731d2656923daa708513324b1a6418a1d3fb7", "html_url": "https://github.com/rust-lang/rust/commit/99a731d2656923daa708513324b1a6418a1d3fb7", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/99a731d2656923daa708513324b1a6418a1d3fb7/comments", "author": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "committer": {"login": "flip1995", "id": 9744647, "node_id": "MDQ6VXNlcjk3NDQ2NDc=", "avatar_url": "https://avatars.githubusercontent.com/u/9744647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/flip1995", "html_url": "https://github.com/flip1995", "followers_url": "https://api.github.com/users/flip1995/followers", "following_url": "https://api.github.com/users/flip1995/following{/other_user}", "gists_url": "https://api.github.com/users/flip1995/gists{/gist_id}", "starred_url": "https://api.github.com/users/flip1995/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/flip1995/subscriptions", "organizations_url": "https://api.github.com/users/flip1995/orgs", "repos_url": "https://api.github.com/users/flip1995/repos", "events_url": "https://api.github.com/users/flip1995/events{/privacy}", "received_events_url": "https://api.github.com/users/flip1995/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "93056599220db45a67e3ba82484af4718456fefa", "url": "https://api.github.com/repos/rust-lang/rust/commits/93056599220db45a67e3ba82484af4718456fefa", "html_url": "https://github.com/rust-lang/rust/commit/93056599220db45a67e3ba82484af4718456fefa"}], "stats": {"total": 60, "additions": 29, "deletions": 31}, "files": [{"sha": "5a0f7409a2e4cebfd42d26bd7771d90912423501", "filename": "book/src/development/infrastructure/sync.md", "status": "modified", "additions": 29, "deletions": 31, "changes": 60, "blob_url": "https://github.com/rust-lang/rust/blob/99a731d2656923daa708513324b1a6418a1d3fb7/book%2Fsrc%2Fdevelopment%2Finfrastructure%2Fsync.md", "raw_url": "https://github.com/rust-lang/rust/raw/99a731d2656923daa708513324b1a6418a1d3fb7/book%2Fsrc%2Fdevelopment%2Finfrastructure%2Fsync.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/book%2Fsrc%2Fdevelopment%2Finfrastructure%2Fsync.md?ref=99a731d2656923daa708513324b1a6418a1d3fb7", "patch": "@@ -51,6 +51,24 @@ sudo chown --reference=/usr/lib/git-core/git-subtree~ /usr/lib/git-core/git-subt\n > `bash` instead. You can do this by editing the first line of the `git-subtree`\n > script and changing `sh` to `bash`.\n \n+## Defining remotes\n+\n+You may want to define remotes, so you don't have to type out the remote\n+addresses on every sync. You can do this with the following commands (these\n+commands still have to be run inside the `rust` directory):\n+\n+```bash\n+# Set clippy-upstream remote for pulls\n+$ git remote add clippy-upstream https://github.com/rust-lang/rust-clippy\n+# Make sure to not push to the upstream repo\n+$ git remote set-url --push clippy-upstream DISABLED\n+# Set a local remote\n+$ git remote add clippy-local /path/to/rust-clippy\n+```\n+\n+> Note: The following sections assume that you have set those remotes with the\n+> above remote names.\n+\n ## Performing the sync from [`rust-lang/rust`] to Clippy\n \n Here is a TL;DR version of the sync process (all of the following commands have\n@@ -64,22 +82,25 @@ to be run inside the `rust` directory):\n     # Make sure to change `your-github-name` to your github name in the following command. Also be\n     # sure to either use a net-new branch, e.g. `sync-from-rust`, or delete the branch beforehand\n     # because changes cannot be fast forwarded and you have to run this command again.\n-    git subtree push -P src/tools/clippy git@github.com:your-github-name/rust-clippy sync-from-rust\n+    git subtree push -P src/tools/clippy clippy-local sync-from-rust\n     ```\n \n-    > _Note:_ This will directly push to the remote repository. You can also\n-    > push to your local copy by replacing the remote address with\n-    > `/path/to/rust-clippy` directory.\n-\n     > _Note:_ Most of the time you have to create a merge commit in the\n     > `rust-clippy` repo (this has to be done in the Clippy repo, not in the\n     > rust-copy of Clippy):\n     ```bash\n     git fetch upstream  # assuming upstream is the rust-lang/rust remote\n     git checkout sync-from-rust\n-    git merge upstream/master\n+    git merge upstream/master --no-ff\n     ```\n-4. Open a PR to `rust-lang/rust-clippy` and wait for it to get merged (to\n+    > Note: This is one of the few instances where a merge commit is allowed in\n+    > a PR.\n+4. Bump the nightly version in the Clippy repository by changing the date in the\n+   rust-toolchain file to the current date and committing it with the message:\n+   ```bash\n+   git commit -m \"Bump nightly version -> YYYY-MM-DD\"\n+   ```\n+5. Open a PR to `rust-lang/rust-clippy` and wait for it to get merged (to\n    accelerate the process ping the `@rust-lang/clippy` team in your PR and/or\n    ask them in the [Zulip] stream.)\n \n@@ -93,33 +114,10 @@ All of the following commands have to be run inside the `rust` directory.\n 2. Sync the `rust-lang/rust-clippy` master to the rust-copy of Clippy:\n     ```bash\n     git checkout -b sync-from-clippy\n-    git subtree pull -P src/tools/clippy https://github.com/rust-lang/rust-clippy master\n+    git subtree pull -P src/tools/clippy clippy-upstream master\n     ```\n 3. Open a PR to [`rust-lang/rust`]\n \n-## Defining remotes\n-\n-You may want to define remotes, so you don't have to type out the remote\n-addresses on every sync. You can do this with the following commands (these\n-commands still have to be run inside the `rust` directory):\n-\n-```bash\n-# Set clippy-upstream remote for pulls\n-$ git remote add clippy-upstream https://github.com/rust-lang/rust-clippy\n-# Make sure to not push to the upstream repo\n-$ git remote set-url --push clippy-upstream DISABLED\n-# Set clippy-origin remote to your fork for pushes\n-$ git remote add clippy-origin git@github.com:your-github-name/rust-clippy\n-# Set a local remote\n-$ git remote add clippy-local /path/to/rust-clippy\n-```\n-\n-You can then sync with the remote names from above, e.g.:\n-\n-```bash\n-$ git subtree push -P src/tools/clippy clippy-local sync-from-rust\n-```\n-\n [gitgitgadget-pr]: https://github.com/gitgitgadget/git/pull/493\n [subtree]: https://rustc-dev-guide.rust-lang.org/contributing.html#external-dependencies-subtree\n [`rust-lang/rust`]: https://github.com/rust-lang/rust"}]}