{"sha": "9d59c6b76e96005201d3b66dae946cc01dc5e565", "node_id": "MDY6Q29tbWl0NzI0NzEyOjlkNTljNmI3NmU5NjAwNTIwMWQzYjY2ZGFlOTQ2Y2MwMWRjNWU1NjU=", "commit": {"author": {"name": "Lukas Kalbertodt", "email": "lukas.kalbertodt@gmail.com", "date": "2018-07-27T18:44:09Z"}, "committer": {"name": "Lukas Kalbertodt", "email": "lukas.kalbertodt@gmail.com", "date": "2018-07-28T12:00:56Z"}, "message": "Add help message for missing `IndexMut` impl\n\nBefore this change it simply says \"cannot assign to immutable indexed\ncontent\". This might be confusing for Rust beginners, as implementing\ntwo traits for \"one operator\" is not intuitive.", "tree": {"sha": "0dcf88cfde8af43cf8cf90ec1b20f864debd1b65", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0dcf88cfde8af43cf8cf90ec1b20f864debd1b65"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9d59c6b76e96005201d3b66dae946cc01dc5e565", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEENwctvZ5TgcKYXim8PLr0FT+BhicFAltcWw4ACgkQPLr0FT+B\nhidqrxAAmtus0IuRRI020SPIFbi2cCqLG1OlV1KDDWUPPjhhWvv2eDxnMt4PBuqD\noeFExTPwO+KjMymRzN3EAo1e0mZfzGw5IEp28OU8LDXG79yYWgsnNIG6iCwzYCRk\nCrZBZsUKZ/uDstD4CNoUQWk96OdPh4Y8ODjX7toGjVVBzDMV7sThTUcdeKvRB8S8\nrxsK1McABp0CJ1fEZsdl+pnZ2LW+f7R0OGgYwC6Kb4B98lFzIbqOsu+KuTd8dzS/\nEpzVa4tuAtmiyiWtrAI57+ApUZNW+HMTIIGJBh4GSdQuL/YxFgOS3mdK0xoLko/+\n8K46Kbh0s2y04apJXZwi359W+u9pVHsUdQbkO0Cwhb95fnuoqEE3uhYzsLRJigZo\nDZIy9F8phgDEl7+GIQ41vBv4GRPntwhPocq10dLVYK3niT3sMsP5RYLu/jROo/Jh\nBJ9a96VzIHvhgzgyupIQxA5Sw+F4evPZ2MG+yaThcWbdyRh3Ip/yFHO2gm3v56jt\nNOZUW8kd0P1O5phro8HoHAR8nH9Kf6O0oPVx+YS4PqjExFBt0jpYDUkpG3VrdPRC\nlftJmRBwiviKPBhJg1AekJds7x3exznrmQ4jNUSuh2qloS5bPWRf0v0+y5ELza49\nplspbLJxGXR1fFSAVqWTNLaGF4yyKbekbIou2WKRXtSuVs8WauE=\n=b095\n-----END PGP SIGNATURE-----", "payload": "tree 0dcf88cfde8af43cf8cf90ec1b20f864debd1b65\nparent 45b48b9b6d70065a16cc119fe934ed342c664c78\nauthor Lukas Kalbertodt <lukas.kalbertodt@gmail.com> 1532717049 +0200\ncommitter Lukas Kalbertodt <lukas.kalbertodt@gmail.com> 1532779256 +0200\n\nAdd help message for missing `IndexMut` impl\n\nBefore this change it simply says \"cannot assign to immutable indexed\ncontent\". This might be confusing for Rust beginners, as implementing\ntwo traits for \"one operator\" is not intuitive.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9d59c6b76e96005201d3b66dae946cc01dc5e565", "html_url": "https://github.com/rust-lang/rust/commit/9d59c6b76e96005201d3b66dae946cc01dc5e565", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9d59c6b76e96005201d3b66dae946cc01dc5e565/comments", "author": {"login": "LukasKalbertodt", "id": 7419664, "node_id": "MDQ6VXNlcjc0MTk2NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7419664?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LukasKalbertodt", "html_url": "https://github.com/LukasKalbertodt", "followers_url": "https://api.github.com/users/LukasKalbertodt/followers", "following_url": "https://api.github.com/users/LukasKalbertodt/following{/other_user}", "gists_url": "https://api.github.com/users/LukasKalbertodt/gists{/gist_id}", "starred_url": "https://api.github.com/users/LukasKalbertodt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LukasKalbertodt/subscriptions", "organizations_url": "https://api.github.com/users/LukasKalbertodt/orgs", "repos_url": "https://api.github.com/users/LukasKalbertodt/repos", "events_url": "https://api.github.com/users/LukasKalbertodt/events{/privacy}", "received_events_url": "https://api.github.com/users/LukasKalbertodt/received_events", "type": "User", "site_admin": false}, "committer": {"login": "LukasKalbertodt", "id": 7419664, "node_id": "MDQ6VXNlcjc0MTk2NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/7419664?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LukasKalbertodt", "html_url": "https://github.com/LukasKalbertodt", "followers_url": "https://api.github.com/users/LukasKalbertodt/followers", "following_url": "https://api.github.com/users/LukasKalbertodt/following{/other_user}", "gists_url": "https://api.github.com/users/LukasKalbertodt/gists{/gist_id}", "starred_url": "https://api.github.com/users/LukasKalbertodt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LukasKalbertodt/subscriptions", "organizations_url": "https://api.github.com/users/LukasKalbertodt/orgs", "repos_url": "https://api.github.com/users/LukasKalbertodt/repos", "events_url": "https://api.github.com/users/LukasKalbertodt/events{/privacy}", "received_events_url": "https://api.github.com/users/LukasKalbertodt/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "45b48b9b6d70065a16cc119fe934ed342c664c78", "url": "https://api.github.com/repos/rust-lang/rust/commits/45b48b9b6d70065a16cc119fe934ed342c664c78", "html_url": "https://github.com/rust-lang/rust/commit/45b48b9b6d70065a16cc119fe934ed342c664c78"}], "stats": {"total": 23, "additions": 23, "deletions": 0}, "files": [{"sha": "97348c168de8c128243742b914320a35d76c39e4", "filename": "src/librustc_borrowck/borrowck/mod.rs", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/9d59c6b76e96005201d3b66dae946cc01dc5e565/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9d59c6b76e96005201d3b66dae946cc01dc5e565/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_borrowck%2Fborrowck%2Fmod.rs?ref=9d59c6b76e96005201d3b66dae946cc01dc5e565", "patch": "@@ -881,6 +881,29 @@ impl<'a, 'tcx> BorrowckCtxt<'a, 'tcx> {\n                                 }\n                             }\n                         }\n+\n+                        // We add a special note about `IndexMut`, if the source of this error\n+                        // is the fact that `Index` is implemented, but `IndexMut` is not. Needing\n+                        // to implement two traits for \"one operator\" is not very intuitive for\n+                        // many programmers.\n+                        if err.cmt.note == mc::NoteIndex {\n+                            let node_id = self.tcx.hir.hir_to_node_id(err.cmt.hir_id);\n+                            let node =  self.tcx.hir.get(node_id);\n+\n+                            // This pattern probably always matches.\n+                            if let hir_map::NodeExpr(\n+                                hir::Expr { node: hir::ExprKind::Index(lhs, _), ..}\n+                            ) = node {\n+                                let ty = self.tables.expr_ty(lhs);\n+\n+                                db.help(&format!(\n+                                    \"trait `IndexMut` is required to modify indexed content, but \\\n+                                     it is not implemented for {}\",\n+                                    ty\n+                                ));\n+                            }\n+                        }\n+\n                         db\n                     }\n                     BorrowViolation(euv::ClosureCapture(_)) => {"}]}