{"sha": "68d576fd345b197e5be08cc9b84201e5897dc729", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY4ZDU3NmZkMzQ1YjE5N2U1YmUwOGNjOWI4NDIwMWU1ODk3ZGM3Mjk=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-02-17T06:31:05Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2014-02-19T09:10:31Z"}, "message": "rustdoc: Fix json output and input\n\nTurns out a hash map with integer keys isn't serializable to json.\n\nCloses #10115", "tree": {"sha": "25ebea7acdf107ddf61e5412dd9e2e7de6245937", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/25ebea7acdf107ddf61e5412dd9e2e7de6245937"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/68d576fd345b197e5be08cc9b84201e5897dc729", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/68d576fd345b197e5be08cc9b84201e5897dc729", "html_url": "https://github.com/rust-lang/rust/commit/68d576fd345b197e5be08cc9b84201e5897dc729", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/68d576fd345b197e5be08cc9b84201e5897dc729/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6db37bb147c06cddf7ae6a99eb913a5ceaee792b", "url": "https://api.github.com/repos/rust-lang/rust/commits/6db37bb147c06cddf7ae6a99eb913a5ceaee792b", "html_url": "https://github.com/rust-lang/rust/commit/6db37bb147c06cddf7ae6a99eb913a5ceaee792b"}], "stats": {"total": 40, "additions": 34, "deletions": 6}, "files": [{"sha": "586323358c241234494ea2560f6e0954957208e5", "filename": "src/librustdoc/clean.rs", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/68d576fd345b197e5be08cc9b84201e5897dc729/src%2Flibrustdoc%2Fclean.rs", "raw_url": "https://github.com/rust-lang/rust/raw/68d576fd345b197e5be08cc9b84201e5897dc729/src%2Flibrustdoc%2Fclean.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fclean.rs?ref=68d576fd345b197e5be08cc9b84201e5897dc729", "patch": "@@ -25,7 +25,6 @@ use rustc::metadata::csearch;\n use rustc::metadata::decoder;\n \n use std;\n-use std::hashmap::HashMap;\n \n use doctree;\n use visit_ast;\n@@ -68,17 +67,17 @@ impl<T: Clean<U>, U> Clean<~[U]> for syntax::opt_vec::OptVec<T> {\n pub struct Crate {\n     name: ~str,\n     module: Option<Item>,\n-    externs: HashMap<ast::CrateNum, ExternalCrate>,\n+    externs: ~[(ast::CrateNum, ExternalCrate)],\n }\n \n impl<'a> Clean<Crate> for visit_ast::RustdocVisitor<'a> {\n     fn clean(&self) -> Crate {\n         use syntax::attr::find_crateid;\n         let cx = local_data::get(super::ctxtkey, |x| *x.unwrap());\n \n-        let mut externs = HashMap::new();\n+        let mut externs = ~[];\n         cx.sess.cstore.iter_crate_data(|n, meta| {\n-            externs.insert(n, meta.clean());\n+            externs.push((n, meta.clean()));\n         });\n \n         Crate {"}, {"sha": "07ea22d42ecbbba0db88d25f2a72a16945610c9d", "filename": "src/librustdoc/html/render.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/68d576fd345b197e5be08cc9b84201e5897dc729/src%2Flibrustdoc%2Fhtml%2Frender.rs", "raw_url": "https://github.com/rust-lang/rust/raw/68d576fd345b197e5be08cc9b84201e5897dc729/src%2Flibrustdoc%2Fhtml%2Frender.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Frender.rs?ref=68d576fd345b197e5be08cc9b84201e5897dc729", "patch": "@@ -305,7 +305,7 @@ pub fn run(mut krate: clean::Crate, dst: Path) -> io::IoResult<()> {\n         krate = folder.fold_crate(krate);\n     }\n \n-    for (&n, e) in krate.externs.iter() {\n+    for &(n, ref e) in krate.externs.iter() {\n         cache.extern_locations.insert(n, extern_location(e, &cx.dst));\n     }\n "}, {"sha": "4194f5e47293628610fe8eaf809c49e42c96ece5", "filename": "src/librustdoc/lib.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/68d576fd345b197e5be08cc9b84201e5897dc729/src%2Flibrustdoc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/68d576fd345b197e5be08cc9b84201e5897dc729/src%2Flibrustdoc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Flib.rs?ref=68d576fd345b197e5be08cc9b84201e5897dc729", "patch": "@@ -344,7 +344,7 @@ fn json_output(krate: clean::Crate, res: ~[plugins::PluginJson],\n     };\n     let crate_json = match json::from_str(crate_json_str) {\n         Ok(j) => j,\n-        Err(_) => fail!(\"Rust generated JSON is invalid??\")\n+        Err(e) => fail!(\"Rust generated JSON is invalid: {:?}\", e)\n     };\n \n     json.insert(~\"crate\", crate_json);"}, {"sha": "5e6ab4b790ee5efd2c8c72df6989c81fc7fd6ed0", "filename": "src/test/run-make/rustdoc-json/Makefile", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/68d576fd345b197e5be08cc9b84201e5897dc729/src%2Ftest%2Frun-make%2Frustdoc-json%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/68d576fd345b197e5be08cc9b84201e5897dc729/src%2Ftest%2Frun-make%2Frustdoc-json%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frustdoc-json%2FMakefile?ref=68d576fd345b197e5be08cc9b84201e5897dc729", "patch": "@@ -0,0 +1,4 @@\n+-include ../tools.mk\n+all:\n+\t$(RUSTDOC) -w json -o $(TMPDIR)/doc.json foo.rs\n+\t$(RUSTDOC) -o $(TMPDIR)/doc $(TMPDIR)/doc.json"}, {"sha": "818ec1e5eb79013ce4ad7275cf9559d6bce200a5", "filename": "src/test/run-make/rustdoc-json/foo.rs", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/rust-lang/rust/blob/68d576fd345b197e5be08cc9b84201e5897dc729/src%2Ftest%2Frun-make%2Frustdoc-json%2Ffoo.rs", "raw_url": "https://github.com/rust-lang/rust/raw/68d576fd345b197e5be08cc9b84201e5897dc729/src%2Ftest%2Frun-make%2Frustdoc-json%2Ffoo.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make%2Frustdoc-json%2Ffoo.rs?ref=68d576fd345b197e5be08cc9b84201e5897dc729", "patch": "@@ -0,0 +1,25 @@\n+// Copyright 2014 The Rust Project Developers. See the COPYRIGHT\n+// file at the top-level directory of this distribution and at\n+// http://rust-lang.org/COPYRIGHT.\n+//\n+// Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+// http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+// <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+// option. This file may not be copied, modified, or distributed\n+// except according to those terms.\n+\n+#[crate_id = \"foo#0.1\"];\n+\n+//! Very docs\n+\n+pub mod bar {\n+\n+    /// So correct\n+    pub mod baz {\n+        /// Much detail\n+        pub fn baz() { }\n+    }\n+\n+    /// *wow*\n+    pub trait Doge { }\n+}"}]}