{"sha": "86d2af9f7b3f6af2ea9e4eca2584aa501b60aa14", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg2ZDJhZjlmN2IzZjZhZjJlYTllNGVjYTI1ODRhYTUwMWI2MGFhMTQ=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-01-11T23:00:37Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-01-11T23:00:37Z"}, "message": "Merge #2803\n\n2803: Fix various names, e.g. Iterator not resolving in core prelude r=matklad a=flodiebold\n\nBasically, `Iterator` is re-exported via several steps, which happened to not be\r\nresolved yet when we got to the prelude import, but since the name resolved to\r\nthe reexport from `core::iter` (just to no actual items), we gave up trying to\r\nresolve it further.\r\n\r\nMaybe part of the problem is that we can have\r\n`PartialResolvedImport::Unresolved` or `PartialResolvedImport::Indeterminate`\r\nwith `None` in all namespaces, and handle them differently.\r\n\r\nFixes #2683.\n\nCo-authored-by: Florian Diebold <flodiebold@gmail.com>", "tree": {"sha": "e5ae070838d2ecbb3bb71efad06a2927e42dde70", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e5ae070838d2ecbb3bb71efad06a2927e42dde70"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/86d2af9f7b3f6af2ea9e4eca2584aa501b60aa14", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeGlOVCRBK7hj4Ov3rIwAAdHIIAH0GWV2PiyjJLtuyUyIl5XRW\n/uZdorq0D+w+XdrHuTalZ0sLCk7xQj4t2TPWJeI32RbnC1s1fXMyWtpXDrOPIF0r\nJJbyB5I3rmEeShpg0DLk23jvVcgrE8S6m+f8b/9U4lBF3DMFCLCTfjNbZXp23Xo8\ny1gD+KzHBXEql8vYIl29pbFsVAqXtfHgxk/o0/DvlEwsiBIK7zcZyFEtooLpCXWd\n9TMvAwaLoIVIdWyx8jw28p+jIS61IRRcawkyk7Va9SvJoaaST5MoV/pO0QhnGSfV\nOpCWxZEEUgEZtQ74/Tfpca7VihpQKdfAVhyrMRZ5NBgbLg1TMC6mUhSv204CS20=\n=FbaV\n-----END PGP SIGNATURE-----\n", "payload": "tree e5ae070838d2ecbb3bb71efad06a2927e42dde70\nparent bcfd297f4910bbf2305ec859d7cf42b7dca25f57\nparent 9dc1826cfaa75983a83f9eb7f788067d5dedf5a7\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1578783637 +0000\ncommitter GitHub <noreply@github.com> 1578783637 +0000\n\nMerge #2803\n\n2803: Fix various names, e.g. Iterator not resolving in core prelude r=matklad a=flodiebold\n\nBasically, `Iterator` is re-exported via several steps, which happened to not be\r\nresolved yet when we got to the prelude import, but since the name resolved to\r\nthe reexport from `core::iter` (just to no actual items), we gave up trying to\r\nresolve it further.\r\n\r\nMaybe part of the problem is that we can have\r\n`PartialResolvedImport::Unresolved` or `PartialResolvedImport::Indeterminate`\r\nwith `None` in all namespaces, and handle them differently.\r\n\r\nFixes #2683.\n\nCo-authored-by: Florian Diebold <flodiebold@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/86d2af9f7b3f6af2ea9e4eca2584aa501b60aa14", "html_url": "https://github.com/rust-lang/rust/commit/86d2af9f7b3f6af2ea9e4eca2584aa501b60aa14", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/86d2af9f7b3f6af2ea9e4eca2584aa501b60aa14/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bcfd297f4910bbf2305ec859d7cf42b7dca25f57", "url": "https://api.github.com/repos/rust-lang/rust/commits/bcfd297f4910bbf2305ec859d7cf42b7dca25f57", "html_url": "https://github.com/rust-lang/rust/commit/bcfd297f4910bbf2305ec859d7cf42b7dca25f57"}, {"sha": "9dc1826cfaa75983a83f9eb7f788067d5dedf5a7", "url": "https://api.github.com/repos/rust-lang/rust/commits/9dc1826cfaa75983a83f9eb7f788067d5dedf5a7", "html_url": "https://github.com/rust-lang/rust/commit/9dc1826cfaa75983a83f9eb7f788067d5dedf5a7"}], "stats": {"total": 101, "additions": 100, "deletions": 1}, "files": [{"sha": "7499dff3131d9f58fb41b67f711e1d05515d92ff", "filename": "crates/ra_hir_def/src/nameres/collector.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/86d2af9f7b3f6af2ea9e4eca2584aa501b60aa14/crates%2Fra_hir_def%2Fsrc%2Fnameres%2Fcollector.rs", "raw_url": "https://github.com/rust-lang/rust/raw/86d2af9f7b3f6af2ea9e4eca2584aa501b60aa14/crates%2Fra_hir_def%2Fsrc%2Fnameres%2Fcollector.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Fnameres%2Fcollector.rs?ref=86d2af9f7b3f6af2ea9e4eca2584aa501b60aa14", "patch": "@@ -328,7 +328,7 @@ where\n             );\n \n             let def = res.resolved_def;\n-            if res.reached_fixedpoint == ReachedFixedPoint::No {\n+            if res.reached_fixedpoint == ReachedFixedPoint::No || def.is_none() {\n                 return PartialResolvedImport::Unresolved;\n             }\n "}, {"sha": "22103ab2908083b4be1c40dec0e5a684f29e51ea", "filename": "crates/ra_hir_def/src/nameres/tests/mod_resolution.rs", "status": "modified", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/rust-lang/rust/blob/86d2af9f7b3f6af2ea9e4eca2584aa501b60aa14/crates%2Fra_hir_def%2Fsrc%2Fnameres%2Ftests%2Fmod_resolution.rs", "raw_url": "https://github.com/rust-lang/rust/raw/86d2af9f7b3f6af2ea9e4eca2584aa501b60aa14/crates%2Fra_hir_def%2Fsrc%2Fnameres%2Ftests%2Fmod_resolution.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Fnameres%2Ftests%2Fmod_resolution.rs?ref=86d2af9f7b3f6af2ea9e4eca2584aa501b60aa14", "patch": "@@ -52,6 +52,51 @@ fn nested_module_resolution() {\n     \"###);\n }\n \n+#[test]\n+fn nested_module_resolution_2() {\n+    let map = def_map(\n+        \"\n+        //- /lib.rs\n+        mod prelude;\n+        mod iter;\n+\n+        //- /prelude.rs\n+        pub use crate::iter::Iterator;\n+\n+        //- /iter.rs\n+        pub use self::traits::Iterator;\n+        mod traits;\n+\n+        //- /iter/traits.rs\n+        pub use self::iterator::Iterator;\n+        mod iterator;\n+\n+        //- /iter/traits/iterator.rs\n+        pub trait Iterator;\n+        \",\n+    );\n+\n+    assert_snapshot!(map, @r###\"\n+    crate\n+    iter: t\n+    prelude: t\n+    \n+    crate::iter\n+    Iterator: t\n+    traits: t\n+    \n+    crate::iter::traits\n+    Iterator: t\n+    iterator: t\n+    \n+    crate::iter::traits::iterator\n+    Iterator: t\n+    \n+    crate::prelude\n+    Iterator: t\n+    \"###);\n+}\n+\n #[test]\n fn module_resolution_works_for_non_standard_filenames() {\n     let map = def_map("}, {"sha": "aa948dcbfbba6e4d57e505379b6987390cef8b01", "filename": "crates/ra_hir_ty/src/tests/regression.rs", "status": "modified", "additions": 54, "deletions": 0, "changes": 54, "blob_url": "https://github.com/rust-lang/rust/blob/86d2af9f7b3f6af2ea9e4eca2584aa501b60aa14/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fregression.rs", "raw_url": "https://github.com/rust-lang/rust/raw/86d2af9f7b3f6af2ea9e4eca2584aa501b60aa14/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fregression.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_ty%2Fsrc%2Ftests%2Fregression.rs?ref=86d2af9f7b3f6af2ea9e4eca2584aa501b60aa14", "patch": "@@ -2,6 +2,8 @@ use insta::assert_snapshot;\n use test_utils::covers;\n \n use super::infer;\n+use crate::test_db::TestDB;\n+use ra_db::fixture::WithFixture;\n \n #[test]\n fn bug_484() {\n@@ -399,3 +401,55 @@ fn test() {\n     \"###\n     );\n }\n+\n+#[test]\n+fn issue_2683_chars_impl() {\n+    let (db, pos) = TestDB::with_position(\n+        r#\"\n+//- /main.rs crate:main deps:std\n+fn test() {\n+    let chars: std::str::Chars<'_>;\n+    (chars.next(), chars.nth(1))<|>;\n+}\n+\n+//- /std.rs crate:std\n+#[prelude_import]\n+use prelude::*;\n+\n+pub mod prelude {\n+    pub use crate::iter::Iterator;\n+    pub use crate::option::Option;\n+}\n+\n+pub mod iter {\n+    pub use self::traits::Iterator;\n+    pub mod traits {\n+        pub use self::iterator::Iterator;\n+\n+        pub mod iterator {\n+            pub trait Iterator {\n+                type Item;\n+                fn next(&mut self) -> Option<Self::Item>;\n+                fn nth(&mut self, n: usize) -> Option<Self::Item> {}\n+            }\n+        }\n+    }\n+}\n+\n+pub mod option {\n+    pub enum Option<T> {}\n+}\n+\n+pub mod str {\n+    pub struct Chars<'a> {}\n+    impl<'a> Iterator for Chars<'a> {\n+        type Item = char;\n+        fn next(&mut self) -> Option<char> {}\n+    }\n+}\n+\"#,\n+    );\n+\n+    // should be Option<char>, but currently not because of Chalk ambiguity problem\n+    assert_eq!(\"(Option<{unknown}>, Option<{unknown}>)\", super::type_at_pos(&db, pos));\n+}"}]}