{"sha": "7ea286e854d88529af76ca486ed676c9fb06e8ee", "node_id": "MDY6Q29tbWl0NzI0NzEyOjdlYTI4NmU4NTRkODg1MjlhZjc2Y2E0ODZlZDY3NmM5ZmIwNmU4ZWU=", "commit": {"author": {"name": "QuietMisdreavus", "email": "grey@quietmisdreavus.net", "date": "2017-10-09T20:21:11Z"}, "committer": {"name": "QuietMisdreavus", "email": "grey@quietmisdreavus.net", "date": "2017-10-11T01:36:09Z"}, "message": "render the rust version into std/compiler/test docs", "tree": {"sha": "138a6a8c50ab3da8a39862db42f247df9aeedcea", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/138a6a8c50ab3da8a39862db42f247df9aeedcea"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/7ea286e854d88529af76ca486ed676c9fb06e8ee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/7ea286e854d88529af76ca486ed676c9fb06e8ee", "html_url": "https://github.com/rust-lang/rust/commit/7ea286e854d88529af76ca486ed676c9fb06e8ee", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/7ea286e854d88529af76ca486ed676c9fb06e8ee/comments", "author": {"login": "QuietMisdreavus", "id": 5217170, "node_id": "MDQ6VXNlcjUyMTcxNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/5217170?v=4", "gravatar_id": "", "url": "https://api.github.com/users/QuietMisdreavus", "html_url": "https://github.com/QuietMisdreavus", "followers_url": "https://api.github.com/users/QuietMisdreavus/followers", "following_url": "https://api.github.com/users/QuietMisdreavus/following{/other_user}", "gists_url": "https://api.github.com/users/QuietMisdreavus/gists{/gist_id}", "starred_url": "https://api.github.com/users/QuietMisdreavus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/QuietMisdreavus/subscriptions", "organizations_url": "https://api.github.com/users/QuietMisdreavus/orgs", "repos_url": "https://api.github.com/users/QuietMisdreavus/repos", "events_url": "https://api.github.com/users/QuietMisdreavus/events{/privacy}", "received_events_url": "https://api.github.com/users/QuietMisdreavus/received_events", "type": "User", "site_admin": false}, "committer": {"login": "QuietMisdreavus", "id": 5217170, "node_id": "MDQ6VXNlcjUyMTcxNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/5217170?v=4", "gravatar_id": "", "url": "https://api.github.com/users/QuietMisdreavus", "html_url": "https://github.com/QuietMisdreavus", "followers_url": "https://api.github.com/users/QuietMisdreavus/followers", "following_url": "https://api.github.com/users/QuietMisdreavus/following{/other_user}", "gists_url": "https://api.github.com/users/QuietMisdreavus/gists{/gist_id}", "starred_url": "https://api.github.com/users/QuietMisdreavus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/QuietMisdreavus/subscriptions", "organizations_url": "https://api.github.com/users/QuietMisdreavus/orgs", "repos_url": "https://api.github.com/users/QuietMisdreavus/repos", "events_url": "https://api.github.com/users/QuietMisdreavus/events{/privacy}", "received_events_url": "https://api.github.com/users/QuietMisdreavus/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fcee9506602829a2ed8505c0ba657d12b972e7ae", "url": "https://api.github.com/repos/rust-lang/rust/commits/fcee9506602829a2ed8505c0ba657d12b972e7ae", "html_url": "https://github.com/rust-lang/rust/commit/fcee9506602829a2ed8505c0ba657d12b972e7ae"}], "stats": {"total": 14, "additions": 13, "deletions": 1}, "files": [{"sha": "d18512b257d6aa9fcc08c037520a310dca995f7c", "filename": "src/bootstrap/bin/rustdoc.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/7ea286e854d88529af76ca486ed676c9fb06e8ee/src%2Fbootstrap%2Fbin%2Frustdoc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ea286e854d88529af76ca486ed676c9fb06e8ee/src%2Fbootstrap%2Fbin%2Frustdoc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbin%2Frustdoc.rs?ref=7ea286e854d88529af76ca486ed676c9fb06e8ee", "patch": "@@ -48,6 +48,14 @@ fn main() {\n         cmd.arg(\"-Z\").arg(\"force-unstable-if-unmarked\");\n     }\n \n+    // Bootstrap's Cargo-command builder sets this variable to the current Rust version; let's pick\n+    // it up so we can make rustdoc print this into the docs\n+    if let Some(version) = env::var_os(\"RUSTDOC_CRATE_VERSION\") {\n+        // This \"unstable-options\" can be removed when `--crate-version` is stabilized\n+        cmd.arg(\"-Z\").arg(\"unstable-options\")\n+           .arg(\"--crate-version\").arg(version);\n+    }\n+\n     std::process::exit(match cmd.status() {\n         Ok(s) => s.code().unwrap_or(1),\n         Err(e) => panic!(\"\\n\\nfailed to run {:?}: {}\\n\\n\", cmd, e),"}, {"sha": "1d63e112ca6fb357e9286bcef175cdb065dcbeae", "filename": "src/bootstrap/builder.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/7ea286e854d88529af76ca486ed676c9fb06e8ee/src%2Fbootstrap%2Fbuilder.rs", "raw_url": "https://github.com/rust-lang/rust/raw/7ea286e854d88529af76ca486ed676c9fb06e8ee/src%2Fbootstrap%2Fbuilder.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fbuilder.rs?ref=7ea286e854d88529af76ca486ed676c9fb06e8ee", "patch": "@@ -418,7 +418,8 @@ impl<'a> Builder<'a> {\n             .env(\"RUSTC_SYSROOT\", self.sysroot(compiler))\n             .env(\"RUSTC_LIBDIR\", self.sysroot_libdir(compiler, self.build.build))\n             .env(\"CFG_RELEASE_CHANNEL\", &self.build.config.channel)\n-            .env(\"RUSTDOC_REAL\", self.rustdoc(host));\n+            .env(\"RUSTDOC_REAL\", self.rustdoc(host))\n+            .env(\"RUSTDOC_CRATE_VERSION\", self.build.rust_version());\n         cmd\n     }\n \n@@ -574,6 +575,9 @@ impl<'a> Builder<'a> {\n             cargo.env(\"RUSTC_SAVE_ANALYSIS\", \"api\".to_string());\n         }\n \n+        // For `cargo doc` invocations, make rustdoc print the Rust version into the docs\n+        cargo.env(\"RUSTDOC_CRATE_VERSION\", self.build.rust_version());\n+\n         // Environment variables *required* throughout the build\n         //\n         // FIXME: should update code to not require this env var"}]}