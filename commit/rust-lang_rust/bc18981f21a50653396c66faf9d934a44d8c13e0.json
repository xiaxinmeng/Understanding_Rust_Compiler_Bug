{"sha": "bc18981f21a50653396c66faf9d934a44d8c13e0", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJjMTg5ODFmMjFhNTA2NTMzOTZjNjZmYWY5ZDkzNGE0NGQ4YzEzZTA=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-07-09T02:52:38Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-07-09T02:52:38Z"}, "message": "Rollup merge of #62403 - SimonSapin:concat, r=alexcrichton\n\nReplace SliceConcatExt trait with inherent methods and SliceConcat helper trait\n\nBefore this change `SliceConcatExt` was an unstable extension trait with stable methods. It was in the libstd prelude, so that its methods could be used on the stable channel.\n\nThis replaces it with inherent methods, which can be used without any addition to the prelude. Since the methods are stable and very generic (with for example a return type that depends on the types of parameters), an helper trait is still needed. But now that trait does not need to be in scope for the methods to be used.\n\nRemoving this depedency on the libstd prelude allows the methods to be used in `#![no_std]` crate that use liballoc, which does not have its own implicitly-imported prelude.", "tree": {"sha": "44a18dbeaa4ff7b35fef9b1f5e34ee16367628a3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/44a18dbeaa4ff7b35fef9b1f5e34ee16367628a3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bc18981f21a50653396c66faf9d934a44d8c13e0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdJAF3CRBK7hj4Ov3rIwAAdHIIAJvYu0cH2LQvrPYOdlR6h/MT\nBPjMRR/0jonb9tgWiz/cAOOM+4Q1ga9xpnRRSWzqrZ2BaDpC6iidA+5kNGr+iYYP\nApfkkiYP9UVgBW15ZlPRnFUrHQrIityv2b+snmLEYM1UGBPApYkV7ogMovqyjzOj\nsSYYmi9StdEPEup3jJXBeYUcBEkKfQrhquFFx2LMAJ+khYnE36iftULuwCjmxNID\neksRxioULORZl0BII0LWzvbzGnAbbo0uNkRDucxLg459/zdvm0QQ3ySQYYzbv1w6\nsq4FFkqOrLVeqrR8VIfEcRXPt40EcnNLbRvBlaAntBv6TvkhR69bdJ+0vMnCLWk=\n=NLxY\n-----END PGP SIGNATURE-----\n", "payload": "tree 44a18dbeaa4ff7b35fef9b1f5e34ee16367628a3\nparent 3bbc42114271021fbe6b74766531f08399fc9a0d\nparent e808d921ddc0ad81a200934fc4caabc34094afe5\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1562640758 +0200\ncommitter GitHub <noreply@github.com> 1562640758 +0200\n\nRollup merge of #62403 - SimonSapin:concat, r=alexcrichton\n\nReplace SliceConcatExt trait with inherent methods and SliceConcat helper trait\n\nBefore this change `SliceConcatExt` was an unstable extension trait with stable methods. It was in the libstd prelude, so that its methods could be used on the stable channel.\n\nThis replaces it with inherent methods, which can be used without any addition to the prelude. Since the methods are stable and very generic (with for example a return type that depends on the types of parameters), an helper trait is still needed. But now that trait does not need to be in scope for the methods to be used.\n\nRemoving this depedency on the libstd prelude allows the methods to be used in `#![no_std]` crate that use liballoc, which does not have its own implicitly-imported prelude.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bc18981f21a50653396c66faf9d934a44d8c13e0", "html_url": "https://github.com/rust-lang/rust/commit/bc18981f21a50653396c66faf9d934a44d8c13e0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bc18981f21a50653396c66faf9d934a44d8c13e0/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3bbc42114271021fbe6b74766531f08399fc9a0d", "url": "https://api.github.com/repos/rust-lang/rust/commits/3bbc42114271021fbe6b74766531f08399fc9a0d", "html_url": "https://github.com/rust-lang/rust/commit/3bbc42114271021fbe6b74766531f08399fc9a0d"}, {"sha": "e808d921ddc0ad81a200934fc4caabc34094afe5", "url": "https://api.github.com/repos/rust-lang/rust/commits/e808d921ddc0ad81a200934fc4caabc34094afe5", "html_url": "https://github.com/rust-lang/rust/commit/e808d921ddc0ad81a200934fc4caabc34094afe5"}], "stats": {"total": 150, "additions": 76, "deletions": 74}, "files": [{"sha": "3cb285bf0492f5ccf32252c89547bbe6f6232866", "filename": "src/liballoc/prelude/v1.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/bc18981f21a50653396c66faf9d934a44d8c13e0/src%2Fliballoc%2Fprelude%2Fv1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc18981f21a50653396c66faf9d934a44d8c13e0/src%2Fliballoc%2Fprelude%2Fv1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fprelude%2Fv1.rs?ref=bc18981f21a50653396c66faf9d934a44d8c13e0", "patch": "@@ -6,6 +6,5 @@\n \n #[unstable(feature = \"alloc_prelude\", issue = \"58935\")] pub use crate::borrow::ToOwned;\n #[unstable(feature = \"alloc_prelude\", issue = \"58935\")] pub use crate::boxed::Box;\n-#[unstable(feature = \"alloc_prelude\", issue = \"58935\")] pub use crate::slice::SliceConcatExt;\n #[unstable(feature = \"alloc_prelude\", issue = \"58935\")] pub use crate::string::{String, ToString};\n #[unstable(feature = \"alloc_prelude\", issue = \"58935\")] pub use crate::vec::Vec;"}, {"sha": "bc4ae167984785a3d1e925f1cc6fedb26b70230d", "filename": "src/liballoc/slice.rs", "status": "modified", "additions": 69, "deletions": 60, "changes": 129, "blob_url": "https://github.com/rust-lang/rust/blob/bc18981f21a50653396c66faf9d934a44d8c13e0/src%2Fliballoc%2Fslice.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc18981f21a50653396c66faf9d934a44d8c13e0/src%2Fliballoc%2Fslice.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fslice.rs?ref=bc18981f21a50653396c66faf9d934a44d8c13e0", "patch": "@@ -484,6 +484,56 @@ impl<T> [T] {\n         }\n         buf\n     }\n+\n+    /// Flattens a slice of `T` into a single value `Self::Output`.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// assert_eq!([\"hello\", \"world\"].concat(), \"helloworld\");\n+    /// assert_eq!([[1, 2], [3, 4]].concat(), [1, 2, 3, 4]);\n+    /// ```\n+    #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    pub fn concat<Separator: ?Sized>(&self) -> T::Output\n+        where T: SliceConcat<Separator>\n+    {\n+        SliceConcat::concat(self)\n+    }\n+\n+    /// Flattens a slice of `T` into a single value `Self::Output`, placing a\n+    /// given separator between each.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// assert_eq!([\"hello\", \"world\"].join(\" \"), \"hello world\");\n+    /// assert_eq!([[1, 2], [3, 4]].join(&0), [1, 2, 0, 3, 4]);\n+    /// ```\n+    #[stable(feature = \"rename_connect_to_join\", since = \"1.3.0\")]\n+    pub fn join<Separator: ?Sized>(&self, sep: &Separator) -> T::Output\n+        where T: SliceConcat<Separator>\n+    {\n+        SliceConcat::join(self, sep)\n+    }\n+\n+    /// Flattens a slice of `T` into a single value `Self::Output`, placing a\n+    /// given separator between each.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// # #![allow(deprecated)]\n+    /// assert_eq!([\"hello\", \"world\"].connect(\" \"), \"hello world\");\n+    /// assert_eq!([[1, 2], [3, 4]].connect(&0), [1, 2, 0, 3, 4]);\n+    /// ```\n+    #[stable(feature = \"rust1\", since = \"1.0.0\")]\n+    #[rustc_deprecated(since = \"1.3.0\", reason = \"renamed to join\")]\n+    pub fn connect<Separator: ?Sized>(&self, sep: &Separator) -> T::Output\n+        where T: SliceConcat<Separator>\n+    {\n+        SliceConcat::join(self, sep)\n+    }\n+\n }\n \n #[lang = \"slice_u8_alloc\"]\n@@ -527,87 +577,46 @@ impl [u8] {\n ////////////////////////////////////////////////////////////////////////////////\n // Extension traits for slices over specific kinds of data\n ////////////////////////////////////////////////////////////////////////////////\n-#[unstable(feature = \"slice_concat_ext\",\n-           reason = \"trait should not have to exist\",\n-           issue = \"27747\")]\n-/// An extension trait for concatenating slices\n-///\n-/// While this trait is unstable, the methods are stable. `SliceConcatExt` is\n-/// included in the [standard library prelude], so you can use [`join()`] and\n-/// [`concat()`] as if they existed on `[T]` itself.\n-///\n-/// [standard library prelude]: ../../std/prelude/index.html\n-/// [`join()`]: #tymethod.join\n-/// [`concat()`]: #tymethod.concat\n-pub trait SliceConcatExt<T: ?Sized> {\n-    #[unstable(feature = \"slice_concat_ext\",\n-               reason = \"trait should not have to exist\",\n-               issue = \"27747\")]\n+\n+/// Helper trait for [`[T]::concat`](../../std/primitive.slice.html#method.concat)\n+/// and [`[T]::join`](../../std/primitive.slice.html#method.join)\n+#[unstable(feature = \"slice_concat_trait\", issue = \"27747\")]\n+pub trait SliceConcat<Separator: ?Sized>: Sized {\n+    #[unstable(feature = \"slice_concat_trait\", issue = \"27747\")]\n     /// The resulting type after concatenation\n     type Output;\n \n-    /// Flattens a slice of `T` into a single value `Self::Output`.\n-    ///\n-    /// # Examples\n-    ///\n-    /// ```\n-    /// assert_eq!([\"hello\", \"world\"].concat(), \"helloworld\");\n-    /// assert_eq!([[1, 2], [3, 4]].concat(), [1, 2, 3, 4]);\n-    /// ```\n-    #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-    fn concat(&self) -> Self::Output;\n-\n-    /// Flattens a slice of `T` into a single value `Self::Output`, placing a\n-    /// given separator between each.\n-    ///\n-    /// # Examples\n-    ///\n-    /// ```\n-    /// assert_eq!([\"hello\", \"world\"].join(\" \"), \"hello world\");\n-    /// assert_eq!([[1, 2], [3, 4]].join(&0), [1, 2, 0, 3, 4]);\n-    /// ```\n-    #[stable(feature = \"rename_connect_to_join\", since = \"1.3.0\")]\n-    fn join(&self, sep: &T) -> Self::Output;\n+    /// Implementation of [`[T]::concat`](../../std/primitive.slice.html#method.concat)\n+    #[unstable(feature = \"slice_concat_trait\", issue = \"27747\")]\n+    fn concat(slice: &[Self]) -> Self::Output;\n \n-    /// Flattens a slice of `T` into a single value `Self::Output`, placing a\n-    /// given separator between each.\n-    ///\n-    /// # Examples\n-    ///\n-    /// ```\n-    /// # #![allow(deprecated)]\n-    /// assert_eq!([\"hello\", \"world\"].connect(\" \"), \"hello world\");\n-    /// assert_eq!([[1, 2], [3, 4]].connect(&0), [1, 2, 0, 3, 4]);\n-    /// ```\n-    #[stable(feature = \"rust1\", since = \"1.0.0\")]\n-    #[rustc_deprecated(since = \"1.3.0\", reason = \"renamed to join\")]\n-    fn connect(&self, sep: &T) -> Self::Output {\n-        self.join(sep)\n-    }\n+    /// Implementation of [`[T]::join`](../../std/primitive.slice.html#method.join)\n+    #[unstable(feature = \"slice_concat_trait\", issue = \"27747\")]\n+    fn join(slice: &[Self], sep: &Separator) -> Self::Output;\n }\n \n #[unstable(feature = \"slice_concat_ext\",\n            reason = \"trait should not have to exist\",\n            issue = \"27747\")]\n-impl<T: Clone, V: Borrow<[T]>> SliceConcatExt<T> for [V] {\n+impl<T: Clone, V: Borrow<[T]>> SliceConcat<T> for V {\n     type Output = Vec<T>;\n \n-    fn concat(&self) -> Vec<T> {\n-        let size = self.iter().map(|slice| slice.borrow().len()).sum();\n+    fn concat(slice: &[Self]) -> Vec<T> {\n+        let size = slice.iter().map(|slice| slice.borrow().len()).sum();\n         let mut result = Vec::with_capacity(size);\n-        for v in self {\n+        for v in slice {\n             result.extend_from_slice(v.borrow())\n         }\n         result\n     }\n \n-    fn join(&self, sep: &T) -> Vec<T> {\n-        let mut iter = self.iter();\n+    fn join(slice: &[Self], sep: &T) -> Vec<T> {\n+        let mut iter = slice.iter();\n         let first = match iter.next() {\n             Some(first) => first,\n             None => return vec![],\n         };\n-        let size = self.iter().map(|slice| slice.borrow().len()).sum::<usize>() + self.len() - 1;\n+        let size = slice.iter().map(|slice| slice.borrow().len()).sum::<usize>() + slice.len() - 1;\n         let mut result = Vec::with_capacity(size);\n         result.extend_from_slice(first.borrow());\n "}, {"sha": "37a1046d0942dd4370159b51babe387798d233fe", "filename": "src/liballoc/str.rs", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/bc18981f21a50653396c66faf9d934a44d8c13e0/src%2Fliballoc%2Fstr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc18981f21a50653396c66faf9d934a44d8c13e0/src%2Fliballoc%2Fstr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fstr.rs?ref=bc18981f21a50653396c66faf9d934a44d8c13e0", "patch": "@@ -37,7 +37,7 @@ use core::unicode::conversions;\n \n use crate::borrow::ToOwned;\n use crate::boxed::Box;\n-use crate::slice::{SliceConcatExt, SliceIndex};\n+use crate::slice::{SliceConcat, SliceIndex};\n use crate::string::String;\n use crate::vec::Vec;\n \n@@ -74,16 +74,16 @@ pub use core::str::{EscapeDebug, EscapeDefault, EscapeUnicode};\n #[unstable(feature = \"slice_concat_ext\",\n            reason = \"trait should not have to exist\",\n            issue = \"27747\")]\n-impl<S: Borrow<str>> SliceConcatExt<str> for [S] {\n+impl<S: Borrow<str>> SliceConcat<str> for S {\n     type Output = String;\n \n-    fn concat(&self) -> String {\n-        self.join(\"\")\n+    fn concat(slice: &[Self]) -> String {\n+        Self::join(slice, \"\")\n     }\n \n-    fn join(&self, sep: &str) -> String {\n+    fn join(slice: &[Self], sep: &str) -> String {\n         unsafe {\n-            String::from_utf8_unchecked( join_generic_copy(self, sep.as_bytes()) )\n+            String::from_utf8_unchecked( join_generic_copy(slice, sep.as_bytes()) )\n         }\n     }\n }\n@@ -126,7 +126,7 @@ macro_rules! copy_slice_and_advance {\n \n // Optimized join implementation that works for both Vec<T> (T: Copy) and String's inner vec\n // Currently (2018-05-13) there is a bug with type inference and specialization (see issue #36262)\n-// For this reason SliceConcatExt<T> is not specialized for T: Copy and SliceConcatExt<str> is the\n+// For this reason SliceConcat<T> is not specialized for T: Copy and SliceConcat<str> is the\n // only user of this function. It is left in place for the time when that is fixed.\n //\n // the bounds for String-join are S: Borrow<str> and for Vec-join Borrow<[T]>"}, {"sha": "3085c3d829653b0f6750f476e4a7666ac2be0bbe", "filename": "src/libstd/prelude/mod.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/bc18981f21a50653396c66faf9d934a44d8c13e0/src%2Flibstd%2Fprelude%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc18981f21a50653396c66faf9d934a44d8c13e0/src%2Flibstd%2Fprelude%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fprelude%2Fmod.rs?ref=bc18981f21a50653396c66faf9d934a44d8c13e0", "patch": "@@ -71,9 +71,6 @@\n //! * [`std::result`]::[`Result`]::{`self`, `Ok`, `Err`}. A type for functions\n //!   that may succeed or fail. Like [`Option`], its variants are exported as\n //!   well.\n-//! * [`std::slice`]::[`SliceConcatExt`], a trait that exists for technical\n-//!   reasons, but shouldn't have to exist. It provides a few useful methods on\n-//!   slices.\n //! * [`std::string`]::{[`String`], [`ToString`]}, heap allocated strings.\n //! * [`std::vec`]::[`Vec`](../vec/struct.Vec.html), a growable, heap-allocated\n //!   vector."}, {"sha": "a863bebf4a2648572b9a5abe6ffa62f906138312", "filename": "src/libstd/prelude/v1.rs", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/bc18981f21a50653396c66faf9d934a44d8c13e0/src%2Flibstd%2Fprelude%2Fv1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/bc18981f21a50653396c66faf9d934a44d8c13e0/src%2Flibstd%2Fprelude%2Fv1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fprelude%2Fv1.rs?ref=bc18981f21a50653396c66faf9d934a44d8c13e0", "patch": "@@ -60,9 +60,6 @@ pub use crate::boxed::Box;\n pub use crate::borrow::ToOwned;\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n #[doc(no_inline)]\n-pub use crate::slice::SliceConcatExt;\n-#[stable(feature = \"rust1\", since = \"1.0.0\")]\n-#[doc(no_inline)]\n pub use crate::string::{String, ToString};\n #[stable(feature = \"rust1\", since = \"1.0.0\")]\n #[doc(no_inline)]"}]}