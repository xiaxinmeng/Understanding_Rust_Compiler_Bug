{"sha": "27427a950aa22b966d28b3e0a3508e0d97f91252", "node_id": "MDY6Q29tbWl0NzI0NzEyOjI3NDI3YTk1MGFhMjJiOTY2ZDI4YjNlMGEzNTA4ZTBkOTdmOTEyNTI=", "commit": {"author": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2012-05-23T03:39:53Z"}, "committer": {"name": "Brian Anderson", "email": "andersrb@gmail.com", "date": "2012-05-23T03:39:53Z"}, "message": "Merge pull request #2430 from mmeyerho/master\n\nAdded support for #! comments.  Closes issue 1772.", "tree": {"sha": "fe59e9c5fb1397ad6094d271fdba54cc1adb0cfb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/fe59e9c5fb1397ad6094d271fdba54cc1adb0cfb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/27427a950aa22b966d28b3e0a3508e0d97f91252", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/27427a950aa22b966d28b3e0a3508e0d97f91252", "html_url": "https://github.com/rust-lang/rust/commit/27427a950aa22b966d28b3e0a3508e0d97f91252", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/27427a950aa22b966d28b3e0a3508e0d97f91252/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ed357af9801468142b961e8dd3f6349007260fd4", "url": "https://api.github.com/repos/rust-lang/rust/commits/ed357af9801468142b961e8dd3f6349007260fd4", "html_url": "https://github.com/rust-lang/rust/commit/ed357af9801468142b961e8dd3f6349007260fd4"}, {"sha": "4f10c19215e4c234e25c25b57983eeb42774f873", "url": "https://api.github.com/repos/rust-lang/rust/commits/4f10c19215e4c234e25c25b57983eeb42774f873", "html_url": "https://github.com/rust-lang/rust/commit/4f10c19215e4c234e25c25b57983eeb42774f873"}], "stats": {"total": 37, "additions": 34, "deletions": 3}, "files": [{"sha": "808fb2dffe092bb29a76b4fb5d7b50c31fe1ad0e", "filename": "src/librustsyntax/codemap.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/27427a950aa22b966d28b3e0a3508e0d97f91252/src%2Flibrustsyntax%2Fcodemap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/27427a950aa22b966d28b3e0a3508e0d97f91252/src%2Flibrustsyntax%2Fcodemap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustsyntax%2Fcodemap.rs?ref=27427a950aa22b966d28b3e0a3508e0d97f91252", "patch": "@@ -12,6 +12,7 @@ export new_filemap;\n export new_filemap_w_substr;\n export mk_substr_filename;\n export lookup_char_pos;\n+export lookup_char_pos_adj;\n export adjust_span;\n export span_to_str;\n export span_to_filename;"}, {"sha": "9fa4a4c3e8c18ea139f4e793754bb4377696f2db", "filename": "src/librustsyntax/parse/comments.rs", "status": "modified", "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/27427a950aa22b966d28b3e0a3508e0d97f91252/src%2Flibrustsyntax%2Fparse%2Fcomments.rs", "raw_url": "https://github.com/rust-lang/rust/raw/27427a950aa22b966d28b3e0a3508e0d97f91252/src%2Flibrustsyntax%2Fparse%2Fcomments.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustsyntax%2Fparse%2Fcomments.rs?ref=27427a950aa22b966d28b3e0a3508e0d97f91252", "patch": "@@ -1,4 +1,5 @@\n import io::reader_util;\n+import io::println;//XXXXXXXXxxx\n import util::interner;\n import lexer::{ reader, new_reader, next_token, is_whitespace };\n \n@@ -28,7 +29,8 @@ fn read_to_eol(rdr: reader) -> str {\n \n fn read_one_line_comment(rdr: reader) -> str {\n     let val = read_to_eol(rdr);\n-    assert (val[0] == '/' as u8 && val[1] == '/' as u8);\n+    assert ((val[0] == '/' as u8 && val[1] == '/' as u8) ||\n+            (val[0] == '#' as u8 && val[1] == '!' as u8));\n     ret val;\n }\n \n@@ -53,6 +55,15 @@ fn consume_whitespace_counting_blank_lines(rdr: reader, &comments: [cmnt]) {\n     }\n }\n \n+fn read_shebang_comment(rdr: reader, code_to_the_left: bool) -> cmnt {\n+    #debug(\">>> shebang comment\");\n+    let p = rdr.chpos;\n+    #debug(\"<<< shebang comment\");\n+    ret {style: if code_to_the_left { trailing } else { isolated },\n+         lines: [read_one_line_comment(rdr)],\n+         pos: p};\n+}\n+\n fn read_line_comments(rdr: reader, code_to_the_left: bool) -> cmnt {\n     #debug(\">>> line comments\");\n     let p = rdr.chpos;\n@@ -134,8 +145,9 @@ fn read_block_comment(rdr: reader, code_to_the_left: bool) -> cmnt {\n }\n \n fn peeking_at_comment(rdr: reader) -> bool {\n-    ret rdr.curr == '/' && rdr.next() == '/' ||\n-            rdr.curr == '/' && rdr.next() == '*';\n+    ret ((rdr.curr == '/' && rdr.next() == '/') ||\n+         (rdr.curr == '/' && rdr.next() == '*')) ||\n+        (rdr.curr == '#' && rdr.next() == '!');\n }\n \n fn consume_comment(rdr: reader, code_to_the_left: bool, &comments: [cmnt]) {\n@@ -144,6 +156,8 @@ fn consume_comment(rdr: reader, code_to_the_left: bool, &comments: [cmnt]) {\n         comments += [read_line_comments(rdr, code_to_the_left)];\n     } else if rdr.curr == '/' && rdr.next() == '*' {\n         comments += [read_block_comment(rdr, code_to_the_left)];\n+    } else if rdr.curr == '#' && rdr.next() == '!' {\n+        comments += [read_shebang_comment(rdr, code_to_the_left)];\n     } else { fail; }\n     #debug(\"<<< consume comment\");\n }"}, {"sha": "b95b10fc33e80515b5f858253e3461f8d8ae9f26", "filename": "src/librustsyntax/parse/lexer.rs", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/27427a950aa22b966d28b3e0a3508e0d97f91252/src%2Flibrustsyntax%2Fparse%2Flexer.rs", "raw_url": "https://github.com/rust-lang/rust/raw/27427a950aa22b966d28b3e0a3508e0d97f91252/src%2Flibrustsyntax%2Fparse%2Flexer.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustsyntax%2Fparse%2Flexer.rs?ref=27427a950aa22b966d28b3e0a3508e0d97f91252", "patch": "@@ -119,6 +119,16 @@ fn consume_any_line_comment(rdr: reader) {\n           '*' { rdr.bump(); rdr.bump(); ret consume_block_comment(rdr); }\n           _ { ret; }\n         }\n+    } else if rdr.curr == '#' {\n+        if rdr.next() == '!' {\n+            let cmap = codemap::new_codemap();\n+            (*cmap).files.push(rdr.filemap);\n+            let loc = codemap::lookup_char_pos_adj(cmap, rdr.chpos);\n+            if loc.line == 1u && loc.col == 0u {\n+                while rdr.curr != '\\n' && !rdr.is_eof() { rdr.bump(); }\n+                ret consume_whitespace_and_comments(rdr);\n+            }\n+        }\n     }\n }\n "}, {"sha": "5354dde741008d6ca06f17aca0f1a44ab0ffe556", "filename": "src/test/run-pass/shebang.rs", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/27427a950aa22b966d28b3e0a3508e0d97f91252/src%2Ftest%2Frun-pass%2Fshebang.rs", "raw_url": "https://github.com/rust-lang/rust/raw/27427a950aa22b966d28b3e0a3508e0d97f91252/src%2Ftest%2Frun-pass%2Fshebang.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fshebang.rs?ref=27427a950aa22b966d28b3e0a3508e0d97f91252", "patch": "@@ -0,0 +1,6 @@\n+#!/usr/bin/env rustx\n+// pp-exact\n+\n+import io::println;\n+\n+fn main() { io::println(\"Hello World\"); }"}]}