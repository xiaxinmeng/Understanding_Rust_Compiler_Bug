{"sha": "944984885a9dfb9084cac3c5dd7a3bd404795f1a", "node_id": "C_kwDOAAsO6NoAKDk0NDk4NDg4NWE5ZGZiOTA4NGNhYzNjNWRkN2EzYmQ0MDQ3OTVmMWE", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2022-09-15T06:00:14Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-09-15T06:00:14Z"}, "message": "Rollup merge of #101778 - notriddle:notriddle/docblock-short-p, r=GuillaumeGomez\n\nrustdoc: clean up DOM by removing `.dockblock-short p`\n\nOn https://doc.rust-lang.org/nightly/std/ this reduces the number out of `document.querySelectorAll(\"*\").length` from 1278 to 1103.\n\nPreview: https://notriddle.com/notriddle-rustdoc-test/docblock-short-p/std/index.html", "tree": {"sha": "b2c3036cbf903c9260191b957d805f16455e592b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b2c3036cbf903c9260191b957d805f16455e592b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/944984885a9dfb9084cac3c5dd7a3bd404795f1a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjIr9uCRBK7hj4Ov3rIwAAY7UIABhFXaihkEAMuxRiMKb+oXMb\ncmrflvaKOUUYulQUsAAssJPJprMMA8VBdPxbyEO0qQXqvzpn6hOjNIS9kNLu1e05\n6Cyf8v52EOPt8HrT1ErZQ4esLAG+SQWXFQ5hd4mqgqUzrm4gzjywQJSncifj1tiS\nQL9metjhMH0m08Kqm98j9PHmQqloNizXoA6F45AN1CxMDXssKyaUq3qRkJiq9fUd\nm3FEiD7CspyfS0UEtmLUaUrt/j3gXQQLJbddNw57CJSgLMmVd02Tb0vFQsdYJmlv\nIr7Oy9WXFsbYwKavtEcCGwmyyYGLl8BnCTO/bQAXGbmLTWWE0PaHevUcxTustgI=\n=Eqc6\n-----END PGP SIGNATURE-----\n", "payload": "tree b2c3036cbf903c9260191b957d805f16455e592b\nparent b22055c570a797a36f569c88c31239d94cc1a1fc\nparent 11a52dc61afda5ea82cff3e783e24f2302bdce3f\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1663221614 +0200\ncommitter GitHub <noreply@github.com> 1663221614 +0200\n\nRollup merge of #101778 - notriddle:notriddle/docblock-short-p, r=GuillaumeGomez\n\nrustdoc: clean up DOM by removing `.dockblock-short p`\n\nOn https://doc.rust-lang.org/nightly/std/ this reduces the number out of `document.querySelectorAll(\"*\").length` from 1278 to 1103.\n\nPreview: https://notriddle.com/notriddle-rustdoc-test/docblock-short-p/std/index.html\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/944984885a9dfb9084cac3c5dd7a3bd404795f1a", "html_url": "https://github.com/rust-lang/rust/commit/944984885a9dfb9084cac3c5dd7a3bd404795f1a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/944984885a9dfb9084cac3c5dd7a3bd404795f1a/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b22055c570a797a36f569c88c31239d94cc1a1fc", "url": "https://api.github.com/repos/rust-lang/rust/commits/b22055c570a797a36f569c88c31239d94cc1a1fc", "html_url": "https://github.com/rust-lang/rust/commit/b22055c570a797a36f569c88c31239d94cc1a1fc"}, {"sha": "11a52dc61afda5ea82cff3e783e24f2302bdce3f", "url": "https://api.github.com/repos/rust-lang/rust/commits/11a52dc61afda5ea82cff3e783e24f2302bdce3f", "html_url": "https://github.com/rust-lang/rust/commit/11a52dc61afda5ea82cff3e783e24f2302bdce3f"}], "stats": {"total": 64, "additions": 26, "deletions": 38}, "files": [{"sha": "43d07d4a53337ae6100fdfb9c7ac53b745bb810e", "filename": "src/librustdoc/html/markdown.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/944984885a9dfb9084cac3c5dd7a3bd404795f1a/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "raw_url": "https://github.com/rust-lang/rust/raw/944984885a9dfb9084cac3c5dd7a3bd404795f1a/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fmarkdown.rs?ref=944984885a9dfb9084cac3c5dd7a3bd404795f1a", "patch": "@@ -1119,7 +1119,11 @@ impl MarkdownSummaryLine<'_> {\n \n         let mut s = String::new();\n \n-        html::push_html(&mut s, LinkReplacer::new(SummaryLine::new(p), links));\n+        let without_paragraphs = LinkReplacer::new(SummaryLine::new(p), links).filter(|event| {\n+            !matches!(event, Event::Start(Tag::Paragraph) | Event::End(Tag::Paragraph))\n+        });\n+\n+        html::push_html(&mut s, without_paragraphs);\n \n         s\n     }"}, {"sha": "f9f2a48cdc24091868f8997ccc783bbf6e58aea3", "filename": "src/librustdoc/html/static/css/rustdoc.css", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/944984885a9dfb9084cac3c5dd7a3bd404795f1a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "raw_url": "https://github.com/rust-lang/rust/raw/944984885a9dfb9084cac3c5dd7a3bd404795f1a/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustdoc%2Fhtml%2Fstatic%2Fcss%2Frustdoc.css?ref=944984885a9dfb9084cac3c5dd7a3bd404795f1a", "patch": "@@ -609,16 +609,12 @@ h2.location a {\n .docblock-short {\n \toverflow-wrap: break-word;\n \toverflow-wrap: anywhere;\n-}\n-.docblock-short p {\n-\tdisplay: inline;\n \toverflow: hidden;\n \ttext-overflow: ellipsis;\n-\tmargin: 0;\n }\n /* Wrap non-pre code blocks (`text`) but not (```text```). */\n .docblock > :not(pre) > code,\n-.docblock-short > :not(pre) > code {\n+.docblock-short > code {\n \twhite-space: pre-wrap;\n }\n "}, {"sha": "4b4cea2621fff7deeecd2087c70bec097ff0c281", "filename": "src/test/rustdoc-gui/label-next-to-symbol.goml", "status": "modified", "additions": 3, "deletions": 15, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/944984885a9dfb9084cac3c5dd7a3bd404795f1a/src%2Ftest%2Frustdoc-gui%2Flabel-next-to-symbol.goml", "raw_url": "https://github.com/rust-lang/rust/raw/944984885a9dfb9084cac3c5dd7a3bd404795f1a/src%2Ftest%2Frustdoc-gui%2Flabel-next-to-symbol.goml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc-gui%2Flabel-next-to-symbol.goml?ref=944984885a9dfb9084cac3c5dd7a3bd404795f1a", "patch": "@@ -31,15 +31,9 @@ compare-elements-position: (\n )\n \n // Ensure no wrap\n-compare-elements-position-near: (\n-    \"//*[@class='item-left module-item']//a[text()='replaced_function']\",\n-    \"//*[@class='item-right docblock-short']//p[text()='a thing with a label']\",\n-    {\"y\": 2},\n-)\n-// compare parent elements\n compare-elements-position: (\n     \"//*[@class='item-left module-item']//a[text()='replaced_function']/..\",\n-    \"//*[@class='item-right docblock-short']//p[text()='a thing with a label']/..\",\n+    \"//*[@class='item-right docblock-short'][text()='a thing with a label']\",\n     (\"y\"),\n )\n \n@@ -60,19 +54,13 @@ compare-elements-position: (\n )\n \n // Ensure wrap\n-compare-elements-position-near-false: (\n-    \"//*[@class='item-left module-item']//a[text()='replaced_function']\",\n-    \"//*[@class='item-right docblock-short']//p[text()='a thing with a label']\",\n-    {\"y\": 12},\n-)\n-// compare parent elements\n compare-elements-position-false: (\n     \"//*[@class='item-left module-item']//a[text()='replaced_function']/..\",\n-    \"//*[@class='item-right docblock-short']//p[text()='a thing with a label']/..\",\n+    \"//*[@class='item-right docblock-short'][text()='a thing with a label']\",\n     (\"y\"),\n )\n compare-elements-position-false: (\n     \".item-left .stab.deprecated\",\n-    \"//*[@class='item-right docblock-short']//p[text()='a thing with a label']\",\n+    \"//*[@class='item-right docblock-short'][text()='a thing with a label']\",\n     (\"y\"),\n )"}, {"sha": "1a8a689be1d1e2090f3b47c08e8a79dd593cc9fc", "filename": "src/test/rustdoc/short-docblock.rs", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/944984885a9dfb9084cac3c5dd7a3bd404795f1a/src%2Ftest%2Frustdoc%2Fshort-docblock.rs", "raw_url": "https://github.com/rust-lang/rust/raw/944984885a9dfb9084cac3c5dd7a3bd404795f1a/src%2Ftest%2Frustdoc%2Fshort-docblock.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Fshort-docblock.rs?ref=944984885a9dfb9084cac3c5dd7a3bd404795f1a", "patch": "@@ -1,24 +1,24 @@\n #![crate_name = \"foo\"]\n \n-// @has foo/index.html '//*[@class=\"item-right docblock-short\"]/p' 'fooo'\n-// @!has foo/index.html '//*[@class=\"item-right docblock-short\"]/p/h1' 'fooo'\n+// @has foo/index.html '//*[@class=\"item-right docblock-short\"]' 'fooo'\n+// @!has foo/index.html '//*[@class=\"item-right docblock-short\"]/h1' 'fooo'\n // @has foo/fn.foo.html '//h2[@id=\"fooo\"]/a[@href=\"#fooo\"]' 'fooo'\n \n /// # fooo\n ///\n /// foo\n pub fn foo() {}\n \n-// @has foo/index.html '//*[@class=\"item-right docblock-short\"]/p' 'mooood'\n-// @!has foo/index.html '//*[@class=\"item-right docblock-short\"]/p/h2' 'mooood'\n+// @has foo/index.html '//*[@class=\"item-right docblock-short\"]' 'mooood'\n+// @!has foo/index.html '//*[@class=\"item-right docblock-short\"]/h2' 'mooood'\n // @has foo/foo/index.html '//h3[@id=\"mooood\"]/a[@href=\"#mooood\"]' 'mooood'\n \n /// ## mooood\n ///\n /// foo mod\n pub mod foo {}\n \n-// @has foo/index.html '//*[@class=\"item-right docblock-short\"]/p/a[@href=\\\n+// @has foo/index.html '//*[@class=\"item-right docblock-short\"]/a[@href=\\\n //                      \"https://nougat.world\"]/code' 'nougat'\n \n /// [`nougat`](https://nougat.world)"}, {"sha": "195cdf009b9937f37d355f15702347a69942fe7b", "filename": "src/test/rustdoc/trait-impl.rs", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/rust-lang/rust/blob/944984885a9dfb9084cac3c5dd7a3bd404795f1a/src%2Ftest%2Frustdoc%2Ftrait-impl.rs", "raw_url": "https://github.com/rust-lang/rust/raw/944984885a9dfb9084cac3c5dd7a3bd404795f1a/src%2Ftest%2Frustdoc%2Ftrait-impl.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frustdoc%2Ftrait-impl.rs?ref=944984885a9dfb9084cac3c5dd7a3bd404795f1a", "patch": "@@ -21,26 +21,26 @@ pub trait Trait {\n pub struct Struct;\n \n impl Trait for Struct {\n-    // @has trait_impl/struct.Struct.html '//*[@id=\"method.a\"]/../../div[@class=\"docblock\"]/p' 'Some long docs'\n-    // @!has - '//*[@id=\"method.a\"]/../../div[@class=\"docblock\"]/p' 'link will be added'\n-    // @has - '//*[@id=\"method.a\"]/../../div[@class=\"docblock\"]/p/a' 'Read more'\n-    // @has - '//*[@id=\"method.a\"]/../../div[@class=\"docblock\"]/p/a/@href' 'trait.Trait.html#tymethod.a'\n+    // @has trait_impl/struct.Struct.html '//*[@id=\"method.a\"]/../../div[@class=\"docblock\"]' 'Some long docs'\n+    // @!has - '//*[@id=\"method.a\"]/../../div[@class=\"docblock\"]' 'link will be added'\n+    // @has - '//*[@id=\"method.a\"]/../../div[@class=\"docblock\"]/a' 'Read more'\n+    // @has - '//*[@id=\"method.a\"]/../../div[@class=\"docblock\"]/a/@href' 'trait.Trait.html#tymethod.a'\n     fn a() {}\n \n-    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/p' 'These docs contain'\n-    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/p/a' 'reference link'\n-    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/p/a/@href' 'https://example.com'\n-    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/p/a' 'Read more'\n-    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/p/a/@href' 'trait.Trait.html#tymethod.b'\n+    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]' 'These docs contain'\n+    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/a' 'reference link'\n+    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/a/@href' 'https://example.com'\n+    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/a' 'Read more'\n+    // @has - '//*[@id=\"method.b\"]/../../div[@class=\"docblock\"]/a/@href' 'trait.Trait.html#tymethod.b'\n     fn b() {}\n \n-    // @!has - '//*[@id=\"method.c\"]/../../div[@class=\"docblock\"]/p' 'code block'\n+    // @!has - '//*[@id=\"method.c\"]/../../div[@class=\"docblock\"]' 'code block'\n     // @has - '//*[@id=\"method.c\"]/../../div[@class=\"docblock\"]/a' 'Read more'\n     // @has - '//*[@id=\"method.c\"]/../../div[@class=\"docblock\"]/a/@href' 'trait.Trait.html#tymethod.c'\n     fn c() {}\n \n-    // @has - '//*[@id=\"method.d\"]/../../div[@class=\"docblock\"]/p' 'Escaped formatting a*b*c* works'\n-    // @!has - '//*[@id=\"method.d\"]/../../div[@class=\"docblock\"]/p/em' ''\n+    // @has - '//*[@id=\"method.d\"]/../../div[@class=\"docblock\"]' 'Escaped formatting a*b*c* works'\n+    // @!has - '//*[@id=\"method.d\"]/../../div[@class=\"docblock\"]/em' ''\n     fn d() {}\n \n     // @has - '//*[@id=\"impl-Trait-for-Struct\"]/h3//a/@href' 'trait.Trait.html'"}]}