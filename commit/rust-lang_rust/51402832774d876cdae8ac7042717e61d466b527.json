{"sha": "51402832774d876cdae8ac7042717e61d466b527", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUxNDAyODMyNzc0ZDg3NmNkYWU4YWM3MDQyNzE3ZTYxZDQ2NmI1Mjc=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-10-10T11:51:35Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2019-10-10T11:51:35Z"}, "message": "simplify some tests", "tree": {"sha": "af7a30f05592bddec30c203cc24d804138b2f038", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/af7a30f05592bddec30c203cc24d804138b2f038"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/51402832774d876cdae8ac7042717e61d466b527", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/51402832774d876cdae8ac7042717e61d466b527", "html_url": "https://github.com/rust-lang/rust/commit/51402832774d876cdae8ac7042717e61d466b527", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/51402832774d876cdae8ac7042717e61d466b527/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ce0d4a3b1deaca318a1ed2ff83cca652ef8e8c82", "url": "https://api.github.com/repos/rust-lang/rust/commits/ce0d4a3b1deaca318a1ed2ff83cca652ef8e8c82", "html_url": "https://github.com/rust-lang/rust/commit/ce0d4a3b1deaca318a1ed2ff83cca652ef8e8c82"}], "stats": {"total": 114, "additions": 24, "deletions": 90}, "files": [{"sha": "f569aacdc6bdaa9b5f6e9a6b753f8335986ac437", "filename": "crates/ra_hir/src/nameres/tests/mod_resolution.rs", "status": "modified", "additions": 24, "deletions": 90, "changes": 114, "blob_url": "https://github.com/rust-lang/rust/blob/51402832774d876cdae8ac7042717e61d466b527/crates%2Fra_hir%2Fsrc%2Fnameres%2Ftests%2Fmod_resolution.rs", "raw_url": "https://github.com/rust-lang/rust/raw/51402832774d876cdae8ac7042717e61d466b527/crates%2Fra_hir%2Fsrc%2Fnameres%2Ftests%2Fmod_resolution.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fnameres%2Ftests%2Fmod_resolution.rs?ref=51402832774d876cdae8ac7042717e61d466b527", "patch": "@@ -80,18 +80,15 @@ fn module_resolution_works_for_non_standard_filenames() {\n \n #[test]\n fn module_resolution_works_for_raw_modules() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         \"\n-        //- /library.rs\n+        //- /lib.rs\n         mod r#async;\n         use self::r#async::Bar;\n \n         //- /async.rs\n         pub struct Bar;\n         \",\n-        crate_graph! {\n-            \"library\": (\"/library.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -106,19 +103,16 @@ fn module_resolution_works_for_raw_modules() {\n \n #[test]\n fn module_resolution_decl_path() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n-        //- /library.rs\n+        //- /lib.rs\n         #[path = \"bar/baz/foo.rs\"]\n         mod foo;\n         use self::foo::Bar;\n \n         //- /bar/baz/foo.rs\n         pub struct Bar;\n         \"###,\n-        crate_graph! {\n-            \"library\": (\"/library.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -133,7 +127,7 @@ fn module_resolution_decl_path() {\n \n #[test]\n fn module_resolution_module_with_path_in_mod_rs() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         mod foo;\n@@ -147,9 +141,6 @@ fn module_resolution_module_with_path_in_mod_rs() {\n         //- /foo/baz.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -167,7 +158,7 @@ fn module_resolution_module_with_path_in_mod_rs() {\n \n #[test]\n fn module_resolution_module_with_path_non_crate_root() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         mod foo;\n@@ -181,9 +172,6 @@ fn module_resolution_module_with_path_non_crate_root() {\n         //- /baz.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -201,7 +189,7 @@ fn module_resolution_module_with_path_non_crate_root() {\n \n #[test]\n fn module_resolution_module_decl_path_super() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         #[path = \"bar/baz/module.rs\"]\n@@ -211,9 +199,6 @@ fn module_resolution_module_decl_path_super() {\n         //- /bar/baz/module.rs\n         use super::Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -228,7 +213,7 @@ fn module_resolution_module_decl_path_super() {\n \n #[test]\n fn module_resolution_explicit_path_mod_rs() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         #[path = \"module/mod.rs\"]\n@@ -237,9 +222,6 @@ fn module_resolution_explicit_path_mod_rs() {\n         //- /module/mod.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -253,7 +235,7 @@ fn module_resolution_explicit_path_mod_rs() {\n \n #[test]\n fn module_resolution_relative_path() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         mod foo;\n@@ -265,9 +247,6 @@ fn module_resolution_relative_path() {\n         //- /sub.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -284,7 +263,7 @@ fn module_resolution_relative_path() {\n \n #[test]\n fn module_resolution_relative_path_2() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         mod foo;\n@@ -296,9 +275,6 @@ fn module_resolution_relative_path_2() {\n         //- /sub.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -315,7 +291,7 @@ fn module_resolution_relative_path_2() {\n \n #[test]\n fn module_resolution_explicit_path_mod_rs_2() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         #[path = \"module/bar/mod.rs\"]\n@@ -324,9 +300,6 @@ fn module_resolution_explicit_path_mod_rs_2() {\n         //- /module/bar/mod.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -340,7 +313,7 @@ fn module_resolution_explicit_path_mod_rs_2() {\n \n #[test]\n fn module_resolution_explicit_path_mod_rs_with_win_separator() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         #[path = \"module\\bar\\mod.rs\"]\n@@ -349,9 +322,6 @@ fn module_resolution_explicit_path_mod_rs_with_win_separator() {\n         //- /module/bar/mod.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -365,7 +335,7 @@ fn module_resolution_explicit_path_mod_rs_with_win_separator() {\n \n #[test]\n fn module_resolution_decl_inside_inline_module_with_path_attribute() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         #[path = \"models\"]\n@@ -376,9 +346,6 @@ fn module_resolution_decl_inside_inline_module_with_path_attribute() {\n         //- /models/bar.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -395,7 +362,7 @@ fn module_resolution_decl_inside_inline_module_with_path_attribute() {\n \n #[test]\n fn module_resolution_decl_inside_inline_module() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         mod foo {\n@@ -405,9 +372,6 @@ fn module_resolution_decl_inside_inline_module() {\n         //- /foo/bar.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -424,7 +388,7 @@ fn module_resolution_decl_inside_inline_module() {\n \n #[test]\n fn module_resolution_decl_inside_inline_module_2_with_path_attribute() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         #[path = \"models/db\"]\n@@ -435,9 +399,6 @@ fn module_resolution_decl_inside_inline_module_2_with_path_attribute() {\n         //- /models/db/bar.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -454,7 +415,7 @@ fn module_resolution_decl_inside_inline_module_2_with_path_attribute() {\n \n #[test]\n fn module_resolution_decl_inside_inline_module_3() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         #[path = \"models/db\"]\n@@ -466,9 +427,6 @@ fn module_resolution_decl_inside_inline_module_3() {\n         //- /models/db/users.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -485,7 +443,7 @@ fn module_resolution_decl_inside_inline_module_3() {\n \n #[test]\n fn module_resolution_decl_inside_inline_module_empty_path() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         #[path = \"\"]\n@@ -497,9 +455,6 @@ fn module_resolution_decl_inside_inline_module_empty_path() {\n         //- /users.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -516,7 +471,7 @@ fn module_resolution_decl_inside_inline_module_empty_path() {\n \n #[test]\n fn module_resolution_decl_empty_path() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         #[path = \"\"] // Should try to read `/` (a directory)\n@@ -525,9 +480,6 @@ fn module_resolution_decl_empty_path() {\n         //- /foo.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -537,7 +489,7 @@ fn module_resolution_decl_empty_path() {\n \n #[test]\n fn module_resolution_decl_inside_inline_module_relative_path() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         #[path = \"./models\"]\n@@ -548,9 +500,6 @@ fn module_resolution_decl_inside_inline_module_relative_path() {\n         //- /models/bar.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -567,7 +516,7 @@ fn module_resolution_decl_inside_inline_module_relative_path() {\n \n #[test]\n fn module_resolution_decl_inside_inline_module_in_crate_root() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         mod foo {\n@@ -579,9 +528,6 @@ fn module_resolution_decl_inside_inline_module_in_crate_root() {\n         //- /foo/baz.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -599,7 +545,7 @@ fn module_resolution_decl_inside_inline_module_in_crate_root() {\n \n #[test]\n fn module_resolution_decl_inside_inline_module_in_mod_rs() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         mod foo;\n@@ -614,9 +560,6 @@ fn module_resolution_decl_inside_inline_module_in_mod_rs() {\n         //- /foo/bar/qwe.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -637,7 +580,7 @@ fn module_resolution_decl_inside_inline_module_in_mod_rs() {\n \n #[test]\n fn module_resolution_decl_inside_inline_module_in_non_crate_root() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         mod foo;\n@@ -652,9 +595,6 @@ fn module_resolution_decl_inside_inline_module_in_non_crate_root() {\n         //- /foo/bar/qwe.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -675,7 +615,7 @@ fn module_resolution_decl_inside_inline_module_in_non_crate_root() {\n \n #[test]\n fn module_resolution_decl_inside_inline_module_in_non_crate_root_2() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         mod foo;\n@@ -690,9 +630,6 @@ fn module_resolution_decl_inside_inline_module_in_non_crate_root_2() {\n         //- /bar/baz.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\"\n@@ -732,7 +669,7 @@ fn unresolved_module_diagnostics() {\n \n #[test]\n fn module_resolution_decl_inside_module_in_non_crate_root_2() {\n-    let map = def_map_with_crate_graph(\n+    let map = def_map(\n         r###\"\n         //- /main.rs\n         #[path=\"module/m2.rs\"]\n@@ -744,9 +681,6 @@ fn module_resolution_decl_inside_module_in_non_crate_root_2() {\n         //- /module/submod.rs\n         pub struct Baz;\n         \"###,\n-        crate_graph! {\n-            \"main\": (\"/main.rs\", []),\n-        },\n     );\n \n     assert_snapshot!(map, @r###\""}]}