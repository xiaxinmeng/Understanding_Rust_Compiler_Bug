{"sha": "f10b2256a090520636862576ae487d7eee0d95a6", "node_id": "MDY6Q29tbWl0NzI0NzEyOmYxMGIyMjU2YTA5MDUyMDYzNjg2MjU3NmFlNDg3ZDdlZWUwZDk1YTY=", "commit": {"author": {"name": "Seiichi Uchida", "email": "seuchida@gmail.com", "date": "2018-11-08T05:15:09Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2018-11-08T05:15:09Z"}, "message": "Merge pull request #3181 from scampi/issue3131\n\nfix the logic for retaining a comment before the arrow in a match", "tree": {"sha": "7802e9a0f97b91dfd2a7e262d86473d31af3ca35", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7802e9a0f97b91dfd2a7e262d86473d31af3ca35"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/f10b2256a090520636862576ae487d7eee0d95a6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJb48ZdCRBK7hj4Ov3rIwAAdHIIAGD8X5oWlNvtiCxLOLC6JgPO\n8ZU7X+c0sEe9SWZ0C8AZTd+FqYTsTHZjGAYahAezc5FZT4OmlXarY4B2Fy40WKAv\nCa0xzBPYl6W10/MHVfWAWNHhoC/saVXHqZKAcIXjCB0BwfLGofbDRB2JyqGIzL2H\nhe1rHsP/goyl0tzRr3eBgwJSerHD/eAgOGqZuRDk1/xG45RFXp3M/FECdnPMsGJo\nq9SzHVhJxhKzq4BdDqQO6F93rHizJ1ICIkiYg5kJEQD20sEGJdP6G+QJyFVOzmqp\nj12HHKtUFqejB2oRdqwEPgIl+gf90PrZUsDrl6gm+sQ3APULi2B04OfB7cO7ztk=\n=3A43\n-----END PGP SIGNATURE-----\n", "payload": "tree 7802e9a0f97b91dfd2a7e262d86473d31af3ca35\nparent e4652fb271dd37597ae0624515f91c287f04dc8e\nparent 9467033a8e7f369b5a3d8cc68a51283fd19f4955\nauthor Seiichi Uchida <seuchida@gmail.com> 1541654109 +0900\ncommitter GitHub <noreply@github.com> 1541654109 +0900\n\nMerge pull request #3181 from scampi/issue3131\n\nfix the logic for retaining a comment before the arrow in a match"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/f10b2256a090520636862576ae487d7eee0d95a6", "html_url": "https://github.com/rust-lang/rust/commit/f10b2256a090520636862576ae487d7eee0d95a6", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/f10b2256a090520636862576ae487d7eee0d95a6/comments", "author": {"login": "topecongiro", "id": 21980157, "node_id": "MDQ6VXNlcjIxOTgwMTU3", "avatar_url": "https://avatars.githubusercontent.com/u/21980157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/topecongiro", "html_url": "https://github.com/topecongiro", "followers_url": "https://api.github.com/users/topecongiro/followers", "following_url": "https://api.github.com/users/topecongiro/following{/other_user}", "gists_url": "https://api.github.com/users/topecongiro/gists{/gist_id}", "starred_url": "https://api.github.com/users/topecongiro/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/topecongiro/subscriptions", "organizations_url": "https://api.github.com/users/topecongiro/orgs", "repos_url": "https://api.github.com/users/topecongiro/repos", "events_url": "https://api.github.com/users/topecongiro/events{/privacy}", "received_events_url": "https://api.github.com/users/topecongiro/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e4652fb271dd37597ae0624515f91c287f04dc8e", "url": "https://api.github.com/repos/rust-lang/rust/commits/e4652fb271dd37597ae0624515f91c287f04dc8e", "html_url": "https://github.com/rust-lang/rust/commit/e4652fb271dd37597ae0624515f91c287f04dc8e"}, {"sha": "9467033a8e7f369b5a3d8cc68a51283fd19f4955", "url": "https://api.github.com/repos/rust-lang/rust/commits/9467033a8e7f369b5a3d8cc68a51283fd19f4955", "html_url": "https://github.com/rust-lang/rust/commit/9467033a8e7f369b5a3d8cc68a51283fd19f4955"}], "stats": {"total": 20, "additions": 19, "deletions": 1}, "files": [{"sha": "fc7d4cca0200a913ee596112c26cbe720490ae9b", "filename": "src/matches.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/f10b2256a090520636862576ae487d7eee0d95a6/src%2Fmatches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f10b2256a090520636862576ae487d7eee0d95a6/src%2Fmatches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fmatches.rs?ref=f10b2256a090520636862576ae487d7eee0d95a6", "patch": "@@ -379,7 +379,9 @@ fn rewrite_match_body(\n     // Look for comments between `=>` and the start of the body.\n     let arrow_comment = {\n         let arrow_snippet = context.snippet(arrow_span).trim();\n-        let arrow_index = arrow_snippet.find(\"=>\").unwrap();\n+        // search for the arrow starting from the end of the snippet since there may be a match\n+        // expression within the guard\n+        let arrow_index = arrow_snippet.rfind(\"=>\").unwrap();\n         // 2 = `=>`\n         let comment_str = arrow_snippet[arrow_index + 2..].trim();\n         if comment_str.is_empty() {"}, {"sha": "c4cb2d8c03c03bc522d1d4023a4ab81289f79fa1", "filename": "tests/source/issue-3131.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f10b2256a090520636862576ae487d7eee0d95a6/tests%2Fsource%2Fissue-3131.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f10b2256a090520636862576ae487d7eee0d95a6/tests%2Fsource%2Fissue-3131.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fissue-3131.rs?ref=f10b2256a090520636862576ae487d7eee0d95a6", "patch": "@@ -0,0 +1,8 @@\n+fn main() {\n+    match 3 {\n+        t if match t {\n+            _ => true,\n+        } => {},\n+        _ => {}\n+    }\n+}"}, {"sha": "c7304dd55855323d36123f3dc62bf3298fd776ef", "filename": "tests/target/issue-3131.rs", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/f10b2256a090520636862576ae487d7eee0d95a6/tests%2Ftarget%2Fissue-3131.rs", "raw_url": "https://github.com/rust-lang/rust/raw/f10b2256a090520636862576ae487d7eee0d95a6/tests%2Ftarget%2Fissue-3131.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fissue-3131.rs?ref=f10b2256a090520636862576ae487d7eee0d95a6", "patch": "@@ -0,0 +1,8 @@\n+fn main() {\n+    match 3 {\n+        t if match t {\n+            _ => true,\n+        } => {}\n+        _ => {}\n+    }\n+}"}]}