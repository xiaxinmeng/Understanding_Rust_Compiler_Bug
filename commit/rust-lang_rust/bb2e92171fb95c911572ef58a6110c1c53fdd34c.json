{"sha": "bb2e92171fb95c911572ef58a6110c1c53fdd34c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmJiMmU5MjE3MWZiOTVjOTExNTcyZWY1OGE2MTEwYzFjNTNmZGQzNGM=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-01-22T01:05:04Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2016-02-11T19:12:33Z"}, "message": "configure: Add an option to use the cargo build system\n\nThis commit adds a `--enable-rustbuild` option to the configure script which\nwill copy a different `Makefile.in` into place to intercept all `make`\ninvocations.\n\nCurrently this makefile only has one target, but it's expected to be filled out\nquite a bit over time!", "tree": {"sha": "c6d7243945b7c3f083a250727f3301e1541180c6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c6d7243945b7c3f083a250727f3301e1541180c6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/bb2e92171fb95c911572ef58a6110c1c53fdd34c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/bb2e92171fb95c911572ef58a6110c1c53fdd34c", "html_url": "https://github.com/rust-lang/rust/commit/bb2e92171fb95c911572ef58a6110c1c53fdd34c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/bb2e92171fb95c911572ef58a6110c1c53fdd34c/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "34f7364332c95b63a742709b96141142f6cfe3d8", "url": "https://api.github.com/repos/rust-lang/rust/commits/34f7364332c95b63a742709b96141142f6cfe3d8", "html_url": "https://github.com/rust-lang/rust/commit/34f7364332c95b63a742709b96141142f6cfe3d8"}], "stats": {"total": 41, "additions": 38, "deletions": 3}, "files": [{"sha": "7958ac9bfcfe3a5f4e24ed84637d09d0175e2659", "filename": "configure", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/bb2e92171fb95c911572ef58a6110c1c53fdd34c/configure", "raw_url": "https://github.com/rust-lang/rust/raw/bb2e92171fb95c911572ef58a6110c1c53fdd34c/configure", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/configure?ref=bb2e92171fb95c911572ef58a6110c1c53fdd34c", "patch": "@@ -606,6 +606,7 @@ opt stage0-landing-pads 1 \"enable landing pads during bootstrap with stage0\"\n opt dist-host-only 0 \"only install bins for the host architecture\"\n opt inject-std-version 1 \"inject the current compiler version of libstd into programs\"\n opt llvm-version-check 1 \"check if the LLVM version is supported, build anyway\"\n+opt rustbuild 0 \"use the rust and cargo based build system\"\n \n # Optimization and debugging options. These may be overridden by the release channel, etc.\n opt_nosave optimize 1 \"build optimized rust code\"\n@@ -1422,7 +1423,7 @@ done\n step_msg \"configuring submodules\"\n \n # Have to be in the top of src directory for this\n-if [ -z $CFG_DISABLE_MANAGE_SUBMODULES ]\n+if [ -z $CFG_DISABLE_MANAGE_SUBMODULES ] && [ -z $CFG_ENABLE_RUSTBUILD ]\n then\n     cd ${CFG_SRC_DIR}\n \n@@ -1481,7 +1482,11 @@ do\n         ;;\n     esac\n \n-    if [ -z $CFG_LLVM_ROOT ]\n+    if [ -n \"$CFG_ENABLE_RUSTBUILD\" ]\n+    then\n+        msg \"not configuring LLVM, rustbuild in use\"\n+        do_reconfigure=0\n+    elif [ -z $CFG_LLVM_ROOT ]\n     then\n         LLVM_BUILD_DIR=${CFG_BUILD_DIR}$t/llvm\n         if [ -n \"$CFG_DISABLE_OPTIMIZE_LLVM\" ]\n@@ -1812,8 +1817,15 @@ do\n     putvar $CFG_LLVM_INST_DIR\n done\n \n+if [ -n \"$CFG_ENABLE_RUSTBUILD\" ]\n+then\n+    INPUT_MAKEFILE=src/bootstrap/mk/Makefile.in\n+else\n+    INPUT_MAKEFILE=Makefile.in\n+fi\n+\n msg\n-copy_if_changed ${CFG_SRC_DIR}Makefile.in ./Makefile\n+copy_if_changed ${CFG_SRC_DIR}${INPUT_MAKEFILE} ./Makefile\n move_if_changed config.tmp config.mk\n rm -f config.tmp\n touch config.stamp"}, {"sha": "1157346d774ab3882f9d65f12d604c8e36833125", "filename": "src/bootstrap/mk/Makefile.in", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/bb2e92171fb95c911572ef58a6110c1c53fdd34c/src%2Fbootstrap%2Fmk%2FMakefile.in", "raw_url": "https://github.com/rust-lang/rust/raw/bb2e92171fb95c911572ef58a6110c1c53fdd34c/src%2Fbootstrap%2Fmk%2FMakefile.in", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fmk%2FMakefile.in?ref=bb2e92171fb95c911572ef58a6110c1c53fdd34c", "patch": "@@ -0,0 +1,23 @@\n+# Copyright 20126 The Rust Project Developers. See the COPYRIGHT\n+# file at the top-level directory of this distribution and at\n+# http://rust-lang.org/COPYRIGHT.\n+#\n+# Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+# http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+# <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+# option. This file may not be copied, modified, or distributed\n+# except according to those terms.\n+\n+include config.mk\n+include $(CFG_SRC_DIR)mk/util.mk\n+\n+ifdef VERBOSE\n+BOOTSTRAP_ARGS := -v\n+else\n+BOOTSTRAP_ARGS :=\n+endif\n+\n+BOOTSTRAP := $(CFG_PYTHON) $(CFG_SRC_DIR)src/bootstrap/bootstrap.py $(BOOTSTRAP_ARGS)\n+\n+all:\n+\t$(Q)$(BOOTSTRAP)"}]}