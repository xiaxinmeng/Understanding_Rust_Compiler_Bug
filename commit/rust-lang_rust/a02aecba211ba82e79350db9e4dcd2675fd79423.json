{"sha": "a02aecba211ba82e79350db9e4dcd2675fd79423", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEwMmFlY2JhMjExYmE4MmU3OTM1MGRiOWU0ZGNkMjY3NWZkNzk0MjM=", "commit": {"author": {"name": "Yuki Okushi", "email": "huyuumi.dev@gmail.com", "date": "2020-07-24T09:56:31Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-07-24T09:56:31Z"}, "message": "Rollup merge of #74623 - lcnr:polymorphize-functions, r=eddyb\n\npolymorphize GlobalAlloc::Function\n\nthis sadly does not change #74614\n\nr? @eddyb", "tree": {"sha": "cda4a8b95d8da7fac22116e16afec0294a688bfb", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/cda4a8b95d8da7fac22116e16afec0294a688bfb"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a02aecba211ba82e79350db9e4dcd2675fd79423", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJfGrBPCRBK7hj4Ov3rIwAAdHIIAEpPYF+ouo2TTHmlk09IAm3g\nJqCXa+LItoj7zmZwojUwT5wjqofg+d63x6/vyYm5WWiz6ryUp3PsXjur/9Ln390o\n5GcYf0AWGWAk5YLUnqMGSdAp2rZGCmyO/9lWPLgbdVmKKSjI6jfZN5oBxeNSXdvr\n1qjSoQ7emFyviGq0Id+Nuke1dfmVXNAEQDIkVfvmqz2dAFxlm492vYxsVEO9fOca\nD46oJ2tJv5oPUBH2DiMqyZEPc5oIoF9hAdqb5Hfwa5NAsOSDK38oDssEz7cuITUs\ncXii7XkXIaxmRLrpc41ngfpsdAa76FgCv6cN6aBTqMEKEUrx+5fcfmeI2P6lq58=\n=AaS4\n-----END PGP SIGNATURE-----\n", "payload": "tree cda4a8b95d8da7fac22116e16afec0294a688bfb\nparent a816345536b1651bd05d9b9a8eed6db043a5e14d\nparent 40b6bccd6431e5d3032279ec5f6d269cacc7fe9b\nauthor Yuki Okushi <huyuumi.dev@gmail.com> 1595584591 +0900\ncommitter GitHub <noreply@github.com> 1595584591 +0900\n\nRollup merge of #74623 - lcnr:polymorphize-functions, r=eddyb\n\npolymorphize GlobalAlloc::Function\n\nthis sadly does not change #74614\n\nr? @eddyb\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a02aecba211ba82e79350db9e4dcd2675fd79423", "html_url": "https://github.com/rust-lang/rust/commit/a02aecba211ba82e79350db9e4dcd2675fd79423", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a02aecba211ba82e79350db9e4dcd2675fd79423/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a816345536b1651bd05d9b9a8eed6db043a5e14d", "url": "https://api.github.com/repos/rust-lang/rust/commits/a816345536b1651bd05d9b9a8eed6db043a5e14d", "html_url": "https://github.com/rust-lang/rust/commit/a816345536b1651bd05d9b9a8eed6db043a5e14d"}, {"sha": "40b6bccd6431e5d3032279ec5f6d269cacc7fe9b", "url": "https://api.github.com/repos/rust-lang/rust/commits/40b6bccd6431e5d3032279ec5f6d269cacc7fe9b", "html_url": "https://github.com/rust-lang/rust/commit/40b6bccd6431e5d3032279ec5f6d269cacc7fe9b"}], "stats": {"total": 15, "additions": 14, "deletions": 1}, "files": [{"sha": "2a50d4a46d279436ade2897007f8615097f59b7a", "filename": "src/librustc_codegen_llvm/common.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/a02aecba211ba82e79350db9e4dcd2675fd79423/src%2Flibrustc_codegen_llvm%2Fcommon.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a02aecba211ba82e79350db9e4dcd2675fd79423/src%2Flibrustc_codegen_llvm%2Fcommon.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_codegen_llvm%2Fcommon.rs?ref=a02aecba211ba82e79350db9e4dcd2675fd79423", "patch": "@@ -257,7 +257,7 @@ impl ConstMethods<'tcx> for CodegenCx<'ll, 'tcx> {\n                         (value, AddressSpace::DATA)\n                     }\n                     GlobalAlloc::Function(fn_instance) => (\n-                        self.get_fn_addr(fn_instance),\n+                        self.get_fn_addr(fn_instance.polymorphize(self.tcx)),\n                         self.data_layout().instruction_address_space,\n                     ),\n                     GlobalAlloc::Static(def_id) => {"}, {"sha": "0d3af7a89c2aac2936426d8992c880c9dbd2511c", "filename": "src/test/ui/polymorphization/promoted-function.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/a02aecba211ba82e79350db9e4dcd2675fd79423/src%2Ftest%2Fui%2Fpolymorphization%2Fpromoted-function.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a02aecba211ba82e79350db9e4dcd2675fd79423/src%2Ftest%2Fui%2Fpolymorphization%2Fpromoted-function.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fpolymorphization%2Fpromoted-function.rs?ref=a02aecba211ba82e79350db9e4dcd2675fd79423", "patch": "@@ -0,0 +1,13 @@\n+// run-pass\n+fn fop<T>() {}\n+\n+fn bar<T>() -> &'static fn() {\n+    &(fop::<T> as fn())\n+}\n+pub const FN: &'static fn() = &(fop::<i32> as fn());\n+\n+fn main() {\n+    bar::<u32>();\n+    bar::<i32>();\n+    (FN)();\n+}"}]}