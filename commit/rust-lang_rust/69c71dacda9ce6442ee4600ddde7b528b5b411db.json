{"sha": "69c71dacda9ce6442ee4600ddde7b528b5b411db", "node_id": "C_kwDOAAsO6NoAKDY5YzcxZGFjZGE5Y2U2NDQyZWU0NjAwZGRkZTdiNTI4YjViNDExZGI", "commit": {"author": {"name": "Lukas Markeffsky", "email": "@", "date": "2023-04-28T17:35:40Z"}, "committer": {"name": "Lukas Markeffsky", "email": "@", "date": "2023-04-28T17:35:40Z"}, "message": "fix false negative for `unused_mut`", "tree": {"sha": "2b599bd4499b8fea0acda0faf535365fb58dae46", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2b599bd4499b8fea0acda0faf535365fb58dae46"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/69c71dacda9ce6442ee4600ddde7b528b5b411db", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/69c71dacda9ce6442ee4600ddde7b528b5b411db", "html_url": "https://github.com/rust-lang/rust/commit/69c71dacda9ce6442ee4600ddde7b528b5b411db", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/69c71dacda9ce6442ee4600ddde7b528b5b411db/comments", "author": null, "committer": null, "parents": [{"sha": "43a78029b4f4d92978b8fde0a677ea300b113c41", "url": "https://api.github.com/repos/rust-lang/rust/commits/43a78029b4f4d92978b8fde0a677ea300b113c41", "html_url": "https://github.com/rust-lang/rust/commit/43a78029b4f4d92978b8fde0a677ea300b113c41"}], "stats": {"total": 29, "additions": 23, "deletions": 6}, "files": [{"sha": "6900729d671a07e04041a77b5133f7dab38e21b4", "filename": "compiler/rustc_borrowck/src/lib.rs", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/69c71dacda9ce6442ee4600ddde7b528b5b411db/compiler%2Frustc_borrowck%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c71dacda9ce6442ee4600ddde7b528b5b411db/compiler%2Frustc_borrowck%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_borrowck%2Fsrc%2Flib.rs?ref=69c71dacda9ce6442ee4600ddde7b528b5b411db", "patch": "@@ -935,6 +935,7 @@ enum InitializationRequiringAction {\n     PartialAssignment,\n }\n \n+#[derive(Debug)]\n struct RootPlace<'tcx> {\n     place_local: Local,\n     place_projection: &'tcx [PlaceElem<'tcx>],\n@@ -1848,11 +1849,6 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n                         // is allowed, remove this match arm.\n                         ty::Adt(..) | ty::Tuple(..) => {\n                             check_parent_of_field(self, location, place_base, span, flow_state);\n-\n-                            // rust-lang/rust#21232, #54499, #54986: during period where we reject\n-                            // partial initialization, do not complain about unnecessary `mut` on\n-                            // an attempt to do a partial initialization.\n-                            self.used_mut.insert(place.local);\n                         }\n \n                         _ => {}\n@@ -1940,6 +1936,11 @@ impl<'cx, 'tcx> MirBorrowckCtxt<'cx, 'tcx> {\n                     (prefix, base, span),\n                     mpi,\n                 );\n+\n+                // rust-lang/rust#21232, #54499, #54986: during period where we reject\n+                // partial initialization, do not complain about unnecessary `mut` on\n+                // an attempt to do a partial initialization.\n+                this.used_mut.insert(base.local);\n             }\n         }\n     }"}, {"sha": "5334ab5824d7ac5ef5927c2618f2e345a1b90c30", "filename": "tests/ui/lint/unused/lint-unused-mut-variables.rs", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/69c71dacda9ce6442ee4600ddde7b528b5b411db/tests%2Fui%2Flint%2Funused%2Flint-unused-mut-variables.rs", "raw_url": "https://github.com/rust-lang/rust/raw/69c71dacda9ce6442ee4600ddde7b528b5b411db/tests%2Fui%2Flint%2Funused%2Flint-unused-mut-variables.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flint%2Funused%2Flint-unused-mut-variables.rs?ref=69c71dacda9ce6442ee4600ddde7b528b5b411db", "patch": "@@ -205,3 +205,11 @@ fn bar() {\n     let mut b = vec![2]; //~ ERROR: variable does not need to be mutable\n \n }\n+\n+struct Arg(i32);\n+\n+// Regression test for https://github.com/rust-lang/rust/issues/110849\n+fn write_through_reference(mut arg: &mut Arg) {\n+    //~^ WARN: variable does not need to be mutable\n+    arg.0 = 1\n+}"}, {"sha": "5f66c031581784b3a619ec451340c577bf569812", "filename": "tests/ui/lint/unused/lint-unused-mut-variables.stderr", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/69c71dacda9ce6442ee4600ddde7b528b5b411db/tests%2Fui%2Flint%2Funused%2Flint-unused-mut-variables.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/69c71dacda9ce6442ee4600ddde7b528b5b411db/tests%2Fui%2Flint%2Funused%2Flint-unused-mut-variables.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Flint%2Funused%2Flint-unused-mut-variables.stderr?ref=69c71dacda9ce6442ee4600ddde7b528b5b411db", "patch": "@@ -218,5 +218,13 @@ note: the lint level is defined here\n LL | #[deny(unused_mut)]\n    |        ^^^^^^^^^^\n \n-error: aborting due to previous error; 25 warnings emitted\n+warning: variable does not need to be mutable\n+  --> $DIR/lint-unused-mut-variables.rs:212:28\n+   |\n+LL | fn write_through_reference(mut arg: &mut Arg) {\n+   |                            ----^^^\n+   |                            |\n+   |                            help: remove this `mut`\n+\n+error: aborting due to previous error; 26 warnings emitted\n "}]}