{"sha": "23ed79260baa31c24610a42470d379dd434b025a", "node_id": "C_kwDOAAsO6NoAKDIzZWQ3OTI2MGJhYTMxYzI0NjEwYTQyNDcwZDM3OWRkNDM0YjAyNWE", "commit": {"author": {"name": "xFrednet", "email": "xFrednet@gmail.com", "date": "2021-10-17T13:02:12Z"}, "committer": {"name": "xFrednet", "email": "xFrednet@gmail.com", "date": "2021-11-10T18:48:30Z"}, "message": "Document new `clippy::version` attribute and make it mandatory", "tree": {"sha": "b7547d23ceff492f69243748efeed59bf3d95ec4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/b7547d23ceff492f69243748efeed59bf3d95ec4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/23ed79260baa31c24610a42470d379dd434b025a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEsfZNmu/fmIv8KDcv/Ny/Ka9k1gEFAmGME/4ACgkQ/Ny/Ka9k\n1gGI2xAAnXGjpNzkMwpKrqMHH56JJC3FHGkJUOlajOU+7TCetrq16AnrGGsLbLu7\nGKz8+vSgaa5QCLGE92xi/vuipXhQhVYsbtE2YRwTIywmWAD/pnrHPm0fwOkrqDBx\nPF6ZLuJD0hfhrWxfZi1Krx8/BBNT4BtLQxLof2kbumL+htVHvG4ubC/TqxvVnyJA\noIjcv/MAdltnqydb+7OvBfJwMHu2XWyZlSUbu5nPBfekEqjJWzkDc/bYPjyIU8km\njIff8gZfavCcXO4HffG1A0z3lmFtqzER09dCavS+IVvso8bx9B1FN3CS3AoLQRfK\ntyAZsgZ+0cgo7QR70ksw8MgWrl8sotaGu7SuAjXaUcPumcZD7oJLgzyOD12bOGJP\nB1ZJsyxWgyiiqe0f7PEsLO7fyO/rK+hlyECVCe3iQXBrcKpL4lzzo7Lr/tZfUNKe\nr7mYjLnqXDh2tIN4mEq10tzWaABbvVpSItg8Czo3Ki1ArOGBhd+eJoiDF457BpGr\nDdPNbG35gXdeB3p+EMTHNljs1hLpbQkDt+1MDaa2vhS6CGZv9zBWTXwzi7N1hRx+\nDvfr5U2T+469xqCqNpLwyDIbatk0RYqnEUVO1eNrdv5qHMAJgWO8pLBUFSvhW4oy\nk6sLwEnCOONss9PJNs3MI1swVzUllc6NB6qa5CbCVvhF98KteAk=\n=GyZD\n-----END PGP SIGNATURE-----", "payload": "tree b7547d23ceff492f69243748efeed59bf3d95ec4\nparent 8565fc468e97d7ab4d350532474c36127960f8ee\nauthor xFrednet <xFrednet@gmail.com> 1634475732 +0200\ncommitter xFrednet <xFrednet@gmail.com> 1636570110 +0100\n\nDocument new `clippy::version` attribute and make it mandatory\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/23ed79260baa31c24610a42470d379dd434b025a", "html_url": "https://github.com/rust-lang/rust/commit/23ed79260baa31c24610a42470d379dd434b025a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/23ed79260baa31c24610a42470d379dd434b025a/comments", "author": {"login": "xFrednet", "id": 17087237, "node_id": "MDQ6VXNlcjE3MDg3MjM3", "avatar_url": "https://avatars.githubusercontent.com/u/17087237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xFrednet", "html_url": "https://github.com/xFrednet", "followers_url": "https://api.github.com/users/xFrednet/followers", "following_url": "https://api.github.com/users/xFrednet/following{/other_user}", "gists_url": "https://api.github.com/users/xFrednet/gists{/gist_id}", "starred_url": "https://api.github.com/users/xFrednet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xFrednet/subscriptions", "organizations_url": "https://api.github.com/users/xFrednet/orgs", "repos_url": "https://api.github.com/users/xFrednet/repos", "events_url": "https://api.github.com/users/xFrednet/events{/privacy}", "received_events_url": "https://api.github.com/users/xFrednet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xFrednet", "id": 17087237, "node_id": "MDQ6VXNlcjE3MDg3MjM3", "avatar_url": "https://avatars.githubusercontent.com/u/17087237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xFrednet", "html_url": "https://github.com/xFrednet", "followers_url": "https://api.github.com/users/xFrednet/followers", "following_url": "https://api.github.com/users/xFrednet/following{/other_user}", "gists_url": "https://api.github.com/users/xFrednet/gists{/gist_id}", "starred_url": "https://api.github.com/users/xFrednet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xFrednet/subscriptions", "organizations_url": "https://api.github.com/users/xFrednet/orgs", "repos_url": "https://api.github.com/users/xFrednet/repos", "events_url": "https://api.github.com/users/xFrednet/events{/privacy}", "received_events_url": "https://api.github.com/users/xFrednet/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8565fc468e97d7ab4d350532474c36127960f8ee", "url": "https://api.github.com/repos/rust-lang/rust/commits/8565fc468e97d7ab4d350532474c36127960f8ee", "html_url": "https://github.com/rust-lang/rust/commit/8565fc468e97d7ab4d350532474c36127960f8ee"}], "stats": {"total": 33, "additions": 29, "deletions": 4}, "files": [{"sha": "08cf756c77cb864f8f26da145e841ae7479fffa0", "filename": "clippy_dev/Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/23ed79260baa31c24610a42470d379dd434b025a/clippy_dev%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/23ed79260baa31c24610a42470d379dd434b025a/clippy_dev%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2FCargo.toml?ref=23ed79260baa31c24610a42470d379dd434b025a", "patch": "@@ -12,6 +12,7 @@ opener = \"0.5\"\n regex = \"1.5\"\n shell-escape = \"0.1\"\n walkdir = \"2.3\"\n+cargo_metadata = \"0.12\"\n \n [features]\n deny-warnings = []"}, {"sha": "a14dc36013828831bde31ee10706d1ef24af1ae7", "filename": "clippy_dev/src/new_lint.rs", "status": "modified", "additions": 18, "deletions": 3, "changes": 21, "blob_url": "https://github.com/rust-lang/rust/blob/23ed79260baa31c24610a42470d379dd434b025a/clippy_dev%2Fsrc%2Fnew_lint.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23ed79260baa31c24610a42470d379dd434b025a/clippy_dev%2Fsrc%2Fnew_lint.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fnew_lint.rs?ref=23ed79260baa31c24610a42470d379dd434b025a", "patch": "@@ -132,6 +132,18 @@ fn to_camel_case(name: &str) -> String {\n         .collect()\n }\n \n+fn get_stabilisation_version() -> String {\n+    let mut command = cargo_metadata::MetadataCommand::new();\n+    command.no_deps();\n+    if let Ok(metadata) = command.exec() {\n+        if let Some(pkg) = metadata.packages.iter().find(|pkg| pkg.name == \"clippy\") {\n+            return format!(\"{}.{}.0\", pkg.version.minor, pkg.version.patch);\n+        }\n+    }\n+\n+    String::from(\"<TODO set version(see doc/adding_lints.md)\")\n+}\n+\n fn get_test_file_contents(lint_name: &str, header_commands: Option<&str>) -> String {\n     let mut contents = format!(\n         indoc! {\"\n@@ -178,6 +190,7 @@ fn get_lint_file_contents(lint: &LintData<'_>, enable_msrv: bool) -> String {\n         },\n     };\n \n+    let version = get_stabilisation_version();\n     let lint_name = lint.name;\n     let category = lint.category;\n     let name_camel = to_camel_case(lint.name);\n@@ -212,7 +225,7 @@ fn get_lint_file_contents(lint: &LintData<'_>, enable_msrv: bool) -> String {\n     });\n \n     result.push_str(&format!(\n-        indoc! {\"\n+        indoc! {r#\"\n             declare_clippy_lint! {{\n                 /// ### What it does\n                 ///\n@@ -226,11 +239,13 @@ fn get_lint_file_contents(lint: &LintData<'_>, enable_msrv: bool) -> String {\n                 /// ```rust\n                 /// // example code which does not raise clippy warning\n                 /// ```\n+                #[clippy::version = \"{version}\"]\n                 pub {name_upper},\n                 {category},\n-                \\\"default lint description\\\"\n+                \"default lint description\"\n             }}\n-        \"},\n+        \"#},\n+        version = version,\n         name_upper = name_upper,\n         category = category,\n     ));"}, {"sha": "21b2b3b66f4211ba0094db8d7276ecda24a61440", "filename": "clippy_dev/src/update_lints.rs", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/23ed79260baa31c24610a42470d379dd434b025a/clippy_dev%2Fsrc%2Fupdate_lints.rs", "raw_url": "https://github.com/rust-lang/rust/raw/23ed79260baa31c24610a42470d379dd434b025a/clippy_dev%2Fsrc%2Fupdate_lints.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_dev%2Fsrc%2Fupdate_lints.rs?ref=23ed79260baa31c24610a42470d379dd434b025a", "patch": "@@ -18,7 +18,7 @@ static DEC_CLIPPY_LINT_RE: SyncLazy<Regex> = SyncLazy::new(|| {\n         r#\"(?x)\n     declare_clippy_lint!\\s*[\\{(]\n     (?:\\s+///.*)*\n-    (?:\\s*\\#\\[clippy::version\\s*=\\s*\"[^\"]*\"\\])?\n+    (?:\\s*\\#\\[clippy::version\\s*=\\s*\"[^\"]*\"\\])\n     \\s+pub\\s+(?P<name>[A-Z_][A-Z_0-9]*)\\s*,\\s*\n     (?P<cat>[a-z_]+)\\s*,\\s*\n     \"(?P<desc>(?:[^\"\\\\]+|\\\\(?s).(?-s))*)\"\\s*[})]\n@@ -496,20 +496,23 @@ fn test_parse_contents() {\n     let result: Vec<Lint> = parse_contents(\n         r#\"\n declare_clippy_lint! {\n+    #[clippy::version = \"Hello Clippy!\"]\n     pub PTR_ARG,\n     style,\n     \"really long \\\n      text\"\n }\n \n declare_clippy_lint!{\n+    #[clippy::version = \"Test version\"]\n     pub DOC_MARKDOWN,\n     pedantic,\n     \"single line\"\n }\n \n /// some doc comment\n declare_deprecated_lint! {\n+    #[clippy::version = \"I'm a version\"]\n     pub SHOULD_ASSERT_EQ,\n     \"`assert!()` will be more flexible with RFC 2011\"\n }"}, {"sha": "cf16a1d5d3dcf5b09538f3d55da4dd6f3e22341d", "filename": "doc/adding_lints.md", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/23ed79260baa31c24610a42470d379dd434b025a/doc%2Fadding_lints.md", "raw_url": "https://github.com/rust-lang/rust/raw/23ed79260baa31c24610a42470d379dd434b025a/doc%2Fadding_lints.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/doc%2Fadding_lints.md?ref=23ed79260baa31c24610a42470d379dd434b025a", "patch": "@@ -189,6 +189,7 @@ declare_clippy_lint! {\n     /// ```rust\n     /// // example code\n     /// ```\n+    #[clippy::version = \"1.29.0\"]\n     pub FOO_FUNCTIONS,\n     pedantic,\n     \"function named `foo`, which is not a descriptive name\"\n@@ -199,6 +200,10 @@ declare_clippy_lint! {\n   section. This is the default documentation style and will be displayed\n   [like this][example_lint_page]. To render and open this documentation locally\n   in a browser, run `cargo dev serve`.\n+* The `#[clippy::version]` attribute will be rendered as part of the lint documentation.\n+  The value should be set to the current Rust version that the lint is developed in,\n+  it can be retrieved by running `rustc -vV` in the rust-clippy directory. The version\n+  is listed under *release*. (Use the version without the `-nightly`) suffix.\n * `FOO_FUNCTIONS` is the name of our lint. Be sure to follow the\n   [lint naming guidelines][lint_naming] here when naming your lint.\n   In short, the name should state the thing that is being checked for and\n@@ -503,6 +508,7 @@ declare_clippy_lint! {\n     /// // Good\n     /// Insert a short example of improved code that doesn't trigger the lint\n     /// ```\n+    #[clippy::version = \"1.29.0\"]\n     pub FOO_FUNCTIONS,\n     pedantic,\n     \"function named `foo`, which is not a descriptive name\""}]}