{"sha": "8f7a0470b073803317e85e306308a4b9457dc5cd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhmN2EwNDcwYjA3MzgwMzMxN2U4NWUzMDYzMDhhNGI5NDU3ZGM1Y2Q=", "commit": {"author": {"name": "St\u00e9phane Campinas", "email": "stephane.campinas@gmail.com", "date": "2018-10-13T07:57:43Z"}, "committer": {"name": "St\u00e9phane Campinas", "email": "stephane.campinas@gmail.com", "date": "2018-10-13T07:57:43Z"}, "message": "handle lines prefixed with a # inside code blocks", "tree": {"sha": "c0b317990e53a8fd75fb5e193287e3d60185ad7c", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c0b317990e53a8fd75fb5e193287e3d60185ad7c"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8f7a0470b073803317e85e306308a4b9457dc5cd", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCgAdFiEEipi5pnt+pUplKNfibVYg2QghATMFAlvBpgEACgkQbVYg2Qgh\nATNgiQgAiT5kDgpZRAJ/QRxn69U7r8zxNssxLqovTpSObbCYuGxEcHd+fWL2mVsV\nbCgAx/IDCEE974+I8XPr0uEbs9bDB8ZZxH+2S5QB4UvBYjRHJA7bOuXh2Todh6gE\nXBFKFdXTEft+libRhWOX/k/6fSB+vcctstrX94FJ/bd7C4Fp1YlkLluojKFCoMpt\nSyIGRmq46QgAzil5u+H/UpySC7zRiMlKiEpqFRX0l30YbrTLAEaUa3209jCktWKl\nOu7FJIkteBTn5DE6UbO0OkEs/KfI2hR8MUMpoQeVrJCWrGv/0jH364HNXNBdhMMF\nlRIYUHdw4TKRsX+BBDfxb6z6BWRhiA==\n=4iu8\n-----END PGP SIGNATURE-----", "payload": "tree c0b317990e53a8fd75fb5e193287e3d60185ad7c\nparent 78d9091afff88464a32d14508cd4671e8d419e7d\nauthor St\u00e9phane Campinas <stephane.campinas@gmail.com> 1539417463 +0200\ncommitter St\u00e9phane Campinas <stephane.campinas@gmail.com> 1539417463 +0200\n\nhandle lines prefixed with a # inside code blocks\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8f7a0470b073803317e85e306308a4b9457dc5cd", "html_url": "https://github.com/rust-lang/rust/commit/8f7a0470b073803317e85e306308a4b9457dc5cd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8f7a0470b073803317e85e306308a4b9457dc5cd/comments", "author": {"login": "scampi", "id": 795879, "node_id": "MDQ6VXNlcjc5NTg3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/795879?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scampi", "html_url": "https://github.com/scampi", "followers_url": "https://api.github.com/users/scampi/followers", "following_url": "https://api.github.com/users/scampi/following{/other_user}", "gists_url": "https://api.github.com/users/scampi/gists{/gist_id}", "starred_url": "https://api.github.com/users/scampi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scampi/subscriptions", "organizations_url": "https://api.github.com/users/scampi/orgs", "repos_url": "https://api.github.com/users/scampi/repos", "events_url": "https://api.github.com/users/scampi/events{/privacy}", "received_events_url": "https://api.github.com/users/scampi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "scampi", "id": 795879, "node_id": "MDQ6VXNlcjc5NTg3OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/795879?v=4", "gravatar_id": "", "url": "https://api.github.com/users/scampi", "html_url": "https://github.com/scampi", "followers_url": "https://api.github.com/users/scampi/followers", "following_url": "https://api.github.com/users/scampi/following{/other_user}", "gists_url": "https://api.github.com/users/scampi/gists{/gist_id}", "starred_url": "https://api.github.com/users/scampi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/scampi/subscriptions", "organizations_url": "https://api.github.com/users/scampi/orgs", "repos_url": "https://api.github.com/users/scampi/repos", "events_url": "https://api.github.com/users/scampi/events{/privacy}", "received_events_url": "https://api.github.com/users/scampi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "78d9091afff88464a32d14508cd4671e8d419e7d", "url": "https://api.github.com/repos/rust-lang/rust/commits/78d9091afff88464a32d14508cd4671e8d419e7d", "html_url": "https://github.com/rust-lang/rust/commit/78d9091afff88464a32d14508cd4671e8d419e7d"}], "stats": {"total": 34, "additions": 32, "deletions": 2}, "files": [{"sha": "c946cc6e1c013e0a534b2408186a8cf84e7ca8ce", "filename": "src/comment.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/8f7a0470b073803317e85e306308a4b9457dc5cd/src%2Fcomment.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f7a0470b073803317e85e306308a4b9457dc5cd/src%2Fcomment.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomment.rs?ref=8f7a0470b073803317e85e306308a4b9457dc5cd", "patch": "@@ -752,9 +752,16 @@ fn trim_custom_comment_prefix(s: &str) -> String {\n         .map(|line| {\n             let left_trimmed = line.trim_left();\n             if left_trimmed.starts_with(RUSTFMT_CUSTOM_COMMENT_PREFIX) {\n-                left_trimmed.trim_left_matches(RUSTFMT_CUSTOM_COMMENT_PREFIX)\n+                let orig = left_trimmed.trim_left_matches(RUSTFMT_CUSTOM_COMMENT_PREFIX);\n+                // due to comment wrapping, a line that was originaly behind `#` is split over\n+                // multiple lines, which needs then to be prefixed with a `#`\n+                if !orig.trim_left().starts_with(\"# \") {\n+                    format!(\"# {}\", orig)\n+                } else {\n+                    orig.to_string()\n+                }\n             } else {\n-                line\n+                line.to_string()\n             }\n         })\n         .collect::<Vec<_>>()"}, {"sha": "d8de8443812e4d81f977e8716f4d5589a0ea4e82", "filename": "tests/source/wrapped_hidden_code_block.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/8f7a0470b073803317e85e306308a4b9457dc5cd/tests%2Fsource%2Fwrapped_hidden_code_block.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f7a0470b073803317e85e306308a4b9457dc5cd/tests%2Fsource%2Fwrapped_hidden_code_block.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fwrapped_hidden_code_block.rs?ref=8f7a0470b073803317e85e306308a4b9457dc5cd", "patch": "@@ -0,0 +1,10 @@\n+// rustfmt-max_width: 79\n+// rustfmt-wrap_comments: true\n+\n+/// ```rust\n+/// # #![cfg_attr(not(dox), feature(cfg_target_feature, target_feature, stdsimd)not(dox), feature(cfg_target_feature, target_feature, stdsimd))]\n+///\n+/// // Est lectus hendrerit lorem, eget dignissim orci nisl sit amet massa. Etiam volutpat lobortis eros.\n+/// let x = 42;\n+/// ```\n+fn func() {}"}, {"sha": "572f448c4e7ce3cd96a03557048a71db259a3bfd", "filename": "tests/target/wrapped_hidden_code_block.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/8f7a0470b073803317e85e306308a4b9457dc5cd/tests%2Ftarget%2Fwrapped_hidden_code_block.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8f7a0470b073803317e85e306308a4b9457dc5cd/tests%2Ftarget%2Fwrapped_hidden_code_block.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fwrapped_hidden_code_block.rs?ref=8f7a0470b073803317e85e306308a4b9457dc5cd", "patch": "@@ -0,0 +1,13 @@\n+// rustfmt-max_width: 79\n+// rustfmt-wrap_comments: true\n+\n+/// ```rust\n+/// # #![cfg_attr(not(dox), feature(cfg_target_feature, target_feature,\n+/// # stdsimd)not(dox), feature(cfg_target_feature, target_feature,\n+/// # stdsimd))]\n+///\n+/// // Est lectus hendrerit lorem, eget dignissim orci nisl sit amet massa.\n+/// // Etiam volutpat lobortis eros.\n+/// let x = 42;\n+/// ```\n+fn func() {}"}]}