{"sha": "b70cc5380452676e4044ca289d177781d6b42035", "node_id": "MDY6Q29tbWl0NzI0NzEyOmI3MGNjNTM4MDQ1MjY3NmU0MDQ0Y2EyODlkMTc3NzgxZDZiNDIwMzU=", "commit": {"author": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2018-03-21T22:48:56Z"}, "committer": {"name": "Manish Goregaokar", "email": "manishsmail@gmail.com", "date": "2018-03-29T06:44:21Z"}, "message": "Add easy edition feature flag", "tree": {"sha": "273d77cbf80a4da56dfc58a0caf1a979ebc3c1e1", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/273d77cbf80a4da56dfc58a0caf1a979ebc3c1e1"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b70cc5380452676e4044ca289d177781d6b42035", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b70cc5380452676e4044ca289d177781d6b42035", "html_url": "https://github.com/rust-lang/rust/commit/b70cc5380452676e4044ca289d177781d6b42035", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b70cc5380452676e4044ca289d177781d6b42035/comments", "author": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Manishearth", "id": 1617736, "node_id": "MDQ6VXNlcjE2MTc3MzY=", "avatar_url": "https://avatars.githubusercontent.com/u/1617736?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Manishearth", "html_url": "https://github.com/Manishearth", "followers_url": "https://api.github.com/users/Manishearth/followers", "following_url": "https://api.github.com/users/Manishearth/following{/other_user}", "gists_url": "https://api.github.com/users/Manishearth/gists{/gist_id}", "starred_url": "https://api.github.com/users/Manishearth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Manishearth/subscriptions", "organizations_url": "https://api.github.com/users/Manishearth/orgs", "repos_url": "https://api.github.com/users/Manishearth/repos", "events_url": "https://api.github.com/users/Manishearth/events{/privacy}", "received_events_url": "https://api.github.com/users/Manishearth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c08480fce0f39f5c9c6db6dde0dccb375ca0ab14", "url": "https://api.github.com/repos/rust-lang/rust/commits/c08480fce0f39f5c9c6db6dde0dccb375ca0ab14", "html_url": "https://github.com/rust-lang/rust/commit/c08480fce0f39f5c9c6db6dde0dccb375ca0ab14"}], "stats": {"total": 43, "additions": 30, "deletions": 13}, "files": [{"sha": "e579fc74b42661753386440869b2bc0ac16c213d", "filename": "src/libsyntax/edition.rs", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/b70cc5380452676e4044ca289d177781d6b42035/src%2Flibsyntax%2Fedition.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b70cc5380452676e4044ca289d177781d6b42035/src%2Flibsyntax%2Fedition.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Fedition.rs?ref=b70cc5380452676e4044ca289d177781d6b42035", "patch": "@@ -55,6 +55,13 @@ impl Edition {\n             Edition::Edition2018 => \"edition_2018\",\n         }\n     }\n+\n+    pub fn feature_name(&self) -> &'static str {\n+        match *self {\n+            Edition::Edition2015 => \"rust_2015_preview\",\n+            Edition::Edition2018 => \"rust_2018_preview\",\n+        }\n+    }\n }\n \n impl FromStr for Edition {"}, {"sha": "be5ebcbd13a60a5f8ff6d18a37651e7ac2837b59", "filename": "src/libsyntax/feature_gate.rs", "status": "modified", "additions": 23, "deletions": 13, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/b70cc5380452676e4044ca289d177781d6b42035/src%2Flibsyntax%2Ffeature_gate.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b70cc5380452676e4044ca289d177781d6b42035/src%2Flibsyntax%2Ffeature_gate.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax%2Ffeature_gate.rs?ref=b70cc5380452676e4044ca289d177781d6b42035", "patch": "@@ -28,7 +28,7 @@ use self::AttributeGate::*;\n use abi::Abi;\n use ast::{self, NodeId, PatKind, RangeEnd};\n use attr;\n-use edition::Edition;\n+use edition::{ALL_EDITIONS, Edition};\n use codemap::Spanned;\n use syntax_pos::{Span, DUMMY_SP};\n use errors::{DiagnosticBuilder, Handler, FatalError};\n@@ -1818,21 +1818,15 @@ impl<'a> Visitor<'a> for PostExpansionVisitor<'a> {\n }\n \n pub fn get_features(span_handler: &Handler, krate_attrs: &[ast::Attribute],\n-                    edition: Edition) -> Features {\n+                    crate_edition: Edition) -> Features {\n+    fn feature_removed(span_handler: &Handler, span: Span) {\n+        span_err!(span_handler, span, E0557, \"feature has been removed\");\n+    }\n+\n     let mut features = Features::new();\n \n     let mut feature_checker = FeatureChecker::default();\n \n-    for &(.., f_edition, set) in ACTIVE_FEATURES.iter() {\n-        if let Some(f_edition) = f_edition {\n-            if edition >= f_edition {\n-                // FIXME(Manishearth) there is currently no way to set\n-                // lang features by edition\n-                set(&mut features, DUMMY_SP);\n-            }\n-        }\n-    }\n-\n     for attr in krate_attrs {\n         if !attr.check_name(\"feature\") {\n             continue\n@@ -1845,6 +1839,7 @@ pub fn get_features(span_handler: &Handler, krate_attrs: &[ast::Attribute],\n             }\n             Some(list) => {\n                 for mi in list {\n+\n                     let name = if let Some(word) = mi.word() {\n                         word.name()\n                     } else {\n@@ -1862,11 +1857,26 @@ pub fn get_features(span_handler: &Handler, krate_attrs: &[ast::Attribute],\n                             .find(|& &(n, _, _)| name == n)\n                         .or_else(|| STABLE_REMOVED_FEATURES.iter()\n                             .find(|& &(n, _, _)| name == n)) {\n-                        span_err!(span_handler, mi.span, E0557, \"feature has been removed\");\n+                        feature_removed(span_handler, mi.span);\n                     }\n                     else if let Some(&(_, _, _)) = ACCEPTED_FEATURES.iter()\n                         .find(|& &(n, _, _)| name == n) {\n                         features.declared_stable_lang_features.push((name, mi.span));\n+                    } else if let Some(&edition) = ALL_EDITIONS.iter()\n+                                                              .find(|e| name == e.feature_name()) {\n+                        if edition <= crate_edition {\n+                            feature_removed(span_handler, mi.span);\n+                        } else {\n+                            for &(.., f_edition, set) in ACTIVE_FEATURES.iter() {\n+                                if let Some(f_edition) = f_edition {\n+                                    if edition >= f_edition {\n+                                        // FIXME(Manishearth) there is currently no way to set\n+                                        // lib features by edition\n+                                        set(&mut features, DUMMY_SP);\n+                                    }\n+                                }\n+                            }\n+                        }\n                     } else {\n                         features.declared_lib_features.push((name, mi.span));\n                     }"}]}