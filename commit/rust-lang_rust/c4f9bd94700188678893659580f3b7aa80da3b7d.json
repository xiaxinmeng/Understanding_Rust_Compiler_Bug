{"sha": "c4f9bd94700188678893659580f3b7aa80da3b7d", "node_id": "MDY6Q29tbWl0NzI0NzEyOmM0ZjliZDk0NzAwMTg4Njc4ODkzNjU5NTgwZjNiN2FhODBkYTNiN2Q=", "commit": {"author": {"name": "Eric Holk", "email": "eholk@mozilla.com", "date": "2011-06-14T01:19:08Z"}, "committer": {"name": "Eric Holk", "email": "eholk@mozilla.com", "date": "2011-06-16T01:16:59Z"}, "message": "Re-enabled join.", "tree": {"sha": "0d96a277405d57f1b8ddd52b5fbcbff6fd281be3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0d96a277405d57f1b8ddd52b5fbcbff6fd281be3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c4f9bd94700188678893659580f3b7aa80da3b7d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c4f9bd94700188678893659580f3b7aa80da3b7d", "html_url": "https://github.com/rust-lang/rust/commit/c4f9bd94700188678893659580f3b7aa80da3b7d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c4f9bd94700188678893659580f3b7aa80da3b7d/comments", "author": null, "committer": null, "parents": [{"sha": "1fa9133b76ec4641e5470cbea8a8f95ec32f9563", "url": "https://api.github.com/repos/rust-lang/rust/commits/1fa9133b76ec4641e5470cbea8a8f95ec32f9563", "html_url": "https://github.com/rust-lang/rust/commit/1fa9133b76ec4641e5470cbea8a8f95ec32f9563"}], "stats": {"total": 31, "additions": 26, "deletions": 5}, "files": [{"sha": "ecd648d33b543ad1316ceff9e4fb293ae7e8f625", "filename": "src/lib/task.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/c4f9bd94700188678893659580f3b7aa80da3b7d/src%2Flib%2Ftask.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4f9bd94700188678893659580f3b7aa80da3b7d/src%2Flib%2Ftask.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flib%2Ftask.rs?ref=c4f9bd94700188678893659580f3b7aa80da3b7d", "patch": "@@ -1,6 +1,7 @@\n native \"rust\" mod rustrt {\n     fn task_sleep(uint time_in_us);\n     fn task_yield();\n+    fn task_join(task t);\n }\n \n /**\n@@ -17,8 +18,7 @@ fn yield() {\n }\n \n fn join(task t) {\n-    // TODO: figure out how to pass tasks to the runtime and call the builtin\n-    // join.\n+    ret rustrt::task_join(t);\n }\n \n // Local Variables:"}, {"sha": "3500743a79ef287986d3016a3b4ec6c7a741da75", "filename": "src/rt/rust_builtin.cpp", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/c4f9bd94700188678893659580f3b7aa80da3b7d/src%2Frt%2Frust_builtin.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/c4f9bd94700188678893659580f3b7aa80da3b7d/src%2Frt%2Frust_builtin.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_builtin.cpp?ref=c4f9bd94700188678893659580f3b7aa80da3b7d", "patch": "@@ -361,7 +361,12 @@ task_yield(rust_task *task) {\n \n extern \"C\" CDECL void\n task_join(rust_task *task, rust_task *join_task) {\n-    // TODO\n+    // If the other task is already dying, we don't have to wait for it.\n+    if (join_task->dead() == false) {\n+        join_task->tasks_waiting_to_join.push(task);\n+        task->block(join_task, \"joining local task\");\n+        task->yield(2);\n+    }\n }\n \n /* Debug builtins for std.dbg. */"}, {"sha": "68a15e3b3a3fb21b5f0851da1fd2a1dca054790b", "filename": "src/rt/rust_upcall.cpp", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/c4f9bd94700188678893659580f3b7aa80da3b7d/src%2Frt%2Frust_upcall.cpp", "raw_url": "https://github.com/rust-lang/rust/raw/c4f9bd94700188678893659580f3b7aa80da3b7d/src%2Frt%2Frust_upcall.cpp", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frt%2Frust_upcall.cpp?ref=c4f9bd94700188678893659580f3b7aa80da3b7d", "patch": "@@ -509,8 +509,6 @@ upcall_new_task(rust_task *spawner, rust_vec *name) {\n     return task;\n }\n \n-// TODO: This is copied from rust_task.cpp. Both copies should be moved to a\n-// common location.\n static uintptr_t\n align_down(uintptr_t sp)\n {"}, {"sha": "78302145dd7ea0d35f8d140c6b7d0362b79aa33b", "filename": "src/test/run-pass/join.rs", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/c4f9bd94700188678893659580f3b7aa80da3b7d/src%2Ftest%2Frun-pass%2Fjoin.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c4f9bd94700188678893659580f3b7aa80da3b7d/src%2Ftest%2Frun-pass%2Fjoin.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-pass%2Fjoin.rs?ref=c4f9bd94700188678893659580f3b7aa80da3b7d", "patch": "@@ -0,0 +1,18 @@\n+// xfail-stage0\n+// -*- rust -*-\n+\n+use std;\n+\n+import std::task::*;\n+\n+fn main() {\n+  auto other = spawn child();\n+  log_err \"1\";\n+  yield();\n+  join(other);\n+  log_err \"3\";\n+}\n+\n+fn child() {\n+  log_err \"2\";\n+}"}]}