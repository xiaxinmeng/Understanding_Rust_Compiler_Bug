{"sha": "a17803127fdccecdf4a4c98a9e156c77479efcfa", "node_id": "MDY6Q29tbWl0NzI0NzEyOmExNzgwMzEyN2ZkY2NlY2RmNGE0Yzk4YTllMTU2Yzc3NDc5ZWZjZmE=", "commit": {"author": {"name": "Caleb Cartwright", "email": "caleb.cartwright@outlook.com", "date": "2020-08-09T18:59:52Z"}, "committer": {"name": "Caleb Cartwright", "email": "calebcartwright@users.noreply.github.com", "date": "2020-08-09T19:32:34Z"}, "message": "fix: inverted span on attrs within closure", "tree": {"sha": "04502445e0ab1107571511d0004f5d9d1d3119a8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/04502445e0ab1107571511d0004f5d9d1d3119a8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a17803127fdccecdf4a4c98a9e156c77479efcfa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a17803127fdccecdf4a4c98a9e156c77479efcfa", "html_url": "https://github.com/rust-lang/rust/commit/a17803127fdccecdf4a4c98a9e156c77479efcfa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a17803127fdccecdf4a4c98a9e156c77479efcfa/comments", "author": {"login": "calebcartwright", "id": 13042488, "node_id": "MDQ6VXNlcjEzMDQyNDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13042488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebcartwright", "html_url": "https://github.com/calebcartwright", "followers_url": "https://api.github.com/users/calebcartwright/followers", "following_url": "https://api.github.com/users/calebcartwright/following{/other_user}", "gists_url": "https://api.github.com/users/calebcartwright/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebcartwright/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebcartwright/subscriptions", "organizations_url": "https://api.github.com/users/calebcartwright/orgs", "repos_url": "https://api.github.com/users/calebcartwright/repos", "events_url": "https://api.github.com/users/calebcartwright/events{/privacy}", "received_events_url": "https://api.github.com/users/calebcartwright/received_events", "type": "User", "site_admin": false}, "committer": {"login": "calebcartwright", "id": 13042488, "node_id": "MDQ6VXNlcjEzMDQyNDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13042488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebcartwright", "html_url": "https://github.com/calebcartwright", "followers_url": "https://api.github.com/users/calebcartwright/followers", "following_url": "https://api.github.com/users/calebcartwright/following{/other_user}", "gists_url": "https://api.github.com/users/calebcartwright/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebcartwright/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebcartwright/subscriptions", "organizations_url": "https://api.github.com/users/calebcartwright/orgs", "repos_url": "https://api.github.com/users/calebcartwright/repos", "events_url": "https://api.github.com/users/calebcartwright/events{/privacy}", "received_events_url": "https://api.github.com/users/calebcartwright/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a88f0288b37a535502f855aa69a158959f268052", "url": "https://api.github.com/repos/rust-lang/rust/commits/a88f0288b37a535502f855aa69a158959f268052", "html_url": "https://github.com/rust-lang/rust/commit/a88f0288b37a535502f855aa69a158959f268052"}], "stats": {"total": 23, "additions": 20, "deletions": 3}, "files": [{"sha": "00bd03026e665722ddd95033292a506c95eb9662", "filename": "src/closures.rs", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/a17803127fdccecdf4a4c98a9e156c77479efcfa/src%2Fclosures.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a17803127fdccecdf4a4c98a9e156c77479efcfa/src%2Fclosures.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fclosures.rs?ref=a17803127fdccecdf4a4c98a9e156c77479efcfa", "patch": "@@ -155,8 +155,15 @@ fn rewrite_closure_with_block(\n         rules: ast::BlockCheckMode::Default,\n         span: body.span,\n     };\n-    let block =\n-        crate::expr::rewrite_block_with_visitor(context, \"\", &block, None, None, shape, false)?;\n+    let block = crate::expr::rewrite_block_with_visitor(\n+        context,\n+        \"\",\n+        &block,\n+        Some(&body.attrs),\n+        None,\n+        shape,\n+        false,\n+    )?;\n     Some(format!(\"{} {}\", prefix, block))\n }\n "}, {"sha": "2b28e1ac92cfb7579cf9dc9bcc0fc16b41336106", "filename": "src/expr.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/a17803127fdccecdf4a4c98a9e156c77479efcfa/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a17803127fdccecdf4a4c98a9e156c77479efcfa/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=a17803127fdccecdf4a4c98a9e156c77479efcfa", "patch": "@@ -525,7 +525,17 @@ pub(crate) fn rewrite_block_with_visitor(\n             let open_pos = snippet.find_uncommented(\"{\")?;\n             visitor.last_pos = block.span.lo() + BytePos(open_pos as u32)\n         }\n-        (ast::BlockCheckMode::Default, None) => visitor.last_pos = block.span.lo(),\n+        (ast::BlockCheckMode::Default, None) => {\n+            visitor.last_pos = block.span.lo();\n+            if let Some(attrs) = attrs {\n+                if let Some(first) = attrs.first() {\n+                    let first_lo_span = first.span.lo();\n+                    if first_lo_span < visitor.last_pos {\n+                        visitor.last_pos = first_lo_span;\n+                    }\n+                }\n+            }\n+        }\n     }\n \n     let inner_attrs = attrs.map(inner_attributes);"}]}