{"sha": "ecb8ac5cf41bcb20921df6be22caad07fb74136a", "node_id": "C_kwDOAAsO6NoAKGVjYjhhYzVjZjQxYmNiMjA5MjFkZjZiZTIyY2FhZDA3ZmI3NDEzNmE", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-08-16T12:54:20Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2022-08-16T12:54:20Z"}, "message": "make sure all builds are locked on CI", "tree": {"sha": "12d547e7a9d8d6ca8c6796533f976d34cb0fe75d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/12d547e7a9d8d6ca8c6796533f976d34cb0fe75d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/ecb8ac5cf41bcb20921df6be22caad07fb74136a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/ecb8ac5cf41bcb20921df6be22caad07fb74136a", "html_url": "https://github.com/rust-lang/rust/commit/ecb8ac5cf41bcb20921df6be22caad07fb74136a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/ecb8ac5cf41bcb20921df6be22caad07fb74136a/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "793f198b9d8c276f09ac30dbd1278ad0e1320839", "url": "https://api.github.com/repos/rust-lang/rust/commits/793f198b9d8c276f09ac30dbd1278ad0e1320839", "html_url": "https://github.com/rust-lang/rust/commit/793f198b9d8c276f09ac30dbd1278ad0e1320839"}], "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "51cec8fe161964cd01a8d31027582f5cb6f82630", "filename": "ci.sh", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/ecb8ac5cf41bcb20921df6be22caad07fb74136a/ci.sh", "raw_url": "https://github.com/rust-lang/rust/raw/ecb8ac5cf41bcb20921df6be22caad07fb74136a/ci.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/ci.sh?ref=ecb8ac5cf41bcb20921df6be22caad07fb74136a", "patch": "@@ -2,16 +2,18 @@\n set -euo pipefail\n set -x\n \n-# Determine configuration\n+# Determine configuration for installed build\n+echo \"Installing release version of Miri\"\n export RUSTFLAGS=\"-D warnings\"\n export CARGO_INCREMENTAL=0\n-\n-# Prepare\n-echo \"Build and install miri\"\n ./miri install # implicitly locked\n+\n+# Prepare debug build for direct `./miri` invocations\n+echo \"Building debug version of Miri\"\n+export CARGO_EXTRA_FLAGS=\"--locked\"\n ./miri check --no-default-features # make sure this can be built\n ./miri check --all-features # and this, too\n-./miri build --all-targets --locked # the build that all the `./miri test` below will use\n+./miri build --all-targets # the build that all the `./miri test` below will use\n echo\n \n # Test\n@@ -23,13 +25,13 @@ function run_tests {\n   fi\n \n   ## ui test suite\n-  ./miri test --locked\n+  ./miri test\n   if [ -z \"${MIRI_TEST_TARGET+exists}\" ]; then\n     # Only for host architecture: tests with optimizations (`-O` is what cargo passes, but crank MIR\n     # optimizations up all the way).\n     # Optimizations change diagnostics (mostly backtraces), so we don't check them\n     #FIXME(#2155): we want to only run the pass and panic tests here, not the fail tests.\n-    MIRIFLAGS=\"-O -Zmir-opt-level=4\" MIRI_SKIP_UI_CHECKS=1 ./miri test --locked -- tests/{pass,panic}\n+    MIRIFLAGS=\"-O -Zmir-opt-level=4\" MIRI_SKIP_UI_CHECKS=1 ./miri test -- tests/{pass,panic}\n   fi\n \n   ## test-cargo-miri\n@@ -70,7 +72,7 @@ function run_tests_minimal {\n     echo \"Testing MINIMAL host architecture: only testing $@\"\n   fi\n \n-  ./miri test --locked -- \"$@\"\n+  ./miri test -- \"$@\"\n }\n \n # host"}]}