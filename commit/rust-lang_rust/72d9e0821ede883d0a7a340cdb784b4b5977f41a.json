{"sha": "72d9e0821ede883d0a7a340cdb784b4b5977f41a", "node_id": "C_kwDOAAsO6NoAKDcyZDllMDgyMWVkZTg4M2QwYTdhMzQwY2RiNzg0YjRiNTk3N2Y0MWE", "commit": {"author": {"name": "Guillaume Gomez", "email": "guillaume1.gomez@gmail.com", "date": "2022-09-16T11:07:18Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-09-16T11:07:18Z"}, "message": "Rollup merge of #101843 - chenyukang:fix-101797, r=oli-obk\n\nSuggest associated const for incorrect use of let in traits\n\nFixes #101797", "tree": {"sha": "5c1c8dde9bb07ef4110e4b34377b0f5a48ae57f8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5c1c8dde9bb07ef4110e4b34377b0f5a48ae57f8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/72d9e0821ede883d0a7a340cdb784b4b5977f41a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjJFjmCRBK7hj4Ov3rIwAAUHoIAD7q9cEgZ4aAfnXmVpHLZG4F\nU9j3bljVW3WKlhsAppnlJUsqoSLbYReR8al9L3zz+W4cVEMYwtmLkbgJMfis48W6\nvJCwo5NDmieGQViSEpRi614K0fLt2ARl8t0H6lSLcfSpy9iNKOHxOYlDBm64ZNjR\nUCo6CZvHu8H5Zjd14TcwYhmc45cONQRoXP52yreRVcdM5ApYuw3R3StEmnkoWZ+H\nyF4MwI6FGPJvo6p2r9NeZB6XxKN9SX69Azta53T+YZIcdixW9Y+w7I/p2E7i459w\npnBmLRNf540hYGhAKe+bsSLfmB9v7SdLkbH2pRxIGE7ld3KXusXpX6t1qLJL5Hc=\n=xb5M\n-----END PGP SIGNATURE-----\n", "payload": "tree 5c1c8dde9bb07ef4110e4b34377b0f5a48ae57f8\nparent 8ba133fa7b7228eebdc7b3d6991ef168db45e492\nparent 4bf7d2ca913179e3d4c71871a112820624c1e379\nauthor Guillaume Gomez <guillaume1.gomez@gmail.com> 1663326438 +0200\ncommitter GitHub <noreply@github.com> 1663326438 +0200\n\nRollup merge of #101843 - chenyukang:fix-101797, r=oli-obk\n\nSuggest associated const for incorrect use of let in traits\n\nFixes #101797\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/72d9e0821ede883d0a7a340cdb784b4b5977f41a", "html_url": "https://github.com/rust-lang/rust/commit/72d9e0821ede883d0a7a340cdb784b4b5977f41a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/72d9e0821ede883d0a7a340cdb784b4b5977f41a/comments", "author": {"login": "GuillaumeGomez", "id": 3050060, "node_id": "MDQ6VXNlcjMwNTAwNjA=", "avatar_url": "https://avatars.githubusercontent.com/u/3050060?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeGomez", "html_url": "https://github.com/GuillaumeGomez", "followers_url": "https://api.github.com/users/GuillaumeGomez/followers", "following_url": "https://api.github.com/users/GuillaumeGomez/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeGomez/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeGomez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeGomez/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeGomez/orgs", "repos_url": "https://api.github.com/users/GuillaumeGomez/repos", "events_url": "https://api.github.com/users/GuillaumeGomez/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeGomez/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8ba133fa7b7228eebdc7b3d6991ef168db45e492", "url": "https://api.github.com/repos/rust-lang/rust/commits/8ba133fa7b7228eebdc7b3d6991ef168db45e492", "html_url": "https://github.com/rust-lang/rust/commit/8ba133fa7b7228eebdc7b3d6991ef168db45e492"}, {"sha": "4bf7d2ca913179e3d4c71871a112820624c1e379", "url": "https://api.github.com/repos/rust-lang/rust/commits/4bf7d2ca913179e3d4c71871a112820624c1e379", "html_url": "https://github.com/rust-lang/rust/commit/4bf7d2ca913179e3d4c71871a112820624c1e379"}], "stats": {"total": 47, "additions": 43, "deletions": 4}, "files": [{"sha": "e55b5ce71cded2766206c2786b623a72cf730333", "filename": "compiler/rustc_parse/src/parser/item.rs", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/72d9e0821ede883d0a7a340cdb784b4b5977f41a/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs", "raw_url": "https://github.com/rust-lang/rust/raw/72d9e0821ede883d0a7a340cdb784b4b5977f41a/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fitem.rs?ref=72d9e0821ede883d0a7a340cdb784b4b5977f41a", "patch": "@@ -698,11 +698,22 @@ impl<'a> Parser<'a> {\n                     let semicolon_span = self.token.span;\n                     // We have to bail or we'll potentially never make progress.\n                     let non_item_span = self.token.span;\n-                    self.consume_block(Delimiter::Brace, ConsumeClosingDelim::Yes);\n+                    let is_let = self.token.is_keyword(kw::Let);\n+\n                     let mut err = self.struct_span_err(non_item_span, \"non-item in item list\");\n-                    err.span_label(open_brace_span, \"item list starts here\")\n-                        .span_label(non_item_span, \"non-item starts here\")\n-                        .span_label(self.prev_token.span, \"item list ends here\");\n+                    self.consume_block(Delimiter::Brace, ConsumeClosingDelim::Yes);\n+                    if is_let {\n+                        err.span_suggestion(\n+                            non_item_span,\n+                            \"consider using `const` instead of `let` for associated const\",\n+                            \"const\",\n+                            Applicability::MachineApplicable,\n+                        );\n+                    } else {\n+                        err.span_label(open_brace_span, \"item list starts here\")\n+                            .span_label(non_item_span, \"non-item starts here\")\n+                            .span_label(self.prev_token.span, \"item list ends here\");\n+                    }\n                     if is_unnecessary_semicolon {\n                         err.span_suggestion(\n                             semicolon_span,"}, {"sha": "259f37b23a5845bc78580a65f7c33e2297d883ac", "filename": "src/test/ui/parser/suggest-assoc-const.fixed", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/72d9e0821ede883d0a7a340cdb784b4b5977f41a/src%2Ftest%2Fui%2Fparser%2Fsuggest-assoc-const.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/72d9e0821ede883d0a7a340cdb784b4b5977f41a/src%2Ftest%2Fui%2Fparser%2Fsuggest-assoc-const.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fsuggest-assoc-const.fixed?ref=72d9e0821ede883d0a7a340cdb784b4b5977f41a", "patch": "@@ -0,0 +1,10 @@\n+// Issue: 101797, Suggest associated const for incorrect use of let in traits\n+// run-rustfix\n+trait Trait {\n+    const _X: i32;\n+    //~^ ERROR non-item in item list\n+}\n+\n+fn main() {\n+\n+}"}, {"sha": "c7be712ec076e2efe894d8c3b7c9758b20fb0fbb", "filename": "src/test/ui/parser/suggest-assoc-const.rs", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/72d9e0821ede883d0a7a340cdb784b4b5977f41a/src%2Ftest%2Fui%2Fparser%2Fsuggest-assoc-const.rs", "raw_url": "https://github.com/rust-lang/rust/raw/72d9e0821ede883d0a7a340cdb784b4b5977f41a/src%2Ftest%2Fui%2Fparser%2Fsuggest-assoc-const.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fsuggest-assoc-const.rs?ref=72d9e0821ede883d0a7a340cdb784b4b5977f41a", "patch": "@@ -0,0 +1,10 @@\n+// Issue: 101797, Suggest associated const for incorrect use of let in traits\n+// run-rustfix\n+trait Trait {\n+    let _X: i32;\n+    //~^ ERROR non-item in item list\n+}\n+\n+fn main() {\n+\n+}"}, {"sha": "2ddfa07c5be4714af6666629ec69e38fe1c06ac1", "filename": "src/test/ui/parser/suggest-assoc-const.stderr", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/72d9e0821ede883d0a7a340cdb784b4b5977f41a/src%2Ftest%2Fui%2Fparser%2Fsuggest-assoc-const.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/72d9e0821ede883d0a7a340cdb784b4b5977f41a/src%2Ftest%2Fui%2Fparser%2Fsuggest-assoc-const.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Fsuggest-assoc-const.stderr?ref=72d9e0821ede883d0a7a340cdb784b4b5977f41a", "patch": "@@ -0,0 +1,8 @@\n+error: non-item in item list\n+  --> $DIR/suggest-assoc-const.rs:4:5\n+   |\n+LL |     let _X: i32;\n+   |     ^^^ help: consider using `const` instead of `let` for associated const: `const`\n+\n+error: aborting due to previous error\n+"}]}