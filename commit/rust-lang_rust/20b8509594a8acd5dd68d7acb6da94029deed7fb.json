{"sha": "20b8509594a8acd5dd68d7acb6da94029deed7fb", "node_id": "MDY6Q29tbWl0NzI0NzEyOjIwYjg1MDk1OTRhOGFjZDVkZDY4ZDdhY2I2ZGE5NDAyOWRlZWQ3ZmI=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-19T02:51:04Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2012-01-19T03:59:24Z"}, "message": "rustdoc: Add mod docs attrs to the doc tree", "tree": {"sha": "a8f8f27b1092b3ff536155ebe70801ad18139392", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a8f8f27b1092b3ff536155ebe70801ad18139392"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/20b8509594a8acd5dd68d7acb6da94029deed7fb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/20b8509594a8acd5dd68d7acb6da94029deed7fb", "html_url": "https://github.com/rust-lang/rust/commit/20b8509594a8acd5dd68d7acb6da94029deed7fb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/20b8509594a8acd5dd68d7acb6da94029deed7fb/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e39e34776e97073e3ef6f2ef4c226e73ba701fe7", "url": "https://api.github.com/repos/rust-lang/rust/commits/e39e34776e97073e3ef6f2ef4c226e73ba701fe7", "html_url": "https://github.com/rust-lang/rust/commit/e39e34776e97073e3ef6f2ef4c226e73ba701fe7"}], "stats": {"total": 59, "additions": 58, "deletions": 1}, "files": [{"sha": "3a90669df9079d680e30814241f50f317c45e3cd", "filename": "src/rustdoc/attr_parser.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/20b8509594a8acd5dd68d7acb6da94029deed7fb/src%2Frustdoc%2Fattr_parser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20b8509594a8acd5dd68d7acb6da94029deed7fb/src%2Frustdoc%2Fattr_parser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Fattr_parser.rs?ref=20b8509594a8acd5dd68d7acb6da94029deed7fb", "patch": "@@ -9,7 +9,7 @@ import rustc::syntax::ast;\n import rustc::front::attr;\n import core::tuple;\n \n-export crate_attrs, fn_attrs, arg_attrs;\n+export crate_attrs, mod_attrs, fn_attrs, arg_attrs;\n export parse_crate, parse_mod, parse_fn;\n \n type crate_attrs = {"}, {"sha": "42abc78b4d32ae1a77f6b108ae42d082b8ba0e98", "filename": "src/rustdoc/attr_pass.rs", "status": "modified", "additions": 56, "deletions": 0, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/20b8509594a8acd5dd68d7acb6da94029deed7fb/src%2Frustdoc%2Fattr_pass.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20b8509594a8acd5dd68d7acb6da94029deed7fb/src%2Frustdoc%2Fattr_pass.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Fattr_pass.rs?ref=20b8509594a8acd5dd68d7acb6da94029deed7fb", "patch": "@@ -26,6 +26,12 @@ fn run(\n         ) -> doc::cratedoc {\n             fold_crate(f, d)\n         },\n+        fold_mod: fn~(\n+            f: fold::fold<astsrv::srv>,\n+            d: doc::moddoc\n+        ) -> doc::moddoc {\n+            fold_mod(f, d)\n+        },\n         fold_fn: fn~(\n             f: fold::fold<astsrv::srv>,\n             d: doc::fndoc\n@@ -68,6 +74,56 @@ fn should_replace_top_module_name_with_crate_name() {\n     assert doc.topmod.name == \"bond\";\n }\n \n+fn fold_mod(fold: fold::fold<astsrv::srv>, doc: doc::moddoc) -> doc::moddoc {\n+    let srv = fold.ctxt;\n+    let attrs = if doc.id == ast::crate_node_id {\n+        // This is the top-level mod, use the crate attributes\n+        astsrv::exec(srv) {|ctxt|\n+            attr_parser::parse_mod(ctxt.ast.node.attrs)\n+        }\n+    } else {\n+        astsrv::exec(srv) {|ctxt|\n+            let attrs = alt ctxt.map.get(doc.id) {\n+              ast_map::node_item(item) { item.attrs }\n+            };\n+            attr_parser::parse_mod(attrs)\n+        }\n+    };\n+    let doc = fold::default_seq_fold_mod(fold, doc);\n+    ret merge_mod_attrs(doc, attrs);\n+\n+    fn merge_mod_attrs(\n+        doc: doc::moddoc,\n+        attrs: attr_parser::mod_attrs\n+    ) -> doc::moddoc {\n+        ~{\n+            brief: attrs.brief,\n+            desc: attrs.desc\n+            with *doc\n+        }\n+    }\n+}\n+\n+#[test]\n+fn fold_mod_should_extract_mod_attributes() {\n+    let source = \"#[doc = \\\"test\\\"] mod a { }\";\n+    let srv = astsrv::mk_srv_from_str(source);\n+    let doc = extract::from_srv(srv, \"\");\n+    let fold = fold::default_seq_fold(srv);\n+    let doc = fold_mod(fold, doc.topmod.mods[0]);\n+    assert doc.desc == some(\"test\");\n+}\n+\n+#[test]\n+fn fold_mod_should_extract_top_mod_attributes() {\n+    let source = \"#[doc = \\\"test\\\"];\";\n+    let srv = astsrv::mk_srv_from_str(source);\n+    let doc = extract::from_srv(srv, \"\");\n+    let fold = fold::default_seq_fold(srv);\n+    let doc = fold_mod(fold, doc.topmod);\n+    assert doc.desc == some(\"test\");\n+}\n+\n fn fold_fn(\n     fold: fold::fold<astsrv::srv>,\n     doc: doc::fndoc"}, {"sha": "7b52881414cb85cc04db9d696d2902ad910b2d6b", "filename": "src/rustdoc/fold.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/20b8509594a8acd5dd68d7acb6da94029deed7fb/src%2Frustdoc%2Ffold.rs", "raw_url": "https://github.com/rust-lang/rust/raw/20b8509594a8acd5dd68d7acb6da94029deed7fb/src%2Frustdoc%2Ffold.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Frustdoc%2Ffold.rs?ref=20b8509594a8acd5dd68d7acb6da94029deed7fb", "patch": "@@ -2,6 +2,7 @@ export fold;\n export fold_crate, fold_mod, fold_fn, fold_modlist, fold_fnlist;\n export default_seq_fold;\n export default_seq_fold_crate;\n+export default_seq_fold_mod;\n export default_seq_fold_fn;\n export default_seq_fold_fnlist;\n "}]}