{"sha": "624a9978e25c7c6cee7fd88afd1559f1f143fe4e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjYyNGE5OTc4ZTI1YzdjNmNlZTdmZDg4YWZkMTU1OWYxZjE0M2ZlNGU=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-02-19T11:49:52Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-02-19T11:49:52Z"}, "message": "Merge #3231\n\n3231: Add `remove_mut` assist r=matklad a=matklad\n\n\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "56160520062feb9d9b55e49051060bd3b2248ec7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/56160520062feb9d9b55e49051060bd3b2248ec7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/624a9978e25c7c6cee7fd88afd1559f1f143fe4e", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeTSDgCRBK7hj4Ov3rIwAAdHIIADuKocbIYopVYN7+40GH8QTt\nOrVFTmwbzXP4VXNRPLy6M/zGOQLxBVd7gMf0kZOXQ4SycHzIqabtfJTbQDLs6jzB\nMe8YJTu6i3HLhJw2CRIk546V4OmykS/0HbwETgGQorL8pL8y1ParHLQdImyi6Wwl\nI6p7GgOwq2OdSqqewDDEwSkaYW6GrXScRGOPtkKdRPYXQ5EZ2az/8ZOHO8rClFgw\nvyFReb4qT41Z5r7XR68b7MSmFPKbBeBT76xen2c4230a4OHaTpF3UnvXQNoPhTcX\nqXXS3hGaSDGZVv+pgWtKjMmzGgRB25n0L5mBX5ovYa8POjsWXnftOeZUZN5XnT4=\n=8T4r\n-----END PGP SIGNATURE-----\n", "payload": "tree 56160520062feb9d9b55e49051060bd3b2248ec7\nparent eb804261dce7f13056566377148a41f460feed28\nparent 312a7796105ae33f8f73e77291c0c4d46f6202d5\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1582112992 +0000\ncommitter GitHub <noreply@github.com> 1582112992 +0000\n\nMerge #3231\n\n3231: Add `remove_mut` assist r=matklad a=matklad\n\n\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/624a9978e25c7c6cee7fd88afd1559f1f143fe4e", "html_url": "https://github.com/rust-lang/rust/commit/624a9978e25c7c6cee7fd88afd1559f1f143fe4e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/624a9978e25c7c6cee7fd88afd1559f1f143fe4e/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eb804261dce7f13056566377148a41f460feed28", "url": "https://api.github.com/repos/rust-lang/rust/commits/eb804261dce7f13056566377148a41f460feed28", "html_url": "https://github.com/rust-lang/rust/commit/eb804261dce7f13056566377148a41f460feed28"}, {"sha": "312a7796105ae33f8f73e77291c0c4d46f6202d5", "url": "https://api.github.com/repos/rust-lang/rust/commits/312a7796105ae33f8f73e77291c0c4d46f6202d5", "html_url": "https://github.com/rust-lang/rust/commit/312a7796105ae33f8f73e77291c0c4d46f6202d5"}], "stats": {"total": 67, "additions": 67, "deletions": 0}, "files": [{"sha": "3f56dd5084ba6e68783e25731379486884439779", "filename": "crates/ra_assists/src/doc_tests/generated.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/624a9978e25c7c6cee7fd88afd1559f1f143fe4e/crates%2Fra_assists%2Fsrc%2Fdoc_tests%2Fgenerated.rs", "raw_url": "https://github.com/rust-lang/rust/raw/624a9978e25c7c6cee7fd88afd1559f1f143fe4e/crates%2Fra_assists%2Fsrc%2Fdoc_tests%2Fgenerated.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fdoc_tests%2Fgenerated.rs?ref=624a9978e25c7c6cee7fd88afd1559f1f143fe4e", "patch": "@@ -548,6 +548,23 @@ fn main() {\n     )\n }\n \n+#[test]\n+fn doctest_remove_mut() {\n+    check(\n+        \"remove_mut\",\n+        r#####\"\n+impl Walrus {\n+    fn feed(&mut<|> self, amount: u32) {}\n+}\n+\"#####,\n+        r#####\"\n+impl Walrus {\n+    fn feed(&self, amount: u32) {}\n+}\n+\"#####,\n+    )\n+}\n+\n #[test]\n fn doctest_replace_if_let_with_match() {\n     check("}, {"sha": "6884830eb614a6e152e44e7f272f2d33fbe4279a", "filename": "crates/ra_assists/src/handlers/remove_mut.rs", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/624a9978e25c7c6cee7fd88afd1559f1f143fe4e/crates%2Fra_assists%2Fsrc%2Fhandlers%2Fremove_mut.rs", "raw_url": "https://github.com/rust-lang/rust/raw/624a9978e25c7c6cee7fd88afd1559f1f143fe4e/crates%2Fra_assists%2Fsrc%2Fhandlers%2Fremove_mut.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fhandlers%2Fremove_mut.rs?ref=624a9978e25c7c6cee7fd88afd1559f1f143fe4e", "patch": "@@ -0,0 +1,32 @@\n+use ra_syntax::{SyntaxKind, TextRange, T};\n+\n+use crate::{Assist, AssistCtx, AssistId};\n+\n+// Assist: remove_mut\n+//\n+// Removes the `mut` keyword.\n+//\n+// ```\n+// impl Walrus {\n+//     fn feed(&mut<|> self, amount: u32) {}\n+// }\n+// ```\n+// ->\n+// ```\n+// impl Walrus {\n+//     fn feed(&self, amount: u32) {}\n+// }\n+// ```\n+pub(crate) fn remove_mut(ctx: AssistCtx) -> Option<Assist> {\n+    let mut_token = ctx.find_token_at_offset(T![mut])?;\n+    let delete_from = mut_token.text_range().start();\n+    let delete_to = match mut_token.next_token() {\n+        Some(it) if it.kind() == SyntaxKind::WHITESPACE => it.text_range().end(),\n+        _ => mut_token.text_range().end(),\n+    };\n+\n+    ctx.add_assist(AssistId(\"remove_mut\"), \"Remove `mut` keyword\", |edit| {\n+        edit.set_cursor(delete_from);\n+        edit.delete(TextRange::from_to(delete_from, delete_to));\n+    })\n+}"}, {"sha": "d7998b0d1a5ca04951877dc1f4b1b830eae38e16", "filename": "crates/ra_assists/src/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/624a9978e25c7c6cee7fd88afd1559f1f143fe4e/crates%2Fra_assists%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/624a9978e25c7c6cee7fd88afd1559f1f143fe4e/crates%2Fra_assists%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Flib.rs?ref=624a9978e25c7c6cee7fd88afd1559f1f143fe4e", "patch": "@@ -108,6 +108,7 @@ mod handlers {\n     mod introduce_variable;\n     mod inline_local_variable;\n     mod raw_string;\n+    mod remove_mut;\n     mod replace_if_let_with_match;\n     mod split_import;\n     mod remove_dbg;\n@@ -147,6 +148,7 @@ mod handlers {\n             raw_string::make_raw_string,\n             raw_string::make_usual_string,\n             raw_string::remove_hash,\n+            remove_mut::remove_mut,\n             early_return::convert_to_guarded_return,\n             auto_import::auto_import,\n         ]"}, {"sha": "9861332af8ba9146c529222cf934a9bdd4b4f50c", "filename": "docs/user/assists.md", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/624a9978e25c7c6cee7fd88afd1559f1f143fe4e/docs%2Fuser%2Fassists.md", "raw_url": "https://github.com/rust-lang/rust/raw/624a9978e25c7c6cee7fd88afd1559f1f143fe4e/docs%2Fuser%2Fassists.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fuser%2Fassists.md?ref=624a9978e25c7c6cee7fd88afd1559f1f143fe4e", "patch": "@@ -527,6 +527,22 @@ fn main() {\n }\n ```\n \n+## `remove_mut`\n+\n+Removes the `mut` keyword.\n+\n+```rust\n+// BEFORE\n+impl Walrus {\n+    fn feed(&mut\u2503 self, amount: u32) {}\n+}\n+\n+// AFTER\n+impl Walrus {\n+    fn feed(&self, amount: u32) {}\n+}\n+```\n+\n ## `replace_if_let_with_match`\n \n Replaces `if let` with an else branch with a `match` expression."}]}