{"sha": "d908ff1759bf27a8a8a99f113a246b8abc61f425", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQ5MDhmZjE3NTliZjI3YThhOGE5OWYxMTNhMjQ2YjhhYmM2MWY0MjU=", "commit": {"author": {"name": "Jeffrey Seyfried", "email": "jeffrey.seyfried@gmail.com", "date": "2016-02-26T20:31:00Z"}, "committer": {"name": "Jeffrey Seyfried", "email": "jeffrey.seyfried@gmail.com", "date": "2016-03-04T18:30:24Z"}, "message": "Don't treat associated types specially in `def_privacy`\n\nImprove trait privacy error message", "tree": {"sha": "4eecfcbd00829b7bf737174cb0436d9fe318a905", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/4eecfcbd00829b7bf737174cb0436d9fe318a905"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d908ff1759bf27a8a8a99f113a246b8abc61f425", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d908ff1759bf27a8a8a99f113a246b8abc61f425", "html_url": "https://github.com/rust-lang/rust/commit/d908ff1759bf27a8a8a99f113a246b8abc61f425", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d908ff1759bf27a8a8a99f113a246b8abc61f425/comments", "author": {"login": "jseyfried", "id": 8652869, "node_id": "MDQ6VXNlcjg2NTI4Njk=", "avatar_url": "https://avatars.githubusercontent.com/u/8652869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jseyfried", "html_url": "https://github.com/jseyfried", "followers_url": "https://api.github.com/users/jseyfried/followers", "following_url": "https://api.github.com/users/jseyfried/following{/other_user}", "gists_url": "https://api.github.com/users/jseyfried/gists{/gist_id}", "starred_url": "https://api.github.com/users/jseyfried/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jseyfried/subscriptions", "organizations_url": "https://api.github.com/users/jseyfried/orgs", "repos_url": "https://api.github.com/users/jseyfried/repos", "events_url": "https://api.github.com/users/jseyfried/events{/privacy}", "received_events_url": "https://api.github.com/users/jseyfried/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jseyfried", "id": 8652869, "node_id": "MDQ6VXNlcjg2NTI4Njk=", "avatar_url": "https://avatars.githubusercontent.com/u/8652869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jseyfried", "html_url": "https://github.com/jseyfried", "followers_url": "https://api.github.com/users/jseyfried/followers", "following_url": "https://api.github.com/users/jseyfried/following{/other_user}", "gists_url": "https://api.github.com/users/jseyfried/gists{/gist_id}", "starred_url": "https://api.github.com/users/jseyfried/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jseyfried/subscriptions", "organizations_url": "https://api.github.com/users/jseyfried/orgs", "repos_url": "https://api.github.com/users/jseyfried/repos", "events_url": "https://api.github.com/users/jseyfried/events{/privacy}", "received_events_url": "https://api.github.com/users/jseyfried/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "32f251cc1c1ff8721b68b4afe5f86a6bb33c6822", "url": "https://api.github.com/repos/rust-lang/rust/commits/32f251cc1c1ff8721b68b4afe5f86a6bb33c6822", "html_url": "https://github.com/rust-lang/rust/commit/32f251cc1c1ff8721b68b4afe5f86a6bb33c6822"}], "stats": {"total": 20, "additions": 7, "deletions": 13}, "files": [{"sha": "214ac81ee5092c3f306c498938f4b02807b33a06", "filename": "src/librustc_privacy/lib.rs", "status": "modified", "additions": 6, "deletions": 12, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/d908ff1759bf27a8a8a99f113a246b8abc61f425/src%2Flibrustc_privacy%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d908ff1759bf27a8a8a99f113a246b8abc61f425/src%2Flibrustc_privacy%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_privacy%2Flib.rs?ref=d908ff1759bf27a8a8a99f113a246b8abc61f425", "patch": "@@ -615,16 +615,10 @@ impl<'a, 'tcx> PrivacyVisitor<'a, 'tcx> {\n             // decision solely based on the privacy of the method\n             // invocation.\n             Some(ast_map::NodeImplItem(ii)) => {\n-                match ii.node {\n-                    hir::ImplItemKind::Const(..) |\n-                    hir::ImplItemKind::Method(..) => {\n-                        let imp = self.tcx.map.get_parent_did(node_id);\n-                        match self.tcx.impl_trait_ref(imp) {\n-                            Some(..) => hir::Public,\n-                            _ => ii.vis\n-                        }\n-                    }\n-                    hir::ImplItemKind::Type(_) => hir::Public,\n+                let imp = self.tcx.map.get_parent_did(node_id);\n+                match self.tcx.impl_trait_ref(imp) {\n+                    Some(..) => hir::Public,\n+                    _ => ii.vis,\n                 }\n             }\n             Some(ast_map::NodeTraitItem(_)) => hir::Public,\n@@ -804,8 +798,8 @@ impl<'a, 'tcx> PrivacyVisitor<'a, 'tcx> {\n             // Trait methods are always all public. The only controlling factor\n             // is whether the trait itself is accessible or not.\n             ty::TraitContainer(trait_def_id) => {\n-                self.report_error(self.ensure_public(span, trait_def_id,\n-                                                     None, \"source trait\"));\n+                let msg = format!(\"source trait `{}`\", self.tcx.item_path_str(trait_def_id));\n+                self.report_error(self.ensure_public(span, trait_def_id, None, &msg));\n             }\n         }\n     }"}, {"sha": "5feef0a24eb0e93a717f61d52b5608410a97ef03", "filename": "src/test/compile-fail/trait-not-accessible.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d908ff1759bf27a8a8a99f113a246b8abc61f425/src%2Ftest%2Fcompile-fail%2Ftrait-not-accessible.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d908ff1759bf27a8a8a99f113a246b8abc61f425/src%2Ftest%2Fcompile-fail%2Ftrait-not-accessible.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompile-fail%2Ftrait-not-accessible.rs?ref=d908ff1759bf27a8a8a99f113a246b8abc61f425", "patch": "@@ -20,7 +20,7 @@ struct S;\n impl m::Pub for S {}\n \n fn g<T: m::Pub>(arg: T) {\n-    arg.f(); //~ ERROR: source trait is private\n+    arg.f(); //~ ERROR: source trait `m::Priv` is private\n }\n \n fn main() {"}]}