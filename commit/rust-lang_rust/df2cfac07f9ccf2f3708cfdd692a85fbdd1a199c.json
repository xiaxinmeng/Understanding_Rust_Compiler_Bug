{"sha": "df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRmMmNmYWMwN2Y5Y2NmMmYzNzA4Y2ZkZDY5MmE4NWZiZGQxYTE5OWM=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-06-27T23:09:28Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-06-27T23:30:27Z"}, "message": "Move what's left of metadata::cwriter into middle::trans", "tree": {"sha": "f068399d517334f1aa8c01ee8d0e4e44bcab3c70", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f068399d517334f1aa8c01ee8d0e4e44bcab3c70"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c", "html_url": "https://github.com/rust-lang/rust/commit/df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "45efb1f02a8cd90bee590b006f53cea8b05b1331", "url": "https://api.github.com/repos/rust-lang/rust/commits/45efb1f02a8cd90bee590b006f53cea8b05b1331", "html_url": "https://github.com/rust-lang/rust/commit/45efb1f02a8cd90bee590b006f53cea8b05b1331"}], "stats": {"total": 32, "additions": 17, "deletions": 15}, "files": [{"sha": "e317ade16606b8a8a96691fa23b8b4c286f9ea47", "filename": "src/comp/back/link.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c/src%2Fcomp%2Fback%2Flink.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c/src%2Fcomp%2Fback%2Flink.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fback%2Flink.rs?ref=df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c", "patch": "@@ -3,7 +3,6 @@ import driver::session;\n import lib::llvm::llvm;\n import middle::trans;\n import middle::ty;\n-import metadata::cwriter;\n import std::str;\n import std::fs;\n import std::vec;"}, {"sha": "9956a46c828c4df6108d35d03730c234c557ba7b", "filename": "src/comp/metadata/cwriter.rs", "status": "modified", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c/src%2Fcomp%2Fmetadata%2Fcwriter.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c/src%2Fcomp%2Fmetadata%2Fcwriter.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmetadata%2Fcwriter.rs?ref=df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c", "patch": "@@ -15,16 +15,6 @@ fn C_postr(&str s) -> ValueRef {\n     ret llvm::LLVMConstString(str::buf(s), str::byte_len(s), False);\n }\n \n-fn write_metadata(&@trans::crate_ctxt cx, &@crate crate) {\n-    if (!cx.sess.get_opts().shared) { ret; }\n-    auto llmeta = C_postr(encoder::encode_metadata(cx, crate));\n-    auto llconst = trans::C_struct([llmeta]);\n-    auto llglobal =\n-        llvm::LLVMAddGlobal(cx.llmod, trans::val_ty(llconst),\n-                            str::buf(\"rust_metadata\"));\n-    llvm::LLVMSetInitializer(llglobal, llconst);\n-    llvm::LLVMSetSection(llglobal, str::buf(x86::get_meta_sect_name()));\n-}\n \n //\n // Local Variables:"}, {"sha": "2025c6e0e8b10c7687bffa208fe248cfeb0bbfda", "filename": "src/comp/middle/trans.rs", "status": "modified", "additions": 17, "deletions": 2, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c/src%2Fcomp%2Fmiddle%2Ftrans.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c/src%2Fcomp%2Fmiddle%2Ftrans.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Ftrans.rs?ref=df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c", "patch": "@@ -67,7 +67,6 @@ import link::crate_meta_vers;\n import link::crate_meta_extras_hash;\n import metadata::tyencode;\n import metadata::creader;\n-import metadata::cwriter;\n import metadata::decoder;\n import pretty::ppaux::ty_to_str;\n import pretty::ppaux::ty_to_short_str;\n@@ -1041,6 +1040,11 @@ fn C_str(&@crate_ctxt cx, &str s) -> ValueRef {\n     ret llvm::LLVMConstPointerCast(g, T_ptr(T_str()));\n }\n \n+// Returns a Plain Old LLVM String:\n+fn C_postr(&str s) -> ValueRef {\n+    ret llvm::LLVMConstString(str::buf(s), str::byte_len(s), False);\n+}\n+\n fn C_zero_byte_arr(uint size) -> ValueRef {\n     auto i = 0u;\n     let vec[ValueRef] elts = [];\n@@ -8386,6 +8390,17 @@ fn create_crate_map(&@crate_ctxt ccx) -> ValueRef {\n     ret map;\n }\n \n+fn write_metadata(&@trans::crate_ctxt cx, &@ast::crate crate) {\n+    if (!cx.sess.get_opts().shared) { ret; }\n+    auto llmeta = C_postr(metadata::encoder::encode_metadata(cx, crate));\n+    auto llconst = trans::C_struct([llmeta]);\n+    auto llglobal =\n+        llvm::LLVMAddGlobal(cx.llmod, trans::val_ty(llconst),\n+                            str::buf(\"rust_metadata\"));\n+    llvm::LLVMSetInitializer(llglobal, llconst);\n+    llvm::LLVMSetSection(llglobal, str::buf(x86::get_meta_sect_name()));\n+}\n+\n fn trans_crate(&session::session sess, &@ast::crate crate, &ty::ctxt tcx,\n                &str output, &ast_map::map amap) -> ModuleRef {\n     auto llmod =\n@@ -8452,7 +8467,7 @@ fn trans_crate(&session::session sess, &@ast::crate crate, &ty::ctxt tcx,\n     emit_tydescs(ccx);\n     // Translate the metadata:\n \n-    cwriter::write_metadata(cx.ccx, crate);\n+    write_metadata(cx.ccx, crate);\n     if (ccx.sess.get_opts().stats) {\n         log_err \"--- trans stats ---\";\n         log_err #fmt(\"n_static_tydescs: %u\", ccx.stats.n_static_tydescs);"}, {"sha": "de589a10d9b27e09b5311fa183bbf611a531b76a", "filename": "src/comp/middle/ty.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c/src%2Fcomp%2Fmiddle%2Fty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c/src%2Fcomp%2Fmiddle%2Fty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Fmiddle%2Fty.rs?ref=df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c", "patch": "@@ -18,7 +18,6 @@ import front::ast::constr_arg_general;\n import front::ast::mutability;\n import front::ast::controlflow;\n import metadata::creader;\n-import metadata::cwriter;\n import metadata::decoder;\n import util::common::*;\n import util::data::interner;"}, {"sha": "1527479252e5d6a00a535a285cbcf15d1c597edc", "filename": "src/comp/rustc.rc", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c/src%2Fcomp%2Frustc.rc", "raw_url": "https://github.com/rust-lang/rust/raw/df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c/src%2Fcomp%2Frustc.rc", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fcomp%2Frustc.rc?ref=df2cfac07f9ccf2f3708cfdd692a85fbdd1a199c", "patch": "@@ -69,7 +69,6 @@ mod metadata {\n     mod encoder;\n     mod decoder;\n     mod creader;\n-    mod cwriter;\n }\n \n mod driver {"}]}