{"sha": "da0ceeff5a7839427c751cf056e16e67217b12ea", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRhMGNlZWZmNWE3ODM5NDI3Yzc1MWNmMDU2ZTE2ZTY3MjE3YjEyZWE=", "commit": {"author": {"name": "Dirkjan Ochtman", "email": "dirkjan@ochtman.nl", "date": "2018-04-01T14:55:25Z"}, "committer": {"name": "Dirkjan Ochtman", "email": "dirkjan@ochtman.nl", "date": "2018-04-03T15:12:59Z"}, "message": "Introduce Vec::resize_with method (see #41758)", "tree": {"sha": "c6dae9994e5f572df325f03510461ad72da5a1d6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c6dae9994e5f572df325f03510461ad72da5a1d6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/da0ceeff5a7839427c751cf056e16e67217b12ea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/da0ceeff5a7839427c751cf056e16e67217b12ea", "html_url": "https://github.com/rust-lang/rust/commit/da0ceeff5a7839427c751cf056e16e67217b12ea", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/da0ceeff5a7839427c751cf056e16e67217b12ea/comments", "author": {"login": "djc", "id": 158471, "node_id": "MDQ6VXNlcjE1ODQ3MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/158471?v=4", "gravatar_id": "", "url": "https://api.github.com/users/djc", "html_url": "https://github.com/djc", "followers_url": "https://api.github.com/users/djc/followers", "following_url": "https://api.github.com/users/djc/following{/other_user}", "gists_url": "https://api.github.com/users/djc/gists{/gist_id}", "starred_url": "https://api.github.com/users/djc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/djc/subscriptions", "organizations_url": "https://api.github.com/users/djc/orgs", "repos_url": "https://api.github.com/users/djc/repos", "events_url": "https://api.github.com/users/djc/events{/privacy}", "received_events_url": "https://api.github.com/users/djc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "djc", "id": 158471, "node_id": "MDQ6VXNlcjE1ODQ3MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/158471?v=4", "gravatar_id": "", "url": "https://api.github.com/users/djc", "html_url": "https://github.com/djc", "followers_url": "https://api.github.com/users/djc/followers", "following_url": "https://api.github.com/users/djc/following{/other_user}", "gists_url": "https://api.github.com/users/djc/gists{/gist_id}", "starred_url": "https://api.github.com/users/djc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/djc/subscriptions", "organizations_url": "https://api.github.com/users/djc/orgs", "repos_url": "https://api.github.com/users/djc/repos", "events_url": "https://api.github.com/users/djc/events{/privacy}", "received_events_url": "https://api.github.com/users/djc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "135f334e0a3177146f7417cee7ceaf405ffe732d", "url": "https://api.github.com/repos/rust-lang/rust/commits/135f334e0a3177146f7417cee7ceaf405ffe732d", "html_url": "https://github.com/rust-lang/rust/commit/135f334e0a3177146f7417cee7ceaf405ffe732d"}], "stats": {"total": 64, "additions": 57, "deletions": 7}, "files": [{"sha": "0fd4178bd95f1c6d5bc2d4b490968d09d5972c82", "filename": "src/liballoc/vec.rs", "status": "modified", "additions": 57, "deletions": 7, "changes": 64, "blob_url": "https://github.com/rust-lang/rust/blob/da0ceeff5a7839427c751cf056e16e67217b12ea/src%2Fliballoc%2Fvec.rs", "raw_url": "https://github.com/rust-lang/rust/raw/da0ceeff5a7839427c751cf056e16e67217b12ea/src%2Fliballoc%2Fvec.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fliballoc%2Fvec.rs?ref=da0ceeff5a7839427c751cf056e16e67217b12ea", "patch": "@@ -1306,6 +1306,49 @@ impl<T> Vec<T> {\n         }\n         other\n     }\n+\n+    /// Resizes the `Vec` in-place so that `len` is equal to `new_len`.\n+    ///\n+    /// If `new_len` is greater than `len`, the `Vec` is extended by the\n+    /// difference, with each additional slot filled with the result of\n+    /// calling the closure `f`. The return values from `f` will end up\n+    /// in the `Vec` in the order they have been generated.\n+    ///\n+    /// If `new_len` is less than `len`, the `Vec` is simply truncated.\n+    ///\n+    /// This method uses a closure to create new values on every push. If\n+    /// you'd rather [`Clone`] a given value, use [`resize`]. If you want\n+    /// to use the [`Default`] trait to generate values, you can pass\n+    /// [`Default::default()`] as the second argument..\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(vec_resize_with)]\n+    ///\n+    /// let mut vec = vec![1, 2, 3];\n+    /// vec.resize_with(5, Default::default);\n+    /// assert_eq!(vec, [1, 2, 3, 0, 0]);\n+    ///\n+    /// let mut vec = vec![];\n+    /// let mut p = 1;\n+    /// vec.resize_with(4, || { p *= 2; p });\n+    /// assert_eq!(vec, [2, 4, 8, 16]);\n+    /// ```\n+    ///\n+    /// [`resize`]: #method.resize\n+    /// [`Clone`]: ../../std/clone/trait.Clone.html\n+    #[unstable(feature = \"vec_resize_with\", issue = \"41758\")]\n+    pub fn resize_with<F>(&mut self, new_len: usize, f: F)\n+        where F: FnMut() -> T\n+    {\n+        let len = self.len();\n+        if new_len > len {\n+            self.extend_with(new_len - len, ExtendFunc(f));\n+        } else {\n+            self.truncate(new_len);\n+        }\n+    }\n }\n \n impl<T: Clone> Vec<T> {\n@@ -1316,8 +1359,8 @@ impl<T: Clone> Vec<T> {\n     /// If `new_len` is less than `len`, the `Vec` is simply truncated.\n     ///\n     /// This method requires [`Clone`] to be able clone the passed value. If\n-    /// you'd rather create a value with [`Default`] instead, see\n-    /// [`resize_default`].\n+    /// you need more flexibility (or want to rely on [`Default`] instead of\n+    /// [`Clone`]), use [`resize_with`].\n     ///\n     /// # Examples\n     ///\n@@ -1333,7 +1376,7 @@ impl<T: Clone> Vec<T> {\n     ///\n     /// [`Clone`]: ../../std/clone/trait.Clone.html\n     /// [`Default`]: ../../std/default/trait.Default.html\n-    /// [`resize_default`]: #method.resize_default\n+    /// [`resize_with`]: #method.resize_with\n     #[stable(feature = \"vec_resize\", since = \"1.5.0\")]\n     pub fn resize(&mut self, new_len: usize, value: T) {\n         let len = self.len();\n@@ -1412,24 +1455,31 @@ impl<T: Default> Vec<T> {\n \n // This code generalises `extend_with_{element,default}`.\n trait ExtendWith<T> {\n-    fn next(&self) -> T;\n+    fn next(&mut self) -> T;\n     fn last(self) -> T;\n }\n \n struct ExtendElement<T>(T);\n impl<T: Clone> ExtendWith<T> for ExtendElement<T> {\n-    fn next(&self) -> T { self.0.clone() }\n+    fn next(&mut self) -> T { self.0.clone() }\n     fn last(self) -> T { self.0 }\n }\n \n struct ExtendDefault;\n impl<T: Default> ExtendWith<T> for ExtendDefault {\n-    fn next(&self) -> T { Default::default() }\n+    fn next(&mut self) -> T { Default::default() }\n     fn last(self) -> T { Default::default() }\n }\n+\n+struct ExtendFunc<F>(F);\n+impl<T, F: FnMut() -> T> ExtendWith<T> for ExtendFunc<F> {\n+    fn next(&mut self) -> T { (self.0)() }\n+    fn last(mut self) -> T { (self.0)() }\n+}\n+\n impl<T> Vec<T> {\n     /// Extend the vector by `n` values, using the given generator.\n-    fn extend_with<E: ExtendWith<T>>(&mut self, n: usize, value: E) {\n+    fn extend_with<E: ExtendWith<T>>(&mut self, n: usize, mut value: E) {\n         self.reserve(n);\n \n         unsafe {"}]}