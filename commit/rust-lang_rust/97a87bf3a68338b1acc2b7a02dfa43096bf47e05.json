{"sha": "97a87bf3a68338b1acc2b7a02dfa43096bf47e05", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk3YTg3YmYzYTY4MzM4YjFhY2MyYjdhMDJkZmE0MzA5NmJmNDdlMDU=", "commit": {"author": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-03-12T10:23:47Z"}, "committer": {"name": "bors[bot]", "email": "bors[bot]@users.noreply.github.com", "date": "2019-03-12T10:23:47Z"}, "message": "Merge #959\n\n959: Retrieve current working directory from workspace r=matklad a=LDSpits\n\nThis PR improves the way the language client retrieves the current working directory by using the VSCode workspace API to get the path to the currently open directory.\r\n\r\nIf we find more than one directory we show a warning that \"multi root workspaces are not supported yet\" and pick the root path.\r\n\r\nAny feedback is appreciated \ud83d\ude04\r\n\r\nfixes #945\n\nCo-authored-by: Lucas Spits <spits.lucas@gmail.com>", "tree": {"sha": "1f61d8ba63823f243486f1a0a70c38f244ea9760", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1f61d8ba63823f243486f1a0a70c38f244ea9760"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/97a87bf3a68338b1acc2b7a02dfa43096bf47e05", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/97a87bf3a68338b1acc2b7a02dfa43096bf47e05", "html_url": "https://github.com/rust-lang/rust/commit/97a87bf3a68338b1acc2b7a02dfa43096bf47e05", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/97a87bf3a68338b1acc2b7a02dfa43096bf47e05/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "parents": [{"sha": "65a9066115f3d2d150b4fcb46c1db65b2ac91832", "url": "https://api.github.com/repos/rust-lang/rust/commits/65a9066115f3d2d150b4fcb46c1db65b2ac91832", "html_url": "https://github.com/rust-lang/rust/commit/65a9066115f3d2d150b4fcb46c1db65b2ac91832"}, {"sha": "9fe3b36bdae52dabecc3989161162fc6d2a3dccb", "url": "https://api.github.com/repos/rust-lang/rust/commits/9fe3b36bdae52dabecc3989161162fc6d2a3dccb", "html_url": "https://github.com/rust-lang/rust/commit/9fe3b36bdae52dabecc3989161162fc6d2a3dccb"}], "stats": {"total": 18, "additions": 16, "deletions": 2}, "files": [{"sha": "f319f148a341fe624327dd28859709e74e0df2ad", "filename": "editors/code/src/server.ts", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/97a87bf3a68338b1acc2b7a02dfa43096bf47e05/editors%2Fcode%2Fsrc%2Fserver.ts", "raw_url": "https://github.com/rust-lang/rust/raw/97a87bf3a68338b1acc2b7a02dfa43096bf47e05/editors%2Fcode%2Fsrc%2Fserver.ts", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/editors%2Fcode%2Fsrc%2Fserver.ts?ref=97a87bf3a68338b1acc2b7a02dfa43096bf47e05", "patch": "@@ -1,6 +1,6 @@\n import * as lc from 'vscode-languageclient';\n \n-import { window } from 'vscode';\n+import { window, workspace } from 'vscode';\n import { Config } from './config';\n import { Highlighter } from './highlighting';\n \n@@ -12,9 +12,23 @@ export class Server {\n     public static start(\n         notificationHandlers: Iterable<[string, lc.GenericNotificationHandler]>\n     ) {\n+        // '.' Is the fallback if no folder is open\n+        // TODO?: Workspace folders support Uri's (eg: file://test.txt). It might be a good idea to test if the uri points to a file.\n+        let folder: string = '.';\n+        if (workspace.workspaceFolders !== undefined) {\n+            folder = workspace.workspaceFolders[0].uri.fsPath.toString();\n+\n+            if (workspace.workspaceFolders.length > 1) {\n+                // Tell the user that we do not support multi-root workspaces yet\n+                window.showWarningMessage(\n+                    'Multi-root workspaces are not currently supported'\n+                );\n+            }\n+        }\n+\n         const run: lc.Executable = {\n             command: this.config.raLspServerPath,\n-            options: { cwd: '.' }\n+            options: { cwd: folder }\n         };\n         const serverOptions: lc.ServerOptions = {\n             run,"}]}