{"sha": "05b4fc6d79060fc3120f92b01119e3a851c37829", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA1YjRmYzZkNzkwNjBmYzMxMjBmOTJiMDExMTllM2E4NTFjMzc4Mjk=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2020-03-11T13:29:36Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2020-03-11T13:29:36Z"}, "message": "Merge #3558\n\n3558: Fix parsing of stement-ish binary expressions r=matklad a=matklad\n\ncloses #3512\n\n\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>", "tree": {"sha": "d67482ef3c3c231e4c0a1f9a8641548ddf7974fc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/d67482ef3c3c231e4c0a1f9a8641548ddf7974fc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/05b4fc6d79060fc3120f92b01119e3a851c37829", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJeaOfACRBK7hj4Ov3rIwAAdHIIAI6mAQ5p622iBkehFq3SPPdX\npGLkgR52os89hi7vfh9y4bNqmN5dg6PMZvvgbh0QKyMXRK87TdeB/oQOqvYYsHlJ\no+lNTo/EAuEp5tBlZWds3aoF0k8jNCc6fO6aTLD4VogYweAHIJy52YS7z2U0teIY\ndEuoAZc3I718OgY4G2UkBcUniiSOteHmLmaQUDLzY7z0UuEvP1Gp28CCoOMTzXTl\nIePpQD1U1s6p64koYQsFtSoMRtDnvOIW+wjE7E1G/1CiCD7WFxBl22q+6y+/MJcp\nMditPKKTg3ziBJa6fKmUp6zHxvqdSCF8o1G3Tuapy7orOYFq01ULoMAvjAv6m4M=\n=BfJc\n-----END PGP SIGNATURE-----\n", "payload": "tree d67482ef3c3c231e4c0a1f9a8641548ddf7974fc\nparent bddf6b5266997dd7e017fcb963e54a86b68afbaa\nparent 4a745cc8cfab4e9d08a2e513228ce13e33d92a9e\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1583933376 +0000\ncommitter GitHub <noreply@github.com> 1583933376 +0000\n\nMerge #3558\n\n3558: Fix parsing of stement-ish binary expressions r=matklad a=matklad\n\ncloses #3512\n\n\n\nbors r+\n\ud83e\udd16\n\nCo-authored-by: Aleksey Kladov <aleksey.kladov@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/05b4fc6d79060fc3120f92b01119e3a851c37829", "html_url": "https://github.com/rust-lang/rust/commit/05b4fc6d79060fc3120f92b01119e3a851c37829", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/05b4fc6d79060fc3120f92b01119e3a851c37829/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bddf6b5266997dd7e017fcb963e54a86b68afbaa", "url": "https://api.github.com/repos/rust-lang/rust/commits/bddf6b5266997dd7e017fcb963e54a86b68afbaa", "html_url": "https://github.com/rust-lang/rust/commit/bddf6b5266997dd7e017fcb963e54a86b68afbaa"}, {"sha": "4a745cc8cfab4e9d08a2e513228ce13e33d92a9e", "url": "https://api.github.com/repos/rust-lang/rust/commits/4a745cc8cfab4e9d08a2e513228ce13e33d92a9e", "html_url": "https://github.com/rust-lang/rust/commit/4a745cc8cfab4e9d08a2e513228ce13e33d92a9e"}], "stats": {"total": 51, "additions": 49, "deletions": 2}, "files": [{"sha": "0c170ac5ec2092e49b497b51aef18f65b6fb9472", "filename": "crates/ra_parser/src/grammar/expressions.rs", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/05b4fc6d79060fc3120f92b01119e3a851c37829/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/05b4fc6d79060fc3120f92b01119e3a851c37829/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_parser%2Fsrc%2Fgrammar%2Fexpressions.rs?ref=05b4fc6d79060fc3120f92b01119e3a851c37829", "patch": "@@ -278,7 +278,7 @@ fn current_op(p: &Parser) -> (u8, SyntaxKind) {\n }\n \n // Parses expression with binding power of at least bp.\n-fn expr_bp(p: &mut Parser, r: Restrictions, bp: u8) -> (Option<CompletedMarker>, BlockLike) {\n+fn expr_bp(p: &mut Parser, mut r: Restrictions, bp: u8) -> (Option<CompletedMarker>, BlockLike) {\n     let mut lhs = match lhs(p, r) {\n         Some((lhs, blocklike)) => {\n             // test stmt_bin_expr_ambiguity\n@@ -311,6 +311,12 @@ fn expr_bp(p: &mut Parser, r: Restrictions, bp: u8) -> (Option<CompletedMarker>,\n         let m = lhs.precede(p);\n         p.bump(op);\n \n+        // test binop_resets_statementness\n+        // fn foo() {\n+        //     v = {1}&2;\n+        // }\n+        r = Restrictions { prefer_stmt: false, ..r };\n+\n         if is_range {\n             // test postfix_range\n             // fn foo() {\n@@ -327,7 +333,7 @@ fn expr_bp(p: &mut Parser, r: Restrictions, bp: u8) -> (Option<CompletedMarker>,\n             }\n         }\n \n-        expr_bp(p, r, op_bp + 1);\n+        expr_bp(p, Restrictions { prefer_stmt: false, ..r }, op_bp + 1);\n         lhs = m.complete(p, if is_range { RANGE_EXPR } else { BIN_EXPR });\n     }\n     (Some(lhs), BlockLike::NotBlock)"}, {"sha": "05acc30f126d9cea4015429a5be500e0b334467b", "filename": "crates/ra_syntax/test_data/parser/inline/ok/0158_binop_resets_statementness.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/05b4fc6d79060fc3120f92b01119e3a851c37829/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0158_binop_resets_statementness.rs", "raw_url": "https://github.com/rust-lang/rust/raw/05b4fc6d79060fc3120f92b01119e3a851c37829/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0158_binop_resets_statementness.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0158_binop_resets_statementness.rs?ref=05b4fc6d79060fc3120f92b01119e3a851c37829", "patch": "@@ -0,0 +1,3 @@\n+fn foo() {\n+    v = {1}&2;\n+}"}, {"sha": "d568a1d457b268393c7f14c126c1d5f270e62bc6", "filename": "crates/ra_syntax/test_data/parser/inline/ok/0158_binop_resets_statementness.txt", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/05b4fc6d79060fc3120f92b01119e3a851c37829/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0158_binop_resets_statementness.txt", "raw_url": "https://github.com/rust-lang/rust/raw/05b4fc6d79060fc3120f92b01119e3a851c37829/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0158_binop_resets_statementness.txt", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_syntax%2Ftest_data%2Fparser%2Finline%2Fok%2F0158_binop_resets_statementness.txt?ref=05b4fc6d79060fc3120f92b01119e3a851c37829", "patch": "@@ -0,0 +1,38 @@\n+SOURCE_FILE@[0; 28)\n+  FN_DEF@[0; 27)\n+    FN_KW@[0; 2) \"fn\"\n+    WHITESPACE@[2; 3) \" \"\n+    NAME@[3; 6)\n+      IDENT@[3; 6) \"foo\"\n+    PARAM_LIST@[6; 8)\n+      L_PAREN@[6; 7) \"(\"\n+      R_PAREN@[7; 8) \")\"\n+    WHITESPACE@[8; 9) \" \"\n+    BLOCK_EXPR@[9; 27)\n+      BLOCK@[9; 27)\n+        L_CURLY@[9; 10) \"{\"\n+        WHITESPACE@[10; 15) \"\\n    \"\n+        EXPR_STMT@[15; 25)\n+          BIN_EXPR@[15; 24)\n+            PATH_EXPR@[15; 16)\n+              PATH@[15; 16)\n+                PATH_SEGMENT@[15; 16)\n+                  NAME_REF@[15; 16)\n+                    IDENT@[15; 16) \"v\"\n+            WHITESPACE@[16; 17) \" \"\n+            EQ@[17; 18) \"=\"\n+            WHITESPACE@[18; 19) \" \"\n+            BIN_EXPR@[19; 24)\n+              BLOCK_EXPR@[19; 22)\n+                BLOCK@[19; 22)\n+                  L_CURLY@[19; 20) \"{\"\n+                  LITERAL@[20; 21)\n+                    INT_NUMBER@[20; 21) \"1\"\n+                  R_CURLY@[21; 22) \"}\"\n+              AMP@[22; 23) \"&\"\n+              LITERAL@[23; 24)\n+                INT_NUMBER@[23; 24) \"2\"\n+          SEMI@[24; 25) \";\"\n+        WHITESPACE@[25; 26) \"\\n\"\n+        R_CURLY@[26; 27) \"}\"\n+  WHITESPACE@[27; 28) \"\\n\""}]}