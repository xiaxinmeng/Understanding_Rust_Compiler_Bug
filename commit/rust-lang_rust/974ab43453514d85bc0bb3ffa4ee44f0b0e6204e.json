{"sha": "974ab43453514d85bc0bb3ffa4ee44f0b0e6204e", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk3NGFiNDM0NTM1MTRkODViYzBiYjNmZmE0ZWU0NGYwYjBlNjIwNGU=", "commit": {"author": {"name": "Seo Sanghyeon", "email": "sanxiyn@gmail.com", "date": "2015-12-11T07:28:05Z"}, "committer": {"name": "Seo Sanghyeon", "email": "sanxiyn@gmail.com", "date": "2015-12-11T07:28:05Z"}, "message": "Use suggestion for needless_return", "tree": {"sha": "242ef4b8848669aa2478c6d0b693740a4fcfe401", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/242ef4b8848669aa2478c6d0b693740a4fcfe401"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/974ab43453514d85bc0bb3ffa4ee44f0b0e6204e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/974ab43453514d85bc0bb3ffa4ee44f0b0e6204e", "html_url": "https://github.com/rust-lang/rust/commit/974ab43453514d85bc0bb3ffa4ee44f0b0e6204e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/974ab43453514d85bc0bb3ffa4ee44f0b0e6204e/comments", "author": {"login": "sanxiyn", "id": 45249, "node_id": "MDQ6VXNlcjQ1MjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/45249?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sanxiyn", "html_url": "https://github.com/sanxiyn", "followers_url": "https://api.github.com/users/sanxiyn/followers", "following_url": "https://api.github.com/users/sanxiyn/following{/other_user}", "gists_url": "https://api.github.com/users/sanxiyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/sanxiyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sanxiyn/subscriptions", "organizations_url": "https://api.github.com/users/sanxiyn/orgs", "repos_url": "https://api.github.com/users/sanxiyn/repos", "events_url": "https://api.github.com/users/sanxiyn/events{/privacy}", "received_events_url": "https://api.github.com/users/sanxiyn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sanxiyn", "id": 45249, "node_id": "MDQ6VXNlcjQ1MjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/45249?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sanxiyn", "html_url": "https://github.com/sanxiyn", "followers_url": "https://api.github.com/users/sanxiyn/followers", "following_url": "https://api.github.com/users/sanxiyn/following{/other_user}", "gists_url": "https://api.github.com/users/sanxiyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/sanxiyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sanxiyn/subscriptions", "organizations_url": "https://api.github.com/users/sanxiyn/orgs", "repos_url": "https://api.github.com/users/sanxiyn/repos", "events_url": "https://api.github.com/users/sanxiyn/events{/privacy}", "received_events_url": "https://api.github.com/users/sanxiyn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3e7677ff319a3b2989c29bc57d258e7b8f39fed6", "url": "https://api.github.com/repos/rust-lang/rust/commits/3e7677ff319a3b2989c29bc57d258e7b8f39fed6", "html_url": "https://github.com/rust-lang/rust/commit/3e7677ff319a3b2989c29bc57d258e7b8f39fed6"}], "stats": {"total": 29, "additions": 20, "deletions": 9}, "files": [{"sha": "7347558b3a743365eb6bb59cc2067b0d0884420c", "filename": "src/returns.rs", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/974ab43453514d85bc0bb3ffa4ee44f0b0e6204e/src%2Freturns.rs", "raw_url": "https://github.com/rust-lang/rust/raw/974ab43453514d85bc0bb3ffa4ee44f0b0e6204e/src%2Freturns.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Freturns.rs?ref=974ab43453514d85bc0bb3ffa4ee44f0b0e6204e", "patch": "@@ -4,7 +4,7 @@ use syntax::ast::*;\n use syntax::codemap::{Span, Spanned};\n use syntax::visit::FnKind;\n \n-use utils::{span_lint, snippet, match_path_ast, in_external_macro};\n+use utils::{span_lint, span_lint_and_then, snippet_opt, match_path_ast, in_external_macro};\n \n declare_lint!(pub NEEDLESS_RETURN, Warn,\n               \"using a return statement like `return expr;` where an expression would suffice\");\n@@ -23,7 +23,7 @@ impl ReturnPass {\n         } else if let Some(stmt) = block.stmts.last() {\n             if let StmtSemi(ref expr, _) = stmt.node {\n                 if let ExprRet(Some(ref inner)) = expr.node {\n-                    self.emit_return_lint(cx, (expr.span, inner.span));\n+                    self.emit_return_lint(cx, (stmt.span, inner.span));\n                 }\n             }\n         }\n@@ -59,10 +59,15 @@ impl ReturnPass {\n \n     fn emit_return_lint(&mut self, cx: &EarlyContext, spans: (Span, Span)) {\n         if in_external_macro(cx, spans.1) {return;}\n-        span_lint(cx, NEEDLESS_RETURN, spans.0, &format!(\n-            \"unneeded return statement. Consider using `{}` \\\n-             without the return and trailing semicolon\",\n-            snippet(cx, spans.1, \"..\")))\n+        span_lint_and_then(cx, NEEDLESS_RETURN, spans.0,\n+                           \"unneeded return statement\",\n+                           || {\n+            if let Some(snippet) = snippet_opt(cx, spans.1) {\n+                cx.sess().span_suggestion(spans.0,\n+                                          \"remove `return` as shown:\",\n+                                          snippet);\n+            }\n+        });\n     }\n \n     // Check for \"let x = EXPR; x\""}, {"sha": "fe29d991661e5df68dbd9356d56895d3dc400ef2", "filename": "tests/compile-fail/needless_return.rs", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/974ab43453514d85bc0bb3ffa4ee44f0b0e6204e/tests%2Fcompile-fail%2Fneedless_return.rs", "raw_url": "https://github.com/rust-lang/rust/raw/974ab43453514d85bc0bb3ffa4ee44f0b0e6204e/tests%2Fcompile-fail%2Fneedless_return.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompile-fail%2Fneedless_return.rs?ref=974ab43453514d85bc0bb3ffa4ee44f0b0e6204e", "patch": "@@ -8,11 +8,17 @@ fn test_end_of_fn() -> bool {\n         // no error!\n         return true;\n     }\n-    return true;           //~ERROR unneeded return statement\n+    return true;\n+    //~^ ERROR unneeded return statement\n+    //~| HELP remove `return` as shown\n+    //~| SUGGESTION true\n }\n \n fn test_no_semicolon() -> bool {\n-    return true            //~ERROR unneeded return statement\n+    return true\n+    //~^ ERROR unneeded return statement\n+    //~| HELP remove `return` as shown\n+    //~| SUGGESTION true\n }\n \n fn test_if_block() -> bool {\n@@ -29,7 +35,7 @@ fn test_match(x: bool) -> bool {\n             return false;  //~ERROR unneeded return statement\n         }\n         false => {\n-            return true    //~ERROR unneeded return statement\n+            return true;   //~ERROR unneeded return statement\n         }\n     }\n }"}]}