{"sha": "df20c0684c88ca1c8ea7d8da76ff502c734a827e", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRmMjBjMDY4NGM4OGNhMWM4ZWE3ZDhkYTc2ZmY1MDJjNzM0YTgyN2U=", "commit": {"author": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2017-08-26T11:12:55Z"}, "committer": {"name": "Ralf Jung", "email": "post@ralfj.de", "date": "2017-08-26T11:12:55Z"}, "message": "use tempdir to create a dedicated directory for each test", "tree": {"sha": "f6129eaaf12276872ab4fa706ccfc7838940979a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/f6129eaaf12276872ab4fa706ccfc7838940979a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/df20c0684c88ca1c8ea7d8da76ff502c734a827e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/df20c0684c88ca1c8ea7d8da76ff502c734a827e", "html_url": "https://github.com/rust-lang/rust/commit/df20c0684c88ca1c8ea7d8da76ff502c734a827e", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/df20c0684c88ca1c8ea7d8da76ff502c734a827e/comments", "author": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "committer": {"login": "RalfJung", "id": 330628, "node_id": "MDQ6VXNlcjMzMDYyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/330628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RalfJung", "html_url": "https://github.com/RalfJung", "followers_url": "https://api.github.com/users/RalfJung/followers", "following_url": "https://api.github.com/users/RalfJung/following{/other_user}", "gists_url": "https://api.github.com/users/RalfJung/gists{/gist_id}", "starred_url": "https://api.github.com/users/RalfJung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RalfJung/subscriptions", "organizations_url": "https://api.github.com/users/RalfJung/orgs", "repos_url": "https://api.github.com/users/RalfJung/repos", "events_url": "https://api.github.com/users/RalfJung/events{/privacy}", "received_events_url": "https://api.github.com/users/RalfJung/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1ee718a5c952cf7a5f9d4430f4b6114b9b3ec48b", "url": "https://api.github.com/repos/rust-lang/rust/commits/1ee718a5c952cf7a5f9d4430f4b6114b9b3ec48b", "html_url": "https://github.com/rust-lang/rust/commit/1ee718a5c952cf7a5f9d4430f4b6114b9b3ec48b"}], "stats": {"total": 75, "additions": 72, "deletions": 3}, "files": [{"sha": "9e41c3010879083fc327126fea04a456e160fe9a", "filename": "Cargo.lock", "status": "modified", "additions": 60, "deletions": 0, "changes": 60, "blob_url": "https://github.com/rust-lang/rust/blob/df20c0684c88ca1c8ea7d8da76ff502c734a827e/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/df20c0684c88ca1c8ea7d8da76ff502c734a827e/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=df20c0684c88ca1c8ea7d8da76ff502c734a827e", "patch": "@@ -41,6 +41,11 @@ dependencies = [\n  \"libc 0.2.28 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"bitflags\"\n+version = \"0.7.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"byteorder\"\n version = \"1.1.0\"\n@@ -70,6 +75,19 @@ dependencies = [\n  \"rustc-serialize 0.3.24 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"conv\"\n+version = \"0.3.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"custom_derive 0.1.7 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"custom_derive\"\n+version = \"0.1.7\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+\n [[package]]\n name = \"dbghelp-sys\"\n version = \"0.2.0\"\n@@ -135,6 +153,23 @@ dependencies = [\n  \"lazy_static 0.2.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"magenta\"\n+version = \"0.1.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"conv 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"magenta-sys 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"magenta-sys\"\n+version = \"0.1.1\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"bitflags 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"memchr\"\n version = \"1.0.1\"\n@@ -154,6 +189,7 @@ dependencies = [\n  \"log 0.3.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"log_settings 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc_miri 0.1.0\",\n+ \"tempdir 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -166,6 +202,15 @@ name = \"quote\"\n version = \"0.3.15\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n+[[package]]\n+name = \"rand\"\n+version = \"0.3.16\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"libc 0.2.28 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"magenta 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"regex\"\n version = \"0.2.2\"\n@@ -246,6 +291,14 @@ dependencies = [\n  \"unicode-xid 0.0.4 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n+[[package]]\n+name = \"tempdir\"\n+version = \"0.3.5\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"rand 0.3.16 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n [[package]]\n name = \"thread_local\"\n version = \"0.3.4\"\n@@ -292,10 +345,13 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum aho-corasick 0.6.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"500909c4f87a9e52355b26626d890833e9e1d53ac566db76c36faa984b889699\"\n \"checksum backtrace 0.3.2 (git+https://github.com/alexcrichton/backtrace-rs)\" = \"<none>\"\n \"checksum backtrace-sys 0.1.12 (git+https://github.com/alexcrichton/backtrace-rs)\" = \"<none>\"\n+\"checksum bitflags 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"aad18937a628ec6abcd26d1489012cc0e18c21798210f491af69ded9b881106d\"\n \"checksum byteorder 1.1.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ff81738b726f5d099632ceaffe7fb65b90212e8dce59d518729e7e8634032d3d\"\n \"checksum cargo_metadata 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"be1057b8462184f634c3a208ee35b0f935cfd94b694b26deadccd98732088d7b\"\n \"checksum cfg-if 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d4c819a1287eb618df47cc647173c5c4c66ba19d888a6e50d605672aed3140de\"\n \"checksum compiletest_rs 0.2.9 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3dc4720203de7b490e2808cad3e9090e8850eed4ecd4176b246551a952f4ead7\"\n+\"checksum conv 0.3.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"78ff10625fd0ac447827aa30ea8b861fead473bb60aeb73af6c1c58caf0d1299\"\n+\"checksum custom_derive 0.1.7 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ef8ae57c4978a2acd8b869ce6b9ca1dfe817bff704c220209fdef2c0b75a01b9\"\n \"checksum dbghelp-sys 0.2.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"97590ba53bcb8ac28279161ca943a924d1fd4a8fb3fa63302591647c4fc5b850\"\n \"checksum dtoa 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"80c8b71fd71146990a9742fc06dcbbde19161a267e0ad4e572c35162f4578c90\"\n \"checksum env_logger 0.4.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3ddf21e73e016298f5cb37d6ef8e8da8e39f91f9ec8b0df44b7deb16a9f8cd5b\"\n@@ -306,9 +362,12 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum libc 0.2.28 (registry+https://github.com/rust-lang/crates.io-index)\" = \"bb7b49972ee23d8aa1026c365a5b440ba08e35075f18c459980c7395c221ec48\"\n \"checksum log 0.3.8 (registry+https://github.com/rust-lang/crates.io-index)\" = \"880f77541efa6e5cc74e76910c9884d9859683118839d6a1dc3b11e63512565b\"\n \"checksum log_settings 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3d382732ea0fbc09790c4899db3255bdea0fc78b54bf234bd18a63bb603915b6\"\n+\"checksum magenta 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"4bf0336886480e671965f794bc9b6fce88503563013d1bfb7a502c81fe3ac527\"\n+\"checksum magenta-sys 0.1.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"40d014c7011ac470ae28e2f76a02bfea4a8480f73e701353b49ad7a8d75f4699\"\n \"checksum memchr 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"1dbccc0e46f1ea47b9f17e6d67c5a96bd27030519c519c9c91327e31275a47b4\"\n \"checksum num-traits 0.1.40 (registry+https://github.com/rust-lang/crates.io-index)\" = \"99843c856d68d8b4313b03a17e33c4bb42ae8f6610ea81b28abe076ac721b9b0\"\n \"checksum quote 0.3.15 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7a6e920b65c65f10b2ae65c831a81a073a89edd28c7cce89475bff467ab4167a\"\n+\"checksum rand 0.3.16 (registry+https://github.com/rust-lang/crates.io-index)\" = \"eb250fd207a4729c976794d03db689c9be1d634ab5a1c9da9492a13d8fecbcdf\"\n \"checksum regex 0.2.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"1731164734096285ec2a5ec7fea5248ae2f5485b3feeb0115af4fda2183b2d1b\"\n \"checksum regex-syntax 0.4.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ad890a5eef7953f55427c50575c680c42841653abd2b028b68cd223d157f62db\"\n \"checksum rustc-demangle 0.1.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"3058a43ada2c2d0b92b3ae38007a2d0fa5e9db971be260e0171408a4ff471c95\"\n@@ -319,6 +378,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum serde_json 1.0.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"48b04779552e92037212c3615370f6bd57a40ebba7f20e554ff9f55e41a69a7b\"\n \"checksum syn 0.11.11 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d3b891b9015c88c576343b9b3e41c2c11a51c219ef067b264bd9c8aa9b441dad\"\n \"checksum synom 0.11.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"a393066ed9010ebaed60b9eafa373d4b1baac186dd7e008555b0f702b51945b6\"\n+\"checksum tempdir 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"87974a6f5c1dfb344d733055601650059a3363de2a6104819293baff662132d6\"\n \"checksum thread_local 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"1697c4b57aeeb7a536b647165a2825faddffb1d3bad386d507709bd51a90bb14\"\n \"checksum unicode-xid 0.0.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"8c1f860d7d29cf02cb2f3f359fd35991af3d30bac52c57d265a3c461074cb4dc\"\n \"checksum unreachable 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"382810877fe448991dfc7f0dd6e3ae5d58088fd0ea5e35189655f84e6814fa56\""}, {"sha": "0985c15aece9704dbfc940b35be735dbc3f56e4a", "filename": "Cargo.toml", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/df20c0684c88ca1c8ea7d8da76ff502c734a827e/Cargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/df20c0684c88ca1c8ea7d8da76ff502c734a827e/Cargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.toml?ref=df20c0684c88ca1c8ea7d8da76ff502c734a827e", "patch": "@@ -37,6 +37,7 @@ cargo_miri = [\"cargo_metadata\"]\n \n [dev-dependencies]\n compiletest_rs = \"0.2.6\"\n+tempdir = \"0.3\"\n \n [workspace]\n exclude = [\"xargo\", \"cargo-miri-test\", \"rustc_tests\"]"}, {"sha": "93c668e9af49167d58eeffbf340c21bd877d1224", "filename": "tests/compiletest.rs", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/df20c0684c88ca1c8ea7d8da76ff502c734a827e/tests%2Fcompiletest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/df20c0684c88ca1c8ea7d8da76ff502c734a827e/tests%2Fcompiletest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fcompiletest.rs?ref=df20c0684c88ca1c8ea7d8da76ff502c734a827e", "patch": "@@ -1,10 +1,12 @@\n #![feature(slice_concat_ext)]\n \n extern crate compiletest_rs as compiletest;\n+extern crate tempdir;\n \n use std::slice::SliceConcatExt;\n use std::path::{PathBuf, Path};\n use std::io::Write;\n+use tempdir::TempDir;\n \n macro_rules! eprintln {\n     ($($arg:tt)*) => {\n@@ -35,8 +37,10 @@ fn compile_fail(sysroot: &Path, path: &str, target: &str, host: &str, fullmir: b\n         path,\n         target\n     );\n-    let mut config = compiletest::default_config();\n+    let mut config = compiletest::Config::default();\n     config.mode = \"compile-fail\".parse().expect(\"Invalid mode\");\n+    let build_dir = TempDir::new(\"miri-tests\").unwrap();\n+    config.build_base = build_dir.path().to_owned();\n     config.rustc_path = miri_path();\n     let mut flags = Vec::new();\n     if rustc_test_suite().is_some() {\n@@ -66,8 +70,10 @@ fn compile_fail(sysroot: &Path, path: &str, target: &str, host: &str, fullmir: b\n \n fn run_pass(path: &str) {\n     eprintln!(\"## Running run-pass tests in {} against rustc\", path);\n-    let mut config = compiletest::default_config();\n+    let mut config = compiletest::Config::default();\n     config.mode = \"run-pass\".parse().expect(\"Invalid mode\");\n+    let build_dir = TempDir::new(\"miri-tests\").unwrap();\n+    config.build_base = build_dir.path().to_owned();\n     config.src_base = PathBuf::from(path);\n     if let Some(rustc_path) = rustc_test_suite() {\n         config.rustc_path = rustc_path;\n@@ -89,8 +95,10 @@ fn miri_pass(path: &str, target: &str, host: &str, fullmir: bool, opt: bool) {\n         target,\n         opt_str\n     );\n-    let mut config = compiletest::default_config();\n+    let mut config = compiletest::Config::default();\n     config.mode = \"mir-opt\".parse().expect(\"Invalid mode\");\n+    let build_dir = TempDir::new(\"miri-tests\").unwrap();\n+    config.build_base = build_dir.path().to_owned();\n     config.src_base = PathBuf::from(path);\n     config.target = target.to_owned();\n     config.host = host.to_owned();"}]}