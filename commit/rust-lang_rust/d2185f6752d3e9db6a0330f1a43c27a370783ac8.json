{"sha": "d2185f6752d3e9db6a0330f1a43c27a370783ac8", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQyMTg1ZjY3NTJkM2U5ZGI2YTAzMzBmMWE0M2MyN2EzNzA3ODNhYzg=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-11-05T00:30:58Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2019-11-05T00:30:58Z"}, "message": "Auto merge of #65911 - mati865:static-libstdcxx-mingw, r=alexcrichton\n\nStatically link libstdc++ on windows-gnu\n\nFixes https://github.com/rust-lang/rust/issues/61561 by not shipping `libstdc++-6.dll` which can conflict with the GCC.", "tree": {"sha": "a3b22b3cb7abd7d306c579bb1298f9b9a9946644", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/a3b22b3cb7abd7d306c579bb1298f9b9a9946644"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d2185f6752d3e9db6a0330f1a43c27a370783ac8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d2185f6752d3e9db6a0330f1a43c27a370783ac8", "html_url": "https://github.com/rust-lang/rust/commit/d2185f6752d3e9db6a0330f1a43c27a370783ac8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d2185f6752d3e9db6a0330f1a43c27a370783ac8/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "881ebeb776cf4062a85a20b15f64c7349319518c", "url": "https://api.github.com/repos/rust-lang/rust/commits/881ebeb776cf4062a85a20b15f64c7349319518c", "html_url": "https://github.com/rust-lang/rust/commit/881ebeb776cf4062a85a20b15f64c7349319518c"}, {"sha": "b20d8d3396faadd76f413d1d073be5c7576e5780", "url": "https://api.github.com/repos/rust-lang/rust/commits/b20d8d3396faadd76f413d1d073be5c7576e5780", "html_url": "https://github.com/rust-lang/rust/commit/b20d8d3396faadd76f413d1d073be5c7576e5780"}], "stats": {"total": 16, "additions": 10, "deletions": 6}, "files": [{"sha": "8e5fe2520cad7fde10c3bda64895444e9f56f6a6", "filename": "src/bootstrap/compile.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d2185f6752d3e9db6a0330f1a43c27a370783ac8/src%2Fbootstrap%2Fcompile.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d2185f6752d3e9db6a0330f1a43c27a370783ac8/src%2Fbootstrap%2Fcompile.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fcompile.rs?ref=d2185f6752d3e9db6a0330f1a43c27a370783ac8", "patch": "@@ -657,11 +657,11 @@ pub fn build_codegen_backend(builder: &Builder<'_>,\n             if let Some(ref s) = builder.config.llvm_ldflags {\n                 cargo.env(\"LLVM_LINKER_FLAGS\", s);\n             }\n-            // Building with a static libstdc++ is only supported on linux right now,\n+            // Building with a static libstdc++ is only supported on linux and mingw right now,\n             // not for MSVC or macOS\n             if builder.config.llvm_static_stdcpp &&\n                !target.contains(\"freebsd\") &&\n-               !target.contains(\"windows\") &&\n+               !target.contains(\"msvc\") &&\n                !target.contains(\"apple\") {\n                 let file = compiler_file(builder,\n                                          builder.cxx(target).unwrap(),"}, {"sha": "67907bc8cbf0adf8c01867a9a43bb557246aa9a7", "filename": "src/bootstrap/dist.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/d2185f6752d3e9db6a0330f1a43c27a370783ac8/src%2Fbootstrap%2Fdist.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d2185f6752d3e9db6a0330f1a43c27a370783ac8/src%2Fbootstrap%2Fdist.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fdist.rs?ref=d2185f6752d3e9db6a0330f1a43c27a370783ac8", "patch": "@@ -236,7 +236,7 @@ fn make_win_dist(\n     }\n \n     let target_tools = [\"gcc.exe\", \"ld.exe\", \"dlltool.exe\", \"libwinpthread-1.dll\"];\n-    let mut rustc_dlls = vec![\"libstdc++-6.dll\", \"libwinpthread-1.dll\"];\n+    let mut rustc_dlls = vec![\"libwinpthread-1.dll\"];\n     if target_triple.starts_with(\"i686-\") {\n         rustc_dlls.push(\"libgcc_s_dw2-1.dll\");\n     } else {"}, {"sha": "2e89fd5398dfc94a252daec80c76bc9ad1f36c0b", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/d2185f6752d3e9db6a0330f1a43c27a370783ac8/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d2185f6752d3e9db6a0330f1a43c27a370783ac8/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=d2185f6752d3e9db6a0330f1a43c27a370783ac8", "patch": "@@ -159,7 +159,7 @@ impl Step for Llvm {\n \n         // For distribution we want the LLVM tools to be *statically* linked to libstdc++\n         if builder.config.llvm_tools_enabled || builder.config.lldb_enabled {\n-            if !target.contains(\"windows\") {\n+            if !target.contains(\"msvc\") {\n                 if target.contains(\"apple\") {\n                     cfg.define(\"CMAKE_EXE_LINKER_FLAGS\", \"-static-libstdc++\");\n                 } else {\n@@ -395,7 +395,7 @@ fn configure_cmake(builder: &Builder<'_>,\n     cfg.define(\"CMAKE_C_FLAGS\", cflags);\n     let mut cxxflags = builder.cflags(target, GitRepo::Llvm).join(\" \");\n     if builder.config.llvm_static_stdcpp &&\n-        !target.contains(\"windows\") &&\n+        !target.contains(\"msvc\") &&\n         !target.contains(\"netbsd\")\n     {\n         cxxflags.push_str(\" -static-libstdc++\");"}, {"sha": "c5d5f066f4f821d156aded803472942de655a88c", "filename": "src/librustc_llvm/build.rs", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/d2185f6752d3e9db6a0330f1a43c27a370783ac8/src%2Flibrustc_llvm%2Fbuild.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d2185f6752d3e9db6a0330f1a43c27a370783ac8/src%2Flibrustc_llvm%2Fbuild.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_llvm%2Fbuild.rs?ref=d2185f6752d3e9db6a0330f1a43c27a370783ac8", "patch": "@@ -279,7 +279,11 @@ fn main() {\n             let path = PathBuf::from(s);\n             println!(\"cargo:rustc-link-search=native={}\",\n                      path.parent().unwrap().display());\n-            println!(\"cargo:rustc-link-lib=static={}\", stdcppname);\n+            if target.contains(\"windows\") {\n+                println!(\"cargo:rustc-link-lib=static-nobundle={}\", stdcppname);\n+            } else {\n+                println!(\"cargo:rustc-link-lib=static={}\", stdcppname);\n+            }\n         } else if cxxflags.contains(\"stdlib=libc++\") {\n             println!(\"cargo:rustc-link-lib=c++\");\n         } else {"}]}