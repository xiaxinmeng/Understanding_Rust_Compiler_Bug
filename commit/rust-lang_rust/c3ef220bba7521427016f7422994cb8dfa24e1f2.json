{"sha": "c3ef220bba7521427016f7422994cb8dfa24e1f2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmMzZWYyMjBiYmE3NTIxNDI3MDE2Zjc0MjI5OTRjYjhkZmEyNGUxZjI=", "commit": {"author": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2017-08-21T12:22:41Z"}, "committer": {"name": "Oliver Schneider", "email": "git-spam-no-reply9815368754983@oli-obk.de", "date": "2017-08-21T12:22:41Z"}, "message": "Rebase and update ui test", "tree": {"sha": "9377c61334f7761fecd6c51e5d6ab79fa0634221", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/9377c61334f7761fecd6c51e5d6ab79fa0634221"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c3ef220bba7521427016f7422994cb8dfa24e1f2", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEYFTdM4NKd7XQft77pp+NIls619kFAlma0KEACgkQpp+NIls6\n19nR1xAAlW8GnoPq7FfjtjlSoShjLAJixCU4nq+Bw+f16Zaq5cd85hhdr1LzAKbG\nDzEHEsJHcv6tU0D4RwHdkCc0vXSME+0naupT962hmE7JCjEfLmZdLlDxNLxs9Xyl\nICAAPLInY20hYlzAMIoi4Hd09Qq5M5vNz89aK+cbBE6EfrwyFhqCK3cr/cDTKhxU\n+f+6VdIyymtahy7XkSb8nz4NMtr7H8oAJ+TlFs//LC2NXL35Q1dUBDc1sUHt2V4b\nywEFvYb9di7mFgEp1s7qXk8TJ5o3Jal9oexgZTFCK8PyXBOP3Lg7KmS6/ZIDPQwq\nnYd3AD22DSMOgnQ1LG3dQK6xs5raPxH1A0xuL4SVQObf32qaOaS08/94sOiASC+n\nGAHAe0zjAwM5CbK48bOv2ccFGRhT1SDCDlbvJJ6HNkqGztkVWW900thhbpcQnenl\nEm9nbmpMm49lm6Q/v69KGhi9+nngBtnKaipm6C8F3l/RtRUso5+Jie4ieE2uhD6c\ni+bn1xIVwkLxhMFFduP+x54JuXOzK6fiqtRQFWsbcOgXXuXqBOSSh0u9lnUtAFLq\nd1G8UJCuwfaiMc6CFMHosk2JMA9dQVA5MHkZwyXnqtVbcB5K0rvWQZEZUeDVfH13\nKXwdGtTp6fXpmLQ+U4u7TmvE5+rlk4koI2TeTaotWwJmHIJyVAE=\n=FkbF\n-----END PGP SIGNATURE-----", "payload": "tree 9377c61334f7761fecd6c51e5d6ab79fa0634221\nparent ee2f54723ae8122b7f7e5cfca48f3f85f7d656ca\nauthor Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1503318161 +0200\ncommitter Oliver Schneider <git-spam-no-reply9815368754983@oli-obk.de> 1503318161 +0200\n\nRebase and update ui test\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c3ef220bba7521427016f7422994cb8dfa24e1f2", "html_url": "https://github.com/rust-lang/rust/commit/c3ef220bba7521427016f7422994cb8dfa24e1f2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c3ef220bba7521427016f7422994cb8dfa24e1f2/comments", "author": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "committer": {"login": "oli-obk", "id": 332036, "node_id": "MDQ6VXNlcjMzMjAzNg==", "avatar_url": "https://avatars.githubusercontent.com/u/332036?v=4", "gravatar_id": "", "url": "https://api.github.com/users/oli-obk", "html_url": "https://github.com/oli-obk", "followers_url": "https://api.github.com/users/oli-obk/followers", "following_url": "https://api.github.com/users/oli-obk/following{/other_user}", "gists_url": "https://api.github.com/users/oli-obk/gists{/gist_id}", "starred_url": "https://api.github.com/users/oli-obk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/oli-obk/subscriptions", "organizations_url": "https://api.github.com/users/oli-obk/orgs", "repos_url": "https://api.github.com/users/oli-obk/repos", "events_url": "https://api.github.com/users/oli-obk/events{/privacy}", "received_events_url": "https://api.github.com/users/oli-obk/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ee2f54723ae8122b7f7e5cfca48f3f85f7d656ca", "url": "https://api.github.com/repos/rust-lang/rust/commits/ee2f54723ae8122b7f7e5cfca48f3f85f7d656ca", "html_url": "https://github.com/rust-lang/rust/commit/ee2f54723ae8122b7f7e5cfca48f3f85f7d656ca"}], "stats": {"total": 26, "additions": 17, "deletions": 9}, "files": [{"sha": "3f7ccca23b4267f197ca48fdacc7c8b084163d09", "filename": "clippy_lints/src/needless_borrowed_ref.rs", "status": "modified", "additions": 2, "deletions": 8, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/c3ef220bba7521427016f7422994cb8dfa24e1f2/clippy_lints%2Fsrc%2Fneedless_borrowed_ref.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c3ef220bba7521427016f7422994cb8dfa24e1f2/clippy_lints%2Fsrc%2Fneedless_borrowed_ref.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_borrowed_ref.rs?ref=c3ef220bba7521427016f7422994cb8dfa24e1f2", "patch": "@@ -3,8 +3,7 @@\n //! This lint is **warn** by default\n \n use rustc::lint::*;\n-use rustc::hir::{MutImmutable, Pat, PatKind, BindByRef};\n-use rustc::ty;\n+use rustc::hir::{MutImmutable, Pat, PatKind, BindingAnnotation};\n use utils::{span_lint_and_then, in_macro, snippet};\n \n /// **What it does:** Checks for useless borrowed references.\n@@ -63,16 +62,11 @@ impl<'a, 'tcx> LateLintPass<'a, 'tcx> for NeedlessBorrowedRef {\n         }\n \n         if_let_chain! {[\n-            // Pat is a pattern whose node\n-            // is a binding which \"involves\" an immutable reference...\n-            let PatKind::Binding(BindingAnnotation::Ref, ..) = pat.node,\n-            // Pattern's type is a reference. Get the type and mutability of referenced value (tam: TypeAndMut).\n-            let ty::TyRef(_, ref tam) = cx.tables.pat_ty(pat).sty,\n             // Only lint immutable refs, because `&mut ref T` may be useful.\n             let PatKind::Ref(ref sub_pat, MutImmutable) = pat.node,\n \n             // Check sub_pat got a `ref` keyword (excluding `ref mut`).\n-            let PatKind::Binding(BindByRef(MutImmutable), _, spanned_name, ..) = sub_pat.node,\n+            let PatKind::Binding(BindingAnnotation::Ref, _, spanned_name, ..) = sub_pat.node,\n         ], {\n             span_lint_and_then(cx, NEEDLESS_BORROWED_REFERENCE, pat.span,\n                                \"this pattern takes a reference on something that is being de-referenced\","}, {"sha": "d90c396645e9cd4f5f1e3d0dc372159f659eb0fe", "filename": "tests/ui/needless_borrow.stderr", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/c3ef220bba7521427016f7422994cb8dfa24e1f2/tests%2Fui%2Fneedless_borrow.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/c3ef220bba7521427016f7422994cb8dfa24e1f2/tests%2Fui%2Fneedless_borrow.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_borrow.stderr?ref=c3ef220bba7521427016f7422994cb8dfa24e1f2", "patch": "@@ -18,11 +18,25 @@ error: this expression borrows a reference that is immediately dereferenced by t\n 27 |         46 => &&a,\n    |               ^^^\n \n+error: this pattern takes a reference on something that is being de-referenced\n+  --> $DIR/needless_borrow.rs:49:34\n+   |\n+49 |     let _ = v.iter_mut().filter(|&ref a| a.is_empty());\n+   |                                  ^^^^^^ help: try removing the `&ref` part and just keep: `a`\n+   |\n+   = note: `-D needless-borrowed-reference` implied by `-D warnings`\n+\n+error: this pattern takes a reference on something that is being de-referenced\n+  --> $DIR/needless_borrow.rs:50:30\n+   |\n+50 |     let _ = v.iter().filter(|&ref a| a.is_empty());\n+   |                              ^^^^^^ help: try removing the `&ref` part and just keep: `a`\n+\n error: this pattern creates a reference to a reference\n   --> $DIR/needless_borrow.rs:50:31\n    |\n 50 |     let _ = v.iter().filter(|&ref a| a.is_empty());\n    |                               ^^^^^\n \n-error: aborting due to 4 previous errors\n+error: aborting due to 6 previous errors\n "}]}