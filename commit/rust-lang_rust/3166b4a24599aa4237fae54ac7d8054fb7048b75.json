{"sha": "3166b4a24599aa4237fae54ac7d8054fb7048b75", "node_id": "C_kwDOAAsO6NoAKDMxNjZiNGEyNDU5OWFhNDIzN2ZhZTU0YWM3ZDgwNTRmYjcwNDhiNzU", "commit": {"author": {"name": "Matthias Kr\u00fcger", "email": "matthias.krueger@famsik.de", "date": "2023-03-12T07:13:29Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-03-12T07:13:29Z"}, "message": "Rollup merge of #109034 - compiler-errors:lazy-norm-tests, r=jackh726\n\nCommit some tests for the new solver + lazy norm\n\nAlso consolidate `typeck/lazy-norm` into `traits/new-solver`, since it's not really useful to maintain a distinction, like when a test really is due to \"lazy norm\" or \"the new solver\" (usually both!)", "tree": {"sha": "51defbe48986d6461f34063852bf890e34906d53", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/51defbe48986d6461f34063852bf890e34906d53"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3166b4a24599aa4237fae54ac7d8054fb7048b75", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJkDXuZCRBK7hj4Ov3rIwAAN6wIAC31lyUUrb76Wze9zy4kbXw5\nsa/yyorGknJLu0XZJnL1ikkEcXonIa/shwSQ9cGx2PumTMEJe6iO7VE1R8XDA+e+\njvh9UPME+TdpdC4ez5bcTYJ7dcem/9TZnZP6hu7wm5qKo8NcCHC6qprR+KnF0i+b\nLnTj+FXgvGKttBLE8KxZDqoBvz8x1TaznHH1zzUahsPt4WovJzomHFGv6qbhr5cw\nb+Gk9MOeAaLU7wk48w7slHWdxq+/mkFfDbZX9ctoNCUmICZL/dtvMqQ5kjCAh8B7\no7nwGmU7z61Dfyqe/x2SmMSoSJA3Jpq+KftkBaQb78hooLDWLEZLGSi6/jMf7jo=\n=vvmt\n-----END PGP SIGNATURE-----\n", "payload": "tree 51defbe48986d6461f34063852bf890e34906d53\nparent 54c95a8072d806de140d6428487374b69b629c81\nparent 1c4603e3b036b3f1292feb1a073fc7f3221a4321\nauthor Matthias Kr\u00fcger <matthias.krueger@famsik.de> 1678605209 +0100\ncommitter GitHub <noreply@github.com> 1678605209 +0100\n\nRollup merge of #109034 - compiler-errors:lazy-norm-tests, r=jackh726\n\nCommit some tests for the new solver + lazy norm\n\nAlso consolidate `typeck/lazy-norm` into `traits/new-solver`, since it's not really useful to maintain a distinction, like when a test really is due to \"lazy norm\" or \"the new solver\" (usually both!)\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3166b4a24599aa4237fae54ac7d8054fb7048b75", "html_url": "https://github.com/rust-lang/rust/commit/3166b4a24599aa4237fae54ac7d8054fb7048b75", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3166b4a24599aa4237fae54ac7d8054fb7048b75/comments", "author": {"login": "matthiaskrgr", "id": 476013, "node_id": "MDQ6VXNlcjQ3NjAxMw==", "avatar_url": "https://avatars.githubusercontent.com/u/476013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matthiaskrgr", "html_url": "https://github.com/matthiaskrgr", "followers_url": "https://api.github.com/users/matthiaskrgr/followers", "following_url": "https://api.github.com/users/matthiaskrgr/following{/other_user}", "gists_url": "https://api.github.com/users/matthiaskrgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/matthiaskrgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matthiaskrgr/subscriptions", "organizations_url": "https://api.github.com/users/matthiaskrgr/orgs", "repos_url": "https://api.github.com/users/matthiaskrgr/repos", "events_url": "https://api.github.com/users/matthiaskrgr/events{/privacy}", "received_events_url": "https://api.github.com/users/matthiaskrgr/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "54c95a8072d806de140d6428487374b69b629c81", "url": "https://api.github.com/repos/rust-lang/rust/commits/54c95a8072d806de140d6428487374b69b629c81", "html_url": "https://github.com/rust-lang/rust/commit/54c95a8072d806de140d6428487374b69b629c81"}, {"sha": "1c4603e3b036b3f1292feb1a073fc7f3221a4321", "url": "https://api.github.com/repos/rust-lang/rust/commits/1c4603e3b036b3f1292feb1a073fc7f3221a4321", "html_url": "https://github.com/rust-lang/rust/commit/1c4603e3b036b3f1292feb1a073fc7f3221a4321"}], "stats": {"total": 172, "additions": 172, "deletions": 0}, "files": [{"sha": "3b261062f782e6c1d227379a4fbb14d6a566d0b4", "filename": "tests/ui/traits/new-solver/cast-checks-handling-projections.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Fcast-checks-handling-projections.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Fcast-checks-handling-projections.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftraits%2Fnew-solver%2Fcast-checks-handling-projections.rs?ref=3166b4a24599aa4237fae54ac7d8054fb7048b75", "previous_filename": "tests/ui/typeck/lazy-norm/cast-checks-handling-projections.rs"}, {"sha": "019c6e81c50e9affd64e64cc22d04a71a0660172", "filename": "tests/ui/traits/new-solver/equating-projection-cyclically.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Fequating-projection-cyclically.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Fequating-projection-cyclically.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftraits%2Fnew-solver%2Fequating-projection-cyclically.rs?ref=3166b4a24599aa4237fae54ac7d8054fb7048b75", "previous_filename": "tests/ui/typeck/lazy-norm/equating-projection-cyclically.rs"}, {"sha": "57cbc65a17a925957d70dd881ed4c59badd55f8d", "filename": "tests/ui/traits/new-solver/equating-projection-cyclically.stderr", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Fequating-projection-cyclically.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Fequating-projection-cyclically.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftraits%2Fnew-solver%2Fequating-projection-cyclically.stderr?ref=3166b4a24599aa4237fae54ac7d8054fb7048b75", "previous_filename": "tests/ui/typeck/lazy-norm/equating-projection-cyclically.stderr"}, {"sha": "af00cbb3ba82749f529a25f1482ea4a8076fda65", "filename": "tests/ui/traits/new-solver/lazy-nested-obligations-1.rs", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Flazy-nested-obligations-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Flazy-nested-obligations-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftraits%2Fnew-solver%2Flazy-nested-obligations-1.rs?ref=3166b4a24599aa4237fae54ac7d8054fb7048b75", "patch": "@@ -0,0 +1,13 @@\n+// check-pass\n+// compile-flags: -Ztrait-solver=next\n+// Issue 94358\n+\n+fn foo<C>(_: C)\n+where\n+    for <'a> &'a C: IntoIterator,\n+    for <'a> <&'a C as IntoIterator>::IntoIter: ExactSizeIterator,\n+{}\n+\n+fn main() {\n+    foo::<_>(vec![true, false]);\n+}"}, {"sha": "32addd829dcfdf5f42c2a579efe6f67eb75346ab", "filename": "tests/ui/traits/new-solver/lazy-nested-obligations-2.rs", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/rust-lang/rust/blob/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Flazy-nested-obligations-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Flazy-nested-obligations-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftraits%2Fnew-solver%2Flazy-nested-obligations-2.rs?ref=3166b4a24599aa4237fae54ac7d8054fb7048b75", "patch": "@@ -0,0 +1,23 @@\n+// check-pass\n+// compile-flags: -Ztrait-solver=next\n+// Issue 95863\n+\n+pub trait With {\n+    type F;\n+}\n+\n+impl With for i32 {\n+    type F = fn(&str);\n+}\n+\n+fn f(_: &str) {}\n+\n+fn main() {\n+    let _: V<i32> = V(f);\n+    pub struct V<T: With>(<T as With>::F);\n+\n+    pub enum E3<T: With> {\n+        Var(<T as With>::F),\n+    }\n+    let _: E3<i32> = E3::Var(f);\n+}"}, {"sha": "baf399572402311f00f01ca751a8769c931a6e61", "filename": "tests/ui/traits/new-solver/lazy-nested-obligations-3.rs", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Flazy-nested-obligations-3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Flazy-nested-obligations-3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftraits%2Fnew-solver%2Flazy-nested-obligations-3.rs?ref=3166b4a24599aa4237fae54ac7d8054fb7048b75", "patch": "@@ -0,0 +1,38 @@\n+// check-pass\n+// compile-flags: -Ztrait-solver=next\n+// Issue 96750\n+\n+use std::marker::PhantomData;\n+\n+trait AsyncFn<Arg> {\n+    type Output;\n+}\n+trait RequestFamily {\n+    type Type<'a>;\n+}\n+trait Service {}\n+\n+struct MyFn;\n+impl AsyncFn<String> for MyFn {\n+    type Output = ();\n+}\n+\n+impl RequestFamily for String {\n+    type Type<'a> = String;\n+}\n+\n+struct ServiceFromAsyncFn<F, Req>(F, PhantomData<Req>);\n+\n+impl<F, Req, O> Service for ServiceFromAsyncFn<F, Req>\n+where\n+    Req: RequestFamily,\n+    F: AsyncFn<Req>,\n+    F: for<'a> AsyncFn<Req::Type<'a>, Output = O>,\n+{\n+}\n+\n+fn assert_service() -> impl Service {\n+    ServiceFromAsyncFn(MyFn, PhantomData)\n+}\n+\n+fn main() {}"}, {"sha": "b02a5d623307a23c818bf255acf17062310cfb2d", "filename": "tests/ui/traits/new-solver/normalize-param-env-1.rs", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/rust-lang/rust/blob/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Fnormalize-param-env-1.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Fnormalize-param-env-1.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftraits%2Fnew-solver%2Fnormalize-param-env-1.rs?ref=3166b4a24599aa4237fae54ac7d8054fb7048b75", "patch": "@@ -0,0 +1,40 @@\n+// check-pass\n+// compile-flags: -Ztrait-solver=next\n+// Issue 108933\n+\n+trait Add<Rhs> {\n+    type Sum;\n+}\n+\n+impl Add<()> for () {\n+    type Sum = ();\n+}\n+\n+type Unit = <() as Add<()>>::Sum;\n+\n+trait Trait<C> {\n+    type Output;\n+}\n+\n+fn f<T>()\n+where\n+    T: Trait<()>,\n+    <T as Trait<()>>::Output: Sized,\n+{\n+}\n+\n+fn g<T>()\n+where\n+    T: Trait<Unit>,\n+    <T as Trait<()>>::Output: Sized,\n+{\n+}\n+\n+fn h<T>()\n+where\n+    T: Trait<()>,\n+    <T as Trait<Unit>>::Output: Sized,\n+{\n+}\n+\n+fn main() {}"}, {"sha": "7c2cebdd2002f942afbe5ef7d35408c94702ebdd", "filename": "tests/ui/traits/new-solver/normalize-param-env-2.rs", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Fnormalize-param-env-2.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Fnormalize-param-env-2.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftraits%2Fnew-solver%2Fnormalize-param-env-2.rs?ref=3166b4a24599aa4237fae54ac7d8054fb7048b75", "patch": "@@ -0,0 +1,26 @@\n+// check-pass\n+// compile-flags: -Ztrait-solver=next\n+// Issue 92505\n+\n+trait A<T> {\n+    type I;\n+\n+    fn f()\n+    where\n+        Self::I: A<T>,\n+    {\n+    }\n+}\n+\n+impl<T> A<T> for () {\n+    type I = ();\n+\n+    fn f()\n+    where\n+        Self::I: A<T>,\n+    {\n+        <() as A<T>>::f();\n+    }\n+}\n+\n+fn main() {}"}, {"sha": "ce2974b2a16f4ef06ef2a95969e3c015849170f4", "filename": "tests/ui/traits/new-solver/normalize-param-env-3.rs", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Fnormalize-param-env-3.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3166b4a24599aa4237fae54ac7d8054fb7048b75/tests%2Fui%2Ftraits%2Fnew-solver%2Fnormalize-param-env-3.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Ftraits%2Fnew-solver%2Fnormalize-param-env-3.rs?ref=3166b4a24599aa4237fae54ac7d8054fb7048b75", "patch": "@@ -0,0 +1,32 @@\n+// check-pass\n+// compile-flags: -Ztrait-solver=next\n+// Issue 100177\n+\n+trait GenericTrait<T> {}\n+\n+trait Channel<I>: GenericTrait<Self::T> {\n+    type T;\n+}\n+\n+trait Sender {\n+    type Msg;\n+\n+    fn send<C>()\n+    where\n+        C: Channel<Self::Msg>;\n+}\n+\n+impl<T> Sender for T {\n+    type Msg = ();\n+\n+    fn send<C>()\n+    where\n+        C: Channel<Self::Msg>,\n+    {\n+    }\n+}\n+\n+// This works\n+fn foo<I, C>(ch: C) where C: Channel<I> {}\n+\n+fn main() {}"}]}