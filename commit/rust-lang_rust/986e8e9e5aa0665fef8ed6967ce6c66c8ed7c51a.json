{"sha": "986e8e9e5aa0665fef8ed6967ce6c66c8ed7c51a", "node_id": "MDY6Q29tbWl0NzI0NzEyOjk4NmU4ZTllNWFhMDY2NWZlZjhlZDY5NjdjZTZjNjZjOGVkN2M1MWE=", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-01-15T08:18:22Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-01-15T08:18:22Z"}, "message": "Merge #7274\n\n7274: Flesh out la-arena crate r=lnicola a=arzg\n\nAs requested in #7267, I\u2019ve added some basic documentation and added more keys to the crate\u2019s `Cargo.toml`.\n\nCo-authored-by: Aramis Razzaghipour <aramisnoah@gmail.com>", "tree": {"sha": "ac02a3c23a05afc925dc589c6854232a81b85fa3", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ac02a3c23a05afc925dc589c6854232a81b85fa3"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/986e8e9e5aa0665fef8ed6967ce6c66c8ed7c51a", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJgAU/OCRBK7hj4Ov3rIwAAdHIIAHkPKU3J5it0bNm1AT6sPILo\nUCjwHU/Q//0yblTaUvH+1o2LmtrhB5EPMGczKaovpQyQXW1dIMHt+9IAQJ+/lsj2\nnaA/kGRQ0ZrOUNJJ94hsjIz0MGxon6ly7COCB2fCjMk03/Up2Y7X6rAUJp89Wfo8\ndseviko0nEfBcXW8+h7OGEHGUiLVRdTGzP8iAedZlLLZSqa8JB3NtDKUmD8jb6Se\n7KWeXzh4+Yn3aTAQy+3qcNKQ/Wi9UUFVGvgfyjuUSkqwDkF2Kkj4ZxHPePaH7xrf\nDMFW8xch9C5gwrIiZ82MYDLLjXsLl9KmyZV/i2Lg3wxEQ9jhvGCvCcTSKD9ydHo=\n=bzBA\n-----END PGP SIGNATURE-----\n", "payload": "tree ac02a3c23a05afc925dc589c6854232a81b85fa3\nparent f88f3d688507508ae9528101e13e1c62902467a3\nparent a45099ee3ec0534de6e9aec0b56be64ac67c59a1\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1610698702 +0000\ncommitter GitHub <noreply@github.com> 1610698702 +0000\n\nMerge #7274\n\n7274: Flesh out la-arena crate r=lnicola a=arzg\n\nAs requested in #7267, I\u2019ve added some basic documentation and added more keys to the crate\u2019s `Cargo.toml`.\n\nCo-authored-by: Aramis Razzaghipour <aramisnoah@gmail.com>\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/986e8e9e5aa0665fef8ed6967ce6c66c8ed7c51a", "html_url": "https://github.com/rust-lang/rust/commit/986e8e9e5aa0665fef8ed6967ce6c66c8ed7c51a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/986e8e9e5aa0665fef8ed6967ce6c66c8ed7c51a/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f88f3d688507508ae9528101e13e1c62902467a3", "url": "https://api.github.com/repos/rust-lang/rust/commits/f88f3d688507508ae9528101e13e1c62902467a3", "html_url": "https://github.com/rust-lang/rust/commit/f88f3d688507508ae9528101e13e1c62902467a3"}, {"sha": "a45099ee3ec0534de6e9aec0b56be64ac67c59a1", "url": "https://api.github.com/repos/rust-lang/rust/commits/a45099ee3ec0534de6e9aec0b56be64ac67c59a1", "html_url": "https://github.com/rust-lang/rust/commit/a45099ee3ec0534de6e9aec0b56be64ac67c59a1"}], "stats": {"total": 92, "additions": 88, "deletions": 4}, "files": [{"sha": "1afec9bf87e34b1ec98ce7fe126131972a00e6ad", "filename": "lib/arena/Cargo.toml", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/986e8e9e5aa0665fef8ed6967ce6c66c8ed7c51a/lib%2Farena%2FCargo.toml", "raw_url": "https://github.com/rust-lang/rust/raw/986e8e9e5aa0665fef8ed6967ce6c66c8ed7c51a/lib%2Farena%2FCargo.toml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/lib%2Farena%2FCargo.toml?ref=986e8e9e5aa0665fef8ed6967ce6c66c8ed7c51a", "patch": "@@ -3,8 +3,8 @@ name = \"la-arena\"\n version = \"0.1.0\"\n description = \"Thy rope of sands...\"\n license = \"MIT OR Apache-2.0\"\n+repository = \"https://github.com/rust-analyzer/rust-analyzer\"\n+documentation = \"https://docs.rs/la-arena\"\n+categories = [\"data-structures\", \"memory-management\", \"rust-patterns\"]\n authors = [\"rust-analyzer developers\"]\n edition = \"2018\"\n-\n-[lib]\n-doctest = false"}, {"sha": "78a147c7d18edcf5392b4acb280704ba7378f5a0", "filename": "lib/arena/src/lib.rs", "status": "modified", "additions": 79, "deletions": 1, "changes": 80, "blob_url": "https://github.com/rust-lang/rust/blob/986e8e9e5aa0665fef8ed6967ce6c66c8ed7c51a/lib%2Farena%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/986e8e9e5aa0665fef8ed6967ce6c66c8ed7c51a/lib%2Farena%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/lib%2Farena%2Fsrc%2Flib.rs?ref=986e8e9e5aa0665fef8ed6967ce6c66c8ed7c51a", "patch": "@@ -1,4 +1,6 @@\n-//! Yet another index-based arena.\n+//! Yet another ID-based arena.\n+\n+#![warn(missing_docs)]\n \n use std::{\n     fmt,\n@@ -10,6 +12,7 @@ use std::{\n \n pub mod map;\n \n+/// The raw ID of a value in an arena.\n #[derive(Clone, Copy, PartialEq, Eq, PartialOrd, Ord, Hash)]\n pub struct RawId(u32);\n \n@@ -37,6 +40,7 @@ impl fmt::Display for RawId {\n     }\n }\n \n+/// The ID of a value allocated in an arena that holds `T`s.\n pub struct Idx<T> {\n     raw: RawId,\n     _ty: PhantomData<fn() -> T>,\n@@ -73,14 +77,18 @@ impl<T> fmt::Debug for Idx<T> {\n }\n \n impl<T> Idx<T> {\n+    /// Creates a new ID from a [`RawId`].\n     pub fn from_raw(raw: RawId) -> Self {\n         Idx { raw, _ty: PhantomData }\n     }\n+\n+    /// Converts this ID into the underlying [`RawId`].\n     pub fn into_raw(self) -> RawId {\n         self.raw\n     }\n }\n \n+/// Yet another ID-based arena.\n #[derive(Clone, PartialEq, Eq)]\n pub struct Arena<T> {\n     data: Vec<T>,\n@@ -93,29 +101,99 @@ impl<T: fmt::Debug> fmt::Debug for Arena<T> {\n }\n \n impl<T> Arena<T> {\n+    /// Creates a new empty arena.\n+    ///\n+    /// ```\n+    /// let arena: la_arena::Arena<i32> = la_arena::Arena::new();\n+    /// assert!(arena.is_empty());\n+    /// ```\n     pub const fn new() -> Arena<T> {\n         Arena { data: Vec::new() }\n     }\n+\n+    /// Empties the arena, removing all contained values.\n+    ///\n+    /// ```\n+    /// let mut arena = la_arena::Arena::new();\n+    ///\n+    /// arena.alloc(1);\n+    /// arena.alloc(2);\n+    /// arena.alloc(3);\n+    /// assert_eq!(arena.len(), 3);\n+    ///\n+    /// arena.clear();\n+    /// assert!(arena.is_empty());\n+    /// ```\n     pub fn clear(&mut self) {\n         self.data.clear();\n     }\n \n+    /// Returns the length of the arena.\n+    ///\n+    /// ```\n+    /// let mut arena = la_arena::Arena::new();\n+    /// assert_eq!(arena.len(), 0);\n+    ///\n+    /// arena.alloc(\"foo\");\n+    /// assert_eq!(arena.len(), 1);\n+    ///\n+    /// arena.alloc(\"bar\");\n+    /// assert_eq!(arena.len(), 2);\n+    ///\n+    /// arena.alloc(\"baz\");\n+    /// assert_eq!(arena.len(), 3);\n+    /// ```\n     pub fn len(&self) -> usize {\n         self.data.len()\n     }\n+\n+    /// Returns whether the arena contains no elements.\n+    ///\n+    /// ```\n+    /// let mut arena = la_arena::Arena::new();\n+    /// assert!(arena.is_empty());\n+    ///\n+    /// arena.alloc(0.5);\n+    /// assert!(!arena.is_empty());\n+    /// ```\n     pub fn is_empty(&self) -> bool {\n         self.data.is_empty()\n     }\n+\n+    /// Allocates a new value on the arena, returning the value\u2019s ID.\n+    ///\n+    /// ```\n+    /// let mut arena = la_arena::Arena::new();\n+    /// let id = arena.alloc(50);\n+    ///\n+    /// assert_eq!(arena[id], 50);\n+    /// ```\n     pub fn alloc(&mut self, value: T) -> Idx<T> {\n         let id = RawId(self.data.len() as u32);\n         self.data.push(value);\n         Idx::from_raw(id)\n     }\n+\n+    /// Returns an iterator over the arena\u2019s elements.\n+    ///\n+    /// ```\n+    /// let mut arena = la_arena::Arena::new();\n+    /// let id1 = arena.alloc(20);\n+    /// let id2 = arena.alloc(40);\n+    /// let id3 = arena.alloc(60);\n+    ///\n+    /// let mut iterator = arena.iter();\n+    /// assert_eq!(iterator.next(), Some((id1, &20)));\n+    /// assert_eq!(iterator.next(), Some((id2, &40)));\n+    /// assert_eq!(iterator.next(), Some((id3, &60)));\n+    /// ```\n     pub fn iter(\n         &self,\n     ) -> impl Iterator<Item = (Idx<T>, &T)> + ExactSizeIterator + DoubleEndedIterator {\n         self.data.iter().enumerate().map(|(idx, value)| (Idx::from_raw(RawId(idx as u32)), value))\n     }\n+\n+    /// Reallocates the arena to make it take up as little space as possible.\n     pub fn shrink_to_fit(&mut self) {\n         self.data.shrink_to_fit();\n     }"}, {"sha": "9801982477ed7c34dd76e960fd921b139df7d693", "filename": "lib/arena/src/map.rs", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/rust-lang/rust/blob/986e8e9e5aa0665fef8ed6967ce6c66c8ed7c51a/lib%2Farena%2Fsrc%2Fmap.rs", "raw_url": "https://github.com/rust-lang/rust/raw/986e8e9e5aa0665fef8ed6967ce6c66c8ed7c51a/lib%2Farena%2Fsrc%2Fmap.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/lib%2Farena%2Fsrc%2Fmap.rs?ref=986e8e9e5aa0665fef8ed6967ce6c66c8ed7c51a", "patch": "@@ -12,29 +12,35 @@ pub struct ArenaMap<ID, V> {\n }\n \n impl<T, V> ArenaMap<Idx<T>, V> {\n+    /// Inserts a value associated with a given arena ID into the map.\n     pub fn insert(&mut self, id: Idx<T>, t: V) {\n         let idx = Self::to_idx(id);\n \n         self.v.resize_with((idx + 1).max(self.v.len()), || None);\n         self.v[idx] = Some(t);\n     }\n \n+    /// Returns a reference to the value associated with the provided ID if it is present.\n     pub fn get(&self, id: Idx<T>) -> Option<&V> {\n         self.v.get(Self::to_idx(id)).and_then(|it| it.as_ref())\n     }\n \n+    /// Returns a mutable reference to the value associated with the provided ID if it is present.\n     pub fn get_mut(&mut self, id: Idx<T>) -> Option<&mut V> {\n         self.v.get_mut(Self::to_idx(id)).and_then(|it| it.as_mut())\n     }\n \n+    /// Returns an iterator over the values in the map.\n     pub fn values(&self) -> impl Iterator<Item = &V> {\n         self.v.iter().filter_map(|o| o.as_ref())\n     }\n \n+    /// Returns an iterator over mutable references to the values in the map.\n     pub fn values_mut(&mut self) -> impl Iterator<Item = &mut V> {\n         self.v.iter_mut().filter_map(|o| o.as_mut())\n     }\n \n+    /// Returns an iterator over the arena IDs and values in the map.\n     pub fn iter(&self) -> impl Iterator<Item = (Idx<T>, &V)> {\n         self.v.iter().enumerate().filter_map(|(idx, o)| Some((Self::from_idx(idx), o.as_ref()?)))\n     }"}]}