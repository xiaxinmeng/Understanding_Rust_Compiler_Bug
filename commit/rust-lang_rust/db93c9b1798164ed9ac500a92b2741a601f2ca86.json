{"sha": "db93c9b1798164ed9ac500a92b2741a601f2ca86", "node_id": "MDY6Q29tbWl0NzI0NzEyOmRiOTNjOWIxNzk4MTY0ZWQ5YWM1MDBhOTJiMjc0MWE2MDFmMmNhODY=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2019-03-16T06:56:32Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2019-03-16T14:39:36Z"}, "message": "Rollup merge of #59036 - dlrobertson:fix_59021, r=estebank\n\nFix ICE in MIR pretty printing\n\nA `Def::Variant` should be considered as a function in mir pretty\nprinting. Each variant has a constructor that we must print.\n\nGiven the following enum definition:\n\n```rust\npub enum TestMe {\n    X(usize),\n}\n```\n\nWe will need to generate a constructor for the variant `X` with a\nsignature that looks something like the following:\n\n```\nfn TestMe::X(_1: usize) -> TestMe;\n```\n\nFixes: #59021", "tree": {"sha": "ab5572817cc02411680d06ee094edbc1e951cf5a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ab5572817cc02411680d06ee094edbc1e951cf5a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/db93c9b1798164ed9ac500a92b2741a601f2ca86", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlyNCqgACgkQ/vbIBR0O\nATzLmg/7BfjOBsiqwA9Rs0TmCj88zzQAqT6t4C2sRXz5Nn9eYCW+85D4gSjYLJit\nw+lNt3yRhqYuZmgavAxHdlOWo0PIc8St9550EFihcSDJCKSdxFpurI6rs3boiYf2\n4C25l1c3ANFTEFXv60qzn7VihBOW7UfbG0TUDpR6jQVCO2J2HI+4ExegjuOc85sM\nUvG/xHqBEfujn6ECPIyJw6WoGLyrR0EBOxJrEAGBoGWACWajKcjJoL/0JplzCbzD\n6sedGW7jKSeDItDsz5aWh6Br0NujFptdQGUkRIea1FFssOQERRCISQW1X5Fq3C16\npGhSQZPwjxZc8P6heqLUCU8k5KsYE5PeGN2MgD6DIHPdvhMYt4KzeTarXnL0+OO0\nmdebkyjsLNbWKNl41w23NBklQ+q37EkR1D57aJ+mU+2flCvxkBre9IztyxrT7cJR\nlJ35K7bJ52lElQRNJwBse8oE0tYCwyvirtqxLPY0NihX97pObRdy1K+ubcbntyOi\ngG3AiKnZ/fs+2hCLFTrIY6KSxQqHx7+sIuv47OGILr2saJlGQWDqTlvZC/ItzIdo\nr6g30l2aZQSs8c/qZLkHIfZFr8FVvdSRuCRRX9BfePfPtbPUwtwSnLJKdD7eHbyE\n4sCuI3zZXZP/0UVkmk1IdWQR5boYkLu9MelgcVTrcC8GuJeJfJY=\n=0cRD\n-----END PGP SIGNATURE-----", "payload": "tree ab5572817cc02411680d06ee094edbc1e951cf5a\nparent 9d7450372648d5c15837d007a2ac77f84fb6cc58\nparent 3a83cb2c9ba2acca0577a5f4a092d7fc5b243faf\nauthor kennytm <kennytm@gmail.com> 1552719392 +0800\ncommitter kennytm <kennytm@gmail.com> 1552747176 +0800\n\nRollup merge of #59036 - dlrobertson:fix_59021, r=estebank\n\nFix ICE in MIR pretty printing\n\nA `Def::Variant` should be considered as a function in mir pretty\nprinting. Each variant has a constructor that we must print.\n\nGiven the following enum definition:\n\n```rust\npub enum TestMe {\n    X(usize),\n}\n```\n\nWe will need to generate a constructor for the variant `X` with a\nsignature that looks something like the following:\n\n```\nfn TestMe::X(_1: usize) -> TestMe;\n```\n\nFixes: #59021\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/db93c9b1798164ed9ac500a92b2741a601f2ca86", "html_url": "https://github.com/rust-lang/rust/commit/db93c9b1798164ed9ac500a92b2741a601f2ca86", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/db93c9b1798164ed9ac500a92b2741a601f2ca86/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9d7450372648d5c15837d007a2ac77f84fb6cc58", "url": "https://api.github.com/repos/rust-lang/rust/commits/9d7450372648d5c15837d007a2ac77f84fb6cc58", "html_url": "https://github.com/rust-lang/rust/commit/9d7450372648d5c15837d007a2ac77f84fb6cc58"}, {"sha": "3a83cb2c9ba2acca0577a5f4a092d7fc5b243faf", "url": "https://api.github.com/repos/rust-lang/rust/commits/3a83cb2c9ba2acca0577a5f4a092d7fc5b243faf", "html_url": "https://github.com/rust-lang/rust/commit/3a83cb2c9ba2acca0577a5f4a092d7fc5b243faf"}], "stats": {"total": 22, "additions": 21, "deletions": 1}, "files": [{"sha": "c7c77d351a75f5b2bea9e92e745e14e299f87c5d", "filename": "src/librustc_mir/util/pretty.rs", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/db93c9b1798164ed9ac500a92b2741a601f2ca86/src%2Flibrustc_mir%2Futil%2Fpretty.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db93c9b1798164ed9ac500a92b2741a601f2ca86/src%2Flibrustc_mir%2Futil%2Fpretty.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Futil%2Fpretty.rs?ref=db93c9b1798164ed9ac500a92b2741a601f2ca86", "patch": "@@ -1,4 +1,5 @@\n use rustc::hir::def_id::{DefId, LOCAL_CRATE};\n+use rustc::hir::def::CtorKind;\n use rustc::mir::*;\n use rustc::mir::visit::Visitor;\n use rustc::ty::{self, TyCtxt};\n@@ -596,7 +597,8 @@ fn write_mir_sig(\n     trace!(\"write_mir_sig: {:?}\", src.instance);\n     let descr = tcx.describe_def(src.def_id());\n     let is_function = match descr {\n-        Some(Def::Fn(_)) | Some(Def::Method(_)) | Some(Def::StructCtor(..)) => true,\n+        Some(Def::Fn(_)) | Some(Def::Method(_)) | Some(Def::Variant(..)) |\n+        Some(Def::StructCtor(_, CtorKind::Fn)) => true,\n         _ => tcx.is_closure(src.def_id()),\n     };\n     match (descr, src.promoted) {"}, {"sha": "ced30381fda68cb0f81a16151a9f3005297456bb", "filename": "src/test/mir-opt/unusual-item-types.rs", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/rust-lang/rust/blob/db93c9b1798164ed9ac500a92b2741a601f2ca86/src%2Ftest%2Fmir-opt%2Funusual-item-types.rs", "raw_url": "https://github.com/rust-lang/rust/raw/db93c9b1798164ed9ac500a92b2741a601f2ca86/src%2Ftest%2Fmir-opt%2Funusual-item-types.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fmir-opt%2Funusual-item-types.rs?ref=db93c9b1798164ed9ac500a92b2741a601f2ca86", "patch": "@@ -7,11 +7,18 @@ impl A {\n     const ASSOCIATED_CONSTANT: i32 = 2;\n }\n \n+// See #59021\n+enum Test {\n+    X(usize),\n+    Y { a: usize },\n+}\n+\n enum E {\n     V = 5,\n }\n \n fn main() {\n+    let f = Test::X as fn(usize) -> Test;\n     let v = Vec::<i32>::new();\n }\n \n@@ -64,3 +71,14 @@ fn main() {\n //     _3 = const std::ops::Drop::drop(move _2) -> [return: bb6, unwind: bb5];\n // }\n // END rustc.ptr-real_drop_in_place.std__vec__Vec_i32_.AddMovesForPackedDrops.before.mir\n+\n+// START rustc.Test-X.mir_map.0.mir\n+// fn Test::X(_1: usize) -> Test {\n+//     let mut _0: Test;\n+//\n+//     bb0: {\n+//         _0 = Test::X(move _1,);\n+//         return;\n+//     }\n+// }\n+// END rustc.Test-X.mir_map.0.mir"}]}