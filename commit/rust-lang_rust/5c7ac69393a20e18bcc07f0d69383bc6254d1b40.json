{"sha": "5c7ac69393a20e18bcc07f0d69383bc6254d1b40", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjN2FjNjkzOTNhMjBlMThiY2MwN2YwZDY5MzgzYmM2MjU0ZDFiNDA=", "commit": {"author": {"name": "Ayaz Hafiz", "email": "ayaz.hafiz.1@gmail.com", "date": "2020-07-16T01:27:19Z"}, "committer": {"name": "Caleb Cartwright", "email": "calebcartwright@users.noreply.github.com", "date": "2021-08-18T02:55:26Z"}, "message": "Warn when rate limit is on docs page\n\nDemo: https://5f0fad2f06c62143ac519413--festive-golick-afb5e0.netlify.app", "tree": {"sha": "56d0af66dec56f997c42b184e15a9fbeb27307b0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/56d0af66dec56f997c42b184e15a9fbeb27307b0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5c7ac69393a20e18bcc07f0d69383bc6254d1b40", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5c7ac69393a20e18bcc07f0d69383bc6254d1b40", "html_url": "https://github.com/rust-lang/rust/commit/5c7ac69393a20e18bcc07f0d69383bc6254d1b40", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5c7ac69393a20e18bcc07f0d69383bc6254d1b40/comments", "author": {"login": "ayazhafiz", "id": 20735482, "node_id": "MDQ6VXNlcjIwNzM1NDgy", "avatar_url": "https://avatars.githubusercontent.com/u/20735482?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ayazhafiz", "html_url": "https://github.com/ayazhafiz", "followers_url": "https://api.github.com/users/ayazhafiz/followers", "following_url": "https://api.github.com/users/ayazhafiz/following{/other_user}", "gists_url": "https://api.github.com/users/ayazhafiz/gists{/gist_id}", "starred_url": "https://api.github.com/users/ayazhafiz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ayazhafiz/subscriptions", "organizations_url": "https://api.github.com/users/ayazhafiz/orgs", "repos_url": "https://api.github.com/users/ayazhafiz/repos", "events_url": "https://api.github.com/users/ayazhafiz/events{/privacy}", "received_events_url": "https://api.github.com/users/ayazhafiz/received_events", "type": "User", "site_admin": false}, "committer": {"login": "calebcartwright", "id": 13042488, "node_id": "MDQ6VXNlcjEzMDQyNDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13042488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebcartwright", "html_url": "https://github.com/calebcartwright", "followers_url": "https://api.github.com/users/calebcartwright/followers", "following_url": "https://api.github.com/users/calebcartwright/following{/other_user}", "gists_url": "https://api.github.com/users/calebcartwright/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebcartwright/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebcartwright/subscriptions", "organizations_url": "https://api.github.com/users/calebcartwright/orgs", "repos_url": "https://api.github.com/users/calebcartwright/repos", "events_url": "https://api.github.com/users/calebcartwright/events{/privacy}", "received_events_url": "https://api.github.com/users/calebcartwright/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f5c782f321572e7eece7d42c51a049c1ae825b5a", "url": "https://api.github.com/repos/rust-lang/rust/commits/f5c782f321572e7eece7d42c51a049c1ae825b5a", "html_url": "https://github.com/rust-lang/rust/commit/f5c782f321572e7eece7d42c51a049c1ae825b5a"}], "stats": {"total": 58, "additions": 45, "deletions": 13}, "files": [{"sha": "eb5ded4ac30eb5ce2f145e3ef1e88cd40a4df98b", "filename": "docs/index.html", "status": "modified", "additions": 45, "deletions": 13, "changes": 58, "blob_url": "https://github.com/rust-lang/rust/blob/5c7ac69393a20e18bcc07f0d69383bc6254d1b40/docs%2Findex.html", "raw_url": "https://github.com/rust-lang/rust/raw/5c7ac69393a20e18bcc07f0d69383bc6254d1b40/docs%2Findex.html", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Findex.html?ref=5c7ac69393a20e18bcc07f0d69383bc6254d1b40", "patch": "@@ -116,20 +116,22 @@\n                   if (this.version !== this.oldVersion) {\n                     const ConfigurationMdUrl =\n                       `https://raw.githubusercontent.com/rust-lang/rustfmt/${this.version}/Configurations.md`;\n+                    let res;\n                     try {\n-                      const res = await axios.get(ConfigurationMdUrl);\n-                      const {\n-                        about,\n-                        configurationAbout,\n-                        configurationDescriptions\n-                      } = parseMarkdownAst(res.data);\n-                      this.aboutHtml = marked.parser(about);\n-                      this.configurationAboutHtml = marked.parser(configurationAbout);\n-                      this.configurationDescriptions = configurationDescriptions;\n-                      this.oldVersion = this.version;\n-                    } catch(error) {\n-                        this.aboutHtml = \"<p>Failed to get configuration options for this version, please select the version from the dropdown above.</p>\";\n+                      res = await axios.get(ConfigurationMdUrl).catch(e => { throw e });\n+                    } catch(e) {\n+                      this.handleReqFailure(e);\n+                      return;\n                     }\n+                    const {\n+                      about,\n+                      configurationAbout,\n+                      configurationDescriptions\n+                    } = parseMarkdownAst(res.data);\n+                    this.aboutHtml = marked.parser(about);\n+                    this.configurationAboutHtml = marked.parser(configurationAbout);\n+                    this.configurationDescriptions = configurationDescriptions;\n+                    this.oldVersion = this.version;\n                   }\n \n                   const ast = this.configurationDescriptions\n@@ -172,7 +174,13 @@\n                 }\n               },\n               created: async function() {\n-                const {data: tags} = await axios.get(RusfmtTagsUrl);\n+                let tags;\n+                try {\n+                  tags = (await axios.get(RusfmtTagsUrl)).data;\n+                } catch(e) {\n+                  this.handleReqFailure(e);\n+                  return;\n+                }\n                 const reMajorVersion = /v(\\d+)/;\n                 const tagOptions = tags\n                   .map(tag => tag.name)\n@@ -188,6 +196,30 @@\n                     this.scrolledOnce = true;\n                   }\n                 });\n+              },\n+              methods: {\n+                handleReqFailure(e) {\n+                  if (e.response.status === 404) {\n+                    this.aboutHtml =\n+                      \"<p>Failed to get configuration options for this version, please select the version from the dropdown above.</p>\";\n+                  } else if (\n+                    e.response.status === 403 &&\n+                    e.response.headers[\"X-RateLimit-Remaining\"] === 0\n+                  ) {\n+                    const resetDate = new Date(\n+                      e.response.headers['X-RateLimit-Reset'] * 1000\n+                    ).toLocaleString();\n+                    this.aboutHtml =\n+                      `<p>You have hit the GitHub API rate limit; documentation cannot be updated.` +\n+                      `<p>The rate limit will be reset at ${resetDate}.</p>`;\n+                  } else {\n+                    this.aboutHtml =\n+                      `<p>Ecountered an error when fetching documentation data:</p>` +\n+                      `<pre><code>${e.response.data}</code></pre>` +\n+                      `<p>We would appreciate <a href=\"https://github.com/rust-lang/rustfmt/issues/new?template=bug_report.md\">a bug report</a>.` +\n+                      `<p>Try refreshing the page.</p>`;\n+                  }\n+                }\n               }\n             });\n             const extractDepthOnes = (ast) => {"}]}