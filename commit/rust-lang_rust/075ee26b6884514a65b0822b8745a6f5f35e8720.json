{"sha": "075ee26b6884514a65b0822b8745a6f5f35e8720", "node_id": "C_kwDOAAsO6NoAKDA3NWVlMjZiNjg4NDUxNGE2NWIwODIyYjg3NDVhNmY1ZjM1ZTg3MjA", "commit": {"author": {"name": "Jules Bertholet", "email": "julesbertholet@quoi.xyz", "date": "2022-10-22T16:13:03Z"}, "committer": {"name": "Jules Bertholet", "email": "julesbertholet@quoi.xyz", "date": "2023-04-27T03:41:07Z"}, "message": "Loosen `From<&[T]> for Box<[T]>` bound to T: Clone", "tree": {"sha": "096ae71a14e1386ed1c9bdadcdd938d81812290a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/096ae71a14e1386ed1c9bdadcdd938d81812290a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/075ee26b6884514a65b0822b8745a6f5f35e8720", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEMF9QrRtpLpRzqgMeMgNNr8OMG/wFAmRJ7tUACgkQMgNNr8OM\nG/xNNw/+PIVF5+jDiDpx1y0V3xUYgc9FPQq7MmDDFLuRcCv2rJZIvpZqU1fp+yCM\nH7IOYo5cB0/aF3mbgm6BcKIlylKhnYKRc0Vv1wEl+UETh6HR72cDrfqk/shOQmqZ\nwlXkX5qOvWRWfv7ITK8jwfK7i8VPNUGkdlVgRQGVpZVNbahNBThxMKjMgopTk1Fz\nyxRbugN/Nrn+M/FAcOZY43HFqtwGGwa1yRBpgLSe8/A3RvyzVePmxdeY5n5iJTa9\nQSomR23+bFBHb+iNmKqwWFVJZy6BS6+gejJi3K2rtLSP1EZRZdXNOT62LBChH3cX\nMPWMMYCsoJaVrooW4EQ7oOohXmlJKvugGFJzrT0XkssJ6yEUr0v2nsySd1N0u59m\nVCj8+00ePutyJtGpmGZr7dGpOihkXydNdzE2bdGZghlW5k0RijRW7SAkpbX2JWov\nMXJsyzvHZ3JCQI9MkxPMZuEqm7oa4bmxS1cIzsxwCtErWLbeegKvn6K29VC5gZ5t\nQ+jp2qhJyVp1UoFXNij/GzR8vYQlS+zL4zU90//SGMqpPEh/8k6+dnZQK4pjs+Yf\nkmj6sZOqfKpf9nBO+Wa+lmrtU7JdexyLFKcKNovgzo+UzWJfMiYszno8krkmGJOZ\n2DpeFJ1ijJ67wmteoDfK6Hebq8iDAiuylPqfjP0sh/PNVPifEWY=\n=+dGd\n-----END PGP SIGNATURE-----", "payload": "tree 096ae71a14e1386ed1c9bdadcdd938d81812290a\nparent 1c42cb4ef0544fbfaa500216e53382d6b079c001\nauthor Jules Bertholet <julesbertholet@quoi.xyz> 1666455183 -0400\ncommitter Jules Bertholet <julesbertholet@quoi.xyz> 1682566867 -0400\n\nLoosen `From<&[T]> for Box<[T]>` bound to T: Clone\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/075ee26b6884514a65b0822b8745a6f5f35e8720", "html_url": "https://github.com/rust-lang/rust/commit/075ee26b6884514a65b0822b8745a6f5f35e8720", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/075ee26b6884514a65b0822b8745a6f5f35e8720/comments", "author": {"login": "Jules-Bertholet", "id": 79955405, "node_id": "MDQ6VXNlcjc5OTU1NDA1", "avatar_url": "https://avatars.githubusercontent.com/u/79955405?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jules-Bertholet", "html_url": "https://github.com/Jules-Bertholet", "followers_url": "https://api.github.com/users/Jules-Bertholet/followers", "following_url": "https://api.github.com/users/Jules-Bertholet/following{/other_user}", "gists_url": "https://api.github.com/users/Jules-Bertholet/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jules-Bertholet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jules-Bertholet/subscriptions", "organizations_url": "https://api.github.com/users/Jules-Bertholet/orgs", "repos_url": "https://api.github.com/users/Jules-Bertholet/repos", "events_url": "https://api.github.com/users/Jules-Bertholet/events{/privacy}", "received_events_url": "https://api.github.com/users/Jules-Bertholet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Jules-Bertholet", "id": 79955405, "node_id": "MDQ6VXNlcjc5OTU1NDA1", "avatar_url": "https://avatars.githubusercontent.com/u/79955405?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jules-Bertholet", "html_url": "https://github.com/Jules-Bertholet", "followers_url": "https://api.github.com/users/Jules-Bertholet/followers", "following_url": "https://api.github.com/users/Jules-Bertholet/following{/other_user}", "gists_url": "https://api.github.com/users/Jules-Bertholet/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jules-Bertholet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jules-Bertholet/subscriptions", "organizations_url": "https://api.github.com/users/Jules-Bertholet/orgs", "repos_url": "https://api.github.com/users/Jules-Bertholet/repos", "events_url": "https://api.github.com/users/Jules-Bertholet/events{/privacy}", "received_events_url": "https://api.github.com/users/Jules-Bertholet/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1c42cb4ef0544fbfaa500216e53382d6b079c001", "url": "https://api.github.com/repos/rust-lang/rust/commits/1c42cb4ef0544fbfaa500216e53382d6b079c001", "html_url": "https://github.com/rust-lang/rust/commit/1c42cb4ef0544fbfaa500216e53382d6b079c001"}], "stats": {"total": 38, "additions": 30, "deletions": 8}, "files": [{"sha": "2a26661cab4a70edfa29f90f8a9114242b0cee00", "filename": "library/alloc/src/boxed.rs", "status": "modified", "additions": 30, "deletions": 8, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/075ee26b6884514a65b0822b8745a6f5f35e8720/library%2Falloc%2Fsrc%2Fboxed.rs", "raw_url": "https://github.com/rust-lang/rust/raw/075ee26b6884514a65b0822b8745a6f5f35e8720/library%2Falloc%2Fsrc%2Fboxed.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fboxed.rs?ref=075ee26b6884514a65b0822b8745a6f5f35e8720", "patch": "@@ -1455,9 +1455,35 @@ where\n     }\n }\n \n+/// Specialization trait used for `From<&[T]>`.\n+trait BoxFromSlice<T> {\n+    fn from_slice(slice: &[T]) -> Self;\n+}\n+\n+#[cfg(not(no_global_oom_handling))]\n+impl<T: Clone> BoxFromSlice<T> for Box<[T]> {\n+    #[inline]\n+    default fn from_slice(slice: &[T]) -> Self {\n+        slice.to_vec().into_boxed_slice()\n+    }\n+}\n+\n+#[cfg(not(no_global_oom_handling))]\n+impl<T: Copy> BoxFromSlice<T> for Box<[T]> {\n+    #[inline]\n+    fn from_slice(slice: &[T]) -> Self {\n+        let len = slice.len();\n+        let buf = RawVec::with_capacity(len);\n+        unsafe {\n+            ptr::copy_nonoverlapping(slice.as_ptr(), buf.ptr(), len);\n+            buf.into_box(slice.len()).assume_init()\n+        }\n+    }\n+}\n+\n #[cfg(not(no_global_oom_handling))]\n #[stable(feature = \"box_from_slice\", since = \"1.17.0\")]\n-impl<T: Copy> From<&[T]> for Box<[T]> {\n+impl<T: Clone> From<&[T]> for Box<[T]> {\n     /// Converts a `&[T]` into a `Box<[T]>`\n     ///\n     /// This conversion allocates on the heap\n@@ -1471,19 +1497,15 @@ impl<T: Copy> From<&[T]> for Box<[T]> {\n     ///\n     /// println!(\"{boxed_slice:?}\");\n     /// ```\n+    #[inline]\n     fn from(slice: &[T]) -> Box<[T]> {\n-        let len = slice.len();\n-        let buf = RawVec::with_capacity(len);\n-        unsafe {\n-            ptr::copy_nonoverlapping(slice.as_ptr(), buf.ptr(), len);\n-            buf.into_box(slice.len()).assume_init()\n-        }\n+        <Self as BoxFromSlice<T>>::from_slice(slice)\n     }\n }\n \n #[cfg(not(no_global_oom_handling))]\n #[stable(feature = \"box_from_cow\", since = \"1.45.0\")]\n-impl<T: Copy> From<Cow<'_, [T]>> for Box<[T]> {\n+impl<T: Clone> From<Cow<'_, [T]>> for Box<[T]> {\n     /// Converts a `Cow<'_, [T]>` into a `Box<[T]>`\n     ///\n     /// When `cow` is the `Cow::Borrowed` variant, this"}]}