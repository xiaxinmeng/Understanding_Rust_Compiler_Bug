{"sha": "66fd262962624db0a72f0aafff49a7c74601beb8", "node_id": "MDY6Q29tbWl0NzI0NzEyOjY2ZmQyNjI5NjI2MjRkYjBhNzJmMGFhZmZmNDlhN2M3NDYwMWJlYjg=", "commit": {"author": {"name": "Daiki Ihara", "email": "sasurau4@gmail.com", "date": "2020-12-21T06:50:59Z"}, "committer": {"name": "Daiki Ihara", "email": "sasurau4@gmail.com", "date": "2020-12-21T06:55:40Z"}, "message": "Fix assist test logic", "tree": {"sha": "7e481dbc5a6e374ef86bb83d5901d8457c080f2e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/7e481dbc5a6e374ef86bb83d5901d8457c080f2e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/66fd262962624db0a72f0aafff49a7c74601beb8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/66fd262962624db0a72f0aafff49a7c74601beb8", "html_url": "https://github.com/rust-lang/rust/commit/66fd262962624db0a72f0aafff49a7c74601beb8", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/66fd262962624db0a72f0aafff49a7c74601beb8/comments", "author": {"login": "sasurau4", "id": 13580199, "node_id": "MDQ6VXNlcjEzNTgwMTk5", "avatar_url": "https://avatars.githubusercontent.com/u/13580199?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sasurau4", "html_url": "https://github.com/sasurau4", "followers_url": "https://api.github.com/users/sasurau4/followers", "following_url": "https://api.github.com/users/sasurau4/following{/other_user}", "gists_url": "https://api.github.com/users/sasurau4/gists{/gist_id}", "starred_url": "https://api.github.com/users/sasurau4/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sasurau4/subscriptions", "organizations_url": "https://api.github.com/users/sasurau4/orgs", "repos_url": "https://api.github.com/users/sasurau4/repos", "events_url": "https://api.github.com/users/sasurau4/events{/privacy}", "received_events_url": "https://api.github.com/users/sasurau4/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sasurau4", "id": 13580199, "node_id": "MDQ6VXNlcjEzNTgwMTk5", "avatar_url": "https://avatars.githubusercontent.com/u/13580199?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sasurau4", "html_url": "https://github.com/sasurau4", "followers_url": "https://api.github.com/users/sasurau4/followers", "following_url": "https://api.github.com/users/sasurau4/following{/other_user}", "gists_url": "https://api.github.com/users/sasurau4/gists{/gist_id}", "starred_url": "https://api.github.com/users/sasurau4/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sasurau4/subscriptions", "organizations_url": "https://api.github.com/users/sasurau4/orgs", "repos_url": "https://api.github.com/users/sasurau4/repos", "events_url": "https://api.github.com/users/sasurau4/events{/privacy}", "received_events_url": "https://api.github.com/users/sasurau4/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2b4a7848a89e788142a9b74f43a023a2e5c777b9", "url": "https://api.github.com/repos/rust-lang/rust/commits/2b4a7848a89e788142a9b74f43a023a2e5c777b9", "html_url": "https://github.com/rust-lang/rust/commit/2b4a7848a89e788142a9b74f43a023a2e5c777b9"}], "stats": {"total": 8, "additions": 6, "deletions": 2}, "files": [{"sha": "b41f4874a5d4107f3597b423d7b114587f5dfc6b", "filename": "crates/assists/src/tests.rs", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/66fd262962624db0a72f0aafff49a7c74601beb8/crates%2Fassists%2Fsrc%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/66fd262962624db0a72f0aafff49a7c74601beb8/crates%2Fassists%2Fsrc%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fassists%2Fsrc%2Ftests.rs?ref=66fd262962624db0a72f0aafff49a7c74601beb8", "patch": "@@ -123,8 +123,12 @@ fn check(handler: Handler, before: &str, expected: ExpectedResult, assist_label:\n             for file_system_edit in source_change.file_system_edits.clone() {\n                 match file_system_edit {\n                     FileSystemEdit::CreateFile { dst, initial_contents } => {\n-                        let target_dst = dst.path;\n-                        format_to!(buf, \"//- {}\\n\", target_dst);\n+                        let sr = db.file_source_root(dst.anchor);\n+                        let sr = db.source_root(sr);\n+                        let mut base = sr.path_for_file(&dst.anchor).unwrap().clone();\n+                        base.pop();\n+                        let created_file_path = format!(\"{}{}\", base.to_string(), &dst.path[1..]);\n+                        format_to!(buf, \"//- {}\\n\", created_file_path);\n                         buf.push_str(&initial_contents);\n                     }\n                     _ => (),"}]}