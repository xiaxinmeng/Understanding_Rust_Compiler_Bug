{"sha": "3c4bc8c8ad4eabed2650208e7037ad01170d7897", "node_id": "MDY6Q29tbWl0NzI0NzEyOjNjNGJjOGM4YWQ0ZWFiZWQyNjUwMjA4ZTcwMzdhZDAxMTcwZDc4OTc=", "commit": {"author": {"name": "ThePuzzlemaker", "email": "tpzker@thepuzzlemaker.info", "date": "2020-12-01T18:57:19Z"}, "committer": {"name": "ThePuzzlemaker", "email": "tpzker@thepuzzlemaker.info", "date": "2020-12-01T19:30:08Z"}, "message": "Ignore trait implementations with negative polarity when suggesting trait implementations in diagnostics", "tree": {"sha": "bf2f49d95f42f5bc704cba9fb0fabfa516b5cbd7", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bf2f49d95f42f5bc704cba9fb0fabfa516b5cbd7"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/3c4bc8c8ad4eabed2650208e7037ad01170d7897", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCAAdFiEEcJXCCpIkPbZRdwewlozZ1xyfu2wFAl/GmcAACgkQlozZ1xyf\nu2zxFwwApsvJDe40Yfof5fzGg8XyczCE7zCr0BumIp4QRHLjpe/IDqJsWUxkQAbb\n1KrD/UiX1URbZCUIy4dit0TEX94gPO2zgzK9n8v5ZqLsCVaNF8MaOHD0x743B/cm\nrLB3l6lJOGzc2tqYBJbCCGDavqzCqcbr5XYKGd+s8xipD1Bpd3xb00Bz3NLD4WmZ\n22FkC6pPJkH2QTlDvPwgfPrpIP5NXeLuVahAMQGRa85oEg4MoYEZyTuUWGbGE/5L\nxMbAGORAYgwUbVc024/uC91rXaVewcUygIHUWczYnAJ1gEpOYkytzioM/JrAzjbU\nx1UXK+2Rwgn1/2svMNFU74dzPwchhRU2rHm/ZfFGzStEAKi7IeiT7uqZSQQmvw9w\nB8vBh1gfGT0lejBX4ERhIqIn4HzB6iBzRnzVORpc19/O26tQ/Af3nu7Wo0Xcjz7H\nNtWgci25f4NPbT32xKY7l9woheuKnfRUAD8yNAEBcJPso80fpgu6t/1CrCQkCMGn\nh9Im4CVM\n=9ykT\n-----END PGP SIGNATURE-----", "payload": "tree bf2f49d95f42f5bc704cba9fb0fabfa516b5cbd7\nparent 4cbda829c00af2c3ac362c979fa97ea90be0be7d\nauthor ThePuzzlemaker <tpzker@thepuzzlemaker.info> 1606849039 -0600\ncommitter ThePuzzlemaker <tpzker@thepuzzlemaker.info> 1606851008 -0600\n\nIgnore trait implementations with negative polarity when suggesting trait implementations in diagnostics\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/3c4bc8c8ad4eabed2650208e7037ad01170d7897", "html_url": "https://github.com/rust-lang/rust/commit/3c4bc8c8ad4eabed2650208e7037ad01170d7897", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/3c4bc8c8ad4eabed2650208e7037ad01170d7897/comments", "author": {"login": "ThePuzzlemaker", "id": 12666617, "node_id": "MDQ6VXNlcjEyNjY2NjE3", "avatar_url": "https://avatars.githubusercontent.com/u/12666617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThePuzzlemaker", "html_url": "https://github.com/ThePuzzlemaker", "followers_url": "https://api.github.com/users/ThePuzzlemaker/followers", "following_url": "https://api.github.com/users/ThePuzzlemaker/following{/other_user}", "gists_url": "https://api.github.com/users/ThePuzzlemaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThePuzzlemaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThePuzzlemaker/subscriptions", "organizations_url": "https://api.github.com/users/ThePuzzlemaker/orgs", "repos_url": "https://api.github.com/users/ThePuzzlemaker/repos", "events_url": "https://api.github.com/users/ThePuzzlemaker/events{/privacy}", "received_events_url": "https://api.github.com/users/ThePuzzlemaker/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ThePuzzlemaker", "id": 12666617, "node_id": "MDQ6VXNlcjEyNjY2NjE3", "avatar_url": "https://avatars.githubusercontent.com/u/12666617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ThePuzzlemaker", "html_url": "https://github.com/ThePuzzlemaker", "followers_url": "https://api.github.com/users/ThePuzzlemaker/followers", "following_url": "https://api.github.com/users/ThePuzzlemaker/following{/other_user}", "gists_url": "https://api.github.com/users/ThePuzzlemaker/gists{/gist_id}", "starred_url": "https://api.github.com/users/ThePuzzlemaker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ThePuzzlemaker/subscriptions", "organizations_url": "https://api.github.com/users/ThePuzzlemaker/orgs", "repos_url": "https://api.github.com/users/ThePuzzlemaker/repos", "events_url": "https://api.github.com/users/ThePuzzlemaker/events{/privacy}", "received_events_url": "https://api.github.com/users/ThePuzzlemaker/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4cbda829c00af2c3ac362c979fa97ea90be0be7d", "url": "https://api.github.com/repos/rust-lang/rust/commits/4cbda829c00af2c3ac362c979fa97ea90be0be7d", "html_url": "https://github.com/rust-lang/rust/commit/4cbda829c00af2c3ac362c979fa97ea90be0be7d"}], "stats": {"total": 12, "additions": 11, "deletions": 1}, "files": [{"sha": "9feba7bfc492f5523653a0a1f4ba1f44dda1dc87", "filename": "compiler/rustc_trait_selection/src/traits/error_reporting/mod.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/3c4bc8c8ad4eabed2650208e7037ad01170d7897/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/3c4bc8c8ad4eabed2650208e7037ad01170d7897/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_trait_selection%2Fsrc%2Ftraits%2Ferror_reporting%2Fmod.rs?ref=3c4bc8c8ad4eabed2650208e7037ad01170d7897", "patch": "@@ -1310,10 +1310,20 @@ impl<'a, 'tcx> InferCtxtPrivExt<'tcx> for InferCtxt<'a, 'tcx> {\n                             return None;\n                         }\n                     }\n+                    if self.tcx.impl_polarity(def_id) == ty::ImplPolarity::Negative {\n+                        return None;\n+                    }\n                     Some(imp)\n                 })\n                 .collect(),\n-            None => all_impls.map(|def_id| self.tcx.impl_trait_ref(def_id).unwrap()).collect(),\n+            None => all_impls\n+                .filter_map(|def_id| {\n+                    if self.tcx.impl_polarity(def_id) == ty::ImplPolarity::Negative {\n+                        return None;\n+                    }\n+                    self.tcx.impl_trait_ref(def_id)\n+                })\n+                .collect(),\n         }\n     }\n "}]}