{"sha": "564326a6268d199c1b3c3d67d270c708da7b30ec", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU2NDMyNmE2MjY4ZDE5OWMxYjNjM2Q2N2QyNzBjNzA4ZGE3YjMwZWM=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-06-19T15:34:35Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-06-19T15:34:35Z"}, "message": "Rollup merge of #60667 - oli-obk:raw_from_raw_parts, r=sfackler\n\n Add functions for building raw slices to libcore\n\nimplement https://github.com/rust-lang/rust/issues/36925", "tree": {"sha": "6d943f1f7b4c886836e33b5e18f0f7a928543b2a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6d943f1f7b4c886836e33b5e18f0f7a928543b2a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/564326a6268d199c1b3c3d67d270c708da7b30ec", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJdClYLCRBK7hj4Ov3rIwAAdHIIAH3cYYrjK+Dfvc2O+U4GMEoA\n9Y0V9aRpgCBAcD+LdbYjAu0ePuPoxmh/m9u61AjzbFv9fV/Rp2MFHL6B/y4EjC2m\nYhQnHljgmez0upeTrwBS5tnNON9RkOqYHBp6WlKiwwZAfyVqzYLFBjQajpElqKTA\nhwOhF+O++WG21B/6QrOPTGIAtdnFxEsk/jvHiftlyB0TzeZgGoWISHqLDJUYL1/F\nGadB1RhrZAx1N4AyGMBB97cH80dBD5zCShTDvtG23uAsG+WKDCP/bOeyHK09Kx6t\nYsoNL2rbnWsak8IbpUn8ozquJzBK4jK+CoX2wC7WyJTnol5dyx2052LW2wJvLas=\n=3nml\n-----END PGP SIGNATURE-----\n", "payload": "tree 6d943f1f7b4c886836e33b5e18f0f7a928543b2a\nparent e79b2a18a21e6b178d73473bb8fdbf3d18c66051\nparent 8b21b075f73c629c25e8225c78a2992aa6e1d874\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1560958475 +0200\ncommitter GitHub <noreply@github.com> 1560958475 +0200\n\nRollup merge of #60667 - oli-obk:raw_from_raw_parts, r=sfackler\n\n Add functions for building raw slices to libcore\n\nimplement https://github.com/rust-lang/rust/issues/36925\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/564326a6268d199c1b3c3d67d270c708da7b30ec", "html_url": "https://github.com/rust-lang/rust/commit/564326a6268d199c1b3c3d67d270c708da7b30ec", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/564326a6268d199c1b3c3d67d270c708da7b30ec/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e79b2a18a21e6b178d73473bb8fdbf3d18c66051", "url": "https://api.github.com/repos/rust-lang/rust/commits/e79b2a18a21e6b178d73473bb8fdbf3d18c66051", "html_url": "https://github.com/rust-lang/rust/commit/e79b2a18a21e6b178d73473bb8fdbf3d18c66051"}, {"sha": "8b21b075f73c629c25e8225c78a2992aa6e1d874", "url": "https://api.github.com/repos/rust-lang/rust/commits/8b21b075f73c629c25e8225c78a2992aa6e1d874", "html_url": "https://github.com/rust-lang/rust/commit/8b21b075f73c629c25e8225c78a2992aa6e1d874"}], "stats": {"total": 66, "additions": 50, "deletions": 16}, "files": [{"sha": "ba88fde6ebc97afa70aa3f7eddecafd1b93171ea", "filename": "src/libcore/ptr/mod.rs", "status": "modified", "additions": 47, "deletions": 0, "changes": 47, "blob_url": "https://github.com/rust-lang/rust/blob/564326a6268d199c1b3c3d67d270c708da7b30ec/src%2Flibcore%2Fptr%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/564326a6268d199c1b3c3d67d270c708da7b30ec/src%2Flibcore%2Fptr%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fptr%2Fmod.rs?ref=564326a6268d199c1b3c3d67d270c708da7b30ec", "patch": "@@ -230,6 +230,53 @@ pub const fn null<T>() -> *const T { 0 as *const T }\n #[rustc_promotable]\n pub const fn null_mut<T>() -> *mut T { 0 as *mut T }\n \n+#[repr(C)]\n+pub(crate) union Repr<T> {\n+    pub(crate) rust: *const [T],\n+    rust_mut: *mut [T],\n+    pub(crate) raw: FatPtr<T>,\n+}\n+\n+#[repr(C)]\n+pub(crate) struct FatPtr<T> {\n+    data: *const T,\n+    pub(crate) len: usize,\n+}\n+\n+/// Forms a slice from a pointer and a length.\n+///\n+/// The `len` argument is the number of **elements**, not the number of bytes.\n+///\n+/// # Examples\n+///\n+/// ```rust\n+/// #![feature(slice_from_raw_parts)]\n+/// use std::ptr;\n+///\n+/// // create a slice pointer when starting out with a pointer to the first element\n+/// let mut x = [5, 6, 7];\n+/// let ptr = &mut x[0] as *mut _;\n+/// let slice = ptr::slice_from_raw_parts_mut(ptr, 3);\n+/// assert_eq!(unsafe { &*slice }[2], 7);\n+/// ```\n+#[inline]\n+#[unstable(feature = \"slice_from_raw_parts\", reason = \"recently added\", issue = \"36925\")]\n+pub fn slice_from_raw_parts<T>(data: *const T, len: usize) -> *const [T] {\n+    unsafe { Repr { raw: FatPtr { data, len } }.rust }\n+}\n+\n+/// Performs the same functionality as [`from_raw_parts`], except that a\n+/// mutable slice is returned.\n+///\n+/// See the documentation of [`from_raw_parts`] for more details.\n+///\n+/// [`from_raw_parts`]: ../../std/slice/fn.from_raw_parts.html\n+#[inline]\n+#[unstable(feature = \"slice_from_raw_parts\", reason = \"recently added\", issue = \"36925\")]\n+pub fn slice_from_raw_parts_mut<T>(data: *mut T, len: usize) -> *mut [T] {\n+    unsafe { Repr { raw: FatPtr { data, len } }.rust_mut }\n+}\n+\n /// Swaps the values at two mutable locations of the same type, without\n /// deinitializing either.\n ///"}, {"sha": "af1b20a4c10cfc0539fba0d835bebca40b3994aa", "filename": "src/libcore/slice/mod.rs", "status": "modified", "additions": 3, "deletions": 16, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/564326a6268d199c1b3c3d67d270c708da7b30ec/src%2Flibcore%2Fslice%2Fmod.rs", "raw_url": "https://github.com/rust-lang/rust/raw/564326a6268d199c1b3c3d67d270c708da7b30ec/src%2Flibcore%2Fslice%2Fmod.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fslice%2Fmod.rs?ref=564326a6268d199c1b3c3d67d270c708da7b30ec", "patch": "@@ -45,19 +45,6 @@ pub mod memchr;\n mod rotate;\n mod sort;\n \n-#[repr(C)]\n-union Repr<'a, T: 'a> {\n-    rust: &'a [T],\n-    rust_mut: &'a mut [T],\n-    raw: FatPtr<T>,\n-}\n-\n-#[repr(C)]\n-struct FatPtr<T> {\n-    data: *const T,\n-    len: usize,\n-}\n-\n //\n // Extension traits\n //\n@@ -78,7 +65,7 @@ impl<T> [T] {\n     #[rustc_const_unstable(feature = \"const_slice_len\")]\n     pub const fn len(&self) -> usize {\n         unsafe {\n-            Repr { rust: self }.raw.len\n+            crate::ptr::Repr { rust: self }.raw.len\n         }\n     }\n \n@@ -5195,7 +5182,7 @@ pub unsafe fn from_raw_parts<'a, T>(data: *const T, len: usize) -> &'a [T] {\n     debug_assert!(data as usize % mem::align_of::<T>() == 0, \"attempt to create unaligned slice\");\n     debug_assert!(mem::size_of::<T>().saturating_mul(len) <= isize::MAX as usize,\n                   \"attempt to create slice covering half the address space\");\n-    Repr { raw: FatPtr { data, len } }.rust\n+    &*ptr::slice_from_raw_parts(data, len)\n }\n \n /// Performs the same functionality as [`from_raw_parts`], except that a\n@@ -5216,7 +5203,7 @@ pub unsafe fn from_raw_parts_mut<'a, T>(data: *mut T, len: usize) -> &'a mut [T]\n     debug_assert!(data as usize % mem::align_of::<T>() == 0, \"attempt to create unaligned slice\");\n     debug_assert!(mem::size_of::<T>().saturating_mul(len) <= isize::MAX as usize,\n                   \"attempt to create slice covering half the address space\");\n-    Repr { raw: FatPtr { data, len } }.rust_mut\n+    &mut *ptr::slice_from_raw_parts_mut(data, len)\n }\n \n /// Converts a reference to T into a slice of length 1 (without copying)."}]}