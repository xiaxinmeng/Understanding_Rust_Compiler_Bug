{"sha": "5c0673c371b4306e1e7fda8455af6fa3085a4627", "node_id": "MDY6Q29tbWl0NzI0NzEyOjVjMDY3M2MzNzFiNDMwNmUxZTdmZGE4NDU1YWY2ZmEzMDg1YTQ2Mjc=", "commit": {"author": {"name": "Caleb Cartwright", "email": "caleb.cartwright@outlook.com", "date": "2020-11-28T03:30:27Z"}, "committer": {"name": "Caleb Cartwright", "email": "calebcartwright@users.noreply.github.com", "date": "2020-11-28T23:41:21Z"}, "message": "refactor: update cfg_if attr parsing", "tree": {"sha": "bbd638d94878f31b4d38488d24bc1267a4453be8", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bbd638d94878f31b4d38488d24bc1267a4453be8"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/5c0673c371b4306e1e7fda8455af6fa3085a4627", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/5c0673c371b4306e1e7fda8455af6fa3085a4627", "html_url": "https://github.com/rust-lang/rust/commit/5c0673c371b4306e1e7fda8455af6fa3085a4627", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/5c0673c371b4306e1e7fda8455af6fa3085a4627/comments", "author": {"login": "calebcartwright", "id": 13042488, "node_id": "MDQ6VXNlcjEzMDQyNDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13042488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebcartwright", "html_url": "https://github.com/calebcartwright", "followers_url": "https://api.github.com/users/calebcartwright/followers", "following_url": "https://api.github.com/users/calebcartwright/following{/other_user}", "gists_url": "https://api.github.com/users/calebcartwright/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebcartwright/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebcartwright/subscriptions", "organizations_url": "https://api.github.com/users/calebcartwright/orgs", "repos_url": "https://api.github.com/users/calebcartwright/repos", "events_url": "https://api.github.com/users/calebcartwright/events{/privacy}", "received_events_url": "https://api.github.com/users/calebcartwright/received_events", "type": "User", "site_admin": false}, "committer": {"login": "calebcartwright", "id": 13042488, "node_id": "MDQ6VXNlcjEzMDQyNDg4", "avatar_url": "https://avatars.githubusercontent.com/u/13042488?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calebcartwright", "html_url": "https://github.com/calebcartwright", "followers_url": "https://api.github.com/users/calebcartwright/followers", "following_url": "https://api.github.com/users/calebcartwright/following{/other_user}", "gists_url": "https://api.github.com/users/calebcartwright/gists{/gist_id}", "starred_url": "https://api.github.com/users/calebcartwright/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calebcartwright/subscriptions", "organizations_url": "https://api.github.com/users/calebcartwright/orgs", "repos_url": "https://api.github.com/users/calebcartwright/repos", "events_url": "https://api.github.com/users/calebcartwright/events{/privacy}", "received_events_url": "https://api.github.com/users/calebcartwright/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4f32ce8434630ebb6e116bbb014f4a79a8af0dea", "url": "https://api.github.com/repos/rust-lang/rust/commits/4f32ce8434630ebb6e116bbb014f4a79a8af0dea", "html_url": "https://github.com/rust-lang/rust/commit/4f32ce8434630ebb6e116bbb014f4a79a8af0dea"}], "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "c8d427478dcc5fadb2408c31f72bbc2b41cf1475", "filename": "src/syntux/parser.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/5c0673c371b4306e1e7fda8455af6fa3085a4627/src%2Fsyntux%2Fparser.rs", "raw_url": "https://github.com/rust-lang/rust/raw/5c0673c371b4306e1e7fda8455af6fa3085a4627/src%2Fsyntux%2Fparser.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fsyntux%2Fparser.rs?ref=5c0673c371b4306e1e7fda8455af6fa3085a4627", "patch": "@@ -227,8 +227,16 @@ impl<'a> Parser<'a> {\n                 if !parser.eat_keyword(kw::If) {\n                     return Err(\"Expected `if`\");\n                 }\n+                // Inner attributes are not actually syntactically permitted here, but we don't\n+                // care about inner vs outer attributes in this position. Our purpose with this\n+                // special case parsing of cfg_if macros is to ensure we can correctly resolve\n+                // imported modules that may have a custom `path` defined.\n+                //\n+                // As such, we just need to advance the parser past the attribute and up to\n+                // to the opening brace.\n+                // See also https://github.com/rust-lang/rust/pull/79433\n                 parser\n-                    .parse_attribute(false)\n+                    .parse_attribute(rustc_parse::parser::attr::InnerAttrPolicy::Permitted)\n                     .map_err(|_| \"Failed to parse attributes\")?;\n             }\n "}]}