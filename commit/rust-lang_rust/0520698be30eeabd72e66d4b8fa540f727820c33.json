{"sha": "0520698be30eeabd72e66d4b8fa540f727820c33", "node_id": "MDY6Q29tbWl0NzI0NzEyOjA1MjA2OThiZTMwZWVhYmQ3MmU2NmQ0YjhmYTU0MGY3Mjc4MjBjMzM=", "commit": {"author": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2016-08-07T22:04:51Z"}, "committer": {"name": "Simonas Kazlauskas", "email": "git@kazlauskas.me", "date": "2016-09-06T14:19:36Z"}, "message": "Count and report time taken by MIR passes", "tree": {"sha": "1d12217a767b42438e5a48ac7f99860c721a2fad", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1d12217a767b42438e5a48ac7f99860c721a2fad"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/0520698be30eeabd72e66d4b8fa540f727820c33", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/0520698be30eeabd72e66d4b8fa540f727820c33", "html_url": "https://github.com/rust-lang/rust/commit/0520698be30eeabd72e66d4b8fa540f727820c33", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/0520698be30eeabd72e66d4b8fa540f727820c33/comments", "author": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nagisa", "id": 679122, "node_id": "MDQ6VXNlcjY3OTEyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/679122?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nagisa", "html_url": "https://github.com/nagisa", "followers_url": "https://api.github.com/users/nagisa/followers", "following_url": "https://api.github.com/users/nagisa/following{/other_user}", "gists_url": "https://api.github.com/users/nagisa/gists{/gist_id}", "starred_url": "https://api.github.com/users/nagisa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nagisa/subscriptions", "organizations_url": "https://api.github.com/users/nagisa/orgs", "repos_url": "https://api.github.com/users/nagisa/repos", "events_url": "https://api.github.com/users/nagisa/events{/privacy}", "received_events_url": "https://api.github.com/users/nagisa/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5114f8a29ba29c7a168b46ede82fb62d67a2d619", "url": "https://api.github.com/repos/rust-lang/rust/commits/5114f8a29ba29c7a168b46ede82fb62d67a2d619", "html_url": "https://github.com/rust-lang/rust/commit/5114f8a29ba29c7a168b46ede82fb62d67a2d619"}], "stats": {"total": 25, "additions": 13, "deletions": 12}, "files": [{"sha": "8cd5f5844d21c02e8f2b8a1fdd29165e46d6a8c9", "filename": "src/librustc/mir/transform.rs", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/0520698be30eeabd72e66d4b8fa540f727820c33/src%2Flibrustc%2Fmir%2Ftransform.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0520698be30eeabd72e66d4b8fa540f727820c33/src%2Flibrustc%2Fmir%2Ftransform.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fmir%2Ftransform.rs?ref=0520698be30eeabd72e66d4b8fa540f727820c33", "patch": "@@ -15,7 +15,9 @@ use mir::mir_map::MirMap;\n use mir::repr::{Mir, Promoted};\n use ty::TyCtxt;\n use syntax::ast::NodeId;\n+use util::common::time;\n \n+use std::borrow::Cow;\n use std::fmt;\n \n /// Where a specific Mir comes from.\n@@ -72,12 +74,12 @@ impl<'a, 'tcx> MirSource {\n /// Various information about pass.\n pub trait Pass {\n     // fn should_run(Session) to check if pass should run?\n-    fn name(&self) -> &str {\n+    fn name<'a>(&self) -> Cow<'static, str> {\n         let name = unsafe { ::std::intrinsics::type_name::<Self>() };\n         if let Some(tail) = name.rfind(\":\") {\n-            &name[tail+1..]\n+            Cow::from(&name[tail+1..])\n         } else {\n-            name\n+            Cow::from(name)\n         }\n     }\n     fn disambiguator<'a>(&'a self) -> Option<Box<fmt::Display+'a>> { None }\n@@ -162,11 +164,10 @@ impl<'a, 'tcx> Passes {\n     }\n \n     pub fn run_passes(&mut self, tcx: TyCtxt<'a, 'tcx, 'tcx>, map: &mut MirMap<'tcx>) {\n-        for pass in &mut self.plugin_passes {\n-            pass.run_pass(tcx, map, &mut self.pass_hooks);\n-        }\n-        for pass in &mut self.passes {\n-            pass.run_pass(tcx, map, &mut self.pass_hooks);\n+        let Passes { ref mut passes, ref mut plugin_passes, ref mut pass_hooks } = *self;\n+        for pass in plugin_passes.iter_mut().chain(passes.iter_mut()) {\n+            time(tcx.sess.time_passes(), &*pass.name(),\n+                 || pass.run_pass(tcx, map, pass_hooks));\n         }\n     }\n "}, {"sha": "694b017bbd70687a9f9c0334d731200baa989f18", "filename": "src/librustc_mir/transform/dump_mir.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/0520698be30eeabd72e66d4b8fa540f727820c33/src%2Flibrustc_mir%2Ftransform%2Fdump_mir.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0520698be30eeabd72e66d4b8fa540f727820c33/src%2Flibrustc_mir%2Ftransform%2Fdump_mir.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fdump_mir.rs?ref=0520698be30eeabd72e66d4b8fa540f727820c33", "patch": "@@ -26,7 +26,7 @@ impl<'b, 'tcx> MirPass<'tcx> for Marker<'b> {\n }\n \n impl<'b> Pass for Marker<'b> {\n-    fn name(&self) -> &str { self.0 }\n+    fn name(&self) -> ::std::borrow::Cow<'static, str> { String::from(self.0).into() }\n }\n \n pub struct Disambiguator<'a> {\n@@ -58,7 +58,7 @@ impl<'tcx> MirPassHook<'tcx> for DumpMir {\n     {\n         pretty::dump_mir(\n             tcx,\n-            pass.name(),\n+            &*pass.name(),\n             &Disambiguator {\n                 pass: pass,\n                 is_after: is_after"}, {"sha": "407e21616102cafc7d9ea67f9571c217329e974c", "filename": "src/librustc_mir/transform/simplify_branches.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0520698be30eeabd72e66d4b8fa540f727820c33/src%2Flibrustc_mir%2Ftransform%2Fsimplify_branches.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0520698be30eeabd72e66d4b8fa540f727820c33/src%2Flibrustc_mir%2Ftransform%2Fsimplify_branches.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fsimplify_branches.rs?ref=0520698be30eeabd72e66d4b8fa540f727820c33", "patch": "@@ -62,5 +62,5 @@ impl<'l> Pass for SimplifyBranches<'l> {\n     }\n \n     // avoid calling `type_name` - it contains `<'static>`\n-    fn name(&self) -> &str { \"SimplifyBranches\" }\n+    fn name(&self) -> ::std::borrow::Cow<'static, str> { \"SimplifyBranches\".into() }\n }"}, {"sha": "8e1b7b44976f33c0c2baf8875d646afff8e0ae6d", "filename": "src/librustc_mir/transform/simplify_cfg.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/0520698be30eeabd72e66d4b8fa540f727820c33/src%2Flibrustc_mir%2Ftransform%2Fsimplify_cfg.rs", "raw_url": "https://github.com/rust-lang/rust/raw/0520698be30eeabd72e66d4b8fa540f727820c33/src%2Flibrustc_mir%2Ftransform%2Fsimplify_cfg.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Ftransform%2Fsimplify_cfg.rs?ref=0520698be30eeabd72e66d4b8fa540f727820c33", "patch": "@@ -64,7 +64,7 @@ impl<'l> Pass for SimplifyCfg<'l> {\n     }\n \n     // avoid calling `type_name` - it contains `<'static>`\n-    fn name(&self) -> &str { \"SimplifyCfg\" }\n+    fn name(&self) -> ::std::borrow::Cow<'static, str> { \"SimplifyCfg\".into() }\n }\n \n pub struct CfgSimplifier<'a, 'tcx: 'a> {"}]}