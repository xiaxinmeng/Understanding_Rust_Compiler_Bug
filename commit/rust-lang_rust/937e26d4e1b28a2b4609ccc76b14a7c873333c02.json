{"sha": "937e26d4e1b28a2b4609ccc76b14a7c873333c02", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkzN2UyNmQ0ZTFiMjhhMmI0NjA5Y2NjNzZiMTRhN2M4NzMzMzNjMDI=", "commit": {"author": {"name": "DarkDrek", "email": "wackerei@gmail.com", "date": "2016-01-12T20:13:59Z"}, "committer": {"name": "DarkDrek", "email": "wackerei@gmail.com", "date": "2016-01-12T20:13:59Z"}, "message": "fixes parsing issue #767", "tree": {"sha": "ba3c58a966c575ac81f7f46647e9882ad8f505c0", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ba3c58a966c575ac81f7f46647e9882ad8f505c0"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/937e26d4e1b28a2b4609ccc76b14a7c873333c02", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/937e26d4e1b28a2b4609ccc76b14a7c873333c02", "html_url": "https://github.com/rust-lang/rust/commit/937e26d4e1b28a2b4609ccc76b14a7c873333c02", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/937e26d4e1b28a2b4609ccc76b14a7c873333c02/comments", "author": {"login": "DarkDrek", "id": 5347691, "node_id": "MDQ6VXNlcjUzNDc2OTE=", "avatar_url": "https://avatars.githubusercontent.com/u/5347691?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DarkDrek", "html_url": "https://github.com/DarkDrek", "followers_url": "https://api.github.com/users/DarkDrek/followers", "following_url": "https://api.github.com/users/DarkDrek/following{/other_user}", "gists_url": "https://api.github.com/users/DarkDrek/gists{/gist_id}", "starred_url": "https://api.github.com/users/DarkDrek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DarkDrek/subscriptions", "organizations_url": "https://api.github.com/users/DarkDrek/orgs", "repos_url": "https://api.github.com/users/DarkDrek/repos", "events_url": "https://api.github.com/users/DarkDrek/events{/privacy}", "received_events_url": "https://api.github.com/users/DarkDrek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "DarkDrek", "id": 5347691, "node_id": "MDQ6VXNlcjUzNDc2OTE=", "avatar_url": "https://avatars.githubusercontent.com/u/5347691?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DarkDrek", "html_url": "https://github.com/DarkDrek", "followers_url": "https://api.github.com/users/DarkDrek/followers", "following_url": "https://api.github.com/users/DarkDrek/following{/other_user}", "gists_url": "https://api.github.com/users/DarkDrek/gists{/gist_id}", "starred_url": "https://api.github.com/users/DarkDrek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DarkDrek/subscriptions", "organizations_url": "https://api.github.com/users/DarkDrek/orgs", "repos_url": "https://api.github.com/users/DarkDrek/repos", "events_url": "https://api.github.com/users/DarkDrek/events{/privacy}", "received_events_url": "https://api.github.com/users/DarkDrek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "36b82f3b00cfa7ce31f5c8cbe7e17114edc9adf4", "url": "https://api.github.com/repos/rust-lang/rust/commits/36b82f3b00cfa7ce31f5c8cbe7e17114edc9adf4", "html_url": "https://github.com/rust-lang/rust/commit/36b82f3b00cfa7ce31f5c8cbe7e17114edc9adf4"}], "stats": {"total": 35, "additions": 29, "deletions": 6}, "files": [{"sha": "25c863639214e8a49465072cfab57a39712d6dee", "filename": "src/expr.rs", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/937e26d4e1b28a2b4609ccc76b14a7c873333c02/src%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/937e26d4e1b28a2b4609ccc76b14a7c873333c02/src%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fexpr.rs?ref=937e26d4e1b28a2b4609ccc76b14a7c873333c02", "patch": "@@ -663,6 +663,7 @@ fn rewrite_if_else(context: &RewriteContext,\n     let between_if_cond = mk_sp(span_after(span, \"if\", context.codemap),\n                                 pat.map_or(cond.span.lo,\n                                            |_| span_before(span, \"let\", context.codemap)));\n+\n     let between_if_cond_comment = extract_comment(between_if_cond, &context, offset, width);\n \n     let after_cond_comment = extract_comment(mk_sp(cond.span.hi, if_block.span.lo),\n@@ -680,23 +681,23 @@ fn rewrite_if_else(context: &RewriteContext,\n         let rewrite = match else_block.node {\n             // If the else expression is another if-else expression, prevent it\n             // from being formatted on a single line.\n-            ast::Expr_::ExprIfLet(ref pat, ref cond, ref if_block, ref else_block) => {\n+            ast::Expr_::ExprIfLet(ref pat, ref cond, ref if_block, ref next_else_block) => {\n                 rewrite_if_else(context,\n                                 cond,\n                                 if_block,\n-                                else_block.as_ref().map(|e| &**e),\n-                                mk_sp(span_after(span, \"else\", context.codemap), span.hi),\n+                                next_else_block.as_ref().map(|e| &**e),\n+                                mk_sp(else_block.span.lo, span.hi),\n                                 Some(pat),\n                                 width,\n                                 offset,\n                                 false)\n             }\n-            ast::Expr_::ExprIf(ref cond, ref if_block, ref else_block) => {\n+            ast::Expr_::ExprIf(ref cond, ref if_block, ref next_else_block) => {\n                 rewrite_if_else(context,\n                                 cond,\n                                 if_block,\n-                                else_block.as_ref().map(|e| &**e),\n-                                mk_sp(span_after(span, \"else\", context.codemap), span.hi),\n+                                next_else_block.as_ref().map(|e| &**e),\n+                                mk_sp(else_block.span.lo, span.hi),\n                                 None,\n                                 width,\n                                 offset,"}, {"sha": "c5002f5ec15fd015ff23a5759250791cbd71017c", "filename": "tests/source/expr.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/937e26d4e1b28a2b4609ccc76b14a7c873333c02/tests%2Fsource%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/937e26d4e1b28a2b4609ccc76b14a7c873333c02/tests%2Fsource%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fsource%2Fexpr.rs?ref=937e26d4e1b28a2b4609ccc76b14a7c873333c02", "patch": "@@ -233,3 +233,14 @@ fn blocks() {\n         println!(\"yay arithmetix!\");\n     };\n }\n+\n+fn issue767() {\n+    if false {\n+        if false {\n+        } else {\n+            // A let binding here seems necessary to trigger it.\n+            let _ = ();\n+        }\n+    } else if let false = false {\n+    }\n+}"}, {"sha": "9c9c65a690cdc0505521f5136e0906e8c57c3742", "filename": "tests/target/expr.rs", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/937e26d4e1b28a2b4609ccc76b14a7c873333c02/tests%2Ftarget%2Fexpr.rs", "raw_url": "https://github.com/rust-lang/rust/raw/937e26d4e1b28a2b4609ccc76b14a7c873333c02/tests%2Ftarget%2Fexpr.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Ftarget%2Fexpr.rs?ref=937e26d4e1b28a2b4609ccc76b14a7c873333c02", "patch": "@@ -256,3 +256,14 @@ fn blocks() {\n         println!(\"yay arithmetix!\");\n     };\n }\n+\n+fn issue767() {\n+    if false {\n+        if false {\n+        } else {\n+            // A let binding here seems necessary to trigger it.\n+            let _ = ();\n+        }\n+    } else if let false = false {\n+    }\n+}"}]}