{"sha": "b3290fd14ce4d15ccd6e4719af5d98552cb85efd", "node_id": "MDY6Q29tbWl0NzI0NzEyOmIzMjkwZmQxNGNlNGQxNWNjZDZlNDcxOWFmNWQ5ODU1MmNiODVlZmQ=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-01-13T04:26:52Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-01-13T04:26:52Z"}, "message": "Rollup merge of #57473 - alexcrichton:hex-display-on-windows, r=Kimundi\n\nstd: Render large exit codes as hex on Windows\n\nOn Windows process exit codes are never signals but rather always 32-bit\nintegers. Most faults like segfaults and such end up having large\nintegers used to represent them, like STATUS_ACCESS_VIOLATION being\n0xC0000005. Currently, however, when an `ExitStatus` is printed this\nends up getting rendered as 3221225477 which is somewhat more difficult\nto debug.\n\nThis commit adds a branch in `Display for ExitStatus` on Windows which\nhandles exit statuses where the high bit is set and prints those exit\nstatuses as hex instead of with decimals. This will hopefully preserve\nthe current display for small exit statuses (like `exit code: 22`), but\nassist in quickly debugging segfaults/access violations/etc. I've\nfound at least that the hex codes are easier to search for than decimal.\n\nI wasn't able to find any official documentation saying that all system\nexit codes have the high bit set, but I figure it's a good enough\nheuristic for now.", "tree": {"sha": "859036d1df893992a90388b65bce38a924409a69", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/859036d1df893992a90388b65bce38a924409a69"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b3290fd14ce4d15ccd6e4719af5d98552cb85efd", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcOr4MCRBK7hj4Ov3rIwAAdHIIABD8I2UqCttagqJvphkYKO/h\nvaaEM4QM/i4p4G7Lh7qqfo3gVJJs6Bm8Yr6Hx/lBD1QuMAYw/2vs78XcukJd96bL\nkR326FS9doVevdAVVpGuQkNZNkZXi+sOs8u1bhKC/zEWsfR6HhmzrGZqmUebDLJj\nh++xFDk9FbqBkqtiGj3dtuIYU5Sqrv5aDL2EDkReZadak6YoW0HcUm2nq5oghq6s\nqx8rXFCMCjQjGVFRcUnui7X1sQjO+L3uMfx1G5iMCoGKQHYrOa++CDpNdBfvV5ah\ni35xQC2dLat1dzd6KcRxx8CXfsKxiBJjBhLhs5BL87zNDg0P8AoIV4CSPN4ygqM=\n=jVZl\n-----END PGP SIGNATURE-----\n", "payload": "tree 859036d1df893992a90388b65bce38a924409a69\nparent 0c53b45e8581e439cf890adaba857014f7ef1fdb\nparent bbb5448de447eeef2eae09a6df93553a6d1ccac7\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1547353612 +0100\ncommitter GitHub <noreply@github.com> 1547353612 +0100\n\nRollup merge of #57473 - alexcrichton:hex-display-on-windows, r=Kimundi\n\nstd: Render large exit codes as hex on Windows\n\nOn Windows process exit codes are never signals but rather always 32-bit\nintegers. Most faults like segfaults and such end up having large\nintegers used to represent them, like STATUS_ACCESS_VIOLATION being\n0xC0000005. Currently, however, when an `ExitStatus` is printed this\nends up getting rendered as 3221225477 which is somewhat more difficult\nto debug.\n\nThis commit adds a branch in `Display for ExitStatus` on Windows which\nhandles exit statuses where the high bit is set and prints those exit\nstatuses as hex instead of with decimals. This will hopefully preserve\nthe current display for small exit statuses (like `exit code: 22`), but\nassist in quickly debugging segfaults/access violations/etc. I've\nfound at least that the hex codes are easier to search for than decimal.\n\nI wasn't able to find any official documentation saying that all system\nexit codes have the high bit set, but I figure it's a good enough\nheuristic for now.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b3290fd14ce4d15ccd6e4719af5d98552cb85efd", "html_url": "https://github.com/rust-lang/rust/commit/b3290fd14ce4d15ccd6e4719af5d98552cb85efd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b3290fd14ce4d15ccd6e4719af5d98552cb85efd/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0c53b45e8581e439cf890adaba857014f7ef1fdb", "url": "https://api.github.com/repos/rust-lang/rust/commits/0c53b45e8581e439cf890adaba857014f7ef1fdb", "html_url": "https://github.com/rust-lang/rust/commit/0c53b45e8581e439cf890adaba857014f7ef1fdb"}, {"sha": "bbb5448de447eeef2eae09a6df93553a6d1ccac7", "url": "https://api.github.com/repos/rust-lang/rust/commits/bbb5448de447eeef2eae09a6df93553a6d1ccac7", "html_url": "https://github.com/rust-lang/rust/commit/bbb5448de447eeef2eae09a6df93553a6d1ccac7"}], "stats": {"total": 11, "additions": 10, "deletions": 1}, "files": [{"sha": "08a166bd8c50425f3c86f0963e78ec9c70514e5b", "filename": "src/libstd/sys/windows/process.rs", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/b3290fd14ce4d15ccd6e4719af5d98552cb85efd/src%2Flibstd%2Fsys%2Fwindows%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b3290fd14ce4d15ccd6e4719af5d98552cb85efd/src%2Flibstd%2Fsys%2Fwindows%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibstd%2Fsys%2Fwindows%2Fprocess.rs?ref=b3290fd14ce4d15ccd6e4719af5d98552cb85efd", "patch": "@@ -393,7 +393,16 @@ impl From<c::DWORD> for ExitStatus {\n \n impl fmt::Display for ExitStatus {\n     fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n-        write!(f, \"exit code: {}\", self.0)\n+        // Windows exit codes with the high bit set typically mean some form of\n+        // unhandled exception or warning. In this scenario printing the exit\n+        // code in decimal doesn't always make sense because it's a very large\n+        // and somewhat gibberish number. The hex code is a bit more\n+        // recognizable and easier to search for, so print that.\n+        if self.0 & 0x80000000 != 0 {\n+            write!(f, \"exit code: {:#x}\", self.0)\n+        } else {\n+            write!(f, \"exit code: {}\", self.0)\n+        }\n     }\n }\n "}]}