{"sha": "9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjljZWQ2OWRkNTc1OWZjODBlOTJiMWJhYzFjNWU4MWRlZjBjYzRjZTU=", "commit": {"author": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-05-16T15:22:59Z"}, "committer": {"name": "kennytm", "email": "kennytm@gmail.com", "date": "2018-05-16T21:18:14Z"}, "message": "Rollup merge of #50787 - ehuss:fix-run-make-wasm, r=alexcrichton\n\nFix run-make wasm tests\n\nFixes #50711", "tree": {"sha": "76d3c69bcb768624458550a0f28fe6aae3ec2b89", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/76d3c69bcb768624458550a0f28fe6aae3ec2b89"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEZ1R8CLMp8f2GxWoQ/vbIBR0OATwFAlr8oBcACgkQ/vbIBR0O\nATwYeA/9EuyMmybJskvc9nReo9rixpjxBjeG92p9M0lLx2SpUn+IHrHyTAK+NiJy\nwkUuuQykIG+W/bTWXviFjq3osmT6Gww9H0mG4DtCyJZPGmplv43yKr0P5b+0+J4J\n40YTp1sNXfgOI3/cDM63YSNFXM5LoyA+E5pB4DpHjXWp/UhcnrorH5Q92PCqtNNC\ncTYNBOXMvbDaTjkY3T8fPjYHCcjFPQHkrpzVRMd+bbgMPOwSNwZ3L9mIqbiStVm3\nXZnrSgQXzEAOPAY3ZdXt7eyT0M2uNN/v09OI5bmcNlb/P7WrQvCjbW7MLAOkXjW1\nmxXZAq+YH35mnQrN7OrN8KZXQDQICWPgEY2qXgfAFY8LlDKgyrx54aSoQTJ2+qOw\nzb+RABx8pmQNXPD+VntBW/I66cD7lZCo2vZ8leDLwl0l1c1kLoYNhTmdLEq3OPUr\njGO2d96zrT26JB5evFEkFhVyfCsZILDOzkeCD/96/7v2pPAfpiwRs3cZrj82cG19\nrX+AK73xHdSGcnYL5P5wjJNyHCTQYC22eLz2IN9uvYrJ99XdwEkWBY8cOXMzfRkl\nBgUiIk1xjGp/ZDfMAo1w2grnuOChS8J4F7IlhJVeQOG981SdUVGwOnfJOtOQnx4v\nBHZWMlYvXqEXlggRZgPfsSep46wfdD3CfNUSkrRqqnDew6evMH8=\n=1qkr\n-----END PGP SIGNATURE-----", "payload": "tree 76d3c69bcb768624458550a0f28fe6aae3ec2b89\nparent 380066bb664230f71369bfaf4325ff41c8a2371c\nparent a90a9632659a11264cf9a27273ecc83d52cb4e9f\nauthor kennytm <kennytm@gmail.com> 1526484179 +0800\ncommitter kennytm <kennytm@gmail.com> 1526505494 +0800\n\nRollup merge of #50787 - ehuss:fix-run-make-wasm, r=alexcrichton\n\nFix run-make wasm tests\n\nFixes #50711\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5", "html_url": "https://github.com/rust-lang/rust/commit/9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5/comments", "author": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kennytm", "id": 103023, "node_id": "MDQ6VXNlcjEwMzAyMw==", "avatar_url": "https://avatars.githubusercontent.com/u/103023?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kennytm", "html_url": "https://github.com/kennytm", "followers_url": "https://api.github.com/users/kennytm/followers", "following_url": "https://api.github.com/users/kennytm/following{/other_user}", "gists_url": "https://api.github.com/users/kennytm/gists{/gist_id}", "starred_url": "https://api.github.com/users/kennytm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kennytm/subscriptions", "organizations_url": "https://api.github.com/users/kennytm/orgs", "repos_url": "https://api.github.com/users/kennytm/repos", "events_url": "https://api.github.com/users/kennytm/events{/privacy}", "received_events_url": "https://api.github.com/users/kennytm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "380066bb664230f71369bfaf4325ff41c8a2371c", "url": "https://api.github.com/repos/rust-lang/rust/commits/380066bb664230f71369bfaf4325ff41c8a2371c", "html_url": "https://github.com/rust-lang/rust/commit/380066bb664230f71369bfaf4325ff41c8a2371c"}, {"sha": "a90a9632659a11264cf9a27273ecc83d52cb4e9f", "url": "https://api.github.com/repos/rust-lang/rust/commits/a90a9632659a11264cf9a27273ecc83d52cb4e9f", "html_url": "https://github.com/rust-lang/rust/commit/a90a9632659a11264cf9a27273ecc83d52cb4e9f"}], "stats": {"total": 12, "additions": 6, "deletions": 6}, "files": [{"sha": "1f81a617237cc0b82bd3cc1383b3accec1abd077", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5", "patch": "@@ -838,7 +838,7 @@ test!(RunFailFullDepsPretty {\n     host: true\n });\n \n-host_test!(RunMake {\n+default_test!(RunMake {\n     path: \"src/test/run-make\",\n     mode: \"run-make\",\n     suite: \"run-make\"\n@@ -1041,7 +1041,7 @@ impl Step for Compiletest {\n \n             // Only pass correct values for these flags for the `run-make` suite as it\n             // requires that a C++ compiler was configured which isn't always the case.\n-            if !builder.config.dry_run && mode == \"run-make\" {\n+            if !builder.config.dry_run && suite == \"run-make-fulldeps\" {\n                 let llvm_components = output(Command::new(&llvm_config).arg(\"--components\"));\n                 let llvm_cxxflags = output(Command::new(&llvm_config).arg(\"--cxxflags\"));\n                 cmd.arg(\"--cc\").arg(builder.cc(target))\n@@ -1054,13 +1054,13 @@ impl Step for Compiletest {\n                 }\n             }\n         }\n-        if mode == \"run-make\" && !builder.config.llvm_enabled {\n+        if suite == \"run-make-fulldeps\" && !builder.config.llvm_enabled {\n             builder.info(\n                 &format!(\"Ignoring run-make test suite as they generally don't work without LLVM\"));\n             return;\n         }\n \n-        if mode != \"run-make\" {\n+        if suite != \"run-make-fulldeps\" {\n             cmd.arg(\"--cc\").arg(\"\")\n                .arg(\"--cxx\").arg(\"\")\n                .arg(\"--cflags\").arg(\"\")"}, {"sha": "f5480178db0d14aff54b2ed1898a11fcf705b9b0", "filename": "src/test/run-make-fulldeps/cross-lang-lto/Makefile", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2FMakefile", "raw_url": "https://github.com/rust-lang/rust/raw/9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2FMakefile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2FMakefile?ref=9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5", "patch": "@@ -2,7 +2,7 @@\n # min-llvm-version 4.0\n # ignore-mingw\n \n--include ../../run-make-fulldeps/tools.mk\n+-include ../tools.mk\n \n # This test makes sure that the expected .llvmbc sections for use by\n # linker-based LTO are available in object files when compiling with", "previous_filename": "src/test/run-make/cross-lang-lto/Makefile"}, {"sha": "b2a5b946160f03edb827750e416e9f5576e2dffd", "filename": "src/test/run-make-fulldeps/cross-lang-lto/lib.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2Flib.rs?ref=9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5", "previous_filename": "src/test/run-make/cross-lang-lto/lib.rs"}, {"sha": "ccd34c9e4dbedc109152a91bc9bd0349c1b8a107", "filename": "src/test/run-make-fulldeps/cross-lang-lto/main.rs", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Frun-make-fulldeps%2Fcross-lang-lto%2Fmain.rs?ref=9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5", "previous_filename": "src/test/run-make/cross-lang-lto/main.rs"}, {"sha": "0899ebd5d80f732a40436ed3d06711e142ac27e7", "filename": "src/tools/compiletest/src/main.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs?ref=9ced69dd5759fc80e92b1bac1c5e81def0cc4ce5", "patch": "@@ -614,8 +614,8 @@ pub fn is_test(file_name: &OsString) -> bool {\n }\n \n pub fn make_test(config: &Config, testpaths: &TestPaths) -> test::TestDescAndFn {\n-\n     let early_props = if config.mode == Mode::RunMake {\n+        // Allow `ignore` directives to be in the Makefile.\n         EarlyProps::from_file(config, &testpaths.file.join(\"Makefile\"))\n     } else {\n         EarlyProps::from_file(config, &testpaths.file)"}]}