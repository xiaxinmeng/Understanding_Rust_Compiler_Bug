{"sha": "c2b74f9cc71d0d53a1f7c34070bde1df4bb31dfb", "node_id": "C_kwDOAAsO6NoAKGMyYjc0ZjljYzcxZDBkNTNhMWY3YzM0MDcwYmRlMWRmNGJiMzFkZmI", "commit": {"author": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2022-07-30T00:00:00Z"}, "committer": {"name": "Tomasz Mi\u0105sko", "email": "tomasz.miasko@gmail.com", "date": "2022-08-23T08:08:48Z"}, "message": "Remove support for adding statement to all successors\n\nThis feature of MIR patch system is no longer used.", "tree": {"sha": "282c9527ffaed771cdde711da1208385a2e3822d", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/282c9527ffaed771cdde711da1208385a2e3822d"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/c2b74f9cc71d0d53a1f7c34070bde1df4bb31dfb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/c2b74f9cc71d0d53a1f7c34070bde1df4bb31dfb", "html_url": "https://github.com/rust-lang/rust/commit/c2b74f9cc71d0d53a1f7c34070bde1df4bb31dfb", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/c2b74f9cc71d0d53a1f7c34070bde1df4bb31dfb/comments", "author": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tmiasko", "id": 51362316, "node_id": "MDQ6VXNlcjUxMzYyMzE2", "avatar_url": "https://avatars.githubusercontent.com/u/51362316?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tmiasko", "html_url": "https://github.com/tmiasko", "followers_url": "https://api.github.com/users/tmiasko/followers", "following_url": "https://api.github.com/users/tmiasko/following{/other_user}", "gists_url": "https://api.github.com/users/tmiasko/gists{/gist_id}", "starred_url": "https://api.github.com/users/tmiasko/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tmiasko/subscriptions", "organizations_url": "https://api.github.com/users/tmiasko/orgs", "repos_url": "https://api.github.com/users/tmiasko/repos", "events_url": "https://api.github.com/users/tmiasko/events{/privacy}", "received_events_url": "https://api.github.com/users/tmiasko/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "625af2cc7595e0908f4b557f59010f2eeda67de7", "url": "https://api.github.com/repos/rust-lang/rust/commits/625af2cc7595e0908f4b557f59010f2eeda67de7", "html_url": "https://github.com/rust-lang/rust/commit/625af2cc7595e0908f4b557f59010f2eeda67de7"}], "stats": {"total": 17, "additions": 0, "deletions": 17}, "files": [{"sha": "8aa761aae8d9017ee7fd67ef699a9612a7829a6f", "filename": "compiler/rustc_middle/src/mir/patch.rs", "status": "modified", "additions": 0, "deletions": 17, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/c2b74f9cc71d0d53a1f7c34070bde1df4bb31dfb/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fpatch.rs", "raw_url": "https://github.com/rust-lang/rust/raw/c2b74f9cc71d0d53a1f7c34070bde1df4bb31dfb/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fpatch.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_middle%2Fsrc%2Fmir%2Fpatch.rs?ref=c2b74f9cc71d0d53a1f7c34070bde1df4bb31dfb", "patch": "@@ -150,7 +150,6 @@ impl<'tcx> MirPatch<'tcx> {\n \n         let mut delta = 0;\n         let mut last_bb = START_BLOCK;\n-        let mut stmts_and_targets: Vec<(Statement<'_>, BasicBlock)> = Vec::new();\n         for (mut loc, stmt) in new_statements {\n             if loc.block != last_bb {\n                 delta = 0;\n@@ -159,27 +158,11 @@ impl<'tcx> MirPatch<'tcx> {\n             debug!(\"MirPatch: adding statement {:?} at loc {:?}+{}\", stmt, loc, delta);\n             loc.statement_index += delta;\n             let source_info = Self::source_info_for_index(&body[loc.block], loc);\n-\n-            // For mir-opt `Derefer` to work in all cases we need to\n-            // get terminator's targets and apply the statement to all of them.\n-            if loc.statement_index > body[loc.block].statements.len() {\n-                let term = body[loc.block].terminator();\n-                for i in term.successors() {\n-                    stmts_and_targets.push((Statement { source_info, kind: stmt.clone() }, i));\n-                }\n-                delta += 1;\n-                continue;\n-            }\n-\n             body[loc.block]\n                 .statements\n                 .insert(loc.statement_index, Statement { source_info, kind: stmt });\n             delta += 1;\n         }\n-\n-        for (stmt, target) in stmts_and_targets.into_iter().rev() {\n-            body[target].statements.insert(0, stmt);\n-        }\n     }\n \n     pub fn source_info_for_index(data: &BasicBlockData<'_>, loc: Location) -> SourceInfo {"}]}