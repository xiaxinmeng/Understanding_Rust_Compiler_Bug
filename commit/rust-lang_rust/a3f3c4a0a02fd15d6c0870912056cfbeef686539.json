{"sha": "a3f3c4a0a02fd15d6c0870912056cfbeef686539", "node_id": "MDY6Q29tbWl0NzI0NzEyOmEzZjNjNGEwYTAyZmQxNWQ2YzA4NzA5MTIwNTZjZmJlZWY2ODY1Mzk=", "commit": {"author": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2016-02-23T00:01:24Z"}, "committer": {"name": "Vadim Petrochenkov", "email": "vadim.petrochenkov@gmail.com", "date": "2016-02-23T00:01:24Z"}, "message": "Some refactoring in deriving/debug.rs", "tree": {"sha": "0977e8a2feb7e00ab5733d946cd5c9a81bd96d2a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/0977e8a2feb7e00ab5733d946cd5c9a81bd96d2a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/a3f3c4a0a02fd15d6c0870912056cfbeef686539", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/a3f3c4a0a02fd15d6c0870912056cfbeef686539", "html_url": "https://github.com/rust-lang/rust/commit/a3f3c4a0a02fd15d6c0870912056cfbeef686539", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/a3f3c4a0a02fd15d6c0870912056cfbeef686539/comments", "author": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "petrochenkov", "id": 5751617, "node_id": "MDQ6VXNlcjU3NTE2MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/5751617?v=4", "gravatar_id": "", "url": "https://api.github.com/users/petrochenkov", "html_url": "https://github.com/petrochenkov", "followers_url": "https://api.github.com/users/petrochenkov/followers", "following_url": "https://api.github.com/users/petrochenkov/following{/other_user}", "gists_url": "https://api.github.com/users/petrochenkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/petrochenkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/petrochenkov/subscriptions", "organizations_url": "https://api.github.com/users/petrochenkov/orgs", "repos_url": "https://api.github.com/users/petrochenkov/repos", "events_url": "https://api.github.com/users/petrochenkov/events{/privacy}", "received_events_url": "https://api.github.com/users/petrochenkov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4e8e607d8469a8882944233e4bb3ee45d2a6435a", "url": "https://api.github.com/repos/rust-lang/rust/commits/4e8e607d8469a8882944233e4bb3ee45d2a6435a", "html_url": "https://github.com/rust-lang/rust/commit/4e8e607d8469a8882944233e4bb3ee45d2a6435a"}], "stats": {"total": 11, "additions": 3, "deletions": 8}, "files": [{"sha": "323c6c388fb64d4042ae582632f37c0600d99984", "filename": "src/libsyntax_ext/deriving/debug.rs", "status": "modified", "additions": 3, "deletions": 8, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/a3f3c4a0a02fd15d6c0870912056cfbeef686539/src%2Flibsyntax_ext%2Fderiving%2Fdebug.rs", "raw_url": "https://github.com/rust-lang/rust/raw/a3f3c4a0a02fd15d6c0870912056cfbeef686539/src%2Flibsyntax_ext%2Fderiving%2Fdebug.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibsyntax_ext%2Fderiving%2Fdebug.rs?ref=a3f3c4a0a02fd15d6c0870912056cfbeef686539", "patch": "@@ -61,9 +61,9 @@ fn show_substructure(cx: &mut ExtCtxt, span: Span,\n     // build fmt.debug_struct(<name>).field(<fieldname>, &<fieldval>)....build()\n     // or fmt.debug_tuple(<name>).field(&<fieldval>)....build()\n     // based on the \"shape\".\n-    let ident = match *substr.fields {\n-        Struct(..) => substr.type_ident,\n-        EnumMatching(_, v, _) => v.node.name,\n+    let (ident, is_struct) = match *substr.fields {\n+        Struct(vdata, _) => (substr.type_ident, vdata.is_struct()),\n+        EnumMatching(_, v, _) => (v.node.name, v.node.data.is_struct()),\n         EnumNonMatchingCollapsed(..) | StaticStruct(..) | StaticEnum(..) => {\n             cx.span_bug(span, \"nonsensical .fields in `#[derive(Debug)]`\")\n         }\n@@ -76,11 +76,6 @@ fn show_substructure(cx: &mut ExtCtxt, span: Span,\n     let builder_expr = cx.expr_ident(span, builder.clone());\n \n     let fmt = substr.nonself_args[0].clone();\n-    let is_struct = match *substr.fields {\n-        Struct(vdata, _) => vdata,\n-        EnumMatching(_, v, _) => &v.node.data,\n-        _ => unreachable!()\n-    }.is_struct();\n \n     let stmts = match *substr.fields {\n         Struct(_, ref fields) | EnumMatching(_, _, ref fields) => {"}]}