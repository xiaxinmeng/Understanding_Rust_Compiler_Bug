{"sha": "d28a46444eacf066ea0e7fdf6eda066e315aaa4a", "node_id": "MDY6Q29tbWl0NzI0NzEyOmQyOGE0NjQ0NGVhY2YwNjZlYTBlN2ZkZjZlZGEwNjZlMzE1YWFhNGE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-04-13T07:34:11Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2020-04-13T07:34:11Z"}, "message": "Auto merge of #70882 - tmiasko:llvm-version-suffix, r=Mark-Simulacrum\n\nMake LLVM version suffix independent of rustc version on dev channel\n\nRemove rustc version from LLVM version suffix on dev channel,\navoiding the need for full rebuilds when switching between\nbranches with different LLVM submodule & rustc version.\n\nNote: To avoid full rebuild, on subsequent LLVM submodule update, copy the\ncurrent value of `LLVM_VERSION_SUFFIX` from `build/*/llvm/build/CMakeCache.txt`,\nto `version-suffix` in `config.toml`.", "tree": {"sha": "57d6ae5f460bb51e354813f95b0778b9b3ad9f03", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/57d6ae5f460bb51e354813f95b0778b9b3ad9f03"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/d28a46444eacf066ea0e7fdf6eda066e315aaa4a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/d28a46444eacf066ea0e7fdf6eda066e315aaa4a", "html_url": "https://github.com/rust-lang/rust/commit/d28a46444eacf066ea0e7fdf6eda066e315aaa4a", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/d28a46444eacf066ea0e7fdf6eda066e315aaa4a/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a00bd29e01c4042143d01681e45723a2052412b0", "url": "https://api.github.com/repos/rust-lang/rust/commits/a00bd29e01c4042143d01681e45723a2052412b0", "html_url": "https://github.com/rust-lang/rust/commit/a00bd29e01c4042143d01681e45723a2052412b0"}, {"sha": "7c5a4cdd669c9816df938a878147fe5b4645e951", "url": "https://api.github.com/repos/rust-lang/rust/commits/7c5a4cdd669c9816df938a878147fe5b4645e951", "html_url": "https://github.com/rust-lang/rust/commit/7c5a4cdd669c9816df938a878147fe5b4645e951"}], "stats": {"total": 15, "additions": 10, "deletions": 5}, "files": [{"sha": "9121d1e17992657ed18cf73b9b974823a66bd1d6", "filename": "config.toml.example", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/d28a46444eacf066ea0e7fdf6eda066e315aaa4a/config.toml.example", "raw_url": "https://github.com/rust-lang/rust/raw/d28a46444eacf066ea0e7fdf6eda066e315aaa4a/config.toml.example", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/config.toml.example?ref=d28a46444eacf066ea0e7fdf6eda066e315aaa4a", "patch": "@@ -84,8 +84,9 @@\n #link-shared = false\n \n # When building llvm, this configures what is being appended to the version.\n-# If absent, we let the version as-is.\n-#version-suffix = \"-rust\"\n+# The default is \"-rust-$version-$channel\", except for dev channel where rustc\n+# version number is omitted. To use LLVM version as is, provide an empty string.\n+#version-suffix = \"-rust-dev\"\n \n # On MSVC you can compile LLVM with clang-cl, but the test suite doesn't pass\n # with clang-cl, so this is special in that it only compiles LLVM with clang-cl"}, {"sha": "1e380a20629da7efa29357b5039441a39cae4d5c", "filename": "src/bootstrap/native.rs", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/d28a46444eacf066ea0e7fdf6eda066e315aaa4a/src%2Fbootstrap%2Fnative.rs", "raw_url": "https://github.com/rust-lang/rust/raw/d28a46444eacf066ea0e7fdf6eda066e315aaa4a/src%2Fbootstrap%2Fnative.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fnative.rs?ref=d28a46444eacf066ea0e7fdf6eda066e315aaa4a", "patch": "@@ -235,10 +235,14 @@ impl Step for Llvm {\n             if !suffix.is_empty() {\n                 cfg.define(\"LLVM_VERSION_SUFFIX\", suffix);\n             }\n+        } else if builder.config.channel == \"dev\" {\n+            // Changes to a version suffix require a complete rebuild of the LLVM.\n+            // To avoid rebuilds during a time of version bump, don't include rustc\n+            // release number on the dev channel.\n+            cfg.define(\"LLVM_VERSION_SUFFIX\", \"-rust-dev\");\n         } else {\n-            let default_suffix =\n-                format!(\"-rust-{}-{}\", channel::CFG_RELEASE_NUM, builder.config.channel);\n-            cfg.define(\"LLVM_VERSION_SUFFIX\", default_suffix);\n+            let suffix = format!(\"-rust-{}-{}\", channel::CFG_RELEASE_NUM, builder.config.channel);\n+            cfg.define(\"LLVM_VERSION_SUFFIX\", suffix);\n         }\n \n         if let Some(ref linker) = builder.config.llvm_use_linker {"}]}