{"sha": "500076e141c3c750a41201cec523cf9e9dabf6aa", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUwMDA3NmUxNDFjM2M3NTBhNDEyMDFjZWM1MjNjZjllOWRhYmY2YWE=", "commit": {"author": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-02-27T22:53:12Z"}, "committer": {"name": "Alex Crichton", "email": "alex@alexcrichton.com", "date": "2017-02-28T05:20:23Z"}, "message": "travis: Split Android into dist/test images\n\nPRs can't land againt beta right now because the android bot is filling up on\ndisk space. I don't really know what's going on but the android bot is the\nlongest one to run anyway so it'll benefit from being split up regardless.", "tree": {"sha": "49bfc3830effb6603c9a7d800fea8ebe5f55f615", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/49bfc3830effb6603c9a7d800fea8ebe5f55f615"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/500076e141c3c750a41201cec523cf9e9dabf6aa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/500076e141c3c750a41201cec523cf9e9dabf6aa", "html_url": "https://github.com/rust-lang/rust/commit/500076e141c3c750a41201cec523cf9e9dabf6aa", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/500076e141c3c750a41201cec523cf9e9dabf6aa/comments", "author": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "alexcrichton", "id": 64996, "node_id": "MDQ6VXNlcjY0OTk2", "avatar_url": "https://avatars.githubusercontent.com/u/64996?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcrichton", "html_url": "https://github.com/alexcrichton", "followers_url": "https://api.github.com/users/alexcrichton/followers", "following_url": "https://api.github.com/users/alexcrichton/following{/other_user}", "gists_url": "https://api.github.com/users/alexcrichton/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcrichton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcrichton/subscriptions", "organizations_url": "https://api.github.com/users/alexcrichton/orgs", "repos_url": "https://api.github.com/users/alexcrichton/repos", "events_url": "https://api.github.com/users/alexcrichton/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcrichton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3b4d54ab88fd522b2f02d7079c601ddec047eba8", "url": "https://api.github.com/repos/rust-lang/rust/commits/3b4d54ab88fd522b2f02d7079c601ddec047eba8", "html_url": "https://github.com/rust-lang/rust/commit/3b4d54ab88fd522b2f02d7079c601ddec047eba8"}], "stats": {"total": 107, "additions": 84, "deletions": 23}, "files": [{"sha": "442d02aca7867f27fe58e95a4e08f17777c9e8a2", "filename": ".travis.yml", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/rust-lang/rust/blob/500076e141c3c750a41201cec523cf9e9dabf6aa/.travis.yml", "raw_url": "https://github.com/rust-lang/rust/raw/500076e141c3c750a41201cec523cf9e9dabf6aa/.travis.yml", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/.travis.yml?ref=500076e141c3c750a41201cec523cf9e9dabf6aa", "patch": "@@ -12,10 +12,11 @@ matrix:\n   fast_finish: true\n   include:\n     # Linux builders, all docker images\n-    - env: IMAGE=android DEPLOY=1\n+    - env: IMAGE=arm-android\n     - env: IMAGE=armhf-gnu\n     - env: IMAGE=cross DEPLOY=1\n     - env: IMAGE=linux-tested-targets DEPLOY=1\n+    - env: IMAGE=dist-android DEPLOY=1\n     - env: IMAGE=dist-arm-linux DEPLOY=1\n     - env: IMAGE=dist-armv7-aarch64-linux DEPLOY=1\n     - env: IMAGE=dist-freebsd DEPLOY=1"}, {"sha": "bc439d6f7826d4f6bec937ac3f45886e50595316", "filename": "src/bootstrap/sanity.rs", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/500076e141c3c750a41201cec523cf9e9dabf6aa/src%2Fbootstrap%2Fsanity.rs", "raw_url": "https://github.com/rust-lang/rust/raw/500076e141c3c750a41201cec523cf9e9dabf6aa/src%2Fbootstrap%2Fsanity.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Fsanity.rs?ref=500076e141c3c750a41201cec523cf9e9dabf6aa", "patch": "@@ -198,10 +198,6 @@ $ pacman -R cmake && pacman -S mingw-w64-x86_64-cmake\n \");\n             }\n         }\n-\n-        if target.contains(\"arm-linux-android\") {\n-            need_cmd(\"adb\".as_ref());\n-        }\n     }\n \n     for host in build.flags.host.iter() {"}, {"sha": "4c89ce12531b4b85087d83d2b2c7c7bf0a308a6a", "filename": "src/ci/docker/arm-android/Dockerfile", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/rust-lang/rust/blob/500076e141c3c750a41201cec523cf9e9dabf6aa/src%2Fci%2Fdocker%2Farm-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/500076e141c3c750a41201cec523cf9e9dabf6aa/src%2Fci%2Fdocker%2Farm-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Farm-android%2FDockerfile?ref=500076e141c3c750a41201cec523cf9e9dabf6aa", "patch": "@@ -0,0 +1,46 @@\n+FROM ubuntu:16.04\n+\n+RUN dpkg --add-architecture i386 && \\\n+    apt-get update && \\\n+    apt-get install -y --no-install-recommends \\\n+  g++ \\\n+  make \\\n+  file \\\n+  curl \\\n+  ca-certificates \\\n+  python2.7 \\\n+  git \\\n+  cmake \\\n+  unzip \\\n+  expect \\\n+  openjdk-9-jre \\\n+  sudo \\\n+  libstdc++6:i386 \\\n+  xz-utils \\\n+  libssl-dev \\\n+  pkg-config\n+\n+WORKDIR /android/\n+ENV PATH=$PATH:/android/ndk-arm-9/bin:/android/sdk/tools:/android/sdk/platform-tools\n+\n+COPY install-ndk.sh install-sdk.sh accept-licenses.sh /android/\n+RUN sh /android/install-ndk.sh\n+RUN sh /android/install-sdk.sh\n+\n+RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n+    dpkg -i dumb-init_*.deb && \\\n+    rm dumb-init_*.deb\n+\n+COPY start-emulator.sh /android/\n+\n+ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\", \"/android/start-emulator.sh\"]\n+\n+RUN curl -o /usr/local/bin/sccache \\\n+      https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-02-24-sccache-x86_64-unknown-linux-gnu && \\\n+      chmod +x /usr/local/bin/sccache\n+\n+ENV RUST_CONFIGURE_ARGS \\\n+      --target=arm-linux-androideabi \\\n+      --arm-linux-androideabi-ndk=/android/ndk-arm-9\n+\n+ENV SCRIPT python2.7 ../x.py test --target arm-linux-androideabi"}, {"sha": "8d8f60a5ec2604606571cdb6a7d231d5754aa38f", "filename": "src/ci/docker/arm-android/accept-licenses.sh", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/500076e141c3c750a41201cec523cf9e9dabf6aa/src%2Fci%2Fdocker%2Farm-android%2Faccept-licenses.sh", "raw_url": "https://github.com/rust-lang/rust/raw/500076e141c3c750a41201cec523cf9e9dabf6aa/src%2Fci%2Fdocker%2Farm-android%2Faccept-licenses.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Farm-android%2Faccept-licenses.sh?ref=500076e141c3c750a41201cec523cf9e9dabf6aa", "previous_filename": "src/ci/docker/android/accept-licenses.sh"}, {"sha": "389ec062110e0e5681ef0d8385582e508afca44c", "filename": "src/ci/docker/arm-android/install-ndk.sh", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/rust-lang/rust/blob/500076e141c3c750a41201cec523cf9e9dabf6aa/src%2Fci%2Fdocker%2Farm-android%2Finstall-ndk.sh", "raw_url": "https://github.com/rust-lang/rust/raw/500076e141c3c750a41201cec523cf9e9dabf6aa/src%2Fci%2Fdocker%2Farm-android%2Finstall-ndk.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Farm-android%2Finstall-ndk.sh?ref=500076e141c3c750a41201cec523cf9e9dabf6aa", "patch": "@@ -0,0 +1,33 @@\n+#!/bin/sh\n+# Copyright 2016 The Rust Project Developers. See the COPYRIGHT\n+# file at the top-level directory of this distribution and at\n+# http://rust-lang.org/COPYRIGHT.\n+#\n+# Licensed under the Apache License, Version 2.0 <LICENSE-APACHE or\n+# http://www.apache.org/licenses/LICENSE-2.0> or the MIT license\n+# <LICENSE-MIT or http://opensource.org/licenses/MIT>, at your\n+# option. This file may not be copied, modified, or distributed\n+# except according to those terms.\n+\n+set -ex\n+\n+cpgdb() {\n+  cp android-ndk-r11c/prebuilt/linux-x86_64/bin/gdb /android/$1/bin/$2-gdb\n+  cp android-ndk-r11c/prebuilt/linux-x86_64/bin/gdb-orig /android/$1/bin/gdb-orig\n+  cp -r android-ndk-r11c/prebuilt/linux-x86_64/share /android/$1/share\n+}\n+\n+# Prep the Android NDK\n+#\n+# See https://github.com/servo/servo/wiki/Building-for-Android\n+curl -O https://dl.google.com/android/repository/android-ndk-r11c-linux-x86_64.zip\n+unzip -q android-ndk-r11c-linux-x86_64.zip\n+bash android-ndk-r11c/build/tools/make-standalone-toolchain.sh \\\n+        --platform=android-9 \\\n+        --toolchain=arm-linux-androideabi-4.9 \\\n+        --install-dir=/android/ndk-arm-9 \\\n+        --ndk-dir=/android/android-ndk-r11c \\\n+        --arch=arm\n+cpgdb ndk-arm-9 arm-linux-androideabi\n+\n+rm -rf ./android-ndk-r11c-linux-x86_64.zip ./android-ndk-r11c"}, {"sha": "2db1d46ba2273e89cfdb655ba59ef427ba0974ba", "filename": "src/ci/docker/arm-android/install-sdk.sh", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/500076e141c3c750a41201cec523cf9e9dabf6aa/src%2Fci%2Fdocker%2Farm-android%2Finstall-sdk.sh", "raw_url": "https://github.com/rust-lang/rust/raw/500076e141c3c750a41201cec523cf9e9dabf6aa/src%2Fci%2Fdocker%2Farm-android%2Finstall-sdk.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Farm-android%2Finstall-sdk.sh?ref=500076e141c3c750a41201cec523cf9e9dabf6aa", "previous_filename": "src/ci/docker/android/install-sdk.sh"}, {"sha": "24c477d87f1a72975a3f0fb650d37b3e82dd3f99", "filename": "src/ci/docker/arm-android/start-emulator.sh", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/rust-lang/rust/blob/500076e141c3c750a41201cec523cf9e9dabf6aa/src%2Fci%2Fdocker%2Farm-android%2Fstart-emulator.sh", "raw_url": "https://github.com/rust-lang/rust/raw/500076e141c3c750a41201cec523cf9e9dabf6aa/src%2Fci%2Fdocker%2Farm-android%2Fstart-emulator.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Farm-android%2Fstart-emulator.sh?ref=500076e141c3c750a41201cec523cf9e9dabf6aa", "previous_filename": "src/ci/docker/android/start-emulator.sh"}, {"sha": "6d433cc1509f2856471f61f315d5405c8999d9ff", "filename": "src/ci/docker/dist-android/Dockerfile", "status": "renamed", "additions": 3, "deletions": 11, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/500076e141c3c750a41201cec523cf9e9dabf6aa/src%2Fci%2Fdocker%2Fdist-android%2FDockerfile", "raw_url": "https://github.com/rust-lang/rust/raw/500076e141c3c750a41201cec523cf9e9dabf6aa/src%2Fci%2Fdocker%2Fdist-android%2FDockerfile", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-android%2FDockerfile?ref=500076e141c3c750a41201cec523cf9e9dabf6aa", "patch": "@@ -23,17 +23,13 @@ RUN dpkg --add-architecture i386 && \\\n WORKDIR /android/\n ENV PATH=$PATH:/android/ndk-arm-9/bin:/android/sdk/tools:/android/sdk/platform-tools\n \n-COPY install-ndk.sh install-sdk.sh accept-licenses.sh /android/\n+COPY install-ndk.sh /android/\n RUN sh /android/install-ndk.sh\n-RUN sh /android/install-sdk.sh\n \n RUN curl -OL https://github.com/Yelp/dumb-init/releases/download/v1.2.0/dumb-init_1.2.0_amd64.deb && \\\n     dpkg -i dumb-init_*.deb && \\\n     rm dumb-init_*.deb\n-\n-COPY start-emulator.sh /android/\n-\n-ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\", \"/android/start-emulator.sh\"]\n+ENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n \n RUN curl -o /usr/local/bin/sccache \\\n       https://s3.amazonaws.com/rust-lang-ci/rust-ci-mirror/2017-02-25-sccache-x86_64-unknown-linux-musl && \\\n@@ -51,8 +47,4 @@ ENV RUST_CONFIGURE_ARGS \\\n       --i686-linux-android-ndk=/android/ndk-x86-9 \\\n       --aarch64-linux-android-ndk=/android/ndk-aarch64\n \n-# Just a smoke test in dist to see if this works for now, we should expand this\n-# to all the targets above eventually.\n-ENV SCRIPT \\\n-  python2.7 ../x.py test --target arm-linux-androideabi && \\\n-  python2.7 ../x.py dist --target $TARGETS\n+ENV SCRIPT python2.7 ../x.py dist --target $TARGETS", "previous_filename": "src/ci/docker/android/Dockerfile"}, {"sha": "19c1b94e784c826a00f57ffe74c6b117645076c5", "filename": "src/ci/docker/dist-android/install-ndk.sh", "status": "renamed", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/500076e141c3c750a41201cec523cf9e9dabf6aa/src%2Fci%2Fdocker%2Fdist-android%2Finstall-ndk.sh", "raw_url": "https://github.com/rust-lang/rust/raw/500076e141c3c750a41201cec523cf9e9dabf6aa/src%2Fci%2Fdocker%2Fdist-android%2Finstall-ndk.sh", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fci%2Fdocker%2Fdist-android%2Finstall-ndk.sh?ref=500076e141c3c750a41201cec523cf9e9dabf6aa", "patch": "@@ -11,12 +11,6 @@\n \n set -ex\n \n-cpgdb() {\n-  cp android-ndk-r11c/prebuilt/linux-x86_64/bin/gdb /android/$1/bin/$2-gdb\n-  cp android-ndk-r11c/prebuilt/linux-x86_64/bin/gdb-orig /android/$1/bin/gdb-orig\n-  cp -r android-ndk-r11c/prebuilt/linux-x86_64/share /android/$1/share\n-}\n-\n # Prep the Android NDK\n #\n # See https://github.com/servo/servo/wiki/Building-for-Android\n@@ -28,7 +22,6 @@ bash android-ndk-r11c/build/tools/make-standalone-toolchain.sh \\\n         --install-dir=/android/ndk-arm-9 \\\n         --ndk-dir=/android/android-ndk-r11c \\\n         --arch=arm\n-cpgdb ndk-arm-9 arm-linux-androideabi\n bash android-ndk-r11c/build/tools/make-standalone-toolchain.sh \\\n         --platform=android-21 \\\n         --toolchain=aarch64-linux-android-4.9 \\", "previous_filename": "src/ci/docker/android/install-ndk.sh"}]}