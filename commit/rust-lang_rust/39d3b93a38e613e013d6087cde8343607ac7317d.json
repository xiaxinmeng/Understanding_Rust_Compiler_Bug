{"sha": "39d3b93a38e613e013d6087cde8343607ac7317d", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM5ZDNiOTNhMzhlNjEzZTAxM2Q2MDg3Y2RlODM0MzYwN2FjNzMxN2Q=", "commit": {"author": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-07-31T04:57:28Z"}, "committer": {"name": "Brian Anderson", "email": "banderson@mozilla.com", "date": "2011-08-02T17:39:12Z"}, "message": "Pretty-print tests only run on .rs files. Issue #789\n\nThe pretty-printer can't handle .rc files currently", "tree": {"sha": "6056de41a6f920b3ce118c79e039e32c3cee90bc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6056de41a6f920b3ce118c79e039e32c3cee90bc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/39d3b93a38e613e013d6087cde8343607ac7317d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/39d3b93a38e613e013d6087cde8343607ac7317d", "html_url": "https://github.com/rust-lang/rust/commit/39d3b93a38e613e013d6087cde8343607ac7317d", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/39d3b93a38e613e013d6087cde8343607ac7317d/comments", "author": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "committer": {"login": "brson", "id": 147214, "node_id": "MDQ6VXNlcjE0NzIxNA==", "avatar_url": "https://avatars.githubusercontent.com/u/147214?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brson", "html_url": "https://github.com/brson", "followers_url": "https://api.github.com/users/brson/followers", "following_url": "https://api.github.com/users/brson/following{/other_user}", "gists_url": "https://api.github.com/users/brson/gists{/gist_id}", "starred_url": "https://api.github.com/users/brson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brson/subscriptions", "organizations_url": "https://api.github.com/users/brson/orgs", "repos_url": "https://api.github.com/users/brson/repos", "events_url": "https://api.github.com/users/brson/events{/privacy}", "received_events_url": "https://api.github.com/users/brson/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4e8ab8b3a8fa324754023feeb4406482c4643feb", "url": "https://api.github.com/repos/rust-lang/rust/commits/4e8ab8b3a8fa324754023feeb4406482c4643feb", "html_url": "https://github.com/rust-lang/rust/commit/4e8ab8b3a8fa324754023feeb4406482c4643feb"}], "stats": {"total": 27, "additions": 22, "deletions": 5}, "files": [{"sha": "ab1eb989b292b324036f23c44fb413368ecf3626", "filename": "src/test/compiletest/compiletest.rs", "status": "modified", "additions": 22, "deletions": 5, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/39d3b93a38e613e013d6087cde8343607ac7317d/src%2Ftest%2Fcompiletest%2Fcompiletest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/39d3b93a38e613e013d6087cde8343607ac7317d/src%2Ftest%2Fcompiletest%2Fcompiletest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fcompiletest%2Fcompiletest.rs?ref=39d3b93a38e613e013d6087cde8343607ac7317d", "patch": "@@ -125,16 +125,33 @@ fn make_tests(cx: &cx) -> tests_and_conv_fn {\n     let tests = ~[];\n     for file: str  in fs::list_dir(cx.config.src_base) {\n         log #fmt(\"inspecting file %s\", file);\n-        if is_test(file) { tests += ~[make_test(cx, file, configport)]; }\n+        if is_test(cx.config, file) {\n+            tests += ~[make_test(cx, file, configport)];\n+        }\n     }\n     ret {tests: tests, to_task: bind closure_to_task(cx, configport, _)};\n }\n \n-fn is_test(testfile: &str) -> bool {\n+fn is_test(config: &config, testfile: &str) -> bool {\n+    // Pretty-printer does not work with .rc files yet\n+    let valid_extensions = alt config.mode {\n+      mode_pretty. { ~[\".rs\"] }\n+      _ { ~[\".rc\", \".rs\"] }\n+    };\n+    let invalid_prefixes = ~[\".\", \"#\", \"~\"];\n     let name = fs::basename(testfile);\n-    (str::ends_with(name, \".rs\") || str::ends_with(name, \".rc\")) &&\n-        !(str::starts_with(name, \".\") || str::starts_with(name, \"#\") ||\n-              str::starts_with(name, \"~\"))\n+\n+    let valid = false;\n+\n+    for ext in valid_extensions {\n+        if str::ends_with(name, ext) { valid = true }\n+    }\n+\n+    for pre in invalid_prefixes {\n+        if str::starts_with(name, pre) { valid = false }\n+    }\n+\n+    ret valid;\n }\n \n fn make_test(cx: &cx, testfile: &str, configport: &port[str]) ->"}]}