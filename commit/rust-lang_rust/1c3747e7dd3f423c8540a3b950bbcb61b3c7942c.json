{"sha": "1c3747e7dd3f423c8540a3b950bbcb61b3c7942c", "node_id": "C_kwDOAAsO6NoAKDFjMzc0N2U3ZGQzZjQyM2M4NTQwYTNiOTUwYmJjYjYxYjNjNzk0MmM", "commit": {"author": {"name": "Esteban Kuber", "email": "esteban@kuber.com.ar", "date": "2021-11-16T22:06:25Z"}, "committer": {"name": "Esteban Kuber", "email": "esteban@kuber.com.ar", "date": "2021-12-13T17:09:16Z"}, "message": "Fix rebase and clippy tests", "tree": {"sha": "e930377b05d94ef313a21d66afea60375927403e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e930377b05d94ef313a21d66afea60375927403e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1c3747e7dd3f423c8540a3b950bbcb61b3c7942c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1c3747e7dd3f423c8540a3b950bbcb61b3c7942c", "html_url": "https://github.com/rust-lang/rust/commit/1c3747e7dd3f423c8540a3b950bbcb61b3c7942c", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1c3747e7dd3f423c8540a3b950bbcb61b3c7942c/comments", "author": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "committer": {"login": "estebank", "id": 1606434, "node_id": "MDQ6VXNlcjE2MDY0MzQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1606434?v=4", "gravatar_id": "", "url": "https://api.github.com/users/estebank", "html_url": "https://github.com/estebank", "followers_url": "https://api.github.com/users/estebank/followers", "following_url": "https://api.github.com/users/estebank/following{/other_user}", "gists_url": "https://api.github.com/users/estebank/gists{/gist_id}", "starred_url": "https://api.github.com/users/estebank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/estebank/subscriptions", "organizations_url": "https://api.github.com/users/estebank/orgs", "repos_url": "https://api.github.com/users/estebank/repos", "events_url": "https://api.github.com/users/estebank/events{/privacy}", "received_events_url": "https://api.github.com/users/estebank/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d8af82e4bb1b5bce1124f42518e47ba72eb03179", "url": "https://api.github.com/repos/rust-lang/rust/commits/d8af82e4bb1b5bce1124f42518e47ba72eb03179", "html_url": "https://github.com/rust-lang/rust/commit/d8af82e4bb1b5bce1124f42518e47ba72eb03179"}], "stats": {"total": 77, "additions": 22, "deletions": 55}, "files": [{"sha": "5b098659377c64805c5dc72eb8904bc740ca8ba1", "filename": "clippy_lints/src/needless_late_init.rs", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/rust-lang/rust/blob/1c3747e7dd3f423c8540a3b950bbcb61b3c7942c/clippy_lints%2Fsrc%2Fneedless_late_init.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c3747e7dd3f423c8540a3b950bbcb61b3c7942c/clippy_lints%2Fsrc%2Fneedless_late_init.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/clippy_lints%2Fsrc%2Fneedless_late_init.rs?ref=1c3747e7dd3f423c8540a3b950bbcb61b3c7942c", "patch": "@@ -73,7 +73,7 @@ fn contains_assign_expr<'tcx>(cx: &LateContext<'tcx>, stmt: &'tcx Stmt<'tcx>) ->\n     seen\n }\n \n-#[derive(Debug)]\n+#[derive(Debug, Clone)]\n struct LocalAssign {\n     lhs_id: HirId,\n     lhs_span: Span,\n@@ -154,9 +154,14 @@ fn assignment_suggestions<'tcx>(\n         assignments.push(assign);\n     }\n \n-    let suggestions = assignments\n+    let suggestions = assignments.clone()\n         .into_iter()\n-        .map(|assignment| Some((assignment.span, snippet_opt(cx, assignment.rhs_span)?)))\n+        .map(|assignment| Some((assignment.span.until(assignment.rhs_span), String::new())))\n+        .chain(\n+            assignments\n+                .into_iter()\n+                .map(|assignment| Some((assignment.rhs_span.shrink_to_hi().with_hi(assignment.span.hi()), String::new())))\n+        )\n         .collect::<Option<Vec<(Span, String)>>>()?;\n \n     let applicability = if suggestions.len() > 1 {"}, {"sha": "32d5d04fde4d52001484eef8e615a157eaad177e", "filename": "tests/ui/needless_late_init_fixable.fixed", "status": "removed", "additions": 0, "deletions": 38, "changes": 38, "blob_url": "https://github.com/rust-lang/rust/blob/d8af82e4bb1b5bce1124f42518e47ba72eb03179/tests%2Fui%2Fneedless_late_init_fixable.fixed", "raw_url": "https://github.com/rust-lang/rust/raw/d8af82e4bb1b5bce1124f42518e47ba72eb03179/tests%2Fui%2Fneedless_late_init_fixable.fixed", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_late_init_fixable.fixed?ref=d8af82e4bb1b5bce1124f42518e47ba72eb03179", "patch": "@@ -1,38 +0,0 @@\n-// run-rustfix\n-\n-#![allow(unused, clippy::assign_op_pattern)]\n-\n-fn main() {\n-    \n-    let a = \"zero\";\n-\n-    \n-    \n-    let b = 1;\n-    let c = 2;\n-\n-    \n-    let d: usize = 1;\n-\n-    \n-    let mut e = 1;\n-    e = 2;\n-\n-    \n-    let f = match 1 {\n-        1 => \"three\",\n-        _ => return,\n-    }; // has semi\n-\n-    \n-    let g: usize = if true {\n-        5\n-    } else {\n-        panic!();\n-    };\n-\n-    \n-    let h = format!(\"{}\", e);\n-\n-    println!(\"{}\", a);\n-}"}, {"sha": "76099df0e0689cfa8e51b25fe3564315d171b2cf", "filename": "tests/ui/needless_late_init_fixable.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/1c3747e7dd3f423c8540a3b950bbcb61b3c7942c/tests%2Fui%2Fneedless_late_init_fixable.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1c3747e7dd3f423c8540a3b950bbcb61b3c7942c/tests%2Fui%2Fneedless_late_init_fixable.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_late_init_fixable.rs?ref=1c3747e7dd3f423c8540a3b950bbcb61b3c7942c", "patch": "@@ -1,5 +1,3 @@\n-// run-rustfix\n-\n #![allow(unused, clippy::assign_op_pattern)]\n \n fn main() {"}, {"sha": "728e19252ea707b4428fed20f466f12646e0d6d8", "filename": "tests/ui/needless_late_init_fixable.stderr", "status": "modified", "additions": 14, "deletions": 12, "changes": 26, "blob_url": "https://github.com/rust-lang/rust/blob/1c3747e7dd3f423c8540a3b950bbcb61b3c7942c/tests%2Fui%2Fneedless_late_init_fixable.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/1c3747e7dd3f423c8540a3b950bbcb61b3c7942c/tests%2Fui%2Fneedless_late_init_fixable.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/tests%2Fui%2Fneedless_late_init_fixable.stderr?ref=1c3747e7dd3f423c8540a3b950bbcb61b3c7942c", "patch": "@@ -1,5 +1,5 @@\n error: unneeded late initalization\n-  --> $DIR/needless_late_init_fixable.rs:6:5\n+  --> $DIR/needless_late_init_fixable.rs:4:5\n    |\n LL |     let a;\n    |     ^^^^^^\n@@ -11,7 +11,7 @@ LL |     let a = \"zero\";\n    |     ~~~~~\n \n error: unneeded late initalization\n-  --> $DIR/needless_late_init_fixable.rs:9:5\n+  --> $DIR/needless_late_init_fixable.rs:7:5\n    |\n LL |     let b;\n    |     ^^^^^^\n@@ -22,7 +22,7 @@ LL |     let b = 1;\n    |     ~~~~~\n \n error: unneeded late initalization\n-  --> $DIR/needless_late_init_fixable.rs:10:5\n+  --> $DIR/needless_late_init_fixable.rs:8:5\n    |\n LL |     let c;\n    |     ^^^^^^\n@@ -33,7 +33,7 @@ LL |     let c = 2;\n    |     ~~~~~\n \n error: unneeded late initalization\n-  --> $DIR/needless_late_init_fixable.rs:14:5\n+  --> $DIR/needless_late_init_fixable.rs:12:5\n    |\n LL |     let d: usize;\n    |     ^^^^^^^^^^^^^\n@@ -44,7 +44,7 @@ LL |     let d: usize = 1;\n    |     ~~~~~~~~~~~~\n \n error: unneeded late initalization\n-  --> $DIR/needless_late_init_fixable.rs:17:5\n+  --> $DIR/needless_late_init_fixable.rs:15:5\n    |\n LL |     let mut e;\n    |     ^^^^^^^^^^\n@@ -55,7 +55,7 @@ LL |     let mut e = 1;\n    |     ~~~~~~~~~\n \n error: unneeded late initalization\n-  --> $DIR/needless_late_init_fixable.rs:21:5\n+  --> $DIR/needless_late_init_fixable.rs:19:5\n    |\n LL |     let f;\n    |     ^^^^^^\n@@ -66,11 +66,12 @@ LL |     let f = match 1 {\n    |     +++++++\n help: remove the assignments from the `match` arms\n    |\n-LL |         1 => \"three\",\n-   |              ~~~~~~~\n+LL -         1 => f = \"three\",\n+LL +         1 => \"three\",\n+   | \n \n error: unneeded late initalization\n-  --> $DIR/needless_late_init_fixable.rs:27:5\n+  --> $DIR/needless_late_init_fixable.rs:25:5\n    |\n LL |     let g: usize;\n    |     ^^^^^^^^^^^^^\n@@ -81,15 +82,16 @@ LL |     let g: usize = if true {\n    |     ++++++++++++++\n help: remove the assignments from the branches\n    |\n-LL |         5\n-   |\n+LL -         g = 5;\n+LL +         5\n+   | \n help: add a semicolon after the `if` expression\n    |\n LL |     };\n    |      +\n \n error: unneeded late initalization\n-  --> $DIR/needless_late_init_fixable.rs:34:5\n+  --> $DIR/needless_late_init_fixable.rs:32:5\n    |\n LL |     let h;\n    |     ^^^^^^"}]}