{"sha": "530540025c35016ad951bf5fa58d533e2972feb0", "node_id": "MDY6Q29tbWl0NzI0NzEyOjUzMDU0MDAyNWMzNTAxNmFkOTUxYmY1ZmE1OGQ1MzNlMjk3MmZlYjA=", "commit": {"author": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2012-09-25T03:24:10Z"}, "committer": {"name": "Patrick Walton", "email": "pcwalton@mimiga.net", "date": "2012-09-25T03:25:51Z"}, "message": "libcore: Fix 32 bit Rust task structure offsets for unwinding", "tree": {"sha": "c627a76c426a6c5f923aaf408e1b8aefb4ff4851", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/c627a76c426a6c5f923aaf408e1b8aefb4ff4851"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/530540025c35016ad951bf5fa58d533e2972feb0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/530540025c35016ad951bf5fa58d533e2972feb0", "html_url": "https://github.com/rust-lang/rust/commit/530540025c35016ad951bf5fa58d533e2972feb0", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/530540025c35016ad951bf5fa58d533e2972feb0/comments", "author": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pcwalton", "id": 157897, "node_id": "MDQ6VXNlcjE1Nzg5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/157897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcwalton", "html_url": "https://github.com/pcwalton", "followers_url": "https://api.github.com/users/pcwalton/followers", "following_url": "https://api.github.com/users/pcwalton/following{/other_user}", "gists_url": "https://api.github.com/users/pcwalton/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcwalton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcwalton/subscriptions", "organizations_url": "https://api.github.com/users/pcwalton/orgs", "repos_url": "https://api.github.com/users/pcwalton/repos", "events_url": "https://api.github.com/users/pcwalton/events{/privacy}", "received_events_url": "https://api.github.com/users/pcwalton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ba8750a5503242828ca0d95177196ebe6d7cbf51", "url": "https://api.github.com/repos/rust-lang/rust/commits/ba8750a5503242828ca0d95177196ebe6d7cbf51", "html_url": "https://github.com/rust-lang/rust/commit/ba8750a5503242828ca0d95177196ebe6d7cbf51"}], "stats": {"total": 35, "additions": 32, "deletions": 3}, "files": [{"sha": "064387dd6b85915e6dc8a412049b7bec5429d3fd", "filename": "src/libcore/cleanup.rs", "status": "modified", "additions": 32, "deletions": 3, "changes": 35, "blob_url": "https://github.com/rust-lang/rust/blob/530540025c35016ad951bf5fa58d533e2972feb0/src%2Flibcore%2Fcleanup.rs", "raw_url": "https://github.com/rust-lang/rust/raw/530540025c35016ad951bf5fa58d533e2972feb0/src%2Flibcore%2Fcleanup.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibcore%2Fcleanup.rs?ref=530540025c35016ad951bf5fa58d533e2972feb0", "patch": "@@ -33,18 +33,26 @@ struct MemoryRegion { priv opaque: () }\n \n #[cfg(target_arch=\"x86\")]\n struct Registers {\n-    data: [u32 * 13]\n+    data: [u32 * 16]\n+}\n+\n+#[cfg(target_arch=\"x86\")]\n+struct Context {\n+    regs: Registers,\n+    next: *Context,\n+    pad: [u32 * 3]\n }\n \n #[cfg(target_arch=\"x86_64\")]\n struct Registers {\n     data: [u64 * 22]\n }\n \n+#[cfg(target_arch=\"x86_64\")]\n struct Context {\n     regs: Registers,\n     next: *Context,\n-    pad: u64\n+    pad: uintptr_t\n }\n \n struct BoxedRegion {\n@@ -53,6 +61,27 @@ struct BoxedRegion {\n     live_allocs: *BoxRepr\n }\n \n+#[cfg(target_arch=\"x86\")]\n+struct Task {\n+    // Public fields\n+    refcount: intptr_t,                 // 0\n+    id: TaskID,                         // 4\n+    pad: [u32 * 2],                     // 8\n+    ctx: Context,                       // 16\n+    stack_segment: *StackSegment,       // 96\n+    runtime_sp: uintptr_t,              // 100\n+    scheduler: *Scheduler,              // 104\n+    scheduler_loop: *SchedulerLoop,     // 108\n+\n+    // Fields known only to the runtime\n+    kernel: *Kernel,                    // 112\n+    name: *c_char,                      // 116\n+    list_index: i32,                    // 120\n+    rendezvous_ptr: *uintptr_t,         // 124\n+    boxed_region: BoxedRegion           // 128\n+}\n+\n+#[cfg(target_arch=\"x86_64\")]\n struct Task {\n     // Public fields\n     refcount: intptr_t,\n@@ -66,7 +95,7 @@ struct Task {\n     // Fields known only to the runtime\n     kernel: *Kernel,\n     name: *c_char,\n-    list_index: *i32,\n+    list_index: i32,\n     rendezvous_ptr: *uintptr_t,\n     boxed_region: BoxedRegion\n }"}]}