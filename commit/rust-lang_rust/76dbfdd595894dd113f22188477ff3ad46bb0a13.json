{"sha": "76dbfdd595894dd113f22188477ff3ad46bb0a13", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc2ZGJmZGQ1OTU4OTRkZDExM2YyMjE4ODQ3N2ZmM2FkNDZiYjBhMTM=", "commit": {"author": {"name": "Mazdak Farrokhzad", "email": "twingoow@gmail.com", "date": "2019-01-28T21:25:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2019-01-28T21:25:42Z"}, "message": "Rollup merge of #57674 - dotdash:erase_reg, r=varkor\n\nAvoid erase_regions_ty queries if there are no regions to erase\n\nIt's overall faster to perform this extra check than to perform the\nquery, even if the result is already in the query cache.", "tree": {"sha": "6573c29347a73b4c098c636061b57d72aef6e60e", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/6573c29347a73b4c098c636061b57d72aef6e60e"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/76dbfdd595894dd113f22188477ff3ad46bb0a13", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJcT3NXCRBK7hj4Ov3rIwAAdHIIAEkGyJyagf2aVZMBVrr7xRn3\n4e6enToumZ2OFJDFTs/1dufdwdMktgK9bgxRMrAGrG4V588lIv21uU1pwI6UTaKl\nddl9uXCA4/t7yDJ0Z4y2NdPuPdb/smPpDV+X4N3iWc1/c3N6UfX+XM6tV+CHWf22\nejtlIQCOaT0p/JUKDzrISF1axCPJh/5KM7pVjaxBrQy5m+yTQ8oULbR9vetIb5m+\nZcMtgj/NLNvPHWpYgyhrnmYqjdnnNED9nbKHFcbdPHSFd2x9xA8Z7UYvHRXCGH0a\nA8JCiB3pPDWjltZxmJjRicY2vdcg5yU6CmysOjVuJVkaw4hcXW4lX9zFF6Ab8ds=\n=MfTn\n-----END PGP SIGNATURE-----\n", "payload": "tree 6573c29347a73b4c098c636061b57d72aef6e60e\nparent f21f83d11710f13e285dab4bea7b9bebd1d47814\nparent da06898a7539ff66e636a5bf9d3b176b865a2737\nauthor Mazdak Farrokhzad <twingoow@gmail.com> 1548710742 +0100\ncommitter GitHub <noreply@github.com> 1548710742 +0100\n\nRollup merge of #57674 - dotdash:erase_reg, r=varkor\n\nAvoid erase_regions_ty queries if there are no regions to erase\n\nIt's overall faster to perform this extra check than to perform the\nquery, even if the result is already in the query cache.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/76dbfdd595894dd113f22188477ff3ad46bb0a13", "html_url": "https://github.com/rust-lang/rust/commit/76dbfdd595894dd113f22188477ff3ad46bb0a13", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/76dbfdd595894dd113f22188477ff3ad46bb0a13/comments", "author": {"login": "Centril", "id": 855702, "node_id": "MDQ6VXNlcjg1NTcwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/855702?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Centril", "html_url": "https://github.com/Centril", "followers_url": "https://api.github.com/users/Centril/followers", "following_url": "https://api.github.com/users/Centril/following{/other_user}", "gists_url": "https://api.github.com/users/Centril/gists{/gist_id}", "starred_url": "https://api.github.com/users/Centril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Centril/subscriptions", "organizations_url": "https://api.github.com/users/Centril/orgs", "repos_url": "https://api.github.com/users/Centril/repos", "events_url": "https://api.github.com/users/Centril/events{/privacy}", "received_events_url": "https://api.github.com/users/Centril/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f21f83d11710f13e285dab4bea7b9bebd1d47814", "url": "https://api.github.com/repos/rust-lang/rust/commits/f21f83d11710f13e285dab4bea7b9bebd1d47814", "html_url": "https://github.com/rust-lang/rust/commit/f21f83d11710f13e285dab4bea7b9bebd1d47814"}, {"sha": "da06898a7539ff66e636a5bf9d3b176b865a2737", "url": "https://api.github.com/repos/rust-lang/rust/commits/da06898a7539ff66e636a5bf9d3b176b865a2737", "html_url": "https://github.com/rust-lang/rust/commit/da06898a7539ff66e636a5bf9d3b176b865a2737"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "da7e021b2d54b79d1bd12cc59b1af888f940de88", "filename": "src/librustc/ty/erase_regions.rs", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/76dbfdd595894dd113f22188477ff3ad46bb0a13/src%2Flibrustc%2Fty%2Ferase_regions.rs", "raw_url": "https://github.com/rust-lang/rust/raw/76dbfdd595894dd113f22188477ff3ad46bb0a13/src%2Flibrustc%2Fty%2Ferase_regions.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fty%2Ferase_regions.rs?ref=76dbfdd595894dd113f22188477ff3ad46bb0a13", "patch": "@@ -1,4 +1,4 @@\n-use ty::{self, Ty, TyCtxt};\n+use ty::{self, Ty, TyCtxt, TypeFlags};\n use ty::fold::{TypeFolder, TypeFoldable};\n \n pub(super) fn provide(providers: &mut ty::query::Providers<'_>) {\n@@ -21,6 +21,11 @@ impl<'a, 'gcx, 'tcx> TyCtxt<'a, 'gcx, 'tcx> {\n     pub fn erase_regions<T>(self, value: &T) -> T\n         where T : TypeFoldable<'tcx>\n     {\n+        // If there's nothing to erase avoid performing the query at all\n+        if !value.has_type_flags(TypeFlags::HAS_RE_LATE_BOUND | TypeFlags::HAS_FREE_REGIONS) {\n+            return value.clone();\n+        }\n+\n         let value1 = value.fold_with(&mut RegionEraserVisitor { tcx: self });\n         debug!(\"erase_regions({:?}) = {:?}\", value, value1);\n         value1"}]}