{"sha": "fc5a742b24539f4e3e62dffa005c6a927adb66b5", "node_id": "C_kwDOAAsO6NoAKGZjNWE3NDJiMjQ1MzlmNGUzZTYyZGZmYTAwNWM2YTkyN2FkYjY2YjU", "commit": {"author": {"name": "jyn", "email": "github@jyn.dev", "date": "2023-04-20T01:58:45Z"}, "committer": {"name": "jyn", "email": "github@jyn.dev", "date": "2023-04-29T07:19:39Z"}, "message": "[wip] separate out a test_crate_args fn", "tree": {"sha": "5c1e20dc5534f35468b81a0e2e83eb29857d5c8f", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5c1e20dc5534f35468b81a0e2e83eb29857d5c8f"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/fc5a742b24539f4e3e62dffa005c6a927adb66b5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/fc5a742b24539f4e3e62dffa005c6a927adb66b5", "html_url": "https://github.com/rust-lang/rust/commit/fc5a742b24539f4e3e62dffa005c6a927adb66b5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/fc5a742b24539f4e3e62dffa005c6a927adb66b5/comments", "author": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jyn514", "id": 23638587, "node_id": "MDQ6VXNlcjIzNjM4NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/23638587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jyn514", "html_url": "https://github.com/jyn514", "followers_url": "https://api.github.com/users/jyn514/followers", "following_url": "https://api.github.com/users/jyn514/following{/other_user}", "gists_url": "https://api.github.com/users/jyn514/gists{/gist_id}", "starred_url": "https://api.github.com/users/jyn514/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jyn514/subscriptions", "organizations_url": "https://api.github.com/users/jyn514/orgs", "repos_url": "https://api.github.com/users/jyn514/repos", "events_url": "https://api.github.com/users/jyn514/events{/privacy}", "received_events_url": "https://api.github.com/users/jyn514/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "41d79374930ba9db67467008fc318f5e8fd8b93d", "url": "https://api.github.com/repos/rust-lang/rust/commits/41d79374930ba9db67467008fc318f5e8fd8b93d", "html_url": "https://github.com/rust-lang/rust/commit/41d79374930ba9db67467008fc318f5e8fd8b93d"}], "stats": {"total": 36, "additions": 20, "deletions": 16}, "files": [{"sha": "e8804eb1d609c569cf4948ffa232fe79211d6b1a", "filename": "src/bootstrap/test.rs", "status": "modified", "additions": 20, "deletions": 16, "changes": 36, "blob_url": "https://github.com/rust-lang/rust/blob/fc5a742b24539f4e3e62dffa005c6a927adb66b5/src%2Fbootstrap%2Ftest.rs", "raw_url": "https://github.com/rust-lang/rust/raw/fc5a742b24539f4e3e62dffa005c6a927adb66b5/src%2Fbootstrap%2Ftest.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Fbootstrap%2Ftest.rs?ref=fc5a742b24539f4e3e62dffa005c6a927adb66b5", "patch": "@@ -2108,6 +2108,25 @@ impl Step for CrateLibrustc {\n     }\n }\n \n+// Given a `cargo test` subcommand, pass it the appropriate test flags given a `builder`.\n+fn cargo_test_args(cargo: &mut Command, libtest_args: &[&str], _crates: &[&str], builder: &Builder<'_>) {\n+    if !builder.fail_fast {\n+        cargo.arg(\"--no-fail-fast\");\n+    }\n+    match builder.doc_tests {\n+        DocTests::Only => {\n+            cargo.arg(\"--doc\");\n+        }\n+        DocTests::No => {\n+            cargo.args(&[\"--lib\", \"--bins\", \"--examples\", \"--tests\", \"--benches\"]);\n+        }\n+        DocTests::Yes => {}\n+    }\n+\n+    cargo.arg(\"--\").args(&builder.config.cmd.test_args()).args(libtest_args);\n+    add_flags_and_try_run_tests(builder, cargo);\n+}\n+\n #[derive(Debug, Clone, PartialEq, Eq, PartialOrd, Ord, Hash)]\n pub struct Crate {\n     pub compiler: Compiler,\n@@ -2560,24 +2579,9 @@ impl Step for Bootstrap {\n             // https://github.com/rust-lang/rust/issues/49215\n             cmd.env(\"RUSTFLAGS\", flags);\n         }\n-        if !builder.fail_fast {\n-            cmd.arg(\"--no-fail-fast\");\n-        }\n-        match builder.doc_tests {\n-            DocTests::Only => {\n-                cmd.arg(\"--doc\");\n-            }\n-            DocTests::No => {\n-                cmd.args(&[\"--lib\", \"--bins\", \"--examples\", \"--tests\", \"--benches\"]);\n-            }\n-            DocTests::Yes => {}\n-        }\n-\n-        cmd.arg(\"--\").args(&builder.config.cmd.test_args());\n         // rustbuild tests are racy on directory creation so just run them one at a time.\n         // Since there's not many this shouldn't be a problem.\n-        cmd.arg(\"--test-threads=1\");\n-        add_flags_and_try_run_tests(builder, &mut cmd);\n+        cargo_test_args(&mut cmd, &[\"--test-threads=1\"], &[], builder);\n     }\n \n     fn should_run(run: ShouldRun<'_>) -> ShouldRun<'_> {"}]}