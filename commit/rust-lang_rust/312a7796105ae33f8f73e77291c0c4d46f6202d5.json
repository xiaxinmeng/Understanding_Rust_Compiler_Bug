{"sha": "312a7796105ae33f8f73e77291c0c4d46f6202d5", "node_id": "MDY6Q29tbWl0NzI0NzEyOjMxMmE3Nzk2MTA1YWUzM2Y4ZjczZTc3MjkxYzBjNGQ0NmY2MjAyZDU=", "commit": {"author": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-02-19T11:44:20Z"}, "committer": {"name": "Aleksey Kladov", "email": "aleksey.kladov@gmail.com", "date": "2020-02-19T11:44:54Z"}, "message": "Add `remove_mut` assist", "tree": {"sha": "ba0dd37991220be14187f03b066c6490776eb6df", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/ba0dd37991220be14187f03b066c6490776eb6df"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/312a7796105ae33f8f73e77291c0c4d46f6202d5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/312a7796105ae33f8f73e77291c0c4d46f6202d5", "html_url": "https://github.com/rust-lang/rust/commit/312a7796105ae33f8f73e77291c0c4d46f6202d5", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/312a7796105ae33f8f73e77291c0c4d46f6202d5/comments", "author": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "committer": {"login": "matklad", "id": 1711539, "node_id": "MDQ6VXNlcjE3MTE1Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1711539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matklad", "html_url": "https://github.com/matklad", "followers_url": "https://api.github.com/users/matklad/followers", "following_url": "https://api.github.com/users/matklad/following{/other_user}", "gists_url": "https://api.github.com/users/matklad/gists{/gist_id}", "starred_url": "https://api.github.com/users/matklad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matklad/subscriptions", "organizations_url": "https://api.github.com/users/matklad/orgs", "repos_url": "https://api.github.com/users/matklad/repos", "events_url": "https://api.github.com/users/matklad/events{/privacy}", "received_events_url": "https://api.github.com/users/matklad/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d07f043ef1c99491cb172f3c3474b31c97501d7a", "url": "https://api.github.com/repos/rust-lang/rust/commits/d07f043ef1c99491cb172f3c3474b31c97501d7a", "html_url": "https://github.com/rust-lang/rust/commit/d07f043ef1c99491cb172f3c3474b31c97501d7a"}], "stats": {"total": 67, "additions": 67, "deletions": 0}, "files": [{"sha": "3f56dd5084ba6e68783e25731379486884439779", "filename": "crates/ra_assists/src/doc_tests/generated.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/312a7796105ae33f8f73e77291c0c4d46f6202d5/crates%2Fra_assists%2Fsrc%2Fdoc_tests%2Fgenerated.rs", "raw_url": "https://github.com/rust-lang/rust/raw/312a7796105ae33f8f73e77291c0c4d46f6202d5/crates%2Fra_assists%2Fsrc%2Fdoc_tests%2Fgenerated.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fdoc_tests%2Fgenerated.rs?ref=312a7796105ae33f8f73e77291c0c4d46f6202d5", "patch": "@@ -548,6 +548,23 @@ fn main() {\n     )\n }\n \n+#[test]\n+fn doctest_remove_mut() {\n+    check(\n+        \"remove_mut\",\n+        r#####\"\n+impl Walrus {\n+    fn feed(&mut<|> self, amount: u32) {}\n+}\n+\"#####,\n+        r#####\"\n+impl Walrus {\n+    fn feed(&self, amount: u32) {}\n+}\n+\"#####,\n+    )\n+}\n+\n #[test]\n fn doctest_replace_if_let_with_match() {\n     check("}, {"sha": "6884830eb614a6e152e44e7f272f2d33fbe4279a", "filename": "crates/ra_assists/src/handlers/remove_mut.rs", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/rust-lang/rust/blob/312a7796105ae33f8f73e77291c0c4d46f6202d5/crates%2Fra_assists%2Fsrc%2Fhandlers%2Fremove_mut.rs", "raw_url": "https://github.com/rust-lang/rust/raw/312a7796105ae33f8f73e77291c0c4d46f6202d5/crates%2Fra_assists%2Fsrc%2Fhandlers%2Fremove_mut.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Fhandlers%2Fremove_mut.rs?ref=312a7796105ae33f8f73e77291c0c4d46f6202d5", "patch": "@@ -0,0 +1,32 @@\n+use ra_syntax::{SyntaxKind, TextRange, T};\n+\n+use crate::{Assist, AssistCtx, AssistId};\n+\n+// Assist: remove_mut\n+//\n+// Removes the `mut` keyword.\n+//\n+// ```\n+// impl Walrus {\n+//     fn feed(&mut<|> self, amount: u32) {}\n+// }\n+// ```\n+// ->\n+// ```\n+// impl Walrus {\n+//     fn feed(&self, amount: u32) {}\n+// }\n+// ```\n+pub(crate) fn remove_mut(ctx: AssistCtx) -> Option<Assist> {\n+    let mut_token = ctx.find_token_at_offset(T![mut])?;\n+    let delete_from = mut_token.text_range().start();\n+    let delete_to = match mut_token.next_token() {\n+        Some(it) if it.kind() == SyntaxKind::WHITESPACE => it.text_range().end(),\n+        _ => mut_token.text_range().end(),\n+    };\n+\n+    ctx.add_assist(AssistId(\"remove_mut\"), \"Remove `mut` keyword\", |edit| {\n+        edit.set_cursor(delete_from);\n+        edit.delete(TextRange::from_to(delete_from, delete_to));\n+    })\n+}"}, {"sha": "d7998b0d1a5ca04951877dc1f4b1b830eae38e16", "filename": "crates/ra_assists/src/lib.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/312a7796105ae33f8f73e77291c0c4d46f6202d5/crates%2Fra_assists%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/312a7796105ae33f8f73e77291c0c4d46f6202d5/crates%2Fra_assists%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_assists%2Fsrc%2Flib.rs?ref=312a7796105ae33f8f73e77291c0c4d46f6202d5", "patch": "@@ -108,6 +108,7 @@ mod handlers {\n     mod introduce_variable;\n     mod inline_local_variable;\n     mod raw_string;\n+    mod remove_mut;\n     mod replace_if_let_with_match;\n     mod split_import;\n     mod remove_dbg;\n@@ -147,6 +148,7 @@ mod handlers {\n             raw_string::make_raw_string,\n             raw_string::make_usual_string,\n             raw_string::remove_hash,\n+            remove_mut::remove_mut,\n             early_return::convert_to_guarded_return,\n             auto_import::auto_import,\n         ]"}, {"sha": "9861332af8ba9146c529222cf934a9bdd4b4f50c", "filename": "docs/user/assists.md", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/312a7796105ae33f8f73e77291c0c4d46f6202d5/docs%2Fuser%2Fassists.md", "raw_url": "https://github.com/rust-lang/rust/raw/312a7796105ae33f8f73e77291c0c4d46f6202d5/docs%2Fuser%2Fassists.md", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/docs%2Fuser%2Fassists.md?ref=312a7796105ae33f8f73e77291c0c4d46f6202d5", "patch": "@@ -527,6 +527,22 @@ fn main() {\n }\n ```\n \n+## `remove_mut`\n+\n+Removes the `mut` keyword.\n+\n+```rust\n+// BEFORE\n+impl Walrus {\n+    fn feed(&mut\u2503 self, amount: u32) {}\n+}\n+\n+// AFTER\n+impl Walrus {\n+    fn feed(&self, amount: u32) {}\n+}\n+```\n+\n ## `replace_if_let_with_match`\n \n Replaces `if let` with an else branch with a `match` expression."}]}