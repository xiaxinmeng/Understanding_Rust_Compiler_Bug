{"sha": "1b6c68e51fcbba59c2e99c31d1400cbd6d44f928", "node_id": "MDY6Q29tbWl0NzI0NzEyOjFiNmM2OGU1MWZjYmJhNTljMmU5OWMzMWQxNDAwY2JkNmQ0NGY5Mjg=", "commit": {"author": {"name": "Seivan Heidari", "email": "seivan.heidari@icloud.com", "date": "2019-10-31T16:40:39Z"}, "committer": {"name": "Seivan Heidari", "email": "seivan.heidari@icloud.com", "date": "2019-10-31T16:40:39Z"}, "message": "Merge branch 'master' into feature/themes", "tree": {"sha": "bdf28d44b2908a62b49a3f2bb1995187f45e42c4", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/bdf28d44b2908a62b49a3f2bb1995187f45e42c4"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928", "html_url": "https://github.com/rust-lang/rust/commit/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/comments", "author": {"login": "seivan", "id": 55424, "node_id": "MDQ6VXNlcjU1NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/55424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/seivan", "html_url": "https://github.com/seivan", "followers_url": "https://api.github.com/users/seivan/followers", "following_url": "https://api.github.com/users/seivan/following{/other_user}", "gists_url": "https://api.github.com/users/seivan/gists{/gist_id}", "starred_url": "https://api.github.com/users/seivan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/seivan/subscriptions", "organizations_url": "https://api.github.com/users/seivan/orgs", "repos_url": "https://api.github.com/users/seivan/repos", "events_url": "https://api.github.com/users/seivan/events{/privacy}", "received_events_url": "https://api.github.com/users/seivan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "seivan", "id": 55424, "node_id": "MDQ6VXNlcjU1NDI0", "avatar_url": "https://avatars.githubusercontent.com/u/55424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/seivan", "html_url": "https://github.com/seivan", "followers_url": "https://api.github.com/users/seivan/followers", "following_url": "https://api.github.com/users/seivan/following{/other_user}", "gists_url": "https://api.github.com/users/seivan/gists{/gist_id}", "starred_url": "https://api.github.com/users/seivan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/seivan/subscriptions", "organizations_url": "https://api.github.com/users/seivan/orgs", "repos_url": "https://api.github.com/users/seivan/repos", "events_url": "https://api.github.com/users/seivan/events{/privacy}", "received_events_url": "https://api.github.com/users/seivan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a437f0e5849d8ce0a14d40a55f2ac2166f5ec343", "url": "https://api.github.com/repos/rust-lang/rust/commits/a437f0e5849d8ce0a14d40a55f2ac2166f5ec343", "html_url": "https://github.com/rust-lang/rust/commit/a437f0e5849d8ce0a14d40a55f2ac2166f5ec343"}, {"sha": "5451bfb9a1c6482822bdd7883434b9230affd2ea", "url": "https://api.github.com/repos/rust-lang/rust/commits/5451bfb9a1c6482822bdd7883434b9230affd2ea", "html_url": "https://github.com/rust-lang/rust/commit/5451bfb9a1c6482822bdd7883434b9230affd2ea"}], "stats": {"total": 457, "additions": 240, "deletions": 217}, "files": [{"sha": "10f51403a380e6725287290cd8f2d9e86346cdf3", "filename": "Cargo.lock", "status": "modified", "additions": 26, "deletions": 16, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/Cargo.lock", "raw_url": "https://github.com/rust-lang/rust/raw/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/Cargo.lock", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/Cargo.lock?ref=1b6c68e51fcbba59c2e99c31d1400cbd6d44f928", "patch": "@@ -272,7 +272,7 @@ dependencies = [\n  \"cfg-if 0.1.10 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"crossbeam-utils 0.6.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"lazy_static 1.4.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"memoffset 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"memoffset 0.5.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"scopeguard 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n@@ -455,7 +455,15 @@ name = \"heck\"\n version = \"0.3.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"unicode-segmentation 1.4.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"unicode-segmentation 1.5.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n+]\n+\n+[[package]]\n+name = \"hermit-abi\"\n+version = \"0.1.3\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+dependencies = [\n+ \"libc 0.2.65 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -664,7 +672,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n name = \"memoffset\"\n-version = \"0.5.1\"\n+version = \"0.5.2\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n  \"rustc_version 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n@@ -761,9 +769,10 @@ dependencies = [\n \n [[package]]\n name = \"num_cpus\"\n-version = \"1.10.1\"\n+version = \"1.11.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n+ \"hermit-abi 0.1.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"libc 0.2.65 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n@@ -802,7 +811,7 @@ dependencies = [\n  \"libc 0.2.65 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"redox_syscall 0.1.56 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc_version 0.2.3 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"smallvec 0.6.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"smallvec 0.6.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"winapi 0.3.8 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n@@ -1111,7 +1120,7 @@ dependencies = [\n  \"ra_syntax 0.1.0\",\n  \"ra_tt 0.1.0\",\n  \"rustc-hash 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"smallvec 0.6.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"smallvec 0.6.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"test_utils 0.1.0\",\n ]\n \n@@ -1364,7 +1373,7 @@ dependencies = [\n  \"crossbeam-queue 0.1.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"crossbeam-utils 0.6.6 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"lazy_static 1.4.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"num_cpus 1.10.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"num_cpus 1.11.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -1476,7 +1485,7 @@ dependencies = [\n  \"rand 0.7.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"rustc-hash 1.0.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n  \"salsa-macros 0.13.2 (registry+https://github.com/rust-lang/crates.io-index)\",\n- \"smallvec 0.6.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"smallvec 0.6.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -1573,7 +1582,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n name = \"smallvec\"\n-version = \"0.6.11\"\n+version = \"0.6.12\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n@@ -1659,7 +1668,7 @@ name = \"threadpool\"\n version = \"1.7.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"num_cpus 1.10.1 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"num_cpus 1.11.0 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n@@ -1693,12 +1702,12 @@ name = \"unicode-normalization\"\n version = \"0.1.8\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n dependencies = [\n- \"smallvec 0.6.11 (registry+https://github.com/rust-lang/crates.io-index)\",\n+ \"smallvec 0.6.12 (registry+https://github.com/rust-lang/crates.io-index)\",\n ]\n \n [[package]]\n name = \"unicode-segmentation\"\n-version = \"1.4.0\"\n+version = \"1.5.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \n [[package]]\n@@ -1879,6 +1888,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum glob 0.3.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"9b919933a397b79c37e33b77bb2aa3dc8eb6e165ad809e58ff75bc7db2e34574\"\n \"checksum globset 0.4.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"925aa2cac82d8834e2b2a4415b6f6879757fb5c0928fc445ae76461a12eed8f2\"\n \"checksum heck 0.3.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"20564e78d53d2bb135c343b3f47714a56af2061f1c928fdb541dc7b9fdd94205\"\n+\"checksum hermit-abi 0.1.3 (registry+https://github.com/rust-lang/crates.io-index)\" = \"307c3c9f937f38e3534b1d6447ecf090cafcc9744e4a6360e8b037b2cf5af120\"\n \"checksum idna 0.2.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"02e2673c30ee86b5b96a9cb52ad15718aa1f966f5ab9ad54a8b95d5ca33120a9\"\n \"checksum indexmap 1.3.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"712d7b3ea5827fcb9d4fda14bf4da5f136f0db2ae9c8f4bd4e2d1c6fde4e6db2\"\n \"checksum indicatif 0.12.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"a8d596a9576eaa1446996092642d72bfef35cf47243129b7ab883baf5faec31e\"\n@@ -1905,7 +1915,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum lsp-types 0.61.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"fa3268fbe8beb2795c2fb327bf44f4f3d24f5fe9ebc18d7e2980afd444d72bcf\"\n \"checksum matches 0.1.8 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7ffc5c5338469d4d3ea17d269fa8ea3512ad247247c30bd2df69e68309ed0a08\"\n \"checksum memchr 2.2.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"88579771288728879b57485cc7d6b07d648c9f0141eb955f8ab7f9d45394468e\"\n-\"checksum memoffset 0.5.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ce6075db033bbbb7ee5a0bbd3a3186bbae616f57fb001c485c7ff77955f8177f\"\n+\"checksum memoffset 0.5.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"4a85c1a8c329f11437034d7313dca647c79096523533a1c79e86f1d0f657c7cc\"\n \"checksum mio 0.6.19 (registry+https://github.com/rust-lang/crates.io-index)\" = \"83f51996a3ed004ef184e16818edc51fadffe8e7ca68be67f9dee67d84d0ff23\"\n \"checksum mio-extras 2.0.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"46e73a04c2fa6250b8d802134d56d554a9ec2922bf977777c805ea5def61ce40\"\n \"checksum miow 0.2.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"8c1f2f3b1cf331de6896aabf6e9d55dca90356cc9960cca7eaaf408a355ae919\"\n@@ -1914,7 +1924,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum notify 4.0.14 (registry+https://github.com/rust-lang/crates.io-index)\" = \"199628fc33b21bc767baa057490b00b382ecbae030803a7b36292422d15b778b\"\n \"checksum num-integer 0.1.41 (registry+https://github.com/rust-lang/crates.io-index)\" = \"b85e541ef8255f6cf42bbfe4ef361305c6c135d10919ecc26126c4e5ae94bc09\"\n \"checksum num-traits 0.2.8 (registry+https://github.com/rust-lang/crates.io-index)\" = \"6ba9a427cfca2be13aa6f6403b0b7e7368fe982bfa16fccc450ce74c46cd9b32\"\n-\"checksum num_cpus 1.10.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"bcef43580c035376c0705c42792c294b66974abbfd2789b511784023f71f3273\"\n+\"checksum num_cpus 1.11.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"155394f924cdddf08149da25bfb932d226b4a593ca7468b08191ff6335941af5\"\n \"checksum number_prefix 0.3.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"17b02fc0ff9a9e4b35b3342880f48e896ebf69f2967921fe8646bf5b7125956a\"\n \"checksum once_cell 1.2.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"891f486f630e5c5a4916c7e16c4b24a53e78c860b646e9f8e005e4f16847bfed\"\n \"checksum ordermap 0.3.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"a86ed3f5f244b372d6b1a00b72ef7f8876d0bc6a78a4c9985c53614041512063\"\n@@ -1975,7 +1985,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum serde_repr 0.1.5 (registry+https://github.com/rust-lang/crates.io-index)\" = \"cd02c7587ec314570041b2754829f84d873ced14a96d1fd1823531e11db40573\"\n \"checksum serde_yaml 0.8.11 (registry+https://github.com/rust-lang/crates.io-index)\" = \"691b17f19fc1ec9d94ec0b5864859290dff279dbd7b03f017afda54eb36c3c35\"\n \"checksum slab 0.4.2 (registry+https://github.com/rust-lang/crates.io-index)\" = \"c111b5bd5695e56cffe5129854aa230b39c93a305372fdbb2668ca2394eea9f8\"\n-\"checksum smallvec 0.6.11 (registry+https://github.com/rust-lang/crates.io-index)\" = \"cefaa50e76a6f10b86f36e640eb1739eafbd4084865067778463913e43a77ff3\"\n+\"checksum smallvec 0.6.12 (registry+https://github.com/rust-lang/crates.io-index)\" = \"533e29e15d0748f28afbaf4ff7cab44d73e483a8e50b38c40bd13b7f3d48f542\"\n \"checksum smol_str 0.1.15 (registry+https://github.com/rust-lang/crates.io-index)\" = \"34836c9a295c62c2ce3514471117c5cb269891e8421b2aafdd910050576c4d8b\"\n \"checksum stacker 0.1.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"d96fc4f13a0ac088e9a3cd9af1cc8c5cc1ab5deb2145cef661267dfc9c542f8a\"\n \"checksum superslice 1.0.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"ab16ced94dbd8a46c82fd81e3ed9a8727dac2977ea869d217bcc4ea1f122e81f\"\n@@ -1989,7 +1999,7 @@ source = \"registry+https://github.com/rust-lang/crates.io-index\"\n \"checksum unicase 2.5.1 (registry+https://github.com/rust-lang/crates.io-index)\" = \"2e2e6bd1e59e56598518beb94fd6db628ded570326f0a98c679a304bd9f00150\"\n \"checksum unicode-bidi 0.3.4 (registry+https://github.com/rust-lang/crates.io-index)\" = \"49f2bd0c6468a8230e1db229cff8029217cf623c767ea5d60bfbd42729ea54d5\"\n \"checksum unicode-normalization 0.1.8 (registry+https://github.com/rust-lang/crates.io-index)\" = \"141339a08b982d942be2ca06ff8b076563cbe223d1befd5450716790d44e2426\"\n-\"checksum unicode-segmentation 1.4.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"dc5415c074426c7c65db13bd647c23d78c0fb2e10dca0b8fb0f40058a59bccdf\"\n+\"checksum unicode-segmentation 1.5.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"49f5526225fd8b77342d5986ab5f6055552e9c0776193b5b63fd53b46debfad7\"\n \"checksum unicode-width 0.1.6 (registry+https://github.com/rust-lang/crates.io-index)\" = \"7007dbd421b92cc6e28410fe7362e2e0a2503394908f417b68ec8d1c364c4e20\"\n \"checksum unicode-xid 0.2.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"826e7639553986605ec5979c7dd957c7895e93eabed50ab2ffa7f6128a75097c\"\n \"checksum url 2.1.0 (registry+https://github.com/rust-lang/crates.io-index)\" = \"75b414f6c464c879d7f9babf951f23bc3743fb7313c081b2e6ca719067ea9d61\""}, {"sha": "0436d20b79eeb3d9fa188b07601e1555f9ab0bd3", "filename": "crates/ra_hir/src/adt.rs", "status": "modified", "additions": 4, "deletions": 172, "changes": 176, "blob_url": "https://github.com/rust-lang/rust/blob/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/crates%2Fra_hir%2Fsrc%2Fadt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/crates%2Fra_hir%2Fsrc%2Fadt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fadt.rs?ref=1b6c68e51fcbba59c2e99c31d1400cbd6d44f928", "patch": "@@ -3,152 +3,16 @@\n \n use std::sync::Arc;\n \n-use hir_def::{type_ref::TypeRef, LocalEnumVariantId};\n-use hir_expand::name::AsName;\n-use ra_arena::{impl_arena_id, Arena, RawId};\n-use ra_syntax::ast::{self, NameOwner, StructKind, TypeAscriptionOwner};\n+use hir_def::adt::VariantData;\n \n use crate::{\n-    db::{AstDatabase, DefDatabase, HirDatabase},\n-    Enum, EnumVariant, FieldSource, HasSource, Module, Name, Source, Struct, StructField,\n+    db::{DefDatabase, HirDatabase},\n+    EnumVariant, Module, Name, Struct, StructField,\n };\n \n impl Struct {\n     pub(crate) fn variant_data(self, db: &impl DefDatabase) -> Arc<VariantData> {\n-        db.struct_data(self).variant_data.clone()\n-    }\n-}\n-\n-/// Note that we use `StructData` for unions as well!\n-#[derive(Debug, Clone, PartialEq, Eq)]\n-pub struct StructData {\n-    pub(crate) name: Option<Name>,\n-    pub(crate) variant_data: Arc<VariantData>,\n-}\n-\n-impl StructData {\n-    fn new(struct_def: &ast::StructDef) -> StructData {\n-        let name = struct_def.name().map(|n| n.as_name());\n-        let variant_data = VariantData::new(struct_def.kind());\n-        let variant_data = Arc::new(variant_data);\n-        StructData { name, variant_data }\n-    }\n-\n-    pub(crate) fn struct_data_query(\n-        db: &(impl DefDatabase + AstDatabase),\n-        struct_: Struct,\n-    ) -> Arc<StructData> {\n-        let src = struct_.source(db);\n-        Arc::new(StructData::new(&src.ast))\n-    }\n-}\n-\n-fn variants(enum_def: &ast::EnumDef) -> impl Iterator<Item = ast::EnumVariant> {\n-    enum_def.variant_list().into_iter().flat_map(|it| it.variants())\n-}\n-\n-impl EnumVariant {\n-    pub(crate) fn source_impl(\n-        self,\n-        db: &(impl DefDatabase + AstDatabase),\n-    ) -> Source<ast::EnumVariant> {\n-        let src = self.parent.source(db);\n-        let ast = variants(&src.ast)\n-            .zip(db.enum_data(self.parent).variants.iter())\n-            .find(|(_syntax, (id, _))| *id == self.id)\n-            .unwrap()\n-            .0;\n-        Source { file_id: src.file_id, ast }\n-    }\n-    pub(crate) fn variant_data(self, db: &impl DefDatabase) -> Arc<VariantData> {\n-        db.enum_data(self.parent).variants[self.id].variant_data.clone()\n-    }\n-}\n-\n-#[derive(Debug, Clone, PartialEq, Eq)]\n-pub struct EnumData {\n-    pub(crate) name: Option<Name>,\n-    pub(crate) variants: Arena<LocalEnumVariantId, EnumVariantData>,\n-}\n-\n-impl EnumData {\n-    pub(crate) fn enum_data_query(db: &(impl DefDatabase + AstDatabase), e: Enum) -> Arc<EnumData> {\n-        let src = e.source(db);\n-        let name = src.ast.name().map(|n| n.as_name());\n-        let variants = variants(&src.ast)\n-            .map(|var| EnumVariantData {\n-                name: var.name().map(|it| it.as_name()),\n-                variant_data: Arc::new(VariantData::new(var.kind())),\n-            })\n-            .collect();\n-        Arc::new(EnumData { name, variants })\n-    }\n-}\n-\n-#[derive(Debug, Clone, PartialEq, Eq)]\n-pub(crate) struct EnumVariantData {\n-    pub(crate) name: Option<Name>,\n-    variant_data: Arc<VariantData>,\n-}\n-\n-#[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n-pub(crate) struct StructFieldId(RawId);\n-impl_arena_id!(StructFieldId);\n-\n-/// A single field of an enum variant or struct\n-#[derive(Debug, Clone, PartialEq, Eq)]\n-pub struct StructFieldData {\n-    pub(crate) name: Name,\n-    pub(crate) type_ref: TypeRef,\n-}\n-\n-/// Fields of an enum variant or struct\n-#[derive(Debug, Clone, PartialEq, Eq)]\n-pub(crate) struct VariantData(VariantDataInner);\n-\n-#[derive(Debug, Clone, PartialEq, Eq)]\n-enum VariantDataInner {\n-    Struct(Arena<StructFieldId, StructFieldData>),\n-    Tuple(Arena<StructFieldId, StructFieldData>),\n-    Unit,\n-}\n-\n-impl VariantData {\n-    pub(crate) fn fields(&self) -> Option<&Arena<StructFieldId, StructFieldData>> {\n-        match &self.0 {\n-            VariantDataInner::Struct(fields) | VariantDataInner::Tuple(fields) => Some(fields),\n-            _ => None,\n-        }\n-    }\n-}\n-\n-impl VariantData {\n-    fn new(flavor: StructKind) -> Self {\n-        let inner = match flavor {\n-            ast::StructKind::Tuple(fl) => {\n-                let fields = fl\n-                    .fields()\n-                    .enumerate()\n-                    .map(|(i, fd)| StructFieldData {\n-                        name: Name::new_tuple_field(i),\n-                        type_ref: TypeRef::from_ast_opt(fd.type_ref()),\n-                    })\n-                    .collect();\n-                VariantDataInner::Tuple(fields)\n-            }\n-            ast::StructKind::Named(fl) => {\n-                let fields = fl\n-                    .fields()\n-                    .map(|fd| StructFieldData {\n-                        name: fd.name().map(|n| n.as_name()).unwrap_or_else(Name::missing),\n-                        type_ref: TypeRef::from_ast_opt(fd.ascribed_type()),\n-                    })\n-                    .collect();\n-                VariantDataInner::Struct(fields)\n-            }\n-            ast::StructKind::Unit => VariantDataInner::Unit,\n-        };\n-        VariantData(inner)\n+        db.struct_data(self.id).variant_data.clone()\n     }\n }\n \n@@ -188,35 +52,3 @@ impl VariantDef {\n         }\n     }\n }\n-\n-impl StructField {\n-    pub(crate) fn source_impl(&self, db: &(impl DefDatabase + AstDatabase)) -> Source<FieldSource> {\n-        let var_data = self.parent.variant_data(db);\n-        let fields = var_data.fields().unwrap();\n-        let ss;\n-        let es;\n-        let (file_id, struct_kind) = match self.parent {\n-            VariantDef::Struct(s) => {\n-                ss = s.source(db);\n-                (ss.file_id, ss.ast.kind())\n-            }\n-            VariantDef::EnumVariant(e) => {\n-                es = e.source(db);\n-                (es.file_id, es.ast.kind())\n-            }\n-        };\n-\n-        let field_sources = match struct_kind {\n-            ast::StructKind::Tuple(fl) => fl.fields().map(|it| FieldSource::Pos(it)).collect(),\n-            ast::StructKind::Named(fl) => fl.fields().map(|it| FieldSource::Named(it)).collect(),\n-            ast::StructKind::Unit => Vec::new(),\n-        };\n-        let ast = field_sources\n-            .into_iter()\n-            .zip(fields.iter())\n-            .find(|(_syntax, (id, _))| *id == self.id)\n-            .unwrap()\n-            .0;\n-        Source { file_id, ast }\n-    }\n-}"}, {"sha": "ae6ef760674c23859df9a23f9de4e96ae6c3ea75", "filename": "crates/ra_hir/src/code_model.rs", "status": "modified", "additions": 20, "deletions": 11, "changes": 31, "blob_url": "https://github.com/rust-lang/rust/blob/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/crates%2Fra_hir%2Fsrc%2Fcode_model.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/crates%2Fra_hir%2Fsrc%2Fcode_model.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fcode_model.rs?ref=1b6c68e51fcbba59c2e99c31d1400cbd6d44f928", "patch": "@@ -6,16 +6,17 @@ pub(crate) mod docs;\n use std::sync::Arc;\n \n use hir_def::{\n+    adt::VariantData,\n     builtin_type::BuiltinType,\n     type_ref::{Mutability, TypeRef},\n-    CrateModuleId, LocalEnumVariantId, ModuleId,\n+    CrateModuleId, LocalEnumVariantId, LocalStructFieldId, ModuleId,\n };\n use hir_expand::name::{self, AsName};\n use ra_db::{CrateId, Edition};\n use ra_syntax::ast::{self, NameOwner, TypeAscriptionOwner};\n \n use crate::{\n-    adt::{StructFieldId, VariantDef},\n+    adt::VariantDef,\n     db::{AstDatabase, DefDatabase, HirDatabase},\n     diagnostics::DiagnosticSink,\n     expr::{validation::ExprValidator, Body, BodySourceMap},\n@@ -250,7 +251,7 @@ impl Module {\n #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n pub struct StructField {\n     pub(crate) parent: VariantDef,\n-    pub(crate) id: StructFieldId,\n+    pub(crate) id: LocalStructFieldId,\n }\n \n #[derive(Debug, PartialEq, Eq)]\n@@ -288,11 +289,11 @@ impl Struct {\n     }\n \n     pub fn name(self, db: &impl DefDatabase) -> Option<Name> {\n-        db.struct_data(self).name.clone()\n+        db.struct_data(self.id).name.clone()\n     }\n \n     pub fn fields(self, db: &impl HirDatabase) -> Vec<StructField> {\n-        db.struct_data(self)\n+        db.struct_data(self.id)\n             .variant_data\n             .fields()\n             .into_iter()\n@@ -302,7 +303,7 @@ impl Struct {\n     }\n \n     pub fn field(self, db: &impl HirDatabase, name: &Name) -> Option<StructField> {\n-        db.struct_data(self)\n+        db.struct_data(self.id)\n             .variant_data\n             .fields()\n             .into_iter()\n@@ -338,7 +339,7 @@ pub struct Union {\n \n impl Union {\n     pub fn name(self, db: &impl DefDatabase) -> Option<Name> {\n-        db.struct_data(Struct { id: self.id }).name.clone()\n+        db.struct_data(self.id).name.clone()\n     }\n \n     pub fn module(self, db: &impl HirDatabase) -> Module {\n@@ -376,15 +377,19 @@ impl Enum {\n     }\n \n     pub fn name(self, db: &impl DefDatabase) -> Option<Name> {\n-        db.enum_data(self).name.clone()\n+        db.enum_data(self.id).name.clone()\n     }\n \n     pub fn variants(self, db: &impl DefDatabase) -> Vec<EnumVariant> {\n-        db.enum_data(self).variants.iter().map(|(id, _)| EnumVariant { parent: self, id }).collect()\n+        db.enum_data(self.id)\n+            .variants\n+            .iter()\n+            .map(|(id, _)| EnumVariant { parent: self, id })\n+            .collect()\n     }\n \n     pub fn variant(self, db: &impl DefDatabase, name: &Name) -> Option<EnumVariant> {\n-        db.enum_data(self)\n+        db.enum_data(self.id)\n             .variants\n             .iter()\n             .find(|(_id, data)| data.name.as_ref() == Some(name))\n@@ -422,7 +427,7 @@ impl EnumVariant {\n     }\n \n     pub fn name(self, db: &impl DefDatabase) -> Option<Name> {\n-        db.enum_data(self.parent).variants[self.id].name.clone()\n+        db.enum_data(self.parent.id).variants[self.id].name.clone()\n     }\n \n     pub fn fields(self, db: &impl HirDatabase) -> Vec<StructField> {\n@@ -442,6 +447,10 @@ impl EnumVariant {\n             .find(|(_id, data)| data.name == *name)\n             .map(|(id, _)| StructField { parent: self.into(), id })\n     }\n+\n+    pub(crate) fn variant_data(self, db: &impl DefDatabase) -> Arc<VariantData> {\n+        db.enum_data(self.parent.id).variants[self.id].variant_data.clone()\n+    }\n }\n \n /// A Data Type"}, {"sha": "0f4c78df760d8655e88a1055f96d56ac53aa5390", "filename": "crates/ra_hir/src/code_model/src.rs", "status": "modified", "additions": 40, "deletions": 2, "changes": 42, "blob_url": "https://github.com/rust-lang/rust/blob/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/crates%2Fra_hir%2Fsrc%2Fcode_model%2Fsrc.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/crates%2Fra_hir%2Fsrc%2Fcode_model%2Fsrc.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fcode_model%2Fsrc.rs?ref=1b6c68e51fcbba59c2e99c31d1400cbd6d44f928", "patch": "@@ -3,6 +3,7 @@\n use ra_syntax::ast::{self, AstNode};\n \n use crate::{\n+    adt::VariantDef,\n     db::{AstDatabase, DefDatabase, HirDatabase},\n     ids::AstItemDef,\n     Const, Either, Enum, EnumVariant, FieldSource, Function, HasBody, HirFileId, MacroDef, Module,\n@@ -45,7 +46,33 @@ impl Module {\n impl HasSource for StructField {\n     type Ast = FieldSource;\n     fn source(self, db: &(impl DefDatabase + AstDatabase)) -> Source<FieldSource> {\n-        self.source_impl(db)\n+        let var_data = self.parent.variant_data(db);\n+        let fields = var_data.fields().unwrap();\n+        let ss;\n+        let es;\n+        let (file_id, struct_kind) = match self.parent {\n+            VariantDef::Struct(s) => {\n+                ss = s.source(db);\n+                (ss.file_id, ss.ast.kind())\n+            }\n+            VariantDef::EnumVariant(e) => {\n+                es = e.source(db);\n+                (es.file_id, es.ast.kind())\n+            }\n+        };\n+\n+        let field_sources = match struct_kind {\n+            ast::StructKind::Tuple(fl) => fl.fields().map(|it| FieldSource::Pos(it)).collect(),\n+            ast::StructKind::Named(fl) => fl.fields().map(|it| FieldSource::Named(it)).collect(),\n+            ast::StructKind::Unit => Vec::new(),\n+        };\n+        let ast = field_sources\n+            .into_iter()\n+            .zip(fields.iter())\n+            .find(|(_syntax, (id, _))| *id == self.id)\n+            .unwrap()\n+            .0;\n+        Source { file_id, ast }\n     }\n }\n impl HasSource for Struct {\n@@ -69,7 +96,18 @@ impl HasSource for Enum {\n impl HasSource for EnumVariant {\n     type Ast = ast::EnumVariant;\n     fn source(self, db: &(impl DefDatabase + AstDatabase)) -> Source<ast::EnumVariant> {\n-        self.source_impl(db)\n+        let enum_data = db.enum_data(self.parent.id);\n+        let src = self.parent.id.source(db);\n+        let ast = src\n+            .ast\n+            .variant_list()\n+            .into_iter()\n+            .flat_map(|it| it.variants())\n+            .zip(enum_data.variants.iter())\n+            .find(|(_syntax, (id, _))| *id == self.id)\n+            .unwrap()\n+            .0;\n+        Source { file_id: src.file_id, ast }\n     }\n }\n impl HasSource for Function {"}, {"sha": "89ca4e39f0af9fa09933fbb6850f12f802bdb833", "filename": "crates/ra_hir/src/db.rs", "status": "modified", "additions": 4, "deletions": 11, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/crates%2Fra_hir%2Fsrc%2Fdb.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/crates%2Fra_hir%2Fsrc%2Fdb.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fdb.rs?ref=1b6c68e51fcbba59c2e99c31d1400cbd6d44f928", "patch": "@@ -6,7 +6,6 @@ use ra_db::salsa;\n use ra_syntax::SmolStr;\n \n use crate::{\n-    adt::{EnumData, StructData},\n     debug::HirDebugDatabase,\n     generics::{GenericDef, GenericParams},\n     ids,\n@@ -19,13 +18,13 @@ use crate::{\n         InferenceResult, Substs, Ty, TypableDef, TypeCtor,\n     },\n     type_alias::TypeAliasData,\n-    Const, ConstData, Crate, DefWithBody, Enum, ExprScopes, FnData, Function, Module, Static,\n-    Struct, StructField, Trait, TypeAlias,\n+    Const, ConstData, Crate, DefWithBody, ExprScopes, FnData, Function, Module, Static,\n+    StructField, Trait, TypeAlias,\n };\n \n pub use hir_def::db::{\n-    DefDatabase2, DefDatabase2Storage, InternDatabase, InternDatabaseStorage, RawItemsQuery,\n-    RawItemsWithSourceMapQuery,\n+    DefDatabase2, DefDatabase2Storage, EnumDataQuery, InternDatabase, InternDatabaseStorage,\n+    RawItemsQuery, RawItemsWithSourceMapQuery, StructDataQuery,\n };\n pub use hir_expand::db::{\n     AstDatabase, AstDatabaseStorage, AstIdMapQuery, MacroArgQuery, MacroDefQuery, MacroExpandQuery,\n@@ -36,12 +35,6 @@ pub use hir_expand::db::{\n #[salsa::query_group(DefDatabaseStorage)]\n #[salsa::requires(AstDatabase)]\n pub trait DefDatabase: HirDebugDatabase + DefDatabase2 {\n-    #[salsa::invoke(crate::adt::StructData::struct_data_query)]\n-    fn struct_data(&self, s: Struct) -> Arc<StructData>;\n-\n-    #[salsa::invoke(crate::adt::EnumData::enum_data_query)]\n-    fn enum_data(&self, e: Enum) -> Arc<EnumData>;\n-\n     #[salsa::invoke(crate::traits::TraitData::trait_data_query)]\n     fn trait_data(&self, t: Trait) -> Arc<TraitData>;\n "}, {"sha": "8e28343071a29ae2e60a275d7bf030b45705c3de", "filename": "crates/ra_hir/src/ty/lower.rs", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/rust-lang/rust/blob/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/crates%2Fra_hir%2Fsrc%2Fty%2Flower.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/crates%2Fra_hir%2Fsrc%2Fty%2Flower.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir%2Fsrc%2Fty%2Flower.rs?ref=1b6c68e51fcbba59c2e99c31d1400cbd6d44f928", "patch": "@@ -655,8 +655,8 @@ fn type_for_builtin(def: BuiltinType) -> Ty {\n }\n \n fn fn_sig_for_struct_constructor(db: &impl HirDatabase, def: Struct) -> FnSig {\n-    let var_data = def.variant_data(db);\n-    let fields = match var_data.fields() {\n+    let struct_data = db.struct_data(def.id);\n+    let fields = match struct_data.variant_data.fields() {\n         Some(fields) => fields,\n         None => panic!(\"fn_sig_for_struct_constructor called on unit struct\"),\n     };\n@@ -671,8 +671,8 @@ fn fn_sig_for_struct_constructor(db: &impl HirDatabase, def: Struct) -> FnSig {\n \n /// Build the type of a tuple struct constructor.\n fn type_for_struct_constructor(db: &impl HirDatabase, def: Struct) -> Ty {\n-    let var_data = def.variant_data(db);\n-    if var_data.fields().is_none() {\n+    let struct_data = db.struct_data(def.id);\n+    if struct_data.variant_data.fields().is_none() {\n         return type_for_adt(db, def); // Unit struct\n     }\n     let generics = def.generic_params(db);"}, {"sha": "22bd469f0a31a9789c28ec28223521e888ef1afc", "filename": "crates/ra_hir_def/src/adt.rs", "status": "added", "additions": 114, "deletions": 0, "changes": 114, "blob_url": "https://github.com/rust-lang/rust/blob/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/crates%2Fra_hir_def%2Fsrc%2Fadt.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/crates%2Fra_hir_def%2Fsrc%2Fadt.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Fadt.rs?ref=1b6c68e51fcbba59c2e99c31d1400cbd6d44f928", "patch": "@@ -0,0 +1,114 @@\n+//! Defines hir-level representation of structs, enums and unions\n+\n+use std::sync::Arc;\n+\n+use hir_expand::name::{AsName, Name};\n+use ra_arena::Arena;\n+use ra_syntax::ast::{self, NameOwner, TypeAscriptionOwner};\n+\n+use crate::{\n+    db::DefDatabase2, type_ref::TypeRef, AstItemDef, EnumId, LocalEnumVariantId,\n+    LocalStructFieldId, StructId,\n+};\n+\n+/// Note that we use `StructData` for unions as well!\n+#[derive(Debug, Clone, PartialEq, Eq)]\n+pub struct StructData {\n+    pub name: Option<Name>,\n+    pub variant_data: Arc<VariantData>,\n+}\n+\n+#[derive(Debug, Clone, PartialEq, Eq)]\n+pub struct EnumData {\n+    pub name: Option<Name>,\n+    pub variants: Arena<LocalEnumVariantId, EnumVariantData>,\n+}\n+\n+#[derive(Debug, Clone, PartialEq, Eq)]\n+pub struct EnumVariantData {\n+    pub name: Option<Name>,\n+    pub variant_data: Arc<VariantData>,\n+}\n+\n+/// Fields of an enum variant or struct\n+#[derive(Debug, Clone, PartialEq, Eq)]\n+pub struct VariantData(VariantDataInner);\n+\n+#[derive(Debug, Clone, PartialEq, Eq)]\n+enum VariantDataInner {\n+    Struct(Arena<LocalStructFieldId, StructFieldData>),\n+    Tuple(Arena<LocalStructFieldId, StructFieldData>),\n+    Unit,\n+}\n+\n+/// A single field of an enum variant or struct\n+#[derive(Debug, Clone, PartialEq, Eq)]\n+pub struct StructFieldData {\n+    pub name: Name,\n+    pub type_ref: TypeRef,\n+}\n+\n+impl StructData {\n+    pub(crate) fn struct_data_query(db: &impl DefDatabase2, struct_: StructId) -> Arc<StructData> {\n+        let src = struct_.source(db);\n+        let name = src.ast.name().map(|n| n.as_name());\n+        let variant_data = VariantData::new(src.ast.kind());\n+        let variant_data = Arc::new(variant_data);\n+        Arc::new(StructData { name, variant_data })\n+    }\n+}\n+\n+impl EnumData {\n+    pub(crate) fn enum_data_query(db: &impl DefDatabase2, e: EnumId) -> Arc<EnumData> {\n+        let src = e.source(db);\n+        let name = src.ast.name().map(|n| n.as_name());\n+        let variants = src\n+            .ast\n+            .variant_list()\n+            .into_iter()\n+            .flat_map(|it| it.variants())\n+            .map(|var| EnumVariantData {\n+                name: var.name().map(|it| it.as_name()),\n+                variant_data: Arc::new(VariantData::new(var.kind())),\n+            })\n+            .collect();\n+        Arc::new(EnumData { name, variants })\n+    }\n+}\n+\n+impl VariantData {\n+    fn new(flavor: ast::StructKind) -> Self {\n+        let inner = match flavor {\n+            ast::StructKind::Tuple(fl) => {\n+                let fields = fl\n+                    .fields()\n+                    .enumerate()\n+                    .map(|(i, fd)| StructFieldData {\n+                        name: Name::new_tuple_field(i),\n+                        type_ref: TypeRef::from_ast_opt(fd.type_ref()),\n+                    })\n+                    .collect();\n+                VariantDataInner::Tuple(fields)\n+            }\n+            ast::StructKind::Named(fl) => {\n+                let fields = fl\n+                    .fields()\n+                    .map(|fd| StructFieldData {\n+                        name: fd.name().map(|n| n.as_name()).unwrap_or_else(Name::missing),\n+                        type_ref: TypeRef::from_ast_opt(fd.ascribed_type()),\n+                    })\n+                    .collect();\n+                VariantDataInner::Struct(fields)\n+            }\n+            ast::StructKind::Unit => VariantDataInner::Unit,\n+        };\n+        VariantData(inner)\n+    }\n+\n+    pub fn fields(&self) -> Option<&Arena<LocalStructFieldId, StructFieldData>> {\n+        match &self.0 {\n+            VariantDataInner::Struct(fields) | VariantDataInner::Tuple(fields) => Some(fields),\n+            _ => None,\n+        }\n+    }\n+}"}, {"sha": "f6027013f2a8e451ec978a4dc424ebb89c2b6fe5", "filename": "crates/ra_hir_def/src/db.rs", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/crates%2Fra_hir_def%2Fsrc%2Fdb.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/crates%2Fra_hir_def%2Fsrc%2Fdb.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Fdb.rs?ref=1b6c68e51fcbba59c2e99c31d1400cbd6d44f928", "patch": "@@ -5,7 +5,11 @@ use hir_expand::{db::AstDatabase, HirFileId};\n use ra_db::{salsa, SourceDatabase};\n use ra_syntax::ast;\n \n-use crate::nameres::raw::{ImportSourceMap, RawItems};\n+use crate::{\n+    adt::{EnumData, StructData},\n+    nameres::raw::{ImportSourceMap, RawItems},\n+    EnumId, StructId,\n+};\n \n #[salsa::query_group(InternDatabaseStorage)]\n pub trait InternDatabase: SourceDatabase {\n@@ -37,4 +41,10 @@ pub trait DefDatabase2: InternDatabase + AstDatabase {\n \n     #[salsa::invoke(RawItems::raw_items_query)]\n     fn raw_items(&self, file_id: HirFileId) -> Arc<RawItems>;\n+\n+    #[salsa::invoke(StructData::struct_data_query)]\n+    fn struct_data(&self, s: StructId) -> Arc<StructData>;\n+\n+    #[salsa::invoke(EnumData::enum_data_query)]\n+    fn enum_data(&self, e: EnumId) -> Arc<EnumData>;\n }"}, {"sha": "76d5f18522bc685ccb09c65cb151cce293aac959", "filename": "crates/ra_hir_def/src/lib.rs", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/rust-lang/rust/blob/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/crates%2Fra_hir_def%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/1b6c68e51fcbba59c2e99c31d1400cbd6d44f928/crates%2Fra_hir_def%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fra_hir_def%2Fsrc%2Flib.rs?ref=1b6c68e51fcbba59c2e99c31d1400cbd6d44f928", "patch": "@@ -12,6 +12,7 @@ pub mod attr;\n pub mod path;\n pub mod type_ref;\n pub mod builtin_type;\n+pub mod adt;\n \n // FIXME: this should be private\n pub mod nameres;\n@@ -259,6 +260,22 @@ pub struct EnumVariantId {\n pub struct LocalEnumVariantId(RawId);\n impl_arena_id!(LocalEnumVariantId);\n \n+#[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n+pub enum VariantId {\n+    EnumVariantId(EnumVariantId),\n+    StructId(StructId),\n+}\n+\n+#[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n+pub struct StructFieldId {\n+    parent: VariantId,\n+    local_id: LocalStructFieldId,\n+}\n+\n+#[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n+pub struct LocalStructFieldId(RawId);\n+impl_arena_id!(LocalStructFieldId);\n+\n #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\n pub struct ConstId(salsa::InternId);\n impl_intern_key!(ConstId);"}]}