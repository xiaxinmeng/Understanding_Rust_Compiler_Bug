{"sha": "78f8ad36409754319011514ca6febc8599abd429", "node_id": "MDY6Q29tbWl0NzI0NzEyOjc4ZjhhZDM2NDA5NzU0MzE5MDExNTE0Y2E2ZmViYzg1OTlhYmQ0Mjk=", "commit": {"author": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2020-02-05T01:09:22Z"}, "committer": {"name": "Dylan MacKenzie", "email": "ecstaticmorse@gmail.com", "date": "2020-02-05T04:36:18Z"}, "message": "Implement remaining `unchecked` arithmetic intrinsics", "tree": {"sha": "40acf981fa441776ad6080604ed96cb63234065a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/40acf981fa441776ad6080604ed96cb63234065a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/78f8ad36409754319011514ca6febc8599abd429", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/78f8ad36409754319011514ca6febc8599abd429", "html_url": "https://github.com/rust-lang/rust/commit/78f8ad36409754319011514ca6febc8599abd429", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/78f8ad36409754319011514ca6febc8599abd429/comments", "author": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ecstatic-morse", "id": 29463364, "node_id": "MDQ6VXNlcjI5NDYzMzY0", "avatar_url": "https://avatars.githubusercontent.com/u/29463364?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ecstatic-morse", "html_url": "https://github.com/ecstatic-morse", "followers_url": "https://api.github.com/users/ecstatic-morse/followers", "following_url": "https://api.github.com/users/ecstatic-morse/following{/other_user}", "gists_url": "https://api.github.com/users/ecstatic-morse/gists{/gist_id}", "starred_url": "https://api.github.com/users/ecstatic-morse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ecstatic-morse/subscriptions", "organizations_url": "https://api.github.com/users/ecstatic-morse/orgs", "repos_url": "https://api.github.com/users/ecstatic-morse/repos", "events_url": "https://api.github.com/users/ecstatic-morse/events{/privacy}", "received_events_url": "https://api.github.com/users/ecstatic-morse/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "040d9873aa6ca1ce458e98fec403cee8ec4f7ae8", "url": "https://api.github.com/repos/rust-lang/rust/commits/040d9873aa6ca1ce458e98fec403cee8ec4f7ae8", "html_url": "https://github.com/rust-lang/rust/commit/040d9873aa6ca1ce458e98fec403cee8ec4f7ae8"}], "stats": {"total": 24, "additions": 22, "deletions": 2}, "files": [{"sha": "f85da760ada6d03c5af4262172a761ec422ea0ba", "filename": "src/librustc_mir/interpret/intrinsics.rs", "status": "modified", "additions": 17, "deletions": 2, "changes": 19, "blob_url": "https://github.com/rust-lang/rust/blob/78f8ad36409754319011514ca6febc8599abd429/src%2Flibrustc_mir%2Finterpret%2Fintrinsics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78f8ad36409754319011514ca6febc8599abd429/src%2Flibrustc_mir%2Finterpret%2Fintrinsics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_mir%2Finterpret%2Fintrinsics.rs?ref=78f8ad36409754319011514ca6febc8599abd429", "patch": "@@ -218,19 +218,34 @@ impl<'mir, 'tcx, M: Machine<'mir, 'tcx>> InterpCx<'mir, 'tcx, M> {\n                 };\n                 self.write_scalar(val, dest)?;\n             }\n-            sym::unchecked_shl | sym::unchecked_shr => {\n+            sym::unchecked_shl\n+            | sym::unchecked_shr\n+            | sym::unchecked_add\n+            | sym::unchecked_sub\n+            | sym::unchecked_mul\n+            | sym::unchecked_div\n+            | sym::unchecked_rem => {\n                 let l = self.read_immediate(args[0])?;\n                 let r = self.read_immediate(args[1])?;\n                 let bin_op = match intrinsic_name {\n                     sym::unchecked_shl => BinOp::Shl,\n                     sym::unchecked_shr => BinOp::Shr,\n+                    sym::unchecked_add => BinOp::Add,\n+                    sym::unchecked_sub => BinOp::Sub,\n+                    sym::unchecked_mul => BinOp::Mul,\n+                    sym::unchecked_div => BinOp::Div,\n+                    sym::unchecked_rem => BinOp::Rem,\n                     _ => bug!(\"Already checked for int ops\"),\n                 };\n                 let (val, overflowed, _ty) = self.overflowing_binary_op(bin_op, l, r)?;\n                 if overflowed {\n                     let layout = self.layout_of(substs.type_at(0))?;\n                     let r_val = self.force_bits(r.to_scalar()?, layout.size)?;\n-                    throw_ub_format!(\"Overflowing shift by {} in `{}`\", r_val, intrinsic_name);\n+                    if let sym::unchecked_shl | sym::unchecked_shr = intrinsic_name {\n+                        throw_ub_format!(\"Overflowing shift by {} in `{}`\", r_val, intrinsic_name);\n+                    } else {\n+                        throw_ub_format!(\"Overflow executing `{}`\", intrinsic_name);\n+                    }\n                 }\n                 self.write_scalar(val, dest)?;\n             }"}, {"sha": "c060e8948e3ed45fd770a518044c5d67d7ddc4c4", "filename": "src/librustc_span/symbol.rs", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/78f8ad36409754319011514ca6febc8599abd429/src%2Flibrustc_span%2Fsymbol.rs", "raw_url": "https://github.com/rust-lang/rust/raw/78f8ad36409754319011514ca6febc8599abd429/src%2Flibrustc_span%2Fsymbol.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_span%2Fsymbol.rs?ref=78f8ad36409754319011514ca6febc8599abd429", "patch": "@@ -755,8 +755,13 @@ symbols! {\n         u64,\n         u8,\n         unboxed_closures,\n+        unchecked_add,\n+        unchecked_div,\n+        unchecked_mul,\n+        unchecked_rem,\n         unchecked_shl,\n         unchecked_shr,\n+        unchecked_sub,\n         underscore_const_names,\n         underscore_imports,\n         underscore_lifetimes,"}]}