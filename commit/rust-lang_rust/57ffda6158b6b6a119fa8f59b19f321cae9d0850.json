{"sha": "57ffda6158b6b6a119fa8f59b19f321cae9d0850", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU3ZmZkYTYxNThiNmI2YTExOWZhOGY1OWIxOWYzMjFjYWU5ZDA4NTA=", "commit": {"author": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2016-12-01T17:29:28Z"}, "committer": {"name": "Niko Matsakis", "email": "niko@alum.mit.edu", "date": "2016-12-01T17:29:28Z"}, "message": "add a `-Z incremental-dump-hash` flag\n\nThis causes us to dump a bunch of has information to stdout that can be\nuseful in tracking down incremental compilation invalidations,\nparticularly across crates.", "tree": {"sha": "e229cdea0f592adcecb83fe8e79b6cec67dc8bc6", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e229cdea0f592adcecb83fe8e79b6cec67dc8bc6"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/57ffda6158b6b6a119fa8f59b19f321cae9d0850", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/57ffda6158b6b6a119fa8f59b19f321cae9d0850", "html_url": "https://github.com/rust-lang/rust/commit/57ffda6158b6b6a119fa8f59b19f321cae9d0850", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/57ffda6158b6b6a119fa8f59b19f321cae9d0850/comments", "author": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nikomatsakis", "id": 155238, "node_id": "MDQ6VXNlcjE1NTIzOA==", "avatar_url": "https://avatars.githubusercontent.com/u/155238?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nikomatsakis", "html_url": "https://github.com/nikomatsakis", "followers_url": "https://api.github.com/users/nikomatsakis/followers", "following_url": "https://api.github.com/users/nikomatsakis/following{/other_user}", "gists_url": "https://api.github.com/users/nikomatsakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nikomatsakis/subscriptions", "organizations_url": "https://api.github.com/users/nikomatsakis/orgs", "repos_url": "https://api.github.com/users/nikomatsakis/repos", "events_url": "https://api.github.com/users/nikomatsakis/events{/privacy}", "received_events_url": "https://api.github.com/users/nikomatsakis/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5a0248068c693c64f74623e9a6f7504b900df8a6", "url": "https://api.github.com/repos/rust-lang/rust/commits/5a0248068c693c64f74623e9a6f7504b900df8a6", "html_url": "https://github.com/rust-lang/rust/commit/5a0248068c693c64f74623e9a6f7504b900df8a6"}], "stats": {"total": 30, "additions": 30, "deletions": 0}, "files": [{"sha": "0052fe25b05f0dc061c5857d862c8bee8205a739", "filename": "src/librustc/session/config.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/57ffda6158b6b6a119fa8f59b19f321cae9d0850/src%2Flibrustc%2Fsession%2Fconfig.rs", "raw_url": "https://github.com/rust-lang/rust/raw/57ffda6158b6b6a119fa8f59b19f321cae9d0850/src%2Flibrustc%2Fsession%2Fconfig.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc%2Fsession%2Fconfig.rs?ref=57ffda6158b6b6a119fa8f59b19f321cae9d0850", "patch": "@@ -885,6 +885,8 @@ options! {DebuggingOptions, DebuggingSetter, basic_debugging_options,\n           \"enable incremental compilation (experimental)\"),\n     incremental_info: bool = (false, parse_bool, [UNTRACKED],\n         \"print high-level information about incremental reuse (or the lack thereof)\"),\n+    incremental_dump_hash: bool = (false, parse_bool, [UNTRACKED],\n+        \"dump hash information in textual format to stdout\"),\n     dump_dep_graph: bool = (false, parse_bool, [UNTRACKED],\n           \"dump the dependency graph to $RUST_DEP_GRAPH (default: /tmp/dep_graph.gv)\"),\n     query_dep_graph: bool = (false, parse_bool, [UNTRACKED],"}, {"sha": "ead353512c7ef38dd9900facfa10fe11fec7a565", "filename": "src/librustc_incremental/persist/load.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/57ffda6158b6b6a119fa8f59b19f321cae9d0850/src%2Flibrustc_incremental%2Fpersist%2Fload.rs", "raw_url": "https://github.com/rust-lang/rust/raw/57ffda6158b6b6a119fa8f59b19f321cae9d0850/src%2Flibrustc_incremental%2Fpersist%2Fload.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2Fpersist%2Fload.rs?ref=57ffda6158b6b6a119fa8f59b19f321cae9d0850", "patch": "@@ -250,11 +250,24 @@ fn dirty_nodes<'a, 'tcx>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n                    current_hash);\n                 continue;\n             }\n+\n+            if tcx.sess.opts.debugging_opts.incremental_dump_hash {\n+                println!(\"node {:?} is dirty as hash is {:?} was {:?}\",\n+                         dep_node.map_def(|&def_id| Some(tcx.def_path(def_id))).unwrap(),\n+                         current_hash,\n+                         hash.hash);\n+            }\n+\n             debug!(\"initial_dirty_nodes: {:?} is dirty as hash is {:?}, was {:?}\",\n                    dep_node.map_def(|&def_id| Some(tcx.def_path(def_id))).unwrap(),\n                    current_hash,\n                    hash.hash);\n         } else {\n+            if tcx.sess.opts.debugging_opts.incremental_dump_hash {\n+                println!(\"node {:?} is dirty as it was removed\",\n+                         hash.dep_node);\n+            }\n+\n             debug!(\"initial_dirty_nodes: {:?} is dirty as it was removed\",\n                    hash.dep_node);\n         }"}, {"sha": "1ce4bf7f033417735a3fe09c160ee06a71177a8e", "filename": "src/librustc_incremental/persist/save.rs", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/rust-lang/rust/blob/57ffda6158b6b6a119fa8f59b19f321cae9d0850/src%2Flibrustc_incremental%2Fpersist%2Fsave.rs", "raw_url": "https://github.com/rust-lang/rust/raw/57ffda6158b6b6a119fa8f59b19f321cae9d0850/src%2Flibrustc_incremental%2Fpersist%2Fsave.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_incremental%2Fpersist%2Fsave.rs?ref=57ffda6158b6b6a119fa8f59b19f321cae9d0850", "patch": "@@ -159,6 +159,12 @@ pub fn encode_dep_graph(preds: &Predecessors,\n         }\n     }\n \n+    if tcx.sess.opts.debugging_opts.incremental_dump_hash {\n+        for (dep_node, hash) in &preds.hashes {\n+            println!(\"HIR hash for {:?} is {}\", dep_node, hash);\n+        }\n+    }\n+\n     // Create the serialized dep-graph.\n     let graph = SerializedDepGraph {\n         edges: edges,\n@@ -248,6 +254,15 @@ pub fn encode_metadata_hashes(tcx: TyCtxt,\n         let hash = state.finish();\n \n         debug!(\"save: metadata hash for {:?} is {}\", def_id, hash);\n+\n+        if tcx.sess.opts.debugging_opts.incremental_dump_hash {\n+            println!(\"metadata hash for {:?} is {}\", def_id, hash);\n+            for dep_node in sources {\n+                println!(\"metadata hash for {:?} depends on {:?} with hash {}\",\n+                         def_id, dep_node, preds.hashes[dep_node]);\n+            }\n+        }\n+\n         serialized_hashes.hashes.push(SerializedMetadataHash {\n             def_index: def_id.index,\n             hash: hash,"}]}