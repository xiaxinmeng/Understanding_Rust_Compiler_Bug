{"sha": "8a11da40a789e5d73c5c11d69ba87638ddff8676", "node_id": "MDY6Q29tbWl0NzI0NzEyOjhhMTFkYTQwYTc4OWU1ZDczYzVjMTFkNjliYTg3NjM4ZGRmZjg2NzY=", "commit": {"author": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2020-11-23T04:43:00Z"}, "committer": {"name": "David Tolnay", "email": "dtolnay@gmail.com", "date": "2020-11-23T04:44:56Z"}, "message": "Parse unsafe extern block", "tree": {"sha": "658935369dc3ce1601a153ad55fd2eec787c4db9", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/658935369dc3ce1601a153ad55fd2eec787c4db9"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8a11da40a789e5d73c5c11d69ba87638ddff8676", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEERijF2Cz/ZdaBZKeK+boUO5X/bYIFAl+7PkgACgkQ+boUO5X/\nbYLtLg//WOi6+EQc/G/sbwZB+g1kXan3I4cw7Ru9XX97T7VnsqFvA3HhsBEicomz\nYpD2bxamRnE1h/y1ebre17DdKX+u/qERO/AgcJwz4C0ta/feymXNKyXklazIPYFn\n4dZN/8mP1Z73cIhC/MCikk0Dhmk7sZJA4J1V+ck+RuyEOc1YRmw6+i5McNxx6Uqj\nwKQOuXX/CYG+ZUKe6jP2IDyC2eAPp6v8UgBNwTHeYKhP1Tmc4R+KJ5uV0JA9ElNk\nPLesbPRXdsu3m9fCeiwZT4QGcZ0qPtQSH12ncSwuOFM2fmCd317GPgZx2l8ZjNPs\n7Ej7E2nr5lJYDByzGhRDNXDvnIT0Ju0RbScJaTC48NKILISuDHkAQdn+3L5WfwEZ\nXsfziJZZt2MeUX27R6c2BX+qDkhrN6YUi2xE7CnvVjxeoQzUW63OCMGgSTc5JnlR\nF7p1eEHR9N70e360rAJevwaSsNSpJOBpH0W2YyI+iy1ar9rDCJPMk3IULXS53Mm9\nOiZ0aiRRg4BYGltaIvWq20NgxEEVqwgKgyNx5Ls00o7SZdeJ2j3mKcyUmCi0ysLw\nZhg+/90247M5+AAdquBz6aSvsBS/ZKd83GZKNS+vuNv/3+t2gayLPWr1Cjwujbqw\nU2Frp2UiI8mBOuQ1P0PmYiYV2Pw0XgFfYqrsJpevNtBfHEyiDog=\n=1xTb\n-----END PGP SIGNATURE-----", "payload": "tree 658935369dc3ce1601a153ad55fd2eec787c4db9\nparent cadf0e9fb630d04367ef2611383865963d84ab54\nauthor David Tolnay <dtolnay@gmail.com> 1606106580 -0800\ncommitter David Tolnay <dtolnay@gmail.com> 1606106696 -0800\n\nParse unsafe extern block\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8a11da40a789e5d73c5c11d69ba87638ddff8676", "html_url": "https://github.com/rust-lang/rust/commit/8a11da40a789e5d73c5c11d69ba87638ddff8676", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8a11da40a789e5d73c5c11d69ba87638ddff8676/comments", "author": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dtolnay", "id": 1940490, "node_id": "MDQ6VXNlcjE5NDA0OTA=", "avatar_url": "https://avatars.githubusercontent.com/u/1940490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dtolnay", "html_url": "https://github.com/dtolnay", "followers_url": "https://api.github.com/users/dtolnay/followers", "following_url": "https://api.github.com/users/dtolnay/following{/other_user}", "gists_url": "https://api.github.com/users/dtolnay/gists{/gist_id}", "starred_url": "https://api.github.com/users/dtolnay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dtolnay/subscriptions", "organizations_url": "https://api.github.com/users/dtolnay/orgs", "repos_url": "https://api.github.com/users/dtolnay/repos", "events_url": "https://api.github.com/users/dtolnay/events{/privacy}", "received_events_url": "https://api.github.com/users/dtolnay/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cadf0e9fb630d04367ef2611383865963d84ab54", "url": "https://api.github.com/repos/rust-lang/rust/commits/cadf0e9fb630d04367ef2611383865963d84ab54", "html_url": "https://github.com/rust-lang/rust/commit/cadf0e9fb630d04367ef2611383865963d84ab54"}], "stats": {"total": 28, "additions": 25, "deletions": 3}, "files": [{"sha": "ad29b82f7785b81be5f599bba671e3f3bd19a44a", "filename": "crates/parser/src/grammar/items.rs", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/rust-lang/rust/blob/8a11da40a789e5d73c5c11d69ba87638ddff8676/crates%2Fparser%2Fsrc%2Fgrammar%2Fitems.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8a11da40a789e5d73c5c11d69ba87638ddff8676/crates%2Fparser%2Fsrc%2Fgrammar%2Fitems.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fparser%2Fsrc%2Fgrammar%2Fitems.rs?ref=8a11da40a789e5d73c5c11d69ba87638ddff8676", "patch": "@@ -112,7 +112,7 @@ pub(super) fn maybe_item(p: &mut Parser, m: Marker) -> Result<(), Marker> {\n         has_mods = true;\n     }\n \n-    if p.at(T![extern]) {\n+    if p.at(T![extern]) && p.nth(1) != T!['{'] && (p.nth(1) != STRING || p.nth(2) != T!['{']) {\n         has_mods = true;\n         abi(p);\n     }\n@@ -181,6 +181,14 @@ pub(super) fn maybe_item(p: &mut Parser, m: Marker) -> Result<(), Marker> {\n         T![type] => {\n             type_alias(p, m);\n         }\n+\n+        // unsafe extern \"C\" {}\n+        T![extern] => {\n+            abi(p);\n+            extern_item_list(p);\n+            m.complete(p, EXTERN_BLOCK);\n+        }\n+\n         _ => {\n             if !has_visibility && !has_mods {\n                 return Err(m);"}, {"sha": "87eebf18574f46afbe105d49d9bc8e9c17c162e6", "filename": "crates/syntax/test_data/parser/ok/0068_item_modifiers.rast", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/rust-lang/rust/blob/8a11da40a789e5d73c5c11d69ba87638ddff8676/crates%2Fsyntax%2Ftest_data%2Fparser%2Fok%2F0068_item_modifiers.rast", "raw_url": "https://github.com/rust-lang/rust/raw/8a11da40a789e5d73c5c11d69ba87638ddff8676/crates%2Fsyntax%2Ftest_data%2Fparser%2Fok%2F0068_item_modifiers.rast", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Ftest_data%2Fparser%2Fok%2F0068_item_modifiers.rast?ref=8a11da40a789e5d73c5c11d69ba87638ddff8676", "patch": "@@ -1,4 +1,4 @@\n-SOURCE_FILE@0..304\n+SOURCE_FILE@0..328\n   FN@0..17\n     ASYNC_KW@0..5 \"async\"\n     WHITESPACE@5..6 \" \"\n@@ -215,4 +215,16 @@ SOURCE_FILE@0..304\n     ASSOC_ITEM_LIST@301..303\n       L_CURLY@301..302 \"{\"\n       R_CURLY@302..303 \"}\"\n-  WHITESPACE@303..304 \"\\n\"\n+  WHITESPACE@303..305 \"\\n\\n\"\n+  EXTERN_BLOCK@305..327\n+    UNSAFE_KW@305..311 \"unsafe\"\n+    WHITESPACE@311..312 \" \"\n+    ABI@312..324\n+      EXTERN_KW@312..318 \"extern\"\n+      WHITESPACE@318..319 \" \"\n+      STRING@319..324 \"\\\"C++\\\"\"\n+    WHITESPACE@324..325 \" \"\n+    EXTERN_ITEM_LIST@325..327\n+      L_CURLY@325..326 \"{\"\n+      R_CURLY@326..327 \"}\"\n+  WHITESPACE@327..328 \"\\n\""}, {"sha": "6d27a082cb3670e68cd9f5035ebedf97451e98d1", "filename": "crates/syntax/test_data/parser/ok/0068_item_modifiers.rs", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/8a11da40a789e5d73c5c11d69ba87638ddff8676/crates%2Fsyntax%2Ftest_data%2Fparser%2Fok%2F0068_item_modifiers.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8a11da40a789e5d73c5c11d69ba87638ddff8676/crates%2Fsyntax%2Ftest_data%2Fparser%2Fok%2F0068_item_modifiers.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fsyntax%2Ftest_data%2Fparser%2Fok%2F0068_item_modifiers.rs?ref=8a11da40a789e5d73c5c11d69ba87638ddff8676", "patch": "@@ -14,3 +14,5 @@ unsafe auto trait T {}\n unsafe impl Foo {}\n default impl Foo {}\n unsafe default impl Foo {}\n+\n+unsafe extern \"C++\" {}"}]}