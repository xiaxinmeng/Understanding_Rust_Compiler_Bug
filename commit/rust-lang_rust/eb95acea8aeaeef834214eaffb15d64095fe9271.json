{"sha": "eb95acea8aeaeef834214eaffb15d64095fe9271", "node_id": "MDY6Q29tbWl0NzI0NzEyOmViOTVhY2VhOGFlYWVlZjgzNDIxNGVhZmZiMTVkNjQwOTVmZTkyNzE=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-03-19T00:47:37Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2021-03-19T00:47:37Z"}, "message": "Auto merge of #71780 - jcotton42:string_remove_matches, r=joshtriplett\n\nImplement String::remove_matches\n\nCloses #50206.\n\nI lifted the function help from `@frewsxcv's` original PR (#50015), hope they don't mind.\n\nI'm also wondering whether it would be useful for `remove_matches` to collect up the removed substrings into a `Vec` and return them, right now they're just overwritten by the copy and lost.", "tree": {"sha": "1e13b205c657ee7584e35bf301bace177ef64bc5", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/1e13b205c657ee7584e35bf301bace177ef64bc5"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/eb95acea8aeaeef834214eaffb15d64095fe9271", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/eb95acea8aeaeef834214eaffb15d64095fe9271", "html_url": "https://github.com/rust-lang/rust/commit/eb95acea8aeaeef834214eaffb15d64095fe9271", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/eb95acea8aeaeef834214eaffb15d64095fe9271/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1705a7d64b833d1c4b69958b0627bd054e6d764b", "url": "https://api.github.com/repos/rust-lang/rust/commits/1705a7d64b833d1c4b69958b0627bd054e6d764b", "html_url": "https://github.com/rust-lang/rust/commit/1705a7d64b833d1c4b69958b0627bd054e6d764b"}, {"sha": "a2571cfc8b6f5cf5d8d2e7075ac4809aceae9541", "url": "https://api.github.com/repos/rust-lang/rust/commits/a2571cfc8b6f5cf5d8d2e7075ac4809aceae9541", "html_url": "https://github.com/rust-lang/rust/commit/a2571cfc8b6f5cf5d8d2e7075ac4809aceae9541"}], "stats": {"total": 84, "additions": 84, "deletions": 0}, "files": [{"sha": "019b17a594536a5869e192cb57676c8335cf657e", "filename": "library/alloc/src/string.rs", "status": "modified", "additions": 56, "deletions": 0, "changes": 56, "blob_url": "https://github.com/rust-lang/rust/blob/eb95acea8aeaeef834214eaffb15d64095fe9271/library%2Falloc%2Fsrc%2Fstring.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb95acea8aeaeef834214eaffb15d64095fe9271/library%2Falloc%2Fsrc%2Fstring.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Fsrc%2Fstring.rs?ref=eb95acea8aeaeef834214eaffb15d64095fe9271", "patch": "@@ -1202,6 +1202,62 @@ impl String {\n         ch\n     }\n \n+    /// Remove all matches of pattern `pat` in the `String`.\n+    ///\n+    /// # Examples\n+    ///\n+    /// ```\n+    /// #![feature(string_remove_matches)]\n+    /// let mut s = String::from(\"Trees are not green, the sky is not blue.\");\n+    /// s.remove_matches(\"not \");\n+    /// assert_eq!(\"Trees are green, the sky is blue.\", s);\n+    /// ```\n+    ///\n+    /// Matches will be detected and removed iteratively, so in cases where\n+    /// patterns overlap, only the first pattern will be removed:\n+    ///\n+    /// ```\n+    /// #![feature(string_remove_matches)]\n+    /// let mut s = String::from(\"banana\");\n+    /// s.remove_matches(\"ana\");\n+    /// assert_eq!(\"bna\", s);\n+    /// ```\n+    #[unstable(feature = \"string_remove_matches\", reason = \"new API\", issue = \"72826\")]\n+    pub fn remove_matches<'a, P>(&'a mut self, pat: P)\n+    where\n+        P: for<'x> Pattern<'x>,\n+    {\n+        use core::str::pattern::Searcher;\n+\n+        let matches = {\n+            let mut searcher = pat.into_searcher(self);\n+            let mut matches = Vec::new();\n+\n+            while let Some(m) = searcher.next_match() {\n+                matches.push(m);\n+            }\n+\n+            matches\n+        };\n+\n+        let len = self.len();\n+        let mut shrunk_by = 0;\n+\n+        // SAFETY: start and end will be on utf8 byte boundaries per\n+        // the Searcher docs\n+        unsafe {\n+            for (start, end) in matches {\n+                ptr::copy(\n+                    self.vec.as_mut_ptr().add(end - shrunk_by),\n+                    self.vec.as_mut_ptr().add(start - shrunk_by),\n+                    len - end,\n+                );\n+                shrunk_by += end - start;\n+            }\n+            self.vec.set_len(len - shrunk_by);\n+        }\n+    }\n+\n     /// Retains only the characters specified by the predicate.\n     ///\n     /// In other words, remove all characters `c` such that `f(c)` returns `false`."}, {"sha": "06874bff44ed6036899dc4e53d2405579964cea6", "filename": "library/alloc/tests/lib.rs", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/rust-lang/rust/blob/eb95acea8aeaeef834214eaffb15d64095fe9271/library%2Falloc%2Ftests%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb95acea8aeaeef834214eaffb15d64095fe9271/library%2Falloc%2Ftests%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Ftests%2Flib.rs?ref=eb95acea8aeaeef834214eaffb15d64095fe9271", "patch": "@@ -22,6 +22,7 @@\n #![feature(slice_partition_dedup)]\n #![feature(vec_extend_from_within)]\n #![feature(vec_spare_capacity)]\n+#![feature(string_remove_matches)]\n \n use std::collections::hash_map::DefaultHasher;\n use std::hash::{Hash, Hasher};"}, {"sha": "9ec0ee97ab9261153da35bf64199c07a40148a73", "filename": "library/alloc/tests/string.rs", "status": "modified", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/rust-lang/rust/blob/eb95acea8aeaeef834214eaffb15d64095fe9271/library%2Falloc%2Ftests%2Fstring.rs", "raw_url": "https://github.com/rust-lang/rust/raw/eb95acea8aeaeef834214eaffb15d64095fe9271/library%2Falloc%2Ftests%2Fstring.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/library%2Falloc%2Ftests%2Fstring.rs?ref=eb95acea8aeaeef834214eaffb15d64095fe9271", "patch": "@@ -365,6 +365,33 @@ fn remove_bad() {\n     \"\u0e28\".to_string().remove(1);\n }\n \n+#[test]\n+fn test_remove_matches() {\n+    let mut s = \"abc\".to_string();\n+\n+    s.remove_matches('b');\n+    assert_eq!(s, \"ac\");\n+    s.remove_matches('b');\n+    assert_eq!(s, \"ac\");\n+\n+    let mut s = \"abcb\".to_string();\n+\n+    s.remove_matches('b');\n+    assert_eq!(s, \"ac\");\n+\n+    let mut s = \"\u0e28\u0e44\u0e17\u0e22\u4e2d\u534eVi\u1ec7t Nam; foobar\u0e28\".to_string();\n+    s.remove_matches('\u0e28');\n+    assert_eq!(s, \"\u0e44\u0e17\u0e22\u4e2d\u534eVi\u1ec7t Nam; foobar\");\n+\n+    let mut s = \"\".to_string();\n+    s.remove_matches(\"\");\n+    assert_eq!(s, \"\");\n+\n+    let mut s = \"aaaaa\".to_string();\n+    s.remove_matches('a');\n+    assert_eq!(s, \"\");\n+}\n+\n #[test]\n fn test_retain() {\n     let mut s = String::from(\"\u03b1_\u03b2_\u03b3\");"}]}