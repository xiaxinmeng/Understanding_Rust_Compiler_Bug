{"sha": "8999e877ed860961a6ca3c1150e5641ba6eb336f", "node_id": "MDY6Q29tbWl0NzI0NzEyOjg5OTllODc3ZWQ4NjA5NjFhNmNhM2MxMTUwZTU2NDFiYTZlYjMzNmY=", "commit": {"author": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2016-05-17T07:06:18Z"}, "committer": {"name": "Felix S. Klock II", "email": "pnkfelix@pnkfx.org", "date": "2016-05-17T07:06:18Z"}, "message": "`mir::dataflow::sanity_check`: removed hackish `tmp = val` propagation code.\n\n(it was an artifact of an earlier design of the `rustc_peek` API, but\nits totally unnecessary now.)", "tree": {"sha": "e0f2249fd8b6a761fef36f4a131ee62ed32cdecc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/e0f2249fd8b6a761fef36f4a131ee62ed32cdecc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/8999e877ed860961a6ca3c1150e5641ba6eb336f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/8999e877ed860961a6ca3c1150e5641ba6eb336f", "html_url": "https://github.com/rust-lang/rust/commit/8999e877ed860961a6ca3c1150e5641ba6eb336f", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/8999e877ed860961a6ca3c1150e5641ba6eb336f/comments", "author": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pnkfelix", "id": 173127, "node_id": "MDQ6VXNlcjE3MzEyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/173127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pnkfelix", "html_url": "https://github.com/pnkfelix", "followers_url": "https://api.github.com/users/pnkfelix/followers", "following_url": "https://api.github.com/users/pnkfelix/following{/other_user}", "gists_url": "https://api.github.com/users/pnkfelix/gists{/gist_id}", "starred_url": "https://api.github.com/users/pnkfelix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pnkfelix/subscriptions", "organizations_url": "https://api.github.com/users/pnkfelix/orgs", "repos_url": "https://api.github.com/users/pnkfelix/repos", "events_url": "https://api.github.com/users/pnkfelix/events{/privacy}", "received_events_url": "https://api.github.com/users/pnkfelix/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "90a652617b23f56e4a89db822b464de341e61049", "url": "https://api.github.com/repos/rust-lang/rust/commits/90a652617b23f56e4a89db822b464de341e61049", "html_url": "https://github.com/rust-lang/rust/commit/90a652617b23f56e4a89db822b464de341e61049"}], "stats": {"total": 43, "additions": 8, "deletions": 35}, "files": [{"sha": "b45b79229128aeb81684c7ed07dd884bd37895d5", "filename": "src/librustc_borrowck/borrowck/mir/dataflow/sanity_check.rs", "status": "modified", "additions": 8, "deletions": 35, "changes": 43, "blob_url": "https://github.com/rust-lang/rust/blob/8999e877ed860961a6ca3c1150e5641ba6eb336f/src%2Flibrustc_borrowck%2Fborrowck%2Fmir%2Fdataflow%2Fsanity_check.rs", "raw_url": "https://github.com/rust-lang/rust/raw/8999e877ed860961a6ca3c1150e5641ba6eb336f/src%2Flibrustc_borrowck%2Fborrowck%2Fmir%2Fdataflow%2Fsanity_check.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustc_borrowck%2Fborrowck%2Fmir%2Fdataflow%2Fsanity_check.rs?ref=8999e877ed860961a6ca3c1150e5641ba6eb336f", "patch": "@@ -145,43 +145,16 @@ pub fn sanity_check_via_rustc_peek<'a, 'tcx, O>(tcx: TyCtxt<'a, 'tcx, 'tcx>,\n                 }\n             }\n \n-            enum Effect<'a, 'tcx:'a> { Propagate(&'a repr::Lvalue<'tcx>), Compute }\n-            let lvalue_effect: Effect = match *rvalue {\n-                // tmp = rhs\n-                repr::Rvalue::Use(repr::Operand::Consume(ref rhs_lval)) =>\n-                    Effect::Propagate(rhs_lval),\n-\n-                repr::Rvalue::Use(repr::Operand::Constant(_)) =>\n-                    Effect::Compute,\n-\n-                _ => {\n-                    // (fall back to BitDenotation for all other kinds of Rvalues\n-                    Effect::Compute\n-                }\n-            };\n-\n             let lhs_mpi = move_data.rev_lookup.find(lvalue);\n \n-            if let Effect::Propagate(rhs_lval) = lvalue_effect {\n-                let rhs_mpi = move_data.rev_lookup.find(rhs_lval);\n-                let state = sets.on_entry.get_bit(rhs_mpi.idx());\n-                debug!(\"rustc_peek: propagate into lvalue {:?} ({:?}) from rhs: {:?} state: {}\",\n-                       lvalue, lhs_mpi, rhs_lval, state);\n-                if state {\n-                    sets.on_entry.set_bit(lhs_mpi.idx());\n-                } else {\n-                    sets.on_entry.clear_bit(lhs_mpi.idx());\n-                }\n-            } else {\n-                debug!(\"rustc_peek: computing effect on lvalue: {:?} ({:?}) in stmt: {:?}\",\n-                       lvalue, lhs_mpi, stmt);\n-                // reset GEN and KILL sets before emulating their effect.\n-                for e in &mut sets.gen_set[..] { *e = 0; }\n-                for e in &mut sets.kill_set[..] { *e = 0; }\n-                results.0.operator.statement_effect(flow_ctxt, &mut sets, bb, j);\n-                bitwise(sets.on_entry, sets.gen_set, &Union);\n-                bitwise(sets.on_entry, sets.kill_set, &Subtract);\n-            }\n+            debug!(\"rustc_peek: computing effect on lvalue: {:?} ({:?}) in stmt: {:?}\",\n+                   lvalue, lhs_mpi, stmt);\n+            // reset GEN and KILL sets before emulating their effect.\n+            for e in &mut sets.gen_set[..] { *e = 0; }\n+            for e in &mut sets.kill_set[..] { *e = 0; }\n+            results.0.operator.statement_effect(flow_ctxt, &mut sets, bb, j);\n+            bitwise(sets.on_entry, sets.gen_set, &Union);\n+            bitwise(sets.on_entry, sets.kill_set, &Subtract);\n         }\n \n         tcx.sess.span_err(span, &format!(\"rustc_peek: MIR did not match \\"}]}