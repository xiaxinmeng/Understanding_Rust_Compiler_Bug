{"sha": "e42e6f9ab902ba05c3f534876ca6ab0dcdce13a2", "node_id": "MDY6Q29tbWl0NzI0NzEyOmU0MmU2ZjlhYjkwMmJhMDVjM2Y1MzQ4NzZjYTZhYjBkY2RjZTEzYTI=", "commit": {"author": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-12-07T12:55:41Z"}, "committer": {"name": "Jonas Schievink", "email": "jonasschievink@gmail.com", "date": "2020-12-07T13:02:27Z"}, "message": "ProcMacroProcessExpander: support attribute macros", "tree": {"sha": "57ba5ab3f9a209e3a2448be67faa5ba46fed4d51", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/57ba5ab3f9a209e3a2448be67faa5ba46fed4d51"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/e42e6f9ab902ba05c3f534876ca6ab0dcdce13a2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/e42e6f9ab902ba05c3f534876ca6ab0dcdce13a2", "html_url": "https://github.com/rust-lang/rust/commit/e42e6f9ab902ba05c3f534876ca6ab0dcdce13a2", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/e42e6f9ab902ba05c3f534876ca6ab0dcdce13a2/comments", "author": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jonas-schievink", "id": 1786438, "node_id": "MDQ6VXNlcjE3ODY0Mzg=", "avatar_url": "https://avatars.githubusercontent.com/u/1786438?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jonas-schievink", "html_url": "https://github.com/jonas-schievink", "followers_url": "https://api.github.com/users/jonas-schievink/followers", "following_url": "https://api.github.com/users/jonas-schievink/following{/other_user}", "gists_url": "https://api.github.com/users/jonas-schievink/gists{/gist_id}", "starred_url": "https://api.github.com/users/jonas-schievink/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jonas-schievink/subscriptions", "organizations_url": "https://api.github.com/users/jonas-schievink/orgs", "repos_url": "https://api.github.com/users/jonas-schievink/repos", "events_url": "https://api.github.com/users/jonas-schievink/events{/privacy}", "received_events_url": "https://api.github.com/users/jonas-schievink/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "403ed489ff51e4b1d9b1bbde1ddb6f765ebcbd1f", "url": "https://api.github.com/repos/rust-lang/rust/commits/403ed489ff51e4b1d9b1bbde1ddb6f765ebcbd1f", "html_url": "https://github.com/rust-lang/rust/commit/403ed489ff51e4b1d9b1bbde1ddb6f765ebcbd1f"}], "stats": {"total": 32, "additions": 11, "deletions": 21}, "files": [{"sha": "0537286dd1de076f2147c1cef76c39bc36ceb4ce", "filename": "crates/proc_macro_api/src/lib.rs", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/rust-lang/rust/blob/e42e6f9ab902ba05c3f534876ca6ab0dcdce13a2/crates%2Fproc_macro_api%2Fsrc%2Flib.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e42e6f9ab902ba05c3f534876ca6ab0dcdce13a2/crates%2Fproc_macro_api%2Fsrc%2Flib.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fproc_macro_api%2Fsrc%2Flib.rs?ref=e42e6f9ab902ba05c3f534876ca6ab0dcdce13a2", "patch": "@@ -42,9 +42,17 @@ impl tt::TokenExpander for ProcMacroProcessExpander {\n     fn expand(\n         &self,\n         subtree: &Subtree,\n-        _attr: Option<&Subtree>,\n+        attr: Option<&Subtree>,\n     ) -> Result<Subtree, tt::ExpansionError> {\n-        self.process.custom_derive(&self.dylib_path, subtree, &self.name)\n+        let task = ExpansionTask {\n+            macro_body: subtree.clone(),\n+            macro_name: self.name.to_string(),\n+            attributes: attr.cloned(),\n+            lib: self.dylib_path.to_path_buf(),\n+        };\n+\n+        let result: ExpansionResult = self.process.send_task(msg::Request::ExpansionMacro(task))?;\n+        Ok(result.expansion)\n     }\n }\n "}, {"sha": "d68723ada36e82c1ea3fac4bdb7af6df9dfdf087", "filename": "crates/proc_macro_api/src/process.rs", "status": "modified", "additions": 1, "deletions": 19, "changes": 20, "blob_url": "https://github.com/rust-lang/rust/blob/e42e6f9ab902ba05c3f534876ca6ab0dcdce13a2/crates%2Fproc_macro_api%2Fsrc%2Fprocess.rs", "raw_url": "https://github.com/rust-lang/rust/raw/e42e6f9ab902ba05c3f534876ca6ab0dcdce13a2/crates%2Fproc_macro_api%2Fsrc%2Fprocess.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/crates%2Fproc_macro_api%2Fsrc%2Fprocess.rs?ref=e42e6f9ab902ba05c3f534876ca6ab0dcdce13a2", "patch": "@@ -10,11 +10,10 @@ use std::{\n };\n \n use crossbeam_channel::{bounded, Receiver, Sender};\n-use tt::Subtree;\n \n use crate::{\n     msg::{ErrorCode, Message, Request, Response, ResponseError},\n-    rpc::{ExpansionResult, ExpansionTask, ListMacrosResult, ListMacrosTask, ProcMacroKind},\n+    rpc::{ListMacrosResult, ListMacrosTask, ProcMacroKind},\n };\n \n #[derive(Debug, Default)]\n@@ -58,23 +57,6 @@ impl ProcMacroProcessSrv {\n         Ok(result.macros)\n     }\n \n-    pub(crate) fn custom_derive(\n-        &self,\n-        dylib_path: &Path,\n-        subtree: &Subtree,\n-        derive_name: &str,\n-    ) -> Result<Subtree, tt::ExpansionError> {\n-        let task = ExpansionTask {\n-            macro_body: subtree.clone(),\n-            macro_name: derive_name.to_string(),\n-            attributes: None,\n-            lib: dylib_path.to_path_buf(),\n-        };\n-\n-        let result: ExpansionResult = self.send_task(Request::ExpansionMacro(task))?;\n-        Ok(result.expansion)\n-    }\n-\n     pub(crate) fn send_task<R>(&self, req: Request) -> Result<R, tt::ExpansionError>\n     where\n         R: TryFrom<Response, Error = &'static str>,"}]}