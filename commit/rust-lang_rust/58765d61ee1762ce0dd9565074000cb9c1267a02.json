{"sha": "58765d61ee1762ce0dd9565074000cb9c1267a02", "node_id": "MDY6Q29tbWl0NzI0NzEyOjU4NzY1ZDYxZWUxNzYyY2UwZGQ5NTY1MDc0MDAwY2I5YzEyNjdhMDI=", "commit": {"author": {"name": "Yuki Okushi", "email": "yuki.okushi@huawei.com", "date": "2021-06-18T01:22:23Z"}, "committer": {"name": "Yuki Okushi", "email": "yuki.okushi@huawei.com", "date": "2021-09-17T04:14:23Z"}, "message": "Emit clearer diagnostics for parens around `for` loop heads", "tree": {"sha": "2953c0306ea3ff37074a55a27ca5f348cfad8d7b", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/2953c0306ea3ff37074a55a27ca5f348cfad8d7b"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/58765d61ee1762ce0dd9565074000cb9c1267a02", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEx6scKn6IIf/+FpBu2rpbBylhwYoFAmFEFh8ACgkQ2rpbBylh\nwYpA6Q//fY5wTG2uiTIniEO21ft8BAcrXCIPCMBwq86kWBppePwjFhihSA13ykJ2\n4bp2UmJe2f3USmQ7kuJPi05lHEEf0rfoKJK2nGfZCBv2I0mNIyRsL2xEBbvqpHCR\nw53SMJVy8Wu1LQeMF+tNawqMktxMvD1iW20Ldv94hYiECu0gv6b/2W8xGArJluq4\nlu9xTHaOTmawa6SN6MBfu4qY9dp4/t1v5IAhgKTuJPG0Jg4hUeLNvqjZ3FACaMHx\nEnD1jPihNt0D8/ihYJd6ZtimYc7cWYd+E35FnuPsRoKXcQjvo2Sp4dL/z/0lPLlG\nXct2wQZasA6Zcl58N5MTv34h2rEPSyAmUseG5lLWKLY6dyDOA6Ko7g3VrkOgnN+a\nw3OY+VDZ4GihEUSS2K/sAR+34L8IJwL/OETSSYXMAne/ChkJuWYrvXpFMHvDqKEm\ncfpI1zjGfxfCd0HdlMCHSQSjeg9euxgIEwrRrUfNBLNAcDuVjOIToGTz+3pCZqho\nHTCZExJd3kMxpjQ+YcXEMEWfELX4kmPrPAzBrim2IPXruK4LygrLzBZEKp8TocKz\nmpbOcUCul8fECOSMTW+0nR9OpW8O7vZCQqWC7lKKnYSoWUIHui/zqF0mzE3FWrfY\n6N/2+VIRPrRrICM/ubMWom4LqK/6kfn5hr1aQsQN1pH/gy+NIa0=\n=VEC1\n-----END PGP SIGNATURE-----", "payload": "tree 2953c0306ea3ff37074a55a27ca5f348cfad8d7b\nparent 78a46efff06558674b51c10d8d81758285746ab5\nauthor Yuki Okushi <yuki.okushi@huawei.com> 1623979343 +0900\ncommitter Yuki Okushi <yuki.okushi@huawei.com> 1631852063 +0900\n\nEmit clearer diagnostics for parens around `for` loop heads\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/58765d61ee1762ce0dd9565074000cb9c1267a02", "html_url": "https://github.com/rust-lang/rust/commit/58765d61ee1762ce0dd9565074000cb9c1267a02", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/58765d61ee1762ce0dd9565074000cb9c1267a02/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "78a46efff06558674b51c10d8d81758285746ab5", "url": "https://api.github.com/repos/rust-lang/rust/commits/78a46efff06558674b51c10d8d81758285746ab5", "html_url": "https://github.com/rust-lang/rust/commit/78a46efff06558674b51c10d8d81758285746ab5"}], "stats": {"total": 14, "additions": 7, "deletions": 7}, "files": [{"sha": "ab7478c7e5faab52fdc65295c0dcf25f8c9861cb", "filename": "compiler/rustc_parse/src/parser/diagnostics.rs", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/rust-lang/rust/blob/58765d61ee1762ce0dd9565074000cb9c1267a02/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "raw_url": "https://github.com/rust-lang/rust/raw/58765d61ee1762ce0dd9565074000cb9c1267a02/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/compiler%2Frustc_parse%2Fsrc%2Fparser%2Fdiagnostics.rs?ref=58765d61ee1762ce0dd9565074000cb9c1267a02", "patch": "@@ -1346,8 +1346,9 @@ impl<'a> Parser<'a> {\n                     .span_to_snippet(pat.span.trim_start(begin_par_sp).unwrap())\n                     .unwrap_or_else(|_| pprust::pat_to_string(&pat));\n \n-                self.struct_span_err(self.prev_token.span, \"unexpected closing `)`\")\n-                    .span_label(begin_par_sp, \"opening `(`\")\n+                let sp = MultiSpan::from_spans(vec![begin_par_sp, self.prev_token.span]);\n+\n+                self.struct_span_err(sp, \"unexpected parenthesis surrounding `for` loop head\")\n                     .span_suggestion(\n                         begin_par_sp.to(self.prev_token.span),\n                         \"remove parenthesis in `for` loop\","}, {"sha": "8080dbc332ae7146d13648157bc3e64fde3f2f77", "filename": "src/test/ui/parser/recover-for-loop-parens-around-head.rs", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/rust-lang/rust/blob/58765d61ee1762ce0dd9565074000cb9c1267a02/src%2Ftest%2Fui%2Fparser%2Frecover-for-loop-parens-around-head.rs", "raw_url": "https://github.com/rust-lang/rust/raw/58765d61ee1762ce0dd9565074000cb9c1267a02/src%2Ftest%2Fui%2Fparser%2Frecover-for-loop-parens-around-head.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Frecover-for-loop-parens-around-head.rs?ref=58765d61ee1762ce0dd9565074000cb9c1267a02", "patch": "@@ -9,7 +9,7 @@ fn main() {\n \n     for ( elem in vec ) {\n         //~^ ERROR expected one of `)`, `,`, `@`, or `|`, found keyword `in`\n-        //~| ERROR unexpected closing `)`\n+        //~| ERROR unexpected parenthesis surrounding `for` loop head\n         const RECOVERY_WITNESS: () = 0; //~ ERROR mismatched types\n     }\n }"}, {"sha": "98f6b5b884bd2afd44c2844ee7929c0e163ed108", "filename": "src/test/ui/parser/recover-for-loop-parens-around-head.stderr", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/rust-lang/rust/blob/58765d61ee1762ce0dd9565074000cb9c1267a02/src%2Ftest%2Fui%2Fparser%2Frecover-for-loop-parens-around-head.stderr", "raw_url": "https://github.com/rust-lang/rust/raw/58765d61ee1762ce0dd9565074000cb9c1267a02/src%2Ftest%2Fui%2Fparser%2Frecover-for-loop-parens-around-head.stderr", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftest%2Fui%2Fparser%2Frecover-for-loop-parens-around-head.stderr?ref=58765d61ee1762ce0dd9565074000cb9c1267a02", "patch": "@@ -4,13 +4,12 @@ error: expected one of `)`, `,`, `@`, or `|`, found keyword `in`\n LL |     for ( elem in vec ) {\n    |                ^^ expected one of `)`, `,`, `@`, or `|`\n \n-error: unexpected closing `)`\n-  --> $DIR/recover-for-loop-parens-around-head.rs:10:23\n+error: unexpected parenthesis surrounding `for` loop head\n+  --> $DIR/recover-for-loop-parens-around-head.rs:10:9\n    |\n LL |     for ( elem in vec ) {\n-   |         --------------^\n+   |         ^-------------^\n    |         |\n-   |         opening `(`\n    |         help: remove parenthesis in `for` loop: `elem in vec`\n \n error[E0308]: mismatched types"}]}