{"sha": "379bda9e527809fcf149383ac52c4afd1328c649", "node_id": "MDY6Q29tbWl0NzI0NzEyOjM3OWJkYTllNTI3ODA5ZmNmMTQ5MzgzYWM1MmM0YWZkMTMyOGM2NDk=", "commit": {"author": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-11-05T08:07:20Z"}, "committer": {"name": "bors", "email": "bors@rust-lang.org", "date": "2013-11-05T08:07:20Z"}, "message": "auto merge of #10282 : sfackler/rust/rustpkg-test-cfg, r=alexcrichton\n\nCloses #10238", "tree": {"sha": "5fbca580baca65edd61adac6bdfb52cc5892e47a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/5fbca580baca65edd61adac6bdfb52cc5892e47a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/379bda9e527809fcf149383ac52c4afd1328c649", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/379bda9e527809fcf149383ac52c4afd1328c649", "html_url": "https://github.com/rust-lang/rust/commit/379bda9e527809fcf149383ac52c4afd1328c649", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/379bda9e527809fcf149383ac52c4afd1328c649/comments", "author": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "committer": {"login": "bors", "id": 3372342, "node_id": "MDQ6VXNlcjMzNzIzNDI=", "avatar_url": "https://avatars.githubusercontent.com/u/3372342?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors", "html_url": "https://github.com/bors", "followers_url": "https://api.github.com/users/bors/followers", "following_url": "https://api.github.com/users/bors/following{/other_user}", "gists_url": "https://api.github.com/users/bors/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors/subscriptions", "organizations_url": "https://api.github.com/users/bors/orgs", "repos_url": "https://api.github.com/users/bors/repos", "events_url": "https://api.github.com/users/bors/events{/privacy}", "received_events_url": "https://api.github.com/users/bors/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bf98981696b244d182b89bc34df6d7894c1f3785", "url": "https://api.github.com/repos/rust-lang/rust/commits/bf98981696b244d182b89bc34df6d7894c1f3785", "html_url": "https://github.com/rust-lang/rust/commit/bf98981696b244d182b89bc34df6d7894c1f3785"}, {"sha": "4b9c5d6878522a23d97db14ff85b6bdc6e2edd84", "url": "https://api.github.com/repos/rust-lang/rust/commits/4b9c5d6878522a23d97db14ff85b6bdc6e2edd84", "html_url": "https://github.com/rust-lang/rust/commit/4b9c5d6878522a23d97db14ff85b6bdc6e2edd84"}], "stats": {"total": 17, "additions": 15, "deletions": 2}, "files": [{"sha": "3856f7f424db2726c4694a5f945d4df36ba19b11", "filename": "src/librustpkg/context.rs", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/rust-lang/rust/blob/379bda9e527809fcf149383ac52c4afd1328c649/src%2Flibrustpkg%2Fcontext.rs", "raw_url": "https://github.com/rust-lang/rust/raw/379bda9e527809fcf149383ac52c4afd1328c649/src%2Flibrustpkg%2Fcontext.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Fcontext.rs?ref=379bda9e527809fcf149383ac52c4afd1328c649", "patch": "@@ -252,8 +252,8 @@ pub fn flags_forbidden_for_cmd(flags: &RustcFlags,\n         return true;\n     }\n \n-    if !cfgs.is_empty() && cmd != \"build\" && cmd != \"install\" {\n-        println(\"The --cfg option can only be used with the build or install commands.\");\n+    if !cfgs.is_empty() && cmd != \"build\" && cmd != \"install\" && cmd != \"test\" {\n+        println(\"The --cfg option can only be used with the build, test, or install commands.\");\n         return true;\n     }\n "}, {"sha": "b45e4ff1755f4e9319a5439b16080e283b000751", "filename": "src/librustpkg/tests.rs", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/rust-lang/rust/blob/379bda9e527809fcf149383ac52c4afd1328c649/src%2Flibrustpkg%2Ftests.rs", "raw_url": "https://github.com/rust-lang/rust/raw/379bda9e527809fcf149383ac52c4afd1328c649/src%2Flibrustpkg%2Ftests.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Flibrustpkg%2Ftests.rs?ref=379bda9e527809fcf149383ac52c4afd1328c649", "patch": "@@ -2098,6 +2098,19 @@ fn test_rustpkg_test_failure_exit_status() {\n     }\n }\n \n+#[test]\n+fn test_rustpkg_test_cfg() {\n+    let foo_id = PkgId::new(\"foo\");\n+    let foo_workspace = create_local_package(&foo_id);\n+    let foo_workspace = foo_workspace.path();\n+    writeFile(&foo_workspace.join_many([\"src\", \"foo-0.1\", \"test.rs\"]),\n+              \"#[test] #[cfg(not(foobar))] fn f() { assert!('a' != 'a'); }\");\n+    let output = command_line_test([~\"test\", ~\"--cfg\", ~\"foobar\", ~\"foo\"],\n+                                   foo_workspace);\n+    let output_str = str::from_utf8(output.output);\n+    assert!(output_str.contains(\"0 passed; 0 failed; 0 ignored; 0 measured\"));\n+}\n+\n #[test]\n fn test_rebuild_when_needed() {\n     let foo_id = PkgId::new(\"foo\");"}]}