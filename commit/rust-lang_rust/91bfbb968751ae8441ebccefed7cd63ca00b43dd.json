{"sha": "91bfbb968751ae8441ebccefed7cd63ca00b43dd", "node_id": "MDY6Q29tbWl0NzI0NzEyOjkxYmZiYjk2ODc1MWFlODQ0MWViY2NlZmVkN2NkNjNjYTAwYjQzZGQ=", "commit": {"author": {"name": "Vytautas Astrauskas", "email": "vastrauskas@gmail.com", "date": "2018-12-10T14:59:55Z"}, "committer": {"name": "Vytautas Astrauskas", "email": "vastrauskas@gmail.com", "date": "2018-12-17T11:18:35Z"}, "message": "Use compiletest timestamp to check if the tests should be rerun.", "tree": {"sha": "71c3247efbdb6a9525dee2b33f16e3243ec895dc", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/71c3247efbdb6a9525dee2b33f16e3243ec895dc"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/91bfbb968751ae8441ebccefed7cd63ca00b43dd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/91bfbb968751ae8441ebccefed7cd63ca00b43dd", "html_url": "https://github.com/rust-lang/rust/commit/91bfbb968751ae8441ebccefed7cd63ca00b43dd", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/91bfbb968751ae8441ebccefed7cd63ca00b43dd/comments", "author": {"login": "vakaras", "id": 75347, "node_id": "MDQ6VXNlcjc1MzQ3", "avatar_url": "https://avatars.githubusercontent.com/u/75347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vakaras", "html_url": "https://github.com/vakaras", "followers_url": "https://api.github.com/users/vakaras/followers", "following_url": "https://api.github.com/users/vakaras/following{/other_user}", "gists_url": "https://api.github.com/users/vakaras/gists{/gist_id}", "starred_url": "https://api.github.com/users/vakaras/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vakaras/subscriptions", "organizations_url": "https://api.github.com/users/vakaras/orgs", "repos_url": "https://api.github.com/users/vakaras/repos", "events_url": "https://api.github.com/users/vakaras/events{/privacy}", "received_events_url": "https://api.github.com/users/vakaras/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vakaras", "id": 75347, "node_id": "MDQ6VXNlcjc1MzQ3", "avatar_url": "https://avatars.githubusercontent.com/u/75347?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vakaras", "html_url": "https://github.com/vakaras", "followers_url": "https://api.github.com/users/vakaras/followers", "following_url": "https://api.github.com/users/vakaras/following{/other_user}", "gists_url": "https://api.github.com/users/vakaras/gists{/gist_id}", "starred_url": "https://api.github.com/users/vakaras/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vakaras/subscriptions", "organizations_url": "https://api.github.com/users/vakaras/orgs", "repos_url": "https://api.github.com/users/vakaras/repos", "events_url": "https://api.github.com/users/vakaras/events{/privacy}", "received_events_url": "https://api.github.com/users/vakaras/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7fb479c92b6358590a0180b00a416bb055b6548e", "url": "https://api.github.com/repos/rust-lang/rust/commits/7fb479c92b6358590a0180b00a416bb055b6548e", "html_url": "https://github.com/rust-lang/rust/commit/7fb479c92b6358590a0180b00a416bb055b6548e"}], "stats": {"total": 28, "additions": 18, "deletions": 10}, "files": [{"sha": "68db2402213d8fe0c2d75a9eca01768e5d3fac8f", "filename": "src/tools/compiletest/src/main.rs", "status": "modified", "additions": 18, "deletions": 10, "changes": 28, "blob_url": "https://github.com/rust-lang/rust/blob/91bfbb968751ae8441ebccefed7cd63ca00b43dd/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/91bfbb968751ae8441ebccefed7cd63ca00b43dd/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fcompiletest%2Fsrc%2Fmain.rs?ref=91bfbb968751ae8441ebccefed7cd63ca00b43dd", "patch": "@@ -682,6 +682,20 @@ fn stamp(config: &Config, testpaths: &TestPaths, revision: Option<&str>) -> Path\n     output_base_dir(config, testpaths, revision).join(\"stamp\")\n }\n \n+/// Walk the directory at `path` and collect timestamps of all files into `inputs`.\n+fn collect_timestamps(path: &PathBuf, inputs: &mut Vec<FileTime>) {\n+    let mut entries = path.read_dir().unwrap().collect::<Vec<_>>();\n+    while let Some(entry) = entries.pop() {\n+        let entry = entry.unwrap();\n+        let path = entry.path();\n+        if entry.metadata().unwrap().is_file() {\n+            inputs.push(mtime(&path));\n+        } else {\n+            entries.extend(path.read_dir().unwrap());\n+        }\n+    }\n+}\n+\n fn up_to_date(\n     config: &Config,\n     testpaths: &TestPaths,\n@@ -725,16 +739,7 @@ fn up_to_date(\n     for pretty_printer_file in &pretty_printer_files {\n         inputs.push(mtime(&rust_src_dir.join(pretty_printer_file)));\n     }\n-    let mut entries = config.run_lib_path.read_dir().unwrap().collect::<Vec<_>>();\n-    while let Some(entry) = entries.pop() {\n-        let entry = entry.unwrap();\n-        let path = entry.path();\n-        if entry.metadata().unwrap().is_file() {\n-            inputs.push(mtime(&path));\n-        } else {\n-            entries.extend(path.read_dir().unwrap());\n-        }\n-    }\n+    collect_timestamps(&config.run_lib_path, &mut inputs);\n     if let Some(ref rustdoc_path) = config.rustdoc_path {\n         inputs.push(mtime(&rustdoc_path));\n         inputs.push(mtime(&rust_src_dir.join(\"src/etc/htmldocck.py\")));\n@@ -746,6 +751,9 @@ fn up_to_date(\n         inputs.push(mtime(path));\n     }\n \n+    // Compiletest itself.\n+    collect_timestamps(&rust_src_dir.join(\"src/tools/compiletest/\"), &mut inputs);\n+\n     inputs.iter().any(|input| *input > stamp)\n }\n "}]}