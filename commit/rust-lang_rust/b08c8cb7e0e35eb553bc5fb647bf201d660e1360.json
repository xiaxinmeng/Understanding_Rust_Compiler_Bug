{"sha": "b08c8cb7e0e35eb553bc5fb647bf201d660e1360", "node_id": "C_kwDOAAsO6NoAKGIwOGM4Y2I3ZTBlMzVlYjU1M2JjNWZiNjQ3YmYyMDFkNjYwZTEzNjA", "commit": {"author": {"name": "Yuki Okushi", "email": "jtitor@2k36.org", "date": "2022-09-22T00:03:52Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-09-22T00:03:52Z"}, "message": "Rollup merge of #101952 - Mark-Simulacrum:missing-fallback, r=ehuss\n\nAvoid panicking on missing fallback\n\nThis just prints a message but continues on if a fallback is missing, which can happen when we're building a partial set of builders and producing a dev-static build from it (e.g., when no Apple builder runs at all).\n\nProbably the more extensive fix is to allow the build-manifest invoker to specify the expected set of targets & hosts, but that's a far more extensive change. The main risk from this is that we accidentally start falling back to linux docs across all platforms without noticing. I'm not sure that we can do much about that though at this time.\n\ncc `@ehuss` since IIRC you participated in adding this system\n\nThis comes up when building a test nightly from a try build, e.g., https://github.com/rust-lang/rust/pull/101855#issuecomment-1250123298. For now I'm going to manually cherry pick this onto that PR for testing purposes.", "tree": {"sha": "15af8ee160e8f32cd3277fffe9360ebd49f91c9a", "url": "https://api.github.com/repos/rust-lang/rust/git/trees/15af8ee160e8f32cd3277fffe9360ebd49f91c9a"}, "url": "https://api.github.com/repos/rust-lang/rust/git/commits/b08c8cb7e0e35eb553bc5fb647bf201d660e1360", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjK6ZoCRBK7hj4Ov3rIwAAuIwIAKudZ0ppLpbAY6hbX0X9jDnN\nO6NLt7ot9cLzplD82bAOxVKc4IHW3rphX9SSJtluLbF/6CP+ti+AG7dFxCLXRTAr\npjH1oIWd+RJAhcFyU+zHcbwhkPFDwO1ajM1tpFoOZmBTlacMypnNBxN87tqzF9a0\nCiTHcPrghbgmqBSpPYqNahiej6xzVpf6nNWiYU4vis2onlRITrv+GgpCHeoZi9fG\n7kGeoqGrLTd/aBkdsZe7gVl+6RHbj/naDLydNZMAjzcAYdLL5gC+qZ8AQWnosOOV\nYbfkTtbv9o2Kxm9hooOvfcjnZiLWwg22+Xr28FcqKkxGNIAJw8XcR2eCu5UqwC4=\n=DW/e\n-----END PGP SIGNATURE-----\n", "payload": "tree 15af8ee160e8f32cd3277fffe9360ebd49f91c9a\nparent 9062b780b32d2eab060b4432863e085d9504ca5c\nparent 84fb168d7f0f143fc9d666cc6de757c3d0949ced\nauthor Yuki Okushi <jtitor@2k36.org> 1663805032 +0900\ncommitter GitHub <noreply@github.com> 1663805032 +0900\n\nRollup merge of #101952 - Mark-Simulacrum:missing-fallback, r=ehuss\n\nAvoid panicking on missing fallback\n\nThis just prints a message but continues on if a fallback is missing, which can happen when we're building a partial set of builders and producing a dev-static build from it (e.g., when no Apple builder runs at all).\n\nProbably the more extensive fix is to allow the build-manifest invoker to specify the expected set of targets & hosts, but that's a far more extensive change. The main risk from this is that we accidentally start falling back to linux docs across all platforms without noticing. I'm not sure that we can do much about that though at this time.\n\ncc `@ehuss` since IIRC you participated in adding this system\n\nThis comes up when building a test nightly from a try build, e.g., https://github.com/rust-lang/rust/pull/101855#issuecomment-1250123298. For now I'm going to manually cherry pick this onto that PR for testing purposes.\n"}}, "url": "https://api.github.com/repos/rust-lang/rust/commits/b08c8cb7e0e35eb553bc5fb647bf201d660e1360", "html_url": "https://github.com/rust-lang/rust/commit/b08c8cb7e0e35eb553bc5fb647bf201d660e1360", "comments_url": "https://api.github.com/repos/rust-lang/rust/commits/b08c8cb7e0e35eb553bc5fb647bf201d660e1360/comments", "author": {"login": "JohnTitor", "id": 25030997, "node_id": "MDQ6VXNlcjI1MDMwOTk3", "avatar_url": "https://avatars.githubusercontent.com/u/25030997?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JohnTitor", "html_url": "https://github.com/JohnTitor", "followers_url": "https://api.github.com/users/JohnTitor/followers", "following_url": "https://api.github.com/users/JohnTitor/following{/other_user}", "gists_url": "https://api.github.com/users/JohnTitor/gists{/gist_id}", "starred_url": "https://api.github.com/users/JohnTitor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JohnTitor/subscriptions", "organizations_url": "https://api.github.com/users/JohnTitor/orgs", "repos_url": "https://api.github.com/users/JohnTitor/repos", "events_url": "https://api.github.com/users/JohnTitor/events{/privacy}", "received_events_url": "https://api.github.com/users/JohnTitor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9062b780b32d2eab060b4432863e085d9504ca5c", "url": "https://api.github.com/repos/rust-lang/rust/commits/9062b780b32d2eab060b4432863e085d9504ca5c", "html_url": "https://github.com/rust-lang/rust/commit/9062b780b32d2eab060b4432863e085d9504ca5c"}, {"sha": "84fb168d7f0f143fc9d666cc6de757c3d0949ced", "url": "https://api.github.com/repos/rust-lang/rust/commits/84fb168d7f0f143fc9d666cc6de757c3d0949ced", "html_url": "https://github.com/rust-lang/rust/commit/84fb168d7f0f143fc9d666cc6de757c3d0949ced"}], "stats": {"total": 14, "additions": 12, "deletions": 2}, "files": [{"sha": "bf07cd75cab565730c0b85cfbf67f7beaed031dd", "filename": "src/tools/build-manifest/src/main.rs", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/rust-lang/rust/blob/b08c8cb7e0e35eb553bc5fb647bf201d660e1360/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "raw_url": "https://github.com/rust-lang/rust/raw/b08c8cb7e0e35eb553bc5fb647bf201d660e1360/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs", "contents_url": "https://api.github.com/repos/rust-lang/rust/contents/src%2Ftools%2Fbuild-manifest%2Fsrc%2Fmain.rs?ref=b08c8cb7e0e35eb553bc5fb647bf201d660e1360", "patch": "@@ -543,8 +543,18 @@ impl Builder {\n             for (substr, fallback_target) in fallback {\n                 if target_name.contains(substr) {\n                     let t = Target::from_compressed_tar(self, &tarball_name!(fallback_target));\n-                    // Fallbacks must always be available.\n-                    assert!(t.available);\n+                    // Fallbacks should typically be available on 'production' builds\n+                    // but may not be available for try builds, which only build one target by\n+                    // default. Ideally we'd gate this being a hard error on whether we're in a\n+                    // production build or not, but it's not information that's readily available\n+                    // here.\n+                    if !t.available {\n+                        eprintln!(\n+                            \"{:?} not available for fallback\",\n+                            tarball_name!(fallback_target)\n+                        );\n+                        continue;\n+                    }\n                     return t;\n                 }\n             }"}]}