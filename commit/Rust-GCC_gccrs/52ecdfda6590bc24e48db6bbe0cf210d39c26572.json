{"sha": "52ecdfda6590bc24e48db6bbe0cf210d39c26572", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTJlY2RmZGE2NTkwYmMyNGU0OGRiNmJiZTBjZjIxMGQzOWMyNjU3Mg==", "commit": {"author": {"name": "Jim Wilson", "email": "wilson@cygnus.com", "date": "1999-05-07T12:42:05Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1999-05-07T12:42:05Z"}, "message": "Fix mips16 libstdc++ builds.  Fix inconsistency from Apr 7 change.\n\n\t* mips/elf64.h (MAKE_DECL_ONE_ONLY, UNIQUE_SECTION_P): Define.\n\t* mips/mips.c (mips_select_rtx_section): When TARGET_MIPS16, use\n\tfunction_section instead of text_section.\n\t* mips/mips.h (ENCODE_SECTION_INFO): Add check for UNIQUE_SECTION_P\n\tin TARGET_MIPS16 STRING_CST handling.\n\nFrom-SVN: r26824", "tree": {"sha": "110a889cd2f0a819c32ee9bba382c790225620c8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/110a889cd2f0a819c32ee9bba382c790225620c8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/52ecdfda6590bc24e48db6bbe0cf210d39c26572", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52ecdfda6590bc24e48db6bbe0cf210d39c26572", "html_url": "https://github.com/Rust-GCC/gccrs/commit/52ecdfda6590bc24e48db6bbe0cf210d39c26572", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52ecdfda6590bc24e48db6bbe0cf210d39c26572/comments", "author": null, "committer": null, "parents": [{"sha": "e42dc6049611fc5a9c3b44eba7a7fecf87393a9f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e42dc6049611fc5a9c3b44eba7a7fecf87393a9f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e42dc6049611fc5a9c3b44eba7a7fecf87393a9f"}], "stats": {"total": 31, "additions": 27, "deletions": 4}, "files": [{"sha": "d33a85008fd60d578a13cb171eb9d0f8b1e55666", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52ecdfda6590bc24e48db6bbe0cf210d39c26572/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52ecdfda6590bc24e48db6bbe0cf210d39c26572/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=52ecdfda6590bc24e48db6bbe0cf210d39c26572", "patch": "@@ -1,3 +1,11 @@\n+Fri May  7 12:38:54 1999  Jim Wilson  <wilson@cygnus.com>\n+\n+\t* mips/elf64.h (MAKE_DECL_ONE_ONLY, UNIQUE_SECTION_P): Define.\n+\t* mips/mips.c (mips_select_rtx_section): When TARGET_MIPS16, use\n+\tfunction_section instead of text_section.\n+\t* mips/mips.h (ENCODE_SECTION_INFO): Add check for UNIQUE_SECTION_P\n+\tin TARGET_MIPS16 STRING_CST handling.\n+\n Fri May  7 09:54:11 1999  Nick Clifton  <nickc@cygnus.com>\n \n \tPatch from: Nick Burrett  <nick.burrett@btinternet.com>"}, {"sha": "d692531120f211da4829c8949e2459ff6026c5db", "filename": "gcc/config/mips/elf64.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52ecdfda6590bc24e48db6bbe0cf210d39c26572/gcc%2Fconfig%2Fmips%2Felf64.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52ecdfda6590bc24e48db6bbe0cf210d39c26572/gcc%2Fconfig%2Fmips%2Felf64.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Felf64.h?ref=52ecdfda6590bc24e48db6bbe0cf210d39c26572", "patch": "@@ -195,6 +195,8 @@ do {\t\t\t\t\t\t\t\t\t \\\n   fputc ('\\n', FILE);\t\t\t\t\\\n  } while (0)\n \n+#define MAKE_DECL_ONE_ONLY(DECL) (DECL_WEAK (DECL) = 1)\n+#define UNIQUE_SECTION_P(DECL) (DECL_ONE_ONLY (DECL))\n #define UNIQUE_SECTION(DECL,RELOC)\t\t\t\t\t   \\\n do {\t\t\t\t\t\t\t\t\t   \\\n   int len, size, sec;\t\t\t\t\t\t\t   \\"}, {"sha": "20caaa4417904545765f5169d84edfef3cfa714b", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52ecdfda6590bc24e48db6bbe0cf210d39c26572/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52ecdfda6590bc24e48db6bbe0cf210d39c26572/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=52ecdfda6590bc24e48db6bbe0cf210d39c26572", "patch": "@@ -6884,10 +6884,10 @@ mips_select_rtx_section (mode, x)\n {\n   if (TARGET_MIPS16)\n     {\n-      /* In mips16 mode, the constant table always goes in the .text\n-         section, so that constants can be loaded using PC relative\n+      /* In mips16 mode, the constant table always goes in the same section\n+         as the function, so that constants can be loaded using PC relative\n          addressing.  */\n-      text_section ();\n+      function_section (current_function_decl);\n     }\n   else if (TARGET_EMBEDDED_DATA)\n     {"}, {"sha": "08b78b82d3c0bf4111cf51e07c71dd96ef5ee7d6", "filename": "gcc/config/mips/mips.h", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52ecdfda6590bc24e48db6bbe0cf210d39c26572/gcc%2Fconfig%2Fmips%2Fmips.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52ecdfda6590bc24e48db6bbe0cf210d39c26572/gcc%2Fconfig%2Fmips%2Fmips.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.h?ref=52ecdfda6590bc24e48db6bbe0cf210d39c26572", "patch": "@@ -3168,7 +3168,20 @@ do\t\t\t\t\t\t\t\t\t\\\n     if (TARGET_MIPS16)\t\t\t\t\t\t\t\\\n       {\t\t\t\t\t\t\t\t\t\\\n \tif (TREE_CODE (DECL) == STRING_CST\t\t\t\t\\\n-\t    && ! flag_writable_strings)\t\t\t\t\t\\\n+\t    && ! flag_writable_strings\t\t\t\t\t\\\n+\t    /* If this string is from a function, and the function will\t\\\n+\t       go in a gnu linkonce section, then we can't directly\t\\\n+\t       access the string.  This gets an assembler error\t\t\\\n+\t       \"unsupported PC relative reference to different section\".\\\n+\t       If we modify SELECT_SECTION to put it in function_section\\\n+\t       instead of text_section, it still fails because\t\t\\\n+\t       DECL_SECTION_NAME isn't set until assemble_start_function.\\\n+\t       If we fix that, it still fails because strings are shared\\\n+\t       among multiple functions, and we have cross section\t\\\n+\t       references again.  We force it to work by putting string\t\\\n+\t       addresses in the constant pool and indirecting.  */\t\\\n+\t    && (! current_function_decl\t\t\t\t\t\\\n+\t\t|| ! UNIQUE_SECTION_P (current_function_decl)))\t\t\\\n \t  {\t\t\t\t\t\t\t\t\\\n \t    SYMBOL_REF_FLAG (XEXP (TREE_CST_RTL (DECL), 0)) = 1;\t\\\n \t    mips_string_length += TREE_STRING_LENGTH (DECL);\t\t\\"}]}