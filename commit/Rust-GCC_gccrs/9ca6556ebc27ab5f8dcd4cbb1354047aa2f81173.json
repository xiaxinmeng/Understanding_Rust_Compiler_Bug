{"sha": "9ca6556ebc27ab5f8dcd4cbb1354047aa2f81173", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWNhNjU1NmViYzI3YWI1ZjhkY2Q0Y2JiMTM1NDA0N2FhMmY4MTE3Mw==", "commit": {"author": {"name": "Dodji Seketeli", "email": "dodji@redhat.com", "date": "2011-03-08T15:38:30Z"}, "committer": {"name": "Dodji Seketeli", "email": "dodji@gcc.gnu.org", "date": "2011-03-08T15:38:30Z"}, "message": "re PR c++/47957 (Type mismatch when a class derived a same name with template parameter)\n\nPR c++/47957\n\ngcc/cp/\n\n\t* name-lookup.c (binding_to_template_parms_of_scope_p): Only\n\tconsider scopes of primary template definitions.  Adjust comments.\n\ngcc/testsuite/\n\n\t* g++.dg/lookup/template3.C: New test.\n\nFrom-SVN: r170779", "tree": {"sha": "17e43344745b397a3dc75f4a2c639f89d10cf21c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/17e43344745b397a3dc75f4a2c639f89d10cf21c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9ca6556ebc27ab5f8dcd4cbb1354047aa2f81173", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9ca6556ebc27ab5f8dcd4cbb1354047aa2f81173", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9ca6556ebc27ab5f8dcd4cbb1354047aa2f81173", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9ca6556ebc27ab5f8dcd4cbb1354047aa2f81173/comments", "author": null, "committer": null, "parents": [{"sha": "1c2bbb161e777a6f2dc45f152e7f75c60b0fe39e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1c2bbb161e777a6f2dc45f152e7f75c60b0fe39e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1c2bbb161e777a6f2dc45f152e7f75c60b0fe39e"}], "stats": {"total": 55, "additions": 53, "deletions": 2}, "files": [{"sha": "df362b2953822c31b1e3d62f4b14759a1a990d2a", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9ca6556ebc27ab5f8dcd4cbb1354047aa2f81173/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9ca6556ebc27ab5f8dcd4cbb1354047aa2f81173/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=9ca6556ebc27ab5f8dcd4cbb1354047aa2f81173", "patch": "@@ -1,3 +1,8 @@\n+2011-03-08  Dodji Seketeli  <dodji@redhat.com>\n+\n+\t* name-lookup.c (binding_to_template_parms_of_scope_p): Only\n+\tconsider scopes of primary template definitions.  Adjust comments.\n+\n 2011-03-07  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/48003"}, {"sha": "18e34417b26e2756f0679e34399ee2a65bf8d652", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9ca6556ebc27ab5f8dcd4cbb1354047aa2f81173/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9ca6556ebc27ab5f8dcd4cbb1354047aa2f81173/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=9ca6556ebc27ab5f8dcd4cbb1354047aa2f81173", "patch": "@@ -4205,8 +4205,13 @@ qualified_lookup_using_namespace (tree name, tree scope,\n }\n \n /* Subroutine of outer_binding.\n-   Returns TRUE if BINDING is a binding to a template parameter of SCOPE,\n-   FALSE otherwise.  */\n+\n+   Returns TRUE if BINDING is a binding to a template parameter of\n+   SCOPE.  In that case SCOPE is the scope of a primary template\n+   parameter -- in the sense of G++, i.e, a template that has its own\n+   template header.\n+\n+   Returns FALSE otherwise.  */\n \n static bool\n binding_to_template_parms_of_scope_p (cxx_binding *binding,\n@@ -4222,6 +4227,8 @@ binding_to_template_parms_of_scope_p (cxx_binding *binding,\n   return (scope\n \t  && scope->this_entity\n \t  && get_template_info (scope->this_entity)\n+\t  && PRIMARY_TEMPLATE_P (TI_TEMPLATE\n+\t\t\t\t (get_template_info (scope->this_entity)))\n \t  && parameter_of_template_p (binding_value,\n \t\t\t\t      TI_TEMPLATE (get_template_info \\\n \t\t\t\t\t\t    (scope->this_entity))));"}, {"sha": "a2ed5fd398f315deb579c70265ca44e7e87bd095", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9ca6556ebc27ab5f8dcd4cbb1354047aa2f81173/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9ca6556ebc27ab5f8dcd4cbb1354047aa2f81173/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9ca6556ebc27ab5f8dcd4cbb1354047aa2f81173", "patch": "@@ -1,3 +1,7 @@\n+2011-03-08  Dodji Seketeli  <dodji@redhat.com>\n+\n+\t* g++.dg/lookup/template3.C: New test.\n+\n 2011-03-08  Kai Tietz  <ktietz@redhat.com>\n \n \t* g++.dg/tree-ssa/pr21082.C: Use __INTPTR_TYPE__ instead of"}, {"sha": "e5f6f18edc7d3885bb20a5ac1a6b23f68d531839", "filename": "gcc/testsuite/g++.dg/lookup/template3.C", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9ca6556ebc27ab5f8dcd4cbb1354047aa2f81173/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Ftemplate3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9ca6556ebc27ab5f8dcd4cbb1354047aa2f81173/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Ftemplate3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Ftemplate3.C?ref=9ca6556ebc27ab5f8dcd4cbb1354047aa2f81173", "patch": "@@ -0,0 +1,35 @@\n+// Origin PR c++/47957\n+// { dg-do compile }\n+\n+struct S\n+{\n+  int m;\n+\n+  S()\n+    : m(0)\n+  {\n+  }\n+};\n+\n+struct Base\n+{\n+  typedef S T;\n+};\n+\n+template<class T>\n+struct Derived : public Base\n+{\n+  int\n+  foo()\n+  {\n+    T a; // This is Base::T, not the template parameter.\n+    return a.m;\n+  }\n+};\n+\n+int\n+main()\n+{\n+  Derived<char> d;\n+  return d.foo();\n+}"}]}