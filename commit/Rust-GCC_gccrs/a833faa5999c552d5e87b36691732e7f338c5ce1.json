{"sha": "a833faa5999c552d5e87b36691732e7f338c5ce1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTgzM2ZhYTU5OTljNTUyZDVlODdiMzY2OTE3MzJlN2YzMzhjNWNlMQ==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2003-04-29T03:24:27Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2003-04-29T03:24:27Z"}, "message": "re PR c++/10180 (gcc fails to warn about non-inlined function)\n\n\tPR c++/10180\n\t* tree-inline.c (expand_call_inline): Call push_srcloc when\n\tencountering EXPR_WITH_FILE_LOCATION.  Honor warn_inline.\n\n\tPR c++/10180\n\t* g++.dg/warn/Winline-1.C: New test.\n\nFrom-SVN: r66202", "tree": {"sha": "37410dac5d69f16d8ad0eb350980071c1f87900a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/37410dac5d69f16d8ad0eb350980071c1f87900a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a833faa5999c552d5e87b36691732e7f338c5ce1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a833faa5999c552d5e87b36691732e7f338c5ce1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a833faa5999c552d5e87b36691732e7f338c5ce1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a833faa5999c552d5e87b36691732e7f338c5ce1/comments", "author": null, "committer": null, "parents": [{"sha": "3e1be8c1b1da6e8a423260c65cdaaec64fa37ea7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e1be8c1b1da6e8a423260c65cdaaec64fa37ea7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3e1be8c1b1da6e8a423260c65cdaaec64fa37ea7"}], "stats": {"total": 43, "additions": 42, "deletions": 1}, "files": [{"sha": "c848eba880d93731d7a366326ae8f5e4439b6cd7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a833faa5999c552d5e87b36691732e7f338c5ce1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a833faa5999c552d5e87b36691732e7f338c5ce1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a833faa5999c552d5e87b36691732e7f338c5ce1", "patch": "@@ -1,3 +1,9 @@\n+2003-04-28  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/10180\n+\t* tree-inline.c (expand_call_inline): Call push_srcloc when\n+\tencountering EXPR_WITH_FILE_LOCATION.  Honor warn_inline.\n+\n 2003-04-28  Mike Stump  <mrs@apple.com>\n \n \t* gdbinit.in: Update to reflect new identifier structure."}, {"sha": "b0d8e7587e9c6d3ba2aabe3575e3c0ad597bb4d5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a833faa5999c552d5e87b36691732e7f338c5ce1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a833faa5999c552d5e87b36691732e7f338c5ce1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a833faa5999c552d5e87b36691732e7f338c5ce1", "patch": "@@ -1,3 +1,8 @@\n+2003-04-28  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/10180\n+\t* g++.dg/warn/Winline-1.C: New test.\n+\n 2003-04-28  Jakub Jelinek  <jakub@redhat.com>\n \n \t* gcc.c-torture/execute/string-opt-19.c: New test."}, {"sha": "2f8b39cfb4d12e0ea533fb084d7bad0e8136d03d", "filename": "gcc/testsuite/g++.dg/warn/Winline-1.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a833faa5999c552d5e87b36691732e7f338c5ce1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWinline-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a833faa5999c552d5e87b36691732e7f338c5ce1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWinline-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWinline-1.C?ref=a833faa5999c552d5e87b36691732e7f338c5ce1", "patch": "@@ -0,0 +1,10 @@\n+// { dg-options \"-Winline -O2\" }\n+\n+static inline int foo(int x); // { dg-warning \"\" }\n+\n+int main()\n+{\n+  return(foo(17)); // { dg-warning \"\" }\n+}\n+\n+inline int foo(int x) {  return(x);  }"}, {"sha": "3a8adc51e2ee8a0aa0a33603ceb1f0280ed6f17e", "filename": "gcc/tree-inline.c", "status": "modified", "additions": 21, "deletions": 1, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a833faa5999c552d5e87b36691732e7f338c5ce1/gcc%2Ftree-inline.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a833faa5999c552d5e87b36691732e7f338c5ce1/gcc%2Ftree-inline.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-inline.c?ref=a833faa5999c552d5e87b36691732e7f338c5ce1", "patch": "@@ -1139,6 +1139,19 @@ expand_call_inline (tp, walk_subtrees, data)\n       abort ();\n #endif /* INLINER_FOR_JAVA */\n     }\n+  else if (TREE_CODE (t) == EXPR_WITH_FILE_LOCATION)\n+    {\n+      /* We're walking the subtree directly.  */\n+      *walk_subtrees = 0;\n+      /* Update the source position.  */\n+      push_srcloc (EXPR_WFL_FILENAME (t), EXPR_WFL_LINENO (t));\n+      walk_tree (&EXPR_WFL_NODE (t), expand_call_inline, data, \n+\t\t id->tree_pruner);\n+      /* Restore the original source position.  */\n+      pop_srcloc ();\n+\n+      return NULL_TREE;\n+    }\n \n   if (TYPE_P (t))\n     /* Because types were not copied in copy_body, CALL_EXPRs beneath\n@@ -1173,7 +1186,14 @@ expand_call_inline (tp, walk_subtrees, data)\n   if ((!flag_unit_at_a_time || !DECL_SAVED_TREE (fn)\n        || !cgraph_global_info (fn)->inline_once)\n       && !inlinable_function_p (fn, id, 0))\n-    return NULL_TREE;\n+    {\n+      if (warn_inline && DECL_INLINE (fn))\n+\t{\n+\t  warning_with_decl (fn, \"inlining failed in call to `%s'\");\n+\t  warning (\"called from here\");\n+\t}\n+      return NULL_TREE;\n+    }\n \n   if (! (*lang_hooks.tree_inlining.start_inlining) (fn))\n     return NULL_TREE;"}]}