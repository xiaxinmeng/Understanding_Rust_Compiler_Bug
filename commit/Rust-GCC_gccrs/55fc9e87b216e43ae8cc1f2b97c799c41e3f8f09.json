{"sha": "55fc9e87b216e43ae8cc1f2b97c799c41e3f8f09", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTVmYzllODdiMjE2ZTQzYWU4Y2MxZjJiOTdjNzk5YzQxZTNmOGYwOQ==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2006-11-02T18:40:54Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2006-11-02T18:40:54Z"}, "message": "re PR other/29639 (ext/bitmap_allocator/check_allocate_max_size.cc execution test)\n\n\tPR other/29639\n\t* except.c (switch_to_exception_section): Do not cache the section\n\tif named sections are supported and HAVE_LD_EH_GC_SECTIONS is defined\n\tand flag_function_sections is set.\n\nFrom-SVN: r118422", "tree": {"sha": "f42d8ac2181f6aa81b4776a59939e9acada4e38e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f42d8ac2181f6aa81b4776a59939e9acada4e38e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/55fc9e87b216e43ae8cc1f2b97c799c41e3f8f09", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55fc9e87b216e43ae8cc1f2b97c799c41e3f8f09", "html_url": "https://github.com/Rust-GCC/gccrs/commit/55fc9e87b216e43ae8cc1f2b97c799c41e3f8f09", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55fc9e87b216e43ae8cc1f2b97c799c41e3f8f09/comments", "author": null, "committer": null, "parents": [{"sha": "4cb1c1c3965ebfe93001af017164066506454ebd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4cb1c1c3965ebfe93001af017164066506454ebd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4cb1c1c3965ebfe93001af017164066506454ebd"}], "stats": {"total": 76, "additions": 71, "deletions": 5}, "files": [{"sha": "92b9048f93767e7b4e274f98561da858b9330e04", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55fc9e87b216e43ae8cc1f2b97c799c41e3f8f09/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55fc9e87b216e43ae8cc1f2b97c799c41e3f8f09/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=55fc9e87b216e43ae8cc1f2b97c799c41e3f8f09", "patch": "@@ -1,3 +1,10 @@\n+2006-11-02  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\tPR other/29639\n+\t* except.c (switch_to_exception_section): Do not cache the section\n+\tif named sections are supported and HAVE_LD_EH_GC_SECTIONS is defined\n+\tand flag_function_sections is set.\n+\n 2006-11-01  Kaveh R. Ghazi  <ghazi@caip.rutgers.edu>\n \n \tPR middle-end/29335"}, {"sha": "39827c9b68db48543c0a9405745a379cbcb4d304", "filename": "gcc/except.c", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55fc9e87b216e43ae8cc1f2b97c799c41e3f8f09/gcc%2Fexcept.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55fc9e87b216e43ae8cc1f2b97c799c41e3f8f09/gcc%2Fexcept.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexcept.c?ref=55fc9e87b216e43ae8cc1f2b97c799c41e3f8f09", "patch": "@@ -3522,8 +3522,14 @@ sjlj_output_call_site_table (void)\n static void\n switch_to_exception_section (const char * ARG_UNUSED (fnname))\n {\n-  if (exception_section == 0)\n+  section *s;\n+\n+  if (exception_section)\n+    s = exception_section;\n+  else\n     {\n+      /* Compute the section and cache it into exception_section,\n+\t unless it depends on the function name.  */\n       if (targetm.have_named_sections)\n \t{\n \t  int flags;\n@@ -3539,22 +3545,26 @@ switch_to_exception_section (const char * ARG_UNUSED (fnname))\n \t    }\n \t  else\n \t    flags = SECTION_WRITE;\n+\n #ifdef HAVE_LD_EH_GC_SECTIONS\n \t  if (flag_function_sections)\n \t    {\n \t      char *section_name = xmalloc (strlen (fnname) + 32);\n \t      sprintf (section_name, \".gcc_except_table.%s\", fnname);\n-\t      exception_section = get_section (section_name, flags, NULL);\n+\t      s = get_section (section_name, flags, NULL);\n \t      free (section_name);\n \t    }\n \t  else\n #endif\n-\t  exception_section = get_section (\".gcc_except_table\", flags, NULL);\n+\t    exception_section\n+\t      = s = get_section (\".gcc_except_table\", flags, NULL);\n \t}\n       else\n-\texception_section = flag_pic ? data_section : readonly_data_section;\n+\texception_section\n+\t  = s = flag_pic ? data_section : readonly_data_section;\n     }\n-  switch_to_section (exception_section);\n+\n+  switch_to_section (s);\n }\n #endif\n "}, {"sha": "59e983281a7e5640b5f31777802da0c65fe53d61", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55fc9e87b216e43ae8cc1f2b97c799c41e3f8f09/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55fc9e87b216e43ae8cc1f2b97c799c41e3f8f09/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=55fc9e87b216e43ae8cc1f2b97c799c41e3f8f09", "patch": "@@ -1,3 +1,7 @@\n+2006-11-02  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* g++.dg/eh/gcsec1.C: New test.\n+\n 2006-11-01  Kaveh R. Ghazi  <ghazi@caip.rutgers.edu>\n \n \t* gcc.dg/torture/builtin-math-3.c: Fix semicolons."}, {"sha": "5dfe02a6b9ec616f4e151d3e0b323069c10db392", "filename": "gcc/testsuite/g++.dg/eh/gcsec1.C", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55fc9e87b216e43ae8cc1f2b97c799c41e3f8f09/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Feh%2Fgcsec1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55fc9e87b216e43ae8cc1f2b97c799c41e3f8f09/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Feh%2Fgcsec1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Feh%2Fgcsec1.C?ref=55fc9e87b216e43ae8cc1f2b97c799c41e3f8f09", "patch": "@@ -0,0 +1,45 @@\n+/* PR other/29639 */\n+/* AIX gld supports garbage collection. But AIX gcc does not support \n+   -ffunction-sections or -fdata-sections.  */\n+/* { dg-do run { xfail rs6000-*-aix* powerpc*-*-aix* } } */\n+/* { dg-require-gc-sections \"\" } */\n+/* { dg-options \"-ffunction-sections -Wl,--gc-sections\" } */\n+\n+extern \"C\" void abort (void);\n+\n+int g = 0;\n+\n+void raise_exception()\n+{\n+  throw 1;\n+}\n+\n+void used()\n+{\n+  try {\n+    raise_exception ();\n+  }\n+  catch (int) {\n+    g = 1;\n+  }\n+}\n+\n+void unused()\n+{\n+  try {\n+    raise_exception ();\n+  }\n+  catch (int) {\n+    g = 1;\n+  }\n+}\n+\n+int main()\n+{\n+  used ();\n+\n+  if (g != 1)\n+    abort ();\n+\n+  return 0;\n+}"}]}