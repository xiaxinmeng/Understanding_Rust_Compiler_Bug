{"sha": "8b248c17bd9999eb3adb585b0789595bada43e8c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGIyNDhjMTdiZDk5OTllYjNhZGI1ODViMDc4OTU5NWJhZGE0M2U4Yw==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "iant@golang.org", "date": "2019-01-18T17:13:59Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2019-01-18T17:13:59Z"}, "message": "re PR libbacktrace/88890 (libbacktrace on 32-bit system with _FILE_OFFSET_BITS == 64)\n\n\tPR libbacktrace/88890\n\t* mmapio.c (backtrace_get_view): Change size parameter to\n\tuint64_t.  Check that value fits in size_t.\n\t* read.c (backtrace_get_view): Likewise.\n\t* internal.h (backtrace_get_view): Update declaration.\n\t* elf.c (elf_add): Pass shstrhdr->sh_size to backtrace_get_view.\n\nFrom-SVN: r268082", "tree": {"sha": "763e0966d741405f3d063a4c83449045813900b5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/763e0966d741405f3d063a4c83449045813900b5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8b248c17bd9999eb3adb585b0789595bada43e8c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b248c17bd9999eb3adb585b0789595bada43e8c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8b248c17bd9999eb3adb585b0789595bada43e8c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b248c17bd9999eb3adb585b0789595bada43e8c/comments", "author": {"login": "ianlancetaylor", "id": 3194333, "node_id": "MDQ6VXNlcjMxOTQzMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3194333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ianlancetaylor", "html_url": "https://github.com/ianlancetaylor", "followers_url": "https://api.github.com/users/ianlancetaylor/followers", "following_url": "https://api.github.com/users/ianlancetaylor/following{/other_user}", "gists_url": "https://api.github.com/users/ianlancetaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/ianlancetaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ianlancetaylor/subscriptions", "organizations_url": "https://api.github.com/users/ianlancetaylor/orgs", "repos_url": "https://api.github.com/users/ianlancetaylor/repos", "events_url": "https://api.github.com/users/ianlancetaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/ianlancetaylor/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "89ce81fbe13dc554d489d9f00f92f85164b185d6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/89ce81fbe13dc554d489d9f00f92f85164b185d6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/89ce81fbe13dc554d489d9f00f92f85164b185d6"}], "stats": {"total": 29, "additions": 25, "deletions": 4}, "files": [{"sha": "cf44db69e2d95f13e881051b64b8e99598d853a3", "filename": "libbacktrace/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b248c17bd9999eb3adb585b0789595bada43e8c/libbacktrace%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b248c17bd9999eb3adb585b0789595bada43e8c/libbacktrace%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2FChangeLog?ref=8b248c17bd9999eb3adb585b0789595bada43e8c", "patch": "@@ -1,3 +1,12 @@\n+2019-01-18  Ian Lance Taylor  <iant@golang.org>\n+\n+\tPR libbacktrace/88890\n+\t* mmapio.c (backtrace_get_view): Change size parameter to\n+\tuint64_t.  Check that value fits in size_t.\n+\t* read.c (backtrace_get_view): Likewise.\n+\t* internal.h (backtrace_get_view): Update declaration.\n+\t* elf.c (elf_add): Pass shstrhdr->sh_size to backtrace_get_view.\n+\n 2019-01-17  Tom de Vries  <tdevries@suse.de>\n \n \tPR libbacktrace/82857"}, {"sha": "01cf6f9cff7ad46dfbf7096d4384d59dd6cbb698", "filename": "libbacktrace/elf.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b248c17bd9999eb3adb585b0789595bada43e8c/libbacktrace%2Felf.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b248c17bd9999eb3adb585b0789595bada43e8c/libbacktrace%2Felf.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2Felf.c?ref=8b248c17bd9999eb3adb585b0789595bada43e8c", "patch": "@@ -2813,7 +2813,7 @@ elf_add (struct backtrace_state *state, const char *filename, int descriptor,\n   shstr_size = shstrhdr->sh_size;\n   shstr_off = shstrhdr->sh_offset;\n \n-  if (!backtrace_get_view (state, descriptor, shstr_off, shstr_size,\n+  if (!backtrace_get_view (state, descriptor, shstr_off, shstrhdr->sh_size,\n \t\t\t   error_callback, data, &names_view))\n     goto fail;\n   names_view_valid = 1;"}, {"sha": "065b9535e8b0f24bfc584fbb21835fad132e85ba", "filename": "libbacktrace/internal.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b248c17bd9999eb3adb585b0789595bada43e8c/libbacktrace%2Finternal.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b248c17bd9999eb3adb585b0789595bada43e8c/libbacktrace%2Finternal.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2Finternal.h?ref=8b248c17bd9999eb3adb585b0789595bada43e8c", "patch": "@@ -179,7 +179,7 @@ struct backtrace_view\n /* Create a view of SIZE bytes from DESCRIPTOR at OFFSET.  Store the\n    result in *VIEW.  Returns 1 on success, 0 on error.  */\n extern int backtrace_get_view (struct backtrace_state *state, int descriptor,\n-\t\t\t       off_t offset, size_t size,\n+\t\t\t       off_t offset, uint64_t size,\n \t\t\t       backtrace_error_callback error_callback,\n \t\t\t       void *data, struct backtrace_view *view);\n "}, {"sha": "b188a43a4f224f8afd916c9eaa295e40b9d631fa", "filename": "libbacktrace/mmapio.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b248c17bd9999eb3adb585b0789595bada43e8c/libbacktrace%2Fmmapio.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b248c17bd9999eb3adb585b0789595bada43e8c/libbacktrace%2Fmmapio.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2Fmmapio.c?ref=8b248c17bd9999eb3adb585b0789595bada43e8c", "patch": "@@ -51,7 +51,7 @@ POSSIBILITY OF SUCH DAMAGE.  */\n \n int\n backtrace_get_view (struct backtrace_state *state ATTRIBUTE_UNUSED,\n-\t\t    int descriptor, off_t offset, size_t size,\n+\t\t    int descriptor, off_t offset, uint64_t size,\n \t\t    backtrace_error_callback error_callback,\n \t\t    void *data, struct backtrace_view *view)\n {\n@@ -60,6 +60,12 @@ backtrace_get_view (struct backtrace_state *state ATTRIBUTE_UNUSED,\n   off_t pageoff;\n   void *map;\n \n+  if ((uint64_t) (size_t) size != size)\n+    {\n+      error_callback (data, \"file size too large\", 0);\n+      return 0;\n+    }\n+\n   pagesize = getpagesize ();\n   inpage = offset % pagesize;\n   pageoff = offset - inpage;"}, {"sha": "eb4852610223bb7d1fae40f4c4d96474af89a3d3", "filename": "libbacktrace/read.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b248c17bd9999eb3adb585b0789595bada43e8c/libbacktrace%2Fread.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b248c17bd9999eb3adb585b0789595bada43e8c/libbacktrace%2Fread.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2Fread.c?ref=8b248c17bd9999eb3adb585b0789595bada43e8c", "patch": "@@ -46,12 +46,18 @@ POSSIBILITY OF SUCH DAMAGE.  */\n \n int\n backtrace_get_view (struct backtrace_state *state, int descriptor,\n-\t\t    off_t offset, size_t size,\n+\t\t    off_t offset, uint64_t size,\n \t\t    backtrace_error_callback error_callback,\n \t\t    void *data, struct backtrace_view *view)\n {\n   ssize_t got;\n \n+  if ((uint64_t) (size_t) size != size)\n+    {\n+      error_callback (data, \"file size too large\", 0);\n+      return 0;\n+    }\n+\n   if (lseek (descriptor, offset, SEEK_SET) < 0)\n     {\n       error_callback (data, \"lseek\", errno);"}]}