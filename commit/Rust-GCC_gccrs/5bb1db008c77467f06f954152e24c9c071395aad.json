{"sha": "5bb1db008c77467f06f954152e24c9c071395aad", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWJiMWRiMDA4Yzc3NDY3ZjA2Zjk1NDE1MmUyNGM5YzA3MTM5NWFhZA==", "commit": {"author": {"name": "Warren Levy", "email": "warrenl@redhat.com", "date": "2001-01-26T21:57:08Z"}, "committer": {"name": "Warren Levy", "email": "warrenl@gcc.gnu.org", "date": "2001-01-26T21:57:08Z"}, "message": "natSystem.cc (getSystemTimeZone): Only use tm_gmtoff and timezone if they are available on the system.\n\n\t* java/lang/natSystem.cc (getSystemTimeZone): Only use tm_gmtoff\n\tand timezone if they are available on the system.\n\nFrom-SVN: r39283", "tree": {"sha": "a02b57c458c7362efc95137bb24bcf3ebd2ba1c5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a02b57c458c7362efc95137bb24bcf3ebd2ba1c5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5bb1db008c77467f06f954152e24c9c071395aad", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5bb1db008c77467f06f954152e24c9c071395aad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5bb1db008c77467f06f954152e24c9c071395aad", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5bb1db008c77467f06f954152e24c9c071395aad/comments", "author": null, "committer": null, "parents": [{"sha": "0604c1567548cabaa597001f214520f80de20250", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0604c1567548cabaa597001f214520f80de20250", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0604c1567548cabaa597001f214520f80de20250"}], "stats": {"total": 22, "additions": 20, "deletions": 2}, "files": [{"sha": "7169f8679a97d84bf97b9a5a0d71864004fc7a1f", "filename": "libjava/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5bb1db008c77467f06f954152e24c9c071395aad/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5bb1db008c77467f06f954152e24c9c071395aad/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=5bb1db008c77467f06f954152e24c9c071395aad", "patch": "@@ -1,3 +1,8 @@\n+2001-01-26  Warren Levy  <warrenl@redhat.com>\n+\n+\t* java/lang/natSystem.cc (getSystemTimeZone): Only use tm_gmtoff\n+\tand timezone if they are available on the system.\n+\n 2001-01-24  Tom Tromey  <tromey@redhat.com>\n \n \t* java/lang/sf_fabs.c: Use uint32_t, not __uint32_t."}, {"sha": "3e96559e8f029a5c821db4073c4ebe87b3a6eda4", "filename": "libjava/java/lang/natSystem.cc", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5bb1db008c77467f06f954152e24c9c071395aad/libjava%2Fjava%2Flang%2FnatSystem.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5bb1db008c77467f06f954152e24c9c071395aad/libjava%2Fjava%2Flang%2FnatSystem.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FnatSystem.cc?ref=5bb1db008c77467f06f954152e24c9c071395aad", "patch": "@@ -240,15 +240,28 @@ getpwuid_adaptor(T_passwd * (*getpwuid_r)(T_uid user_id, T_passwd *pwd_r,\n jstring\n java::lang::System::getSystemTimeZone (void)\n {\n+  struct tm *tim;\n   time_t current_time;\n   char **tzinfo, *tzid;\n   long tzoffset;\n \n   current_time = time(0);\n \n-  mktime(localtime(&current_time));\n+  mktime(tim = localtime(&current_time));\n+#ifdef STRUCT_TM_HAS_GMTOFF\n+  tzoffset = -(tim->tm_gmtoff);\t// tm_gmtoff is secs EAST of UTC.\n+#elif HAVE_TIMEZONE\n+  tzoffset = timezone;\t\t// timezone is secs WEST of UTC.\n+#else\n+  // FIXME: there must be another global if neither tm_gmtoff nor timezone\n+  // is available, esp. if tzname is valid.\n+  // Richard Earnshaw <rearnsha@arm.com> has suggested using difftime to\n+  // calculate between gmtime and localtime (and accounting for possible\n+  // daylight savings time) as an alternative.  Also note that this same\n+  // issue exists in java/util/natGregorianCalendar.cc.\n+  tzoffset = 0L;\n+#endif\n   tzinfo = tzname;\n-  tzoffset = timezone;\n \n   if ((tzoffset % 3600) == 0)\n     tzoffset = tzoffset / 3600;"}]}