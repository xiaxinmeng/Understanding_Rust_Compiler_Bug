{"sha": "7eca91d4781bb3df941f25c30b971dac66ba1b3d", "node_id": "C_kwDOANBUbNoAKDdlY2E5MWQ0NzgxYmIzZGY5NDFmMjVjMzBiOTcxZGFjNjZiYTFiM2Q", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2023-03-26T18:15:05Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2023-03-26T18:15:05Z"}, "message": "predict: Don't emit -Wsuggest-attribute=cold warning for functions which already have that attribute [PR105685]\n\nIn the following testcase, we predict baz to have cold\nentry regardless of the user supplied attribute (as it call\nunconditionally a cold function), but still issue\na -Wsuggest-attribute=cold warning despite it having that attribute\nalready.\n\nThe following patch avoids that.\n\n2023-03-26  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR ipa/105685\n\t* predict.cc (compute_function_frequency): Don't call\n\twarn_function_cold if function already has cold attribute.\n\n\t* c-c++-common/cold-2.c: New test.", "tree": {"sha": "d8f648eb88d269d3b2d64b9c257992304121bcfc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d8f648eb88d269d3b2d64b9c257992304121bcfc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7eca91d4781bb3df941f25c30b971dac66ba1b3d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7eca91d4781bb3df941f25c30b971dac66ba1b3d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7eca91d4781bb3df941f25c30b971dac66ba1b3d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7eca91d4781bb3df941f25c30b971dac66ba1b3d/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9cdbe57362e5e1c3bfdec798dfd37de2b32b24bc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9cdbe57362e5e1c3bfdec798dfd37de2b32b24bc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9cdbe57362e5e1c3bfdec798dfd37de2b32b24bc"}], "stats": {"total": 23, "additions": 22, "deletions": 1}, "files": [{"sha": "a0dc409648f733d023b17c4c248ee3362765a02c", "filename": "gcc/predict.cc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7eca91d4781bb3df941f25c30b971dac66ba1b3d/gcc%2Fpredict.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7eca91d4781bb3df941f25c30b971dac66ba1b3d/gcc%2Fpredict.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpredict.cc?ref=7eca91d4781bb3df941f25c30b971dac66ba1b3d", "patch": "@@ -4033,7 +4033,9 @@ compute_function_frequency (void)\n     }\n \n   node->frequency = NODE_FREQUENCY_UNLIKELY_EXECUTED;\n-  warn_function_cold (current_function_decl);\n+  if (lookup_attribute (\"cold\", DECL_ATTRIBUTES (current_function_decl))\n+      == NULL)\n+    warn_function_cold (current_function_decl);\n   if (ENTRY_BLOCK_PTR_FOR_FN (cfun)->count.ipa() == profile_count::zero ())\n     return;\n   FOR_EACH_BB_FN (bb, cfun)"}, {"sha": "7f78496fb8205afc54baa5e3ee46cb2f2e286312", "filename": "gcc/testsuite/c-c++-common/cold-2.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7eca91d4781bb3df941f25c30b971dac66ba1b3d/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fcold-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7eca91d4781bb3df941f25c30b971dac66ba1b3d/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fcold-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fcold-2.c?ref=7eca91d4781bb3df941f25c30b971dac66ba1b3d", "patch": "@@ -0,0 +1,19 @@\n+/* PR ipa/105685 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -Wsuggest-attribute=cold\" } */\n+\n+extern void foo (char *, char const *, int);\n+\n+__attribute__((cold)) char *\n+bar (int x)\n+{\n+  static char b[42];\n+  foo (b, \"foo\", x);\n+  return b;\n+}\n+\n+__attribute__((cold)) char *\n+baz (int x)\t\t/* { dg-bogus \"function might be candidate for attribute 'cold'\" } */\n+{\n+  return bar (x);\n+}"}]}