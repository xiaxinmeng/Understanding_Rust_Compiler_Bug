{"sha": "3d283195f78bbfc85038982de371ab89477e9b63", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2QyODMxOTVmNzhiYmZjODUwMzg5ODJkZTM3MWFiODk0NzdlOWI2Mw==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2007-01-12T18:07:57Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2007-01-12T18:07:57Z"}, "message": "re PR middle-end/30443 (4.3 internal compiler error: verify_cgraph_node failed)\n\n\tPR tree-optimization/30443\n\t* tree-inline.c (tree_function_versioning): Do not optimize when\n\tcloning for inlining.\n\nFrom-SVN: r120730", "tree": {"sha": "b05bf93d2ac070a4af5f7ef1caa2f4637cf25426", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b05bf93d2ac070a4af5f7ef1caa2f4637cf25426"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3d283195f78bbfc85038982de371ab89477e9b63", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d283195f78bbfc85038982de371ab89477e9b63", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d283195f78bbfc85038982de371ab89477e9b63", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d283195f78bbfc85038982de371ab89477e9b63/comments", "author": null, "committer": null, "parents": [{"sha": "6270df4c21eb9114e9023f0da513e68cf465553d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6270df4c21eb9114e9023f0da513e68cf465553d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6270df4c21eb9114e9023f0da513e68cf465553d"}], "stats": {"total": 35, "additions": 24, "deletions": 11}, "files": [{"sha": "dcec75dcf8d6dcb7c15e1c511847d1060acb9586", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d283195f78bbfc85038982de371ab89477e9b63/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d283195f78bbfc85038982de371ab89477e9b63/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3d283195f78bbfc85038982de371ab89477e9b63", "patch": "@@ -1,3 +1,9 @@\n+2007-01-12  Jan Hubicka  <jh@suse.cz>\n+\n+\tPR tree-optimization/30443\n+\t* tree-inline.c (tree_function_versioning): Do not optimize when\n+\tcloning for inlining.\n+\n 2007-01-12  Zdenek Dvorak <dvorakz@suse.cz>\n \n \t* doc/loop.texi: Document recording of loop exits."}, {"sha": "3da2cc2b4d70701f82ac9b2ce4499fbe4f05dce3", "filename": "gcc/tree-inline.c", "status": "modified", "additions": 18, "deletions": 11, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d283195f78bbfc85038982de371ab89477e9b63/gcc%2Ftree-inline.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d283195f78bbfc85038982de371ab89477e9b63/gcc%2Ftree-inline.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-inline.c?ref=3d283195f78bbfc85038982de371ab89477e9b63", "patch": "@@ -3209,16 +3209,17 @@ tree_function_versioning (tree old_decl, tree new_decl, varray_type tree_map,\n   DECL_ARTIFICIAL (new_decl) = 1;\n   DECL_ABSTRACT_ORIGIN (new_decl) = DECL_ORIGIN (old_decl);\n \n+  /* Prepare the data structures for the tree copy.  */\n+  memset (&id, 0, sizeof (id));\n+\n   /* Generate a new name for the new version. */\n   if (!update_clones)\n     {\n       DECL_NAME (new_decl) =  create_tmp_var_name (NULL);\n       SET_DECL_ASSEMBLER_NAME (new_decl, DECL_NAME (new_decl));\n       SET_DECL_RTL (new_decl, NULL_RTX);\n+      id.statements_to_fold = pointer_set_create ();\n     }\n-\n-  /* Prepare the data structures for the tree copy.  */\n-  memset (&id, 0, sizeof (id));\n   \n   id.decl_map = splay_tree_new (splay_tree_compare_pointers, NULL, NULL);\n   id.src_fn = old_decl;\n@@ -3233,7 +3234,6 @@ tree_function_versioning (tree old_decl, tree new_decl, varray_type tree_map,\n   id.transform_new_cfg = true;\n   id.transform_return_to_modify = false;\n   id.transform_lang_insert_block = false;\n-  id.statements_to_fold = pointer_set_create ();\n \n   current_function_decl = new_decl;\n   old_entry_block = ENTRY_BLOCK_PTR_FOR_FUNCTION\n@@ -3299,18 +3299,25 @@ tree_function_versioning (tree old_decl, tree new_decl, varray_type tree_map,\n \n   /* Clean up.  */\n   splay_tree_delete (id.decl_map);\n-  fold_marked_statements (0, id.statements_to_fold);\n-  pointer_set_destroy (id.statements_to_fold);\n-  fold_cond_expr_cond ();\n+  if (!update_clones)\n+    {\n+      fold_marked_statements (0, id.statements_to_fold);\n+      pointer_set_destroy (id.statements_to_fold);\n+      fold_cond_expr_cond ();\n+    }\n   if (gimple_in_ssa_p (cfun))\n     {\n       free_dominance_info (CDI_DOMINATORS);\n       free_dominance_info (CDI_POST_DOMINATORS);\n-      delete_unreachable_blocks ();\n+      if (!update_clones)\n+        delete_unreachable_blocks ();\n       update_ssa (TODO_update_ssa);\n-      fold_cond_expr_cond ();\n-      if (need_ssa_update_p ())\n-        update_ssa (TODO_update_ssa);\n+      if (!update_clones)\n+\t{\n+\t  fold_cond_expr_cond ();\n+\t  if (need_ssa_update_p ())\n+\t    update_ssa (TODO_update_ssa);\n+\t}\n     }\n   free_dominance_info (CDI_DOMINATORS);\n   free_dominance_info (CDI_POST_DOMINATORS);"}]}