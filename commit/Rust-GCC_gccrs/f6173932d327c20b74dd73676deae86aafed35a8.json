{"sha": "f6173932d327c20b74dd73676deae86aafed35a8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjYxNzM5MzJkMzI3YzIwYjc0ZGQ3MzY3NmRlYWU4NmFhZmVkMzVhOA==", "commit": {"author": {"name": "Dale Johannesen", "email": "dalej@apple.com", "date": "2005-11-30T18:19:16Z"}, "committer": {"name": "Dale Johannesen", "email": "dalej@gcc.gnu.org", "date": "2005-11-30T18:19:16Z"}, "message": "combine.c (find_split_point): Sign extend bitmask when changing bitfield assignment to IOR of AND.\n\n2005-11-30  Dale Johannesen  <dalej@apple.com>\n            Andrew Pinski  <pinskia@physics.uc.edu>\n\n\t* combine.c (find_split_point):  Sign extend bitmask\n\twhen changing bitfield assignment to IOR of AND.\n\n2005-11-30  Dale Johannesen  <dalej@apple.com>\n\n\t* gcc.c-torture/compile/pr24930.c:  New.\n\n\nCo-Authored-By: Andrew Pinski <pinskia@physics.uc.edu>\n\nFrom-SVN: r107731", "tree": {"sha": "c34dd7d789f3dd43cbf0595491f13705e8035ef6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c34dd7d789f3dd43cbf0595491f13705e8035ef6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f6173932d327c20b74dd73676deae86aafed35a8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f6173932d327c20b74dd73676deae86aafed35a8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f6173932d327c20b74dd73676deae86aafed35a8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f6173932d327c20b74dd73676deae86aafed35a8/comments", "author": null, "committer": null, "parents": [{"sha": "99c7ab426c16387fb2a27681f54b0ca4ff853b69", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/99c7ab426c16387fb2a27681f54b0ca4ff853b69", "html_url": "https://github.com/Rust-GCC/gccrs/commit/99c7ab426c16387fb2a27681f54b0ca4ff853b69"}], "stats": {"total": 33, "additions": 31, "deletions": 2}, "files": [{"sha": "90d2fc892a73e91944b896431198539ea7134622", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6173932d327c20b74dd73676deae86aafed35a8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6173932d327c20b74dd73676deae86aafed35a8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f6173932d327c20b74dd73676deae86aafed35a8", "patch": "@@ -1,3 +1,9 @@\n+2005-11-30  Dale Johannesen  <dalej@apple.com>\n+            Andrew Pinski  <pinskia@physics.uc.edu>\n+\n+\t* combine.c (find_split_point):  Sign extend bitmask\n+\twhen changing bitfield assignment to IOR of AND.\n+\n 2005-11-30  Nathan Sidwell  <nathan@codesourcery.com>\n \n \t* config/ms1/ms1.md (decrement_and_branch_until_zero): Add early"}, {"sha": "08cacab6f0c9549825cb0d347581d1ff61c2617d", "filename": "gcc/combine.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6173932d327c20b74dd73676deae86aafed35a8/gcc%2Fcombine.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6173932d327c20b74dd73676deae86aafed35a8/gcc%2Fcombine.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcombine.c?ref=f6173932d327c20b74dd73676deae86aafed35a8", "patch": "@@ -3361,21 +3361,23 @@ find_split_point (rtx *loc, rtx insn)\n \t  rtx dest = XEXP (SET_DEST (x), 0);\n \t  enum machine_mode mode = GET_MODE (dest);\n \t  unsigned HOST_WIDE_INT mask = ((HOST_WIDE_INT) 1 << len) - 1;\n+\t  rtx or_mask;\n \n \t  if (BITS_BIG_ENDIAN)\n \t    pos = GET_MODE_BITSIZE (mode) - len - pos;\n \n+\t  or_mask = gen_int_mode (src << pos, mode);\n \t  if (src == mask)\n \t    SUBST (SET_SRC (x),\n-\t\t   simplify_gen_binary (IOR, mode, dest, GEN_INT (src << pos)));\n+\t\t   simplify_gen_binary (IOR, mode, dest, or_mask));\n \t  else\n \t    {\n \t      rtx negmask = gen_int_mode (~(mask << pos), mode);\n \t      SUBST (SET_SRC (x),\n \t\t     simplify_gen_binary (IOR, mode,\n \t\t\t\t          simplify_gen_binary (AND, mode,\n \t\t\t\t\t\t\t       dest, negmask),\n-\t\t\t\t\t  GEN_INT (src << pos)));\n+\t\t\t\t\t  or_mask));\n \t    }\n \n \t  SUBST (SET_DEST (x), dest);"}, {"sha": "056b57e924c8695b36e57207fa89f892f0dc9de5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6173932d327c20b74dd73676deae86aafed35a8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6173932d327c20b74dd73676deae86aafed35a8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f6173932d327c20b74dd73676deae86aafed35a8", "patch": "@@ -1,3 +1,7 @@\n+2005-11-30  Dale Johannesen  <dalej@apple.com>\n+\n+\t* gcc.c-torture/compile/pr24930.c:  New.\n+\n 2005-11-30  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/15809"}, {"sha": "d52bb5c5057a63d1a83f34dcbddb755629e3a884", "filename": "gcc/testsuite/gcc.c-torture/compile/pr24930.c", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6173932d327c20b74dd73676deae86aafed35a8/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr24930.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6173932d327c20b74dd73676deae86aafed35a8/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr24930.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr24930.c?ref=f6173932d327c20b74dd73676deae86aafed35a8", "patch": "@@ -0,0 +1,17 @@\n+/* PR 24930 */\n+extern int foo(int u) __attribute__((noinline));\n+int foo(int u) {return 0;}\n+int\n+main(int argc, char** argv)\n+{\n+  const char *buf = argv[1];\n+  \n+  unsigned int data = (((unsigned int) buf[0]) << 8) + (unsigned int) buf[1];\n+  if (data & 0x8000) {\n+    data &= 0x7fff ;\n+    data ^= 0x7fff ;\n+    data += 1 ;\n+    data *= -1 ;\n+  }\n+  return foo((int)data);\n+}"}]}