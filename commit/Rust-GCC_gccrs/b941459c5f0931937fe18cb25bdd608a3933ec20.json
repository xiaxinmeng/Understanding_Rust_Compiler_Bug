{"sha": "b941459c5f0931937fe18cb25bdd608a3933ec20", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yjk0MTQ1OWM1ZjA5MzE5MzdmZTE4Y2IyNWJkZDYwOGEzOTMzZWMyMA==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2019-10-18T17:27:06Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2019-10-18T17:27:06Z"}, "message": "re PR fortran/69455 ([F08] Assembler error(s) when using intrinsic modules in two BLOCK)\n\n2019-10-18  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/69455\n\t* trans-decl.c (generate_local_decl): Avoid misconstructed\n\tintrinsic modules in a BLOCK construct.\n\n2019-10-18  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/69455\n\t* gfortran.dg/pr69455_1.f90: New test.\n\t* gfortran.dg/pr69455_2.f90: Ditto.\n\nFrom-SVN: r277158", "tree": {"sha": "b4453e7f56b6f0a2c4e0f7e76f6ee722c3a79ae9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b4453e7f56b6f0a2c4e0f7e76f6ee722c3a79ae9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b941459c5f0931937fe18cb25bdd608a3933ec20", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b941459c5f0931937fe18cb25bdd608a3933ec20", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b941459c5f0931937fe18cb25bdd608a3933ec20", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b941459c5f0931937fe18cb25bdd608a3933ec20/comments", "author": null, "committer": null, "parents": [{"sha": "9e0d2031c32b748eaf3ea89082c0f8658edcbf82", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e0d2031c32b748eaf3ea89082c0f8658edcbf82", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9e0d2031c32b748eaf3ea89082c0f8658edcbf82"}], "stats": {"total": 48, "additions": 47, "deletions": 1}, "files": [{"sha": "5ba62d251ef5008d71cea80aaa08a41f1cd68081", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b941459c5f0931937fe18cb25bdd608a3933ec20/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b941459c5f0931937fe18cb25bdd608a3933ec20/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=b941459c5f0931937fe18cb25bdd608a3933ec20", "patch": "@@ -1,3 +1,9 @@\n+2019-10-18  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/69455\n+\t* trans-decl.c (generate_local_decl): Avoid misconstructed\n+\tintrinsic modules in a BLOCK construct.\n+\n 2019-10-18  Tobias Burnus  <tobias@codesourcery.com>\n \n \tPR fortran/91586"}, {"sha": "fc295b4e843dd79ca72c9a5185ff1d9b870e5aa8", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b941459c5f0931937fe18cb25bdd608a3933ec20/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b941459c5f0931937fe18cb25bdd608a3933ec20/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=b941459c5f0931937fe18cb25bdd608a3933ec20", "patch": "@@ -5987,7 +5987,14 @@ generate_local_decl (gfc_symbol * sym)\n \n       if (sym->ns && sym->ns->construct_entities)\n \t{\n-\t  if (sym->attr.referenced)\n+\t  /* Construction of the intrinsic modules within a BLOCK\n+\t     construct, where ONLY and RENAMED entities are included,\n+\t     seems to be bogus.  This is a workaround that can be removed\n+\t     if someone ever takes on the task to creating full-fledge\n+\t     modules.  See PR 69455.  */\n+\t  if (sym->attr.referenced\n+\t      && sym->from_intmod != INTMOD_ISO_C_BINDING\n+\t      && sym->from_intmod != INTMOD_ISO_FORTRAN_ENV)\n \t    gfc_get_symbol_decl (sym);\n \t  sym->mark = 1;\n \t}"}, {"sha": "5379447194bc37f811de3e0496c6fa7d79648b8f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b941459c5f0931937fe18cb25bdd608a3933ec20/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b941459c5f0931937fe18cb25bdd608a3933ec20/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b941459c5f0931937fe18cb25bdd608a3933ec20", "patch": "@@ -1,3 +1,9 @@\n+2019-10-18  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/69455\n+\t* gfortran.dg/pr69455_1.f90: New test.\n+\t* gfortran.dg/pr69455_2.f90: Ditto.\n+\n 2019-10-18  Andre Vieira  <andre.simoesdiasvieira@arm.com>\n \n \t* gcc.target/arm/multilib.exp: Add extra tests."}, {"sha": "fe62e5c1b0b0ae7f0d2696e33e6faf5ab0be8ef7", "filename": "gcc/testsuite/gfortran.dg/pr69455_1.f90", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b941459c5f0931937fe18cb25bdd608a3933ec20/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr69455_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b941459c5f0931937fe18cb25bdd608a3933ec20/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr69455_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr69455_1.f90?ref=b941459c5f0931937fe18cb25bdd608a3933ec20", "patch": "@@ -0,0 +1,14 @@\n+! { dg-do run }\n+program foo\n+   block\n+      use, intrinsic :: iso_c_binding, only: wp => c_float, ik => c_int\n+      if (ik /= 4) stop 1\n+      if (wp /= 4) stop 2\n+   end block\n+   block\n+      use, intrinsic :: iso_c_binding, only: wp => c_double, ik => c_int64_t\n+      if (ik /= 8) stop 3\n+      if (wp /= 8) stop 4\n+   end block\n+end program foo\n+"}, {"sha": "8f9fb35021fcdae4143f10197142ac10fbbdaee9", "filename": "gcc/testsuite/gfortran.dg/pr69455_2.f90", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b941459c5f0931937fe18cb25bdd608a3933ec20/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr69455_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b941459c5f0931937fe18cb25bdd608a3933ec20/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr69455_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr69455_2.f90?ref=b941459c5f0931937fe18cb25bdd608a3933ec20", "patch": "@@ -0,0 +1,13 @@\n+! { dg-do run }\n+program foo\n+   block\n+      use, intrinsic :: ISO_FORTRAN_ENV, only: wp => REAL32, ik => INT32\n+      if (ik /= 4) stop 1\n+      if (wp /= 4) stop 2\n+   end block\n+   block\n+      use, intrinsic :: ISO_FORTRAN_ENV, only: wp => REAL64, ik => INT64\n+      if (ik /= 8) stop 3\n+      if (wp /= 8) stop 4\n+   end block\n+end program foo"}]}