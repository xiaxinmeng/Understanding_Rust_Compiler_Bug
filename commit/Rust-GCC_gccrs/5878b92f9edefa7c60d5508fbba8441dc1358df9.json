{"sha": "5878b92f9edefa7c60d5508fbba8441dc1358df9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTg3OGI5MmY5ZWRlZmE3YzYwZDU1MDhmYmJhODQ0MWRjMTM1OGRmOQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2005-06-09T11:36:12Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2005-06-09T11:36:12Z"}, "message": "c-typeck.c (build_c_cast): Check type punning on COMPONENT_REF too.\n\n/:\n\t* c-typeck.c (build_c_cast): Check type punning on COMPONENT_REF\n\ttoo.\ntestsuite:\n\t* gcc.dg/alias-8.c: New.\n\nFrom-SVN: r100799", "tree": {"sha": "787ca8df932d5209b49a6b6917d989cc4a5c0b20", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/787ca8df932d5209b49a6b6917d989cc4a5c0b20"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5878b92f9edefa7c60d5508fbba8441dc1358df9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5878b92f9edefa7c60d5508fbba8441dc1358df9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5878b92f9edefa7c60d5508fbba8441dc1358df9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5878b92f9edefa7c60d5508fbba8441dc1358df9/comments", "author": null, "committer": null, "parents": [{"sha": "9df3d545d50e1c6440491c48f01840edd4346a19", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9df3d545d50e1c6440491c48f01840edd4346a19", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9df3d545d50e1c6440491c48f01840edd4346a19"}], "stats": {"total": 30, "additions": 26, "deletions": 4}, "files": [{"sha": "b4195245fc0190318d32b2a8de6d5e00612684cb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5878b92f9edefa7c60d5508fbba8441dc1358df9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5878b92f9edefa7c60d5508fbba8441dc1358df9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5878b92f9edefa7c60d5508fbba8441dc1358df9", "patch": "@@ -1,3 +1,8 @@\n+2005-06-09  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* c-typeck.c (build_c_cast): Check type punning on COMPONENT_REF\n+\ttoo.\n+\n 2005-06-09  Bernd Schmidt  <bernd.schmidt@analog.com>\n \n \t* config/bfin/bfin.c (enum bfin_builtins): Moved here from..."}, {"sha": "9429b73172c448ae64827b6951edd2b3f2eb1220", "filename": "gcc/c-typeck.c", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5878b92f9edefa7c60d5508fbba8441dc1358df9/gcc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5878b92f9edefa7c60d5508fbba8441dc1358df9/gcc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-typeck.c?ref=5878b92f9edefa7c60d5508fbba8441dc1358df9", "patch": "@@ -3304,14 +3304,15 @@ build_c_cast (tree type, tree expr)\n \t  && !TREE_CONSTANT (value))\n \twarning (0, \"cast to pointer from integer of different size\");\n \n-      if (TREE_CODE (type) == POINTER_TYPE\n+      if (flag_strict_aliasing && warn_strict_aliasing\n+\t  && TREE_CODE (type) == POINTER_TYPE\n \t  && TREE_CODE (otype) == POINTER_TYPE\n \t  && TREE_CODE (expr) == ADDR_EXPR\n-\t  && DECL_P (TREE_OPERAND (expr, 0))\n-\t  && flag_strict_aliasing && warn_strict_aliasing\n+\t  && (DECL_P (TREE_OPERAND (expr, 0))\n+\t      || TREE_CODE (TREE_OPERAND (expr, 0)) == COMPONENT_REF)\n \t  && !VOID_TYPE_P (TREE_TYPE (type)))\n \t{\n-\t  /* Casting the address of a decl to non void pointer. Warn\n+\t  /* Casting the address of an object to non void pointer. Warn\n \t     if the cast breaks type based aliasing.  */\n \t  if (!COMPLETE_TYPE_P (TREE_TYPE (type)))\n \t    warning (0, \"type-punning to incomplete type might break strict-aliasing rules\");"}, {"sha": "fe3197c1e0845ca077dd093b58191570c5c941f8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5878b92f9edefa7c60d5508fbba8441dc1358df9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5878b92f9edefa7c60d5508fbba8441dc1358df9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5878b92f9edefa7c60d5508fbba8441dc1358df9", "patch": "@@ -1,3 +1,7 @@\n+2005-06-09  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* gcc.dg/alias-8.c: New.\n+\n 2005-06-08  Joseph S. Myers  <joseph@codesourcery.com>\n \n \t* gcc.dg/format/cmn_err-1.c: Update."}, {"sha": "690f1b62da94bd8045ab83bed16052de232dafeb", "filename": "gcc/testsuite/gcc.dg/alias-8.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5878b92f9edefa7c60d5508fbba8441dc1358df9/gcc%2Ftestsuite%2Fgcc.dg%2Falias-8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5878b92f9edefa7c60d5508fbba8441dc1358df9/gcc%2Ftestsuite%2Fgcc.dg%2Falias-8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Falias-8.c?ref=5878b92f9edefa7c60d5508fbba8441dc1358df9", "patch": "@@ -0,0 +1,12 @@\n+// { dg-do compile }\n+// { dg-options \"-Wstrict-aliasing=2 -fstrict-aliasing\" }\n+\n+struct s {\n+  char    *p;\n+};\n+\n+void\n+func(struct s *ptr)\n+{\n+  *(void **)&ptr->p = 0; /* { dg-warning \"type-punned pointer\" } */\n+}"}]}