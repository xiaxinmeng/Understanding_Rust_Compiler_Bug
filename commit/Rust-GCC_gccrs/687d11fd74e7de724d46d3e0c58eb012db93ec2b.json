{"sha": "687d11fd74e7de724d46d3e0c58eb012db93ec2b", "node_id": "C_kwDOANBUbNoAKDY4N2QxMWZkNzRlN2RlNzI0ZDQ2ZDNlMGM1OGViMDEyZGI5M2VjMmI", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2022-10-24T20:41:09Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2022-10-24T20:41:09Z"}, "message": "analyzer: fix ICE on va_copy [PR107349]\n\ngcc/analyzer/ChangeLog:\n\tPR analyzer/107349\n\t* varargs.cc (get_va_copy_arg): Fix the non-pointer case.\n\ngcc/testsuite/ChangeLog:\n\tPR analyzer/107349\n\t* gcc.dg/analyzer/stdarg-1-ms_abi.c (pr107349): New.\n\t* gcc.dg/analyzer/stdarg-1-sysv_abi.c (pr107349): New.\n\t* gcc.dg/analyzer/stdarg-1.c (pr107349): New.\n\nSigned-off-by: David Malcolm <dmalcolm@redhat.com>", "tree": {"sha": "6d89e0b28e9baa2a7603822fedcc4bb3587472e6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6d89e0b28e9baa2a7603822fedcc4bb3587472e6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/687d11fd74e7de724d46d3e0c58eb012db93ec2b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/687d11fd74e7de724d46d3e0c58eb012db93ec2b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/687d11fd74e7de724d46d3e0c58eb012db93ec2b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/687d11fd74e7de724d46d3e0c58eb012db93ec2b/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2e8a0553918adc919f98ac5c0224fc6ce1fef68d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2e8a0553918adc919f98ac5c0224fc6ce1fef68d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2e8a0553918adc919f98ac5c0224fc6ce1fef68d"}], "stats": {"total": 23, "additions": 20, "deletions": 3}, "files": [{"sha": "e4dbad79f424bfd9beddad6a7946e0e36b9b5531", "filename": "gcc/analyzer/varargs.cc", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/687d11fd74e7de724d46d3e0c58eb012db93ec2b/gcc%2Fanalyzer%2Fvarargs.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/687d11fd74e7de724d46d3e0c58eb012db93ec2b/gcc%2Fanalyzer%2Fvarargs.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fvarargs.cc?ref=687d11fd74e7de724d46d3e0c58eb012db93ec2b", "patch": "@@ -171,9 +171,8 @@ get_va_copy_arg (const region_model *model,\n   const svalue *arg_sval = model->get_rvalue (arg, ctxt);\n   if (const svalue *cast = arg_sval->maybe_undo_cast ())\n     arg_sval = cast;\n-  /* Expect a POINTER_TYPE; does it point to an array type?  */\n-  gcc_assert (TREE_CODE (TREE_TYPE (arg)) == POINTER_TYPE);\n-  if (TREE_CODE (TREE_TYPE (TREE_TYPE (arg))) == ARRAY_TYPE)\n+  if (TREE_CODE (TREE_TYPE (arg)) == POINTER_TYPE\n+      && TREE_CODE (TREE_TYPE (TREE_TYPE (arg))) == ARRAY_TYPE)\n     {\n       /* va_list_arg_type_node is a pointer to a va_list;\n \t return *ARG_SVAL.  */"}, {"sha": "e55f10de66be10bb843c7af39f65f5f09c50f85f", "filename": "gcc/testsuite/gcc.dg/analyzer/stdarg-1-ms_abi.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/687d11fd74e7de724d46d3e0c58eb012db93ec2b/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fstdarg-1-ms_abi.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/687d11fd74e7de724d46d3e0c58eb012db93ec2b/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fstdarg-1-ms_abi.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fstdarg-1-ms_abi.c?ref=687d11fd74e7de724d46d3e0c58eb012db93ec2b", "patch": "@@ -435,3 +435,9 @@ void test_va_arg_after_return (void)\n   __analyzer_called_by_test_va_arg_after_return (42, 1066);\n   i = __builtin_va_arg (global_ap, int); /* { dg-warning \"dereferencing pointer 'global_ap' to within stale stack frame\" } */\n }\n+\n+void pr107349 (void)\n+{\n+  __builtin_ms_va_list x,y;\n+  __builtin_ms_va_copy(x,y); /* { dg-warning \"use of uninitialized value 'y'\" } */\n+} /* { dg-warning \"missing call to 'va_end'\" } */"}, {"sha": "fb49b3584e2a2feded19b4ad6822fd05325f89de", "filename": "gcc/testsuite/gcc.dg/analyzer/stdarg-1-sysv_abi.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/687d11fd74e7de724d46d3e0c58eb012db93ec2b/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fstdarg-1-sysv_abi.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/687d11fd74e7de724d46d3e0c58eb012db93ec2b/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fstdarg-1-sysv_abi.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fstdarg-1-sysv_abi.c?ref=687d11fd74e7de724d46d3e0c58eb012db93ec2b", "patch": "@@ -435,3 +435,9 @@ void test_va_arg_after_return (void)\n   __analyzer_called_by_test_va_arg_after_return (42, 1066);\n   i = __builtin_va_arg (global_ap, int); /* { dg-warning \"dereferencing pointer 'global_ap' to within stale stack frame\" } */\n }\n+\n+void pr107349 (void)\n+{\n+  __builtin_sysv_va_list x,y;\n+  __builtin_sysv_va_copy(x,y); /* { dg-warning \"use of uninitialized value 'y'\" } */\n+} /* { dg-warning \"missing call to 'va_end'\" } */"}, {"sha": "f2766a505227bac0b8b7d8cc046531c34863f9d6", "filename": "gcc/testsuite/gcc.dg/analyzer/stdarg-1.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/687d11fd74e7de724d46d3e0c58eb012db93ec2b/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fstdarg-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/687d11fd74e7de724d46d3e0c58eb012db93ec2b/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fstdarg-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fstdarg-1.c?ref=687d11fd74e7de724d46d3e0c58eb012db93ec2b", "patch": "@@ -431,3 +431,9 @@ void test_va_arg_after_return (void)\n   __analyzer_called_by_test_va_arg_after_return (42, 1066);\n   i = __builtin_va_arg (global_ap, int); /* { dg-warning \"dereferencing pointer 'global_ap' to within stale stack frame\" } */\n }\n+\n+void pr107349 (void)\n+{\n+  __builtin_va_list x,y;\n+  __builtin_va_copy(x,y); /* { dg-warning \"use of uninitialized value 'y'\" } */\n+} /* { dg-warning \"missing call to 'va_end'\" } */"}]}