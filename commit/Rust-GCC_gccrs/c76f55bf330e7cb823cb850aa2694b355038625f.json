{"sha": "c76f55bf330e7cb823cb850aa2694b355038625f", "node_id": "C_kwDOANBUbNoAKGM3NmY1NWJmMzMwZTdjYjgyM2NiODUwYWEyNjk0YjM1NTAzODYyNWY", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2023-02-04T00:04:55Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2023-02-06T14:23:47Z"}, "message": "libstdc++: Fix testsuite warnings about new C++23 deprecations\n\nWith the recent change to deprecate std::aligned_storage and\nstd::aligned_union we need to adjust some tests that now fail with\n-std=c++23.\n\nlibstdc++-v3/ChangeLog:\n\n\t* include/std/type_traits: Add diagnostic pragmas around\n\treferences to deprecated std::aligned_storage and\n\tstd::aligned_union traits.\n\t* testsuite/20_util/aligned_storage/requirements/alias_decl.cc:\n\tAdd dg-warning for et c++23.\n\t* testsuite/20_util/aligned_storage/requirements/explicit_instantiation.cc:\n\tLikewise.\n\t* testsuite/20_util/aligned_storage/value.cc: Likewise.\n\t* testsuite/20_util/aligned_union/1.cc: Likewise.\n\t* testsuite/20_util/aligned_union/requirements/alias_decl.cc:\n\tLikewise.", "tree": {"sha": "faad2e0bd4ca104bd6bda5f2a6f54bbd34389dc0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/faad2e0bd4ca104bd6bda5f2a6f54bbd34389dc0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c76f55bf330e7cb823cb850aa2694b355038625f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c76f55bf330e7cb823cb850aa2694b355038625f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c76f55bf330e7cb823cb850aa2694b355038625f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c76f55bf330e7cb823cb850aa2694b355038625f/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aa02a69e15dfc4b276457b65fae283f1a06fb2a0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa02a69e15dfc4b276457b65fae283f1a06fb2a0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aa02a69e15dfc4b276457b65fae283f1a06fb2a0"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "2bd607a8b8ff52aba6fd205ab1af2bc4b92f78d0", "filename": "libstdc++-v3/include/std/type_traits", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c76f55bf330e7cb823cb850aa2694b355038625f/libstdc%2B%2B-v3%2Finclude%2Fstd%2Ftype_traits", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c76f55bf330e7cb823cb850aa2694b355038625f/libstdc%2B%2B-v3%2Finclude%2Fstd%2Ftype_traits", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Ftype_traits?ref=c76f55bf330e7cb823cb850aa2694b355038625f", "patch": "@@ -2123,6 +2123,9 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t? sizeof(_Tp) : __strictest_alignment<_Types...>::_S_size;\n     };\n \n+#pragma GCC diagnostic push\n+#pragma GCC diagnostic ignored \"-Wdeprecated-declarations\"\n+\n   /**\n    *  @brief Provide aligned storage for types.\n    *\n@@ -2155,6 +2158,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \n   template <size_t _Len, typename... _Types>\n     const size_t aligned_union<_Len, _Types...>::alignment_value;\n+#pragma GCC diagnostic pop\n \n   /// @cond undocumented\n \n@@ -2586,13 +2590,16 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n     { } _GLIBCXX17_DEPRECATED_SUGGEST(\"std::invoke_result\");\n \n #if __cplusplus >= 201402L\n+#pragma GCC diagnostic push\n+#pragma GCC diagnostic ignored \"-Wdeprecated-declarations\"\n   /// Alias template for aligned_storage\n   template<size_t _Len, size_t _Align =\n \t    __alignof__(typename __aligned_storage_msa<_Len>::__type)>\n     using aligned_storage_t _GLIBCXX23_DEPRECATED = typename aligned_storage<_Len, _Align>::type;\n \n   template <size_t _Len, typename... _Types>\n     using aligned_union_t _GLIBCXX23_DEPRECATED = typename aligned_union<_Len, _Types...>::type;\n+#pragma GCC diagnostic pop\n \n   /// Alias template for decay\n   template<typename _Tp>"}, {"sha": "2e8e90efcd788ebcbed2b0b24d18b3b3880777cb", "filename": "libstdc++-v3/testsuite/20_util/aligned_storage/requirements/alias_decl.cc", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c76f55bf330e7cb823cb850aa2694b355038625f/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_storage%2Frequirements%2Falias_decl.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c76f55bf330e7cb823cb850aa2694b355038625f/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_storage%2Frequirements%2Falias_decl.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_storage%2Frequirements%2Falias_decl.cc?ref=c76f55bf330e7cb823cb850aa2694b355038625f", "patch": "@@ -26,3 +26,6 @@ using namespace std;\n static_assert (is_same<typename aligned_storage<4>::type,\n \t               aligned_storage_t<4>>(),\n                \"aligned_storage_t\" );\n+\n+// { dg-warning \"deprecated\" \"\" { target c++23 } 26 }\n+// { dg-warning \"deprecated\" \"\" { target c++23 } 27 }"}, {"sha": "baec6667f306cf9e918a0ec54af09d07e3a1d07b", "filename": "libstdc++-v3/testsuite/20_util/aligned_storage/requirements/explicit_instantiation.cc", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c76f55bf330e7cb823cb850aa2694b355038625f/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_storage%2Frequirements%2Fexplicit_instantiation.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c76f55bf330e7cb823cb850aa2694b355038625f/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_storage%2Frequirements%2Fexplicit_instantiation.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_storage%2Frequirements%2Fexplicit_instantiation.cc?ref=c76f55bf330e7cb823cb850aa2694b355038625f", "patch": "@@ -29,3 +29,6 @@ namespace std\n   template struct aligned_storage<1, alignment_of<test_type>::value>;\n   template struct aligned_storage<2>;\n }\n+\n+// { dg-warning \"deprecated\" \"\" { target c++23 } 29 }\n+// { dg-warning \"deprecated\" \"\" { target c++23 } 30 }"}, {"sha": "6e9df7ffc5d114ad473aaf78ee35cebc579330cb", "filename": "libstdc++-v3/testsuite/20_util/aligned_storage/value.cc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c76f55bf330e7cb823cb850aa2694b355038625f/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_storage%2Fvalue.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c76f55bf330e7cb823cb850aa2694b355038625f/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_storage%2Fvalue.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_storage%2Fvalue.cc?ref=c76f55bf330e7cb823cb850aa2694b355038625f", "patch": "@@ -59,3 +59,5 @@ void test01()\n   static_assert(sizeof(aligned_storage<5>::type) >= 5, \"\");\n   static_assert(__alignof__(aligned_storage<5>::type) == align_msa, \"\");\n }\n+\n+// { dg-warning \"deprecated\" \"\" { target c++23 } 0 }"}, {"sha": "7501529cbf4fa37e1f717a1246571ddf002d2a32", "filename": "libstdc++-v3/testsuite/20_util/aligned_union/1.cc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c76f55bf330e7cb823cb850aa2694b355038625f/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_union%2F1.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c76f55bf330e7cb823cb850aa2694b355038625f/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_union%2F1.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_union%2F1.cc?ref=c76f55bf330e7cb823cb850aa2694b355038625f", "patch": "@@ -64,6 +64,8 @@ void test01()\n   static_assert(sizeof(au_type2::type) >= max_s+100,\n                 \"Storage size (at least len)\");\n }\n+// { dg-warning \"deprecated\" \"\" { target c++23 } 57 }\n+// { dg-warning \"deprecated\" \"\" { target c++23 } 62 }\n \n int main()\n {"}, {"sha": "41f2b0881af562a2fb91af15ca4720d2c2f215d3", "filename": "libstdc++-v3/testsuite/20_util/aligned_union/requirements/alias_decl.cc", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c76f55bf330e7cb823cb850aa2694b355038625f/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_union%2Frequirements%2Falias_decl.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c76f55bf330e7cb823cb850aa2694b355038625f/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_union%2Frequirements%2Falias_decl.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_union%2Frequirements%2Falias_decl.cc?ref=c76f55bf330e7cb823cb850aa2694b355038625f", "patch": "@@ -26,3 +26,6 @@ using namespace std;\n static_assert (is_same<typename aligned_union<0, char, int>::type,\n \t               aligned_union_t<0, char, int>>(),\n                \"aligned_union_t\" );\n+\n+// { dg-warning \"deprecated\" \"\" { target c++23 } 26 }\n+// { dg-warning \"deprecated\" \"\" { target c++23 } 27 }"}]}