{"sha": "80ad275cf1e6f308d3bbafc34635eb56851d6862", "node_id": "C_kwDOANBUbNoAKDgwYWQyNzVjZjFlNmYzMDhkM2JiYWZjMzQ2MzVlYjU2ODUxZDY4NjI", "commit": {"author": {"name": "Claire Dross", "email": "dross@adacore.com", "date": "2022-11-25T15:28:47Z"}, "committer": {"name": "Marc Poulhi\u00e8s", "email": "poulhies@adacore.com", "date": "2022-11-28T12:02:31Z"}, "message": "ada: Annotate GNAT.Source_Info with an abstract state\n\nSo it can be used safely from SPARK code. The abstract state represents\nthe source code information that is accessed by the functions defined\nin Source_Info. It is volatile as it is updated asyncronously when\nmoving in the code.\n\ngcc/ada/\n\n\t* libgnat/g-souinf.ads (Source_Code_Information): Add a new\n\tvolatile abstract state and add it in the global contract of all\n\tfunctions defined in Source_Info.", "tree": {"sha": "aef0bfd981f8d5a95f09000254fcc64948a386f6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/aef0bfd981f8d5a95f09000254fcc64948a386f6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/80ad275cf1e6f308d3bbafc34635eb56851d6862", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/80ad275cf1e6f308d3bbafc34635eb56851d6862", "html_url": "https://github.com/Rust-GCC/gccrs/commit/80ad275cf1e6f308d3bbafc34635eb56851d6862", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/80ad275cf1e6f308d3bbafc34635eb56851d6862/comments", "author": {"login": "clairedross", "id": 8180017, "node_id": "MDQ6VXNlcjgxODAwMTc=", "avatar_url": "https://avatars.githubusercontent.com/u/8180017?v=4", "gravatar_id": "", "url": "https://api.github.com/users/clairedross", "html_url": "https://github.com/clairedross", "followers_url": "https://api.github.com/users/clairedross/followers", "following_url": "https://api.github.com/users/clairedross/following{/other_user}", "gists_url": "https://api.github.com/users/clairedross/gists{/gist_id}", "starred_url": "https://api.github.com/users/clairedross/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/clairedross/subscriptions", "organizations_url": "https://api.github.com/users/clairedross/orgs", "repos_url": "https://api.github.com/users/clairedross/repos", "events_url": "https://api.github.com/users/clairedross/events{/privacy}", "received_events_url": "https://api.github.com/users/clairedross/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dkm", "id": 87603, "node_id": "MDQ6VXNlcjg3NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/87603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkm", "html_url": "https://github.com/dkm", "followers_url": "https://api.github.com/users/dkm/followers", "following_url": "https://api.github.com/users/dkm/following{/other_user}", "gists_url": "https://api.github.com/users/dkm/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkm/subscriptions", "organizations_url": "https://api.github.com/users/dkm/orgs", "repos_url": "https://api.github.com/users/dkm/repos", "events_url": "https://api.github.com/users/dkm/events{/privacy}", "received_events_url": "https://api.github.com/users/dkm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e75d06f9bfad341aea3565f95fffb8937de5f142", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e75d06f9bfad341aea3565f95fffb8937de5f142", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e75d06f9bfad341aea3565f95fffb8937de5f142"}], "stats": {"total": 20, "additions": 19, "deletions": 1}, "files": [{"sha": "6b72a6497f1360e183a7362d976a9c2052a80ce0", "filename": "gcc/ada/libgnat/g-souinf.ads", "status": "modified", "additions": 19, "deletions": 1, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/80ad275cf1e6f308d3bbafc34635eb56851d6862/gcc%2Fada%2Flibgnat%2Fg-souinf.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/80ad275cf1e6f308d3bbafc34635eb56851d6862/gcc%2Fada%2Flibgnat%2Fg-souinf.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flibgnat%2Fg-souinf.ads?ref=80ad275cf1e6f308d3bbafc34635eb56851d6862", "patch": "@@ -36,7 +36,13 @@\n --  and logging purposes. For example, an exception handler can print out\n --  the name of the source file in which the exception is handled.\n \n-package GNAT.Source_Info is\n+package GNAT.Source_Info with\n+   SPARK_Mode,\n+   Abstract_State =>\n+     (Source_Code_Information with\n+         External => (Async_Writers, Async_Readers)),\n+   Annotate => (GNATprove, Always_Return)\n+is\n    pragma Preelaborate;\n    --  Note that this unit is Preelaborate, but not Pure, that's because the\n    --  functions here such as Line are clearly not pure functions, and normally\n@@ -47,6 +53,8 @@ package GNAT.Source_Info is\n    --  intrinsics as not Pure, even in Pure units, so no problems arose.\n \n    function File return String with\n+     Volatile_Function,\n+     Global => Source_Code_Information,\n      Import, Convention => Intrinsic;\n    --  Return the name of the current file, not including the path information.\n    --  The result is considered to be a static string constant.\n@@ -57,6 +65,8 @@ package GNAT.Source_Info is\n    --  static expression.\n \n    function Source_Location return String with\n+     Volatile_Function,\n+     Global => Source_Code_Information,\n      Import, Convention => Intrinsic;\n    --  Return a string literal of the form \"name:line\", where name is the\n    --  current source file name without path information, and line is the\n@@ -66,6 +76,8 @@ package GNAT.Source_Info is\n    --  string constant.\n \n    function Enclosing_Entity return String with\n+     Volatile_Function,\n+     Global => Source_Code_Information,\n      Import, Convention => Intrinsic;\n    --  Return the name of the current subprogram, package, task, entry or\n    --  protected subprogram. The string is in exactly the form used for the\n@@ -80,15 +92,21 @@ package GNAT.Source_Info is\n    --  from within generic templates.\n \n    function Compilation_ISO_Date return String with\n+     Volatile_Function,\n+     Global => Source_Code_Information,\n      Import, Convention => Intrinsic;\n    --  Returns date of compilation as a static string \"yyyy-mm-dd\".\n \n    function Compilation_Date return String with\n+     Volatile_Function,\n+     Global => Source_Code_Information,\n      Import, Convention => Intrinsic;\n    --  Returns date of compilation as a static string \"mmm dd yyyy\". This is\n    --  in local time form, and is exactly compatible with C macro __DATE__.\n \n    function Compilation_Time return String with\n+     Volatile_Function,\n+     Global => Source_Code_Information,\n      Import, Convention => Intrinsic;\n    --  Returns GMT time of compilation as a static string \"hh:mm:ss\". This is\n    --  in local time form, and is exactly compatible with C macro __TIME__."}]}