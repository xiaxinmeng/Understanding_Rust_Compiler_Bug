{"sha": "8b5865104c57edfc56c5a10bcbcdbaf8b527658f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGI1ODY1MTA0YzU3ZWRmYzU2YzVhMTBiY2JjZGJhZjhiNTI3NjU4Zg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-09-14T20:18:17Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-09-14T20:18:17Z"}, "message": "re PR c++/81314 (Undefined reference to a function with -fopenmp)\n\n\tPR c++/81314\n\t* cp-gimplify.c (omp_var_to_track): Look through references.\n\t(omp_cxx_notice_variable): Likewise.\n\n\t* testsuite/libgomp.c++/pr81314.C: New test.\n\nFrom-SVN: r252770", "tree": {"sha": "3d7d0e0c7d54b8b34774a1e25e74a48dc3f235e1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3d7d0e0c7d54b8b34774a1e25e74a48dc3f235e1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8b5865104c57edfc56c5a10bcbcdbaf8b527658f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b5865104c57edfc56c5a10bcbcdbaf8b527658f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8b5865104c57edfc56c5a10bcbcdbaf8b527658f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b5865104c57edfc56c5a10bcbcdbaf8b527658f/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "595ced60609a353b91face2f87b6f7abe3eaf28c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/595ced60609a353b91face2f87b6f7abe3eaf28c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/595ced60609a353b91face2f87b6f7abe3eaf28c"}], "stats": {"total": 53, "additions": 53, "deletions": 0}, "files": [{"sha": "1bda58141ce77432fa0dda6ae9bd515f15890582", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b5865104c57edfc56c5a10bcbcdbaf8b527658f/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b5865104c57edfc56c5a10bcbcdbaf8b527658f/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=8b5865104c57edfc56c5a10bcbcdbaf8b527658f", "patch": "@@ -1,3 +1,9 @@\n+2017-09-14  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/81314\n+\t* cp-gimplify.c (omp_var_to_track): Look through references.\n+\t(omp_cxx_notice_variable): Likewise.\n+\n 2017-09-13  Nathan Sidwell  <nathan@acm.org>\n \n \tConv-op identifers not in identifier hash table"}, {"sha": "262485a5c1ff74a84774997a7ad88aa83c9883b5", "filename": "gcc/cp/cp-gimplify.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b5865104c57edfc56c5a10bcbcdbaf8b527658f/gcc%2Fcp%2Fcp-gimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b5865104c57edfc56c5a10bcbcdbaf8b527658f/gcc%2Fcp%2Fcp-gimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-gimplify.c?ref=8b5865104c57edfc56c5a10bcbcdbaf8b527658f", "patch": "@@ -895,6 +895,8 @@ omp_var_to_track (tree decl)\n   tree type = TREE_TYPE (decl);\n   if (is_invisiref_parm (decl))\n     type = TREE_TYPE (type);\n+  else if (TREE_CODE (type) == REFERENCE_TYPE)\n+    type = TREE_TYPE (type);\n   while (TREE_CODE (type) == ARRAY_TYPE)\n     type = TREE_TYPE (type);\n   if (type == error_mark_node || !CLASS_TYPE_P (type))\n@@ -947,6 +949,8 @@ omp_cxx_notice_variable (struct cp_genericize_omp_taskreg *omp_ctx, tree decl)\n \t      tree type = TREE_TYPE (decl);\n \t      if (is_invisiref_parm (decl))\n \t\ttype = TREE_TYPE (type);\n+\t      else if (TREE_CODE (type) == REFERENCE_TYPE)\n+\t\ttype = TREE_TYPE (type);\n \t      while (TREE_CODE (type) == ARRAY_TYPE)\n \t\ttype = TREE_TYPE (type);\n \t      get_copy_ctor (type, tf_none);"}, {"sha": "459dcffa5701321e873b6bbf5a2c9fbe2b21aa97", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b5865104c57edfc56c5a10bcbcdbaf8b527658f/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b5865104c57edfc56c5a10bcbcdbaf8b527658f/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=8b5865104c57edfc56c5a10bcbcdbaf8b527658f", "patch": "@@ -1,3 +1,8 @@\n+2017-09-14  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/81314\n+\t* testsuite/libgomp.c++/pr81314.C: New test.\n+\n 2017-09-03  Gerald Pfeifer  <gerald@pfeifer.com>\n \n \t* libgomp.texi (Top): www.openacc.org now uses https."}, {"sha": "afe89438bd3f1f95a4159fd755d05dc9148dbba1", "filename": "libgomp/testsuite/libgomp.c++/pr81314.C", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b5865104c57edfc56c5a10bcbcdbaf8b527658f/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr81314.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b5865104c57edfc56c5a10bcbcdbaf8b527658f/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr81314.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr81314.C?ref=8b5865104c57edfc56c5a10bcbcdbaf8b527658f", "patch": "@@ -0,0 +1,38 @@\n+// PR c++/81314\n+// { dg-do link }\n+\n+template <int N>\n+struct S {\n+  S () { s = 0; }\n+  S (const S &x) { s = x.s; }\n+  ~S () {}\n+  int s;\n+};\n+\n+void\n+foo (S<2> &x)\n+{\n+  #pragma omp taskloop\n+  for (int i = 0; i < 100; ++i)\n+    x.s++;\n+}\n+\n+void\n+bar (S<3> &x)\n+{\n+  #pragma omp task\n+  x.s++;\n+}\n+\n+int\n+main ()\n+{\n+  S<2> s;\n+  S<3> t;\n+  #pragma omp parallel\n+  #pragma omp master\n+  {\n+    foo (s);\n+    bar (t);\n+  }\n+}"}]}