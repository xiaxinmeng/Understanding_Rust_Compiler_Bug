{"sha": "e6c5d9f0f586b303a4d292b42e1e8d705651f86c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTZjNWQ5ZjBmNTg2YjMwM2E0ZDI5MmI0MmUxZThkNzA1NjUxZjg2Yw==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2018-09-05T11:28:49Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2018-09-05T11:28:49Z"}, "message": "Group switch cases in switch lowering (PR tree-optimization/87205).\n\n2018-09-05  Martin Liska  <mliska@suse.cz>\n\n\tPR tree-optimization/87205\n\t* tree-switch-conversion.c (pass_lower_switch::execute):\n\tGroup cases for switch statements.\n2018-09-05  Martin Liska  <mliska@suse.cz>\n\n\tPR tree-optimization/87205\n\t* gcc.dg/tree-ssa/pr87205-2.c: New test.\n\t* gcc.dg/tree-ssa/pr87205.c: New test.\n\nFrom-SVN: r264124", "tree": {"sha": "1b7c60da9489ea13350cf717f48e317704be88d9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1b7c60da9489ea13350cf717f48e317704be88d9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e6c5d9f0f586b303a4d292b42e1e8d705651f86c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e6c5d9f0f586b303a4d292b42e1e8d705651f86c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e6c5d9f0f586b303a4d292b42e1e8d705651f86c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e6c5d9f0f586b303a4d292b42e1e8d705651f86c/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "85004cb2dcc43010001d6231cf6aca6eb769d2c3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/85004cb2dcc43010001d6231cf6aca6eb769d2c3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/85004cb2dcc43010001d6231cf6aca6eb769d2c3"}], "stats": {"total": 60, "additions": 58, "deletions": 2}, "files": [{"sha": "8386829287d74353d523ac50d735a0d401158ea8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6c5d9f0f586b303a4d292b42e1e8d705651f86c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6c5d9f0f586b303a4d292b42e1e8d705651f86c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e6c5d9f0f586b303a4d292b42e1e8d705651f86c", "patch": "@@ -1,3 +1,9 @@\n+2018-09-05  Martin Liska  <mliska@suse.cz>\n+\n+\tPR tree-optimization/87205\n+\t* tree-switch-conversion.c (pass_lower_switch::execute):\n+\tGroup cases for switch statements.\n+\n 2018-09-05  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/87217"}, {"sha": "fc40df045f41777b3aec5d5fd3adb6c479e653ab", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6c5d9f0f586b303a4d292b42e1e8d705651f86c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6c5d9f0f586b303a4d292b42e1e8d705651f86c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e6c5d9f0f586b303a4d292b42e1e8d705651f86c", "patch": "@@ -1,3 +1,9 @@\n+2018-09-05  Martin Liska  <mliska@suse.cz>\n+\n+\tPR tree-optimization/87205\n+\t* gcc.dg/tree-ssa/pr87205-2.c: New test.\n+\t* gcc.dg/tree-ssa/pr87205.c: New test.\n+\n 2018-09-05  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/87217"}, {"sha": "fb1879ed71ba9a691a897578925710c025cc7567", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr87205-2.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6c5d9f0f586b303a4d292b42e1e8d705651f86c/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr87205-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6c5d9f0f586b303a4d292b42e1e8d705651f86c/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr87205-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr87205-2.c?ref=e6c5d9f0f586b303a4d292b42e1e8d705651f86c", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-options \"-O2 -fdump-tree-optimized\" } */\n+\n+void f(int);\n+void h(unsigned i)\n+{\n+  switch (i) {\n+    default: __builtin_unreachable();\n+    case 0: f(42); break;\n+    case 1: f(42); break;\n+    case 2: f(42); break;\n+    case 3: f(42); break;\n+    case 4: f(42); break;\n+    case 5: f(42); break;\n+  }\n+} \n+\n+/* { dg-final { scan-tree-dump-not \"if\" \"optimized\" } } */\n+/* { dg-final { scan-tree-dump-not \"switch\" \"optimized\" } } */"}, {"sha": "129e60747e2e5ce91849a093417c76532788d65f", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr87205.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6c5d9f0f586b303a4d292b42e1e8d705651f86c/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr87205.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6c5d9f0f586b303a4d292b42e1e8d705651f86c/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr87205.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr87205.c?ref=e6c5d9f0f586b303a4d292b42e1e8d705651f86c", "patch": "@@ -0,0 +1,21 @@\n+/* { dg-options \"-O2 -fdump-tree-optimized\" } */\n+\n+void f( int x );\n+\n+void h( unsigned ix )\n+{\n+  switch( ix )\n+  {\n+    case 0: f(42); break;\n+    case 1: f(42); break;\n+    case 2: f(42); break;\n+    case 3: f(42); break;\n+    case 4: f(42); break;\n+    case 5: f(42); break;\n+    default: __builtin_unreachable();\n+  }\n+}\n+\n+\n+/* { dg-final { scan-tree-dump-not \"if\" \"optimized\" } } */\n+/* { dg-final { scan-tree-dump-not \"switch\" \"optimized\" } } */"}, {"sha": "64169a6cd3d725e683773299c02fd9ff1efa3cba", "filename": "gcc/tree-switch-conversion.c", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6c5d9f0f586b303a4d292b42e1e8d705651f86c/gcc%2Ftree-switch-conversion.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6c5d9f0f586b303a4d292b42e1e8d705651f86c/gcc%2Ftree-switch-conversion.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-switch-conversion.c?ref=e6c5d9f0f586b303a4d292b42e1e8d705651f86c", "patch": "@@ -2419,8 +2419,13 @@ pass_lower_switch<O0>::execute (function *fun)\n   FOR_EACH_BB_FN (bb, fun)\n     {\n       gimple *stmt = last_stmt (bb);\n-      if (stmt && gimple_code (stmt) == GIMPLE_SWITCH)\n-\tswitch_statements.safe_push (stmt);\n+      gswitch *swtch;\n+      if (stmt && (swtch = dyn_cast<gswitch *> (stmt)))\n+\t{\n+\t  if (!O0)\n+\t    group_case_labels_stmt (swtch);\n+\t  switch_statements.safe_push (swtch);\n+\t}\n     }\n \n   for (unsigned i = 0; i < switch_statements.length (); i++)"}]}