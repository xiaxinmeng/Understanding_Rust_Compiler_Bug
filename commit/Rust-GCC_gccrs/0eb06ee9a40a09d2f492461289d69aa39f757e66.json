{"sha": "0eb06ee9a40a09d2f492461289d69aa39f757e66", "node_id": "C_kwDOANBUbNoAKDBlYjA2ZWU5YTQwYTA5ZDJmNDkyNDYxMjg5ZDY5YWEzOWY3NTdlNjY", "commit": {"author": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2022-01-31T19:15:01Z"}, "committer": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2022-01-31T19:15:01Z"}, "message": "c++: CONSTRUCTORs are non-deduced contexts [PR104291]\n\n\tPR c++/104291\n\ngcc/cp/ChangeLog:\n\n\t* pt.cc (for_each_template_parm_r) <case CONSTRUCTOR>: Clear\n\twalk_subtrees if !include_nondeduced_p.  Simplify given that\n\tcp_walk_subtrees already walks TYPE_PTRMEMFUNC_FN_TYPE_RAW.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/template/partial20.C: New test.", "tree": {"sha": "4b906c91ec2850a1fbc51a0d9aa517c87b0e86ef", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4b906c91ec2850a1fbc51a0d9aa517c87b0e86ef"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0eb06ee9a40a09d2f492461289d69aa39f757e66", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0eb06ee9a40a09d2f492461289d69aa39f757e66", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0eb06ee9a40a09d2f492461289d69aa39f757e66", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0eb06ee9a40a09d2f492461289d69aa39f757e66/comments", "author": null, "committer": null, "parents": [{"sha": "2cbe5dd54f15e88e0b42567319aa9c8e7bad7946", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2cbe5dd54f15e88e0b42567319aa9c8e7bad7946", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2cbe5dd54f15e88e0b42567319aa9c8e7bad7946"}], "stats": {"total": 14, "additions": 8, "deletions": 6}, "files": [{"sha": "84d63f9181ca25e8a7c07585aeeb8893923620e4", "filename": "gcc/cp/pt.cc", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0eb06ee9a40a09d2f492461289d69aa39f757e66/gcc%2Fcp%2Fpt.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0eb06ee9a40a09d2f492461289d69aa39f757e66/gcc%2Fcp%2Fpt.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.cc?ref=0eb06ee9a40a09d2f492461289d69aa39f757e66", "patch": "@@ -10525,12 +10525,6 @@ for_each_template_parm_r (tree *tp, int *walk_subtrees, void *d)\n       *walk_subtrees = 0;\n       break;\n \n-    case CONSTRUCTOR:\n-      if (TREE_TYPE (t) && TYPE_PTRMEMFUNC_P (TREE_TYPE (t))\n-\t  && pfd->include_nondeduced_p)\n-\tWALK_SUBTREE (TYPE_PTRMEMFUNC_FN_TYPE (TREE_TYPE (t)));\n-      break;\n-\n     case INDIRECT_REF:\n     case COMPONENT_REF:\n       /* If there's no type, then this thing must be some expression\n@@ -10539,6 +10533,7 @@ for_each_template_parm_r (tree *tp, int *walk_subtrees, void *d)\n \treturn error_mark_node;\n       break;\n \n+    case CONSTRUCTOR:\n     case TRAIT_EXPR:\n     case PLUS_EXPR:\n     case MULT_EXPR:"}, {"sha": "b29e09988d9f78738e10f304f869b6957c91319d", "filename": "gcc/testsuite/g++.dg/template/partial20.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0eb06ee9a40a09d2f492461289d69aa39f757e66/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fpartial20.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0eb06ee9a40a09d2f492461289d69aa39f757e66/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fpartial20.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fpartial20.C?ref=0eb06ee9a40a09d2f492461289d69aa39f757e66", "patch": "@@ -0,0 +1,7 @@\n+// PR c++/104291\n+// { dg-do compile { target c++20 } }\n+\n+struct A { int x; };\n+\n+template<auto> struct B;\n+template<int N> struct B<A{N}> { }; // { dg-error \"not deducible\" }"}]}