{"sha": "5b5198f72b81ef1415a908558ae1fa09309e696b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWI1MTk4ZjcyYjgxZWYxNDE1YTkwODU1OGFlMWZhMDkzMDllNjk2Yg==", "commit": {"author": {"name": "David Edelsohn", "email": "edelsohn@gnu.org", "date": "2002-09-11T17:36:06Z"}, "committer": {"name": "David Edelsohn", "email": "dje@gcc.gnu.org", "date": "2002-09-11T17:36:06Z"}, "message": "rs6000.c (rs6000_xcoff_asm_named_section): Append alignment to csect.\n\n\t* config/rs6000/rs6000.c (rs6000_xcoff_asm_named_section): Append\n\talignment to csect.\n\t(rs6000_xcoff_unique_section): Only set section name for public\n\tdata.\n\t(rs6000_xcoff_section_type_flags): Store log2 alignment in flags.\n\t* config/rs6000/xcoff.h (TARGET_ASM_SELECT_SECTION): Remove\n\tduplicate definition.\n\nFrom-SVN: r57034", "tree": {"sha": "d9e99dae322b895f4b0231f36025993b31b87f5c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d9e99dae322b895f4b0231f36025993b31b87f5c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5b5198f72b81ef1415a908558ae1fa09309e696b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b5198f72b81ef1415a908558ae1fa09309e696b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5b5198f72b81ef1415a908558ae1fa09309e696b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b5198f72b81ef1415a908558ae1fa09309e696b/comments", "author": null, "committer": null, "parents": [{"sha": "b7caf8dd94741dd0f6cd277dcb669ee1809286b1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b7caf8dd94741dd0f6cd277dcb669ee1809286b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b7caf8dd94741dd0f6cd277dcb669ee1809286b1"}], "stats": {"total": 39, "additions": 30, "deletions": 9}, "files": [{"sha": "cab4f487aa2d92ef7f9892da87e151f67658636c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b5198f72b81ef1415a908558ae1fa09309e696b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b5198f72b81ef1415a908558ae1fa09309e696b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5b5198f72b81ef1415a908558ae1fa09309e696b", "patch": "@@ -1,3 +1,13 @@\n+2002-09-11  David Edelsohn  <edelsohn@gnu.org>\n+\n+\t* config/rs6000/rs6000.c (rs6000_xcoff_asm_named_section): Append\n+\talignment to csect.\n+\t(rs6000_xcoff_unique_section): Only set section name for public\n+\tdata.\n+\t(rs6000_xcoff_section_type_flags): Store log2 alignment in flags.\n+\t* config/rs6000/xcoff.h (TARGET_ASM_SELECT_SECTION): Remove\n+\tduplicate definition.\n+\n 2002-09-10  John David Anglin  <dave@hiauly1.hia.nrc.ca>\n \n \t* pa.md (extzv): Check predicates before emitting extzv_32."}, {"sha": "5974d3bce096f5cda3faf540dbce1e16aae583b5", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 18, "deletions": 5, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b5198f72b81ef1415a908558ae1fa09309e696b/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b5198f72b81ef1415a908558ae1fa09309e696b/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=5b5198f72b81ef1415a908558ae1fa09309e696b", "patch": "@@ -13096,9 +13096,9 @@ rs6000_xcoff_asm_named_section (name, flags)\n   else\n     smclass = 1;\n \n-  fprintf (asm_out_file, \"\\t.csect %s%s[%s]\\n\",\n+  fprintf (asm_out_file, \"\\t.csect %s%s[%s],%u\\n\",\n \t   (flags & SECTION_CODE) ? \".\" : \"\",\n-\t   name, suffix[smclass]);\n+\t   name, suffix[smclass], flags & SECTION_ENTSIZE);\n }\n \n static void\n@@ -13130,8 +13130,9 @@ rs6000_xcoff_unique_section (decl, reloc)\n {\n   const char *name;\n \n-  /* Use select_section for uninitialized data.  */\n-  if (DECL_COMMON (decl)\n+  /* Use select_section for private and uninitialized data.  */\n+  if (!TREE_PUBLIC (decl)\n+      || DECL_COMMON (decl)\n       || DECL_INITIAL (decl) == NULL_TREE\n       || DECL_INITIAL (decl) == error_mark_node\n       || (flag_zero_initialized_in_bss\n@@ -13185,7 +13186,19 @@ rs6000_xcoff_section_type_flags (decl, name, reloc)\n      const char *name;\n      int reloc;\n {\n-  return default_section_type_flags_1 (decl, name, reloc, 1);\n+  unsigned int align;\n+  unsigned int flags = default_section_type_flags_1 (decl, name, reloc, 1);\n+\n+  /* Align to at least UNIT size.  */\n+  if (flags & SECTION_CODE)\n+    align = MIN_UNITS_PER_WORD;\n+  else\n+    /* Increase alignment of large objects if not already stricter.  */\n+    align = MAX ((DECL_ALIGN (decl) / BITS_PER_UNIT),\n+\t\t int_size_in_bytes (TREE_TYPE (decl)) > MIN_UNITS_PER_WORD\n+\t\t ? UNITS_PER_FP_WORD : MIN_UNITS_PER_WORD);\n+\n+  return flags | (exact_log2 (align) & SECTION_ENTSIZE);\n }\n \n #endif /* TARGET_XCOFF */"}, {"sha": "b83f678b9f85c62daf8dbdfe1bf8292c52c2b983", "filename": "gcc/config/rs6000/xcoff.h", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b5198f72b81ef1415a908558ae1fa09309e696b/gcc%2Fconfig%2Frs6000%2Fxcoff.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b5198f72b81ef1415a908558ae1fa09309e696b/gcc%2Fconfig%2Frs6000%2Fxcoff.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fxcoff.h?ref=5b5198f72b81ef1415a908558ae1fa09309e696b", "patch": "@@ -135,8 +135,6 @@ toc_section ()\t\t\t\t\t\t\\\n \n #define READONLY_DATA_SECTION read_only_data_section\n \n-#define TARGET_ASM_SELECT_SECTION  rs6000_xcoff_select_section\n-\n /* Return non-zero if this entry is to be written into the constant\n    pool in a special way.  We do so if this is a SYMBOL_REF, LABEL_REF\n    or a CONST containing one of them.  If -mfp-in-toc (the default),\n@@ -166,8 +164,8 @@ toc_section ()\t\t\t\t\t\t\\\n #define TARGET_ASM_SELECT_SECTION  rs6000_xcoff_select_section\n #define TARGET_ASM_SELECT_RTX_SECTION  rs6000_xcoff_select_rtx_section\n #define TARGET_ASM_UNIQUE_SECTION  rs6000_xcoff_unique_section\n-#define TARGET_ENCODE_SECTION_INFO rs6000_xcoff_encode_section_info\n-#define TARGET_STRIP_NAME_ENCODING rs6000_xcoff_strip_name_encoding\n+#define TARGET_ENCODE_SECTION_INFO  rs6000_xcoff_encode_section_info\n+#define TARGET_STRIP_NAME_ENCODING  rs6000_xcoff_strip_name_encoding\n #define TARGET_SECTION_TYPE_FLAGS  rs6000_xcoff_section_type_flags\n \n /* FP save and restore routines.  */"}]}