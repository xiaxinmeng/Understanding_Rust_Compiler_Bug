{"sha": "cc694a8150db5f0cc607aba151150e8a77cedf49", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2M2OTRhODE1MGRiNWYwY2M2MDdhYmExNTExNTBlOGE3N2NlZGY0OQ==", "commit": {"author": {"name": "Doug Evans", "email": "dje@gnu.org", "date": "1996-11-15T22:37:40Z"}, "committer": {"name": "Doug Evans", "email": "dje@gnu.org", "date": "1996-11-15T22:37:40Z"}, "message": "sdbout.c (current_file): New global.\n\n\t* sdbout.c (current_file): New global.\n\t(PUT_SDB_SRC_FILE): New PUT_SDB_FOO macro.\n\t(sdbout_init): Initialize current_file ifdef MIPS_DEBUGGING_INFO.\n\t(sdbout_{start_new,resume_previous}_source_file): New functions.\n\t* toplev.c (debug_{start,end}_source_file): Call them if SDB_DEBUG.\n\t* mips/mips.h (PUT_SDB_SRC_FILE): Define.\n\nFrom-SVN: r13179", "tree": {"sha": "4505494c3394c62e861b72b346a4107427f33ffc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4505494c3394c62e861b72b346a4107427f33ffc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cc694a8150db5f0cc607aba151150e8a77cedf49", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc694a8150db5f0cc607aba151150e8a77cedf49", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cc694a8150db5f0cc607aba151150e8a77cedf49", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc694a8150db5f0cc607aba151150e8a77cedf49/comments", "author": null, "committer": null, "parents": [{"sha": "6619df077de9c3f535607deb2f87c07f65e1d6dc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6619df077de9c3f535607deb2f87c07f65e1d6dc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6619df077de9c3f535607deb2f87c07f65e1d6dc"}], "stats": {"total": 83, "additions": 83, "deletions": 0}, "files": [{"sha": "0093ed5bff10bb628cec17931f0e2a8b15ab4a88", "filename": "gcc/config/mips/mips.h", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc694a8150db5f0cc607aba151150e8a77cedf49/gcc%2Fconfig%2Fmips%2Fmips.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc694a8150db5f0cc607aba151150e8a77cedf49/gcc%2Fconfig%2Fmips%2Fmips.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.h?ref=cc694a8150db5f0cc607aba151150e8a77cedf49", "patch": "@@ -1061,6 +1061,12 @@ do {                                                  \\\n \n #define PUT_SDB_EPILOGUE_END(NAME)\n \n+#define PUT_SDB_SRC_FILE(FILENAME) \\\n+do {\t\t\t\t\t\t\t\\\n+  extern FILE *asm_out_text_file;\t\t\t\\\n+  output_file_directive (asm_out_text_file, (FILENAME)); \\\n+} while (0)\n+\n #define SDB_GENERATE_FAKE(BUFFER, NUMBER) \\\n   sprintf ((BUFFER), \".%dfake\", (NUMBER));\n "}, {"sha": "788061c39dad75244cf3a65a8ccc36920ae2b4f7", "filename": "gcc/sdbout.c", "status": "modified", "additions": 69, "deletions": 0, "changes": 69, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc694a8150db5f0cc607aba151150e8a77cedf49/gcc%2Fsdbout.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc694a8150db5f0cc607aba151150e8a77cedf49/gcc%2Fsdbout.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsdbout.c?ref=cc694a8150db5f0cc607aba151150e8a77cedf49", "patch": "@@ -288,6 +288,38 @@ do { fprintf (asm_out_file, \"\\t.def\\t\");\t\t\\\n /* Ensure we don't output a negative line number.  */\n #define MAKE_LINE_SAFE(line)  \\\n   if (line <= sdb_begin_function_line) line = sdb_begin_function_line + 1\n+\n+/* Perform linker optimization of merging header file definitions together\n+   for targets with MIPS_DEBUGGING_INFO defined.  This won't work without a\n+   post 960826 version of GAS.  Nothing breaks with earlier versions of GAS,\n+   the optimization just won't be done.  The native assembler already has the\n+   necessary support.  */\n+\n+#ifdef MIPS_DEBUGGING_INFO\n+\n+#ifndef PUT_SDB_SRC_FILE\n+#define PUT_SDB_SRC_FILE(FILENAME) \\\n+output_file_directive (asm_out_file, (FILENAME))\n+#endif\n+\n+/* ECOFF linkers have an optimization that does the same kind of thing as\n+   N_BINCL/E_INCL in stabs: eliminate duplicate debug information in the\n+   executable.  To achieve this, GCC must output a .file for each file\n+   name change.  */\n+\n+/* This is a stack of input files.  */\n+\n+struct sdb_file\n+{\n+  struct sdb_file *next;\n+  char *name;\n+};\n+\n+/* This is the top of the stack.  */\n+\n+static struct sdb_file *current_file;\n+\n+#endif /* MIPS_DEBUGGING_INFO */\n \f\n /* Set up for SDB output at the start of compilation.  */\n \n@@ -297,6 +329,12 @@ sdbout_init (asm_file, input_file_name, syms)\n      char *input_file_name;\n      tree syms;\n {\n+#ifdef MIPS_DEBUGGING_INFO\n+  current_file = (struct sdb_file *) xmalloc (sizeof *current_file);\n+  current_file->next = NULL;\n+  current_file->name = input_file_name;\n+#endif\n+\n #ifdef RMS_QUICK_HACK_1\n   tree t;\n   for (t = syms; t; t = TREE_CHAIN (t))\n@@ -1556,4 +1594,35 @@ sdbout_label (insn)\n   PUT_SDB_ENDEF;\n }\n \n+/* Change to reading from a new source file.  */\n+\n+void\n+sdbout_start_new_source_file (filename)\n+     char *filename;\n+{\n+#ifdef MIPS_DEBUGGING_INFO\n+  struct sdb_file *n = (struct sdb_file *) xmalloc (sizeof *n);\n+\n+  n->next = current_file;\n+  n->name = filename;\n+  current_file = n;\n+  PUT_SDB_SRC_FILE (filename);\n+#endif\n+}\n+\n+/* Revert to reading a previous source file.  */\n+\n+void\n+sdbout_resume_previous_source_file ()\n+{\n+#ifdef MIPS_DEBUGGING_INFO\n+  struct sdb_file *next;\n+\n+  next = current_file->next;\n+  free (current_file);\n+  current_file = next;\n+  PUT_SDB_SRC_FILE (current_file->name);\n+#endif\n+}\n+\n #endif /* SDB_DEBUGGING_INFO */"}, {"sha": "6a67d03c6faec0b8a82e2181e1eef87728a7cbbc", "filename": "gcc/toplev.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc694a8150db5f0cc607aba151150e8a77cedf49/gcc%2Ftoplev.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc694a8150db5f0cc607aba151150e8a77cedf49/gcc%2Ftoplev.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftoplev.c?ref=cc694a8150db5f0cc607aba151150e8a77cedf49", "patch": "@@ -4323,6 +4323,10 @@ debug_start_source_file (filename)\n       && write_symbols == DWARF2_DEBUG)\n     dwarf2out_start_source_file (filename);\n #endif /* DWARF2_DEBUGGING_INFO */  \n+#ifdef SDB_DEBUGGING_INFO\n+  if (write_symbols == SDB_DEBUG)\n+    sdbout_start_new_source_file (filename);\n+#endif\n }\n \n /* Record the resumption of a source file.  LINENO is the line number in\n@@ -4346,6 +4350,10 @@ debug_end_source_file (lineno)\n       && write_symbols == DWARF2_DEBUG)\n     dwarf2out_end_source_file ();\n #endif /* DWARF2_DEBUGGING_INFO */\n+#ifdef SDB_DEBUGGING_INFO\n+  if (write_symbols == SDB_DEBUG)\n+    sdbout_resume_previous_source_file ();\n+#endif\n }\n \n /* Called from check_newline in c-parse.y.  The `buffer' parameter contains"}]}