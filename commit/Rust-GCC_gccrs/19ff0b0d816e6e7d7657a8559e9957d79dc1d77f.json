{"sha": "19ff0b0d816e6e7d7657a8559e9957d79dc1d77f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTlmZjBiMGQ4MTZlNmU3ZDc2NTdhODU1OWU5OTU3ZDc5ZGMxZDc3Zg==", "commit": {"author": {"name": "H.J. Lu", "email": "hjl.tools@gmail.com", "date": "2021-03-20T12:17:36Z"}, "committer": {"name": "H.J. Lu", "email": "hjl.tools@gmail.com", "date": "2021-03-20T17:08:31Z"}, "message": "x86: Check cfun != NULL before accessing silent_p\n\nSince construct_container may be called with cfun == NULL, check\ncfun != NULL before accessing silent_p.\n\ngcc/\n\n\tPR target/99679\n\t* config/i386/i386.c (construct_container): Check cfun != NULL\n\tbefore accessing silent_p.\n\ngcc/testsuite/\n\n\tPR target/99679\n\t* g++.target/i386/pr99679-1.C: New test.\n\t* g++.target/i386/pr99679-2.C: Likewise.", "tree": {"sha": "334a73f2effa41f2a2048f27edeb53d94be12568", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/334a73f2effa41f2a2048f27edeb53d94be12568"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/19ff0b0d816e6e7d7657a8559e9957d79dc1d77f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/19ff0b0d816e6e7d7657a8559e9957d79dc1d77f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/19ff0b0d816e6e7d7657a8559e9957d79dc1d77f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/19ff0b0d816e6e7d7657a8559e9957d79dc1d77f/comments", "author": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "committer": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9f59cb7cac009f3c6eba81eb09714699b9ac9f8d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f59cb7cac009f3c6eba81eb09714699b9ac9f8d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9f59cb7cac009f3c6eba81eb09714699b9ac9f8d"}], "stats": {"total": 38, "additions": 36, "deletions": 2}, "files": [{"sha": "7c41302c75b5a1905dec71d7153fa80a84008519", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19ff0b0d816e6e7d7657a8559e9957d79dc1d77f/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19ff0b0d816e6e7d7657a8559e9957d79dc1d77f/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=19ff0b0d816e6e7d7657a8559e9957d79dc1d77f", "patch": "@@ -2540,7 +2540,7 @@ construct_container (machine_mode mode, machine_mode orig_mode,\n     {\n       /* Return early if we shouldn't raise an error for invalid\n \t calls.  */\n-      if (cfun->machine->silent_p)\n+      if (cfun != NULL && cfun->machine->silent_p)\n \treturn NULL;\n       if (in_return)\n \t{\n@@ -2568,7 +2568,7 @@ construct_container (machine_mode mode, machine_mode orig_mode,\n \t{\n \t  /* Return early if we shouldn't raise an error for invalid\n \t     calls.  */\n-\t  if (cfun->machine->silent_p)\n+\t  if (cfun != NULL && cfun->machine->silent_p)\n \t    return NULL;\n \t  if (!issued_x87_ret_error)\n \t    {"}, {"sha": "36640a4e0a12b3d46e64b2bc1d37cb9dce962122", "filename": "gcc/testsuite/g++.target/i386/pr99679-1.C", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19ff0b0d816e6e7d7657a8559e9957d79dc1d77f/gcc%2Ftestsuite%2Fg%2B%2B.target%2Fi386%2Fpr99679-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19ff0b0d816e6e7d7657a8559e9957d79dc1d77f/gcc%2Ftestsuite%2Fg%2B%2B.target%2Fi386%2Fpr99679-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.target%2Fi386%2Fpr99679-1.C?ref=19ff0b0d816e6e7d7657a8559e9957d79dc1d77f", "patch": "@@ -0,0 +1,17 @@\n+// { dg-do compile }\n+// { dg-options \"-Ofast -fipa-pta -mno-80387\" }\n+\n+#include <stdarg.h>\n+\n+extern \"C\" void abort (void);\n+\n+void\n+foo (int x, ...)\n+{\n+  long double ld;\n+  va_list ap;\n+  va_start (ap, x);\n+  ld = va_arg (ap, long double);\n+  if (ld)\n+    abort ();\n+} // { dg-error \"x87 register return with x87 disabled\" \"\" { target { ! ia32 } } }"}, {"sha": "cbd3c4958db878af7e8ea0fcd11e2a840992b315", "filename": "gcc/testsuite/g++.target/i386/pr99679-2.C", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19ff0b0d816e6e7d7657a8559e9957d79dc1d77f/gcc%2Ftestsuite%2Fg%2B%2B.target%2Fi386%2Fpr99679-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19ff0b0d816e6e7d7657a8559e9957d79dc1d77f/gcc%2Ftestsuite%2Fg%2B%2B.target%2Fi386%2Fpr99679-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.target%2Fi386%2Fpr99679-2.C?ref=19ff0b0d816e6e7d7657a8559e9957d79dc1d77f", "patch": "@@ -0,0 +1,17 @@\n+// { dg-do compile }\n+// { dg-options \"-Ofast -fipa-pta -mgeneral-regs-only\" }\n+\n+#include <stdarg.h>\n+\n+extern \"C\" void abort (void);\n+\n+void\n+foo (int x, ...)\n+{\n+  double ld;\n+  va_list ap;\n+  va_start (ap, x);\n+  ld = va_arg (ap, double); // { dg-error \"SSE register argument with SSE disabled\" \"\" { target { ! ia32 } } }\n+  if (ld)\n+    abort ();\n+} // { dg-error \"SSE register return with SSE disabled\" \"\" { target { ! ia32 } } }"}]}