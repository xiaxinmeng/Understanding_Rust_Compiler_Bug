{"sha": "fc0c2dcf34b46affddc871962525c0b062571490", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmMwYzJkY2YzNGI0NmFmZmRkYzg3MTk2MjUyNWMwYjA2MjU3MTQ5MA==", "commit": {"author": {"name": "Marc Poulhi\u00e8s", "email": "dkm@kataplop.net", "date": "2021-08-12T11:42:01Z"}, "committer": {"name": "Marc", "email": "dkm@kataplop.net", "date": "2021-08-18T20:59:36Z"}, "message": "Add module map in HIR maps\n\nAdd module map and required methods to access it.\n\nrefs #432", "tree": {"sha": "71e8daf1a1e6da1d25500f1c1b80d8530b960aaa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/71e8daf1a1e6da1d25500f1c1b80d8530b960aaa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fc0c2dcf34b46affddc871962525c0b062571490", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fc0c2dcf34b46affddc871962525c0b062571490", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fc0c2dcf34b46affddc871962525c0b062571490", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fc0c2dcf34b46affddc871962525c0b062571490/comments", "author": {"login": "dkm", "id": 87603, "node_id": "MDQ6VXNlcjg3NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/87603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkm", "html_url": "https://github.com/dkm", "followers_url": "https://api.github.com/users/dkm/followers", "following_url": "https://api.github.com/users/dkm/following{/other_user}", "gists_url": "https://api.github.com/users/dkm/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkm/subscriptions", "organizations_url": "https://api.github.com/users/dkm/orgs", "repos_url": "https://api.github.com/users/dkm/repos", "events_url": "https://api.github.com/users/dkm/events{/privacy}", "received_events_url": "https://api.github.com/users/dkm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dkm", "id": 87603, "node_id": "MDQ6VXNlcjg3NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/87603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkm", "html_url": "https://github.com/dkm", "followers_url": "https://api.github.com/users/dkm/followers", "following_url": "https://api.github.com/users/dkm/following{/other_user}", "gists_url": "https://api.github.com/users/dkm/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkm/subscriptions", "organizations_url": "https://api.github.com/users/dkm/orgs", "repos_url": "https://api.github.com/users/dkm/repos", "events_url": "https://api.github.com/users/dkm/events{/privacy}", "received_events_url": "https://api.github.com/users/dkm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9d30105d752530c7dc6abe60455b3a8847e50922", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d30105d752530c7dc6abe60455b3a8847e50922", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9d30105d752530c7dc6abe60455b3a8847e50922"}], "stats": {"total": 26, "additions": 26, "deletions": 0}, "files": [{"sha": "d544042b3442d9aed7cae8c73d4e3816e497d709", "filename": "gcc/rust/util/rust-hir-map.cc", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fc0c2dcf34b46affddc871962525c0b062571490/gcc%2Frust%2Futil%2Frust-hir-map.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fc0c2dcf34b46affddc871962525c0b062571490/gcc%2Frust%2Futil%2Frust-hir-map.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Futil%2Frust-hir-map.cc?ref=fc0c2dcf34b46affddc871962525c0b062571490", "patch": "@@ -324,6 +324,28 @@ Mappings::lookup_hir_impl_block (CrateNum crateNum, HirId id)\n   return iy->second;\n }\n \n+void\n+Mappings::insert_module (CrateNum crateNum, HirId id, HIR::Module *module)\n+{\n+  rust_assert (lookup_module (crateNum, id) == nullptr);\n+\n+  hirModuleMappings[crateNum][id] = module;\n+}\n+\n+HIR::Module *\n+Mappings::lookup_module (CrateNum crateNum, HirId id)\n+{\n+  auto it = hirModuleMappings.find (crateNum);\n+  if (it == hirModuleMappings.end ())\n+    return nullptr;\n+\n+  auto iy = it->second.find (id);\n+  if (iy == it->second.end ())\n+    return nullptr;\n+\n+  return iy->second;\n+}\n+\n void\n Mappings::insert_hir_implitem (CrateNum crateNum, HirId id,\n \t\t\t       HirId parent_impl_id, HIR::ImplItem *item)"}, {"sha": "2366724d65459b6fe1144b12d81bfc5a3508914d", "filename": "gcc/rust/util/rust-hir-map.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fc0c2dcf34b46affddc871962525c0b062571490/gcc%2Frust%2Futil%2Frust-hir-map.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fc0c2dcf34b46affddc871962525c0b062571490/gcc%2Frust%2Futil%2Frust-hir-map.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Futil%2Frust-hir-map.h?ref=fc0c2dcf34b46affddc871962525c0b062571490", "patch": "@@ -131,6 +131,9 @@ class Mappings\n \t\t\t      HIR::ImplBlock *item);\n   HIR::ImplBlock *lookup_hir_impl_block (CrateNum crateNum, HirId id);\n \n+  void insert_module (CrateNum crateNum, HirId id, HIR::Module *module);\n+  HIR::Module *lookup_module (CrateNum crateNum, HirId id);\n+\n   void insert_hir_implitem (CrateNum crateNum, HirId id, HirId parent_impl_id,\n \t\t\t    HIR::ImplItem *item);\n   HIR::ImplItem *lookup_hir_implitem (CrateNum crateNum, HirId id,\n@@ -279,6 +282,7 @@ class Mappings\n \n   std::map<DefId, HIR::Item *> defIdMappings;\n   std::map<CrateNum, std::map<LocalDefId, HIR::Item *> > localDefIdMappings;\n+  std::map<CrateNum, std::map<HirId, HIR::Module *> > hirModuleMappings;\n   std::map<CrateNum, std::map<HirId, HIR::Item *> > hirItemMappings;\n   std::map<CrateNum, std::map<HirId, HIR::Type *> > hirTypeMappings;\n   std::map<CrateNum, std::map<HirId, HIR::Expr *> > hirExprMappings;"}]}