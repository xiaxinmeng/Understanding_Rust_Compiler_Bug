{"sha": "f965d3dad7edb527e465d7d2811294177daee53c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Zjk2NWQzZGFkN2VkYjUyN2U0NjVkN2QyODExMjk0MTc3ZGFlZTUzYw==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2016-07-07T12:03:39Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2016-07-07T12:03:39Z"}, "message": "Prevent LTO wrappers to process a recursive execution\n\n\t* file-find.c (remove_prefix): New function.\n\t* file-find.h (remove_prefix): Declare the function.\n\t* gcc-ar.c (main): Skip a folder of the wrapper if\n\ta wrapped binary would point to the same file.\n\nFrom-SVN: r238089", "tree": {"sha": "9776d8d0e93b2015a8b4ebed34c65d2f6e684da5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9776d8d0e93b2015a8b4ebed34c65d2f6e684da5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f965d3dad7edb527e465d7d2811294177daee53c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f965d3dad7edb527e465d7d2811294177daee53c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f965d3dad7edb527e465d7d2811294177daee53c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f965d3dad7edb527e465d7d2811294177daee53c/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "019d6598357659e05640cf762b75e18953f70fe9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/019d6598357659e05640cf762b75e18953f70fe9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/019d6598357659e05640cf762b75e18953f70fe9"}], "stats": {"total": 51, "additions": 51, "deletions": 0}, "files": [{"sha": "c3d6327577504eb9d52d703b527e5629711f54dd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f965d3dad7edb527e465d7d2811294177daee53c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f965d3dad7edb527e465d7d2811294177daee53c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f965d3dad7edb527e465d7d2811294177daee53c", "patch": "@@ -1,3 +1,10 @@\n+2016-07-07  Martin Liska  <mliska@suse.cz>\n+\n+\t* file-find.c (remove_prefix): New function.\n+\t* file-find.h (remove_prefix): Declare the function.\n+\t* gcc-ar.c (main): Skip a folder of the wrapper if\n+\ta wrapped binary would point to the same file.\n+\n 2016-07-07  Jan Hubicka  <jh@suse.cz>\n \n \t* tree-scalar-evolution.c (iv_can_overflow_p): export."}, {"sha": "1066da9395ac2ffcb8568ddc95fd832d9a76843d", "filename": "gcc/file-find.c", "status": "modified", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f965d3dad7edb527e465d7d2811294177daee53c/gcc%2Ffile-find.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f965d3dad7edb527e465d7d2811294177daee53c/gcc%2Ffile-find.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffile-find.c?ref=f965d3dad7edb527e465d7d2811294177daee53c", "patch": "@@ -208,3 +208,38 @@ prefix_from_string (const char *p, struct path_prefix *pprefix)\n     }\n   free (nstore);\n }\n+\n+void\n+remove_prefix (const char *prefix, struct path_prefix *pprefix)\n+{\n+  struct prefix_list *remove, **prev, **remove_prev = NULL;\n+  int max_len = 0;\n+\n+  if (pprefix->plist)\n+    {\n+      prev = &pprefix->plist;\n+      for (struct prefix_list *pl = pprefix->plist; pl->next; pl = pl->next)\n+\t{\n+\t  if (strcmp (prefix, pl->prefix) == 0)\n+\t    {\n+\t      remove = pl;\n+\t      remove_prev = prev;\n+\t      continue;\n+\t    }\n+\n+\t  int l = strlen (pl->prefix);\n+\t  if (l > max_len)\n+\t    max_len = l;\n+\n+\t  prev = &pl;\n+\t}\n+\n+      if (remove_prev)\n+\t{\n+\t  *remove_prev = remove->next;\n+\t  free (remove);\n+\t}\n+\n+      pprefix->max_len = max_len;\n+    }\n+}"}, {"sha": "19a4746be091a766d4e0adbefa17f5632a322d06", "filename": "gcc/file-find.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f965d3dad7edb527e465d7d2811294177daee53c/gcc%2Ffile-find.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f965d3dad7edb527e465d7d2811294177daee53c/gcc%2Ffile-find.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffile-find.h?ref=f965d3dad7edb527e465d7d2811294177daee53c", "patch": "@@ -41,6 +41,7 @@ extern void find_file_set_debug (bool);\n extern char *find_a_file (struct path_prefix *, const char *, int);\n extern void add_prefix (struct path_prefix *, const char *);\n extern void add_prefix_begin (struct path_prefix *, const char *);\n+extern void remove_prefix (const char *prefix, struct path_prefix *);\n extern void prefix_from_env (const char *, struct path_prefix *);\n extern void prefix_from_string (const char *, struct path_prefix *);\n "}, {"sha": "a02dccb80006b1bf39c8d2e2383c0110576538e8", "filename": "gcc/gcc-ar.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f965d3dad7edb527e465d7d2811294177daee53c/gcc%2Fgcc-ar.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f965d3dad7edb527e465d7d2811294177daee53c/gcc%2Fgcc-ar.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgcc-ar.c?ref=f965d3dad7edb527e465d7d2811294177daee53c", "patch": "@@ -194,6 +194,14 @@ main (int ac, char **av)\n #ifdef CROSS_DIRECTORY_STRUCTURE\n       real_exe_name = concat (target_machine, \"-\", PERSONALITY, NULL);\n #endif\n+      /* Do not search original location in the same folder.  */\n+      char *exe_folder = lrealpath (av[0]);\n+      exe_folder[strlen (exe_folder) - strlen (lbasename (exe_folder))] = '\\0';\n+      char *location = concat (exe_folder, PERSONALITY, NULL);\n+\n+      if (access (location, X_OK) == 0)\n+\tremove_prefix (exe_folder, &path);\n+\n       exe_name = find_a_file (&path, real_exe_name, X_OK);\n       if (!exe_name)\n \t{"}]}