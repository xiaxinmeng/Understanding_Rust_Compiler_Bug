{"sha": "e7547bc697688459e3e1ece81268e7b14addef22", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTc1NDdiYzY5NzY4ODQ1OWUzZTFlY2U4MTI2OGU3YjE0YWRkZWYyMg==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2015-06-05T20:23:19Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2015-06-05T20:23:19Z"}, "message": "Fix build of jit after debug-early merger\n\ngcc/jit/ChangeLog:\n\t* dummy-frontend.c (jit_langhook_write_globals): Rename to...\n\t(jit_langhook_post_compilation_parsing_cleanups): ...this, and\n\teliminate calls to finalize_compilation_unit and\n\twrite_global_decls_2.\n\t(LANG_HOOKS_WRITE_GLOBALS): Rename to...\n\t(LANG_HOOKS_POST_COMPILATION_PARSING_CLEANUPS): ...this and\n\tredirect from jit_langhook_write_globals to\n\tjit_langhook_post_compilation_parsing_cleanups.\n\t* jit-playback.c\n\t(gcc::jit::playback::context::write_global_decls_1): Rename to...\n\t(gcc::jit::playback::context::finalize_global_decls): ...this.\n\t(gcc::jit::playback::context::write_global_decls_1): Delete.\n\t* jit-playback.h\n\t(gcc::jit::playback::context::write_global_decls_1): Rename to...\n\t(gcc::jit::playback::context::finalize_global_decls): ...this.\n\t(gcc::jit::playback::context::write_global_decls_1): Delete.\n\nFrom-SVN: r224170", "tree": {"sha": "53816fcb94823ec1ff89412fbaacce06fe3f1283", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/53816fcb94823ec1ff89412fbaacce06fe3f1283"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e7547bc697688459e3e1ece81268e7b14addef22", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e7547bc697688459e3e1ece81268e7b14addef22", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e7547bc697688459e3e1ece81268e7b14addef22", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e7547bc697688459e3e1ece81268e7b14addef22/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "47d201f03d8577572e15a4a121b06ad089496133", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47d201f03d8577572e15a4a121b06ad089496133", "html_url": "https://github.com/Rust-GCC/gccrs/commit/47d201f03d8577572e15a4a121b06ad089496133"}], "stats": {"total": 62, "additions": 27, "deletions": 35}, "files": [{"sha": "6610da969d3306b12c9ce96a0e4628519a96310d", "filename": "gcc/jit/ChangeLog", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e7547bc697688459e3e1ece81268e7b14addef22/gcc%2Fjit%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e7547bc697688459e3e1ece81268e7b14addef22/gcc%2Fjit%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjit%2FChangeLog?ref=e7547bc697688459e3e1ece81268e7b14addef22", "patch": "@@ -1,3 +1,22 @@\n+2015-06-05  David Malcolm  <dmalcolm@redhat.com>\n+\n+\t* dummy-frontend.c (jit_langhook_write_globals): Rename to...\n+\t(jit_langhook_post_compilation_parsing_cleanups): ...this, and\n+\teliminate calls to finalize_compilation_unit and\n+\twrite_global_decls_2.\n+\t(LANG_HOOKS_WRITE_GLOBALS): Rename to...\n+\t(LANG_HOOKS_POST_COMPILATION_PARSING_CLEANUPS): ...this and\n+\tredirect from jit_langhook_write_globals to\n+\tjit_langhook_post_compilation_parsing_cleanups.\n+\t* jit-playback.c\n+\t(gcc::jit::playback::context::write_global_decls_1): Rename to...\n+\t(gcc::jit::playback::context::finalize_global_decls): ...this.\n+\t(gcc::jit::playback::context::write_global_decls_1): Delete.\n+\t* jit-playback.h\n+\t(gcc::jit::playback::context::write_global_decls_1): Rename to...\n+\t(gcc::jit::playback::context::finalize_global_decls): ...this.\n+\t(gcc::jit::playback::context::write_global_decls_1): Delete.\n+\n 2015-06-04  Andrew MacLeod  <amacleod@redhat.com>\n \n \t* dummy-frontend.c: Adjust includes for restructured coretypes.h."}, {"sha": "4a7966ddd6e68eab997a13b91bb0aa7c3dcfd462", "filename": "gcc/jit/dummy-frontend.c", "status": "modified", "additions": 5, "deletions": 9, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e7547bc697688459e3e1ece81268e7b14addef22/gcc%2Fjit%2Fdummy-frontend.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e7547bc697688459e3e1ece81268e7b14addef22/gcc%2Fjit%2Fdummy-frontend.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjit%2Fdummy-frontend.c?ref=e7547bc697688459e3e1ece81268e7b14addef22", "patch": "@@ -219,18 +219,13 @@ jit_langhook_getdecls (void)\n }\n \n static void\n-jit_langhook_write_globals (void)\n+jit_langhook_post_compilation_parsing_cleanups (void)\n {\n   gcc::jit::playback::context *ctxt = gcc::jit::active_playback_ctxt;\n   gcc_assert (ctxt);\n   JIT_LOG_SCOPE (ctxt->get_logger ());\n \n-  ctxt->write_global_decls_1 ();\n-\n-  /* This is the hook that runs the middle and backends: */\n-  symtab->finalize_compilation_unit ();\n-\n-  ctxt->write_global_decls_2 ();\n+  ctxt->finalize_global_decls ();\n }\n \n #undef LANG_HOOKS_NAME\n@@ -260,8 +255,9 @@ jit_langhook_write_globals (void)\n #undef LANG_HOOKS_GETDECLS\n #define LANG_HOOKS_GETDECLS\t\tjit_langhook_getdecls\n \n-#undef LANG_HOOKS_WRITE_GLOBALS\n-#define LANG_HOOKS_WRITE_GLOBALS\tjit_langhook_write_globals\n+#undef LANG_HOOKS_POST_COMPILATION_PARSING_CLEANUPS\n+#define LANG_HOOKS_POST_COMPILATION_PARSING_CLEANUPS \\\n+  jit_langhook_post_compilation_parsing_cleanups\n \n struct lang_hooks lang_hooks = LANG_HOOKS_INITIALIZER;\n "}, {"sha": "64478b7e5eabb59e472b38a67089513011ec3d06", "filename": "gcc/jit/jit-playback.c", "status": "modified", "additions": 2, "deletions": 23, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e7547bc697688459e3e1ece81268e7b14addef22/gcc%2Fjit%2Fjit-playback.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e7547bc697688459e3e1ece81268e7b14addef22/gcc%2Fjit%2Fjit-playback.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjit%2Fjit-playback.c?ref=e7547bc697688459e3e1ece81268e7b14addef22", "patch": "@@ -668,14 +668,13 @@ as_truth_value (tree expr, location *loc)\n   return expr;\n }\n \n-/* For use by jit_langhook_write_globals.\n+/* For use by jit_langhook_post_compilation_parsing_cleanups\n    Calls varpool_node::finalize_decl on each global.  */\n \n void\n playback::context::\n-write_global_decls_1 ()\n+finalize_global_decls ()\n {\n-  /* Compare with e.g. the C frontend's c_write_global_declarations.  */\n   JIT_LOG_SCOPE (get_logger ());\n \n   int i;\n@@ -687,26 +686,6 @@ write_global_decls_1 ()\n     }\n }\n \n-/* For use by jit_langhook_write_globals.\n-   Calls debug_hooks->global_decl on each global.  */\n-\n-void\n-playback::context::\n-write_global_decls_2 ()\n-{\n-  /* Compare with e.g. the C frontend's c_write_global_declarations_2. */\n-  JIT_LOG_SCOPE (get_logger ());\n-\n-  int i;\n-  tree decl;\n-  FOR_EACH_VEC_ELT (m_globals, i, decl)\n-    {\n-      gcc_assert (TREE_CODE (decl) == VAR_DECL);\n-      debug_hooks->global_decl (decl);\n-    }\n-}\n-\n-\n /* Construct a playback::rvalue instance (wrapping a tree) for a\n    unary op.  */\n "}, {"sha": "84d99e4f38eb059f50e078876caeb49e0da52814", "filename": "gcc/jit/jit-playback.h", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e7547bc697688459e3e1ece81268e7b14addef22/gcc%2Fjit%2Fjit-playback.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e7547bc697688459e3e1ece81268e7b14addef22/gcc%2Fjit%2Fjit-playback.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjit%2Fjit-playback.h?ref=e7547bc697688459e3e1ece81268e7b14addef22", "patch": "@@ -215,9 +215,7 @@ class context : public log_user\n     return m_recording_ctxt->errors_occurred ();\n   }\n \n-  /* For use by jit_langhook_write_globals.  */\n-  void write_global_decls_1 ();\n-  void write_global_decls_2 ();\n+  void finalize_global_decls ();\n \n private:\n   void dump_generated_code ();"}]}