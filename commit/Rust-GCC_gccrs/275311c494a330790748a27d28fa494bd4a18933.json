{"sha": "275311c494a330790748a27d28fa494bd4a18933", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mjc1MzExYzQ5NGEzMzA3OTA3NDhhMjdkMjhmYTQ5NGJkNGExODkzMw==", "commit": {"author": {"name": "Mikael Pettersson", "email": "mikpe@it.uu.se", "date": "2011-06-06T11:43:31Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2011-06-06T11:43:31Z"}, "message": "re PR tree-optimization/49243 (attribute((returns_twice)) doesn't work)\n\n2011-06-06  Mikael Pettersson  <mikpe@it.uu.se>\n\n\tPR tree-optimization/49243\n\t* calls.c (setjmp_call_p): Also check if fndecl has the\n\treturns_twice attribute.\n\n\t* gcc.dg/pr49243.c: New.\n\nFrom-SVN: r174695", "tree": {"sha": "4cf2bc8dd32967087e36ff5664d882cd396e5b51", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4cf2bc8dd32967087e36ff5664d882cd396e5b51"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/275311c494a330790748a27d28fa494bd4a18933", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/275311c494a330790748a27d28fa494bd4a18933", "html_url": "https://github.com/Rust-GCC/gccrs/commit/275311c494a330790748a27d28fa494bd4a18933", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/275311c494a330790748a27d28fa494bd4a18933/comments", "author": null, "committer": null, "parents": [{"sha": "38fbfaf6fb23fdcd130cc524839686b9ad28f752", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38fbfaf6fb23fdcd130cc524839686b9ad28f752", "html_url": "https://github.com/Rust-GCC/gccrs/commit/38fbfaf6fb23fdcd130cc524839686b9ad28f752"}], "stats": {"total": 38, "additions": 38, "deletions": 0}, "files": [{"sha": "3f01f25faf09d44bd7da695aca125931fed484db", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/275311c494a330790748a27d28fa494bd4a18933/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/275311c494a330790748a27d28fa494bd4a18933/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=275311c494a330790748a27d28fa494bd4a18933", "patch": "@@ -1,3 +1,9 @@\n+2011-06-06  Mikael Pettersson  <mikpe@it.uu.se>\n+\n+\tPR tree-optimization/49243\n+\t* calls.c (setjmp_call_p): Also check if fndecl has the\n+\treturns_twice attribute.\n+\n 2011-06-06  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \t* config/mips/iris6.h (ENDFILE_SPEC): Use crtfastmath.o if"}, {"sha": "feb98d21c00296a30b156f959fa7c08569bf370f", "filename": "gcc/calls.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/275311c494a330790748a27d28fa494bd4a18933/gcc%2Fcalls.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/275311c494a330790748a27d28fa494bd4a18933/gcc%2Fcalls.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcalls.c?ref=275311c494a330790748a27d28fa494bd4a18933", "patch": "@@ -567,6 +567,8 @@ special_function_p (const_tree fndecl, int flags)\n int\n setjmp_call_p (const_tree fndecl)\n {\n+  if (DECL_IS_RETURNS_TWICE (fndecl))\n+    return ECF_RETURNS_TWICE;\n   return special_function_p (fndecl, 0) & ECF_RETURNS_TWICE;\n }\n "}, {"sha": "1c0a71a6ec345097f2f54befbf55497895577a8e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/275311c494a330790748a27d28fa494bd4a18933/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/275311c494a330790748a27d28fa494bd4a18933/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=275311c494a330790748a27d28fa494bd4a18933", "patch": "@@ -1,3 +1,8 @@\n+2011-06-06  Mikael Pettersson  <mikpe@it.uu.se>\n+\n+\tPR tree-optimization/49243\n+\t* gcc.dg/pr49243.c: New.\n+\n 2011-06-06  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/specs/cond_expr1.ads: New test."}, {"sha": "f896b05b06018da00d078ec10bcaa446617bfd9a", "filename": "gcc/testsuite/gcc.dg/pr49243.c", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/275311c494a330790748a27d28fa494bd4a18933/gcc%2Ftestsuite%2Fgcc.dg%2Fpr49243.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/275311c494a330790748a27d28fa494bd4a18933/gcc%2Ftestsuite%2Fgcc.dg%2Fpr49243.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr49243.c?ref=275311c494a330790748a27d28fa494bd4a18933", "patch": "@@ -0,0 +1,25 @@\n+/* PR tree-optimization/49243 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -Winline\" } */\n+\n+extern unsigned long jb[];\n+extern int my_setjmp(unsigned long jb[]) __attribute__((returns_twice));\n+extern int decode(const char*);\n+\n+static inline int wrapper(const char **s_ptr) /* { dg-warning \"(inlining failed|function 'wrapper' can never be inlined because it uses setjmp)\" } */\n+{\n+    if (my_setjmp(jb) == 0) {\n+\tconst char *s = *s_ptr;\n+\twhile (decode(s) != 0)\n+\t    *s_ptr = ++s;\n+\treturn 0;\n+    } else\n+\treturn -1;\n+}\n+\n+void parse(const char *data)\n+{\n+    const char *s = data;\n+    if (!(wrapper(&s) == -1 && (s - data) == 1)) /* { dg-warning \"called from here\" } */\n+\t__builtin_abort();\n+}"}]}