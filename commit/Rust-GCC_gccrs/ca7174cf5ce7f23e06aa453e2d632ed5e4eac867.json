{"sha": "ca7174cf5ce7f23e06aa453e2d632ed5e4eac867", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2E3MTc0Y2Y1Y2U3ZjIzZTA2YWE0NTNlMmQ2MzJlZDVlNGVhYzg2Nw==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2011-01-29T07:16:20Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2011-01-29T07:16:20Z"}, "message": "re PR go/47515 (Issues porting libgo to IRIX 6.5)\n\n\tPR go/47515\nruntime: If no MAP_ANON, use /dev/zero.\n\nFrom-SVN: r169388", "tree": {"sha": "c1d5ea86ec3d33227420e2b63ebf7dcfebe431f5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c1d5ea86ec3d33227420e2b63ebf7dcfebe431f5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ca7174cf5ce7f23e06aa453e2d632ed5e4eac867", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca7174cf5ce7f23e06aa453e2d632ed5e4eac867", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ca7174cf5ce7f23e06aa453e2d632ed5e4eac867", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca7174cf5ce7f23e06aa453e2d632ed5e4eac867/comments", "author": null, "committer": null, "parents": [{"sha": "e0b77418ce90c353563d88ff5fab32f68cdc0bef", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e0b77418ce90c353563d88ff5fab32f68cdc0bef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e0b77418ce90c353563d88ff5fab32f68cdc0bef"}], "stats": {"total": 31, "additions": 30, "deletions": 1}, "files": [{"sha": "4d6c7420907f285039c94e52cbd3bce30a889f2c", "filename": "libgo/runtime/mem.c", "status": "modified", "additions": 27, "deletions": 1, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca7174cf5ce7f23e06aa453e2d632ed5e4eac867/libgo%2Fruntime%2Fmem.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca7174cf5ce7f23e06aa453e2d632ed5e4eac867/libgo%2Fruntime%2Fmem.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fruntime%2Fmem.c?ref=ca7174cf5ce7f23e06aa453e2d632ed5e4eac867", "patch": "@@ -3,13 +3,39 @@\n #include \"runtime.h\"\n #include \"malloc.h\"\n \n+#ifndef MAP_ANON\n+#ifdef MAP_ANONYMOUS\n+#define MAP_ANON MAP_ANONYMOUS\n+#else\n+#define USE_DEV_ZERO\n+#define MAP_ANON 0\n+#endif\n+#endif\n+\n+#ifdef USE_DEV_ZERO\n+static int dev_zero = -1;\n+#endif\n+\n void*\n runtime_SysAlloc(uintptr n)\n {\n \tvoid *p;\n+\tint fd = -1;\n \n \tmstats.sys += n;\n-\tp = runtime_mmap(nil, n, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_ANON|MAP_PRIVATE, -1, 0);\n+\n+#ifdef USE_DEV_ZERO\n+\tif (dev_zero == -1) {\n+\t\tdev_zero = open(\"/dev/zero\", O_RDONLY);\n+\t\tif (dev_zero < 0) {\n+\t\t\tprintf(\"open /dev/zero: errno=%d\\n\", errno);\n+\t\t\texit(2);\n+\t\t}\n+\t}\n+\tfd = dev_zero;\n+#endif\n+\n+\tp = runtime_mmap(nil, n, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_ANON|MAP_PRIVATE, fd, 0);\n \tif (p == MAP_FAILED) {\n \t\tif(errno == EACCES) {\n \t\t\tprintf(\"mmap: access denied\\n\");"}, {"sha": "95216e4a5ca28091c1d57db3f9b8449eb215d4ca", "filename": "libgo/runtime/runtime.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca7174cf5ce7f23e06aa453e2d632ed5e4eac867/libgo%2Fruntime%2Fruntime.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca7174cf5ce7f23e06aa453e2d632ed5e4eac867/libgo%2Fruntime%2Fruntime.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fruntime%2Fruntime.h?ref=ca7174cf5ce7f23e06aa453e2d632ed5e4eac867", "patch": "@@ -12,6 +12,9 @@\n #include <stdio.h>\n #include <stdlib.h>\n #include <string.h>\n+#include <sys/types.h>\n+#include <sys/stat.h>\n+#include <fcntl.h>\n #include <pthread.h>\n #include <semaphore.h>\n "}]}