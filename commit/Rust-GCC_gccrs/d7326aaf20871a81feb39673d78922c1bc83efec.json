{"sha": "d7326aaf20871a81feb39673d78922c1bc83efec", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDczMjZhYWYyMDg3MWE4MWZlYjM5NjczZDc4OTIyYzFiYzgzZWZlYw==", "commit": {"author": {"name": "Max Filippov", "email": "jcmvbkbc@gmail.com", "date": "2019-09-26T20:51:27Z"}, "committer": {"name": "Max Filippov", "email": "jcmvbkbc@gcc.gnu.org", "date": "2019-09-26T20:51:27Z"}, "message": "xtensa: fix PR target/91880\n\nXtensa hwloop_optimize segfaults when zero overhead loop is about to be\ninserted as the first instruction of the function.\nInsert zero overhead loop instruction into new basic block before the\nloop when basic block that precedes the loop is empty.\n\n2019-09-26  Max Filippov  <jcmvbkbc@gmail.com>\ngcc/\n\t* config/xtensa/xtensa.c (hwloop_optimize): Insert zero overhead\n\tloop instruction into new basic block before the loop when basic\n\tblock that precedes the loop is empty.\n\ngcc/testsuite/\n\t* gcc.target/xtensa/pr91880.c: New test case.\n\t* gcc.target/xtensa/xtensa.exp: New test suite.\n\nFrom-SVN: r276166", "tree": {"sha": "f946f3aba697deed6752d518e37e3d3e810b5e03", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f946f3aba697deed6752d518e37e3d3e810b5e03"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d7326aaf20871a81feb39673d78922c1bc83efec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d7326aaf20871a81feb39673d78922c1bc83efec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d7326aaf20871a81feb39673d78922c1bc83efec", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d7326aaf20871a81feb39673d78922c1bc83efec/comments", "author": {"login": "jcmvbkbc", "id": 166731, "node_id": "MDQ6VXNlcjE2NjczMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/166731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jcmvbkbc", "html_url": "https://github.com/jcmvbkbc", "followers_url": "https://api.github.com/users/jcmvbkbc/followers", "following_url": "https://api.github.com/users/jcmvbkbc/following{/other_user}", "gists_url": "https://api.github.com/users/jcmvbkbc/gists{/gist_id}", "starred_url": "https://api.github.com/users/jcmvbkbc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jcmvbkbc/subscriptions", "organizations_url": "https://api.github.com/users/jcmvbkbc/orgs", "repos_url": "https://api.github.com/users/jcmvbkbc/repos", "events_url": "https://api.github.com/users/jcmvbkbc/events{/privacy}", "received_events_url": "https://api.github.com/users/jcmvbkbc/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "25b45c7c6cea24f85d2f87c11c0e3c99ef20b655", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/25b45c7c6cea24f85d2f87c11c0e3c99ef20b655", "html_url": "https://github.com/Rust-GCC/gccrs/commit/25b45c7c6cea24f85d2f87c11c0e3c99ef20b655"}], "stats": {"total": 67, "additions": 65, "deletions": 2}, "files": [{"sha": "3d1233715a1025b7e266eda88a6d1ae2d2e837c8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7326aaf20871a81feb39673d78922c1bc83efec/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7326aaf20871a81feb39673d78922c1bc83efec/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d7326aaf20871a81feb39673d78922c1bc83efec", "patch": "@@ -1,3 +1,9 @@\n+2019-09-26  Max Filippov  <jcmvbkbc@gmail.com>\n+\n+\t* config/xtensa/xtensa.c (hwloop_optimize): Insert zero overhead\n+\tloop instruction into new basic block before the loop when basic\n+\tblock that precedes the loop is empty.\n+\n 2019-09-26  Jakub Jelinek  <jakub@redhat.com>\n \n \t* function.c (gimplify_parameters): Use build_clobber function."}, {"sha": "9453f0c162b34d43dc3ecc6900bd83ce8121453e", "filename": "gcc/config/xtensa/xtensa.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7326aaf20871a81feb39673d78922c1bc83efec/gcc%2Fconfig%2Fxtensa%2Fxtensa.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7326aaf20871a81feb39673d78922c1bc83efec/gcc%2Fconfig%2Fxtensa%2Fxtensa.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.c?ref=d7326aaf20871a81feb39673d78922c1bc83efec", "patch": "@@ -4230,7 +4230,9 @@ hwloop_optimize (hwloop_info loop)\n \n   seq = get_insns ();\n \n-  if (!single_succ_p (entry_bb) || vec_safe_length (loop->incoming) > 1)\n+  entry_after = BB_END (entry_bb);\n+  if (!single_succ_p (entry_bb) || vec_safe_length (loop->incoming) > 1\n+      || !entry_after)\n     {\n       basic_block new_bb;\n       edge e;\n@@ -4251,7 +4253,6 @@ hwloop_optimize (hwloop_info loop)\n     }\n   else\n     {\n-      entry_after = BB_END (entry_bb);\n       while (DEBUG_INSN_P (entry_after)\n              || (NOTE_P (entry_after)\n \t\t && NOTE_KIND (entry_after) != NOTE_INSN_BASIC_BLOCK))"}, {"sha": "7cdc8f0d107a1f5bc57ef9f2d770e46d517d808e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7326aaf20871a81feb39673d78922c1bc83efec/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7326aaf20871a81feb39673d78922c1bc83efec/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d7326aaf20871a81feb39673d78922c1bc83efec", "patch": "@@ -1,3 +1,8 @@\n+2019-09-26  Max Filippov  <jcmvbkbc@gmail.com>\n+\n+\t* gcc.target/xtensa/pr91880.c: New test case.\n+\t* gcc.target/xtensa/xtensa.exp: New test suite.\n+\n 2019-09-26  Will Schmidt <will_schmidt@vnet.ibm.com>\n \n \t* gcc.target/powerpc/pure-builtin-redundant-load.c:  New."}, {"sha": "f4895a1bb8ecb081ec5985135d28d4e7a6324c97", "filename": "gcc/testsuite/gcc.target/xtensa/pr91880.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7326aaf20871a81feb39673d78922c1bc83efec/gcc%2Ftestsuite%2Fgcc.target%2Fxtensa%2Fpr91880.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7326aaf20871a81feb39673d78922c1bc83efec/gcc%2Ftestsuite%2Fgcc.target%2Fxtensa%2Fpr91880.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fxtensa%2Fpr91880.c?ref=d7326aaf20871a81feb39673d78922c1bc83efec", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -fomit-frame-pointer -fno-tree-vectorize\" } */\n+\n+void foo (unsigned int n, char *a, char *b)\n+{\n+  int i;\n+\n+  for (i = 0; i <= n - 1; ++i)\n+    a[i] = b[i];\n+}"}, {"sha": "8720327f526e56f715a51272ecb85380e0d3dea2", "filename": "gcc/testsuite/gcc.target/xtensa/xtensa.exp", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7326aaf20871a81feb39673d78922c1bc83efec/gcc%2Ftestsuite%2Fgcc.target%2Fxtensa%2Fxtensa.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7326aaf20871a81feb39673d78922c1bc83efec/gcc%2Ftestsuite%2Fgcc.target%2Fxtensa%2Fxtensa.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fxtensa%2Fxtensa.exp?ref=d7326aaf20871a81feb39673d78922c1bc83efec", "patch": "@@ -0,0 +1,41 @@\n+# Copyright (C) 2019 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+#\n+# You should have received a copy of the GNU General Public License\n+# along with GCC; see the file COPYING3.  If not see\n+# <http://www.gnu.org/licenses/>.\n+\n+# GCC testsuite that uses the `dg.exp' driver.\n+\n+# Exit immediately if this isn't an Xtensa target.\n+if ![istarget xtensa*-*-*] then {\n+  return\n+}\n+\n+# Load support procs.\n+load_lib gcc-dg.exp\n+\n+# If a testcase doesn't have special options, use these.\n+global DEFAULT_CFLAGS\n+if ![info exists DEFAULT_CFLAGS] then {\n+    set DEFAULT_CFLAGS \" -ansi -pedantic-errors\"\n+}\n+\n+# Initialize `dg'.\n+dg-init\n+\n+# Main loop.\n+dg-runtest [lsort [glob -nocomplain $srcdir/$subdir/*.\\[cS\\]]] \\\n+\t\"\" $DEFAULT_CFLAGS\n+\n+# All done.\n+dg-finish"}]}