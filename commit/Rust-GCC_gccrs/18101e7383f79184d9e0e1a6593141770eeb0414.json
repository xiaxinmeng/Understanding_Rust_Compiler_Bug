{"sha": "18101e7383f79184d9e0e1a6593141770eeb0414", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTgxMDFlNzM4M2Y3OTE4NGQ5ZTBlMWE2NTkzMTQxNzcwZWViMDQxNA==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2018-02-26T17:06:07Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2018-02-26T17:06:07Z"}, "message": "PR c++/84447 - ICE with deleted inherited ctor with default arg.\n\n\t* call.c (build_over_call): Handle deleted functions in one place.\n\nFrom-SVN: r258003", "tree": {"sha": "e39976d23aa4a34112c40df1327e326eabf482d3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e39976d23aa4a34112c40df1327e326eabf482d3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/18101e7383f79184d9e0e1a6593141770eeb0414", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18101e7383f79184d9e0e1a6593141770eeb0414", "html_url": "https://github.com/Rust-GCC/gccrs/commit/18101e7383f79184d9e0e1a6593141770eeb0414", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18101e7383f79184d9e0e1a6593141770eeb0414/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f18f8ade38e5a71e7bdafa46f0972b45e835ea9e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f18f8ade38e5a71e7bdafa46f0972b45e835ea9e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f18f8ade38e5a71e7bdafa46f0972b45e835ea9e"}], "stats": {"total": 41, "additions": 28, "deletions": 13}, "files": [{"sha": "59d4ceead6713eff18418fbdc92df60c5358030c", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18101e7383f79184d9e0e1a6593141770eeb0414/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18101e7383f79184d9e0e1a6593141770eeb0414/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=18101e7383f79184d9e0e1a6593141770eeb0414", "patch": "@@ -1,3 +1,8 @@\n+2018-02-26  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/84447 - ICE with deleted inherited ctor with default arg.\n+\t* call.c (build_over_call): Handle deleted functions in one place.\n+\n 2018-02-26  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/84533"}, {"sha": "c47befdbf7f88340290837ec352d47394868b2fa", "filename": "gcc/cp/call.c", "status": "modified", "additions": 9, "deletions": 13, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18101e7383f79184d9e0e1a6593141770eeb0414/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18101e7383f79184d9e0e1a6593141770eeb0414/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=18101e7383f79184d9e0e1a6593141770eeb0414", "patch": "@@ -7665,8 +7665,12 @@ build_over_call (struct z_candidate *cand, int flags, tsubst_flags_t complain)\n     deduce_inheriting_ctor (fn);\n \n   /* Make =delete work with SFINAE.  */\n-  if (DECL_DELETED_FN (fn) && !(complain & tf_error))\n-    return error_mark_node;\n+  if (DECL_DELETED_FN (fn))\n+    {\n+      if (complain & tf_error)\n+\tmark_used (fn);\n+      return error_mark_node;\n+    }\n \n   if (DECL_FUNCTION_MEMBER_P (fn))\n     {\n@@ -7710,12 +7714,6 @@ build_over_call (struct z_candidate *cand, int flags, tsubst_flags_t complain)\n      conversions.  */\n   if (flags & LOOKUP_SPECULATIVE)\n     {\n-      if (DECL_DELETED_FN (fn))\n-\t{\n-\t  if (complain & tf_error)\n-\t    mark_used (fn);\n-\t  return error_mark_node;\n-\t}\n       if (cand->viable == 1)\n \treturn fn;\n       else if (!(complain & tf_error))\n@@ -8090,7 +8088,7 @@ build_over_call (struct z_candidate *cand, int flags, tsubst_flags_t complain)\n \n       /* [class.copy]: the copy constructor is implicitly defined even if\n \t the implementation elided its use.  */\n-      if (!trivial || DECL_DELETED_FN (fn))\n+      if (!trivial)\n \t{\n \t  if (!mark_used (fn, complain) && !(complain & tf_error))\n \t    return error_mark_node;\n@@ -8121,8 +8119,7 @@ build_over_call (struct z_candidate *cand, int flags, tsubst_flags_t complain)\n     }\n   else if (DECL_ASSIGNMENT_OPERATOR_P (fn)\n \t   && DECL_OVERLOADED_OPERATOR_IS (fn, NOP_EXPR)\n-\t   && trivial_fn_p (fn)\n-\t   && !DECL_DELETED_FN (fn))\n+\t   && trivial_fn_p (fn))\n     {\n       tree to = cp_stabilize_reference\n \t(cp_build_fold_indirect_ref (argarray[0]));\n@@ -8166,8 +8163,7 @@ build_over_call (struct z_candidate *cand, int flags, tsubst_flags_t complain)\n \n       return val;\n     }\n-  else if (!DECL_DELETED_FN (fn)\n-\t   && trivial_fn_p (fn))\n+  else if (trivial_fn_p (fn))\n     {\n       if (DECL_DESTRUCTOR_P (fn))\n \treturn fold_convert (void_type_node, argarray[0]);"}, {"sha": "071f1789a3b75f40fdeb90fa698b9bc9a57570ba", "filename": "gcc/testsuite/g++.dg/cpp0x/inh-ctor31.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18101e7383f79184d9e0e1a6593141770eeb0414/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finh-ctor31.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18101e7383f79184d9e0e1a6593141770eeb0414/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finh-ctor31.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finh-ctor31.C?ref=18101e7383f79184d9e0e1a6593141770eeb0414", "patch": "@@ -0,0 +1,14 @@\n+// PR c++/84447\n+// { dg-do compile { target c++11 } }\n+\n+struct A\n+{\n+  template<typename T> A(T, T = 0) = delete;\n+};\n+\n+struct B : A\n+{\n+  using A::A;\t\t\t// { dg-error \"deleted\" }\n+};\n+\n+B b(0);\t\t\t\t// { dg-error \"deleted\" }"}]}