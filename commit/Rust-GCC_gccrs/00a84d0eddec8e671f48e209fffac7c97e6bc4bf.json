{"sha": "00a84d0eddec8e671f48e209fffac7c97e6bc4bf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDBhODRkMGVkZGVjOGU2NzFmNDhlMjA5ZmZmYWM3Yzk3ZTZiYzRiZg==", "commit": {"author": {"name": "Sheldon Lobo", "email": "sheldon.lobo@oracle.com", "date": "2017-05-18T09:34:26Z"}, "committer": {"name": "Sheldon Lobo", "email": "smlobo@gcc.gnu.org", "date": "2017-05-18T09:34:26Z"}, "message": "Minor SPARC T4 and M7 fixes and additions.\n\n\t* config/sparc/sparc.c (sparc_option_override): Set function\n\talignment for -mcpu=niagara7 to 64 to match the I$ line.\n\t* config/sparc/sparc.h (BRANCH_COST): Set the SPARC M7 branch\n\tlatency to 1.\n\t* config/sparc/sparc.h (BRANCH_COST): Set the SPARC T4 branch\n\tlatency to 2.\n\t* config/sparc/sol2.h: Fix a ASM_CPU32_DEFAULT_SPEC typo.\n\t* gcc.target/sparc/niagara7-align.c: New test.\n\nFrom-SVN: r248184", "tree": {"sha": "3073cf46a77e5e964b3e0c4db99086e8a4fe43b8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3073cf46a77e5e964b3e0c4db99086e8a4fe43b8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/00a84d0eddec8e671f48e209fffac7c97e6bc4bf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/00a84d0eddec8e671f48e209fffac7c97e6bc4bf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/00a84d0eddec8e671f48e209fffac7c97e6bc4bf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/00a84d0eddec8e671f48e209fffac7c97e6bc4bf/comments", "author": null, "committer": null, "parents": [{"sha": "243c288370fe51ba55c3a9ee61eb2a1a62cb1279", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/243c288370fe51ba55c3a9ee61eb2a1a62cb1279", "html_url": "https://github.com/Rust-GCC/gccrs/commit/243c288370fe51ba55c3a9ee61eb2a1a62cb1279"}], "stats": {"total": 44, "additions": 36, "deletions": 8}, "files": [{"sha": "a9978bca01643c21252cd5f6e6397ba70af12768", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a84d0eddec8e671f48e209fffac7c97e6bc4bf/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a84d0eddec8e671f48e209fffac7c97e6bc4bf/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=00a84d0eddec8e671f48e209fffac7c97e6bc4bf", "patch": "@@ -1,3 +1,13 @@\n+2017-05-18  Sheldon Lobo  <sheldon.lobo@oracle.com>\n+\n+\t* config/sparc/sparc.c (sparc_option_override): Set function\n+\talignment for -mcpu=niagara7 to 64 to match the I$ line.\n+\t* config/sparc/sparc.h (BRANCH_COST): Set the SPARC M7 branch\n+\tlatency to 1.\n+\t* config/sparc/sparc.h (BRANCH_COST): Set the SPARC T4 branch\n+\tlatency to 2.\n+\t* config/sparc/sol2.h: Fix a ASM_CPU32_DEFAULT_SPEC typo.\n+\n 2017-05-18  Marek Polacek  <polacek@redhat.com>\n \n \tPR sanitizer/80797"}, {"sha": "8a50bfeefc7fc412816f3d4dad4736a83bd2ef11", "filename": "gcc/config/sparc/sol2.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a84d0eddec8e671f48e209fffac7c97e6bc4bf/gcc%2Fconfig%2Fsparc%2Fsol2.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a84d0eddec8e671f48e209fffac7c97e6bc4bf/gcc%2Fconfig%2Fsparc%2Fsol2.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fsol2.h?ref=00a84d0eddec8e671f48e209fffac7c97e6bc4bf", "patch": "@@ -169,7 +169,7 @@ along with GCC; see the file COPYING3.  If not see\n #undef CPP_CPU64_DEFAULT_SPEC\n #define CPP_CPU64_DEFAULT_SPEC \"\"\n #undef ASM_CPU32_DEFAULT_SPEC\n-#define ASM_CPU32_DEFAUILT_SPEC AS_SPARC32_FLAG AS_NIAGARA7_FLAG\n+#define ASM_CPU32_DEFAULT_SPEC AS_SPARC32_FLAG AS_NIAGARA7_FLAG\n #undef ASM_CPU64_DEFAULT_SPEC\n #define ASM_CPU64_DEFAULT_SPEC AS_SPARC64_FLAG AS_NIAGARA7_FLAG\n #endif"}, {"sha": "6dfb2698c71e3924add1a8b6fb623c5bb4ed17da", "filename": "gcc/config/sparc/sparc.c", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a84d0eddec8e671f48e209fffac7c97e6bc4bf/gcc%2Fconfig%2Fsparc%2Fsparc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a84d0eddec8e671f48e209fffac7c97e6bc4bf/gcc%2Fconfig%2Fsparc%2Fsparc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fsparc.c?ref=00a84d0eddec8e671f48e209fffac7c97e6bc4bf", "patch": "@@ -1528,15 +1528,18 @@ sparc_option_override (void)\n     target_flags |= MASK_LRA;\n \n   /* Supply a default value for align_functions.  */\n-  if (align_functions == 0\n-      && (sparc_cpu == PROCESSOR_ULTRASPARC\n+  if (align_functions == 0)\n+    {\n+      if (sparc_cpu == PROCESSOR_ULTRASPARC\n \t  || sparc_cpu == PROCESSOR_ULTRASPARC3\n \t  || sparc_cpu == PROCESSOR_NIAGARA\n \t  || sparc_cpu == PROCESSOR_NIAGARA2\n \t  || sparc_cpu == PROCESSOR_NIAGARA3\n-\t  || sparc_cpu == PROCESSOR_NIAGARA4\n-\t  || sparc_cpu == PROCESSOR_NIAGARA7))\n-    align_functions = 32;\n+\t  || sparc_cpu == PROCESSOR_NIAGARA4)\n+\talign_functions = 32;\n+      else if (sparc_cpu == PROCESSOR_NIAGARA7)\n+\talign_functions = 64;\n+    }\n \n   /* Validate PCC_STRUCT_RETURN.  */\n   if (flag_pcc_struct_return == DEFAULT_PCC_STRUCT_RETURN)"}, {"sha": "686a3d521939752a77efc7052e59fceb816fc3c3", "filename": "gcc/config/sparc/sparc.h", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a84d0eddec8e671f48e209fffac7c97e6bc4bf/gcc%2Fconfig%2Fsparc%2Fsparc.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a84d0eddec8e671f48e209fffac7c97e6bc4bf/gcc%2Fconfig%2Fsparc%2Fsparc.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fsparc.h?ref=00a84d0eddec8e671f48e209fffac7c97e6bc4bf", "patch": "@@ -1566,7 +1566,10 @@ do {\t\t\t\t\t\t\t\t\t   \\\n    and annulled branches insert 4 bubbles.\n \n    On Niagara-2 and Niagara-3, a not-taken branch costs 1 cycle whereas\n-   a taken branch costs 6 cycles.  */\n+   a taken branch costs 6 cycles.\n+\n+   The T4 Supplement specifies the branch latency at 2 cycles.\n+   The M7 Supplement specifies the branch latency at 1 cycle. */\n \n #define BRANCH_COST(speed_p, predictable_p) \\\n \t((sparc_cpu == PROCESSOR_V9 \\\n@@ -1579,7 +1582,11 @@ do {\t\t\t\t\t\t\t\t\t   \\\n \t : ((sparc_cpu == PROCESSOR_NIAGARA2 \\\n \t     || sparc_cpu == PROCESSOR_NIAGARA3) \\\n \t    ? 5 \\\n-\t : 3))))\n+\t : (sparc_cpu == PROCESSOR_NIAGARA4 \\\n+\t    ? 2 \\\n+\t : (sparc_cpu == PROCESSOR_NIAGARA7 \\\n+\t    ? 1 \\\n+\t : 3))))))\n \f\n /* Control the assembler format that we output.  */\n "}, {"sha": "fca9165d0ce5a2fabd695433a6649ad9f4dc8518", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a84d0eddec8e671f48e209fffac7c97e6bc4bf/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a84d0eddec8e671f48e209fffac7c97e6bc4bf/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=00a84d0eddec8e671f48e209fffac7c97e6bc4bf", "patch": "@@ -1,3 +1,7 @@\n+2017-05-18  Sheldon Lobo  <sheldon.lobo@oracle.com>\n+\n+\t* gcc.target/sparc/niagara7-align.c: New test.\n+\n 2017-05-18  Marek Polacek  <polacek@redhat.com>\n \n \tPR sanitizer/80797"}, {"sha": "a46aac17c32948dc02cb1cb70d47616ebbf9fede", "filename": "gcc/testsuite/gcc.target/sparc/niagara7-align.c", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a84d0eddec8e671f48e209fffac7c97e6bc4bf/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Fniagara7-align.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a84d0eddec8e671f48e209fffac7c97e6bc4bf/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Fniagara7-align.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fsparc%2Fniagara7-align.c?ref=00a84d0eddec8e671f48e209fffac7c97e6bc4bf", "patch": "@@ -0,0 +1,4 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-falign-functions -mcpu=niagara7\" } */\n+/* { dg-final { scan-assembler \"\\.align 64\" } } */\n+void foo(void) {}"}]}