{"sha": "ce4e59c46ba3989a420afca61ddcf9550e02ab7f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2U0ZTU5YzQ2YmEzOTg5YTQyMGFmY2E2MWRkY2Y5NTUwZTAyYWI3Zg==", "commit": {"author": {"name": "Samuel Tardieu", "email": "sam@rfc1149.net", "date": "2008-04-09T14:21:18Z"}, "committer": {"name": "Samuel Tardieu", "email": "sam@gcc.gnu.org", "date": "2008-04-09T14:21:18Z"}, "message": "re PR ada/28305 (GNAT bug when inlining instance of a generic subprogram)\n\n    gcc/ada/\n\tPR ada/28305\n\t* sem_ch6.adb (Build_Body_To_Inline): Do not save and restore\n\tenvironment if generic instance is a top-level one.\n\n    gcc/testsuite/\n\tPR ada/28305\n\t* gnat.dg/specs/fe_inlining.ads, gnat.dg/specs/fe_inlining_helper.ads,\n\tgnat.dg/specs/fe_inlining_helper.adb: New test.\n\nFrom-SVN: r134142", "tree": {"sha": "1df1a59c24593585213fab7e8e0190a93d6bb053", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1df1a59c24593585213fab7e8e0190a93d6bb053"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ce4e59c46ba3989a420afca61ddcf9550e02ab7f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce4e59c46ba3989a420afca61ddcf9550e02ab7f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ce4e59c46ba3989a420afca61ddcf9550e02ab7f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce4e59c46ba3989a420afca61ddcf9550e02ab7f/comments", "author": {"login": "samueltardieu", "id": 44656, "node_id": "MDQ6VXNlcjQ0NjU2", "avatar_url": "https://avatars.githubusercontent.com/u/44656?v=4", "gravatar_id": "", "url": "https://api.github.com/users/samueltardieu", "html_url": "https://github.com/samueltardieu", "followers_url": "https://api.github.com/users/samueltardieu/followers", "following_url": "https://api.github.com/users/samueltardieu/following{/other_user}", "gists_url": "https://api.github.com/users/samueltardieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/samueltardieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/samueltardieu/subscriptions", "organizations_url": "https://api.github.com/users/samueltardieu/orgs", "repos_url": "https://api.github.com/users/samueltardieu/repos", "events_url": "https://api.github.com/users/samueltardieu/events{/privacy}", "received_events_url": "https://api.github.com/users/samueltardieu/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3a3a1fe1f8ed06d2ea69734c8f22a874eeb80b36", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3a3a1fe1f8ed06d2ea69734c8f22a874eeb80b36", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3a3a1fe1f8ed06d2ea69734c8f22a874eeb80b36"}], "stats": {"total": 33, "additions": 31, "deletions": 2}, "files": [{"sha": "f659d3303eac87b56235b9eb91d000bdb560f276", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce4e59c46ba3989a420afca61ddcf9550e02ab7f/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce4e59c46ba3989a420afca61ddcf9550e02ab7f/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=ce4e59c46ba3989a420afca61ddcf9550e02ab7f", "patch": "@@ -1,3 +1,9 @@\n+2008-04-09  Samuel Tardieu  <sam@rfc1149.net>\n+\n+\tPR ada/28305\n+\t* sem_ch6.adb (Build_Body_To_Inline): Do not save and restore\n+\tenvironment if generic instance is a top-level one.\n+\n 2008-04-09  Doug Rupp  <rupp@adacore.com>\n \n \t* decl.c (validate_size): Set minimum size for fat pointers same as"}, {"sha": "668a2a7b204aa37ca73c1977a957e2f304dbd215", "filename": "gcc/ada/sem_ch6.adb", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce4e59c46ba3989a420afca61ddcf9550e02ab7f/gcc%2Fada%2Fsem_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce4e59c46ba3989a420afca61ddcf9550e02ab7f/gcc%2Fada%2Fsem_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch6.adb?ref=ce4e59c46ba3989a420afca61ddcf9550e02ab7f", "patch": "@@ -2929,7 +2929,11 @@ package body Sem_Ch6 is\n       --  Within an instance, the body to inline must be treated as a nested\n       --  generic, so that the proper global references are preserved.\n \n-      if In_Instance then\n+      --  Note that we do not do this at the library level, because it is not\n+      --  needed, and furthermore this causes trouble if front end inlining\n+      --  is activated (-gnatN).\n+\n+      if In_Instance and then Scope (Current_Scope) /= Standard_Standard then\n          Save_Env (Scope (Current_Scope), Scope (Current_Scope));\n          Original_Body := Copy_Generic_Node (N, Empty, True);\n       else\n@@ -2977,7 +2981,9 @@ package body Sem_Ch6 is\n \n       Expander_Mode_Restore;\n \n-      if In_Instance then\n+      --  Restore environment if previously saved\n+\n+      if In_Instance and then Scope (Current_Scope) /= Standard_Standard then\n          Restore_Env;\n       end if;\n "}, {"sha": "18d9236b778cab69615e9636e6139afc5c5d5d18", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce4e59c46ba3989a420afca61ddcf9550e02ab7f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce4e59c46ba3989a420afca61ddcf9550e02ab7f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ce4e59c46ba3989a420afca61ddcf9550e02ab7f", "patch": "@@ -1,3 +1,9 @@\n+2008-04-09  Samuel Tardieu  <sam@rfc1149.net>\n+\n+\tPR ada/28305\n+\t* gnat.dg/specs/fe_inlining.ads, gnat.dg/specs/fe_inlining_helper.ads,\n+\tgnat.dg/specs/fe_inlining_helper.adb: New test.\n+\n 2008-04-09  Kai Tietz  <kai.tietz@onevision.com>\n \n \t* gcc.dg/torture/fp-int-convert.h: Use TImode type for "}, {"sha": "ef5f46942107fe3a068875c69d62b2e9a07a4af3", "filename": "gcc/testsuite/gnat.dg/specs/fe_inlining.ads", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce4e59c46ba3989a420afca61ddcf9550e02ab7f/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Ffe_inlining.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce4e59c46ba3989a420afca61ddcf9550e02ab7f/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Ffe_inlining.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Ffe_inlining.ads?ref=ce4e59c46ba3989a420afca61ddcf9550e02ab7f", "patch": "@@ -0,0 +1,4 @@\n+-- { dg-do compile }\n+-- { dg-options \"-O -gnatN\" }\n+with FE_Inlining_Helper;\n+procedure FE_Inlining is new FE_Inlining_Helper;"}, {"sha": "c149ea3c798531fddb61e266df19309d31af8b4c", "filename": "gcc/testsuite/gnat.dg/specs/fe_inlining_helper.adb", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce4e59c46ba3989a420afca61ddcf9550e02ab7f/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Ffe_inlining_helper.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce4e59c46ba3989a420afca61ddcf9550e02ab7f/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Ffe_inlining_helper.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Ffe_inlining_helper.adb?ref=ce4e59c46ba3989a420afca61ddcf9550e02ab7f", "patch": "@@ -0,0 +1,4 @@\n+procedure FE_Inlining_Helper is\n+begin\n+   null;\n+end FE_Inlining_Helper;"}, {"sha": "733268c65e751df752b7d6f74bead01a533dd686", "filename": "gcc/testsuite/gnat.dg/specs/fe_inlining_helper.ads", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce4e59c46ba3989a420afca61ddcf9550e02ab7f/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Ffe_inlining_helper.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce4e59c46ba3989a420afca61ddcf9550e02ab7f/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Ffe_inlining_helper.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Ffe_inlining_helper.ads?ref=ce4e59c46ba3989a420afca61ddcf9550e02ab7f", "patch": "@@ -0,0 +1,3 @@\n+-- { dg-excess-errors \"no code generated\" }\n+generic\n+procedure FE_Inlining_Helper;"}]}