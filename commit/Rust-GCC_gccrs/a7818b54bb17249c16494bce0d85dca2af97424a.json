{"sha": "a7818b54bb17249c16494bce0d85dca2af97424a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTc4MThiNTRiYjE3MjQ5YzE2NDk0YmNlMGQ4NWRjYTJhZjk3NDI0YQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2013-01-15T16:33:24Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2013-01-15T16:33:24Z"}, "message": "re PR tree-optimization/55920 (ICE in expand_debug_locations, at cfgexpand.c:3753)\n\n\tPR tree-optimization/55920\n\t* tree-sra.c (sra_modify_assign): If for lacc->grp_to_be_debug_replaced\n\tthere is non-useless type conversion needed from debug rhs to lhs,\n\tuse build_debug_ref_for_model and/or VIEW_CONVERT_EXPR.\n\n\t* gcc.c-torture/compile/pr55920.c: New test.\n\nFrom-SVN: r195209", "tree": {"sha": "233c3be517e334266d67afb8bd40f84a91531a62", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/233c3be517e334266d67afb8bd40f84a91531a62"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a7818b54bb17249c16494bce0d85dca2af97424a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7818b54bb17249c16494bce0d85dca2af97424a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a7818b54bb17249c16494bce0d85dca2af97424a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7818b54bb17249c16494bce0d85dca2af97424a/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b0fe107eedb0f6d1f86639372e614587d8df3a5d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0fe107eedb0f6d1f86639372e614587d8df3a5d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b0fe107eedb0f6d1f86639372e614587d8df3a5d"}], "stats": {"total": 44, "additions": 42, "deletions": 2}, "files": [{"sha": "8323062459da7528611c911b7ea5841af13b17e4", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7818b54bb17249c16494bce0d85dca2af97424a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7818b54bb17249c16494bce0d85dca2af97424a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a7818b54bb17249c16494bce0d85dca2af97424a", "patch": "@@ -1,3 +1,10 @@\n+2013-01-15  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/55920\n+\t* tree-sra.c (sra_modify_assign): If for lacc->grp_to_be_debug_replaced\n+\tthere is non-useless type conversion needed from debug rhs to lhs,\n+\tuse build_debug_ref_for_model and/or VIEW_CONVERT_EXPR.\n+\n 2013-01-15  Joseph Myers  <joseph@codesourcery.com>\n \t    Mikael Pettersson  <mikpe@it.uu.se>\n "}, {"sha": "c20ed625e95323a26855613d5577e747bacda23d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7818b54bb17249c16494bce0d85dca2af97424a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7818b54bb17249c16494bce0d85dca2af97424a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a7818b54bb17249c16494bce0d85dca2af97424a", "patch": "@@ -1,3 +1,8 @@\n+2013-01-15  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/55920\n+\t* gcc.c-torture/compile/pr55920.c: New test.\n+\n 2013-01-15  Richard Biener  <rguenther@suse.de>\n \n \tPR middle-end/55882"}, {"sha": "91387430b71c2cf2c911286769a9cfe55394a4e9", "filename": "gcc/testsuite/gcc.c-torture/compile/pr55920.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7818b54bb17249c16494bce0d85dca2af97424a/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr55920.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7818b54bb17249c16494bce0d85dca2af97424a/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr55920.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr55920.c?ref=a7818b54bb17249c16494bce0d85dca2af97424a", "patch": "@@ -0,0 +1,16 @@\n+/* PR tree-optimization/55920 */\n+\n+struct A { unsigned a; } __attribute__((packed));\n+struct B { int b; unsigned char c[16]; };\n+void bar (struct A);\n+\n+void\n+foo (struct B *x)\n+{\n+  struct A a;\n+  if (x->b)\n+    __builtin_memcpy (&a, x->c, sizeof a);\n+  else\n+    a.a = 0;\n+  bar (a);\n+}"}, {"sha": "e5fbcf2c5c5ffb352e295763059e6d12191fa243", "filename": "gcc/tree-sra.c", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7818b54bb17249c16494bce0d85dca2af97424a/gcc%2Ftree-sra.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7818b54bb17249c16494bce0d85dca2af97424a/gcc%2Ftree-sra.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-sra.c?ref=a7818b54bb17249c16494bce0d85dca2af97424a", "patch": "@@ -3108,8 +3108,20 @@ sra_modify_assign (gimple *stmt, gimple_stmt_iterator *gsi)\n \n   if (lacc && lacc->grp_to_be_debug_replaced)\n     {\n-      gimple ds = gimple_build_debug_bind (get_access_replacement (lacc),\n-\t\t\t\t\t   unshare_expr (rhs), *stmt);\n+      tree dlhs = get_access_replacement (lacc);\n+      tree drhs = unshare_expr (rhs);\n+      if (!useless_type_conversion_p (TREE_TYPE (dlhs), TREE_TYPE (drhs)))\n+\t{\n+\t  if (AGGREGATE_TYPE_P (TREE_TYPE (drhs))\n+\t      && !contains_vce_or_bfcref_p (drhs))\n+\t    drhs = build_debug_ref_for_model (loc, drhs, 0, lacc);\n+\t  if (drhs\n+\t      && !useless_type_conversion_p (TREE_TYPE (dlhs),\n+\t\t\t\t\t     TREE_TYPE (drhs)))\n+\t    drhs = fold_build1_loc (loc, VIEW_CONVERT_EXPR,\n+\t\t\t\t    TREE_TYPE (dlhs), drhs);\n+\t}\n+      gimple ds = gimple_build_debug_bind (dlhs, drhs, *stmt);\n       gsi_insert_before (gsi, ds, GSI_SAME_STMT);\n     }\n "}]}