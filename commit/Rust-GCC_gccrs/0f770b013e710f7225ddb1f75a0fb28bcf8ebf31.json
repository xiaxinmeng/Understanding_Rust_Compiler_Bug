{"sha": "0f770b013e710f7225ddb1f75a0fb28bcf8ebf31", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGY3NzBiMDEzZTcxMGY3MjI1ZGRiMWY3NWEwZmIyOGJjZjhlYmYzMQ==", "commit": {"author": {"name": "Rasmus Villemoes", "email": "rv@rasmusvillemoes.dk", "date": "2015-05-01T18:25:12Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2015-05-01T18:25:12Z"}, "message": "match.pd: New simplification patterns.\n\n\t* match.pd: New simplification patterns.\n\t(x + (x & 1))  -> ((x + 1) & ~1)\n\t(x & ~(x & y)) -> ((x & ~y))\n\t(x | ~(x | y)) -> ((x | ~y))\n\n\t* gcc.dg/20150120-1.c: New test.\n\t* gcc.dg/20150120-2.c: New test.\n\t* gcc.dg/20150120-3.c: New test.\n\nFrom-SVN: r222697", "tree": {"sha": "0946db8391df7da6267cfcf0d058190705a74e1b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0946db8391df7da6267cfcf0d058190705a74e1b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0f770b013e710f7225ddb1f75a0fb28bcf8ebf31", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f770b013e710f7225ddb1f75a0fb28bcf8ebf31", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0f770b013e710f7225ddb1f75a0fb28bcf8ebf31", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f770b013e710f7225ddb1f75a0fb28bcf8ebf31/comments", "author": {"login": "Villemoes", "id": 4375908, "node_id": "MDQ6VXNlcjQzNzU5MDg=", "avatar_url": "https://avatars.githubusercontent.com/u/4375908?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Villemoes", "html_url": "https://github.com/Villemoes", "followers_url": "https://api.github.com/users/Villemoes/followers", "following_url": "https://api.github.com/users/Villemoes/following{/other_user}", "gists_url": "https://api.github.com/users/Villemoes/gists{/gist_id}", "starred_url": "https://api.github.com/users/Villemoes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Villemoes/subscriptions", "organizations_url": "https://api.github.com/users/Villemoes/orgs", "repos_url": "https://api.github.com/users/Villemoes/repos", "events_url": "https://api.github.com/users/Villemoes/events{/privacy}", "received_events_url": "https://api.github.com/users/Villemoes/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5524eb7ecc101ec843fe1f1c3200d20ff09da0d3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5524eb7ecc101ec843fe1f1c3200d20ff09da0d3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5524eb7ecc101ec843fe1f1c3200d20ff09da0d3"}], "stats": {"total": 142, "additions": 142, "deletions": 0}, "files": [{"sha": "e006b26fee90b15fe654d87a209dd09977d4f232", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f770b013e710f7225ddb1f75a0fb28bcf8ebf31/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f770b013e710f7225ddb1f75a0fb28bcf8ebf31/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0f770b013e710f7225ddb1f75a0fb28bcf8ebf31", "patch": "@@ -1,3 +1,10 @@\n+2015-05-01  Rasmus Villemoes  <rv@rasmusvillemoes.dk>\n+\n+\t* match.pd: New simplification patterns.\n+\t(x + (x & 1))  -> ((x + 1) & ~1)\n+\t(x & ~(x & y)) -> ((x & ~y))\n+\t(x | ~(x | y)) -> ((x | ~y))\n+\n 2015-05-01  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n \n \t* target.def (attribute_table): Mention that struct attribute_spec"}, {"sha": "87ecaf10140780243c58b90d0909d4b6c55799c9", "filename": "gcc/match.pd", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f770b013e710f7225ddb1f75a0fb28bcf8ebf31/gcc%2Fmatch.pd", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f770b013e710f7225ddb1f75a0fb28bcf8ebf31/gcc%2Fmatch.pd", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmatch.pd?ref=0f770b013e710f7225ddb1f75a0fb28bcf8ebf31", "patch": "@@ -255,6 +255,20 @@ along with GCC; see the file COPYING3.  If not see\n   (bitop @0 @0)\n   (non_lvalue @0)))\n \n+/* x + (x & 1) -> (x + 1) & ~1 */\n+(simplify\n+ (plus:c @0 (bit_and@2 @0 integer_onep@1))\n+ (if (TREE_CODE (@2) != SSA_NAME || has_single_use (@2))\n+  (bit_and (plus @0 @1) (bit_not @1))))\n+\n+/* x & ~(x & y) -> x & ~y */\n+/* x | ~(x | y) -> x | ~y  */\n+(for bitop (bit_and bit_ior)\n+  (simplify\n+    (bitop:c @0 (bit_not (bitop:c@2 @0 @1)))\n+      (if (TREE_CODE (@2) != SSA_NAME || has_single_use (@2))\n+\t(bitop @0 (bit_not @1)))))\n+\n (simplify\n  (abs (negate @0))\n  (abs @0))"}, {"sha": "2aedc46e74d52c35a801604bf04b0b61834586bc", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f770b013e710f7225ddb1f75a0fb28bcf8ebf31/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f770b013e710f7225ddb1f75a0fb28bcf8ebf31/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0f770b013e710f7225ddb1f75a0fb28bcf8ebf31", "patch": "@@ -1,3 +1,9 @@\n+2015-05-01  Rasmus Villemoes  <rv@rasmusvillemoes.dk>\n+\n+\t* gcc.dg/20150120-1.c: New test.\n+\t* gcc.dg/20150120-2.c: New test.\n+\t* gcc.dg/20150120-3.c: New test.\n+\n 2015-05-01  David Edelsohn  <dje.gcc@gmail.com>\n \n \t* gcc.dg/debug/pr65771.c: Add \"dg-add-options tls\"."}, {"sha": "18906c47a0974cc74d2bf56d0cdf786aef32aabc", "filename": "gcc/testsuite/gcc.dg/20150120-1.c", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f770b013e710f7225ddb1f75a0fb28bcf8ebf31/gcc%2Ftestsuite%2Fgcc.dg%2F20150120-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f770b013e710f7225ddb1f75a0fb28bcf8ebf31/gcc%2Ftestsuite%2Fgcc.dg%2F20150120-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2F20150120-1.c?ref=0f770b013e710f7225ddb1f75a0fb28bcf8ebf31", "patch": "@@ -0,0 +1,51 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-original\" } */\n+\n+/* x + (x & 1) -> (x + 1) & ~1 */\n+int\n+fn1 (int x)\n+{\n+\treturn x + (x & 1);\n+}\n+int\n+fn2 (int x)\n+{\n+\treturn (x & 1) + x;\n+}\n+int\n+fn3 (int x)\n+{\n+\treturn x + (1 & x);\n+}\n+int\n+fn4 (int x)\n+{\n+\treturn (1 & x) + x;\n+}\n+unsigned int\n+fn5 (unsigned int x)\n+{\n+\treturn x + (x & 1);\n+}\n+unsigned int\n+fn6 (unsigned int x)\n+{\n+\treturn (x & 1) + x;\n+}\n+unsigned int\n+fn7 (unsigned int x)\n+{\n+\treturn x + (x % 2);\n+}\n+unsigned int\n+fn8 (unsigned int x)\n+{\n+\treturn (x % 2) + x;\n+}\n+unsigned int\n+fn9 (unsigned int x)\n+{\n+\treturn (1LL & x) + x;\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"x \\\\+ 1\" 9 \"original\" } } */"}, {"sha": "976b6548e27bb4203a5ea317fe462570489749c9", "filename": "gcc/testsuite/gcc.dg/20150120-2.c", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f770b013e710f7225ddb1f75a0fb28bcf8ebf31/gcc%2Ftestsuite%2Fgcc.dg%2F20150120-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f770b013e710f7225ddb1f75a0fb28bcf8ebf31/gcc%2Ftestsuite%2Fgcc.dg%2F20150120-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2F20150120-2.c?ref=0f770b013e710f7225ddb1f75a0fb28bcf8ebf31", "patch": "@@ -0,0 +1,32 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-original\" } */\n+\n+/* x & ~(x & y) -> x & ~y */\n+int fn1 (int x, int y)\n+{\n+\treturn x & ~(x & y);\n+}\n+int fn2 (int x, int y)\n+{\n+\treturn ~(x & y) & x;\n+}\n+int fn3 (int x, int y)\n+{\n+\treturn x & ~(y & x);\n+}\n+int fn4 (int x, int y)\n+{\n+\treturn ~(y & x) & x;\n+}\n+int fn5 (int z)\n+{\n+\treturn z & ~(z & 3);\n+}\n+int fn6 (int z)\n+{\n+\treturn ~(z & 3) & z;\n+}\n+\n+\n+/* { dg-final { scan-tree-dump-times \"~y & x\" 4 \"original\" } } */\n+/* { dg-final { scan-tree-dump-times \"z & -4\" 2 \"original\" } } */"}, {"sha": "322556f4add1ca9c081d35ac9dae55b6ba0f3262", "filename": "gcc/testsuite/gcc.dg/20150120-3.c", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f770b013e710f7225ddb1f75a0fb28bcf8ebf31/gcc%2Ftestsuite%2Fgcc.dg%2F20150120-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f770b013e710f7225ddb1f75a0fb28bcf8ebf31/gcc%2Ftestsuite%2Fgcc.dg%2F20150120-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2F20150120-3.c?ref=0f770b013e710f7225ddb1f75a0fb28bcf8ebf31", "patch": "@@ -0,0 +1,32 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-original\" } */\n+\n+/* x | ~(x | y) -> x | ~y */\n+int fn1 (int x, int y)\n+{\n+\treturn x | ~(x | y);\n+}\n+int fn2 (int x, int y)\n+{\n+\treturn ~(x | y) | x;\n+}\n+int fn3 (int x, int y)\n+{\n+\treturn x | ~(y | x);\n+}\n+int fn4 (int x, int y)\n+{\n+\treturn ~(y | x) | x;\n+}\n+int fn5 (int z)\n+{\n+\treturn z | ~(z | 3);\n+}\n+int fn6 (int z)\n+{\n+\treturn ~(z | 3) | z;\n+}\n+\n+\n+/* { dg-final { scan-tree-dump-times \"~y \\\\| x\" 4 \"original\" } } */\n+/* { dg-final { scan-tree-dump-times \"z \\\\| -4\" 2 \"original\" } } */"}]}