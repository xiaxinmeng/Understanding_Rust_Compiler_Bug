{"sha": "4886ec8e709d547391d199bd88579d0f523f4e2d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDg4NmVjOGU3MDlkNTQ3MzkxZDE5OWJkODg1NzlkMGY1MjNmNGUyZA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2015-02-04T22:32:36Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2015-02-04T22:32:36Z"}, "message": "re PR middle-end/64824 (ICE in gimple verification)\n\n\tPR c/64824\n\tPR c/64868\ngcc/c/\n\t* c-parser.c (c_parser_omp_atomic): Handle RDIV_EXPR.\ngcc/cp/\n\t* parser.c (cp_parser_omp_atomic): Handle RDIV_EXPR.\ngcc/c-family/\n\t* c-omp.c (c_finish_omp_atomic): Use TRUNC_DIV_EXPR\n\tinstead of RDIV_EXPR.  Use build_binary_op instead of\n\tbuild2_loc.\nlibgomp/\n\t* testsuite/libgomp.c/pr64824.c: New test.\n\t* testsuite/libgomp.c/pr64868.c: New test.\n\t* testsuite/libgomp.c++/pr64824.C: New test.\n\t* testsuite/libgomp.c++/pr64868.C: New test.\n\nFrom-SVN: r220420", "tree": {"sha": "02931ee5cccee35af26dbaf8156acf44d9ec6fb5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/02931ee5cccee35af26dbaf8156acf44d9ec6fb5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4886ec8e709d547391d199bd88579d0f523f4e2d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4886ec8e709d547391d199bd88579d0f523f4e2d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4886ec8e709d547391d199bd88579d0f523f4e2d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4886ec8e709d547391d199bd88579d0f523f4e2d/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5a33f47d99d787af43fc8b27c29cea4e5c1432d8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5a33f47d99d787af43fc8b27c29cea4e5c1432d8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5a33f47d99d787af43fc8b27c29cea4e5c1432d8"}], "stats": {"total": 149, "additions": 148, "deletions": 1}, "files": [{"sha": "6e4553af9213d3b8c2cd90ec26505b8d4e77db52", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4886ec8e709d547391d199bd88579d0f523f4e2d/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4886ec8e709d547391d199bd88579d0f523f4e2d/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=4886ec8e709d547391d199bd88579d0f523f4e2d", "patch": "@@ -1,3 +1,11 @@\n+2015-02-04  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/64824\n+\tPR c/64868\n+\t* c-omp.c (c_finish_omp_atomic): Use TRUNC_DIV_EXPR\n+\tinstead of RDIV_EXPR.  Use build_binary_op instead of\n+\tbuild2_loc.\n+\n 2015-01-30  Joseph Myers  <joseph@codesourcery.com>\n \n \t* c-opts.c, c-pch.c, cppspec.c: All callers of fatal_error changed"}, {"sha": "86a9f54b80686a5f96ae0ae12c9c6c7c8f91898e", "filename": "gcc/c-family/c-omp.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4886ec8e709d547391d199bd88579d0f523f4e2d/gcc%2Fc-family%2Fc-omp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4886ec8e709d547391d199bd88579d0f523f4e2d/gcc%2Fc-family%2Fc-omp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-omp.c?ref=4886ec8e709d547391d199bd88579d0f523f4e2d", "patch": "@@ -206,6 +206,9 @@ c_finish_omp_atomic (location_t loc, enum tree_code code,\n       return error_mark_node;\n     }\n \n+  if (opcode == RDIV_EXPR)\n+    opcode = TRUNC_DIV_EXPR;\n+\n   /* ??? Validate that rhs does not overlap lhs.  */\n \n   /* Take and save the address of the lhs.  From then on we'll reference it\n@@ -240,7 +243,7 @@ c_finish_omp_atomic (location_t loc, enum tree_code code,\n      to do this, and then take it apart again.  */\n   if (swapped)\n     {\n-      rhs = build2_loc (loc, opcode, TREE_TYPE (lhs), rhs, lhs);\n+      rhs = build_binary_op (loc, opcode, rhs, lhs, 1);\n       opcode = NOP_EXPR;\n     }\n   bool save = in_late_binary_op;"}, {"sha": "4c822f4ca0988581ebc2dfc5c23f344b59c23a7d", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4886ec8e709d547391d199bd88579d0f523f4e2d/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4886ec8e709d547391d199bd88579d0f523f4e2d/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=4886ec8e709d547391d199bd88579d0f523f4e2d", "patch": "@@ -1,3 +1,9 @@\n+2015-02-04  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/64824\n+\tPR c/64868\n+\t* c-parser.c (c_parser_omp_atomic): Handle RDIV_EXPR.\n+\n 2015-02-02  Bruno Loff <bruno.loff@gmail.com>\n \n \t* c-parser.c (c_parser_declspecs): Call invoke_plugin_callbacks after"}, {"sha": "982ba6a894cf24d60ff9fa7ebc1571a7d4a7cab5", "filename": "gcc/c/c-parser.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4886ec8e709d547391d199bd88579d0f523f4e2d/gcc%2Fc%2Fc-parser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4886ec8e709d547391d199bd88579d0f523f4e2d/gcc%2Fc%2Fc-parser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-parser.c?ref=4886ec8e709d547391d199bd88579d0f523f4e2d", "patch": "@@ -12611,6 +12611,7 @@ c_parser_omp_atomic (location_t loc, c_parser *parser)\n \t    {\n \t    case MULT_EXPR:\n \t    case TRUNC_DIV_EXPR:\n+\t    case RDIV_EXPR:\n \t    case PLUS_EXPR:\n \t    case MINUS_EXPR:\n \t    case LSHIFT_EXPR:"}, {"sha": "3ab1d77a362a516c0e8cbbf8abf03c248cc371e2", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4886ec8e709d547391d199bd88579d0f523f4e2d/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4886ec8e709d547391d199bd88579d0f523f4e2d/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=4886ec8e709d547391d199bd88579d0f523f4e2d", "patch": "@@ -1,3 +1,9 @@\n+2015-02-04  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/64824\n+\tPR c/64868\n+\t* parser.c (cp_parser_omp_atomic): Handle RDIV_EXPR.\n+\n 2015-02-03  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/64877"}, {"sha": "57dfbcc41171196be8c55dbd984cd92010cc8f33", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4886ec8e709d547391d199bd88579d0f523f4e2d/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4886ec8e709d547391d199bd88579d0f523f4e2d/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=4886ec8e709d547391d199bd88579d0f523f4e2d", "patch": "@@ -29835,6 +29835,7 @@ cp_parser_omp_atomic (cp_parser *parser, cp_token *pragma_tok)\n \t\t{\n \t\tcase MULT_EXPR:\n \t\tcase TRUNC_DIV_EXPR:\n+\t\tcase RDIV_EXPR:\n \t\tcase PLUS_EXPR:\n \t\tcase MINUS_EXPR:\n \t\tcase LSHIFT_EXPR:"}, {"sha": "21b42d154e890893ac1ae4ebc24091d4f233fbd9", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4886ec8e709d547391d199bd88579d0f523f4e2d/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4886ec8e709d547391d199bd88579d0f523f4e2d/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=4886ec8e709d547391d199bd88579d0f523f4e2d", "patch": "@@ -1,3 +1,12 @@\n+2015-02-04  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/64824\n+\tPR c/64868\n+\t* testsuite/libgomp.c/pr64824.c: New test.\n+\t* testsuite/libgomp.c/pr64868.c: New test.\n+\t* testsuite/libgomp.c++/pr64824.C: New test.\n+\t* testsuite/libgomp.c++/pr64868.C: New test.\n+\n 2015-02-01  David Edelsohn  <dje.gcc@gmail.com>\n \n \tPR libgomp/64635"}, {"sha": "348f6d6e0c26bc102d7f3e27100dd763e31ac8c0", "filename": "libgomp/testsuite/libgomp.c++/pr64824.C", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4886ec8e709d547391d199bd88579d0f523f4e2d/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr64824.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4886ec8e709d547391d199bd88579d0f523f4e2d/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr64824.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr64824.C?ref=4886ec8e709d547391d199bd88579d0f523f4e2d", "patch": "@@ -0,0 +1,5 @@\n+// PR c/64824\n+// { dg-do run }\n+// { dg-options \"-O2 -fopenmp\" }\n+\n+#include \"../libgomp.c/pr64824.c\""}, {"sha": "2d730ac4924fd9a9f2ceca30097abfbb4330eea8", "filename": "libgomp/testsuite/libgomp.c++/pr64868.C", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4886ec8e709d547391d199bd88579d0f523f4e2d/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr64868.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4886ec8e709d547391d199bd88579d0f523f4e2d/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr64868.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr64868.C?ref=4886ec8e709d547391d199bd88579d0f523f4e2d", "patch": "@@ -0,0 +1,5 @@\n+// PR c/64868\n+// { dg-do run }\n+// { dg-options \"-O2 -fopenmp\" }\n+\n+#include \"../libgomp.c/pr64868.c\""}, {"sha": "544d0b0fc1ff1a15bd7e1a0801a4386d100dcbc6", "filename": "libgomp/testsuite/libgomp.c/pr64824.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4886ec8e709d547391d199bd88579d0f523f4e2d/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr64824.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4886ec8e709d547391d199bd88579d0f523f4e2d/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr64824.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr64824.c?ref=4886ec8e709d547391d199bd88579d0f523f4e2d", "patch": "@@ -0,0 +1,16 @@\n+/* PR c/64824 */\n+/* { dg-do run } */\n+/* { dg-options \"-O2 -fopenmp\" } */\n+\n+int\n+main ()\n+{\n+  long long a;\n+  long long b = 1LL;\n+  int c = 3;\n+#pragma omp atomic capture\n+  a = b = c << b;\n+  if (b != 6LL || a != 6LL)\n+    __builtin_abort ();\n+  return 0;\n+}"}, {"sha": "acdf99841087d2d5bcc3ddce42aed5a683db7fcb", "filename": "libgomp/testsuite/libgomp.c/pr64868.c", "status": "added", "additions": 87, "deletions": 0, "changes": 87, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4886ec8e709d547391d199bd88579d0f523f4e2d/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr64868.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4886ec8e709d547391d199bd88579d0f523f4e2d/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr64868.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr64868.c?ref=4886ec8e709d547391d199bd88579d0f523f4e2d", "patch": "@@ -0,0 +1,87 @@\n+/* PR c/64868 */\n+/* { dg-do run } */\n+/* { dg-options \"-O2 -fopenmp\" } */\n+\n+float f = 2.0f;\n+double d = 4.0;\n+long double ld = 8.0L;\n+\n+void\n+foo ()\n+{\n+#pragma omp atomic\n+  f = 1.0f / f;\n+#pragma omp atomic\n+  f = 1 / f;\n+#pragma omp atomic\n+  f = f / 2.0f;\n+#pragma omp atomic\n+  f = f / 2;\n+#pragma omp atomic\n+  f /= 2.0f;\n+#pragma omp atomic\n+  f /= 2;\n+#pragma omp atomic\n+  d = 1.0 / d;\n+#pragma omp atomic\n+  d = 1 / d;\n+#pragma omp atomic\n+  d = d / 2.0;\n+#pragma omp atomic\n+  d = d / 2;\n+#pragma omp atomic\n+  d /= 2.0;\n+#pragma omp atomic\n+  d /= 2;\n+#pragma omp atomic\n+  ld = 1.0L / ld;\n+#pragma omp atomic\n+  ld = 1 / ld;\n+#pragma omp atomic\n+  ld = ld / 2.0L;\n+#pragma omp atomic\n+  ld = ld / 2;\n+#pragma omp atomic\n+  ld /= 2.0L;\n+#pragma omp atomic\n+  ld /= 2;\n+  if (f != 0.125f || d != 0.25 || ld != 0.5L)\n+    __builtin_abort ();\n+}\n+\n+#ifdef __cplusplus\n+template <typename T, int N1, int N2>\n+void\n+bar ()\n+{\n+  T v = ::d;\n+#pragma omp atomic\n+  v *= 16;\n+#pragma omp atomic\n+  v = 1.0 / v;\n+#pragma omp atomic\n+  v = N1 / v;\n+#pragma omp atomic\n+  v = v / 2.0;\n+#pragma omp atomic\n+  v = v / N2;\n+#pragma omp atomic\n+  v /= 2.0;\n+#pragma omp atomic\n+  v /= N2;\n+  if (v != 0.25)\n+    __builtin_abort ();\n+}\n+#endif\n+\n+int\n+main ()\n+{\n+  foo ();\n+#ifdef __cplusplus\n+  bar<float, 1, 2> ();\n+  bar<double, 1, 2> ();\n+  bar<long double, 1, 2> ();\n+#endif\n+  return 0;\n+}"}]}