{"sha": "7bcbf2d83269394899f27695e19715dca8f098bf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2JjYmYyZDgzMjY5Mzk0ODk5ZjI3Njk1ZTE5NzE1ZGNhOGYwOThiZg==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2018-07-31T14:23:44Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2018-07-31T14:23:44Z"}, "message": "[23/46] Make LOOP_VINFO_MAY_MISALIGN_STMTS use stmt_vec_info\n\nThis patch changes LOOP_VINFO_MAY_MISALIGN_STMTS from an\nauto_vec<gimple *> to an auto_vec<stmt_vec_info>.\n\n2018-07-31  Richard Sandiford  <richard.sandiford@arm.com>\n\ngcc/\n\t* tree-vectorizer.h (_loop_vec_info::may_misalign_stmts): Change\n\tfrom an auto_vec<gimple *> to an auto_vec<stmt_vec_info>.\n\t* tree-vect-data-refs.c (vect_enhance_data_refs_alignment): Update\n\taccordingly.\n\t* tree-vect-loop-manip.c (vect_create_cond_for_align_checks): Likewise.\n\nFrom-SVN: r263138", "tree": {"sha": "417803f296d5d01432224749ec34c1a99d20b6d4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/417803f296d5d01432224749ec34c1a99d20b6d4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7bcbf2d83269394899f27695e19715dca8f098bf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7bcbf2d83269394899f27695e19715dca8f098bf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7bcbf2d83269394899f27695e19715dca8f098bf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7bcbf2d83269394899f27695e19715dca8f098bf/comments", "author": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c26228d41bcbb1a8027570cbef7a2c00ed75f2d6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c26228d41bcbb1a8027570cbef7a2c00ed75f2d6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c26228d41bcbb1a8027570cbef7a2c00ed75f2d6"}], "stats": {"total": 30, "additions": 18, "deletions": 12}, "files": [{"sha": "dde2596749d438a2441435238ab81fd153126801", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7bcbf2d83269394899f27695e19715dca8f098bf/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7bcbf2d83269394899f27695e19715dca8f098bf/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7bcbf2d83269394899f27695e19715dca8f098bf", "patch": "@@ -1,3 +1,11 @@\n+2018-07-31  Richard Sandiford  <richard.sandiford@arm.com>\n+\n+\t* tree-vectorizer.h (_loop_vec_info::may_misalign_stmts): Change\n+\tfrom an auto_vec<gimple *> to an auto_vec<stmt_vec_info>.\n+\t* tree-vect-data-refs.c (vect_enhance_data_refs_alignment): Update\n+\taccordingly.\n+\t* tree-vect-loop-manip.c (vect_create_cond_for_align_checks): Likewise.\n+\n 2018-07-31  Richard Sandiford  <richard.sandiford@arm.com>\n \n \t* tree-vectorizer.h (_stmt_vec_info::same_dr_stmt): Change from"}, {"sha": "e1d644c67f0a51b37c56b7b4f8d0f305b1d3b70e", "filename": "gcc/tree-vect-data-refs.c", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7bcbf2d83269394899f27695e19715dca8f098bf/gcc%2Ftree-vect-data-refs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7bcbf2d83269394899f27695e19715dca8f098bf/gcc%2Ftree-vect-data-refs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-data-refs.c?ref=7bcbf2d83269394899f27695e19715dca8f098bf", "patch": "@@ -2231,16 +2231,15 @@ vect_enhance_data_refs_alignment (loop_vec_info loop_vinfo)\n \n   if (do_versioning)\n     {\n-      vec<gimple *> may_misalign_stmts\n+      vec<stmt_vec_info> may_misalign_stmts\n         = LOOP_VINFO_MAY_MISALIGN_STMTS (loop_vinfo);\n-      gimple *stmt;\n+      stmt_vec_info stmt_info;\n \n       /* It can now be assumed that the data references in the statements\n          in LOOP_VINFO_MAY_MISALIGN_STMTS will be aligned in the version\n          of the loop being vectorized.  */\n-      FOR_EACH_VEC_ELT (may_misalign_stmts, i, stmt)\n+      FOR_EACH_VEC_ELT (may_misalign_stmts, i, stmt_info)\n         {\n-          stmt_vec_info stmt_info = vinfo_for_stmt (stmt);\n           dr = STMT_VINFO_DATA_REF (stmt_info);\n \t  SET_DR_MISALIGNMENT (dr, 0);\n \t  if (dump_enabled_p ())"}, {"sha": "83ddff2d12d908fabd1f5f7928d0194dbdf6ffaf", "filename": "gcc/tree-vect-loop-manip.c", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7bcbf2d83269394899f27695e19715dca8f098bf/gcc%2Ftree-vect-loop-manip.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7bcbf2d83269394899f27695e19715dca8f098bf/gcc%2Ftree-vect-loop-manip.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop-manip.c?ref=7bcbf2d83269394899f27695e19715dca8f098bf", "patch": "@@ -2772,9 +2772,9 @@ vect_create_cond_for_align_checks (loop_vec_info loop_vinfo,\n                                    tree *cond_expr,\n \t\t\t\t   gimple_seq *cond_expr_stmt_list)\n {\n-  vec<gimple *> may_misalign_stmts\n+  vec<stmt_vec_info> may_misalign_stmts\n     = LOOP_VINFO_MAY_MISALIGN_STMTS (loop_vinfo);\n-  gimple *ref_stmt;\n+  stmt_vec_info stmt_info;\n   int mask = LOOP_VINFO_PTR_MASK (loop_vinfo);\n   tree mask_cst;\n   unsigned int i;\n@@ -2795,23 +2795,22 @@ vect_create_cond_for_align_checks (loop_vec_info loop_vinfo,\n   /* Create expression (mask & (dr_1 || ... || dr_n)) where dr_i is the address\n      of the first vector of the i'th data reference. */\n \n-  FOR_EACH_VEC_ELT (may_misalign_stmts, i, ref_stmt)\n+  FOR_EACH_VEC_ELT (may_misalign_stmts, i, stmt_info)\n     {\n       gimple_seq new_stmt_list = NULL;\n       tree addr_base;\n       tree addr_tmp_name;\n       tree new_or_tmp_name;\n       gimple *addr_stmt, *or_stmt;\n-      stmt_vec_info stmt_vinfo = vinfo_for_stmt (ref_stmt);\n-      tree vectype = STMT_VINFO_VECTYPE (stmt_vinfo);\n+      tree vectype = STMT_VINFO_VECTYPE (stmt_info);\n       bool negative = tree_int_cst_compare\n-\t(DR_STEP (STMT_VINFO_DATA_REF (stmt_vinfo)), size_zero_node) < 0;\n+\t(DR_STEP (STMT_VINFO_DATA_REF (stmt_info)), size_zero_node) < 0;\n       tree offset = negative\n \t? size_int (-TYPE_VECTOR_SUBPARTS (vectype) + 1) : size_zero_node;\n \n       /* create: addr_tmp = (int)(address_of_first_vector) */\n       addr_base =\n-\tvect_create_addr_base_for_vector_ref (ref_stmt, &new_stmt_list,\n+\tvect_create_addr_base_for_vector_ref (stmt_info, &new_stmt_list,\n \t\t\t\t\t      offset);\n       if (new_stmt_list != NULL)\n \tgimple_seq_add_seq (cond_expr_stmt_list, new_stmt_list);"}, {"sha": "ff3b4c641b9ce453493c11a099513d0c2a7caa42", "filename": "gcc/tree-vectorizer.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7bcbf2d83269394899f27695e19715dca8f098bf/gcc%2Ftree-vectorizer.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7bcbf2d83269394899f27695e19715dca8f098bf/gcc%2Ftree-vectorizer.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vectorizer.h?ref=7bcbf2d83269394899f27695e19715dca8f098bf", "patch": "@@ -472,7 +472,7 @@ typedef struct _loop_vec_info : public vec_info {\n \n   /* Statements in the loop that have data references that are candidates for a\n      runtime (loop versioning) misalignment check.  */\n-  auto_vec<gimple *> may_misalign_stmts;\n+  auto_vec<stmt_vec_info> may_misalign_stmts;\n \n   /* Reduction cycles detected in the loop. Used in loop-aware SLP.  */\n   auto_vec<stmt_vec_info> reductions;"}]}