{"sha": "1a55127d2253848d525bb62ff95bd70fc65a5d2f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWE1NTEyN2QyMjUzODQ4ZDUyNWJiNjJmZjk1YmQ3MGZjNjVhNWQyZg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2002-10-15T22:03:53Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2002-10-15T22:03:53Z"}, "message": "call.c (call_builtin_trap): New fn.\n\n        * call.c (call_builtin_trap): New fn.\n        (convert_arg_to_ellipsis): Use it.  Downgrade error to warning.\n        (build_call): Don't set current_function_returns_abnormally outside\n        a function.\n\nFrom-SVN: r58180", "tree": {"sha": "dfafa4d339e98f37653c6a692f593667acd86132", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dfafa4d339e98f37653c6a692f593667acd86132"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1a55127d2253848d525bb62ff95bd70fc65a5d2f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a55127d2253848d525bb62ff95bd70fc65a5d2f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1a55127d2253848d525bb62ff95bd70fc65a5d2f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a55127d2253848d525bb62ff95bd70fc65a5d2f/comments", "author": null, "committer": null, "parents": [{"sha": "74f6d07186e73e97aa4779ec7c996fef36a8011b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/74f6d07186e73e97aa4779ec7c996fef36a8011b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/74f6d07186e73e97aa4779ec7c996fef36a8011b"}], "stats": {"total": 35, "additions": 30, "deletions": 5}, "files": [{"sha": "211f275e586e5e5b8ef9d41f52ac5f5fd9add343", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a55127d2253848d525bb62ff95bd70fc65a5d2f/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a55127d2253848d525bb62ff95bd70fc65a5d2f/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=1a55127d2253848d525bb62ff95bd70fc65a5d2f", "patch": "@@ -1,3 +1,10 @@\n+2002-10-15  Jason Merrill  <jason@redhat.com>\n+\n+\t* call.c (call_builtin_trap): New fn.\n+\t(convert_arg_to_ellipsis): Use it.  Downgrade error to warning.\n+\t(build_call): Don't set current_function_returns_abnormally outside\n+\ta function.\n+\n 2002-10-14  Mark Mitchell  <mark@codesourcery.com>\n \n \t* class.c (check_field_decls): Remove empty_p parameter.  Instead,\n@@ -2651,7 +2658,7 @@\n \t* pt.c (convert_template_argument): Adjust make_typename_type\n \treturn value.\n \t(tsubst): Adjust cp_build_qualified_type_real calls.\n-\t(check_cv_quals_for_unify): Cope with alowing bad qualifications\n+\t(check_cv_quals_for_unify): Cope with allowing bad qualifications\n \ton template type parms.\n \t(instantiate_decl): Recheck substitutions to give warnings on bad\n \tqualifications."}, {"sha": "1b79ac48250ba512ab70ddf6178735a981f1dc06", "filename": "gcc/cp/call.c", "status": "modified", "additions": 22, "deletions": 4, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a55127d2253848d525bb62ff95bd70fc65a5d2f/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a55127d2253848d525bb62ff95bd70fc65a5d2f/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=1a55127d2253848d525bb62ff95bd70fc65a5d2f", "patch": "@@ -101,6 +101,7 @@ static tree convert_class_to_reference PARAMS ((tree, tree, tree));\n static tree direct_reference_binding PARAMS ((tree, tree));\n static int promoted_arithmetic_type_p PARAMS ((tree));\n static tree conditional_conversion PARAMS ((tree, tree));\n+static tree call_builtin_trap PARAMS ((void));\n \n tree\n build_vfield_ref (datum, type)\n@@ -380,7 +381,7 @@ build_call (function, parms)\n   nothrow = ((decl && TREE_NOTHROW (decl))\n \t     || TYPE_NOTHROW_P (TREE_TYPE (TREE_TYPE (function))));\n \n-  if (decl && TREE_THIS_VOLATILE (decl))\n+  if (decl && TREE_THIS_VOLATILE (decl) && cfun)\n     current_function_returns_abnormally = 1;\n \n   if (decl && TREE_DEPRECATED (decl))\n@@ -4097,6 +4098,22 @@ convert_like_real (convs, expr, fn, argnum, inner)\n \t\t      LOOKUP_NORMAL|LOOKUP_NO_CONVERSION);\n }\n \n+/* Build a call to __builtin_trap which can be used in an expression.  */\n+\n+static tree\n+call_builtin_trap ()\n+{\n+  tree fn = get_identifier (\"__builtin_trap\");\n+  if (IDENTIFIER_GLOBAL_VALUE (fn))\n+    fn = IDENTIFIER_GLOBAL_VALUE (fn);\n+  else\n+    abort ();\n+\n+  fn = build_call (fn, NULL_TREE);\n+  fn = build (COMPOUND_EXPR, integer_type_node, fn, integer_zero_node);\n+  return fn;\n+}\n+\n /* ARG is being passed to a varargs function.  Perform any conversions\n    required.  Array/function to pointer decay must have already happened.\n    Return the converted value.  */\n@@ -4121,9 +4138,10 @@ convert_arg_to_ellipsis (arg)\n       /* Undefined behavior [expr.call] 5.2.2/7.  We used to just warn\n \t here and do a bitwise copy, but now cp_expr_size will abort if we\n \t try to do that.  */\n-      error (\"cannot pass objects of non-POD type `%#T' through `...'\",\n-\t     TREE_TYPE (arg));\n-      arg = error_mark_node;\n+      warning (\"cannot pass objects of non-POD type `%#T' through `...'; \\\n+call will abort at runtime\",\n+\t       TREE_TYPE (arg));\n+      arg = call_builtin_trap ();\n     }\n \n   return arg;"}]}