{"sha": "9cbf8673106e24e33f2ab2ed9a054c3a759d84e1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWNiZjg2NzMxMDZlMjRlMzNmMmFiMmVkOWEwNTRjM2E3NTlkODRlMQ==", "commit": {"author": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2016-11-13T09:56:10Z"}, "committer": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2016-11-13T09:56:10Z"}, "message": "re PR fortran/66366 ([OOP] ICE on invalid with non-allocatable CLASS variable)\n\n2016-11-13  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/66366\n\t* resolve.c (resolve_component): Move check for C437\n\tto ...\n\t* decl.c (build_struct): ... here. Fix indentation.\n\n2016-11-13  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/66366\n\t* gfortran.dg/class_57.f90: Changed error message.\n\t* gfortran.dg/class_60.f90: New test.\n\nFrom-SVN: r242351", "tree": {"sha": "64c45c010d747e598543fbee00fee803369db4e8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/64c45c010d747e598543fbee00fee803369db4e8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9cbf8673106e24e33f2ab2ed9a054c3a759d84e1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9cbf8673106e24e33f2ab2ed9a054c3a759d84e1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9cbf8673106e24e33f2ab2ed9a054c3a759d84e1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9cbf8673106e24e33f2ab2ed9a054c3a759d84e1/comments", "author": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "559f2bbc362f311ab424232e72bb4f9f601b54eb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/559f2bbc362f311ab424232e72bb4f9f601b54eb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/559f2bbc362f311ab424232e72bb4f9f601b54eb"}], "stats": {"total": 74, "additions": 58, "deletions": 16}, "files": [{"sha": "a9db062b4abc91c6b7d21bae244d30db7d03456b", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cbf8673106e24e33f2ab2ed9a054c3a759d84e1/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cbf8673106e24e33f2ab2ed9a054c3a759d84e1/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=9cbf8673106e24e33f2ab2ed9a054c3a759d84e1", "patch": "@@ -1,3 +1,10 @@\n+2016-11-13  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/66366\n+\t* resolve.c (resolve_component): Move check for C437\n+\tto ...\n+\t* decl.c (build_struct): ... here. Fix indentation.\n+\n 2016-11-12  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/77501"}, {"sha": "4f5c0cfa4ac4c1cbb36b956a6d55fbd79159c116", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cbf8673106e24e33f2ab2ed9a054c3a759d84e1/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cbf8673106e24e33f2ab2ed9a054c3a759d84e1/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=9cbf8673106e24e33f2ab2ed9a054c3a759d84e1", "patch": "@@ -1866,9 +1866,18 @@ build_struct (const char *name, gfc_charlen *cl, gfc_expr **init,\n \t}\n       else if (current_attr.allocatable == 0)\n \t{\n-      gfc_error (\"Component at %C must have the POINTER attribute\");\n-      return false;\n+\t  gfc_error (\"Component at %C must have the POINTER attribute\");\n+\t  return false;\n+\t}\n     }\n+\n+  /* F03:C437.  */\n+  if (current_ts.type == BT_CLASS\n+      && !(current_attr.pointer || current_attr.allocatable))\n+    {\n+      gfc_error (\"Component %qs with CLASS at %C must be allocatable \"\n+                 \"or pointer\", name);\n+      return false;\n     }\n \n   if (gfc_current_block ()->attr.pointer && (*as)->rank != 0)"}, {"sha": "c85525aabb9e557cc03367c3566257514819a797", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 0, "deletions": 13, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cbf8673106e24e33f2ab2ed9a054c3a759d84e1/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cbf8673106e24e33f2ab2ed9a054c3a759d84e1/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=9cbf8673106e24e33f2ab2ed9a054c3a759d84e1", "patch": "@@ -13587,19 +13587,6 @@ resolve_component (gfc_component *c, gfc_symbol *sym)\n       return false;\n     }\n \n-  /* C437.  */\n-  if (c->ts.type == BT_CLASS && c->attr.flavor != FL_PROCEDURE\n-      && (!c->attr.class_ok\n-          || !(CLASS_DATA (c)->attr.class_pointer\n-               || CLASS_DATA (c)->attr.allocatable)))\n-    {\n-      gfc_error (\"Component %qs with CLASS at %L must be allocatable \"\n-                 \"or pointer\", c->name, &c->loc);\n-      /* Prevent a recurrence of the error.  */\n-      c->ts.type = BT_UNKNOWN;\n-      return false;\n-    }\n-\n   /* If an allocatable component derived type is of the same type as\n      the enclosing derived type, we need a vtable generating so that\n      the __deallocate procedure is created.  */"}, {"sha": "65fbaad34f9d8e1ce197497c3cf9f67125f22114", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cbf8673106e24e33f2ab2ed9a054c3a759d84e1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cbf8673106e24e33f2ab2ed9a054c3a759d84e1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9cbf8673106e24e33f2ab2ed9a054c3a759d84e1", "patch": "@@ -1,3 +1,9 @@\n+2016-11-13  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/66366\n+\t* gfortran.dg/class_57.f90: Changed error message.\n+\t* gfortran.dg/class_60.f90: New test.\n+\n 2016-11-12  David Edelsohn  <dje.gcc@gmail.com>\n \n \t* g++.dg/pr78112.C: XFAIL AIX."}, {"sha": "8104338672bee65638876db28fdbf3c12b3f1eed", "filename": "gcc/testsuite/gfortran.dg/class_57.f90", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cbf8673106e24e33f2ab2ed9a054c3a759d84e1/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_57.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cbf8673106e24e33f2ab2ed9a054c3a759d84e1/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_57.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_57.f90?ref=9cbf8673106e24e33f2ab2ed9a054c3a759d84e1", "patch": "@@ -18,7 +18,7 @@\n   function pc(pd)\n     type(p) :: pc\n     class(d), intent(in), target :: pd\n-    pc%cc => pd   ! { dg-error \"Non-POINTER in pointer association context\" }\n+    pc%cc => pd   ! { dg-error \"is not a member of\" }\n   end function\n \n end"}, {"sha": "f51c48349c331e5cb49d9da78f2e9f24ddfdb7da", "filename": "gcc/testsuite/gfortran.dg/class_60.f90", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cbf8673106e24e33f2ab2ed9a054c3a759d84e1/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_60.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cbf8673106e24e33f2ab2ed9a054c3a759d84e1/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_60.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_60.f90?ref=9cbf8673106e24e33f2ab2ed9a054c3a759d84e1", "patch": "@@ -0,0 +1,33 @@\n+! { dg-do compile }\n+!\n+! PR 66366: [OOP] ICE on invalid with non-allocatable CLASS variable\n+!\n+! Contributed by Andrew Benson <abensonca@gmail.com>\n+\n+module bug\n+\n+  type :: t1d\n+   contains\n+     procedure :: interpolate => interp\n+  end type t1d\n+\n+  type :: tff\n+     class(t1d) :: transfer  ! { dg-error \"must be allocatable or pointer\" }\n+  end type tff\n+\n+contains\n+\n+  double precision function interp(self)\n+    implicit none\n+    class(t1d), intent(inout) :: self\n+    return\n+  end function interp\n+\n+  double precision function fvb(self)\n+    implicit none\n+    class(tff), intent(inout) :: self\n+    fvb=self%transfer%interpolate()  ! { dg-error \"is not a member of\" }\n+    return\n+  end function fvb\n+\n+end module bug"}]}