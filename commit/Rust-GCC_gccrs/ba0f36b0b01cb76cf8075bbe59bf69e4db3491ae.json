{"sha": "ba0f36b0b01cb76cf8075bbe59bf69e4db3491ae", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmEwZjM2YjBiMDFjYjc2Y2Y4MDc1YmJlNTliZjY5ZTRkYjM0OTFhZQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2013-11-03T23:49:41Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2013-11-03T23:49:41Z"}, "message": "re PR c++/38313 (g++ fails to parse a member function with a parenthesized type name as its declarator)\n\n/cp\n2013-11-03  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/38313\n\t* parser.c (cp_parser_constructor_declarator_p): Check that the\n\tclass-name matches current_class_type.\n\n/testsuite\n2013-11-03  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/38313\n\t* g++.dg/lookup/name-clash10.C: New.\n\nFrom-SVN: r204339", "tree": {"sha": "cc49b2ba73fa9a84b152cae39da937223caf8d41", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cc49b2ba73fa9a84b152cae39da937223caf8d41"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ba0f36b0b01cb76cf8075bbe59bf69e4db3491ae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba0f36b0b01cb76cf8075bbe59bf69e4db3491ae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ba0f36b0b01cb76cf8075bbe59bf69e4db3491ae", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba0f36b0b01cb76cf8075bbe59bf69e4db3491ae/comments", "author": null, "committer": null, "parents": [{"sha": "8df183493151d64d036fe8ab6fa6813072342daa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8df183493151d64d036fe8ab6fa6813072342daa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8df183493151d64d036fe8ab6fa6813072342daa"}], "stats": {"total": 41, "additions": 36, "deletions": 5}, "files": [{"sha": "acdf4b5da11c40fdd116345790fd60e940ac5659", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba0f36b0b01cb76cf8075bbe59bf69e4db3491ae/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba0f36b0b01cb76cf8075bbe59bf69e4db3491ae/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=ba0f36b0b01cb76cf8075bbe59bf69e4db3491ae", "patch": "@@ -1,3 +1,9 @@\n+2013-11-03  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/38313\n+\t* parser.c (cp_parser_constructor_declarator_p): Check that the\n+\tclass-name matches current_class_type.\n+\n 2013-11-03  Marek Polacek  <polacek@redhat.com>\n \n \t* decl.c (cp_finish_decl): Move C++1y bounds checking..."}, {"sha": "3df746a3683fbe799d9c54b950eef874eb3c008b", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 17, "deletions": 5, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba0f36b0b01cb76cf8075bbe59bf69e4db3491ae/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba0f36b0b01cb76cf8075bbe59bf69e4db3491ae/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=ba0f36b0b01cb76cf8075bbe59bf69e4db3491ae", "patch": "@@ -22211,6 +22211,7 @@ static bool\n cp_parser_constructor_declarator_p (cp_parser *parser, bool friend_p)\n {\n   bool constructor_p;\n+  bool outside_class_specifier_p;\n   tree nested_name_specifier;\n   cp_token *next_token;\n \n@@ -22243,11 +22244,14 @@ cp_parser_constructor_declarator_p (cp_parser *parser, bool friend_p)\n \t\t\t\t\t    /*check_dependency_p=*/false,\n \t\t\t\t\t    /*type_p=*/false,\n \t\t\t\t\t    /*is_declaration=*/false));\n+\n+  outside_class_specifier_p = (!at_class_scope_p ()\n+\t\t\t       || !TYPE_BEING_DEFINED (current_class_type)\n+\t\t\t       || friend_p);\n+\n   /* Outside of a class-specifier, there must be a\n      nested-name-specifier.  */\n-  if (!nested_name_specifier &&\n-      (!at_class_scope_p () || !TYPE_BEING_DEFINED (current_class_type)\n-       || friend_p))\n+  if (!nested_name_specifier && outside_class_specifier_p)\n     constructor_p = false;\n   else if (nested_name_specifier == error_mark_node)\n     constructor_p = false;\n@@ -22286,8 +22290,16 @@ cp_parser_constructor_declarator_p (cp_parser *parser, bool friend_p)\n \t\t\t\t\t/*check_dependency_p=*/false,\n \t\t\t\t\t/*class_head_p=*/false,\n \t\t\t\t\t/*is_declaration=*/false);\n-      /* If there was no class-name, then this is not a constructor.  */\n-      constructor_p = !cp_parser_error_occurred (parser);\n+      /* If there was no class-name, then this is not a constructor.\n+\t Otherwise, if we are in a class-specifier and we aren't\n+\t handling a friend declaration, check that its type matches\n+\t current_class_type (c++/38313).  Note: error_mark_node\n+\t is left alone for error recovery purposes.  */\n+      constructor_p = (!cp_parser_error_occurred (parser)\n+\t\t       && (outside_class_specifier_p\n+\t\t\t   || type_decl == error_mark_node\n+\t\t\t   || same_type_p (current_class_type,\n+\t\t\t\t\t   TREE_TYPE (type_decl))));\n \n       /* If we're still considering a constructor, we have to see a `(',\n \t to begin the parameter-declaration-clause, followed by either a"}, {"sha": "09dc34363e3110f6e1f10d077a4f1017b68d5524", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba0f36b0b01cb76cf8075bbe59bf69e4db3491ae/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba0f36b0b01cb76cf8075bbe59bf69e4db3491ae/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ba0f36b0b01cb76cf8075bbe59bf69e4db3491ae", "patch": "@@ -1,3 +1,8 @@\n+2013-11-03  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/38313\n+\t* g++.dg/lookup/name-clash10.C: New.\n+\n 2013-11-03  Kugan Vivekanandarajah  <kuganv@linaro.org>\n \n \t* gcc.target/arm/neon-vcond-gt.c: Scan for vbsl or vbit or vbif."}, {"sha": "0a089be257a80acc34a090030213aa520518cb78", "filename": "gcc/testsuite/g++.dg/lookup/name-clash10.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba0f36b0b01cb76cf8075bbe59bf69e4db3491ae/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fname-clash10.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba0f36b0b01cb76cf8075bbe59bf69e4db3491ae/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fname-clash10.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fname-clash10.C?ref=ba0f36b0b01cb76cf8075bbe59bf69e4db3491ae", "patch": "@@ -0,0 +1,8 @@\n+// PR c++/38313\n+\n+struct foo { };\n+struct bar { };\n+\n+struct baz {\n+  static foo (bar)();\n+};"}]}