{"sha": "d2f64e95fdb0bc89b327325f2b7eeada03547499", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDJmNjRlOTVmZGIwYmM4OWIzMjczMjVmMmI3ZWVhZGEwMzU0NzQ5OQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "pcarlini@suse.de", "date": "2005-01-30T14:09:58Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2005-01-30T14:09:58Z"}, "message": "re PR libstdc++/19642 (streaming doubles is very slow compared to sprintf)\n\n2005-01-30  Paolo Carlini  <pcarlini@suse.de>\n\n\tPR libstdc++/19642\n\t* config/locale/generic/c_locale.h (__convert_from_v): Switch only\n\tLC_NUMERIC, and only when actually != \"C\".\n\nFrom-SVN: r94440", "tree": {"sha": "030a889c42d5ac40150378b761b53643c4c014c0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/030a889c42d5ac40150378b761b53643c4c014c0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d2f64e95fdb0bc89b327325f2b7eeada03547499", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2f64e95fdb0bc89b327325f2b7eeada03547499", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d2f64e95fdb0bc89b327325f2b7eeada03547499", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2f64e95fdb0bc89b327325f2b7eeada03547499/comments", "author": null, "committer": null, "parents": [{"sha": "23e044cc1dc30da08dd53bddd70ca66cbb4ca6c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23e044cc1dc30da08dd53bddd70ca66cbb4ca6c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/23e044cc1dc30da08dd53bddd70ca66cbb4ca6c4"}], "stats": {"total": 26, "additions": 20, "deletions": 6}, "files": [{"sha": "63349ec958705de1d0f8b9a6c432cfb9ccbd0a81", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2f64e95fdb0bc89b327325f2b7eeada03547499/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2f64e95fdb0bc89b327325f2b7eeada03547499/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=d2f64e95fdb0bc89b327325f2b7eeada03547499", "patch": "@@ -1,3 +1,9 @@\n+2005-01-30  Paolo Carlini  <pcarlini@suse.de>\n+\n+\tPR libstdc++/19642\n+\t* config/locale/generic/c_locale.h (__convert_from_v): Switch only\n+\tLC_NUMERIC, and only when actually != \"C\".\n+\n 2005-01-28  Paolo Carlini  <pcarlini@suse.de>\n \n \t* include/tr1/type_traits (is_function): Minor consistency tweaks."}, {"sha": "7b2282b04f658774bf4643bd179bd7215db3862d", "filename": "libstdc++-v3/config/locale/generic/c_locale.h", "status": "modified", "additions": 14, "deletions": 6, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2f64e95fdb0bc89b327325f2b7eeada03547499/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgeneric%2Fc_locale.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2f64e95fdb0bc89b327325f2b7eeada03547499/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgeneric%2Fc_locale.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgeneric%2Fc_locale.h?ref=d2f64e95fdb0bc89b327325f2b7eeada03547499", "patch": "@@ -59,18 +59,26 @@ namespace std\n \t\t     const char* __fmt,\n \t\t     _Tv __v, const __c_locale&, int __prec)\n     {\n-      char* __old = std::setlocale(LC_ALL, NULL);\n-      char* __sav = new char[std::strlen(__old) + 1];\n-      std::strcpy(__sav, __old);\n-      std::setlocale(LC_ALL, \"C\");\n+      char* __old = std::setlocale(LC_NUMERIC, NULL);\n+      char* __sav = NULL;\n+      if (std::strcmp(__old, \"C\"))\n+\t{\n+\t  __sav = new char[std::strlen(__old) + 1];\n+\t  std::strcpy(__sav, __old);\n+\t  std::setlocale(LC_NUMERIC, \"C\");\n+\t}\n \n #ifdef _GLIBCXX_USE_C99\n       const int __ret = std::snprintf(__out, __size, __fmt, __prec, __v);\n #else\n       const int __ret = std::sprintf(__out, __fmt, __prec, __v);\n #endif\n-      std::setlocale(LC_ALL, __sav);\n-      delete [] __sav;\n+      \n+      if (__sav)\n+\t{\n+\t  std::setlocale(LC_NUMERIC, __sav);\n+\t  delete [] __sav;\n+\t}\n       return __ret;\n     }\n }"}]}