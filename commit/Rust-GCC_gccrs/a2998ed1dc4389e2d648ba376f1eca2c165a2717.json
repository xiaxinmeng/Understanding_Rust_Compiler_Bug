{"sha": "a2998ed1dc4389e2d648ba376f1eca2c165a2717", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTI5OThlZDFkYzQzODllMmQ2NDhiYTM3NmYxZWNhMmMxNjVhMjcxNw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-11-22T09:57:28Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-11-22T09:57:28Z"}, "message": "re PR middle-end/82875 (ICE at -Os on valid code on x86_64-linux-gnu: in find_widening_optab_handler_and_mode, at optabs-query.c:414)\n\n\tPR middle-end/82875\n\t* optabs.c (expand_doubleword_mult, expand_binop): Before calling\n\texpand_binop with *mul_widen_optab, make sure at least one of the\n\toperands doesn't have VOIDmode.\n\n\t* gcc.dg/pr82875.c: New test.\n\t* gcc.c-torture/compile/pr82875.c: New test.\n\nFrom-SVN: r255050", "tree": {"sha": "e74efc9fd718473642ee90a0a64c09bac23f4832", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e74efc9fd718473642ee90a0a64c09bac23f4832"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a2998ed1dc4389e2d648ba376f1eca2c165a2717", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2998ed1dc4389e2d648ba376f1eca2c165a2717", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a2998ed1dc4389e2d648ba376f1eca2c165a2717", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2998ed1dc4389e2d648ba376f1eca2c165a2717/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0a770b5907cdb70709356fbbfe5c570010b0b936", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0a770b5907cdb70709356fbbfe5c570010b0b936", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0a770b5907cdb70709356fbbfe5c570010b0b936"}], "stats": {"total": 55, "additions": 55, "deletions": 0}, "files": [{"sha": "ace7c7c0ce75e17453285c49cd193103e3fc56e1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2998ed1dc4389e2d648ba376f1eca2c165a2717/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2998ed1dc4389e2d648ba376f1eca2c165a2717/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a2998ed1dc4389e2d648ba376f1eca2c165a2717", "patch": "@@ -1,5 +1,10 @@\n 2017-11-22  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR middle-end/82875\n+\t* optabs.c (expand_doubleword_mult, expand_binop): Before calling\n+\texpand_binop with *mul_widen_optab, make sure at least one of the\n+\toperands doesn't have VOIDmode.\n+\n \tPR debug/83034\n \t* dwarf2out.c (mem_loc_descriptor): Handle VEC_SERIES.\n "}, {"sha": "518ce7a972cfaa7593d44252856cf422afc6fa1f", "filename": "gcc/optabs.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2998ed1dc4389e2d648ba376f1eca2c165a2717/gcc%2Foptabs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2998ed1dc4389e2d648ba376f1eca2c165a2717/gcc%2Foptabs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Foptabs.c?ref=a2998ed1dc4389e2d648ba376f1eca2c165a2717", "patch": "@@ -861,6 +861,11 @@ expand_doubleword_mult (machine_mode mode, rtx op0, rtx op1, rtx target,\n   if (target && !REG_P (target))\n     target = NULL_RTX;\n \n+  /* *_widen_optab needs to determine operand mode, make sure at least\n+     one operand has non-VOID mode.  */\n+  if (GET_MODE (op0_low) == VOIDmode && GET_MODE (op1_low) == VOIDmode)\n+    op0_low = force_reg (word_mode, op0_low);\n+\n   if (umulp)\n     product = expand_binop (mode, umul_widen_optab, op0_low, op1_low,\n \t\t\t    target, 1, OPTAB_DIRECT);\n@@ -1199,6 +1204,10 @@ expand_binop (machine_mode mode, optab binoptab, rtx op0, rtx op1,\n \t\t\t\t  : smul_widen_optab),\n \t\t\t\t wider_mode, mode) != CODE_FOR_nothing))\n     {\n+      /* *_widen_optab needs to determine operand mode, make sure at least\n+\t one operand has non-VOID mode.  */\n+      if (GET_MODE (op0) == VOIDmode && GET_MODE (op1) == VOIDmode)\n+\top0 = force_reg (mode, op0);\n       temp = expand_binop (wider_mode,\n \t\t\t   unsignedp ? umul_widen_optab : smul_widen_optab,\n \t\t\t   op0, op1, NULL_RTX, unsignedp, OPTAB_DIRECT);"}, {"sha": "b7e0c470c4c765a0938b0b5a2343c8fe4cdddf63", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2998ed1dc4389e2d648ba376f1eca2c165a2717/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2998ed1dc4389e2d648ba376f1eca2c165a2717/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a2998ed1dc4389e2d648ba376f1eca2c165a2717", "patch": "@@ -1,3 +1,9 @@\n+2017-11-22  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/82875\n+\t* gcc.dg/pr82875.c: New test.\n+\t* gcc.c-torture/compile/pr82875.c: New test.\n+\n 2017-11-22  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR debug/83034"}, {"sha": "4360ebcfe78f048e9757d7b82ee1748834d9898c", "filename": "gcc/testsuite/gcc.c-torture/compile/pr82875.c", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2998ed1dc4389e2d648ba376f1eca2c165a2717/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr82875.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2998ed1dc4389e2d648ba376f1eca2c165a2717/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr82875.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr82875.c?ref=a2998ed1dc4389e2d648ba376f1eca2c165a2717", "patch": "@@ -0,0 +1,24 @@\n+/* PR middle-end/82875 */\n+\n+signed char a;\n+unsigned b;\n+long c, d;\n+long long e;\n+\n+void\n+foo (void)\n+{\n+  short f = a = 6;\n+  while (0)\n+    while (a <= 7)\n+      {\n+\tfor (;;)\n+\t  ;\n+\tlab:\n+\t  while (c <= 73)\n+\t    ;\n+\te = 20;\n+\td ? (a %= c) * (e *= a ? f : b) : 0;\n+      }\n+  goto lab;\n+}"}, {"sha": "5b97b80da2611a4fc1a6162348cbbc56e6f28bef", "filename": "gcc/testsuite/gcc.dg/pr82875.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2998ed1dc4389e2d648ba376f1eca2c165a2717/gcc%2Ftestsuite%2Fgcc.dg%2Fpr82875.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2998ed1dc4389e2d648ba376f1eca2c165a2717/gcc%2Ftestsuite%2Fgcc.dg%2Fpr82875.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr82875.c?ref=a2998ed1dc4389e2d648ba376f1eca2c165a2717", "patch": "@@ -0,0 +1,11 @@\n+/* PR middle-end/82875 */\n+/* { dg-do compile } */\n+/* { dg-options \"-ftree-ter\" } */\n+\n+const int a = 100;\n+\n+void\n+foo (void)\n+{\n+  int c[a];\n+}"}]}