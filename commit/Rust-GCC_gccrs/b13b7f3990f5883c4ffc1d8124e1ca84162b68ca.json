{"sha": "b13b7f3990f5883c4ffc1d8124e1ca84162b68ca", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjEzYjdmMzk5MGY1ODgzYzRmZmMxZDgxMjRlMWNhODQxNjJiNjhjYQ==", "commit": {"author": {"name": "David Daney", "email": "ddaney@caviumnetworks.com", "date": "2009-08-04T17:25:42Z"}, "committer": {"name": "David Daney", "email": "daney@gcc.gnu.org", "date": "2009-08-04T17:25:42Z"}, "message": "mutex.h (gomp_mutex_unlock): Add comment about needed memory barrier semantics.\n\n2009-08-04  David Daney  <ddaney@caviumnetworks.com>\n\n\t* config/linux/mutex.h (gomp_mutex_unlock): Add comment about\n\tneeded memory barrier semantics.\n\t* config/linux/mips/mutex.h: New file.\n\nFrom-SVN: r150463", "tree": {"sha": "94cb32888cf3eca2bd09013d270556e12da16441", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/94cb32888cf3eca2bd09013d270556e12da16441"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b13b7f3990f5883c4ffc1d8124e1ca84162b68ca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b13b7f3990f5883c4ffc1d8124e1ca84162b68ca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b13b7f3990f5883c4ffc1d8124e1ca84162b68ca", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b13b7f3990f5883c4ffc1d8124e1ca84162b68ca/comments", "author": null, "committer": null, "parents": [{"sha": "481817e4b9403845d7dad473bc4d134057265189", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/481817e4b9403845d7dad473bc4d134057265189", "html_url": "https://github.com/Rust-GCC/gccrs/commit/481817e4b9403845d7dad473bc4d134057265189"}], "stats": {"total": 43, "additions": 43, "deletions": 0}, "files": [{"sha": "6b9592bda7319ceee3963e3e5f3202d2ca4897b9", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b13b7f3990f5883c4ffc1d8124e1ca84162b68ca/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b13b7f3990f5883c4ffc1d8124e1ca84162b68ca/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=b13b7f3990f5883c4ffc1d8124e1ca84162b68ca", "patch": "@@ -1,3 +1,9 @@\n+2009-08-04  David Daney  <ddaney@caviumnetworks.com>\n+\n+\t* config/linux/mutex.h (gomp_mutex_unlock): Add comment about\n+\tneeded memory barrier semantics.\n+\t* config/linux/mips/mutex.h: New file.\n+\n 2009-07-30  Ralf Wildenhues  <Ralf.Wildenhues@gmx.de>\n \n \t* configure.ac (_AC_ARG_VAR_PRECIOUS): Use m4_rename_force."}, {"sha": "668cc11b29a95a876e0220ac251193120e4b30c4", "filename": "libgomp/config/linux/mips/mutex.h", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b13b7f3990f5883c4ffc1d8124e1ca84162b68ca/libgomp%2Fconfig%2Flinux%2Fmips%2Fmutex.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b13b7f3990f5883c4ffc1d8124e1ca84162b68ca/libgomp%2Fconfig%2Flinux%2Fmips%2Fmutex.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fconfig%2Flinux%2Fmips%2Fmutex.h?ref=b13b7f3990f5883c4ffc1d8124e1ca84162b68ca", "patch": "@@ -0,0 +1,27 @@\n+/* Copyright (C) 2009 Free Software Foundation, Inc.\n+\n+   This file is part of the GNU OpenMP Library (libgomp).\n+\n+   Libgomp is free software; you can redistribute it and/or modify it\n+   under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3, or (at your option)\n+   any later version.\n+\n+   Libgomp is distributed in the hope that it will be useful, but WITHOUT ANY\n+   WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS\n+   FOR A PARTICULAR PURPOSE.  See the GNU General Public License for\n+   more details.\n+\n+   Under Section 7 of GPL version 3, you are granted additional\n+   permissions described in the GCC Runtime Library Exception, version\n+   3.1, as published by the Free Software Foundation.\n+\n+   You should have received a copy of the GNU General Public License and\n+   a copy of the GCC Runtime Library Exception along with this program;\n+   see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n+   <http://www.gnu.org/licenses/>.  */\n+\n+/* MIPS needs the same correct usage of __sync_synchronize and\n+   __sync_lock_test_and_set as ia64.  So we just use its mutex.h.  */\n+\n+#include \"config/linux/ia64/mutex.h\""}, {"sha": "1905ce012fde79b8b57ccc5a338be8f2b895eebf", "filename": "libgomp/config/linux/mutex.h", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b13b7f3990f5883c4ffc1d8124e1ca84162b68ca/libgomp%2Fconfig%2Flinux%2Fmutex.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b13b7f3990f5883c4ffc1d8124e1ca84162b68ca/libgomp%2Fconfig%2Flinux%2Fmutex.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fconfig%2Flinux%2Fmutex.h?ref=b13b7f3990f5883c4ffc1d8124e1ca84162b68ca", "patch": "@@ -48,6 +48,16 @@ static inline void gomp_mutex_lock (gomp_mutex_t *mutex)\n extern void gomp_mutex_unlock_slow (gomp_mutex_t *mutex);\n static inline void gomp_mutex_unlock (gomp_mutex_t *mutex)\n {\n+  /* Warning: By definition __sync_lock_test_and_set() does not have\n+     proper memory barrier semantics for a mutex unlock operation.\n+     However, this default implementation is written assuming that it\n+     does, which is true for some targets.\n+\n+     Targets that require additional memory barriers before\n+     __sync_lock_test_and_set to achieve the release semantics of\n+     mutex unlock, are encouraged to include\n+     \"config/linux/ia64/mutex.h\" in a target specific mutex.h instead\n+     of using this file.  */\n   int val = __sync_lock_test_and_set (mutex, 0);\n   if (__builtin_expect (val > 1, 0))\n     gomp_mutex_unlock_slow (mutex);"}]}