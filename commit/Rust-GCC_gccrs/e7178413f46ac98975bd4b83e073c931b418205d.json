{"sha": "e7178413f46ac98975bd4b83e073c931b418205d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTcxNzg0MTNmNDZhYzk4OTc1YmQ0YjgzZTA3M2M5MzFiNDE4MjA1ZA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2019-04-19T08:24:05Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-04-19T08:24:05Z"}, "message": "re PR c++/90108 (ICE: Segmentation fault (in c_tree_chain_next))\n\n\tPR c++/90108\n\t* c-decl.c (merge_decls): If remove is main variant and\n\tDECL_ORIGINAL_TYPE is some other type, remove a DECL_ORIGINAL_TYPE\n\tvariant that has newdecl as TYPE_NAME if any.\n\n\t* decl.c (duplicate_decls): If remove is main variant and\n\tDECL_ORIGINAL_TYPE is some other type, remove a DECL_ORIGINAL_TYPE\n\tvariant that has newdecl as TYPE_NAME if any.\n\n\t* c-c++-common/pr90108.c: New test.\n\nFrom-SVN: r270453", "tree": {"sha": "f491d635b20c7ce83f8fe69a7cfcd1479503d80e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f491d635b20c7ce83f8fe69a7cfcd1479503d80e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e7178413f46ac98975bd4b83e073c931b418205d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e7178413f46ac98975bd4b83e073c931b418205d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e7178413f46ac98975bd4b83e073c931b418205d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e7178413f46ac98975bd4b83e073c931b418205d/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1ad6b2105127d761df87840f77a4fde06f1dbf9e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ad6b2105127d761df87840f77a4fde06f1dbf9e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ad6b2105127d761df87840f77a4fde06f1dbf9e"}], "stats": {"total": 63, "additions": 61, "deletions": 2}, "files": [{"sha": "27660b98e7dd6007a2dcd9e924c241c9c3abf71d", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e7178413f46ac98975bd4b83e073c931b418205d/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e7178413f46ac98975bd4b83e073c931b418205d/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=e7178413f46ac98975bd4b83e073c931b418205d", "patch": "@@ -1,3 +1,10 @@\n+2019-04-19  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/90108\n+\t* c-decl.c (merge_decls): If remove is main variant and\n+\tDECL_ORIGINAL_TYPE is some other type, remove a DECL_ORIGINAL_TYPE\n+\tvariant that has newdecl as TYPE_NAME if any.\n+\n 2019-04-12  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c/89933"}, {"sha": "c8e7cd01d9ec1abe5c6255ea2f41b282b474e0f0", "filename": "gcc/c/c-decl.c", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e7178413f46ac98975bd4b83e073c931b418205d/gcc%2Fc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e7178413f46ac98975bd4b83e073c931b418205d/gcc%2Fc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-decl.c?ref=e7178413f46ac98975bd4b83e073c931b418205d", "patch": "@@ -2513,7 +2513,24 @@ merge_decls (tree newdecl, tree olddecl, tree newtype, tree oldtype)\n \t{\n \t  tree remove = TREE_TYPE (newdecl);\n \t  if (TYPE_MAIN_VARIANT (remove) == remove)\n-\t    gcc_assert (TYPE_NEXT_VARIANT (remove) == NULL_TREE);\n+\t    {\n+\t      gcc_assert (TYPE_NEXT_VARIANT (remove) == NULL_TREE);\n+\t      /* If remove is the main variant, no need to remove that\n+\t\t from the list.  One of the DECL_ORIGINAL_TYPE\n+\t\t variants, e.g. created for aligned attribute, might still\n+\t\t refer to the newdecl TYPE_DECL though, so remove that one\n+\t\t in that case.  */\n+\t      if (DECL_ORIGINAL_TYPE (newdecl)\n+\t\t  && DECL_ORIGINAL_TYPE (newdecl) != remove)\n+\t\tfor (tree t = TYPE_MAIN_VARIANT (DECL_ORIGINAL_TYPE (newdecl));\n+\t\t     t; t = TYPE_MAIN_VARIANT (t))\n+\t\t  if (TYPE_NAME (TYPE_NEXT_VARIANT (t)) == newdecl)\n+\t\t    {\n+\t\t      TYPE_NEXT_VARIANT (t)\n+\t\t\t= TYPE_NEXT_VARIANT (TYPE_NEXT_VARIANT (t));\n+\t\t      break;\n+\t\t    }\n+\t    }\t    \n \t  else\n \t    for (tree t = TYPE_MAIN_VARIANT (remove); ;\n \t\t t = TYPE_NEXT_VARIANT (t))"}, {"sha": "9c1c49bda28da6e0b91c9ab048be5166539ab8a9", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e7178413f46ac98975bd4b83e073c931b418205d/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e7178413f46ac98975bd4b83e073c931b418205d/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=e7178413f46ac98975bd4b83e073c931b418205d", "patch": "@@ -1,3 +1,10 @@\n+2019-04-19  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/90108\n+\t* decl.c (duplicate_decls): If remove is main variant and\n+\tDECL_ORIGINAL_TYPE is some other type, remove a DECL_ORIGINAL_TYPE\n+\tvariant that has newdecl as TYPE_NAME if any.\n+\n 2019-04-18  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/87554 - ICE with extern template and reference member."}, {"sha": "21b4cc6b83ca9e925f8f778120e6bafb4f960e79", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e7178413f46ac98975bd4b83e073c931b418205d/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e7178413f46ac98975bd4b83e073c931b418205d/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=e7178413f46ac98975bd4b83e073c931b418205d", "patch": "@@ -2133,7 +2133,24 @@ next_arg:;\n \t    {\n \t      tree remove = TREE_TYPE (newdecl);\n \t      if (TYPE_MAIN_VARIANT (remove) == remove)\n-\t\tgcc_assert (TYPE_NEXT_VARIANT (remove) == NULL_TREE);\n+\t\t{\n+\t\t  gcc_assert (TYPE_NEXT_VARIANT (remove) == NULL_TREE);\n+\t\t  /* If remove is the main variant, no need to remove that\n+\t\t     from the list.  One of the DECL_ORIGINAL_TYPE\n+\t\t     variants, e.g. created for aligned attribute, might still\n+\t\t     refer to the newdecl TYPE_DECL though, so remove that one\n+\t\t     in that case.  */\n+\t\t  if (tree orig = DECL_ORIGINAL_TYPE (newdecl))\n+\t\t    if (orig != remove)\n+\t\t      for (tree t = TYPE_MAIN_VARIANT (orig); t;\n+\t\t\t   t = TYPE_MAIN_VARIANT (t))\n+\t\t\tif (TYPE_NAME (TYPE_NEXT_VARIANT (t)) == newdecl)\n+\t\t\t  {\n+\t\t\t    TYPE_NEXT_VARIANT (t)\n+\t\t\t      = TYPE_NEXT_VARIANT (TYPE_NEXT_VARIANT (t));\n+\t\t\t    break;\n+\t\t\t  }\n+\t\t}\t    \n \t      else\n \t\tfor (tree t = TYPE_MAIN_VARIANT (remove); ;\n \t\t     t = TYPE_NEXT_VARIANT (t))"}, {"sha": "15e1d14038c7c125848aa96115018bb4fda43eb3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e7178413f46ac98975bd4b83e073c931b418205d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e7178413f46ac98975bd4b83e073c931b418205d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e7178413f46ac98975bd4b83e073c931b418205d", "patch": "@@ -1,3 +1,8 @@\n+2019-04-19  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/90108\n+\t* c-c++-common/pr90108.c: New test.\n+\n 2019-04-18  Richard Sandiford  <richard.sandiford@arm.com>\n \n \tPR middle-end/85164"}, {"sha": "fa5b8461aaeadaf0b78ac42608f169396e91e37a", "filename": "gcc/testsuite/c-c++-common/pr90108.c", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e7178413f46ac98975bd4b83e073c931b418205d/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr90108.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e7178413f46ac98975bd4b83e073c931b418205d/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr90108.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr90108.c?ref=e7178413f46ac98975bd4b83e073c931b418205d", "patch": "@@ -0,0 +1,6 @@\n+/* PR c++/90108 */\n+/* { dg-do compile } */\n+/* { dg-options \"--param ggc-min-heapsize=0\" } */\n+\n+typedef unsigned int a __attribute__ ((__aligned__(8), __may_alias__));\n+typedef unsigned int a __attribute__ ((__aligned__(8), __may_alias__));"}]}