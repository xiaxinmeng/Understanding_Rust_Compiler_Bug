{"sha": "b6ad3c0844bd20dece60aa20ccd3a196d34290d9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjZhZDNjMDg0NGJkMjBkZWNlNjBhYTIwY2NkM2ExOTZkMzQyOTBkOQ==", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2019-08-20T09:48:02Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-08-20T09:48:02Z"}, "message": "[Ada] Revert change for gnatprove that is no longer needed\n\nYears ago, we adapted Get_Kind_Of_Unit so that gnatprove could use it to\ndetect both bodies and specs of predefined units.\n\nHowever, this wasn't really needed: gnatprove could simply reuse\nLib.In_Predefined_Unit and now it does. This patch simply reverts two\ncommits mentioned above.\n\nNo frontend test provided, because the removed comment is clear that this\ndoesn't affect the compiler. Other tools similarly should not be affected\n(at least they were not when this change was introduced in 2012).\n\n2019-08-20  Piotr Trojanek  <trojanek@adacore.com>\n\ngcc/ada/\n\n\t* impunit.adb (Get_Kind_Of_Unit): Revert change for adapting\n\tthis routine for gnatprove.\n\nFrom-SVN: r274718", "tree": {"sha": "048a29a3845164ff05b83eee1463d63b74048858", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/048a29a3845164ff05b83eee1463d63b74048858"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b6ad3c0844bd20dece60aa20ccd3a196d34290d9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6ad3c0844bd20dece60aa20ccd3a196d34290d9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b6ad3c0844bd20dece60aa20ccd3a196d34290d9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6ad3c0844bd20dece60aa20ccd3a196d34290d9/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2beee64ae080305808720f839b6ca7bc280aed74", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2beee64ae080305808720f839b6ca7bc280aed74", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2beee64ae080305808720f839b6ca7bc280aed74"}], "stats": {"total": 22, "additions": 9, "deletions": 13}, "files": [{"sha": "b1640e2619c6dc0306c21a532609166b18714c6e", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6ad3c0844bd20dece60aa20ccd3a196d34290d9/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6ad3c0844bd20dece60aa20ccd3a196d34290d9/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=b6ad3c0844bd20dece60aa20ccd3a196d34290d9", "patch": "@@ -1,3 +1,8 @@\n+2019-08-20  Piotr Trojanek  <trojanek@adacore.com>\n+\n+\t* impunit.adb (Get_Kind_Of_Unit): Revert change for adapting\n+\tthis routine for gnatprove.\n+\n 2019-08-20  Arnaud Charlet  <charlet@adacore.com>\n \n \t* doc/gnat_rm/implementation_defined_pragmas.rst: Document"}, {"sha": "7e67569d5db0ce5ddf85dda26864f06fe7202a03", "filename": "gcc/ada/impunit.adb", "status": "modified", "additions": 4, "deletions": 13, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6ad3c0844bd20dece60aa20ccd3a196d34290d9/gcc%2Fada%2Fimpunit.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6ad3c0844bd20dece60aa20ccd3a196d34290d9/gcc%2Fada%2Fimpunit.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fimpunit.adb?ref=b6ad3c0844bd20dece60aa20ccd3a196d34290d9", "patch": "@@ -692,19 +692,10 @@ package body Impunit is\n          return Not_Predefined_Unit;\n       end if;\n \n-      --  To be considered predefined, the file name must end in .ads or .adb.\n-      --  File names with other extensions (coming from the use of non-standard\n-      --  file naming schemes) can never be predefined.\n-\n-      --  Note that in the context of a compiler, the .adb case will never\n-      --  arise. However it can arise for other tools, e.g. gnatprove uses\n-      --  this routine to detect when a construct comes from an instance of\n-      --  a generic defined in a predefined unit.\n-\n-      if File (File'Last - 3 .. File'Last) /= \".ads\"\n-           and then\n-         File (File'Last - 3 .. File'Last) /= \".adb\"\n-      then\n+      --  Not predefined if file name does not end in .ads. This can happen\n+      --  when non-standard file names are being used.\n+\n+      if Name_Buffer (Name_Len - 3 .. Name_Len) /= \".ads\" then\n          return Not_Predefined_Unit;\n       end if;\n "}]}