{"sha": "13c1cd82670b0be75bf99ba5bd23a7c34460fe65", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTNjMWNkODI2NzBiMGJlNzViZjk5YmE1YmQyM2E3YzM0NDYwZmU2NQ==", "commit": {"author": {"name": "Paul Brook", "email": "paul@codesourcery.com", "date": "2004-05-14T12:53:11Z"}, "committer": {"name": "Paul Brook", "email": "pbrook@gcc.gnu.org", "date": "2004-05-14T12:53:11Z"}, "message": "stor-layout.c (update_alignment_for_field): Use targetm.align_anon_bitfield.\n\n\t* stor-layout.c (update_alignment_for_field): Use\n\ttargetm.align_anon_bitfield.\n\t* target-def.h (TARGET_ALIGN_ANON_BITFIELD): Define.\n\t(TARGET_INITIALIZER): Use it.\n\t* target.h (struct gcc_target): Add align_anon_bitfield.\n\t* config/arm/arm.c (arm_align_anon_bitfield):  New function.\n\t(TARGET_ALIGN_ANON_BITFIELD): Define.\n\t* doc/tm.texi: Document TARGET_ALIGN_ANON_BITFIELD.\n\nFrom-SVN: r81838", "tree": {"sha": "a01af50a8b0a254e0fc7b796f434623f5557811b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a01af50a8b0a254e0fc7b796f434623f5557811b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/13c1cd82670b0be75bf99ba5bd23a7c34460fe65", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/13c1cd82670b0be75bf99ba5bd23a7c34460fe65", "html_url": "https://github.com/Rust-GCC/gccrs/commit/13c1cd82670b0be75bf99ba5bd23a7c34460fe65", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/13c1cd82670b0be75bf99ba5bd23a7c34460fe65/comments", "author": null, "committer": null, "parents": [{"sha": "ce8fc97bdf64cb3abbe042de3d9030b0c22b74dc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce8fc97bdf64cb3abbe042de3d9030b0c22b74dc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ce8fc97bdf64cb3abbe042de3d9030b0c22b74dc"}], "stats": {"total": 42, "additions": 40, "deletions": 2}, "files": [{"sha": "968a23f9336b021a5efd6a56f4d8236324744d5d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/13c1cd82670b0be75bf99ba5bd23a7c34460fe65/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/13c1cd82670b0be75bf99ba5bd23a7c34460fe65/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=13c1cd82670b0be75bf99ba5bd23a7c34460fe65", "patch": "@@ -1,3 +1,14 @@\n+2004-05-14  Paul Brook  <paul@codesourcery.com>\n+\n+\t* stor-layout.c (update_alignment_for_field): Use\n+\ttargetm.align_anon_bitfield.\n+\t* target-def.h (TARGET_ALIGN_ANON_BITFIELD): Define.\n+\t(TARGET_INITIALIZER): Use it.\n+\t* target.h (struct gcc_target): Add align_anon_bitfield.\n+\t* config/arm/arm.c (arm_align_anon_bitfield):  New function.\n+\t(TARGET_ALIGN_ANON_BITFIELD): Define.\n+\t* doc/tm.texi: Document TARGET_ALIGN_ANON_BITFIELD.\n+\n 2004-05-13  Zack Weinberg  <zack@codesourcery.com>\n \n \t* tree.def (documentation): Remove mention of class 'b'."}, {"sha": "acbdb77f15b12e950919ac91cfe08821fe707b13", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/13c1cd82670b0be75bf99ba5bd23a7c34460fe65/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/13c1cd82670b0be75bf99ba5bd23a7c34460fe65/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=13c1cd82670b0be75bf99ba5bd23a7c34460fe65", "patch": "@@ -160,6 +160,7 @@ static void arm_setup_incoming_varargs (CUMULATIVE_ARGS *, enum machine_mode,\n \t\t\t\t\ttree, int *, int);\n static bool arm_promote_prototypes (tree);\n static bool arm_default_short_enums (void);\n+static bool arm_align_anon_bitfield (void);\n \n \f\n /* Initialize the GCC target structure.  */\n@@ -260,6 +261,9 @@ static bool arm_default_short_enums (void);\n #undef TARGET_DEFAULT_SHORT_ENUMS\n #define TARGET_DEFAULT_SHORT_ENUMS arm_default_short_enums\n \n+#undef TARGET_ALIGN_ANON_BITFIELD\n+#define TARGET_ALIGN_ANON_BITFIELD arm_align_anon_bitfield\n+\n struct gcc_target targetm = TARGET_INITIALIZER;\n \f\n /* Obstack for minipool constant handling.  */\n@@ -14565,3 +14569,12 @@ arm_default_short_enums (void)\n {\n   return TARGET_AAPCS_BASED;\n }\n+\n+\n+/* AAPCS requires that anonymous bitfields affect structure alignment.  */\n+\n+static bool\n+arm_align_anon_bitfield (void)\n+{\n+  return TARGET_AAPCS_BASED;\n+}"}, {"sha": "a0f855d904ee6c4fb0ce5659ec039df5e53eae26", "filename": "gcc/doc/tm.texi", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/13c1cd82670b0be75bf99ba5bd23a7c34460fe65/gcc%2Fdoc%2Ftm.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/13c1cd82670b0be75bf99ba5bd23a7c34460fe65/gcc%2Fdoc%2Ftm.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Ftm.texi?ref=13c1cd82670b0be75bf99ba5bd23a7c34460fe65", "patch": "@@ -1301,6 +1301,13 @@ Like @code{PCC_BITFIELD_TYPE_MATTERS} except that its effect is limited\n to aligning a bit-field within the structure.\n @end defmac\n \n+@deftypefn {Target Hook} bool TARGET_ALIGN_ANON_BITFIELDS (void)\n+When @code{PCC_BITFIELD_TYPE_MATTERS} is true this hook will determine\n+whether unnamed bitfields affect the alignment of the containing\n+structure.  The hook should return true if the structure should inherit\n+the alignment requirements of an unnamed bitfield's type.\n+@end deftypefn\n+\n @defmac MEMBER_TYPE_FORCES_BLK (@var{field}, @var{mode})\n Return 1 if a structure or array containing @var{field} should be accessed using\n @code{BLKMODE}."}, {"sha": "5c87a638376e08041f2af7eba9faeefce31fbe3a", "filename": "gcc/stor-layout.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/13c1cd82670b0be75bf99ba5bd23a7c34460fe65/gcc%2Fstor-layout.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/13c1cd82670b0be75bf99ba5bd23a7c34460fe65/gcc%2Fstor-layout.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fstor-layout.c?ref=13c1cd82670b0be75bf99ba5bd23a7c34460fe65", "patch": "@@ -771,8 +771,10 @@ update_alignment_for_field (record_layout_info rli, tree field,\n   else if (is_bitfield && PCC_BITFIELD_TYPE_MATTERS)\n     {\n       /* Named bit-fields cause the entire structure to have the\n-\t alignment implied by their type.  */\n-      if (DECL_NAME (field) != 0)\n+\t alignment implied by their type.  Some targets also apply the same\n+\t rules to unnamed bitfields.  */\n+      if (DECL_NAME (field) != 0\n+\t  || targetm.align_anon_bitfield ())\n \t{\n \t  unsigned int type_align = TYPE_ALIGN (type);\n "}, {"sha": "f8c832a251e44addea8cda6b7a8c27b485780883", "filename": "gcc/target-def.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/13c1cd82670b0be75bf99ba5bd23a7c34460fe65/gcc%2Ftarget-def.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/13c1cd82670b0be75bf99ba5bd23a7c34460fe65/gcc%2Ftarget-def.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftarget-def.h?ref=13c1cd82670b0be75bf99ba5bd23a7c34460fe65", "patch": "@@ -310,6 +310,7 @@ Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.\n #define TARGET_INSERT_ATTRIBUTES hook_void_tree_treeptr\n #define TARGET_FUNCTION_ATTRIBUTE_INLINABLE_P hook_bool_tree_false\n #define TARGET_MS_BITFIELD_LAYOUT_P hook_bool_tree_false\n+#define TARGET_ALIGN_ANON_BITFIELD hook_bool_void_false\n #define TARGET_RTX_COSTS hook_bool_rtx_int_int_intp_false\n #define TARGET_MANGLE_FUNDAMENTAL_TYPE hook_constcharptr_tree_null\n \n@@ -384,6 +385,7 @@ Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.\n   TARGET_INSERT_ATTRIBUTES,\t\t\t\\\n   TARGET_FUNCTION_ATTRIBUTE_INLINABLE_P,\t\\\n   TARGET_MS_BITFIELD_LAYOUT_P,\t\t\t\\\n+  TARGET_ALIGN_ANON_BITFIELD,\t\t\t\\\n   TARGET_INIT_BUILTINS,\t\t\t\t\\\n   TARGET_EXPAND_BUILTIN,\t\t\t\\\n   TARGET_MANGLE_FUNDAMENTAL_TYPE,\t\t\\"}, {"sha": "6e288104559a4d526d91450e3d85b3b92904a7e4", "filename": "gcc/target.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/13c1cd82670b0be75bf99ba5bd23a7c34460fe65/gcc%2Ftarget.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/13c1cd82670b0be75bf99ba5bd23a7c34460fe65/gcc%2Ftarget.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftarget.h?ref=13c1cd82670b0be75bf99ba5bd23a7c34460fe65", "patch": "@@ -307,6 +307,9 @@ struct gcc_target\n      Microsoft Visual C++ bitfield layout rules.  */\n   bool (* ms_bitfield_layout_p) (tree record_type);\n \n+  /* Return true if anonymous bitfields affect structure alignment.  */\n+  bool (* align_anon_bitfield) (void);\n+\n   /* Set up target-specific built-in functions.  */\n   void (* init_builtins) (void);\n "}]}