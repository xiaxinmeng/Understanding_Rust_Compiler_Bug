{"sha": "a7f52181a6a16bb6d216ff41d9c6a9da95c19b5c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTdmNTIxODFhNmExNmJiNmQyMTZmZjQxZDljNmE5ZGE5NWMxOWI1Yw==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-01-29T15:02:36Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-01-29T16:32:19Z"}, "message": "rtl-optimization/98863 - tame i386 specific RPAD pass\n\nThis removes analyzing DF with expensive problems which we do not\nuse at all and which somehow cause 5GB of memory to leak.  Instead\njust do a defered rescan of added insns.\n\n2021-01-29  Richard Biener  <rguenther@suse.de>\n\n\tPR rtl-optimization/98863\n\t* config/i386/i386-features.c (remove_partial_avx_dependency):\n\tDo not perform DF analysis.\n\t(pass_data_remove_partial_avx_dependency): Remove\n\tTODO_df_finish.", "tree": {"sha": "8ca44e73410eec86e31b6e22d4d0329528684120", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8ca44e73410eec86e31b6e22d4d0329528684120"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a7f52181a6a16bb6d216ff41d9c6a9da95c19b5c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7f52181a6a16bb6d216ff41d9c6a9da95c19b5c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a7f52181a6a16bb6d216ff41d9c6a9da95c19b5c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7f52181a6a16bb6d216ff41d9c6a9da95c19b5c/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ee4c4fe289e768d3c6b6651c8bfa3fdf458934f4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee4c4fe289e768d3c6b6651c8bfa3fdf458934f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ee4c4fe289e768d3c6b6651c8bfa3fdf458934f4"}], "stats": {"total": 17, "additions": 7, "deletions": 10}, "files": [{"sha": "c845ba90cafcf194c8cebf2588ac6da95c413835", "filename": "gcc/config/i386/i386-features.c", "status": "modified", "additions": 7, "deletions": 10, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7f52181a6a16bb6d216ff41d9c6a9da95c19b5c/gcc%2Fconfig%2Fi386%2Fi386-features.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7f52181a6a16bb6d216ff41d9c6a9da95c19b5c/gcc%2Fconfig%2Fi386%2Fi386-features.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386-features.c?ref=a7f52181a6a16bb6d216ff41d9c6a9da95c19b5c", "patch": "@@ -2272,6 +2272,9 @@ remove_partial_avx_dependency (void)\n \n   auto_vec<rtx_insn *> control_flow_insns;\n \n+  /* We create invalid RTL initially so defer rescans.  */\n+  df_set_flags (DF_DEFER_INSN_RESCAN);\n+\n   FOR_EACH_BB_FN (bb, cfun)\n     {\n       FOR_BB_INSNS (bb, insn)\n@@ -2292,14 +2295,7 @@ remove_partial_avx_dependency (void)\n \t    continue;\n \n \t  if (!v4sf_const0)\n-\t    {\n-\t      calculate_dominance_info (CDI_DOMINATORS);\n-\t      df_set_flags (DF_DEFER_INSN_RESCAN);\n-\t      df_chain_add_problem (DF_DU_CHAIN | DF_UD_CHAIN);\n-\t      df_md_add_problem ();\n-\t      df_analyze ();\n-\t      v4sf_const0 = gen_reg_rtx (V4SFmode);\n-\t    }\n+\t    v4sf_const0 = gen_reg_rtx (V4SFmode);\n \n \t  /* Convert PARTIAL_XMM_UPDATE_TRUE insns, DF -> SF, SF -> DF,\n \t     SI -> SF, SI -> DF, DI -> SF, DI -> DF, to vec_dup and\n@@ -2360,6 +2356,7 @@ remove_partial_avx_dependency (void)\n     {\n       /* (Re-)discover loops so that bb->loop_father can be used in the\n \t analysis below.  */\n+      calculate_dominance_info (CDI_DOMINATORS);\n       loop_optimizer_init (AVOID_CFG_MODIFICATIONS);\n \n       /* Generate a vxorps at entry of the nearest dominator for basic\n@@ -2391,7 +2388,6 @@ remove_partial_avx_dependency (void)\n \tset_insn = emit_insn_after (set,\n \t\t\t\t    insn ? PREV_INSN (insn) : BB_END (bb));\n       df_insn_rescan (set_insn);\n-      df_process_deferred_rescans ();\n       loop_optimizer_finalize ();\n \n       if (!control_flow_insns.is_empty ())\n@@ -2412,6 +2408,7 @@ remove_partial_avx_dependency (void)\n \t}\n     }\n \n+  df_process_deferred_rescans ();\n   bitmap_obstack_release (NULL);\n   BITMAP_FREE (convert_bbs);\n \n@@ -2441,7 +2438,7 @@ const pass_data pass_data_remove_partial_avx_dependency =\n   0, /* properties_provided */\n   0, /* properties_destroyed */\n   0, /* todo_flags_start */\n-  TODO_df_finish, /* todo_flags_finish */\n+  0, /* todo_flags_finish */\n };\n \n class pass_remove_partial_avx_dependency : public rtl_opt_pass"}]}