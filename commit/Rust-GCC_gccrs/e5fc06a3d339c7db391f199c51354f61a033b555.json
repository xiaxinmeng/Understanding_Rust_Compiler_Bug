{"sha": "e5fc06a3d339c7db391f199c51354f61a033b555", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTVmYzA2YTNkMzM5YzdkYjM5MWYxOTljNTEzNTRmNjFhMDMzYjU1NQ==", "commit": {"author": {"name": "Wilco Dijkstra", "email": "wdijkstr@arm.com", "date": "2017-09-05T17:22:51Z"}, "committer": {"name": "Wilco Dijkstra", "email": "wilco@gcc.gnu.org", "date": "2017-09-05T17:22:51Z"}, "message": "Improve max_insns_skipped logic\n\nImprove the logic when setting max_insns_skipped.  Limit the maximum size of IT\nto MAX_INSN_PER_IT_BLOCK as otherwise multiple IT instructions are needed,\nincreasing codesize.  Given 4 works well for Thumb-2, use the same limit for ARM\nfor consistency.\n\n    gcc/\n\t* config/arm/arm.c (arm_option_params_internal): Improve setting of\n\tmax_insns_skipped.\n\nFrom-SVN: r251720", "tree": {"sha": "1537c9c18f0dd49c1bc42405a1848868f550833f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1537c9c18f0dd49c1bc42405a1848868f550833f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e5fc06a3d339c7db391f199c51354f61a033b555", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5fc06a3d339c7db391f199c51354f61a033b555", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e5fc06a3d339c7db391f199c51354f61a033b555", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5fc06a3d339c7db391f199c51354f61a033b555/comments", "author": null, "committer": null, "parents": [{"sha": "f174328efedff73f53cad8848fe69f92e940309a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f174328efedff73f53cad8848fe69f92e940309a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f174328efedff73f53cad8848fe69f92e940309a"}], "stats": {"total": 23, "additions": 10, "deletions": 13}, "files": [{"sha": "99a3a768804dcc269580f7f552b45a943c032f5f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5fc06a3d339c7db391f199c51354f61a033b555/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5fc06a3d339c7db391f199c51354f61a033b555/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e5fc06a3d339c7db391f199c51354f61a033b555", "patch": "@@ -1,3 +1,8 @@\n+2017-09-05  Wilco Dijkstra  <wdijkstr@arm.com>\n+\n+\t* config/arm/arm.c (arm_option_params_internal): Improve setting of\n+\tmax_insns_skipped.\n+\n 2017-09-05  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR target/59501"}, {"sha": "0094c0e60f3af32cd2f3f8f45300d734d1da152d", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 5, "deletions": 13, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5fc06a3d339c7db391f199c51354f61a033b555/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5fc06a3d339c7db391f199c51354f61a033b555/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=e5fc06a3d339c7db391f199c51354f61a033b555", "patch": "@@ -2873,20 +2873,12 @@ arm_option_params_internal (void)\n       targetm.max_anchor_offset = TARGET_MAX_ANCHOR_OFFSET;\n     }\n \n-  if (optimize_size)\n-    {\n-      /* If optimizing for size, bump the number of instructions that we\n-         are prepared to conditionally execute (even on a StrongARM).  */\n-      max_insns_skipped = 6;\n+  /* Increase the number of conditional instructions with -Os.  */\n+  max_insns_skipped = optimize_size ? 4 : current_tune->max_insns_skipped;\n \n-      /* For THUMB2, we limit the conditional sequence to one IT block.  */\n-      if (TARGET_THUMB2)\n-        max_insns_skipped = arm_restrict_it ? 1 : 4;\n-    }\n-  else\n-    /* When -mrestrict-it is in use tone down the if-conversion.  */\n-    max_insns_skipped = (TARGET_THUMB2 && arm_restrict_it)\n-      ? 1 : current_tune->max_insns_skipped;\n+  /* For THUMB2, we limit the conditional sequence to one IT block.  */\n+  if (TARGET_THUMB2)\n+    max_insns_skipped = MIN (max_insns_skipped, MAX_INSN_PER_IT_BLOCK);\n }\n \n /* True if -mflip-thumb should next add an attribute for the default"}]}