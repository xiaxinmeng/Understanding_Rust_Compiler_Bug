{"sha": "d91909c0133554d00379f0ef41fe2d2ff6ab9968", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDkxOTA5YzAxMzM1NTRkMDAzNzlmMGVmNDFmZTJkMmZmNmFiOTk2OA==", "commit": {"author": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2011-03-29T09:39:10Z"}, "committer": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2011-03-29T09:39:10Z"}, "message": "re PR fortran/48095 ([OOP] Invalid assignment to procedure pointer component not rejected)\n\n2011-03-29  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/48095\n\t* decl.c (match_procedure_decl,match_ppc_decl): Set flavor of interface.\n\t* module.c (MOD_VERSION): Bump.\n\t(mio_typespec): Read/write 'interface' field.\n\t* primary.c (match_string_constant,match_logical_constant): Remove\n\tunneeded code.\n\t(match_complex_constant): Make sure to clear the typespec.\n\n2011-03-29  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/48095\n\t* gfortran.dg/module_md5_1.f90: Modified MD5 sum.\n\t* gfortran.dg/proc_ptr_comp_32.f90: New.\n\nFrom-SVN: r171654", "tree": {"sha": "5cbc71797224538781afa1e8370fcb01a020856b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5cbc71797224538781afa1e8370fcb01a020856b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d91909c0133554d00379f0ef41fe2d2ff6ab9968", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d91909c0133554d00379f0ef41fe2d2ff6ab9968", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d91909c0133554d00379f0ef41fe2d2ff6ab9968", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d91909c0133554d00379f0ef41fe2d2ff6ab9968/comments", "author": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "23360fe40929b6f731db12007a7b262e72e5e336", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23360fe40929b6f731db12007a7b262e72e5e336", "html_url": "https://github.com/Rust-GCC/gccrs/commit/23360fe40929b6f731db12007a7b262e72e5e336"}], "stats": {"total": 73, "additions": 62, "deletions": 11}, "files": [{"sha": "3ebca545f0a787f5887d91e6ffe2aa9f9bfaa97c", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d91909c0133554d00379f0ef41fe2d2ff6ab9968/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d91909c0133554d00379f0ef41fe2d2ff6ab9968/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=d91909c0133554d00379f0ef41fe2d2ff6ab9968", "patch": "@@ -1,3 +1,13 @@\n+2011-03-29  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/48095\n+\t* decl.c (match_procedure_decl,match_ppc_decl): Set flavor of interface.\n+\t* module.c (MOD_VERSION): Bump.\n+\t(mio_typespec): Read/write 'interface' field.\n+\t* primary.c (match_string_constant,match_logical_constant): Remove\n+\tunneeded code.\n+\t(match_complex_constant): Make sure to clear the typespec.\n+\n 2011-03-29  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \t* frontend-passes.c (create_var):  Warn about creating an"}, {"sha": "f7a704fd0b33e5c6817d5ecf60a3985dce4a3e8f", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d91909c0133554d00379f0ef41fe2d2ff6ab9968/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d91909c0133554d00379f0ef41fe2d2ff6ab9968/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=d91909c0133554d00379f0ef41fe2d2ff6ab9968", "patch": "@@ -4737,8 +4737,9 @@ match_procedure_decl (void)\n \t    return MATCH_ERROR;\n \t  sym->ts.interface = gfc_new_symbol (\"\", gfc_current_ns);\n \t  sym->ts.interface->ts = current_ts;\n+\t  sym->ts.interface->attr.flavor = FL_PROCEDURE;\n \t  sym->ts.interface->attr.function = 1;\n-\t  sym->attr.function = sym->ts.interface->attr.function;\n+\t  sym->attr.function = 1;\n \t  sym->attr.if_source = IFSRC_UNKNOWN;\n \t}\n \n@@ -4871,8 +4872,9 @@ match_ppc_decl (void)\n \t  c->ts = ts;\n \t  c->ts.interface = gfc_new_symbol (\"\", gfc_current_ns);\n \t  c->ts.interface->ts = ts;\n+\t  c->ts.interface->attr.flavor = FL_PROCEDURE;\n \t  c->ts.interface->attr.function = 1;\n-\t  c->attr.function = c->ts.interface->attr.function;\n+\t  c->attr.function = 1;\n \t  c->attr.if_source = IFSRC_UNKNOWN;\n \t}\n "}, {"sha": "36701b427f94fae8317471998aae6cf993a08873", "filename": "gcc/fortran/module.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d91909c0133554d00379f0ef41fe2d2ff6ab9968/gcc%2Ffortran%2Fmodule.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d91909c0133554d00379f0ef41fe2d2ff6ab9968/gcc%2Ffortran%2Fmodule.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmodule.c?ref=d91909c0133554d00379f0ef41fe2d2ff6ab9968", "patch": "@@ -80,7 +80,7 @@ along with GCC; see the file COPYING3.  If not see\n \n /* Don't put any single quote (') in MOD_VERSION, \n    if yout want it to be recognized.  */\n-#define MOD_VERSION \"6\"\n+#define MOD_VERSION \"7\"\n \n \n /* Structure that describes a position within a module file.  */\n@@ -2124,6 +2124,8 @@ mio_typespec (gfc_typespec *ts)\n   else\n     mio_symbol_ref (&ts->u.derived);\n \n+  mio_symbol_ref (&ts->interface);\n+\n   /* Add info for C interop and is_iso_c.  */\n   mio_integer (&ts->is_c_interop);\n   mio_integer (&ts->is_iso_c);"}, {"sha": "a121999317aea34dcb99fb8ac8f7a76a44f0c316", "filename": "gcc/fortran/primary.c", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d91909c0133554d00379f0ef41fe2d2ff6ab9968/gcc%2Ffortran%2Fprimary.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d91909c0133554d00379f0ef41fe2d2ff6ab9968/gcc%2Ffortran%2Fprimary.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fprimary.c?ref=d91909c0133554d00379f0ef41fe2d2ff6ab9968", "patch": "@@ -980,9 +980,6 @@ match_string_constant (gfc_expr **result)\n     goto no_match;\n \n   e = gfc_get_character_expr (kind, &start_locus, NULL, length);\n-  e->ref = NULL;\n-  e->ts.is_c_interop = 0;\n-  e->ts.is_iso_c = 0;\n \n   gfc_current_locus = start_locus;\n \n@@ -1086,8 +1083,6 @@ match_logical_constant (gfc_expr **result)\n     }\n \n   e = gfc_get_logical_expr (kind, &gfc_current_locus, i);\n-  e->ts.is_c_interop = 0;\n-  e->ts.is_iso_c = 0;\n \n   *result = e;\n   return MATCH_YES;\n@@ -1269,10 +1264,9 @@ match_complex_constant (gfc_expr **result)\n       else\n \tkind = gfc_default_real_kind;\n     }\n+  gfc_clear_ts (&target);\n   target.type = BT_REAL;\n   target.kind = kind;\n-  target.is_c_interop = 0;\n-  target.is_iso_c = 0;\n \n   if (real->ts.type != BT_REAL || kind != real->ts.kind)\n     gfc_convert_type (real, &target, 2);"}, {"sha": "6b960a61a4674841804edf547e3f161ad24786a6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d91909c0133554d00379f0ef41fe2d2ff6ab9968/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d91909c0133554d00379f0ef41fe2d2ff6ab9968/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d91909c0133554d00379f0ef41fe2d2ff6ab9968", "patch": "@@ -1,3 +1,9 @@\n+2011-03-29  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/48095\n+\t* gfortran.dg/module_md5_1.f90: Modified MD5 sum.\n+\t* gfortran.dg/proc_ptr_comp_32.f90: New.\n+\n 2011-03-29  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \t* gfortran.dg/function_optimize_1.f90:  Add -Warray-temporaries,"}, {"sha": "f146cd2e2040993369d26bb0689b8c1bc9084ea4", "filename": "gcc/testsuite/gfortran.dg/module_md5_1.f90", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d91909c0133554d00379f0ef41fe2d2ff6ab9968/gcc%2Ftestsuite%2Fgfortran.dg%2Fmodule_md5_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d91909c0133554d00379f0ef41fe2d2ff6ab9968/gcc%2Ftestsuite%2Fgfortran.dg%2Fmodule_md5_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fmodule_md5_1.f90?ref=d91909c0133554d00379f0ef41fe2d2ff6ab9968", "patch": "@@ -10,5 +10,5 @@ program test\n   use foo\n   print *, pi\n end program test\n-! { dg-final { scan-module \"foo\" \"MD5:5632bcd379cf023bf7e663e91d52fa12\" } }\n+! { dg-final { scan-module \"foo\" \"MD5:12a205c48fe46315a609823f15986377\" } }\n ! { dg-final { cleanup-modules \"foo\" } }"}, {"sha": "eda972a4548375fdcd917f409249786de95855f0", "filename": "gcc/testsuite/gfortran.dg/proc_ptr_comp_32.f90", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d91909c0133554d00379f0ef41fe2d2ff6ab9968/gcc%2Ftestsuite%2Fgfortran.dg%2Fproc_ptr_comp_32.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d91909c0133554d00379f0ef41fe2d2ff6ab9968/gcc%2Ftestsuite%2Fgfortran.dg%2Fproc_ptr_comp_32.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fproc_ptr_comp_32.f90?ref=d91909c0133554d00379f0ef41fe2d2ff6ab9968", "patch": "@@ -0,0 +1,37 @@\n+! { dg-do compile }\n+!\n+! PR 48095: [OOP] Invalid assignment to procedure pointer component not rejected\n+!\n+! Contributed by Arjen Markus <arjen.markus895@gmail.com>\n+\n+module m\n+\n+  implicit none\n+\n+  type :: rectangle\n+    procedure(get_area), pointer :: get_special_area\n+  end type rectangle\n+\n+  abstract interface\n+    real function get_area( this )\n+      import                       :: rectangle\n+      class(rectangle), intent(in) :: this\n+    end function get_area\n+  end interface\n+\n+contains\n+\n+  real function get_my_area( this )\n+    type(rectangle), intent(in) :: this\n+    get_my_area = 3.0\n+  end function get_my_area\n+\n+end module\n+\n+\n+use m\n+type(rectangle) :: rect\n+rect%get_special_area => get_my_area  ! { dg-error \"Interface mismatch in procedure pointer assignment\" }\n+end\n+\n+! { dg-final { cleanup-modules \"m\" } }"}]}