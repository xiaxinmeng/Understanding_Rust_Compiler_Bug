{"sha": "212cf333fbd72f189273a0947f2889bae99429d8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjEyY2YzMzNmYmQ3MmYxODkyNzNhMDk0N2YyODg5YmFlOTk0MjlkOA==", "commit": {"author": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "1999-05-25T23:18:19Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "1999-05-25T23:18:19Z"}, "message": "Revert accidental checkin.\n\nFrom-SVN: r27152", "tree": {"sha": "645c571bfcc7d8306bdaa61ca7382a47e62eee09", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/645c571bfcc7d8306bdaa61ca7382a47e62eee09"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/212cf333fbd72f189273a0947f2889bae99429d8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/212cf333fbd72f189273a0947f2889bae99429d8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/212cf333fbd72f189273a0947f2889bae99429d8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/212cf333fbd72f189273a0947f2889bae99429d8/comments", "author": null, "committer": null, "parents": [{"sha": "98577d038cb1781b3d3ff5050a279a1aae9cb592", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/98577d038cb1781b3d3ff5050a279a1aae9cb592", "html_url": "https://github.com/Rust-GCC/gccrs/commit/98577d038cb1781b3d3ff5050a279a1aae9cb592"}], "stats": {"total": 168, "additions": 60, "deletions": 108}, "files": [{"sha": "d5c6fc52eda3898cc8d2d39b8b827d58b03ac434", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 60, "deletions": 108, "changes": 168, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/212cf333fbd72f189273a0947f2889bae99429d8/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/212cf333fbd72f189273a0947f2889bae99429d8/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=212cf333fbd72f189273a0947f2889bae99429d8", "patch": "@@ -2995,8 +2995,7 @@ put_jump_code (code, reverse, file)\n      FILE *file;\n {\n   int flags = cc_prev_status.flags;\n-  int ieee = (TARGET_IEEE_FP && (flags & CC_IN_80387)\n-\t      && !(cc_prev_status.flags & CC_FCOMI));\n+  int ieee = (TARGET_IEEE_FP && (flags & CC_IN_80387));\n   const char *suffix;\n \n   if (flags & CC_Z_IN_NOT_C)\n@@ -3761,7 +3760,7 @@ notice_update_cc (exp)\n           if (stack_regs_mentioned_p (SET_SRC (XVECEXP (exp, 0, 0))))\n \t    {\n               cc_status.flags |= CC_IN_80387;\n-\t      if (TARGET_CMOVE && stack_regs_mentioned_p\n+\t      if (0 && TARGET_CMOVE && stack_regs_mentioned_p\n \t\t  (XEXP (SET_SRC (XVECEXP (exp, 0, 0)), 1)))\n \t\tcc_status.flags |= CC_FCOMI;\n \t    }\n@@ -4119,8 +4118,7 @@ output_float_compare (insn, operands)\n   int cc0_set = 1;\n   int i;\n \n-  if (TARGET_CMOVE && STACK_REG_P (operands[1])\n-      && STACK_REG_P (operands[0]))\n+  if (0 && TARGET_CMOVE && STACK_REG_P (operands[1]))\n     {\n       cc_status.flags |= CC_FCOMI;\n       cc_prev_status.flags &= ~CC_TEST_AX;\n@@ -4154,8 +4152,7 @@ output_float_compare (insn, operands)\n \t    {\n \t      output_asm_insn (AS2 (fucomip,%y1,%0), operands);\n \t      output_asm_insn (AS1 (fstp, %y0), operands);\n-\t      if (!TARGET_IEEE_FP)\n-\t\tcc0_set = 0; \n+\t      cc0_set = 0; \n \t    }\n \t  else\n \t    output_asm_insn (\"fucompp\", operands);\n@@ -4166,8 +4163,7 @@ output_float_compare (insn, operands)\n \t    {\n \t      output_asm_insn (AS2 (fcomip, %y1,%0), operands);\n \t      output_asm_insn (AS1 (fstp, %y0), operands);\n-\t      if (!TARGET_IEEE_FP)\n-\t\tcc0_set = 0; \n+\t      cc0_set = 0; \n \t    }\n \t  else\n \t    output_asm_insn (\"fcompp\", operands);\n@@ -4192,8 +4188,7 @@ output_float_compare (insn, operands)\n       if (cc_status.flags & CC_FCOMI)\n \t{\n \t  output_asm_insn (strcat (buf, AS2 (%z1,%y1,%0)), operands);\n-\t  if (!TARGET_IEEE_FP)\n-\t    cc0_set = 0; \n+\t  cc0_set = 0; \n \t}\n       else\n         output_asm_insn (strcat (buf, AS1 (%z1,%y1)), operands);\n@@ -4241,19 +4236,17 @@ output_fp_cc0_set (insn)\n   rtx next;\n   enum rtx_code code;\n \n-  if (!(cc_status.flags & CC_FCOMI))\n-    {\n-      xops[0] = gen_rtx_REG (HImode, 0);\n-      output_asm_insn (AS1 (fnsts%W0,%0), xops);\n-    }\n+  xops[0] = gen_rtx_REG (HImode, 0);\n+  output_asm_insn (AS1 (fnsts%W0,%0), xops);\n \n   if (! TARGET_IEEE_FP)\n     {\n       if (!(cc_status.flags & CC_REVERSED))\n         {\n           next = next_cc0_user (insn);\n-  \n-          if (GET_CODE (PATTERN (next)) == SET\n+\n+          if (GET_CODE (next) == JUMP_INSN\n+              && GET_CODE (PATTERN (next)) == SET\n               && SET_DEST (PATTERN (next)) == pc_rtx\n               && GET_CODE (SET_SRC (PATTERN (next))) == IF_THEN_ELSE)\n \t    code = GET_CODE (XEXP (SET_SRC (PATTERN (next)), 0));\n@@ -4278,7 +4271,8 @@ output_fp_cc0_set (insn)\n   if (next == NULL_RTX)\n     abort ();\n \n-  if (GET_CODE (PATTERN (next)) == SET\n+  if (GET_CODE (next) == JUMP_INSN\n+      && GET_CODE (PATTERN (next)) == SET\n       && SET_DEST (PATTERN (next)) == pc_rtx\n       && GET_CODE (SET_SRC (PATTERN (next))) == IF_THEN_ELSE)\n     code = GET_CODE (XEXP (SET_SRC (PATTERN (next)), 0));\n@@ -4301,103 +4295,61 @@ output_fp_cc0_set (insn)\n   else\n     abort ();\n \n-  if (cc_status.flags & CC_FCOMI)\n-    {\n-      /* It is very tricky. We have to do it right. */\n-\n-      xops [0] = gen_rtx_REG (QImode, 0);\n-\n-      switch (code)\n-\t{\n-\tcase GT:\n-\tcase GE:\n-\t  break;\n-\n-\tcase LT:\n-\t  output_asm_insn (AS1 (setb,%b0), xops);\n-\t  output_asm_insn (AS1 (setp,%h0), xops);\n-\t  output_asm_insn (AS2 (cmp%B0,%b0,%h0), xops);\n-\t  break;\n-\n-\tcase LE:\n-\t  output_asm_insn (AS1 (setbe,%b0), xops);\n-\t  output_asm_insn (AS1 (setnp,%h0), xops);\n-\t  output_asm_insn (AS2 (xor%B0,%b0,%h0), xops);\n-\t  break;\n-\n-\tcase EQ:\n-\tcase NE:\n-\t  output_asm_insn (AS1 (setne,%b0), xops);\n-\t  output_asm_insn (AS1 (setp,%h0), xops);\n-\t  output_asm_insn (AS2 (or%B0,%b0,%h0), xops);\n-\t  break;\n+  xops[0] = gen_rtx_REG (QImode, 0);\n \n-\tcase GTU:\n-\tcase LTU:\n-\tcase GEU:\n-\tcase LEU:\n-\tdefault:\n-\t  abort ();\n-\t}\n-    }\n-  else\n+  switch (code)\n     {\n-      xops[0] = gen_rtx_REG (QImode, 0);\n-\n-      switch (code)\n-\t{\n-\tcase GT:\n-\t  xops[1] = GEN_INT (0x45);\n-\t  output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n-\t  /* je label */\n-\t  break;\n+    case GT:\n+      xops[1] = GEN_INT (0x45);\n+      output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n+      /* je label */\n+      break;\n \n-\tcase LT:\n-\t  xops[1] = GEN_INT (0x45);\n-\t  xops[2] = GEN_INT (0x01);\n-\t  output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n-\t  output_asm_insn (AS2 (cmp%B0,%2,%h0), xops);\n-\t  /* je label */\n-\t  break;\n+    case LT:\n+      xops[1] = GEN_INT (0x45);\n+      xops[2] = GEN_INT (0x01);\n+      output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n+      output_asm_insn (AS2 (cmp%B0,%2,%h0), xops);\n+      /* je label */\n+      break;\n \n-\tcase GE:\n-\t  xops[1] = GEN_INT (0x05);\n-\t  output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n-\t  /* je label */\n-\t  break;\n+    case GE:\n+      xops[1] = GEN_INT (0x05);\n+      output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n+      /* je label */\n+      break;\n \n-\tcase LE:\n-\t  xops[1] = GEN_INT (0x45);\n-\t  xops[2] = GEN_INT (0x40);\n-\t  output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n-\t  output_asm_insn (AS1 (dec%B0,%h0), xops);\n-\t  output_asm_insn (AS2 (cmp%B0,%2,%h0), xops);\n-\t  /* jb label */\n-\t  break;\n+    case LE:\n+      xops[1] = GEN_INT (0x45);\n+      xops[2] = GEN_INT (0x40);\n+      output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n+      output_asm_insn (AS1 (dec%B0,%h0), xops);\n+      output_asm_insn (AS2 (cmp%B0,%2,%h0), xops);\n+      /* jb label */\n+      break;\n \n-\tcase EQ:\n-\t  xops[1] = GEN_INT (0x45);\n-\t  xops[2] = GEN_INT (0x40);\n-\t  output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n-\t  output_asm_insn (AS2 (cmp%B0,%2,%h0), xops);\n-\t  /* je label */\n-\t  break;\n+    case EQ:\n+      xops[1] = GEN_INT (0x45);\n+      xops[2] = GEN_INT (0x40);\n+      output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n+      output_asm_insn (AS2 (cmp%B0,%2,%h0), xops);\n+      /* je label */\n+      break;\n \n-\tcase NE:\n-\t  xops[1] = GEN_INT (0x44);\n-\t  xops[2] = GEN_INT (0x40);\n-\t  output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n-\t  output_asm_insn (AS2 (xor%B0,%2,%h0), xops);\n-\t  /* jne label */\n-\t  break;\n+    case NE:\n+      xops[1] = GEN_INT (0x44);\n+      xops[2] = GEN_INT (0x40);\n+      output_asm_insn (AS2 (and%B0,%1,%h0), xops);\n+      output_asm_insn (AS2 (xor%B0,%2,%h0), xops);\n+      /* jne label */\n+      break;\n \n-\tcase GTU:\n-\tcase LTU:\n-\tcase GEU:\n-\tcase LEU:\n-\tdefault:\n-\t  abort ();\n-\t}\n+    case GTU:\n+    case LTU:\n+    case GEU:\n+    case LEU:\n+    default:\n+      abort ();\n     }\n \n   return \"\";"}]}