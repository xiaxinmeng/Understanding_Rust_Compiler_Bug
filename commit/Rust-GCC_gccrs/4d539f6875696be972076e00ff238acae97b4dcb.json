{"sha": "4d539f6875696be972076e00ff238acae97b4dcb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGQ1MzlmNjg3NTY5NmJlOTcyMDc2ZTAwZmYyMzhhY2FlOTdiNGRjYg==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2004-09-18T21:54:53Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2004-09-18T21:54:53Z"}, "message": "* tree-cfg.c (thread_jumps):  Fix updating of the profile.\n\nFrom-SVN: r87709", "tree": {"sha": "a1454d32f30953d3df17ed9dde7a3701bf9b1dfc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a1454d32f30953d3df17ed9dde7a3701bf9b1dfc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4d539f6875696be972076e00ff238acae97b4dcb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d539f6875696be972076e00ff238acae97b4dcb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4d539f6875696be972076e00ff238acae97b4dcb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d539f6875696be972076e00ff238acae97b4dcb/comments", "author": null, "committer": null, "parents": [{"sha": "0eac5febe66effbc6fae3b6945e108fac736b4e6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0eac5febe66effbc6fae3b6945e108fac736b4e6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0eac5febe66effbc6fae3b6945e108fac736b4e6"}], "stats": {"total": 28, "additions": 18, "deletions": 10}, "files": [{"sha": "36183a7d5a5048ee4475d0d8daafdbbefedf8f3f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d539f6875696be972076e00ff238acae97b4dcb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d539f6875696be972076e00ff238acae97b4dcb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4d539f6875696be972076e00ff238acae97b4dcb", "patch": "@@ -1,5 +1,7 @@\n 2004-09-18  Jan Hubicka  <jh@suse.cz>\n \n+\t* tree-cfg.c (thread_jumps):  Fix updating of the profile.\n+\n \t* tree-optimize.c (tree_rest_of_compilation): Kill forgotten\n \tverify_cgraph call.\n "}, {"sha": "37b57102f63aa0fbbfad8ddada19120c5748c1b7", "filename": "gcc/tree-cfg.c", "status": "modified", "additions": 16, "deletions": 10, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d539f6875696be972076e00ff238acae97b4dcb/gcc%2Ftree-cfg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d539f6875696be972076e00ff238acae97b4dcb/gcc%2Ftree-cfg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfg.c?ref=4d539f6875696be972076e00ff238acae97b4dcb", "patch": "@@ -3832,7 +3832,7 @@ static bool\n thread_jumps (void)\n {\n   edge e, next, last, old;\n-  basic_block bb, dest, tmp, old_dest, dom;\n+  basic_block bb, dest, tmp, old_dest, curr, dom;\n   tree phi;\n   int arg;\n   bool retval = false;\n@@ -3891,15 +3891,6 @@ thread_jumps (void)\n \t\tbreak;\n \n \t      bb_ann (dest)->forwardable = 0;\n-\t      dest->frequency -= freq;\n-\t      if (dest->frequency < 0)\n-\t\tdest->frequency = 0;\n-\t      dest->count -= count;\n-\t      if (dest->count < 0)\n-\t\tdest->count = 0;\n-\t      dest->succ->count -= count;\n-\t      if (dest->succ->count < 0)\n-\t\tdest->succ->count = 0;\n \t    }\n \n \t  /* Reset the forwardable marks to 1.  */\n@@ -3936,6 +3927,21 @@ thread_jumps (void)\n \t  old_dest = e->dest;\n \t  e = redirect_edge_and_branch (e, dest);\n \n+\t  /* Update the profile.  */\n+\t  if (profile_status != PROFILE_ABSENT)\n+\t    for (curr = old_dest; curr != dest; curr = curr->succ->dest)\n+\t      {\n+\t\tcurr->frequency -= freq;\n+\t\tif (curr->frequency < 0)\n+\t\t  curr->frequency = 0;\n+\t\tcurr->count -= count;\n+\t\tif (curr->count < 0)\n+\t\t  curr->count = 0;\n+\t\tcurr->succ->count -= count;\n+\t\tif (curr->succ->count < 0)\n+\t\t  curr->succ->count = 0;\n+\t      }\n+\n \t  if (!old)\n \t    {\n \t      /* Update PHI nodes.   We know that the new argument should"}]}