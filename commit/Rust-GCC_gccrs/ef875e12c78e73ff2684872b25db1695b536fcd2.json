{"sha": "ef875e12c78e73ff2684872b25db1695b536fcd2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWY4NzVlMTJjNzhlNzNmZjI2ODQ4NzJiMjVkYjE2OTViNTM2ZmNkMg==", "commit": {"author": {"name": "Anatoly Sokolov", "email": "aesok@post.ru", "date": "2010-12-16T18:41:56Z"}, "committer": {"name": "Anatoly Sokolov", "email": "aesok@gcc.gnu.org", "date": "2010-12-16T18:41:56Z"}, "message": "sh.h (OUTPUT_ADDR_CONST_EXTRA): Remove.\n\n\t* config/sh/sh.h (OUTPUT_ADDR_CONST_EXTRA): Remove.\n\t* config/sh/sh.c (sh_asm_output_addr_const_extra): New function.\n\t(TARGET_ASM_OUTPUT_ADDR_CONST_EXTRA): Define.\n\nFrom-SVN: r167951", "tree": {"sha": "103380eb3323f45fe185741536abd467e74ac707", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/103380eb3323f45fe185741536abd467e74ac707"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ef875e12c78e73ff2684872b25db1695b536fcd2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ef875e12c78e73ff2684872b25db1695b536fcd2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ef875e12c78e73ff2684872b25db1695b536fcd2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ef875e12c78e73ff2684872b25db1695b536fcd2/comments", "author": null, "committer": null, "parents": [{"sha": "a4b56e0218ecfc45a452cdbe60f3d19f35a6c8b9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a4b56e0218ecfc45a452cdbe60f3d19f35a6c8b9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a4b56e0218ecfc45a452cdbe60f3d19f35a6c8b9"}], "stats": {"total": 228, "additions": 119, "deletions": 109}, "files": [{"sha": "351bce86add08e08bb99cd4d3c077559551ba35e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef875e12c78e73ff2684872b25db1695b536fcd2/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef875e12c78e73ff2684872b25db1695b536fcd2/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ef875e12c78e73ff2684872b25db1695b536fcd2", "patch": "@@ -1,3 +1,9 @@\n+2010-12-16  Anatoly Sokolov  <aesok@post.ru>\n+\n+\t* config/sh/sh.h (OUTPUT_ADDR_CONST_EXTRA): Remove.\n+\t* config/sh/sh.c (sh_asm_output_addr_const_extra): New function.\n+\t(TARGET_ASM_OUTPUT_ADDR_CONST_EXTRA): Define.\n+\n 2010-12-16  Ulrich Weigand  <Ulrich.Weigand@de.ibm.com>\n \n \t* config/spu/t-spu-elf (LIB2_SIDITI_CONV_FUNC): Define."}, {"sha": "2fdf03a7c251eefcc3f6a64f201f2b67be70b5e2", "filename": "gcc/config/sh/sh.c", "status": "modified", "additions": 113, "deletions": 1, "changes": 114, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef875e12c78e73ff2684872b25db1695b536fcd2/gcc%2Fconfig%2Fsh%2Fsh.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef875e12c78e73ff2684872b25db1695b536fcd2/gcc%2Fconfig%2Fsh%2Fsh.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsh%2Fsh.c?ref=ef875e12c78e73ff2684872b25db1695b536fcd2", "patch": "@@ -204,6 +204,7 @@ static tree sh_handle_renesas_attribute (tree *, tree, tree, int, bool *);\n static void sh_print_operand (FILE *, rtx, int);\n static void sh_print_operand_address (FILE *, rtx);\n static bool sh_print_operand_punct_valid_p (unsigned char code);\n+static bool sh_asm_output_addr_const_extra (FILE *file, rtx x);\n static void sh_output_function_epilogue (FILE *, HOST_WIDE_INT);\n static void sh_insert_attributes (tree, tree *);\n static const char *sh_check_pch_target_flags (int);\n@@ -372,7 +373,9 @@ static const struct default_options sh_option_optimization_table[] =\n #define TARGET_PRINT_OPERAND_ADDRESS sh_print_operand_address\n #undef TARGET_PRINT_OPERAND_PUNCT_VALID_P\n #define TARGET_PRINT_OPERAND_PUNCT_VALID_P sh_print_operand_punct_valid_p\n-\n+#undef TARGET_ASM_OUTPUT_ADDR_CONST_EXTRA\n+#define TARGET_ASM_OUTPUT_ADDR_CONST_EXTRA sh_asm_output_addr_const_extra\n+ \n #undef TARGET_ASM_FUNCTION_EPILOGUE\n #define TARGET_ASM_FUNCTION_EPILOGUE sh_output_function_epilogue\n \n@@ -1453,6 +1456,115 @@ sh_print_operand_punct_valid_p (unsigned char code)\n   return (code == '.' || code == '#' || code == '@' || code == ','\n           || code == '$' || code == '\\'' || code == '>');\n }\n+\n+/* Implement TARGET_ASM_OUTPUT_ADDR_CONST_EXTRA.  */\n+\n+static bool\n+sh_asm_output_addr_const_extra (FILE *file, rtx x)\n+{\n+  if (GET_CODE (x) == UNSPEC)\n+    {\n+      switch (XINT (x, 1))\n+\t{\n+\tcase UNSPEC_DATALABEL:\n+\t  fputs (\"datalabel \", file);\n+\t  output_addr_const (file, XVECEXP (x, 0, 0));\n+\t  break;\n+\tcase UNSPEC_PIC:\n+\t  /* GLOBAL_OFFSET_TABLE or local symbols, no suffix.  */\n+\t  output_addr_const (file, XVECEXP (x, 0, 0));\n+\t  break;\n+\tcase UNSPEC_GOT:\n+\t  output_addr_const (file, XVECEXP (x, 0, 0));\n+\t  fputs (\"@GOT\", file);\n+\t  break;\n+\tcase UNSPEC_GOTOFF:\n+\t  output_addr_const (file, XVECEXP (x, 0, 0));\n+\t  fputs (\"@GOTOFF\", file);\n+\t  break;\n+\tcase UNSPEC_PLT:\n+\t  output_addr_const (file, XVECEXP (x, 0, 0));\n+\t  fputs (\"@PLT\", file);\n+\t  break;\n+\tcase UNSPEC_GOTPLT:\n+\t  output_addr_const (file, XVECEXP (x, 0, 0));\n+\t  fputs (\"@GOTPLT\", file);\n+\t  break;\n+\tcase UNSPEC_DTPOFF:\n+\t  output_addr_const (file, XVECEXP (x, 0, 0));\n+\t  fputs (\"@DTPOFF\", file);\n+\t  break;\n+\tcase UNSPEC_GOTTPOFF:\n+\t  output_addr_const (file, XVECEXP (x, 0, 0));\n+\t  fputs (\"@GOTTPOFF\", file);\n+\t  break;\n+\tcase UNSPEC_TPOFF:\n+\t  output_addr_const (file, XVECEXP (x, 0, 0));\n+\t  fputs (\"@TPOFF\", file);\n+\t  break;\n+\tcase UNSPEC_CALLER:\n+\t  {\n+\t    char name[32];\n+\t    /* LPCS stands for Label for PIC Call Site.  */\n+\t    targetm.asm_out.generate_internal_label (name, \"LPCS\",\n+\t\t\t\t\t\t     INTVAL (XVECEXP (x, 0, 0)));\n+\t    assemble_name (file, name);\n+\t  }\n+\t  break;\n+\tcase UNSPEC_EXTRACT_S16:\n+\tcase UNSPEC_EXTRACT_U16:\n+\t  {\n+\t    rtx val, shift;\n+\n+\t    val = XVECEXP (x, 0, 0);\n+\t    shift = XVECEXP (x, 0, 1);\n+\t    fputc ('(', file);\n+\t    if (shift != const0_rtx)\n+\t        fputc ('(', file);\n+\t    if (GET_CODE (val) == CONST\n+\t        || GET_RTX_CLASS (GET_CODE (val)) != RTX_OBJ)\n+\t      {\n+\t\tfputc ('(', file);\n+\t\toutput_addr_const (file, val);\n+\t\tfputc (')', file);\n+\t      }\n+\t    else\n+\t      output_addr_const (file, val);\n+\t    if (shift != const0_rtx)\n+\t      {\n+\t\tfputs (\" >> \", file);\n+\t\toutput_addr_const (file, shift);\n+\t\tfputc (')', file);\n+\t      }\n+\t    fputs (\" & 65535)\", file);\n+\t  }\n+\t  break;\n+\tcase UNSPEC_SYMOFF:\n+\t  output_addr_const (file, XVECEXP (x, 0, 0));\n+\t  fputc ('-', file);\n+\t  if (GET_CODE (XVECEXP (x, 0, 1)) == CONST)\n+\t    {\n+\t      fputc ('(', file);\n+\t      output_addr_const (file, XVECEXP (x, 0, 1));\n+\t      fputc (')', file);\n+\t    }\n+\t  else\n+\t    output_addr_const (file, XVECEXP (x, 0, 1));\n+\t  break;\n+\tcase UNSPEC_PCREL_SYMOFF:\n+\t  output_addr_const (file, XVECEXP (x, 0, 0));\n+\t  fputs (\"-(\", file);\n+\t  output_addr_const (file, XVECEXP (x, 0, 1));\n+\t  fputs (\"-.)\", file);\n+\t  break;\n+\tdefault:\n+\t  return false;\n+\t}\n+      return true;\n+    }\n+  else\n+    return false;\n+}\n \f\n \n /* Encode symbol attributes of a SYMBOL_REF into its"}, {"sha": "c07ff083d8858273de83c5601553c4ec744af0b6", "filename": "gcc/config/sh/sh.h", "status": "modified", "additions": 0, "deletions": 108, "changes": 108, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef875e12c78e73ff2684872b25db1695b536fcd2/gcc%2Fconfig%2Fsh%2Fsh.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef875e12c78e73ff2684872b25db1695b536fcd2/gcc%2Fconfig%2Fsh%2Fsh.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsh%2Fsh.h?ref=ef875e12c78e73ff2684872b25db1695b536fcd2", "patch": "@@ -2353,114 +2353,6 @@ struct sh_args {\n #define FINAL_PRESCAN_INSN(INSN, OPVEC, NOPERANDS) \\\n   final_prescan_insn ((INSN), (OPVEC), (NOPERANDS))\n \n-/* Recognize machine-specific patterns that may appear within\n-   constants.  Used for PIC-specific UNSPECs.  */\n-#define OUTPUT_ADDR_CONST_EXTRA(STREAM, X, FAIL) \\\n-  do\t\t\t\t\t\t\t\t\t\\\n-    if (GET_CODE (X) == UNSPEC)\t\t\t\t\t\t\\\n-      {\t\t\t\t\t\t\t\t\t\\\n-\tswitch (XINT ((X), 1))\t\t\t\t\t\t\\\n-\t  {\t\t\t\t\t\t\t\t\\\n-\t  case UNSPEC_DATALABEL:\t\t\t\t\t\\\n-\t    fputs (\"datalabel \", (STREAM));\t\t\t\t\\\n-\t    output_addr_const ((STREAM), XVECEXP ((X), 0, 0));\t\t\\\n-\t    break;\t\t\t\t\t\t\t\\\n-\t  case UNSPEC_PIC:\t\t\t\t\t\t\\\n-\t    /* GLOBAL_OFFSET_TABLE or local symbols, no suffix.  */\t\\\n-\t    output_addr_const ((STREAM), XVECEXP ((X), 0, 0));\t\t\\\n-\t    break;\t\t\t\t\t\t\t\\\n-\t  case UNSPEC_GOT:\t\t\t\t\t\t\\\n-\t    output_addr_const ((STREAM), XVECEXP ((X), 0, 0));\t\t\\\n-\t    fputs (\"@GOT\", (STREAM));\t\t\t\t\t\\\n-\t    break;\t\t\t\t\t\t\t\\\n-\t  case UNSPEC_GOTOFF:\t\t\t\t\t\t\\\n-\t    output_addr_const ((STREAM), XVECEXP ((X), 0, 0));\t\t\\\n-\t    fputs (\"@GOTOFF\", (STREAM));\t\t\t\t\\\n-\t    break;\t\t\t\t\t\t\t\\\n-\t  case UNSPEC_PLT:\t\t\t\t\t\t\\\n-\t    output_addr_const ((STREAM), XVECEXP ((X), 0, 0));\t\t\\\n-\t    fputs (\"@PLT\", (STREAM));\t\t\t\t\t\\\n-\t    break;\t\t\t\t\t\t\t\\\n-\t  case UNSPEC_GOTPLT:\t\t\t\t\t\t\\\n-\t    output_addr_const ((STREAM), XVECEXP ((X), 0, 0));\t\t\\\n-\t    fputs (\"@GOTPLT\", (STREAM));\t\t\t\t\\\n-\t    break;\t\t\t\t\t\t\t\\\n-\t  case UNSPEC_DTPOFF:\t\t\t\t\t\t\\\n-\t    output_addr_const ((STREAM), XVECEXP ((X), 0, 0));\t\t\\\n-\t    fputs (\"@DTPOFF\", (STREAM));\t\t\t\t\\\n-\t    break;\t\t\t\t\t\t\t\\\n-\t  case UNSPEC_GOTTPOFF:\t\t\t\t\t\t\\\n-\t    output_addr_const ((STREAM), XVECEXP ((X), 0, 0));\t\t\\\n-\t    fputs (\"@GOTTPOFF\", (STREAM));\t\t\t\t\\\n-\t    break;\t\t\t\t\t\t\t\\\n-\t  case UNSPEC_TPOFF:\t\t\t\t\t\t\\\n-\t    output_addr_const ((STREAM), XVECEXP ((X), 0, 0));\t\t\\\n-\t    fputs (\"@TPOFF\", (STREAM));\t\t\t\t\t\\\n-\t    break;\t\t\t\t\t\t\t\\\n-\t  case UNSPEC_CALLER:\t\t\t\t\t\t\\\n-\t    {\t\t\t\t\t\t\t\t\\\n-\t      char name[32];\t\t\t\t\t\t\\\n-\t      /* LPCS stands for Label for PIC Call Site.  */\t\t\\\n-\t      ASM_GENERATE_INTERNAL_LABEL\t\t\t\t\\\n-\t\t(name, \"LPCS\", INTVAL (XVECEXP ((X), 0, 0)));\t\t\\\n-\t      assemble_name ((STREAM), name);\t\t\t\t\\\n-\t    }\t\t\t\t\t\t\t\t\\\n-\t    break;\t\t\t\t\t\t\t\\\n-\t  case UNSPEC_EXTRACT_S16:\t\t\t\t\t\\\n-\t  case UNSPEC_EXTRACT_U16:\t\t\t\t\t\\\n-\t    {\t\t\t\t\t\t\t\t\\\n-\t      rtx val, shift;\t\t\t\t\t\t\\\n-\t\t\t\t\t\t\t\t\t\\\n-\t      val = XVECEXP (X, 0, 0);\t\t\t\t\t\\\n-\t      shift = XVECEXP (X, 0, 1);\t\t\t\t\\\n-\t      fputc ('(', STREAM);\t\t\t\t\t\\\n-\t      if (shift != const0_rtx)\t\t\t\t\t\\\n-\t\tfputc ('(', STREAM);\t\t\t\t\t\\\n-\t      if (GET_CODE (val) == CONST\t\t\t\t\\\n-\t\t  || GET_RTX_CLASS (GET_CODE (val)) != RTX_OBJ)\t\t\\\n-\t\t{\t\t\t\t\t\t\t\\\n-\t\t  fputc ('(', STREAM);\t\t\t\t\t\\\n-\t\t  output_addr_const (STREAM, val);\t\t\t\\\n-\t\t  fputc (')', STREAM);\t\t\t\t\t\\\n-\t\t}\t\t\t\t\t\t\t\\\n-\t      else\t\t\t\t\t\t\t\\\n-\t\toutput_addr_const (STREAM, val);\t\t\t\\\n-\t      if (shift != const0_rtx)\t\t\t\t\t\\\n-\t\t{\t\t\t\t\t\t\t\\\n-\t\t  fputs (\" >> \", STREAM);\t\t\t\t\\\n-\t\t  output_addr_const (STREAM, shift);\t\t\t\\\n-\t\t  fputc (')', STREAM);\t\t\t\t\t\\\n-\t\t}\t\t\t\t\t\t\t\\\n-\t      fputs (\" & 65535)\", STREAM);\t\t\t\t\\\n-\t    }\t\t\t\t\t\t\t\t\\\n-\t    break;\t\t\t\t\t\t\t\\\n-\t  case UNSPEC_SYMOFF:\t\t\t\t\t\t\\\n-\t    output_addr_const (STREAM, XVECEXP (X, 0, 0));\t\t\\\n-\t    fputc ('-', STREAM);\t\t\t\t\t\\\n-\t    if (GET_CODE (XVECEXP (X, 0, 1)) == CONST)\t\t\t\\\n-\t      {\t\t\t\t\t\t\t\t\\\n-\t\tfputc ('(', STREAM);\t\t\t\t\t\\\n-\t\toutput_addr_const (STREAM, XVECEXP (X, 0, 1));\t\t\\\n-\t\tfputc (')', STREAM);\t\t\t\t\t\\\n-\t      }\t\t\t\t\t\t\t\t\\\n-\t    else\t\t\t\t\t\t\t\\\n-\t      output_addr_const (STREAM, XVECEXP (X, 0, 1));\t\t\\\n-\t    break;\t\t\t\t\t\t\t\\\n-\t  case UNSPEC_PCREL_SYMOFF:\t\t\t\t\t\\\n-\t    output_addr_const (STREAM, XVECEXP (X, 0, 0));\t\t\\\n-\t    fputs (\"-(\", STREAM);\t\t\t\t\t\\\n-\t    output_addr_const (STREAM, XVECEXP (X, 0, 1));\t\t\\\n-\t    fputs (\"-.)\", STREAM);\t\t\t\t\t\\\n-\t    break;\t\t\t\t\t\t\t\\\n-\t  default:\t\t\t\t\t\t\t\\\n-\t    goto FAIL;\t\t\t\t\t\t\t\\\n-\t  }\t\t\t\t\t\t\t\t\\\n-\tbreak;\t\t\t\t\t\t\t\t\\\n-      }\t\t\t\t\t\t\t\t\t\\\n-    else\t\t\t\t\t\t\t\t\\\n-      goto FAIL;\t\t\t\t\t\t\t\\\n-  while (0)\n-\n \f\n extern struct rtx_def *sh_compare_op0;\n extern struct rtx_def *sh_compare_op1;"}]}