{"sha": "e7437b594f9c54bc07a2ef0bda9801ce62b1eab7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTc0MzdiNTk0ZjljNTRiYzA3YTJlZjBiZGE5ODAxY2U2MmIxZWFiNw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-05-03T11:43:06Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-05-03T11:43:06Z"}, "message": "re PR tree-optimization/70916 (gcc ICE at -O3 on valid code on x86_64-linux-gnu in \"tree_operand_check\")\n\n\tPR tree-optimization/70916\n\t* tree-if-conv.c (constant_or_ssa_name): Removed.\n\t(fold_build_cond_expr): Use is_gimple_val instead of\n\tconstant_or_ssa_name.\n\nFrom-SVN: r235815", "tree": {"sha": "9171de8194afb338e1740a5022ab98933b0653ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9171de8194afb338e1740a5022ab98933b0653ca"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e7437b594f9c54bc07a2ef0bda9801ce62b1eab7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e7437b594f9c54bc07a2ef0bda9801ce62b1eab7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e7437b594f9c54bc07a2ef0bda9801ce62b1eab7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e7437b594f9c54bc07a2ef0bda9801ce62b1eab7/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "dea60b590ccf8968b5b651eddfc25ddf3226c8a1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dea60b590ccf8968b5b651eddfc25ddf3226c8a1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dea60b590ccf8968b5b651eddfc25ddf3226c8a1"}], "stats": {"total": 33, "additions": 9, "deletions": 24}, "files": [{"sha": "f2952eb9625e644462d913ae7eb1fd4293ecec96", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e7437b594f9c54bc07a2ef0bda9801ce62b1eab7/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e7437b594f9c54bc07a2ef0bda9801ce62b1eab7/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e7437b594f9c54bc07a2ef0bda9801ce62b1eab7", "patch": "@@ -1,5 +1,10 @@\n 2016-05-03  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR tree-optimization/70916\n+\t* tree-if-conv.c (constant_or_ssa_name): Removed.\n+\t(fold_build_cond_expr): Use is_gimple_val instead of\n+\tconstant_or_ssa_name.\n+\n \tPR tree-optimization/70916\n \t* tree-vect-patterns.c (vect_recog_mask_conversion_pattern): Give up\n \tif COND_EXPR rhs1 is neither SSA_NAME nor COMPARISON_CLASS_P."}, {"sha": "72dca985d741ba32d73f0f4b87803886ea34391e", "filename": "gcc/tree-if-conv.c", "status": "modified", "additions": 4, "deletions": 24, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e7437b594f9c54bc07a2ef0bda9801ce62b1eab7/gcc%2Ftree-if-conv.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e7437b594f9c54bc07a2ef0bda9801ce62b1eab7/gcc%2Ftree-if-conv.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-if-conv.c?ref=e7437b594f9c54bc07a2ef0bda9801ce62b1eab7", "patch": "@@ -416,24 +416,6 @@ fold_or_predicates (location_t loc, tree c1, tree c2)\n   return fold_build2_loc (loc, TRUTH_OR_EXPR, boolean_type_node, c1, c2);\n }\n \n-/* Returns true if N is either a constant or a SSA_NAME.  */\n-\n-static bool\n-constant_or_ssa_name (tree n)\n-{\n-  switch (TREE_CODE (n))\n-    {\n-      case SSA_NAME:\n-      case INTEGER_CST:\n-      case REAL_CST:\n-      case COMPLEX_CST:\n-      case VECTOR_CST:\n-\treturn true;\n-      default:\n-\treturn false;\n-    }\n-}\n-\n /* Returns either a COND_EXPR or the folded expression if the folded\n    expression is a MIN_EXPR, a MAX_EXPR, an ABS_EXPR,\n    a constant or a SSA_NAME. */\n@@ -454,22 +436,21 @@ fold_build_cond_expr (tree type, tree cond, tree rhs, tree lhs)\n \t  && (integer_zerop (op1)))\n \tcond = op0;\n     }\n-  cond_expr = fold_ternary (COND_EXPR, type, cond,\n-\t\t\t    rhs, lhs);\n+  cond_expr = fold_ternary (COND_EXPR, type, cond, rhs, lhs);\n \n   if (cond_expr == NULL_TREE)\n     return build3 (COND_EXPR, type, cond, rhs, lhs);\n \n   STRIP_USELESS_TYPE_CONVERSION (cond_expr);\n \n-  if (constant_or_ssa_name (cond_expr))\n+  if (is_gimple_val (cond_expr))\n     return cond_expr;\n \n   if (TREE_CODE (cond_expr) == ABS_EXPR)\n     {\n       rhs1 = TREE_OPERAND (cond_expr, 1);\n       STRIP_USELESS_TYPE_CONVERSION (rhs1);\n-      if (constant_or_ssa_name (rhs1))\n+      if (is_gimple_val (rhs1))\n \treturn build1 (ABS_EXPR, type, rhs1);\n     }\n \n@@ -480,8 +461,7 @@ fold_build_cond_expr (tree type, tree cond, tree rhs, tree lhs)\n       STRIP_USELESS_TYPE_CONVERSION (lhs1);\n       rhs1 = TREE_OPERAND (cond_expr, 1);\n       STRIP_USELESS_TYPE_CONVERSION (rhs1);\n-      if (constant_or_ssa_name (rhs1)\n-\t  && constant_or_ssa_name (lhs1))\n+      if (is_gimple_val (rhs1) && is_gimple_val (lhs1))\n \treturn build2 (TREE_CODE (cond_expr), type, lhs1, rhs1);\n     }\n   return build3 (COND_EXPR, type, cond, rhs, lhs);"}]}