{"sha": "e9191ad3ab89826936060c5e13800ce6be4f650c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTkxOTFhZDNhYjg5ODI2OTM2MDYwYzVlMTM4MDBjZTZiZTRmNjUwYw==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2016-01-19T11:57:41Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2016-01-19T11:57:41Z"}, "message": "re PR lto/69133 (LTO segfault in lto_get_decl_name_mapping() on 483.xalancbmk with -flto-partition=none)\n\n\n\tPR lto/69133\n\t* cgraphunit.c (cgraph_node::expand_thunk): When forcing gimple\n\tassume that the node has body.\n\t* cgraph.c (cgraph_node::get_untransformed_body): Use gimple_body_p\n\tcheck.\n\t* g++.dg/lto/pr69133_0.C: New testcase.\n\t* g++.dg/lto/pr69133_1.C: New testcase.\n\nFrom-SVN: r232552", "tree": {"sha": "f304db9cdc8550c316d6ea4709de8f5b53d0d35d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f304db9cdc8550c316d6ea4709de8f5b53d0d35d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e9191ad3ab89826936060c5e13800ce6be4f650c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e9191ad3ab89826936060c5e13800ce6be4f650c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e9191ad3ab89826936060c5e13800ce6be4f650c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e9191ad3ab89826936060c5e13800ce6be4f650c/comments", "author": null, "committer": null, "parents": [{"sha": "150be262b98a8601cbc470c789c5b7b0907ddfb4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/150be262b98a8601cbc470c789c5b7b0907ddfb4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/150be262b98a8601cbc470c789c5b7b0907ddfb4"}], "stats": {"total": 65, "additions": 62, "deletions": 3}, "files": [{"sha": "717330d16fc072bf63c50f9a58d0ce625b2c9ea3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9191ad3ab89826936060c5e13800ce6be4f650c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9191ad3ab89826936060c5e13800ce6be4f650c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e9191ad3ab89826936060c5e13800ce6be4f650c", "patch": "@@ -1,3 +1,11 @@\n+2016-01-19  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\tPR lto/69133\n+\t* cgraphunit.c (cgraph_node::expand_thunk): When forcing gimple\n+\tassume that the node has body.\n+\t* cgraph.c (cgraph_node::get_untransformed_body): Use gimple_body_p\n+\tcheck.\n+\t\n 2016-01-19  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* lto-streamer-out.c (lto_output): Do not stream instrumentation"}, {"sha": "5331f7f373b23569a8f02fd32eb314fda7e201e8", "filename": "gcc/cgraph.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9191ad3ab89826936060c5e13800ce6be4f650c/gcc%2Fcgraph.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9191ad3ab89826936060c5e13800ce6be4f650c/gcc%2Fcgraph.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.c?ref=e9191ad3ab89826936060c5e13800ce6be4f650c", "patch": "@@ -3305,10 +3305,12 @@ cgraph_node::get_untransformed_body (void)\n   size_t len;\n   tree decl = this->decl;\n \n-  if (DECL_RESULT (decl))\n+  /* Check if body is already there.  Either we have gimple body or\n+     the function is thunk and in that case we set DECL_ARGUMENTS.  */\n+  if (DECL_ARGUMENTS (decl) || gimple_has_body_p (decl))\n     return false;\n \n-  gcc_assert (in_lto_p);\n+  gcc_assert (in_lto_p && !DECL_RESULT (decl));\n \n   timevar_push (TV_IPA_LTO_GIMPLE_IN);\n "}, {"sha": "2c49d7b0ac533d0e632566989229088e5503594f", "filename": "gcc/cgraphunit.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9191ad3ab89826936060c5e13800ce6be4f650c/gcc%2Fcgraphunit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9191ad3ab89826936060c5e13800ce6be4f650c/gcc%2Fcgraphunit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraphunit.c?ref=e9191ad3ab89826936060c5e13800ce6be4f650c", "patch": "@@ -1664,7 +1664,9 @@ cgraph_node::expand_thunk (bool output_asm_thunks, bool force_gimple_thunk)\n       greturn *ret;\n       bool alias_is_noreturn = TREE_THIS_VOLATILE (alias);\n \n-      if (in_lto_p)\n+      /* We may be called from expand_thunk that releses body except for\n+\t DECL_ARGUMENTS.  In this case force_gimple_thunk is true.  */\n+      if (in_lto_p && !force_gimple_thunk)\n \tget_untransformed_body ();\n       a = DECL_ARGUMENTS (thunk_fndecl);\n "}, {"sha": "6f9a2a64c1b912818404a778eb8786ba310aecea", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9191ad3ab89826936060c5e13800ce6be4f650c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9191ad3ab89826936060c5e13800ce6be4f650c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e9191ad3ab89826936060c5e13800ce6be4f650c", "patch": "@@ -1,3 +1,9 @@\n+2016-01-19  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\tPR lto/69133\n+\t* g++.dg/lto/pr69133_0.C: New testcase.\n+\t* g++.dg/lto/pr69133_1.C: New testcase.\n+\n 2016-01-15  Jeff Law  <law@redhat.com>\n \n \tPR tree-optimization/69320"}, {"sha": "bd667074b7b6e242dc81a873ca36602ddbadb5db", "filename": "gcc/testsuite/g++.dg/lto/pr69133_0.C", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9191ad3ab89826936060c5e13800ce6be4f650c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr69133_0.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9191ad3ab89826936060c5e13800ce6be4f650c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr69133_0.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr69133_0.C?ref=e9191ad3ab89826936060c5e13800ce6be4f650c", "patch": "@@ -0,0 +1,19 @@\n+// { dg-lto-do link }\n+// { dg-lto-options { { -flto -O2 } } }\n+// { dg-extra-ld-options \"-r -nostdlib -flto -flto-partition=none -O2\" }\n+namespace xercesc_3_1 {\n+class XMLEntityHandler {\n+public:\n+  virtual ~XMLEntityHandler();\n+  virtual void m_fn1();\n+  virtual bool m_fn2();\n+  virtual void m_fn3();\n+  virtual int m_fn4();\n+  virtual void m_fn5();\n+} * a;\n+void fn1() {\n+  a->m_fn5();\n+  a->m_fn1();\n+}\n+}\n+"}, {"sha": "24c477d73c33d0338082c1ad3abe58eb983cb073", "filename": "gcc/testsuite/g++.dg/lto/pr69133_1.C", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9191ad3ab89826936060c5e13800ce6be4f650c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr69133_1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9191ad3ab89826936060c5e13800ce6be4f650c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr69133_1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr69133_1.C?ref=e9191ad3ab89826936060c5e13800ce6be4f650c", "patch": "@@ -0,0 +1,22 @@\n+namespace xercesc_3_1 {\n+class A {\n+  virtual void m_fn1();\n+};\n+class XMLEntityHandler {\n+public:\n+  virtual ~XMLEntityHandler();\n+  virtual void m_fn2(const int &);\n+  virtual bool m_fn3();\n+  virtual void m_fn4();\n+  virtual int m_fn5() = 0;\n+  virtual void m_fn6(const int &);\n+};\n+class B : A, XMLEntityHandler {};\n+class C : B {\n+  void m_fn2(const int &);\n+  void m_fn6(const int &);\n+};\n+void C::m_fn2(const int &) {}\n+void C::m_fn6(const int &) {}\n+}\n+"}]}