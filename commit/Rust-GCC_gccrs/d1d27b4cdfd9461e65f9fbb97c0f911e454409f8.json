{"sha": "d1d27b4cdfd9461e65f9fbb97c0f911e454409f8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDFkMjdiNGNkZmQ5NDYxZTY1ZjlmYmI5N2MwZjkxMWU0NTQ0MDlmOA==", "commit": {"author": {"name": "Michael Meissner", "email": "meissner@gcc.gnu.org", "date": "1995-04-14T17:06:46Z"}, "committer": {"name": "Michael Meissner", "email": "meissner@gcc.gnu.org", "date": "1995-04-14T17:06:46Z"}, "message": "Emit eabi's main call to __eabi before setting up the minimal TOC, rather than after.\n\nFrom-SVN: r9382", "tree": {"sha": "0ef0ea0d22f0b171f3b76a1b4766ea0277632751", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0ef0ea0d22f0b171f3b76a1b4766ea0277632751"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d1d27b4cdfd9461e65f9fbb97c0f911e454409f8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1d27b4cdfd9461e65f9fbb97c0f911e454409f8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d1d27b4cdfd9461e65f9fbb97c0f911e454409f8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1d27b4cdfd9461e65f9fbb97c0f911e454409f8/comments", "author": null, "committer": null, "parents": [{"sha": "9973f4a2949b6de3b35752399aea27842e79efdd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9973f4a2949b6de3b35752399aea27842e79efdd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9973f4a2949b6de3b35752399aea27842e79efdd"}], "stats": {"total": 20, "additions": 19, "deletions": 1}, "files": [{"sha": "9d19ea0a38612a8e91367f1baeef8edc3d05d1d3", "filename": "gcc/config/rs6000/eabi.h", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1d27b4cdfd9461e65f9fbb97c0f911e454409f8/gcc%2Fconfig%2Frs6000%2Feabi.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1d27b4cdfd9461e65f9fbb97c0f911e454409f8/gcc%2Fconfig%2Frs6000%2Feabi.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Feabi.h?ref=d1d27b4cdfd9461e65f9fbb97c0f911e454409f8", "patch": "@@ -50,7 +50,6 @@ the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.  */\n   ((TARGET_RELOCATABLE) ? \"\\t.section\\t\\\".got2\\\",\\\"aw\\\"\" : \"\\t.section\\t\\\".got1\\\",\\\"aw\\\"\")\n \n /* Invoke an initializer function to set up the GOT */\n-#define INVOKE__main 1\n #define NAME__MAIN \"__eabi\"\n \n #undef TARGET_VERSION"}, {"sha": "ce2463d5f26c76fc796cef45171cfb9fda16d82b", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1d27b4cdfd9461e65f9fbb97c0f911e454409f8/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1d27b4cdfd9461e65f9fbb97c0f911e454409f8/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=d1d27b4cdfd9461e65f9fbb97c0f911e454409f8", "patch": "@@ -1612,6 +1612,19 @@ output_prolog (file, size)\n   int total_size = (basic_size + size + current_function_outgoing_args_size);\n   char buf[256];\n \n+  /* If this is eabi, call __eabi with main, but do so before the minimal TOC\n+     is setup, so we can't use the normal mechanism.  */\n+#if defined(USING_SVR4_H) && defined(NAME__MAIN) && !defined(INVOKE__main)\n+  int main_p = 0;\n+\n+  if (IDENTIFIER_LENGTH (DECL_NAME (current_function_decl)) == 4\n+      && !strcmp (IDENTIFIER_POINTER (DECL_NAME (current_function_decl)), \"main\"))\n+    {\n+      main_p = 1;\n+      regs_ever_live[65] = 1;\n+    }\n+#endif\n+\n   /* Round size to multiple of 8 bytes.  */\n   total_size = (total_size + 7) & ~7;\n \n@@ -1715,6 +1728,12 @@ output_prolog (file, size)\n   if (frame_pointer_needed)\n     asm_fprintf (file, \"\\tmr 31,1\\n\");\n \n+  /* If this is eabi, call __eabi before loading up the minimal TOC */\n+#if defined(USING_SVR4_H) && defined(NAME__MAIN) && !defined(INVOKE__main)\n+  if (main_p)\n+    fprintf (file, \"\\tbl %s\\n\", NAME__MAIN);\n+#endif\n+\n   /* If TARGET_MINIMAL_TOC, and the constant pool is needed, then load the\n      TOC_TABLE address into register 30.  */\n   if (TARGET_MINIMAL_TOC && get_pool_size () != 0)"}]}