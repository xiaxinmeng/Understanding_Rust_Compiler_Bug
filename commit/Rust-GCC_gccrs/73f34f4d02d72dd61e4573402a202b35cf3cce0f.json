{"sha": "73f34f4d02d72dd61e4573402a202b35cf3cce0f", "node_id": "C_kwDOANBUbNoAKDczZjM0ZjRkMDJkNzJkZDYxZTQ1NzM0MDJhMjAyYjM1Y2YzY2NlMGY", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2021-10-14T15:35:42Z"}, "committer": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2021-10-14T15:35:42Z"}, "message": "rs6000: Fix memory leak in rs6000_density_test\n\nrs6000_density_test has an early exit test between a call\nto get_loop_body and the corresponding free.  This would\nlead to a memory leak if the early exit is taken.\n\ngcc/\n\t* config/rs6000/rs6000.c (rs6000_density_test): Move early\n\texit test further up the function.", "tree": {"sha": "d68c11e8bcd35d738c7177e6b8564dcc238c6f82", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d68c11e8bcd35d738c7177e6b8564dcc238c6f82"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/73f34f4d02d72dd61e4573402a202b35cf3cce0f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/73f34f4d02d72dd61e4573402a202b35cf3cce0f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/73f34f4d02d72dd61e4573402a202b35cf3cce0f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/73f34f4d02d72dd61e4573402a202b35cf3cce0f/comments", "author": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1975395021e34088865e6566e281622a218be70e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1975395021e34088865e6566e281622a218be70e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1975395021e34088865e6566e281622a218be70e"}], "stats": {"total": 17, "additions": 8, "deletions": 9}, "files": [{"sha": "01a95591a5dc9850efcdb61ca00b663c016dd27f", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 8, "deletions": 9, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/73f34f4d02d72dd61e4573402a202b35cf3cce0f/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/73f34f4d02d72dd61e4573402a202b35cf3cce0f/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=73f34f4d02d72dd61e4573402a202b35cf3cce0f", "patch": "@@ -5289,20 +5289,19 @@ struct rs6000_cost_data\n static void\n rs6000_density_test (rs6000_cost_data *data)\n {\n-  struct loop *loop = data->loop_info;\n-  basic_block *bbs = get_loop_body (loop);\n-  int nbbs = loop->num_nodes;\n-  loop_vec_info loop_vinfo = loop_vec_info_for_loop (data->loop_info);\n-  int vec_cost = data->cost[vect_body], not_vec_cost = 0;\n-  int i, density_pct;\n-\n   /* This density test only cares about the cost of vector version of the\n      loop, so immediately return if we are passed costing for the scalar\n      version (namely computing single scalar iteration cost).  */\n   if (data->costing_for_scalar)\n     return;\n \n-  for (i = 0; i < nbbs; i++)\n+  struct loop *loop = data->loop_info;\n+  basic_block *bbs = get_loop_body (loop);\n+  int nbbs = loop->num_nodes;\n+  loop_vec_info loop_vinfo = loop_vec_info_for_loop (data->loop_info);\n+  int vec_cost = data->cost[vect_body], not_vec_cost = 0;\n+\n+  for (int i = 0; i < nbbs; i++)\n     {\n       basic_block bb = bbs[i];\n       gimple_stmt_iterator gsi;\n@@ -5322,7 +5321,7 @@ rs6000_density_test (rs6000_cost_data *data)\n     }\n \n   free (bbs);\n-  density_pct = (vec_cost * 100) / (vec_cost + not_vec_cost);\n+  int density_pct = (vec_cost * 100) / (vec_cost + not_vec_cost);\n \n   if (density_pct > rs6000_density_pct_threshold\n       && vec_cost + not_vec_cost > rs6000_density_size_threshold)"}]}