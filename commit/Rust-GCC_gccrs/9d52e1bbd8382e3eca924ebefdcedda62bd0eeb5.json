{"sha": "9d52e1bbd8382e3eca924ebefdcedda62bd0eeb5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWQ1MmUxYmJkODM4MmUzZWNhOTI0ZWJlZmRjZWRkYTYyYmQwZWViNQ==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2019-02-19T17:55:33Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2019-02-19T17:55:33Z"}, "message": "re PR fortran/89384 (CONTIGUOUS dummy argument in BIND(C) interface incorrect when actual is non-contiguous)\n\n2019-02-19  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/89384\n\t* trans-expr.c (gfc_conv_gfc_desc_to_cfi_desc): If the dummy\n\targument is contiguous and the actual argument may not be,\n\tuse gfc_conv_subref_array_arg.\n\n2019-02-19  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/89384\n\t* gfortran.dg/ISO_Fortran_binding_4.f90\n\nFrom-SVN: r269024", "tree": {"sha": "89e68ed04fe51932a7ab89dde88cb80e8b980e89", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/89e68ed04fe51932a7ab89dde88cb80e8b980e89"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9d52e1bbd8382e3eca924ebefdcedda62bd0eeb5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d52e1bbd8382e3eca924ebefdcedda62bd0eeb5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9d52e1bbd8382e3eca924ebefdcedda62bd0eeb5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d52e1bbd8382e3eca924ebefdcedda62bd0eeb5/comments", "author": null, "committer": null, "parents": [{"sha": "fe95aee9ce0a163194d4c986d15bd2b8f2abed3d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fe95aee9ce0a163194d4c986d15bd2b8f2abed3d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fe95aee9ce0a163194d4c986d15bd2b8f2abed3d"}], "stats": {"total": 46, "additions": 45, "deletions": 1}, "files": [{"sha": "ae06290ca8bd50e9fe2de8a555623617045f6378", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d52e1bbd8382e3eca924ebefdcedda62bd0eeb5/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d52e1bbd8382e3eca924ebefdcedda62bd0eeb5/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=9d52e1bbd8382e3eca924ebefdcedda62bd0eeb5", "patch": "@@ -1,3 +1,10 @@\n+2019-02-19  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/89384\n+\t* trans-expr.c (gfc_conv_gfc_desc_to_cfi_desc): If the dummy\n+\targument is contiguous and the actual argument may not be,\n+\tuse gfc_conv_subref_array_arg.\n+\n 2019-02-19  Chung-Lin Tang  <cltang@codesourcery.com>\n \n \tPR c/87924"}, {"sha": "223fd14cd7b984a05ee9bda8f6b65b90874c8991", "filename": "gcc/fortran/trans-expr.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d52e1bbd8382e3eca924ebefdcedda62bd0eeb5/gcc%2Ffortran%2Ftrans-expr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d52e1bbd8382e3eca924ebefdcedda62bd0eeb5/gcc%2Ffortran%2Ftrans-expr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-expr.c?ref=9d52e1bbd8382e3eca924ebefdcedda62bd0eeb5", "patch": "@@ -4944,7 +4944,12 @@ gfc_conv_gfc_desc_to_cfi_desc (gfc_se *parmse, gfc_expr *e, gfc_symbol *fsym)\n \n   if (e->rank != 0)\n     {\n-      gfc_conv_expr_descriptor (parmse, e);\n+      if (fsym->attr.contiguous\n+\t  && !gfc_is_simply_contiguous (e, false, true))\n+\tgfc_conv_subref_array_arg (parmse, e, false, fsym->attr.intent,\n+\t\t\t\t   fsym->attr.pointer);\n+      else\n+\tgfc_conv_expr_descriptor (parmse, e);\n \n       if (POINTER_TYPE_P (TREE_TYPE (parmse->expr)))\n \tparmse->expr = build_fold_indirect_ref_loc (input_location,"}, {"sha": "4ea21550f0dcd2ebd17e8e7147d1be617b643bb9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d52e1bbd8382e3eca924ebefdcedda62bd0eeb5/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d52e1bbd8382e3eca924ebefdcedda62bd0eeb5/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9d52e1bbd8382e3eca924ebefdcedda62bd0eeb5", "patch": "@@ -1,3 +1,8 @@\n+2019-02-19  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/89384\n+\t* gfortran.dg/ISO_Fortran_binding_4.f90\n+\n 2019-02-19  Thomas Schwinge  <thomas@codesourcery.com>\n \n \tPR c/87924"}, {"sha": "2c6c81b2557aa60a22f339e6164a415f56f49fbd", "filename": "gcc/testsuite/gfortran.dg/ISO_Fortran_binding_4.f90", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d52e1bbd8382e3eca924ebefdcedda62bd0eeb5/gcc%2Ftestsuite%2Fgfortran.dg%2FISO_Fortran_binding_4.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d52e1bbd8382e3eca924ebefdcedda62bd0eeb5/gcc%2Ftestsuite%2Fgfortran.dg%2FISO_Fortran_binding_4.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2FISO_Fortran_binding_4.f90?ref=9d52e1bbd8382e3eca924ebefdcedda62bd0eeb5", "patch": "@@ -0,0 +1,27 @@\n+! { dg-do  run }\n+! PR fortran/89384 - this used to give a wrong results\n+! with contiguous.\n+! Test case by Reinhold Bader.\n+module mod_ctg\n+  implicit none\n+contains\n+  subroutine ctg(x) BIND(C)\n+    real, contiguous :: x(:)\n+\n+    if (any(abs(x - [2.,4.,6.]) > 1.e-6)) then\n+       write(*,*) 'FAIL'\n+    else\n+       write(*,*) 'OK'\n+    end if\n+  end subroutine\n+end module\n+program p\n+  use mod_ctg\n+  implicit none\n+  real :: x(6)\n+  integer :: i\n+\n+  x = [ (real(i), i=1, size(x)) ]\n+  call ctg(x(2::2))\n+\n+end program"}]}