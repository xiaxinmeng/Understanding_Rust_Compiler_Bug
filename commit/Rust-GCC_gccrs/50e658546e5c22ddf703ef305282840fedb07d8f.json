{"sha": "50e658546e5c22ddf703ef305282840fedb07d8f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTBlNjU4NTQ2ZTVjMjJkZGY3MDNlZjMwNTI4Mjg0MGZlZGIwN2Q4Zg==", "commit": {"author": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1993-05-04T00:10:51Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1993-05-04T00:10:51Z"}, "message": "(grokdeclarator, ARRAY_REF case): Build array type, and\nthen build the variant array type.\n\nFrom-SVN: r4314", "tree": {"sha": "8f54c059f3a8b67028e639739587b415d9bd1d4d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8f54c059f3a8b67028e639739587b415d9bd1d4d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/50e658546e5c22ddf703ef305282840fedb07d8f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50e658546e5c22ddf703ef305282840fedb07d8f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/50e658546e5c22ddf703ef305282840fedb07d8f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50e658546e5c22ddf703ef305282840fedb07d8f/comments", "author": null, "committer": null, "parents": [{"sha": "1d77b9c11d2145e67b4b5957ea7bb792d1c7dfb1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1d77b9c11d2145e67b4b5957ea7bb792d1c7dfb1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1d77b9c11d2145e67b4b5957ea7bb792d1c7dfb1"}], "stats": {"total": 11, "additions": 7, "deletions": 4}, "files": [{"sha": "fa7d5bc567ecfb11c0586cfc951f3a7fce21d05e", "filename": "gcc/c-decl.c", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50e658546e5c22ddf703ef305282840fedb07d8f/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50e658546e5c22ddf703ef305282840fedb07d8f/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=50e658546e5c22ddf703ef305282840fedb07d8f", "patch": "@@ -4189,15 +4189,19 @@ grokdeclarator (declarator, declspecs, decl_context, initialized)\n \t    warning (\"array type has incomplete element type\");\n #endif\n \n-\t  /* Build the array type itself.\n-\t     Merge any constancy or volatility into the target type.  */\n-\n #if 0  /* We shouldn't have a function type here at all!\n \t  Functions aren't allowed as array elements.  */\n \t  if (pedantic && TREE_CODE (type) == FUNCTION_TYPE\n \t      && (constp || volatilep))\n \t    pedwarn (\"ANSI C forbids const or volatile function types\");\n #endif\n+\n+\t  /* Build the array type itself, then merge any constancy or\n+\t     volatility into the target type.  We must do it in this order\n+\t     to ensure that the TYPE_MAIN_VARIANT field of the array type\n+\t     is set correctly.  */\n+\n+\t  type = build_array_type (type, itype);\n \t  if (constp || volatilep)\n \t    type = c_build_type_variant (type, constp, volatilep);\n \n@@ -4207,7 +4211,6 @@ grokdeclarator (declarator, declspecs, decl_context, initialized)\n \t  volatilep = 0;\n #endif\n \n-\t  type = build_array_type (type, itype);\n \t  if (size_varies)\n \t    C_TYPE_VARIABLE_SIZE (type) = 1;\n \t}"}]}