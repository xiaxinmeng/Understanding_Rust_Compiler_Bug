{"sha": "61e00a5e0d9676dacd7e407d6b797146f10aae7f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjFlMDBhNWUwZDk2NzZkYWNkN2U0MDdkNmI3OTcxNDZmMTBhYWU3Zg==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2006-10-15T16:20:06Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2006-10-15T16:20:06Z"}, "message": "re PR middle-end/29299 (gcc \"used\" attribute has no effect on local-scope static variables)\n\n\tPR middle-end/29299\n\t* cgraphunit.c (cgraph_finalize_compilation_unit): Call\n\tprocess_function_and_variable_attributes on all variables, including\n\tthose discovered during cgraph construction phase.\n\nFrom-SVN: r117746", "tree": {"sha": "40fc048501d66f0b1d5def16d9ebe2a7ba1b8202", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/40fc048501d66f0b1d5def16d9ebe2a7ba1b8202"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/61e00a5e0d9676dacd7e407d6b797146f10aae7f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/61e00a5e0d9676dacd7e407d6b797146f10aae7f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/61e00a5e0d9676dacd7e407d6b797146f10aae7f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/61e00a5e0d9676dacd7e407d6b797146f10aae7f/comments", "author": null, "committer": null, "parents": [{"sha": "70c99f6c02013c9de34ce838732dd370d7ca379e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/70c99f6c02013c9de34ce838732dd370d7ca379e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/70c99f6c02013c9de34ce838732dd370d7ca379e"}], "stats": {"total": 38, "additions": 34, "deletions": 4}, "files": [{"sha": "bf63002e460eb261b2ada0d55f8e0c08191d8c21", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/61e00a5e0d9676dacd7e407d6b797146f10aae7f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/61e00a5e0d9676dacd7e407d6b797146f10aae7f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=61e00a5e0d9676dacd7e407d6b797146f10aae7f", "patch": "@@ -1,3 +1,11 @@\n+2006-10-15  Jan Hubicka  <jh@suse.cz>\n+            Richard Guenther  <rguenther@suse.de>\n+\n+\tPR middle-end/29299\n+\t* cgraphunit.c (cgraph_finalize_compilation_unit): Call\n+\tprocess_function_and_variable_attributes on all variables, including\n+\tthose discovered during cgraph construction phase.\n+\n 2006-10-15  Bernhard Fischer  <aldot@gcc.gnu.org>\n \n \t* final.c: Update Copyright year. Commentary typo fix. Fix whitespace"}, {"sha": "d7ad793db5b9fbe8537a893eac756d8c3ae557cc", "filename": "gcc/cgraphunit.c", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/61e00a5e0d9676dacd7e407d6b797146f10aae7f/gcc%2Fcgraphunit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/61e00a5e0d9676dacd7e407d6b797146f10aae7f/gcc%2Fcgraphunit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraphunit.c?ref=61e00a5e0d9676dacd7e407d6b797146f10aae7f", "patch": "@@ -1055,6 +1055,7 @@ cgraph_finalize_compilation_unit (void)\n   /* Keep track of already processed nodes when called multiple times for\n      intermodule optimization.  */\n   static struct cgraph_node *first_analyzed;\n+  struct cgraph_node *first_processed = first_analyzed;\n   static struct cgraph_varpool_node *first_analyzed_var;\n \n   if (errorcount || sorrycount)\n@@ -1077,7 +1078,10 @@ cgraph_finalize_compilation_unit (void)\n     }\n \n   timevar_push (TV_CGRAPH);\n-  process_function_and_variable_attributes (first_analyzed, first_analyzed_var);\n+  process_function_and_variable_attributes (first_processed,\n+\t\t\t\t\t    first_analyzed_var);\n+  first_processed = cgraph_nodes;\n+  first_analyzed_var = cgraph_varpool_nodes;\n   cgraph_varpool_analyze_pending_decls ();\n   if (cgraph_dump_file)\n     {\n@@ -1119,11 +1123,16 @@ cgraph_finalize_compilation_unit (void)\n \tif (!edge->callee->reachable)\n \t  cgraph_mark_reachable_node (edge->callee);\n \n+      /* We finalize local static variables during constructing callgraph\n+         edges.  Process their attributes too.  */\n+      process_function_and_variable_attributes (first_processed,\n+\t\t\t\t\t\tfirst_analyzed_var);\n+      first_processed = cgraph_nodes;\n+      first_analyzed_var = cgraph_varpool_nodes;\n       cgraph_varpool_analyze_pending_decls ();\n     }\n \n-  /* Collect entry points to the unit.  */\n-\n+/bin/bash: line 1: :Q: command not found\n   if (cgraph_dump_file)\n     {\n       fprintf (cgraph_dump_file, \"Unit entry points:\");\n@@ -1163,7 +1172,6 @@ cgraph_finalize_compilation_unit (void)\n       dump_cgraph (cgraph_dump_file);\n     }\n   first_analyzed = cgraph_nodes;\n-  first_analyzed_var = cgraph_varpool_nodes;\n   ggc_collect ();\n   timevar_pop (TV_CGRAPH);\n }"}, {"sha": "c2ff6c22b40f045b2a8bd4bbc878946fadceca51", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/61e00a5e0d9676dacd7e407d6b797146f10aae7f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/61e00a5e0d9676dacd7e407d6b797146f10aae7f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=61e00a5e0d9676dacd7e407d6b797146f10aae7f", "patch": "@@ -1,3 +1,7 @@\n+2006-10-15  Richard Guenther  <rguenther@suse.de>\n+\n+\t* gcc.dg/pr29299.c: New testcase.\n+\n 2006-10-15  Bernhard Fischer  <aldot@gcc.gnu.org>\n \n \tPR fortran/24767"}, {"sha": "9049060fae452d71e624bc46d49a04cd1354767d", "filename": "gcc/testsuite/gcc.dg/pr29299.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/61e00a5e0d9676dacd7e407d6b797146f10aae7f/gcc%2Ftestsuite%2Fgcc.dg%2Fpr29299.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/61e00a5e0d9676dacd7e407d6b797146f10aae7f/gcc%2Ftestsuite%2Fgcc.dg%2Fpr29299.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr29299.c?ref=61e00a5e0d9676dacd7e407d6b797146f10aae7f", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O\" } */\n+\n+static int bof __attribute__((used));\n+int foo()\n+{\n+\tstatic int barbarbarbar __attribute__((used));\n+};\n+\n+/* { dg-final { scan-assembler \"barbarbarbar\" } } */"}]}