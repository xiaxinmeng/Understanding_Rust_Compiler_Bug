{"sha": "6b7d84532342ed038a07d850ddacf7a86106a998", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmI3ZDg0NTMyMzQyZWQwMzhhMDdkODUwZGRhY2Y3YTg2MTA2YTk5OA==", "commit": {"author": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2016-12-04T14:38:05Z"}, "committer": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2016-12-04T14:38:05Z"}, "message": "re PR target/70322 (STV doesn't optimize andn)\n\n\tPR target/70322\n\t* config/i386/i386.c (dimode_scalar_to_vector_candidate_p): Handle NEG.\n\t(dimode_scalar_chain::compute_convert_gain): Ditto.\n\t(dimode_scalar_chain::convert_insn): Ditto.\n\ntestsuite/ChangeLog:\n\n\tPR target/70322\n\t* gcc.target/i386/pr70322-4.c: New test.\n\nFrom-SVN: r243228", "tree": {"sha": "7e3242ff6da9239e948b52cac4248cba291a04c3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7e3242ff6da9239e948b52cac4248cba291a04c3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6b7d84532342ed038a07d850ddacf7a86106a998", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6b7d84532342ed038a07d850ddacf7a86106a998", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6b7d84532342ed038a07d850ddacf7a86106a998", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6b7d84532342ed038a07d850ddacf7a86106a998/comments", "author": null, "committer": null, "parents": [{"sha": "c818397a989cda38cf335a411360307dea311c99", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c818397a989cda38cf335a411360307dea311c99", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c818397a989cda38cf335a411360307dea311c99"}], "stats": {"total": 42, "additions": 39, "deletions": 3}, "files": [{"sha": "e888c036fe1567006eced2b6be68e2a4fbb28b83", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6b7d84532342ed038a07d850ddacf7a86106a998/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6b7d84532342ed038a07d850ddacf7a86106a998/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6b7d84532342ed038a07d850ddacf7a86106a998", "patch": "@@ -1,10 +1,17 @@\n+2016-12-04  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\tPR target/70322\n+\t* config/i386/i386.c (dimode_scalar_to_vector_candidate_p): Handle NEG.\n+\t(dimode_scalar_chain::compute_convert_gain): Ditto.\n+\t(dimode_scalar_chain::convert_insn): Ditto.\n+\n 2016-12-03  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* lra-constraints.c (emit_spill_move): Use gen_lowpart_SUBREG in all\n \tcases to build a lowpart SUBREG.\n \n 2016-12-03  Eric Botcazou  <ebotcazou@adacore.com>\n-            David S. Miller  <davem@davemloft.net>\n+\t    David S. Miller  <davem@davemloft.net>\n \n \t* config/sparc/constraints.md (U): Adjust comment.\n \t* config/sparc/sparc.md (lra): New attribute."}, {"sha": "41717da822afe34e92d74a35187ff4fb50e61043", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6b7d84532342ed038a07d850ddacf7a86106a998/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6b7d84532342ed038a07d850ddacf7a86106a998/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=6b7d84532342ed038a07d850ddacf7a86106a998", "patch": "@@ -2826,6 +2826,7 @@ dimode_scalar_to_vector_candidate_p (rtx_insn *insn)\n \treturn false;\n       break;\n \n+    case NEG:\n     case NOT:\n       break;\n \n@@ -2851,7 +2852,8 @@ dimode_scalar_to_vector_candidate_p (rtx_insn *insn)\n \n   if ((GET_MODE (XEXP (src, 0)) != DImode\n        && !CONST_INT_P (XEXP (src, 0)))\n-      || (GET_CODE (src) != NOT\n+      || (GET_CODE (src) != NEG\n+\t  && GET_CODE (src) != NOT\n \t  && GET_MODE (XEXP (src, 1)) != DImode\n \t  && !CONST_INT_P (XEXP (src, 1))))\n     return false;\n@@ -3419,7 +3421,8 @@ dimode_scalar_chain::compute_convert_gain ()\n \t  if (CONST_INT_P (XEXP (src, 1)))\n \t    gain -= vector_const_cost (XEXP (src, 1));\n \t}\n-      else if (GET_CODE (src) == NOT)\n+      else if (GET_CODE (src) == NEG\n+\t       || GET_CODE (src) == NOT)\n \tgain += ix86_cost->add - COSTS_N_INSNS (1);\n       else if (GET_CODE (src) == COMPARE)\n \t{\n@@ -3776,6 +3779,14 @@ dimode_scalar_chain::convert_insn (rtx_insn *insn)\n       PUT_MODE (src, V2DImode);\n       break;\n \n+    case NEG:\n+      src = XEXP (src, 0);\n+      convert_op (&src, insn);\n+      subreg = gen_reg_rtx (V2DImode);\n+      emit_insn_before (gen_move_insn (subreg, CONST0_RTX (V2DImode)), insn);\n+      src = gen_rtx_MINUS (V2DImode, subreg, src);\n+      break;\n+\n     case NOT:\n       src = XEXP (src, 0);\n       convert_op (&src, insn);"}, {"sha": "a323678ff7f9a328be12134caadf32f5a1ee94c0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6b7d84532342ed038a07d850ddacf7a86106a998/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6b7d84532342ed038a07d850ddacf7a86106a998/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6b7d84532342ed038a07d850ddacf7a86106a998", "patch": "@@ -1,3 +1,8 @@\n+2016-12-04  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\tPR target/70322\n+\t* gcc.target/i386/pr70322-4.c: New test.\n+\n 2016-12-03  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/43207"}, {"sha": "8a02b9b031f940e9e354d7f5e2b785911d74bfc8", "filename": "gcc/testsuite/gcc.target/i386/pr70322-4.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6b7d84532342ed038a07d850ddacf7a86106a998/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr70322-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6b7d84532342ed038a07d850ddacf7a86106a998/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr70322-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr70322-4.c?ref=6b7d84532342ed038a07d850ddacf7a86106a998", "patch": "@@ -0,0 +1,13 @@\n+/* PR target/70322 */\n+/* { dg-do compile { target ia32 } } */\n+/* { dg-options \"-O2 -msse2 -mstv\" } */\n+/* { dg-final { scan-assembler \"psub\" } } */\n+/* { dg-final { scan-assembler \"por\" } } */\n+\n+extern long long z;\n+\n+void\n+foo (long long x, long long y)\n+{\n+  z = -x | y;\n+}"}]}