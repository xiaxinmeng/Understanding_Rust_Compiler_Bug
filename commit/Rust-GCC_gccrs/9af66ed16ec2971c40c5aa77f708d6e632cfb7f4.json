{"sha": "9af66ed16ec2971c40c5aa77f708d6e632cfb7f4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWFmNjZlZDE2ZWMyOTcxYzQwYzVhYTc3ZjcwOGQ2ZTYzMmNmYjdmNA==", "commit": {"author": {"name": "Dodji Seketeli", "email": "dodji@redhat.com", "date": "2009-11-28T22:55:52Z"}, "committer": {"name": "Dodji Seketeli", "email": "dodji@gcc.gnu.org", "date": "2009-11-28T22:55:52Z"}, "message": "re PR c++/36408 (ICE with statement expression in template)\n\nFix PR c++/36408\n\ngcc/cp/ChangeLog:\n\n\tPR c++/36408\n\t* cp-tree.h (empty_expr_stmt_p): Declare ...\n\t* semantics.c (empty_expr_stmt_p): ... this.\n\t* pt.c (tsubst_copy_and_build) <STMT_EXPR>: Use it.\n\ngcc/testsuite/ChangeLog:\n\tPR c++/36408\n\t* g++.dg/template/stmtexpr2.C: New test.\n\nFrom-SVN: r154731", "tree": {"sha": "51b5fc9ae82f2b8773076c0364709413c0897090", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/51b5fc9ae82f2b8773076c0364709413c0897090"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9af66ed16ec2971c40c5aa77f708d6e632cfb7f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9af66ed16ec2971c40c5aa77f708d6e632cfb7f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9af66ed16ec2971c40c5aa77f708d6e632cfb7f4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9af66ed16ec2971c40c5aa77f708d6e632cfb7f4/comments", "author": null, "committer": null, "parents": [{"sha": "288d6a77c3fc3d7f2dcc879f10c460f95236688a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/288d6a77c3fc3d7f2dcc879f10c460f95236688a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/288d6a77c3fc3d7f2dcc879f10c460f95236688a"}], "stats": {"total": 70, "additions": 70, "deletions": 0}, "files": [{"sha": "4f5845305fe7f38c2eceb9a2c625d144cf26760b", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9af66ed16ec2971c40c5aa77f708d6e632cfb7f4/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9af66ed16ec2971c40c5aa77f708d6e632cfb7f4/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=9af66ed16ec2971c40c5aa77f708d6e632cfb7f4", "patch": "@@ -1,3 +1,10 @@\n+2009-11-28  Dodji Seketeli  <dodji@redhat.com>\n+\n+\tPR c++/36408\n+\t* cp-tree.h (empty_expr_stmt_p): Declare ...\n+\t* semantics.c (empty_expr_stmt_p): ... this.\n+\t* pt.c (tsubst_copy_and_build) <STMT_EXPR>: Use it.\n+\n 2009-11-27  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/38656"}, {"sha": "2d8f409ef7dc34de6a055f6b8a89714ec839c8e4", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9af66ed16ec2971c40c5aa77f708d6e632cfb7f4/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9af66ed16ec2971c40c5aa77f708d6e632cfb7f4/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=9af66ed16ec2971c40c5aa77f708d6e632cfb7f4", "patch": "@@ -5074,6 +5074,7 @@ extern tree begin_stmt_expr\t\t\t(void);\n extern tree finish_stmt_expr_expr\t\t(tree, tree);\n extern tree finish_stmt_expr\t\t\t(tree, bool);\n extern tree stmt_expr_value_expr\t\t(tree);\n+bool empty_expr_stmt_p\t\t\t\t(tree);\n extern tree perform_koenig_lookup\t\t(tree, VEC(tree,gc) *);\n extern tree finish_call_expr\t\t\t(tree, VEC(tree,gc) **, bool,\n \t\t\t\t\t\t bool, tsubst_flags_t);"}, {"sha": "eb1cdd3ca657162013b2c49808001e6faa49c598", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9af66ed16ec2971c40c5aa77f708d6e632cfb7f4/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9af66ed16ec2971c40c5aa77f708d6e632cfb7f4/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=9af66ed16ec2971c40c5aa77f708d6e632cfb7f4", "patch": "@@ -12544,6 +12544,11 @@ tsubst_copy_and_build (tree t,\n \tstmt_expr = finish_stmt_expr (stmt_expr, false);\n \tcur_stmt_expr = old_stmt_expr;\n \n+\t/* If the resulting list of expression statement is empty,\n+\t   fold it further into void_zero_node.  */\n+\tif (empty_expr_stmt_p (cur_stmt_expr))\n+\t  cur_stmt_expr = void_zero_node;\n+\n \treturn stmt_expr;\n       }\n "}, {"sha": "5253df85ff9e70c971d79bf18c509f3e98b171f2", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9af66ed16ec2971c40c5aa77f708d6e632cfb7f4/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9af66ed16ec2971c40c5aa77f708d6e632cfb7f4/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=9af66ed16ec2971c40c5aa77f708d6e632cfb7f4", "patch": "@@ -1847,6 +1847,32 @@ stmt_expr_value_expr (tree stmt_expr)\n   return t;\n }\n \n+/* Return TRUE iff EXPR_STMT is an empty list of\n+   expression statements.  */\n+\n+bool\n+empty_expr_stmt_p (tree expr_stmt)\n+{\n+  tree body = NULL_TREE;\n+\n+  if (expr_stmt)\n+    {\n+      if (TREE_CODE (expr_stmt) == EXPR_STMT)\n+\tbody = EXPR_STMT_EXPR (expr_stmt);\n+      else if (TREE_CODE (expr_stmt) == STATEMENT_LIST)\n+\tbody = expr_stmt;\n+    }\n+\n+    if (body)\n+      {\n+\tif (TREE_CODE (body) == STATEMENT_LIST)\n+\t  return tsi_end_p (tsi_start (body));\n+\telse\n+\t  return empty_expr_stmt_p (body);\n+      }\n+  return false;\n+}\n+\n /* Perform Koenig lookup.  FN is the postfix-expression representing\n    the function (or functions) to call; ARGS are the arguments to the\n    call.  Returns the functions to be considered by overload"}, {"sha": "cad8b2bd2ce959f13514331c4660bed8f370dbbb", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9af66ed16ec2971c40c5aa77f708d6e632cfb7f4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9af66ed16ec2971c40c5aa77f708d6e632cfb7f4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9af66ed16ec2971c40c5aa77f708d6e632cfb7f4", "patch": "@@ -1,3 +1,8 @@\n+2009-11-28  Dodji Seketeli  <dodji@redhat.com>\n+\n+\tPR c++/36408\n+\t* g++.dg/template/stmtexpr2.C: New test.\n+\n 2009-11-28  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/42183"}, {"sha": "ef29b43c59f9f59468d152c100ebeaef743013f3", "filename": "gcc/testsuite/g++.dg/template/stmtexpr2.C", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9af66ed16ec2971c40c5aa77f708d6e632cfb7f4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fstmtexpr2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9af66ed16ec2971c40c5aa77f708d6e632cfb7f4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fstmtexpr2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fstmtexpr2.C?ref=9af66ed16ec2971c40c5aa77f708d6e632cfb7f4", "patch": "@@ -0,0 +1,26 @@\n+// Contributed by Dodji Seketeli <dodji@redhat.com>\n+// Origin: PR c++/36408\n+// { dg-options \"\" }\n+// { dg-do compile }\n+\n+template<int>\n+void\n+foo()\n+{\n+  int i = ({ }); // { dg-error \"void value not ignored\" }\n+}\n+\n+template<int>\n+void\n+bar()\n+{\n+  int i = ({ ({}); }); // { dg-error \"void value not ignored\" }\n+}\n+\n+int\n+main ()\n+{\n+  foo<0> ();\n+  bar<0> ();\n+}\n+"}]}