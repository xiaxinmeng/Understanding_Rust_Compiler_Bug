{"sha": "ded6091379ad0d03bf5ea26633d501b026615c09", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGVkNjA5MTM3OWFkMGQwM2JmNWVhMjY2MzNkNTAxYjAyNjYxNWMwOQ==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2016-03-17T18:27:47Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2016-03-17T18:27:47Z"}, "message": "PR c/70264: fix crash in compatible_locations_p with BUILTINS_LOCATION\n\nIn r234088 my fix for PR c++/70105 didn't allow for the possibility that\nwhen comparing a pair of macro expansion histories that one of the\nmacros in the history might not be located within a line-map, and\nPR c/70264 reports a crash due to encountering BUILTINS_LOCATION within\nthe traversal.\n\nFixed thusly.\n\nSuccessfully bootstrapped on x86_64-pc-linux-gnu; adds 4 PASS results\nto gcc.sum and 12 to g++.sum.\n\ngcc/ChangeLog:\n\tPR c/70264\n\t* diagnostic-show-locus.c (compatible_locations_p): Handle the case\n\twhere one or both locations aren't within a line_map.\n\ngcc/testsuite/ChangeLog:\n\tPR c/70264\n\t* c-c++-common/pr70264.c: New test case.\n\nFrom-SVN: r234303", "tree": {"sha": "50eca93808fd6cb6a328f1c827549ccd995c143d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/50eca93808fd6cb6a328f1c827549ccd995c143d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ded6091379ad0d03bf5ea26633d501b026615c09", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ded6091379ad0d03bf5ea26633d501b026615c09", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ded6091379ad0d03bf5ea26633d501b026615c09", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ded6091379ad0d03bf5ea26633d501b026615c09/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "17366700d4ddcefeb271677029f59646a37a8ed3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/17366700d4ddcefeb271677029f59646a37a8ed3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/17366700d4ddcefeb271677029f59646a37a8ed3"}], "stats": {"total": 30, "additions": 30, "deletions": 0}, "files": [{"sha": "4a74494a4cb907ab21492218420e14ba844c1bcd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ded6091379ad0d03bf5ea26633d501b026615c09/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ded6091379ad0d03bf5ea26633d501b026615c09/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ded6091379ad0d03bf5ea26633d501b026615c09", "patch": "@@ -1,3 +1,9 @@\n+2016-03-17  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR c/70264\n+\t* diagnostic-show-locus.c (compatible_locations_p): Handle the case\n+\twhere one or both locations aren't within a line_map.\n+\n 2016-03-17  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR driver/70192"}, {"sha": "bf956661252e63825ab97ef6082de1468b4f9c28", "filename": "gcc/diagnostic-show-locus.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ded6091379ad0d03bf5ea26633d501b026615c09/gcc%2Fdiagnostic-show-locus.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ded6091379ad0d03bf5ea26633d501b026615c09/gcc%2Fdiagnostic-show-locus.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdiagnostic-show-locus.c?ref=ded6091379ad0d03bf5ea26633d501b026615c09", "patch": "@@ -486,6 +486,12 @@ compatible_locations_p (location_t loc_a, location_t loc_b)\n   if (IS_ADHOC_LOC (loc_b))\n     loc_b = get_location_from_adhoc_loc (line_table, loc_b);\n \n+  /* If either location is one of the special locations outside of a\n+     linemap, they are only compatible if they are equal.  */\n+  if (loc_a < RESERVED_LOCATION_COUNT\n+      || loc_b < RESERVED_LOCATION_COUNT)\n+    return loc_a == loc_b;\n+\n   const line_map *map_a = linemap_lookup (line_table, loc_a);\n   linemap_assert (map_a);\n "}, {"sha": "b3c16b552324ebb49e1ad674c7b6126d7de189a1", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ded6091379ad0d03bf5ea26633d501b026615c09/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ded6091379ad0d03bf5ea26633d501b026615c09/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ded6091379ad0d03bf5ea26633d501b026615c09", "patch": "@@ -1,3 +1,8 @@\n+2016-03-17  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR c/70264\n+\t* c-c++-common/pr70264.c: New test case.\n+\n 2016-03-17  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/70144"}, {"sha": "815aad175e53bc8fa35ba0836616ec124ac95218", "filename": "gcc/testsuite/c-c++-common/pr70264.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ded6091379ad0d03bf5ea26633d501b026615c09/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr70264.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ded6091379ad0d03bf5ea26633d501b026615c09/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr70264.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr70264.c?ref=ded6091379ad0d03bf5ea26633d501b026615c09", "patch": "@@ -0,0 +1,13 @@\n+/* { dg-options \"-fdiagnostics-show-caret\" } */\n+\n+#define X __LINE__ /* { dg-error \"expected\" } */\n+X\n+\n+/* { dg-begin-multiline-output \"\" }\n+ #define X __LINE__\n+           ^\n+   { dg-end-multiline-output \"\" } */\n+/* { dg-begin-multiline-output \"\" }\n+ X\n+ ^\n+   { dg-end-multiline-output \"\" } */"}]}