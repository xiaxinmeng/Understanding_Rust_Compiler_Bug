{"sha": "94172876940bd493e6c193e46dfacaa77d1f8606", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTQxNzI4NzY5NDBiZDQ5M2U2YzE5M2U0NmRmYWNhYTc3ZDFmODYwNg==", "commit": {"author": {"name": "Richard Sandiford", "email": "rsandifo@nildram.co.uk", "date": "2007-10-09T11:04:46Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2007-10-09T11:04:46Z"}, "message": "re PR tree-optimization/33615 (Hoisting of potentially-throwing values for -fnon-call-exceptions)\n\ngcc/\n\tPR tree-optimization/33615\n\t* tree-ssa-loop-im.c (movement_possibility): Return MOVE_IMPOSSIBLE\n\tif the rhs might throw.\n\ngcc/testsuite/\n\tPR tree-optimization/33615\n\t* g++.dg/tree-ssa/pr33615.C: New test.\n\nFrom-SVN: r129163", "tree": {"sha": "380064bdc5ece64e0334820d84d2da25451f50cd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/380064bdc5ece64e0334820d84d2da25451f50cd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/94172876940bd493e6c193e46dfacaa77d1f8606", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94172876940bd493e6c193e46dfacaa77d1f8606", "html_url": "https://github.com/Rust-GCC/gccrs/commit/94172876940bd493e6c193e46dfacaa77d1f8606", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94172876940bd493e6c193e46dfacaa77d1f8606/comments", "author": null, "committer": null, "parents": [{"sha": "edbed3d31e8f6981f4bf4692c132b95081ab5112", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/edbed3d31e8f6981f4bf4692c132b95081ab5112", "html_url": "https://github.com/Rust-GCC/gccrs/commit/edbed3d31e8f6981f4bf4692c132b95081ab5112"}], "stats": {"total": 34, "additions": 33, "deletions": 1}, "files": [{"sha": "1d66ea3ac7886867ec42630cb33ab64bd0c71a90", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94172876940bd493e6c193e46dfacaa77d1f8606/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94172876940bd493e6c193e46dfacaa77d1f8606/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=94172876940bd493e6c193e46dfacaa77d1f8606", "patch": "@@ -1,3 +1,9 @@\n+2007-10-09  Richard Sandiford  <rsandifo@nildram.co.uk>\n+\n+\tPR tree-optimization/33615\n+\t* tree-ssa-loop-im.c (movement_possibility): Return MOVE_IMPOSSIBLE\n+\tif the rhs might throw.\n+\n 2007-10-09  Jan Hubicka  <jh@suse.cz>\n \n \t* invoke.texi (align-threshold, align-loop-iterations): Document."}, {"sha": "f6665d5c7076589eabfc374fc96d3bc5ebe7e78f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94172876940bd493e6c193e46dfacaa77d1f8606/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94172876940bd493e6c193e46dfacaa77d1f8606/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=94172876940bd493e6c193e46dfacaa77d1f8606", "patch": "@@ -1,3 +1,8 @@\n+2007-10-09  Richard Sandiford  <rsandifo@nildram.co.uk>\n+\n+\tPR tree-optimization/33615\n+\t* g++.dg/tree-ssa/pr33615.C: New test.\n+\n 2007-10-08  Alexandre Oliva  <aoliva@redhat.com>\n \n \tPR tree-optimization/33572"}, {"sha": "e8a536935b799593b8ef68e007c749bae1753b2a", "filename": "gcc/testsuite/g++.dg/tree-ssa/pr33615.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94172876940bd493e6c193e46dfacaa77d1f8606/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr33615.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94172876940bd493e6c193e46dfacaa77d1f8606/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr33615.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr33615.C?ref=94172876940bd493e6c193e46dfacaa77d1f8606", "patch": "@@ -0,0 +1,20 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O -fnon-call-exceptions -fdump-tree-lim-details -w\" } */\n+\n+extern volatile int y;\n+\n+double\n+foo (double a, int x)\n+{\n+  while (x--)\n+    {\n+      y++;\n+      a += 1.0 / 0.0;\n+    }\n+  return a;\n+}\n+\n+// The expression 1.0 / 0.0 should not be treated as a loop invariant\n+// if it may throw an exception.\n+// { dg-final { scan-tree-dump-times \"invariant up to\" 0 \"lim\" } }\n+// { dg-final { cleanup-tree-dump \"lim\" } }"}, {"sha": "83ad70c2890528843160a4c26b7a1903c9bc5420", "filename": "gcc/tree-ssa-loop-im.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94172876940bd493e6c193e46dfacaa77d1f8606/gcc%2Ftree-ssa-loop-im.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94172876940bd493e6c193e46dfacaa77d1f8606/gcc%2Ftree-ssa-loop-im.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-im.c?ref=94172876940bd493e6c193e46dfacaa77d1f8606", "patch": "@@ -260,7 +260,8 @@ movement_possibility (tree stmt)\n \n   rhs = GIMPLE_STMT_OPERAND (stmt, 1);\n \n-  if (TREE_SIDE_EFFECTS (rhs))\n+  if (TREE_SIDE_EFFECTS (rhs)\n+      || tree_could_throw_p (rhs))\n     return MOVE_IMPOSSIBLE;\n \n   if (TREE_CODE (lhs) != SSA_NAME"}]}