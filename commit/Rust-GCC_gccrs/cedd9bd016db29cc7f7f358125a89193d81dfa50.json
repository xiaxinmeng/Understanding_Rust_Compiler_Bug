{"sha": "cedd9bd016db29cc7f7f358125a89193d81dfa50", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2VkZDliZDAxNmRiMjljYzdmN2YzNTgxMjVhODkxOTNkODFkZmE1MA==", "commit": {"author": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2018-08-08T14:26:28Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2018-08-08T14:26:28Z"}, "message": "[libgomp, nvptx] Allow cuGetErrorString to be NULL\n\nCuda driver api function cuGetErrorString is available in version 6.0 and\nhigher.\n\nCurrently, when the driver that is used does not contain this function, the\nlibgomp nvptx plugin will not build (PLUGIN_NVPTX_DYNAMIC == 0) or run\n(PLUGIN_NVPTX_DYNAMIC == 1).\n\nThis patch fixes this problem by testing for the presence of the function, and\nhandling absence.\n\nBuild on x86_64 with nvptx accelerator and reg-tested libgomp, both with and\nwithout --without-cuda-driver.\n\n2018-08-08  Tom de Vries  <tdevries@suse.de>\n\n\t* plugin/cuda-lib.def (cuGetErrorString): Use CUDA_ONE_CALL_MAYBE_NULL.\n\t* plugin/plugin-nvptx.c (cuda_error): Handle if cuGetErrorString is not\n\tpresent.\n\nFrom-SVN: r263407", "tree": {"sha": "5eaefa2fde4ae620a9d6848791130ac97f8d7443", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5eaefa2fde4ae620a9d6848791130ac97f8d7443"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cedd9bd016db29cc7f7f358125a89193d81dfa50", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cedd9bd016db29cc7f7f358125a89193d81dfa50", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cedd9bd016db29cc7f7f358125a89193d81dfa50", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cedd9bd016db29cc7f7f358125a89193d81dfa50/comments", "author": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b113af959cc00dd8726298003e837b5824288649", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b113af959cc00dd8726298003e837b5824288649", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b113af959cc00dd8726298003e837b5824288649"}], "stats": {"total": 18, "additions": 14, "deletions": 4}, "files": [{"sha": "605c84c228697254686ebe9c7071a5d31aa29460", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cedd9bd016db29cc7f7f358125a89193d81dfa50/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cedd9bd016db29cc7f7f358125a89193d81dfa50/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=cedd9bd016db29cc7f7f358125a89193d81dfa50", "patch": "@@ -1,3 +1,9 @@\n+2018-08-08  Tom de Vries  <tdevries@suse.de>\n+\n+\t* plugin/cuda-lib.def (cuGetErrorString): Use CUDA_ONE_CALL_MAYBE_NULL.\n+\t* plugin/plugin-nvptx.c (cuda_error): Handle if cuGetErrorString is not\n+\tpresent.\n+\n 2018-08-08  Tom de Vries  <tdevries@suse.de>\n \n \t* plugin/plugin-nvptx.c"}, {"sha": "6365cdbfcbe4e147b653af681bc93b11967be9c7", "filename": "libgomp/plugin/cuda-lib.def", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cedd9bd016db29cc7f7f358125a89193d81dfa50/libgomp%2Fplugin%2Fcuda-lib.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cedd9bd016db29cc7f7f358125a89193d81dfa50/libgomp%2Fplugin%2Fcuda-lib.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fplugin%2Fcuda-lib.def?ref=cedd9bd016db29cc7f7f358125a89193d81dfa50", "patch": "@@ -15,7 +15,7 @@ CUDA_ONE_CALL (cuEventQuery)\n CUDA_ONE_CALL (cuEventRecord)\n CUDA_ONE_CALL (cuEventSynchronize)\n CUDA_ONE_CALL (cuFuncGetAttribute)\n-CUDA_ONE_CALL (cuGetErrorString)\n+CUDA_ONE_CALL_MAYBE_NULL (cuGetErrorString)\n CUDA_ONE_CALL (cuInit)\n CUDA_ONE_CALL (cuLaunchKernel)\n CUDA_ONE_CALL (cuLinkAddData)"}, {"sha": "b549b774003951f8289eab14c286e3ecbf51f19e", "filename": "libgomp/plugin/plugin-nvptx.c", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cedd9bd016db29cc7f7f358125a89193d81dfa50/libgomp%2Fplugin%2Fplugin-nvptx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cedd9bd016db29cc7f7f358125a89193d81dfa50/libgomp%2Fplugin%2Fplugin-nvptx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fplugin%2Fplugin-nvptx.c?ref=cedd9bd016db29cc7f7f358125a89193d81dfa50", "patch": "@@ -161,13 +161,17 @@ init_cuda_lib (void)\n static const char *\n cuda_error (CUresult r)\n {\n+  const char *fallback = \"unknown cuda error\";\n   const char *desc;\n \n+  if (!CUDA_CALL_EXISTS (cuGetErrorString))\n+    return fallback;\n+\n   r = CUDA_CALL_NOCHECK (cuGetErrorString, r, &desc);\n-  if (r != CUDA_SUCCESS)\n-    desc = \"unknown cuda error\";\n+  if (r == CUDA_SUCCESS)\n+    return desc;\n \n-  return desc;\n+  return fallback;\n }\n \n static unsigned int instantiated_devices = 0;"}]}