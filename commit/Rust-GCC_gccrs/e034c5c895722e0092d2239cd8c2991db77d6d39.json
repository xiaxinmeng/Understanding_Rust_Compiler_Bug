{"sha": "e034c5c895722e0092d2239cd8c2991db77d6d39", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTAzNGM1Yzg5NTcyMmUwMDkyZDIyMzljZDhjMjk5MWRiNzdkNmQzOQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-12-02T07:54:47Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-12-02T07:54:47Z"}, "message": "re PR target/78643 (ICE in convert_move, at expr.c:230)\n\n\tPR target/78643\n\tPR target/80583\n\t* expr.c (get_inner_reference): If DECL_MODE of a non-bitfield\n\tis BLKmode for vector field with vector raw mode, use TYPE_MODE\n\tinstead of DECL_MODE.\n\n\t* gcc.target/i386/pr80583.c: New test.\n\nFrom-SVN: r255353", "tree": {"sha": "128171fc7beeba4de19df412d9d8a94d75ce0164", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/128171fc7beeba4de19df412d9d8a94d75ce0164"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e034c5c895722e0092d2239cd8c2991db77d6d39", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e034c5c895722e0092d2239cd8c2991db77d6d39", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e034c5c895722e0092d2239cd8c2991db77d6d39", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e034c5c895722e0092d2239cd8c2991db77d6d39/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3b5e1089fedddec6d8299ba1800705b65c574d32", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b5e1089fedddec6d8299ba1800705b65c574d32", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3b5e1089fedddec6d8299ba1800705b65c574d32"}], "stats": {"total": 36, "additions": 35, "deletions": 1}, "files": [{"sha": "9536a88b8a9e542be5b74eb586ef2afd984ea5dc", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e034c5c895722e0092d2239cd8c2991db77d6d39/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e034c5c895722e0092d2239cd8c2991db77d6d39/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e034c5c895722e0092d2239cd8c2991db77d6d39", "patch": "@@ -1,5 +1,11 @@\n 2017-12-02  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR target/78643\n+\tPR target/80583\n+\t* expr.c (get_inner_reference): If DECL_MODE of a non-bitfield\n+\tis BLKmode for vector field with vector raw mode, use TYPE_MODE\n+\tinstead of DECL_MODE.\n+\n \t* config/i386/i386-protos.h (standard_sse_constant_opcode): Change\n \tlast argument to rtx pointer.\n \t* config/i386/i386.c (standard_sse_constant_opcode): Replace X argument"}, {"sha": "80116381f1b7d075d0619e4fc7821db133730a7d", "filename": "gcc/expr.c", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e034c5c895722e0092d2239cd8c2991db77d6d39/gcc%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e034c5c895722e0092d2239cd8c2991db77d6d39/gcc%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpr.c?ref=e034c5c895722e0092d2239cd8c2991db77d6d39", "patch": "@@ -7032,7 +7032,16 @@ get_inner_reference (tree exp, HOST_WIDE_INT *pbitsize,\n \t     size.  */\n \tmode = TYPE_MODE (DECL_BIT_FIELD_TYPE (field));\n       else if (!DECL_BIT_FIELD (field))\n-\tmode = DECL_MODE (field);\n+\t{\n+\t  mode = DECL_MODE (field);\n+\t  /* For vector fields re-check the target flags, as DECL_MODE\n+\t     could have been set with different target flags than\n+\t     the current function has.  */\n+\t  if (mode == BLKmode\n+\t      && VECTOR_TYPE_P (TREE_TYPE (field))\n+\t      && VECTOR_MODE_P (TYPE_MODE_RAW (TREE_TYPE (field))))\n+\t    mode = TYPE_MODE (TREE_TYPE (field));\n+\t}\n       else if (DECL_MODE (field) == BLKmode)\n \tblkmode_bitfield = true;\n "}, {"sha": "49f0409a24aa9364f304f7dc669be337553d5c3b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e034c5c895722e0092d2239cd8c2991db77d6d39/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e034c5c895722e0092d2239cd8c2991db77d6d39/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e034c5c895722e0092d2239cd8c2991db77d6d39", "patch": "@@ -1,3 +1,9 @@\n+2017-12-02  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/78643\n+\tPR target/80583\n+\t* gcc.target/i386/pr80583.c: New test.\n+\n 2017-12-01  Segher Boessenkool  <segher@kernel.crashing.org>\n \n \t* gcc.target/powerpc/fusion.c: Add -dp to options.  Adjust the expected"}, {"sha": "6fe3212b65ce5971f5953d150351be8e0613a7d6", "filename": "gcc/testsuite/gcc.target/i386/pr80583.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e034c5c895722e0092d2239cd8c2991db77d6d39/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr80583.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e034c5c895722e0092d2239cd8c2991db77d6d39/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr80583.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr80583.c?ref=e034c5c895722e0092d2239cd8c2991db77d6d39", "patch": "@@ -0,0 +1,13 @@\n+/* PR target/80583 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O0 -mno-avx\" } */\n+\n+typedef int V __attribute__((__vector_size__(32)));\n+struct S { V a; };\n+\n+V __attribute__((target (\"avx\")))\n+foo (struct S *b)\n+{\n+  V x = b->a;\n+  return x;\n+}"}]}