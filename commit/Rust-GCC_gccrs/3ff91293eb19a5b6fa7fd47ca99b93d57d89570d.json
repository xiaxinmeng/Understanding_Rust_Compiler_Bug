{"sha": "3ff91293eb19a5b6fa7fd47ca99b93d57d89570d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2ZmOTEyOTNlYjE5YTViNmZhN2ZkNDdjYTk5YjkzZDU3ZDg5NTcwZA==", "commit": {"author": {"name": "Kostya Serebryany", "email": "kcc@google.com", "date": "2010-08-18T15:21:56Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2010-08-18T15:21:56Z"}, "message": "re PR libstdc++/45276 (Need to document _GLIBCXX_SYNCHRONIZATION_HAPPENS_BEFORE)\n\n2010-08-18  Kostya Serebryany <kcc@google.com>\n\t    Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR libstdc++/45276\n\t* doc/xml/manual/debug.xml ([debug.races]): Add.\n\nCo-Authored-By: Paolo Carlini <paolo.carlini@oracle.com>\n\nFrom-SVN: r163342", "tree": {"sha": "7ec1128f3daadc6b1a77eb6d68d91f1fd28c47b4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7ec1128f3daadc6b1a77eb6d68d91f1fd28c47b4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3ff91293eb19a5b6fa7fd47ca99b93d57d89570d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ff91293eb19a5b6fa7fd47ca99b93d57d89570d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3ff91293eb19a5b6fa7fd47ca99b93d57d89570d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ff91293eb19a5b6fa7fd47ca99b93d57d89570d/comments", "author": {"login": "kcc", "id": 1789297, "node_id": "MDQ6VXNlcjE3ODkyOTc=", "avatar_url": "https://avatars.githubusercontent.com/u/1789297?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kcc", "html_url": "https://github.com/kcc", "followers_url": "https://api.github.com/users/kcc/followers", "following_url": "https://api.github.com/users/kcc/following{/other_user}", "gists_url": "https://api.github.com/users/kcc/gists{/gist_id}", "starred_url": "https://api.github.com/users/kcc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kcc/subscriptions", "organizations_url": "https://api.github.com/users/kcc/orgs", "repos_url": "https://api.github.com/users/kcc/repos", "events_url": "https://api.github.com/users/kcc/events{/privacy}", "received_events_url": "https://api.github.com/users/kcc/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1027c9c5b9c0d3d60fe1eb711bd97c8432c6cfb6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1027c9c5b9c0d3d60fe1eb711bd97c8432c6cfb6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1027c9c5b9c0d3d60fe1eb711bd97c8432c6cfb6"}], "stats": {"total": 57, "additions": 57, "deletions": 0}, "files": [{"sha": "a8d53090770a51af5bc1e037f01aee665812c2c9", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ff91293eb19a5b6fa7fd47ca99b93d57d89570d/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ff91293eb19a5b6fa7fd47ca99b93d57d89570d/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=3ff91293eb19a5b6fa7fd47ca99b93d57d89570d", "patch": "@@ -1,3 +1,9 @@\n+2010-08-18  Kostya Serebryany <kcc@google.com>\n+\t    Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR libstdc++/45276\n+\t* doc/xml/manual/debug.xml ([debug.races]): Add.\n+\n 2010-08-17  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR libstdc++/45300"}, {"sha": "51219d45efd665f469836964bd2976060f63799e", "filename": "libstdc++-v3/doc/xml/manual/debug.xml", "status": "modified", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ff91293eb19a5b6fa7fd47ca99b93d57d89570d/libstdc%2B%2B-v3%2Fdoc%2Fxml%2Fmanual%2Fdebug.xml", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ff91293eb19a5b6fa7fd47ca99b93d57d89570d/libstdc%2B%2B-v3%2Fdoc%2Fxml%2Fmanual%2Fdebug.xml", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fdoc%2Fxml%2Fmanual%2Fdebug.xml?ref=3ff91293eb19a5b6fa7fd47ca99b93d57d89570d", "patch": "@@ -189,6 +189,57 @@\n \n </section>\n \n+<section xml:id=\"debug.races\"><info><title>Data Race Hunting</title></info>\n+<para>\n+  All synchronization primitives used in the library internals should be\n+  understood by race detectors so that they do not produce false reports.\n+</para>\n+\n+<para>\n+  We use two annotations (macros) to explain low-level synchronization \n+  to race detectors:\n+  <code>_GLIBCXX_SYNCHRONIZATION_HAPPENS_BEFORE()</code> and\n+  <code> _GLIBCXX_SYNCHRONIZATION_HAPPENS_AFTER()</code>.\n+  By default, these two macros are defined empty -- anyone who wants\n+  to use a race detector will need to redefine these macros to call an\n+  appropriate API.\n+  Since these macros are empty by default, redefining them in the user code\n+  will affect only the inline template code, e.g. <code>shared_ptr</code>.\n+  In order to redefine the macros in <code>basic_string</code> one will\n+  need to disable extern templates (by defining \n+  <code>_GLIBCXX_EXTERN_TEMPLATE=-1</code>) or rebuild the \n+  <code>.so</code> file.\n+  The rest of the cases (currently, <code>ios_base::Init::~Init</code>,\n+  <code>locale::_Impl</code> and <code>locale::facet</code>) will require\n+  to rebuild the <code>.so</code> file.\n+</para>\n+\n+<para>\n+  The approach described above works at least with the following race \n+  detection tools:\n+  <link xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n+  xlink:href=\"http://valgrind.org/docs/manual/drd-manual.html\">\n+  DRD </link>,\n+  <link xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n+  xlink:href=\"http://valgrind.org/docs/manual/hg-manual.html\"> \n+  Helgrind </link>,\n+  <link xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n+  xlink:href=\"http://code.google.com/p/data-race-test\"> \n+  ThreadSanitizer </link>.\n+</para>\n+\n+<para>\n+  With DRD, Helgrind and ThreadSanitizer you will need to define\n+  the macros like this:\n+<programlisting>\n+  #define _GLIBCXX_SYNCHRONIZATION_HAPPENS_BEFORE(A) ANNOTATE_HAPPENS_BEFORE(A)\n+  #define _GLIBCXX_SYNCHRONIZATION_HAPPENS_AFTER(A)  ANNOTATE_HAPPENS_AFTER(A)\n+</programlisting>\n+  Refer to the documentation of each particular tool for the details.\n+</para>\n+\n+</section>\n+\n <section xml:id=\"debug.gdb\"><info><title>Using <command>gdb</command></title></info>\n \n   <para>"}]}