{"sha": "a778d033f9229cc036805510c646cfc50d9f12a7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTc3OGQwMzNmOTIyOWNjMDM2ODA1NTEwYzY0NmNmYzUwZDlmMTJhNw==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2005-01-03T15:36:56Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2005-01-03T15:36:56Z"}, "message": "exp_ch3.adb (Stream_Operations_OK): Predicate to determine when the generation of predefined stream operations...\n\n\t* exp_ch3.adb (Stream_Operations_OK): Predicate to determine when the\n\tgeneration of predefined stream operations (specs and bodies) should\n\tproceed. Under various restrictions these subprograms must not be\n\tgenerated.\n\nFrom-SVN: r92836", "tree": {"sha": "d74b1035aeb8ec71c272cbbcadc3d2a1f8e047da", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d74b1035aeb8ec71c272cbbcadc3d2a1f8e047da"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a778d033f9229cc036805510c646cfc50d9f12a7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a778d033f9229cc036805510c646cfc50d9f12a7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a778d033f9229cc036805510c646cfc50d9f12a7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a778d033f9229cc036805510c646cfc50d9f12a7/comments", "author": null, "committer": null, "parents": [{"sha": "42de0044766f78d4dc915b46f5de94a6a5846ae2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/42de0044766f78d4dc915b46f5de94a6a5846ae2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/42de0044766f78d4dc915b46f5de94a6a5846ae2"}], "stats": {"total": 30, "additions": 22, "deletions": 8}, "files": [{"sha": "a09f7f5728823fba05c6a7da9d0f9d4f23e8ca04", "filename": "gcc/ada/exp_ch3.adb", "status": "modified", "additions": 22, "deletions": 8, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a778d033f9229cc036805510c646cfc50d9f12a7/gcc%2Fada%2Fexp_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a778d033f9229cc036805510c646cfc50d9f12a7/gcc%2Fada%2Fexp_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch3.adb?ref=a778d033f9229cc036805510c646cfc50d9f12a7", "patch": "@@ -286,6 +286,11 @@ package body Exp_Ch3 is\n    --  Freeze entities of all predefined primitive operations. This is needed\n    --  because the bodies of these operations do not normally do any freezeing.\n \n+   function Stream_Operations_OK (Typ : Entity_Id) return Boolean;\n+   --  Check whether stream operations must be emitted for a given type.\n+   --  Various restrictions prevent the generation of these operations, as\n+   --  a useful optimization or for certification purposes.\n+\n    --------------------------\n    -- Adjust_Discriminants --\n    --------------------------\n@@ -5364,10 +5369,7 @@ package body Exp_Ch3 is\n       --  We also skip these operations if dispatching is not available\n       --  or if streams are not available (since what's the point?)\n \n-      if not Is_Limited_Type (Tag_Typ)\n-        and then RTE_Available (RE_Tag)\n-        and then RTE_Available (RE_Root_Stream_Type)\n-      then\n+      if Stream_Operations_OK (Tag_Typ) then\n          Append_To (Res,\n            Predef_Stream_Attr_Spec (Loc, Tag_Typ, TSS_Stream_Read));\n          Append_To (Res,\n@@ -5819,11 +5821,9 @@ package body Exp_Ch3 is\n \n       --  Bodies for Dispatching stream IO routines. We need these only for\n       --  non-limited types (in the limited case there is no dispatching).\n-      --  We also skip them if dispatching is not available.\n+      --  We also skip them if dispatching or finalization are not available.\n \n-      if not Is_Limited_Type (Tag_Typ)\n-        and then not Restriction_Active (No_Finalization)\n-      then\n+      if Stream_Operations_OK (Tag_Typ) then\n          if No (TSS (Tag_Typ, TSS_Stream_Read)) then\n             Build_Record_Read_Procedure (Loc, Tag_Typ, Decl, Ent);\n             Append_To (Res, Decl);\n@@ -6034,4 +6034,18 @@ package body Exp_Ch3 is\n \n       return Res;\n    end Predefined_Primitive_Freeze;\n+\n+   --------------------------\n+   -- Stream_Operations_OK --\n+   --------------------------\n+\n+   function Stream_Operations_OK (Typ : Entity_Id) return Boolean is\n+   begin\n+      return\n+        not Is_Limited_Type (Typ)\n+          and then RTE_Available (RE_Tag)\n+          and then RTE_Available (RE_Root_Stream_Type)\n+          and then not Restriction_Active (No_Dispatch)\n+          and then not Restriction_Active (No_Streams);\n+   end Stream_Operations_OK;\n end Exp_Ch3;"}]}