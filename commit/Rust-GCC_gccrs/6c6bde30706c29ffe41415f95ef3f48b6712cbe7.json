{"sha": "6c6bde30706c29ffe41415f95ef3f48b6712cbe7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmM2YmRlMzA3MDZjMjlmZmU0MTQxNWY5NWVmM2Y0OGI2NzEyY2JlNw==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2017-10-27T17:11:42Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2017-10-27T17:11:42Z"}, "message": "re PR fortran/56342 (MATMUL with PARAMETER: Simplification usually doesn't work)\n\n2017-10-27  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/56342\n\t* simplify.c (is_constant_array_expr): If the expression is\n\ta parameter array, call gfc_simplify_expr.\n\n2017-10-27  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/56342\n\t* gfortran.dg/matmul_const.f90: New test.\n\nFrom-SVN: r254157", "tree": {"sha": "71e73a69c0cee745422b73c9d7ac3695e5d64c23", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/71e73a69c0cee745422b73c9d7ac3695e5d64c23"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6c6bde30706c29ffe41415f95ef3f48b6712cbe7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6c6bde30706c29ffe41415f95ef3f48b6712cbe7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6c6bde30706c29ffe41415f95ef3f48b6712cbe7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6c6bde30706c29ffe41415f95ef3f48b6712cbe7/comments", "author": null, "committer": null, "parents": [{"sha": "a09ca93a71be0b9b3c2f8ff0181293a6036f0282", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a09ca93a71be0b9b3c2f8ff0181293a6036f0282", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a09ca93a71be0b9b3c2f8ff0181293a6036f0282"}], "stats": {"total": 28, "additions": 27, "deletions": 1}, "files": [{"sha": "295704adc6eb05f791336da47f70e1fadbe43cc9", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c6bde30706c29ffe41415f95ef3f48b6712cbe7/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c6bde30706c29ffe41415f95ef3f48b6712cbe7/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=6c6bde30706c29ffe41415f95ef3f48b6712cbe7", "patch": "@@ -1,3 +1,9 @@\n+2017-10-27  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/56342\n+\t* simplify.c (is_constant_array_expr): If the expression is\n+\ta parameter array, call gfc_simplify_expr.\n+\n 2017-10-25  Bernhard Reutner-Fischer  <aldot@gcc.gnu.org>\n \n \t* match.c (gfc_match_type_is): Fix typo in error message."}, {"sha": "ba010a0aebff58b8d136c567f78c9749c578d1c0", "filename": "gcc/fortran/simplify.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c6bde30706c29ffe41415f95ef3f48b6712cbe7/gcc%2Ffortran%2Fsimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c6bde30706c29ffe41415f95ef3f48b6712cbe7/gcc%2Ffortran%2Fsimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsimplify.c?ref=6c6bde30706c29ffe41415f95ef3f48b6712cbe7", "patch": "@@ -227,7 +227,8 @@ convert_boz (gfc_expr *x, int kind)\n }\n \n \n-/* Test that the expression is an constant array.  */\n+/* Test that the expression is an constant array, simplifying if\n+   we are dealing with a parameter array.  */\n \n static bool\n is_constant_array_expr (gfc_expr *e)\n@@ -237,6 +238,10 @@ is_constant_array_expr (gfc_expr *e)\n   if (e == NULL)\n     return true;\n \n+  if (e->expr_type == EXPR_VARIABLE && e->rank > 0\n+      && e->symtree->n.sym->attr.flavor == FL_PARAMETER)\n+    gfc_simplify_expr (e, 1);\n+\n   if (e->expr_type != EXPR_ARRAY || !gfc_is_constant_expr (e))\n     return false;\n "}, {"sha": "2fb6daaf214354f5aa6536057aaf88c4715f4d37", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c6bde30706c29ffe41415f95ef3f48b6712cbe7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c6bde30706c29ffe41415f95ef3f48b6712cbe7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6c6bde30706c29ffe41415f95ef3f48b6712cbe7", "patch": "@@ -1,3 +1,8 @@\n+2017-10-27  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/56342\n+\t* gfortran.dg/matmul_const.f90: New test.\n+\n 2017-10-25  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* gcc.target/i386/pr70021.c: Add -mtune=skylake."}, {"sha": "35dce3227748717879c58c87eb3f71e024df6efa", "filename": "gcc/testsuite/gfortran.dg/matmul_const.f90", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c6bde30706c29ffe41415f95ef3f48b6712cbe7/gcc%2Ftestsuite%2Fgfortran.dg%2Fmatmul_const.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c6bde30706c29ffe41415f95ef3f48b6712cbe7/gcc%2Ftestsuite%2Fgfortran.dg%2Fmatmul_const.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fmatmul_const.f90?ref=6c6bde30706c29ffe41415f95ef3f48b6712cbe7", "patch": "@@ -0,0 +1,10 @@\n+! { dg-do  run }\n+! { dg-additional-options \"-fno-frontend-optimize -fdump-tree-original\" }\n+program main\n+  integer, parameter :: A(3,2) = reshape([1,2,3,4,5,6],[3,2])\n+  integer, parameter :: B(2,3) = reshape([1,1,1,1,1,1],[2,3])\n+  character (len=30) :: line\n+  write (unit=line,fmt='(9i3)') matmul(A,B)\n+  if (line /= '  5  7  9  5  7  9  5  7  9') call abort\n+end program main\n+!  dg-final { scan-tree-dump-times \"matmul_i4\" 0 \"original\" } }"}]}