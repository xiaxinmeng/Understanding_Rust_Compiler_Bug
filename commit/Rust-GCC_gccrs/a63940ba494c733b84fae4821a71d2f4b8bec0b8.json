{"sha": "a63940ba494c733b84fae4821a71d2f4b8bec0b8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTYzOTQwYmE0OTRjNzMzYjg0ZmFlNDgyMWE3MWQyZjRiOGJlYzBiOA==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2011-03-30T18:07:09Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2011-03-30T18:07:09Z"}, "message": "re PR c++/48281 ([C++0x] internal compiler error: in record_reference, at cgraphbuild.c:60)\n\n\tPR c++/48281\n\t* semantics.c (finish_compound_literal): Do put static/constant\n\tarrays in static variables.\n\nFrom-SVN: r171741", "tree": {"sha": "f09963879d8722ec5295e87c4327d9a3283792eb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f09963879d8722ec5295e87c4327d9a3283792eb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a63940ba494c733b84fae4821a71d2f4b8bec0b8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a63940ba494c733b84fae4821a71d2f4b8bec0b8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a63940ba494c733b84fae4821a71d2f4b8bec0b8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a63940ba494c733b84fae4821a71d2f4b8bec0b8/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "88d37ae679fd5fd498076514d16248ccb5b2b8ae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88d37ae679fd5fd498076514d16248ccb5b2b8ae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/88d37ae679fd5fd498076514d16248ccb5b2b8ae"}], "stats": {"total": 51, "additions": 50, "deletions": 1}, "files": [{"sha": "75f7da727a4717f9ca5bf00b958b3e64fc09654f", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a63940ba494c733b84fae4821a71d2f4b8bec0b8/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a63940ba494c733b84fae4821a71d2f4b8bec0b8/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=a63940ba494c733b84fae4821a71d2f4b8bec0b8", "patch": "@@ -1,5 +1,9 @@\n 2011-03-30  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/48281\n+\t* semantics.c (finish_compound_literal): Do put static/constant\n+\tarrays in static variables.\n+\n \t* call.c (convert_like_real) [ck_list]: Build up the\n \tinitializer_list object directly.\n \t* decl.c (build_init_list_var_init): Adjust."}, {"sha": "74e9a9f5a6f12ce39afc48a405b84fedb9280635", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 28, "deletions": 1, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a63940ba494c733b84fae4821a71d2f4b8bec0b8/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a63940ba494c733b84fae4821a71d2f4b8bec0b8/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=a63940ba494c733b84fae4821a71d2f4b8bec0b8", "patch": "@@ -2335,7 +2335,34 @@ finish_compound_literal (tree type, tree compound_literal)\n   if (TREE_CODE (type) == ARRAY_TYPE)\n     cp_complete_array_type (&type, compound_literal, false);\n   compound_literal = digest_init (type, compound_literal);\n-  return get_target_expr (compound_literal);\n+  /* Put static/constant array temporaries in static variables, but always\n+     represent class temporaries with TARGET_EXPR so we elide copies.  */\n+  if ((!at_function_scope_p () || CP_TYPE_CONST_P (type))\n+      && TREE_CODE (type) == ARRAY_TYPE\n+      && initializer_constant_valid_p (compound_literal, type))\n+    {\n+      tree decl = create_temporary_var (type);\n+      DECL_INITIAL (decl) = compound_literal;\n+      TREE_STATIC (decl) = 1;\n+      if (literal_type_p (type) && CP_TYPE_CONST_NON_VOLATILE_P (type))\n+\t{\n+\t  /* 5.19 says that a constant expression can include an\n+\t     lvalue-rvalue conversion applied to \"a glvalue of literal type\n+\t     that refers to a non-volatile temporary object initialized\n+\t     with a constant expression\".  Rather than try to communicate\n+\t     that this VAR_DECL is a temporary, just mark it constexpr.  */\n+\t  DECL_DECLARED_CONSTEXPR_P (decl) = true;\n+\t  DECL_INITIALIZED_BY_CONSTANT_EXPRESSION_P (decl) = true;\n+\t  TREE_CONSTANT (decl) = true;\n+\t}\n+      cp_apply_type_quals_to_decl (cp_type_quals (type), decl);\n+      decl = pushdecl_top_level (decl);\n+      DECL_NAME (decl) = make_anon_name ();\n+      SET_DECL_ASSEMBLER_NAME (decl, DECL_NAME (decl));\n+      return decl;\n+    }\n+  else\n+    return get_target_expr (compound_literal);\n }\n \n /* Return the declaration for the function-name variable indicated by"}, {"sha": "6ec96c906fb94bfba4325268ca57ec8ce9359998", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a63940ba494c733b84fae4821a71d2f4b8bec0b8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a63940ba494c733b84fae4821a71d2f4b8bec0b8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a63940ba494c733b84fae4821a71d2f4b8bec0b8", "patch": "@@ -1,3 +1,7 @@\n+2011-03-30  Jason Merrill  <jason@redhat.com>\n+\n+\t* g++.dg/cpp0x/initlist46.C: New.\n+\n 2011-03-30  Richard Sandiford  <richard.sandiford@linaro.org>\n \n \tPR target/47551"}, {"sha": "2b9f07dbdc9be2d15f4dcd961d998eda55e36b9a", "filename": "gcc/testsuite/g++.dg/cpp0x/initlist46.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a63940ba494c733b84fae4821a71d2f4b8bec0b8/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finitlist46.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a63940ba494c733b84fae4821a71d2f4b8bec0b8/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finitlist46.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finitlist46.C?ref=a63940ba494c733b84fae4821a71d2f4b8bec0b8", "patch": "@@ -0,0 +1,14 @@\n+// PR c++/48281\n+// { dg-options \"-std=c++0x -O2\" }\n+// { dg-do run }\n+\n+#include <initializer_list>\n+\n+typedef std::initializer_list<int>  int1;\n+typedef std::initializer_list<int1> int2;\n+static int2 ib = {{42,2,3,4,5},{2,3,4,5,1},{3,4,5,2,1}};\n+\n+int main()\n+{\n+  return *(ib.begin()->begin()) != 42;\n+}"}]}