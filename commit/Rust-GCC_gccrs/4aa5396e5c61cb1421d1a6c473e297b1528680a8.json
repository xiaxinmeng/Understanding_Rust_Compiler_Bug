{"sha": "4aa5396e5c61cb1421d1a6c473e297b1528680a8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGFhNTM5NmU1YzYxY2IxNDIxZDFhNmM0NzNlMjk3YjE1Mjg2ODBhOA==", "commit": {"author": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2021-03-31T14:55:41Z"}, "committer": {"name": "Philip Herron", "email": "herron.philip@googlemail.com", "date": "2021-03-31T17:22:02Z"}, "message": "Fixed bug TyTy::SubstitutionRef::needs_substitution\n\nWhen we have Types capable of type substitution it only needs substituted\nif it was not already substituted and it actually has substitutions defined\n\nFixes #311", "tree": {"sha": "47b3a88d303528e03fcbb48da85d4717e499a160", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/47b3a88d303528e03fcbb48da85d4717e499a160"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4aa5396e5c61cb1421d1a6c473e297b1528680a8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4aa5396e5c61cb1421d1a6c473e297b1528680a8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4aa5396e5c61cb1421d1a6c473e297b1528680a8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4aa5396e5c61cb1421d1a6c473e297b1528680a8/comments", "author": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "committer": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d7593fec92166db4d454fdf241b1fde6922d72f2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d7593fec92166db4d454fdf241b1fde6922d72f2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d7593fec92166db4d454fdf241b1fde6922d72f2"}], "stats": {"total": 29, "additions": 24, "deletions": 5}, "files": [{"sha": "6c31ab3b885e56177ea81363eab211e18f03d6c8", "filename": "gcc/rust/typecheck/rust-hir-type-check-expr.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4aa5396e5c61cb1421d1a6c473e297b1528680a8/gcc%2Frust%2Ftypecheck%2Frust-hir-type-check-expr.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4aa5396e5c61cb1421d1a6c473e297b1528680a8/gcc%2Frust%2Ftypecheck%2Frust-hir-type-check-expr.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Ftypecheck%2Frust-hir-type-check-expr.h?ref=4aa5396e5c61cb1421d1a6c473e297b1528680a8", "patch": "@@ -243,7 +243,7 @@ class TypeCheckExpr : public TypeCheckBase\n \tif (receiver_tyty->get_kind () == TyTy::TypeKind::ADT)\n \t  {\n \t    TyTy::ADTType *adt = static_cast<TyTy::ADTType *> (receiver_tyty);\n-\t    if (adt->has_substitutions ())\n+\t    if (adt->has_substitutions () && fn->needs_substitution ())\n \t      {\n \t\trust_assert (adt->was_substituted ());\n \t\tlookup"}, {"sha": "ae17bafd5e2df49f2ae8676a7d80c71cd163dede", "filename": "gcc/rust/typecheck/rust-tyty.cc", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4aa5396e5c61cb1421d1a6c473e297b1528680a8/gcc%2Frust%2Ftypecheck%2Frust-tyty.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4aa5396e5c61cb1421d1a6c473e297b1528680a8/gcc%2Frust%2Ftypecheck%2Frust-tyty.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Ftypecheck%2Frust-tyty.cc?ref=4aa5396e5c61cb1421d1a6c473e297b1528680a8", "patch": "@@ -362,7 +362,6 @@ ADTType *\n ADTType::handle_substitions (SubstitutionArgumentMappings subst_mappings)\n {\n   if (subst_mappings.size () != get_num_substitutions ())\n-\n     {\n       rust_error_at (subst_mappings.get_locus (),\n \t\t     \"invalid number of generic arguments to generic ADT type\");\n@@ -565,8 +564,9 @@ FnType::handle_substitions (SubstitutionArgumentMappings subst_mappings)\n {\n   if (subst_mappings.size () != get_num_substitutions ())\n     {\n-      rust_error_at (subst_mappings.get_locus (),\n-\t\t     \"invalid number of generic arguments to generic ADT type\");\n+      rust_error_at (\n+\tsubst_mappings.get_locus (),\n+\t\"invalid number of generic arguments to generic Function type\");\n       return nullptr;\n     }\n "}, {"sha": "3bc06b1499a267bbdbd505fa16375c3c0f18a426", "filename": "gcc/rust/typecheck/rust-tyty.h", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4aa5396e5c61cb1421d1a6c473e297b1528680a8/gcc%2Frust%2Ftypecheck%2Frust-tyty.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4aa5396e5c61cb1421d1a6c473e297b1528680a8/gcc%2Frust%2Ftypecheck%2Frust-tyty.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Ftypecheck%2Frust-tyty.h?ref=4aa5396e5c61cb1421d1a6c473e297b1528680a8", "patch": "@@ -527,7 +527,10 @@ class SubstitutionRef\n       }\n   }\n \n-  bool needs_substitution () const { return used_arguments.is_error (); }\n+  bool needs_substitution () const\n+  {\n+    return has_substitutions () && used_arguments.is_error ();\n+  }\n \n   bool was_substituted () const { return !needs_substitution (); }\n "}, {"sha": "0be8b0e22a3eb537e1cb657b5cbf5a01699ea0cd", "filename": "gcc/testsuite/rust.test/compile/generics12.rs", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4aa5396e5c61cb1421d1a6c473e297b1528680a8/gcc%2Ftestsuite%2Frust.test%2Fcompile%2Fgenerics12.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4aa5396e5c61cb1421d1a6c473e297b1528680a8/gcc%2Ftestsuite%2Frust.test%2Fcompile%2Fgenerics12.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust.test%2Fcompile%2Fgenerics12.rs?ref=4aa5396e5c61cb1421d1a6c473e297b1528680a8", "patch": "@@ -0,0 +1,16 @@\n+struct GenericStruct<T>(T, usize);\n+\n+impl GenericStruct<i32> {\n+    fn new(a: i32, b: usize) -> Self {\n+        GenericStruct(a, b)\n+    }\n+\n+    fn get(self) -> i32 {\n+        self.0\n+    }\n+}\n+\n+fn main() {\n+    let a: GenericStruct<i32> = GenericStruct::<i32>::new(123, 456);\n+    let aa: i32 = a.get();\n+}"}]}