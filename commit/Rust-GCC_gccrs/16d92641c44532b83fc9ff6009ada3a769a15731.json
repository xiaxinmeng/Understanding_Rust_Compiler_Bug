{"sha": "16d92641c44532b83fc9ff6009ada3a769a15731", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTZkOTI2NDFjNDQ1MzJiODNmYzlmZjYwMDlhZGEzYTc2OWExNTczMQ==", "commit": {"author": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2017-12-05T11:38:00Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2017-12-05T11:38:00Z"}, "message": "[multiple changes]\n\n2017-12-05  Bob Duff  <duff@adacore.com>\n\n\t* exp_ch6.adb (Build_In_Place_Formal): Search for the formal by suffix\n\tinstead of the full name.\n\t* sem_ch6.adb (Create_Extra_Formals): Make sure there are extra formals\n\tin the case of an instance of a generic.\n\n2017-12-05  Arnaud Charlet  <charlet@adacore.com>\n\n\t(Adjust_Global_Switches): Create an alias GNAT_Annotate to map to\n\tpragma Annotate.\n\nFrom-SVN: r255409", "tree": {"sha": "9761b471835baf82f173c34189b9c20165525dd3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9761b471835baf82f173c34189b9c20165525dd3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/16d92641c44532b83fc9ff6009ada3a769a15731", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16d92641c44532b83fc9ff6009ada3a769a15731", "html_url": "https://github.com/Rust-GCC/gccrs/commit/16d92641c44532b83fc9ff6009ada3a769a15731", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16d92641c44532b83fc9ff6009ada3a769a15731/comments", "author": null, "committer": null, "parents": [{"sha": "ab92e6e6a5f5cdd3a28d54c4626f1efb8218f561", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab92e6e6a5f5cdd3a28d54c4626f1efb8218f561", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ab92e6e6a5f5cdd3a28d54c4626f1efb8218f561"}], "stats": {"total": 45, "additions": 41, "deletions": 4}, "files": [{"sha": "d5e64b0b3c0244d810f6465144ef785129fcd713", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16d92641c44532b83fc9ff6009ada3a769a15731/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16d92641c44532b83fc9ff6009ada3a769a15731/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=16d92641c44532b83fc9ff6009ada3a769a15731", "patch": "@@ -1,3 +1,15 @@\n+2017-12-05  Bob Duff  <duff@adacore.com>\n+\n+\t* exp_ch6.adb (Build_In_Place_Formal): Search for the formal by suffix\n+\tinstead of the full name.\n+\t* sem_ch6.adb (Create_Extra_Formals): Make sure there are extra formals\n+\tin the case of an instance of a generic.\n+\n+2017-12-05  Arnaud Charlet  <charlet@adacore.com>\n+\n+\t(Adjust_Global_Switches): Create an alias GNAT_Annotate to map to\n+\tpragma Annotate.\n+\n 2017-12-05  Sebastian Huber  <sebastian.huber@embedded-brains.de>\n \n \t* gcc-interface/Makefile.in (RTEMS): Define EH_MECHANISM."}, {"sha": "8a3f3905c76630db1329c83ac376779b182a2c30", "filename": "gcc/ada/exp_ch6.adb", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16d92641c44532b83fc9ff6009ada3a769a15731/gcc%2Fada%2Fexp_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16d92641c44532b83fc9ff6009ada3a769a15731/gcc%2Fada%2Fexp_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch6.adb?ref=16d92641c44532b83fc9ff6009ada3a769a15731", "patch": "@@ -650,9 +650,7 @@ package body Exp_Ch6 is\n      (Func : Entity_Id;\n       Kind : BIP_Formal_Kind) return Entity_Id\n    is\n-      Formal_Name  : constant Name_Id :=\n-                       New_External_Name\n-                         (Chars (Func), BIP_Formal_Suffix (Kind));\n+      Formal_Suffix : constant String := BIP_Formal_Suffix (Kind);\n       Extra_Formal : Entity_Id := Extra_Formals (Func);\n \n    begin\n@@ -669,9 +667,21 @@ package body Exp_Ch6 is\n          Extra_Formal := Extra_Formals (Func);\n       end if;\n \n+      --  We search for a formal with a matching suffix. We can't search\n+      --  for the full name, because of the code at the end of Sem_Ch6.-\n+      --  Create_Extra_Formals, which copies the Extra_Formals over to\n+      --  the Alias of an instance, which will cause the formals to have\n+      --  \"incorrect\" names.\n+\n       loop\n          pragma Assert (Present (Extra_Formal));\n-         exit when Chars (Extra_Formal) = Formal_Name;\n+         declare\n+            Name : constant String := Get_Name_String (Chars (Extra_Formal));\n+         begin\n+            exit when Name'Length >= Formal_Suffix'Length\n+              and then Formal_Suffix =\n+                Name (Name'Last - Formal_Suffix'Length + 1 .. Name'Last);\n+         end;\n \n          Next_Formal_With_Extras (Extra_Formal);\n       end loop;"}, {"sha": "1b3f9a35b4ec29df0a4f33772a33fed5432b7efb", "filename": "gcc/ada/gnat1drv.adb", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16d92641c44532b83fc9ff6009ada3a769a15731/gcc%2Fada%2Fgnat1drv.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16d92641c44532b83fc9ff6009ada3a769a15731/gcc%2Fada%2Fgnat1drv.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnat1drv.adb?ref=16d92641c44532b83fc9ff6009ada3a769a15731", "patch": "@@ -136,6 +136,13 @@ procedure Gnat1drv is\n    --  Start of processing for Adjust_Global_Switches\n \n    begin\n+      --  Define pragma GNAT_Annotate as an alias of pragma Annotate,\n+      --  to be able to work around bootstrap limitations with the old syntax\n+      --  of pragma Annotate, and use pragma GNAT_Annotate in compiler sources\n+      --  when needed.\n+\n+      Map_Pragma_Name (From => Name_Gnat_Annotate, To => Name_Annotate);\n+\n       --  -gnatd.M enables Relaxed_RM_Semantics\n \n       if Debug_Flag_Dot_MM then"}, {"sha": "b13ca92eae83f68a2fdf894fe6be700a18299b5b", "filename": "gcc/ada/sem_ch6.adb", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16d92641c44532b83fc9ff6009ada3a769a15731/gcc%2Fada%2Fsem_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16d92641c44532b83fc9ff6009ada3a769a15731/gcc%2Fada%2Fsem_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch6.adb?ref=16d92641c44532b83fc9ff6009ada3a769a15731", "patch": "@@ -8140,6 +8140,13 @@ package body Sem_Ch6 is\n                 (E, Formal_Typ, E, BIP_Formal_Suffix (BIP_Object_Access));\n          end;\n       end if;\n+\n+      --  If this is an instance of a generic, we need to have extra formals\n+      --  for the Alias.\n+\n+      if Is_Generic_Instance (E) and then Present (Alias (E)) then\n+         Set_Extra_Formals (Alias (E), Extra_Formals (E));\n+      end if;\n    end Create_Extra_Formals;\n \n    -----------------------------"}, {"sha": "e89e3ff9b4db62cbe353f17093a5eb87faf5a701", "filename": "gcc/ada/snames.ads-tmpl", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16d92641c44532b83fc9ff6009ada3a769a15731/gcc%2Fada%2Fsnames.ads-tmpl", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16d92641c44532b83fc9ff6009ada3a769a15731/gcc%2Fada%2Fsnames.ads-tmpl", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsnames.ads-tmpl?ref=16d92641c44532b83fc9ff6009ada3a769a15731", "patch": "@@ -760,6 +760,7 @@ package Snames is\n    Name_Gcc                            : constant Name_Id := N + $;\n    Name_General                        : constant Name_Id := N + $;\n    Name_Gnat                           : constant Name_Id := N + $;\n+   Name_Gnat_Annotate                  : constant Name_Id := N + $;\n    Name_Gnat_Extended_Ravenscar        : constant Name_Id := N + $;\n    Name_Gnat_Ravenscar_EDF             : constant Name_Id := N + $;\n    Name_Gnatprove                      : constant Name_Id := N + $;"}]}