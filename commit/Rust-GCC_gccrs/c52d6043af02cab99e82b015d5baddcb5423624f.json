{"sha": "c52d6043af02cab99e82b015d5baddcb5423624f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzUyZDYwNDNhZjAyY2FiOTllODJiMDE1ZDViYWRkY2I1NDIzNjI0Zg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-07-01T08:16:27Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-07-01T08:16:27Z"}, "message": "re PR sanitizer/81262 (verify_flow_info failed for asmgoto test-case with -fsanitize=undefined)\n\n\tPR sanitizer/81262\n\t* bb-reorder.c (fix_up_fall_thru_edges): Move variable declarations to\n\tthe right scopes, make sure cond_jump isn't preserved between multiple\n\titerations.  Search for fallthru edge whenever there are 3+ edges and\n\tuse find_fallthru_edge for it.\n\n\t* gcc.c-torture/compile/pr81262.c: New test.\n\t* g++.dg/ubsan/pr81262.C: New test.\n\nFrom-SVN: r249865", "tree": {"sha": "c16314a48246321e533127a2a43984abc05882a6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c16314a48246321e533127a2a43984abc05882a6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c52d6043af02cab99e82b015d5baddcb5423624f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c52d6043af02cab99e82b015d5baddcb5423624f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c52d6043af02cab99e82b015d5baddcb5423624f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c52d6043af02cab99e82b015d5baddcb5423624f/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9aad8d9385a8c2abd912e227b1aae0490c6ea468", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9aad8d9385a8c2abd912e227b1aae0490c6ea468", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9aad8d9385a8c2abd912e227b1aae0490c6ea468"}], "stats": {"total": 88, "additions": 58, "deletions": 30}, "files": [{"sha": "dd8e1d27a35da96175e60aad7d25f95b7494f995", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c52d6043af02cab99e82b015d5baddcb5423624f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c52d6043af02cab99e82b015d5baddcb5423624f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c52d6043af02cab99e82b015d5baddcb5423624f", "patch": "@@ -1,3 +1,11 @@\n+2017-07-01  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR sanitizer/81262\n+\t* bb-reorder.c (fix_up_fall_thru_edges): Move variable declarations to\n+\tthe right scopes, make sure cond_jump isn't preserved between multiple\n+\titerations.  Search for fallthru edge whenever there are 3+ edges and\n+\tuse find_fallthru_edge for it.\n+\n 2017-06-29  Jan Hubicka  <hubicka@ucw.cz>\n \n \tPatch by Alexander Monakov <amonakov@ispras.ru>"}, {"sha": "846c291e9b4dd751c1cf8780cbcc76778b639214", "filename": "gcc/bb-reorder.c", "status": "modified", "additions": 16, "deletions": 30, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c52d6043af02cab99e82b015d5baddcb5423624f/gcc%2Fbb-reorder.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c52d6043af02cab99e82b015d5baddcb5423624f/gcc%2Fbb-reorder.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbb-reorder.c?ref=c52d6043af02cab99e82b015d5baddcb5423624f", "patch": "@@ -1812,18 +1812,15 @@ static void\n fix_up_fall_thru_edges (void)\n {\n   basic_block cur_bb;\n-  basic_block new_bb;\n-  edge succ1;\n-  edge succ2;\n-  edge fall_thru;\n-  edge cond_jump = NULL;\n-  bool cond_jump_crosses;\n-  int invert_worked;\n-  rtx_insn *old_jump;\n-  rtx_code_label *fall_thru_label;\n \n   FOR_EACH_BB_FN (cur_bb, cfun)\n     {\n+      edge succ1;\n+      edge succ2;\n+      edge fall_thru = NULL;\n+      edge cond_jump = NULL;\n+      rtx_code_label *fall_thru_label;\n+\n       fall_thru = NULL;\n       if (EDGE_COUNT (cur_bb->succs) > 0)\n \tsucc1 = EDGE_SUCC (cur_bb, 0);\n@@ -1849,20 +1846,8 @@ fix_up_fall_thru_edges (void)\n \t  fall_thru = succ2;\n \t  cond_jump = succ1;\n \t}\n-      else if (succ1\n-\t       && (block_ends_with_call_p (cur_bb)\n-\t\t   || can_throw_internal (BB_END (cur_bb))))\n-\t{\n-\t  edge e;\n-\t  edge_iterator ei;\n-\n-\t  FOR_EACH_EDGE (e, ei, cur_bb->succs)\n-\t    if (e->flags & EDGE_FALLTHRU)\n-\t      {\n-\t\tfall_thru = e;\n-\t\tbreak;\n-\t      }\n-\t}\n+      else if (succ2 && EDGE_COUNT (cur_bb->succs) > 2)\n+\tfall_thru = find_fallthru_edge (cur_bb->succs);\n \n       if (fall_thru && (fall_thru->dest != EXIT_BLOCK_PTR_FOR_FN (cfun)))\n \t{\n@@ -1873,9 +1858,9 @@ fix_up_fall_thru_edges (void)\n \t      /* The fall_thru edge crosses; now check the cond jump edge, if\n \t\t it exists.  */\n \n-\t      cond_jump_crosses = true;\n-\t      invert_worked  = 0;\n-\t      old_jump = BB_END (cur_bb);\n+\t      bool cond_jump_crosses = true;\n+\t      int invert_worked = 0;\n+\t      rtx_insn *old_jump = BB_END (cur_bb);\n \n \t      /* Find the jump instruction, if there is one.  */\n \n@@ -1895,12 +1880,13 @@ fix_up_fall_thru_edges (void)\n \t\t      /* Find label in fall_thru block. We've already added\n \t\t\t any missing labels, so there must be one.  */\n \n-\t\t      fall_thru_label = block_label (fall_thru->dest);\n+\t\t      rtx_code_label *fall_thru_label\n+\t\t\t= block_label (fall_thru->dest);\n \n \t\t      if (old_jump && fall_thru_label)\n \t\t\t{\n-\t\t\t  rtx_jump_insn *old_jump_insn =\n-\t\t\t\tdyn_cast <rtx_jump_insn *> (old_jump);\n+\t\t\t  rtx_jump_insn *old_jump_insn\n+\t\t\t    = dyn_cast <rtx_jump_insn *> (old_jump);\n \t\t\t  if (old_jump_insn)\n \t\t\t    invert_worked = invert_jump (old_jump_insn,\n \t\t\t\t\t\t\t fall_thru_label, 0);\n@@ -1931,7 +1917,7 @@ fix_up_fall_thru_edges (void)\n \t\t     becomes EDGE_CROSSING.  */\n \n \t\t  fall_thru->flags &= ~EDGE_CROSSING;\n-\t\t  new_bb = force_nonfallthru (fall_thru);\n+\t\t  basic_block new_bb = force_nonfallthru (fall_thru);\n \n \t\t  if (new_bb)\n \t\t    {"}, {"sha": "c71540aa811eb067f341dbd0a4344441e3a9e44b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c52d6043af02cab99e82b015d5baddcb5423624f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c52d6043af02cab99e82b015d5baddcb5423624f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c52d6043af02cab99e82b015d5baddcb5423624f", "patch": "@@ -1,3 +1,9 @@\n+2017-07-01  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR sanitizer/81262\n+\t* gcc.c-torture/compile/pr81262.c: New test.\n+\t* g++.dg/ubsan/pr81262.C: New test.\n+\n 2017-06-29  Jan Hubicka  <hubicka@ucw.cz>\n \n \tPR ipa/81261"}, {"sha": "1b360de95ad60a983d0bcd5f73706c4d7a16a36a", "filename": "gcc/testsuite/g++.dg/ubsan/pr81262.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c52d6043af02cab99e82b015d5baddcb5423624f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fubsan%2Fpr81262.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c52d6043af02cab99e82b015d5baddcb5423624f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fubsan%2Fpr81262.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fubsan%2Fpr81262.C?ref=c52d6043af02cab99e82b015d5baddcb5423624f", "patch": "@@ -0,0 +1,14 @@\n+// PR sanitizer/81262\n+// { dg-do compile }\n+// { dg-options \"-O2 -fsanitize=unreachable\" }\n+\n+int\n+foo ()\n+{\n+  asm goto (\"\" : : : : l1, l2);\n+  __builtin_unreachable ();\n+ l1:\n+  return 1;\n+ l2:\n+  return 0;\n+}"}, {"sha": "68fbea2a7ab8531f6236c9a836a32e515e8a7483", "filename": "gcc/testsuite/gcc.c-torture/compile/pr81262.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c52d6043af02cab99e82b015d5baddcb5423624f/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr81262.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c52d6043af02cab99e82b015d5baddcb5423624f/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr81262.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr81262.c?ref=c52d6043af02cab99e82b015d5baddcb5423624f", "patch": "@@ -0,0 +1,14 @@\n+/* PR sanitizer/81262 */\n+\n+void bar (void) __attribute__((cold, noreturn));\n+\n+int\n+foo (void)\n+{\n+  asm goto (\"\" : : : : l1, l2);\n+  bar ();\n+ l1:\n+  return 1;\n+ l2:\n+  return 0;\n+}"}]}