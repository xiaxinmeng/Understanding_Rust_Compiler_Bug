{"sha": "d228ee80f8578be474595a517a228111fac26c5e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDIyOGVlODBmODU3OGJlNDc0NTk1YTUxN2EyMjgxMTFmYWMyNmM1ZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2019-11-01T23:34:21Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-11-01T23:34:21Z"}, "message": "re PR bootstrap/92314 (missing omp-device-properties', needed by 's-omp-device-properties-h')\n\n\tPR bootstrap/92314\n\t* configure.ac: Don't look for omp-device-properties files from\n\tinstalled offloading compilers.  Instead add tmake_file snippets\n\tfor configured offloading targets and use files they generate.\n\t* Makefile.in (install): Don't depend on\n\tinstall-omp-device-properties.\n\t(install-omp-device-properties): Remove goal.\n\t* config/i386/t-omp-device: New file.\n\t* config/i386/t-intelmic (omp-device-properties): Remove goal.\n\t* config/nvptx/t-omp-device: New file.\n\t* config/nvptx/t-nvptx (omp-device-properties): Remove goal.\n\t* configure: Regenerated.\n\nFrom-SVN: r277735", "tree": {"sha": "eed22a0e69a45d980b41b3ae4495b8ee3eed01fa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eed22a0e69a45d980b41b3ae4495b8ee3eed01fa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d228ee80f8578be474595a517a228111fac26c5e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d228ee80f8578be474595a517a228111fac26c5e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d228ee80f8578be474595a517a228111fac26c5e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d228ee80f8578be474595a517a228111fac26c5e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "917dd789e55c88123d804a8a411e4a61ee7b6e43", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/917dd789e55c88123d804a8a411e4a61ee7b6e43", "html_url": "https://github.com/Rust-GCC/gccrs/commit/917dd789e55c88123d804a8a411e4a61ee7b6e43"}], "stats": {"total": 84, "additions": 47, "deletions": 37}, "files": [{"sha": "511ae542ae847c651343c1f2ea557e8170fe5c82", "filename": "gcc/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d228ee80f8578be474595a517a228111fac26c5e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d228ee80f8578be474595a517a228111fac26c5e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d228ee80f8578be474595a517a228111fac26c5e", "patch": "@@ -1,5 +1,18 @@\n 2019-11-02  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR bootstrap/92314\n+\t* configure.ac: Don't look for omp-device-properties files from\n+\tinstalled offloading compilers.  Instead add tmake_file snippets\n+\tfor configured offloading targets and use files they generate.\n+\t* Makefile.in (install): Don't depend on\n+\tinstall-omp-device-properties.\n+\t(install-omp-device-properties): Remove goal.\n+\t* config/i386/t-omp-device: New file.\n+\t* config/i386/t-intelmic (omp-device-properties): Remove goal.\n+\t* config/nvptx/t-omp-device: New file.\n+\t* config/nvptx/t-nvptx (omp-device-properties): Remove goal.\n+\t* configure: Regenerated.\n+\n \t* omp-general.h (omp_context_selector_set_compare): Declare.\n \t* omp-general.c (omp_construct_simd_compare,\n \tomp_context_selector_props_compare, omp_context_selector_set_compare,"}, {"sha": "035b58f50c0d51623a7ef21989da48124a4c9b41", "filename": "gcc/Makefile.in", "status": "modified", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d228ee80f8578be474595a517a228111fac26c5e/gcc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d228ee80f8578be474595a517a228111fac26c5e/gcc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FMakefile.in?ref=d228ee80f8578be474595a517a228111fac26c5e", "patch": "@@ -3476,10 +3476,6 @@ ifeq ($(enable_plugin),yes)\n install: install-plugin\n endif\n \n-ifeq ($(enable_as_accelerator),yes)\n-install: install-omp-device-properties\n-endif\n-\n install-strip: override INSTALL_PROGRAM = $(INSTALL_STRIP_PROGRAM)\n ifneq ($(STRIP),)\n install-strip: STRIPPROG = $(STRIP)\n@@ -3665,11 +3661,6 @@ install-driver: installdirs xgcc$(exeext)\n \t  fi; \\\n \tfi\n \n-# Install omp-device-properties file for accelerator compilers.\n-install-omp-device-properties: omp-device-properties installdirs\n-\t$(INSTALL_DATA) omp-device-properties \\\n-\t  $(DESTDIR)$(libsubdir)/omp-device-properties\n-\n # Install the info files.\n # $(INSTALL_DATA) might be a relative pathname, so we can't cd into srcdir\n # to do the install."}, {"sha": "9de4b76e3109ff3ad4e638a3da11780097d20785", "filename": "gcc/config/i386/t-intelmic", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d228ee80f8578be474595a517a228111fac26c5e/gcc%2Fconfig%2Fi386%2Ft-intelmic", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d228ee80f8578be474595a517a228111fac26c5e/gcc%2Fconfig%2Fi386%2Ft-intelmic", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Ft-intelmic?ref=d228ee80f8578be474595a517a228111fac26c5e", "patch": "@@ -8,10 +8,3 @@ ALL_HOST_OBJS += mkoffload.o\n mkoffload$(exeext): mkoffload.o collect-utils.o libcommon-target.a $(LIBIBERTY) $(LIBDEPS)\n \t$(LINKER) $(ALL_LINKERFLAGS) $(LDFLAGS) -o $@ \\\n \t  mkoffload.o collect-utils.o libcommon-target.a $(LIBIBERTY) $(LIBS)\n-\n-omp-device-properties: $(srcdir)/config/i386/i386-options.c\n-\techo kind: cpu > omp-device-properties\n-\techo arch: x86 x86_64 i386 i486 i586 i686 ia32 >> omp-device-properties\n-\techo isa: sse4 `sed -n '/^static struct ix86_target_opts isa2\\?_opts\\[\\] =/,/^};/p' \\\n-\t  $(srcdir)/config/i386/i386-options.c | \\\n-\t  sed -n 's/\",.*$$//;s/\\./_/;s/^  { \"-m//p'` >> omp-device-properties"}, {"sha": "26de162b54b29e57d0e4a35d355cae7c0c819e1c", "filename": "gcc/config/i386/t-omp-device", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d228ee80f8578be474595a517a228111fac26c5e/gcc%2Fconfig%2Fi386%2Ft-omp-device", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d228ee80f8578be474595a517a228111fac26c5e/gcc%2Fconfig%2Fi386%2Ft-omp-device", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Ft-omp-device?ref=d228ee80f8578be474595a517a228111fac26c5e", "patch": "@@ -0,0 +1,6 @@\n+omp-device-properties-i386: $(srcdir)/config/i386/i386-options.c\n+\techo kind: cpu > $@\n+\techo arch: x86 x86_64 i386 i486 i586 i686 ia32 >> $@\n+\techo isa: sse4 `sed -n '/^static struct ix86_target_opts isa2\\?_opts\\[\\] =/,/^};/p' \\\n+\t  $(srcdir)/config/i386/i386-options.c | \\\n+\t  sed -n 's/\",.*$$//;s/\\./_/;s/^  { \"-m//p'` >> $@"}, {"sha": "6c1010ddd661588802370acaf9102ab1dfe94585", "filename": "gcc/config/nvptx/t-nvptx", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d228ee80f8578be474595a517a228111fac26c5e/gcc%2Fconfig%2Fnvptx%2Ft-nvptx", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d228ee80f8578be474595a517a228111fac26c5e/gcc%2Fconfig%2Fnvptx%2Ft-nvptx", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Ft-nvptx?ref=d228ee80f8578be474595a517a228111fac26c5e", "patch": "@@ -10,8 +10,3 @@ mkoffload$(exeext): mkoffload.o collect-utils.o libcommon-target.a $(LIBIBERTY)\n \t  mkoffload.o collect-utils.o libcommon-target.a $(LIBIBERTY) $(LIBS)\n \n MULTILIB_OPTIONS = mgomp\n-\n-omp-device-properties: $(srcdir)/config/nvptx/nvptx.c\n-\techo kind: gpu > omp-device-properties\n-\techo arch: nvptx >> omp-device-properties\n-\techo isa: sm_30 sm_35 >> omp-device-properties"}, {"sha": "6d03b434ffca5905fb236bc71823f4ae39ad41e3", "filename": "gcc/config/nvptx/t-omp-device", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d228ee80f8578be474595a517a228111fac26c5e/gcc%2Fconfig%2Fnvptx%2Ft-omp-device", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d228ee80f8578be474595a517a228111fac26c5e/gcc%2Fconfig%2Fnvptx%2Ft-omp-device", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Ft-omp-device?ref=d228ee80f8578be474595a517a228111fac26c5e", "patch": "@@ -0,0 +1,4 @@\n+omp-device-properties-nvptx: $(srcdir)/config/nvptx/nvptx.c\n+\techo kind: gpu > $@\n+\techo arch: nvptx >> $@\n+\techo isa: sm_30 sm_35 >> $@"}, {"sha": "5794582bdd54659671fcea4b202b96c0ad34bd18", "filename": "gcc/configure", "status": "modified", "additions": 13, "deletions": 9, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d228ee80f8578be474595a517a228111fac26c5e/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d228ee80f8578be474595a517a228111fac26c5e/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=d228ee80f8578be474595a517a228111fac26c5e", "patch": "@@ -7881,18 +7881,22 @@ fi\n \n \n for tgt in `echo $enable_offload_targets | sed 's/,/ /g'`; do\n-  tgt_dir=`echo $tgt | sed -n 's/.*=//p'`\n   tgt=`echo $tgt | sed 's/=.*//'`\n \n   if echo \"$tgt\" | grep \"^hsa\" > /dev/null ; then\n     enable_hsa=1\n   else\n     enable_offloading=1\n-    if test -n \"$tgt_dir\"; then\n-      omp_device_property=\"${tgt_dir}/lib/gcc/\\$(real_target_noncanonical)/\\$(version)/accel/${tgt}/omp-device-properties\"\n-    else\n-      omp_device_property=\"\\$(libsubdir)/accel/${tgt}/omp-device-properties\"\n-    fi\n+    case \"$tgt\" in\n+      *-intelmicemul-*)\n+\tomp_device_property=omp-device-properties-i386\n+\tomp_device_property_tmake_file=\"${omp_device_property_tmake_file} \\$(srcdir)/config/i386/t-omp-device\"\n+\t;;\n+      nvptx*-*)\n+\tomp_device_property=omp-device-properties-nvptx\n+\tomp_device_property_tmake_file=\"${omp_device_property_tmake_file} \\$(srcdir)/config/nvptx/t-omp-device\"\n+\t;;\n+    esac\n     omp_device_properties=\"${omp_device_properties} ${tgt}=${omp_device_property}\"\n     omp_device_property_deps=\"${omp_device_property_deps} ${omp_device_property}\"\n   fi\n@@ -12536,7 +12540,7 @@ do\n \t\ttmake_file_=\"${tmake_file_} \\$(srcdir)/config/$f\"\n \tfi\n done\n-tmake_file=\"${tmake_file_}\"\n+tmake_file=\"${tmake_file_}${omp_device_property_tmake_file}\"\n \n out_object_file=`basename $out_file .c`.o\n common_out_object_file=`basename $common_out_file .c`.o\n@@ -18864,7 +18868,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 18867 \"configure\"\n+#line 18871 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -18970,7 +18974,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 18973 \"configure\"\n+#line 18977 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H"}, {"sha": "8df849f485864500426848f66d5382cc0adb93a6", "filename": "gcc/configure.ac", "status": "modified", "additions": 11, "deletions": 7, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d228ee80f8578be474595a517a228111fac26c5e/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d228ee80f8578be474595a517a228111fac26c5e/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=d228ee80f8578be474595a517a228111fac26c5e", "patch": "@@ -1026,18 +1026,22 @@ AC_SUBST(real_target_noncanonical)\n AC_SUBST(accel_dir_suffix)\n \n for tgt in `echo $enable_offload_targets | sed 's/,/ /g'`; do\n-  tgt_dir=`echo $tgt | sed -n 's/.*=//p'`\n   tgt=`echo $tgt | sed 's/=.*//'`\n \n   if echo \"$tgt\" | grep \"^hsa\" > /dev/null ; then\n     enable_hsa=1\n   else\n     enable_offloading=1\n-    if test -n \"$tgt_dir\"; then\n-      omp_device_property=\"${tgt_dir}/lib/gcc/\\$(real_target_noncanonical)/\\$(version)/accel/${tgt}/omp-device-properties\"\n-    else\n-      omp_device_property=\"\\$(libsubdir)/accel/${tgt}/omp-device-properties\"\n-    fi\n+    case \"$tgt\" in\n+      *-intelmicemul-*)\n+\tomp_device_property=omp-device-properties-i386\n+\tomp_device_property_tmake_file=\"${omp_device_property_tmake_file} \\$(srcdir)/config/i386/t-omp-device\"\n+\t;;\n+      nvptx*-*)\n+\tomp_device_property=omp-device-properties-nvptx\n+\tomp_device_property_tmake_file=\"${omp_device_property_tmake_file} \\$(srcdir)/config/nvptx/t-omp-device\"\n+\t;;\n+    esac\n     omp_device_properties=\"${omp_device_properties} ${tgt}=${omp_device_property}\"\n     omp_device_property_deps=\"${omp_device_property_deps} ${omp_device_property}\"\n   fi\n@@ -2065,7 +2069,7 @@ do\n \t\ttmake_file_=\"${tmake_file_} \\$(srcdir)/config/$f\"\n \tfi\n done\n-tmake_file=\"${tmake_file_}\"\n+tmake_file=\"${tmake_file_}${omp_device_property_tmake_file}\"\n \n out_object_file=`basename $out_file .c`.o\n common_out_object_file=`basename $common_out_file .c`.o"}]}