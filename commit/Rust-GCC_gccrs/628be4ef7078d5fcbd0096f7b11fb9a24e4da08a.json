{"sha": "628be4ef7078d5fcbd0096f7b11fb9a24e4da08a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjI4YmU0ZWY3MDc4ZDVmY2JkMDA5NmY3YjExZmI5YTI0ZTRkYTA4YQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2019-11-02T06:53:53Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-11-02T06:53:53Z"}, "message": "re PR c++/89640 (g++ chokes on lambda with __attribute__)\n\n\tPR c++/89640\n\t* parser.c (cp_parser_decl_specifier_seq): Don't parse attributes\n\tif CP_PARSER_FLAGS_ONLY_MUTABLE_OR_CONSTEXPR.\n\n\t* g++.dg/cpp1z/attr-lambda1.C: New test.\n\t* g++.dg/ext/attr-lambda2.C: New test.\n\nFrom-SVN: r277741", "tree": {"sha": "f86c1070852444331f12cbca2368507e6e82a875", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f86c1070852444331f12cbca2368507e6e82a875"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/628be4ef7078d5fcbd0096f7b11fb9a24e4da08a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/628be4ef7078d5fcbd0096f7b11fb9a24e4da08a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/628be4ef7078d5fcbd0096f7b11fb9a24e4da08a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/628be4ef7078d5fcbd0096f7b11fb9a24e4da08a/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1afe39ac14274d1ce4ffdf9f80833c53175e8581", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1afe39ac14274d1ce4ffdf9f80833c53175e8581", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1afe39ac14274d1ce4ffdf9f80833c53175e8581"}], "stats": {"total": 35, "additions": 34, "deletions": 1}, "files": [{"sha": "54ed775c2e94595006d484e238723db29f26bdcc", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/628be4ef7078d5fcbd0096f7b11fb9a24e4da08a/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/628be4ef7078d5fcbd0096f7b11fb9a24e4da08a/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=628be4ef7078d5fcbd0096f7b11fb9a24e4da08a", "patch": "@@ -1,5 +1,9 @@\n 2019-11-02  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/89640\n+\t* parser.c (cp_parser_decl_specifier_seq): Don't parse attributes\n+\tif CP_PARSER_FLAGS_ONLY_MUTABLE_OR_CONSTEXPR.\n+\n \tPR c++/88335 - Implement P1073R3: Immediate functions\n \t* cp-tree.h (struct lang_decl_fn): Add immediate_fn_p bit.\n \t(DECL_IMMEDIATE_FUNCTION_P, SET_DECL_IMMEDIATE_FUNCTION_P): Define."}, {"sha": "3ed282fd4b2f9ee4c7c1fef9226d155f68cd18be", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/628be4ef7078d5fcbd0096f7b11fb9a24e4da08a/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/628be4ef7078d5fcbd0096f7b11fb9a24e4da08a/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=628be4ef7078d5fcbd0096f7b11fb9a24e4da08a", "patch": "@@ -13994,7 +13994,8 @@ cp_parser_decl_specifier_seq (cp_parser* parser,\n       if (!start_token)\n \tstart_token = token;\n       /* Handle attributes.  */\n-      if (cp_next_tokens_can_be_attribute_p (parser))\n+      if ((flags & CP_PARSER_FLAGS_ONLY_MUTABLE_OR_CONSTEXPR) == 0\n+\t  && cp_next_tokens_can_be_attribute_p (parser))\n \t{\n \t  /* Parse the attributes.  */\n \t  tree attrs = cp_parser_attributes_opt (parser);"}, {"sha": "ea52930076102c1681dab8a0f624f097eadd2527", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/628be4ef7078d5fcbd0096f7b11fb9a24e4da08a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/628be4ef7078d5fcbd0096f7b11fb9a24e4da08a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=628be4ef7078d5fcbd0096f7b11fb9a24e4da08a", "patch": "@@ -1,5 +1,9 @@\n 2019-11-02  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/89640\n+\t* g++.dg/cpp1z/attr-lambda1.C: New test.\n+\t* g++.dg/ext/attr-lambda2.C: New test.\n+\n \t* c-c++-common/gomp/declare-variant-6.c: Expect construct rather than\n \tconstructor in diagnostic messages.\n \t* c-c++-common/gomp/declare-variant-7.c: Likewise."}, {"sha": "f2234725b83aacb01114a7e8e98e1f1434631f92", "filename": "gcc/testsuite/g++.dg/cpp1z/attr-lambda1.C", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/628be4ef7078d5fcbd0096f7b11fb9a24e4da08a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fattr-lambda1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/628be4ef7078d5fcbd0096f7b11fb9a24e4da08a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fattr-lambda1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fattr-lambda1.C?ref=628be4ef7078d5fcbd0096f7b11fb9a24e4da08a", "patch": "@@ -0,0 +1,12 @@\n+// PR c++/89640\n+// { dg-options \"-Wno-attributes\" }\n+// { dg-do compile { target c++17 } }\n+\n+void test() {\n+    []() mutable [[gnu::cold]] constexpr {}();\t\t// { dg-error \"expected\" }\n+    []() constexpr [[gnu::cold]] mutable {}();\t\t// { dg-error \"expected\" }\n+    []() [[gnu::cold]] mutable constexpr {}();\t\t// { dg-error \"expected\" }\n+    []() [[gnu::cold]] constexpr mutable {}();\t\t// { dg-error \"expected\" }\n+    []() mutable constexpr [[gnu::cold]] {}();\n+    []() constexpr mutable [[gnu::cold]] {}();\n+}"}, {"sha": "2926adcc75b59dfcbcfc86ae8645b7f040988b51", "filename": "gcc/testsuite/g++.dg/ext/attr-lambda2.C", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/628be4ef7078d5fcbd0096f7b11fb9a24e4da08a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fattr-lambda2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/628be4ef7078d5fcbd0096f7b11fb9a24e4da08a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fattr-lambda2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fattr-lambda2.C?ref=628be4ef7078d5fcbd0096f7b11fb9a24e4da08a", "patch": "@@ -0,0 +1,12 @@\n+// PR c++/89640\n+// { dg-options \"-Wno-attributes\" }\n+// { dg-do compile { target c++17 } }\n+\n+void test() {\n+    []() mutable __attribute__((cold)) constexpr {}();\t// { dg-error \"expected\" }\n+    []() constexpr __attribute__((cold)) mutable {}();\t// { dg-error \"expected\" }\n+    []() __attribute__((cold)) mutable constexpr {}();\t// { dg-error \"expected\" }\n+    []() __attribute__((cold)) constexpr mutable {}();\t// { dg-error \"expected\" }\n+    []() mutable constexpr __attribute__((cold)) {}();\n+    []() constexpr mutable __attribute__((cold)) {}();\n+}"}]}