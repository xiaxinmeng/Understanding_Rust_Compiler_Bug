{"sha": "01099e0465b7851cc5096c58f7b7155937d44960", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDEwOTllMDQ2NWI3ODUxY2M1MDk2YzU4ZjdiNzE1NTkzN2Q0NDk2MA==", "commit": {"author": {"name": "Pascal Obry", "email": "obry@adacore.com", "date": "2015-05-22T10:38:07Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2015-05-22T10:38:07Z"}, "message": "prj-util.ads, [...] (Relative_Path): New routine.\n\n2015-05-22  Pascal Obry  <obry@adacore.com>\n\n\t* prj-util.ads, prj-util.adb (Relative_Path): New routine.\n\nFrom-SVN: r223542", "tree": {"sha": "600d59b3b2383c9783cb877f737a9941b73c6f77", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/600d59b3b2383c9783cb877f737a9941b73c6f77"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/01099e0465b7851cc5096c58f7b7155937d44960", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/01099e0465b7851cc5096c58f7b7155937d44960", "html_url": "https://github.com/Rust-GCC/gccrs/commit/01099e0465b7851cc5096c58f7b7155937d44960", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/01099e0465b7851cc5096c58f7b7155937d44960/comments", "author": {"login": "TurboGit", "id": 467069, "node_id": "MDQ6VXNlcjQ2NzA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/467069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TurboGit", "html_url": "https://github.com/TurboGit", "followers_url": "https://api.github.com/users/TurboGit/followers", "following_url": "https://api.github.com/users/TurboGit/following{/other_user}", "gists_url": "https://api.github.com/users/TurboGit/gists{/gist_id}", "starred_url": "https://api.github.com/users/TurboGit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TurboGit/subscriptions", "organizations_url": "https://api.github.com/users/TurboGit/orgs", "repos_url": "https://api.github.com/users/TurboGit/repos", "events_url": "https://api.github.com/users/TurboGit/events{/privacy}", "received_events_url": "https://api.github.com/users/TurboGit/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ca811241793e95b1c7be841dda57e459dd03b2eb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca811241793e95b1c7be841dda57e459dd03b2eb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ca811241793e95b1c7be841dda57e459dd03b2eb"}], "stats": {"total": 80, "additions": 78, "deletions": 2}, "files": [{"sha": "0df6bd3da3d641d7019c77243cfb23c804c34c69", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/01099e0465b7851cc5096c58f7b7155937d44960/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/01099e0465b7851cc5096c58f7b7155937d44960/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=01099e0465b7851cc5096c58f7b7155937d44960", "patch": "@@ -1,3 +1,7 @@\n+2015-05-22  Pascal Obry  <obry@adacore.com>\n+\n+\t* prj-util.ads, prj-util.adb (Relative_Path): New routine.\n+\n 2015-05-22  Bob Duff  <duff@adacore.com>\n \n \t* exp_utils.ads, exp_utils.adb (Find_Optional_Prim_Op): New"}, {"sha": "ef500c3219869f8e31d4beaf748cb2cbcaa56e0e", "filename": "gcc/ada/prj-util.adb", "status": "modified", "additions": 69, "deletions": 1, "changes": 70, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/01099e0465b7851cc5096c58f7b7155937d44960/gcc%2Fada%2Fprj-util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/01099e0465b7851cc5096c58f7b7155937d44960/gcc%2Fada%2Fprj-util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-util.adb?ref=01099e0465b7851cc5096c58f7b7155937d44960", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2001-2014, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2001-2015, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -25,6 +25,8 @@\n \n with Ada.Containers.Indefinite_Ordered_Sets;\n with Ada.Directories;\n+with Ada.Strings.Fixed;          use Ada.Strings.Fixed;\n+with Ada.Strings.Maps;           use Ada.Strings.Maps;\n with Ada.Unchecked_Deallocation;\n \n with GNAT.Case_Util; use GNAT.Case_Util;\n@@ -798,6 +800,71 @@ package body Prj.Util is\n       Put (File, L);\n    end Put_Line;\n \n+   -------------------\n+   -- Relative_Path --\n+   -------------------\n+\n+   function Relative_Path (Pathname, To : String) return String is\n+\n+      function Ensure_Directory (Path : String) return String;\n+\n+      ----------------------\n+      -- Ensure_Directory --\n+      ----------------------\n+\n+      function Ensure_Directory (Path : String) return String is\n+      begin\n+         if Path'Length = 0\n+           or else Path (Path'Last) = Directory_Separator\n+           or else Path (Path'Last) = '/' -- on Windows check also for /\n+         then\n+            return Path;\n+         else\n+            return Path & Directory_Separator;\n+         end if;\n+      end Ensure_Directory;\n+\n+      Dir_Sep_Map : constant Character_Mapping := To_Mapping (\"\\\", \"/\");\n+\n+      P  : String (1 .. Pathname'Length) := Pathname;\n+      T  : String (1 .. To'Length) := To;\n+\n+      Pi : Natural; -- common prefix ending\n+      N  : Natural := 0;\n+\n+   begin\n+      pragma Assert (Is_Absolute_Path (Pathname));\n+      pragma Assert (Is_Absolute_Path (To));\n+\n+      --  Use canonical directory separator\n+\n+      Translate (Source => P, Mapping => Dir_Sep_Map);\n+      Translate (Source => T, Mapping => Dir_Sep_Map);\n+\n+      --  First check for common prefix\n+\n+      Pi := 1;\n+      while Pi < P'Last and then Pi < T'Last and then P (Pi) = T (Pi) loop\n+         Pi := Pi + 1;\n+      end loop;\n+\n+      --  Cut common prefix at a directory separator\n+\n+      while Pi > P'First and then P (Pi) /= '/' loop\n+         Pi := Pi - 1;\n+      end loop;\n+\n+      --  Count directory under prefix in P, these will be replaced by the\n+      --  corresponding number of \"..\".\n+\n+      N := Count (T (Pi + 1 .. T'Last), \"/\");\n+      if T (T'Last) /= '/' then\n+         N := N + 1;\n+      end if;\n+\n+      return N * \"../\" & Ensure_Directory (P (Pi + 1 .. P'Last));\n+   end Relative_Path;\n+\n    ---------------------------\n    -- Read_Source_Info_File --\n    ---------------------------\n@@ -1357,4 +1424,5 @@ package body Prj.Util is\n          Write_Str (S (First .. S'Last));\n       end if;\n    end Write_Str;\n+\n end Prj.Util;"}, {"sha": "b0ffbcc5724ee76b72ac7da065fb2e768edbb464", "filename": "gcc/ada/prj-util.ads", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/01099e0465b7851cc5096c58f7b7155937d44960/gcc%2Fada%2Fprj-util.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/01099e0465b7851cc5096c58f7b7155937d44960/gcc%2Fada%2Fprj-util.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-util.ads?ref=01099e0465b7851cc5096c58f7b7155937d44960", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---          Copyright (C) 2001-2012, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2001-2015, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -245,6 +245,10 @@ package Prj.Util is\n    --  are handled. This routine must be called only when the project has\n    --  been built successfully.\n \n+   function Relative_Path (Pathname, To : String) return String;\n+   --  Returns the relative pathname which corresponds to Pathname when\n+   --  starting from directory to. Both Pathname and To must be absolute paths.\n+\n private\n    type Text_File_Data is record\n       FD                  : File_Descriptor := Invalid_FD;"}]}