{"sha": "0786e1fe8688691332e6c4f9aab82956546073c5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDc4NmUxZmU4Njg4NjkxMzMyZTZjNGY5YWFiODI5NTY1NDYwNzNjNQ==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2015-10-07T17:22:08Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2015-10-07T17:22:08Z"}, "message": "re PR go/67874 (fd_unix.go does not build when there is fcntl64 and no fcntl syscall)\n\n\tPR go/67874\n    net, runtime: Call C library fcntl function rather than syscall.Syscall.\n    \n    Not all systems define a fcntl syscall; some only have fcntl64.\n    \n    Fixes GCC PR go/67874.\n    \n    Reviewed-on: https://go-review.googlesource.com/15497\n\nFrom-SVN: r228576", "tree": {"sha": "dfed1026d5397402b85feef171a5e9c2c1ff4dae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dfed1026d5397402b85feef171a5e9c2c1ff4dae"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0786e1fe8688691332e6c4f9aab82956546073c5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0786e1fe8688691332e6c4f9aab82956546073c5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0786e1fe8688691332e6c4f9aab82956546073c5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0786e1fe8688691332e6c4f9aab82956546073c5/comments", "author": null, "committer": null, "parents": [{"sha": "919e06d3f59f9770be5e3968159a46f6c077c9f8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/919e06d3f59f9770be5e3968159a46f6c077c9f8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/919e06d3f59f9770be5e3968159a46f6c077c9f8"}], "stats": {"total": 36, "additions": 34, "deletions": 2}, "files": [{"sha": "19dcf2a646232f838f4859dd5e6589b66e27cccb", "filename": "gcc/go/gofrontend/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0786e1fe8688691332e6c4f9aab82956546073c5/gcc%2Fgo%2Fgofrontend%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0786e1fe8688691332e6c4f9aab82956546073c5/gcc%2Fgo%2Fgofrontend%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2FMERGE?ref=0786e1fe8688691332e6c4f9aab82956546073c5", "patch": "@@ -1,4 +1,4 @@\n-3039d79149901d25d89c2412bdd8684f3cbcd09e\n+651e71a729e5dcbd9dc14c1b59b6eff05bfe3d26\n \n The first line of this file holds the git revision number of the last\n merge done from the gofrontend repository."}, {"sha": "45a4eb8f123ad8a94b79cfadfb2269785cf312ae", "filename": "libgo/go/net/fd_unix.go", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0786e1fe8688691332e6c4f9aab82956546073c5/libgo%2Fgo%2Fnet%2Ffd_unix.go", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0786e1fe8688691332e6c4f9aab82956546073c5/libgo%2Fgo%2Fnet%2Ffd_unix.go", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fgo%2Fnet%2Ffd_unix.go?ref=0786e1fe8688691332e6c4f9aab82956546073c5", "patch": "@@ -442,13 +442,21 @@ func (fd *netFD) accept() (netfd *netFD, err error) {\n \treturn netfd, nil\n }\n \n+// Use a helper function to call fcntl.  This is defined in C in\n+// libgo/runtime.\n+//extern __go_fcntl_uintptr\n+func fcntl(uintptr, uintptr, uintptr) (uintptr, uintptr)\n+\n // tryDupCloexec indicates whether F_DUPFD_CLOEXEC should be used.\n // If the kernel doesn't support it, this is set to 0.\n var tryDupCloexec = int32(1)\n \n func dupCloseOnExec(fd int) (newfd int, err error) {\n \tif atomic.LoadInt32(&tryDupCloexec) == 1 && syscall.F_DUPFD_CLOEXEC != 0 {\n-\t\tr0, _, e1 := syscall.Syscall(syscall.SYS_FCNTL, uintptr(fd), syscall.F_DUPFD_CLOEXEC, 0)\n+\t\tsyscall.Entersyscall()\n+\t\tr0, errno := fcntl(uintptr(fd), syscall.F_DUPFD_CLOEXEC, 0)\n+\t\tsyscall.Exitsyscall()\n+\t\te1 := syscall.Errno(errno)\n \t\tif runtime.GOOS == \"darwin\" && e1 == syscall.EBADF {\n \t\t\t// On OS X 10.6 and below (but we only support\n \t\t\t// >= 10.6), F_DUPFD_CLOEXEC is unsupported"}, {"sha": "7a2006fbab22f282cdc539f83067b7c0f14b9f6e", "filename": "libgo/runtime/go-varargs.c", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0786e1fe8688691332e6c4f9aab82956546073c5/libgo%2Fruntime%2Fgo-varargs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0786e1fe8688691332e6c4f9aab82956546073c5/libgo%2Fruntime%2Fgo-varargs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fruntime%2Fgo-varargs.c?ref=0786e1fe8688691332e6c4f9aab82956546073c5", "patch": "@@ -6,6 +6,8 @@\n \n #include \"config.h\"\n \n+#include <errno.h>\n+#include <stdint.h>\n #include <sys/types.h>\n #include <fcntl.h>\n \n@@ -32,6 +34,28 @@ __go_fcntl_flock (int fd, int cmd, struct flock *arg)\n   return fcntl (fd, cmd, arg);\n }\n \n+// This is for the net package.  We use uintptr_t to make sure that\n+// the types match, since the Go and C \"int\" types are not the same.\n+struct go_fcntl_ret {\n+  uintptr_t r;\n+  uintptr_t err;\n+};\n+\n+struct go_fcntl_ret\n+__go_fcntl_uintptr (uintptr_t fd, uintptr_t cmd, uintptr_t arg)\n+{\n+  int r;\n+  struct go_fcntl_ret ret;\n+\n+  r = fcntl ((int) fd, (int) cmd, (int) arg);\n+  ret.r = (uintptr_t) r;\n+  if (r < 0)\n+    ret.err = (uintptr_t) errno;\n+  else\n+    ret.err = 0;\n+  return ret;\n+}\n+\n #ifdef HAVE_OPEN64\n \n int"}]}