{"sha": "3dd598be88193ee087ab51312b5e464b2d6e2891", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2RkNTk4YmU4ODE5M2VlMDg3YWI1MTMxMmI1ZTQ2NGIyZDZlMjg5MQ==", "commit": {"author": {"name": "Ilya Enkovich", "email": "ilya.enkovich@intel.com", "date": "2015-01-27T09:09:28Z"}, "committer": {"name": "Ilya Enkovich", "email": "ienkovich@gcc.gnu.org", "date": "2015-01-27T09:09:28Z"}, "message": "tree-chkp.c (chkp_call_returns_bounds_p): Fix handling of bounds narrowing...\n\ngcc/\n\n\t* tree-chkp.c (chkp_call_returns_bounds_p): Fix handling of\n\tbounds narrowing, already instrumented calls and calls to\n\tnot instrumentable functions.\n\ngcc/testsuite/\n\n\t* gcc.target/i386/chkp-narrow-bounds.c: New.\n\nFrom-SVN: r220154", "tree": {"sha": "a2bf30768dbb9420eeae351f01e4395ac6b1b049", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a2bf30768dbb9420eeae351f01e4395ac6b1b049"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3dd598be88193ee087ab51312b5e464b2d6e2891", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3dd598be88193ee087ab51312b5e464b2d6e2891", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3dd598be88193ee087ab51312b5e464b2d6e2891", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3dd598be88193ee087ab51312b5e464b2d6e2891/comments", "author": {"login": "ienkovich", "id": 18308708, "node_id": "MDQ6VXNlcjE4MzA4NzA4", "avatar_url": "https://avatars.githubusercontent.com/u/18308708?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ienkovich", "html_url": "https://github.com/ienkovich", "followers_url": "https://api.github.com/users/ienkovich/followers", "following_url": "https://api.github.com/users/ienkovich/following{/other_user}", "gists_url": "https://api.github.com/users/ienkovich/gists{/gist_id}", "starred_url": "https://api.github.com/users/ienkovich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ienkovich/subscriptions", "organizations_url": "https://api.github.com/users/ienkovich/orgs", "repos_url": "https://api.github.com/users/ienkovich/repos", "events_url": "https://api.github.com/users/ienkovich/events{/privacy}", "received_events_url": "https://api.github.com/users/ienkovich/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b30ea1387f8e26ad60bd4d71ba2006ea7e11a6ee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b30ea1387f8e26ad60bd4d71ba2006ea7e11a6ee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b30ea1387f8e26ad60bd4d71ba2006ea7e11a6ee"}], "stats": {"total": 33, "additions": 31, "deletions": 2}, "files": [{"sha": "5597e32b3f9c2325505cf8c0c0124843c1de3267", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3dd598be88193ee087ab51312b5e464b2d6e2891/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3dd598be88193ee087ab51312b5e464b2d6e2891/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3dd598be88193ee087ab51312b5e464b2d6e2891", "patch": "@@ -1,3 +1,9 @@\n+2015-01-27  Ilya Enkovich  <ilya.enkovich@intel.com>\n+\n+\t* tree-chkp.c (chkp_call_returns_bounds_p): Fix handling of\n+\tbounds narrowing, already instrumented calls and calls to\n+\tnot instrumentable functions.\n+\n 2015-01-27  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR tree-optimization/64807"}, {"sha": "0686fa7caaa4fc91bba94b1c2fea3938e90ce8ec", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3dd598be88193ee087ab51312b5e464b2d6e2891/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3dd598be88193ee087ab51312b5e464b2d6e2891/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3dd598be88193ee087ab51312b5e464b2d6e2891", "patch": "@@ -1,3 +1,7 @@\n+2015-01-27  Ilya Enkovich  <ilya.enkovich@intel.com>\n+\n+\t* gcc.target/i386/chkp-narrow-bounds.c: New.\n+\n 2015-01-27  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR tree-optimization/64807"}, {"sha": "28bc622570f13a11b1b0f64befb3ad6cdd6ef3af", "filename": "gcc/testsuite/gcc.target/i386/chkp-narrow-bounds.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3dd598be88193ee087ab51312b5e464b2d6e2891/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fchkp-narrow-bounds.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3dd598be88193ee087ab51312b5e464b2d6e2891/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fchkp-narrow-bounds.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fchkp-narrow-bounds.c?ref=3dd598be88193ee087ab51312b5e464b2d6e2891", "patch": "@@ -0,0 +1,13 @@\n+/* { dg-do compile } */\n+/* { dg-require-effective-target mpx } */\n+/* { dg-options \"-fcheck-pointer-bounds -mmpx -O2 -fdump-tree-chkp\" } */\n+/* { dg-final { scan-tree-dump \"bndcl\" \"chkp\" } } */\n+/* { dg-final { scan-tree-dump \"bndcu\" \"chkp\" } } */\n+/* { dg-final { cleanup-tree-dump \"chkp\" } } */\n+\n+int\n+test (int *p)\n+{\n+  int *p1 = __bnd_narrow_ptr_bounds (p - 10, p, sizeof (int) * 20);\n+  return p1[10];\n+}"}, {"sha": "b0a3a1547ffe965e59551e010129bb0ee5446e89", "filename": "gcc/tree-chkp.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3dd598be88193ee087ab51312b5e464b2d6e2891/gcc%2Ftree-chkp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3dd598be88193ee087ab51312b5e464b2d6e2891/gcc%2Ftree-chkp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-chkp.c?ref=3dd598be88193ee087ab51312b5e464b2d6e2891", "patch": "@@ -2113,13 +2113,19 @@ chkp_call_returns_bounds_p (gcall *call)\n   if (gimple_call_internal_p (call))\n     return false;\n \n+  if (gimple_call_builtin_p (call, BUILT_IN_CHKP_NARROW_PTR_BOUNDS)\n+      || chkp_gimple_call_builtin_p (call, BUILT_IN_CHKP_NARROW))\n+    return true;\n+\n+  if (gimple_call_with_bounds_p (call))\n+    return true;\n+\n   tree fndecl = gimple_call_fndecl (call);\n \n   if (fndecl && DECL_BUILT_IN_CLASS (fndecl) == BUILT_IN_MD)\n     return false;\n \n-  if (fndecl\n-      && lookup_attribute (\"bnd_legacy\", DECL_ATTRIBUTES (fndecl)))\n+  if (fndecl && !chkp_instrumentable_p (fndecl))\n     return false;\n \n   if (fndecl && DECL_BUILT_IN_CLASS (fndecl) == BUILT_IN_NORMAL)"}]}