{"sha": "dad495e30135904b0d0305eab8c0ce5f838440d4", "node_id": "C_kwDOANBUbNoAKGRhZDQ5NWUzMDEzNTkwNGIwZDAzMDVlYWI4YzBjZTVmODM4NDQwZDQ", "commit": {"author": {"name": "Maciej W. Rozycki", "email": "macro@embecosm.com", "date": "2022-01-18T19:39:13Z"}, "committer": {"name": "Maciej W. Rozycki", "email": "macro@embecosm.com", "date": "2022-01-18T19:39:13Z"}, "message": "RISC-V: Fix use-after-free error in `parse_multiletter_ext'\n\nAvoid undefined arithmetic involving a pointer to a heap allocation that\nhas been freed and move a problematic calculation ahead of the following\ncall to `free' in `riscv_subset_list::parse_multiletter_ext', removing a\ncompilation error:\n\n.../gcc/common/config/riscv/riscv-common.cc: In member function 'const char* riscv_subset_list::parse_multiletter_ext(const char*, const char*, const char*)':\n.../gcc/common/config/riscv/riscv-common.cc:905:27: error: pointer 'subset' used after 'void free(void*)' [-Werror=use-after-free]\n  905 |       p += end_of_version - subset;\n      |            ~~~~~~~~~~~~~~~^~~~~~~~\n.../gcc/common/config/riscv/riscv-common.cc:904:12: note: call to 'void free(void*)' here\n  904 |       free (subset);\n      |       ~~~~~^~~~~~~~\ncc1plus: all warnings being treated as errors\nmake[2]: *** [Makefile:2428: riscv-common.o] Error 1\n\nand a build regression from commit 671a283636de (\"Add -Wuse-after-free\n[PR80532].\").\n\n\tgcc/\n\t* common/config/riscv/riscv-common.cc\n\t(riscv_subset_list::parse_multiletter_ext): Move pointer\n\tarithmetic ahead of `free'.", "tree": {"sha": "7c574644eec926160938231d5c10280a8e85edf5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7c574644eec926160938231d5c10280a8e85edf5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dad495e30135904b0d0305eab8c0ce5f838440d4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dad495e30135904b0d0305eab8c0ce5f838440d4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dad495e30135904b0d0305eab8c0ce5f838440d4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dad495e30135904b0d0305eab8c0ce5f838440d4/comments", "author": {"login": "maciej-w-rozycki", "id": 117297942, "node_id": "U_kgDOBv3TFg", "avatar_url": "https://avatars.githubusercontent.com/u/117297942?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maciej-w-rozycki", "html_url": "https://github.com/maciej-w-rozycki", "followers_url": "https://api.github.com/users/maciej-w-rozycki/followers", "following_url": "https://api.github.com/users/maciej-w-rozycki/following{/other_user}", "gists_url": "https://api.github.com/users/maciej-w-rozycki/gists{/gist_id}", "starred_url": "https://api.github.com/users/maciej-w-rozycki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maciej-w-rozycki/subscriptions", "organizations_url": "https://api.github.com/users/maciej-w-rozycki/orgs", "repos_url": "https://api.github.com/users/maciej-w-rozycki/repos", "events_url": "https://api.github.com/users/maciej-w-rozycki/events{/privacy}", "received_events_url": "https://api.github.com/users/maciej-w-rozycki/received_events", "type": "User", "site_admin": false}, "committer": {"login": "maciej-w-rozycki", "id": 117297942, "node_id": "U_kgDOBv3TFg", "avatar_url": "https://avatars.githubusercontent.com/u/117297942?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maciej-w-rozycki", "html_url": "https://github.com/maciej-w-rozycki", "followers_url": "https://api.github.com/users/maciej-w-rozycki/followers", "following_url": "https://api.github.com/users/maciej-w-rozycki/following{/other_user}", "gists_url": "https://api.github.com/users/maciej-w-rozycki/gists{/gist_id}", "starred_url": "https://api.github.com/users/maciej-w-rozycki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maciej-w-rozycki/subscriptions", "organizations_url": "https://api.github.com/users/maciej-w-rozycki/orgs", "repos_url": "https://api.github.com/users/maciej-w-rozycki/repos", "events_url": "https://api.github.com/users/maciej-w-rozycki/events{/privacy}", "received_events_url": "https://api.github.com/users/maciej-w-rozycki/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0d01a2722671bef37b931fd1f121e44b27e68268", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0d01a2722671bef37b931fd1f121e44b27e68268", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0d01a2722671bef37b931fd1f121e44b27e68268"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "25f56707d94982864788cf3e7626fcf4d4ffccf9", "filename": "gcc/common/config/riscv/riscv-common.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dad495e30135904b0d0305eab8c0ce5f838440d4/gcc%2Fcommon%2Fconfig%2Friscv%2Friscv-common.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dad495e30135904b0d0305eab8c0ce5f838440d4/gcc%2Fcommon%2Fconfig%2Friscv%2Friscv-common.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcommon%2Fconfig%2Friscv%2Friscv-common.cc?ref=dad495e30135904b0d0305eab8c0ce5f838440d4", "patch": "@@ -901,8 +901,8 @@ riscv_subset_list::parse_multiletter_ext (const char *p,\n \t}\n \n       add (subset, major_version, minor_version, explicit_version_p, false);\n-      free (subset);\n       p += end_of_version - subset;\n+      free (subset);\n \n       if (*p != '\\0' && *p != '_')\n \t{"}]}