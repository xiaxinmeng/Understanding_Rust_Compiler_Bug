{"sha": "5a5da48013f29c55bd9a4221ebc72104b80e4982", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWE1ZGE0ODAxM2YyOWM1NWJkOWE0MjIxZWJjNzIxMDRiODBlNDk4Mg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2019-06-11T13:01:40Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-06-11T13:01:40Z"}, "message": "re PR c++/90810 (Different intrinsics behavior on G++ 7.4 and G++ 8.3)\n\n\tPR c++/90810\n\t* init.c (constant_value_1): Handle VECTOR_CST DECL_INITIAL for\n\t!DECL_INITIALIZED_BY_CONSTANT_EXPRESSION_P decls like CONSTRUCTOR.\n\n\t* g++.dg/ext/vector37.C: New test.\n\nFrom-SVN: r272152", "tree": {"sha": "2bc3d382017ed835296e5947bcc18fc10ff41a26", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2bc3d382017ed835296e5947bcc18fc10ff41a26"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5a5da48013f29c55bd9a4221ebc72104b80e4982", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5a5da48013f29c55bd9a4221ebc72104b80e4982", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5a5da48013f29c55bd9a4221ebc72104b80e4982", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5a5da48013f29c55bd9a4221ebc72104b80e4982/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7ac9a201848f020a7803c5b3e20dc4768a992c40", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ac9a201848f020a7803c5b3e20dc4768a992c40", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7ac9a201848f020a7803c5b3e20dc4768a992c40"}], "stats": {"total": 47, "additions": 45, "deletions": 2}, "files": [{"sha": "757f3fccf31f5ccd596c4686f60884ad4480889c", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5a5da48013f29c55bd9a4221ebc72104b80e4982/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5a5da48013f29c55bd9a4221ebc72104b80e4982/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=5a5da48013f29c55bd9a4221ebc72104b80e4982", "patch": "@@ -1,3 +1,9 @@\n+2019-06-11  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/90810\n+\t* init.c (constant_value_1): Handle VECTOR_CST DECL_INITIAL for\n+\t!DECL_INITIALIZED_BY_CONSTANT_EXPRESSION_P decls like CONSTRUCTOR.\n+\n 2019-06-11  Martin Liska  <mliska@suse.cz>\n \n \tPR c++/87847"}, {"sha": "e962113d15434712a5391f5620fcc2cb5c35faa1", "filename": "gcc/cp/init.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5a5da48013f29c55bd9a4221ebc72104b80e4982/gcc%2Fcp%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5a5da48013f29c55bd9a4221ebc72104b80e4982/gcc%2Fcp%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Finit.c?ref=5a5da48013f29c55bd9a4221ebc72104b80e4982", "patch": "@@ -2339,8 +2339,11 @@ constant_value_1 (tree decl, bool strict_p, bool return_aggregate_cst_ok_p)\n \t\t  || TREE_CODE (init) == STRING_CST)))\n \tbreak;\n       /* Don't return a CONSTRUCTOR for a variable with partial run-time\n-\t initialization, since it doesn't represent the entire value.  */\n-      if (TREE_CODE (init) == CONSTRUCTOR\n+\t initialization, since it doesn't represent the entire value.\n+\t Similarly for VECTOR_CSTs created by cp_folding those\n+\t CONSTRUCTORs.  */\n+      if ((TREE_CODE (init) == CONSTRUCTOR\n+\t   || TREE_CODE (init) == VECTOR_CST)\n \t  && !DECL_INITIALIZED_BY_CONSTANT_EXPRESSION_P (decl))\n \tbreak;\n       /* If the variable has a dynamic initializer, don't use its"}, {"sha": "beecd96eab56b7c12d16b866b4fac7cb4b6d419d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5a5da48013f29c55bd9a4221ebc72104b80e4982/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5a5da48013f29c55bd9a4221ebc72104b80e4982/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5a5da48013f29c55bd9a4221ebc72104b80e4982", "patch": "@@ -1,3 +1,8 @@\n+2019-06-11  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/90810\n+\t* g++.dg/ext/vector37.C: New test.\n+\n 2019-06-10  Matthew Beliveau  <mbelivea@redhat.com>\n \n \tPR c++/87250"}, {"sha": "a7baf8d33f98106c63fb8a3d9dde278ab080f338", "filename": "gcc/testsuite/g++.dg/ext/vector37.C", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5a5da48013f29c55bd9a4221ebc72104b80e4982/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvector37.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5a5da48013f29c55bd9a4221ebc72104b80e4982/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvector37.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvector37.C?ref=5a5da48013f29c55bd9a4221ebc72104b80e4982", "patch": "@@ -0,0 +1,29 @@\n+// PR c++/90810\n+// { dg-do run }\n+\n+void\n+foo (float x, float y)\n+{\n+  typedef float __attribute__ ((__vector_size__ (4 * sizeof (float)), __may_alias__)) V;\n+  const V a = { x, x, x, x }, b = { y, y, y, y };\n+  const V c = a / b;\n+  if (c[0] != 6.0f || c[1] != 6.0f || c[2] != 6.0f || c[3] != 6.0f)\n+    __builtin_abort ();\n+}\n+\n+void\n+bar (float y)\n+{\n+  typedef float __attribute__ ((__vector_size__ (4 * sizeof (float)), __may_alias__)) V;\n+  const V a = { 7.0f, 8.0f, 9.0f, 10.0f }, b = { 1.0f, 2.0f, 3.0f, y };\n+  const V c = a / b;\n+  if (c[0] != 7.0f || c[1] != 4.0f || c[2] != 3.0f || c[3] != 5.0f)\n+    __builtin_abort ();\n+}\n+\n+int\n+main ()\n+{\n+  foo (12.0f, 2.0f);\n+  bar (2.0f);\n+}"}]}