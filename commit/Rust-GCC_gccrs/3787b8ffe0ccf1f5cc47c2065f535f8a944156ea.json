{"sha": "3787b8ffe0ccf1f5cc47c2065f535f8a944156ea", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mzc4N2I4ZmZlMGNjZjFmNWNjNDdjMjA2NWY1MzVmOGE5NDQxNTZlYQ==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2011-12-08T18:56:58Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2011-12-08T18:56:58Z"}, "message": "re PR fortran/51378 ([OOP] Structure constructor wrongly rejects parent components if only child has PRIVATE comps)\n\n2011-12-08  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/51378\n        * symbol.c (gfc_find_component): Fix access check of parent\n        components.\n\n2011-12-08  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/51378\n        * gfortran.dg/private_type_14.f90: New.\n\nFrom-SVN: r182133", "tree": {"sha": "ed6dc1b12ec1287f852f63b9512c2ca1df234c2e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ed6dc1b12ec1287f852f63b9512c2ca1df234c2e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3787b8ffe0ccf1f5cc47c2065f535f8a944156ea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3787b8ffe0ccf1f5cc47c2065f535f8a944156ea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3787b8ffe0ccf1f5cc47c2065f535f8a944156ea", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3787b8ffe0ccf1f5cc47c2065f535f8a944156ea/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "14dcdf69d57b85cc5926162da7699f4846bb3faf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/14dcdf69d57b85cc5926162da7699f4846bb3faf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/14dcdf69d57b85cc5926162da7699f4846bb3faf"}], "stats": {"total": 84, "additions": 69, "deletions": 15}, "files": [{"sha": "986ee2d01e174b1ada822033e87190a983a285ac", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3787b8ffe0ccf1f5cc47c2065f535f8a944156ea/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3787b8ffe0ccf1f5cc47c2065f535f8a944156ea/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=3787b8ffe0ccf1f5cc47c2065f535f8a944156ea", "patch": "@@ -1,3 +1,9 @@\n+2011-12-08  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/51378\n+\t* symbol.c (gfc_find_component): Fix access check of parent\n+\tcomponents.\n+\n 2011-12-08  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/51407"}, {"sha": "fcc1ccfec583f9df9bc192118aa65cfd01c0a386", "filename": "gcc/fortran/symbol.c", "status": "modified", "additions": 15, "deletions": 15, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3787b8ffe0ccf1f5cc47c2065f535f8a944156ea/gcc%2Ffortran%2Fsymbol.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3787b8ffe0ccf1f5cc47c2065f535f8a944156ea/gcc%2Ffortran%2Fsymbol.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsymbol.c?ref=3787b8ffe0ccf1f5cc47c2065f535f8a944156ea", "patch": "@@ -2022,6 +2022,21 @@ gfc_find_component (gfc_symbol *sym, const char *name,\n     if (strcmp (p->name, name) == 0)\n       break;\n \n+  if (p && sym->attr.use_assoc && !noaccess)\n+    {\n+      bool is_parent_comp = sym->attr.extension && (p == sym->components);\n+      if (p->attr.access == ACCESS_PRIVATE ||\n+\t  (p->attr.access != ACCESS_PUBLIC\n+\t   && sym->component_access == ACCESS_PRIVATE\n+\t   && !is_parent_comp))\n+\t{\n+\t  if (!silent)\n+\t    gfc_error (\"Component '%s' at %C is a PRIVATE component of '%s'\",\n+\t\t       name, sym->name);\n+\t  return NULL;\n+\t}\n+    }\n+\n   if (p == NULL\n \t&& sym->attr.extension\n \t&& sym->components->ts.type == BT_DERIVED)\n@@ -2037,21 +2052,6 @@ gfc_find_component (gfc_symbol *sym, const char *name,\n     gfc_error (\"'%s' at %C is not a member of the '%s' structure\",\n \t       name, sym->name);\n \n-  else if (sym->attr.use_assoc && !noaccess)\n-    {\n-      bool is_parent_comp = sym->attr.extension && (p == sym->components);\n-      if (p->attr.access == ACCESS_PRIVATE ||\n-\t  (p->attr.access != ACCESS_PUBLIC\n-\t   && sym->component_access == ACCESS_PRIVATE\n-\t   && !is_parent_comp))\n-\t{\n-\t  if (!silent)\n-\t    gfc_error (\"Component '%s' at %C is a PRIVATE component of '%s'\",\n-\t\t       name, sym->name);\n-\t  return NULL;\n-\t}\n-    }\n-\n   return p;\n }\n "}, {"sha": "452fdddab1383c1717cba8d24a636bbcc9cfb9b5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3787b8ffe0ccf1f5cc47c2065f535f8a944156ea/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3787b8ffe0ccf1f5cc47c2065f535f8a944156ea/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3787b8ffe0ccf1f5cc47c2065f535f8a944156ea", "patch": "@@ -1,3 +1,8 @@\n+2011-12-08  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/51378\n+\t* gfortran.dg/private_type_14.f90: New.\n+\n 2011-12-08  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/51407"}, {"sha": "6c90b86411a7352fee900b36d9980003aae8e74c", "filename": "gcc/testsuite/gfortran.dg/private_type_14.f90", "status": "added", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3787b8ffe0ccf1f5cc47c2065f535f8a944156ea/gcc%2Ftestsuite%2Fgfortran.dg%2Fprivate_type_14.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3787b8ffe0ccf1f5cc47c2065f535f8a944156ea/gcc%2Ftestsuite%2Fgfortran.dg%2Fprivate_type_14.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fprivate_type_14.f90?ref=3787b8ffe0ccf1f5cc47c2065f535f8a944156ea", "patch": "@@ -0,0 +1,43 @@\n+! { dg-do compile }\n+!\n+! PR fortran/51378\n+!\n+! Allow constructor to nonprivate parent compoents,\n+! even if the extension specified PRIVATE for its own components\n+!\n+! Contributed by Reinhold Bader\n+!\n+module type_ext\n+  type :: vec\n+     real, dimension(3) :: comp\n+     integer :: len\n+  end type vec\n+  type, extends(vec) :: l_vec\n+     private\n+     character(len=20) :: label = '01234567890123456789'\n+  end type l_vec\n+end module type_ext\n+program test_ext\n+  use type_ext\n+  implicit none\n+  type(vec) :: o_vec, oo_vec\n+  type(l_vec) :: o_l_vec\n+  integer :: i\n+!\n+  o_vec = vec((/1.0, 2.0, 3.0/),3)\n+!  write(*,*) o_vec%comp, o_vec%len\n+  o_l_vec = l_vec(comp=(/1.0, 2.0, 3.0/),len=3)\n+! partial constr. not accepted by ifort 11.1, fixed in 12.0 (issue 562240)\n+!  write(*,*) o_l_vec%comp, o_l_vec%len\n+!  write(*,*) o_l_vec%vec\n+  oo_vec = o_l_vec%vec\n+  do i=1, 3\n+    if (abs(oo_vec%comp(i) - o_vec%comp(i)) > 1.0E-5) then\n+       write(*, *) 'FAIL'\n+       stop\n+    end if\n+  end do\n+  write(*, *) 'OK'\n+end program\n+\n+! { dg-final { cleanup-modules \"type_ext\" } }"}]}