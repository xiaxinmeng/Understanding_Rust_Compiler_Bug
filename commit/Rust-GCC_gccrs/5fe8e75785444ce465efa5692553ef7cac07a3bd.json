{"sha": "5fe8e75785444ce465efa5692553ef7cac07a3bd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWZlOGU3NTc4NTQ0NGNlNDY1ZWZhNTY5MjU1M2VmN2NhYzA3YTNiZA==", "commit": {"author": {"name": "Martin Jambor", "email": "mjambor@suse.cz", "date": "2013-06-24T12:51:43Z"}, "committer": {"name": "Martin Jambor", "email": "jamborm@gcc.gnu.org", "date": "2013-06-24T12:51:43Z"}, "message": "re PR tree-optimization/57358 (segmentation fault with attribute(optimize(O0)))\n\n2013-06-24  Martin Jambor  <mjambor@suse.cz>\n\n\tPR tree-optimization/57358\n\t* ipa-prop.c (ipa_func_spec_opts_forbid_analysis_p): New function.\n\t(ipa_compute_jump_functions_for_edge): Bail out if it returns true.\n\t(ipa_analyze_params_uses): Generate pessimistic info when true.\n\ntestsuite\n\t* gcc.dg/ipa/pr57358.c: New test.\n\nFrom-SVN: r200369", "tree": {"sha": "56275519efe2b184d885e764d4ba6ab580d4b164", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/56275519efe2b184d885e764d4ba6ab580d4b164"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5fe8e75785444ce465efa5692553ef7cac07a3bd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5fe8e75785444ce465efa5692553ef7cac07a3bd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5fe8e75785444ce465efa5692553ef7cac07a3bd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5fe8e75785444ce465efa5692553ef7cac07a3bd/comments", "author": {"login": "jamborm", "id": 2180070, "node_id": "MDQ6VXNlcjIxODAwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2180070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamborm", "html_url": "https://github.com/jamborm", "followers_url": "https://api.github.com/users/jamborm/followers", "following_url": "https://api.github.com/users/jamborm/following{/other_user}", "gists_url": "https://api.github.com/users/jamborm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamborm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamborm/subscriptions", "organizations_url": "https://api.github.com/users/jamborm/orgs", "repos_url": "https://api.github.com/users/jamborm/repos", "events_url": "https://api.github.com/users/jamborm/events{/privacy}", "received_events_url": "https://api.github.com/users/jamborm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "44a60244592da0196f7c1d8cfe56bc95d7cdae0e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44a60244592da0196f7c1d8cfe56bc95d7cdae0e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/44a60244592da0196f7c1d8cfe56bc95d7cdae0e"}], "stats": {"total": 52, "additions": 50, "deletions": 2}, "files": [{"sha": "8f45983db5fa31693bcc93a1f84f261f9eda1ebc", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5fe8e75785444ce465efa5692553ef7cac07a3bd/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5fe8e75785444ce465efa5692553ef7cac07a3bd/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5fe8e75785444ce465efa5692553ef7cac07a3bd", "patch": "@@ -1,3 +1,10 @@\n+2013-06-24  Martin Jambor  <mjambor@suse.cz>\n+\n+\tPR tree-optimization/57358\n+\t* ipa-prop.c (ipa_func_spec_opts_forbid_analysis_p): New function.\n+\t(ipa_compute_jump_functions_for_edge): Bail out if it returns true.\n+\t(ipa_analyze_params_uses): Generate pessimistic info when true.\n+\n 2013-06-24  Martin Jambor  <mjambor@suse.cz>\n \n \tPR tree-optimization/57539"}, {"sha": "ae6825b003a807810729162f3797d94adba58a97", "filename": "gcc/ipa-prop.c", "status": "modified", "additions": 29, "deletions": 2, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5fe8e75785444ce465efa5692553ef7cac07a3bd/gcc%2Fipa-prop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5fe8e75785444ce465efa5692553ef7cac07a3bd/gcc%2Fipa-prop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-prop.c?ref=5fe8e75785444ce465efa5692553ef7cac07a3bd", "patch": "@@ -78,6 +78,21 @@ struct ipa_cst_ref_desc\n \n static alloc_pool ipa_refdesc_pool;\n \n+/* Return true if DECL_FUNCTION_SPECIFIC_OPTIMIZATION of the decl associated\n+   with NODE should prevent us from analyzing it for the purposes of IPA-CP.  */\n+\n+static bool\n+ipa_func_spec_opts_forbid_analysis_p (struct cgraph_node *node)\n+{\n+  tree fs_opts = DECL_FUNCTION_SPECIFIC_OPTIMIZATION (node->symbol.decl);\n+  struct cl_optimization *os;\n+\n+  if (!fs_opts)\n+    return false;\n+  os = TREE_OPTIMIZATION (fs_opts);\n+  return !os->x_optimize || !os->x_flag_ipa_cp;\n+}\n+\n /* Return index of the formal whose tree is PTREE in function which corresponds\n    to INFO.  */\n \n@@ -1446,6 +1461,9 @@ ipa_compute_jump_functions_for_edge (struct param_analysis_info *parms_ainfo,\n     return;\n   vec_safe_grow_cleared (args->jump_functions, arg_num);\n \n+  if (ipa_func_spec_opts_forbid_analysis_p (cs->caller))\n+    return;\n+\n   for (n = 0; n < arg_num; n++)\n     {\n       struct ipa_jump_func *jfunc = ipa_get_ith_jump_func (args, n);\n@@ -1936,6 +1954,17 @@ ipa_analyze_params_uses (struct cgraph_node *node,\n   if (ipa_get_param_count (info) == 0 || info->uses_analysis_done)\n     return;\n \n+  info->uses_analysis_done = 1;\n+  if (ipa_func_spec_opts_forbid_analysis_p (node))\n+    {\n+      for (i = 0; i < ipa_get_param_count (info); i++)\n+\t{\n+\t  ipa_set_param_used (info, i, true);\n+\t  ipa_set_controlled_uses (info, i, IPA_UNDESCRIBED_USE);\n+\t}\n+      return;\n+    }\n+\n   for (i = 0; i < ipa_get_param_count (info); i++)\n     {\n       tree parm = ipa_get_param (info, i);\n@@ -1992,8 +2021,6 @@ ipa_analyze_params_uses (struct cgraph_node *node,\n \t\t\t\t       visit_ref_for_mod_analysis,\n \t\t\t\t       visit_ref_for_mod_analysis);\n     }\n-\n-  info->uses_analysis_done = 1;\n }\n \n /* Free stuff in PARMS_AINFO, assume there are PARAM_COUNT parameters.  */"}, {"sha": "9940868d34503047cf37cbb844af330c56673c36", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5fe8e75785444ce465efa5692553ef7cac07a3bd/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5fe8e75785444ce465efa5692553ef7cac07a3bd/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5fe8e75785444ce465efa5692553ef7cac07a3bd", "patch": "@@ -1,3 +1,8 @@\n+2013-06-24  Martin Jambor  <mjambor@suse.cz>\n+\n+\tPR tree-optimization/57358\n+\t* gcc.dg/ipa/pr57358.c: New test.\n+\n 2013-06-24  Richard Biener  <rguenther@suse.de>\n \n \tPR testsuite/57686"}, {"sha": "c83396f4c0bd1e833dc937dfac88d742f3b79b20", "filename": "gcc/testsuite/gcc.dg/ipa/pr57358.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5fe8e75785444ce465efa5692553ef7cac07a3bd/gcc%2Ftestsuite%2Fgcc.dg%2Fipa%2Fpr57358.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5fe8e75785444ce465efa5692553ef7cac07a3bd/gcc%2Ftestsuite%2Fgcc.dg%2Fipa%2Fpr57358.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fipa%2Fpr57358.c?ref=5fe8e75785444ce465efa5692553ef7cac07a3bd", "patch": "@@ -0,0 +1,9 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2\" } */\n+\n+struct t { void (*func)(void*); };\n+void test_func(struct t* a) __attribute__((optimize(\"O0\")));\n+void test_func(struct t* a)\n+{\n+  a->func(0);\n+}"}]}