{"sha": "1bdbef090299990b1fdef6323bb3daa48acf9349", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWJkYmVmMDkwMjk5OTkwYjFmZGVmNjMyM2JiM2RhYTQ4YWNmOTM0OQ==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2018-03-21T07:09:22Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2018-03-21T07:09:22Z"}, "message": "PR c++/71638, ICE with NSDMI and reference.\n\n\t* constexpr.c (cxx_eval_bare_aggregate): Update constructor's flags\n\teven when we replace an element.\n\n\t* g++.dg/cpp0x/nsdmi14.C: New test.\n\t* g++.dg/cpp1y/nsdmi-aggr10.C: New test.\n\nFrom-SVN: r258703", "tree": {"sha": "704a2e97123b62562f6c6b058dd39f83366135eb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/704a2e97123b62562f6c6b058dd39f83366135eb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1bdbef090299990b1fdef6323bb3daa48acf9349", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1bdbef090299990b1fdef6323bb3daa48acf9349", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1bdbef090299990b1fdef6323bb3daa48acf9349", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1bdbef090299990b1fdef6323bb3daa48acf9349/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3b8acdf9441857ca1d78d54091ad55daa3c20416", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b8acdf9441857ca1d78d54091ad55daa3c20416", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3b8acdf9441857ca1d78d54091ad55daa3c20416"}], "stats": {"total": 55, "additions": 47, "deletions": 8}, "files": [{"sha": "f3ed02d1820f639e4da204bb98daf85e22ffb588", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1bdbef090299990b1fdef6323bb3daa48acf9349/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1bdbef090299990b1fdef6323bb3daa48acf9349/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=1bdbef090299990b1fdef6323bb3daa48acf9349", "patch": "@@ -1,3 +1,9 @@\n+2018-03-21  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/71638, ICE with NSDMI and reference.\n+\t* constexpr.c (cxx_eval_bare_aggregate): Update constructor's flags\n+\teven when we replace an element.\n+\n 2018-03-20  Marek Polacek  <polacek@redhat.com>\n \n \tPR c++/84978, ICE with NRVO."}, {"sha": "9e813bf0bcd385005942e81213ce4a4e95a36e71", "filename": "gcc/cp/constexpr.c", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1bdbef090299990b1fdef6323bb3daa48acf9349/gcc%2Fcp%2Fconstexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1bdbef090299990b1fdef6323bb3daa48acf9349/gcc%2Fcp%2Fconstexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fconstexpr.c?ref=1bdbef090299990b1fdef6323bb3daa48acf9349", "patch": "@@ -2873,16 +2873,17 @@ cxx_eval_bare_aggregate (const constexpr_ctx *ctx, tree t,\n \t  gcc_assert (is_empty_class (TREE_TYPE (TREE_TYPE (index))));\n \t  changed = true;\n \t}\n-      else if (new_ctx.ctor != ctx->ctor)\n-\t{\n-\t  /* We appended this element above; update the value.  */\n-\t  gcc_assert ((*p)->last().index == index);\n-\t  (*p)->last().value = elt;\n-\t}\n       else\n \t{\n-\t  CONSTRUCTOR_APPEND_ELT (*p, index, elt);\n-\t  /* Adding an element might change the ctor's flags.  */\n+\t  if (new_ctx.ctor != ctx->ctor)\n+\t    {\n+\t      /* We appended this element above; update the value.  */\n+\t      gcc_assert ((*p)->last().index == index);\n+\t      (*p)->last().value = elt;\n+\t    }\n+\t  else\n+\t    CONSTRUCTOR_APPEND_ELT (*p, index, elt);\n+\t  /* Adding or replacing an element might change the ctor's flags.  */\n \t  TREE_CONSTANT (ctx->ctor) = constant_p;\n \t  TREE_SIDE_EFFECTS (ctx->ctor) = side_effects_p;\n \t}"}, {"sha": "f3cc7574e9caad14f729b4cc99d32d85b23a67d2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1bdbef090299990b1fdef6323bb3daa48acf9349/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1bdbef090299990b1fdef6323bb3daa48acf9349/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1bdbef090299990b1fdef6323bb3daa48acf9349", "patch": "@@ -1,3 +1,9 @@\n+2018-03-21  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/71638, ICE with NSDMI and reference.\n+\t* g++.dg/cpp0x/nsdmi14.C: New test.\n+\t* g++.dg/cpp1y/nsdmi-aggr10.C: New test.\n+\n 2018-03-21  Chenghua Xu  <paul.hua.gm@gmail.com>\n \n \t* gcc.dg/vect/vect-strided-shift-1.c: Add dg-skip-if for"}, {"sha": "aac6fa1c81bb1621a4d01837abb2f55529237fca", "filename": "gcc/testsuite/g++.dg/cpp0x/nsdmi14.C", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1bdbef090299990b1fdef6323bb3daa48acf9349/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fnsdmi14.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1bdbef090299990b1fdef6323bb3daa48acf9349/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fnsdmi14.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fnsdmi14.C?ref=1bdbef090299990b1fdef6323bb3daa48acf9349", "patch": "@@ -0,0 +1,19 @@\n+// PR c++/71638\n+// { dg-do compile { target c++11 } }\n+// { dg-options \"-Wall\" }\n+\n+struct A {\n+  struct {\n+    int i;\n+    int &j = i;\n+  } b;\n+  int a = b.j;\n+};\n+\n+void bar (A);\n+\n+void\n+foo ()\n+{\n+  bar (A{});\n+}"}, {"sha": "1dc396d9ca59622730af036d26ddf928c60c622a", "filename": "gcc/testsuite/g++.dg/cpp1y/nsdmi-aggr10.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1bdbef090299990b1fdef6323bb3daa48acf9349/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fnsdmi-aggr10.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1bdbef090299990b1fdef6323bb3daa48acf9349/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fnsdmi-aggr10.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fnsdmi-aggr10.C?ref=1bdbef090299990b1fdef6323bb3daa48acf9349", "patch": "@@ -0,0 +1,7 @@\n+// PR c++/71638\n+// { dg-do compile { target c++14 } }\n+\n+struct {\n+  int &&a;\n+  int b{a};\n+} c[] { { 2 } };"}]}