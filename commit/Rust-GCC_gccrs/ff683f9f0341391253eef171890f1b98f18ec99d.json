{"sha": "ff683f9f0341391253eef171890f1b98f18ec99d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmY2ODNmOWYwMzQxMzkxMjUzZWVmMTcxODkwZjFiOThmMThlYzk5ZA==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@adacore.com", "date": "2020-12-03T15:06:47Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2021-04-28T09:38:04Z"}, "message": "[Ada] Crash with declare expression used in a postcondition\n\ngcc/ada/\n\n\t* sem_aux.adb (Is_Limited_Type): Fix logic to check Is_Type\n\tbefore assuming Ent is a typo.\n\t* sem_ch4.adb (Analyze_Expression_With_Actions): Update\n\tcomments, minor reformatting.\n\t* sem_res.adb (Resolve_Declare_Expression): Add protection\n\tagainst no type.", "tree": {"sha": "1574b25474bb0dbc8d01b42679ba42017f8ea95d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1574b25474bb0dbc8d01b42679ba42017f8ea95d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ff683f9f0341391253eef171890f1b98f18ec99d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff683f9f0341391253eef171890f1b98f18ec99d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff683f9f0341391253eef171890f1b98f18ec99d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff683f9f0341391253eef171890f1b98f18ec99d/comments", "author": {"login": "ArnaudCharlet", "id": 30291825, "node_id": "MDQ6VXNlcjMwMjkxODI1", "avatar_url": "https://avatars.githubusercontent.com/u/30291825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ArnaudCharlet", "html_url": "https://github.com/ArnaudCharlet", "followers_url": "https://api.github.com/users/ArnaudCharlet/followers", "following_url": "https://api.github.com/users/ArnaudCharlet/following{/other_user}", "gists_url": "https://api.github.com/users/ArnaudCharlet/gists{/gist_id}", "starred_url": "https://api.github.com/users/ArnaudCharlet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ArnaudCharlet/subscriptions", "organizations_url": "https://api.github.com/users/ArnaudCharlet/orgs", "repos_url": "https://api.github.com/users/ArnaudCharlet/repos", "events_url": "https://api.github.com/users/ArnaudCharlet/events{/privacy}", "received_events_url": "https://api.github.com/users/ArnaudCharlet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "df5f901ce89cdbf73ae827ee528da776cbcacfac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df5f901ce89cdbf73ae827ee528da776cbcacfac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/df5f901ce89cdbf73ae827ee528da776cbcacfac"}], "stats": {"total": 22, "additions": 15, "deletions": 7}, "files": [{"sha": "3eddad9d814ff93c6b233cb6df5bb5868c7523ca", "filename": "gcc/ada/sem_aux.adb", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff683f9f0341391253eef171890f1b98f18ec99d/gcc%2Fada%2Fsem_aux.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff683f9f0341391253eef171890f1b98f18ec99d/gcc%2Fada%2Fsem_aux.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_aux.adb?ref=ff683f9f0341391253eef171890f1b98f18ec99d", "patch": "@@ -1072,14 +1072,18 @@ package body Sem_Aux is\n    ---------------------\n \n    function Is_Limited_Type (Ent : Entity_Id) return Boolean is\n-      Btype : constant E := Base_Type (Ent);\n-      Rtype : constant E := Root_Type (Btype);\n+      Btype : Entity_Id;\n+      Rtype : Entity_Id;\n \n    begin\n       if not Is_Type (Ent) then\n          return False;\n+      end if;\n \n-      elsif Ekind (Btype) = E_Limited_Private_Type\n+      Btype := Base_Type (Ent);\n+      Rtype := Root_Type (Btype);\n+\n+      if Ekind (Btype) = E_Limited_Private_Type\n         or else Is_Limited_Composite (Btype)\n       then\n          return True;"}, {"sha": "ad6c7fddf9312b6a0eec77f430c7423f569fdec9", "filename": "gcc/ada/sem_ch4.adb", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff683f9f0341391253eef171890f1b98f18ec99d/gcc%2Fada%2Fsem_ch4.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff683f9f0341391253eef171890f1b98f18ec99d/gcc%2Fada%2Fsem_ch4.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch4.adb?ref=ff683f9f0341391253eef171890f1b98f18ec99d", "patch": "@@ -2278,9 +2278,12 @@ package body Sem_Ch4 is\n    procedure Analyze_Expression_With_Actions (N : Node_Id) is\n \n       procedure Check_Action_OK (A : Node_Id);\n-      --  Check that the action is something that is allows as a declare_item\n-      --  of a declare_expression, except the checks are suppressed for\n-      --  generated code.\n+      --  Check that the action A is allowed as a declare_item of a declare\n+      --  expression if N and A come from source.\n+\n+      ---------------------\n+      -- Check_Action_OK --\n+      ---------------------\n \n       procedure Check_Action_OK (A : Node_Id) is\n       begin\n@@ -2324,7 +2327,7 @@ package body Sem_Ch4 is\n          Error_Msg_N (\"object renaming or constant declaration expected\", A);\n       end Check_Action_OK;\n \n-      A : Node_Id;\n+      A        : Node_Id;\n       EWA_Scop : Entity_Id;\n \n    --  Start of processing for Analyze_Expression_With_Actions"}, {"sha": "39907aea2e77573fd94ffedf6428c4346afdb8af", "filename": "gcc/ada/sem_res.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff683f9f0341391253eef171890f1b98f18ec99d/gcc%2Fada%2Fsem_res.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff683f9f0341391253eef171890f1b98f18ec99d/gcc%2Fada%2Fsem_res.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_res.adb?ref=ff683f9f0341391253eef171890f1b98f18ec99d", "patch": "@@ -7494,6 +7494,7 @@ package body Sem_Res is\n             Node := First (Actions (N));\n             while Present (Node) loop\n                if Nkind (Node) = N_Object_Declaration\n+                 and then Is_Type (Etype (Defining_Identifier (Node)))\n                  and then Requires_Transient_Scope\n                             (Etype (Defining_Identifier (Node)))\n                then"}]}