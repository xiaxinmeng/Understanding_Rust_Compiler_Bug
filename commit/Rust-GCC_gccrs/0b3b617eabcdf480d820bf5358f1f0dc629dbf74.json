{"sha": "0b3b617eabcdf480d820bf5358f1f0dc629dbf74", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGIzYjYxN2VhYmNkZjQ4MGQ4MjBiZjUzNThmMWYwZGM2MjlkYmY3NA==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2011-02-22T20:33:45Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2011-02-22T20:33:45Z"}, "message": "re PR fortran/45743 (gfortran.dg/whole_file_3.f90 ICE: verify_stmts failed: invalid conversion in gimple call with -finline-small-functions)\n\n2011-02-22  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/45743\n\t* trans-decl.c (gfc_get_extern_function_decl): Don't use the\n\tgsymbol backend_decl if the procedure has a formal argument\n\tthat is a procedure.\n\n2011-02-22  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/45743\n\t* gfortran.dg/whole_file_32.f90 : New test.\n\nFrom-SVN: r170414", "tree": {"sha": "49ddaedb388488e0e8a9512185b898a6b96485c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/49ddaedb388488e0e8a9512185b898a6b96485c4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0b3b617eabcdf480d820bf5358f1f0dc629dbf74", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0b3b617eabcdf480d820bf5358f1f0dc629dbf74", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0b3b617eabcdf480d820bf5358f1f0dc629dbf74", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0b3b617eabcdf480d820bf5358f1f0dc629dbf74/comments", "author": null, "committer": null, "parents": [{"sha": "ca2409f9f23194cbb8b22c59796b48049975aae4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca2409f9f23194cbb8b22c59796b48049975aae4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ca2409f9f23194cbb8b22c59796b48049975aae4"}], "stats": {"total": 50, "additions": 50, "deletions": 0}, "files": [{"sha": "159b1be15c93ff817203793d9bf711713f75b469", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b3b617eabcdf480d820bf5358f1f0dc629dbf74/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b3b617eabcdf480d820bf5358f1f0dc629dbf74/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=0b3b617eabcdf480d820bf5358f1f0dc629dbf74", "patch": "@@ -1,3 +1,10 @@\n+2011-02-22  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/45743\n+\t* trans-decl.c (gfc_get_extern_function_decl): Don't use the\n+\tgsymbol backend_decl if the procedure has a formal argument\n+\tthat is a procedure.\n+\n 2011-02-22  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/41359"}, {"sha": "08207e098324b8fca08d640567c785123e929961", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b3b617eabcdf480d820bf5358f1f0dc629dbf74/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b3b617eabcdf480d820bf5358f1f0dc629dbf74/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=0b3b617eabcdf480d820bf5358f1f0dc629dbf74", "patch": "@@ -1495,6 +1495,7 @@ gfc_get_extern_function_decl (gfc_symbol * sym)\n   tree name;\n   tree mangled_name;\n   gfc_gsymbol *gsym;\n+  bool proc_formal_arg;\n \n   if (sym->backend_decl)\n     return sym->backend_decl;\n@@ -1511,10 +1512,27 @@ gfc_get_extern_function_decl (gfc_symbol * sym)\n      return the backend_decl.  */\n   gsym =  gfc_find_gsymbol (gfc_gsym_root, sym->name);\n \n+  /* Do not use procedures that have a procedure argument because this\n+     can result in problems of multiple decls during inlining.  */\n+  proc_formal_arg = false;\n+  if (gsym && gsym->ns && gsym->ns->proc_name)\n+    {\n+      gfc_formal_arglist *formal = gsym->ns->proc_name->formal;\n+      for (; formal; formal = formal->next)\n+\t{\n+\t  if (formal->sym && formal->sym->attr.flavor == FL_PROCEDURE)\n+\t    {\n+\t      proc_formal_arg = true;\n+\t      break;\n+\t    }\n+\t}\n+    }\n+\n   if (gfc_option.flag_whole_file\n \t&& (!sym->attr.use_assoc || sym->attr.if_source != IFSRC_DECL)\n \t&& !sym->backend_decl\n \t&& gsym && gsym->ns\n+\t&& !proc_formal_arg\n \t&& ((gsym->type == GSYM_SUBROUTINE) || (gsym->type == GSYM_FUNCTION))\n \t&& (gsym->ns->proc_name->backend_decl || !sym->attr.intrinsic))\n     {"}, {"sha": "14df266e1c1ba52daa3db9799ff0d6f1f7d01845", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b3b617eabcdf480d820bf5358f1f0dc629dbf74/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b3b617eabcdf480d820bf5358f1f0dc629dbf74/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0b3b617eabcdf480d820bf5358f1f0dc629dbf74", "patch": "@@ -1,3 +1,8 @@\n+2011-02-22  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/45743\n+\t* gfortran.dg/whole_file_32.f90 : New test.\n+\n 2011-02-22  Dodji Seketeli  <dodji@redhat.com>\n \n \tPR c++/47666"}, {"sha": "6626fbd5a541ede5aaa1e1f15c3f04055f1421be", "filename": "gcc/testsuite/gfortran.dg/whole_file_32.f90", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b3b617eabcdf480d820bf5358f1f0dc629dbf74/gcc%2Ftestsuite%2Fgfortran.dg%2Fwhole_file_32.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b3b617eabcdf480d820bf5358f1f0dc629dbf74/gcc%2Ftestsuite%2Fgfortran.dg%2Fwhole_file_32.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fwhole_file_32.f90?ref=0b3b617eabcdf480d820bf5358f1f0dc629dbf74", "patch": "@@ -0,0 +1,20 @@\n+! { dg-do compile }\n+! { dg-options \"-O -finline-small-functions\" }\n+! Tests the fix for PR45743 in which the compilation failed with an ICE\n+! internal compiler error: verify_stmts failed.  The source is the essential\n+! part of whole_file_3.f90.\n+!\n+! Contributed by Zdenek Sojka  <zsojka@seznam.cz>\n+!\n+      SUBROUTINE PHLOAD (READER,*)\n+      IMPLICIT NONE\n+      EXTERNAL         READER\n+      CALL READER (*1)\n+ 1    RETURN 1\n+      END SUBROUTINE\n+\n+      program test\n+      EXTERNAL R\n+      CALL PHLOAD (R, *999) ! This one is OK\n+ 999  continue\n+      END program test"}]}