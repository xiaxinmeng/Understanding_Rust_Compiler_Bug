{"sha": "84a3423b97784ba86bcb37efb39fd528de3671cb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODRhMzQyM2I5Nzc4NGJhODZiY2IzN2VmYjM5ZmQ1MjhkZTM2NzFjYg==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2015-05-23T22:28:54Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2015-05-23T22:28:54Z"}, "message": "re PR c++/65936 (ICE: canonical types differ for identical types)\n\n\tcp/\n\tPR c++/65936\n\t* pt.c (lookup_template_class_1): Copy may_alias attribute too.\n\n\ttestsuite/\n\tPR c++/65936\n\t* g++.dg/template/pr65936.C: New.\n\nFrom-SVN: r223613", "tree": {"sha": "ff8367af9f5301322417ebd0e66ee3cc6bfa2287", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ff8367af9f5301322417ebd0e66ee3cc6bfa2287"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/84a3423b97784ba86bcb37efb39fd528de3671cb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84a3423b97784ba86bcb37efb39fd528de3671cb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/84a3423b97784ba86bcb37efb39fd528de3671cb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84a3423b97784ba86bcb37efb39fd528de3671cb/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "94cbafd1737a6e0a395e5dabca880ba1b0be10d2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94cbafd1737a6e0a395e5dabca880ba1b0be10d2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/94cbafd1737a6e0a395e5dabca880ba1b0be10d2"}], "stats": {"total": 48, "additions": 43, "deletions": 5}, "files": [{"sha": "35d5f34e63f7c63232b650bdd7e4711c056846a1", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84a3423b97784ba86bcb37efb39fd528de3671cb/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84a3423b97784ba86bcb37efb39fd528de3671cb/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=84a3423b97784ba86bcb37efb39fd528de3671cb", "patch": "@@ -1,3 +1,8 @@\n+2015-05-23  Nathan Sidwell  <nathan@acm.org>\n+\n+\tPR c++/65936\n+\t* pt.c (lookup_template_class_1): Copy may_alias attribute too.\n+\n 2015-05-22  Jim Wilson  <jim.wilson@linaro.org>\n \n \t* Make-lang.in (check_g++_parallelize): Update comment."}, {"sha": "a0c5d7cd586b39204e3637fec1ca605da2685f91", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 12, "deletions": 5, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84a3423b97784ba86bcb37efb39fd528de3671cb/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84a3423b97784ba86bcb37efb39fd528de3671cb/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=84a3423b97784ba86bcb37efb39fd528de3671cb", "patch": "@@ -7905,15 +7905,22 @@ lookup_template_class_1 (tree d1, tree arglist, tree in_decl, tree context,\n       if (OVERLOAD_TYPE_P (t)\n \t  && !DECL_ALIAS_TEMPLATE_P (gen_tmpl))\n \t{\n-\t  if (tree attributes\n-\t      = lookup_attribute (\"abi_tag\", TYPE_ATTRIBUTES (template_type)))\n+\t  static const char *tags[] = {\"abi_tag\", \"may_alias\"};\n+\n+\t  for (unsigned ix = 0; ix != 2; ix++)\n \t    {\n-\t      if (!TREE_CHAIN (attributes))\n+\t      tree attributes\n+\t\t= lookup_attribute (tags[ix], TYPE_ATTRIBUTES (template_type));\n+\n+\t      if (!attributes)\n+\t\t;\n+\t      else if (!TREE_CHAIN (attributes) && !TYPE_ATTRIBUTES (t))\n \t\tTYPE_ATTRIBUTES (t) = attributes;\n \t      else\n \t\tTYPE_ATTRIBUTES (t)\n-\t\t  = build_tree_list (TREE_PURPOSE (attributes),\n-\t\t\t\t     TREE_VALUE (attributes));\n+\t\t  = tree_cons (TREE_PURPOSE (attributes),\n+\t\t\t       TREE_VALUE (attributes),\n+\t\t\t       TYPE_ATTRIBUTES (t));\n \t    }\n \t}\n "}, {"sha": "e302f01257a2040b31519910e5a452097492e6af", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84a3423b97784ba86bcb37efb39fd528de3671cb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84a3423b97784ba86bcb37efb39fd528de3671cb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=84a3423b97784ba86bcb37efb39fd528de3671cb", "patch": "@@ -1,3 +1,8 @@\n+2015-05-23  Nathan Sidwell  <nathan@acm.org>\n+\n+\tPR c++/65936\n+\t* g++.dg/template/pr65936.C: New.\n+\n 2015-05-22  Marc Glisse  <marc.glisse@inria.fr>\n \n \tPR tree-optimization/63387"}, {"sha": "afa227686d1d26468cce4c05ff6f3ec96816a8d6", "filename": "gcc/testsuite/g++.dg/template/pr65936.C", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84a3423b97784ba86bcb37efb39fd528de3671cb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fpr65936.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84a3423b97784ba86bcb37efb39fd528de3671cb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fpr65936.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fpr65936.C?ref=84a3423b97784ba86bcb37efb39fd528de3671cb", "patch": "@@ -0,0 +1,21 @@\n+// checking ICE in canonical typing\n+\n+class A;\n+\n+template <typename> struct B\n+{\n+  typedef A type;\n+};\n+\n+template <class T> class C\n+  : public B<T>::type\n+{\n+} __attribute__ ((__may_alias__));\n+\n+class A\n+{\n+  operator const C<int> &()\n+  {\n+    return *static_cast<const C<int> *> (this);\n+  }\n+};"}]}