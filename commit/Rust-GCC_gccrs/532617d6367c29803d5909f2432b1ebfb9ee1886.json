{"sha": "532617d6367c29803d5909f2432b1ebfb9ee1886", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTMyNjE3ZDYzNjdjMjk4MDNkNTkwOWYyNDMyYjFlYmZiOWVlMTg4Ng==", "commit": {"author": {"name": "Indu Bhagat", "email": "indu.bhagat@oracle.com", "date": "2021-05-20T17:32:38Z"}, "committer": {"name": "Jose E. Marchesi", "email": "jose.marchesi@oracle.com", "date": "2021-06-28T16:47:20Z"}, "message": "dejagnu: modularize gcc-dg-debug-runtest a bit\n\nMove some functionality into a procedure of its own. This is only so that when\nthe patch for ctf comes along, the gcc-dg-debug-runtest procedure looks bit\nmore uniform.\n\ngcc/testsuite/ChangeLog:\n\n\t* lib/gcc-dg.exp (gcc-dg-target-supports-debug-format): New procedure.", "tree": {"sha": "cb474de4e1b4b8f3732b63201fe3913c2b0f99da", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cb474de4e1b4b8f3732b63201fe3913c2b0f99da"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/532617d6367c29803d5909f2432b1ebfb9ee1886", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/532617d6367c29803d5909f2432b1ebfb9ee1886", "html_url": "https://github.com/Rust-GCC/gccrs/commit/532617d6367c29803d5909f2432b1ebfb9ee1886", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/532617d6367c29803d5909f2432b1ebfb9ee1886/comments", "author": {"login": "ibhagatgnu", "id": 51812649, "node_id": "MDQ6VXNlcjUxODEyNjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/51812649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibhagatgnu", "html_url": "https://github.com/ibhagatgnu", "followers_url": "https://api.github.com/users/ibhagatgnu/followers", "following_url": "https://api.github.com/users/ibhagatgnu/following{/other_user}", "gists_url": "https://api.github.com/users/ibhagatgnu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibhagatgnu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibhagatgnu/subscriptions", "organizations_url": "https://api.github.com/users/ibhagatgnu/orgs", "repos_url": "https://api.github.com/users/ibhagatgnu/repos", "events_url": "https://api.github.com/users/ibhagatgnu/events{/privacy}", "received_events_url": "https://api.github.com/users/ibhagatgnu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jemarch", "id": 7061875, "node_id": "MDQ6VXNlcjcwNjE4NzU=", "avatar_url": "https://avatars.githubusercontent.com/u/7061875?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jemarch", "html_url": "https://github.com/jemarch", "followers_url": "https://api.github.com/users/jemarch/followers", "following_url": "https://api.github.com/users/jemarch/following{/other_user}", "gists_url": "https://api.github.com/users/jemarch/gists{/gist_id}", "starred_url": "https://api.github.com/users/jemarch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jemarch/subscriptions", "organizations_url": "https://api.github.com/users/jemarch/orgs", "repos_url": "https://api.github.com/users/jemarch/repos", "events_url": "https://api.github.com/users/jemarch/events{/privacy}", "received_events_url": "https://api.github.com/users/jemarch/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5783a0cc78af95940dcb3d1a5d29041c3d8ae3e1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5783a0cc78af95940dcb3d1a5d29041c3d8ae3e1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5783a0cc78af95940dcb3d1a5d29041c3d8ae3e1"}], "stats": {"total": 23, "additions": 16, "deletions": 7}, "files": [{"sha": "c7722ba07daa271a06a7f3150dd7a5a5e290843f", "filename": "gcc/testsuite/lib/gcc-dg.exp", "status": "modified", "additions": 16, "deletions": 7, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/532617d6367c29803d5909f2432b1ebfb9ee1886/gcc%2Ftestsuite%2Flib%2Fgcc-dg.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/532617d6367c29803d5909f2432b1ebfb9ee1886/gcc%2Ftestsuite%2Flib%2Fgcc-dg.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fgcc-dg.exp?ref=532617d6367c29803d5909f2432b1ebfb9ee1886", "patch": "@@ -621,18 +621,27 @@ proc gcc-dg-runtest { testcases flags default-extra-flags } {\n     }\n }\n \n-proc gcc-dg-debug-runtest { target_compile trivial opt_opts testcases } {\n+# Check if the target system supports the debug format\n+proc gcc-dg-target-supports-debug-format { target_compile trivial type } {\n     global srcdir subdir\n \n+    set comp_output [$target_compile \\\n+\t    \"$srcdir/$subdir/$trivial\" \"trivial.S\" assembly \\\n+\t    \"additional_flags=$type\"]\n+    if { ! [string match \"*: target system does not support the * debug format*\" \\\n+\t    $comp_output] } {\n+\tremove-build-file \"trivial.S\"\n+\treturn 1\n+    }\n+    return 0\n+}\n+\n+proc gcc-dg-debug-runtest { target_compile trivial opt_opts testcases } {\n     if ![info exists DEBUG_TORTURE_OPTIONS] {\n \tset DEBUG_TORTURE_OPTIONS \"\"\n \tforeach type {-gdwarf-2 -gstabs -gstabs+ -gxcoff -gxcoff+} {\n-\t    set comp_output [$target_compile \\\n-\t\t    \"$srcdir/$subdir/$trivial\" \"trivial.S\" assembly \\\n-\t\t    \"additional_flags=$type\"]\n-\t    if { ! [string match \"*: target system does not support the * debug format*\" \\\n-\t\t    $comp_output] } {\n-\t\tremove-build-file \"trivial.S\"\n+\t    if [expr [gcc-dg-target-supports-debug-format \\\n+\t\t      $target_compile $trivial $type]] {\n \t\tforeach level {1 \"\" 3} {\n \t\t    if { ($type == \"-gdwarf-2\") && ($level != \"\") } {\n \t\t\tlappend DEBUG_TORTURE_OPTIONS [list \"${type}\" \"-g${level}\"]"}]}