{"sha": "29b7e00589f1c1c00029928ac1b7ba8ff53288f5", "node_id": "C_kwDOANBUbNoAKDI5YjdlMDA1ODlmMWMxYzAwMDI5OTI4YWMxYjdiYThmZjUzMjg4ZjU", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2022-11-07T14:17:40Z"}, "committer": {"name": "Marc Poulhi\u00e8s", "email": "poulhies@adacore.com", "date": "2022-11-22T12:34:51Z"}, "message": "ada: Adjust number of errors when removing warning in dead code\n\nWhen a warning about a runtime exception is emitted for a code in\ngeneric instance, we add continuation warnings \"in instantiation ...\"\nand only the original message increase the total number of errors.\n\nWhen removing these messages, e.g. after detecting that the code inside\ngeneric instance is dead, we must decrease the total number of errors,\nas otherwise the compiler exit status might stop gnatmake or gprbuild.\n\ngcc/ada/\n\n\t* errout.adb (To_Be_Removed): Decrease total number of errors when\n\tremoving a warning that has been escalated into error.\n\t* erroutc.adb (dmsg): Print Warn_Runtime_Raise flag.", "tree": {"sha": "4cd3d32c2f0036a9665908336675f3ca0c4cad47", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4cd3d32c2f0036a9665908336675f3ca0c4cad47"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/29b7e00589f1c1c00029928ac1b7ba8ff53288f5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29b7e00589f1c1c00029928ac1b7ba8ff53288f5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/29b7e00589f1c1c00029928ac1b7ba8ff53288f5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29b7e00589f1c1c00029928ac1b7ba8ff53288f5/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dkm", "id": 87603, "node_id": "MDQ6VXNlcjg3NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/87603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkm", "html_url": "https://github.com/dkm", "followers_url": "https://api.github.com/users/dkm/followers", "following_url": "https://api.github.com/users/dkm/following{/other_user}", "gists_url": "https://api.github.com/users/dkm/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkm/subscriptions", "organizations_url": "https://api.github.com/users/dkm/orgs", "repos_url": "https://api.github.com/users/dkm/repos", "events_url": "https://api.github.com/users/dkm/events{/privacy}", "received_events_url": "https://api.github.com/users/dkm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3b5f3138dceeac609b4c5fe33009302d13592400", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b5f3138dceeac609b4c5fe33009302d13592400", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3b5f3138dceeac609b4c5fe33009302d13592400"}], "stats": {"total": 46, "additions": 29, "deletions": 17}, "files": [{"sha": "b30e8b51d159d89b900a90030d450376083834d7", "filename": "gcc/ada/errout.adb", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29b7e00589f1c1c00029928ac1b7ba8ff53288f5/gcc%2Fada%2Ferrout.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29b7e00589f1c1c00029928ac1b7ba8ff53288f5/gcc%2Fada%2Ferrout.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ferrout.adb?ref=29b7e00589f1c1c00029928ac1b7ba8ff53288f5", "patch": "@@ -3351,6 +3351,17 @@ package body Errout is\n                   Warning_Info_Messages := Warning_Info_Messages - 1;\n                end if;\n \n+               --  When warning about a runtime exception has been escalated\n+               --  into error, the starting message has increased the total\n+               --  errors counter, so here we decrease this counter.\n+\n+               if Errors.Table (E).Warn_Runtime_Raise\n+                 and then not Errors.Table (E).Msg_Cont\n+                 and then Warning_Mode = Treat_Run_Time_Warnings_As_Errors\n+               then\n+                  Total_Errors_Detected := Total_Errors_Detected - 1;\n+               end if;\n+\n                return True;\n \n             --  No removal required"}, {"sha": "d40c668be8abe9aa195af3f0c8b694667d9f6bf0", "filename": "gcc/ada/erroutc.adb", "status": "modified", "additions": 18, "deletions": 17, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29b7e00589f1c1c00029928ac1b7ba8ff53288f5/gcc%2Fada%2Ferroutc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29b7e00589f1c1c00029928ac1b7ba8ff53288f5/gcc%2Fada%2Ferroutc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ferroutc.adb?ref=29b7e00589f1c1c00029928ac1b7ba8ff53288f5", "patch": "@@ -312,32 +312,33 @@ package body Erroutc is\n \n    begin\n       w (\"Dumping error message, Id = \", Int (Id));\n-      w (\"  Text     = \", E.Text.all);\n-      w (\"  Next     = \", Int (E.Next));\n-      w (\"  Prev     = \", Int (E.Prev));\n-      w (\"  Sfile    = \", Int (E.Sfile));\n+      w (\"  Text               = \", E.Text.all);\n+      w (\"  Next               = \", Int (E.Next));\n+      w (\"  Prev               = \", Int (E.Prev));\n+      w (\"  Sfile              = \", Int (E.Sfile));\n \n       Write_Str\n-        (\"  Sptr     = \");\n+        (\"  Sptr               = \");\n       Write_Location (E.Sptr.Ptr);  --  ??? Do not write the full span for now\n       Write_Eol;\n \n       Write_Str\n-        (\"  Optr     = \");\n+        (\"  Optr               = \");\n       Write_Location (E.Optr.Ptr);\n       Write_Eol;\n \n-      w (\"  Line     = \", Int (E.Line));\n-      w (\"  Col      = \", Int (E.Col));\n-      w (\"  Warn     = \", E.Warn);\n-      w (\"  Warn_Err = \", E.Warn_Err);\n-      w (\"  Warn_Chr = '\" & E.Warn_Chr & ''');\n-      w (\"  Style    = \", E.Style);\n-      w (\"  Serious  = \", E.Serious);\n-      w (\"  Uncond   = \", E.Uncond);\n-      w (\"  Msg_Cont = \", E.Msg_Cont);\n-      w (\"  Deleted  = \", E.Deleted);\n-      w (\"  Node     = \", Int (E.Node));\n+      w (\"  Line               = \", Int (E.Line));\n+      w (\"  Col                = \", Int (E.Col));\n+      w (\"  Warn               = \", E.Warn);\n+      w (\"  Warn_Err           = \", E.Warn_Err);\n+      w (\"  Warn_Runtime_Raise = \", E.Warn_Runtime_Raise);\n+      w (\"  Warn_Chr           = '\" & E.Warn_Chr & ''');\n+      w (\"  Style              = \", E.Style);\n+      w (\"  Serious            = \", E.Serious);\n+      w (\"  Uncond             = \", E.Uncond);\n+      w (\"  Msg_Cont           = \", E.Msg_Cont);\n+      w (\"  Deleted            = \", E.Deleted);\n+      w (\"  Node               = \", Int (E.Node));\n \n       Write_Eol;\n    end dmsg;"}]}