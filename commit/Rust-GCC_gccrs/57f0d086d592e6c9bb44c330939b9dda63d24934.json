{"sha": "57f0d086d592e6c9bb44c330939b9dda63d24934", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTdmMGQwODZkNTkyZTZjOWJiNDRjMzMwOTM5YjlkZGE2M2QyNDkzNA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2005-09-27T21:46:14Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2005-09-27T21:46:14Z"}, "message": "re PR fortran/18518 (equivalenced variables are not saved)\n\n\tPR fortran/18518\n\t* trans-common.c (build_equiv_decl): Add IS_SAVED argument.\n\tIf it is true, set TREE_STATIC on the decl.\n\t(create_common): If any symbol in equivalence has SAVE attribute,\n\tpass true as last argument to build_equiv_decl.\n\n\t* gfortran.fortran-torture/execute/save_2.f90: New decl.\n\nFrom-SVN: r104712", "tree": {"sha": "c3973b2ad4259e5ebeaafcea074d679fc6155edd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c3973b2ad4259e5ebeaafcea074d679fc6155edd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/57f0d086d592e6c9bb44c330939b9dda63d24934", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57f0d086d592e6c9bb44c330939b9dda63d24934", "html_url": "https://github.com/Rust-GCC/gccrs/commit/57f0d086d592e6c9bb44c330939b9dda63d24934", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57f0d086d592e6c9bb44c330939b9dda63d24934/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "93954fcc895e40418cecc5c0c1d35ef579ea204d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/93954fcc895e40418cecc5c0c1d35ef579ea204d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/93954fcc895e40418cecc5c0c1d35ef579ea204d"}], "stats": {"total": 48, "additions": 45, "deletions": 3}, "files": [{"sha": "4334c3c6ae2b78c137a18710a1bd4d773d414e36", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57f0d086d592e6c9bb44c330939b9dda63d24934/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57f0d086d592e6c9bb44c330939b9dda63d24934/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=57f0d086d592e6c9bb44c330939b9dda63d24934", "patch": "@@ -1,3 +1,11 @@\n+2005-09-27  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/18518\n+\t* trans-common.c (build_equiv_decl): Add IS_SAVED argument.\n+\tIf it is true, set TREE_STATIC on the decl.\n+\t(create_common): If any symbol in equivalence has SAVE attribute,\n+\tpass true as last argument to build_equiv_decl.\n+\n 2005-09-24  Janne Blomqvist  <jblomqvi@cc.hut.fi>\n \n \t* trans-io.c (gfc_build_io_library_fndecls): Add entry"}, {"sha": "de47f90630590132f7b9d2d5fcfd77738afabc91", "filename": "gcc/fortran/trans-common.c", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57f0d086d592e6c9bb44c330939b9dda63d24934/gcc%2Ffortran%2Ftrans-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57f0d086d592e6c9bb44c330939b9dda63d24934/gcc%2Ffortran%2Ftrans-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-common.c?ref=57f0d086d592e6c9bb44c330939b9dda63d24934", "patch": "@@ -268,7 +268,7 @@ build_field (segment_info *h, tree union_type, record_layout_info rli)\n /* Get storage for local equivalence.  */\n \n static tree\n-build_equiv_decl (tree union_type, bool is_init)\n+build_equiv_decl (tree union_type, bool is_init, bool is_saved)\n {\n   tree decl;\n   char name[15];\n@@ -286,7 +286,8 @@ build_equiv_decl (tree union_type, bool is_init)\n   DECL_ARTIFICIAL (decl) = 1;\n   DECL_IGNORED_P (decl) = 1;\n \n-  if (!gfc_can_put_var_on_stack (DECL_SIZE_UNIT (decl)))\n+  if (!gfc_can_put_var_on_stack (DECL_SIZE_UNIT (decl))\n+      || is_saved)\n     TREE_STATIC (decl) = 1;\n \n   TREE_ADDRESSABLE (decl) = 1;\n@@ -385,6 +386,7 @@ create_common (gfc_common_head *com, segment_info * head, bool saw_equiv)\n   record_layout_info rli;\n   tree decl;\n   bool is_init = false;\n+  bool is_saved = false;\n \n   /* Declare the variables inside the common block.\n      If the current common block contains any equivalence object, then\n@@ -410,13 +412,17 @@ create_common (gfc_common_head *com, segment_info * head, bool saw_equiv)\n       /* Has initial value.  */\n       if (s->sym->value)\n         is_init = true;\n+\n+      /* Has SAVE attribute.  */\n+      if (s->sym->attr.save)\n+        is_saved = true;\n     }\n   finish_record_layout (rli, true);\n \n   if (com)\n     decl = build_common_decl (com, union_type, is_init);\n   else\n-    decl = build_equiv_decl (union_type, is_init);\n+    decl = build_equiv_decl (union_type, is_init, is_saved);\n \n   if (is_init)\n     {"}, {"sha": "e6375b5576bdd6c02a3b20743a6286deca13a321", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57f0d086d592e6c9bb44c330939b9dda63d24934/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57f0d086d592e6c9bb44c330939b9dda63d24934/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=57f0d086d592e6c9bb44c330939b9dda63d24934", "patch": "@@ -1,3 +1,8 @@\n+2005-09-27  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/18518\n+\t* gfortran.fortran-torture/execute/save_2.f90: New decl.\n+\n 2005-09-27  Devang Patel  <dpatel@apple.com>\n \n \tPR tree-optimization/23625"}, {"sha": "c3775bbecc3ebeb552f8576626a3c04fd76cda44", "filename": "gcc/testsuite/gfortran.fortran-torture/execute/save_2.f90", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57f0d086d592e6c9bb44c330939b9dda63d24934/gcc%2Ftestsuite%2Fgfortran.fortran-torture%2Fexecute%2Fsave_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57f0d086d592e6c9bb44c330939b9dda63d24934/gcc%2Ftestsuite%2Fgfortran.fortran-torture%2Fexecute%2Fsave_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.fortran-torture%2Fexecute%2Fsave_2.f90?ref=57f0d086d592e6c9bb44c330939b9dda63d24934", "patch": "@@ -0,0 +1,23 @@\n+! PR fortran/18518\n+      program main\n+\tcall foo\n+\tcall bar\n+\tcall foo\n+      end program main\n+\n+      subroutine foo\n+\tinteger i,g,h\n+\tdata i/0/\n+\tequivalence (g,h)\n+\tsave g\n+\tif (i == 0) then\n+\t   i = 1\n+\t   h = 12345\n+\tend if\n+\tif (h .ne. 12345) call abort\n+      end subroutine foo\n+\n+      subroutine bar\n+\tinteger a(10)\n+\ta = 34\n+      end subroutine bar"}]}