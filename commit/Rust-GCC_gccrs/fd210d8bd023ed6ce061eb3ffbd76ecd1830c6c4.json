{"sha": "fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4", "node_id": "C_kwDOANBUbNoAKGZkMjEwZDhiZDAyM2VkNmNlMDYxZWIzZmZiZDc2ZWNkMTgzMGM2YzQ", "commit": {"author": {"name": "Haochen Jiang", "email": "haochen.jiang@intel.com", "date": "2022-11-11T02:17:18Z"}, "committer": {"name": "Haochen Jiang", "email": "haochen.jiang@intel.com", "date": "2022-11-14T08:30:36Z"}, "message": "i386: Add AMX-TILE dependency for AMX related ISAs\n\ngcc/ChangeLog:\n\n\t* common/config/i386/i386-common.cc\n\t(OPTION_MASK_ISA2_AMX_INT8_SET): Add AMX-TILE dependency.\n\t(OPTION_MASK_ISA2_AMX_BF16_SET): Ditto.\n\t(OPTION_MASK_ISA2_AMX_FP16_SET): Ditto.\n\t(OPTION_MASK_ISA2_AMX_TILE_UNSET): Disable AMX_{INT8,\n\tBF16, FP16} when disable AMX_TILE.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/i386/amxbf16-dpbf16ps-2.c: Remove -amx-tile.\n\t* gcc.target/i386/amxfp16-dpfp16ps-2.c: Ditto.\n\t* gcc.target/i386/amxint8-dpbssd-2.c: Ditto.\n\t* gcc.target/i386/amxint8-dpbsud-2.c: Ditto.\n\t* gcc.target/i386/amxint8-dpbusd-2.c: Ditto.\n\t* gcc.target/i386/amxint8-dpbuud-2.c: Ditto.", "tree": {"sha": "2cf9c0b5ef9eaea9ff93b2e89b72966c06805ae8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2cf9c0b5ef9eaea9ff93b2e89b72966c06805ae8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4/comments", "author": {"login": "jianghc724", "id": 10798680, "node_id": "MDQ6VXNlcjEwNzk4Njgw", "avatar_url": "https://avatars.githubusercontent.com/u/10798680?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jianghc724", "html_url": "https://github.com/jianghc724", "followers_url": "https://api.github.com/users/jianghc724/followers", "following_url": "https://api.github.com/users/jianghc724/following{/other_user}", "gists_url": "https://api.github.com/users/jianghc724/gists{/gist_id}", "starred_url": "https://api.github.com/users/jianghc724/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jianghc724/subscriptions", "organizations_url": "https://api.github.com/users/jianghc724/orgs", "repos_url": "https://api.github.com/users/jianghc724/repos", "events_url": "https://api.github.com/users/jianghc724/events{/privacy}", "received_events_url": "https://api.github.com/users/jianghc724/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jianghc724", "id": 10798680, "node_id": "MDQ6VXNlcjEwNzk4Njgw", "avatar_url": "https://avatars.githubusercontent.com/u/10798680?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jianghc724", "html_url": "https://github.com/jianghc724", "followers_url": "https://api.github.com/users/jianghc724/followers", "following_url": "https://api.github.com/users/jianghc724/following{/other_user}", "gists_url": "https://api.github.com/users/jianghc724/gists{/gist_id}", "starred_url": "https://api.github.com/users/jianghc724/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jianghc724/subscriptions", "organizations_url": "https://api.github.com/users/jianghc724/orgs", "repos_url": "https://api.github.com/users/jianghc724/repos", "events_url": "https://api.github.com/users/jianghc724/events{/privacy}", "received_events_url": "https://api.github.com/users/jianghc724/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "afabc30b78ccf088b5c0c6f17bb17524b4644ce6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/afabc30b78ccf088b5c0c6f17bb17524b4644ce6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/afabc30b78ccf088b5c0c6f17bb17524b4644ce6"}], "stats": {"total": 31, "additions": 15, "deletions": 16}, "files": [{"sha": "6ce2a588adc4ff6a7b4761174a2717701aa9aa6c", "filename": "gcc/common/config/i386/i386-common.cc", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4/gcc%2Fcommon%2Fconfig%2Fi386%2Fi386-common.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4/gcc%2Fcommon%2Fconfig%2Fi386%2Fi386-common.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcommon%2Fconfig%2Fi386%2Fi386-common.cc?ref=fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4", "patch": "@@ -106,12 +106,15 @@ along with GCC; see the file COPYING3.  If not see\n #define OPTION_MASK_ISA_CLWB_SET OPTION_MASK_ISA_CLWB\n #define OPTION_MASK_ISA2_AVX512VP2INTERSECT_SET OPTION_MASK_ISA2_AVX512VP2INTERSECT\n #define OPTION_MASK_ISA2_AMX_TILE_SET OPTION_MASK_ISA2_AMX_TILE\n-#define OPTION_MASK_ISA2_AMX_INT8_SET OPTION_MASK_ISA2_AMX_INT8\n-#define OPTION_MASK_ISA2_AMX_BF16_SET OPTION_MASK_ISA2_AMX_BF16\n+#define OPTION_MASK_ISA2_AMX_INT8_SET \\\n+  (OPTION_MASK_ISA2_AMX_TILE | OPTION_MASK_ISA2_AMX_INT8)\n+#define OPTION_MASK_ISA2_AMX_BF16_SET \\\n+  (OPTION_MASK_ISA2_AMX_TILE | OPTION_MASK_ISA2_AMX_BF16)\n #define OPTION_MASK_ISA2_AVXVNNIINT8_SET OPTION_MASK_ISA2_AVXVNNIINT8\n #define OPTION_MASK_ISA2_AVXNECONVERT_SET OPTION_MASK_ISA2_AVXNECONVERT\n #define OPTION_MASK_ISA2_CMPCCXADD_SET OPTION_MASK_ISA2_CMPCCXADD\n-#define OPTION_MASK_ISA2_AMX_FP16_SET OPTION_MASK_ISA2_AMX_FP16\n+#define OPTION_MASK_ISA2_AMX_FP16_SET \\\n+  (OPTION_MASK_ISA2_AMX_TILE | OPTION_MASK_ISA2_AMX_FP16)\n #define OPTION_MASK_ISA2_PREFETCHI_SET OPTION_MASK_ISA2_PREFETCHI\n #define OPTION_MASK_ISA2_RAOINT_SET OPTION_MASK_ISA2_RAOINT\n \n@@ -277,7 +280,9 @@ along with GCC; see the file COPYING3.  If not see\n #define OPTION_MASK_ISA2_SERIALIZE_UNSET OPTION_MASK_ISA2_SERIALIZE\n #define OPTION_MASK_ISA2_AVX512VP2INTERSECT_UNSET OPTION_MASK_ISA2_AVX512VP2INTERSECT\n #define OPTION_MASK_ISA2_TSXLDTRK_UNSET OPTION_MASK_ISA2_TSXLDTRK\n-#define OPTION_MASK_ISA2_AMX_TILE_UNSET OPTION_MASK_ISA2_AMX_TILE\n+#define OPTION_MASK_ISA2_AMX_TILE_UNSET \\\n+  (OPTION_MASK_ISA2_AMX_TILE | OPTION_MASK_ISA2_AMX_INT8_UNSET \\\n+   | OPTION_MASK_ISA2_AMX_BF16_UNSET | OPTION_MASK_ISA2_AMX_FP16_UNSET)\n #define OPTION_MASK_ISA2_AMX_INT8_UNSET OPTION_MASK_ISA2_AMX_INT8\n #define OPTION_MASK_ISA2_AMX_BF16_UNSET OPTION_MASK_ISA2_AMX_BF16\n #define OPTION_MASK_ISA2_UINTR_UNSET OPTION_MASK_ISA2_UINTR"}, {"sha": "35881e7682ad2eb956dd0a5a9f4971d90b2e19f1", "filename": "gcc/testsuite/gcc.target/i386/amxbf16-dpbf16ps-2.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxbf16-dpbf16ps-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxbf16-dpbf16ps-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxbf16-dpbf16ps-2.c?ref=fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4", "patch": "@@ -1,7 +1,6 @@\n /* { dg-do run { target { ! ia32 } } } */\n-/* { dg-require-effective-target amx_tile } */\n /* { dg-require-effective-target amx_bf16 } */\n-/* { dg-options \"-O2 -mamx-tile -mamx-bf16\" } */\n+/* { dg-options \"-O2 -mamx-bf16\" } */\n #include <immintrin.h>\n \n #define AMX_BF16"}, {"sha": "a1fafbcbfeb24d24537e5668415513237609d9da", "filename": "gcc/testsuite/gcc.target/i386/amxfp16-dpfp16ps-2.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxfp16-dpfp16ps-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxfp16-dpfp16ps-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxfp16-dpfp16ps-2.c?ref=fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4", "patch": "@@ -1,8 +1,7 @@\n /* { dg-do run { target { ! ia32 } } } */\n-/* { dg-require-effective-target amx_tile } */\n /* { dg-require-effective-target amx_fp16 } */\n /* { dg-require-effective-target avx512fp16 } */\n-/* { dg-options \"-O2 -mamx-tile -mamx-fp16 -mavx512fp16\" } */\n+/* { dg-options \"-O2 -mamx-fp16 -mavx512fp16\" } */\n #define AMX_FP16\n #define DO_TEST test_amx_fp16_dpfp16ps\n void test_amx_fp16_dpfp16ps ();"}, {"sha": "d7efb3d20c216c4eab2a9ac7355c3047dca93784", "filename": "gcc/testsuite/gcc.target/i386/amxint8-dpbssd-2.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxint8-dpbssd-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxint8-dpbssd-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxint8-dpbssd-2.c?ref=fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4", "patch": "@@ -1,7 +1,6 @@\n /* { dg-do run { target { ! ia32 } } } */\n-/* { dg-require-effective-target amx_tile } */\n /* { dg-require-effective-target amx_int8 } */\n-/* { dg-options \"-O2 -mamx-tile -mamx-int8\" } */\n+/* { dg-options \"-O2 -mamx-int8\" } */\n #include <immintrin.h>\n \n #define AMX_INT8"}, {"sha": "c8bf89d738b9af708d18280ae2673865518f4a56", "filename": "gcc/testsuite/gcc.target/i386/amxint8-dpbsud-2.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxint8-dpbsud-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxint8-dpbsud-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxint8-dpbsud-2.c?ref=fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4", "patch": "@@ -1,7 +1,6 @@\n /* { dg-do run { target { ! ia32 } } } */\n-/* { dg-require-effective-target amx_tile } */\n /* { dg-require-effective-target amx_int8 } */\n-/* { dg-options \"-O2 -mamx-tile -mamx-int8\" } */\n+/* { dg-options \"-O2 -mamx-int8\" } */\n #include <immintrin.h>\n \n #define AMX_INT8"}, {"sha": "bb8777d920a313a1e5e8b4077b8b56bb97c02a34", "filename": "gcc/testsuite/gcc.target/i386/amxint8-dpbusd-2.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxint8-dpbusd-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxint8-dpbusd-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxint8-dpbusd-2.c?ref=fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4", "patch": "@@ -1,7 +1,6 @@\n /* { dg-do run { target { ! ia32 } } } */\n-/* { dg-require-effective-target amx_tile } */\n /* { dg-require-effective-target amx_int8 } */\n-/* { dg-options \"-O2 -mamx-tile -mamx-int8\" } */\n+/* { dg-options \"-O2 -mamx-int8\" } */\n #include <immintrin.h>\n \n #define AMX_INT8"}, {"sha": "d30f46d8de3b8dbe893ba414442dbc1b23dabc79", "filename": "gcc/testsuite/gcc.target/i386/amxint8-dpbuud-2.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxint8-dpbuud-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxint8-dpbuud-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Famxint8-dpbuud-2.c?ref=fd210d8bd023ed6ce061eb3ffbd76ecd1830c6c4", "patch": "@@ -1,7 +1,6 @@\n /* { dg-do run { target { ! ia32 } } } */\n-/* { dg-require-effective-target amx_tile } */\n /* { dg-require-effective-target amx_int8 } */\n-/* { dg-options \"-O2 -mamx-tile -mamx-int8\" } */\n+/* { dg-options \"-O2 -mamx-int8\" } */\n #include <immintrin.h>\n \n #define AMX_INT8"}]}