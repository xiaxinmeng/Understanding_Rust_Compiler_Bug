{"sha": "f1c13d6ddeecc9da5f53643b6b6b715546d670fe", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjFjMTNkNmRkZWVjYzlkYTVmNTM2NDNiNmI2YjcxNTU0NmQ2NzBmZQ==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2019-12-10T12:20:07Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2019-12-10T12:20:07Z"}, "message": "Record the loop masks needed for EXTRACT_LAST_REDUCTIONs\n\nThe analysis phase of vectorizable_condition wasn't recording the\nloop masks needed by the transform phase.  This meant that the masks\nwouldn't be created in the (rare) case that no other statement needed\nthem.\n\n2019-12-10  Richard Sandiford  <richard.sandiford@arm.com>\n\ngcc/\n\t* tree-vect-stmts.c (vectorizable_condition): Record the loop\n\tmasks required for extract-last reductions.\n\ngcc/testsuite/\n\t* gcc.target/aarch64/sve/clastb_9.c: New test.\n\nFrom-SVN: r279163", "tree": {"sha": "692bc76eee86aeddb222ae16fbb0b8239944aea3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/692bc76eee86aeddb222ae16fbb0b8239944aea3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f1c13d6ddeecc9da5f53643b6b6b715546d670fe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f1c13d6ddeecc9da5f53643b6b6b715546d670fe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f1c13d6ddeecc9da5f53643b6b6b715546d670fe", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f1c13d6ddeecc9da5f53643b6b6b715546d670fe/comments", "author": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9ec35478ccf0f3539988a054b7996278706a7710", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9ec35478ccf0f3539988a054b7996278706a7710", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9ec35478ccf0f3539988a054b7996278706a7710"}], "stats": {"total": 47, "additions": 45, "deletions": 2}, "files": [{"sha": "0ca3e15f4c9f41461bf05c65991150d114d7cc34", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1c13d6ddeecc9da5f53643b6b6b715546d670fe/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1c13d6ddeecc9da5f53643b6b6b715546d670fe/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f1c13d6ddeecc9da5f53643b6b6b715546d670fe", "patch": "@@ -1,3 +1,8 @@\n+2019-12-10  Richard Sandiford  <richard.sandiford@arm.com>\n+\n+\t* tree-vect-stmts.c (vectorizable_condition): Record the loop\n+\tmasks required for extract-last reductions.\n+\n 2019-12-10  Richard Sandiford  <richard.sandiford@arm.com>\n \n \t* tree-vect-stmts.c (vect_finish_replace_stmt): Always use the"}, {"sha": "5020620fc4dc6fd9189ff407061fa55a7f691368", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1c13d6ddeecc9da5f53643b6b6b715546d670fe/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1c13d6ddeecc9da5f53643b6b6b715546d670fe/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f1c13d6ddeecc9da5f53643b6b6b715546d670fe", "patch": "@@ -1,3 +1,7 @@\n+2019-12-10  Richard Sandiford  <richard.sandiford@arm.com>\n+\n+\t* gcc.target/aarch64/sve/clastb_9.c: New test.\n+\n 2019-12-10  Tobias Burnus  <tobias@codesourcery.com>\n \n \tPR fortran/92872"}, {"sha": "e9db93568c5369326eb7e3635c933bc7a8eb54bc", "filename": "gcc/testsuite/gcc.target/aarch64/sve/clastb_9.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1c13d6ddeecc9da5f53643b6b6b715546d670fe/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fsve%2Fclastb_9.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1c13d6ddeecc9da5f53643b6b6b715546d670fe/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fsve%2Fclastb_9.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fsve%2Fclastb_9.c?ref=f1c13d6ddeecc9da5f53643b6b6b715546d670fe", "patch": "@@ -0,0 +1,21 @@\n+/* Originally gcc.dg/vect/O1-pr41008.c.  */\n+/* { dg-options \"-O1 -ftree-vectorize -fno-vect-cost-model -msve-vector-bits=256\" } */\n+\n+double heating[2][2];\n+\n+void foo (int, int);\n+\n+void map_do()\n+{\n+  int jsav, ksav, k, j;\n+\n+  for(k = 0; k < 2; k++)\n+    for(j = 0; j < 2; j++)\n+      if (heating[k][j] > 0.)\n+        {\n+          jsav = j;\n+          ksav = k;\n+        }\n+\n+  foo (jsav, ksav);\n+}"}, {"sha": "706da5b4e92008fc8566b5aa3a551dd5a3cbdcfe", "filename": "gcc/tree-vect-stmts.c", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1c13d6ddeecc9da5f53643b6b6b715546d670fe/gcc%2Ftree-vect-stmts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1c13d6ddeecc9da5f53643b6b6b715546d670fe/gcc%2Ftree-vect-stmts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-stmts.c?ref=f1c13d6ddeecc9da5f53643b6b6b715546d670fe", "patch": "@@ -9912,6 +9912,7 @@ vectorizable_condition (stmt_vec_info stmt_info, gimple_stmt_iterator *gsi,\n        vect_unknown_def_type, vect_unknown_def_type};\n   int ndts = 4;\n   int ncopies;\n+  int vec_num;\n   enum tree_code code, cond_code, bitop1 = NOP_EXPR, bitop2 = NOP_EXPR;\n   stmt_vec_info prev_stmt_info = NULL;\n   int i, j;\n@@ -9969,9 +9970,15 @@ vectorizable_condition (stmt_vec_info stmt_info, gimple_stmt_iterator *gsi,\n   tree vectype1 = NULL_TREE, vectype2 = NULL_TREE;\n \n   if (slp_node)\n-    ncopies = 1;\n+    {\n+      ncopies = 1;\n+      vec_num = SLP_TREE_NUMBER_OF_VEC_STMTS (slp_node);\n+    }\n   else\n-    ncopies = vect_get_num_copies (loop_vinfo, vectype);\n+    {\n+      ncopies = vect_get_num_copies (loop_vinfo, vectype);\n+      vec_num = 1;\n+    }\n \n   gcc_assert (ncopies >= 1);\n   if (for_reduction && ncopies > 1)\n@@ -10094,6 +10101,12 @@ vectorizable_condition (stmt_vec_info stmt_info, gimple_stmt_iterator *gsi,\n \t    }\n \t}\n \n+      if (loop_vinfo\n+\t  && LOOP_VINFO_CAN_FULLY_MASK_P (loop_vinfo)\n+\t  && reduction_type == EXTRACT_LAST_REDUCTION)\n+\tvect_record_loop_mask (loop_vinfo, &LOOP_VINFO_MASKS (loop_vinfo),\n+\t\t\t       ncopies * vec_num, vectype, NULL);\n+\n       vect_cost_for_stmt kind = vector_stmt;\n       if (reduction_type == EXTRACT_LAST_REDUCTION)\n \t/* Count one reduction-like operation per vector.  */"}]}