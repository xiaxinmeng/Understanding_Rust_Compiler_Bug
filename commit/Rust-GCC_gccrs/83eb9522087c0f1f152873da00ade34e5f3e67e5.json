{"sha": "83eb9522087c0f1f152873da00ade34e5f3e67e5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODNlYjk1MjIwODdjMGYxZjE1Mjg3M2RhMDBhZGUzNGU1ZjNlNjdlNQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2019-07-03T04:56:25Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-07-03T04:56:25Z"}, "message": "gimplify.c (gimplify_scan_omp_clauses): For inscan reductions on worksharing loop propagate it as shared clause to...\n\n\t* gimplify.c (gimplify_scan_omp_clauses): For inscan reductions\n\ton worksharing loop propagate it as shared clause to containing\n\tcombined parallel.\n\n\t* c-omp.c (c_omp_split_clauses): Put OMP_CLAUSE_REDUCTION_INSCAN\n\tclauses on OMP_FOR rather than OMP_PARALLEL when OMP_FOR is combined\n\twith OMP_PARALLEL.\n\n\t* c-c++-common/gomp/scan-5.c: New test.\n\nFrom-SVN: r272957", "tree": {"sha": "df2542661fab9ef8615c69f2f2a5c03502eec739", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/df2542661fab9ef8615c69f2f2a5c03502eec739"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/83eb9522087c0f1f152873da00ade34e5f3e67e5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/83eb9522087c0f1f152873da00ade34e5f3e67e5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/83eb9522087c0f1f152873da00ade34e5f3e67e5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/83eb9522087c0f1f152873da00ade34e5f3e67e5/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1a39b3d3e22ba34b750e277fae9634d0af015cae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a39b3d3e22ba34b750e277fae9634d0af015cae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1a39b3d3e22ba34b750e277fae9634d0af015cae"}], "stats": {"total": 36, "additions": 33, "deletions": 3}, "files": [{"sha": "0f00fce6e38be760b43dc65c85950add3d01a4f3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83eb9522087c0f1f152873da00ade34e5f3e67e5/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83eb9522087c0f1f152873da00ade34e5f3e67e5/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=83eb9522087c0f1f152873da00ade34e5f3e67e5", "patch": "@@ -1,5 +1,9 @@\n 2019-07-03  Jakub Jelinek  <jakub@redhat.com>\n \n+\t* gimplify.c (gimplify_scan_omp_clauses): For inscan reductions\n+\ton worksharing loop propagate it as shared clause to containing\n+\tcombined parallel.\n+\n \t* omp-expand.c (expand_omp_for_static_nochunk,\n \texpand_omp_for_static_chunk): For nowait worksharing loop with\n \tconditional lastprivate clause(s), emit GOMP_loop_end_nowait call"}, {"sha": "3907d3a5fffa3dd6a2abfd2a18c6c699a6b3905b", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83eb9522087c0f1f152873da00ade34e5f3e67e5/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83eb9522087c0f1f152873da00ade34e5f3e67e5/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=83eb9522087c0f1f152873da00ade34e5f3e67e5", "patch": "@@ -1,3 +1,9 @@\n+2019-07-03  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* c-omp.c (c_omp_split_clauses): Put OMP_CLAUSE_REDUCTION_INSCAN\n+\tclauses on OMP_FOR rather than OMP_PARALLEL when OMP_FOR is combined\n+\twith OMP_PARALLEL.\n+\n 2019-07-02  qing zhao  <qing.zhao@oracle.com>\n \n \tPR preprocessor/90581"}, {"sha": "583305e268b11a1ffcd7560205abfdd789270700", "filename": "gcc/c-family/c-omp.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83eb9522087c0f1f152873da00ade34e5f3e67e5/gcc%2Fc-family%2Fc-omp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83eb9522087c0f1f152873da00ade34e5f3e67e5/gcc%2Fc-family%2Fc-omp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-omp.c?ref=83eb9522087c0f1f152873da00ade34e5f3e67e5", "patch": "@@ -1634,7 +1634,8 @@ c_omp_split_clauses (location_t loc, enum tree_code code,\n \t  break;\n \t/* Reduction is allowed on simd, for, parallel, sections, taskloop\n \t   and teams.  Duplicate it on all of them, but omit on for or\n-\t   sections if parallel is present.  If taskloop is combined with\n+\t   sections if parallel is present (unless inscan, in that case\n+\t   omit on parallel).  If taskloop is combined with\n \t   parallel, omit it on parallel.  */\n \tcase OMP_CLAUSE_REDUCTION:\n \t  if (OMP_CLAUSE_REDUCTION_TASK (clauses))\n@@ -1708,7 +1709,8 @@ c_omp_split_clauses (location_t loc, enum tree_code code,\n \t\t  s = C_OMP_CLAUSE_SPLIT_PARALLEL;\n \t\t}\n \t      else if ((mask & (OMP_CLAUSE_MASK_1\n-\t\t\t\t<< PRAGMA_OMP_CLAUSE_NUM_THREADS)) != 0)\n+\t\t\t\t<< PRAGMA_OMP_CLAUSE_NUM_THREADS)) != 0\n+\t\t       && !OMP_CLAUSE_REDUCTION_INSCAN (clauses))\n \t\ts = C_OMP_CLAUSE_SPLIT_PARALLEL;\n \t      else\n \t\ts = C_OMP_CLAUSE_SPLIT_FOR;"}, {"sha": "9e5e4230941254de5eae4777eb9a4aa7ea692308", "filename": "gcc/gimplify.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83eb9522087c0f1f152873da00ade34e5f3e67e5/gcc%2Fgimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83eb9522087c0f1f152873da00ade34e5f3e67e5/gcc%2Fgimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimplify.c?ref=83eb9522087c0f1f152873da00ade34e5f3e67e5", "patch": "@@ -9125,7 +9125,10 @@ gimplify_scan_omp_clauses (tree *list_p, gimple_seq *pre_p,\n \t\t\t  \" or private in outer context\", DECL_NAME (decl));\n \t    }\n \tdo_notice:\n-\t  if ((region_type & ORT_TASKLOOP) == ORT_TASKLOOP\n+\t  if (((region_type & ORT_TASKLOOP) == ORT_TASKLOOP\n+\t       || (region_type == ORT_WORKSHARE\n+\t\t   && OMP_CLAUSE_CODE (c) == OMP_CLAUSE_REDUCTION\n+\t\t   && OMP_CLAUSE_REDUCTION_INSCAN (c)))\n \t      && outer_ctx\n \t      && outer_ctx->region_type == ORT_COMBINED_PARALLEL\n \t      && (OMP_CLAUSE_CODE (c) == OMP_CLAUSE_REDUCTION"}, {"sha": "2e3999ed9ef38f964b162552a36d06c4b78ffddf", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83eb9522087c0f1f152873da00ade34e5f3e67e5/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83eb9522087c0f1f152873da00ade34e5f3e67e5/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=83eb9522087c0f1f152873da00ade34e5f3e67e5", "patch": "@@ -1,5 +1,7 @@\n 2019-07-03  Jakub Jelinek  <jakub@redhat.com>\n \n+\t* c-c++-common/gomp/scan-5.c: New test.\n+\n \t* c-c++-common/gomp/lastprivate-conditional-5.c: New test.\n \n 2019-07-02  Jeff Law  <law@redhat.com>"}, {"sha": "92945bab01611d933c85c8aca794cc8e9a9fba8d", "filename": "gcc/testsuite/c-c++-common/gomp/scan-5.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83eb9522087c0f1f152873da00ade34e5f3e67e5/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fscan-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83eb9522087c0f1f152873da00ade34e5f3e67e5/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fscan-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fscan-5.c?ref=83eb9522087c0f1f152873da00ade34e5f3e67e5", "patch": "@@ -0,0 +1,13 @@\n+int\n+foo (int *a, int *b)\n+{\n+  int r = 0;\n+  #pragma omp parallel for reduction (inscan, +:r) default(none) firstprivate (a, b)\n+  for (int i = 0; i < 64; i++)\n+    {\n+      r += a[i];\n+      #pragma omp scan inclusive (r)\t/* { dg-message \"sorry, unimplemented: '#pragma omp scan' not supported yet\" } */\n+      b[i] = r;\n+    }\n+  return r;\n+}"}]}