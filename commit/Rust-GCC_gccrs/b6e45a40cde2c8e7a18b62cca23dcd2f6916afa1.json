{"sha": "b6e45a40cde2c8e7a18b62cca23dcd2f6916afa1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjZlNDVhNDBjZGUyYzhlN2ExOGI2MmNjYTIzZGNkMmY2OTE2YWZhMQ==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2019-03-18T15:58:24Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2019-03-18T15:58:24Z"}, "message": "PR c++/89682 - wrong access error in default argument.\n\nHere we were pushing into the right access context, but we were called from\na deferred checking context, so didn't end up doing the checks until after\nwe left the access context.\n\n\t* pt.c (tsubst_default_argument): Don't defer access checks.\n\nFrom-SVN: r269766", "tree": {"sha": "a190096cda3c6cb88a3573692e82d805f3f14f1f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a190096cda3c6cb88a3573692e82d805f3f14f1f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b6e45a40cde2c8e7a18b62cca23dcd2f6916afa1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6e45a40cde2c8e7a18b62cca23dcd2f6916afa1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b6e45a40cde2c8e7a18b62cca23dcd2f6916afa1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6e45a40cde2c8e7a18b62cca23dcd2f6916afa1/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ca6d4a08c120841654acb10b973b0d009b053ef3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca6d4a08c120841654acb10b973b0d009b053ef3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ca6d4a08c120841654acb10b973b0d009b053ef3"}], "stats": {"total": 21, "additions": 21, "deletions": 0}, "files": [{"sha": "bc3850d3aff2010535c4142df5dbb94805ca8f33", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6e45a40cde2c8e7a18b62cca23dcd2f6916afa1/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6e45a40cde2c8e7a18b62cca23dcd2f6916afa1/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=b6e45a40cde2c8e7a18b62cca23dcd2f6916afa1", "patch": "@@ -1,3 +1,8 @@\n+2019-03-18  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/89682 - wrong access error in default argument.\n+\t* pt.c (tsubst_default_argument): Don't defer access checks.\n+\n 2019-03-18  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/85014"}, {"sha": "7dc6e44cf7be99999ce1c6fec7592b23f98b99a9", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6e45a40cde2c8e7a18b62cca23dcd2f6916afa1/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6e45a40cde2c8e7a18b62cca23dcd2f6916afa1/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=b6e45a40cde2c8e7a18b62cca23dcd2f6916afa1", "patch": "@@ -12776,6 +12776,7 @@ tsubst_default_argument (tree fn, int parmnum, tree type, tree arg,\n      rather than in the current class.  */\n   push_to_top_level ();\n   push_access_scope (fn);\n+  push_deferring_access_checks (dk_no_deferred);\n   start_lambda_scope (parm);\n \n   /* The default argument expression may cause implicitly defined\n@@ -12799,6 +12800,7 @@ tsubst_default_argument (tree fn, int parmnum, tree type, tree arg,\n     inform (input_location,\n \t    \"  when instantiating default argument for call to %qD\", fn);\n \n+  pop_deferring_access_checks ();\n   pop_access_scope (fn);\n   pop_from_top_level ();\n "}, {"sha": "4a2b7e5b1afdcddd4a6ee478298b035e3bc4a1d1", "filename": "gcc/testsuite/g++.dg/overload/defarg12.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6e45a40cde2c8e7a18b62cca23dcd2f6916afa1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Foverload%2Fdefarg12.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6e45a40cde2c8e7a18b62cca23dcd2f6916afa1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Foverload%2Fdefarg12.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Foverload%2Fdefarg12.C?ref=b6e45a40cde2c8e7a18b62cca23dcd2f6916afa1", "patch": "@@ -0,0 +1,14 @@\n+// PR c++/89682\n+\n+template <typename T>\n+class C {\n+    class TagType {};\n+public:\n+    C(int, TagType = makeTag());\n+private:\n+    static TagType makeTag();\n+};\n+\n+void test() {\n+    C<int>(1);\n+}"}]}