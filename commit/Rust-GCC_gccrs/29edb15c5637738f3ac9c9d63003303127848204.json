{"sha": "29edb15c5637738f3ac9c9d63003303127848204", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjllZGIxNWM1NjM3NzM4ZjNhYzljOWQ2MzAwMzMwMzEyNzg0ODIwNA==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2003-09-15T00:27:16Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2003-09-15T00:27:16Z"}, "message": "class.c (layout_class_type): Make DECL_MODE match TYPE_MODE for an bit-field whose width exceeds that of its...\n\n\t* class.c (layout_class_type): Make DECL_MODE match TYPE_MODE for\n\tan bit-field whose width exceeds that of its type.\n\n\t* g++.dg/abi/bitfield11.C: New test.\n\t* g++.dg/abi/bitfield12.C: Likewise.\n\nFrom-SVN: r71392", "tree": {"sha": "55191847f19102bcfd738acb455adb684fe3adce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/55191847f19102bcfd738acb455adb684fe3adce"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/29edb15c5637738f3ac9c9d63003303127848204", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29edb15c5637738f3ac9c9d63003303127848204", "html_url": "https://github.com/Rust-GCC/gccrs/commit/29edb15c5637738f3ac9c9d63003303127848204", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29edb15c5637738f3ac9c9d63003303127848204/comments", "author": null, "committer": null, "parents": [{"sha": "bd12da498dc86d4cb18b1f6548d1efb9f530172e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bd12da498dc86d4cb18b1f6548d1efb9f530172e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bd12da498dc86d4cb18b1f6548d1efb9f530172e"}], "stats": {"total": 34, "additions": 33, "deletions": 1}, "files": [{"sha": "706ebbff67826f804964e2bd03b97fb977365660", "filename": "gcc/cp/class.c", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29edb15c5637738f3ac9c9d63003303127848204/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29edb15c5637738f3ac9c9d63003303127848204/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=29edb15c5637738f3ac9c9d63003303127848204", "patch": "@@ -4759,7 +4759,15 @@ layout_class_type (tree t, tree *virtuals_p)\n \t     field to the size of its declared type; the rest of the\n \t     field is effectively invisible.  */\n \t  DECL_SIZE (field) = TYPE_SIZE (type);\n-\t  DECL_MODE (field) = TYPE_MODE (type);\n+\t  /* We must also reset the DECL_MODE of the field.  */\n+\t  if (abi_version_at_least (2))\n+\t    DECL_MODE (field) = TYPE_MODE (type);\n+\t  else if (warn_abi\n+\t\t   && DECL_MODE (field) != TYPE_MODE (type))\n+\t    /* Versions of G++ before G++ 3.4 did not reset the\n+\t       DECL_MODE.  */\n+\t    warning (\"the offset of `%D' may not be ABI-compliant and may \"\n+\t\t     \"change in a future version of GCC\", field);\n \t}\n       else\n \tlayout_nonempty_base_or_field (rli, field, NULL_TREE,"}, {"sha": "802d53e4a3cd9b433983f0ec567dc3a42a722180", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29edb15c5637738f3ac9c9d63003303127848204/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29edb15c5637738f3ac9c9d63003303127848204/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=29edb15c5637738f3ac9c9d63003303127848204", "patch": "@@ -1,3 +1,8 @@\n+2003-09-14  Mark Mitchell  <mark@codesourcery.com>\n+\n+\t* g++.dg/abi/bitfield11.C: New test.\n+\t* g++.dg/abi/bitfield12.C: Likewise.\n+\n 2003-09-14  Alexandre Oliva  <aoliva@redhat.com>\n \n \t* gcc.dg/cpp/separate-1.c: Adjust line of error.  Test for correct"}, {"sha": "e78ea121d6159087ef35cff8acc67121e93cea81", "filename": "gcc/testsuite/g++.dg/abi/bitfield11.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29edb15c5637738f3ac9c9d63003303127848204/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fbitfield11.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29edb15c5637738f3ac9c9d63003303127848204/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fbitfield11.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fbitfield11.C?ref=29edb15c5637738f3ac9c9d63003303127848204", "patch": "@@ -0,0 +1,14 @@\n+// { dg-do run } \n+// { dg-options \"-w -fabi-version=0\" }\n+\n+struct S {\n+  char c : 1024;\n+};\n+\n+S s;\n+\n+int main () {\n+  s.c = 1;\n+  if (*(char *)&s != 1)\n+    return 1;\n+}"}, {"sha": "6cfda5d47df53523f1c84de1b642642c3f30ca8a", "filename": "gcc/testsuite/g++.dg/abi/bitfield12.C", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29edb15c5637738f3ac9c9d63003303127848204/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fbitfield12.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29edb15c5637738f3ac9c9d63003303127848204/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fbitfield12.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fbitfield12.C?ref=29edb15c5637738f3ac9c9d63003303127848204", "patch": "@@ -0,0 +1,5 @@\n+// { dg-options \"-Wabi -fabi-version=1\" }\n+\n+struct S { // { dg-warning \"ABI\" }\n+  char c : 1024; // { dg-warning \"width\" }\n+};"}]}