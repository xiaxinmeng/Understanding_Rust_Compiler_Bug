{"sha": "69f36ba6bd980b7a0a426beec9e6b2c495d129b4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjlmMzZiYTZiZDk4MGI3YTBhNDI2YmVlYzllNmIyYzQ5NWQxMjliNA==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2011-02-10T16:29:49Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2011-02-10T16:29:49Z"}, "message": "class.c (type_has_constexpr_default_constructor): Make sure the caller stripped an enclosing array.\n\n\t* class.c (type_has_constexpr_default_constructor): Make sure the\n\tcaller stripped an enclosing array.\n\t* init.c (perform_member_init): Strip arrays before calling it.\n\nFrom-SVN: r170006", "tree": {"sha": "c49864362c684ac4366e445c11ee2613ca837412", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c49864362c684ac4366e445c11ee2613ca837412"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/69f36ba6bd980b7a0a426beec9e6b2c495d129b4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/69f36ba6bd980b7a0a426beec9e6b2c495d129b4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/69f36ba6bd980b7a0a426beec9e6b2c495d129b4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/69f36ba6bd980b7a0a426beec9e6b2c495d129b4/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5b883ca61cf968fa32782309aa3750511b549889", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b883ca61cf968fa32782309aa3750511b549889", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5b883ca61cf968fa32782309aa3750511b549889"}], "stats": {"total": 37, "additions": 34, "deletions": 3}, "files": [{"sha": "26de2b6ea0e643c97168fe6fdc25e2c28a39ec5c", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/69f36ba6bd980b7a0a426beec9e6b2c495d129b4/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/69f36ba6bd980b7a0a426beec9e6b2c495d129b4/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=69f36ba6bd980b7a0a426beec9e6b2c495d129b4", "patch": "@@ -1,5 +1,9 @@\n 2011-02-09  Jason Merrill  <jason@redhat.com>\n \n+\t* class.c (type_has_constexpr_default_constructor): Make sure the\n+\tcaller stripped an enclosing array.\n+\t* init.c (perform_member_init): Strip arrays before calling it.\n+\n \tPR c++/47511\n \t* semantics.c (potential_constant_expression_1): Handle TEMPLATE_DECL.\n "}, {"sha": "66c85bdb5dee1be1b15db2e0f2e622b763cd1545", "filename": "gcc/cp/class.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/69f36ba6bd980b7a0a426beec9e6b2c495d129b4/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/69f36ba6bd980b7a0a426beec9e6b2c495d129b4/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=69f36ba6bd980b7a0a426beec9e6b2c495d129b4", "patch": "@@ -4349,7 +4349,11 @@ type_has_constexpr_default_constructor (tree t)\n   tree fns;\n \n   if (!CLASS_TYPE_P (t))\n-    return false;\n+    {\n+      /* The caller should have stripped an enclosing array.  */\n+      gcc_assert (TREE_CODE (t) != ARRAY_TYPE);\n+      return false;\n+    }\n   if (CLASSTYPE_LAZY_DEFAULT_CTOR (t))\n     return synthesized_default_constructor_is_constexpr (t);\n   fns = locate_ctor (t);"}, {"sha": "e590118f3cfb1d3a647e192a86db431621c088c5", "filename": "gcc/cp/init.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/69f36ba6bd980b7a0a426beec9e6b2c495d129b4/gcc%2Fcp%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/69f36ba6bd980b7a0a426beec9e6b2c495d129b4/gcc%2Fcp%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Finit.c?ref=69f36ba6bd980b7a0a426beec9e6b2c495d129b4", "patch": "@@ -535,16 +535,17 @@ perform_member_init (tree member, tree init)\n \t\t       \"uninitialized member %qD with %<const%> type %qT\",\n \t\t       member, type);\n \n+\t  core_type = strip_array_types (type);\n+\n \t  if (DECL_DECLARED_CONSTEXPR_P (current_function_decl)\n-\t      && !type_has_constexpr_default_constructor (type))\n+\t      && !type_has_constexpr_default_constructor (core_type))\n \t    {\n \t      if (!DECL_TEMPLATE_INSTANTIATION (current_function_decl))\n \t\terror (\"uninitialized member %qD in %<constexpr%> constructor\",\n \t\t       member);\n \t      DECL_DECLARED_CONSTEXPR_P (current_function_decl) = false;\n \t    }\n \n-\t  core_type = strip_array_types (type);\n \t  if (CLASS_TYPE_P (core_type)\n \t      && (CLASSTYPE_READONLY_FIELDS_NEED_INIT (core_type)\n \t\t  || CLASSTYPE_REF_FIELDS_NEED_INIT (core_type)))"}, {"sha": "8d7e3871c8166c925b5c6f104a0f415e170e048b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/69f36ba6bd980b7a0a426beec9e6b2c495d129b4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/69f36ba6bd980b7a0a426beec9e6b2c495d129b4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=69f36ba6bd980b7a0a426beec9e6b2c495d129b4", "patch": "@@ -1,5 +1,7 @@\n 2011-02-09  Jason Merrill  <jason@redhat.com>\n \n+\t* g++.dg/cpp0x/regress/abi-empty7.C: New.\n+\n \t* g++.dg/cpp0x/regress: New directory.\n \t* g++.dg/cpp0x/constexpr-regress1.C: Move to regress/regress1.C.\n \t* g++.dg/cpp0x/constexpr-regress2.C: Move to regress/regress2.C."}, {"sha": "adc71278d9db03c0f6b3dc091dd0c6d27f7daacd", "filename": "gcc/testsuite/g++.dg/cpp0x/regress/abi-empty7.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/69f36ba6bd980b7a0a426beec9e6b2c495d129b4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fregress%2Fabi-empty7.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/69f36ba6bd980b7a0a426beec9e6b2c495d129b4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fregress%2Fabi-empty7.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fregress%2Fabi-empty7.C?ref=69f36ba6bd980b7a0a426beec9e6b2c495d129b4", "patch": "@@ -0,0 +1,20 @@\n+// Copy of abi/empty7.C.\n+// { dg-do run { target i?86-*-* x86_64-*-* } }\n+// { dg-require-effective-target ilp32 }\n+// { dg-options \"-fabi-version=0 -std=c++0x\" }\n+\n+struct S1 {};\n+struct S2 { virtual void f () {} S1 s1[4]; };\n+struct S3 : virtual public S2 {};\n+struct S4 : virtual public S2 { int i; };\n+struct S5 : public S3, virtual public S4 {};\n+struct S6 { S5 s5; };\n+struct S7 { S1 s1[5]; };\n+struct S8 : public S1, public S6, virtual public S7 { };\n+\n+S8 s8;\n+\n+int main () {\n+  if ((char *)(S7 *)&s8 - (char *)&s8 != 24)\n+    return 1;\n+}"}]}