{"sha": "e147bb0faad95ed8699c426484ed3dd026fd3366", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTE0N2JiMGZhYWQ5NWVkODY5OWM0MjY0ODRlZDNkZDAyNmZkMzM2Ng==", "commit": {"author": {"name": "Andrea Corallo", "email": "andrea.corallo@arm.com", "date": "2020-09-07T12:45:47Z"}, "committer": {"name": "Andrea Corallo", "email": "andrea.corallo@arm.com", "date": "2020-09-07T17:49:25Z"}, "message": "vec: Revert \"dead code removal in tree-vect-loop.c\" and add a comment.\n\ngcc/ChangeLog\n\n2020-09-07  Andrea Corallo  <andrea.corallo@arm.com>\n\n\t* tree-vect-loop.c (vect_estimate_min_profitable_iters): Revert\n\tdead-code removal introduced by 09fa6acd8d9 + add a comment to\n\tclarify.", "tree": {"sha": "8301d707166fa002211c4c24318f51a4a41ca17a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8301d707166fa002211c4c24318f51a4a41ca17a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e147bb0faad95ed8699c426484ed3dd026fd3366", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e147bb0faad95ed8699c426484ed3dd026fd3366", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e147bb0faad95ed8699c426484ed3dd026fd3366", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e147bb0faad95ed8699c426484ed3dd026fd3366/comments", "author": {"login": "AndreaCorallo", "id": 6765576, "node_id": "MDQ6VXNlcjY3NjU1NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/6765576?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AndreaCorallo", "html_url": "https://github.com/AndreaCorallo", "followers_url": "https://api.github.com/users/AndreaCorallo/followers", "following_url": "https://api.github.com/users/AndreaCorallo/following{/other_user}", "gists_url": "https://api.github.com/users/AndreaCorallo/gists{/gist_id}", "starred_url": "https://api.github.com/users/AndreaCorallo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AndreaCorallo/subscriptions", "organizations_url": "https://api.github.com/users/AndreaCorallo/orgs", "repos_url": "https://api.github.com/users/AndreaCorallo/repos", "events_url": "https://api.github.com/users/AndreaCorallo/events{/privacy}", "received_events_url": "https://api.github.com/users/AndreaCorallo/received_events", "type": "User", "site_admin": false}, "committer": {"login": "AndreaCorallo", "id": 6765576, "node_id": "MDQ6VXNlcjY3NjU1NzY=", "avatar_url": "https://avatars.githubusercontent.com/u/6765576?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AndreaCorallo", "html_url": "https://github.com/AndreaCorallo", "followers_url": "https://api.github.com/users/AndreaCorallo/followers", "following_url": "https://api.github.com/users/AndreaCorallo/following{/other_user}", "gists_url": "https://api.github.com/users/AndreaCorallo/gists{/gist_id}", "starred_url": "https://api.github.com/users/AndreaCorallo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AndreaCorallo/subscriptions", "organizations_url": "https://api.github.com/users/AndreaCorallo/orgs", "repos_url": "https://api.github.com/users/AndreaCorallo/repos", "events_url": "https://api.github.com/users/AndreaCorallo/events{/privacy}", "received_events_url": "https://api.github.com/users/AndreaCorallo/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "016b190036437f7a357f0a3ce5281fd70620a1a5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/016b190036437f7a357f0a3ce5281fd70620a1a5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/016b190036437f7a357f0a3ce5281fd70620a1a5"}], "stats": {"total": 17, "additions": 13, "deletions": 4}, "files": [{"sha": "80e78f7adf4d1cbc279a63831d72b57176d58470", "filename": "gcc/tree-vect-loop.c", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e147bb0faad95ed8699c426484ed3dd026fd3366/gcc%2Ftree-vect-loop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e147bb0faad95ed8699c426484ed3dd026fd3366/gcc%2Ftree-vect-loop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop.c?ref=e147bb0faad95ed8699c426484ed3dd026fd3366", "patch": "@@ -4089,6 +4089,8 @@ vect_estimate_min_profitable_iters (loop_vec_info loop_vinfo,\n \n   if (vec_outside_cost <= 0)\n     min_profitable_estimate = 0;\n+  /* ??? This \"else if\" arm is written to handle all cases; see below for\n+     what we would do for !LOOP_VINFO_USING_PARTIAL_VECTORS_P.  */\n   else if (LOOP_VINFO_USING_PARTIAL_VECTORS_P (loop_vinfo))\n     {\n       /* This is a repeat of the code above, but with + SOC rather\n@@ -4101,10 +4103,17 @@ vect_estimate_min_profitable_iters (loop_vec_info loop_vinfo,\n       if (outside_overhead > 0)\n \tmin_vec_niters = outside_overhead / saving_per_viter + 1;\n \n-      int threshold = (vec_inside_cost * min_vec_niters\n-\t\t       + vec_outside_cost\n-\t\t       + scalar_outside_cost);\n-      min_profitable_estimate = threshold / scalar_single_iter_cost + 1;\n+      if (LOOP_VINFO_USING_PARTIAL_VECTORS_P (loop_vinfo))\n+\t{\n+\t  int threshold = (vec_inside_cost * min_vec_niters\n+\t\t\t   + vec_outside_cost\n+\t\t\t   + scalar_outside_cost);\n+\t  min_profitable_estimate = threshold / scalar_single_iter_cost + 1;\n+\t}\n+      else\n+\tmin_profitable_estimate = (min_vec_niters * assumed_vf\n+\t\t\t\t   + peel_iters_prologue\n+\t\t\t\t   + peel_iters_epilogue);\n     }\n   else\n     {"}]}