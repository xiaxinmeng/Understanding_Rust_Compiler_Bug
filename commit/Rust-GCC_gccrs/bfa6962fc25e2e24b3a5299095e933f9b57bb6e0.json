{"sha": "bfa6962fc25e2e24b3a5299095e933f9b57bb6e0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmZhNjk2MmZjMjVlMmUyNGIzYTUyOTkwOTVlOTMzZjliNTdiYjZlMA==", "commit": {"author": {"name": "Bob Duff", "email": "duff@adacore.com", "date": "2019-08-19T08:37:23Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-08-19T08:37:23Z"}, "message": "[Ada] Suppress warnings on unreferenced parameters of dispatching ops\n\nIf the -gnatwf switch is used to activate warnings on unreferenced\nformal parameters, the warning is no longer given if the subprogram is\ndispatching, because such warnings tend to be noise. It is quite common\nto have a parameter that is necessary just because the subprogram is\noverriding, or just because we need a controlling parameter for the\ndispatch.\n\n2019-08-19  Bob Duff  <duff@adacore.com>\n\ngcc/ada/\n\n\t* sem_warn.adb (Warn_On_Unreferenced_Entity): Suppress warning\n\ton formal parameters of dispatching operations.\n\ngcc/testsuite/\n\n\t* gnat.dg/warn29.adb, gnat.dg/warn29.ads: New testcase.\n\nFrom-SVN: r274663", "tree": {"sha": "e3a0a408bda5ba809d8c1f2321ab06b27d02e2aa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e3a0a408bda5ba809d8c1f2321ab06b27d02e2aa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bfa6962fc25e2e24b3a5299095e933f9b57bb6e0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bfa6962fc25e2e24b3a5299095e933f9b57bb6e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bfa6962fc25e2e24b3a5299095e933f9b57bb6e0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bfa6962fc25e2e24b3a5299095e933f9b57bb6e0/comments", "author": {"login": "bobduff", "id": 29099567, "node_id": "MDQ6VXNlcjI5MDk5NTY3", "avatar_url": "https://avatars.githubusercontent.com/u/29099567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bobduff", "html_url": "https://github.com/bobduff", "followers_url": "https://api.github.com/users/bobduff/followers", "following_url": "https://api.github.com/users/bobduff/following{/other_user}", "gists_url": "https://api.github.com/users/bobduff/gists{/gist_id}", "starred_url": "https://api.github.com/users/bobduff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bobduff/subscriptions", "organizations_url": "https://api.github.com/users/bobduff/orgs", "repos_url": "https://api.github.com/users/bobduff/repos", "events_url": "https://api.github.com/users/bobduff/events{/privacy}", "received_events_url": "https://api.github.com/users/bobduff/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "fcef060c9b321edcb24a56616588e712c22029ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fcef060c9b321edcb24a56616588e712c22029ba", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fcef060c9b321edcb24a56616588e712c22029ba"}], "stats": {"total": 54, "additions": 49, "deletions": 5}, "files": [{"sha": "84c2239d209d5d758b613cb1bd1689c266c15e71", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bfa6962fc25e2e24b3a5299095e933f9b57bb6e0/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bfa6962fc25e2e24b3a5299095e933f9b57bb6e0/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=bfa6962fc25e2e24b3a5299095e933f9b57bb6e0", "patch": "@@ -1,3 +1,8 @@\n+2019-08-19  Bob Duff  <duff@adacore.com>\n+\n+\t* sem_warn.adb (Warn_On_Unreferenced_Entity): Suppress warning\n+\ton formal parameters of dispatching operations.\n+\n 2019-08-19  Ed Schonberg  <schonberg@adacore.com>\n \n \t* sem_res.adb (Resolve_Call): A call to an expression function"}, {"sha": "8f85057dc0d700dedc315622178d480c498e7234", "filename": "gcc/ada/sem_warn.adb", "status": "modified", "additions": 25, "deletions": 5, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bfa6962fc25e2e24b3a5299095e933f9b57bb6e0/gcc%2Fada%2Fsem_warn.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bfa6962fc25e2e24b3a5299095e933f9b57bb6e0/gcc%2Fada%2Fsem_warn.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_warn.adb?ref=bfa6962fc25e2e24b3a5299095e933f9b57bb6e0", "patch": "@@ -4407,11 +4407,31 @@ package body Sem_Warn is\n                         E := Body_E;\n                      end if;\n \n-                     if not Is_Trivial_Subprogram (Scope (E)) then\n-                        Error_Msg_NE -- CODEFIX\n-                          (\"?u?formal parameter & is not referenced!\",\n-                           E, Spec_E);\n-                     end if;\n+                     declare\n+                        B : constant Node_Id := Parent (Parent (Scope (E)));\n+                        S : Entity_Id := Empty;\n+                     begin\n+                        if Nkind_In (B,\n+                                     N_Expression_Function,\n+                                     N_Subprogram_Body,\n+                                     N_Subprogram_Renaming_Declaration)\n+                        then\n+                           S := Corresponding_Spec (B);\n+                        end if;\n+\n+                        --  Do not warn for dispatching operations, because\n+                        --  that causes too much noise. Also do not warn for\n+                        --  trivial subprograms.\n+\n+                        if (not Present (S)\n+                            or else not Is_Dispatching_Operation (S))\n+                          and then not Is_Trivial_Subprogram (Scope (E))\n+                        then\n+                           Error_Msg_NE -- CODEFIX\n+                             (\"?u?formal parameter & is not referenced!\",\n+                              E, Spec_E);\n+                        end if;\n+                     end;\n                   end if;\n                end if;\n "}, {"sha": "5bafa9d636f65738a15e2023de7f8079fc2402ca", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bfa6962fc25e2e24b3a5299095e933f9b57bb6e0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bfa6962fc25e2e24b3a5299095e933f9b57bb6e0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bfa6962fc25e2e24b3a5299095e933f9b57bb6e0", "patch": "@@ -1,3 +1,7 @@\n+2019-08-19  Bob Duff  <duff@adacore.com>\n+\n+\t* gnat.dg/warn29.adb, gnat.dg/warn29.ads: New testcase.\n+\n 2019-08-19  Ed Schonberg  <schonberg@adacore.com>\n \n \t* gnat.dg/expr_func9.adb: New testcase."}, {"sha": "ec3b9eebf6e2f89382530ca48c1dd58a76125c89", "filename": "gcc/testsuite/gnat.dg/warn29.adb", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bfa6962fc25e2e24b3a5299095e933f9b57bb6e0/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn29.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bfa6962fc25e2e24b3a5299095e933f9b57bb6e0/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn29.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn29.adb?ref=bfa6962fc25e2e24b3a5299095e933f9b57bb6e0", "patch": "@@ -0,0 +1,11 @@\n+--  { dg-do compile }\n+--  { dg-options \"-gnatwa\" }\n+\n+with Text_IO; use Text_IO;\n+\n+package body Warn29 is\n+   procedure P (X : T; Y : Integer) is\n+   begin\n+      Put_Line (\"hello\");\n+   end P;\n+end Warn29;"}, {"sha": "56c202a8c87b70b81d8e0ddeeeb01905b2995578", "filename": "gcc/testsuite/gnat.dg/warn29.ads", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bfa6962fc25e2e24b3a5299095e933f9b57bb6e0/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn29.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bfa6962fc25e2e24b3a5299095e933f9b57bb6e0/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn29.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fwarn29.ads?ref=bfa6962fc25e2e24b3a5299095e933f9b57bb6e0", "patch": "@@ -0,0 +1,4 @@\n+package Warn29 is\n+   type T is tagged null record;\n+   procedure P (X : T; Y : Integer);\n+end Warn29;"}]}