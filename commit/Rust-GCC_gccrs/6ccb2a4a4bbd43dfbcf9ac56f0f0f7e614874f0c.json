{"sha": "6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmNjYjJhNGE0YmJkNDNkZmJjZjlhYzU2ZjBmMGY3ZTYxNDg3NGYwYw==", "commit": {"author": {"name": "Joseph Myers", "email": "joseph@codesourcery.com", "date": "2009-04-01T14:41:06Z"}, "committer": {"name": "Joseph Myers", "email": "jsm28@gcc.gnu.org", "date": "2009-04-01T14:41:06Z"}, "message": "re PR c/39605 (\"error: variable-size type declared outside of any function\" is issued twice)\n\n\tPR c/39605\n\t* c-decl.c (grokdeclarator): Pedwarn for file-scope array\n\tdeclarator whose size is not an integer constant expression but\n\tfolds to an integer constant, then treat it as a constant\n\tsubsequently.\n\ntestsuite:\n\t* gcc.dg/vla-17.c, gcc.dg/vla-18.c: New tests.\n\t* gcc.dg/pr25682.c: Update expected diagnostics.\n\nFrom-SVN: r145405", "tree": {"sha": "1b594cd6ac30f778bcb2ffce2d24267f82199988", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1b594cd6ac30f778bcb2ffce2d24267f82199988"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c/comments", "author": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "299b87f8a21c1ae2611434529c8c4dfc4c291d95", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/299b87f8a21c1ae2611434529c8c4dfc4c291d95", "html_url": "https://github.com/Rust-GCC/gccrs/commit/299b87f8a21c1ae2611434529c8c4dfc4c291d95"}], "stats": {"total": 52, "additions": 47, "deletions": 5}, "files": [{"sha": "1eebf64a50907a4ae1b372acadd3110d2247f367", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c", "patch": "@@ -1,3 +1,11 @@\n+2009-04-01  Joseph Myers  <joseph@codesourcery.com>\n+\n+\tPR c/39605\n+\t* c-decl.c (grokdeclarator): Pedwarn for file-scope array\n+\tdeclarator whose size is not an integer constant expression but\n+\tfolds to an integer constant, then treat it as a constant\n+\tsubsequently.\n+\n 2009-04-01  Richard Guenther  <rguenther@suse.de>\n \n \t* fold-const.c (fold_plusminus_mult_expr): Do not fold"}, {"sha": "9202feb4b94bf07963307f5b1897eeed8506af79", "filename": "gcc/c-decl.c", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c", "patch": "@@ -4408,7 +4408,17 @@ grokdeclarator (const struct c_declarator *declarator,\n \t\t       not an integer constant expression.  */\n \t\t    if (!size_int_const)\n \t\t      {\n-\t\t\tthis_size_varies = size_varies = 1;\n+\t\t\t/* If this is a file scope declaration of an\n+\t\t\t   ordinary identifier, this is invalid code;\n+\t\t\t   diagnosing it here and not subsequently\n+\t\t\t   treating the type as variable-length avoids\n+\t\t\t   more confusing diagnostics later.  */\n+\t\t\tif ((decl_context == NORMAL || decl_context == FIELD)\n+\t\t\t    && current_scope == file_scope)\n+\t\t\t  pedwarn (input_location, 0,\n+\t\t\t\t   \"variably modified %qs at file scope\", name);\n+\t\t\telse\n+\t\t\t  this_size_varies = size_varies = 1;\n \t\t\twarn_variable_length_array (orig_name, size);\n \t\t      }\n \t\t  }"}, {"sha": "16d9340017987cb5846cdd4b40b14668446693a2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c", "patch": "@@ -1,3 +1,9 @@\n+2009-04-01  Joseph Myers  <joseph@codesourcery.com>\n+\n+\tPR c/39605\n+\t* gcc.dg/vla-17.c, gcc.dg/vla-18.c: New tests.\n+\t* gcc.dg/pr25682.c: Update expected diagnostics.\n+\n 2009-04-01  Richard Guenther  <rguenther@suse.de>\n \n \t* gcc.dg/fold-plusmult-2.c: New testcase."}, {"sha": "8c51d82403a28b76ce759d14948fddb90a9d2382", "filename": "gcc/testsuite/gcc.dg/pr25682.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c/gcc%2Ftestsuite%2Fgcc.dg%2Fpr25682.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c/gcc%2Ftestsuite%2Fgcc.dg%2Fpr25682.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr25682.c?ref=6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c", "patch": "@@ -10,10 +10,10 @@ struct S\n   int b;\n };\n \n-char c[(char *) &((struct S *) 0)->b - (char *) 0]; /* { dg-error \"variable-size\" } */\n-char d[(__SIZE_TYPE__) &((struct S *) 8)->b]; /* { dg-error \"variable-size\" } */\n-char e[sizeof (c) == __builtin_offsetof (struct S, b) ? 1 : -1]; /* { dg-error \"variably modified\" } */\n-char f[sizeof (d) == __builtin_offsetof (struct S, b) + 8 ? 1 : -1]; /* { dg-error \"variably modified\" } */\n+char c[(char *) &((struct S *) 0)->b - (char *) 0]; /* { dg-warning \"variably modified\" } */\n+char d[(__SIZE_TYPE__) &((struct S *) 8)->b]; /* { dg-warning \"variably modified\" } */\n+char e[sizeof (c) == __builtin_offsetof (struct S, b) ? 1 : -1];\n+char f[sizeof (d) == __builtin_offsetof (struct S, b) + 8 ? 1 : -1];\n \n extern void bar (char *, char *);\n "}, {"sha": "07d3930041788f3f7a69307ceef85498a06a26f2", "filename": "gcc/testsuite/gcc.dg/vla-17.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c/gcc%2Ftestsuite%2Fgcc.dg%2Fvla-17.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c/gcc%2Ftestsuite%2Fgcc.dg%2Fvla-17.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvla-17.c?ref=6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c", "patch": "@@ -0,0 +1,9 @@\n+/* Test diagnostics for VLA whose size folds to an integer constant at\n+   file scope.  PR 39605.  */\n+/* { dg-do compile } */\n+/* { dg-options \"\" } */\n+\n+#define FIRST ((void*)0x80)\n+#define LAST  ((void*)0x86)\n+\n+static int b[LAST-FIRST]; /* { dg-warning \"variably modified 'b' at file scope\" } */"}, {"sha": "c60069cfd86819d8bb5268dc9be48cdbded00b97", "filename": "gcc/testsuite/gcc.dg/vla-18.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c/gcc%2Ftestsuite%2Fgcc.dg%2Fvla-18.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c/gcc%2Ftestsuite%2Fgcc.dg%2Fvla-18.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvla-18.c?ref=6ccb2a4a4bbd43dfbcf9ac56f0f0f7e614874f0c", "patch": "@@ -0,0 +1,9 @@\n+/* Test diagnostics for VLA whose size folds to an integer constant at\n+   file scope; the diagnostic should be a pedwarn.  PR 39605.  */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=c99 -pedantic-errors\" } */\n+\n+#define FIRST ((char*)0x80)\n+#define LAST  ((char*)0x86)\n+\n+static int b[LAST-FIRST]; /* { dg-error \"variably modified 'b' at file scope\" } */"}]}