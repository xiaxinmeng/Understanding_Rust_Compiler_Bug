{"sha": "b7d7a473ab0813c0f52f71248f3c204dfb2451f0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjdkN2E0NzNhYjA4MTNjMGY1MmY3MTI0OGYzYzIwNGRmYjI0NTFmMA==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2009-05-10T16:40:55Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2009-05-10T16:40:55Z"}, "message": "re PR tree-optimization/40081 (verify_stmts failed with -O2)\n\n2009-05-10  Richard Guenther  <rguenther@suse.de>\n\n\tPR tree-optimization/40081\n\tRevert\n\t* tree-sra.c (instantiate_element): Instantiate scalar replacements\n\tusing the main variant of the element type.  Do not fiddle with\n\tTREE_THIS_VOLATILE or TREE_SIDE_EFFECTS.\n\n\t* tree-sra.c (sra_type_can_be_decomposed_p): Do not decompose\n\tstructs with volatile fields.\n\nFrom-SVN: r147349", "tree": {"sha": "46ffe657f00f9daedaa94686a0e36e6ce6b56021", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/46ffe657f00f9daedaa94686a0e36e6ce6b56021"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b7d7a473ab0813c0f52f71248f3c204dfb2451f0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b7d7a473ab0813c0f52f71248f3c204dfb2451f0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b7d7a473ab0813c0f52f71248f3c204dfb2451f0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b7d7a473ab0813c0f52f71248f3c204dfb2451f0/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ade1f226fa9fe1cf12523ec439b1a53b7f0b5910", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ade1f226fa9fe1cf12523ec439b1a53b7f0b5910", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ade1f226fa9fe1cf12523ec439b1a53b7f0b5910"}], "stats": {"total": 27, "additions": 23, "deletions": 4}, "files": [{"sha": "6c0177b65554c37545b1555cf4e41cab281b9647", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b7d7a473ab0813c0f52f71248f3c204dfb2451f0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b7d7a473ab0813c0f52f71248f3c204dfb2451f0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b7d7a473ab0813c0f52f71248f3c204dfb2451f0", "patch": "@@ -1,3 +1,14 @@\n+2009-05-10  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR tree-optimization/40081\n+\tRevert\n+\t* tree-sra.c (instantiate_element): Instantiate scalar replacements\n+\tusing the main variant of the element type.  Do not fiddle with\n+\tTREE_THIS_VOLATILE or TREE_SIDE_EFFECTS.\n+\n+\t* tree-sra.c (sra_type_can_be_decomposed_p): Do not decompose\n+\tstructs with volatile fields.\n+\n 2009-05-10  Jan Hubicka  <jh@suse.cz>\n \n \t* tree-inline.c (delete_unreachable_blocks_update_callgraph): Declare."}, {"sha": "626a253d1525752005b3961dbde4119a899e7a25", "filename": "gcc/tree-sra.c", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b7d7a473ab0813c0f52f71248f3c204dfb2451f0/gcc%2Ftree-sra.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b7d7a473ab0813c0f52f71248f3c204dfb2451f0/gcc%2Ftree-sra.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-sra.c?ref=b7d7a473ab0813c0f52f71248f3c204dfb2451f0", "patch": "@@ -270,6 +270,10 @@ sra_type_can_be_decomposed_p (tree type)\n \t\t      != TYPE_PRECISION (TREE_TYPE (t))))\n \t\tgoto fail;\n \n+\t      /* And volatile fields.  */\n+\t      if (TREE_THIS_VOLATILE (t))\n+\t\tgoto fail;\n+\n \t      saw_one_field = true;\n \t    }\n \n@@ -1277,8 +1281,7 @@ instantiate_element (struct sra_elt *elt)\n       nowarn = TREE_NO_WARNING (base_elt->parent->element);\n   base = base_elt->element;\n \n-  elt->replacement = var = make_rename_temp (TYPE_MAIN_VARIANT (elt->type),\n-\t\t\t\t\t     \"SR\");\n+  elt->replacement = var = make_rename_temp (elt->type, \"SR\");\n \n   if (DECL_P (elt->element)\n       && !tree_int_cst_equal (DECL_SIZE (var), DECL_SIZE (elt->element)))\n@@ -1287,8 +1290,7 @@ instantiate_element (struct sra_elt *elt)\n       DECL_SIZE_UNIT (var) = DECL_SIZE_UNIT (elt->element);\n \n       elt->in_bitfld_block = 1;\n-      elt->replacement = fold_build3 (BIT_FIELD_REF,\n-\t\t\t\t      TYPE_MAIN_VARIANT (elt->type), var,\n+      elt->replacement = fold_build3 (BIT_FIELD_REF, elt->type, var,\n \t\t\t\t      DECL_SIZE (var),\n \t\t\t\t      BYTES_BIG_ENDIAN\n \t\t\t\t      ? size_binop (MINUS_EXPR,\n@@ -1305,6 +1307,12 @@ instantiate_element (struct sra_elt *elt)\n   DECL_SOURCE_LOCATION (var) = DECL_SOURCE_LOCATION (base);\n   DECL_ARTIFICIAL (var) = 1;\n \n+  if (TREE_THIS_VOLATILE (elt->type))\n+    {\n+      TREE_THIS_VOLATILE (var) = 1;\n+      TREE_SIDE_EFFECTS (var) = 1;\n+    }\n+\n   if (DECL_NAME (base) && !DECL_IGNORED_P (base))\n     {\n       char *pretty_name = build_element_name (elt);"}]}