{"sha": "c24dbebb4414e38d43f6a4f3ed1963b7395fac11", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzI0ZGJlYmI0NDE0ZTM4ZDQzZjZhNGYzZWQxOTYzYjczOTVmYWMxMQ==", "commit": {"author": {"name": "Chung-Lin Tang", "email": "cltang@codesourcery.com", "date": "2012-08-29T09:29:55Z"}, "committer": {"name": "Chung-Lin Tang", "email": "cltang@gcc.gnu.org", "date": "2012-08-29T09:29:55Z"}, "message": "futex.h (sys_futex0): Change to static function with noinline, nomips16 attributes under MIPS16.\n\n\n2012-08-29  Chung-Lin Tang  <cltang@codesourcery.com>\n\n\tlibgomp/\n\t* config/linux/mips/futex.h (sys_futex0): Change to static\n\tfunction with noinline, nomips16 attributes under MIPS16. Adjust\n\tasm statement to place 'li v0,SYS_futex' immediately before\n\tsyscall insn.\n\nFrom-SVN: r190772", "tree": {"sha": "3bf1bc0c11aafa989fb02cec5db74b15242fbafc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3bf1bc0c11aafa989fb02cec5db74b15242fbafc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c24dbebb4414e38d43f6a4f3ed1963b7395fac11", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c24dbebb4414e38d43f6a4f3ed1963b7395fac11", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c24dbebb4414e38d43f6a4f3ed1963b7395fac11", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c24dbebb4414e38d43f6a4f3ed1963b7395fac11/comments", "author": {"login": "cltang", "id": 4055966, "node_id": "MDQ6VXNlcjQwNTU5NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/4055966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cltang", "html_url": "https://github.com/cltang", "followers_url": "https://api.github.com/users/cltang/followers", "following_url": "https://api.github.com/users/cltang/following{/other_user}", "gists_url": "https://api.github.com/users/cltang/gists{/gist_id}", "starred_url": "https://api.github.com/users/cltang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cltang/subscriptions", "organizations_url": "https://api.github.com/users/cltang/orgs", "repos_url": "https://api.github.com/users/cltang/repos", "events_url": "https://api.github.com/users/cltang/events{/privacy}", "received_events_url": "https://api.github.com/users/cltang/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "27f36b78376bedb52ac917e036118bc2ce9a6d9e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/27f36b78376bedb52ac917e036118bc2ce9a6d9e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/27f36b78376bedb52ac917e036118bc2ce9a6d9e"}], "stats": {"total": 21, "additions": 17, "deletions": 4}, "files": [{"sha": "2f761d7177f9c3b20a555a38a78ec637d097e974", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c24dbebb4414e38d43f6a4f3ed1963b7395fac11/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c24dbebb4414e38d43f6a4f3ed1963b7395fac11/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=c24dbebb4414e38d43f6a4f3ed1963b7395fac11", "patch": "@@ -1,3 +1,10 @@\n+2012-08-29  Chung-Lin Tang  <cltang@codesourcery.com>\n+\n+\t* config/linux/mips/futex.h (sys_futex0): Change to static\n+\tfunction with noinline, nomips16 attributes under MIPS16. Adjust\n+\tasm statement to place 'li v0,SYS_futex' immediately before\n+\tsyscall insn.\n+\n 2012-07-04  Sandra Loosemore <sandra@codesourcery.com>\n \n \t* libgomp.texi (Library Index): Renamed from \"Index\" to prevent"}, {"sha": "83b0aefede745345217651c82bb9432926a543d9", "filename": "libgomp/config/linux/mips/futex.h", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c24dbebb4414e38d43f6a4f3ed1963b7395fac11/libgomp%2Fconfig%2Flinux%2Fmips%2Ffutex.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c24dbebb4414e38d43f6a4f3ed1963b7395fac11/libgomp%2Fconfig%2Flinux%2Fmips%2Ffutex.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fconfig%2Flinux%2Fmips%2Ffutex.h?ref=c24dbebb4414e38d43f6a4f3ed1963b7395fac11", "patch": "@@ -28,20 +28,26 @@\n #define FUTEX_WAIT 0\n #define FUTEX_WAKE 1\n \n+#ifdef __mips16\n+static void __attribute__((noinline,nomips16))\n+#else\n static inline void\n+#endif\n sys_futex0 (int *addr, int op, int val)\n {\n-  register unsigned long __v0 asm(\"$2\") = (unsigned long) SYS_futex;\n+  register unsigned long __v0 asm(\"$2\");\n   register unsigned long __a0 asm(\"$4\") = (unsigned long) addr;\n   register unsigned long __a1 asm(\"$5\") = (unsigned long) op;\n   register unsigned long __a2 asm(\"$6\") = (unsigned long) val;\n   register unsigned long __a3 asm(\"$7\") = 0;\n \n-  __asm volatile (\"syscall\"\n+  __asm volatile (\"li $2, %6\\n\\t\"\n+\t\t  \"syscall\"\n \t\t  /* returns $a3 (errno), $v0 (return value) */\n \t\t  : \"=r\" (__v0), \"=r\" (__a3)\n-\t\t  /* arguments in v0 (syscall) a0-a3 */\n-\t\t  : \"r\" (__v0), \"r\" (__a0), \"r\" (__a1), \"r\" (__a2), \"r\" (__a3)\n+\t\t  /* arguments in a0-a3, and syscall number */\n+\t\t  : \"r\" (__a0), \"r\" (__a1), \"r\" (__a2), \"r\" (__a3),\n+                    \"IK\" (SYS_futex)\n \t\t  /* clobbers at, v1, t0-t9, memory */\n \t\t  : \"$1\", \"$3\", \"$8\", \"$9\", \"$10\", \"$11\", \"$12\", \"$13\", \"$14\",\n \t\t    \"$15\", \"$24\", \"$25\", \"memory\");"}]}