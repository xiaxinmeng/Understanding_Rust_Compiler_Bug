{"sha": "8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGUzNjMzMmNmNjViNGVjNWExZWE2YjRiM2E2YWU4Y2I2ZWQ5ZjQ1NQ==", "commit": {"author": {"name": "Cesar Philippidis", "email": "cesar@codesourcery.com", "date": "2018-09-12T15:21:19Z"}, "committer": {"name": "Julian Brown", "email": "jules@gcc.gnu.org", "date": "2018-09-12T15:21:19Z"}, "message": "[OpenACC] C++ reference mapping\n\n2018-09-09  Cesar Philippidis  <cesar@codesourcery.com>\n\t    Julian Brown  <julian@codesourcery.com>\n\n\tPR middle-end/86336\n\n\tgcc/cp/\n\t* semantics.c (finish_omp_clauses): Treat C++ references the same in\n\tOpenACC as OpenMP.\n\n\tgcc/\n\t* gimplify.c (gimplify_scan_omp_clauses): Set\n\ttarget_firstprivatize_array_bases in OpenACC parallel and kernels\n\tregion contexts.  Remove GOMP_MAP_FIRSTPRIVATE_REFERENCE clauses from\n\tOpenACC data regions.\n\n\tlibgomp/\n\t* testsuite/libgomp.oacc-c++/non-scalar-data.C: Remove XFAIL.\n\nCo-Authored-By: Julian Brown <julian@codesourcery.com>\n\nFrom-SVN: r264244", "tree": {"sha": "21b85dccb3c797eff6332dff0040809c140e8351", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/21b85dccb3c797eff6332dff0040809c140e8351"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455/comments", "author": {"login": "cesarjp", "id": 4576177, "node_id": "MDQ6VXNlcjQ1NzYxNzc=", "avatar_url": "https://avatars.githubusercontent.com/u/4576177?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cesarjp", "html_url": "https://github.com/cesarjp", "followers_url": "https://api.github.com/users/cesarjp/followers", "following_url": "https://api.github.com/users/cesarjp/following{/other_user}", "gists_url": "https://api.github.com/users/cesarjp/gists{/gist_id}", "starred_url": "https://api.github.com/users/cesarjp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cesarjp/subscriptions", "organizations_url": "https://api.github.com/users/cesarjp/orgs", "repos_url": "https://api.github.com/users/cesarjp/repos", "events_url": "https://api.github.com/users/cesarjp/events{/privacy}", "received_events_url": "https://api.github.com/users/cesarjp/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c749305900f8afab04948702e637579b2db2199a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c749305900f8afab04948702e637579b2db2199a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c749305900f8afab04948702e637579b2db2199a"}], "stats": {"total": 32, "additions": 28, "deletions": 4}, "files": [{"sha": "06911461a1253a7b0520d97ef2bfbc68dd69f492", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455", "patch": "@@ -1,3 +1,12 @@\n+2018-09-09  Cesar Philippidis  <cesar@codesourcery.com>\n+            Julian Brown  <julian@codesourcery.com>\n+\n+\tPR middle-end/86336\n+\t* gimplify.c (gimplify_scan_omp_clauses): Set\n+\ttarget_firstprivatize_array_bases in OpenACC parallel and kernels\n+\tregion contexts.  Remove GOMP_MAP_FIRSTPRIVATE_REFERENCE clauses from\n+\tOpenACC data regions.\n+\n 2018-09-12  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* config/i386/i386.md (sqrt_extend<mode>xf3_i387): Remove."}, {"sha": "e4d635dc47d8f3c8cfa5ac929eaf9bbcf7272a13", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455", "patch": "@@ -1,3 +1,10 @@\n+2018-09-09  Cesar Philippidis  <cesar@codesourcery.com>\n+            Julian Brown  <julian@codesourcery.com>\n+\n+\tPR middle-end/86336\n+\t* semantics.c (finish_omp_clauses): Treat C++ references the same in\n+\tOpenACC as OpenMP.\n+\n 2018-08-28  Martin Liska  <mliska@suse.cz>\n \n \t* constexpr.c (cxx_eval_call_expression): Add quotes"}, {"sha": "bf3c63a09a1fbe98723d567174519ea53d9bd074", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455", "patch": "@@ -6878,7 +6878,7 @@ finish_omp_clauses (tree clauses, enum c_omp_region_type ort)\n \thandle_map_references:\n \t  if (!remove\n \t      && !processing_template_decl\n-\t      && (ort & C_ORT_OMP_DECLARE_SIMD) == C_ORT_OMP\n+\t      && ort != C_ORT_DECLARE_SIMD\n \t      && TYPE_REF_P (TREE_TYPE (OMP_CLAUSE_DECL (c))))\n \t    {\n \t      t = OMP_CLAUSE_DECL (c);"}, {"sha": "f0eb04a751ccc64ebeb5ba695ebf31f7b5758cec", "filename": "gcc/gimplify.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455/gcc%2Fgimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455/gcc%2Fgimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimplify.c?ref=8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455", "patch": "@@ -7513,6 +7513,8 @@ gimplify_scan_omp_clauses (tree *list_p, gimple_seq *pre_p,\n       case OMP_TARGET_EXIT_DATA:\n       case OACC_DECLARE:\n       case OACC_HOST_DATA:\n+      case OACC_PARALLEL:\n+      case OACC_KERNELS:\n \tctx->target_firstprivatize_array_bases = true;\n       default:\n \tbreak;\n@@ -8556,7 +8558,8 @@ gimplify_scan_omp_clauses (tree *list_p, gimple_seq *pre_p,\n \n       if (code == OACC_DATA\n \t  && OMP_CLAUSE_CODE (c) == OMP_CLAUSE_MAP\n-\t  && OMP_CLAUSE_MAP_KIND (c) == GOMP_MAP_FIRSTPRIVATE_POINTER)\n+\t  && (OMP_CLAUSE_MAP_KIND (c) == GOMP_MAP_FIRSTPRIVATE_POINTER\n+\t      || OMP_CLAUSE_MAP_KIND (c) == GOMP_MAP_FIRSTPRIVATE_REFERENCE))\n \tremove = true;\n       if (remove)\n \t*list_p = OMP_CLAUSE_CHAIN (c);"}, {"sha": "219a75217ed8c67a02d2154194b403a8da9d1c5d", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455", "patch": "@@ -1,3 +1,9 @@\n+2018-09-09  Cesar Philippidis  <cesar@codesourcery.com>\n+            Julian Brown  <julian@codesourcery.com>\n+\n+\tPR middle-end/86336\n+\t* testsuite/libgomp.oacc-c++/non-scalar-data.C: Remove XFAIL.\n+\n 2018-08-21  Nicolas Koenig  <koenigni@gcc.gnu.org>\n \tThomas Koenig <tkoenig@gcc.gnu.org>\n "}, {"sha": "e5f8707c24911fa9b48a6ba1dfd86bc50f81b561", "filename": "libgomp/testsuite/libgomp.oacc-c++/non-scalar-data.C", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455/libgomp%2Ftestsuite%2Flibgomp.oacc-c%2B%2B%2Fnon-scalar-data.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455/libgomp%2Ftestsuite%2Flibgomp.oacc-c%2B%2B%2Fnon-scalar-data.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c%2B%2B%2Fnon-scalar-data.C?ref=8e36332cf65b4ec5a1ea6b4b3a6ae8cb6ed9f455", "patch": "@@ -1,8 +1,7 @@\n // Ensure that a non-scalar dummy arguments which are implicitly used inside\n // offloaded regions are properly mapped using present_or_copy semantics.\n \n-// { dg-xfail-if \"TODO\" { *-*-* } }\n-// { dg-excess-errors \"ICE\" }\n+// { dg-do run }\n \n #include <cassert>\n "}]}