{"sha": "ca8f4e8af148694ae2fd444a0cdcf713910d23fd", "node_id": "C_kwDOANBUbNoAKGNhOGY0ZThhZjE0ODY5NGFlMmZkNDQ0YTBjZGNmNzEzOTEwZDIzZmQ", "commit": {"author": {"name": "konglin1", "email": "lingling.kong@intel.com", "date": "2022-09-01T06:40:42Z"}, "committer": {"name": "konglin1", "email": "lingling.kong@intel.com", "date": "2022-09-01T06:40:48Z"}, "message": "middle-end: Add MULT_EXPR recognition for cond scalar reduction\n\ngcc/ChangeLog:\n\n\t* tree-if-conv.cc (is_cond_scalar_reduction): Add MULT_EXPR\n\trecognition.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.dg/tree-ssa/gen-vect-34.c: New test.\n\t* gcc.dg/vect/vect-ifcvt-18.c: New test.", "tree": {"sha": "c180e113f9efd219391861d2c2ad517ad17c248c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c180e113f9efd219391861d2c2ad517ad17c248c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ca8f4e8af148694ae2fd444a0cdcf713910d23fd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca8f4e8af148694ae2fd444a0cdcf713910d23fd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ca8f4e8af148694ae2fd444a0cdcf713910d23fd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca8f4e8af148694ae2fd444a0cdcf713910d23fd/comments", "author": {"login": "konglingling7", "id": 86399175, "node_id": "MDQ6VXNlcjg2Mzk5MTc1", "avatar_url": "https://avatars.githubusercontent.com/u/86399175?v=4", "gravatar_id": "", "url": "https://api.github.com/users/konglingling7", "html_url": "https://github.com/konglingling7", "followers_url": "https://api.github.com/users/konglingling7/followers", "following_url": "https://api.github.com/users/konglingling7/following{/other_user}", "gists_url": "https://api.github.com/users/konglingling7/gists{/gist_id}", "starred_url": "https://api.github.com/users/konglingling7/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/konglingling7/subscriptions", "organizations_url": "https://api.github.com/users/konglingling7/orgs", "repos_url": "https://api.github.com/users/konglingling7/repos", "events_url": "https://api.github.com/users/konglingling7/events{/privacy}", "received_events_url": "https://api.github.com/users/konglingling7/received_events", "type": "User", "site_admin": false}, "committer": {"login": "konglingling7", "id": 86399175, "node_id": "MDQ6VXNlcjg2Mzk5MTc1", "avatar_url": "https://avatars.githubusercontent.com/u/86399175?v=4", "gravatar_id": "", "url": "https://api.github.com/users/konglingling7", "html_url": "https://github.com/konglingling7", "followers_url": "https://api.github.com/users/konglingling7/followers", "following_url": "https://api.github.com/users/konglingling7/following{/other_user}", "gists_url": "https://api.github.com/users/konglingling7/gists{/gist_id}", "starred_url": "https://api.github.com/users/konglingling7/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/konglingling7/subscriptions", "organizations_url": "https://api.github.com/users/konglingling7/orgs", "repos_url": "https://api.github.com/users/konglingling7/repos", "events_url": "https://api.github.com/users/konglingling7/events{/privacy}", "received_events_url": "https://api.github.com/users/konglingling7/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "023c5b36e476976cb3b45ff32c7c64990c5a6d45", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/023c5b36e476976cb3b45ff32c7c64990c5a6d45", "html_url": "https://github.com/Rust-GCC/gccrs/commit/023c5b36e476976cb3b45ff32c7c64990c5a6d45"}], "stats": {"total": 55, "additions": 55, "deletions": 0}, "files": [{"sha": "8d2d36401fe8a0257ec1c3154dc8110dd91b7ba0", "filename": "gcc/testsuite/gcc.dg/tree-ssa/gen-vect-34.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca8f4e8af148694ae2fd444a0cdcf713910d23fd/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fgen-vect-34.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca8f4e8af148694ae2fd444a0cdcf713910d23fd/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fgen-vect-34.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fgen-vect-34.c?ref=ca8f4e8af148694ae2fd444a0cdcf713910d23fd", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-Ofast -fdump-tree-vect-details\" } */\n+/* { dg-additional-options \"-mavx2\" { target { x86_64-*-* i?86-*-* } } } */\n+\n+float summul(int n, float *arg1, float *arg2)\n+{                                                  \n+    int i;                                             \n+    float res1 = 1.0;\n+    for(i = 0; i < n; i++) {\n+      if(arg2[i]) \n+        res1 *= arg1[i];\n+    }                                                  \n+    return res1;                                       \n+}\n+\n+/* { dg-final { scan-tree-dump-times \"vectorized 1 loops\" 1 \"vect\" { target { ! { avr-*-* pru-*-* } } } } } */"}, {"sha": "c1d3c27d819335ad0882e5af8005667e6ed2a531", "filename": "gcc/testsuite/gcc.dg/vect/vect-ifcvt-18.c", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca8f4e8af148694ae2fd444a0cdcf713910d23fd/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-ifcvt-18.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca8f4e8af148694ae2fd444a0cdcf713910d23fd/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-ifcvt-18.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-ifcvt-18.c?ref=ca8f4e8af148694ae2fd444a0cdcf713910d23fd", "patch": "@@ -0,0 +1,38 @@\n+/* { dg-require-effective-target vect_condition } */\n+/* { dg-require-effective-target vect_float } */\n+/* { dg-additional-options \"-Ofast -mavx\" { target avx_runtime } } */\n+\n+\n+int A0[4] = {36,39,42,45};\n+int B0[4] = {42,42,0,42};\n+float A1[8] = {36,39,42,45,43,32,21,12};\n+float B1[8] = {42,42,0,42,42,42,0,42};\n+double A2[16] = {36,39,42,45,43,32,21,12,23,34,45,56,42,78,89,11};\n+double B2[16] = {42,42,0,42,42,42,42,42,42,42,42,42,0,42,42,42};\n+\n+int main ()\n+{\n+  int i, j;\n+  int res0 = 1;\n+  float res1 = 1.0;\n+  double res2 = 1.0;\n+\n+  for (i = 0; i < 4; i++)\n+    if (B0[i])\n+      res0 *= A0[i];\n+\n+  for (i = 0; i < 8; i++)\n+    if (B1[i])\n+      res1 *= A1[i];\n+  \n+  for (i = 0; i < 16; i++)\n+    if (B2[i])\n+      res2 *= A2[i];\n+  /* check results:  */\n+  if (res0 != 63180 || res1 != 1043228160.000000\n+      ||res2 != 3296728515318523101184.000000)\n+      __builtin_abort ();\n+  return 0;\n+}\n+\n+/* { dg-final { scan-tree-dump \"vectorized 3 loops\" \"vect\" { target i?86-*-* x86_64-*-* } } } */"}, {"sha": "bac29fb557462f5d3193481ef180f1412e8bc639", "filename": "gcc/tree-if-conv.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca8f4e8af148694ae2fd444a0cdcf713910d23fd/gcc%2Ftree-if-conv.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca8f4e8af148694ae2fd444a0cdcf713910d23fd/gcc%2Ftree-if-conv.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-if-conv.cc?ref=ca8f4e8af148694ae2fd444a0cdcf713910d23fd", "patch": "@@ -1739,6 +1739,7 @@ is_cond_scalar_reduction (gimple *phi, gimple **reduc, tree arg_0, tree arg_1,\n \n   if (reduction_op != PLUS_EXPR\n       && reduction_op != MINUS_EXPR\n+      && reduction_op != MULT_EXPR\n       && reduction_op != BIT_IOR_EXPR\n       && reduction_op != BIT_XOR_EXPR\n       && reduction_op != BIT_AND_EXPR)"}]}