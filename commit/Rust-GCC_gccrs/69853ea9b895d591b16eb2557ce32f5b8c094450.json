{"sha": "69853ea9b895d591b16eb2557ce32f5b8c094450", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Njk4NTNlYTliODk1ZDU5MWIxNmViMjU1N2NlMzJmNWI4YzA5NDQ1MA==", "commit": {"author": {"name": "Oleg Endo", "email": "olegendo@gcc.gnu.org", "date": "2012-08-12T22:50:51Z"}, "committer": {"name": "Oleg Endo", "email": "olegendo@gcc.gnu.org", "date": "2012-08-12T22:50:51Z"}, "message": "sh.md (prefetch): Simplify expander.\n\n\t* config/sh/sh.md (prefetch): Simplify expander.  Fix condition to\n\tallow SH3.\n\t(*prefetch_media): Move insn below expander.\n\t(*prefetch): Fix condition to allow SH3.\n\n\t* gcc.target/sh/prefetch.c: Add -m3* to inclusion list.\n\nFrom-SVN: r190332", "tree": {"sha": "89b9ba0c6ac377ff665c13ddef54ea9c9726ade2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/89b9ba0c6ac377ff665c13ddef54ea9c9726ade2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/69853ea9b895d591b16eb2557ce32f5b8c094450", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/69853ea9b895d591b16eb2557ce32f5b8c094450", "html_url": "https://github.com/Rust-GCC/gccrs/commit/69853ea9b895d591b16eb2557ce32f5b8c094450", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/69853ea9b895d591b16eb2557ce32f5b8c094450/comments", "author": null, "committer": null, "parents": [{"sha": "eb11dba2b47beb01a873eb234ed98e30049e0bbf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eb11dba2b47beb01a873eb234ed98e30049e0bbf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eb11dba2b47beb01a873eb234ed98e30049e0bbf"}], "stats": {"total": 57, "additions": 30, "deletions": 27}, "files": [{"sha": "35390e4dba6333adcf63789fcaa2b77b16c81415", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/69853ea9b895d591b16eb2557ce32f5b8c094450/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/69853ea9b895d591b16eb2557ce32f5b8c094450/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=69853ea9b895d591b16eb2557ce32f5b8c094450", "patch": "@@ -1,3 +1,10 @@\n+2012-08-12  Oleg Endo  <olegendo@gcc.gnu.org>\n+\n+\t* config/sh/sh.md (prefetch): Simplify expander.  Fix condition to\n+\tallow SH3.\n+\t(*prefetch_media): Move insn below expander.\n+\t(*prefetch): Fix condition to allow SH3.\n+\n 2012-08-12  Oleg Endo  <olegendo@gcc.gnu.org>\n \n \tPR target/51244"}, {"sha": "aee416e5fb4a0153ca683ee21aa2be2eed791869", "filename": "gcc/config/sh/sh.md", "status": "modified", "additions": 18, "deletions": 26, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/69853ea9b895d591b16eb2557ce32f5b8c094450/gcc%2Fconfig%2Fsh%2Fsh.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/69853ea9b895d591b16eb2557ce32f5b8c094450/gcc%2Fconfig%2Fsh%2Fsh.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsh%2Fsh.md?ref=69853ea9b895d591b16eb2557ce32f5b8c094450", "patch": "@@ -13868,44 +13868,36 @@ label:\n   \"byterev\t%1, %0\"\n   [(set_attr \"type\" \"arith_media\")])\n \n-(define_insn \"*prefetch_media\"\n-  [(prefetch (match_operand:QI 0 \"address_operand\" \"p\")\n-             (match_operand:SI 1 \"const_int_operand\" \"n\")\n-             (match_operand:SI 2 \"const_int_operand\" \"n\"))]\n-  \"TARGET_SHMEDIA\"\n-{\n-  operands[0] = gen_rtx_MEM (QImode, operands[0]);\n-  output_asm_insn (\"ld%M0.b    %m0,r63\", operands);\n-  return \"\";\n-}\n-  [(set_attr \"type\" \"other\")])\n-\n ;; In user mode, the \"pref\" instruction will raise a RADDERR exception\n ;; for accesses to [0x80000000,0xffffffff].  This makes it an unsuitable\n ;; implementation of __builtin_prefetch for VxWorks RTPs.\n (define_expand \"prefetch\"\n-  [(prefetch (match_operand 0 \"address_operand\" \"p\")\n-             (match_operand:SI 1 \"const_int_operand\" \"n\")\n-             (match_operand:SI 2 \"const_int_operand\" \"n\"))]\n-  \"TARGET_SH2A || ((TARGET_HARD_SH4 || TARGET_SH5)\n-   && (TARGET_SHMEDIA || !TARGET_VXWORKS_RTP))\"\n-{\n-  if (GET_MODE (operands[0]) != Pmode\n-      || !CONST_INT_P (operands[1])\n-      || !CONST_INT_P (operands[2]))\n-    FAIL;\n-  if (! TARGET_SHMEDIA)\n-    operands[0] = force_reg (Pmode, operands[0]);\n-})\n+  [(prefetch (match_operand 0 \"address_operand\" \"\")\n+             (match_operand:SI 1 \"const_int_operand\" \"\")\n+             (match_operand:SI 2 \"const_int_operand\" \"\"))]\n+  \"(TARGET_SH2A || TARGET_SH3 || TARGET_SH5)\n+   && (TARGET_SHMEDIA || ! TARGET_VXWORKS_RTP)\")\n \n (define_insn \"*prefetch\"\n   [(prefetch (match_operand:SI 0 \"register_operand\" \"r\")\n \t     (match_operand:SI 1 \"const_int_operand\" \"n\")\n \t     (match_operand:SI 2 \"const_int_operand\" \"n\"))]\n-  \"(TARGET_SH2A || TARGET_HARD_SH4 || TARGET_SHCOMPACT) && !TARGET_VXWORKS_RTP\"\n+  \"(TARGET_SH2A || TARGET_SH3 || TARGET_SHCOMPACT) && ! TARGET_VXWORKS_RTP\"\n   \"pref\t@%0\"\n   [(set_attr \"type\" \"other\")])\n \n+(define_insn \"*prefetch_media\"\n+  [(prefetch (match_operand:QI 0 \"address_operand\" \"p\")\n+             (match_operand:SI 1 \"const_int_operand\" \"n\")\n+             (match_operand:SI 2 \"const_int_operand\" \"n\"))]\n+  \"TARGET_SHMEDIA\"\n+{\n+  operands[0] = gen_rtx_MEM (QImode, operands[0]);\n+  output_asm_insn (\"ld%M0.b    %m0,r63\", operands);\n+  return \"\";\n+}\n+  [(set_attr \"type\" \"other\")])\n+\n (define_insn \"alloco_i\"\n   [(set (mem:BLK (match_operand:QI 0 \"cache_address_operand\" \"p\"))\n \t(unspec:BLK [(const_int 0)] UNSPEC_ALLOCO))]"}, {"sha": "a9df8b75264a81058ce385db545b8b91da1d8f8f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/69853ea9b895d591b16eb2557ce32f5b8c094450/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/69853ea9b895d591b16eb2557ce32f5b8c094450/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=69853ea9b895d591b16eb2557ce32f5b8c094450", "patch": "@@ -1,3 +1,7 @@\n+2012-08-12  Oleg Endo  <olegendo@gcc.gnu.org>\n+\n+\t* gcc.target/sh/prefetch.c: Add -m3* to inclusion list.\n+\n 2012-08-12  Oleg Endo  <olegendo@gcc.gnu.org>\n \n \tPR target/51244"}, {"sha": "e0873737453e5cfbe7815b84b284a64838d6a356", "filename": "gcc/testsuite/gcc.target/sh/prefetch.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/69853ea9b895d591b16eb2557ce32f5b8c094450/gcc%2Ftestsuite%2Fgcc.target%2Fsh%2Fprefetch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/69853ea9b895d591b16eb2557ce32f5b8c094450/gcc%2Ftestsuite%2Fgcc.target%2Fsh%2Fprefetch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fsh%2Fprefetch.c?ref=69853ea9b895d591b16eb2557ce32f5b8c094450", "patch": "@@ -2,7 +2,7 @@\n    instruction PREF @Rm.  */\n /* { dg-do assemble {target sh*-*-*}}  */\n /* { dg-options \"-O0\" }  */\n-/* { dg-skip-if \"\" { \"sh*-*-*\" } { \"*\" } { \"-m2a*\" \"-m4*\" } }  */\n+/* { dg-skip-if \"\" { \"sh*-*-*\" } { \"*\" } { \"-m2a*\" \"-m3*\" \"-m4*\" } }  */\n /* { dg-final { scan-assembler \"pref\"} }  */\n \n void"}]}