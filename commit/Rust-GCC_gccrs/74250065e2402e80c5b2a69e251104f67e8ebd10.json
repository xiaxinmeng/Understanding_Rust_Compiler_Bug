{"sha": "74250065e2402e80c5b2a69e251104f67e8ebd10", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzQyNTAwNjVlMjQwMmU4MGM1YjJhNjllMjUxMTA0ZjY3ZThlYmQxMA==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2012-01-14T12:04:20Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2012-01-14T12:04:20Z"}, "message": "re PR fortran/51816 (Wrong error when use..., only : operator() twice)\n\n2011-01-14  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/51816\n        * module.c (read_module): Don't make nonexisting\n        intrinsic operators as found.\n        (rename_list_remove_duplicate): New function.\n        (gfc_use_modules): Use it.\n\n2011-01-14  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/51816\n        * gfortran.dg/use_18.f90: New.\n        * gfortran.dg/use_19.f90: New.\n\nFrom-SVN: r183179", "tree": {"sha": "9ccede597adf8609120ac0afb6ca628c17d9e04f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9ccede597adf8609120ac0afb6ca628c17d9e04f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/74250065e2402e80c5b2a69e251104f67e8ebd10", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/74250065e2402e80c5b2a69e251104f67e8ebd10", "html_url": "https://github.com/Rust-GCC/gccrs/commit/74250065e2402e80c5b2a69e251104f67e8ebd10", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/74250065e2402e80c5b2a69e251104f67e8ebd10/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "12448f77a57be1954b4f15455b06de9012e88390", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/12448f77a57be1954b4f15455b06de9012e88390", "html_url": "https://github.com/Rust-GCC/gccrs/commit/12448f77a57be1954b4f15455b06de9012e88390"}], "stats": {"total": 106, "additions": 105, "deletions": 1}, "files": [{"sha": "95fa783da70d6a7481893fabb9b18fd09cd4a6ee", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/74250065e2402e80c5b2a69e251104f67e8ebd10/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/74250065e2402e80c5b2a69e251104f67e8ebd10/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=74250065e2402e80c5b2a69e251104f67e8ebd10", "patch": "@@ -1,3 +1,11 @@\n+2011-01-14  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/51816\n+\t* module.c (read_module): Don't make nonexisting\n+\tintrinsic operators as found.\n+\t(rename_list_remove_duplicate): New function.\n+\t(gfc_use_modules): Use it.\n+\n 2012-01-13  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/48351"}, {"sha": "0616a8591f139584db410e8290b2ec98408206a8", "filename": "gcc/fortran/module.c", "status": "modified", "additions": 29, "deletions": 1, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/74250065e2402e80c5b2a69e251104f67e8ebd10/gcc%2Ffortran%2Fmodule.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/74250065e2402e80c5b2a69e251104f67e8ebd10/gcc%2Ffortran%2Fmodule.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmodule.c?ref=74250065e2402e80c5b2a69e251104f67e8ebd10", "patch": "@@ -4465,7 +4465,7 @@ read_module (void)\n   int i;\n   int ambiguous, j, nuse, symbol;\n   pointer_info *info, *q;\n-  gfc_use_rename *u;\n+  gfc_use_rename *u = NULL;\n   gfc_symtree *st;\n   gfc_symbol *sym;\n \n@@ -4678,6 +4678,8 @@ read_module (void)\n \t}\n \n       mio_interface (&gfc_current_ns->op[i]);\n+      if (u && !gfc_current_ns->op[i])\n+\tu->found = 0;\n     }\n \n   mio_rparen ();\n@@ -6093,6 +6095,31 @@ gfc_use_module (gfc_use_list *module)\n }\n \n \n+/* Remove duplicated intrinsic operators from the rename list. */\n+\n+static void\n+rename_list_remove_duplicate (gfc_use_rename *list)\n+{\n+  gfc_use_rename *seek, *last;\n+\n+  for (; list; list = list->next)\n+    if (list->op != INTRINSIC_USER && list->op != INTRINSIC_NONE)\n+      {\n+\tlast = list;\n+\tfor (seek = list->next; seek; seek = last->next)\n+\t  {\n+\t    if (list->op == seek->op)\n+\t      {\n+\t\tlast->next = seek->next;\n+\t\tfree (seek);\n+\t      }\n+\t    else\n+\t      last = seek;\n+\t  }\n+      }\n+}\n+\n+\n /* Process all USE directives.  */\n \n void\n@@ -6171,6 +6198,7 @@ gfc_use_modules (void)\n   for (; module_list; module_list = next)\n     {\n       next = module_list->next;\n+      rename_list_remove_duplicate (module_list->rename);\n       gfc_use_module (module_list);\n       if (module_list->intrinsic)\n \tfree_rename (module_list->rename);"}, {"sha": "9b36590a17a9774a4518a55ac5f079980ae226de", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/74250065e2402e80c5b2a69e251104f67e8ebd10/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/74250065e2402e80c5b2a69e251104f67e8ebd10/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=74250065e2402e80c5b2a69e251104f67e8ebd10", "patch": "@@ -1,3 +1,9 @@\n+2011-01-14  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/51816\n+\t* gfortran.dg/use_18.f90: New.\n+\t* gfortran.dg/use_19.f90: New.\n+\n 2012-01-13  Ian Lance Taylor  <iant@google.com>\n \n \tPR c++/50012"}, {"sha": "a46cdc407444790349a254ec90c5edad3bf1db5b", "filename": "gcc/testsuite/gfortran.dg/use_18.f90", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/74250065e2402e80c5b2a69e251104f67e8ebd10/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_18.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/74250065e2402e80c5b2a69e251104f67e8ebd10/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_18.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_18.f90?ref=74250065e2402e80c5b2a69e251104f67e8ebd10", "patch": "@@ -0,0 +1,51 @@\n+! { dg-do compile }\n+!\n+! PR fortran/51816\n+!\n+! Contributed by Harald Anlauf \n+!\n+module foo\n+  implicit none\n+  type t\n+     integer :: i\n+  end type t\n+  interface operator (*)\n+     module procedure mult\n+  end interface\n+contains\n+  function mult (i, j)\n+    type(t), intent(in) :: i, j\n+    integer             :: mult\n+    mult = i%i * j%i\n+  end function mult\n+end module foo\n+\n+module bar\n+  implicit none\n+  type t2\n+     integer :: i\n+  end type t2\n+  interface operator (>)\n+     module procedure gt\n+  end interface\n+contains\n+  function gt (i, j)\n+    type(t2), intent(in) :: i, j\n+    logical             :: gt\n+    gt = i%i > j%i\n+  end function gt\n+end module bar\n+\n+use bar, only : t2, operator(>) , operator(>)\n+use foo, only : t\n+use foo, only : operator (*)\n+use foo, only : t\n+use foo, only : operator (*)\n+implicit none\n+type(t) :: i = t(1), j = t(2)\n+type(t2) :: k = t2(1), l = t2(2)\n+print *, i*j\n+print *, k > l\n+end\n+\n+! { dg-final { cleanup-modules \"foo bar\" } }"}, {"sha": "5ddc5d153b2cdd8a25d868687b10f65c41f52459", "filename": "gcc/testsuite/gfortran.dg/use_19.f90", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/74250065e2402e80c5b2a69e251104f67e8ebd10/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_19.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/74250065e2402e80c5b2a69e251104f67e8ebd10/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_19.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_19.f90?ref=74250065e2402e80c5b2a69e251104f67e8ebd10", "patch": "@@ -0,0 +1,11 @@\n+! { dg-do compile }\n+!\n+! PR fortran/51816\n+!\n+module m\n+end module m\n+\n+use m, only: operator(/) ! { dg-error \"Intrinsic operator '/' referenced at .1. not found in module 'm'\" }\n+end\n+\n+! { dg-final { cleanup-modules \"m\" } }"}]}