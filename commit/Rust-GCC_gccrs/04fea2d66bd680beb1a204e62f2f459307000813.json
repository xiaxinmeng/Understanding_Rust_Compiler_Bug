{"sha": "04fea2d66bd680beb1a204e62f2f459307000813", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDRmZWEyZDY2YmQ2ODBiZWIxYTIwNGU2MmYyZjQ1OTMwNzAwMDgxMw==", "commit": {"author": {"name": "Iain Buclaw", "email": "ibuclaw@gdcproject.org", "date": "2021-06-09T17:37:22Z"}, "committer": {"name": "Iain Buclaw", "email": "ibuclaw@gdcproject.org", "date": "2021-06-09T17:41:30Z"}, "message": "d: Respect explicit align(N) type alignment (PR100935)\n\nIt was previously the natural type alignment, defined as the maximum of\nthe field alignments for an aggregate.  Make sure an explicit align(N)\noverrides it.\n\nReviewed-on: https://github.com/dlang/dmd/pull/12646\n\ngcc/d/ChangeLog:\n\n\tPR d/100935\n\t* dmd/MERGE: Merge upstream dmd f3fdeb578.", "tree": {"sha": "4aa3b45f43efc1405f47815b5a4994a453be5aa7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4aa3b45f43efc1405f47815b5a4994a453be5aa7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/04fea2d66bd680beb1a204e62f2f459307000813", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04fea2d66bd680beb1a204e62f2f459307000813", "html_url": "https://github.com/Rust-GCC/gccrs/commit/04fea2d66bd680beb1a204e62f2f459307000813", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04fea2d66bd680beb1a204e62f2f459307000813/comments", "author": {"login": "ibuclaw", "id": 397929, "node_id": "MDQ6VXNlcjM5NzkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibuclaw", "html_url": "https://github.com/ibuclaw", "followers_url": "https://api.github.com/users/ibuclaw/followers", "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}", "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions", "organizations_url": "https://api.github.com/users/ibuclaw/orgs", "repos_url": "https://api.github.com/users/ibuclaw/repos", "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}", "received_events_url": "https://api.github.com/users/ibuclaw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ibuclaw", "id": 397929, "node_id": "MDQ6VXNlcjM5NzkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibuclaw", "html_url": "https://github.com/ibuclaw", "followers_url": "https://api.github.com/users/ibuclaw/followers", "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}", "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions", "organizations_url": "https://api.github.com/users/ibuclaw/orgs", "repos_url": "https://api.github.com/users/ibuclaw/repos", "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}", "received_events_url": "https://api.github.com/users/ibuclaw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c8d581bdf731714977b1592e74d05e000535e338", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8d581bdf731714977b1592e74d05e000535e338", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c8d581bdf731714977b1592e74d05e000535e338"}], "stats": {"total": 27, "additions": 25, "deletions": 2}, "files": [{"sha": "e22e3d1ebf77813cefa671879aaa6415ef517898", "filename": "gcc/d/dmd/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04fea2d66bd680beb1a204e62f2f459307000813/gcc%2Fd%2Fdmd%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04fea2d66bd680beb1a204e62f2f459307000813/gcc%2Fd%2Fdmd%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fd%2Fdmd%2FMERGE?ref=04fea2d66bd680beb1a204e62f2f459307000813", "patch": "@@ -1,4 +1,4 @@\n-b7d146c4c34469f876a63f26ff19091a7f9d54d7\n+f3fdeb578f8cc6d9426d47d2fa144d2078f9ab29\n \n The first line of this file holds the git revision number of the last\n merge done from the dlang/dmd repository."}, {"sha": "6cccf40df986ba519e38529b828b7dd0723bd9e8", "filename": "gcc/d/dmd/mtype.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04fea2d66bd680beb1a204e62f2f459307000813/gcc%2Fd%2Fdmd%2Fmtype.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04fea2d66bd680beb1a204e62f2f459307000813/gcc%2Fd%2Fdmd%2Fmtype.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fd%2Fdmd%2Fmtype.c?ref=04fea2d66bd680beb1a204e62f2f459307000813", "patch": "@@ -2040,7 +2040,10 @@ Expression *Type::getProperty(Loc loc, Identifier *ident, int flag)\n     }\n     else if (ident == Id::__xalignof)\n     {\n-        e = new IntegerExp(loc, alignsize(), Type::tsize_t);\n+        unsigned explicitAlignment = alignment();\n+        unsigned naturalAlignment = alignsize();\n+        unsigned actualAlignment = (explicitAlignment == STRUCTALIGN_DEFAULT ? naturalAlignment : explicitAlignment);\n+        e = new IntegerExp(loc, actualAlignment, Type::tsize_t);\n     }\n     else if (ident == Id::_init)\n     {"}, {"sha": "0c727e2fec560a81ee1d63b857f4c86a076e765a", "filename": "gcc/testsuite/gdc.test/compilable/aggr_alignment.d", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04fea2d66bd680beb1a204e62f2f459307000813/gcc%2Ftestsuite%2Fgdc.test%2Fcompilable%2Faggr_alignment.d", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04fea2d66bd680beb1a204e62f2f459307000813/gcc%2Ftestsuite%2Fgdc.test%2Fcompilable%2Faggr_alignment.d", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgdc.test%2Fcompilable%2Faggr_alignment.d?ref=04fea2d66bd680beb1a204e62f2f459307000813", "patch": "@@ -27,6 +27,26 @@ static assert(C2.int1.offsetof == payloadOffset + 8);\n static assert(C2.alignof == size_t.sizeof);\n static assert(__traits(classInstanceSize, C2) == payloadOffset + 12);\n \n+align(8) struct PaddedStruct\n+{\n+    bool flag;\n+    align(2) S1 s1;\n+}\n+\n+static assert(PaddedStruct.s1.offsetof == 2);\n+static assert(PaddedStruct.alignof == 8);\n+static assert(PaddedStruct.sizeof == 16);\n+\n+align(1) struct UglyStruct\n+{\n+    bool flag;\n+    int i;\n+    ubyte u;\n+}\n+\n+static assert(UglyStruct.i.offsetof == 4);\n+static assert(UglyStruct.alignof == 1);\n+static assert(UglyStruct.sizeof == 9);\n \n /***************************************************/\n // https://issues.dlang.org/show_bug.cgi?id=19914"}]}