{"sha": "a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTNiNzY0NWJmZmJhZjNkYWRmMWY5Y2ZjY2Q5M2M2ZmJhM2UwODM0ZA==", "commit": {"author": {"name": "Javier Miranda", "email": "miranda@adacore.com", "date": "2018-07-16T14:10:27Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-07-16T14:10:27Z"}, "message": "[Ada] Crash processing sources under GNATprove debug mode\n\nProcessing sources under -gnatd.F the frontend may crash on\nan iterator of the form 'for X of ...' over an array if the\niterator is located in an inlined subprogram.\n\n2018-07-16  Javier Miranda  <miranda@adacore.com>\n\ngcc/ada/\n\n\t* exp_ch5.adb (Expand_Iterator_Loop_Over_Array): Code cleanup. Required\n\tto avoid generating an ill-formed tree that confuses gnatprove causing\n\tit to blowup.\n\ngcc/testsuite/\n\n\t* gnat.dg/iter2.adb, gnat.dg/iter2.ads: New testcase.\n\nFrom-SVN: r262707", "tree": {"sha": "efe83c064e59079cd0bcf4b9b0fa565d139baf18", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/efe83c064e59079cd0bcf4b9b0fa565d139baf18"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d/comments", "author": {"login": "miranda-adacore", "id": 54413934, "node_id": "MDQ6VXNlcjU0NDEzOTM0", "avatar_url": "https://avatars.githubusercontent.com/u/54413934?v=4", "gravatar_id": "", "url": "https://api.github.com/users/miranda-adacore", "html_url": "https://github.com/miranda-adacore", "followers_url": "https://api.github.com/users/miranda-adacore/followers", "following_url": "https://api.github.com/users/miranda-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/miranda-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/miranda-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/miranda-adacore/subscriptions", "organizations_url": "https://api.github.com/users/miranda-adacore/orgs", "repos_url": "https://api.github.com/users/miranda-adacore/repos", "events_url": "https://api.github.com/users/miranda-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/miranda-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c4ea29786f9b6e63c47daddfb6bff5b690e5f555", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4ea29786f9b6e63c47daddfb6bff5b690e5f555", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c4ea29786f9b6e63c47daddfb6bff5b690e5f555"}], "stats": {"total": 54, "additions": 51, "deletions": 3}, "files": [{"sha": "bff06e6be436213eff682bb4689b9d6b729fe2f2", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d", "patch": "@@ -1,3 +1,9 @@\n+2018-07-16  Javier Miranda  <miranda@adacore.com>\n+\n+\t* exp_ch5.adb (Expand_Iterator_Loop_Over_Array): Code cleanup. Required\n+\tto avoid generating an ill-formed tree that confuses gnatprove causing\n+\tit to blowup.\n+\n 2018-07-16  Yannick Moy  <moy@adacore.com>\n \n \t* inline.adb (Has_Single_Return): Rewrap comment."}, {"sha": "7371ee33acb6648da6e24e192f3acb0993f103cd", "filename": "gcc/ada/exp_ch5.adb", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d/gcc%2Fada%2Fexp_ch5.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d/gcc%2Fada%2Fexp_ch5.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch5.adb?ref=a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d", "patch": "@@ -3711,9 +3711,14 @@ package body Exp_Ch5 is\n \n       Ind_Comp :=\n         Make_Indexed_Component (Loc,\n-          Prefix      => Relocate_Node (Array_Node),\n+          Prefix      => New_Copy_Tree (Array_Node),\n           Expressions => New_List (New_Occurrence_Of (Iterator, Loc)));\n \n+      --  Propagate the original node to the copy since the analysis of the\n+      --  following object renaming declaration relies on the original node.\n+\n+      Set_Original_Node (Prefix (Ind_Comp), Original_Node (Array_Node));\n+\n       Prepend_To (Stats,\n         Make_Object_Renaming_Declaration (Loc,\n           Defining_Identifier => Id,\n@@ -3755,7 +3760,7 @@ package body Exp_Ch5 is\n                   Defining_Identifier         => Iterator,\n                   Discrete_Subtype_Definition =>\n                     Make_Attribute_Reference (Loc,\n-                      Prefix         => Relocate_Node (Array_Node),\n+                      Prefix         => New_Copy_Tree (Array_Node),\n                       Attribute_Name => Name_Range,\n                       Expressions    => New_List (\n                         Make_Integer_Literal (Loc, Dim1))),\n@@ -3792,7 +3797,7 @@ package body Exp_Ch5 is\n                         Defining_Identifier         => Iterator,\n                         Discrete_Subtype_Definition =>\n                           Make_Attribute_Reference (Loc,\n-                            Prefix         => Relocate_Node (Array_Node),\n+                            Prefix         => New_Copy_Tree (Array_Node),\n                             Attribute_Name => Name_Range,\n                             Expressions    => New_List (\n                               Make_Integer_Literal (Loc, Dim1))),"}, {"sha": "f73096e0f30e8c4fb9192b980639d190a69457b4", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d", "patch": "@@ -1,3 +1,7 @@\n+2018-07-16  Javier Miranda  <miranda@adacore.com>\n+\n+\t* gnat.dg/iter2.adb, gnat.dg/iter2.ads: New testcase.\n+\n 2018-07-16  Richard Biener  <rguenther@suse.de>\n \n \tPR lto/86523"}, {"sha": "e5819a031b75c9652e10e7a12055780382bf8f78", "filename": "gcc/testsuite/gnat.dg/iter2.adb", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d/gcc%2Ftestsuite%2Fgnat.dg%2Fiter2.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d/gcc%2Ftestsuite%2Fgnat.dg%2Fiter2.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fiter2.adb?ref=a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d", "patch": "@@ -0,0 +1,28 @@\n+--  { dg-do compile }\n+--  { dg-options \"-gnatd.F -gnatws\" }\n+\n+package body Iter2\n+   with SPARK_Mode\n+is\n+   function To_String (Name : String) return String\n+   is\n+      procedure Append (Result : in out String;\n+                        Data   :        String)\n+        with Inline_Always;\n+      procedure Append (Result : in out String;\n+                        Data   :        String)\n+      is\n+      begin\n+         for C of Data\n+         loop\n+            Result (1) := C;\n+         end loop;\n+      end Append;\n+\n+      Result : String (1 .. 3);\n+   begin\n+      Append (Result, \"</\" & Name & \">\");\n+      return Result;\n+   end To_String;\n+\n+end Iter2;"}, {"sha": "2178630944aedaa9b7a9f0d6f855d6de5aae0776", "filename": "gcc/testsuite/gnat.dg/iter2.ads", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d/gcc%2Ftestsuite%2Fgnat.dg%2Fiter2.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d/gcc%2Ftestsuite%2Fgnat.dg%2Fiter2.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fiter2.ads?ref=a3b7645bffbaf3dadf1f9cfccd93c6fba3e0834d", "patch": "@@ -0,0 +1,5 @@\n+package Iter2\n+   with SPARK_Mode\n+is\n+   function To_String (Name : String) return String;\n+end Iter2;"}]}