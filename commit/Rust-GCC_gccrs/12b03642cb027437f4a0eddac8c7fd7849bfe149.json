{"sha": "12b03642cb027437f4a0eddac8c7fd7849bfe149", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTJiMDM2NDJjYjAyNzQzN2Y0YTBlZGRhYzhjN2ZkNzg0OWJmZTE0OQ==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2011-09-26T15:47:17Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2011-09-26T15:47:17Z"}, "message": "re PR c++/50523 (C++ FE apparently incorrectly rejects tramp3d)\n\n\tPR c++/50523\n\t* call.c (implicit_conversion): Mask out inappropriate LOOKUP\n\tflags at the top of the function.\n\nFrom-SVN: r179203", "tree": {"sha": "54fc5444301c0263f867679f45d2739c6aea979b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/54fc5444301c0263f867679f45d2739c6aea979b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/12b03642cb027437f4a0eddac8c7fd7849bfe149", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/12b03642cb027437f4a0eddac8c7fd7849bfe149", "html_url": "https://github.com/Rust-GCC/gccrs/commit/12b03642cb027437f4a0eddac8c7fd7849bfe149", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/12b03642cb027437f4a0eddac8c7fd7849bfe149/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "fcb7afc20f55efe8d8df8cb95cc546eed2df12ac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fcb7afc20f55efe8d8df8cb95cc546eed2df12ac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fcb7afc20f55efe8d8df8cb95cc546eed2df12ac"}], "stats": {"total": 32, "additions": 29, "deletions": 3}, "files": [{"sha": "865d76461e16bd620eb8c00af281c45a3fd1adea", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/12b03642cb027437f4a0eddac8c7fd7849bfe149/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/12b03642cb027437f4a0eddac8c7fd7849bfe149/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=12b03642cb027437f4a0eddac8c7fd7849bfe149", "patch": "@@ -1,5 +1,9 @@\n 2011-09-26  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/50523\n+\t* call.c (implicit_conversion): Mask out inappropriate LOOKUP\n+\tflags at the top of the function.\n+\n \t* pt.c (tsubst_copy) [PARM_DECL]: Handle 'this' in NSDMI.\n \n 2011-09-26  Paolo Carlini  <paolo.carlini@oracle.com>"}, {"sha": "579e563ea1c68ff188de0f1604f47fe16f2c0c8e", "filename": "gcc/cp/call.c", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/12b03642cb027437f4a0eddac8c7fd7849bfe149/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/12b03642cb027437f4a0eddac8c7fd7849bfe149/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=12b03642cb027437f4a0eddac8c7fd7849bfe149", "patch": "@@ -1660,6 +1660,12 @@ implicit_conversion (tree to, tree from, tree expr, bool c_cast_p,\n       || expr == error_mark_node)\n     return NULL;\n \n+  /* Other flags only apply to the primary function in overload\n+     resolution, or after we've chosen one.  */\n+  flags &= (LOOKUP_ONLYCONVERTING|LOOKUP_NO_CONVERSION|LOOKUP_COPY_PARM\n+\t    |LOOKUP_NO_TEMP_BIND|LOOKUP_NO_RVAL_BIND|LOOKUP_PREFER_RVALUE\n+\t    |LOOKUP_NO_NARROWING|LOOKUP_PROTECT);\n+\n   if (TREE_CODE (to) == REFERENCE_TYPE)\n     conv = reference_binding (to, from, expr, c_cast_p, flags);\n   else\n@@ -1716,15 +1722,13 @@ implicit_conversion (tree to, tree from, tree expr, bool c_cast_p,\n       && (flags & LOOKUP_NO_CONVERSION) == 0)\n     {\n       struct z_candidate *cand;\n-      int convflags = (flags & (LOOKUP_NO_TEMP_BIND|LOOKUP_ONLYCONVERTING\n-\t\t\t\t|LOOKUP_NO_NARROWING));\n \n       if (CLASS_TYPE_P (to)\n \t  && BRACE_ENCLOSED_INITIALIZER_P (expr)\n \t  && !CLASSTYPE_NON_AGGREGATE (complete_type (to)))\n \treturn build_aggr_conv (to, expr, flags);\n \n-      cand = build_user_type_conversion_1 (to, expr, convflags);\n+      cand = build_user_type_conversion_1 (to, expr, flags);\n       if (cand)\n \tconv = cand->second_conv;\n "}, {"sha": "500fbf577ee677e220c1cbec8c08d1d3e2169c6e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/12b03642cb027437f4a0eddac8c7fd7849bfe149/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/12b03642cb027437f4a0eddac8c7fd7849bfe149/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=12b03642cb027437f4a0eddac8c7fd7849bfe149", "patch": "@@ -1,5 +1,8 @@\n 2011-09-26  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/50523\n+\t* g++.dg/overload/ref-conv2.C: New.\n+\n \t* g++.dg/cpp0x/nsdmi-template1.C: New.\n \n 2011-09-26  Paolo Carlini  <paolo.carlini@oracle.com>"}, {"sha": "bb0ad39d6b1c292156488a7091511f5f4cf118dc", "filename": "gcc/testsuite/g++.dg/overload/ref-conv2.C", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/12b03642cb027437f4a0eddac8c7fd7849bfe149/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Foverload%2Fref-conv2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/12b03642cb027437f4a0eddac8c7fd7849bfe149/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Foverload%2Fref-conv2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Foverload%2Fref-conv2.C?ref=12b03642cb027437f4a0eddac8c7fd7849bfe149", "patch": "@@ -0,0 +1,15 @@\n+// PR c++/50523\n+\n+template <class T>\n+struct A\n+{\n+  A(const T&);\n+  operator T&() const;\n+  operator const T&() const;\n+};\n+\n+int main()\n+{\n+  A<int> a(1);\n+  A<int> a2(a);\n+}"}]}