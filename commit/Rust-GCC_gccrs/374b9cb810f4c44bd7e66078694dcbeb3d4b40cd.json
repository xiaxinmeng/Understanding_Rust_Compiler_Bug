{"sha": "374b9cb810f4c44bd7e66078694dcbeb3d4b40cd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mzc0YjljYjgxMGY0YzQ0YmQ3ZTY2MDc4Njk0ZGNiZWIzZDRiNDBjZA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2009-12-23T16:54:35Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2009-12-23T16:54:35Z"}, "message": "re PR debug/42454 (debug_ranges table contains empty range for unused .text section with -ffunction-sections)\n\n\tPR debug/42454\n\t* dwarf2out.c (add_ranges_by_labels_to_AT_range_list): New function.\n\t(dwarf2out_finish): Call add_ranges_by_labels_to_AT_range_list.\n\n\t* gcc.dg/debug/dwarf2/aranges-fnsec-1.c: Add check for .debug_ranges.\n\nCo-Authored-By: Cary Coutant <ccoutant@google.com>\n\nFrom-SVN: r155429", "tree": {"sha": "b8dcdb87793bd7954d5139a8c2bbecdd7ba0fc13", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b8dcdb87793bd7954d5139a8c2bbecdd7ba0fc13"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/374b9cb810f4c44bd7e66078694dcbeb3d4b40cd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/374b9cb810f4c44bd7e66078694dcbeb3d4b40cd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/374b9cb810f4c44bd7e66078694dcbeb3d4b40cd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/374b9cb810f4c44bd7e66078694dcbeb3d4b40cd/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "83c3a2d826778223e827ab541ada1c3ffde04034", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/83c3a2d826778223e827ab541ada1c3ffde04034", "html_url": "https://github.com/Rust-GCC/gccrs/commit/83c3a2d826778223e827ab541ada1c3ffde04034"}], "stats": {"total": 66, "additions": 47, "deletions": 19}, "files": [{"sha": "42c4e1c085cf48ebc166a0be86f3aa5978fa8d32", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/374b9cb810f4c44bd7e66078694dcbeb3d4b40cd/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/374b9cb810f4c44bd7e66078694dcbeb3d4b40cd/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=374b9cb810f4c44bd7e66078694dcbeb3d4b40cd", "patch": "@@ -1,3 +1,10 @@\n+2009-12-23  Jakub Jelinek  <jakub@redhat.com>\n+\t    Cary Coutant  <ccoutant@google.com>\n+\n+\tPR debug/42454\n+\t* dwarf2out.c (add_ranges_by_labels_to_AT_range_list): New function.\n+\t(dwarf2out_finish): Call add_ranges_by_labels_to_AT_range_list.\n+\n 2009-12-23  Ramana Radhakrishnan  <ramana.radhakrishnan@arm.com>\n \n         PR target/42093"}, {"sha": "02c0afd1171ec88cf7b8fa86a0ec8f67e8d7ed6d", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 29, "deletions": 16, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/374b9cb810f4c44bd7e66078694dcbeb3d4b40cd/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/374b9cb810f4c44bd7e66078694dcbeb3d4b40cd/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=374b9cb810f4c44bd7e66078694dcbeb3d4b40cd", "patch": "@@ -6062,7 +6062,8 @@ static void add_arange (tree, dw_die_ref);\n static void output_aranges (void);\n static unsigned int add_ranges_num (int);\n static unsigned int add_ranges (const_tree);\n-static unsigned int add_ranges_by_labels (const char *, const char *);\n+static void add_ranges_by_labels (dw_die_ref, const char *, const char *,\n+\t\t\t\t  bool *);\n static void output_ranges (void);\n static void output_line_info (void);\n static void output_file_names (void);\n@@ -11021,10 +11022,12 @@ add_ranges (const_tree block)\n /* Add a new entry to .debug_ranges corresponding to a pair of\n    labels.  */\n \n-static unsigned int\n-add_ranges_by_labels (const char *begin, const char *end)\n+static void\n+add_ranges_by_labels (dw_die_ref die, const char *begin, const char *end,\n+\t\t      bool *added)\n {\n   unsigned int in_use = ranges_by_label_in_use;\n+  unsigned int offset;\n \n   if (in_use == ranges_by_label_allocated)\n     {\n@@ -11041,7 +11044,12 @@ add_ranges_by_labels (const char *begin, const char *end)\n   ranges_by_label[in_use].end = end;\n   ranges_by_label_in_use = in_use + 1;\n \n-  return add_ranges_num (-(int)in_use - 1);\n+  offset = add_ranges_num (-(int)in_use - 1);\n+  if (!*added)\n+    {\n+      add_AT_range_list (die, DW_AT_ranges, offset);\n+      *added = true;\n+    }\n }\n \n static void\n@@ -21209,6 +21217,7 @@ dwarf2out_finish (const char *filename)\n   else\n     {\n       unsigned fde_idx = 0;\n+      bool range_list_added = false;\n \n       /* We need to give .debug_loc and .debug_ranges an appropriate\n \t \"base address\".  Use zero so that these addresses become\n@@ -21219,12 +21228,11 @@ dwarf2out_finish (const char *filename)\n       add_AT_addr (comp_unit_die, DW_AT_entry_pc, const0_rtx);\n \n       if (text_section_used)\n-\tadd_AT_range_list (comp_unit_die, DW_AT_ranges,\n-\t\t\t   add_ranges_by_labels (text_section_label,\n-\t\t\t\t\t\t text_end_label));\n+\tadd_ranges_by_labels (comp_unit_die, text_section_label,\n+\t\t\t      text_end_label, &range_list_added);\n       if (flag_reorder_blocks_and_partition && cold_text_section_used)\n-\tadd_ranges_by_labels (cold_text_section_label,\n-\t\t\t      cold_end_label);\n+\tadd_ranges_by_labels (comp_unit_die, cold_text_section_label,\n+\t\t\t      cold_end_label, &range_list_added);\n \n       for (fde_idx = 0; fde_idx < fde_table_in_use; fde_idx++)\n \t{\n@@ -21233,18 +21241,23 @@ dwarf2out_finish (const char *filename)\n \t  if (fde->dw_fde_switched_sections)\n \t    {\n \t      if (!fde->in_std_section)\n-\t\tadd_ranges_by_labels (fde->dw_fde_hot_section_label,\n-\t\t\t\t      fde->dw_fde_hot_section_end_label);\n+\t\tadd_ranges_by_labels (comp_unit_die,\n+\t\t\t\t      fde->dw_fde_hot_section_label,\n+\t\t\t\t      fde->dw_fde_hot_section_end_label,\n+\t\t\t\t      &range_list_added);\n \t      if (!fde->cold_in_std_section)\n-\t\tadd_ranges_by_labels (fde->dw_fde_unlikely_section_label,\n-\t\t\t\t      fde->dw_fde_unlikely_section_end_label);\n+\t\tadd_ranges_by_labels (comp_unit_die,\n+\t\t\t\t      fde->dw_fde_unlikely_section_label,\n+\t\t\t\t      fde->dw_fde_unlikely_section_end_label,\n+\t\t\t\t      &range_list_added);\n \t    }\n \t  else if (!fde->in_std_section)\n-\t    add_ranges_by_labels (fde->dw_fde_begin,\n-\t\t\t\t  fde->dw_fde_end);\n+\t    add_ranges_by_labels (comp_unit_die, fde->dw_fde_begin,\n+\t\t\t\t  fde->dw_fde_end, &range_list_added);\n \t}\n \n-      add_ranges (NULL);\n+      if (range_list_added)\n+\tadd_ranges (NULL);\n     }\n \n   /* Output location list section if necessary.  */"}, {"sha": "83144a258f2e9219ae094e9c890064175b208a20", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/374b9cb810f4c44bd7e66078694dcbeb3d4b40cd/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/374b9cb810f4c44bd7e66078694dcbeb3d4b40cd/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=374b9cb810f4c44bd7e66078694dcbeb3d4b40cd", "patch": "@@ -1,3 +1,9 @@\n+2009-12-23  Jakub Jelinek  <jakub@redhat.com>\n+\t    Cary Coutant  <ccoutant@google.com>\n+\n+\tPR debug/42454\n+\t* gcc.dg/debug/dwarf2/aranges-fnsec-1.c: Add check for .debug_ranges.\n+\n 2009-12-23  Ramana Radhakrishnan  <ramana.radhakrishnan@arm.com>\n \n         PR target/42093"}, {"sha": "124e28eb7cea050960e017e3bfae0d92efa0625e", "filename": "gcc/testsuite/gcc.dg/debug/dwarf2/aranges-fnsec-1.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/374b9cb810f4c44bd7e66078694dcbeb3d4b40cd/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fdwarf2%2Faranges-fnsec-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/374b9cb810f4c44bd7e66078694dcbeb3d4b40cd/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fdwarf2%2Faranges-fnsec-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fdwarf2%2Faranges-fnsec-1.c?ref=374b9cb810f4c44bd7e66078694dcbeb3d4b40cd", "patch": "@@ -1,9 +1,11 @@\n-/* Test that .debug_aranges does not have an entry for the text\n-   section if nothing went in there.  */\n+/* Test that .debug_aranges and .debug_ranges do not have an entry for the\n+   text section if nothing went in there.  */\n /* Origin: Joseph Myers <joseph@codesourcery.com> */\n /* { dg-do compile } */\n-/* { dg-options \"-gdwarf-2 -ffunction-sections -w\" } */\n+/* { dg-options \"-gdwarf-2 -ffunction-sections -w -dA\" } */\n /* { dg-final { scan-assembler-not \"\\\\.Letext0-\\\\.Ltext0\" } } */\n+/* { dg-final { scan-assembler-not \"\\\\.Ltext0\\[^\\n\\r\\]*Offset 0x0\" } } */\n+/* { dg-final { scan-assembler \"DW_AT_ranges\" } } */\n \n int\n f (void)"}]}