{"sha": "df99e9e42094dee0833ac38f53e7fae09b4d133c", "node_id": "C_kwDOANBUbNoAKGRmOTllOWU0MjA5NGRlZTA4MzNhYzM4ZjUzZTdmYWUwOWI0ZDEzM2M", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2022-10-20T09:37:35Z"}, "committer": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2022-10-20T09:37:35Z"}, "message": "aarch64: Commonise some folding code\n\nAdd an aarch64_sve::gimple_folder helper for folding calls\nto integer constants.  SME will make more use of this.\n\ngcc/\n\t* config/aarch64/aarch64-sve-builtins.h\n\t(gimple_folder::fold_to_cstu): New member function.\n\t* config/aarch64/aarch64-sve-builtins.cc\n\t(gimple_folder::fold_to_cstu): Define.\n\t* config/aarch64/aarch64-sve-builtins-base.cc\n\t(svcnt_bhwd_impl::fold): Use it.", "tree": {"sha": "bcbfa9c67f1a07049db1e8fb464bffcb067df060", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bcbfa9c67f1a07049db1e8fb464bffcb067df060"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/df99e9e42094dee0833ac38f53e7fae09b4d133c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df99e9e42094dee0833ac38f53e7fae09b4d133c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/df99e9e42094dee0833ac38f53e7fae09b4d133c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df99e9e42094dee0833ac38f53e7fae09b4d133c/comments", "author": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7bca7218ac92b8f842d93dd672385c2ba0f8faf9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7bca7218ac92b8f842d93dd672385c2ba0f8faf9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7bca7218ac92b8f842d93dd672385c2ba0f8faf9"}], "stats": {"total": 17, "additions": 10, "deletions": 7}, "files": [{"sha": "23b4d42822ad437d5f101796ffd1ca9141c75aab", "filename": "gcc/config/aarch64/aarch64-sve-builtins-base.cc", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df99e9e42094dee0833ac38f53e7fae09b4d133c/gcc%2Fconfig%2Faarch64%2Faarch64-sve-builtins-base.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df99e9e42094dee0833ac38f53e7fae09b4d133c/gcc%2Fconfig%2Faarch64%2Faarch64-sve-builtins-base.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64-sve-builtins-base.cc?ref=df99e9e42094dee0833ac38f53e7fae09b4d133c", "patch": "@@ -517,9 +517,7 @@ class svcnt_bhwd_impl : public function_base\n   gimple *\n   fold (gimple_folder &f) const override\n   {\n-    tree count = build_int_cstu (TREE_TYPE (f.lhs),\n-\t\t\t\t GET_MODE_NUNITS (m_ref_mode));\n-    return gimple_build_assign (f.lhs, count);\n+    return f.fold_to_cstu (GET_MODE_NUNITS (m_ref_mode));\n   }\n \n   rtx\n@@ -553,10 +551,7 @@ class svcnt_bhwd_pat_impl : public svcnt_bhwd_impl\n     unsigned int elements_per_vq = 128 / GET_MODE_UNIT_BITSIZE (m_ref_mode);\n     HOST_WIDE_INT value = aarch64_fold_sve_cnt_pat (pattern, elements_per_vq);\n     if (value >= 0)\n-      {\n-\ttree count = build_int_cstu (TREE_TYPE (f.lhs), value);\n-\treturn gimple_build_assign (f.lhs, count);\n-      }\n+      return f.fold_to_cstu (value);\n \n     return NULL;\n   }"}, {"sha": "37228f6389aa3594b3a865278f9e5724084d40f5", "filename": "gcc/config/aarch64/aarch64-sve-builtins.cc", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df99e9e42094dee0833ac38f53e7fae09b4d133c/gcc%2Fconfig%2Faarch64%2Faarch64-sve-builtins.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df99e9e42094dee0833ac38f53e7fae09b4d133c/gcc%2Fconfig%2Faarch64%2Faarch64-sve-builtins.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64-sve-builtins.cc?ref=df99e9e42094dee0833ac38f53e7fae09b4d133c", "patch": "@@ -2615,6 +2615,13 @@ gimple_folder::redirect_call (const function_instance &instance)\n   return call;\n }\n \n+/* Fold the call to constant VAL.  */\n+gimple *\n+gimple_folder::fold_to_cstu (poly_uint64 val)\n+{\n+  return gimple_build_assign (lhs, build_int_cstu (TREE_TYPE (lhs), val));\n+}\n+\n /* Fold the call to a PTRUE, taking the element size from type suffix 0.  */\n gimple *\n gimple_folder::fold_to_ptrue ()"}, {"sha": "0d130b871d0976b96ecfb3acee2edf7ab3b26b2e", "filename": "gcc/config/aarch64/aarch64-sve-builtins.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df99e9e42094dee0833ac38f53e7fae09b4d133c/gcc%2Fconfig%2Faarch64%2Faarch64-sve-builtins.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df99e9e42094dee0833ac38f53e7fae09b4d133c/gcc%2Fconfig%2Faarch64%2Faarch64-sve-builtins.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64-sve-builtins.h?ref=df99e9e42094dee0833ac38f53e7fae09b4d133c", "patch": "@@ -500,6 +500,7 @@ class gimple_folder : public function_call_info\n   tree load_store_cookie (tree);\n \n   gimple *redirect_call (const function_instance &);\n+  gimple *fold_to_cstu (poly_uint64);\n   gimple *fold_to_pfalse ();\n   gimple *fold_to_ptrue ();\n   gimple *fold_to_vl_pred (unsigned int);"}]}