{"sha": "ba9bbd6f584afe2939c44c159cbb1c064becad5c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmE5YmJkNmY1ODRhZmUyOTM5YzQ0YzE1OWNiYjFjMDY0YmVjYWQ1Yw==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2016-08-29T16:41:33Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2016-08-29T16:41:33Z"}, "message": "Handle errors in both args of va_arg\n\n2016-08-29  Tom de Vries  <tom@codesourcery.com>\n\n\tPR c/77398\n\t* c-common.c (build_va_arg): Add first argument error.  Build va_arg\n\twith error_mark_node as va_list instead of with illegal va_list.\n\n\t* gimplify.c (gimplify_va_arg_expr): Replace first argument type error\n\twith assert.\n\n\t* g++.dg/ext/va-arg1.C: Add error check for illegal first argument.\n\nFrom-SVN: r239827", "tree": {"sha": "bb66752a765b5b993a5ede281a590b42667c2c1d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bb66752a765b5b993a5ede281a590b42667c2c1d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ba9bbd6f584afe2939c44c159cbb1c064becad5c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba9bbd6f584afe2939c44c159cbb1c064becad5c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ba9bbd6f584afe2939c44c159cbb1c064becad5c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba9bbd6f584afe2939c44c159cbb1c064becad5c/comments", "author": null, "committer": null, "parents": [{"sha": "6c77dacd1cc70db30c4505966a7a636b78e292dd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6c77dacd1cc70db30c4505966a7a636b78e292dd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6c77dacd1cc70db30c4505966a7a636b78e292dd"}], "stats": {"total": 35, "additions": 26, "deletions": 9}, "files": [{"sha": "55906fea96bd53d83572d28c34a8a218585ab882", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba9bbd6f584afe2939c44c159cbb1c064becad5c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba9bbd6f584afe2939c44c159cbb1c064becad5c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ba9bbd6f584afe2939c44c159cbb1c064becad5c", "patch": "@@ -1,3 +1,9 @@\n+2016-08-29  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR c/77398\n+\t* gimplify.c (gimplify_va_arg_expr): Replace first argument type error\n+\twith assert.\n+\n 2016-08-29  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* Makefile.in (gcov-iov.h): Add dummy recipe."}, {"sha": "b6876d4bae025205f60d1b73cad72e06a337ef11", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba9bbd6f584afe2939c44c159cbb1c064becad5c/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba9bbd6f584afe2939c44c159cbb1c064becad5c/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=ba9bbd6f584afe2939c44c159cbb1c064becad5c", "patch": "@@ -1,3 +1,9 @@\n+2016-08-29  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR c/77398\n+\t* c-common.c (build_va_arg): Add first argument error.  Build va_arg\n+\twith error_mark_node as va_list instead of with illegal va_list.\n+\n 2016-08-25  Marek Polacek  <polacek@redhat.com>\n \t    David Malcolm  <dmalcolm@redhat.com>\n "}, {"sha": "eef86744038b42ae7393306c423cfd3696e3dfae", "filename": "gcc/c-family/c-common.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba9bbd6f584afe2939c44c159cbb1c064becad5c/gcc%2Fc-family%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba9bbd6f584afe2939c44c159cbb1c064becad5c/gcc%2Fc-family%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.c?ref=ba9bbd6f584afe2939c44c159cbb1c064becad5c", "patch": "@@ -5806,16 +5806,19 @@ build_va_arg (location_t loc, tree expr, tree type)\n {\n   tree va_type = TREE_TYPE (expr);\n   tree canon_va_type = (va_type == error_mark_node\n-\t\t\t? NULL_TREE\n+\t\t\t? error_mark_node\n \t\t\t: targetm.canonical_va_list_type (va_type));\n \n   if (va_type == error_mark_node\n       || canon_va_type == NULL_TREE)\n     {\n+      if (canon_va_type == NULL_TREE)\n+\terror_at (loc, \"first argument to %<va_arg%> not of type %<va_list%>\");\n+\n       /* Let's handle things neutrallly, if expr:\n \t - has undeclared type, or\n \t - is not an va_list type.  */\n-      return build_va_arg_1 (loc, type, expr);\n+      return build_va_arg_1 (loc, type, error_mark_node);\n     }\n \n   if (TREE_CODE (canon_va_type) != ARRAY_TYPE)"}, {"sha": "288b4727dd82709940cdfe31d6819aacb11bd341", "filename": "gcc/gimplify.c", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba9bbd6f584afe2939c44c159cbb1c064becad5c/gcc%2Fgimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba9bbd6f584afe2939c44c159cbb1c064becad5c/gcc%2Fgimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimplify.c?ref=ba9bbd6f584afe2939c44c159cbb1c064becad5c", "patch": "@@ -11959,12 +11959,7 @@ gimplify_va_arg_expr (tree *expr_p, gimple_seq *pre_p,\n   if (have_va_type == error_mark_node)\n     return GS_ERROR;\n   have_va_type = targetm.canonical_va_list_type (have_va_type);\n-\n-  if (have_va_type == NULL_TREE)\n-    {\n-      error_at (loc, \"first argument to %<va_arg%> not of type %<va_list%>\");\n-      return GS_ERROR;\n-    }\n+  gcc_assert (have_va_type != NULL_TREE);\n \n   /* Generate a diagnostic for requesting data of a type that cannot\n      be passed through `...' due to type promotion at the call site.  */"}, {"sha": "577df5111b15e83485535f98c6c3fccb2efce53f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba9bbd6f584afe2939c44c159cbb1c064becad5c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba9bbd6f584afe2939c44c159cbb1c064becad5c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ba9bbd6f584afe2939c44c159cbb1c064becad5c", "patch": "@@ -1,3 +1,8 @@\n+2016-08-29  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR c/77398\n+\t* g++.dg/ext/va-arg1.C: Add error check for illegal first argument.\n+\n 2016-08-29  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc.dg/ipa/iinline-attr.c: XFAIL on Visium."}, {"sha": "c0477adcb76a4f76e808b80cb13a6071d1d1b977", "filename": "gcc/testsuite/g++.dg/ext/va-arg1.C", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba9bbd6f584afe2939c44c159cbb1c064becad5c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fva-arg1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba9bbd6f584afe2939c44c159cbb1c064becad5c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fva-arg1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fva-arg1.C?ref=ba9bbd6f584afe2939c44c159cbb1c064becad5c", "patch": "@@ -4,5 +4,7 @@ struct A {};\n \n void foo()\n {\n-  ++__builtin_va_arg(0, A); // { dg-error \"operand type is 'A'\" }\n+  ++__builtin_va_arg (0, A);\n+  // { dg-error \"operand type is 'A'\" \"\" {target *-*-*} \"7\" }\n+  // { dg-error \"first argument to 'va_arg' not of type 'va_list'\" \"\" {target *-*-*} \"7\" }\n }"}]}