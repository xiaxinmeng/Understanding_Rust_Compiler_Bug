{"sha": "b8910447230acb4d7651f131174cee296e4ac66d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yjg5MTA0NDcyMzBhY2I0ZDc2NTFmMTMxMTc0Y2VlMjk2ZTRhYzY2ZA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2015-01-23T18:19:50Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2015-01-23T18:19:50Z"}, "message": "re PR middle-end/64734 (ICE at omp lowering)\n\n\tPR middle-end/64734\n\t* omp-low.c (scan_sharing_clauses): Don't ignore\n\tOMP_CLAUSE_MAP_ZERO_BIAS_ARRAY_SECTION GOMP_MAP_POINTER clauses\n\ton target data/update constructs.\n\n\t* libgomp.c/pr64734.c: New test.\n\nFrom-SVN: r220053", "tree": {"sha": "0b4fd08fad396211399dfe9c28d88e7ec0ed0eab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0b4fd08fad396211399dfe9c28d88e7ec0ed0eab"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b8910447230acb4d7651f131174cee296e4ac66d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8910447230acb4d7651f131174cee296e4ac66d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b8910447230acb4d7651f131174cee296e4ac66d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8910447230acb4d7651f131174cee296e4ac66d/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8a7261b26cd40d2d462b8d4a9a2d60089b6eb6f0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a7261b26cd40d2d462b8d4a9a2d60089b6eb6f0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8a7261b26cd40d2d462b8d4a9a2d60089b6eb6f0"}], "stats": {"total": 70, "additions": 69, "deletions": 1}, "files": [{"sha": "e5eaf5b6026ddbe806f319d32cda50f41a46ff02", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8910447230acb4d7651f131174cee296e4ac66d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8910447230acb4d7651f131174cee296e4ac66d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b8910447230acb4d7651f131174cee296e4ac66d", "patch": "@@ -1,3 +1,10 @@\n+2015-01-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/64734\n+\t* omp-low.c (scan_sharing_clauses): Don't ignore\n+\tOMP_CLAUSE_MAP_ZERO_BIAS_ARRAY_SECTION GOMP_MAP_POINTER clauses\n+\ton target data/update constructs.\n+\n 2015-01-23  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n \n \tPR target/50928"}, {"sha": "da53334b3252fac5516fb7065b1a8e73151047f2", "filename": "gcc/omp-low.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8910447230acb4d7651f131174cee296e4ac66d/gcc%2Fomp-low.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8910447230acb4d7651f131174cee296e4ac66d/gcc%2Fomp-low.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-low.c?ref=b8910447230acb4d7651f131174cee296e4ac66d", "patch": "@@ -1834,7 +1834,8 @@ scan_sharing_clauses (tree clauses, omp_context *ctx)\n \t      /* Ignore GOMP_MAP_POINTER kind for arrays in regions that are\n \t\t not offloaded; there is nothing to map for those.  */\n \t      if (!is_gimple_omp_offloaded (ctx->stmt)\n-\t\t  && !POINTER_TYPE_P (TREE_TYPE (decl)))\n+\t\t  && !POINTER_TYPE_P (TREE_TYPE (decl))\n+\t\t  && !OMP_CLAUSE_MAP_ZERO_BIAS_ARRAY_SECTION (c))\n \t\tbreak;\n \t    }\n \t  if (DECL_P (decl))"}, {"sha": "b58d1c6cdafefe38f9a354981f545c9524285fbb", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8910447230acb4d7651f131174cee296e4ac66d/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8910447230acb4d7651f131174cee296e4ac66d/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=b8910447230acb4d7651f131174cee296e4ac66d", "patch": "@@ -1,3 +1,8 @@\n+2015-01-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/64734\n+\t* libgomp.c/pr64734.c: New test.\n+\n 2015-01-23  Tom de Vries  <tom@codesourcery.com>\n \n \tPR libgomp/64672"}, {"sha": "457f481ae0bd8644b9e1e6b66767ffca93d5e395", "filename": "libgomp/testsuite/libgomp.c/pr64734.c", "status": "added", "additions": 55, "deletions": 0, "changes": 55, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8910447230acb4d7651f131174cee296e4ac66d/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr64734.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8910447230acb4d7651f131174cee296e4ac66d/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr64734.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr64734.c?ref=b8910447230acb4d7651f131174cee296e4ac66d", "patch": "@@ -0,0 +1,55 @@\n+/* PR middle-end/64734 */\n+\n+#include <stdlib.h>\n+\n+void\n+foo (int *x, int *y)\n+{\n+  #pragma omp target map (alloc:x[0]) map (alloc:y[0:8])\n+  {\n+    int i;\n+    for (i = 0; i < 8; i++)\n+      if (y[i] != 2 + i)\n+\tbreak;\n+    if (i != 8 || *x != 1)\n+      *x = 6;\n+    else\n+      {\n+\t*x = 8;\n+\tfor (i = 0; i < 8; i++)\n+\t  y[i] = 9 + i;\n+      }\n+  }\n+  #pragma omp target update from (y[0:8]) from (x[0])\n+}\n+\n+void\n+bar (void)\n+{\n+  int x = 1, y[32] = { 0 };\n+  #pragma omp target data map (to:y[0:32]) map (to:x)\n+    ;\n+}\n+\n+int\n+main ()\n+{\n+  int x = 1, y[8] = { 2, 3, 4, 5, 6, 7, 8, 9 }, i;\n+  #pragma omp target data map (to:y[0:8]) map (to:x)\n+    ;\n+  #pragma omp target data map (to:y[0:8]) map (to:x)\n+    {\n+      #pragma omp target update from (y[0:8]) from (x)\n+    }\n+\n+  #pragma omp target data map (to:y[0:8]) map (to:x)\n+    foo (&x, &y[0]);\n+\n+  if (x != 8)\n+    abort ();\n+  for (i = 0; i < 8; i++)\n+    if (y[i] != 9 + i)\n+      abort ();\n+\n+  return 0;\n+}"}]}