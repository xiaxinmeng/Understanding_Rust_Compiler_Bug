{"sha": "f127ea514dbd61dde99f6d86c05d753748b9f93e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjEyN2VhNTE0ZGJkNjFkZGU5OWY2ZDg2YzA1ZDc1Mzc0OGI5ZjkzZQ==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2015-11-07T09:56:04Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2015-11-07T09:56:04Z"}, "message": "Try to update dominance info in tree-call-cdce.c\n\nThe pass would free the dominance info after making a change, but it\nshould be pretty easy to keep the information up-to-date when the call\nhas no EH edges.\n\nTested on x86_64-linux-gnu, arm-linux-gnueabi and aarch64-linux-gnu.\n\ngcc/\n\t* tree-call-cdce.c (shrink_wrap_one_built_in_call): Try to update\n\tthe dominance info; free it if we can't.\n\t(pass_call_cdce::execute): Don't free the dominance info here.\n\nFrom-SVN: r229916", "tree": {"sha": "e6991c90c6ee33ae4de032d5acba2f29c1da2872", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e6991c90c6ee33ae4de032d5acba2f29c1da2872"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f127ea514dbd61dde99f6d86c05d753748b9f93e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f127ea514dbd61dde99f6d86c05d753748b9f93e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f127ea514dbd61dde99f6d86c05d753748b9f93e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f127ea514dbd61dde99f6d86c05d753748b9f93e/comments", "author": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "88419b5295091e664e993fc6d981b3fb149a3e7b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88419b5295091e664e993fc6d981b3fb149a3e7b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/88419b5295091e664e993fc6d981b3fb149a3e7b"}], "stats": {"total": 43, "additions": 42, "deletions": 1}, "files": [{"sha": "6e7ab8e048fc03547c5e62e68ceea3aa85fcc883", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f127ea514dbd61dde99f6d86c05d753748b9f93e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f127ea514dbd61dde99f6d86c05d753748b9f93e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f127ea514dbd61dde99f6d86c05d753748b9f93e", "patch": "@@ -1,3 +1,9 @@\n+2015-11-07  Richard Sandiford  <richard.sandiford@arm.com>\n+\n+\t* tree-call-cdce.c (shrink_wrap_one_built_in_call): Try to update\n+\tthe dominance info; free it if we can't.\n+\t(pass_call_cdce::execute): Don't free the dominance info here.\n+\n 2015-11-06  Jeff Law <jeff@redhat.com>\n \n \t* tree-ssa-threadedge.c (dummy_simplify): Remove."}, {"sha": "a5f38ce1331454fbfb3a0081b6e6a2f05122fa0b", "filename": "gcc/tree-call-cdce.c", "status": "modified", "additions": 36, "deletions": 1, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f127ea514dbd61dde99f6d86c05d753748b9f93e/gcc%2Ftree-call-cdce.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f127ea514dbd61dde99f6d86c05d753748b9f93e/gcc%2Ftree-call-cdce.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-call-cdce.c?ref=f127ea514dbd61dde99f6d86c05d753748b9f93e", "patch": "@@ -731,6 +731,32 @@ shrink_wrap_one_built_in_call (gcall *bi_call)\n   if (nconds == 0)\n     return false;\n \n+  /* The cfg we want to create looks like this:\n+\n+\t   [guard n-1]         <- guard_bb (old block)\n+\t     |    \\\n+\t     | [guard n-2]                   }\n+\t     |    / \\                        }\n+\t     |   /  ...                      } new blocks\n+\t     |  /  [guard 0]                 }\n+\t     | /    /   |                    }\n+\t    [ call ]    |     <- bi_call_bb  }\n+\t     | \\        |\n+\t     |  \\       |\n+\t     |   [ join ]     <- join_tgt_bb (old iff call must end bb)\n+\t     |\n+\t possible EH edges (only if [join] is old)\n+\n+     When [join] is new, the immediate dominators for these blocks are:\n+\n+     1. [guard n-1]: unchanged\n+     2. [call]: [guard n-1]\n+     3. [guard m]: [guard m+1] for 0 <= m <= n-2\n+     4. [join]: [guard n-1]\n+\n+     We punt for the more complex case case of [join] being old and\n+     simply free the dominance info.  We also punt on postdominators,\n+     which aren't expected to be available at this point anyway.  */\n   bi_call_bb = gimple_bb (bi_call);\n \n   /* Now find the join target bb -- split bi_call_bb if needed.  */\n@@ -741,6 +767,7 @@ shrink_wrap_one_built_in_call (gcall *bi_call)\n       join_tgt_in_edge_from_call = find_fallthru_edge (bi_call_bb->succs);\n       if (join_tgt_in_edge_from_call == NULL)\n         return false;\n+      free_dominance_info (CDI_DOMINATORS);\n     }\n   else\n     join_tgt_in_edge_from_call = split_block (bi_call_bb, bi_call);\n@@ -820,6 +847,15 @@ shrink_wrap_one_built_in_call (gcall *bi_call)\n       guard_bb_in_edge->count = guard_bb->count - bi_call_in_edge->count;\n     }\n \n+  if (dom_info_available_p (CDI_DOMINATORS))\n+    {\n+      /* The split_blocks leave [guard 0] as the immediate dominator\n+\t of [call] and [call] as the immediate dominator of [join].\n+\t Fix them up.  */\n+      set_immediate_dominator (CDI_DOMINATORS, bi_call_bb, guard_bb);\n+      set_immediate_dominator (CDI_DOMINATORS, join_tgt_bb, guard_bb);\n+    }\n+\n   if (dump_file && (dump_flags & TDF_DETAILS))\n     {\n       location_t loc;\n@@ -927,7 +963,6 @@ pass_call_cdce::execute (function *fun)\n \n   if (something_changed)\n     {\n-      free_dominance_info (CDI_DOMINATORS);\n       free_dominance_info (CDI_POST_DOMINATORS);\n       /* As we introduced new control-flow we need to insert PHI-nodes\n          for the call-clobbers of the remaining call.  */"}]}