{"sha": "7877f4e000e999a902cf2898a535ae8e8ad45a3f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Nzg3N2Y0ZTAwMGU5OTlhOTAyY2YyODk4YTUzNWFlOGU4YWQ0NWEzZg==", "commit": {"author": {"name": "Alan Modra", "email": "amodra@gmail.com", "date": "2018-11-13T03:55:30Z"}, "committer": {"name": "Alan Modra", "email": "amodra@gcc.gnu.org", "date": "2018-11-13T03:55:30Z"}, "message": "[RS6000] secondary_reload and find_replacement\n\nThis patch removes a call only necessary when using reload.  It also\ncorrects a PRE_DEC address offset.\n\n\t* config/rs6000/rs6000.c (rs6000_secondary_reload_inner): Negate\n\toffset for PRE_DEC.\n\t(rs6000_secondary_reload_gpr): Don't call find_replacement.\n\nFrom-SVN: r266049", "tree": {"sha": "076d41a9e8b41926eb635d993ddc07e421d49d22", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/076d41a9e8b41926eb635d993ddc07e421d49d22"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7877f4e000e999a902cf2898a535ae8e8ad45a3f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7877f4e000e999a902cf2898a535ae8e8ad45a3f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7877f4e000e999a902cf2898a535ae8e8ad45a3f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7877f4e000e999a902cf2898a535ae8e8ad45a3f/comments", "author": {"login": "amodra", "id": 6006325, "node_id": "MDQ6VXNlcjYwMDYzMjU=", "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amodra", "html_url": "https://github.com/amodra", "followers_url": "https://api.github.com/users/amodra/followers", "following_url": "https://api.github.com/users/amodra/following{/other_user}", "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}", "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amodra/subscriptions", "organizations_url": "https://api.github.com/users/amodra/orgs", "repos_url": "https://api.github.com/users/amodra/repos", "events_url": "https://api.github.com/users/amodra/events{/privacy}", "received_events_url": "https://api.github.com/users/amodra/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c6459f2dfa63a6581233eb143b7614422c88b352", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c6459f2dfa63a6581233eb143b7614422c88b352", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c6459f2dfa63a6581233eb143b7614422c88b352"}], "stats": {"total": 22, "additions": 10, "deletions": 12}, "files": [{"sha": "3f98c9001f4d0525fde145b6f0b1037a4337693a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7877f4e000e999a902cf2898a535ae8e8ad45a3f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7877f4e000e999a902cf2898a535ae8e8ad45a3f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7877f4e000e999a902cf2898a535ae8e8ad45a3f", "patch": "@@ -1,3 +1,9 @@\n+2018-11-13  Alan Modra  <amodra@gmail.com>\n+\n+\t* config/rs6000/rs6000.c (rs6000_secondary_reload_inner): Negate\n+\toffset for PRE_DEC.\n+\t(rs6000_secondary_reload_gpr): Don't call find_replacement.\n+\n 2018-11-13  Sandra Loosemore  <sandra@codesourcery.com>\n \n \tPR middle-end/59634"}, {"sha": "516e69724cc26fea788c392f467a5fa1648a0c63", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 4, "deletions": 12, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7877f4e000e999a902cf2898a535ae8e8ad45a3f/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7877f4e000e999a902cf2898a535ae8e8ad45a3f/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=7877f4e000e999a902cf2898a535ae8e8ad45a3f", "patch": "@@ -19701,7 +19701,10 @@ rs6000_secondary_reload_inner (rtx reg, rtx mem, rtx scratch, bool store_p)\n \n       if ((addr_mask & RELOAD_REG_PRE_INCDEC) == 0)\n \t{\n-\t  emit_insn (gen_add2_insn (op_reg, GEN_INT (GET_MODE_SIZE (mode))));\n+\t  int delta = GET_MODE_SIZE (mode);\n+\t  if (GET_CODE (addr) == PRE_DEC)\n+\t    delta = -delta;\n+\t  emit_insn (gen_add2_insn (op_reg, GEN_INT (delta)));\n \t  new_addr = op_reg;\n \t}\n       break;\n@@ -19901,17 +19904,6 @@ rs6000_secondary_reload_gpr (rtx reg, rtx mem, rtx scratch, bool store_p)\n \t\t  && GET_CODE (XEXP (addr, 1)) == PLUS\n \t\t  && XEXP (XEXP (addr, 1), 0) == XEXP (addr, 0));\n       scratch_or_premodify = XEXP (addr, 0);\n-      if (!HARD_REGISTER_P (scratch_or_premodify))\n-\t/* If we have a pseudo here then reload will have arranged\n-\t   to have it replaced, but only in the original insn.\n-\t   Use the replacement here too.  */\n-\tscratch_or_premodify = find_replacement (&XEXP (addr, 0));\n-\n-      /* RTL emitted by rs6000_secondary_reload_gpr uses RTL\n-\t expressions from the original insn, without unsharing them.\n-\t Any RTL that points into the original insn will of course\n-\t have register replacements applied.  That is why we don't\n-\t need to look for replacements under the PLUS.  */\n       addr = XEXP (addr, 1);\n     }\n   gcc_assert (GET_CODE (addr) == PLUS || GET_CODE (addr) == LO_SUM);"}]}