{"sha": "ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWU1Y2JjMzMyZjYwYTRmOWJjY2E1NmM0NzM5NDEwYzliMmQzYWJmOQ==", "commit": {"author": {"name": "Roger Sayle", "email": "sayle@gcc.gnu.org", "date": "2004-05-22T13:56:19Z"}, "committer": {"name": "Roger Sayle", "email": "sayle@gcc.gnu.org", "date": "2004-05-22T13:56:19Z"}, "message": "name-lookup.c (check_for_out_of_scope_variable): Avoid ICE by returning when TREE_TYPE is error_mark_node.\n\n\n\t* name-lookup.c (check_for_out_of_scope_variable): Avoid ICE by\n\treturning when TREE_TYPE is error_mark_node.\n\t* typeck.c (require_complete_type): Return error_mark_node if\n\tvalue's type is an error_mark_node.\n\n\t* g++.dg/lookup/forscope2.C: New test case.\n\nFrom-SVN: r82133", "tree": {"sha": "f4a140dd0b5dd33ca49fc912aca01dccd68a2b20", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f4a140dd0b5dd33ca49fc912aca01dccd68a2b20"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9/comments", "author": null, "committer": null, "parents": [{"sha": "b7e6a6b3f511cc8aabb80a4460c417fcac90c2e7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b7e6a6b3f511cc8aabb80a4460c417fcac90c2e7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b7e6a6b3f511cc8aabb80a4460c417fcac90c2e7"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "03cc5a86755395a523e191f5a30bdbc0a7ed338d", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9", "patch": "@@ -1,3 +1,10 @@\n+2004-05-22  Roger Sayle  <roger@eyesopen.com>\n+\n+\t* name-lookup.c (check_for_out_of_scope_variable): Avoid ICE by\n+\treturning when TREE_TYPE is error_mark_node.\n+\t* typeck.c (require_complete_type): Return error_mark_node if\n+\tvalue's type is an error_mark_node.\n+\n 2005-05-20  Andrew Pinski  <pinskia@physics.uc.edu>\n \n \t* optimize.c (calls_setjmp_r): Remove."}, {"sha": "388883431890978c6b38a06eff4bf6417c3884f2", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9", "patch": "@@ -1151,6 +1151,10 @@ check_for_out_of_scope_variable (tree decl)\n     return decl;\n \n   DECL_ERROR_REPORTED (decl) = 1;\n+\n+  if (TREE_TYPE (decl) == error_mark_node)\n+    return decl;\n+\n   if (TYPE_HAS_NONTRIVIAL_DESTRUCTOR (TREE_TYPE (decl)))\n     {\n       error (\"name lookup of `%D' changed for new ISO `for' scoping\","}, {"sha": "3e9c2cf590ec4e3666ef2a20c5dcbf899f6590b8", "filename": "gcc/cp/typeck.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9/gcc%2Fcp%2Ftypeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9/gcc%2Fcp%2Ftypeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck.c?ref=ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9", "patch": "@@ -96,6 +96,9 @@ require_complete_type (tree value)\n   else\n     type = TREE_TYPE (value);\n \n+  if (type == error_mark_node)\n+    return error_mark_node;\n+\n   /* First, detect a valid value with a complete type.  */\n   if (COMPLETE_TYPE_P (type))\n     return value;"}, {"sha": "13b309c02ffa047d0c997eb4b24b302ac95a2815", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9", "patch": "@@ -1,3 +1,8 @@\n+2004-05-22  Wolfgang Bangerth  <bangerth@dealii.org>\n+\t    Roger Sayle  <roger@eyesopen.com>\n+\n+\t* g++.dg/lookup/forscope2.C: New test case.\n+\n 2004-05-22  Ben Elliston  <bje@au.ibm.com>\n \n \t* gcc.dg/cpp/Wmissingdirs.c: New."}, {"sha": "1fed957a041ff33658e6d7671782cbdc3baac5af", "filename": "gcc/testsuite/g++.dg/lookup/forscope2.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fforscope2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fforscope2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fforscope2.C?ref=ae5cbc332f60a4f9bcca56c4739410c9b2d3abf9", "patch": "@@ -0,0 +1,9 @@\n+// { dg-do compile }\n+\n+struct S {\n+  void foo() {\n+     for (_ptr; ;) {}  // { dg-error \"not declared\" }\n+     _ptr = 0;\n+    }\n+};\n+"}]}