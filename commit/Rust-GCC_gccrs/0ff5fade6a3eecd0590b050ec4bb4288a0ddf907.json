{"sha": "0ff5fade6a3eecd0590b050ec4bb4288a0ddf907", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGZmNWZhZGU2YTNlZWNkMDU5MGIwNTBlYzRiYjQyODhhMGRkZjkwNw==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2015-02-19T15:14:24Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2015-02-19T15:14:24Z"}, "message": "re PR middle-end/65074 (r220674 broke C++ PIEs)\n\nPR middle-end/65074\n\n * varasm.c (default_binds_local_p_2): Don't test node->definition;\n test DECL_EXTERNAL independent of symtab_node.\n\nFrom-SVN: r220816", "tree": {"sha": "b58d8a7bbe776f6bbe0c1db3794c30e56b0ff573", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b58d8a7bbe776f6bbe0c1db3794c30e56b0ff573"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0ff5fade6a3eecd0590b050ec4bb4288a0ddf907", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0ff5fade6a3eecd0590b050ec4bb4288a0ddf907", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0ff5fade6a3eecd0590b050ec4bb4288a0ddf907", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0ff5fade6a3eecd0590b050ec4bb4288a0ddf907/comments", "author": null, "committer": null, "parents": [{"sha": "97953c118b29aea7df7428da0da926e79167fbec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97953c118b29aea7df7428da0da926e79167fbec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/97953c118b29aea7df7428da0da926e79167fbec"}], "stats": {"total": 18, "additions": 11, "deletions": 7}, "files": [{"sha": "ac52a2cc6e8d50de3cbc78edc09a094e4fa31d90", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ff5fade6a3eecd0590b050ec4bb4288a0ddf907/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ff5fade6a3eecd0590b050ec4bb4288a0ddf907/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0ff5fade6a3eecd0590b050ec4bb4288a0ddf907", "patch": "@@ -1,3 +1,9 @@\n+2015-02-19  Richard Henderson  <rth@redhat.com>\n+\n+\tPR middle-end/65074\n+\t* varasm.c (default_binds_local_p_2): Don't test node->definition;\n+\ttest DECL_EXTERNAL independent of symtab_node.\n+\n 2015-02-19  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR lto/65012"}, {"sha": "8173207b497f19f006b2089703e57e26efa667b0", "filename": "gcc/varasm.c", "status": "modified", "additions": 5, "deletions": 7, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ff5fade6a3eecd0590b050ec4bb4288a0ddf907/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ff5fade6a3eecd0590b050ec4bb4288a0ddf907/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=0ff5fade6a3eecd0590b050ec4bb4288a0ddf907", "patch": "@@ -6828,20 +6828,18 @@ default_binds_local_p_2 (const_tree exp, bool shlib, bool weak_dominate)\n      because dynamic linking might overwrite symbols\n      in shared libraries.  */\n   bool resolved_locally = false;\n-  bool defined_locally = false;\n+  bool defined_locally = !DECL_EXTERNAL (exp);\n   if (symtab_node *node = symtab_node::get (exp))\n     {\n-      if ((node->definition && !DECL_EXTERNAL (node->decl))\n-\t  || node->in_other_partition)\n-\t{\n-\t  defined_locally = true;\n-\t  resolved_locally = (weak_dominate && !shlib);\n-\t}\n+      if (node->in_other_partition)\n+\tdefined_locally = true;\n       if (resolution_to_local_definition_p (node->resolution))\n \tdefined_locally = resolved_locally = true;\n       else if (resolution_local_p (node->resolution))\n \tresolved_locally = true;\n     }\n+  if (defined_locally && weak_dominate && !shlib)\n+    resolved_locally = true;\n \n   /* Undefined weak symbols are never defined locally.  */\n   if (DECL_WEAK (exp) && !defined_locally)"}]}