{"sha": "36365906b74c92f33668387ae16842ed9d6c1b2a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzYzNjU5MDZiNzRjOTJmMzM2NjgzODdhZTE2ODQyZWQ5ZDZjMWIyYQ==", "commit": {"author": {"name": "Trevor Saunders", "email": "tbsaunde+gcc@tbsaunde.org", "date": "2016-01-13T02:51:11Z"}, "committer": {"name": "Trevor Saunders", "email": "tbsaunde@gcc.gnu.org", "date": "2016-01-13T02:51:11Z"}, "message": "remove mark_hook gty attribute\n\ngcc/ChangeLog:\n\n2016-01-12  Trevor Saunders  <tbsaunde+gcc@tbsaunde.org>\n\n\tPR middle-end/54809\n\t* doc/gty.texi: Remove documentation of mark_hook.\n\t* gengtype.c (struct write_types_data): Remove code to support\n\tmark_hook attribute.\n\t(walk_type): Likewise.\n\t(write_func_for_structure): Likewise.\n\nFrom-SVN: r232309", "tree": {"sha": "90e33426ec03a715686a01015843dc5a555b6afc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/90e33426ec03a715686a01015843dc5a555b6afc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/36365906b74c92f33668387ae16842ed9d6c1b2a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36365906b74c92f33668387ae16842ed9d6c1b2a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/36365906b74c92f33668387ae16842ed9d6c1b2a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36365906b74c92f33668387ae16842ed9d6c1b2a/comments", "author": null, "committer": null, "parents": [{"sha": "bf3f4b389a2e454149a2369f7d60edc9d8a0f9f9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf3f4b389a2e454149a2369f7d60edc9d8a0f9f9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bf3f4b389a2e454149a2369f7d60edc9d8a0f9f9"}], "stats": {"total": 52, "additions": 12, "deletions": 40}, "files": [{"sha": "39fd10776f7f3a434a6f1f6214d6f4e760f94d40", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36365906b74c92f33668387ae16842ed9d6c1b2a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36365906b74c92f33668387ae16842ed9d6c1b2a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=36365906b74c92f33668387ae16842ed9d6c1b2a", "patch": "@@ -1,3 +1,12 @@\n+2016-01-12  Trevor Saunders  <tbsaunde+gcc@tbsaunde.org>\n+\n+\tPR middle-end/54809\n+\t* doc/gty.texi: Remove documentation of mark_hook.\n+\t* gengtype.c (struct write_types_data): Remove code to support\n+\tmark_hook attribute.\n+\t(walk_type): Likewise.\n+\t(write_func_for_structure): Likewise.\n+\n 2016-01-12  Sandra Loosemore <sandra@codesourcery.com>\n \n \t* doc/invoke.texi (Option Summary) Move -no-canonical-prefixes to"}, {"sha": "1a22e4ba13f6787bbcd118bfe518e9624a18eeef", "filename": "gcc/doc/gty.texi", "status": "modified", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36365906b74c92f33668387ae16842ed9d6c1b2a/gcc%2Fdoc%2Fgty.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36365906b74c92f33668387ae16842ed9d6c1b2a/gcc%2Fdoc%2Fgty.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Fgty.texi?ref=36365906b74c92f33668387ae16842ed9d6c1b2a", "patch": "@@ -261,16 +261,6 @@ garbage collection runs, there's no need to mark anything pointed to\n by this variable, it can just be set to @code{NULL} instead.  This is used\n to keep a list of free structures around for re-use.\n \n-@findex mark_hook\n-@item mark_hook (\"@var{hook-routine-name}\")\n-\n-If provided for a structure or union type, the given\n-@var{hook-routine-name} (between double-quotes) is the name of a\n-routine called when the garbage collector has just marked the data as\n-reachable. This routine should not change the data, or call any ggc\n-routine. Its only argument is a pointer to the just marked (const)\n-structure or union.\n-\n @findex maybe_undef\n @item maybe_undef\n "}, {"sha": "be496609dba458b264697f0c54e1ec77e2a0d7e9", "filename": "gcc/gengtype.c", "status": "modified", "additions": 3, "deletions": 30, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36365906b74c92f33668387ae16842ed9d6c1b2a/gcc%2Fgengtype.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36365906b74c92f33668387ae16842ed9d6c1b2a/gcc%2Fgengtype.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgengtype.c?ref=36365906b74c92f33668387ae16842ed9d6c1b2a", "patch": "@@ -2407,7 +2407,6 @@ struct write_types_data\n   const char *marker_routine;\n   const char *reorder_note_routine;\n   const char *comment;\n-  int skip_hooks;\t\t/* skip hook generation if non zero */\n   enum write_types_kinds kind;\n };\n \n@@ -2677,8 +2676,6 @@ walk_type (type_p t, struct walk_type_data *d)\n       maybe_undef_p = 1;\n     else if (strcmp (oo->name, \"desc\") == 0 && oo->kind == OPTION_STRING)\n       desc = oo->info.string;\n-    else if (strcmp (oo->name, \"mark_hook\") == 0)\n-      ;\n     else if (strcmp (oo->name, \"nested_ptr\") == 0 \n \t     && oo->kind == OPTION_NESTED)\n       nested_ptr_d = (const struct nested_ptr_data *) oo->info.nested;\n@@ -2918,7 +2915,6 @@ walk_type (type_p t, struct walk_type_data *d)\n \tconst char *oldval = d->val;\n \tconst char *oldprevval1 = d->prev_val[1];\n \tconst char *oldprevval2 = d->prev_val[2];\n-\tconst char *struct_mark_hook = NULL;\n \tconst int union_p = t->kind == TYPE_UNION;\n \tint seen_default_p = 0;\n \toptions_p o;\n@@ -2942,13 +2938,6 @@ walk_type (type_p t, struct walk_type_data *d)\n \t  if (!desc && strcmp (o->name, \"desc\") == 0\n \t      && o->kind == OPTION_STRING)\n \t    desc = o->info.string;\n-\t  else if (!struct_mark_hook && strcmp (o->name, \"mark_hook\") == 0\n-\t\t   && o->kind == OPTION_STRING)\n-\t    struct_mark_hook = o->info.string;\n-\n-\tif (struct_mark_hook)\n-\t  oprintf (d->of, \"%*s%s (&%s);\\n\",\n-\t\t   d->indent, \"\", struct_mark_hook, oldval);\n \n \td->prev_val[2] = oldval;\n \td->prev_val[1] = oldprevval2;\n@@ -3473,7 +3462,6 @@ write_func_for_structure (type_p orig_s, type_p s,\n   const char *chain_next = NULL;\n   const char *chain_prev = NULL;\n   const char *chain_circular = NULL;\n-  const char *mark_hook_name = NULL;\n   options_p opt;\n   struct walk_type_data d;\n \n@@ -3509,9 +3497,6 @@ write_func_for_structure (type_p orig_s, type_p s,\n     else if (strcmp (opt->name, \"chain_circular\") == 0\n \t     && opt->kind == OPTION_STRING)\n       chain_circular = opt->info.string;\n-    else if (strcmp (opt->name, \"mark_hook\") == 0\n-\t     && opt->kind == OPTION_STRING)\n-      mark_hook_name = opt->info.string;\n     else if (strcmp (opt->name, \"for_user\") == 0)\n       for_user = true;\n   if (chain_prev != NULL && chain_next == NULL)\n@@ -3576,17 +3561,11 @@ write_func_for_structure (type_p orig_s, type_p s,\n       oprintf (d.of, \"))\\n\");\n       if (chain_circular != NULL)\n \toprintf (d.of, \"    return;\\n  do\\n\");\n-      if (mark_hook_name && !wtd->skip_hooks)\n-\t{\n-\t  oprintf (d.of, \"    {\\n\");\n-\t  oprintf (d.of, \"      %s (xlimit);\\n   \", mark_hook_name);\n-\t}\n+\n       oprintf (d.of, \"   xlimit = (\");\n       d.prev_val[2] = \"*xlimit\";\n       output_escaped_param (&d, chain_next, \"chain_next\");\n       oprintf (d.of, \");\\n\");\n-      if (mark_hook_name && !wtd->skip_hooks)\n-\toprintf (d.of, \"    }\\n\");\n       if (chain_prev != NULL)\n \t{\n \t  oprintf (d.of, \"  if (x != xlimit)\\n\");\n@@ -3618,18 +3597,12 @@ write_func_for_structure (type_p orig_s, type_p s,\n \t      output_mangled_typename (d.of, orig_s);\n \t    }\n \t  oprintf (d.of, \"));\\n\");\n-\t  if (mark_hook_name && !wtd->skip_hooks)\n-\t    oprintf (d.of, \"  %s (xlimit);\\n\", mark_hook_name);\n \t  oprintf (d.of, \"  do\\n\");\n \t}\n       else\n \toprintf (d.of, \"  while (x != xlimit)\\n\");\n     }\n   oprintf (d.of, \"    {\\n\");\n-  if (mark_hook_name && chain_next == NULL && !wtd->skip_hooks)\n-    {\n-      oprintf (d.of, \"      %s (x);\\n\", mark_hook_name);\n-    }\n \n   d.prev_val[2] = \"*x\";\n   d.indent = 6;\n@@ -3789,14 +3762,14 @@ write_types (outf_p output_header, type_p structures,\n static const struct write_types_data ggc_wtd = {\n   \"ggc_m\", NULL, \"ggc_mark\", \"ggc_test_and_set_mark\", NULL,\n   \"GC marker procedures.  \",\n-  FALSE, WTK_GGC\n+  WTK_GGC\n };\n \n static const struct write_types_data pch_wtd = {\n   \"pch_n\", \"pch_p\", \"gt_pch_note_object\", \"gt_pch_note_object\",\n   \"gt_pch_note_reorder\",\n   \"PCH type-walking procedures.  \",\n-  TRUE, WTK_PCH\n+  WTK_PCH\n };\n \n /* Write out the local pointer-walking routines.  */"}]}