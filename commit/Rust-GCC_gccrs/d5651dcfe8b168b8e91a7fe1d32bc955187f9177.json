{"sha": "d5651dcfe8b168b8e91a7fe1d32bc955187f9177", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDU2NTFkY2ZlOGIxNjhiOGU5MWE3ZmUxZDMyYmM5NTUxODdmOTE3Nw==", "commit": {"author": {"name": "Doug Evans", "email": "dje@google.com", "date": "2012-11-30T21:53:34Z"}, "committer": {"name": "Doug Evans", "email": "devans@gcc.gnu.org", "date": "2012-11-30T21:53:34Z"}, "message": "validate_failures.py: Add support for @include, @remove directives in manifest files.\n\n\t* testsuite-management/validate_failures.py: Add support for @include,\n\t@remove directives in manifest files.\n\nFrom-SVN: r194008", "tree": {"sha": "2f5f5fe86efcc83808ebfc80fc481c27ba382940", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2f5f5fe86efcc83808ebfc80fc481c27ba382940"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d5651dcfe8b168b8e91a7fe1d32bc955187f9177", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d5651dcfe8b168b8e91a7fe1d32bc955187f9177", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d5651dcfe8b168b8e91a7fe1d32bc955187f9177", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d5651dcfe8b168b8e91a7fe1d32bc955187f9177/comments", "author": null, "committer": null, "parents": [{"sha": "f6fce9517e41866fe436d4dcb3d4bb934ec61d0b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f6fce9517e41866fe436d4dcb3d4bb934ec61d0b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f6fce9517e41866fe436d4dcb3d4bb934ec61d0b"}], "stats": {"total": 75, "additions": 70, "deletions": 5}, "files": [{"sha": "cc1c8df33136e6b1d8f81a3419fd4c5b4cafcfef", "filename": "contrib/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5651dcfe8b168b8e91a7fe1d32bc955187f9177/contrib%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5651dcfe8b168b8e91a7fe1d32bc955187f9177/contrib%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2FChangeLog?ref=d5651dcfe8b168b8e91a7fe1d32bc955187f9177", "patch": "@@ -1,5 +1,8 @@\n 2012-11-30  Doug Evans  <dje@google.com>\n \n+\t* testsuite-management/validate_failures.py: Add support for @include,\n+\t@remove directives in manifest files.\n+\n \t* testsuite-management/validate_failures.py: Add function\n \tGetManifestPath.  New global _MANIFEST_SUBDIR.\n "}, {"sha": "483f466b040892a3de034e398bb8e7b716ad2671", "filename": "contrib/testsuite-management/validate_failures.py", "status": "modified", "additions": 67, "deletions": 5, "changes": 72, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5651dcfe8b168b8e91a7fe1d32bc955187f9177/contrib%2Ftestsuite-management%2Fvalidate_failures.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5651dcfe8b168b8e91a7fe1d32bc955187f9177/contrib%2Ftestsuite-management%2Fvalidate_failures.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Ftestsuite-management%2Fvalidate_failures.py?ref=d5651dcfe8b168b8e91a7fe1d32bc955187f9177", "patch": "@@ -44,6 +44,14 @@\n    b- Failures in the build not expected in the manifest.\n 6- If all the build failures are expected in the manifest, it exits\n    with exit code 0.  Otherwise, it exits with error code 1.\n+\n+Manifest files contain expected DejaGNU results that are otherwise\n+treated as failures.\n+They may also contain additional text:\n+\n+# This is a comment.  - self explanatory\n+@include file         - the file is a path relative to the includer\n+@remove result text   - result text is removed from the expected set\n \"\"\"\n \n import datetime\n@@ -192,11 +200,13 @@ def ValidBuildDirectory(builddir, target):\n   return True\n \n \n+def IsComment(line):\n+  \"\"\"Return True if line is a comment.\"\"\"\n+  return line.startswith('#')\n+\n+\n def IsInterestingResult(line):\n-  \"\"\"Return True if the given line is one of the summary lines we care about.\"\"\"\n-  line = line.strip()\n-  if line.startswith('#'):\n-    return False\n+  \"\"\"Return True if line is one of the summary lines we care about.\"\"\"\n   if '|' in line:\n     (_, line) = line.split('|', 1)\n   line = line.strip()\n@@ -206,6 +216,58 @@ def IsInterestingResult(line):\n   return False\n \n \n+def IsInclude(line):\n+  \"\"\"Return True if line is an include of another file.\"\"\"\n+  return line.startswith(\"@include \")\n+\n+\n+def GetIncludeFile(line, includer):\n+  \"\"\"Extract the name of the include file from line.\"\"\"\n+  includer_dir = os.path.dirname(includer)\n+  include_file = line[len(\"@include \"):]\n+  return os.path.join(includer_dir, include_file.strip())\n+\n+\n+def IsNegativeResult(line):\n+  \"\"\"Return True if line should be removed from the expected results.\"\"\"\n+  return line.startswith(\"@remove \")\n+\n+\n+def GetNegativeResult(line):\n+  \"\"\"Extract the name of the negative result from line.\"\"\"\n+  line = line[len(\"@remove \"):]\n+  return line.strip()\n+\n+\n+def ParseManifestWorker(result_set, manifest_path):\n+  \"\"\"Read manifest_path, adding the contents to result_set.\"\"\"\n+  if options.verbosity >= 1:\n+    print 'Parsing manifest file %s.' % manifest_path\n+  manifest_file = open(manifest_path)\n+  for line in manifest_file:\n+    line = line.strip()\n+    if line == \"\":\n+      pass\n+    elif IsComment(line):\n+      pass\n+    elif IsNegativeResult(line):\n+      result_set.remove(TestResult(GetNegativeResult(line)))\n+    elif IsInclude(line):\n+      ParseManifestWorker(result_set, GetIncludeFile(line, manifest_path))\n+    elif IsInterestingResult(line):\n+      result_set.add(TestResult(line))\n+    else:\n+      Error('Unrecognized line in manifest file: %s' % line)\n+  manifest_file.close()\n+\n+\n+def ParseManifest(manifest_path):\n+  \"\"\"Create a set of TestResult instances from the given manifest file.\"\"\"\n+  result_set = set()\n+  ParseManifestWorker(result_set, manifest_path)\n+  return result_set\n+\n+\n def ParseSummary(sum_fname):\n   \"\"\"Create a set of TestResult instances from the given summary file.\"\"\"\n   result_set = set()\n@@ -237,7 +299,7 @@ def GetManifest(manifest_path):\n   If no manifest file exists for this target, it returns an empty set.\n   \"\"\"\n   if os.path.exists(manifest_path):\n-    return ParseSummary(manifest_path)\n+    return ParseManifest(manifest_path)\n   else:\n     return set()\n "}]}