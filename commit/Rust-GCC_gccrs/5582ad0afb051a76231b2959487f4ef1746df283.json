{"sha": "5582ad0afb051a76231b2959487f4ef1746df283", "node_id": "C_kwDOANBUbNoAKDU1ODJhZDBhZmIwNTFhNzYyMzFiMjk1OTQ4N2Y0ZWYxNzQ2ZGYyODM", "commit": {"author": {"name": "Kewen Lin", "email": "linkw@linux.ibm.com", "date": "2023-04-12T02:51:40Z"}, "committer": {"name": "Kewen Lin", "email": "linkw@linux.ibm.com", "date": "2023-04-12T02:51:40Z"}, "message": "testsuite: Adjust powerpc pr83677.c for BE [PR108815]\n\nThe test case gcc.target/powerpc/pr83677.c was written for\nLE environment, this patch is to make it work on BE as well.\n\n\tPR testsuite/108815\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/powerpc/pr83677.c (v_expand_u8, v_expand_u16,\n\tv_load_deinterleave_f32, v_store_interleave_f32): Adjust some code by\n\tconsidering BE.", "tree": {"sha": "f60810056d8817554bbf9eb615aa002fce92c12d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f60810056d8817554bbf9eb615aa002fce92c12d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5582ad0afb051a76231b2959487f4ef1746df283", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5582ad0afb051a76231b2959487f4ef1746df283", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5582ad0afb051a76231b2959487f4ef1746df283", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5582ad0afb051a76231b2959487f4ef1746df283/comments", "author": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e2073672aec0b58700fc7fa5f48b76b9d66c5c17", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2073672aec0b58700fc7fa5f48b76b9d66c5c17", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e2073672aec0b58700fc7fa5f48b76b9d66c5c17"}], "stats": {"total": 30, "additions": 27, "deletions": 3}, "files": [{"sha": "8b1caff3f98c5424c7898eb63a31c3620e305e47", "filename": "gcc/testsuite/gcc.target/powerpc/pr83677.c", "status": "modified", "additions": 27, "deletions": 3, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5582ad0afb051a76231b2959487f4ef1746df283/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr83677.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5582ad0afb051a76231b2959487f4ef1746df283/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr83677.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr83677.c?ref=5582ad0afb051a76231b2959487f4ef1746df283", "patch": "@@ -9,14 +9,24 @@\n \n void v_expand_u8(vector unsigned char* a, vector unsigned short* b0, vector unsigned short* b1)\n {\n+#if __LITTLE_ENDIAN__\n   *b0 = (vector unsigned short)vec_mergeh(*a, vec_splats((unsigned char)0));\n   *b1 = (vector unsigned short)vec_mergel(*a, vec_splats((unsigned char)0));\n+#else\n+  *b0 = (vector unsigned short)vec_mergeh(vec_splats((unsigned char)0), *a);\n+  *b1 = (vector unsigned short)vec_mergel(vec_splats((unsigned char)0), *a);\n+#endif\n }\n \n void v_expand_u16(vector unsigned short* a, vector unsigned int* b0, vector unsigned int* b1)\n {\n+#if __LITTLE_ENDIAN__\n     *b0 = (vector unsigned int)vec_mergeh(*a, vec_splats((unsigned short)0));\n     *b1 = (vector unsigned int)vec_mergel(*a, vec_splats((unsigned short)0));\n+#else\n+    *b0 = (vector unsigned int)vec_mergeh(vec_splats((unsigned short)0), *a);\n+    *b1 = (vector unsigned int)vec_mergel(vec_splats((unsigned short)0), *a);\n+#endif\n }\n \n void v_load_deinterleave_u8(unsigned char *ptr, vector unsigned char* a, vector unsigned char* b, vector unsigned char* c)\n@@ -44,13 +54,23 @@ void v_load_deinterleave_f32(float *ptr, vector float* a, vector float* b, vecto\n     vector float v2 = vec_xl(16, ptr);\n     vector float v3 = vec_xl(32, ptr);\n \n+#if __LITTLE_ENDIAN__\n+    vector float t1 = vec_sld(v3, v2, 8);\n+    vector float t2 = vec_sld(v1, v3, 8);\n+    vector float t3 = vec_sld(v2, v1, 8);\n+#else\n+    vector float t1 = vec_sld(v2, v3, 8);\n+    vector float t2 = vec_sld(v3, v1, 8);\n+    vector float t3 = vec_sld(v1, v2, 8);\n+#endif\n+\n     static const vector unsigned char flp = {0, 1, 2, 3, 12, 13, 14, 15, 16, 17, 18, 19, 28, 29, 30, 31};\n-    *a = vec_perm(v1, vec_sld(v3, v2, 8), flp);\n+    *a = vec_perm(v1, t1, flp);\n \n     static const vector unsigned char flp2 = {28, 29, 30, 31, 0, 1, 2, 3, 12, 13, 14, 15, 16, 17, 18, 19};\n-    *b = vec_perm(v2, vec_sld(v1, v3, 8), flp2);\n+    *b = vec_perm(v2, t2, flp2);\n \n-    *c = vec_perm(vec_sld(v2, v1, 8), v3, flp);\n+    *c = vec_perm(t3, v3, flp);\n }\n \n void v_store_interleave_f32(float *ptr, vector float a, vector float b, vector float c)\n@@ -61,7 +81,11 @@ void v_store_interleave_f32(float *ptr, vector float a, vector float b, vector f\n     vec_xst(vec_perm(a, hbc, ahbc),  0, ptr);\n \n     vector float lab = vec_mergel(a, b);\n+#if __LITTLE_ENDIAN__\n     vec_xst(vec_sld(lab, hbc, 8), 16, ptr);\n+#else\n+    vec_xst(vec_sld(hbc, lab, 8), 16, ptr);\n+#endif\n \n     static const vector unsigned char clab = {8, 9, 10, 11, 24, 25, 26, 27, 28, 29, 30, 31, 12, 13, 14, 15};\n     vec_xst(vec_perm(c, lab, clab), 32, ptr);"}]}