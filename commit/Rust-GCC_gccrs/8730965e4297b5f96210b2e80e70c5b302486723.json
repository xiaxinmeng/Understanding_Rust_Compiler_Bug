{"sha": "8730965e4297b5f96210b2e80e70c5b302486723", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODczMDk2NWU0Mjk3YjVmOTYyMTBiMmU4MGU3MGM1YjMwMjQ4NjcyMw==", "commit": {"author": {"name": "Patrick Marlier", "email": "pmarlier@gcc.gnu.org", "date": "2012-05-17T02:57:56Z"}, "committer": {"name": "Patrick Marlier", "email": "pmarlier@gcc.gnu.org", "date": "2012-05-17T02:57:56Z"}, "message": "[multiple changes]\n\n2012-05-16  Dave Boutcher  <daveboutcher@gmail.com>\n\t    Patrick Marlier  <patrick.marlier@gmail.com>\n\n\t* trans-mem.c (ipa_tm_transform_clone): Transform functions with\n\tindirect calls.\n\ntestsuite/\n2012-05-16  Patrick Marlier  <patrick.marlier@gmail.com>\n\n\t* gcc.dg/tm/indirect-2.c: New test.\n\nFrom-SVN: r187621", "tree": {"sha": "734f60a84f1033bf4846899994016b28cf532b76", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/734f60a84f1033bf4846899994016b28cf532b76"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8730965e4297b5f96210b2e80e70c5b302486723", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8730965e4297b5f96210b2e80e70c5b302486723", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8730965e4297b5f96210b2e80e70c5b302486723", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8730965e4297b5f96210b2e80e70c5b302486723/comments", "author": null, "committer": null, "parents": [{"sha": "e2f7d9f4adb2178545bed99657c45c4c76bcbbb5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2f7d9f4adb2178545bed99657c45c4c76bcbbb5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e2f7d9f4adb2178545bed99657c45c4c76bcbbb5"}], "stats": {"total": 27, "additions": 26, "deletions": 1}, "files": [{"sha": "f4ddc3a2082705414bb74e28cc9687ac687300a5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8730965e4297b5f96210b2e80e70c5b302486723/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8730965e4297b5f96210b2e80e70c5b302486723/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8730965e4297b5f96210b2e80e70c5b302486723", "patch": "@@ -1,3 +1,9 @@\n+2012-05-16  Dave Boutcher  <daveboutcher@gmail.com>\n+\t    Patrick Marlier  <patrick.marlier@gmail.com>\n+\n+\t* trans-mem.c (ipa_tm_transform_clone): Transform functions with\n+\tindirect calls.\n+\n 2012-05-16  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* configure: Regenerated."}, {"sha": "2c33c31e89677ad5a37a77a4e27d9af047c797a9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8730965e4297b5f96210b2e80e70c5b302486723/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8730965e4297b5f96210b2e80e70c5b302486723/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8730965e4297b5f96210b2e80e70c5b302486723", "patch": "@@ -1,3 +1,7 @@\n+2012-05-16  Patrick Marlier  <patrick.marlier@gmail.com> \n+\n+\t* gcc.dg/tm/indirect-2.c: New test. \n+\n 2012-05-16  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n \n \tPR tree-optimization/53217"}, {"sha": "dd7168f0519476af2533ec81ce0e067bd12feb6b", "filename": "gcc/testsuite/gcc.dg/tm/indirect-2.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8730965e4297b5f96210b2e80e70c5b302486723/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Findirect-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8730965e4297b5f96210b2e80e70c5b302486723/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Findirect-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Findirect-2.c?ref=8730965e4297b5f96210b2e80e70c5b302486723", "patch": "@@ -0,0 +1,15 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-fgnu-tm\" } */\n+\n+void __attribute__((transaction_safe))\n+foo(void);\n+\n+void __attribute__((transaction_safe))\n+set_fn(void)\n+{\n+  void __attribute__((transaction_safe)) (*fn)(void);\n+  fn = foo;\n+  fn();\n+}\n+\n+/* { dg-final { scan-assembler \"_ITM_getTMCloneSafe\" } } */"}, {"sha": "51dd7fe13eda5dd53ce1d32f9a1d712408681a29", "filename": "gcc/trans-mem.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8730965e4297b5f96210b2e80e70c5b302486723/gcc%2Ftrans-mem.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8730965e4297b5f96210b2e80e70c5b302486723/gcc%2Ftrans-mem.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftrans-mem.c?ref=8730965e4297b5f96210b2e80e70c5b302486723", "patch": "@@ -4732,7 +4732,7 @@ ipa_tm_transform_clone (struct cgraph_node *node)\n   /* If this function makes no calls and has no irrevocable blocks,\n      then there's nothing to do.  */\n   /* ??? Remove non-aborting top-level transactions.  */\n-  if (!node->callees && !d->irrevocable_blocks_clone)\n+  if (!node->callees && !node->indirect_calls && !d->irrevocable_blocks_clone)\n     return;\n \n   current_function_decl = d->clone->symbol.decl;"}]}