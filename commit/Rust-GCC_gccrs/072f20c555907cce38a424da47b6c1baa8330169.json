{"sha": "072f20c555907cce38a424da47b6c1baa8330169", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDcyZjIwYzU1NTkwN2NjZTM4YTQyNGRhNDdiNmMxYmFhODMzMDE2OQ==", "commit": {"author": {"name": "Kito Cheng", "email": "kito.cheng@sifive.com", "date": "2021-01-28T10:29:53Z"}, "committer": {"name": "Kito Cheng", "email": "kito.cheng@sifive.com", "date": "2021-02-05T06:26:16Z"}, "message": "PR target/98878 - Incorrect multilib list for riscv*-rtems\n\n - Multi-lib only check the default argument is appeared in the multilib\n   flag list, but we didn't check the case that the flag is required but\n   default argument didn't provide.\n\n - For example riscv*-rtems has a multilib set:\n\n     rv32imafd/ilp32d;@march=rv32imafd@mabi=ilp32d\n\n   And when we set the default argument of arch to rv32imafdc and ABI to\n   ilp32d, gcc will check the ilp32d is matched, but it didn't check\n   rv32imafd is not provided by default arguments, so it should not\n   reuse default library.\n\n - The side effcet of this patch is csky-elf target will increase the\n   number of multilib from 54 to 59, but it's because genmultilib didn't\n   know the default argument for multilib, so I think it could be\n   improved in future.\n\ngcc/ChangeLog:\n\n\t* gcc.c (print_multilib_info): Check all required argument is provided\n\tby default arg.", "tree": {"sha": "43ccf27e79921db02fa15d9e2bbfe906308cc355", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/43ccf27e79921db02fa15d9e2bbfe906308cc355"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/072f20c555907cce38a424da47b6c1baa8330169", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/072f20c555907cce38a424da47b6c1baa8330169", "html_url": "https://github.com/Rust-GCC/gccrs/commit/072f20c555907cce38a424da47b6c1baa8330169", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/072f20c555907cce38a424da47b6c1baa8330169/comments", "author": {"login": "kito-cheng", "id": 2723185, "node_id": "MDQ6VXNlcjI3MjMxODU=", "avatar_url": "https://avatars.githubusercontent.com/u/2723185?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kito-cheng", "html_url": "https://github.com/kito-cheng", "followers_url": "https://api.github.com/users/kito-cheng/followers", "following_url": "https://api.github.com/users/kito-cheng/following{/other_user}", "gists_url": "https://api.github.com/users/kito-cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/kito-cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kito-cheng/subscriptions", "organizations_url": "https://api.github.com/users/kito-cheng/orgs", "repos_url": "https://api.github.com/users/kito-cheng/repos", "events_url": "https://api.github.com/users/kito-cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/kito-cheng/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kito-cheng", "id": 2723185, "node_id": "MDQ6VXNlcjI3MjMxODU=", "avatar_url": "https://avatars.githubusercontent.com/u/2723185?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kito-cheng", "html_url": "https://github.com/kito-cheng", "followers_url": "https://api.github.com/users/kito-cheng/followers", "following_url": "https://api.github.com/users/kito-cheng/following{/other_user}", "gists_url": "https://api.github.com/users/kito-cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/kito-cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kito-cheng/subscriptions", "organizations_url": "https://api.github.com/users/kito-cheng/orgs", "repos_url": "https://api.github.com/users/kito-cheng/repos", "events_url": "https://api.github.com/users/kito-cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/kito-cheng/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d0737d8f4b10bffe0411507ad2dc21ba7679883", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d0737d8f4b10bffe0411507ad2dc21ba7679883", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d0737d8f4b10bffe0411507ad2dc21ba7679883"}], "stats": {"total": 27, "additions": 21, "deletions": 6}, "files": [{"sha": "76f1d422f9a0264d1d13a7f9a9617df86788726b", "filename": "gcc/gcc.c", "status": "modified", "additions": 21, "deletions": 6, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/072f20c555907cce38a424da47b6c1baa8330169/gcc%2Fgcc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/072f20c555907cce38a424da47b6c1baa8330169/gcc%2Fgcc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgcc.c?ref=072f20c555907cce38a424da47b6c1baa8330169", "patch": "@@ -9909,12 +9909,14 @@ print_multilib_info (void)\n \t  last_path_len = p - this_path;\n \t}\n \n-      /* If this directory requires any default arguments, we can skip\n-\t it.  We will already have printed a directory identical to\n-\t this one which does not require that default argument.  */\n+      /* If all required arguments are default arguments, and no default\n+\t arguments appear in the ! argument list, then we can skip it.\n+\t We will already have printed a directory identical to this one\n+\t which does not require that default argument.  */\n       if (! skip)\n \t{\n \t  const char *q;\n+\t  bool default_arg_ok = false;\n \n \t  q = p + 1;\n \t  while (*q != ';')\n@@ -9946,16 +9948,29 @@ print_multilib_info (void)\n \t\t     list.  */\n \t\t  if (not_arg)\n \t\t    {\n-\t\t      skip = 0;\n+\t\t      default_arg_ok = false;\n \t\t      break;\n \t\t    }\n-\t\t  else\n-\t\t    skip = 1;\n+\n+\t\t  default_arg_ok = true;\n+\t\t}\n+\t      else if (!not_arg)\n+\t\t{\n+\t\t  /* Stop checking if any required argument is not provided by\n+\t\t     default arguments.  */\n+\t\t  default_arg_ok = false;\n+\t\t  break;\n \t\t}\n \n \t      if (*q == ' ')\n \t\t++q;\n \t    }\n+\n+\t  /* Make sure all default argument is OK for this multi-lib set.  */\n+\t  if (default_arg_ok)\n+\t    skip = 1;\n+\t  else\n+\t    skip = 0;\n \t}\n \n       if (! skip)"}]}