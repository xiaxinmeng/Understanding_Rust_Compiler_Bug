{"sha": "d88382176e53eca7552e29b7bb88ae4efd72a39d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDg4MzgyMTc2ZTUzZWNhNzU1MmUyOWI3YmI4OGFlNGVmZDcyYTM5ZA==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2017-06-09T07:38:52Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2017-06-09T07:38:52Z"}, "message": "Come up with selftests for predict.c.\n\n2017-06-09  Martin Liska  <mliska@suse.cz>\n\n\t* predict.c (struct branch_predictor): New struct.\n\t(test_prediction_value_range): New test.\n\t(predict_c_tests): New function.\n\t* selftest-run-tests.c (selftest::run_tests): Run the function.\n\t* selftest.h: Declare new tests.\n\nFrom-SVN: r249048", "tree": {"sha": "e7548f278250e87e028751c87a71c1597f22efae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e7548f278250e87e028751c87a71c1597f22efae"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d88382176e53eca7552e29b7bb88ae4efd72a39d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d88382176e53eca7552e29b7bb88ae4efd72a39d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d88382176e53eca7552e29b7bb88ae4efd72a39d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d88382176e53eca7552e29b7bb88ae4efd72a39d/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1ee77fbdea58944b047de8ff88901aea4e93ed7d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ee77fbdea58944b047de8ff88901aea4e93ed7d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ee77fbdea58944b047de8ff88901aea4e93ed7d"}], "stats": {"total": 54, "additions": 54, "deletions": 0}, "files": [{"sha": "ded979703ad5521e0d25f716b265e97abc4568c8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d88382176e53eca7552e29b7bb88ae4efd72a39d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d88382176e53eca7552e29b7bb88ae4efd72a39d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d88382176e53eca7552e29b7bb88ae4efd72a39d", "patch": "@@ -1,3 +1,11 @@\n+2017-06-09  Martin Liska  <mliska@suse.cz>\n+\n+\t* predict.c (struct branch_predictor): New struct.\n+\t(test_prediction_value_range): New test.\n+\t(predict_c_tests): New function.\n+\t* selftest-run-tests.c (selftest::run_tests): Run the function.\n+\t* selftest.h: Declare new tests.\n+\n 2017-06-09  Segher Boessenkool  <segher@kernel.crashing.org>\n \n \tPR target/80966"}, {"sha": "ca40068c150777e22e7198364b4d0eac84b550a6", "filename": "gcc/predict.c", "status": "modified", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d88382176e53eca7552e29b7bb88ae4efd72a39d/gcc%2Fpredict.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d88382176e53eca7552e29b7bb88ae4efd72a39d/gcc%2Fpredict.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpredict.c?ref=d88382176e53eca7552e29b7bb88ae4efd72a39d", "patch": "@@ -57,6 +57,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"tree-scalar-evolution.h\"\n #include \"ipa-utils.h\"\n #include \"gimple-pretty-print.h\"\n+#include \"selftest.h\"\n \n /* Enum with reasons why a predictor is ignored.  */\n \n@@ -4016,3 +4017,46 @@ force_edge_cold (edge e, bool impossible)\n \t\t impossible ? \"impossible\" : \"cold\");\n     }\n }\n+\n+#if CHECKING_P\n+\n+namespace selftest {\n+\n+/* Test that value range of predictor values defined in predict.def is\n+   within range (50, 100].  */\n+\n+struct branch_predictor\n+{\n+  const char *name;\n+  unsigned probability;\n+};\n+\n+#define DEF_PREDICTOR(ENUM, NAME, HITRATE, FLAGS) { NAME, HITRATE },\n+\n+static void\n+test_prediction_value_range ()\n+{\n+  branch_predictor predictors[] = {\n+#include \"predict.def\"\n+    {NULL, -1}\n+  };\n+\n+  for (unsigned i = 0; predictors[i].name != NULL; i++)\n+    {\n+      unsigned p = 100 * predictors[i].probability / REG_BR_PROB_BASE;\n+      ASSERT_TRUE (p > 50 && p <= 100);\n+    }\n+}\n+\n+#undef DEF_PREDICTOR\n+\n+/* Run all of the selfests within this file.  */\n+\n+void\n+predict_c_tests ()\n+{\n+  test_prediction_value_range ();\n+}\n+\n+} // namespace selftest\n+#endif /* CHECKING_P.  */"}, {"sha": "30e476d14c5da02d2e2873accf1c358d04e06a63", "filename": "gcc/selftest-run-tests.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d88382176e53eca7552e29b7bb88ae4efd72a39d/gcc%2Fselftest-run-tests.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d88382176e53eca7552e29b7bb88ae4efd72a39d/gcc%2Fselftest-run-tests.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fselftest-run-tests.c?ref=d88382176e53eca7552e29b7bb88ae4efd72a39d", "patch": "@@ -92,6 +92,7 @@ selftest::run_tests ()\n     targetm.run_target_selftests ();\n \n   store_merging_c_tests ();\n+  predict_c_tests ();\n \n   /* Run any lang-specific selftests.  */\n   lang_hooks.run_lang_selftests ();"}, {"sha": "0572fefd2812159d6a3083a995d5f0d4963f81e8", "filename": "gcc/selftest.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d88382176e53eca7552e29b7bb88ae4efd72a39d/gcc%2Fselftest.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d88382176e53eca7552e29b7bb88ae4efd72a39d/gcc%2Fselftest.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fselftest.h?ref=d88382176e53eca7552e29b7bb88ae4efd72a39d", "patch": "@@ -196,6 +196,7 @@ extern void tree_c_tests ();\n extern void tree_cfg_c_tests ();\n extern void vec_c_tests ();\n extern void wide_int_cc_tests ();\n+extern void predict_c_tests ();\n \n extern int num_passes;\n "}]}