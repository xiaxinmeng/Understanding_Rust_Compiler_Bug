{"sha": "205f5ac60a175bc1739ef4edba1751c50d2aaa89", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjA1ZjVhYzYwYTE3NWJjMTczOWVmNGVkYmExNzUxYzUwZDJhYWE4OQ==", "commit": {"author": {"name": "Alexandre Oliva", "email": "aoliva@redhat.com", "date": "2000-09-10T08:04:40Z"}, "committer": {"name": "Alexandre Oliva", "email": "aoliva@gcc.gnu.org", "date": "2000-09-10T08:04:40Z"}, "message": "* Updated from libtool multi-language branch.\n\nFrom-SVN: r36295", "tree": {"sha": "a4fd9fbd2edd47490b8d1386b9db7942536ab0d8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a4fd9fbd2edd47490b8d1386b9db7942536ab0d8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/205f5ac60a175bc1739ef4edba1751c50d2aaa89", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/205f5ac60a175bc1739ef4edba1751c50d2aaa89", "html_url": "https://github.com/Rust-GCC/gccrs/commit/205f5ac60a175bc1739ef4edba1751c50d2aaa89", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/205f5ac60a175bc1739ef4edba1751c50d2aaa89/comments", "author": null, "committer": null, "parents": [{"sha": "8a24138dca956850680b5c573c443222127a65ff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a24138dca956850680b5c573c443222127a65ff", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8a24138dca956850680b5c573c443222127a65ff"}], "stats": {"total": 6091, "additions": 4425, "deletions": 1666}, "files": [{"sha": "a013585e5d5295708b6e43d902b093ca421a4a1f", "filename": "libjava/libltdl/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Flibltdl%2FChangeLog?ref=205f5ac60a175bc1739ef4edba1751c50d2aaa89", "patch": "@@ -1,3 +1,7 @@\n+2000-09-10  Alexandre Oliva  <aoliva@redhat.com>\n+\n+\t* Updated from libtool multi-language branch.\n+\n 2000-02-14  Tom Tromey  <tromey@cygnus.com>\n \n \t* ltdl.c: If HAVE_BOEHM_GC defined, includ gc.h."}, {"sha": "78500297830804eec669da84b2bc3493485dbc40", "filename": "libjava/libltdl/Makefile.am", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Flibltdl%2FMakefile.am?ref=205f5ac60a175bc1739ef4edba1751c50d2aaa89", "patch": "@@ -16,7 +16,7 @@ noinst_LTLIBRARIES = libltdlc.la\n endif\n \n libltdl_la_SOURCES = ltdl.c\n-libltdl_la_LDFLAGS = -version-info 1:2:1\n+libltdl_la_LDFLAGS = -no-undefined -version-info 2:0:2\n libltdl_la_LIBADD = $(LIBADD_DL)\n \n libltdlc_la_SOURCES = ltdl.c"}, {"sha": "bfea1574b6bd3787bd9d56040f1aa368208671a8", "filename": "libjava/libltdl/Makefile.in", "status": "modified", "additions": 25, "deletions": 15, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Flibltdl%2FMakefile.in?ref=205f5ac60a175bc1739ef4edba1751c50d2aaa89", "patch": "@@ -61,31 +61,38 @@ host_alias = @host_alias@\n host_triplet = @host@\n AS = @AS@\n CC = @CC@\n+CXX = @CXX@\n+CXXCPP = @CXXCPP@\n DLLTOOL = @DLLTOOL@\n+EXEEXT = @EXEEXT@\n GCINCS = @GCINCS@\n+GCJ = @GCJ@\n+GCJFLAGS = @GCJFLAGS@\n LIBADD_DL = @LIBADD_DL@\n LIBTOOL = @LIBTOOL@\n LIBTOOL_DEPS = @LIBTOOL_DEPS@\n LN_S = @LN_S@\n MAINT = @MAINT@\n MAKEINFO = @MAKEINFO@\n OBJDUMP = @OBJDUMP@\n+OBJEXT = @OBJEXT@\n PACKAGE = @PACKAGE@\n RANLIB = @RANLIB@\n+STRIP = @STRIP@\n VERSION = @VERSION@\n \n-AUTOMAKE_OPTIONS = no-dependencies foreign no-installinfo\n+AUTOMAKE_OPTIONS = no-dependencies foreign\n \n INCLUDES = $(GCINCS)\n \n-@INSTALL_LTDL_TRUE@include_HEADERS = @INSTALL_LTDL_TRUE@ltdl.h\n-@INSTALL_LTDL_TRUE@lib_LTLIBRARIES = @INSTALL_LTDL_TRUE@libltdl.la\n-@INSTALL_LTDL_FALSE@noinst_HEADERS = @INSTALL_LTDL_FALSE@ltdl.h\n+@INSTALL_LTDL_TRUE@include_HEADERS = ltdl.h\n+@INSTALL_LTDL_TRUE@lib_LTLIBRARIES = libltdl.la\n+@INSTALL_LTDL_FALSE@noinst_HEADERS = ltdl.h\n \n-@CONVENIENCE_LTDL_TRUE@noinst_LTLIBRARIES = @CONVENIENCE_LTDL_TRUE@libltdlc.la\n+@CONVENIENCE_LTDL_TRUE@noinst_LTLIBRARIES = libltdlc.la\n \n libltdl_la_SOURCES = ltdl.c\n-libltdl_la_LDFLAGS = -version-info 1:2:1\n+libltdl_la_LDFLAGS = -no-undefined -version-info 2:0:2\n libltdl_la_LIBADD = $(LIBADD_DL)\n \n libltdlc_la_SOURCES = ltdl.c\n@@ -127,7 +134,7 @@ OBJECTS = $(libltdl_la_OBJECTS) $(libltdlc_la_OBJECTS)\n \n all: all-redirect\n .SUFFIXES:\n-.SUFFIXES: .S .c .lo .o .s\n+.SUFFIXES: .S .c .lo .o .obj .s\n $(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) \n \tcd $(top_srcdir) && $(AUTOMAKE) --foreign Makefile\n \n@@ -208,6 +215,11 @@ maintainer-clean-noinstLTLIBRARIES:\n .c.o:\n \t$(COMPILE) -c $<\n \n+# FIXME: We should only use cygpath when building on Windows,\n+# and only if it is available.\n+.c.obj:\n+\t$(COMPILE) -c `cygpath -w $<`\n+\n .s.o:\n \t$(COMPILE) -c $<\n \n@@ -216,6 +228,7 @@ maintainer-clean-noinstLTLIBRARIES:\n \n mostlyclean-compile:\n \t-rm -f *.o core *.core\n+\t-rm -f *.$(OBJEXT)\n \n clean-compile:\n \n@@ -349,8 +362,6 @@ check-am: all-am\n check: check-am\n installcheck-am:\n installcheck: installcheck-am\n-install-info-am: \n-install-info: install-info-am\n all-recursive-am: config.h\n \t$(MAKE) $(AM_MAKEFLAGS) all-recursive\n \n@@ -427,12 +438,11 @@ maintainer-clean-compile mostlyclean-libtool distclean-libtool \\\n clean-libtool maintainer-clean-libtool uninstall-includeHEADERS \\\n install-includeHEADERS tags mostlyclean-tags distclean-tags clean-tags \\\n maintainer-clean-tags distdir info-am info dvi-am dvi check check-am \\\n-installcheck-am installcheck install-info-am install-info \\\n-all-recursive-am install-exec-am install-exec install-data-am \\\n-install-data install-am install uninstall-am uninstall all-redirect \\\n-all-am all installdirs mostlyclean-generic distclean-generic \\\n-clean-generic maintainer-clean-generic clean mostlyclean distclean \\\n-maintainer-clean\n+installcheck-am installcheck all-recursive-am install-exec-am \\\n+install-exec install-data-am install-data install-am install \\\n+uninstall-am uninstall all-redirect all-am all installdirs \\\n+mostlyclean-generic distclean-generic clean-generic \\\n+maintainer-clean-generic clean mostlyclean distclean maintainer-clean\n \n \n ltdl.lo: ltdl.h config.h"}, {"sha": "b838418322ee6cd55c1b6a9e6515b6d93466d006", "filename": "libjava/libltdl/acinclude.m4", "status": "modified", "additions": 903, "deletions": 44, "changes": 947, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2Facinclude.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2Facinclude.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Flibltdl%2Facinclude.m4?ref=205f5ac60a175bc1739ef4edba1751c50d2aaa89", "patch": "@@ -1,5 +1,5 @@\n-## libtool.m4 - Configure libtool for the target system. -*-Shell-script-*-\n-## Copyright (C) 1996-1999 Free Software Foundation, Inc.\n+## libtool.m4 - Configure libtool for the host system. -*-Shell-script-*-\n+## Copyright (C) 1996-1999,2000 Free Software Foundation, Inc.\n ## Originally by Gordon Matzigkeit <gord@gnu.ai.mit.edu>, 1996\n ##\n ## This program is free software; you can redistribute it and/or modify\n@@ -21,27 +21,53 @@\n ## configuration script generated by Autoconf, you may include it under\n ## the same distribution terms that you use for the rest of that program.\n \n-# serial 40 AC_PROG_LIBTOOL\n-AC_DEFUN(AC_PROG_LIBTOOL,\n+# serial 45 AC_PROG_LIBTOOL\n+AC_DEFUN(AC_PROG_LIBTOOL,[AC_REQUIRE([_AC_PROG_LIBTOOL])\n+dnl If AC_PROG_CXX has already been expanded, run AC_LIBTOOL_CXX\n+dnl immediately, otherwise, hook it in at the end of AC_PROG_CXX.\n+  AC_PROVIDE_IFELSE([AC_PROG_CXX],\n+    [AC_LIBTOOL_CXX],\n+    [define([AC_PROG_CXX], defn([AC_PROG_CXX])[AC_LIBTOOL_CXX\n+])])\n+\n+dnl Quote A][M_PROG_GCJ so that aclocal doesn't bring it in needlessly.\n+dnl If either AC_PROG_GCJ or A][M_PROG_GCJ have already been expanded, run\n+dnl AC_LIBTOOL_GCJ immediately, otherwise, hook it in at the end of both.\n+  AC_PROVIDE_IFELSE([AC_PROG_GCJ],\n+    [AC_LIBTOOL_GCJ],\n+    [AC_PROVIDE_IFELSE([A][M_PROG_GCJ],\n+        [AC_LIBTOOL_GCJ],\n+\t[ifdef([AC_PROG_GCJ],\n+\t       [define([AC_PROG_GCJ], defn([AC_PROG_GCJ])[AC_LIBTOOL_GCJ\n+])])\n+\t ifdef([A][M_PROG_GCJ],\n+\t       [define([A][M_PROG_GCJ], defn([A][M_PROG_GCJ])[AC_LIBTOOL_GCJ\n+])])])])])\n+\n+AC_DEFUN(_AC_PROG_LIBTOOL,\n [AC_REQUIRE([AC_LIBTOOL_SETUP])dnl\n+AC_BEFORE([$0],[AC_LIBTOOL_CXX])dnl\n+AC_BEFORE([$0],[AC_LIBTOOL_GCJ])dnl\n \n # Save cache, so that ltconfig can load it\n AC_CACHE_SAVE\n \n # Actually configure libtool.  ac_aux_dir is where install-sh is found.\n-CC=\"$CC\" CFLAGS=\"$CFLAGS\" CPPFLAGS=\"$CPPFLAGS\" \\\n-LD=\"$LD\" LDFLAGS=\"$LDFLAGS\" LIBS=\"$LIBS\" \\\n-LN_S=\"$LN_S\" NM=\"$NM\" RANLIB=\"$RANLIB\" \\\n-DLLTOOL=\"$DLLTOOL\" AS=\"$AS\" OBJDUMP=\"$OBJDUMP\" \\\n+AR=\"$AR\" LTCC=\"$CC\" CC=\"$CC\" CFLAGS=\"$CFLAGS\" CPPFLAGS=\"$CPPFLAGS\" \\\n+MAGIC=\"$MAGIC\" LD=\"$LD\" LDFLAGS=\"$LDFLAGS\" LIBS=\"$LIBS\" \\\n+LN_S=\"$LN_S\" NM=\"$NM\" RANLIB=\"$RANLIB\" STRIP=\"$STRIP\" \\\n+AS=\"$AS\" DLLTOOL=\"$DLLTOOL\" OBJDUMP=\"$OBJDUMP\" \\\n+objext=\"$OBJEXT\" exeext=\"$EXEEXT\" reload_flag=\"$reload_flag\" \\\n+deplibs_check_method=\"$deplibs_check_method\" file_magic_cmd=\"$file_magic_cmd\" \\\n ${CONFIG_SHELL-/bin/sh} $ac_aux_dir/ltconfig --no-reexec \\\n-$libtool_flags --no-verify $ac_aux_dir/ltmain.sh $lt_target \\\n+$libtool_flags --no-verify --build=\"$build\" $ac_aux_dir/ltmain.sh $host \\\n || AC_MSG_ERROR([libtool configure failed])\n \n # Reload cache, that may have been modified by ltconfig\n AC_CACHE_LOAD\n \n # This can be used to rebuild libtool when needed\n-LIBTOOL_DEPS=\"$ac_aux_dir/ltconfig $ac_aux_dir/ltmain.sh\"\n+LIBTOOL_DEPS=\"$ac_aux_dir/ltconfig $ac_aux_dir/ltmain.sh $ac_aux_dir/ltcf-c.sh\"\n \n # Always use our own libtool.\n LIBTOOL='$(SHELL) $(top_builddir)/libtool'\n@@ -59,18 +85,29 @@ AC_REQUIRE([AC_ENABLE_STATIC])dnl\n AC_REQUIRE([AC_ENABLE_FAST_INSTALL])dnl\n AC_REQUIRE([AC_CANONICAL_HOST])dnl\n AC_REQUIRE([AC_CANONICAL_BUILD])dnl\n-AC_REQUIRE([AC_PROG_RANLIB])dnl\n AC_REQUIRE([AC_PROG_CC])dnl\n AC_REQUIRE([AC_PROG_LD])dnl\n+AC_REQUIRE([AC_PROG_LD_RELOAD_FLAG])dnl\n AC_REQUIRE([AC_PROG_NM])dnl\n AC_REQUIRE([AC_PROG_LN_S])dnl\n+AC_REQUIRE([AC_DEPLIBS_CHECK_METHOD])dnl\n+# Autoconf 2.13's AC_OBJEXT and AC_EXEEXT macros only works for C compilers!\n+AC_REQUIRE([AC_OBJEXT])dnl\n+AC_REQUIRE([AC_EXEEXT])dnl\n dnl\n \n-case \"$target\" in\n-NONE) lt_target=\"$host\" ;;\n-*) lt_target=\"$target\" ;;\n+# Only perform the check for file, if the check method requires it\n+case \"$deplibs_check_method\" in\n+file_magic*)\n+  if test \"$file_magic_cmd\" = '${MAGIC}'; then\n+    AC_PATH_MAGIC\n+  fi\n+  ;;\n esac\n \n+AC_CHECK_TOOL(RANLIB, ranlib, :)\n+AC_CHECK_TOOL(STRIP, strip, :)\n+\n # Check for any special flags to pass to ltconfig.\n libtool_flags=\"--cache-file=$cache_file\"\n test \"$enable_shared\" = no && libtool_flags=\"$libtool_flags --disable-shared\"\n@@ -87,9 +124,15 @@ AC_ARG_ENABLE(libtool-lock,\n test \"x$enable_libtool_lock\" = xno && libtool_flags=\"$libtool_flags --disable-lock\"\n test x\"$silent\" = xyes && libtool_flags=\"$libtool_flags --silent\"\n \n+AC_ARG_WITH(pic,\n+  [  --with-pic              try to use only PIC/non-PIC objects [default=use both]],\n+     pic_mode=\"$withval\", pic_mode=default)\n+test x\"$pic_mode\" = xyes && libtool_flags=\"$libtool_flags --prefer-pic\"\n+test x\"$pic_mode\" = xno && libtool_flags=\"$libtool_flags --prefer-non-pic\"\n+\n # Some flags need to be propagated to the compiler or linker for good\n # libtool support.\n-case \"$lt_target\" in\n+case \"$host\" in\n *-*-irix6*)\n   # Find out which ABI we are using.\n   echo '[#]line __oline__ \"configure\"' > conftest.$ac_ext\n@@ -114,7 +157,10 @@ case \"$lt_target\" in\n   SAVE_CFLAGS=\"$CFLAGS\"\n   CFLAGS=\"$CFLAGS -belf\"\n   AC_CACHE_CHECK([whether the C compiler needs -belf], lt_cv_cc_needs_belf,\n-    [AC_TRY_LINK([],[],[lt_cv_cc_needs_belf=yes],[lt_cv_cc_needs_belf=no])])\n+    [AC_LANG_SAVE\n+     AC_LANG_C\n+     AC_TRY_LINK([],[],[lt_cv_cc_needs_belf=yes],[lt_cv_cc_needs_belf=no])\n+     AC_LANG_RESTORE])\n   if test x\"$lt_cv_cc_needs_belf\" != x\"yes\"; then\n     # this is probably gcc 2.8.0, egcs 1.0 or newer; no need for -belf\n     CFLAGS=\"$SAVE_CFLAGS\"\n@@ -126,8 +172,31 @@ ifdef([AC_PROVIDE_AC_LIBTOOL_WIN32_DLL],\n   AC_CHECK_TOOL(DLLTOOL, dlltool, false)\n   AC_CHECK_TOOL(AS, as, false)\n   AC_CHECK_TOOL(OBJDUMP, objdump, false)\n+\n+  # recent cygwin and mingw systems supply a stub DllMain which the user\n+  # can override, but on older systems we have to supply one\n+  AC_CACHE_CHECK([if libtool should supply DllMain function], lt_cv_need_dllmain,\n+    [AC_TRY_LINK([],\n+      [extern int __attribute__((__stdcall__)) DllMain(void*, int, void*);\n+      DllMain (0, 0, 0);],\n+      [lt_cv_need_dllmain=no],[lt_cv_need_dllmain=yes])])\n+\n+  case \"$host/$CC\" in\n+  *-*-cygwin*/gcc*-mno-cygwin*|*-*-mingw*)\n+    # old mingw systems require \"-dll\" to link a DLL, while more recent ones\n+    # require \"-mdll\"\n+    SAVE_CFLAGS=\"$CFLAGS\"\n+    CFLAGS=\"$CFLAGS -mdll\"\n+    AC_CACHE_CHECK([how to link DLLs], lt_cv_cc_dll_switch,\n+      [AC_TRY_LINK([], [], [lt_cv_cc_dll_switch=-mdll],[lt_cv_cc_dll_switch=-dll])])\n+    CFLAGS=\"$SAVE_CFLAGS\" ;;\n+  *-*-cygwin*)\n+    # cygwin systems need to pass --dll to the linker, and not link\n+    # crt.o which will require a WinMain@16 definition.\n+    lt_cv_cc_dll_switch=\"-Wl,--dll -nostartfiles\" ;;\n+  esac\n   ;;\n-])\n+  ])\n esac\n ])\n \n@@ -233,10 +302,94 @@ esac],\n enable_fast_install=AC_ENABLE_FAST_INSTALL_DEFAULT)dnl\n ])\n \n-# AC_ENABLE_FAST_INSTALL - set the default to --disable-fast-install\n+# AC_DISABLE_FAST_INSTALL - set the default to --disable-fast-install\n AC_DEFUN(AC_DISABLE_FAST_INSTALL, [AC_BEFORE([$0],[AC_LIBTOOL_SETUP])dnl\n AC_ENABLE_FAST_INSTALL(no)])\n \n+# AC_LIBTOOL_PICMODE - implement the --with-pic flag\n+# Usage: AC_LIBTOOL_PICMODE[(MODE)]\n+#   Where MODE is either `yes' or `no'.  If omitted, it defaults to\n+#   `both'.\n+AC_DEFUN(AC_LIBTOOL_PICMODE, [AC_BEFORE([$0],[AC_LIBTOOL_SETUP])dnl\n+pic_mode=ifelse($#,1,$1,default)])\n+\n+\n+# AC_PATH_TOOL_PREFIX - find a file program which can recognise shared library\n+AC_DEFUN(AC_PATH_TOOL_PREFIX,\n+[AC_MSG_CHECKING([for $1])\n+AC_CACHE_VAL(lt_cv_path_MAGIC,\n+[case \"$MAGIC\" in\n+  /*)\n+  lt_cv_path_MAGIC=\"$MAGIC\" # Let the user override the test with a path.\n+  ;;\n+  ?:/*)\n+  ac_cv_path_MAGIC=\"$MAGIC\" # Let the user override the test with a dos path.\n+  ;;\n+  *)\n+  ac_save_MAGIC=\"$MAGIC\"\n+  IFS=\"${IFS=   }\"; ac_save_ifs=\"$IFS\"; IFS=\":\"\n+dnl $ac_dummy forces splitting on constant user-supplied paths.\n+dnl POSIX.2 word splitting is done only on the output of word expansions,\n+dnl not every word.  This closes a longstanding sh security hole.\n+  ac_dummy=\"ifelse([$2], , $PATH, [$2])\"\n+  for ac_dir in $ac_dummy; do\n+    test -z \"$ac_dir\" && ac_dir=.\n+    if test -f $ac_dir/$1; then\n+      lt_cv_path_MAGIC=\"$ac_dir/$1\"\n+      if test -n \"$file_magic_test_file\"; then\n+\tcase \"$deplibs_check_method\" in\n+\t\"file_magic \"*)\n+\t  file_magic_regex=\"`expr \\\"$deplibs_check_method\\\" : \\\"file_magic \\(.*\\)\\\"`\"\n+\t  MAGIC=\"$lt_cv_path_MAGIC\"\n+\t  if eval $file_magic_cmd \\$file_magic_test_file 2> /dev/null |\n+\t    egrep \"$file_magic_regex\" > /dev/null; then\n+\t    :\n+\t  else\n+\t    cat <<EOF 1>&2\n+\n+*** Warning: the command libtool uses to detect shared libraries,\n+*** $file_magic_cmd, produces output that libtool cannot recognize.\n+*** The result is that libtool may fail to recognize shared libraries\n+*** as such.  This will affect the creation of libtool libraries that\n+*** depend on shared libraries, but programs linked with such libtool\n+*** libraries will work regardless of this problem.  Nevertheless, you\n+*** may want to report the problem to your system manager and/or to\n+*** bug-libtool@gnu.org\n+\n+EOF\n+\t  fi ;;\n+\tesac\n+      fi\n+      break\n+    fi\n+  done\n+  IFS=\"$ac_save_ifs\"\n+  MAGIC=\"$ac_save_MAGIC\"\n+  ;;\n+esac])\n+MAGIC=\"$lt_cv_path_MAGIC\"\n+if test -n \"$MAGIC\"; then\n+  AC_MSG_RESULT($MAGIC)\n+else\n+  AC_MSG_RESULT(no)\n+fi\n+])\n+\n+\n+# AC_PATH_MAGIC - find a file program which can recognise a shared library\n+AC_DEFUN(AC_PATH_MAGIC,\n+[AC_REQUIRE([AC_CHECK_TOOL_PREFIX])dnl\n+AC_PATH_TOOL_PREFIX(${ac_tool_prefix}file, /usr/bin:$PATH)\n+if test -z \"$lt_cv_path_MAGIC\"; then\n+  if test -n \"$ac_tool_prefix\"; then\n+    AC_PATH_TOOL_PREFIX(file, /usr/bin:$PATH)\n+  else\n+    MAGIC=:\n+  fi\n+fi\n+])\n+\n+\n # AC_PROG_LD - find the path to the GNU or non-GNU linker\n AC_DEFUN(AC_PROG_LD,\n [AC_ARG_WITH(gnu-ld,\n@@ -249,7 +402,13 @@ ac_prog=ld\n if test \"$ac_cv_prog_gcc\" = yes; then\n   # Check if gcc -print-prog-name=ld gives a path.\n   AC_MSG_CHECKING([for ld used by GCC])\n-  ac_prog=`($CC -print-prog-name=ld) 2>&5`\n+  case $host in\n+  *-*-mingw*)\n+    # gcc leaves a trailing carriage return which upsets mingw\n+    ac_prog=`($CC -print-prog-name=ld) 2>&5 | tr -d '\\015'` ;;\n+  *)\n+    ac_prog=`($CC -print-prog-name=ld) 2>&5` ;;\n+  esac\n   case \"$ac_prog\" in\n     # Accept absolute paths.\n changequote(,)dnl\n@@ -316,8 +475,172 @@ if $LD -v 2>&1 </dev/null | egrep '(GNU|with BFD)' 1>&5; then\n else\n   ac_cv_prog_gnu_ld=no\n fi])\n+with_gnu_ld=$ac_cv_prog_gnu_ld\n ])\n \n+# AC_PROG_LD_RELOAD_FLAG - find reload flag for linker\n+#   -- PORTME Some linkers may need a different reload flag.\n+AC_DEFUN(AC_PROG_LD_RELOAD_FLAG,\n+[AC_CACHE_CHECK([for $LD option to reload object files], lt_cv_ld_reload_flag,\n+[lt_cv_ld_reload_flag='-r'])\n+reload_flag=$lt_cv_ld_reload_flag\n+test -n \"$reload_flag\" && reload_flag=\" $reload_flag\"\n+])\n+\n+# AC_DEPLIBS_CHECK_METHOD - how to check for library dependencies\n+#  -- PORTME fill in with the dynamic library characteristics\n+AC_DEFUN(AC_DEPLIBS_CHECK_METHOD,\n+[AC_CACHE_CHECK([how to recognise dependant libraries],\n+lt_cv_deplibs_check_method,\n+[lt_cv_file_magic_cmd='${MAGIC}'\n+lt_cv_file_magic_test_file=\n+lt_cv_deplibs_check_method='unknown'\n+# Need to set the preceding variable on all platforms that support\n+# interlibrary dependencies.\n+# 'none' -- dependencies not supported.\n+# `unknown' -- same as none, but documents that we really don't know.\n+# 'pass_all' -- all dependencies passed with no checks.\n+# 'test_compile' -- check by making test program.\n+# 'file_magic [regex]' -- check by looking for files in library path\n+# which responds to the $file_magic_cmd with a given egrep regex.\n+# If you have `file' or equivalent on your system and you're not sure\n+# whether `pass_all' will *always* work, you probably want this one.\n+\n+case \"$host_os\" in\n+aix4*)\n+  lt_cv_deplibs_check_method=pass_all\n+  ;;\n+\n+beos*)\n+  lt_cv_deplibs_check_method=pass_all\n+  ;;\n+\n+bsdi4*)\n+  changequote(,)dnl\n+  lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [ML]SB (shared object|dynamic lib)'\n+  changequote([, ])dnl\n+  lt_cv_file_magic_cmd='/usr/bin/file -L'\n+  lt_cv_file_magic_test_file=/shlib/libc.so\n+  ;;\n+\n+cygwin* | mingw*)\n+  lt_cv_deplibs_check_method='file_magic file format pei*-i386(.*architecture: i386)?'\n+  lt_cv_file_magic_cmd='${OBJDUMP} -f'\n+  ;;\n+\n+freebsd* )\n+  if echo __ELF__ | $CC -E - | grep __ELF__ > /dev/null; then\n+    case \"$host_cpu\" in\n+    i*86 )\n+      # Not sure whether the presence of OpenBSD here was a mistake.\n+      # Let's accept both of them until this is cleared up.\n+      changequote(,)dnl\n+      lt_cv_deplibs_check_method='file_magic (FreeBSD|OpenBSD)/i[3-9]86 (compact )?demand paged shared library'\n+      changequote([, ])dnl\n+      lt_cv_file_magic_cmd=/usr/bin/file\n+      lt_cv_file_magic_test_file=`echo /usr/lib/libc.so.*`\n+      ;;\n+    esac\n+  else\n+    lt_cv_deplibs_check_method=pass_all\n+  fi\n+  ;;\n+\n+gnu*)\n+  lt_cv_deplibs_check_method=pass_all\n+  ;;\n+\n+hpux10.20*)\n+  # TODO:  Does this work for hpux-11 too?\n+  lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|PA-RISC[0-9].[0-9]) shared library'\n+  lt_cv_file_magic_cmd=/usr/bin/file\n+  lt_cv_file_magic_test_file=/usr/lib/libc.sl\n+  ;;\n+\n+irix5* | irix6*)\n+  case \"$host_os\" in\n+  irix5*)\n+    # this will be overridden with pass_all, but let us keep it just in case\n+    lt_cv_deplibs_check_method=\"file_magic ELF 32-bit MSB dynamic lib MIPS - version 1\"\n+    ;;\n+  *)\n+    case \"$LD\" in\n+    *-32|*\"-32 \") libmagic=32-bit;;\n+    *-n32|*\"-n32 \") libmagic=N32;;\n+    *-64|*\"-64 \") libmagic=64-bit;;\n+    *) libmagic=never-match;;\n+    esac\n+    # this will be overridden with pass_all, but let us keep it just in case\n+    changequote(,)dnl\n+    lt_cv_deplibs_check_method=\"file_magic ELF ${libmagic} MSB mips-[1234] dynamic lib MIPS - version 1\"\n+    changequote([, ])dnl\n+    ;;\n+  esac\n+  lt_cv_file_magic_test_file=`echo /lib${libsuff}/libc.so*`\n+  lt_cv_deplibs_check_method=pass_all\n+  ;;\n+\n+# This must be Linux ELF.\n+linux-gnu*)\n+  case \"$host_cpu\" in\n+  alpha* | i*86 | powerpc* | sparc* | ia64* )\n+    lt_cv_deplibs_check_method=pass_all ;;\n+  *)\n+    # glibc up to 2.1.1 does not perform some relocations on ARM\n+    changequote(,)dnl\n+    lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB (shared object|dynamic lib )' ;;\n+    changequote([, ])dnl\n+  esac\n+  lt_cv_file_magic_test_file=`echo /lib/libc.so* /lib/libc-*.so`\n+  ;;\n+\n+netbsd*)\n+  if echo __ELF__ | $CC -E - | grep __ELF__ > /dev/null; then :\n+  else\n+    changequote(,)dnl\n+    lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB shared object'\n+    changequote([, ])dnl\n+    lt_cv_file_magic_cmd='/usr/bin/file -L'\n+    lt_cv_file_magic_test_file=`echo /usr/lib/libc.so*`\n+  fi\n+  ;;\n+\n+osf3* | osf4* | osf5*)\n+  # this will be overridden with pass_all, but let us keep it just in case\n+  lt_cv_deplibs_check_method='file_magic COFF format alpha shared library'\n+  lt_cv_file_magic_test_file=/shlib/libc.so\n+  lt_cv_deplibs_check_method=pass_all\n+  ;;\n+\n+sco3.2v5*)\n+  lt_cv_deplibs_check_method=pass_all\n+  ;;\n+\n+solaris*)\n+  lt_cv_deplibs_check_method=pass_all\n+  lt_cv_file_magic_test_file=/lib/libc.so\n+  ;;\n+\n+sysv4 | sysv4.2uw2* | sysv4.3* | sysv5*)\n+  case \"$host_vendor\" in\n+  ncr)\n+    lt_cv_deplibs_check_method=pass_all\n+    ;;\n+  motorola)\n+    changequote(,)dnl\n+    lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [ML]SB (shared object|dynamic lib) M[0-9][0-9]* Version [0-9]'\n+    changequote([, ])dnl\n+    lt_cv_file_magic_test_file=`echo /usr/lib/libc.so*`\n+    ;;\n+  esac\n+  ;;\n+esac\n+])\n+file_magic_cmd=$lt_cv_file_magic_cmd\n+deplibs_check_method=$lt_cv_deplibs_check_method\n+])\n+\n+\n # AC_PROG_NM - find the path to a BSD-compatible name lister\n AC_DEFUN(AC_PROG_NM,\n [AC_MSG_CHECKING([for BSD-compatible nm])\n@@ -329,18 +652,20 @@ else\n   IFS=\"${IFS= \t}\"; ac_save_ifs=\"$IFS\"; IFS=\"${IFS}${PATH_SEPARATOR-:}\"\n   for ac_dir in $PATH /usr/ccs/bin /usr/ucb /bin; do\n     test -z \"$ac_dir\" && ac_dir=.\n-    if test -f $ac_dir/nm || test -f $ac_dir/nm$ac_exeext ; then\n+    tmp_nm=$ac_dir/${ac_tool_prefix}nm\n+    if test -f $tmp_nm || test -f $tmp_nm$ac_exeext ; then\n       # Check to see if the nm accepts a BSD-compat flag.\n       # Adding the `sed 1q' prevents false positives on HP-UX, which says:\n       #   nm: unknown option \"B\" ignored\n-      if ($ac_dir/nm -B /dev/null 2>&1 | sed '1q'; exit 0) | egrep /dev/null >/dev/null; then\n-\tac_cv_path_NM=\"$ac_dir/nm -B\"\n+      # Tru64's nm complains that /dev/null is an invalid object file\n+      if ($tmp_nm -B /dev/null 2>&1 | sed '1q'; exit 0) | egrep '(/dev/null|Invalid file or object type)' >/dev/null; then\n+\tac_cv_path_NM=\"$tmp_nm -B\"\n \tbreak\n-      elif ($ac_dir/nm -p /dev/null 2>&1 | sed '1q'; exit 0) | egrep /dev/null >/dev/null; then\n-\tac_cv_path_NM=\"$ac_dir/nm -p\"\n+      elif ($tmp_nm -p /dev/null 2>&1 | sed '1q'; exit 0) | egrep /dev/null >/dev/null; then\n+\tac_cv_path_NM=\"$tmp_nm -p\"\n \tbreak\n       else\n-\tac_cv_path_NM=${ac_cv_path_NM=\"$ac_dir/nm\"} # keep the first match, but\n+\tac_cv_path_NM=${ac_cv_path_NM=\"$tmp_nm\"} # keep the first match, but\n \tcontinue # so that we can try to find one that supports BSD flags\n       fi\n     fi\n@@ -356,7 +681,7 @@ AC_MSG_RESULT([$NM])\n AC_DEFUN(AC_CHECK_LIBM,\n [AC_REQUIRE([AC_CANONICAL_HOST])dnl\n LIBM=\n-case \"$lt_target\" in\n+case \"$host\" in\n *-*-beos* | *-*-cygwin*)\n   # These system don't have libm\n   ;;\n@@ -371,31 +696,35 @@ esac\n ])\n \n # AC_LIBLTDL_CONVENIENCE[(dir)] - sets LIBLTDL to the link flags for\n-# the libltdl convenience library, adds --enable-ltdl-convenience to\n-# the configure arguments.  Note that LIBLTDL is not AC_SUBSTed, nor\n-# is AC_CONFIG_SUBDIRS called.  If DIR is not provided, it is assumed\n-# to be `${top_builddir}/libltdl'.  Make sure you start DIR with\n-# '${top_builddir}/' (note the single quotes!) if your package is not\n-# flat, and, if you're not using automake, define top_builddir as\n-# appropriate in the Makefiles.\n+# the libltdl convenience library and INCLTDL to the include flags for\n+# the libltdl header and adds --enable-ltdl-convenience to the\n+# configure arguments.  Note that LIBLTDL and INCLTDL are not\n+# AC_SUBSTed, nor is AC_CONFIG_SUBDIRS called.  If DIR is not\n+# provided, it is assumed to be `libltdl'.  LIBLTDL will be prefixed\n+# with '${top_builddir}/' and INCLTDL will be prefixed with\n+# '${top_srcdir}/' (note the single quotes!).  If your package is not\n+# flat and you're not using automake, define top_builddir and\n+# top_srcdir appropriately in the Makefiles.\n AC_DEFUN(AC_LIBLTDL_CONVENIENCE, [AC_BEFORE([$0],[AC_LIBTOOL_SETUP])dnl\n   case \"$enable_ltdl_convenience\" in\n   no) AC_MSG_ERROR([this package needs a convenience libltdl]) ;;\n   \"\") enable_ltdl_convenience=yes\n       ac_configure_args=\"$ac_configure_args --enable-ltdl-convenience\" ;;\n   esac\n-  LIBLTDL=ifelse($#,1,$1,['${top_builddir}/libltdl'])/libltdlc.la\n-  INCLTDL=ifelse($#,1,-I$1,['-I${top_builddir}/libltdl'])\n+  LIBLTDL='${top_builddir}/'ifelse($#,1,[$1],['libltdl'])/libltdlc.la\n+  INCLTDL='-I${top_srcdir}/'ifelse($#,1,[$1],['libltdl'])\n ])\n \n # AC_LIBLTDL_INSTALLABLE[(dir)] - sets LIBLTDL to the link flags for\n-# the libltdl installable library, and adds --enable-ltdl-install to\n-# the configure arguments.  Note that LIBLTDL is not AC_SUBSTed, nor\n-# is AC_CONFIG_SUBDIRS called.  If DIR is not provided, it is assumed\n-# to be `${top_builddir}/libltdl'.  Make sure you start DIR with\n-# '${top_builddir}/' (note the single quotes!) if your package is not\n-# flat, and, if you're not using automake, define top_builddir as\n-# appropriate in the Makefiles.\n+# the libltdl installable library and INCLTDL to the include flags for\n+# the libltdl header and adds --enable-ltdl-install to the configure\n+# arguments.  Note that LIBLTDL and INCLTDL are not AC_SUBSTed, nor is\n+# AC_CONFIG_SUBDIRS called.  If DIR is not provided and an installed\n+# libltdl is not found, it is assumed to be `libltdl'.  LIBLTDL will\n+# be prefixed with '${top_builddir}/' and INCLTDL will be prefixed\n+# with '${top_srcdir}/' (note the single quotes!).  If your package is\n+# not flat and you're not using automake, define top_builddir and\n+# top_srcdir appropriately in the Makefiles.\n # In the future, this macro may have to be called after AC_PROG_LIBTOOL.\n AC_DEFUN(AC_LIBLTDL_INSTALLABLE, [AC_BEFORE([$0],[AC_LIBTOOL_SETUP])dnl\n   AC_CHECK_LIB(ltdl, main,\n@@ -408,15 +737,83 @@ AC_DEFUN(AC_LIBLTDL_INSTALLABLE, [AC_BEFORE([$0],[AC_LIBTOOL_SETUP])dnl\n   ])\n   if test x\"$enable_ltdl_install\" = x\"yes\"; then\n     ac_configure_args=\"$ac_configure_args --enable-ltdl-install\"\n-    LIBLTDL=ifelse($#,1,$1,['${top_builddir}/libltdl'])/libltdl.la\n-    INCLTDL=ifelse($#,1,-I$1,['-I${top_builddir}/libltdl'])\n+    LIBLTDL='${top_builddir}/'ifelse($#,1,[$1],['libltdl'])/libltdl.la\n+    INCLTDL='-I${top_srcdir}/'ifelse($#,1,[$1],['libltdl'])\n   else\n     ac_configure_args=\"$ac_configure_args --enable-ltdl-install=no\"\n     LIBLTDL=\"-lltdl\"\n     INCLTDL=\n   fi\n ])\n \n+# If this macro is not defined by Autoconf, define it here.\n+ifdef([AC_PROVIDE_IFELSE],\n+      [],\n+      [define([AC_PROVIDE_IFELSE],\n+              [ifdef([AC_PROVIDE_$1],\n+                     [$2], [$3])])])\n+\n+# AC_LIBTOOL_CXX - enable support for C++ libraries\n+AC_DEFUN(AC_LIBTOOL_CXX,[AC_REQUIRE([_AC_LIBTOOL_CXX])])\n+AC_DEFUN(_AC_LIBTOOL_CXX,\n+[AC_REQUIRE([AC_PROG_LIBTOOL])\n+AC_REQUIRE([AC_PROG_CXX])\n+AC_REQUIRE([AC_PROG_CXXCPP])\n+LIBTOOL_DEPS=$LIBTOOL_DEPS\" $ac_aux_dir/ltcf-cxx.sh\"\n+lt_save_CC=\"$CC\"\n+lt_save_CFLAGS=\"$CFLAGS\"\n+dnl Make sure LTCC is set to the C compiler, i.e. set LTCC before CC\n+dnl is set to the C++ compiler.\n+AR=\"$AR\" LTCC=\"$CC\" CC=\"$CXX\" CXX=\"$CXX\" CFLAGS=\"$CXXFLAGS\" CPPFLAGS=\"$CPPFLAGS\" \\\n+MAGIC=\"$MAGIC\" LDFLAGS=\"$LDFLAGS\" LIBS=\"$LIBS\" \\\n+LN_S=\"$LN_S\" NM=\"$NM\" RANLIB=\"$RANLIB\" STRIP=\"$STRIP\" \\\n+AS=\"$AS\" DLLTOOL=\"$DLLTOOL\" OBJDUMP=\"$OBJDUMP\" \\\n+objext=\"$OBJEXT\" exeext=\"$EXEEXT\" reload_flag=\"$reload_flag\" \\\n+deplibs_check_method=\"$deplibs_check_method\" \\\n+file_magic_cmd=\"$file_magic_cmd\" \\\n+${CONFIG_SHELL-/bin/sh} $ac_aux_dir/ltconfig -o libtool $libtool_flags \\\n+--build=\"$build\" --add-tag=CXX $ac_aux_dir/ltcf-cxx.sh $host \\\n+|| AC_MSG_ERROR([libtool tag configuration failed])\n+CC=\"$lt_save_CC\"\n+CFLAGS=\"$lt_save_CFLAGS\"\n+\n+# Redirect the config.log output again, so that the ltconfig log is not\n+# clobbered by the next message.\n+exec 5>>./config.log\n+])\n+\n+# AC_LIBTOOL_GCJ - enable support for GCJ libraries\n+AC_DEFUN(AC_LIBTOOL_GCJ,[AC_REQUIRE([_AC_LIBTOOL_GCJ])])\n+AC_DEFUN(_AC_LIBTOOL_GCJ,\n+[AC_REQUIRE([AC_PROG_LIBTOOL])\n+AC_PROVIDE_IFELSE([AC_PROG_GCJ],[],\n+  [AC_PROVIDE_IFELSE([A][M_PROG_GCJ],[],\n+    [ifdef([AC_PROG_GCJ],[AC_REQUIRE([AC_PROG_GCJ])],\n+       [ifdef([A][M_PROG_GCJ],[AC_REQUIRE([A][M_PROG_GCJ])],\n+         [AC_REQUIRE([A][C_PROG_GCJ_OR_A][M_PROG_GCJ])])])])])\n+LIBTOOL_DEPS=$LIBTOOL_DEPS\" $ac_aux_dir/ltcf-gcj.sh\"\n+lt_save_CC=\"$CC\"\n+lt_save_CFLAGS=\"$CFLAGS\"\n+dnl Make sure LTCC is set to the C compiler, i.e. set LTCC before CC\n+dnl is set to the C++ compiler.\n+AR=\"$AR\" LTCC=\"$CC\" CC=\"$GCJ\" CFLAGS=\"$GCJFLAGS\" CPPFLAGS=\"\" \\\n+MAGIC=\"$MAGIC\" LDFLAGS=\"$LDFLAGS\" LIBS=\"$LIBS\" \\\n+LN_S=\"$LN_S\" NM=\"$NM\" RANLIB=\"$RANLIB\" STRIP=\"$STRIP\" \\\n+AS=\"$AS\" DLLTOOL=\"$DLLTOOL\" OBJDUMP=\"$OBJDUMP\" \\\n+objext=\"$OBJEXT\" exeext=\"$EXEEXT\" reload_flag=\"$reload_flag\" \\\n+deplibs_check_method=\"$deplibs_check_method\" \\\n+file_magic_cmd=\"$file_magic_cmd\" \\\n+${CONFIG_SHELL-/bin/sh} $ac_aux_dir/ltconfig -o libtool $libtool_flags \\\n+--build=\"$build\" --add-tag=GCJ $ac_aux_dir/ltcf-gcj.sh $host \\\n+|| AC_MSG_ERROR([libtool tag configuration failed])\n+CC=\"$lt_save_CC\"\n+CFLAGS=\"$lt_save_CFLAGS\"\n+\n+# Redirect the config.log output again, so that the ltconfig log is not\n+# clobbered by the next message.\n+exec 5>>./config.log\n+])\n+\n dnl old names\n AC_DEFUN(AM_PROG_LIBTOOL, [indir([AC_PROG_LIBTOOL])])dnl\n AC_DEFUN(AM_ENABLE_SHARED, [indir([AC_ENABLE_SHARED], $@)])dnl\n@@ -428,3 +825,465 @@ AC_DEFUN(AM_PROG_NM, [indir([AC_PROG_NM])])dnl\n \n dnl This is just to silence aclocal about the macro not being used\n ifelse([AC_DISABLE_FAST_INSTALL])dnl\n+\n+AC_DEFUN([LT_AC_PROG_GCJ],[\n+  AC_CHECK_TOOL(GCJ, gcj, no)\n+  test \"x${GCJFLAGS+set}\" = xset || GCJFLAGS=\"-g -O2\"\n+  AC_SUBST(GCJFLAGS)\n+])\n+## ltdl.m4 - Configure ltdl for the target system. -*-Shell-script-*-\n+## Copyright (C) 1999-2000 Free Software Foundation, Inc.\n+##\n+## This program is free software; you can redistribute it and/or modify\n+## it under the terms of the GNU General Public License as published by\n+## the Free Software Foundation; either version 2 of the License, or\n+## (at your option) any later version.\n+##\n+## This program is distributed in the hope that it will be useful, but\n+## WITHOUT ANY WARRANTY; without even the implied warranty of\n+## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+## General Public License for more details.\n+##\n+## You should have received a copy of the GNU General Public License\n+## along with this program; if not, write to the Free Software\n+## Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.\n+##\n+## As a special exception to the GNU General Public License, if you\n+## distribute this file as part of a program that contains a\n+## configuration script generated by Autoconf, you may include it under\n+## the same distribution terms that you use for the rest of that program.\n+\n+# serial 1 AC_LIB_LTDL\n+\n+AC_DEFUN(AC_LIB_LTDL,\n+[AC_PREREQ(2.13)dnl\n+AC_REQUIRE([AC_PROG_CC])dnl\n+AC_REQUIRE([AC_C_CONST])dnl\n+AC_REQUIRE([AC_C_INLINE])dnl\n+\n+dnl AC_LIB_LTDL must perform all the checks necessary for compilation\n+dnl of the ltdl objects -- including compiler checks (above) and header\n+dnl checks (below).\n+AC_REQUIRE([AC_HEADER_STDC])dnl\n+\n+AC_CHECK_HEADERS(malloc.h memory.h stdlib.h stdio.h ctype.h dlfcn.h dl.h dld.h)\n+AC_CHECK_HEADERS(string.h strings.h, break)\n+AC_CHECK_FUNCS(strchr index, break)\n+AC_CHECK_FUNCS(strrchr rindex, break)\n+AC_CHECK_FUNCS(strcmp)\n+\n+AC_REQUIRE([AC_LTDL_ENABLE_INSTALL])dnl\n+AC_REQUIRE([AC_LTDL_SHLIBEXT])dnl\n+AC_REQUIRE([AC_LTDL_SHLIBPATH])dnl\n+AC_REQUIRE([AC_LTDL_SYSSEARCHPATH])dnl\n+AC_REQUIRE([AC_LTDL_OBJDIR])dnl\n+AC_REQUIRE([AC_LTDL_DLPREOPEN])dnl\n+AC_REQUIRE([AC_LTDL_DLLIB])dnl\n+AC_REQUIRE([AC_LTDL_SYMBOL_USCORE])dnl\n+])\n+\n+AC_DEFUN(AC_LTDL_ENABLE_INSTALL,\n+[AC_ARG_ENABLE(ltdl-install,\n+[  --enable-ltdl-install   install libltdl])\n+\n+AM_CONDITIONAL(INSTALL_LTDL, test x\"${enable_ltdl_install-no}\" != xno)\n+AM_CONDITIONAL(CONVENIENCE_LTDL, test x\"${enable_ltdl_convenience-no}\" != xno)\n+])])\n+\n+\n+AC_DEFUN(AC_LTDL_SNARF_CONFIG,\n+[# Read the libtool configuration\n+rm -f conftest\n+./libtool --config > conftest\n+. ./conftest\n+rm -f conftest\n+])\n+\n+AC_DEFUN(AC_LTDL_SHLIBEXT,\n+[AC_REQUIRE([AC_LTDL_SNARF_CONFIG])dnl\n+AC_CACHE_CHECK([which extension is used for shared libraries],\n+  libltdl_cv_shlibext, [dnl\n+(\n+  last=\n+  for spec in $library_names_spec; do\n+    last=\"$spec\"\n+  done\n+changequote(, )\n+  echo \"$last\" | sed 's/\\[.*\\]//;s/^[^.]*//;s/\\$.*$//;s/\\.$//' > conftest\n+changequote([, ])\n+)\n+libltdl_cv_shlibext=`cat conftest`\n+rm -f conftest\n+])\n+if test -n \"$libltdl_cv_shlibext\"; then\n+  AC_DEFINE_UNQUOTED(LTDL_SHLIB_EXT, \"$libltdl_cv_shlibext\",\n+    [Define to the extension used for shared libraries, say, \".so\". ])\n+fi\n+])\n+\n+AC_DEFUN(AC_LTDL_SHLIBPATH,\n+[AC_REQUIRE([AC_LTDL_SNARF_CONFIG])dnl\n+AC_CACHE_CHECK([which variable specifies run-time library path],\n+  libltdl_cv_shlibpath_var, [libltdl_cv_shlibpath_var=\"$shlibpath_var\"])\n+if test -n \"$libltdl_cv_shlibpath_var\"; then\n+  AC_DEFINE_UNQUOTED(LTDL_SHLIBPATH_VAR, \"$libltdl_cv_shlibpath_var\",\n+    [Define to the name of the environment variable that determines the dynamic library search path. ])\n+fi\n+])\n+\n+AC_DEFUN(AC_LTDL_SYSSEARCHPATH,\n+[AC_REQUIRE([AC_LTDL_SNARF_CONFIG])dnl\n+AC_CACHE_CHECK([for the default library search path],\n+  libltdl_cv_sys_search_path, [libltdl_cv_sys_search_path=\"$sys_lib_dlsearch_path_spec\"])\n+if test -n \"$libltdl_cv_sys_search_path\"; then\n+  case \"$host\" in\n+  *-*-mingw*) pathsep=\";\" ;;\n+  *) pathsep=\":\" ;;\n+  esac\n+  sys_search_path=\n+  for dir in $libltdl_cv_sys_search_path; do\n+    if test -z \"$sys_search_path\"; then\n+      sys_search_path=\"$dir\"\n+    else\n+      sys_search_path=\"$sys_search_path$pathsep$dir\"\n+    fi\n+  done\n+  AC_DEFINE_UNQUOTED(LTDL_SYSSEARCHPATH, \"$sys_search_path\",\n+    [Define to the system default library search path. ])\n+fi\n+])\n+\n+AC_DEFUN(AC_LTDL_OBJDIR,\n+[AC_CACHE_CHECK([for objdir],\n+  libltdl_cv_objdir, [libltdl_cv_objdir=\"$objdir\"\n+if test -n \"$objdir\"; then\n+  :\n+else\n+  rm -f .libs 2>/dev/null\n+  mkdir .libs 2>/dev/null\n+  if test -d .libs; then\n+    libltdl_cv_objdir=.libs\n+  else\n+    # MS-DOS does not allow filenames that begin with a dot.\n+    libltdl_cv_objdir=_libs\n+  fi\n+rmdir .libs 2>/dev/null\n+fi])\n+AC_DEFINE_UNQUOTED(LTDL_OBJDIR, \"$libltdl_cv_objdir/\",\n+  [Define to the sub-directory in which libtool stores uninstalled libraries. ])\n+])\n+\n+AC_DEFUN(AC_LTDL_DLPREOPEN,\n+[AC_REQUIRE([AC_LTDL_GLOBAL_SYMBOL_PIPE])dnl\n+AC_CACHE_CHECK([whether libtool supports -dlopen/-dlpreopen],\n+       libltdl_cv_preloaded_symbols, [dnl\n+  if test -n \"$global_symbol_pipe\"; then\n+    libltdl_cv_preloaded_symbols=yes\n+  else\n+    libltdl_cv_preloaded_symbols=no\n+  fi\n+])\n+if test x\"$libltdl_cv_preloaded_symbols\" = x\"yes\"; then\n+  AC_DEFINE(HAVE_PRELOADED_SYMBOLS, 1,\n+    [Define if libtool can extract symbol lists from object files. ])\n+fi\n+])\n+\n+AC_DEFUN(AC_LTDL_DLLIB,\n+[LIBADD_DL=\n+AC_CHECK_LIB(dl, dlopen, [AC_DEFINE(HAVE_LIBDL, 1,\n+   [Define if you have the libdl library or equivalent. ]) LIBADD_DL=\"-ldl\"],\n+[AC_CHECK_FUNC(dlopen, [AC_DEFINE(HAVE_LIBDL, 1,\n+   [Define if you have the libdl library or equivalent.])],\n+[AC_CHECK_LIB(svld, dlopen, [AC_DEFINE(HAVE_LIBDL, 1,\n+   [Define if you have the libdl library or equivalent.]) LIBADD_DL=\"-lsvld\"]\n+)])])\n+AC_CHECK_FUNC(shl_load, [AC_DEFINE(HAVE_SHL_LOAD, 1,\n+   [Define if you have the shl_load function.])],\n+[AC_CHECK_LIB(dld, shl_load,\n+  [AC_DEFINE(HAVE_SHL_LOAD, 1,\n+     [Define if you have the shl_load function.])\n+   LIBADD_DL=\"$LIBADD_DL -ldld\"])\n+])\n+AC_CHECK_LIB(dld, dld_link, [AC_DEFINE(HAVE_DLD, 1,\n+  [Define if you have the GNU dld library.])dnl\n+test \"x$ac_cv_lib_dld_shl_load\" = yes || LIBADD_DL=\"$LIBADD_DL -ldld\"])\n+AC_SUBST(LIBADD_DL)\n+\n+if test \"x$ac_cv_func_dlopen\" = xyes || test \"x$ac_cv_lib_dl_dlopen\" = xyes; then\n+ LIBS_SAVE=\"$LIBS\"\n+ LIBS=\"$LIBS $LIBADD_DL\"\n+ AC_CHECK_FUNCS(dlerror)\n+ LIBS=\"$LIBS_SAVE\"\n+fi\n+])\n+\n+AC_DEFUN(AC_LTDL_GLOBAL_SYMBOL_PIPE,\n+[dnl Check for command to grab the raw symbol name followed\n+dnl by C symbol name from nm.\n+AC_REQUIRE([AC_CANONICAL_HOST])dnl\n+AC_REQUIRE([AC_PROG_NM])dnl\n+# Check for command to grab the raw symbol name followed by C symbol from nm.\n+AC_MSG_CHECKING([command to parse $NM output])\n+AC_CACHE_VAL(ac_cv_sys_global_symbol_pipe,\n+[# These are sane defaults that work on at least a few old systems.\n+# {They come from Ultrix.  What could be older than Ultrix?!! ;)}\n+\n+changequote(,)dnl\n+# Character class describing NM global symbol codes.\n+ac_symcode='[BCDEGRST]'\n+\n+# Regexp to match symbols that can be accessed directly from C.\n+ac_sympat='\\([_A-Za-z][_A-Za-z0-9]*\\)'\n+\n+# Transform the above into a raw symbol and a C symbol.\n+ac_symxfrm='\\1 \\2\\3 \\3'\n+\n+# Transform an extracted symbol line into a proper C declaration\n+ac_global_symbol_to_cdecl=\"sed -n -e 's/^. .* \\(.*\\)$/extern char \\1;/p'\"\n+\n+# Define system-specific variables.\n+case \"$host_os\" in\n+aix*)\n+  ac_symcode='[BCDT]'\n+  ;;\n+cygwin* | mingw*)\n+  ac_symcode='[ABCDGISTW]'\n+  ;;\n+hpux*)\n+  ac_global_symbol_to_cdecl=\"sed -n -e 's/^T .* \\(.*\\)$/extern char \\1();/p' -e 's/^. .* \\(.*\\)$/extern char \\1;/p'\"\n+  ;;\n+irix*)\n+  ac_symcode='[BCDEGRST]'\n+  ;;\n+solaris*)\n+  ac_symcode='[BDT]'\n+  ;;\n+esac\n+\n+# If we're using GNU nm, then use its standard symbol codes.\n+if $NM -V 2>&1 | egrep '(GNU|with BFD)' > /dev/null; then\n+  ac_symcode='[ABCDGISTW]'\n+fi\n+changequote([,])dnl\n+\n+# Try without a prefix undercore, then with it.\n+for ac_symprfx in \"\" \"_\"; do\n+\n+  ac_cv_sys_global_symbol_pipe=\"sed -n -e 's/^.*[ \t]\\($ac_symcode\\)[ \t][ \t]*\\($ac_symprfx\\)$ac_sympat$/$ac_symxfrm/p'\"\n+\n+  # Check to see that the pipe works correctly.\n+  ac_pipe_works=no\n+  rm -f conftest.$ac_ext\n+  cat > conftest.$ac_ext <<EOF\n+#ifdef __cplusplus\n+extern \"C\" {\n+#endif\n+char nm_test_var;\n+void nm_test_func(){}\n+#ifdef __cplusplus\n+}\n+#endif\n+int main(){nm_test_var='a';nm_test_func;return 0;}\n+EOF\n+\n+  if AC_TRY_EVAL(ac_compile); then\n+    # Now try to grab the symbols.\n+    ac_nlist=conftest.nm\n+\n+    if AC_TRY_EVAL(NM conftest.$ac_objext \\| $ac_cv_sys_global_symbol_pipe \\> $ac_nlist) && test -s \"$ac_nlist\"; then\n+\n+      # Try sorting and uniquifying the output.\n+      if sort \"$ac_nlist\" | uniq > \"$ac_nlist\"T; then\n+\tmv -f \"$ac_nlist\"T \"$ac_nlist\"\n+      else\n+\trm -f \"$ac_nlist\"T\n+      fi\n+\n+      # Make sure that we snagged all the symbols we need.\n+      if egrep ' nm_test_var$' \"$ac_nlist\" >/dev/null; then\n+\tif egrep ' nm_test_func$' \"$ac_nlist\" >/dev/null; then\n+\t  cat <<EOF > conftest.c\n+#ifdef __cplusplus\n+extern \"C\" {\n+#endif\n+\n+EOF\n+\t  # Now generate the symbol file.\n+\t  eval \"$ac_global_symbol_to_cdecl\"' < \"$ac_nlist\" >> conftest.c'\n+\n+\t  cat <<EOF >> conftest.c\n+#if defined (__STDC__) && __STDC__\n+# define lt_ptr_t void *\n+#else\n+# define lt_ptr_t char *\n+# define const\n+#endif\n+\n+/* The mapping between symbol names and symbols. */\n+const struct {\n+  const char *name;\n+  lt_ptr_t address;\n+}\n+changequote(,)dnl\n+lt_preloaded_symbols[] =\n+changequote([,])dnl\n+{\n+EOF\n+\tsed 's/^. \\(.*\\) \\(.*\\)$/  {\"\\2\", (lt_ptr_t) \\&\\2},/' < \"$ac_nlist\" >> conftest.c\n+\tcat <<\\EOF >> conftest.c\n+  {0, (lt_ptr_t) 0}\n+};\n+\n+#ifdef __cplusplus\n+}\n+#endif\n+EOF\n+\t  # Now try linking the two files.\n+\t  mv conftest.$ac_objext conftstm.$ac_objext\n+\t  ac_save_LIBS=\"$LIBS\"\n+\t  ac_save_CFLAGS=\"$CFLAGS\"\n+\t  LIBS=\"conftstm.$ac_objext\"\n+\t  CFLAGS=\"$CFLAGS$no_builtin_flag\"\n+\t  if AC_TRY_EVAL(ac_link) && test -s conftest; then\n+\t    ac_pipe_works=yes\n+\t  else\n+\t    echo \"configure: failed program was:\" >&AC_FD_CC\n+\t    cat conftest.c >&AC_FD_CC\n+\t  fi\n+\t  LIBS=\"$ac_save_LIBS\"\n+\t  CFLAGS=\"$ac_save_CFLAGS\"\n+\telse\n+\t  echo \"cannot find nm_test_func in $ac_nlist\" >&AC_FD_CC\n+\tfi\n+      else\n+\techo \"cannot find nm_test_var in $ac_nlist\" >&AC_FD_CC\n+      fi\n+    else\n+      echo \"cannot run $ac_cv_sys_global_symbol_pipe\" >&AC_FD_CC\n+    fi\n+  else\n+    echo \"$progname: failed program was:\" >&AC_FD_CC\n+    cat conftest.c >&AC_FD_CC\n+  fi\n+  rm -rf conftest* conftst*\n+\n+  # Do not use the global_symbol_pipe unless it works.\n+  if test \"$ac_pipe_works\" = yes; then\n+    if test x\"$ac_symprfx\" = x\"_\"; then\n+      ac_cv_sys_symbol_underscore=yes\n+    else\n+      ac_cv_sys_symbol_underscore=no\n+    fi\n+    break\n+  else\n+    ac_cv_sys_global_symbol_pipe=\n+  fi\n+done\n+])\n+\n+ac_result=yes\n+if test -z \"$ac_cv_sys_global_symbol_pipe\"; then\n+   ac_result=no\n+fi\n+AC_MSG_RESULT($ac_result)\n+])\n+\n+AC_DEFUN(AC_LTDL_SYMBOL_USCORE,\n+[dnl does the compiler prefix global symbols with an underscore?\n+AC_REQUIRE([AC_LTDL_GLOBAL_SYMBOL_PIPE])dnl\n+AC_MSG_CHECKING([for _ prefix in compiled symbols])\n+AC_CACHE_VAL(ac_cv_sys_symbol_underscore,\n+[ac_cv_sys_symbol_underscore=no\n+cat > conftest.$ac_ext <<EOF\n+void nm_test_func(){}\n+int main(){nm_test_func;return 0;}\n+EOF\n+if AC_TRY_EVAL(ac_compile); then\n+  # Now try to grab the symbols.\n+  ac_nlist=conftest.nm\n+  if AC_TRY_EVAL(NM conftest.$ac_objext \\| $ac_cv_sys_global_symbol_pipe \\> $ac_nlist) && test -s \"$ac_nlist\"; then\n+    # See whether the symbols have a leading underscore.\n+    if egrep '^. _nm_test_func' \"$ac_nlist\" >/dev/null; then\n+      ac_cv_sys_symbol_underscore=yes\n+    else\n+      if egrep '^. nm_test_func ' \"$ac_nlist\" >/dev/null; then\n+\t:\n+      else\n+\techo \"configure: cannot find nm_test_func in $ac_nlist\" >&AC_FD_CC\n+      fi\n+    fi\n+  else\n+    echo \"configure: cannot run $ac_cv_sys_global_symbol_pipe\" >&AC_FD_CC\n+  fi\n+else\n+  echo \"configure: failed program was:\" >&AC_FD_CC\n+  cat conftest.c >&AC_FD_CC\n+fi\n+rm -rf conftest*\n+])\n+AC_MSG_RESULT($ac_cv_sys_symbol_underscore)\n+AC_LTDL_DLSYM_USCORE\n+])\n+\n+AC_DEFUN(AC_LTDL_DLSYM_USCORE,\n+[AC_REQUIRE([AC_LTDL_SYMBOL_USCORE])dnl\n+if test x\"$ac_cv_sys_symbol_underscore\" = xyes; then\n+  if test x\"$ac_cv_func_dlopen\" = xyes ||\n+     test x\"$ac_cv_lib_dl_dlopen\" = xyes ; then\n+\tAC_CACHE_CHECK([whether we have to add an underscore for dlsym],\n+\t\tlibltdl_cv_need_uscore, [dnl\n+\t\tAC_TRY_RUN([\n+#if HAVE_DLFCN_H\n+#include <dlfcn.h>\n+#endif\n+\n+#include <stdio.h>\n+\n+#ifdef RTLD_GLOBAL\n+# define LTDL_GLOBAL\tRTLD_GLOBAL\n+#else\n+# ifdef DL_GLOBAL\n+#  define LTDL_GLOBAL\tDL_GLOBAL\n+# else\n+#  define LTDL_GLOBAL\t0\n+# endif\n+#endif\n+\n+/* We may have to define LTDL_LAZY_OR_NOW in the command line if we\n+   find out it does not work in some platform. */\n+#ifndef LTDL_LAZY_OR_NOW\n+# ifdef RTLD_LAZY\n+#  define LTDL_LAZY_OR_NOW\tRTLD_LAZY\n+# else\n+#  ifdef DL_LAZY\n+#   define LTDL_LAZY_OR_NOW\tDL_LAZY\n+#  else\n+#   ifdef RTLD_NOW\n+#    define LTDL_LAZY_OR_NOW\tRTLD_NOW\n+#   else\n+#    ifdef DL_NOW\n+#     define LTDL_LAZY_OR_NOW\tDL_NOW\n+#    else\n+#     define LTDL_LAZY_OR_NOW\t0\n+#    endif\n+#   endif\n+#  endif\n+# endif\n+#endif\n+\n+fnord() { int i=42;}\n+main() { void *self, *ptr1, *ptr2; self=dlopen(0,LTDL_GLOBAL|LTDL_LAZY_OR_NOW);\n+    if(self) { ptr1=dlsym(self,\"fnord\"); ptr2=dlsym(self,\"_fnord\");\n+\t       if(ptr1 && !ptr2) { dlclose(self); exit(0); } } exit(1); }\n+],\tlibltdl_cv_need_uscore=no, libltdl_cv_need_uscore=yes,\n+\tlibltdl_cv_need_uscore=cross\n+)])\n+  fi\n+fi\n+\n+if test x\"$libltdl_cv_need_uscore\" = xyes; then\n+  AC_DEFINE(NEED_USCORE, 1,\n+    [Define if dlsym() requires a leading underscode in symbol names. ])\n+fi\n+])"}, {"sha": "43a94dbcc16ed77cd8918d3a8c009f6659fd7383", "filename": "libjava/libltdl/aclocal.m4", "status": "modified", "additions": 893, "deletions": 55, "changes": 948, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2Faclocal.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2Faclocal.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Flibltdl%2Faclocal.m4?ref=205f5ac60a175bc1739ef4edba1751c50d2aaa89", "patch": "@@ -11,27 +11,53 @@ dnl even the implied warranty of MERCHANTABILITY or FITNESS FOR A\n dnl PARTICULAR PURPOSE.\n \n \n-# serial 40 AC_PROG_LIBTOOL\n-AC_DEFUN(AC_PROG_LIBTOOL,\n+# serial 45 AC_PROG_LIBTOOL\n+AC_DEFUN(AC_PROG_LIBTOOL,[AC_REQUIRE([_AC_PROG_LIBTOOL])\n+dnl If AC_PROG_CXX has already been expanded, run AC_LIBTOOL_CXX\n+dnl immediately, otherwise, hook it in at the end of AC_PROG_CXX.\n+  AC_PROVIDE_IFELSE([AC_PROG_CXX],\n+    [AC_LIBTOOL_CXX],\n+    [define([AC_PROG_CXX], defn([AC_PROG_CXX])[AC_LIBTOOL_CXX\n+])])\n+\n+dnl Quote A][M_PROG_GCJ so that aclocal doesn't bring it in needlessly.\n+dnl If either AC_PROG_GCJ or A][M_PROG_GCJ have already been expanded, run\n+dnl AC_LIBTOOL_GCJ immediately, otherwise, hook it in at the end of both.\n+  AC_PROVIDE_IFELSE([AC_PROG_GCJ],\n+    [AC_LIBTOOL_GCJ],\n+    [AC_PROVIDE_IFELSE([A][M_PROG_GCJ],\n+        [AC_LIBTOOL_GCJ],\n+\t[ifdef([AC_PROG_GCJ],\n+\t       [define([AC_PROG_GCJ], defn([AC_PROG_GCJ])[AC_LIBTOOL_GCJ\n+])])\n+\t ifdef([A][M_PROG_GCJ],\n+\t       [define([A][M_PROG_GCJ], defn([A][M_PROG_GCJ])[AC_LIBTOOL_GCJ\n+])])])])])\n+\n+AC_DEFUN(_AC_PROG_LIBTOOL,\n [AC_REQUIRE([AC_LIBTOOL_SETUP])dnl\n+AC_BEFORE([$0],[AC_LIBTOOL_CXX])dnl\n+AC_BEFORE([$0],[AC_LIBTOOL_GCJ])dnl\n \n # Save cache, so that ltconfig can load it\n AC_CACHE_SAVE\n \n # Actually configure libtool.  ac_aux_dir is where install-sh is found.\n-CC=\"$CC\" CFLAGS=\"$CFLAGS\" CPPFLAGS=\"$CPPFLAGS\" \\\n-LD=\"$LD\" LDFLAGS=\"$LDFLAGS\" LIBS=\"$LIBS\" \\\n-LN_S=\"$LN_S\" NM=\"$NM\" RANLIB=\"$RANLIB\" \\\n-DLLTOOL=\"$DLLTOOL\" AS=\"$AS\" OBJDUMP=\"$OBJDUMP\" \\\n+AR=\"$AR\" LTCC=\"$CC\" CC=\"$CC\" CFLAGS=\"$CFLAGS\" CPPFLAGS=\"$CPPFLAGS\" \\\n+MAGIC=\"$MAGIC\" LD=\"$LD\" LDFLAGS=\"$LDFLAGS\" LIBS=\"$LIBS\" \\\n+LN_S=\"$LN_S\" NM=\"$NM\" RANLIB=\"$RANLIB\" STRIP=\"$STRIP\" \\\n+AS=\"$AS\" DLLTOOL=\"$DLLTOOL\" OBJDUMP=\"$OBJDUMP\" \\\n+objext=\"$OBJEXT\" exeext=\"$EXEEXT\" reload_flag=\"$reload_flag\" \\\n+deplibs_check_method=\"$deplibs_check_method\" file_magic_cmd=\"$file_magic_cmd\" \\\n ${CONFIG_SHELL-/bin/sh} $ac_aux_dir/ltconfig --no-reexec \\\n-$libtool_flags --no-verify $ac_aux_dir/ltmain.sh $lt_target \\\n+$libtool_flags --no-verify --build=\"$build\" $ac_aux_dir/ltmain.sh $host \\\n || AC_MSG_ERROR([libtool configure failed])\n \n # Reload cache, that may have been modified by ltconfig\n AC_CACHE_LOAD\n \n # This can be used to rebuild libtool when needed\n-LIBTOOL_DEPS=\"$ac_aux_dir/ltconfig $ac_aux_dir/ltmain.sh\"\n+LIBTOOL_DEPS=\"$ac_aux_dir/ltconfig $ac_aux_dir/ltmain.sh $ac_aux_dir/ltcf-c.sh\"\n \n # Always use our own libtool.\n LIBTOOL='$(SHELL) $(top_builddir)/libtool'\n@@ -49,18 +75,29 @@ AC_REQUIRE([AC_ENABLE_STATIC])dnl\n AC_REQUIRE([AC_ENABLE_FAST_INSTALL])dnl\n AC_REQUIRE([AC_CANONICAL_HOST])dnl\n AC_REQUIRE([AC_CANONICAL_BUILD])dnl\n-AC_REQUIRE([AC_PROG_RANLIB])dnl\n AC_REQUIRE([AC_PROG_CC])dnl\n AC_REQUIRE([AC_PROG_LD])dnl\n+AC_REQUIRE([AC_PROG_LD_RELOAD_FLAG])dnl\n AC_REQUIRE([AC_PROG_NM])dnl\n AC_REQUIRE([AC_PROG_LN_S])dnl\n+AC_REQUIRE([AC_DEPLIBS_CHECK_METHOD])dnl\n+# Autoconf 2.13's AC_OBJEXT and AC_EXEEXT macros only works for C compilers!\n+AC_REQUIRE([AC_OBJEXT])dnl\n+AC_REQUIRE([AC_EXEEXT])dnl\n dnl\n \n-case \"$target\" in\n-NONE) lt_target=\"$host\" ;;\n-*) lt_target=\"$target\" ;;\n+# Only perform the check for file, if the check method requires it\n+case \"$deplibs_check_method\" in\n+file_magic*)\n+  if test \"$file_magic_cmd\" = '${MAGIC}'; then\n+    AC_PATH_MAGIC\n+  fi\n+  ;;\n esac\n \n+AC_CHECK_TOOL(RANLIB, ranlib, :)\n+AC_CHECK_TOOL(STRIP, strip, :)\n+\n # Check for any special flags to pass to ltconfig.\n libtool_flags=\"--cache-file=$cache_file\"\n test \"$enable_shared\" = no && libtool_flags=\"$libtool_flags --disable-shared\"\n@@ -77,9 +114,15 @@ AC_ARG_ENABLE(libtool-lock,\n test \"x$enable_libtool_lock\" = xno && libtool_flags=\"$libtool_flags --disable-lock\"\n test x\"$silent\" = xyes && libtool_flags=\"$libtool_flags --silent\"\n \n+AC_ARG_WITH(pic,\n+  [  --with-pic              try to use only PIC/non-PIC objects [default=use both]],\n+     pic_mode=\"$withval\", pic_mode=default)\n+test x\"$pic_mode\" = xyes && libtool_flags=\"$libtool_flags --prefer-pic\"\n+test x\"$pic_mode\" = xno && libtool_flags=\"$libtool_flags --prefer-non-pic\"\n+\n # Some flags need to be propagated to the compiler or linker for good\n # libtool support.\n-case \"$lt_target\" in\n+case \"$host\" in\n *-*-irix6*)\n   # Find out which ABI we are using.\n   echo '[#]line __oline__ \"configure\"' > conftest.$ac_ext\n@@ -104,7 +147,10 @@ case \"$lt_target\" in\n   SAVE_CFLAGS=\"$CFLAGS\"\n   CFLAGS=\"$CFLAGS -belf\"\n   AC_CACHE_CHECK([whether the C compiler needs -belf], lt_cv_cc_needs_belf,\n-    [AC_TRY_LINK([],[],[lt_cv_cc_needs_belf=yes],[lt_cv_cc_needs_belf=no])])\n+    [AC_LANG_SAVE\n+     AC_LANG_C\n+     AC_TRY_LINK([],[],[lt_cv_cc_needs_belf=yes],[lt_cv_cc_needs_belf=no])\n+     AC_LANG_RESTORE])\n   if test x\"$lt_cv_cc_needs_belf\" != x\"yes\"; then\n     # this is probably gcc 2.8.0, egcs 1.0 or newer; no need for -belf\n     CFLAGS=\"$SAVE_CFLAGS\"\n@@ -116,8 +162,31 @@ ifdef([AC_PROVIDE_AC_LIBTOOL_WIN32_DLL],\n   AC_CHECK_TOOL(DLLTOOL, dlltool, false)\n   AC_CHECK_TOOL(AS, as, false)\n   AC_CHECK_TOOL(OBJDUMP, objdump, false)\n+\n+  # recent cygwin and mingw systems supply a stub DllMain which the user\n+  # can override, but on older systems we have to supply one\n+  AC_CACHE_CHECK([if libtool should supply DllMain function], lt_cv_need_dllmain,\n+    [AC_TRY_LINK([],\n+      [extern int __attribute__((__stdcall__)) DllMain(void*, int, void*);\n+      DllMain (0, 0, 0);],\n+      [lt_cv_need_dllmain=no],[lt_cv_need_dllmain=yes])])\n+\n+  case \"$host/$CC\" in\n+  *-*-cygwin*/gcc*-mno-cygwin*|*-*-mingw*)\n+    # old mingw systems require \"-dll\" to link a DLL, while more recent ones\n+    # require \"-mdll\"\n+    SAVE_CFLAGS=\"$CFLAGS\"\n+    CFLAGS=\"$CFLAGS -mdll\"\n+    AC_CACHE_CHECK([how to link DLLs], lt_cv_cc_dll_switch,\n+      [AC_TRY_LINK([], [], [lt_cv_cc_dll_switch=-mdll],[lt_cv_cc_dll_switch=-dll])])\n+    CFLAGS=\"$SAVE_CFLAGS\" ;;\n+  *-*-cygwin*)\n+    # cygwin systems need to pass --dll to the linker, and not link\n+    # crt.o which will require a WinMain@16 definition.\n+    lt_cv_cc_dll_switch=\"-Wl,--dll -nostartfiles\" ;;\n+  esac\n   ;;\n-])\n+  ])\n esac\n ])\n \n@@ -223,10 +292,94 @@ esac],\n enable_fast_install=AC_ENABLE_FAST_INSTALL_DEFAULT)dnl\n ])\n \n-# AC_ENABLE_FAST_INSTALL - set the default to --disable-fast-install\n+# AC_DISABLE_FAST_INSTALL - set the default to --disable-fast-install\n AC_DEFUN(AC_DISABLE_FAST_INSTALL, [AC_BEFORE([$0],[AC_LIBTOOL_SETUP])dnl\n AC_ENABLE_FAST_INSTALL(no)])\n \n+# AC_LIBTOOL_PICMODE - implement the --with-pic flag\n+# Usage: AC_LIBTOOL_PICMODE[(MODE)]\n+#   Where MODE is either `yes' or `no'.  If omitted, it defaults to\n+#   `both'.\n+AC_DEFUN(AC_LIBTOOL_PICMODE, [AC_BEFORE([$0],[AC_LIBTOOL_SETUP])dnl\n+pic_mode=ifelse($#,1,$1,default)])\n+\n+\n+# AC_PATH_TOOL_PREFIX - find a file program which can recognise shared library\n+AC_DEFUN(AC_PATH_TOOL_PREFIX,\n+[AC_MSG_CHECKING([for $1])\n+AC_CACHE_VAL(lt_cv_path_MAGIC,\n+[case \"$MAGIC\" in\n+  /*)\n+  lt_cv_path_MAGIC=\"$MAGIC\" # Let the user override the test with a path.\n+  ;;\n+  ?:/*)\n+  ac_cv_path_MAGIC=\"$MAGIC\" # Let the user override the test with a dos path.\n+  ;;\n+  *)\n+  ac_save_MAGIC=\"$MAGIC\"\n+  IFS=\"${IFS=   }\"; ac_save_ifs=\"$IFS\"; IFS=\":\"\n+dnl $ac_dummy forces splitting on constant user-supplied paths.\n+dnl POSIX.2 word splitting is done only on the output of word expansions,\n+dnl not every word.  This closes a longstanding sh security hole.\n+  ac_dummy=\"ifelse([$2], , $PATH, [$2])\"\n+  for ac_dir in $ac_dummy; do\n+    test -z \"$ac_dir\" && ac_dir=.\n+    if test -f $ac_dir/$1; then\n+      lt_cv_path_MAGIC=\"$ac_dir/$1\"\n+      if test -n \"$file_magic_test_file\"; then\n+\tcase \"$deplibs_check_method\" in\n+\t\"file_magic \"*)\n+\t  file_magic_regex=\"`expr \\\"$deplibs_check_method\\\" : \\\"file_magic \\(.*\\)\\\"`\"\n+\t  MAGIC=\"$lt_cv_path_MAGIC\"\n+\t  if eval $file_magic_cmd \\$file_magic_test_file 2> /dev/null |\n+\t    egrep \"$file_magic_regex\" > /dev/null; then\n+\t    :\n+\t  else\n+\t    cat <<EOF 1>&2\n+\n+*** Warning: the command libtool uses to detect shared libraries,\n+*** $file_magic_cmd, produces output that libtool cannot recognize.\n+*** The result is that libtool may fail to recognize shared libraries\n+*** as such.  This will affect the creation of libtool libraries that\n+*** depend on shared libraries, but programs linked with such libtool\n+*** libraries will work regardless of this problem.  Nevertheless, you\n+*** may want to report the problem to your system manager and/or to\n+*** bug-libtool@gnu.org\n+\n+EOF\n+\t  fi ;;\n+\tesac\n+      fi\n+      break\n+    fi\n+  done\n+  IFS=\"$ac_save_ifs\"\n+  MAGIC=\"$ac_save_MAGIC\"\n+  ;;\n+esac])\n+MAGIC=\"$lt_cv_path_MAGIC\"\n+if test -n \"$MAGIC\"; then\n+  AC_MSG_RESULT($MAGIC)\n+else\n+  AC_MSG_RESULT(no)\n+fi\n+])\n+\n+\n+# AC_PATH_MAGIC - find a file program which can recognise a shared library\n+AC_DEFUN(AC_PATH_MAGIC,\n+[AC_REQUIRE([AC_CHECK_TOOL_PREFIX])dnl\n+AC_PATH_TOOL_PREFIX(${ac_tool_prefix}file, /usr/bin:$PATH)\n+if test -z \"$lt_cv_path_MAGIC\"; then\n+  if test -n \"$ac_tool_prefix\"; then\n+    AC_PATH_TOOL_PREFIX(file, /usr/bin:$PATH)\n+  else\n+    MAGIC=:\n+  fi\n+fi\n+])\n+\n+\n # AC_PROG_LD - find the path to the GNU or non-GNU linker\n AC_DEFUN(AC_PROG_LD,\n [AC_ARG_WITH(gnu-ld,\n@@ -239,7 +392,13 @@ ac_prog=ld\n if test \"$ac_cv_prog_gcc\" = yes; then\n   # Check if gcc -print-prog-name=ld gives a path.\n   AC_MSG_CHECKING([for ld used by GCC])\n-  ac_prog=`($CC -print-prog-name=ld) 2>&5`\n+  case $host in\n+  *-*-mingw*)\n+    # gcc leaves a trailing carriage return which upsets mingw\n+    ac_prog=`($CC -print-prog-name=ld) 2>&5 | tr -d '\\015'` ;;\n+  *)\n+    ac_prog=`($CC -print-prog-name=ld) 2>&5` ;;\n+  esac\n   case \"$ac_prog\" in\n     # Accept absolute paths.\n changequote(,)dnl\n@@ -306,8 +465,172 @@ if $LD -v 2>&1 </dev/null | egrep '(GNU|with BFD)' 1>&5; then\n else\n   ac_cv_prog_gnu_ld=no\n fi])\n+with_gnu_ld=$ac_cv_prog_gnu_ld\n ])\n \n+# AC_PROG_LD_RELOAD_FLAG - find reload flag for linker\n+#   -- PORTME Some linkers may need a different reload flag.\n+AC_DEFUN(AC_PROG_LD_RELOAD_FLAG,\n+[AC_CACHE_CHECK([for $LD option to reload object files], lt_cv_ld_reload_flag,\n+[lt_cv_ld_reload_flag='-r'])\n+reload_flag=$lt_cv_ld_reload_flag\n+test -n \"$reload_flag\" && reload_flag=\" $reload_flag\"\n+])\n+\n+# AC_DEPLIBS_CHECK_METHOD - how to check for library dependencies\n+#  -- PORTME fill in with the dynamic library characteristics\n+AC_DEFUN(AC_DEPLIBS_CHECK_METHOD,\n+[AC_CACHE_CHECK([how to recognise dependant libraries],\n+lt_cv_deplibs_check_method,\n+[lt_cv_file_magic_cmd='${MAGIC}'\n+lt_cv_file_magic_test_file=\n+lt_cv_deplibs_check_method='unknown'\n+# Need to set the preceding variable on all platforms that support\n+# interlibrary dependencies.\n+# 'none' -- dependencies not supported.\n+# `unknown' -- same as none, but documents that we really don't know.\n+# 'pass_all' -- all dependencies passed with no checks.\n+# 'test_compile' -- check by making test program.\n+# 'file_magic [regex]' -- check by looking for files in library path\n+# which responds to the $file_magic_cmd with a given egrep regex.\n+# If you have `file' or equivalent on your system and you're not sure\n+# whether `pass_all' will *always* work, you probably want this one.\n+\n+case \"$host_os\" in\n+aix4*)\n+  lt_cv_deplibs_check_method=pass_all\n+  ;;\n+\n+beos*)\n+  lt_cv_deplibs_check_method=pass_all\n+  ;;\n+\n+bsdi4*)\n+  changequote(,)dnl\n+  lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [ML]SB (shared object|dynamic lib)'\n+  changequote([, ])dnl\n+  lt_cv_file_magic_cmd='/usr/bin/file -L'\n+  lt_cv_file_magic_test_file=/shlib/libc.so\n+  ;;\n+\n+cygwin* | mingw*)\n+  lt_cv_deplibs_check_method='file_magic file format pei*-i386(.*architecture: i386)?'\n+  lt_cv_file_magic_cmd='${OBJDUMP} -f'\n+  ;;\n+\n+freebsd* )\n+  if echo __ELF__ | $CC -E - | grep __ELF__ > /dev/null; then\n+    case \"$host_cpu\" in\n+    i*86 )\n+      # Not sure whether the presence of OpenBSD here was a mistake.\n+      # Let's accept both of them until this is cleared up.\n+      changequote(,)dnl\n+      lt_cv_deplibs_check_method='file_magic (FreeBSD|OpenBSD)/i[3-9]86 (compact )?demand paged shared library'\n+      changequote([, ])dnl\n+      lt_cv_file_magic_cmd=/usr/bin/file\n+      lt_cv_file_magic_test_file=`echo /usr/lib/libc.so.*`\n+      ;;\n+    esac\n+  else\n+    lt_cv_deplibs_check_method=pass_all\n+  fi\n+  ;;\n+\n+gnu*)\n+  lt_cv_deplibs_check_method=pass_all\n+  ;;\n+\n+hpux10.20*)\n+  # TODO:  Does this work for hpux-11 too?\n+  lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|PA-RISC[0-9].[0-9]) shared library'\n+  lt_cv_file_magic_cmd=/usr/bin/file\n+  lt_cv_file_magic_test_file=/usr/lib/libc.sl\n+  ;;\n+\n+irix5* | irix6*)\n+  case \"$host_os\" in\n+  irix5*)\n+    # this will be overridden with pass_all, but let us keep it just in case\n+    lt_cv_deplibs_check_method=\"file_magic ELF 32-bit MSB dynamic lib MIPS - version 1\"\n+    ;;\n+  *)\n+    case \"$LD\" in\n+    *-32|*\"-32 \") libmagic=32-bit;;\n+    *-n32|*\"-n32 \") libmagic=N32;;\n+    *-64|*\"-64 \") libmagic=64-bit;;\n+    *) libmagic=never-match;;\n+    esac\n+    # this will be overridden with pass_all, but let us keep it just in case\n+    changequote(,)dnl\n+    lt_cv_deplibs_check_method=\"file_magic ELF ${libmagic} MSB mips-[1234] dynamic lib MIPS - version 1\"\n+    changequote([, ])dnl\n+    ;;\n+  esac\n+  lt_cv_file_magic_test_file=`echo /lib${libsuff}/libc.so*`\n+  lt_cv_deplibs_check_method=pass_all\n+  ;;\n+\n+# This must be Linux ELF.\n+linux-gnu*)\n+  case \"$host_cpu\" in\n+  alpha* | i*86 | powerpc* | sparc* | ia64* )\n+    lt_cv_deplibs_check_method=pass_all ;;\n+  *)\n+    # glibc up to 2.1.1 does not perform some relocations on ARM\n+    changequote(,)dnl\n+    lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB (shared object|dynamic lib )' ;;\n+    changequote([, ])dnl\n+  esac\n+  lt_cv_file_magic_test_file=`echo /lib/libc.so* /lib/libc-*.so`\n+  ;;\n+\n+netbsd*)\n+  if echo __ELF__ | $CC -E - | grep __ELF__ > /dev/null; then :\n+  else\n+    changequote(,)dnl\n+    lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB shared object'\n+    changequote([, ])dnl\n+    lt_cv_file_magic_cmd='/usr/bin/file -L'\n+    lt_cv_file_magic_test_file=`echo /usr/lib/libc.so*`\n+  fi\n+  ;;\n+\n+osf3* | osf4* | osf5*)\n+  # this will be overridden with pass_all, but let us keep it just in case\n+  lt_cv_deplibs_check_method='file_magic COFF format alpha shared library'\n+  lt_cv_file_magic_test_file=/shlib/libc.so\n+  lt_cv_deplibs_check_method=pass_all\n+  ;;\n+\n+sco3.2v5*)\n+  lt_cv_deplibs_check_method=pass_all\n+  ;;\n+\n+solaris*)\n+  lt_cv_deplibs_check_method=pass_all\n+  lt_cv_file_magic_test_file=/lib/libc.so\n+  ;;\n+\n+sysv4 | sysv4.2uw2* | sysv4.3* | sysv5*)\n+  case \"$host_vendor\" in\n+  ncr)\n+    lt_cv_deplibs_check_method=pass_all\n+    ;;\n+  motorola)\n+    changequote(,)dnl\n+    lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [ML]SB (shared object|dynamic lib) M[0-9][0-9]* Version [0-9]'\n+    changequote([, ])dnl\n+    lt_cv_file_magic_test_file=`echo /usr/lib/libc.so*`\n+    ;;\n+  esac\n+  ;;\n+esac\n+])\n+file_magic_cmd=$lt_cv_file_magic_cmd\n+deplibs_check_method=$lt_cv_deplibs_check_method\n+])\n+\n+\n # AC_PROG_NM - find the path to a BSD-compatible name lister\n AC_DEFUN(AC_PROG_NM,\n [AC_MSG_CHECKING([for BSD-compatible nm])\n@@ -319,18 +642,20 @@ else\n   IFS=\"${IFS= \t}\"; ac_save_ifs=\"$IFS\"; IFS=\"${IFS}${PATH_SEPARATOR-:}\"\n   for ac_dir in $PATH /usr/ccs/bin /usr/ucb /bin; do\n     test -z \"$ac_dir\" && ac_dir=.\n-    if test -f $ac_dir/nm || test -f $ac_dir/nm$ac_exeext ; then\n+    tmp_nm=$ac_dir/${ac_tool_prefix}nm\n+    if test -f $tmp_nm || test -f $tmp_nm$ac_exeext ; then\n       # Check to see if the nm accepts a BSD-compat flag.\n       # Adding the `sed 1q' prevents false positives on HP-UX, which says:\n       #   nm: unknown option \"B\" ignored\n-      if ($ac_dir/nm -B /dev/null 2>&1 | sed '1q'; exit 0) | egrep /dev/null >/dev/null; then\n-\tac_cv_path_NM=\"$ac_dir/nm -B\"\n+      # Tru64's nm complains that /dev/null is an invalid object file\n+      if ($tmp_nm -B /dev/null 2>&1 | sed '1q'; exit 0) | egrep '(/dev/null|Invalid file or object type)' >/dev/null; then\n+\tac_cv_path_NM=\"$tmp_nm -B\"\n \tbreak\n-      elif ($ac_dir/nm -p /dev/null 2>&1 | sed '1q'; exit 0) | egrep /dev/null >/dev/null; then\n-\tac_cv_path_NM=\"$ac_dir/nm -p\"\n+      elif ($tmp_nm -p /dev/null 2>&1 | sed '1q'; exit 0) | egrep /dev/null >/dev/null; then\n+\tac_cv_path_NM=\"$tmp_nm -p\"\n \tbreak\n       else\n-\tac_cv_path_NM=${ac_cv_path_NM=\"$ac_dir/nm\"} # keep the first match, but\n+\tac_cv_path_NM=${ac_cv_path_NM=\"$tmp_nm\"} # keep the first match, but\n \tcontinue # so that we can try to find one that supports BSD flags\n       fi\n     fi\n@@ -346,7 +671,7 @@ AC_MSG_RESULT([$NM])\n AC_DEFUN(AC_CHECK_LIBM,\n [AC_REQUIRE([AC_CANONICAL_HOST])dnl\n LIBM=\n-case \"$lt_target\" in\n+case \"$host\" in\n *-*-beos* | *-*-cygwin*)\n   # These system don't have libm\n   ;;\n@@ -361,31 +686,35 @@ esac\n ])\n \n # AC_LIBLTDL_CONVENIENCE[(dir)] - sets LIBLTDL to the link flags for\n-# the libltdl convenience library, adds --enable-ltdl-convenience to\n-# the configure arguments.  Note that LIBLTDL is not AC_SUBSTed, nor\n-# is AC_CONFIG_SUBDIRS called.  If DIR is not provided, it is assumed\n-# to be `${top_builddir}/libltdl'.  Make sure you start DIR with\n-# '${top_builddir}/' (note the single quotes!) if your package is not\n-# flat, and, if you're not using automake, define top_builddir as\n-# appropriate in the Makefiles.\n+# the libltdl convenience library and INCLTDL to the include flags for\n+# the libltdl header and adds --enable-ltdl-convenience to the\n+# configure arguments.  Note that LIBLTDL and INCLTDL are not\n+# AC_SUBSTed, nor is AC_CONFIG_SUBDIRS called.  If DIR is not\n+# provided, it is assumed to be `libltdl'.  LIBLTDL will be prefixed\n+# with '${top_builddir}/' and INCLTDL will be prefixed with\n+# '${top_srcdir}/' (note the single quotes!).  If your package is not\n+# flat and you're not using automake, define top_builddir and\n+# top_srcdir appropriately in the Makefiles.\n AC_DEFUN(AC_LIBLTDL_CONVENIENCE, [AC_BEFORE([$0],[AC_LIBTOOL_SETUP])dnl\n   case \"$enable_ltdl_convenience\" in\n   no) AC_MSG_ERROR([this package needs a convenience libltdl]) ;;\n   \"\") enable_ltdl_convenience=yes\n       ac_configure_args=\"$ac_configure_args --enable-ltdl-convenience\" ;;\n   esac\n-  LIBLTDL=ifelse($#,1,$1,['${top_builddir}/libltdl'])/libltdlc.la\n-  INCLTDL=ifelse($#,1,-I$1,['-I${top_builddir}/libltdl'])\n+  LIBLTDL='${top_builddir}/'ifelse($#,1,[$1],['libltdl'])/libltdlc.la\n+  INCLTDL='-I${top_srcdir}/'ifelse($#,1,[$1],['libltdl'])\n ])\n \n # AC_LIBLTDL_INSTALLABLE[(dir)] - sets LIBLTDL to the link flags for\n-# the libltdl installable library, and adds --enable-ltdl-install to\n-# the configure arguments.  Note that LIBLTDL is not AC_SUBSTed, nor\n-# is AC_CONFIG_SUBDIRS called.  If DIR is not provided, it is assumed\n-# to be `${top_builddir}/libltdl'.  Make sure you start DIR with\n-# '${top_builddir}/' (note the single quotes!) if your package is not\n-# flat, and, if you're not using automake, define top_builddir as\n-# appropriate in the Makefiles.\n+# the libltdl installable library and INCLTDL to the include flags for\n+# the libltdl header and adds --enable-ltdl-install to the configure\n+# arguments.  Note that LIBLTDL and INCLTDL are not AC_SUBSTed, nor is\n+# AC_CONFIG_SUBDIRS called.  If DIR is not provided and an installed\n+# libltdl is not found, it is assumed to be `libltdl'.  LIBLTDL will\n+# be prefixed with '${top_builddir}/' and INCLTDL will be prefixed\n+# with '${top_srcdir}/' (note the single quotes!).  If your package is\n+# not flat and you're not using automake, define top_builddir and\n+# top_srcdir appropriately in the Makefiles.\n # In the future, this macro may have to be called after AC_PROG_LIBTOOL.\n AC_DEFUN(AC_LIBLTDL_INSTALLABLE, [AC_BEFORE([$0],[AC_LIBTOOL_SETUP])dnl\n   AC_CHECK_LIB(ltdl, main,\n@@ -398,15 +727,83 @@ AC_DEFUN(AC_LIBLTDL_INSTALLABLE, [AC_BEFORE([$0],[AC_LIBTOOL_SETUP])dnl\n   ])\n   if test x\"$enable_ltdl_install\" = x\"yes\"; then\n     ac_configure_args=\"$ac_configure_args --enable-ltdl-install\"\n-    LIBLTDL=ifelse($#,1,$1,['${top_builddir}/libltdl'])/libltdl.la\n-    INCLTDL=ifelse($#,1,-I$1,['-I${top_builddir}/libltdl'])\n+    LIBLTDL='${top_builddir}/'ifelse($#,1,[$1],['libltdl'])/libltdl.la\n+    INCLTDL='-I${top_srcdir}/'ifelse($#,1,[$1],['libltdl'])\n   else\n     ac_configure_args=\"$ac_configure_args --enable-ltdl-install=no\"\n     LIBLTDL=\"-lltdl\"\n     INCLTDL=\n   fi\n ])\n \n+# If this macro is not defined by Autoconf, define it here.\n+ifdef([AC_PROVIDE_IFELSE],\n+      [],\n+      [define([AC_PROVIDE_IFELSE],\n+              [ifdef([AC_PROVIDE_$1],\n+                     [$2], [$3])])])\n+\n+# AC_LIBTOOL_CXX - enable support for C++ libraries\n+AC_DEFUN(AC_LIBTOOL_CXX,[AC_REQUIRE([_AC_LIBTOOL_CXX])])\n+AC_DEFUN(_AC_LIBTOOL_CXX,\n+[AC_REQUIRE([AC_PROG_LIBTOOL])\n+AC_REQUIRE([AC_PROG_CXX])\n+AC_REQUIRE([AC_PROG_CXXCPP])\n+LIBTOOL_DEPS=$LIBTOOL_DEPS\" $ac_aux_dir/ltcf-cxx.sh\"\n+lt_save_CC=\"$CC\"\n+lt_save_CFLAGS=\"$CFLAGS\"\n+dnl Make sure LTCC is set to the C compiler, i.e. set LTCC before CC\n+dnl is set to the C++ compiler.\n+AR=\"$AR\" LTCC=\"$CC\" CC=\"$CXX\" CXX=\"$CXX\" CFLAGS=\"$CXXFLAGS\" CPPFLAGS=\"$CPPFLAGS\" \\\n+MAGIC=\"$MAGIC\" LDFLAGS=\"$LDFLAGS\" LIBS=\"$LIBS\" \\\n+LN_S=\"$LN_S\" NM=\"$NM\" RANLIB=\"$RANLIB\" STRIP=\"$STRIP\" \\\n+AS=\"$AS\" DLLTOOL=\"$DLLTOOL\" OBJDUMP=\"$OBJDUMP\" \\\n+objext=\"$OBJEXT\" exeext=\"$EXEEXT\" reload_flag=\"$reload_flag\" \\\n+deplibs_check_method=\"$deplibs_check_method\" \\\n+file_magic_cmd=\"$file_magic_cmd\" \\\n+${CONFIG_SHELL-/bin/sh} $ac_aux_dir/ltconfig -o libtool $libtool_flags \\\n+--build=\"$build\" --add-tag=CXX $ac_aux_dir/ltcf-cxx.sh $host \\\n+|| AC_MSG_ERROR([libtool tag configuration failed])\n+CC=\"$lt_save_CC\"\n+CFLAGS=\"$lt_save_CFLAGS\"\n+\n+# Redirect the config.log output again, so that the ltconfig log is not\n+# clobbered by the next message.\n+exec 5>>./config.log\n+])\n+\n+# AC_LIBTOOL_GCJ - enable support for GCJ libraries\n+AC_DEFUN(AC_LIBTOOL_GCJ,[AC_REQUIRE([_AC_LIBTOOL_GCJ])])\n+AC_DEFUN(_AC_LIBTOOL_GCJ,\n+[AC_REQUIRE([AC_PROG_LIBTOOL])\n+AC_PROVIDE_IFELSE([AC_PROG_GCJ],[],\n+  [AC_PROVIDE_IFELSE([A][M_PROG_GCJ],[],\n+    [ifdef([AC_PROG_GCJ],[AC_REQUIRE([AC_PROG_GCJ])],\n+       [ifdef([A][M_PROG_GCJ],[AC_REQUIRE([A][M_PROG_GCJ])],\n+         [AC_REQUIRE([A][C_PROG_GCJ_OR_A][M_PROG_GCJ])])])])])\n+LIBTOOL_DEPS=$LIBTOOL_DEPS\" $ac_aux_dir/ltcf-gcj.sh\"\n+lt_save_CC=\"$CC\"\n+lt_save_CFLAGS=\"$CFLAGS\"\n+dnl Make sure LTCC is set to the C compiler, i.e. set LTCC before CC\n+dnl is set to the C++ compiler.\n+AR=\"$AR\" LTCC=\"$CC\" CC=\"$GCJ\" CFLAGS=\"$GCJFLAGS\" CPPFLAGS=\"\" \\\n+MAGIC=\"$MAGIC\" LDFLAGS=\"$LDFLAGS\" LIBS=\"$LIBS\" \\\n+LN_S=\"$LN_S\" NM=\"$NM\" RANLIB=\"$RANLIB\" STRIP=\"$STRIP\" \\\n+AS=\"$AS\" DLLTOOL=\"$DLLTOOL\" OBJDUMP=\"$OBJDUMP\" \\\n+objext=\"$OBJEXT\" exeext=\"$EXEEXT\" reload_flag=\"$reload_flag\" \\\n+deplibs_check_method=\"$deplibs_check_method\" \\\n+file_magic_cmd=\"$file_magic_cmd\" \\\n+${CONFIG_SHELL-/bin/sh} $ac_aux_dir/ltconfig -o libtool $libtool_flags \\\n+--build=\"$build\" --add-tag=GCJ $ac_aux_dir/ltcf-gcj.sh $host \\\n+|| AC_MSG_ERROR([libtool tag configuration failed])\n+CC=\"$lt_save_CC\"\n+CFLAGS=\"$lt_save_CFLAGS\"\n+\n+# Redirect the config.log output again, so that the ltconfig log is not\n+# clobbered by the next message.\n+exec 5>>./config.log\n+])\n+\n dnl old names\n AC_DEFUN(AM_PROG_LIBTOOL, [indir([AC_PROG_LIBTOOL])])dnl\n AC_DEFUN(AM_ENABLE_SHARED, [indir([AC_ENABLE_SHARED], $@)])dnl\n@@ -419,6 +816,460 @@ AC_DEFUN(AM_PROG_NM, [indir([AC_PROG_NM])])dnl\n dnl This is just to silence aclocal about the macro not being used\n ifelse([AC_DISABLE_FAST_INSTALL])dnl\n \n+AC_DEFUN([LT_AC_PROG_GCJ],[\n+  AC_CHECK_TOOL(GCJ, gcj, no)\n+  test \"x${GCJFLAGS+set}\" = xset || GCJFLAGS=\"-g -O2\"\n+  AC_SUBST(GCJFLAGS)\n+])\n+\n+# serial 1 AC_LIB_LTDL\n+\n+AC_DEFUN(AC_LIB_LTDL,\n+[AC_PREREQ(2.13)dnl\n+AC_REQUIRE([AC_PROG_CC])dnl\n+AC_REQUIRE([AC_C_CONST])dnl\n+AC_REQUIRE([AC_C_INLINE])dnl\n+\n+dnl AC_LIB_LTDL must perform all the checks necessary for compilation\n+dnl of the ltdl objects -- including compiler checks (above) and header\n+dnl checks (below).\n+AC_REQUIRE([AC_HEADER_STDC])dnl\n+\n+AC_CHECK_HEADERS(malloc.h memory.h stdlib.h stdio.h ctype.h dlfcn.h dl.h dld.h)\n+AC_CHECK_HEADERS(string.h strings.h, break)\n+AC_CHECK_FUNCS(strchr index, break)\n+AC_CHECK_FUNCS(strrchr rindex, break)\n+AC_CHECK_FUNCS(strcmp)\n+\n+AC_REQUIRE([AC_LTDL_ENABLE_INSTALL])dnl\n+AC_REQUIRE([AC_LTDL_SHLIBEXT])dnl\n+AC_REQUIRE([AC_LTDL_SHLIBPATH])dnl\n+AC_REQUIRE([AC_LTDL_SYSSEARCHPATH])dnl\n+AC_REQUIRE([AC_LTDL_OBJDIR])dnl\n+AC_REQUIRE([AC_LTDL_DLPREOPEN])dnl\n+AC_REQUIRE([AC_LTDL_DLLIB])dnl\n+AC_REQUIRE([AC_LTDL_SYMBOL_USCORE])dnl\n+])\n+\n+AC_DEFUN(AC_LTDL_ENABLE_INSTALL,\n+[AC_ARG_ENABLE(ltdl-install,\n+[  --enable-ltdl-install   install libltdl])\n+\n+AM_CONDITIONAL(INSTALL_LTDL, test x\"${enable_ltdl_install-no}\" != xno)\n+AM_CONDITIONAL(CONVENIENCE_LTDL, test x\"${enable_ltdl_convenience-no}\" != xno)\n+])])\n+\n+\n+AC_DEFUN(AC_LTDL_SNARF_CONFIG,\n+[# Read the libtool configuration\n+rm -f conftest\n+./libtool --config > conftest\n+. ./conftest\n+rm -f conftest\n+])\n+\n+AC_DEFUN(AC_LTDL_SHLIBEXT,\n+[AC_REQUIRE([AC_LTDL_SNARF_CONFIG])dnl\n+AC_CACHE_CHECK([which extension is used for shared libraries],\n+  libltdl_cv_shlibext, [dnl\n+(\n+  last=\n+  for spec in $library_names_spec; do\n+    last=\"$spec\"\n+  done\n+changequote(, )\n+  echo \"$last\" | sed 's/\\[.*\\]//;s/^[^.]*//;s/\\$.*$//;s/\\.$//' > conftest\n+changequote([, ])\n+)\n+libltdl_cv_shlibext=`cat conftest`\n+rm -f conftest\n+])\n+if test -n \"$libltdl_cv_shlibext\"; then\n+  AC_DEFINE_UNQUOTED(LTDL_SHLIB_EXT, \"$libltdl_cv_shlibext\",\n+    [Define to the extension used for shared libraries, say, \".so\". ])\n+fi\n+])\n+\n+AC_DEFUN(AC_LTDL_SHLIBPATH,\n+[AC_REQUIRE([AC_LTDL_SNARF_CONFIG])dnl\n+AC_CACHE_CHECK([which variable specifies run-time library path],\n+  libltdl_cv_shlibpath_var, [libltdl_cv_shlibpath_var=\"$shlibpath_var\"])\n+if test -n \"$libltdl_cv_shlibpath_var\"; then\n+  AC_DEFINE_UNQUOTED(LTDL_SHLIBPATH_VAR, \"$libltdl_cv_shlibpath_var\",\n+    [Define to the name of the environment variable that determines the dynamic library search path. ])\n+fi\n+])\n+\n+AC_DEFUN(AC_LTDL_SYSSEARCHPATH,\n+[AC_REQUIRE([AC_LTDL_SNARF_CONFIG])dnl\n+AC_CACHE_CHECK([for the default library search path],\n+  libltdl_cv_sys_search_path, [libltdl_cv_sys_search_path=\"$sys_lib_dlsearch_path_spec\"])\n+if test -n \"$libltdl_cv_sys_search_path\"; then\n+  case \"$host\" in\n+  *-*-mingw*) pathsep=\";\" ;;\n+  *) pathsep=\":\" ;;\n+  esac\n+  sys_search_path=\n+  for dir in $libltdl_cv_sys_search_path; do\n+    if test -z \"$sys_search_path\"; then\n+      sys_search_path=\"$dir\"\n+    else\n+      sys_search_path=\"$sys_search_path$pathsep$dir\"\n+    fi\n+  done\n+  AC_DEFINE_UNQUOTED(LTDL_SYSSEARCHPATH, \"$sys_search_path\",\n+    [Define to the system default library search path. ])\n+fi\n+])\n+\n+AC_DEFUN(AC_LTDL_OBJDIR,\n+[AC_CACHE_CHECK([for objdir],\n+  libltdl_cv_objdir, [libltdl_cv_objdir=\"$objdir\"\n+if test -n \"$objdir\"; then\n+  :\n+else\n+  rm -f .libs 2>/dev/null\n+  mkdir .libs 2>/dev/null\n+  if test -d .libs; then\n+    libltdl_cv_objdir=.libs\n+  else\n+    # MS-DOS does not allow filenames that begin with a dot.\n+    libltdl_cv_objdir=_libs\n+  fi\n+rmdir .libs 2>/dev/null\n+fi])\n+AC_DEFINE_UNQUOTED(LTDL_OBJDIR, \"$libltdl_cv_objdir/\",\n+  [Define to the sub-directory in which libtool stores uninstalled libraries. ])\n+])\n+\n+AC_DEFUN(AC_LTDL_DLPREOPEN,\n+[AC_REQUIRE([AC_LTDL_GLOBAL_SYMBOL_PIPE])dnl\n+AC_CACHE_CHECK([whether libtool supports -dlopen/-dlpreopen],\n+       libltdl_cv_preloaded_symbols, [dnl\n+  if test -n \"$global_symbol_pipe\"; then\n+    libltdl_cv_preloaded_symbols=yes\n+  else\n+    libltdl_cv_preloaded_symbols=no\n+  fi\n+])\n+if test x\"$libltdl_cv_preloaded_symbols\" = x\"yes\"; then\n+  AC_DEFINE(HAVE_PRELOADED_SYMBOLS, 1,\n+    [Define if libtool can extract symbol lists from object files. ])\n+fi\n+])\n+\n+AC_DEFUN(AC_LTDL_DLLIB,\n+[LIBADD_DL=\n+AC_CHECK_LIB(dl, dlopen, [AC_DEFINE(HAVE_LIBDL, 1,\n+   [Define if you have the libdl library or equivalent. ]) LIBADD_DL=\"-ldl\"],\n+[AC_CHECK_FUNC(dlopen, [AC_DEFINE(HAVE_LIBDL, 1,\n+   [Define if you have the libdl library or equivalent.])],\n+[AC_CHECK_LIB(svld, dlopen, [AC_DEFINE(HAVE_LIBDL, 1,\n+   [Define if you have the libdl library or equivalent.]) LIBADD_DL=\"-lsvld\"]\n+)])])\n+AC_CHECK_FUNC(shl_load, [AC_DEFINE(HAVE_SHL_LOAD, 1,\n+   [Define if you have the shl_load function.])],\n+[AC_CHECK_LIB(dld, shl_load,\n+  [AC_DEFINE(HAVE_SHL_LOAD, 1,\n+     [Define if you have the shl_load function.])\n+   LIBADD_DL=\"$LIBADD_DL -ldld\"])\n+])\n+AC_CHECK_LIB(dld, dld_link, [AC_DEFINE(HAVE_DLD, 1,\n+  [Define if you have the GNU dld library.])dnl\n+test \"x$ac_cv_lib_dld_shl_load\" = yes || LIBADD_DL=\"$LIBADD_DL -ldld\"])\n+AC_SUBST(LIBADD_DL)\n+\n+if test \"x$ac_cv_func_dlopen\" = xyes || test \"x$ac_cv_lib_dl_dlopen\" = xyes; then\n+ LIBS_SAVE=\"$LIBS\"\n+ LIBS=\"$LIBS $LIBADD_DL\"\n+ AC_CHECK_FUNCS(dlerror)\n+ LIBS=\"$LIBS_SAVE\"\n+fi\n+])\n+\n+AC_DEFUN(AC_LTDL_GLOBAL_SYMBOL_PIPE,\n+[dnl Check for command to grab the raw symbol name followed\n+dnl by C symbol name from nm.\n+AC_REQUIRE([AC_CANONICAL_HOST])dnl\n+AC_REQUIRE([AC_PROG_NM])dnl\n+# Check for command to grab the raw symbol name followed by C symbol from nm.\n+AC_MSG_CHECKING([command to parse $NM output])\n+AC_CACHE_VAL(ac_cv_sys_global_symbol_pipe,\n+[# These are sane defaults that work on at least a few old systems.\n+# {They come from Ultrix.  What could be older than Ultrix?!! ;)}\n+\n+changequote(,)dnl\n+# Character class describing NM global symbol codes.\n+ac_symcode='[BCDEGRST]'\n+\n+# Regexp to match symbols that can be accessed directly from C.\n+ac_sympat='\\([_A-Za-z][_A-Za-z0-9]*\\)'\n+\n+# Transform the above into a raw symbol and a C symbol.\n+ac_symxfrm='\\1 \\2\\3 \\3'\n+\n+# Transform an extracted symbol line into a proper C declaration\n+ac_global_symbol_to_cdecl=\"sed -n -e 's/^. .* \\(.*\\)$/extern char \\1;/p'\"\n+\n+# Define system-specific variables.\n+case \"$host_os\" in\n+aix*)\n+  ac_symcode='[BCDT]'\n+  ;;\n+cygwin* | mingw*)\n+  ac_symcode='[ABCDGISTW]'\n+  ;;\n+hpux*)\n+  ac_global_symbol_to_cdecl=\"sed -n -e 's/^T .* \\(.*\\)$/extern char \\1();/p' -e 's/^. .* \\(.*\\)$/extern char \\1;/p'\"\n+  ;;\n+irix*)\n+  ac_symcode='[BCDEGRST]'\n+  ;;\n+solaris*)\n+  ac_symcode='[BDT]'\n+  ;;\n+esac\n+\n+# If we're using GNU nm, then use its standard symbol codes.\n+if $NM -V 2>&1 | egrep '(GNU|with BFD)' > /dev/null; then\n+  ac_symcode='[ABCDGISTW]'\n+fi\n+changequote([,])dnl\n+\n+# Try without a prefix undercore, then with it.\n+for ac_symprfx in \"\" \"_\"; do\n+\n+  ac_cv_sys_global_symbol_pipe=\"sed -n -e 's/^.*[ \t]\\($ac_symcode\\)[ \t][ \t]*\\($ac_symprfx\\)$ac_sympat$/$ac_symxfrm/p'\"\n+\n+  # Check to see that the pipe works correctly.\n+  ac_pipe_works=no\n+  rm -f conftest.$ac_ext\n+  cat > conftest.$ac_ext <<EOF\n+#ifdef __cplusplus\n+extern \"C\" {\n+#endif\n+char nm_test_var;\n+void nm_test_func(){}\n+#ifdef __cplusplus\n+}\n+#endif\n+int main(){nm_test_var='a';nm_test_func;return 0;}\n+EOF\n+\n+  if AC_TRY_EVAL(ac_compile); then\n+    # Now try to grab the symbols.\n+    ac_nlist=conftest.nm\n+\n+    if AC_TRY_EVAL(NM conftest.$ac_objext \\| $ac_cv_sys_global_symbol_pipe \\> $ac_nlist) && test -s \"$ac_nlist\"; then\n+\n+      # Try sorting and uniquifying the output.\n+      if sort \"$ac_nlist\" | uniq > \"$ac_nlist\"T; then\n+\tmv -f \"$ac_nlist\"T \"$ac_nlist\"\n+      else\n+\trm -f \"$ac_nlist\"T\n+      fi\n+\n+      # Make sure that we snagged all the symbols we need.\n+      if egrep ' nm_test_var$' \"$ac_nlist\" >/dev/null; then\n+\tif egrep ' nm_test_func$' \"$ac_nlist\" >/dev/null; then\n+\t  cat <<EOF > conftest.c\n+#ifdef __cplusplus\n+extern \"C\" {\n+#endif\n+\n+EOF\n+\t  # Now generate the symbol file.\n+\t  eval \"$ac_global_symbol_to_cdecl\"' < \"$ac_nlist\" >> conftest.c'\n+\n+\t  cat <<EOF >> conftest.c\n+#if defined (__STDC__) && __STDC__\n+# define lt_ptr_t void *\n+#else\n+# define lt_ptr_t char *\n+# define const\n+#endif\n+\n+/* The mapping between symbol names and symbols. */\n+const struct {\n+  const char *name;\n+  lt_ptr_t address;\n+}\n+changequote(,)dnl\n+lt_preloaded_symbols[] =\n+changequote([,])dnl\n+{\n+EOF\n+\tsed 's/^. \\(.*\\) \\(.*\\)$/  {\"\\2\", (lt_ptr_t) \\&\\2},/' < \"$ac_nlist\" >> conftest.c\n+\tcat <<\\EOF >> conftest.c\n+  {0, (lt_ptr_t) 0}\n+};\n+\n+#ifdef __cplusplus\n+}\n+#endif\n+EOF\n+\t  # Now try linking the two files.\n+\t  mv conftest.$ac_objext conftstm.$ac_objext\n+\t  ac_save_LIBS=\"$LIBS\"\n+\t  ac_save_CFLAGS=\"$CFLAGS\"\n+\t  LIBS=\"conftstm.$ac_objext\"\n+\t  CFLAGS=\"$CFLAGS$no_builtin_flag\"\n+\t  if AC_TRY_EVAL(ac_link) && test -s conftest; then\n+\t    ac_pipe_works=yes\n+\t  else\n+\t    echo \"configure: failed program was:\" >&AC_FD_CC\n+\t    cat conftest.c >&AC_FD_CC\n+\t  fi\n+\t  LIBS=\"$ac_save_LIBS\"\n+\t  CFLAGS=\"$ac_save_CFLAGS\"\n+\telse\n+\t  echo \"cannot find nm_test_func in $ac_nlist\" >&AC_FD_CC\n+\tfi\n+      else\n+\techo \"cannot find nm_test_var in $ac_nlist\" >&AC_FD_CC\n+      fi\n+    else\n+      echo \"cannot run $ac_cv_sys_global_symbol_pipe\" >&AC_FD_CC\n+    fi\n+  else\n+    echo \"$progname: failed program was:\" >&AC_FD_CC\n+    cat conftest.c >&AC_FD_CC\n+  fi\n+  rm -rf conftest* conftst*\n+\n+  # Do not use the global_symbol_pipe unless it works.\n+  if test \"$ac_pipe_works\" = yes; then\n+    if test x\"$ac_symprfx\" = x\"_\"; then\n+      ac_cv_sys_symbol_underscore=yes\n+    else\n+      ac_cv_sys_symbol_underscore=no\n+    fi\n+    break\n+  else\n+    ac_cv_sys_global_symbol_pipe=\n+  fi\n+done\n+])\n+\n+ac_result=yes\n+if test -z \"$ac_cv_sys_global_symbol_pipe\"; then\n+   ac_result=no\n+fi\n+AC_MSG_RESULT($ac_result)\n+])\n+\n+AC_DEFUN(AC_LTDL_SYMBOL_USCORE,\n+[dnl does the compiler prefix global symbols with an underscore?\n+AC_REQUIRE([AC_LTDL_GLOBAL_SYMBOL_PIPE])dnl\n+AC_MSG_CHECKING([for _ prefix in compiled symbols])\n+AC_CACHE_VAL(ac_cv_sys_symbol_underscore,\n+[ac_cv_sys_symbol_underscore=no\n+cat > conftest.$ac_ext <<EOF\n+void nm_test_func(){}\n+int main(){nm_test_func;return 0;}\n+EOF\n+if AC_TRY_EVAL(ac_compile); then\n+  # Now try to grab the symbols.\n+  ac_nlist=conftest.nm\n+  if AC_TRY_EVAL(NM conftest.$ac_objext \\| $ac_cv_sys_global_symbol_pipe \\> $ac_nlist) && test -s \"$ac_nlist\"; then\n+    # See whether the symbols have a leading underscore.\n+    if egrep '^. _nm_test_func' \"$ac_nlist\" >/dev/null; then\n+      ac_cv_sys_symbol_underscore=yes\n+    else\n+      if egrep '^. nm_test_func ' \"$ac_nlist\" >/dev/null; then\n+\t:\n+      else\n+\techo \"configure: cannot find nm_test_func in $ac_nlist\" >&AC_FD_CC\n+      fi\n+    fi\n+  else\n+    echo \"configure: cannot run $ac_cv_sys_global_symbol_pipe\" >&AC_FD_CC\n+  fi\n+else\n+  echo \"configure: failed program was:\" >&AC_FD_CC\n+  cat conftest.c >&AC_FD_CC\n+fi\n+rm -rf conftest*\n+])\n+AC_MSG_RESULT($ac_cv_sys_symbol_underscore)\n+AC_LTDL_DLSYM_USCORE\n+])\n+\n+AC_DEFUN(AC_LTDL_DLSYM_USCORE,\n+[AC_REQUIRE([AC_LTDL_SYMBOL_USCORE])dnl\n+if test x\"$ac_cv_sys_symbol_underscore\" = xyes; then\n+  if test x\"$ac_cv_func_dlopen\" = xyes ||\n+     test x\"$ac_cv_lib_dl_dlopen\" = xyes ; then\n+\tAC_CACHE_CHECK([whether we have to add an underscore for dlsym],\n+\t\tlibltdl_cv_need_uscore, [dnl\n+\t\tAC_TRY_RUN([\n+#if HAVE_DLFCN_H\n+#include <dlfcn.h>\n+#endif\n+\n+#include <stdio.h>\n+\n+#ifdef RTLD_GLOBAL\n+# define LTDL_GLOBAL\tRTLD_GLOBAL\n+#else\n+# ifdef DL_GLOBAL\n+#  define LTDL_GLOBAL\tDL_GLOBAL\n+# else\n+#  define LTDL_GLOBAL\t0\n+# endif\n+#endif\n+\n+/* We may have to define LTDL_LAZY_OR_NOW in the command line if we\n+   find out it does not work in some platform. */\n+#ifndef LTDL_LAZY_OR_NOW\n+# ifdef RTLD_LAZY\n+#  define LTDL_LAZY_OR_NOW\tRTLD_LAZY\n+# else\n+#  ifdef DL_LAZY\n+#   define LTDL_LAZY_OR_NOW\tDL_LAZY\n+#  else\n+#   ifdef RTLD_NOW\n+#    define LTDL_LAZY_OR_NOW\tRTLD_NOW\n+#   else\n+#    ifdef DL_NOW\n+#     define LTDL_LAZY_OR_NOW\tDL_NOW\n+#    else\n+#     define LTDL_LAZY_OR_NOW\t0\n+#    endif\n+#   endif\n+#  endif\n+# endif\n+#endif\n+\n+fnord() { int i=42;}\n+main() { void *self, *ptr1, *ptr2; self=dlopen(0,LTDL_GLOBAL|LTDL_LAZY_OR_NOW);\n+    if(self) { ptr1=dlsym(self,\"fnord\"); ptr2=dlsym(self,\"_fnord\");\n+\t       if(ptr1 && !ptr2) { dlclose(self); exit(0); } } exit(1); }\n+],\tlibltdl_cv_need_uscore=no, libltdl_cv_need_uscore=yes,\n+\tlibltdl_cv_need_uscore=cross\n+)])\n+  fi\n+fi\n+\n+if test x\"$libltdl_cv_need_uscore\" = xyes; then\n+  AC_DEFINE(NEED_USCORE, 1,\n+    [Define if dlsym() requires a leading underscode in symbol names. ])\n+fi\n+])\n+\n+# Define a conditional.\n+\n+AC_DEFUN(AM_CONDITIONAL,\n+[AC_SUBST($1_TRUE)\n+AC_SUBST($1_FALSE)\n+if $2; then\n+  $1_TRUE=\n+  $1_FALSE='#'\n+else\n+  $1_TRUE='#'\n+  $1_FALSE=\n+fi])\n+\n # Do all the work for Automake.  This macro actually does too much --\n # some checks are only needed if your package does certain things.\n # But this isn't really a big deal.\n@@ -554,16 +1405,3 @@ AC_DEFUN(AM_MAINTAINER_MODE,\n ]\n )\n \n-# Define a conditional.\n-\n-AC_DEFUN(AM_CONDITIONAL,\n-[AC_SUBST($1_TRUE)\n-AC_SUBST($1_FALSE)\n-if $2; then\n-  $1_TRUE=\n-  $1_FALSE='#'\n-else\n-  $1_TRUE='#'\n-  $1_FALSE=\n-fi])\n-"}, {"sha": "95e384928b31cd44730703d083f4a7d3470fdf24", "filename": "libjava/libltdl/config.h.in", "status": "modified", "additions": 24, "deletions": 9, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2Fconfig.h.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2Fconfig.h.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Flibltdl%2Fconfig.h.in?ref=205f5ac60a175bc1739ef4edba1751c50d2aaa89", "patch": "@@ -9,15 +9,6 @@\n /* Define if you have the ANSI C header files.  */\n #undef STDC_HEADERS\n \n-/* Define if you have the libdl library or equivalent.  */\n-#undef HAVE_LIBDL\n-\n-/* Define if you have the GNU dld library.  */\n-#undef HAVE_DLD\n-\n-/* Define if you have the shl_load function.  */\n-#undef HAVE_SHL_LOAD\n-\n /* Define if you are using the Boehm GC.  */\n #undef HAVE_BOEHM_GC\n \n@@ -33,6 +24,9 @@\n /* Define if you have the strchr function.  */\n #undef HAVE_STRCHR\n \n+/* Define if you have the strcmp function.  */\n+#undef HAVE_STRCMP\n+\n /* Define if you have the strrchr function.  */\n #undef HAVE_STRRCHR\n \n@@ -72,12 +66,33 @@\n /* Define to the name of the environment variable that determines the dynamic library search path.  */\n #undef LTDL_SHLIBPATH_VAR\n \n+/* Define to the system default library search path.  */\n+#undef LTDL_SYSSEARCHPATH\n+\n /* Define to the sub-directory in which libtool stores uninstalled libraries.  */\n #undef LTDL_OBJDIR\n \n /* Define if libtool can extract symbol lists from object files.  */\n #undef HAVE_PRELOADED_SYMBOLS\n \n+/* Define if you have the libdl library or equivalent.  */\n+#undef HAVE_LIBDL\n+\n+/* Define if you have the libdl library or equivalent. */\n+#undef HAVE_LIBDL\n+\n+/* Define if you have the libdl library or equivalent. */\n+#undef HAVE_LIBDL\n+\n+/* Define if you have the shl_load function. */\n+#undef HAVE_SHL_LOAD\n+\n+/* Define if you have the shl_load function. */\n+#undef HAVE_SHL_LOAD\n+\n+/* Define if you have the GNU dld library. */\n+#undef HAVE_DLD\n+\n /* Define if dlsym() requires a leading underscode in symbol names.  */\n #undef NEED_USCORE\n "}, {"sha": "f0e6f22323daaad0f3b5b1f0740f41b027227d90", "filename": "libjava/libltdl/configure", "status": "modified", "additions": 1734, "deletions": 731, "changes": 2465, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Flibltdl%2Fconfigure?ref=205f5ac60a175bc1739ef4edba1751c50d2aaa89"}, {"sha": "188fc101da45899cba8135b25393ca7e7668fe84", "filename": "libjava/libltdl/configure.in", "status": "modified", "additions": 11, "deletions": 340, "changes": 351, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2Fconfigure.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2Fconfigure.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Flibltdl%2Fconfigure.in?ref=205f5ac60a175bc1739ef4edba1751c50d2aaa89", "patch": "@@ -2,6 +2,13 @@ dnl Process this file with autoconf to create configure.\n \n AC_INIT(ltdl.c)\n \n+dnl We shouldn't be using these internal macros of autoconf,\n+dnl but CONFIG_AUX_DIR($with_auxdir) breaks automake.\n+AC_ARG_WITH(auxdir,\n+[  --with-auxdir=DIR   path to autoconf auxiliary files],\n+[AC_CONFIG_AUX_DIRS($with_auxdir)],\n+[AC_CONFIG_AUX_DIR_DEFAULT])\n+\n if test -z \"$enable_ltdl_install$enable_ltdl_convenience\"; then\n   if test -f ${srcdir}/ltconfig && test -f ${srcdir}/ltmain.sh; then\n     # if libltdl is libtoolized, it is assumed to be stand-alone and\n@@ -14,19 +21,18 @@ if test -z \"$enable_ltdl_install$enable_ltdl_convenience\"; then\n   fi\n fi\n \n-AM_INIT_AUTOMAKE(libltdl,1.0,-)\n+AM_INIT_AUTOMAKE(libltdl,1.1,-)\n AM_CONFIG_HEADER(config.h)\n AM_MAINTAINER_MODE\n \n AC_PROG_CC\n AC_C_CONST\n AC_C_INLINE\n+\n+AC_LIBTOOL_WIN32_DLL\n AM_PROG_LIBTOOL\n AC_SUBST(LIBTOOL_DEPS)\n \n-AC_ARG_ENABLE(ltdl-install,\n-[  --enable-ltdl-install   install libltdl])\n-\n AC_MSG_CHECKING([for garbage collector to use])\n AC_ARG_ENABLE(java-gc,\n changequote(<<,>>)dnl\n@@ -43,342 +49,7 @@ if test \"$GC\" = \"boehm\"; then\n fi\n AC_SUBST(GCINCS)\n \n-AM_CONDITIONAL(INSTALL_LTDL, test x\"${enable_ltdl_install-no}\" != xno)\n-AM_CONDITIONAL(CONVENIENCE_LTDL, test x\"${enable_ltdl_convenience-no}\" != xno)\n-\n-dnl Read the libtool configuration\n-rm -f conftest\n-./libtool --config > conftest\n-. ./conftest\n-rm -f conftest\n-\n-AC_CACHE_CHECK([which extension is used for shared libraries],\n-  libltdl_cv_shlibext, [dnl\n-(\n-  last=\n-  for spec in $library_names_spec; do\n-    last=\"$spec\"\n-  done\n-changequote(, )\n-  echo \"$last\" | sed 's/\\[.*\\]//;s/^[^.]*//;s/\\$.*$//;s/\\.$//' > conftest\n-changequote([, ])\n-)\n-libltdl_cv_shlibext=`cat conftest`\n-rm -f conftest\n-])\n-if test -n \"$libltdl_cv_shlibext\"; then\n-  AC_DEFINE_UNQUOTED(LTDL_SHLIB_EXT, \"$libltdl_cv_shlibext\",\n-    [Define to the extension used for shared libraries, say, \".so\". ])\n-fi\n-\n-AC_CACHE_CHECK([which variable specifies run-time library path],\n-  libltdl_cv_shlibpath_var, [libltdl_cv_shlibpath_var=\"$shlibpath_var\"])\n-if test -n \"$libltdl_cv_shlibpath_var\"; then\n-  AC_DEFINE_UNQUOTED(LTDL_SHLIBPATH_VAR, \"$libltdl_cv_shlibpath_var\",\n-    [Define to the name of the environment variable that determines the dynamic library search path. ])\n-fi\n-\n-AC_CACHE_CHECK([for objdir],\n-  libltdl_cv_objdir, [libltdl_cv_objdir=\"$objdir\"])\n-test -z \"$libltdl_cv_objdir\" && libltdl_cv_objdir=\".libs\"\n-AC_DEFINE_UNQUOTED(LTDL_OBJDIR, \"$libltdl_cv_objdir/\",\n-  [Define to the sub-directory in which libtool stores uninstalled libraries. ])\n-\n-AC_HEADER_STDC\n-AC_CHECK_HEADERS(malloc.h memory.h stdlib.h stdio.h ctype.h dlfcn.h dl.h dld.h)\n-AC_CHECK_HEADERS(string.h strings.h, break)\n-AC_CHECK_FUNCS(strchr index, break)\n-AC_CHECK_FUNCS(strrchr rindex, break)\n-\n-AC_CACHE_CHECK([whether libtool supports -dlopen/-dlpreopen],\n-       libltdl_cv_preloaded_symbols, [dnl\n-  if test -n \"$global_symbol_pipe\"; then\n-    libltdl_cv_preloaded_symbols=yes\n-  else\n-    libltdl_cv_preloaded_symbols=no\n-  fi\n-])\n-if test x\"$libltdl_cv_preloaded_symbols\" = x\"yes\"; then\n-  AC_DEFINE(HAVE_PRELOADED_SYMBOLS, 1,\n-    [Define if libtool can extract symbol lists from object files. ])\n-fi\n-\n-LIBADD_DL=\n-AC_CHECK_LIB(dl, dlopen, [AC_DEFINE(HAVE_LIBDL, 1) LIBADD_DL=\"-ldl\"],\n-[AC_CHECK_FUNC(dlopen, [AC_DEFINE(HAVE_LIBDL, 1)])])\n-AC_CHECK_FUNC(shl_load, [AC_DEFINE(HAVE_SHL_LOAD, 1)],\n-[AC_CHECK_LIB(dld, shl_load, [AC_DEFINE(HAVE_SHL_LOAD, 1) LIBADD_DL=\"$LIBADD_DL -ldld\"])])\n-AC_CHECK_LIB(dld, dld_link, [AC_DEFINE(HAVE_DLD, 1)dnl\n-test \"x$ac_cv_lib_dld_shl_load\" = yes || LIBADD_DL=\"$LIBADD_DL -ldld\"])\n-AC_SUBST(LIBADD_DL)\n-\n-if test \"x$ac_cv_func_dlopen\" = xyes || test \"x$ac_cv_lib_dl_dlopen\" = xyes; then\n- LIBS_SAVE=\"$LIBS\"\n- LIBS=\"$LIBS $LIBADD_DL\"\n- AC_CHECK_FUNCS(dlerror)\n- LIBS=\"$LIBS_SAVE\"\n-fi\n-\n-dnl Check for command to grab the raw symbol name followed\n-dnl by C symbol name from nm.\n-AC_REQUIRE([AC_CANONICAL_HOST])dnl\n-AC_REQUIRE([AC_PROG_NM])dnl\n-# Check for command to grab the raw symbol name followed by C symbol from nm.\n-AC_MSG_CHECKING([command to parse $NM output])\n-AC_CACHE_VAL(ac_cv_sys_global_symbol_pipe,\n-[# These are sane defaults that work on at least a few old systems.\n-# {They come from Ultrix.  What could be older than Ultrix?!! ;)}\n-\n-changequote(,)dnl\n-# Character class describing NM global symbol codes.\n-ac_symcode='[BCDEGRST]'\n-\n-# Regexp to match symbols that can be accessed directly from C.\n-ac_sympat='\\([_A-Za-z][_A-Za-z0-9]*\\)'\n-\n-# Transform the above into a raw symbol and a C symbol.\n-ac_symxfrm='\\1 \\2\\3 \\3'\n-\n-# Transform an extracted symbol line into a proper C declaration\n-ac_global_symbol_to_cdecl=\"sed -n -e 's/^. .* \\(.*\\)$/extern char \\1;/p'\"\n-\n-# Define system-specific variables.\n-case \"$host_os\" in\n-aix*)\n-  ac_symcode='[BCDT]'\n-  ;;\n-cygwin* | mingw*)\n-  ac_symcode='[ABCDGISTW]'\n-  ;;\n-hpux*)\n-  ac_global_symbol_to_cdecl=\"sed -n -e 's/^T .* \\(.*\\)$/extern char \\1();/p' -e 's/^. .* \\(.*\\)$/extern char \\1;/p'\"\n-  ;;\n-irix*)\n-  ac_symcode='[BCDEGRST]'\n-  ;;\n-solaris*)\n-  ac_symcode='[BDT]'\n-  ;;\n-esac\n-\n-# If we're using GNU nm, then use its standard symbol codes.\n-if $NM -V 2>&1 | egrep '(GNU|with BFD)' > /dev/null; then\n-  ac_symcode='[ABCDGISTW]'\n-fi\n-changequote([,])dnl\n-\n-# Try without a prefix undercore, then with it.\n-for ac_symprfx in \"\" \"_\"; do\n-\n-  ac_cv_sys_global_symbol_pipe=\"sed -n -e 's/^.*[ \t]\\($ac_symcode\\)[ \t][ \t]*\\($ac_symprfx\\)$ac_sympat$/$ac_symxfrm/p'\"\n-\n-  # Check to see that the pipe works correctly.\n-  ac_pipe_works=no\n-  rm -f conftest.$ac_ext\n-  cat > conftest.$ac_ext <<EOF\n-#ifdef __cplusplus\n-extern \"C\" {\n-#endif\n-char nm_test_var;\n-void nm_test_func(){}\n-#ifdef __cplusplus\n-}\n-#endif\n-int main(){nm_test_var='a';nm_test_func;return 0;}\n-EOF\n-\n-  if AC_TRY_EVAL(ac_compile); then\n-    # Now try to grab the symbols.\n-    ac_nlist=conftest.nm\n-  \n-    if AC_TRY_EVAL(NM conftest.$ac_objext \\| $ac_cv_sys_global_symbol_pipe \\> $ac_nlist) && test -s \"$ac_nlist\"; then\n-\n-      # Try sorting and uniquifying the output.\n-      if sort \"$ac_nlist\" | uniq > \"$ac_nlist\"T; then\n-\tmv -f \"$ac_nlist\"T \"$ac_nlist\"\n-      else\n-\trm -f \"$ac_nlist\"T\n-      fi\n-\n-      # Make sure that we snagged all the symbols we need.\n-      if egrep ' nm_test_var$' \"$ac_nlist\" >/dev/null; then\n-\tif egrep ' nm_test_func$' \"$ac_nlist\" >/dev/null; then\n-\t  cat <<EOF > conftest.c\n-#ifdef __cplusplus\n-extern \"C\" {\n-#endif\n-\n-EOF\n-\t  # Now generate the symbol file.\n-\t  eval \"$ac_global_symbol_to_cdecl\"' < \"$ac_nlist\" >> conftest.c'\n-\n-\t  cat <<EOF >> conftest.c\n-#if defined (__STDC__) && __STDC__\n-# define lt_ptr_t void *\n-#else\n-# define lt_ptr_t char *\n-# define const\n-#endif\n-\n-/* The mapping between symbol names and symbols. */\n-const struct {\n-  const char *name;\n-  lt_ptr_t address;\n-}\n-changequote(,)dnl\n-lt_preloaded_symbols[] =\n-changequote([,])dnl\n-{\n-EOF\n-\tsed 's/^. \\(.*\\) \\(.*\\)$/  {\"\\2\", (lt_ptr_t) \\&\\2},/' < \"$ac_nlist\" >> conftest.c\n-\tcat <<\\EOF >> conftest.c\n-  {0, (lt_ptr_t) 0}\n-};\n-\n-#ifdef __cplusplus\n-}\n-#endif\n-EOF\n-\t  # Now try linking the two files.\n-\t  mv conftest.$ac_objext conftstm.$ac_objext\n-\t  ac_save_LIBS=\"$LIBS\"\n-\t  ac_save_CFLAGS=\"$CFLAGS\"\n-\t  LIBS=\"conftstm.$ac_objext\"\n-\t  CFLAGS=\"$CFLAGS$no_builtin_flag\"\n-\t  if AC_TRY_EVAL(ac_link) && test -s conftest; then\n-\t    ac_pipe_works=yes\n-\t  else\n-\t    echo \"configure: failed program was:\" >&AC_FD_CC\n-\t    cat conftest.c >&AC_FD_CC\n-\t  fi\n-\t  LIBS=\"$ac_save_LIBS\"\n-\t  CFLAGS=\"$ac_save_CFLAGS\"\n-\telse\n-\t  echo \"cannot find nm_test_func in $ac_nlist\" >&AC_FD_CC\n-\tfi\n-      else\n-\techo \"cannot find nm_test_var in $ac_nlist\" >&AC_FD_CC\n-      fi\n-    else\n-      echo \"cannot run $ac_cv_sys_global_symbol_pipe\" >&AC_FD_CC\n-    fi\n-  else\n-    echo \"$progname: failed program was:\" >&AC_FD_CC\n-    cat conftest.c >&AC_FD_CC\n-  fi\n-  rm -rf conftest* conftst*\n-\n-  # Do not use the global_symbol_pipe unless it works.\n-  if test \"$ac_pipe_works\" = yes; then\n-    if test x\"$ac_symprfx\" = x\"_\"; then\n-      ac_cv_sys_symbol_underscore=yes\n-    else\n-      ac_cv_sys_symbol_underscore=no\n-    fi\n-    break\n-  else\n-    ac_cv_sys_global_symbol_pipe=\n-  fi\n-done\n-])\n-\n-ac_result=yes\n-if test -z \"$ac_cv_sys_global_symbol_pipe\"; then\n-   ac_result=no\n-fi\n-AC_MSG_RESULT($ac_result)\n-\n-dnl does the compiler prefix global symbols with an underscore?\n-AC_MSG_CHECKING([for _ prefix in compiled symbols])\n-AC_CACHE_VAL(ac_cv_sys_symbol_underscore,\n-[ac_cv_sys_symbol_underscore=no\n-cat > conftest.$ac_ext <<EOF\n-void nm_test_func(){}\n-int main(){nm_test_func;return 0;}\n-EOF\n-if AC_TRY_EVAL(ac_compile); then\n-  # Now try to grab the symbols.\n-  ac_nlist=conftest.nm\n-  if AC_TRY_EVAL(NM conftest.$ac_objext \\| $ac_cv_sys_global_symbol_pipe \\> $ac_nlist) && test -s \"$ac_nlist\"; then\n-    # See whether the symbols have a leading underscore.\n-    if egrep '^. _nm_test_func' \"$ac_nlist\" >/dev/null; then\n-      ac_cv_sys_symbol_underscore=yes\n-    else\n-      if egrep '^. nm_test_func ' \"$ac_nlist\" >/dev/null; then\n-\t:\n-      else\n-\techo \"configure: cannot find nm_test_func in $ac_nlist\" >&AC_FD_CC\n-      fi\n-    fi\n-  else\n-    echo \"configure: cannot run $ac_cv_sys_global_symbol_pipe\" >&AC_FD_CC\n-  fi\n-else\n-  echo \"configure: failed program was:\" >&AC_FD_CC\n-  cat conftest.c >&AC_FD_CC\n-fi\n-rm -rf conftest*\n-])\n-AC_MSG_RESULT($ac_cv_sys_symbol_underscore)\n-\n-if test x\"$ac_cv_sys_symbol_underscore\" = xyes; then\n-  if test x\"$ac_cv_func_dlopen\" = xyes ||\n-     test x\"$ac_cv_lib_dl_dlopen\" = xyes ; then\n-\tAC_CACHE_CHECK([whether we have to add an underscore for dlsym],\n-\t\tlibltdl_cv_need_uscore, [dnl\n-\t\tAC_TRY_RUN([\n-#if HAVE_DLFCN_H\n-#include <dlfcn.h>\n-#endif\n-\n-#include <stdio.h>\n-\n-#ifdef RTLD_GLOBAL\n-# define LTDL_GLOBAL\tRTLD_GLOBAL\n-#else\n-# ifdef DL_GLOBAL\n-#  define LTDL_GLOBAL\tDL_GLOBAL\n-# else\n-#  define LTDL_GLOBAL\t0\n-# endif\n-#endif\n-\n-/* We may have to define LTDL_LAZY_OR_NOW in the command line if we\n-   find out it does not work in some platform. */\n-#ifndef LTDL_LAZY_OR_NOW\n-# ifdef RTLD_LAZY\n-#  define LTDL_LAZY_OR_NOW\tRTLD_LAZY\n-# else\n-#  ifdef DL_LAZY\n-#   define LTDL_LAZY_OR_NOW\tDL_LAZY\n-#  else\n-#   ifdef RTLD_NOW\n-#    define LTDL_LAZY_OR_NOW\tRTLD_NOW\n-#   else\n-#    ifdef DL_NOW\n-#     define LTDL_LAZY_OR_NOW\tDL_NOW\n-#    else\n-#     define LTDL_LAZY_OR_NOW\t0\n-#    endif\n-#   endif\n-#  endif\n-# endif\n-#endif\n-\n-fnord() { int i=42;}\n-main() { void *self, *ptr1, *ptr2; self=dlopen(0,LTDL_GLOBAL|LTDL_LAZY_OR_NOW);\n-    if(self) { ptr1=dlsym(self,\"fnord\"); ptr2=dlsym(self,\"_fnord\");\n-\t       if(ptr1 && !ptr2) { dlclose(self); exit(0); } } exit(1); } \n-],\tlibltdl_cv_need_uscore=no, libltdl_cv_need_uscore=yes,\n-\tlibltdl_cv_need_uscore=cross\n-)])\n-  fi\n-fi\n-\n-if test x\"$libltdl_cv_need_uscore\" = xyes; then\n-  AC_DEFINE(NEED_USCORE, 1,\n-    [Define if dlsym() requires a leading underscode in symbol names. ])\n-fi\n+AC_LIB_LTDL\n \n dnl Output the makefile\n AC_OUTPUT(Makefile)"}, {"sha": "5ecbee5d2cb14e38a9e2b1581fb75e9bb4bd7dd5", "filename": "libjava/libltdl/ltdl.c", "status": "modified", "additions": 830, "deletions": 471, "changes": 1301, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2Fltdl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/205f5ac60a175bc1739ef4edba1751c50d2aaa89/libjava%2Flibltdl%2Fltdl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Flibltdl%2Fltdl.c?ref=205f5ac60a175bc1739ef4edba1751c50d2aaa89", "patch": "@@ -1,27 +1,28 @@\n /* ltdl.c -- system independent dlopen wrapper\n-   Copyright (C) 1998-1999 Free Software Foundation, Inc.\n+   Copyright (C) 1998, 1999, 2000 Free Software Foundation, Inc.\n    Originally by Thomas Tanner <tanner@ffii.org>\n    This file is part of GNU Libtool.\n \n This library is free software; you can redistribute it and/or\n-modify it under the terms of the GNU Library General Public\n+modify it under the terms of the GNU Lesser General Public\n License as published by the Free Software Foundation; either\n version 2 of the License, or (at your option) any later version.\n \n-As a special exception to the GNU Library General Public License,\n-if you distribute this file as part of a program that uses GNU libtool\n-to create libraries and programs, you may include it under the same\n+As a special exception to the GNU Lesser General Public License,\n+if you distribute this file as part of a program or library that\n+is built using GNU libtool, you may include it under the same\n distribution terms that you use for the rest of that program.\n \n This library is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n-Library General Public License for more details.\n+Lesser General Public License for more details.\n \n-You should have received a copy of the GNU Library General Public\n+You should have received a copy of the GNU Lesser General Public\n License along with this library; if not, write to the Free Software\n Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA\n 02111-1307  USA\n+\n */\n \n #define _LTDL_COMPILE_\n@@ -64,6 +65,12 @@ Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA\n \n #include \"ltdl.h\"\n \n+#ifdef DLL_EXPORT\n+#  define LTDL_GLOBAL_DATA\t__declspec(dllexport)\n+#else\n+#  define LTDL_GLOBAL_DATA\n+#endif\n+\n /* max. filename length */\n #ifndef LTDL_FILENAME_MAX\n #define LTDL_FILENAME_MAX 1024\n@@ -85,56 +92,57 @@ Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA\n /* This accounts for the _LTX_ separator */\n #define LTDL_SYMBOL_OVERHEAD\t5\n \n+/* NOTE: typedefed in ltdl.h\n+   This structure is used for the list of registered loaders. */\n+struct lt_dlloader_t {\n+\tstruct lt_dlloader_t *next;\n+\tconst char *loader_name; /* identifying name for each loader */\n+\tconst char *sym_prefix;\t /* prefix for symbols */\n+\tlt_module_open_t *module_open;\n+\tlt_module_close_t *module_close;\n+\tlt_find_sym_t *find_sym;\n+\tlt_dlloader_exit_t *dlloader_exit;\n+  \tlt_dlloader_data_t dlloader_data;\n+};\n+\n+typedef\tstruct lt_dlhandle_t {\n+\tstruct lt_dlhandle_t *next;\n+\tlt_dlloader_t *loader;\t/* dlopening interface */\n+\tlt_dlinfo info;\n+\tint\tdepcount;\t/* number of dependencies */\n+\tlt_dlhandle *deplibs;\t/* dependencies */\n+\tlt_module_t module;\t/* system module handle */\n+\tlt_ptr_t system;\t/* system specific data */\n+\tlt_ptr_t app_private;\t/* application private data */\n+} lt_dlhandle_t;\n+\n static const char objdir[] = LTDL_OBJDIR;\n #ifdef\tLTDL_SHLIB_EXT\n static const char shlib_ext[] = LTDL_SHLIB_EXT;\n #endif\n+#ifdef\tLTDL_SYSSEARCHPATH\n+static const char sys_search_path[] = LTDL_SYSSEARCHPATH;\n+#endif\n \n-static const char unknown_error[] = \"unknown error\";\n-static const char dlopen_not_supported_error[] = \"dlopen support not available\";\n-static const char file_not_found_error[] = \"file not found\";\n-static const char no_symbols_error[] = \"no symbols defined\";\n-static const char cannot_open_error[] = \"can't open the module\";\n-static const char cannot_close_error[] = \"can't close the module\";\n-static const char symbol_error[] = \"symbol not found\";\n-static const char memory_error[] = \"not enough memory\";\n-static const char invalid_handle_error[] = \"invalid handle\";\n-static const char buffer_overflow_error[] = \"internal buffer overflow\";\n-static const char shutdown_error[] = \"library already shutdown\";\n-\n-#ifndef HAVE_PRELOADED_SYMBOLS\n-/* If libtool won't define it, we'd better do */\n-const lt_dlsymlist lt_preloaded_symbols[1] = { { 0, 0 } };\n+/* Extract the diagnostic strings from the error table macro in the same\n+   order as the enumberated indices in ltdl.h. */\n+#define LTDL_ERROR(name, diagnostic)\t(diagnostic),\n+static const char *ltdl_error_strings[] = {\n+\tltdl_error_table\n+\t0\n+};\n+#undef LTDL_ERROR\n+\n+#ifdef __STDC__\n+#  define LT_DLSTRERROR(name)\tltdl_error_strings[LTDL_ERROR_##name]\n+#else\n+#  define LT_DLSTRERROR(name)\tltdl_error_strings[LTDL_ERROR_/**/name]\n #endif\n \n static const char *last_error = 0;\n \n-lt_ptr_t (*lt_dlmalloc) LTDL_PARAMS((size_t size)) = (lt_ptr_t(*)LTDL_PARAMS((size_t)))malloc;\n-void\t (*lt_dlfree)  LTDL_PARAMS((lt_ptr_t ptr)) = (void(*)LTDL_PARAMS((lt_ptr_t)))free;\n-\n-typedef struct lt_dltype_t {\n-\tstruct lt_dltype_t *next;\n-\tconst char *sym_prefix;\t/* prefix for symbols */\n-\tint (*mod_init) LTDL_PARAMS((void));\n-\tint (*mod_exit) LTDL_PARAMS((void));\n-\tint (*lib_open) LTDL_PARAMS((lt_dlhandle handle, const char *filename));\n-\tint (*lib_close) LTDL_PARAMS((lt_dlhandle handle));\n-\tlt_ptr_t (*find_sym) LTDL_PARAMS((lt_dlhandle handle, const char *symbol));\n-} lt_dltype_t;\n-\n-#define LTDL_TYPE_TOP 0\n-\n-typedef\tstruct lt_dlhandle_t {\n-\tstruct lt_dlhandle_t *next;\n-\tlt_dltype_t *type;\t/* dlopening interface */\n-\tchar\t*filename;\t/* file name */\n-\tchar\t*name;\t\t/* module name */\n-\tint\tusage;\t\t/* usage */\n-\tint\tdepcount;\t/* number of dependencies */\n-\tlt_dlhandle *deplibs;\t/* dependencies */\n-\tlt_ptr_t handle;\t/* system handle */\n-\tlt_ptr_t system;\t/* system specific data */\n-} lt_dlhandle_t;\n+LTDL_GLOBAL_DATA lt_ptr_t (*lt_dlmalloc) LTDL_PARAMS((size_t size)) = (lt_ptr_t(*)LTDL_PARAMS((size_t)))malloc;\n+LTDL_GLOBAL_DATA void\t (*lt_dlfree)  LTDL_PARAMS((lt_ptr_t ptr)) = (void(*)LTDL_PARAMS((lt_ptr_t)))free;\n \n #undef strdup\n #define strdup xstrdup\n@@ -153,6 +161,32 @@ strdup(str)\n \treturn tmp;\n }\n \n+#if ! HAVE_STRCMP\n+\n+#undef strcmp\n+#define strcmp xstrcmp\n+\n+static inline int\n+strcmp (str1, str2)\n+\tconst char *str1;\n+\tconst char *str2;\n+{\n+\tif (str1 == str2)\n+\t\treturn 0;\n+\tif (str1 == 0)\n+\t\treturn -1;\n+\tif (str2 == 0)\n+\t\treturn 1;\n+\t\t\n+\tfor (;*str1 && *str2; str1++, str2++)\n+\t\tif (*str1 != *str2)\n+\t\t\tbreak;\n+\t\n+\treturn (int)(*str1 - *str2);\n+}\n+#endif\n+\t\t\n+\n #if ! HAVE_STRCHR\n \n # if HAVE_INDEX\n@@ -210,7 +244,11 @@ strrchr(str, ch)\n \n #endif\n \n-#if HAVE_LIBDL\n+/* The Cygwin dlopen implementation prints a spurious error message to\n+   stderr if its call to LoadLibrary() fails for any reason.  We can\n+   mitigate this by not using the Cygwin implementation, and falling\n+   back to our own LoadLibrary() wrapper. */\n+#if HAVE_LIBDL && !defined(__CYGWIN__)\n \n /* dynamic linking with dlopen/dlsym */\n \n@@ -250,79 +288,62 @@ strrchr(str, ch)\n # endif\n #endif\n \n-static int\n-sys_dl_init LTDL_PARAMS((void))\n-{\n-\treturn 0;\n-}\n-\n-static int\n-sys_dl_exit LTDL_PARAMS((void))\n-{\n-\treturn 0;\n-}\n-\n-static int\n-sys_dl_open (handle, filename)\n-\tlt_dlhandle handle;\n+static lt_module_t\n+sys_dl_open (loader_data, filename)\n+\tlt_dlloader_data_t loader_data;\n \tconst char *filename;\n {\n-\thandle->handle = dlopen(filename, LTDL_GLOBAL | LTDL_LAZY_OR_NOW);\n-\tif (!handle->handle) {\n+\tlt_module_t module = dlopen(filename, LTDL_GLOBAL | LTDL_LAZY_OR_NOW);\n+\tif (!module) {\n #if HAVE_DLERROR\n \t\tlast_error = dlerror();\n #else\n-\t\tlast_error = cannot_open_error;\n+\t\tlast_error = LT_DLSTRERROR(CANNOT_OPEN);\n #endif\n-\t\treturn 1;\n \t}\n-\treturn 0;\n+\treturn module;\n }\n \n static int\n-sys_dl_close (handle)\n-\tlt_dlhandle handle;\n+sys_dl_close (loader_data, module)\n+\tlt_dlloader_data_t loader_data;\n+\tlt_module_t module;\n {\n-\tif (dlclose(handle->handle) != 0) {\n+\tif (dlclose(module) != 0) {\n #if HAVE_DLERROR\n \t\tlast_error = dlerror();\n #else\n-\t\tlast_error = cannot_close_error;\n+\t\tlast_error = LT_DLSTRERROR(CANNOT_CLOSE);\n #endif\n \t\treturn 1;\n \t}\n \treturn 0;\n }\n \n static lt_ptr_t\n-sys_dl_sym (handle, symbol)\n-\tlt_dlhandle handle;\n+sys_dl_sym (loader_data, module, symbol)\n+\tlt_dlloader_data_t loader_data;\n+\tlt_module_t module;\n \tconst char *symbol;\n {\n-\tlt_ptr_t address = dlsym(handle->handle, symbol);\n+\tlt_ptr_t address = dlsym(module, symbol);\n \t\n \tif (!address)\n #if HAVE_DLERROR\n \t\tlast_error = dlerror();\n #else\n-\t\tlast_error = symbol_error;\n+\t\tlast_error = LT_DLSTRERROR(SYMBOL_NOT_FOUND);\n #endif\n \treturn address;\n }\n \n-static\n-lt_dltype_t\n-#ifdef NEED_USCORE\n-sys_dl = { LTDL_TYPE_TOP, \"_\", sys_dl_init, sys_dl_exit,\n-\tsys_dl_open, sys_dl_close, sys_dl_sym };\n-#else\n-sys_dl = { LTDL_TYPE_TOP, 0, sys_dl_init, sys_dl_exit,\n-\tsys_dl_open, sys_dl_close, sys_dl_sym };\n-#endif\n-\n-#undef LTDL_TYPE_TOP\n-#define LTDL_TYPE_TOP &sys_dl\n-\n+static struct lt_user_dlloader sys_dl = {\n+#  ifdef NEED_USCORE\n+\t   \"_\",\n+#  else\n+\t   0,\n+#  endif\n+\t   sys_dl_open, sys_dl_close, sys_dl_sym, 0, 0 };\n #endif\n \n #if HAVE_SHL_LOAD\n@@ -368,168 +389,81 @@ sys_dl = { LTDL_TYPE_TOP, 0, sys_dl_init, sys_dl_exit,\n \n #define\tLTDL_BIND_FLAGS\t(BIND_IMMEDIATE | BIND_NONFATAL | DYNAMIC_PATH)\n \n-static int\n-sys_shl_init LTDL_PARAMS((void))\n-{\n-\treturn 0;\n-}\n-\n-static int\n-sys_shl_exit LTDL_PARAMS((void))\n-{\n-\treturn 0;\n-}\n-\n-static int\n-sys_shl_open (handle, filename)\n-\tlt_dlhandle handle;\n+static lt_module_t\n+sys_shl_open (loader_data, filename)\n+\tlt_dlloader_data_t loader_data;\n \tconst char *filename;\n {\n-\thandle->handle = shl_load(filename, LTDL_BIND_FLAGS, 0L);\n-\tif (!handle->handle) {\n-\t\tlast_error = cannot_open_error;\n-\t\treturn 1;\n+\tlt_module_t module = shl_load(filename, LTDL_BIND_FLAGS, 0L);\n+\tif (!module) {\n+\t\tlast_error = LT_DLSTRERROR(CANNOT_OPEN);\n \t}\n-\treturn 0;\n+\treturn module;\n }\n \n static int\n-sys_shl_close (handle)\n-\tlt_dlhandle handle;\n+sys_shl_close (loader_data, module)\n+\tlt_dlloader_data_t loader_data;\n+\tlt_module_t module;\n {\n-\tif (shl_unload((shl_t) (handle->handle)) != 0) {\n-\t\tlast_error = cannot_close_error;\n+\tif (shl_unload((shl_t) (module)) != 0) {\n+\t\tlast_error = LT_DLSTRERROR(CANNOT_CLOSE);\n \t\treturn 1;\n \t}\n \treturn 0;\n }\n \n static lt_ptr_t\n-sys_shl_sym (handle, symbol)\n-\tlt_dlhandle handle;\n+sys_shl_sym (loader_data, module, symbol)\n+\tlt_dlloader_data_t loader_data;\n+\tlt_module_t module;\n \tconst char *symbol;\n {\n \tlt_ptr_t address;\n \n-\tif (handle->handle && shl_findsym((shl_t*) &(handle->handle),\n+\tif (module && shl_findsym((shl_t*) &module,\n \t    symbol, TYPE_UNDEFINED, &address) == 0)\n \t\tif (address)\n \t\t\treturn address;\n-\tlast_error = symbol_error;\n+\tlast_error = LT_DLSTRERROR(SYMBOL_NOT_FOUND);\n \treturn 0;\n }\n \n-static\n-lt_dltype_t\n-sys_shl = { LTDL_TYPE_TOP, 0, sys_shl_init, sys_shl_exit,\n-\tsys_shl_open, sys_shl_close, sys_shl_sym };\n+static struct lt_user_dlloader\n+sys_shl = { 0, sys_shl_open, sys_shl_close, sys_shl_sym, 0, 0 };\n \n #undef LTDL_TYPE_TOP\n #define LTDL_TYPE_TOP &sys_shl\n \n #endif\n \n-#if HAVE_DLD\n-\n-/* dynamic linking with dld */\n-\n-#if HAVE_DLD_H\n-#include <dld.h>\n-#endif\n-\n-static int\n-sys_dld_init LTDL_PARAMS((void))\n-{\n-\treturn 0;\n-}\n-\n-static int\n-sys_dld_exit LTDL_PARAMS((void))\n-{\n-\treturn 0;\n-}\n-\n-static int\n-sys_dld_open (handle, filename)\n-\tlt_dlhandle handle;\n-\tconst char *filename;\n-{\n-\thandle->handle = strdup(filename);\n-\tif (!handle->handle) {\n-\t\tlast_error = memory_error;\n-\t\treturn 1;\n-\t}\n-\tif (dld_link(filename) != 0) {\n-\t\tlast_error = cannot_open_error;\n-\t\tlt_dlfree(handle->handle);\n-\t\treturn 1;\n-\t}\n-\treturn 0;\n-}\n-\n-static int\n-sys_dld_close (handle)\n-\tlt_dlhandle handle;\n-{\n-\tif (dld_unlink_by_file((char*)(handle->handle), 1) != 0) {\n-\t\tlast_error = cannot_close_error;\n-\t\treturn 1;\n-\t}\n-\tlt_dlfree(handle->filename);\n-\treturn 0;\n-}\n-\n-static lt_ptr_t\n-sys_dld_sym (handle, symbol)\n-\tlt_dlhandle handle;\n-\tconst char *symbol;\n-{\n-\tlt_ptr_t address = dld_get_func(symbol);\n-\t\n-\tif (!address)\n-\t\tlast_error = symbol_error;\n-\treturn address;\n-}\n-\n-static\n-lt_dltype_t\n-sys_dld = { LTDL_TYPE_TOP, 0, sys_dld_init, sys_dld_exit,\n-\tsys_dld_open, sys_dld_close, sys_dld_sym };\n-\n-#undef LTDL_TYPE_TOP\n-#define LTDL_TYPE_TOP &sys_dld\n-\n-#endif\n-\n #ifdef _WIN32\n \n /* dynamic linking for Win32 */\n \n #include <windows.h>\n \n-static int\n-sys_wll_init LTDL_PARAMS((void))\n-{\n-\treturn 0;\n-}\n-\n-static int\n-sys_wll_exit LTDL_PARAMS((void))\n-{\n-\treturn 0;\n-}\n-\n /* Forward declaration; required to implement handle search below. */\n static lt_dlhandle handles;\n \n-static int\n-sys_wll_open (handle, filename)\n-\tlt_dlhandle handle;\n+static lt_module_t\n+sys_wll_open (loader_data, filename)\n+\tlt_dlloader_data_t loader_data;\n \tconst char *filename;\n {\n \tlt_dlhandle cur;\n-\tchar *searchname = NULL;\n-\tchar *ext = strrchr(filename, '.');\n+\tlt_module_t module;\n+\tchar *searchname = 0;\n+        char *ext;\n+        char self_name_buf[MAX_PATH];\n+\n+\tif (!filename) {\n+\t\t/* Get the name of main module */\n+\t\t*self_name_buf = 0;\n+\t\tGetModuleFileName(NULL, self_name_buf, sizeof(self_name_buf));\n+\t\tfilename = ext = self_name_buf;\n+\t}\n+\telse ext = strrchr(filename, '.');\n \n \tif (ext) {\n \t\t/* FILENAME already has an extension. */\n@@ -538,11 +472,15 @@ sys_wll_open (handle, filename)\n \t\t/* Append a `.' to stop Windows from adding an\n \t\t   implicit `.dll' extension. */\n \t\tsearchname = (char*)lt_dlmalloc(2+ strlen(filename));\n+\t\tif (!searchname) {\n+\t\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n+\t\t\treturn 0;\n+\t\t}\n \t\tstrcpy(searchname, filename);\n \t\tstrcat(searchname, \".\");\n \t}\n-    \n-\thandle->handle = LoadLibrary(searchname);\n+\n+\tmodule = LoadLibrary(searchname);\n \tlt_dlfree(searchname);\n \t\n \t/* libltdl expects this function to fail if it is unable\n@@ -555,53 +493,50 @@ sys_wll_open (handle, filename)\n \t   find one. */\n \tcur = handles;\n \twhile (cur) {\n-\t\tif (!cur->handle) {\n+\t\tif (!cur->module) {\n \t\t\tcur = 0;\n \t\t\tbreak;\n \t\t}\n-\t\tif (cur->handle == handle->handle)\n+\t\tif (cur->module == module)\n \t\t\tbreak;\n \t\tcur = cur->next;\n \t}\n \n-\tif (cur || !handle->handle) {\n-\t\tlast_error = cannot_open_error;\n-\t\treturn 1;\n+\tif (cur || !module) {\n+\t\tlast_error = LT_DLSTRERROR(CANNOT_OPEN);\n+\t\treturn 0;\n \t}\n \n-\treturn 0;\n+\treturn module;\n }\n \n static int\n-sys_wll_close (handle)\n-\tlt_dlhandle handle;\n+sys_wll_close (loader_data, module)\n+\tlt_dlloader_data_t loader_data;\n+\tlt_module_t module;\n {\n-\tif (FreeLibrary(handle->handle) == 0) {\n-\t\tlast_error = cannot_close_error;\n+\tif (FreeLibrary(module) == 0) {\n+\t\tlast_error = LT_DLSTRERROR(CANNOT_CLOSE);\n \t\treturn 1;\n \t}\n \treturn 0;\n }\n \n static lt_ptr_t\n-sys_wll_sym (handle, symbol)\n-\tlt_dlhandle handle;\n+sys_wll_sym (loader_data, module, symbol)\n+\tlt_dlloader_data_t loader_data;\n+\tlt_module_t module;\n \tconst char *symbol;\n {\n-\tlt_ptr_t address = GetProcAddress(handle->handle, symbol);\n+\tlt_ptr_t address = GetProcAddress(module, symbol);\n \t\n \tif (!address)\n-\t\tlast_error = symbol_error;\n+\t\tlast_error = LT_DLSTRERROR(SYMBOL_NOT_FOUND);\n \treturn address;\n }\n \n-static\n-lt_dltype_t\n-sys_wll = { LTDL_TYPE_TOP, 0, sys_wll_init, sys_wll_exit,\n-\tsys_wll_open, sys_wll_close, sys_wll_sym };\n-\n-#undef LTDL_TYPE_TOP\n-#define LTDL_TYPE_TOP &sys_wll\n+static struct lt_user_dlloader\n+sys_wll = { 0, sys_wll_open, sys_wll_close, sys_wll_sym, 0, 0 };\n \n #endif\n \n@@ -611,21 +546,9 @@ sys_wll = { LTDL_TYPE_TOP, 0, sys_wll_init, sys_wll_exit,\n \n #include <kernel/image.h>\n \n-static int\n-sys_bedl_init LTDL_PARAMS((void))\n-{\n-\treturn 0;\n-}\n-\n-static int\n-sys_bedl_exit LTDL_PARAMS((void))\n-{\n-\treturn 0;\n-}\n-\n-static int\n-sys_bedl_open (handle, filename)\n-\tlt_dlhandle handle;\n+static lt_module_t\n+sys_bedl_open (loader_data, filename)\n+\tlt_dlloader_data_t loader_data;\n \tconst char *filename;\n {\n \timage_id image = 0;\n@@ -639,47 +562,101 @@ sys_bedl_open (handle, filename)\n \t\t\timage = load_add_on(info.name);\n \t}\n \tif (image <= 0) {\n-\t\tlast_error = cannot_open_error;\n-\t\treturn 1;\n+\t\tlast_error = LT_DLSTRERROR(CANNOT_OPEN);\n+\t\treturn 0;\n \t}\n-\thandle->handle = (void*) image;\n-\treturn 0;\n+\n+\treturn (lt_module_t) image;\n }\n \n static int\n-sys_bedl_close (handle)\n-\tlt_dlhandle handle;\n+sys_bedl_close (loader_data, module)\n+\tlt_dlloader_data_t loader_data;\n+\tlt_module_t module;\n {\n-\tif (unload_add_on((image_id)handle->handle) != B_OK) {\n-\t\tlast_error = cannot_close_error;\n+\tif (unload_add_on((image_id)module) != B_OK) {\n+\t\tlast_error = LT_DLSTRERROR(CANNOT_CLOSE);\n \t\treturn 1;\n \t}\n \treturn 0;\n }\n \n static lt_ptr_t\n-sys_bedl_sym (handle, symbol)\n-\tlt_dlhandle handle;\n+sys_bedl_sym (loader_data, module, symbol)\n+\tlt_dlloader_data_t loader_data;\n+\tlt_module_t module;\n \tconst char *symbol;\n {\n \tlt_ptr_t address = 0;\n-\timage_id image = (image_id)handle->handle;\n+\timage_id image = (image_id)module;\n    \n \tif (get_image_symbol(image, symbol, B_SYMBOL_TYPE_ANY,\n \t\t&address) != B_OK) {\n-\t\tlast_error = symbol_error;\n+\t\tlast_error = LT_DLSTRERROR(SYMBOL_NOT_FOUND);\n \t\treturn 0;\n \t}\n \treturn address;\n }\n \n-static\n-lt_dltype_t\n-sys_bedl = { LTDL_TYPE_TOP, 0, sys_bedl_init, sys_bedl_exit,\n-\tsys_bedl_open, sys_bedl_close, sys_bedl_sym };\n+static struct lt_user_dlloader\n+sys_bedl = { 0, sys_bedl_open, sys_bedl_close, sys_bedl_sym, 0, 0 };\n \n-#undef LTDL_TYPE_TOP\n-#define LTDL_TYPE_TOP &sys_bedl\n+#endif\n+\n+#if HAVE_DLD\n+\n+/* dynamic linking with dld */\n+\n+#if HAVE_DLD_H\n+#include <dld.h>\n+#endif\n+\n+static lt_module_t\n+sys_dld_open (loader_data, filename)\n+\tlt_dlloader_data_t loader_data;\n+\tconst char *filename;\n+{\n+\tlt_module_t module = strdup(filename);\n+\tif (!module) {\n+\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n+\t\treturn 0;\n+\t}\n+\tif (dld_link(filename) != 0) {\n+\t\tlast_error = LT_DLSTRERROR(CANNOT_OPEN);\n+\t\tlt_dlfree(module);\n+\t\treturn 0;\n+\t}\n+\treturn module;\n+}\n+\n+static int\n+sys_dld_close (loader_data, module)\n+\tlt_dlloader_data_t loader_data;\n+\tlt_module_t module;\n+{\n+\tif (dld_unlink_by_file((char*)(module), 1) != 0) {\n+\t\tlast_error = LT_DLSTRERROR(CANNOT_CLOSE);\n+\t\treturn 1;\n+\t}\n+\tlt_dlfree(module);\n+\treturn 0;\n+}\n+\n+static lt_ptr_t\n+sys_dld_sym (loader_data, module, symbol)\n+\tlt_dlloader_data_t loader_data;\n+\tlt_module_t module;\n+\tconst char *symbol;\n+{\n+\tlt_ptr_t address = dld_get_func(symbol);\n+\n+\tif (!address)\n+\t\tlast_error = LT_DLSTRERROR(SYMBOL_NOT_FOUND);\n+\treturn address;\n+}\n+\n+static struct lt_user_dlloader\n+sys_dld = { 0, sys_dld_open, sys_dld_close, sys_dld_sym, 0, 0 };\n \n #endif\n \n@@ -694,7 +671,8 @@ static const lt_dlsymlist *default_preloaded_symbols = 0;\n static lt_dlsymlists_t *preloaded_symbols = 0;\n \n static int\n-presym_init LTDL_PARAMS((void))\n+presym_init (loader_data)\n+\tlt_dlloader_data_t loader_data;\n {\n \tpreloaded_symbols = 0;\n \tif (default_preloaded_symbols)\n@@ -718,7 +696,8 @@ presym_free_symlists LTDL_PARAMS((void))\n }\n \n static int\n-presym_exit LTDL_PARAMS((void))\n+presym_exit (loader_data)\n+\tlt_dlloader_data_t loader_data;\n {\n \tpresym_free_symlists();\n \treturn 0;\n@@ -739,33 +718,25 @@ presym_add_symlist (preloaded)\n \n \ttmp = (lt_dlsymlists_t*) lt_dlmalloc(sizeof(lt_dlsymlists_t));\n \tif (!tmp) {\n-\t\tlast_error = memory_error;\n+\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n \t\treturn 1;\n \t}\n \ttmp->syms = preloaded;\n-\ttmp->next = 0;\n-\tif (!preloaded_symbols)\n-\t\tpreloaded_symbols = tmp;\n-\telse {\n-\t\t/* append to the end */\n-\t\tlists = preloaded_symbols;\n-\t\twhile (lists->next)\n-\t\t\tlists = lists->next;\n-\t\tlists->next = tmp;\n-\t}\n+\ttmp->next = preloaded_symbols;\n+\tpreloaded_symbols = tmp;\n \treturn 0;\n }\n \n-static int\n-presym_open (handle, filename)\n-\tlt_dlhandle handle;\n+static lt_module_t\n+presym_open (loader_data, filename)\n+\tlt_dlloader_data_t loader_data;\n \tconst char *filename;\n {\n \tlt_dlsymlists_t *lists = preloaded_symbols;\n \n \tif (!lists) {\n-\t\tlast_error = no_symbols_error;\n-\t\treturn 1;\n+\t\tlast_error = LT_DLSTRERROR(NO_SYMBOLS);\n+\t\treturn 0;\n \t}\n \tif (!filename)\n \t\tfilename = \"@PROGRAM@\";\n@@ -775,82 +746,89 @@ presym_open (handle, filename)\n \t\twhile (syms->name) {\n \t\t\tif (!syms->address &&\n \t\t\t    strcmp(syms->name, filename) == 0) {\n-\t\t\t\thandle->handle = (lt_ptr_t) syms;\n-\t\t\t\treturn 0;\n+\t\t\t\treturn (lt_module_t) syms;\n \t\t\t}\n \t\t\tsyms++;\n \t\t}\n \t\tlists = lists->next;\n \t}\n-\tlast_error = file_not_found_error;\n-\treturn 1;\n+\tlast_error = LT_DLSTRERROR(FILE_NOT_FOUND);\n+\treturn 0;\n }\n \n static int\n-presym_close (handle)\n-\tlt_dlhandle handle;\n+presym_close (loader_data, module)\n+\tlt_dlloader_data_t loader_data;\n+\tlt_module_t module;\n {\n \t/* Just to silence gcc -Wall */\n-\thandle = 0;\n+\tmodule = 0;\n \treturn 0;\n }\n \n static lt_ptr_t\n-presym_sym (handle, symbol)\n-\tlt_dlhandle handle;\n+presym_sym (loader_data, module, symbol)\n+\tlt_dlloader_data_t loader_data;\n+\tlt_module_t module;\n \tconst char *symbol;\n {\n-\tlt_dlsymlist *syms = (lt_dlsymlist*)(handle->handle);\n+\tlt_dlsymlist *syms = (lt_dlsymlist*)(module);\n \n \tsyms++;\n \twhile (syms->address) {\n \t\tif (strcmp(syms->name, symbol) == 0)\n \t\t\treturn syms->address;\n \t\tsyms++;\n \t}\n-\tlast_error = symbol_error;\n+\tlast_error = LT_DLSTRERROR(SYMBOL_NOT_FOUND);\n \treturn 0;\n }\n \n-static\n-lt_dltype_t\n-presym = { LTDL_TYPE_TOP, 0, presym_init, presym_exit,\n-\t   presym_open, presym_close, presym_sym };\n+static struct lt_user_dlloader\n+presym = { 0, presym_open, presym_close, presym_sym, presym_exit, 0 };\n \n-#undef LTDL_TYPE_TOP\n-#define LTDL_TYPE_TOP &presym\n \n static char *user_search_path = 0;\n+static lt_dlloader_t *loaders = 0;\n static lt_dlhandle handles = 0;\n static int initialized = 0;\n \n-static lt_dltype_t *types = LTDL_TYPE_TOP;\n-#undef LTDL_TYPE_TOP\n-\n int\n lt_dlinit LTDL_PARAMS((void))\n {\n \t/* initialize libltdl */\n-\tlt_dltype_t **type = &types;\n-\tint typecount = 0;\n+\tint errors = 0;\n \n \tif (initialized) {\t/* Initialize only at first call. */\n \t\tinitialized++;\n \t\treturn 0;\n \t}\n \thandles = 0;\n \tuser_search_path = 0; /* empty search path */\n-\n-\twhile (*type) {\n-\t\tif ((*type)->mod_init())\n-\t\t\t*type = (*type)->next; /* Remove it from the list */\n-\t\telse {\n-\t\t\ttype = &(*type)->next; /* Keep it */\n-\t\t\ttypecount++;\n-\t\t}\n+\t\n+#if HAVE_LIBDL && !defined(__CYGWIN__)\n+\terrors += lt_dlloader_add (lt_dlloader_next(0), &sys_dl, \"dlopen\");\n+#endif\t\n+#if HAVE_SHL_LOAD\n+\terrors += lt_dlloader_add (lt_dlloader_next(0), &sys_shl, \"dlopen\");\n+#endif\n+#ifdef _WIN32\n+\terrors += lt_dlloader_add (lt_dlloader_next(0), &sys_wll, \"dlopen\");\n+#endif\n+#ifdef __BEOS__\n+\terrors += lt_dlloader_add (lt_dlloader_next(0), &sys_bedl, \"dlopen\");\n+#endif\n+#if HAVE_DLD\n+\terrors += lt_dlloader_add (lt_dlloader_next(0), &sys_dld, \"dld\");\n+#endif\n+\terrors += lt_dlloader_add (lt_dlloader_next(0), &presym, \"dlpreload\");\n+\tif (presym_init(presym.dlloader_data)) {\n+\t\tlast_error = LT_DLSTRERROR(INIT_LOADER);\n+\t\t\treturn 1;\n \t}\n-\tif (typecount == 0) {\n-\t\tlast_error = dlopen_not_supported_error;\n+\n+\tif (errors != 0) {\n+\t\tlast_error = LT_DLSTRERROR(DLOPEN_NOT_SUPPORTED);\n \t\treturn 1;\n \t}\n \tlast_error = 0;\n@@ -882,11 +860,11 @@ int\n lt_dlexit LTDL_PARAMS((void))\n {\n \t/* shut down libltdl */\n-\tlt_dltype_t *type = types;\n-\tint\terrors;\n+\tlt_dlloader_t *loader = loaders;\n+\tint\terrors, level;\n \t\n \tif (!initialized) {\n-\t\tlast_error = shutdown_error;\n+\t\tlast_error = LT_DLSTRERROR(SHUTDOWN);\n \t\treturn 1;\n \t}\n \tif (initialized != 1) { /* shut down only at last call. */\n@@ -895,17 +873,27 @@ lt_dlexit LTDL_PARAMS((void))\n \t}\n \t/* close all modules */\n \terrors = 0;\n-\twhile (handles) {\n-\t\t/* FIXME: what if a module depends on another one? */\n-\t\tif (lt_dlclose(handles))\n-\t\t\terrors++;\n+\tfor (level = 1; handles; level++) {\n+\t\tlt_dlhandle cur = handles;\n+\t\twhile (cur) {\n+\t\t\tlt_dlhandle tmp = cur;\n+\t\t\tcur = cur->next;\n+\t\t\tif (tmp->info.ref_count <= level)\n+\t\t\t\tif (lt_dlclose(tmp))\n+\t\t\t\t\terrors++;\n+\t\t}\n \t}\n-\tinitialized = 0;\n-\twhile (type) {\n-\t\tif (type->mod_exit())\n+\t/* close all loaders */\n+\twhile (loader) {\n+\t  \tlt_dlloader_t *next = loader->next;\n+\t\tlt_dlloader_data_t data = loader->dlloader_data;\n+\t\tif (loader->dlloader_exit && loader->dlloader_exit(data))\n \t\t\terrors++;\n-\t\ttype = type->next;\n+\t\tlt_dlfree (loader);\n+\t\tloader = next;\n \t}\n+\n+\tinitialized = 0;\n \treturn errors;\n }\n \n@@ -914,46 +902,49 @@ tryall_dlopen (handle, filename)\n \tlt_dlhandle *handle;\n \tconst char *filename;\n {\n-\tlt_dlhandle cur;\n-\tlt_dltype_t *type = types;\n+\tlt_dlhandle cur = handles;\n+\tlt_dlloader_t *loader = loaders;\n \tconst char *saved_error = last_error;\n \t\n \t/* check whether the module was already opened */\n-\tcur = handles;\n \twhile (cur) {\n-\t\tif (!cur->filename && !filename)\n+\t\t/* try to dlopen the program itself? */\n+\t\tif (!cur->info.filename && !filename)\n \t\t\tbreak;\n-\t\tif (cur->filename && filename && \n-\t\t    strcmp(cur->filename, filename) == 0)\n+\t\tif (cur->info.filename && filename && \n+\t\t    strcmp(cur->info.filename, filename) == 0)\n \t\t\tbreak;\n \t\tcur = cur->next;\n \t}\n+\n \tif (cur) {\n-\t\tcur->usage++;\n+\t\tcur->info.ref_count++;\n \t\t*handle = cur;\n \t\treturn 0;\n \t}\n \t\n \tcur = *handle;\n \tif (filename) {\n-\t\tcur->filename = strdup(filename);\n-\t\tif (!cur->filename) {\n-\t\t\tlast_error = memory_error;\n+\t\tcur->info.filename = strdup(filename);\n+\t\tif (!cur->info.filename) {\n+\t\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n \t\t\treturn 1;\n \t\t}\n \t} else\n-\t\tcur->filename = 0;\n-\twhile (type) {\n-\t\tif (type->lib_open(cur, filename) == 0)\n+\t\tcur->info.filename = 0;\n+\twhile (loader) {\n+\t\tlt_dlloader_data_t data = loader->dlloader_data;\n+\t\tcur->module = loader->module_open(data, filename);\n+\t\tif (cur->module != 0)\n \t\t\tbreak;\n-\t\ttype = type->next;\n+\t\tloader = loader->next;\n \t}\n-\tif (!type) {\n-\t\tif (cur->filename)\n-\t\t\tlt_dlfree(cur->filename);\n+\tif (!loader) {\n+\t\tif (cur->info.filename)\n+\t\t\tlt_dlfree(cur->info.filename);\n \t\treturn 1;\n \t}\n-\tcur->type = type;\n+\tcur->loader = loader;\n \tlast_error = saved_error;\n \treturn 0;\n }\n@@ -981,15 +972,13 @@ find_module (handle, dir, libdir, dlname, old_name, installed)\n \t\t\tfilename = (char*)\n \t\t\t\tlt_dlmalloc(strlen(libdir)+1+strlen(dlname)+1);\n \t\t\tif (!filename) {\n-\t\t\t\tlast_error = memory_error;\n+\t\t\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n \t\t\t\treturn 1;\n \t\t\t}\n-\t\t\tstrcpy(filename, libdir);\n-\t\t\tstrcat(filename, \"/\");\n-\t\t\tstrcat(filename, dlname);\n-\t\t\terror = tryall_dlopen(handle, filename) == 0;\n+\t\t\tsprintf (filename, \"%s/%s\", libdir, dlname);\n+\t\t\terror = tryall_dlopen(handle, filename) != 0;\n \t\t\tlt_dlfree(filename);\n-\t\t\tif (error)\n+\t\t\tif (!error)\n \t\t\t\treturn 0;\n \t\t}\n \t\t/* try to open the not-installed module */\n@@ -998,7 +987,7 @@ find_module (handle, dir, libdir, dlname, old_name, installed)\n \t\t\t\tlt_dlmalloc((dir ? strlen(dir) : 0)\n \t\t\t\t       + strlen(objdir)\t+ strlen(dlname) + 1);\n \t\t\tif (!filename) {\n-\t\t\t\tlast_error = memory_error;\n+\t\t\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n \t\t\t\treturn 1;\n \t\t\t}\n \t\t\tif (dir)\n@@ -1008,12 +997,12 @@ find_module (handle, dir, libdir, dlname, old_name, installed)\n \t\t\tstrcat(filename, objdir);\n \t\t\tstrcat(filename, dlname);\n \n-\t\t\terror = tryall_dlopen(handle, filename) == 0;\n+\t\t\terror = tryall_dlopen(handle, filename) != 0;\n \t\t\tlt_dlfree(filename);\n-\t\t\tif (error)\n+\t\t\tif (!error)\n \t\t\t\treturn 0;\n \t\t}\n-\t\t/* hmm, maybe it was moved to another directory */\n+\t\t/* maybe it was moved to another directory */\n \t\t{\n \t\t\tfilename = (char*)\n \t\t\t\tlt_dlmalloc((dir ? strlen(dir) : 0)\n@@ -1023,16 +1012,34 @@ find_module (handle, dir, libdir, dlname, old_name, installed)\n \t\t\telse\n \t\t\t\t*filename = 0;\n \t\t\tstrcat(filename, dlname);\n-\t\t\terror = tryall_dlopen(handle, filename) == 0;\n+\t\t\terror = tryall_dlopen(handle, filename) != 0;\n \t\t\tlt_dlfree(filename);\n-\t\t\tif (error)\n+\t\t\tif (!error)\n \t\t\t\treturn 0;\n \t\t}\n \t}\n-\tlast_error = file_not_found_error;\n \treturn 1;\n }\n \n+static char*\n+canonicalize_path (path)\n+\tconst char *path;\n+{\n+\tchar *canonical = 0;\n+\t\n+\tif (path && *path) {\n+\t\tchar *ptr = strdup (path);\n+\t\tcanonical = ptr;\n+#ifdef LTDL_DIRSEP_CHAR\n+\t\t/* Avoid this overhead where '/' is the only separator. */\n+\t\twhile (ptr = strchr (ptr, LTDL_DIRSEP_CHAR))\n+\t\t\t*ptr++ = '/';\n+#endif\n+\t}\n+\n+\treturn canonical;\n+}\n+\n static lt_ptr_t\n find_file (basename, search_path, pdir, handle)\n \tconst char *basename;\n@@ -1043,24 +1050,31 @@ find_file (basename, search_path, pdir, handle)\n \t/* when handle != NULL search a library, otherwise a file */\n \t/* return NULL on failure, otherwise the file/handle */\n \n+\tlt_ptr_t result = 0;\n \tchar\t*filename = 0;\n \tint     filenamesize = 0;\n-\tconst char *next = search_path;\n \tint\tlenbase = strlen(basename);\n+\tchar\t*canonical = 0, *next = 0;\n \t\n-\tif (!next || !*next) {\n-\t\tlast_error = file_not_found_error;\n+\tif (!search_path || !*search_path) {\n+\t\tlast_error = LT_DLSTRERROR(FILE_NOT_FOUND);\n \t\treturn 0;\n \t}\n+\tcanonical = canonicalize_path (search_path);\n+\tif (!canonical) {\n+\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n+\t\tgoto cleanup;\n+\t}\n+\tnext = canonical;\n \twhile (next) {\n \t\tint lendir;\n-\t\tconst char *cur = next;\n+\t\tchar *cur = next;\n \n-\t\tnext = strchr(cur, ':');\n+\t\tnext = strchr(cur, LTDL_PATHSEP_CHAR);\n \t\tif (!next)\n \t\t\tnext = cur + strlen(cur);\n \t\tlendir = next - cur;\n-\t\tif (*next == ':')\n+\t\tif (*next == LTDL_PATHSEP_CHAR)\n \t\t\t++next;\n \t\telse\n \t\t\tnext = 0;\n@@ -1072,8 +1086,8 @@ find_file (basename, search_path, pdir, handle)\n \t\t\tfilenamesize = lendir + 1 + lenbase + 1;\n \t\t\tfilename = (char*) lt_dlmalloc(filenamesize);\n \t\t\tif (!filename) {\n-\t\t\t\tlast_error = memory_error;\n-\t\t\t\treturn 0;\n+\t\t\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n+\t\t\t\tgoto cleanup;\n \t\t\t}\n \t\t}\n \t\tstrncpy(filename, cur, lendir);\n@@ -1082,8 +1096,8 @@ find_file (basename, search_path, pdir, handle)\n \t\tstrcpy(filename+lendir, basename);\n \t\tif (handle) {\n \t\t\tif (tryall_dlopen(handle, filename) == 0) {\n-\t\t\t\tlt_dlfree(filename);\n-\t\t\t\treturn (lt_ptr_t) handle;\n+\t\t\t\tresult = (lt_ptr_t) handle;\n+\t\t\t\tgoto cleanup;\n \t\t\t}\n \t\t} else {\n \t\t\tFILE *file = fopen(filename, LTDL_READTEXT_MODE);\n@@ -1097,39 +1111,142 @@ find_file (basename, search_path, pdir, handle)\n \t\t\t\t\t   strdup, but there would be some\n \t\t\t\t\t   memory overhead. */\n \t\t\t\t\t*pdir = filename;\n-\t\t\t\t} else\n-\t\t\t\t\tlt_dlfree(filename);\n-\t\t\t\treturn (lt_ptr_t) file;\n+\t\t\t\t\tfilename = 0;\n+\t\t\t\t}\n+\t\t\t\tresult = (lt_ptr_t) file;\n+\t\t\t\tgoto cleanup;\n \t\t\t}\n \t\t}\n \t}\n+\tlast_error = LT_DLSTRERROR(FILE_NOT_FOUND);\n+cleanup:\n \tif (filename)\n \t\tlt_dlfree(filename);\n-\tlast_error = file_not_found_error;\n-\treturn 0;\n+\tif (canonical)\n+\t\tlt_dlfree(canonical);\n+\treturn result;\n }\n \n static int\n load_deplibs(handle, deplibs)\n \tlt_dlhandle handle;\n-\tconst char *deplibs;\n+\tchar *deplibs;\n {\n-\t/* FIXME: load deplibs */\n+\tchar\t*p, *save_search_path;\n+\tint\ti;\n+\tint\tret = 1, depcount = 0;\n+\tchar\t**names = 0;\n+\tlt_dlhandle *handles = 0;\n+\n \thandle->depcount = 0;\n-\thandle->deplibs = 0;\n-\t/* Just to silence gcc -Wall */\n-\tdeplibs = 0;\n-\treturn 0;\n+\tif (!deplibs)\n+\t\treturn 0;\n+\tsave_search_path = strdup(user_search_path);\n+\tif (user_search_path && !save_search_path) {\n+\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n+\t\treturn 1;\n+\t}\n+\tp = deplibs;\n+\t/* extract search paths and count deplibs */\n+\twhile (*p) {\n+\t\tif (!isspace(*p)) {\n+\t\t\tchar *end = p+1;\n+\t\t\twhile (*end && !isspace(*end)) end++;\n+\t\t\tif (strncmp(p, \"-L\", 2) == 0 ||\n+\t\t\t    strncmp(p, \"-R\", 2) == 0) {\n+\t\t\t\tchar save = *end;\n+\t\t\t\t*end = 0; /* set a temporary string terminator */\n+\t\t\t\tif (lt_dladdsearchdir(p+2))\n+\t\t\t\t\tgoto cleanup;\n+\t\t\t\t*end = save;\n+\t\t\t} else\n+\t\t\t\tdepcount++;\n+\t\t\tp = end;\n+\t\t} else\n+\t\t\tp++;\n+\t}\n+\tif (!depcount) {\n+\t\tret = 0;\n+\t\tgoto cleanup;\n+\t}\n+\tnames = (char**)lt_dlmalloc(depcount * sizeof(char*));\n+\tif (!names)\n+\t\tgoto cleanup;\n+\thandles = (lt_dlhandle*)lt_dlmalloc(depcount * sizeof(lt_dlhandle*));\n+\tif (!handles)\n+\t\tgoto cleanup;\n+\tdepcount = 0;\n+\t/* now only extract the actual deplibs */\n+\tp = deplibs;\n+\twhile (*p) {\n+\t\tif (!isspace(*p)) {\n+\t\t\tchar *end = p+1;\n+\t\t\twhile (*end && !isspace(*end)) end++;\n+\t\t\tif (strncmp(p, \"-L\", 2) != 0 &&\n+\t\t\t    strncmp(p, \"-R\", 2) != 0) {\n+\t\t\t\tchar *name;\n+\t\t\t\tchar save = *end;\n+\t\t\t\t*end = 0; /* set a temporary string terminator */\n+\t\t\t\tif (strncmp(p, \"-l\", 2) == 0) {\n+\t\t\t\t\tname = lt_dlmalloc(3+ /* \"lib\" */\n+\t\t\t\t\t\t\t   strlen(p+2)+1);\n+\t\t\t\t\tif (name)\n+\t\t\t\t\t\tsprintf (name, \"lib%s\", p+2);\n+\t\t\t\t} else\n+\t\t\t\t\tname = strdup(p);\n+\t\t\t\tif (name)\n+\t\t\t\t\tnames[depcount++] = name;\n+\t\t\t\telse\n+\t\t\t\t\tgoto cleanup_names;\n+\t\t\t\t*end = save;\n+\t\t\t}\n+\t\t\tp = end;\n+\t\t} else\n+\t\t\tp++;\n+\t}\n+\t/* load the deplibs (in reverse order) */\n+\tfor (i = 0; i < depcount; i++) {\n+\t\tlt_dlhandle handle = lt_dlopenext(names[depcount-1-i]);\n+\t\tif (!handle) {\n+\t\t\tint j;\n+\t\t\tfor (j = 0; j < i; j++)\n+\t\t\t\tlt_dlclose(handles[j]);\n+\t\t\tlast_error = LT_DLSTRERROR(DEPLIB_NOT_FOUND);\n+\t\t\tgoto cleanup_names;\n+\t\t}\n+\t\thandles[i] = handle;\t\n+\t}\n+\thandle->depcount = depcount;\n+\thandle->deplibs = handles;\n+\thandles = 0;\n+\tret = 0;\n+cleanup_names:\n+\tfor (i = 0; i < depcount; i++)\n+\t\tlt_dlfree(names[i]);\n+cleanup:\n+\tif (names)\n+\t\tlt_dlfree(names);\n+\tif (handles)\n+\t\tlt_dlfree(handles);\n+\t/* restore the old search path */\n+\tif (user_search_path)\n+\t\tlt_dlfree(user_search_path);\n+\tuser_search_path = save_search_path;\n+\treturn ret;\n }\n \n static int\n unload_deplibs(handle)\n \tlt_dlhandle handle;\n {\n-\t/* FIXME: unload deplibs */\n-\t/* Just to silence gcc -Wall */\n-\thandle = 0;\n-\treturn 0;\n+\tint i;\n+\tint errors = 0;\n+\t\n+\tif (!handle->depcount)\n+\t\treturn 0;\n+\tfor (i = 0; i < handle->depcount; i++)\n+\t\terrors += lt_dlclose(handle->deplibs[i]);\t\t\n+\treturn errors;\n }\n \n static inline int\n@@ -1148,7 +1265,7 @@ trim (dest, str)\n \tif (len > 3 && str[0] == '\\'') {\n \t\ttmp = (char*) lt_dlmalloc(end - str);\n \t\tif (!tmp) {\n-\t\t\tlast_error = memory_error;\n+\t\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n \t\t\treturn 1;\n \t\t}\n \t\tstrncpy(tmp, &str[1], (end - str) - 1);\n@@ -1160,18 +1277,12 @@ trim (dest, str)\n }\n \n static inline int\n-free_vars(dir, name, dlname, oldname, libdir, deplibs)\n-\tchar *dir;\n-\tchar *name;\n+free_vars( dlname, oldname, libdir, deplibs)\n \tchar *dlname;\n \tchar *oldname;\n \tchar *libdir;\n \tchar *deplibs;\n {\n-\tif (dir)\n-\t\tlt_dlfree(dir);\n-\tif (name)\n-\t\tlt_dlfree(name);\n \tif (dlname)\n \t\tlt_dlfree(dlname);\n \tif (oldname)\n@@ -1187,18 +1298,18 @@ lt_dlhandle\n lt_dlopen (filename)\n \tconst char *filename;\n {\n-\tlt_dlhandle handle, newhandle;\n-\tconst char *basename, *ext;\n+\tlt_dlhandle handle = 0, newhandle;\n+\tconst char *ext;\n \tconst char *saved_error = last_error;\n-\tchar\t*dir = 0, *name = 0;\n+\tchar\t*canonical = 0, *basename = 0, *dir = 0, *name = 0;\n \t\n \tif (!filename) {\n \t\thandle = (lt_dlhandle) lt_dlmalloc(sizeof(lt_dlhandle_t));\n \t\tif (!handle) {\n-\t\t\tlast_error = memory_error;\n+\t\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n \t\t\treturn 0;\n \t\t}\n-\t\thandle->usage = 0;\n+\t\thandle->info.ref_count = 0;\n \t\thandle->depcount = 0;\n \t\thandle->deplibs = 0;\n \t\tnewhandle = handle;\n@@ -1208,18 +1319,26 @@ lt_dlopen (filename)\n \t\t}\n \t\tgoto register_handle;\n \t}\n-\tbasename = strrchr(filename, '/');\n+\tcanonical = canonicalize_path (filename);\n+\tif (!canonical) {\n+\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n+\t\tif (handle)\n+\t\t\tlt_dlfree(handle);\n+\t\treturn 0;\n+\t}\n+\tbasename = strrchr(canonical, '/');\n \tif (basename) {\n \t\tbasename++;\n-\t\tdir = (char*) lt_dlmalloc(basename - filename + 1);\n+\t\tdir = (char*) lt_dlmalloc(basename - canonical + 1);\n \t\tif (!dir) {\n-\t\t\tlast_error = memory_error;\n-\t\t\treturn 0;\n+\t\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n+\t\t\thandle = 0;\n+\t\t\tgoto cleanup;\n \t\t}\n-\t\tstrncpy(dir, filename, basename - filename);\n-\t\tdir[basename - filename] = '\\0';\n+\t\tstrncpy(dir, canonical, basename - canonical);\n+\t\tdir[basename - canonical] = '\\0';\n \t} else\n-\t\tbasename = filename;\n+\t\tbasename = canonical;\n \t/* check whether we open a libtool module (.la extension) */\n \text = strrchr(basename, '.');\n \tif (ext && strcmp(ext, \".la\") == 0) {\n@@ -1238,10 +1357,9 @@ lt_dlopen (filename)\n \t\t/* extract the module name from the file name */\n \t\tname = (char*) lt_dlmalloc(ext - basename + 1);\n \t\tif (!name) {\n-\t\t\tlast_error = memory_error;\n-\t\t\tif (dir)\n-\t\t\t\tlt_dlfree(dir);\n-\t\t\treturn 0;\n+\t\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n+\t\t\thandle = 0;\n+\t\t\tgoto cleanup;\n \t\t}\n \t\t/* canonicalize the module name */\n \t\tfor (i = 0; i < ext - basename; i++)\n@@ -1253,7 +1371,7 @@ lt_dlopen (filename)\n \t\t/* now try to open the .la file */\n \t\tfile = fopen(filename, LTDL_READTEXT_MODE);\n \t\tif (!file)\n-\t\t\tlast_error = file_not_found_error;\n+\t\t\tlast_error = LT_DLSTRERROR(FILE_NOT_FOUND);\n \t\tif (!file && !dir) {\n \t\t\t/* try other directories */\n \t\t\tfile = (FILE*) find_file(basename, \n@@ -1268,20 +1386,24 @@ lt_dlopen (filename)\n \t\t\t\tfile = (FILE*) find_file(basename,\n \t\t\t\t\t\t getenv(LTDL_SHLIBPATH_VAR),\n \t\t\t\t\t\t &dir, 0);\n+#endif\n+#ifdef LTDL_SYSSEARCHPATH\n+\t\t\tif (!file)\n+\t\t\t\tfile = (FILE*) find_file(basename,\n+\t\t\t\t\t\t sys_search_path,\n+\t\t\t\t\t\t &dir, 0);\n #endif\n \t\t}\n \t\tif (!file) {\n-\t\t\tif (name)\n-\t\t\t\tlt_dlfree(name);\n-\t\t\tif (dir)\n-\t\t\t\tlt_dlfree(dir);\n-\t\t\treturn 0;\n+\t\t\thandle = 0;\n+\t\t\tgoto cleanup;\n \t\t}\n \t\tline = (char*) lt_dlmalloc(LTDL_FILENAME_MAX);\n \t\tif (!line) {\n \t\t\tfclose(file);\n-\t\t\tlast_error = memory_error;\n-\t\t\treturn 0;\n+\t\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n+\t\t\thandle = 0;\n+\t\t\tgoto cleanup;\n \t\t}\n \t\t/* read the .la file */\n \t\twhile (!feof(file)) {\n@@ -1322,6 +1444,22 @@ lt_dlopen (filename)\n \t\t\telse\n \t\t\tif (strcmp(line, \"installed=no\\n\") == 0)\n \t\t\t\tinstalled = 0;\n+\t\t\telse\n+#\t\t\tundef  STR_LIBRARY_NAMES\n+#\t\t\tdefine STR_LIBRARY_NAMES \"library_names=\"\n+\t\t\tif (! dlname &&\n+\t\t\t    strncmp(line, STR_LIBRARY_NAMES,\n+\t\t\t\tsizeof(STR_LIBRARY_NAMES) - 1) == 0) {\n+\t\t\t  char *last_libname;\n+\t\t\t  error = trim(&dlname,\n+\t\t\t\t       &line[sizeof(STR_LIBRARY_NAMES) - 1]);\n+\t\t\t  if (! error && dlname &&\n+\t\t\t      (last_libname = strrchr(dlname, ' ')) != NULL) {\n+\t\t\t    last_libname = strdup(last_libname + 1);\n+\t\t\t    free(dlname);\n+\t\t\t    dlname = last_libname;\n+\t\t\t  }\n+\t\t\t}\n \t\t\tif (error)\n \t\t\t\tbreak;\n \t\t}\n@@ -1333,11 +1471,12 @@ lt_dlopen (filename)\n \t\t\tif (handle)\n \t\t\t\tlt_dlfree(handle);\n \t\t\tif (!error)\n-\t\t\t\tlast_error = memory_error;\n-\t\t\tfree_vars(name, dir, dlname, old_name, libdir, deplibs);\n-\t\t\treturn 0;\n+\t\t\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n+\t\t\tfree_vars(dlname, old_name, libdir, deplibs);\n+\t\t\t/* handle is already set to 0 */\n+\t\t\tgoto cleanup;\n \t\t}\n-\t\thandle->usage = 0;\n+\t\thandle->info.ref_count = 0;\n \t\tif (load_deplibs(handle, deplibs) == 0) {\n \t\t\tnewhandle = handle;\n \t\t\t/* find_module may replace newhandle */\n@@ -1348,24 +1487,23 @@ lt_dlopen (filename)\n \t\t\t}\n \t\t} else\n \t\t\terror = 1;\n+\t\tfree_vars(dlname, old_name, libdir, deplibs);\n \t\tif (error) {\n \t\t\tlt_dlfree(handle);\n-\t\t\tfree_vars(name, dir, dlname, old_name, libdir, deplibs);\n-\t\t\treturn 0;\n+\t\t\thandle = 0;\n+\t\t\tgoto cleanup;\n \t\t}\n-\t\tif (handle != newhandle) {\n+\t\tif (handle != newhandle)\n \t\t\tunload_deplibs(handle);\n-\t\t}\n \t} else {\n \t\t/* not a libtool module */\n \t\thandle = (lt_dlhandle) lt_dlmalloc(sizeof(lt_dlhandle_t));\n \t\tif (!handle) {\n-\t\t\tlast_error = memory_error;\n-\t\t\tif (dir)\n-\t\t\t\tlt_dlfree(dir);\n-\t\t\treturn 0;\n+\t\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n+\t\t\t/* handle is already set to 0 */\n+\t\t\tgoto cleanup;\n \t\t}\n-\t\thandle->usage = 0;\n+\t\thandle->info.ref_count = 0;\n \t\t/* non-libtool modules don't have dependencies */\n \t\thandle->depcount = 0;\n \t\thandle->deplibs = 0;\n@@ -1381,29 +1519,37 @@ lt_dlopen (filename)\n \t\t\t    && !find_file(basename,\n \t\t\t\t\t  getenv(LTDL_SHLIBPATH_VAR),\n \t\t\t\t\t  0, &newhandle)\n+#endif\n+#ifdef LTDL_SYSSEARCHPATH\n+\t\t\t    && !find_file(basename, sys_search_path,\n+\t\t\t\t\t  0, &newhandle)\n #endif\n \t\t\t\t))) {\n \t\t\tlt_dlfree(handle);\n-\t\t\tif (dir)\n-\t\t\t\tlt_dlfree(dir);\n-\t\t\treturn 0;\n+\t\t\thandle = 0;\n+\t\t\tgoto cleanup;\n \t\t}\n \t}\n register_handle:\n \tif (newhandle != handle) {\n \t\tlt_dlfree(handle);\n \t\thandle = newhandle;\n \t}\n-\tif (!handle->usage) {\n-\t\thandle->usage = 1;\n-\t\thandle->name = name;\n+\tif (!handle->info.ref_count) {\n+\t\thandle->info.ref_count = 1;\n+\t\thandle->info.name = name;\n \t\thandle->next = handles;\n \t\thandles = handle;\n-\t} else if (name)\n-\t\tlt_dlfree(name);\n+\t\tname = 0;\t/* don't free this during `cleanup' */\n+\t}\n+\tlast_error = saved_error;\n+cleanup:\n \tif (dir)\n \t\tlt_dlfree(dir);\n-\tlast_error = saved_error;\n+\tif (name)\n+\t\tlt_dlfree(name);\n+\tif (canonical)\n+\t\tlt_dlfree(canonical);\n \treturn handle;\n }\n \n@@ -1420,7 +1566,7 @@ lt_dlopenext (filename)\n \t\treturn lt_dlopen(filename);\n \tlen = strlen(filename);\n \tif (!len) {\n-\t\tlast_error = file_not_found_error;\n+\t\tlast_error = LT_DLSTRERROR(FILE_NOT_FOUND);\n \t\treturn 0;\n \t}\n \t/* try the normal file name */\n@@ -1430,7 +1576,7 @@ lt_dlopenext (filename)\n \t/* try \"filename.la\" */\n \ttmp = (char*) lt_dlmalloc(len+4);\n \tif (!tmp) {\n-\t\tlast_error = memory_error;\n+\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n \t\treturn 0;\n \t}\n \tstrcpy(tmp, filename);\n@@ -1447,7 +1593,7 @@ lt_dlopenext (filename)\n \t\tlt_dlfree(tmp);\n \t\ttmp = (char*) lt_dlmalloc(len + strlen(shlib_ext) + 1);\n \t\tif (!tmp) {\n-\t\t\tlast_error = memory_error;\n+\t\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n \t\t\treturn 0;\n \t\t}\n \t\tstrcpy(tmp, filename);\n@@ -1461,7 +1607,7 @@ lt_dlopenext (filename)\n \t\treturn handle;\n \t}\n #endif\t\n-\tlast_error = file_not_found_error;\n+\tlast_error = LT_DLSTRERROR(FILE_NOT_FOUND);\n \tlt_dlfree(tmp);\n \treturn 0;\n }\n@@ -1479,23 +1625,24 @@ lt_dlclose (handle)\n \t\tcur = cur->next;\n \t}\n \tif (!cur) {\n-\t\tlast_error = invalid_handle_error;\n+\t\tlast_error = LT_DLSTRERROR(INVALID_HANDLE);\n \t\treturn 1;\n \t}\n-\thandle->usage--;\n-\tif (!handle->usage) {\n+\thandle->info.ref_count--;\n+\tif (!handle->info.ref_count) {\n \t\tint\terror;\n+\t  \tlt_dlloader_data_t data = handle->loader->dlloader_data;\n \t\n \t\tif (handle != handles)\n \t\t\tlast->next = handle->next;\n \t\telse\n \t\t\thandles = handle->next;\n-\t\terror = handle->type->lib_close(handle);\n+\t\terror = handle->loader->module_close(data, handle->module);\n \t\terror += unload_deplibs(handle);\n-\t\tif (handle->filename)\n-\t\t\tlt_dlfree(handle->filename);\n-\t\tif (handle->name)\n-\t\t\tlt_dlfree(handle->name);\n+\t\tif (handle->info.filename)\n+\t\t\tlt_dlfree(handle->info.filename);\n+\t\tif (handle->info.name)\n+\t\t\tlt_dlfree(handle->info.name);\n \t\tlt_dlfree(handle);\n \t\treturn error;\n \t}\n@@ -1511,41 +1658,43 @@ lt_dlsym (handle, symbol)\n \tchar\tlsym[LTDL_SYMBOL_LENGTH];\n \tchar\t*sym;\n \tlt_ptr_t address;\n+\tlt_dlloader_data_t data;\n \n \tif (!handle) {\n-\t\tlast_error = invalid_handle_error;\n+\t\tlast_error = LT_DLSTRERROR(INVALID_HANDLE);\n \t\treturn 0;\n \t}\n \tif (!symbol) {\n-\t\tlast_error = symbol_error;\n+\t\tlast_error = LT_DLSTRERROR(SYMBOL_NOT_FOUND);\n \t\treturn 0;\n \t}\n \tlensym = strlen(symbol);\n-\tif (handle->type->sym_prefix)\n-\t\tlensym += strlen(handle->type->sym_prefix);\n-\tif (handle->name)\n-\t\tlensym += strlen(handle->name);\n+\tif (handle->loader->sym_prefix)\n+\t\tlensym += strlen(handle->loader->sym_prefix);\n+\tif (handle->info.name)\n+\t\tlensym += strlen(handle->info.name);\n \tif (lensym + LTDL_SYMBOL_OVERHEAD < LTDL_SYMBOL_LENGTH)\n \t\tsym = lsym;\n \telse\n \t\tsym = (char*) lt_dlmalloc(lensym + LTDL_SYMBOL_OVERHEAD + 1);\n \tif (!sym) {\n-\t\tlast_error = buffer_overflow_error;\n+\t\tlast_error = LT_DLSTRERROR(BUFFER_OVERFLOW);\n \t\treturn 0;\n \t}\n-\tif (handle->name) {\n+\tdata = handle->loader->dlloader_data;\n+\tif (handle->info.name) {\n \t\tconst char *saved_error = last_error;\n \t\t\n \t\t/* this is a libtool module */\n-\t\tif (handle->type->sym_prefix) {\n-\t\t\tstrcpy(sym, handle->type->sym_prefix);\n-\t\t\tstrcat(sym, handle->name);\n+\t\tif (handle->loader->sym_prefix) {\n+\t\t\tstrcpy(sym, handle->loader->sym_prefix);\n+\t\t\tstrcat(sym, handle->info.name);\n \t\t} else\n-\t\t\tstrcpy(sym, handle->name);\n+\t\t\tstrcpy(sym, handle->info.name);\n \t\tstrcat(sym, \"_LTX_\");\n \t\tstrcat(sym, symbol);\n \t\t/* try \"modulename_LTX_symbol\" */\n-\t\taddress = handle->type->find_sym(handle, sym);\n+\t\taddress = handle->loader->find_sym(data, handle->module, sym);\n \t\tif (address) {\n \t\t\tif (sym != lsym)\n \t\t\t\tlt_dlfree(sym);\n@@ -1554,12 +1703,12 @@ lt_dlsym (handle, symbol)\n \t\tlast_error = saved_error;\n \t}\n \t/* otherwise try \"symbol\" */\n-\tif (handle->type->sym_prefix) {\n-\t\tstrcpy(sym, handle->type->sym_prefix);\n+\tif (handle->loader->sym_prefix) {\n+\t\tstrcpy(sym, handle->loader->sym_prefix);\n \t\tstrcat(sym, symbol);\n \t} else\n \t\tstrcpy(sym, symbol);\n-\taddress = handle->type->find_sym(handle, sym);\n+\taddress = handle->loader->find_sym(data, handle->module, sym);\n \tif (sym != lsym)\n \t\tlt_dlfree(sym);\n \treturn address;\n@@ -1583,20 +1732,19 @@ lt_dladdsearchdir (search_dir)\n \tif (!user_search_path) {\n \t\tuser_search_path = strdup(search_dir);\n \t\tif (!user_search_path) {\n-\t\t\tlast_error = memory_error;\n+\t\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n \t\t\treturn 1;\n \t\t}\n \t} else {\n \t\tchar\t*new_search_path = (char*)\n \t\t\tlt_dlmalloc(strlen(user_search_path) + \n \t\t\t\tstrlen(search_dir) + 2); /* ':' + '\\0' == 2 */\n \t\tif (!new_search_path) {\n-\t\t\tlast_error = memory_error;\n+\t\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n \t\t\treturn 1;\n \t\t}\n-\t\tstrcpy(new_search_path, user_search_path);\n-\t\tstrcat(new_search_path, \":\");\n-\t\tstrcat(new_search_path, search_dir);\n+\t\tsprintf (new_search_path, \"%s%c%s\", user_search_path,\n+\t\t\t LTDL_PATHSEP_CHAR, search_dir);\n \t\tlt_dlfree(user_search_path);\n \t\tuser_search_path = new_search_path;\n \t}\n@@ -1623,3 +1771,214 @@ lt_dlgetsearchpath LTDL_PARAMS((void))\n {\n \treturn user_search_path;\n }\n+\n+const lt_dlinfo *\n+lt_dlgetinfo (handle)\n+\tlt_dlhandle handle;\n+{\n+\tif (!handle) {\n+\t\tlast_error = LT_DLSTRERROR(INVALID_HANDLE);\n+\t\treturn 0;\n+\t}\n+\treturn &(handle->info);\n+}\n+\n+int\n+lt_dlforeach (func, data)\n+\tint (*func) LTDL_PARAMS((lt_dlhandle handle, lt_ptr_t data));\n+\tlt_ptr_t data;\n+{\n+\tlt_dlhandle cur = handles;\n+\twhile (cur) {\n+\t\tlt_dlhandle tmp = cur;\n+\t\tcur = cur->next;\n+\t\tif (func(tmp, data))\n+\t\t\treturn 1;\n+\t}\n+\treturn 0;\n+}\n+\n+int\n+lt_dlloader_add (place, dlloader, loader_name)\n+\tlt_dlloader_t *place;\n+\tconst struct lt_user_dlloader *dlloader;\n+\tconst char *loader_name;\n+{\n+\tlt_dlloader_t *node = 0, *ptr = 0;\n+\t\n+\tif ((dlloader == 0)\t/* diagnose null parameters */\n+\t    || (dlloader->module_open == 0)\n+\t    || (dlloader->module_close == 0)\n+\t    || (dlloader->find_sym == 0)) {\n+\t\tlast_error = LT_DLSTRERROR(INVALID_LOADER);\n+\t\treturn 1;\n+\t}\n+\n+\t/* Create a new dlloader node with copies of the user callbacks.  */\n+\tnode = (lt_dlloader_t *) lt_dlmalloc (sizeof (lt_dlloader_t));\n+\tif (node == 0) {\n+\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n+\t\treturn 1;\n+\t}\n+\tnode->next = 0;\n+\tnode->loader_name = loader_name;\n+\tnode->sym_prefix = dlloader->sym_prefix;\n+\tnode->dlloader_exit = dlloader->dlloader_exit;\n+\tnode->module_open = dlloader->module_open;\n+\tnode->module_close = dlloader->module_close;\n+\tnode->find_sym = dlloader->find_sym;\n+\tnode->dlloader_data = dlloader->dlloader_data;\n+\t\n+\tif (!loaders)\n+\t\t/* If there are no loaders, NODE becomes the list! */\n+\t\tloaders = node;\n+\telse if (!place) {\n+\t\t/* If PLACE is not set, add NODE to the end of the\n+\t\t   LOADERS list. */\n+\t\tfor (ptr = loaders; ptr->next; ptr = ptr->next)\n+\t\t\t/*NOWORK*/;\n+\t\tptr->next = node;\n+\t} else if (loaders == place) {\n+\t\t/* If PLACE is the first loader, NODE goes first. */\n+\t\tnode->next = place;\n+\t\tloaders = node;\n+\t} else {\n+\t\t/* Find the node immediately preceding PLACE. */\n+\t\tfor (ptr = loaders; ptr->next != place; ptr = ptr->next)\n+\t\t\t/*NOWORK*/;\n+\n+\t\tif (ptr->next != place) {\n+\t\t\tlast_error = LT_DLSTRERROR(INVALID_LOADER);\n+\t\t\treturn 1;\n+\t\t}\n+\n+\t\t/* Insert NODE between PTR and PLACE. */\n+\t\tnode->next = place;\n+\t\tptr->next = node;\n+\t}\n+\n+\treturn 0;\n+}\n+\n+int\n+lt_dlloader_remove (loader_name)\n+\tconst char *loader_name;\n+{\n+\tlt_dlloader_t *place = lt_dlloader_find (loader_name);\n+\tlt_dlhandle handle;\n+\tint result = 0;\n+\n+\tif (!place) {\n+\t\tlast_error = LT_DLSTRERROR(INVALID_LOADER);\n+\t\treturn 1;\n+\t}\n+\n+\t/* Fail if there are any open modules which use this loader. */\n+\tfor  (handle = handles; handle; handle = handle->next)\n+\t\tif (handle->loader == place) {\n+\t\t\tlast_error = LT_DLSTRERROR(REMOVE_LOADER);\n+\t\t\treturn 1;\n+\t\t}\n+\t\n+\tif (place == loaders)\n+\t\t/* PLACE is the first loader in the list. */\n+\t\tloaders = loaders->next;\n+\telse {\n+\t\t/* Find the loader before the one being removed. */\n+\t\tlt_dlloader_t *prev;\n+\t\tfor (prev = loaders; prev->next; prev = prev->next)\n+\t\t\tif (!strcmp (prev->next->loader_name, loader_name))\n+\t\t\t\tbreak;\n+\n+\t\tplace = prev->next;\n+\t\tprev->next = prev->next->next;\n+\t}\n+\tif (place->dlloader_exit)\n+\t\tresult = place->dlloader_exit (place->dlloader_data);\n+\tlt_dlfree (place);\n+\n+\treturn result;\n+}\n+\n+lt_dlloader_t *\n+lt_dlloader_next (place)\n+\tlt_dlloader_t *place;\n+{\n+\treturn place ? place->next : loaders;\n+}\n+\t\n+const char *\n+lt_dlloader_name (place)\n+\tlt_dlloader_t *place;\n+{\n+\tif (!place)\n+\t\tlast_error =  LT_DLSTRERROR(INVALID_LOADER);\n+\treturn place ? place->loader_name : 0;\n+}\t\n+\n+lt_dlloader_data_t *\n+lt_dlloader_data (place)\n+\tlt_dlloader_t *place;\n+{\n+\tif (!place)\n+\t\tlast_error =  LT_DLSTRERROR(INVALID_LOADER);\n+\treturn place ? &(place->dlloader_data) : 0;\n+}\t\n+\n+lt_dlloader_t *\n+lt_dlloader_find (loader_name)\n+\tconst char *loader_name;\n+{\n+\tlt_dlloader_t *place = 0;\n+\n+\tfor (place = loaders; place; place = place->next)\n+\t\tif (strcmp (place->loader_name, loader_name) == 0)\n+\t\t\tbreak;\n+\n+\treturn place;\n+}\n+\n+static const char **user_error_strings = 0;\n+static int errorcode = LTDL_ERROR_MAX;\n+\n+int\n+lt_dladderror (diagnostic)\n+\tconst char *diagnostic;\n+{\n+\tint index = errorcode - LTDL_ERROR_MAX;\n+\tconst char **temp = 0;\n+\n+\t/* realloc is not entirely portable, so simulate it using\n+\t   lt_dlmalloc and lt_dlfree. */\n+\ttemp = (const char **) lt_dlmalloc ((1+index) * sizeof(const char*));\n+\tif (temp == 0) {\n+\t\tlast_error = LT_DLSTRERROR(NO_MEMORY);\n+\t\treturn -1;\n+\t}\n+\n+\t/* Build the new vector in the memory addressed by temp. */\n+\ttemp[index] = diagnostic;\n+\twhile (--index >= 0)\n+\t\ttemp[index] = user_error_strings[index];\n+\n+\tlt_dlfree (user_error_strings);\n+\tuser_error_strings = temp;\n+\treturn errorcode++;\n+}\n+\n+int\n+lt_dlseterror (index)\n+\tint index;\n+{\n+\tif (index >= errorcode || index < 0) {\n+\t\tlast_error = LT_DLSTRERROR(INVALID_ERRORCODE);\n+\t\treturn 1;\n+\t}\n+\t\n+\tif (index < LTDL_ERROR_MAX)\n+\t\tlast_error = ltdl_error_strings[errorcode];\n+\telse\n+\t\tlast_error = user_error_strings[errorcode - LTDL_ERROR_MAX];\n+\n+\treturn 0;\n+}"}]}