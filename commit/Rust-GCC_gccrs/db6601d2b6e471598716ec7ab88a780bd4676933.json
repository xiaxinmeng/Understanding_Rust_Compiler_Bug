{"sha": "db6601d2b6e471598716ec7ab88a780bd4676933", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGI2NjAxZDJiNmU0NzE1OTg3MTZlYzdhYjg4YTc4MGJkNDY3NjkzMw==", "commit": {"author": {"name": "James Bowman", "email": "james.bowman@ftdichip.com", "date": "2017-09-29T01:01:52Z"}, "committer": {"name": "James Bowman", "email": "jamesbowman@gcc.gnu.org", "date": "2017-09-29T01:01:52Z"}, "message": "crti-hw.S: Add watchdog vector, FT930 IRQ support.\n\nlibgcc/\n\t* config/ft32/crti-hw.S: Add watchdog vector, FT930\n\tIRQ support.\n\nFrom-SVN: r253276", "tree": {"sha": "9e7b77c2ae304f82d9304a8aebd54139727e53a1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9e7b77c2ae304f82d9304a8aebd54139727e53a1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/db6601d2b6e471598716ec7ab88a780bd4676933", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/db6601d2b6e471598716ec7ab88a780bd4676933", "html_url": "https://github.com/Rust-GCC/gccrs/commit/db6601d2b6e471598716ec7ab88a780bd4676933", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/db6601d2b6e471598716ec7ab88a780bd4676933/comments", "author": null, "committer": null, "parents": [{"sha": "8da872d9cad373d8e74a75fddf79b36b8b924b38", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8da872d9cad373d8e74a75fddf79b36b8b924b38", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8da872d9cad373d8e74a75fddf79b36b8b924b38"}], "stats": {"total": 32, "additions": 21, "deletions": 11}, "files": [{"sha": "7b1ffb1a0ccb683a9de0038b00436dd786266890", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/db6601d2b6e471598716ec7ab88a780bd4676933/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/db6601d2b6e471598716ec7ab88a780bd4676933/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=db6601d2b6e471598716ec7ab88a780bd4676933", "patch": "@@ -1,3 +1,7 @@\n+2017-09-28  James Bowman  <james.bowman@ftdichip.com>\n+\n+\t* config/ft32/crti-hw.S: Add watchdog vector, FT930 IRQ support.\n+\n 2017-09-26  Joseph Myers  <joseph@codesourcery.com>\n \n \t* config/microblaze/crti.S, config/microblaze/crtn.S,"}, {"sha": "8ee1d38b47e7c363e823708a36db499947c9f91a", "filename": "libgcc/config/ft32/crti-hw.S", "status": "modified", "additions": 17, "deletions": 11, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/db6601d2b6e471598716ec7ab88a780bd4676933/libgcc%2Fconfig%2Fft32%2Fcrti-hw.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/db6601d2b6e471598716ec7ab88a780bd4676933/libgcc%2Fconfig%2Fft32%2Fcrti-hw.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fft32%2Fcrti-hw.S?ref=db6601d2b6e471598716ec7ab88a780bd4676933", "patch": "@@ -1,8 +1,8 @@\n .global _start\n _start:\n # START Interrupt Vector Table [[\n-        jmp     __PMSIZE-4\n-        jmp     watchdog_init\n+        jmp     __PMSIZE-4         # RESET Vector\n+        jmp     interrupt_33       # Watchdog reset vector\n         jmp     interrupt_0\n         jmp     interrupt_1\n         jmp     interrupt_2\n@@ -35,24 +35,29 @@ _start:\n         jmp     interrupt_29\n         jmp     interrupt_30\n         jmp     interrupt_31\n-        jmp     __PMSIZE-8\n+        jmp     __PMSIZE-8         # Interrupt vector 32 (NMI)\n # ]] END Interrupt Vector Table\n \n codestart:\n         jmp    init\n-        \n+\n .global _exithook\n _exithook:               # Debugger uses '_exithook' at 0x90 to catch program exit\n         return\n-        \n-watchdog_init:\n-        ldk\t$r0,1\n+\n init:\n         ldk     $sp,__RAMSIZE\n         # Disable all interrupts\n-        ldk     $r4,0x80\n-        sta.b   0x100e3,$r4\n-        \n+        lda   $r1,0x10000\n+        lshr  $r1,$r1,20\n+        cmp   $r1,0x90\n+        ldk   $r1,0x100e3   # FT900 IRQ Control Register\n+        jmpc  z,1f\n+        ldk   $r1,0x10123   # FT930 IRQ Control Register\n+1:\n+        ldk   $r4,0x80\n+        sti.b $r1,0,$r4\n+\n         # Initialize DATA by copying from program memory\n         ldk.l   $r4,__data_load_start\n         ldk.l   $r1,__data_load_end\n@@ -139,6 +144,7 @@ interrupt_\\i:\n         inth    30\n         inth    31\n         inth    32\n+        inth    33\n \n         # On entry: r0, already saved, holds the handler function\n interrupt_common:\n@@ -182,7 +188,7 @@ nullvector:\n .section .data\n .global vector_table\n vector_table:\n-        .rept 33\n+        .rept 34\n                 .long   nullvector\n         .endr\n "}]}