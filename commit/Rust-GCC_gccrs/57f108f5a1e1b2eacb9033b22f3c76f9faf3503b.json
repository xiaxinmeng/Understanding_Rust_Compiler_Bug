{"sha": "57f108f5a1e1b2eacb9033b22f3c76f9faf3503b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTdmMTA4ZjVhMWUxYjJlYWNiOTAzM2IyMmYzYzc2ZjlmYWYzNTAzYg==", "commit": {"author": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2018-04-14T21:13:20Z"}, "committer": {"name": "Segher Boessenkool", "email": "segher@gcc.gnu.org", "date": "2018-04-14T21:13:20Z"}, "message": "rs6000: Disable -m[no-]direct-move (PR85293)\n\nThe -mno-direct-move option causes a lot of problems, since it forces\nus to be able to generate code for p8 and up with some crucial\ninstructions missing.  This patch removes the -m[no-]direct-move\noptions so that the user cannot put us into this unexpected situation\nanymore.  Internally we still have all the same flags, and they are\nautomatically set based on -mcpu; getting rid of that is a lot more\nwork and will have to wait for GCC 9 (in some places the flag is used\nto see if we are compiling for a p8 _at all_).\n\n\n\tPR target/85293\n\t* config/rs6000/rs6000.opt (mdirect-move): Make deprecated.\n\t* doc/invoke.texi (RS/6000 and PowerPC Options): Remove -mdirect-move\n\tand -mno-direct-move.\n\ngcc/testsuite/\n\tPR target/85293\n\t* gcc.target/powerpc/pr80098-2.c: Remove -mdirect-move.  Remove the\n\tcorresponding dg-error clause.\n\t* gcc.target/powerpc/pr80098-3.c: Ditto.\n\t* gcc.target/powerpc/pr80103-1.c: Delete.\n\nFrom-SVN: r259386", "tree": {"sha": "3a5b4e36722281d9e5f6d591810d4ce793ba91e5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3a5b4e36722281d9e5f6d591810d4ce793ba91e5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/57f108f5a1e1b2eacb9033b22f3c76f9faf3503b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57f108f5a1e1b2eacb9033b22f3c76f9faf3503b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/57f108f5a1e1b2eacb9033b22f3c76f9faf3503b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57f108f5a1e1b2eacb9033b22f3c76f9faf3503b/comments", "author": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2368eaf95dff456f6527f6d82579af0246141553", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2368eaf95dff456f6527f6d82579af0246141553", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2368eaf95dff456f6527f6d82579af0246141553"}], "stats": {"total": 51, "additions": 20, "deletions": 31}, "files": [{"sha": "9b7f84582a4dd97e167ac7c313522a6b3661375a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57f108f5a1e1b2eacb9033b22f3c76f9faf3503b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57f108f5a1e1b2eacb9033b22f3c76f9faf3503b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=57f108f5a1e1b2eacb9033b22f3c76f9faf3503b", "patch": "@@ -1,3 +1,10 @@\n+2018-04-14  Segher Boessenkool  <segher@kernel.crashing.org>\n+\n+\tPR target/85293\n+\t* config/rs6000/rs6000.opt (mdirect-move): Make deprecated.\n+\t* doc/invoke.texi (RS/6000 and PowerPC Options): Remove -mdirect-move\n+\tand -mno-direct-move.\n+\n 2018-04-13  Paul A. Clarke  <pc@us.ibm.com>\n \n \tPR target/83402"}, {"sha": "ace8a4775503f6ed66363943aaff9eb8ef2d1f24", "filename": "gcc/config/rs6000/rs6000.opt", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57f108f5a1e1b2eacb9033b22f3c76f9faf3503b/gcc%2Fconfig%2Frs6000%2Frs6000.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57f108f5a1e1b2eacb9033b22f3c76f9faf3503b/gcc%2Fconfig%2Frs6000%2Frs6000.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.opt?ref=57f108f5a1e1b2eacb9033b22f3c76f9faf3503b", "patch": "@@ -534,8 +534,7 @@ Target Report Mask(CRYPTO) Var(rs6000_isa_flags)\n Use ISA 2.07 Category:Vector.AES and Category:Vector.SHA2 instructions.\n \n mdirect-move\n-Target Report Mask(DIRECT_MOVE) Var(rs6000_isa_flags)\n-Use ISA 2.07 direct move between GPR & VSX register instructions.\n+Target Undocumented Mask(DIRECT_MOVE) Var(rs6000_isa_flags) Ignore Warn(%qs is deprecated)\n \n mhtm\n Target Report Mask(HTM) Var(rs6000_isa_flags)"}, {"sha": "8c0d275626f606b6766179ff1d351d0c5086818b", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 2, "deletions": 10, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57f108f5a1e1b2eacb9033b22f3c76f9faf3503b/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57f108f5a1e1b2eacb9033b22f3c76f9faf3503b/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=57f108f5a1e1b2eacb9033b22f3c76f9faf3503b", "patch": "@@ -1101,7 +1101,7 @@ See RS/6000 and PowerPC Options.\n -mpointers-to-nested-functions  -mno-pointers-to-nested-functions @gol\n -msave-toc-indirect  -mno-save-toc-indirect @gol\n -mpower8-fusion  -mno-mpower8-fusion  -mpower8-vector  -mno-power8-vector @gol\n--mcrypto  -mno-crypto  -mhtm  -mno-htm  -mdirect-move  -mno-direct-move @gol\n+-mcrypto  -mno-crypto  -mhtm  -mno-htm @gol\n -mquad-memory  -mno-quad-memory @gol\n -mquad-memory-atomic  -mno-quad-memory-atomic @gol\n -mcompat-align-parm  -mno-compat-align-parm @gol\n@@ -23359,7 +23359,7 @@ following options:\n -mpopcntb -mpopcntd  -mpowerpc64 @gol\n -mpowerpc-gpopt  -mpowerpc-gfxopt  -msingle-float -mdouble-float @gol\n -msimple-fpu  -mmulhw  -mdlmzb  -mmfpgpr -mvsx @gol\n--mcrypto -mdirect-move -mhtm -mpower8-fusion -mpower8-vector @gol\n+-mcrypto -mhtm -mpower8-fusion -mpower8-vector @gol\n -mquad-memory -mquad-memory-atomic -mfloat128 -mfloat128-hardware}\n \n The particular options set for any particular CPU varies between\n@@ -23501,14 +23501,6 @@ Enable the use (disable) of the built-in functions that allow direct\n access to the cryptographic instructions that were added in version\n 2.07 of the PowerPC ISA.\n \n-@item -mdirect-move\n-@itemx -mno-direct-move\n-@opindex mdirect-move\n-@opindex mno-direct-move\n-Generate code that uses (does not use) the instructions to move data\n-between the general purpose registers and the vector/scalar (VSX)\n-registers that were added in version 2.07 of the PowerPC ISA.\n-\n @item -mhtm\n @itemx -mno-htm\n @opindex mhtm"}, {"sha": "38920451dd8f313c5cbc53ce2f7a745b0232091e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57f108f5a1e1b2eacb9033b22f3c76f9faf3503b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57f108f5a1e1b2eacb9033b22f3c76f9faf3503b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=57f108f5a1e1b2eacb9033b22f3c76f9faf3503b", "patch": "@@ -1,3 +1,11 @@\n+2018-04-14  Segher Boessenkool  <segher@kernel.crashing.org>\n+\n+\tPR target/85293\n+\t* gcc.target/powerpc/pr80098-2.c: Remove -mdirect-move.  Remove the\n+\tcorresponding dg-error clause.\n+\t* gcc.target/powerpc/pr80098-3.c: Ditto.\n+\t* gcc.target/powerpc/pr80103-1.c: Delete.\n+\n 2018-04-14  Andre Vehreschild  <vehre@gcc.gnu.org>\n \n \tPR fortran/81773"}, {"sha": "5a6421b38440869bd4405a68c4023d74636d713d", "filename": "gcc/testsuite/gcc.target/powerpc/pr80098-2.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57f108f5a1e1b2eacb9033b22f3c76f9faf3503b/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr80098-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57f108f5a1e1b2eacb9033b22f3c76f9faf3503b/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr80098-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr80098-2.c?ref=57f108f5a1e1b2eacb9033b22f3c76f9faf3503b", "patch": "@@ -1,9 +1,8 @@\n /* { dg-do compile { target { powerpc64*-*-* } } } */\n /* { dg-skip-if \"do not override -mcpu\" { powerpc*-*-* } { \"-mcpu=*\" } { \"-mcpu=power8\" } } */\n /* { dg-require-effective-target powerpc_p8vector_ok } */\n-/* { dg-options \"-mcpu=power8 -mno-power8-vector -mdirect-move -mcrypto\" } */\n+/* { dg-options \"-mcpu=power8 -mno-power8-vector -mcrypto\" } */\n \n int i;\n \n-/* { dg-error \"'-mno-power8-vector' turns off '-mdirect-move'\" \"PR80098\" { target *-*-* } 0 } */\n /* { dg-error \"'-mno-power8-vector' turns off '-mcrypto'\"      \"PR80098\" { target *-*-* } 0 } */"}, {"sha": "e62418bd061a58461ae06315704a05592be66b88", "filename": "gcc/testsuite/gcc.target/powerpc/pr80098-3.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57f108f5a1e1b2eacb9033b22f3c76f9faf3503b/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr80098-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57f108f5a1e1b2eacb9033b22f3c76f9faf3503b/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr80098-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr80098-3.c?ref=57f108f5a1e1b2eacb9033b22f3c76f9faf3503b", "patch": "@@ -1,9 +1,8 @@\n /* { dg-do compile { target { powerpc64*-*-* } } } */\n /* { dg-skip-if \"do not override -mcpu\" { powerpc*-*-* } { \"-mcpu=*\" } { \"-mcpu=power7\" } } */\n /* { dg-require-effective-target powerpc_vsx_ok } */\n-/* { dg-options \"-mcpu=power7 -mno-vsx -mdirect-move -mcrypto\" } */\n+/* { dg-options \"-mcpu=power7 -mno-vsx -mcrypto\" } */\n \n int i;\n \n-/* { dg-error \"'-mno-vsx' turns off '-mdirect-move'\" \"PR80098\" { target *-*-* } 0 } */\n /* { dg-error \"'-mno-vsx' turns off '-mcrypto'\"      \"PR80098\" { target *-*-* } 0 } */"}, {"sha": "a25d617ae8b2a4c195bc5aee31a54d9d1125da1d", "filename": "gcc/testsuite/gcc.target/powerpc/pr80103-1.c", "status": "removed", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2368eaf95dff456f6527f6d82579af0246141553/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr80103-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2368eaf95dff456f6527f6d82579af0246141553/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr80103-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr80103-1.c?ref=2368eaf95dff456f6527f6d82579af0246141553", "patch": "@@ -1,15 +0,0 @@\n-/* { dg-do compile { target { powerpc*-*-* } } } */\n-/* { dg-skip-if \"do not override -mcpu\" { powerpc*-*-* } { \"-mcpu=*\" } { \"-mcpu=power9\" } } */\n-/* { dg-require-effective-target powerpc_p9vector_ok } */\n-/* { dg-options \"-mpower9-minmax -mno-direct-move\" } */\n-/* { dg-excess-errors \"expect error due to conflicting target options\" } */\n-/* Since the error message is not associated with a particular line\n-   number, we cannot use the dg-error directive and cannot specify a\n-   regexp to describe the expected error message.  The expected error\n-   message is: \"-mpower9-minmax requires -mdirect-move\" */\n-\n-int a;\n-void b (__attribute__ ((__vector_size__ (16))) char c)\n-{\n-  a = ((__attribute__ ((__vector_size__ (2 * sizeof (long)))) long) c)[0];\n-}"}]}