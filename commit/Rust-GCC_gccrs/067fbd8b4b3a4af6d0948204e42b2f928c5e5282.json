{"sha": "067fbd8b4b3a4af6d0948204e42b2f928c5e5282", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDY3ZmJkOGI0YjNhNGFmNmQwOTQ4MjA0ZTQyYjJmOTI4YzVlNTI4Mg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-02-23T19:47:24Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-02-23T19:47:24Z"}, "message": "re PR objc/69844 (Possibly bogus error: unknown type name in ObjC code)\n\n\tPR objc/69844\n\t* c-parser.c (c_parser_for_statement): Properly handle ObjC classes\n\tin id_kind reclassification.\n\n\t* objc.dg/pr69844.m: New test.\n\nFrom-SVN: r233643", "tree": {"sha": "581ba76b0e43ed3d6b85de942669146902e8d4d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/581ba76b0e43ed3d6b85de942669146902e8d4d5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/067fbd8b4b3a4af6d0948204e42b2f928c5e5282", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/067fbd8b4b3a4af6d0948204e42b2f928c5e5282", "html_url": "https://github.com/Rust-GCC/gccrs/commit/067fbd8b4b3a4af6d0948204e42b2f928c5e5282", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/067fbd8b4b3a4af6d0948204e42b2f928c5e5282/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "64a454d9f74cecd95241e96fef281b64715049c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/64a454d9f74cecd95241e96fef281b64715049c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/64a454d9f74cecd95241e96fef281b64715049c4"}], "stats": {"total": 66, "additions": 59, "deletions": 7}, "files": [{"sha": "d0fbaba96ba09f644c7672739279949437bd24ad", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/067fbd8b4b3a4af6d0948204e42b2f928c5e5282/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/067fbd8b4b3a4af6d0948204e42b2f928c5e5282/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=067fbd8b4b3a4af6d0948204e42b2f928c5e5282", "patch": "@@ -1,3 +1,9 @@\n+2016-02-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR objc/69844\n+\t* c-parser.c (c_parser_for_statement): Properly handle ObjC classes\n+\tin id_kind reclassification.\n+\n 2016-02-16  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c/69835"}, {"sha": "82c1d61b76afb3cdb3d9667fe987b43d6e0250d1", "filename": "gcc/c/c-parser.c", "status": "modified", "additions": 24, "deletions": 7, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/067fbd8b4b3a4af6d0948204e42b2f928c5e5282/gcc%2Fc%2Fc-parser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/067fbd8b4b3a4af6d0948204e42b2f928c5e5282/gcc%2Fc%2Fc-parser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-parser.c?ref=067fbd8b4b3a4af6d0948204e42b2f928c5e5282", "patch": "@@ -5886,13 +5886,30 @@ c_parser_for_statement (c_parser *parser, bool ivdep)\n   if (c_parser_next_token_is (parser, CPP_NAME))\n     {\n       c_token *token = c_parser_peek_token (parser);\n-      tree decl = lookup_name (token->value);\n-      if (decl == NULL_TREE || VAR_P (decl))\n-\t/* If DECL is null, we don't know what this token might be.  Treat\n-\t   it as an ID for better diagnostics; we'll error later on.  */\n-\ttoken->id_kind = C_ID_ID;\n-      else if (TREE_CODE (decl) == TYPE_DECL)\n-\ttoken->id_kind = C_ID_TYPENAME;\n+\n+      if (token->id_kind != C_ID_CLASSNAME)\n+\t{\n+\t  tree decl = lookup_name (token->value);\n+\n+\t  token->id_kind = C_ID_ID;\n+\t  if (decl)\n+\t    {\n+\t      if (TREE_CODE (decl) == TYPE_DECL)\n+\t\ttoken->id_kind = C_ID_TYPENAME;\n+\t    }\n+\t  else if (c_dialect_objc ())\n+\t    {\n+\t      tree objc_interface_decl = objc_is_class_name (token->value);\n+\t      /* Objective-C class names are in the same namespace as\n+\t\t variables and typedefs, and hence are shadowed by local\n+\t\t declarations.  */\n+\t      if (objc_interface_decl)\n+\t\t{\n+\t\t  token->value = objc_interface_decl;\n+\t\t  token->id_kind = C_ID_CLASSNAME;\n+\t\t}\n+\t    }\n+\t}\n     }\n \n   token_indent_info next_tinfo"}, {"sha": "8a9e3a02f886673b1450db57c28f0f13973ae53a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/067fbd8b4b3a4af6d0948204e42b2f928c5e5282/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/067fbd8b4b3a4af6d0948204e42b2f928c5e5282/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=067fbd8b4b3a4af6d0948204e42b2f928c5e5282", "patch": "@@ -1,3 +1,8 @@\n+2016-02-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR objc/69844\n+\t* objc.dg/pr69844.m: New test.\n+\n 2016-02-23  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR libgfortran/69456"}, {"sha": "9abcc7a360a7a30d80d691c29ba55eae0318047b", "filename": "gcc/testsuite/objc.dg/pr69844.m", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/067fbd8b4b3a4af6d0948204e42b2f928c5e5282/gcc%2Ftestsuite%2Fobjc.dg%2Fpr69844.m", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/067fbd8b4b3a4af6d0948204e42b2f928c5e5282/gcc%2Ftestsuite%2Fobjc.dg%2Fpr69844.m", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fobjc.dg%2Fpr69844.m?ref=067fbd8b4b3a4af6d0948204e42b2f928c5e5282", "patch": "@@ -0,0 +1,24 @@\n+/* PR objc/69844 */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=gnu99\" } */\n+\n+@class D;\n+\n+void\n+foo (void)\n+{\n+  for (;;)\n+    ;\n+  D *d = (id) 0;\n+  (void) d;\n+}\n+\n+void\n+bar (void)\n+{\n+  for (int D = 0; D < 30; D++)\n+    if (1)\n+      ;\n+  D *d = (id) 0;\n+  (void) d;\n+}"}]}