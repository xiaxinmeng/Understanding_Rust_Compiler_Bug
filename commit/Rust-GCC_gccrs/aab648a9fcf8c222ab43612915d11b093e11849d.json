{"sha": "aab648a9fcf8c222ab43612915d11b093e11849d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWFiNjQ4YTlmY2Y4YzIyMmFiNDM2MTI5MTVkMTFiMDkzZTExODQ5ZA==", "commit": {"author": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2016-10-12T15:21:38Z"}, "committer": {"name": "Segher Boessenkool", "email": "segher@gcc.gnu.org", "date": "2016-10-12T15:21:38Z"}, "message": "dce: Don't dead-code delete separately wrapped restores\n\nIf there is a separately wrapped register restore on some path that\nis dead (say, control goes into an endless loop after it), then we\ncannot delete that restore because that would confuse the DWARF CFI\n(if there is another path joining).\nThis happens with gcc.dg/torture/pr53168.c, for example.\n\n\n\t* dce.c (delete_unmarked_insns): Don't delete instructions with\n\ta REG_CFA_RESTORE note.\n\nFrom-SVN: r241060", "tree": {"sha": "c04c19ce683616d0ce012f90a973edb86373e8a4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c04c19ce683616d0ce012f90a973edb86373e8a4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/aab648a9fcf8c222ab43612915d11b093e11849d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aab648a9fcf8c222ab43612915d11b093e11849d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aab648a9fcf8c222ab43612915d11b093e11849d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aab648a9fcf8c222ab43612915d11b093e11849d/comments", "author": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "20a6ece021473dc7f182b751bcbdaa6ad9762375", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/20a6ece021473dc7f182b751bcbdaa6ad9762375", "html_url": "https://github.com/Rust-GCC/gccrs/commit/20a6ece021473dc7f182b751bcbdaa6ad9762375"}], "stats": {"total": 14, "additions": 14, "deletions": 0}, "files": [{"sha": "77935447474ae2944bc05a600d0ecb702afcc073", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aab648a9fcf8c222ab43612915d11b093e11849d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aab648a9fcf8c222ab43612915d11b093e11849d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=aab648a9fcf8c222ab43612915d11b093e11849d", "patch": "@@ -1,3 +1,8 @@\n+2016-10-12  Segher Boessenkool  <segher@kernel.crashing.org>\n+\n+\t* dce.c (delete_unmarked_insns): Don't delete instructions with\n+\ta REG_CFA_RESTORE note.\n+\n 2016-10-12  Segher Boessenkool  <segher@kernel.crashing.org>\n \n \t* common.opt (-fshrink-wrap-separate): New flag."}, {"sha": "d5102873f60015a1c4c0eed3c09fe31b9c103e92", "filename": "gcc/dce.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aab648a9fcf8c222ab43612915d11b093e11849d/gcc%2Fdce.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aab648a9fcf8c222ab43612915d11b093e11849d/gcc%2Fdce.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdce.c?ref=aab648a9fcf8c222ab43612915d11b093e11849d", "patch": "@@ -587,6 +587,15 @@ delete_unmarked_insns (void)\n \t  if (!dbg_cnt (dce))\n \t    continue;\n \n+\t  if (crtl->shrink_wrapped_separate\n+\t      && find_reg_note (insn, REG_CFA_RESTORE, NULL))\n+\t    {\n+\t      if (dump_file)\n+\t\tfprintf (dump_file, \"DCE: NOT deleting insn %d, it's a \"\n+\t\t\t\t    \"callee-save restore\\n\", INSN_UID (insn));\n+\t      continue;\n+\t    }\n+\n \t  if (dump_file)\n \t    fprintf (dump_file, \"DCE: Deleting insn %d\\n\", INSN_UID (insn));\n "}]}