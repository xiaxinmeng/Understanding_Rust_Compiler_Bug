{"sha": "d577ba89642ebb5701d6e2ca7aaf31de2a427794", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDU3N2JhODk2NDJlYmI1NzAxZDZlMmNhN2FhZjMxZGUyYTQyNzc5NA==", "commit": {"author": {"name": "Alan Modra", "email": "amodra@gcc.gnu.org", "date": "2016-05-04T13:17:51Z"}, "committer": {"name": "Alan Modra", "email": "amodra@gcc.gnu.org", "date": "2016-05-04T13:17:51Z"}, "message": "[RS6000] Align .toc section\n\nLack of any .toc section alignment causes kexec and kdump failure\nwhen linking without the usual linker script.  This of course is\nreally a kexec-tools error, but it is also true that .toc ought to\nalways be word aligned.\n\n\t* config/rs6000/rs6000.c (rs6000_elf_output_toc_section_asm_op):\n\tAlign .toc.\n\nFrom-SVN: r235874", "tree": {"sha": "99af9d5e1f698297936c922f6d20d99a26e39c45", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/99af9d5e1f698297936c922f6d20d99a26e39c45"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d577ba89642ebb5701d6e2ca7aaf31de2a427794", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d577ba89642ebb5701d6e2ca7aaf31de2a427794", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d577ba89642ebb5701d6e2ca7aaf31de2a427794", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d577ba89642ebb5701d6e2ca7aaf31de2a427794/comments", "author": null, "committer": null, "parents": [{"sha": "a793339b732e4a0cd883de9db8698afbcb88bfdf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a793339b732e4a0cd883de9db8698afbcb88bfdf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a793339b732e4a0cd883de9db8698afbcb88bfdf"}], "stats": {"total": 21, "additions": 18, "deletions": 3}, "files": [{"sha": "f339b0ecb5a4e179c5d59b7e0ad0ec1bb269754a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d577ba89642ebb5701d6e2ca7aaf31de2a427794/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d577ba89642ebb5701d6e2ca7aaf31de2a427794/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d577ba89642ebb5701d6e2ca7aaf31de2a427794", "patch": "@@ -1,4 +1,9 @@\n-2016-06-04  Matthew Fortune  <matthew.fortune@imgtec.com>\n+2016-05-04  Alan Modra  <amodra@gmail.com>\n+\n+\t* config/rs6000/rs6000.c (rs6000_elf_output_toc_section_asm_op):\n+\tAlign .toc.\n+\n+2016-05-04  Matthew Fortune  <matthew.fortune@imgtec.com>\n \n \t* config/mips/mips-cpus.def (p5600): Avoid IMADD by default.\n \tClean up p5600 comments."}, {"sha": "fb522fb6144e2c409f436b8b3bed36d4346b63bc", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d577ba89642ebb5701d6e2ca7aaf31de2a427794/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d577ba89642ebb5701d6e2ca7aaf31de2a427794/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=d577ba89642ebb5701d6e2ca7aaf31de2a427794", "patch": "@@ -31339,29 +31339,39 @@ rs6000_elf_output_toc_section_asm_op (const void *data ATTRIBUTE_UNUSED)\n     {\n       if (!toc_initialized)\n \t{\n-\t  toc_initialized = 1;\n \t  fprintf (asm_out_file, \"%s\\n\", TOC_SECTION_ASM_OP);\n+\t  ASM_OUTPUT_ALIGN (asm_out_file, TARGET_64BIT ? 3 : 2);\n \t  (*targetm.asm_out.internal_label) (asm_out_file, \"LCTOC\", 0);\n \t  fprintf (asm_out_file, \"\\t.tc \");\n \t  ASM_OUTPUT_INTERNAL_LABEL_PREFIX (asm_out_file, \"LCTOC1[TC],\");\n \t  ASM_OUTPUT_INTERNAL_LABEL_PREFIX (asm_out_file, \"LCTOC1\");\n \t  fprintf (asm_out_file, \"\\n\");\n \n \t  fprintf (asm_out_file, \"%s\\n\", MINIMAL_TOC_SECTION_ASM_OP);\n+\t  ASM_OUTPUT_ALIGN (asm_out_file, TARGET_64BIT ? 3 : 2);\n \t  ASM_OUTPUT_INTERNAL_LABEL_PREFIX (asm_out_file, \"LCTOC1\");\n \t  fprintf (asm_out_file, \" = .+32768\\n\");\n+\t  toc_initialized = 1;\n \t}\n       else\n \tfprintf (asm_out_file, \"%s\\n\", MINIMAL_TOC_SECTION_ASM_OP);\n     }\n   else if ((DEFAULT_ABI == ABI_AIX || DEFAULT_ABI == ABI_ELFv2)\n \t   && !TARGET_RELOCATABLE)\n-    fprintf (asm_out_file, \"%s\\n\", TOC_SECTION_ASM_OP);\n+    {\n+      fprintf (asm_out_file, \"%s\\n\", TOC_SECTION_ASM_OP);\n+      if (!toc_initialized)\n+\t{\n+\t  ASM_OUTPUT_ALIGN (asm_out_file, TARGET_64BIT ? 3 : 2);\n+\t  toc_initialized = 1;\n+\t}\n+    }\n   else\n     {\n       fprintf (asm_out_file, \"%s\\n\", MINIMAL_TOC_SECTION_ASM_OP);\n       if (!toc_initialized)\n \t{\n+\t  ASM_OUTPUT_ALIGN (asm_out_file, TARGET_64BIT ? 3 : 2);\n \t  ASM_OUTPUT_INTERNAL_LABEL_PREFIX (asm_out_file, \"LCTOC1\");\n \t  fprintf (asm_out_file, \" = .+32768\\n\");\n \t  toc_initialized = 1;"}]}