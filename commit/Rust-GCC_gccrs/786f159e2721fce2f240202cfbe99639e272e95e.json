{"sha": "786f159e2721fce2f240202cfbe99639e272e95e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Nzg2ZjE1OWUyNzIxZmNlMmYyNDAyMDJjZmJlOTk2MzllMjcyZTk1ZQ==", "commit": {"author": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2006-11-25T15:05:53Z"}, "committer": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2006-11-25T15:05:53Z"}, "message": "config/i386/i386.md (fpremxf4): Rename to fpremxf4_i387.\n\n        (fprem1xf4): Rename to fprem1xf4_i387.\n\n        (fmodsf3, fmoddf3): Macroize patterns using X87MODEF12 mode macro.\n        Rename patterns to fmod<mode>3.  Use general_operand operand\n        constraint for operands 1 and 2.  Use SSE_FLOAT_MODE_P to disable\n        patterns for SSE math.\n        (remaindersf3, remainderdf3): Ditto.\n\nFrom-SVN: r119199", "tree": {"sha": "53f77974c0c818c9a17aa34f5b540845f66ba1bd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/53f77974c0c818c9a17aa34f5b540845f66ba1bd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/786f159e2721fce2f240202cfbe99639e272e95e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/786f159e2721fce2f240202cfbe99639e272e95e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/786f159e2721fce2f240202cfbe99639e272e95e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/786f159e2721fce2f240202cfbe99639e272e95e/comments", "author": null, "committer": null, "parents": [{"sha": "e47930a8dc0a96e589ac4af1d6fb61342811d4da", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e47930a8dc0a96e589ac4af1d6fb61342811d4da", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e47930a8dc0a96e589ac4af1d6fb61342811d4da"}], "stats": {"total": 140, "additions": 52, "deletions": 88}, "files": [{"sha": "c0019d2179fdb2211e138ec4e58b11caf65e4348", "filename": "gcc/ChangeLog", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/786f159e2721fce2f240202cfbe99639e272e95e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/786f159e2721fce2f240202cfbe99639e272e95e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=786f159e2721fce2f240202cfbe99639e272e95e", "patch": "@@ -1,3 +1,14 @@\n+2006-11-25  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\tconfig/i386/i386.md (fpremxf4): Rename to fpremxf4_i387.\n+\t(fprem1xf4): Rename to fprem1xf4_i387.\n+\n+\t(fmodsf3, fmoddf3): Macroize patterns using X87MODEF12 mode macro.\n+\tRename patterns to fmod<mode>3.  Use general_operand operand\n+\tconstraint for operands 1 and 2.  Use SSE_FLOAT_MODE_P to disable\n+\tpatterns for SSE math.\n+\t(remaindersf3, remainderdf3): Ditto.\n+\n 2006-11-25  Joseph Myers  <joseph@codesourcery.com>\n \n \t* function.c (instantiate_virtual_regs_in_insn): Call force_reg\n@@ -252,7 +263,7 @@\n \t(erase_self_graph_edge): Ditto.\n \t(add_graph_edge): Removed.\n \t(get_graph_weights): Ditto.\n-\t(allocate_graph_weights): Ditto.\t(\n+\t(allocate_graph_weights): Ditto.\n \t(valid_weighted_graph_edge): Ditto\n \t(bitmap_other_than_zero_bit_set): Ditto.\n \t(int_add_graph_edge): Renamed to add_graph_edge."}, {"sha": "4caeda664d6d9289e2fefdc0e53ad19698ad180d", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 40, "deletions": 87, "changes": 127, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/786f159e2721fce2f240202cfbe99639e272e95e/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/786f159e2721fce2f240202cfbe99639e272e95e/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=786f159e2721fce2f240202cfbe99639e272e95e", "patch": "@@ -15549,7 +15549,7 @@\n    (set_attr \"mode\" \"XF\")\n    (set_attr \"athlon_decode\" \"direct\")])\n \n-(define_insn \"sqrt<mode>xf2_i387\"\n+(define_insn \"sqrt_extend<mode>xf2_i387\"\n   [(set (match_operand:XF 0 \"register_operand\" \"=f\")\n \t(sqrt:XF\n \t  (float_extend:XF\n@@ -15582,13 +15582,13 @@\n       rtx op0 = gen_reg_rtx (XFmode);\n       rtx op1 = force_reg (<MODE>mode, operands[1]);\n \n-      emit_insn (gen_sqrt<mode>xf2_i387 (op0, op1));\n+      emit_insn (gen_sqrt_extend<mode>xf2_i387 (op0, op1));\n       emit_insn (gen_truncxf<mode>2_i387_noop_unspec (operands[0], op0));\n       DONE;\n    }\n })\n \n-(define_insn \"fpremxf4\"\n+(define_insn \"fpremxf4_i387\"\n   [(set (match_operand:XF 0 \"register_operand\" \"=f\")\n \t(unspec:XF [(match_operand:XF 2 \"register_operand\" \"0\")\n \t\t    (match_operand:XF 3 \"register_operand\" \"1\")]\n@@ -15603,73 +15603,49 @@\n   [(set_attr \"type\" \"fpspc\")\n    (set_attr \"mode\" \"XF\")])\n \n-(define_expand \"fmodsf3\"\n-  [(use (match_operand:SF 0 \"register_operand\" \"\"))\n-   (use (match_operand:SF 1 \"register_operand\" \"\"))\n-   (use (match_operand:SF 2 \"register_operand\" \"\"))]\n-  \"TARGET_USE_FANCY_MATH_387\n-   && (!TARGET_SSE_MATH || TARGET_MIX_SSE_I387)\"\n+(define_expand \"fmodxf3\"\n+  [(use (match_operand:XF 0 \"register_operand\" \"\"))\n+   (use (match_operand:XF 1 \"register_operand\" \"\"))\n+   (use (match_operand:XF 2 \"register_operand\" \"\"))]\n+  \"TARGET_USE_FANCY_MATH_387\"\n {\n   rtx label = gen_label_rtx ();\n \n-  rtx op1 = gen_reg_rtx (XFmode);\n-  rtx op2 = gen_reg_rtx (XFmode);\n-\n-  emit_insn(gen_extendsfxf2 (op1, operands[1]));\n-  emit_insn(gen_extendsfxf2 (op2, operands[2]));\n-\n   emit_label (label);\n \n-  emit_insn (gen_fpremxf4 (op1, op2, op1, op2));\n+  emit_insn (gen_fpremxf4_i387 (operands[1], operands[2],\n+\t\t\t\toperands[1], operands[2]));\n   ix86_emit_fp_unordered_jump (label);\n \n-  emit_insn (gen_truncxfsf2_i387_noop_unspec (operands[0], op1));\n+  emit_move_insn (operands[0], operands[1]);\n   DONE;\n })\n \n-(define_expand \"fmoddf3\"\n-  [(use (match_operand:DF 0 \"register_operand\" \"\"))\n-   (use (match_operand:DF 1 \"register_operand\" \"\"))\n-   (use (match_operand:DF 2 \"register_operand\" \"\"))]\n+(define_expand \"fmod<mode>3\"\n+  [(use (match_operand:X87MODEF12 0 \"register_operand\" \"\"))\n+   (use (match_operand:X87MODEF12 1 \"general_operand\" \"\"))\n+   (use (match_operand:X87MODEF12 2 \"general_operand\" \"\"))]\n   \"TARGET_USE_FANCY_MATH_387\n-   && (!(TARGET_SSE2 && TARGET_SSE_MATH) || TARGET_MIX_SSE_I387)\"\n+   && (!(SSE_FLOAT_MODE_P (<MODE>mode) && TARGET_SSE_MATH)\n+       || TARGET_MIX_SSE_I387)\"\n {\n   rtx label = gen_label_rtx ();\n \n   rtx op1 = gen_reg_rtx (XFmode);\n   rtx op2 = gen_reg_rtx (XFmode);\n \n-  emit_insn (gen_extenddfxf2 (op1, operands[1]));\n-  emit_insn (gen_extenddfxf2 (op2, operands[2]));\n+  emit_insn(gen_extend<mode>xf2 (op1, operands[1]));\n+  emit_insn(gen_extend<mode>xf2 (op2, operands[2]));\n \n   emit_label (label);\n-\n-  emit_insn (gen_fpremxf4 (op1, op2, op1, op2));\n+  emit_insn (gen_fpremxf4_i387 (op1, op2, op1, op2));\n   ix86_emit_fp_unordered_jump (label);\n \n-  emit_insn (gen_truncxfdf2_i387_noop_unspec (operands[0], op1));\n-  DONE;\n-})\n-\n-(define_expand \"fmodxf3\"\n-  [(use (match_operand:XF 0 \"register_operand\" \"\"))\n-   (use (match_operand:XF 1 \"register_operand\" \"\"))\n-   (use (match_operand:XF 2 \"register_operand\" \"\"))]\n-  \"TARGET_USE_FANCY_MATH_387\"\n-{\n-  rtx label = gen_label_rtx ();\n-\n-  emit_label (label);\n-\n-  emit_insn (gen_fpremxf4 (operands[1], operands[2],\n-\t\t\t   operands[1], operands[2]));\n-  ix86_emit_fp_unordered_jump (label);\n-\n-  emit_move_insn (operands[0], operands[1]);\n+  emit_insn (gen_truncxf<mode>2_i387_noop_unspec (operands[0], op1));\n   DONE;\n })\n \n-(define_insn \"fprem1xf4\"\n+(define_insn \"fprem1xf4_i387\"\n   [(set (match_operand:XF 0 \"register_operand\" \"=f\")\n \t(unspec:XF [(match_operand:XF 2 \"register_operand\" \"0\")\n \t\t    (match_operand:XF 3 \"register_operand\" \"1\")]\n@@ -15684,69 +15660,46 @@\n   [(set_attr \"type\" \"fpspc\")\n    (set_attr \"mode\" \"XF\")])\n \n-(define_expand \"remaindersf3\"\n-  [(use (match_operand:SF 0 \"register_operand\" \"\"))\n-   (use (match_operand:SF 1 \"register_operand\" \"\"))\n-   (use (match_operand:SF 2 \"register_operand\" \"\"))]\n-  \"TARGET_USE_FANCY_MATH_387\n-   && (!TARGET_SSE_MATH || TARGET_MIX_SSE_I387)\"\n+(define_expand \"remainderxf3\"\n+  [(use (match_operand:XF 0 \"register_operand\" \"\"))\n+   (use (match_operand:XF 1 \"register_operand\" \"\"))\n+   (use (match_operand:XF 2 \"register_operand\" \"\"))]\n+  \"TARGET_USE_FANCY_MATH_387\"\n {\n   rtx label = gen_label_rtx ();\n \n-  rtx op1 = gen_reg_rtx (XFmode);\n-  rtx op2 = gen_reg_rtx (XFmode);\n-\n-  emit_insn(gen_extendsfxf2 (op1, operands[1]));\n-  emit_insn(gen_extendsfxf2 (op2, operands[2]));\n-\n   emit_label (label);\n \n-  emit_insn (gen_fprem1xf4 (op1, op2, op1, op2));\n+  emit_insn (gen_fprem1xf4_i387 (operands[1], operands[2],\n+\t\t\t\t operands[1], operands[2]));\n   ix86_emit_fp_unordered_jump (label);\n \n-  emit_insn (gen_truncxfsf2_i387_noop_unspec (operands[0], op1));\n+  emit_move_insn (operands[0], operands[1]);\n   DONE;\n })\n \n-(define_expand \"remainderdf3\"\n-  [(use (match_operand:DF 0 \"register_operand\" \"\"))\n-   (use (match_operand:DF 1 \"register_operand\" \"\"))\n-   (use (match_operand:DF 2 \"register_operand\" \"\"))]\n+(define_expand \"remainder<mode>3\"\n+  [(use (match_operand:X87MODEF12 0 \"register_operand\" \"\"))\n+   (use (match_operand:X87MODEF12 1 \"general_operand\" \"\"))\n+   (use (match_operand:X87MODEF12 2 \"general_operand\" \"\"))]\n   \"TARGET_USE_FANCY_MATH_387\n-   && (!(TARGET_SSE2 && TARGET_SSE_MATH) || TARGET_MIX_SSE_I387)\"\n+   && (!(SSE_FLOAT_MODE_P (<MODE>mode) && TARGET_SSE_MATH)\n+       || TARGET_MIX_SSE_I387)\"\n {\n   rtx label = gen_label_rtx ();\n \n   rtx op1 = gen_reg_rtx (XFmode);\n   rtx op2 = gen_reg_rtx (XFmode);\n \n-  emit_insn (gen_extenddfxf2 (op1, operands[1]));\n-  emit_insn (gen_extenddfxf2 (op2, operands[2]));\n-\n-  emit_label (label);\n-\n-  emit_insn (gen_fprem1xf4 (op1, op2, op1, op2));\n-  ix86_emit_fp_unordered_jump (label);\n-\n-  emit_insn (gen_truncxfdf2_i387_noop_unspec (operands[0], op1));\n-  DONE;\n-})\n-\n-(define_expand \"remainderxf3\"\n-  [(use (match_operand:XF 0 \"register_operand\" \"\"))\n-   (use (match_operand:XF 1 \"register_operand\" \"\"))\n-   (use (match_operand:XF 2 \"register_operand\" \"\"))]\n-  \"TARGET_USE_FANCY_MATH_387\"\n-{\n-  rtx label = gen_label_rtx ();\n+  emit_insn(gen_extend<mode>xf2 (op1, operands[1]));\n+  emit_insn(gen_extend<mode>xf2 (op2, operands[2]));\n \n   emit_label (label);\n \n-  emit_insn (gen_fprem1xf4 (operands[1], operands[2],\n-\t\t\t    operands[1], operands[2]));\n+  emit_insn (gen_fprem1xf4_i387 (op1, op2, op1, op2));\n   ix86_emit_fp_unordered_jump (label);\n \n-  emit_move_insn (operands[0], operands[1]);\n+  emit_insn (gen_truncxf<mode>2_i387_noop_unspec (operands[0], op1));\n   DONE;\n })\n "}]}