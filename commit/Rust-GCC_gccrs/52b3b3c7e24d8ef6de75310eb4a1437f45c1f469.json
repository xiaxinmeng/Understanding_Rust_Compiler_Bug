{"sha": "52b3b3c7e24d8ef6de75310eb4a1437f45c1f469", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTJiM2IzYzdlMjRkOGVmNmRlNzUzMTBlYjRhMTQzN2Y0NWMxZjQ2OQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2010-09-17T00:35:22Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2010-09-17T00:35:22Z"}, "message": "lto-cgraph.c (input_overwrite_node): Do not set DECL_EXTERNAL when processing clone.\n\n\n\t* lto-cgraph.c (input_overwrite_node): Do not set DECL_EXTERNAL when\n\tprocessing clone.\n\t* lto.c (lto_materialize_function): Do not tamper with STATIC and\n\tEXTERNAL flags.\n\nFrom-SVN: r164354", "tree": {"sha": "17fda233d4a5711e6252ed92e19a57d8be8e4c8c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/17fda233d4a5711e6252ed92e19a57d8be8e4c8c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/52b3b3c7e24d8ef6de75310eb4a1437f45c1f469", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52b3b3c7e24d8ef6de75310eb4a1437f45c1f469", "html_url": "https://github.com/Rust-GCC/gccrs/commit/52b3b3c7e24d8ef6de75310eb4a1437f45c1f469", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52b3b3c7e24d8ef6de75310eb4a1437f45c1f469/comments", "author": null, "committer": null, "parents": [{"sha": "ff01e2cb4486f4bff6ae371a0bf9a80c3370c4d3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff01e2cb4486f4bff6ae371a0bf9a80c3370c4d3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff01e2cb4486f4bff6ae371a0bf9a80c3370c4d3"}], "stats": {"total": 26, "additions": 20, "deletions": 6}, "files": [{"sha": "7625ff3d14416bc19f88d60860b7a668e268ee31", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52b3b3c7e24d8ef6de75310eb4a1437f45c1f469/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52b3b3c7e24d8ef6de75310eb4a1437f45c1f469/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=52b3b3c7e24d8ef6de75310eb4a1437f45c1f469", "patch": "@@ -1,3 +1,8 @@\n+2010-09-16  Jan Hubicka  <jh@suse.cz>\n+\n+\t* lto-cgraph.c (input_overwrite_node): Do not set DECL_EXTERNAL when\n+\tprocessing clone.\n+\n 2010-09-16  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* config/i386/i386-protos.h (ix86_split_idivmod): New prototype."}, {"sha": "08607f6e4cc2bf3514f475462c5785ea6e5b0650", "filename": "gcc/lto-cgraph.c", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52b3b3c7e24d8ef6de75310eb4a1437f45c1f469/gcc%2Flto-cgraph.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52b3b3c7e24d8ef6de75310eb4a1437f45c1f469/gcc%2Flto-cgraph.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-cgraph.c?ref=52b3b3c7e24d8ef6de75310eb4a1437f45c1f469", "patch": "@@ -956,7 +956,16 @@ input_overwrite_node (struct lto_file_decl_data *file_data,\n   node->lowered = bp_unpack_value (bp, 1);\n   node->analyzed = tag == LTO_cgraph_analyzed_node;\n   node->in_other_partition = bp_unpack_value (bp, 1);\n-  if (node->in_other_partition)\n+  if (node->in_other_partition\n+      /* Avoid updating decl when we are seeing just inline clone.\n+\t When inlining function that has functions already inlined into it,\n+\t we produce clones of inline clones.\n+\n+\t WPA partitioning might put each clone into different unit and\n+\t we might end up streaming inline clone from other partition\n+\t to support clone we are interested in. */\n+      && (!node->clone_of\n+\t  || node->clone_of->decl != node->decl))\n     {\n       DECL_EXTERNAL (node->decl) = 1;\n       TREE_STATIC (node->decl) = 0;"}, {"sha": "a8f7bc13176876ae77c8b7bda836e4affc12d8a3", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52b3b3c7e24d8ef6de75310eb4a1437f45c1f469/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52b3b3c7e24d8ef6de75310eb4a1437f45c1f469/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=52b3b3c7e24d8ef6de75310eb4a1437f45c1f469", "patch": "@@ -1,3 +1,8 @@\n+2010-09-16  Jan Hubicka  <jh@suse.cz>\n+\n+\t* lto.c (lto_materialize_function): Do not tamper with STATIC and\n+\tEXTERNAL flags. \n+\n 2010-09-15  Laurynas Biveinis  <laurynas.biveinis@gmail.com>\n \n \t* lto-tree.h (struct lang_type): Add variable_size GTY option."}, {"sha": "88a3b97d2b15a3d38f0f91f348bb4c06aa50fe10", "filename": "gcc/lto/lto.c", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52b3b3c7e24d8ef6de75310eb4a1437f45c1f469/gcc%2Flto%2Flto.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52b3b3c7e24d8ef6de75310eb4a1437f45c1f469/gcc%2Flto%2Flto.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto.c?ref=52b3b3c7e24d8ef6de75310eb4a1437f45c1f469", "patch": "@@ -160,9 +160,6 @@ lto_materialize_function (struct cgraph_node *node)\n      and also functions that are needed to produce virtual clones.  */\n   if (node->analyzed || has_analyzed_clone_p (node))\n     {\n-      /* This function has a definition.  */\n-      TREE_STATIC (decl) = 1;\n-\n       /* Clones don't need to be read.  */\n       if (node->clone_of)\n \treturn;\n@@ -198,8 +195,6 @@ lto_materialize_function (struct cgraph_node *node)\n       if (!flag_wpa)\n \tggc_collect ();\n     }\n-  else\n-    DECL_EXTERNAL (decl) = 1;\n \n   /* Let the middle end know about the function.  */\n   rest_of_decl_compilation (decl, 1, 0);"}]}