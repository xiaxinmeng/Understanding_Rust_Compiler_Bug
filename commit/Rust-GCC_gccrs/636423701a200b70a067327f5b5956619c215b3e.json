{"sha": "636423701a200b70a067327f5b5956619c215b3e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjM2NDIzNzAxYTIwMGI3MGEwNjczMjdmNWI1OTU2NjE5YzIxNWIzZQ==", "commit": {"author": {"name": "Richard Sandiford", "email": "rsandifo@redhat.com", "date": "2005-04-18T20:34:36Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2005-04-18T20:34:36Z"}, "message": "mips.exp: Minor formatting.\n\n\t* gcc.target/mips/mips.exp: Minor formatting.  Call setup_mips_tests.\n\t(setup_mips_tests, dg-mips-options): New procedures.\n\t* gcc.target/mips/asm-1.c, gcc.target/mips/fix-vr4130-1.c,\n\t* gcc.target/mips/fix-vr4130-2.c, gcc.target/mips/fix-vr4130-3.c\n\t* gcc.target/mips/fix-vr4130-4.c, gcc.target/mips/mips-3d-1.c,\n\t* gcc.target/mips/mips-3d-2.c, gcc.target/mips/mips-3d-3.c,\n\t* gcc.target/mips/mips-3d-4.c, gcc.target/mips/mips-3d-5.c,\n\t* gcc.target/mips/mips-3d-6.c, gcc.target/mips/mips-3d-7.c,\n\t* gcc.target/mips/mips-3d-8.c, gcc.target/mips/mips-3d-9.c,\n\t* gcc.target/mips/mips-3d-2.c, gcc.target/mips/mips-3d-3.c,\n\t* gcc.target/mips/mips-ps-1.c, gcc.target/mips/mips-ps-2.c,\n\t* gcc.target/mips/mips-ps-3.c, gcc.target/mips/mips-ps-4.c,\n\t* gcc.target/mips/mips-ps-type.c, gcc.target/mips/sb1-1.c: Use\n\tdg-mips-options instead of dg-options.  Remove now-redundant\n\tpreprocessor guards.\n\t* gcc.dg/mips-args-1.c, gcc.dg/mips-args-2.c, gcc.dg/mips-args-3.c,\n\t* gcc.dg/mips-movcc-1.c, gcc.dg/mips-movcc-2.c, gcc.dg/mips-movcc-3.c,\n\t* gcc.dg/mips-nmadd-1.c, gcc.dg/mips-nmadd-2.c, gcc.dg/mips-rsqrt-1.c,\n\t* gcc.dg/mips-rsqrt-2.c, gcc.dg/mips-rsqrt-3.c, gcc.dg/vr-mult-1.c,\n\t* gcc.dg/vr-mult-2.c: Delete.\n\t* gcc.target/mips/args-1.c, gcc.target/mips/args-2.c,\n\t* gcc.target/mips/args-3.c, gcc.target/mips/movcc-1.c,\n\t* gcc.target/mips/movcc-2.c, gcc.target/mips/movcc-3.c,\n\t* gcc.target/mips/nmadd-1.c, gcc.target/mips/nmadd-2.c,\n\t* gcc.target/mips/rsqrt-1.c, gcc.target/mips/rsqrt-2.c,\n\t* gcc.target/mips/rsqrt-3.c, gcc.target/mips/vr-mult-1.c,\n\t* gcc.target/mips/vr-mult-2.c: New tests, based on the old gcc.dg ones.\n\nFrom-SVN: r98345", "tree": {"sha": "a8c7505358ab32b24bd189ca7b1ef1ccda80ba42", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a8c7505358ab32b24bd189ca7b1ef1ccda80ba42"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/636423701a200b70a067327f5b5956619c215b3e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/636423701a200b70a067327f5b5956619c215b3e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/636423701a200b70a067327f5b5956619c215b3e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/636423701a200b70a067327f5b5956619c215b3e/comments", "author": null, "committer": null, "parents": [{"sha": "16a5a05324570bed1c763f237963748b4e34c4ad", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16a5a05324570bed1c763f237963748b4e34c4ad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/16a5a05324570bed1c763f237963748b4e34c4ad"}], "stats": {"total": 464, "additions": 283, "deletions": 181}, "files": [{"sha": "28dfc14202846e01e26fb51a71461fcb623cd930", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,3 +1,33 @@\n+2005-04-18  Richard Sandiford  <rsandifo@redhat.com>\n+\n+\t* gcc.target/mips/mips.exp: Minor formatting.  Call setup_mips_tests.\n+\t(setup_mips_tests, dg-mips-options): New procedures.\n+\t* gcc.target/mips/asm-1.c, gcc.target/mips/fix-vr4130-1.c,\n+\t* gcc.target/mips/fix-vr4130-2.c, gcc.target/mips/fix-vr4130-3.c\n+\t* gcc.target/mips/fix-vr4130-4.c, gcc.target/mips/mips-3d-1.c,\n+\t* gcc.target/mips/mips-3d-2.c, gcc.target/mips/mips-3d-3.c,\n+\t* gcc.target/mips/mips-3d-4.c, gcc.target/mips/mips-3d-5.c,\n+\t* gcc.target/mips/mips-3d-6.c, gcc.target/mips/mips-3d-7.c,\n+\t* gcc.target/mips/mips-3d-8.c, gcc.target/mips/mips-3d-9.c,\n+\t* gcc.target/mips/mips-3d-2.c, gcc.target/mips/mips-3d-3.c,\n+\t* gcc.target/mips/mips-ps-1.c, gcc.target/mips/mips-ps-2.c,\n+\t* gcc.target/mips/mips-ps-3.c, gcc.target/mips/mips-ps-4.c,\n+\t* gcc.target/mips/mips-ps-type.c, gcc.target/mips/sb1-1.c: Use\n+\tdg-mips-options instead of dg-options.  Remove now-redundant\n+\tpreprocessor guards.\n+\t* gcc.dg/mips-args-1.c, gcc.dg/mips-args-2.c, gcc.dg/mips-args-3.c,\n+\t* gcc.dg/mips-movcc-1.c, gcc.dg/mips-movcc-2.c, gcc.dg/mips-movcc-3.c,\n+\t* gcc.dg/mips-nmadd-1.c, gcc.dg/mips-nmadd-2.c, gcc.dg/mips-rsqrt-1.c,\n+\t* gcc.dg/mips-rsqrt-2.c, gcc.dg/mips-rsqrt-3.c, gcc.dg/vr-mult-1.c,\n+\t* gcc.dg/vr-mult-2.c: Delete.\n+\t* gcc.target/mips/args-1.c, gcc.target/mips/args-2.c,\n+\t* gcc.target/mips/args-3.c, gcc.target/mips/movcc-1.c,\n+\t* gcc.target/mips/movcc-2.c, gcc.target/mips/movcc-3.c,\n+\t* gcc.target/mips/nmadd-1.c, gcc.target/mips/nmadd-2.c,\n+\t* gcc.target/mips/rsqrt-1.c, gcc.target/mips/rsqrt-2.c,\n+\t* gcc.target/mips/rsqrt-3.c, gcc.target/mips/vr-mult-1.c,\n+\t* gcc.target/mips/vr-mult-2.c: New tests, based on the old gcc.dg ones.\n+\n 2005-04-18  Laurent GUERBY  <laurent@guerby.net>\n \n \t* ada/acats/run_all.sh: Use sync when executable not present."}, {"sha": "70a7dc738b58ee5c40bd4a161da8eba15703a550", "filename": "gcc/testsuite/gcc.dg/mips-movcc-1.c", "status": "removed", "additions": 0, "deletions": 33, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16a5a05324570bed1c763f237963748b4e34c4ad/gcc%2Ftestsuite%2Fgcc.dg%2Fmips-movcc-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16a5a05324570bed1c763f237963748b4e34c4ad/gcc%2Ftestsuite%2Fgcc.dg%2Fmips-movcc-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fmips-movcc-1.c?ref=16a5a05324570bed1c763f237963748b4e34c4ad", "patch": "@@ -1,33 +0,0 @@\n-/* { dg-do compile { target \"mips*-*-*\" } } */\n-/* { dg-options \"-O2 -mips4\" } */\n-/* { dg-final { scan-assembler \"movz\" } } */\n-/* { dg-final { scan-assembler \"movn\" } } */\n-/* { dg-final { scan-assembler \"movt\" } } */\n-\n-void ext_int (int);\n-\n-#if __mips < 4\n-asm (\"# movz movn\");\n-#else\n-int\n-sub1 (int i, int j, int k)\n-{\n-  ext_int (k ? i : j);\n-}\n-\n-int\n-sub2 (int i, int j, long l)\n-{\n-  ext_int (!l ? i : j);\n-}\n-#endif\n-\n-#if __mips < 4 || __mips_soft_float\n-asm (\"# movt\");\n-#else\n-int\n-sub3 (int i, int j, float f)\n-{\n-  ext_int (f ? i : j);\n-}\n-#endif"}, {"sha": "22d58e94a1ea71cf60478570edd5067eefa2dd32", "filename": "gcc/testsuite/gcc.dg/mips-movcc-2.c", "status": "removed", "additions": 0, "deletions": 33, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16a5a05324570bed1c763f237963748b4e34c4ad/gcc%2Ftestsuite%2Fgcc.dg%2Fmips-movcc-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16a5a05324570bed1c763f237963748b4e34c4ad/gcc%2Ftestsuite%2Fgcc.dg%2Fmips-movcc-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fmips-movcc-2.c?ref=16a5a05324570bed1c763f237963748b4e34c4ad", "patch": "@@ -1,33 +0,0 @@\n-/* { dg-do compile { target \"mips*-*-*\" } } */\n-/* { dg-options \"-O2 -mips4\" } */\n-/* { dg-final { scan-assembler \"movz\" } } */\n-/* { dg-final { scan-assembler \"movn\" } } */\n-/* { dg-final { scan-assembler \"movf\" } } */\n-\n-void ext_long (long);\n-\n-#if __mips < 4\n-asm (\"# movz movn\");\n-#else\n-long\n-sub4 (long i, long j, long k)\n-{\n-  ext_long (k ? i : j);\n-}\n-\n-long\n-sub5 (long i, long j, int k)\n-{\n-  ext_long (!k ? i : j);\n-}\n-#endif\n-\n-#if __mips < 4 || __mips_soft_float\n-asm (\"# movf\");\n-#else\n-long\n-sub6 (long i, long j, float f)\n-{\n-  ext_long (!f ? i : j);\n-}\n-#endif"}, {"sha": "a208067fb7dbda8f581055c1a5ef1611185f4204", "filename": "gcc/testsuite/gcc.dg/vr-mult-1.c", "status": "removed", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16a5a05324570bed1c763f237963748b4e34c4ad/gcc%2Ftestsuite%2Fgcc.dg%2Fvr-mult-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16a5a05324570bed1c763f237963748b4e34c4ad/gcc%2Ftestsuite%2Fgcc.dg%2Fvr-mult-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvr-mult-1.c?ref=16a5a05324570bed1c763f237963748b4e34c4ad", "patch": "@@ -1,10 +0,0 @@\n-/* Make sure that mul/addu is preferred over mtlo/macc on targets that\n-   support both.  */\n-/* { dg-do compile { target mips*-*-* } } */\n-/* { dg-options \"-O2\" } */\n-#if defined (_MIPS_ARCH_VR5400) || defined (_MIPS_ARCH_VR5500)\n-int f (int a, int b, int c) { return a + b * c; }\n-#else\n-void f () { asm volatile (\"mul/addu\"); }\n-#endif\n-/* { dg-final { scan-assembler \"mul.*addu\" } } */"}, {"sha": "4a3ad98cc2a91348dfe6b62d75ab0ddee9fe9f2d", "filename": "gcc/testsuite/gcc.dg/vr-mult-2.c", "status": "removed", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16a5a05324570bed1c763f237963748b4e34c4ad/gcc%2Ftestsuite%2Fgcc.dg%2Fvr-mult-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16a5a05324570bed1c763f237963748b4e34c4ad/gcc%2Ftestsuite%2Fgcc.dg%2Fvr-mult-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvr-mult-2.c?ref=16a5a05324570bed1c763f237963748b4e34c4ad", "patch": "@@ -1,10 +0,0 @@\n-/* Make sure that mul/subu is preferred over mtlo/msac on targets that\n-   support both.  */\n-/* { dg-do compile { target mips*-*-* } } */\n-/* { dg-options \"-O2\" } */\n-#if defined (_MIPS_ARCH_VR5400) || defined (_MIPS_ARCH_VR5500)\n-int f (int a, int b, int c) { return a - b * c; }\n-#else\n-void f () { asm volatile (\"mul/subu\"); }\n-#endif\n-/* { dg-final { scan-assembler \"mul.*subu\" } } */"}, {"sha": "56def9488a347c083a706b0fd06e1b68ae665ac1", "filename": "gcc/testsuite/gcc.target/mips/args-1.c", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fargs-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fargs-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fargs-1.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,6 +1,6 @@\n /* Check that certain preprocessor macros are defined, and do some\n    consistency checks.  */\n-/* { dg-do compile { target mips*-*-* } } */\n+/* { dg-do compile } */\n \n const char *compiled_for = _MIPS_ARCH;\n const char *optimized_for = _MIPS_TUNE;", "previous_filename": "gcc/testsuite/gcc.dg/mips-args-1.c"}, {"sha": "192756525f8b4578709e261f43aa3e8db4d154fa", "filename": "gcc/testsuite/gcc.target/mips/args-2.c", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fargs-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fargs-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fargs-2.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,5 +1,5 @@\n /* Check the _MIPSEB and _MIPSEL macros are accurate.  */\n-/* { dg-do run { target mips*-*-* } } */\n+/* { dg-do run } */\n extern void abort (void);\n extern void exit (int);\n ", "previous_filename": "gcc/testsuite/gcc.dg/mips-args-2.c"}, {"sha": "e91816f08066e1fccfc5276d2a98a56c7ba3dd3d", "filename": "gcc/testsuite/gcc.target/mips/args-3.c", "status": "renamed", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fargs-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fargs-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fargs-3.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,6 +1,6 @@\n /* __mips, and related defines, guarantee that certain assembly\n    instructions can be used.  Check a few examples.  */\n-/* { dg-do run { target mips*-*-* } } */\n+/* { dg-do run } */\n extern void abort (void);\n extern void exit (int);\n ", "previous_filename": "gcc/testsuite/gcc.dg/mips-args-3.c"}, {"sha": "aed5b8cb285cee4808f489e2db2ff41009e98e44", "filename": "gcc/testsuite/gcc.target/mips/asm-1.c", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fasm-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fasm-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fasm-1.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,8 +1,7 @@\n /* PR target/17565.  GCC used to put the asm into the delay slot\n    of the call.  */\n /* { dg-do assemble } */\n-/* { dg-options \"-O\" } */\n-#ifndef __mips16\n+/* { dg-mips-options \"-O -mno-mips16\" } */\n int foo (int n)\n {\n   register int k asm (\"$16\") = n;\n@@ -13,4 +12,3 @@ int foo (int n)\n     }\n   return k;\n }\n-#endif"}, {"sha": "1ddf547f702902c8cc00701e03d934ca3b1c5a04", "filename": "gcc/testsuite/gcc.target/mips/fix-vr4130-1.c", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffix-vr4130-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffix-vr4130-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffix-vr4130-1.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,9 +1,4 @@\n-/* { dg-do compile { target mips*-*-* } } */\n-/* { dg-skip-if \"\" { mips-sgi-irix* } { \"-mabi=32\" } { \"\" } } */\n-/* { dg-options \"-mfix-vr4130 -march=vr4130\" } */\n-#if _MIPS_ARCH_VR4130 && !__mips16\n+/* { dg-do compile } */\n+/* { dg-mips-options \"-march=vr4130 -mfix-vr4130\" } */\n int foo (void) { int r; asm (\"# foo\" : \"=h\" (r)); return r; }\n-#else\n-asm (\"#\\tmacchi\\t\");\n-#endif\n /* { dg-final { scan-assembler \"\\tmacchi\\t\" } } */"}, {"sha": "633eae691e667f20f4aae4766224310095ddbf36", "filename": "gcc/testsuite/gcc.target/mips/fix-vr4130-2.c", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffix-vr4130-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffix-vr4130-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffix-vr4130-2.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,9 +1,4 @@\n-/* { dg-do compile { target mips*-*-* } } */\n-/* { dg-skip-if \"\" { mips-sgi-irix* } { \"-mabi=32\" } { \"\" } } */\n-/* { dg-options \"-mfix-vr4130 -march=vr4130\" } */\n-#if _MIPS_ARCH_VR4130 && !__mips16\n+/* { dg-do compile } */\n+/* { dg-mips-options \"-march=vr4130 -mfix-vr4130\" } */\n int foo (void) { int r; asm (\"# foo\" : \"=l\" (r)); return r; }\n-#else\n-asm (\"#\\tmacc\\t\");\n-#endif\n /* { dg-final { scan-assembler \"\\tmacc\\t\" } } */"}, {"sha": "58f07b576bb1cbf01925dbed00e4af52afea9555", "filename": "gcc/testsuite/gcc.target/mips/fix-vr4130-3.c", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffix-vr4130-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffix-vr4130-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffix-vr4130-3.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,9 +1,4 @@\n-/* { dg-do compile { target mips*-*-* } } */\n-/* { dg-skip-if \"\" { mips-sgi-irix* } { \"-mabi=32\" } { \"\" } } */\n-/* { dg-options \"-mfix-vr4130 -march=vr4130\" } */\n-#if _MIPS_ARCH_VR4130 && !__mips16 && __mips64\n+/* { dg-do compile } */\n+/* { dg-mips-options \"-march=vr4130 -mgp64 -mfix-vr4130\" } */\n long long foo (void) { long long r; asm (\"# foo\" : \"=h\" (r)); return r; }\n-#else\n-asm (\"#\\tdmacchi\\t\");\n-#endif\n /* { dg-final { scan-assembler \"\\tdmacchi\\t\" } } */"}, {"sha": "64752a8dcfe804649808eff0a5a484a5a1878c8e", "filename": "gcc/testsuite/gcc.target/mips/fix-vr4130-4.c", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffix-vr4130-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffix-vr4130-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Ffix-vr4130-4.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,9 +1,4 @@\n-/* { dg-do compile { target mips*-*-* } } */\n-/* { dg-skip-if \"\" { mips-sgi-irix* } { \"-mabi=32\" } { \"\" } } */\n-/* { dg-options \"-mfix-vr4130 -march=vr4130\" } */\n-#if _MIPS_ARCH_VR4130 && !__mips16 && __mips64\n+/* { dg-do compile } */\n+/* { dg-mips-options \"-march=vr4130 -mgp64 -mfix-vr4130\" } */\n long long foo (void) { long long r; asm (\"# foo\" : \"=l\" (r)); return r; }\n-#else\n-asm (\"#\\tdmacc\\t\");\n-#endif\n /* { dg-final { scan-assembler \"\\tdmacc\\t\" } } */"}, {"sha": "765bc49108491093a1ab985238f9f4b04110be14", "filename": "gcc/testsuite/gcc.target/mips/mips-3d-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-1.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run { target mipsisa64*-*-* } } */\n-/* { dg-options \"-mips64 -O2 -mips3d -mhard-float -mfp64\" } */\n+/* { dg-mips-options \"-mips64 -O2 -mips3d -mhard-float -mgp64\" } */\n \n /* Test MIPS-3D builtin functions */\n #include <stdlib.h>"}, {"sha": "fc70fa2de073fad9eab4743e4fec7410775487f6", "filename": "gcc/testsuite/gcc.target/mips/mips-3d-2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-2.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run { target mipsisa64*-*-* } } */\n-/* { dg-options \"-mips64 -O2 -mips3d -mhard-float -mfp64\" } */\n+/* { dg-mips-options \"-mips64 -O2 -mips3d -mhard-float -mgp64\" } */\n \n /* Test MIPS-3D branch-if-any-two builtin functions */\n #include <stdlib.h>"}, {"sha": "81d6c25f93c20ac30a87366a745fa6cb419d444c", "filename": "gcc/testsuite/gcc.target/mips/mips-3d-3.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-3.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run { target mipsisa64*-*-* } } */\n-/* { dg-options \"-mips64 -O2 -mips3d -mhard-float -mfp64\" } */\n+/* { dg-mips-options \"-mips64 -O2 -mips3d -mhard-float -mgp64\" } */\n \n /* Test MIPS-3D absolute compare builtin functions */\n #include <stdlib.h>"}, {"sha": "b2b6bfe14d52817db57cc3007a84d1747a9ed702", "filename": "gcc/testsuite/gcc.target/mips/mips-3d-4.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-4.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run { target mipsisa64*-*-* } } */\n-/* { dg-options \"-mips64 -O2 -mips3d -mhard-float -mfp64\" } */\n+/* { dg-mips-options \"-mips64 -O2 -mips3d -mhard-float -mgp64\" } */\n \n /* Test MIPS-3D branch-if-any-four builtin functions */\n #include <stdlib.h>"}, {"sha": "7dc6d28e0eae67ec049c8d78531cbe28c8a17359", "filename": "gcc/testsuite/gcc.target/mips/mips-3d-5.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-5.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run { target mipsisa64*-*-* } } */\n-/* { dg-options \"-mips64 -O2 -mips3d -mhard-float -mfp64\" } */\n+/* { dg-mips-options \"-mips64 -O2 -mips3d -mhard-float -mgp64\" } */\n \n /* Test MIPS-3D absolute-compare & branch-if-any-four builtin functions */\n #include <stdlib.h>"}, {"sha": "5a7622dd0e896a241c4d73a8109ad75943a52073", "filename": "gcc/testsuite/gcc.target/mips/mips-3d-6.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-6.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run { target mipsisa64*-*-* } } */\n-/* { dg-options \"-mips64 -O2 -mips3d -mhard-float -mfp64\" } */\n+/* { dg-mips-options \"-mips64 -O2 -mips3d -mhard-float -mgp64\" } */\n \n /* Test MIPS-3D absolute compare (floats) builtin functions */\n #include <stdlib.h>"}, {"sha": "3a512f4a1136a1b486bc868ac36d77d7068135d9", "filename": "gcc/testsuite/gcc.target/mips/mips-3d-7.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-7.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-7.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-7.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run { target mipsisa64*-*-* } } */\n-/* { dg-options \"-mips64 -O2 -mips3d -mhard-float -mfp64\" } */\n+/* { dg-mips-options \"-mips64 -O2 -mips3d -mhard-float -mgp64\" } */\n \n /* Test MIPS-3D absolute compare (doubles) builtin functions */\n #include <stdlib.h>"}, {"sha": "601e5ff30a4820997020f13a85e6c5168d17e841", "filename": "gcc/testsuite/gcc.target/mips/mips-3d-8.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-8.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run { target mipsisa64*-*-* } } */\n-/* { dg-options \"-mips64 -O2 -mips3d -mhard-float -mfp64\" } */\n+/* { dg-mips-options \"-mips64 -O2 -mips3d -mhard-float -mgp64\" } */\n \n /* Test MIPS-3D absolute compare and conditional move builtin functions */\n #include <stdlib.h>"}, {"sha": "11d863f352d4d68c3907ae21062db88339d9c5b6", "filename": "gcc/testsuite/gcc.target/mips/mips-3d-9.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-9.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-9.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-3d-9.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run { target mipsisa64*-*-* } } */\n-/* { dg-options \"-mips64 -O2 -mips3d -mhard-float -mfp64\" } */\n+/* { dg-mips-options \"-mips64 -O2 -mips3d -mhard-float -mgp64\" } */\n \n /* Matrix Multiplications */\n #include <stdlib.h>"}, {"sha": "1723933839f6d0d51f84d745c8e958b7c1482678", "filename": "gcc/testsuite/gcc.target/mips/mips-ps-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-ps-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-ps-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-ps-1.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run { target mipsisa64*-*-* } } */\n-/* { dg-options \"-mips64 -O2 -mpaired-single -mhard-float -mfp64\" } */\n+/* { dg-mips-options \"-mips64 -O2 -mpaired-single -mhard-float -mgp64\" } */\n \n /* Test v2sf calculations */\n #include <stdlib.h>"}, {"sha": "178bb910d8c40921764edf891135af875f70c9e3", "filename": "gcc/testsuite/gcc.target/mips/mips-ps-2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-ps-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-ps-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-ps-2.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run { target mipsisa64*-*-* } } */\n-/* { dg-options \"-mips64 -O2 -mpaired-single -mhard-float -mfp64\" } */\n+/* { dg-mips-options \"-mips64 -O2 -mpaired-single -mhard-float -mgp64\" } */\n \n /* Test MIPS paired-single builtin functions */\n #include <stdlib.h>"}, {"sha": "8d29cc9b6be9805be5930f63a3a73382ec4e4bd1", "filename": "gcc/testsuite/gcc.target/mips/mips-ps-3.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-ps-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-ps-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-ps-3.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run { target mipsisa64*-*-* } } */\n-/* { dg-options \"-mips64 -O2 -mpaired-single -mhard-float -mfp64\" } */\n+/* { dg-mips-options \"-mips64 -O2 -mpaired-single -mhard-float -mgp64\" } */\n \n /* Test MIPS paired-single conditional move */\n #include <stdlib.h>"}, {"sha": "41c39dcaa22836c9abb1a5236842565187a92a99", "filename": "gcc/testsuite/gcc.target/mips/mips-ps-4.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-ps-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-ps-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-ps-4.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run { target mipsisa64*-*-* } } */\n-/* { dg-options \"-mips64 -O2 -mpaired-single -mhard-float -mfp64\" } */\n+/* { dg-mips-options \"-mips64 -O2 -mpaired-single -mhard-float -mgp64\" } */\n \n /* Test MIPS paired-single comparisons */\n #include <stdlib.h>"}, {"sha": "cd5566fcbfa3e378999473e8900cf762eb877f81", "filename": "gcc/testsuite/gcc.target/mips/mips-ps-type.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-ps-type.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-ps-type.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-ps-type.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,6 +1,6 @@\n /* Test v2sf calculations */\n-/* { dg-do compile { target mipsisa64*-*-* } } */ \n-/* { dg-options \"-mips64 -O2 -mpaired-single -mhard-float -mfp64\" } */ \n+/* { dg-do compile } */ \n+/* { dg-mips-options \"-mips64 -O2 -mpaired-single -mhard-float -mgp64\" } */\n /* { dg-final { scan-assembler \"cvt.ps.s\" } } */ \n /* { dg-final { scan-assembler \"mov.ps\" } } */ \n /* { dg-final { scan-assembler \"ldc1\" } } */ "}, {"sha": "4600cab0eb67e748ba68e65c2d869314d08fa54f", "filename": "gcc/testsuite/gcc.target/mips/mips.exp", "status": "modified", "additions": 146, "deletions": 11, "changes": 157, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips.exp?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -17,25 +17,160 @@\n # GCC testsuite that uses the `dg.exp' driver.\n \n # Exit immediately if this isn't a MIPS target.\n-if ![istarget mips*-*-*] then {\n+if ![istarget mips*-*-*] {\n   return\n }\n \n # Load support procs.\n load_lib gcc-dg.exp\n \n-# If a testcase doesn't have special options, use these.\n-global DEFAULT_CFLAGS\n-if ![info exists DEFAULT_CFLAGS] then {\n-    set DEFAULT_CFLAGS \" -ansi -pedantic-errors\"\n+# Find out which target is selected by the default compiler flags.\n+# Also remember which aspects of the target are forced on the command\n+# line (as opposed to being overridable defaults).\n+#\n+#    $mips_isa:\t\t the ISA level specified by __mips\n+#    $mips_arch:\t the architecture specified by _MIPS_ARCH\n+#    $mips_mips16:\t true if MIPS16 mode is selected\n+#    $mips_mips64:\t true if 64-bit output is selected\n+#    $mips_float:\t \"hard\" or \"soft\"\n+#\n+#    $mips_forced_isa:\t true if the command line uses -march=* or -mips*\n+#    $mips_forced_abi:\t true if the command line uses -mabi=* or -mgp*\n+#    $mips_forced_float: true if the command line uses -mhard/soft-float\n+proc setup_mips_tests {} {\n+    global mips_isa\n+    global mips_arch\n+    global mips_mips16\n+    global mips_mips64\n+    global mips_float\n+\n+    global mips_forced_isa\n+    global mips_forced_abi\n+    global mips_forced_float\n+\n+    global compiler_flags\n+    global tool\n+\n+    set src dummy[pid].c\n+    set f [open $src \"w\"]\n+    puts $f {\n+\tint isa = __mips;\n+\tconst char *arch = _MIPS_ARCH;\n+\t#ifdef __mips16\n+\tint mips16 = 1;\n+\t#endif\n+\t#ifdef __mips64\n+\tint mips64 = 1;\n+\t#endif\n+\t#ifdef __mips_hard_float\n+\tconst char *float = \"hard\";\n+\t#else\n+\tconst char *float = \"soft\";\n+\t#endif\n+    }\n+    close $f\n+    set output [${tool}_target_compile $src \"\" preprocess \"\"]\n+    file delete $src\n+\n+    regexp {isa = ([^;]*)} $output dummy mips_isa\n+    regexp {arch = \"([^\"]*)} $output dummy mips_arch\n+    set mips_mips16 [regexp {mips16 = 1} $output]\n+    set mips_mips64 [regexp {mips64 = 1} $output]\n+    regexp {float = \"([^\"]*)} $output dummy mips_float\n+\n+    set mips_forced_isa [regexp -- {(-mips|-march)} $compiler_flags]\n+    set mips_forced_abi [regexp -- {(-mgp|-mabi)} $compiler_flags]\n+    set mips_forced_float [regexp -- {-m(hard|soft)-float} $compiler_flags]\n }\n \n-# Initialize `dg'.\n-dg-init\n+# Like dg-options, but treats certain MIPS-specific options specially:\n+#\n+#    -mgp32\n+#\tForce 32-bit code.  Skip the test if the multilib flags force\n+#\ta 64-bit ABI.\n+#\n+#    -mgp64\n+#\tForce 64-bit code.  Also force a 64-bit target architecture\n+#\tif the other flags don't do so.  Skip the test if the multilib\n+#\tflags force a 32-bit ABI or a 32-bit architecture.\n+#\n+#    -mno-mips16\n+#\tSkip the test for MIPS16 targets.\n+#\n+#    -march=*\n+#    -mips*\n+#\tSelect the target architecture.  Skip the test for MIPS16 targets\n+#\tor if the multilib flags force a different architecture.\n+#\n+#    -msoft-float\n+#    -mhard-float\n+#\tSelect the given floating-point mode.  Skip the test if the\n+#\tmultilib flags force a different selection.\n+proc dg-mips-options {args} {\n+    upvar dg-extra-tool-flags extra_tool_flags\n+    upvar dg-do-what do_what\n \n-# Main loop.\n-dg-runtest [lsort [glob -nocomplain $srcdir/$subdir/*.\\[cS\\]]] \\\n-\t\"\" $DEFAULT_CFLAGS\n+    global mips_isa\n+    global mips_arch\n+    global mips_mips16\n+    global mips_mips64\n+    global mips_float\n \n-# All done.\n+    global mips_forced_isa\n+    global mips_forced_abi\n+    global mips_forced_float\n+\n+    set flags [lindex $args 1]\n+    set matches 1\n+\n+    # First handle the -mgp* options.  Add an architecture option if necessary.\n+    foreach flag $flags {\n+\tif {$flag == \"-mgp32\" && $mips_mips64} {\n+\t    if {$mips_forced_abi} {\n+\t\tset matches 0\n+\t    } else {\n+\t\tappend flags \" -mabi=32\"\n+\t    }\n+\t} elseif {$flag == \"-mgp64\" && !$mips_mips64} {\n+\t    if {$mips_forced_abi} {\n+\t\tset matches 0\n+\t    } else {\n+\t\tappend flags \" -mabi=o64\"\n+\t\tif {[lsearch -regexp $flags {^(-mips|-march)}] < 0} {\n+\t\t    append flags \" -mips3\"\n+\t\t}\n+\t    }\n+\t}\n+    }\n+    # Handle the other options.\n+    foreach flag $flags {\n+\tif {$flag == \"-mno-mips16\"} {\n+\t    if {$mips_mips16} {\n+\t\tset matches 0\n+\t    }\n+\t} elseif {[regexp -- {^-march=(.*)} $flag dummy arch]} {\n+\t    if {$mips_mips16 || ($arch != $mips_arch && $mips_forced_isa)} {\n+\t\tset matches 0\n+\t    }\n+\t} elseif {[regexp -- {^-mips(.*)} $flag dummy isa] && $isa != 16} {\n+\t    if {$mips_mips16 || ($isa != $mips_isa && $mips_forced_isa)} {\n+\t\tset matches 0\n+\t    }\n+\t} elseif {[regexp -- {^-m(hard|soft)-float} $flag dummy float]} {\n+\t    if {$mips_float != $float && $mips_forced_float} {\n+\t\tset matches 0\n+\t    }\n+\t}\n+    }\n+    if {$matches} {\n+\tset extra_tool_flags $flags\n+    } else {\n+\tset do_what [list [lindex $do_what 0] \"N\" \"P\"]\n+    }\n+}\n+\n+setup_mips_tests\n+\n+dg-init\n+dg-runtest [lsort [glob -nocomplain $srcdir/$subdir/*.c]] \"\" \"\"\n dg-finish"}, {"sha": "30a0aa7830c835cea86da51b49d5d642b78d6330", "filename": "gcc/testsuite/gcc.target/mips/movcc-1.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmovcc-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmovcc-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmovcc-1.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-do compile } */\n+/* { dg-mips-options \"-O2 -mips4\" } */\n+/* { dg-final { scan-assembler \"movz\" } } */\n+/* { dg-final { scan-assembler \"movn\" } } */\n+\n+void ext_int (int);\n+\n+int\n+sub1 (int i, int j, int k)\n+{\n+  ext_int (k ? i : j);\n+}\n+\n+int\n+sub2 (int i, int j, long l)\n+{\n+  ext_int (!l ? i : j);\n+}"}, {"sha": "57c2c507ce7bd436c4b2db1602cb25167ff4c0df", "filename": "gcc/testsuite/gcc.target/mips/movcc-2.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmovcc-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmovcc-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmovcc-2.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-do compile } */\n+/* { dg-mips-options \"-O2 -mips4\" } */\n+/* { dg-final { scan-assembler \"movz\" } } */\n+/* { dg-final { scan-assembler \"movn\" } } */\n+\n+void ext_long (long);\n+\n+long\n+sub4 (long i, long j, long k)\n+{\n+  ext_long (k ? i : j);\n+}\n+\n+long\n+sub5 (long i, long j, int k)\n+{\n+  ext_long (!k ? i : j);\n+}"}, {"sha": "ad439f9229388d5d635f1de17172cf2f1e715f11", "filename": "gcc/testsuite/gcc.target/mips/movcc-3.c", "status": "renamed", "additions": 18, "deletions": 6, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmovcc-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmovcc-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmovcc-3.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,18 +1,31 @@\n-/* { dg-do compile { target \"mips*-*-*\" } } */\n-/* { dg-options \"-O2 -mips4\" } */\n+/* { dg-do compile } */\n+/* { dg-mips-options \"-O2 -mips4 -mhard-float\" } */\n+/* { dg-final { scan-assembler \"movt\" } } */\n+/* { dg-final { scan-assembler \"movf\" } } */\n /* { dg-final { scan-assembler \"movz.s\" } } */\n /* { dg-final { scan-assembler \"movn.s\" } } */\n /* { dg-final { scan-assembler \"movt.s\" } } */\n /* { dg-final { scan-assembler \"movz.d\" } } */\n /* { dg-final { scan-assembler \"movn.d\" } } */\n /* { dg-final { scan-assembler \"movf.d\" } } */\n \n-#if __mips < 4 || __mips_soft_float\n-asm (\"# movz.s movn.s movt.s movz.d movn.d movf.d\");\n-#else\n+void ext_int (int);\n+void ext_long (long);\n void ext_float (float);\n void ext_double (double);\n \n+int\n+sub3 (int i, int j, float f)\n+{\n+  ext_int (f ? i : j);\n+}\n+\n+long\n+sub6 (long i, long j, float f)\n+{\n+  ext_long (!f ? i : j);\n+}\n+\n float\n sub7 (float f, float g, int i)\n {\n@@ -48,4 +61,3 @@ subc (double f, double g, double h)\n {\n   ext_double (!h ? f : g);\n }\n-#endif", "previous_filename": "gcc/testsuite/gcc.dg/mips-movcc-3.c"}, {"sha": "e027b07d6d7ec7688c4e92d50ccf0d864184f36b", "filename": "gcc/testsuite/gcc.target/mips/nmadd-1.c", "status": "renamed", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fnmadd-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fnmadd-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fnmadd-1.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,13 +1,10 @@\n-/* { dg-do compile { target \"mips*-*-*\" } } */\n-/* { dg-options \"-O2 -ffast-math -mips4\" } */\n+/* { dg-do compile } */\n+/* { dg-mips-options \"-O2 -ffast-math -mips4 -mhard-float\" } */\n /* { dg-final { scan-assembler \"nmadd.s\" } } */\n /* { dg-final { scan-assembler \"nmadd.d\" } } */\n /* { dg-final { scan-assembler \"nmsub.s\" } } */\n /* { dg-final { scan-assembler \"nmsub.d\" } } */\n \n-#if (__mips != 4 && __mips != 64) || __mips_soft_float\n-asm (\"# nmadd.s nmadd.d nmsub.s nmsub.d\");\n-#else\n float\n sub1 (float f, float g, float h)\n {\n@@ -31,4 +28,3 @@ sub4 (double f, double g, double h)\n {\n   return -((f * g) - h);\n }\n-#endif", "previous_filename": "gcc/testsuite/gcc.dg/mips-nmadd-1.c"}, {"sha": "522407a5119bed9053b64f4ff2c605c85b121f48", "filename": "gcc/testsuite/gcc.target/mips/nmadd-2.c", "status": "renamed", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fnmadd-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fnmadd-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fnmadd-2.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,13 +1,10 @@\n-/* { dg-do compile { target \"mips*-*-*\" } } */\n-/* { dg-options \"-O2 -fno-fast-math -mips4\" } */\n+/* { dg-do compile } */\n+/* { dg-mips-options \"-O2 -fno-fast-math -mips4 -mhard-float\" } */\n /* { dg-final { scan-assembler \"nmadd.s\" } } */\n /* { dg-final { scan-assembler \"nmadd.d\" } } */\n /* { dg-final { scan-assembler \"nmsub.s\" } } */\n /* { dg-final { scan-assembler \"nmsub.d\" } } */\n \n-#if (__mips != 4 && __mips != 64) || __mips_soft_float\n-asm (\"# nmadd.s nmadd.d nmsub.s nmsub.d\");\n-#else\n float\n sub1 (float f, float g, float h)\n {\n@@ -31,4 +28,3 @@ sub4 (double f, double g, double h)\n {\n   return -((f * g) - h);\n }\n-#endif", "previous_filename": "gcc/testsuite/gcc.dg/mips-nmadd-2.c"}, {"sha": "34e712422f4f76b885be120c30096824c1b3d080", "filename": "gcc/testsuite/gcc.target/mips/rsqrt-1.c", "status": "renamed", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Frsqrt-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Frsqrt-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Frsqrt-1.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,11 +1,8 @@\n-/* { dg-do compile { target \"mips*-*-*\" } } */\n-/* { dg-options \"-O2 -ffast-math -mips4\" } */\n+/* { dg-do compile } */\n+/* { dg-mips-options \"-O2 -ffast-math -mips4 -mhard-float\" } */\n /* { dg-final { scan-assembler \"rsqrt.d\" } } */\n /* { dg-final { scan-assembler \"rsqrt.s\" } } */\n \n-#if (__mips != 4 && __mips != 64) || __mips_soft_float\n-asm (\"# rsqrt.d rsqrt.s\");\n-#else\n extern double sqrt(double);\n extern float sqrtf(float);\n \n@@ -18,4 +15,3 @@ float bar(float x)\n {\n   return 1.0f/sqrtf(x);\n }\n-#endif", "previous_filename": "gcc/testsuite/gcc.dg/mips-rsqrt-1.c"}, {"sha": "4bc3e7f134b55ca5259d966c6e58e7290d578f94", "filename": "gcc/testsuite/gcc.target/mips/rsqrt-2.c", "status": "renamed", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Frsqrt-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Frsqrt-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Frsqrt-2.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,11 +1,8 @@\n-/* { dg-do compile { target \"mips*-*-*\" } } */\n-/* { dg-options \"-O2 -ffast-math -mips4\" } */\n+/* { dg-do compile } */\n+/* { dg-mips-options \"-O2 -ffast-math -mips4 -mhard-float\" } */\n /* { dg-final { scan-assembler \"rsqrt.d\" } } */\n /* { dg-final { scan-assembler \"rsqrt.s\" } } */\n \n-#if (__mips != 4 && __mips != 64) || __mips_soft_float\n-asm (\"# rsqrt.d rsqrt.s\");\n-#else\n extern double sqrt(double);\n extern float sqrtf(float);\n \n@@ -18,4 +15,3 @@ float bar(float x)\n {\n   return sqrtf(1.0f/x);\n }\n-#endif", "previous_filename": "gcc/testsuite/gcc.dg/mips-rsqrt-2.c"}, {"sha": "76cee835eb6d17ba6387c04c910bb419396c99fd", "filename": "gcc/testsuite/gcc.target/mips/rsqrt-3.c", "status": "renamed", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Frsqrt-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Frsqrt-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Frsqrt-3.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,5 +1,5 @@\n-/* { dg-do compile { target \"mips*-*-*\" } } */\n-/* { dg-options \"-O2 -mips4\" } */\n+/* { dg-do compile } */\n+/* { dg-mips-options \"-O2 -mips4 -mhard-float\" } */\n /* { dg-final { scan-assembler-not \"rsqrt.d\" } } */\n /* { dg-final { scan-assembler-not \"rsqrt.s\" } } */\n \n@@ -25,4 +25,3 @@ float barf(float x)\n {\n   return sqrtf(1.0f/x);\n }\n-", "previous_filename": "gcc/testsuite/gcc.dg/mips-rsqrt-3.c"}, {"sha": "c9de3a8dbbb31dea9debcee3a05ce48809d18788", "filename": "gcc/testsuite/gcc.target/mips/sb1-1.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fsb1-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fsb1-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fsb1-1.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -1,6 +1,6 @@\n /* Test SB-1 v2sf extensions.  */\n-/* { dg-do compile { target mipsisa64*-*-* } } */ \n-/* { dg-options \"-march=sb1 -O2 -mpaired-single -mhard-float -mfp64 -ffast-math\" } */ \n+/* { dg-do compile } */ \n+/* { dg-mips-options \"-march=sb1 -O2 -mpaired-single -mhard-float -mgp64 -ffast-math\" } */ \n /* { dg-final { scan-assembler \"div.ps\" } } */ \n /* { dg-final { scan-assembler \"recip.ps\" } } */ \n /* { dg-final { scan-assembler \"sqrt.ps\" } } */ "}, {"sha": "47d639131b9f41b02a8132a9391f0f2e4ad1f09d", "filename": "gcc/testsuite/gcc.target/mips/vr-mult-1.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fvr-mult-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fvr-mult-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fvr-mult-1.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -0,0 +1,7 @@\n+/* Make sure that mul/addu is preferred over mtlo/macc and that mul/subu\n+   is preferred over mtlo/msac.  */\n+/* { dg-do compile } */\n+/* { dg-mips-options \"-O2 -march=vr5400\" } */\n+int f1 (int a, int b, int c) { return a + b * c; }\n+int f2 (int a, int b, int c) { return a - b * c; }\n+/* { dg-final { scan-assembler \"\\tmul\\t.*\\tmul\\t\" } } */"}, {"sha": "9112ed08c829acff9fccefd2a4d16882ffe5be8e", "filename": "gcc/testsuite/gcc.target/mips/vr-mult-2.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fvr-mult-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/636423701a200b70a067327f5b5956619c215b3e/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fvr-mult-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fvr-mult-2.c?ref=636423701a200b70a067327f5b5956619c215b3e", "patch": "@@ -0,0 +1,7 @@\n+/* Make sure that mul/addu is preferred over mtlo/macc and that mul/subu\n+   is preferred over mtlo/msac.  */\n+/* { dg-do compile } */\n+/* { dg-mips-options \"-O2 -march=vr5500\" } */\n+int f1 (int a, int b, int c) { return a + b * c; }\n+int f2 (int a, int b, int c) { return a - b * c; }\n+/* { dg-final { scan-assembler \"\\tmul\\t.*\\tmul\\t\" } } */"}]}