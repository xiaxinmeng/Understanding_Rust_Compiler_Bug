{"sha": "e12d3780e6808121365854a9780abac5ba6a5123", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTEyZDM3ODBlNjgwODEyMTM2NTg1NGE5NzgwYWJhYzViYTZhNTEyMw==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2017-07-15T15:43:22Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2017-07-15T15:43:22Z"}, "message": "Reorder std::scoped_lock parameters as per P0739R0 DR status\n\n\t* include/std/mutex (scoped_lock): Reorder std::adopt_lock_t parameter\n\tas per P0739R0.\n\t* testsuite/30_threads/scoped_lock/cons/1.cc: Reorder arguments.\n\t* testsuite/30_threads/scoped_lock/cons/deduction.cc: Test deduction\n\twith std::adopt_lock_t.\n\t* testsuite/30_threads/scoped_lock/requirements/typedefs.cc: Check\n\tfeature-test macro.\n\nFrom-SVN: r250223", "tree": {"sha": "118995031e5d229cc82ec92cf9bc24874861d98d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/118995031e5d229cc82ec92cf9bc24874861d98d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e12d3780e6808121365854a9780abac5ba6a5123", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e12d3780e6808121365854a9780abac5ba6a5123", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e12d3780e6808121365854a9780abac5ba6a5123", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e12d3780e6808121365854a9780abac5ba6a5123/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c2fc34620e4635694f649792e2ae9fc182eb93e7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c2fc34620e4635694f649792e2ae9fc182eb93e7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c2fc34620e4635694f649792e2ae9fc182eb93e7"}], "stats": {"total": 51, "additions": 46, "deletions": 5}, "files": [{"sha": "87b2f63d0ab9ae5cb67ada11d4b4ebfbdd0ba2ec", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e12d3780e6808121365854a9780abac5ba6a5123/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e12d3780e6808121365854a9780abac5ba6a5123/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=e12d3780e6808121365854a9780abac5ba6a5123", "patch": "@@ -1,3 +1,13 @@\n+2017-07-15  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\t* include/std/mutex (scoped_lock): Reorder std::adopt_lock_t parameter\n+\tas per P0739R0.\n+\t* testsuite/30_threads/scoped_lock/cons/1.cc: Reorder arguments.\n+\t* testsuite/30_threads/scoped_lock/cons/deduction.cc: Test deduction\n+\twith std::adopt_lock_t.\n+\t* testsuite/30_threads/scoped_lock/requirements/typedefs.cc: Check\n+\tfeature-test macro.\n+\n 2017-07-14  Jason Merrill  <jason@redhat.com>\n \t    Jonathan Wakely  <jwakely@redhat.com>\n "}, {"sha": "fadb9f60481ac19f9c5702695d3cedf9818ad1d6", "filename": "libstdc++-v3/include/std/mutex", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e12d3780e6808121365854a9780abac5ba6a5123/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fmutex", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e12d3780e6808121365854a9780abac5ba6a5123/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fmutex", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fmutex?ref=e12d3780e6808121365854a9780abac5ba6a5123", "patch": "@@ -557,7 +557,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n     }\n \n #if __cplusplus > 201402L\n-#define __cpp_lib_scoped_lock 201703\n+#define __cpp_lib_scoped_lock 201707\n   /** @brief A scoped lock type for multiple lockable objects.\n    *\n    * A scoped_lock controls mutex ownership within a scope, releasing\n@@ -570,7 +570,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       explicit scoped_lock(_MutexTypes&... __m) : _M_devices(std::tie(__m...))\n       { std::lock(__m...); }\n \n-      explicit scoped_lock(_MutexTypes&... __m, adopt_lock_t) noexcept\n+      explicit scoped_lock(adopt_lock_t, _MutexTypes&... __m) noexcept\n       : _M_devices(std::tie(__m...))\n       { } // calling thread owns mutex\n \n@@ -609,7 +609,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       explicit scoped_lock(mutex_type& __m) : _M_device(__m)\n       { _M_device.lock(); }\n \n-      explicit scoped_lock(mutex_type& __m, adopt_lock_t) noexcept\n+      explicit scoped_lock(adopt_lock_t, mutex_type& __m) noexcept\n       : _M_device(__m)\n       { } // calling thread owns mutex\n "}, {"sha": "e420ab083789f0955680230da778450a15afd0d0", "filename": "libstdc++-v3/testsuite/30_threads/scoped_lock/cons/1.cc", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e12d3780e6808121365854a9780abac5ba6a5123/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fscoped_lock%2Fcons%2F1.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e12d3780e6808121365854a9780abac5ba6a5123/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fscoped_lock%2Fcons%2F1.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fscoped_lock%2Fcons%2F1.cc?ref=e12d3780e6808121365854a9780abac5ba6a5123", "patch": "@@ -79,7 +79,7 @@ void test01()\n \n   try\n     {\n-      std::scoped_lock<BasicLockable> l(m, std::adopt_lock);\n+      std::scoped_lock<BasicLockable> l(std::adopt_lock, m);\n     }\n   catch (...)\n     {\n@@ -113,7 +113,7 @@ void test02()\n \n   try\n     {\n-      std::scoped_lock<Lockable<1>, Lockable<2>> l(m1, m2, std::adopt_lock);\n+      std::scoped_lock<Lockable<1>, Lockable<2>> l(std::adopt_lock, m1, m2);\n       VERIFY( m1.m.locked );\n       VERIFY( m2.m.locked );\n     }"}, {"sha": "7d4f5bfc3865a38a75fe3008be40f37e4e89bc2d", "filename": "libstdc++-v3/testsuite/30_threads/scoped_lock/cons/deduction.cc", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e12d3780e6808121365854a9780abac5ba6a5123/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fscoped_lock%2Fcons%2Fdeduction.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e12d3780e6808121365854a9780abac5ba6a5123/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fscoped_lock%2Fcons%2Fdeduction.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fscoped_lock%2Fcons%2Fdeduction.cc?ref=e12d3780e6808121365854a9780abac5ba6a5123", "patch": "@@ -51,3 +51,28 @@ test01()\n   std::scoped_lock l2(m2, m3);\n   check_type<std::scoped_lock<Lockable, std::mutex>>(l2);\n }\n+\n+void\n+test02()\n+{\n+  std::scoped_lock l0(std::adopt_lock);\n+  check_type<std::scoped_lock<>>(l0);\n+\n+  struct BasicLockable {\n+    void lock() { }\n+    void unlock() { }\n+  } m1;\n+\n+  std::scoped_lock l1(std::adopt_lock, m1);\n+  check_type<std::scoped_lock<BasicLockable>>(l1);\n+\n+  struct Lockable {\n+    void lock() { }\n+    void unlock() { }\n+    bool try_lock() { return true; }\n+  } m2;\n+\n+  std::mutex m3;\n+  std::scoped_lock l2(std::adopt_lock, m2, m3);\n+  check_type<std::scoped_lock<Lockable, std::mutex>>(l2);\n+}"}, {"sha": "0a8903ebaab4683f5b62769eb01d3a93d1ac313e", "filename": "libstdc++-v3/testsuite/30_threads/scoped_lock/requirements/typedefs.cc", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e12d3780e6808121365854a9780abac5ba6a5123/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fscoped_lock%2Frequirements%2Ftypedefs.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e12d3780e6808121365854a9780abac5ba6a5123/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fscoped_lock%2Frequirements%2Ftypedefs.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F30_threads%2Fscoped_lock%2Frequirements%2Ftypedefs.cc?ref=e12d3780e6808121365854a9780abac5ba6a5123", "patch": "@@ -25,6 +25,12 @@\n \n #include <mutex>\n \n+#ifndef __cpp_lib_scoped_lock\n+# error \"Feature-test macro for scoped_lock missing\"\n+#elif __cpp_lib_scoped_lock != 201707\n+# error \"Feature-test macro for scoped_lock has wrong value\"\n+#endif\n+\n void test01()\n {\n   // Check for required typedefs"}]}