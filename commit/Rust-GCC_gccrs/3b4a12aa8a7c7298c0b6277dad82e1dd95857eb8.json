{"sha": "3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2I0YTEyYWE4YTdjNzI5OGMwYjYyNzdkYWQ4MmUxZGQ5NTg1N2ViOA==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2018-04-05T17:05:03Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2018-04-05T17:05:03Z"}, "message": "re PR c++/84792 (ICE with broken typedef of a struct)\n\n/cp\n2018-04-05  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/84792\n\t* decl.c (grokdeclarator): Fix diagnostic about typedef name used\n\tas nested-name-specifier, keep type and TREE_TYPE (decl) in sync.\n\n/testsuite\n2018-04-05  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/84792\n\t* g++.dg/other/pr84792-1.C: New.\n\t* g++.dg/other/pr84792-2.C: Likewise.\n\nFrom-SVN: r259136", "tree": {"sha": "9baede93c832fe05658a4eb44355dd4535496a77", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9baede93c832fe05658a4eb44355dd4535496a77"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8/comments", "author": null, "committer": null, "parents": [{"sha": "970d3d9011542639b420610a29bf9046fcee606c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/970d3d9011542639b420610a29bf9046fcee606c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/970d3d9011542639b420610a29bf9046fcee606c"}], "stats": {"total": 35, "additions": 30, "deletions": 5}, "files": [{"sha": "0d60ed00a7de793623896b32384f1b1948ea7b92", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8", "patch": "@@ -1,3 +1,9 @@\n+2018-04-05  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/84792\n+\t* decl.c (grokdeclarator): Fix diagnostic about typedef name used\n+\tas nested-name-specifier, keep type and TREE_TYPE (decl) in sync.\n+\n 2018-04-05  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/82152 - ICE with class deduction and inherited ctor."}, {"sha": "489dcc0a8ed9b3b12feef8971180cf406bdbc2ef", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8", "patch": "@@ -11766,15 +11766,16 @@ grokdeclarator (const cp_declarator *declarator,\n       if (reqs)\n \terror_at (location_of (reqs), \"requires-clause on typedef\");\n \n+      if (id_declarator && declarator->u.id.qualifying_scope)\n+\t{\n+\t  error (\"typedef name may not be a nested-name-specifier\");\n+\t  type = error_mark_node;\n+\t}\n+\n       if (decl_context == FIELD)\n \tdecl = build_lang_decl (TYPE_DECL, unqualified_id, type);\n       else\n \tdecl = build_decl (input_location, TYPE_DECL, unqualified_id, type);\n-      if (id_declarator && declarator->u.id.qualifying_scope) {\n-\terror_at (DECL_SOURCE_LOCATION (decl), \n-\t\t  \"typedef name may not be a nested-name-specifier\");\n-\tTREE_TYPE (decl) = error_mark_node;\n-      }\n \n       if (decl_context != FIELD)\n \t{"}, {"sha": "a94044ebc3a7cc4e2e184057618ae6e6c4bafddf", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8", "patch": "@@ -1,3 +1,9 @@\n+2018-04-05  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/84792\n+\t* g++.dg/other/pr84792-1.C: New.\n+\t* g++.dg/other/pr84792-2.C: Likewise.\n+\n 2018-04-05  Uros Bizjak  <ubizjak@gmail.com>\n \n \tPR target/85193"}, {"sha": "23df8ae18ad5f43eaee4be3aead59e572a1745e7", "filename": "gcc/testsuite/g++.dg/other/pr84792-1.C", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr84792-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr84792-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr84792-1.C?ref=3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8", "patch": "@@ -0,0 +1,6 @@\n+struct A {};\n+\n+typedef struct\n+{\n+  virtual void foo() {}\n+} A::B;  // { dg-error \"typedef\" }"}, {"sha": "a393d5771cefd089c84e4305937a82cdf6800298", "filename": "gcc/testsuite/g++.dg/other/pr84792-2.C", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr84792-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr84792-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr84792-2.C?ref=3b4a12aa8a7c7298c0b6277dad82e1dd95857eb8", "patch": "@@ -0,0 +1,6 @@\n+struct A {};\n+\n+typedef struct\n+{\n+  void foo() {}\n+} A::B;  // { dg-error \"typedef\" }"}]}