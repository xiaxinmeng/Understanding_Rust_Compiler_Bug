{"sha": "f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjBlZmQ5MjUwMmEwZWIzM2M4ZjhmOWUxZWEwM2IyNWE3MTRiMmQ3Mg==", "commit": {"author": {"name": "Joel Hutton", "email": "Joel.Hutton@arm.com", "date": "2019-07-31T08:56:35Z"}, "committer": {"name": "Kyrylo Tkachov", "email": "ktkachov@gcc.gnu.org", "date": "2019-07-31T08:56:35Z"}, "message": "[Arm][CMSE]Add warn_unused_return attribute to cmse functions\n\nAt present it is possible to call the CMSE functions for checking\naddresses (such as cmse_check_address_range) and  forget to check/use\nthe return value. This patch makes the interfaces more robust against\nprogrammer error by marking these functions with the warn_unused_result\nattribute. With this set, any use of these functions that does not use\nthe result will produce a warning.\n\nThis produces a warning on default warn levels when the result of the\ncmse functions is not used.\n\nFor the following function:\nvoid foo()\n{\n     int *data;\n     cmse_check_address_range((int*)data, 0, 0);\n}\nThe following warning is emitted:\nwarning: ignoring return value of 'cmse_check_address_range' declared\nwith attribute 'warn_unused_result' [-Wunused-result]\n     6 |  cmse_check_address_range((int*)data, 0, 0);\n        |  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\ngcc/ChangeLog:\n\n2019-07-31  Joel Hutton  <Joel.Hutton@arm.com>\n\n         * config/arm/arm_cmse.h (cmse_nonsecure_caller): Add\nwarn_unused_result attribute.\n         (cmse_check_address_range): Add warn_unused_result attribute.\n\nlibgcc/ChangeLog:\n\n2019-07-31  Joel Hutton  <Joel.Hutton@arm.com>\n\n         * config/arm/cmse.c (cmse_check_address_range): Add\nwarn_unused_result attribute.\n\n2019-07-31  Joel Hutton  <Joel.Hutton@arm.com>\n\n         * gcc.target/arm/cmse/cmse-17.c: New test.\n\nFrom-SVN: r273924", "tree": {"sha": "07a1f2d0cb396e93b11d345531d37071cc7a521b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/07a1f2d0cb396e93b11d345531d37071cc7a521b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72/comments", "author": {"login": "JoelHutton", "id": 4455754, "node_id": "MDQ6VXNlcjQ0NTU3NTQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4455754?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JoelHutton", "html_url": "https://github.com/JoelHutton", "followers_url": "https://api.github.com/users/JoelHutton/followers", "following_url": "https://api.github.com/users/JoelHutton/following{/other_user}", "gists_url": "https://api.github.com/users/JoelHutton/gists{/gist_id}", "starred_url": "https://api.github.com/users/JoelHutton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JoelHutton/subscriptions", "organizations_url": "https://api.github.com/users/JoelHutton/orgs", "repos_url": "https://api.github.com/users/JoelHutton/repos", "events_url": "https://api.github.com/users/JoelHutton/events{/privacy}", "received_events_url": "https://api.github.com/users/JoelHutton/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ce52e0ffb4f1ea7bd4fb99aea5dda75d260e438f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce52e0ffb4f1ea7bd4fb99aea5dda75d260e438f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ce52e0ffb4f1ea7bd4fb99aea5dda75d260e438f"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "af3089a8a55a116a8a3215b62baa28bdca6c2c60", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72", "patch": "@@ -1,3 +1,9 @@\n+2019-07-31  Joel Hutton  <Joel.Hutton@arm.com>\n+\n+\t* config/arm/arm_cmse.h (cmse_nonsecure_caller): Add\n+\twarn_unused_result attribute.\n+\t(cmse_check_address_range): Add warn_unused_result attribute.\n+\n 2019-07-31  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/91257"}, {"sha": "a72c46f1a954bd3ba4aefcdbb7a31085d0f583c0", "filename": "gcc/config/arm/arm_cmse.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72/gcc%2Fconfig%2Farm%2Farm_cmse.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72/gcc%2Fconfig%2Farm%2Farm_cmse.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm_cmse.h?ref=f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72", "patch": "@@ -164,6 +164,7 @@ __CMSE_TT_ASM (at)\n \n /* FIXME: diagnose use outside cmse_nonsecure_entry functions.  */\n __extension__ static __inline int __attribute__ ((__always_inline__))\n+__attribute__ ((warn_unused_result))\n cmse_nonsecure_caller (void)\n {\n   return __builtin_arm_cmse_nonsecure_caller ();\n@@ -184,6 +185,7 @@ cmse_nonsecure_caller (void)\n #define CMSE_MPU_READ\t\t8\n \n __extension__ void *\n+__attribute__ ((warn_unused_result))\n cmse_check_address_range (void *, size_t, int);\n \n #define cmse_check_pointed_object(p, f) \\"}, {"sha": "3d44853383c0a32b3d1c4e1b31dbabab6c3ad853", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72", "patch": "@@ -1,3 +1,7 @@\n+2019-07-31  Joel Hutton  <Joel.Hutton@arm.com>\n+\n+\t* gcc.target/arm/cmse/cmse-17.c: New test.\n+\n 2019-07-30  Martin Sebor  <msebor@redhat.com>\n \n \tPR testsuite/91258"}, {"sha": "a2cce09afae590461b86397e73e9b98649bed95a", "filename": "gcc/testsuite/gcc.target/arm/cmse/cmse-17.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fcmse%2Fcmse-17.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fcmse%2Fcmse-17.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fcmse%2Fcmse-17.c?ref=f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-mcmse\"}  */\n+\n+#include <arm_cmse.h>\n+\n+void foo()\n+{\n+\tint *data;\n+\tcmse_check_address_range((int*)data, 0, 0); /* { dg-warning \"ignoring return value\" } */\n+}"}, {"sha": "c9aea1dde159b00e35072fd09f9609315b17e856", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72", "patch": "@@ -1,3 +1,8 @@\n+2019-07-31  Joel Hutton  <Joel.Hutton@arm.com>\n+\n+\t* config/arm/cmse.c (cmse_check_address_range): Add\n+\twarn_unused_result attribute.\n+\n 2019-07-22  Martin Liska  <mliska@suse.cz>\n \n \t* config/pa/stublib.c: Remove stub symbol __gnu_lto_v1."}, {"sha": "0c5a3eaefab49ae07e67b82481fdd0d8dd100227", "filename": "libgcc/config/arm/cmse.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72/libgcc%2Fconfig%2Farm%2Fcmse.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72/libgcc%2Fconfig%2Farm%2Fcmse.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Farm%2Fcmse.c?ref=f0efd92502a0eb33c8f8f9e1ea03b25a714b2d72", "patch": "@@ -30,6 +30,7 @@\n    address range.  See ACLE changes for ARMv8-M.  */\n \n void *\n+__attribute__ ((warn_unused_result))\n cmse_check_address_range (void *p, size_t size, int flags)\n {\n   cmse_address_info_t permb, perme;"}]}