{"sha": "684a3aa7ab4ab91bbd691fd471cbd24184f3dbd3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Njg0YTNhYTdhYjRhYjkxYmJkNjkxZmQ0NzFjYmQyNDE4NGYzZGJkMw==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2014-06-08T16:53:25Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2014-06-08T16:53:25Z"}, "message": "varasm.c (use_blocks_for_decl_p): Check symbol table instead of alias attribute.\n\n\t* varasm.c (use_blocks_for_decl_p): Check symbol table instead of alias\n\tattribute.\n\t(place_block_symbol): Recurse on aliases.\n\nFrom-SVN: r211357", "tree": {"sha": "0e9727e4121e607369c94d97aa9746d96ecfea2e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0e9727e4121e607369c94d97aa9746d96ecfea2e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/684a3aa7ab4ab91bbd691fd471cbd24184f3dbd3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/684a3aa7ab4ab91bbd691fd471cbd24184f3dbd3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/684a3aa7ab4ab91bbd691fd471cbd24184f3dbd3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/684a3aa7ab4ab91bbd691fd471cbd24184f3dbd3/comments", "author": null, "committer": null, "parents": [{"sha": "94c2e46ca326570458effe217e1689a74d7dd042", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94c2e46ca326570458effe217e1689a74d7dd042", "html_url": "https://github.com/Rust-GCC/gccrs/commit/94c2e46ca326570458effe217e1689a74d7dd042"}], "stats": {"total": 14, "additions": 13, "deletions": 1}, "files": [{"sha": "5e5a3c60fc7d0f620af5c30e035b65a114a25c8a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/684a3aa7ab4ab91bbd691fd471cbd24184f3dbd3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/684a3aa7ab4ab91bbd691fd471cbd24184f3dbd3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=684a3aa7ab4ab91bbd691fd471cbd24184f3dbd3", "patch": "@@ -1,3 +1,9 @@\n+2014-06-07  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* varasm.c (use_blocks_for_decl_p): Check symbol table instead of alias\n+\tattribute.\n+\t(place_block_symbol): Recurse on aliases.\n+\n 2014-06-07  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* ipa-visibility.c: Include varasm.h"}, {"sha": "eabc06ff5f725cf05d19df71e96677e40c919a4d", "filename": "gcc/varasm.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/684a3aa7ab4ab91bbd691fd471cbd24184f3dbd3/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/684a3aa7ab4ab91bbd691fd471cbd24184f3dbd3/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=684a3aa7ab4ab91bbd691fd471cbd24184f3dbd3", "patch": "@@ -1184,6 +1184,8 @@ change_symbol_block (rtx symbol, struct object_block *block)\n static bool\n use_blocks_for_decl_p (tree decl)\n {\n+  struct symtab_node *snode;\n+\n   /* Only data DECLs can be placed into object blocks.  */\n   if (TREE_CODE (decl) != VAR_DECL && TREE_CODE (decl) != CONST_DECL)\n     return false;\n@@ -1197,7 +1199,9 @@ use_blocks_for_decl_p (tree decl)\n \n   /* If this decl is an alias, then we don't want to emit a\n      definition.  */\n-  if (lookup_attribute (\"alias\", DECL_ATTRIBUTES (decl)))\n+  if (TREE_CODE (decl) == VAR_DECL\n+      && (snode = symtab_get_node (decl)) != NULL\n+      && snode->alias)\n     return false;\n \n   return targetm.use_blocks_for_decl_p (decl);\n@@ -7028,6 +7032,8 @@ place_block_symbol (rtx symbol)\n       if (snode->alias)\n \t{\n \t  rtx target = DECL_RTL (symtab_alias_ultimate_target (snode)->decl);\n+\n+\t  place_block_symbol (target);\n \t  SYMBOL_REF_BLOCK_OFFSET (symbol) = SYMBOL_REF_BLOCK_OFFSET (target);\n \t  return;\n \t}"}]}