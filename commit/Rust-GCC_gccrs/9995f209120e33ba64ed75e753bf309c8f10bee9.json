{"sha": "9995f209120e33ba64ed75e753bf309c8f10bee9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTk5NWYyMDkxMjBlMzNiYTY0ZWQ3NWU3NTNiZjMwOWM4ZjEwYmVlOQ==", "commit": {"author": {"name": "Vladimir Makarov", "email": "vmakarov@redhat.com", "date": "2010-08-10T21:39:13Z"}, "committer": {"name": "Vladimir Makarov", "email": "vmakarov@gcc.gnu.org", "date": "2010-08-10T21:39:13Z"}, "message": "ira-live.c: Include sbitmap.h.\n\n2010-08-10  Vladimir Makarov  <vmakarov@redhat.com>\n\n\t* ira-live.c: Include sbitmap.h.\n\t(remove_some_program_points_and_update_live_ranges): Use sbitmaps.\n\tCompress live ranges even more.\n\nFrom-SVN: r163080", "tree": {"sha": "ce457536ee73c1a7b613023a34b7124c9f96d491", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ce457536ee73c1a7b613023a34b7124c9f96d491"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9995f209120e33ba64ed75e753bf309c8f10bee9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9995f209120e33ba64ed75e753bf309c8f10bee9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9995f209120e33ba64ed75e753bf309c8f10bee9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9995f209120e33ba64ed75e753bf309c8f10bee9/comments", "author": {"login": "vnmakarov", "id": 9855671, "node_id": "MDQ6VXNlcjk4NTU2NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/9855671?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vnmakarov", "html_url": "https://github.com/vnmakarov", "followers_url": "https://api.github.com/users/vnmakarov/followers", "following_url": "https://api.github.com/users/vnmakarov/following{/other_user}", "gists_url": "https://api.github.com/users/vnmakarov/gists{/gist_id}", "starred_url": "https://api.github.com/users/vnmakarov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vnmakarov/subscriptions", "organizations_url": "https://api.github.com/users/vnmakarov/orgs", "repos_url": "https://api.github.com/users/vnmakarov/repos", "events_url": "https://api.github.com/users/vnmakarov/events{/privacy}", "received_events_url": "https://api.github.com/users/vnmakarov/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "009c04bf7b5f056a6f6d3865eeb3bde125c0bf08", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/009c04bf7b5f056a6f6d3865eeb3bde125c0bf08", "html_url": "https://github.com/Rust-GCC/gccrs/commit/009c04bf7b5f056a6f6d3865eeb3bde125c0bf08"}], "stats": {"total": 45, "additions": 35, "deletions": 10}, "files": [{"sha": "9c838ba4ad2da272ac90670f523dedec738921ce", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9995f209120e33ba64ed75e753bf309c8f10bee9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9995f209120e33ba64ed75e753bf309c8f10bee9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9995f209120e33ba64ed75e753bf309c8f10bee9", "patch": "@@ -1,3 +1,9 @@\n+2010-08-10  Vladimir Makarov  <vmakarov@redhat.com>\n+\n+\t* ira-live.c: Include sbitmap.h.\n+\t(remove_some_program_points_and_update_live_ranges): Use sbitmaps.\n+\tCompress live ranges even more.\n+\n 2010-08-10  Nathan Froyd  <froydnj@codesourcery.com>\n \n \t* coverage.c (ctr_labels): Delete."}, {"sha": "1ffed789e3d2ef0e55f054a3a75362df0c7a89be", "filename": "gcc/ira-lives.c", "status": "modified", "additions": 29, "deletions": 10, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9995f209120e33ba64ed75e753bf309c8f10bee9/gcc%2Fira-lives.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9995f209120e33ba64ed75e753bf309c8f10bee9/gcc%2Fira-lives.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fira-lives.c?ref=9995f209120e33ba64ed75e753bf309c8f10bee9", "patch": "@@ -37,6 +37,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"toplev.h\"\n #include \"params.h\"\n #include \"df.h\"\n+#include \"sbitmap.h\"\n #include \"sparseset.h\"\n #include \"ira-int.h\"\n \n@@ -1308,25 +1309,43 @@ remove_some_program_points_and_update_live_ranges (void)\n   ira_object_t obj;\n   ira_object_iterator oi;\n   live_range_t r;\n-  bitmap born_or_died;\n-  bitmap_iterator bi;\n-\n-  born_or_died = ira_allocate_bitmap ();\n+  sbitmap born_or_dead, born, dead;\n+  sbitmap_iterator sbi;\n+  bool born_p, dead_p, prev_born_p, prev_dead_p;\n+  \n+  born = sbitmap_alloc (ira_max_point);\n+  dead = sbitmap_alloc (ira_max_point);\n+  sbitmap_zero (born);\n+  sbitmap_zero (dead);\n   FOR_EACH_OBJECT (obj, oi)\n     for (r = OBJECT_LIVE_RANGES (obj); r != NULL; r = r->next)\n       {\n \tira_assert (r->start <= r->finish);\n-\tbitmap_set_bit (born_or_died, r->start);\n-\tbitmap_set_bit (born_or_died, r->finish);\n+\tSET_BIT (born, r->start);\n+\tSET_BIT (dead, r->finish);\n       }\n \n+  born_or_dead = sbitmap_alloc (ira_max_point);\n+  sbitmap_a_or_b (born_or_dead, born, dead);\n   map = (int *) ira_allocate (sizeof (int) * ira_max_point);\n-  n = 0;\n-  EXECUTE_IF_SET_IN_BITMAP(born_or_died, 0, i, bi)\n+  n = -1;\n+  prev_born_p = prev_dead_p = false;\n+  EXECUTE_IF_SET_IN_SBITMAP (born_or_dead, 0, i, sbi)\n     {\n-      map[i] = n++;\n+      born_p = TEST_BIT (born, i);\n+      dead_p = TEST_BIT (dead, i);\n+      if ((prev_born_p && ! prev_dead_p && born_p && ! dead_p)\n+\t  || (prev_dead_p && ! prev_born_p && dead_p && ! born_p))\n+\tmap[i] = n;\n+      else\n+\tmap[i] = ++n;\n+      prev_born_p = born_p;\n+      prev_dead_p = dead_p;\n     }\n-  ira_free_bitmap (born_or_died);\n+  sbitmap_free (born_or_dead);\n+  sbitmap_free (born);\n+  sbitmap_free (dead);\n+  n++;\n   if (internal_flag_ira_verbose > 1 && ira_dump_file != NULL)\n     fprintf (ira_dump_file, \"Compressing live ranges: from %d to %d - %d%%\\n\",\n \t     ira_max_point, n, 100 * n / ira_max_point);"}]}