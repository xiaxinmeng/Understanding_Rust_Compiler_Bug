{"sha": "88a2a09dd4529107e7ef7a6e7ce43acf96457173", "node_id": "C_kwDOANBUbNoAKDg4YTJhMDlkZDQ1MjkxMDdlN2VmN2E2ZTdjZTQzYWNmOTY0NTcxNzM", "commit": {"author": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2023-02-01T20:01:32Z"}, "committer": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2023-02-01T20:01:32Z"}, "message": "Fortran: error recovery on invalid array section [PR108609]\n\nThe testcase for PR108527 uncovered a latent issue with invalid array\nsections that resulted in different paths being taken on different\narchitectures.  Detect the invalid array declaration for a clean recovery.\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/108609\n\t* expr.cc (find_array_section): Add check to prevent interpreting an\n\tmpz non-integer constant as an integer.\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/108609\n\t* gfortran.dg/pr108527.f90: Adjust test pattern.", "tree": {"sha": "51decfe2710b4a2afbc11cc50e1874afc5db3630", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/51decfe2710b4a2afbc11cc50e1874afc5db3630"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/88a2a09dd4529107e7ef7a6e7ce43acf96457173", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88a2a09dd4529107e7ef7a6e7ce43acf96457173", "html_url": "https://github.com/Rust-GCC/gccrs/commit/88a2a09dd4529107e7ef7a6e7ce43acf96457173", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88a2a09dd4529107e7ef7a6e7ce43acf96457173/comments", "author": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "committer": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a2c848c92c3f13c2dd9bd92d22beb44c1ff848b4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2c848c92c3f13c2dd9bd92d22beb44c1ff848b4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a2c848c92c3f13c2dd9bd92d22beb44c1ff848b4"}], "stats": {"total": 8, "additions": 6, "deletions": 2}, "files": [{"sha": "c295721b9d6d531d918161f8c42b53dc18a928d7", "filename": "gcc/fortran/expr.cc", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88a2a09dd4529107e7ef7a6e7ce43acf96457173/gcc%2Ffortran%2Fexpr.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88a2a09dd4529107e7ef7a6e7ce43acf96457173/gcc%2Ffortran%2Fexpr.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fexpr.cc?ref=88a2a09dd4529107e7ef7a6e7ce43acf96457173", "patch": "@@ -1552,7 +1552,11 @@ find_array_section (gfc_expr *expr, gfc_ref *ref)\n       lower = ref->u.ar.as->lower[d];\n       upper = ref->u.ar.as->upper[d];\n \n-      if (!lower || !upper)\n+      if (!lower || !upper\n+\t  || lower->expr_type != EXPR_CONSTANT\n+\t  || upper->expr_type != EXPR_CONSTANT\n+\t  || lower->ts.type != BT_INTEGER\n+\t  || upper->ts.type != BT_INTEGER)\n \t{\n \t  t = false;\n \t  goto cleanup;"}, {"sha": "804514810acd4dd761919ee4a15447188789bbde", "filename": "gcc/testsuite/gfortran.dg/pr108527.f90", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88a2a09dd4529107e7ef7a6e7ce43acf96457173/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr108527.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88a2a09dd4529107e7ef7a6e7ce43acf96457173/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr108527.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr108527.f90?ref=88a2a09dd4529107e7ef7a6e7ce43acf96457173", "patch": "@@ -4,7 +4,7 @@\n \n program p\n   integer, parameter :: a((2.)) = [4,8] ! { dg-error \"must be of INTEGER type\" }\n-  integer(a(1:1)) :: b                  ! { dg-error \"out of bounds\" }\n+  integer(a(1:1)) :: b                  ! { dg-error \"Unclassifiable statement\" }\n end\n \n ! { dg-prune-output \"Parameter array\" }"}]}