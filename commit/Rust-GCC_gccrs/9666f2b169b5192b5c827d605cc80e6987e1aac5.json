{"sha": "9666f2b169b5192b5c827d605cc80e6987e1aac5", "node_id": "C_kwDOANBUbNoAKDk2NjZmMmIxNjliNTE5MmI1YzgyN2Q2MDVjYzgwZTY5ODdlMWFhYzU", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2022-12-05T01:22:10Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-12-05T01:22:10Z"}, "message": "Merge #1632\n\n1632: Fix mac-os regression in apply generic arguments to method calls r=philberty a=philberty\n\nWhen applying generic arguments to method calls such as:\r\n\r\n```receiver.method_name<i32, bool>()```\r\n\r\nThis ended up wrongly using the default constructor with an empty generic arguments which seems\r\nlike a possible bug in the new version of clang. This explicitly sets up all relevant copy constructors\r\nfor HIR::PathExprSegment and removes the defaults.\n\nCo-authored-by: Philip Herron <philip.herron@embecosm.com>", "tree": {"sha": "465b0f518b726001cda0e05c0a3a1344913bb022", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/465b0f518b726001cda0e05c0a3a1344913bb022"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9666f2b169b5192b5c827d605cc80e6987e1aac5", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjjUfCCRBK7hj4Ov3rIwAA8d4IAFUSor7DWH+JbIP689upW5ci\ntLoMpLR0KErupi+DAmoMzpUBF/OGzv9j/d6s2R7Aa2EhukdZJkBi697O1eF12Idx\nSj9VNSIMiKIM4kFp0LvalTR4QmQ7loGi2JXTj2Msjb1CUf6lV2/V7y0tdRVF7uas\ngMBJu0s3KLjah7gKnG6jU12fJului2IvAWbEaprajZnySTQr6vGj4GKFjtQdOG9W\nudULnclTb+r66I1G0sx95ZIqd4abu1kuXkzMleOLC2w/CXxSDkNcCyEsVwZiKxWn\nPW4zkMRi52w1HhWgX2Pr8Pu9j4AdUYtYsuX6yaOwiPB53/CcLZCTWcH/NhbfNRQ=\n=iG/x\n-----END PGP SIGNATURE-----\n", "payload": "tree 465b0f518b726001cda0e05c0a3a1344913bb022\nparent e39fadcd0aa4d52d53667e2adad9a6677f7e9adf\nparent 31dd14e197c00891751994839b16a5a193a71820\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1670203330 +0000\ncommitter GitHub <noreply@github.com> 1670203330 +0000\n\nMerge #1632\n\n1632: Fix mac-os regression in apply generic arguments to method calls r=philberty a=philberty\n\nWhen applying generic arguments to method calls such as:\r\n\r\n```receiver.method_name<i32, bool>()```\r\n\r\nThis ended up wrongly using the default constructor with an empty generic arguments which seems\r\nlike a possible bug in the new version of clang. This explicitly sets up all relevant copy constructors\r\nfor HIR::PathExprSegment and removes the defaults.\n\nCo-authored-by: Philip Herron <philip.herron@embecosm.com>\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9666f2b169b5192b5c827d605cc80e6987e1aac5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9666f2b169b5192b5c827d605cc80e6987e1aac5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9666f2b169b5192b5c827d605cc80e6987e1aac5/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e39fadcd0aa4d52d53667e2adad9a6677f7e9adf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e39fadcd0aa4d52d53667e2adad9a6677f7e9adf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e39fadcd0aa4d52d53667e2adad9a6677f7e9adf"}, {"sha": "31dd14e197c00891751994839b16a5a193a71820", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/31dd14e197c00891751994839b16a5a193a71820", "html_url": "https://github.com/Rust-GCC/gccrs/commit/31dd14e197c00891751994839b16a5a193a71820"}], "stats": {"total": 66, "additions": 46, "deletions": 20}, "files": [{"sha": "693704e538a06afce10facbb72d324e347e21bf1", "filename": "gcc/rust/hir/tree/rust-hir-expr.h", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9666f2b169b5192b5c827d605cc80e6987e1aac5/gcc%2Frust%2Fhir%2Ftree%2Frust-hir-expr.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9666f2b169b5192b5c827d605cc80e6987e1aac5/gcc%2Frust%2Fhir%2Ftree%2Frust-hir-expr.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fhir%2Ftree%2Frust-hir-expr.h?ref=9666f2b169b5192b5c827d605cc80e6987e1aac5", "patch": "@@ -1872,7 +1872,8 @@ class MethodCallExpr : public ExprWithoutBlock\n \n   std::unique_ptr<Expr> &get_receiver () { return receiver; }\n \n-  PathExprSegment get_method_name () const { return method_name; };\n+  PathExprSegment &get_method_name () { return method_name; };\n+  const PathExprSegment &get_method_name () const { return method_name; };\n \n   size_t num_params () const { return params.size (); }\n "}, {"sha": "761526b4fc936bd976f60ef33756aa577347d3f8", "filename": "gcc/rust/hir/tree/rust-hir-full-decls.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9666f2b169b5192b5c827d605cc80e6987e1aac5/gcc%2Frust%2Fhir%2Ftree%2Frust-hir-full-decls.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9666f2b169b5192b5c827d605cc80e6987e1aac5/gcc%2Frust%2Fhir%2Ftree%2Frust-hir-full-decls.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fhir%2Ftree%2Frust-hir-full-decls.h?ref=9666f2b169b5192b5c827d605cc80e6987e1aac5", "patch": "@@ -43,7 +43,7 @@ class PathExpr;\n // rust-path.h\n class PathIdentSegment;\n struct GenericArgsBinding;\n-struct GenericArgs;\n+class GenericArgs;\n class PathExprSegment;\n class PathPattern;\n class PathInExpression;"}, {"sha": "8cc16f367cf38e07f916f01c006b23eedf0f984c", "filename": "gcc/rust/hir/tree/rust-hir-path.h", "status": "modified", "additions": 28, "deletions": 9, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9666f2b169b5192b5c827d605cc80e6987e1aac5/gcc%2Frust%2Fhir%2Ftree%2Frust-hir-path.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9666f2b169b5192b5c827d605cc80e6987e1aac5/gcc%2Frust%2Fhir%2Ftree%2Frust-hir-path.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fhir%2Ftree%2Frust-hir-path.h?ref=9666f2b169b5192b5c827d605cc80e6987e1aac5", "patch": "@@ -140,8 +140,7 @@ class ConstGenericArg\n   Location locus;\n };\n \n-// Generic arguments allowed in each path expression segment - inline?\n-struct GenericArgs\n+class GenericArgs\n {\n   std::vector<Lifetime> lifetime_args;\n   std::vector<std::unique_ptr<Type> > type_args;\n@@ -172,6 +171,7 @@ struct GenericArgs\n     : lifetime_args (other.lifetime_args), binding_args (other.binding_args),\n       const_args (other.const_args), locus (other.locus)\n   {\n+    type_args.clear ();\n     type_args.reserve (other.type_args.size ());\n \n     for (const auto &e : other.type_args)\n@@ -188,6 +188,7 @@ struct GenericArgs\n     const_args = other.const_args;\n     locus = other.locus;\n \n+    type_args.clear ();\n     type_args.reserve (other.type_args.size ());\n     for (const auto &e : other.type_args)\n       type_args.push_back (e->clone_type ());\n@@ -235,26 +236,44 @@ class PathExprSegment\n   Location locus;\n \n public:\n-  // Returns true if there are any generic arguments\n-  bool has_generic_args () const { return generic_args.has_generic_args (); }\n-\n-  // Constructor for segment (from IdentSegment and GenericArgs)\n   PathExprSegment (Analysis::NodeMapping mappings,\n-\t\t   PathIdentSegment segment_name, Location locus = Location (),\n-\t\t   GenericArgs generic_args = GenericArgs::create_empty ())\n+\t\t   PathIdentSegment segment_name, Location locus,\n+\t\t   GenericArgs generic_args)\n     : mappings (std::move (mappings)), segment_name (std::move (segment_name)),\n       generic_args (std::move (generic_args)), locus (locus)\n   {}\n \n+  PathExprSegment (PathExprSegment const &other)\n+    : mappings (other.mappings), segment_name (other.segment_name),\n+      generic_args (other.generic_args), locus (other.locus)\n+  {}\n+\n+  PathExprSegment &operator= (PathExprSegment const &other)\n+  {\n+    mappings = other.mappings;\n+    segment_name = other.segment_name;\n+    generic_args = other.generic_args;\n+    locus = other.locus;\n+\n+    return *this;\n+  }\n+\n+  // move constructors\n+  PathExprSegment (PathExprSegment &&other) = default;\n+  PathExprSegment &operator= (PathExprSegment &&other) = default;\n+\n   std::string as_string () const;\n \n   Location get_locus () const { return locus; }\n \n-  PathIdentSegment get_segment () const { return segment_name; }\n+  PathIdentSegment &get_segment () { return segment_name; }\n+  const PathIdentSegment &get_segment () const { return segment_name; }\n \n   GenericArgs &get_generic_args () { return generic_args; }\n \n   const Analysis::NodeMapping &get_mappings () const { return mappings; }\n+\n+  bool has_generic_args () const { return generic_args.has_generic_args (); }\n };\n \n // HIR node representing a pattern that involves a \"path\" - abstract base class"}, {"sha": "3ee59e6ca7c6f767d48574e64e3f413fcdb3bbbc", "filename": "gcc/rust/typecheck/rust-hir-type-check-expr.cc", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9666f2b169b5192b5c827d605cc80e6987e1aac5/gcc%2Frust%2Ftypecheck%2Frust-hir-type-check-expr.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9666f2b169b5192b5c827d605cc80e6987e1aac5/gcc%2Frust%2Ftypecheck%2Frust-hir-type-check-expr.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Ftypecheck%2Frust-hir-type-check-expr.cc?ref=9666f2b169b5192b5c827d605cc80e6987e1aac5", "patch": "@@ -1149,10 +1149,11 @@ TypeCheckExpr::visit (HIR::MethodCallExpr &expr)\n   // apply any remaining generic arguments\n   if (expr.get_method_name ().has_generic_args ())\n     {\n-      rust_debug_loc (expr.get_method_name ().get_generic_args ().get_locus (),\n+      HIR::GenericArgs &args = expr.get_method_name ().get_generic_args ();\n+      rust_debug_loc (args.get_locus (),\n \t\t      \"applying generic arguments to method_call: {%s}\",\n \t\t      lookup->debug_str ().c_str ());\n-      HIR::GenericArgs &args = expr.get_method_name ().get_generic_args ();\n+\n       lookup\n \t= SubstMapper::Resolve (lookup, expr.get_method_name ().get_locus (),\n \t\t\t\t&args);"}, {"sha": "0503528c423498ac6239075041a01e348b001cea", "filename": "gcc/rust/typecheck/rust-tyty.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9666f2b169b5192b5c827d605cc80e6987e1aac5/gcc%2Frust%2Ftypecheck%2Frust-tyty.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9666f2b169b5192b5c827d605cc80e6987e1aac5/gcc%2Frust%2Ftypecheck%2Frust-tyty.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Ftypecheck%2Frust-tyty.h?ref=9666f2b169b5192b5c827d605cc80e6987e1aac5", "patch": "@@ -699,6 +699,10 @@ class SubstitutionArgumentMappings\n     return *this;\n   }\n \n+  SubstitutionArgumentMappings (SubstitutionArgumentMappings &&other) = default;\n+  SubstitutionArgumentMappings &operator= (SubstitutionArgumentMappings &&other)\n+    = default;\n+\n   static SubstitutionArgumentMappings error ()\n   {\n     return SubstitutionArgumentMappings ({}, Location (), nullptr, false);"}, {"sha": "3300925d4e0ddd24e05b00b3655eca09c5fcd035", "filename": "gcc/testsuite/rust/debug/chartype.rs", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9666f2b169b5192b5c827d605cc80e6987e1aac5/gcc%2Ftestsuite%2Frust%2Fdebug%2Fchartype.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9666f2b169b5192b5c827d605cc80e6987e1aac5/gcc%2Ftestsuite%2Frust%2Fdebug%2Fchartype.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fdebug%2Fchartype.rs?ref=9666f2b169b5192b5c827d605cc80e6987e1aac5", "patch": "@@ -1,10 +1,11 @@\n-// 'char' should use DW_ATE_UTF\n-fn main () {\n-    let c = 'x';\n // { dg-do compile }\n-// Use -w to avoid warnings about the unused variables\n-// DW_ATE_UTF entered in DWARF 4.\n+// { dg-skip-if \"see https://github.com/Rust-GCC/gccrs/pull/1632\" { *-*-darwin* } }\n // { dg-options \"-w -gdwarf-4 -dA\" }\n-// DW_ATE_UTF = 0x10\n-// { dg-final { scan-assembler \"0x10\\[ \\t]\\[^\\n\\r]* DW_AT_encoding\" } } */\n+// 'char' should use DW_ATE_UTF\n+fn main() {\n+    let c = 'x';\n+    // Use -w to avoid warnings about the unused variables\n+    // DW_ATE_UTF entered in DWARF 4.\n+    // DW_ATE_UTF = 0x10\n+    // { dg-final { scan-assembler \"0x10\\[ \\t]\\[^\\n\\r]* DW_AT_encoding\" } } */\n }"}]}