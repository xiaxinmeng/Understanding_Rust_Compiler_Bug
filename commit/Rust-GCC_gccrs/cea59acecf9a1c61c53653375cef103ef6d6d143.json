{"sha": "cea59acecf9a1c61c53653375cef103ef6d6d143", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2VhNTlhY2VjZjlhMWM2MWM1MzY1MzM3NWNlZjEwM2VmNmQ2ZDE0Mw==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2010-10-21T00:45:15Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2010-10-21T00:45:15Z"}, "message": "re PR fortran/46079 (ABI for empty stop statement broken)\n\n2010-10-20  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR libgfortran/46079\n\t* runtime/stop.c (stop_numeric_f08): New function.\n\t(stop_numeric): Restore\tto previous behavior.\n\t* gfortran.map: Add symbol _gfortran_stop_numeric_f08.\n\n2010-10-20  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR fortran/46079\n\t* trans_stmt.c (gfc_trans_stop): Fix whitespace.  Build a call to new\n\tF08 numeric stop function.\n\t* trans.h: Add declaration for gfor_fndecl_stop_numeric_f08.\n\t* trans-decl.c (gfc_build_builtin_function_decls): Build declaration\n\tfor stop_numeric_f08.\n\nFrom-SVN: r165746", "tree": {"sha": "f6c2d85ba773d860c79e23d0f535c1678b5d464b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f6c2d85ba773d860c79e23d0f535c1678b5d464b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cea59acecf9a1c61c53653375cef103ef6d6d143", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cea59acecf9a1c61c53653375cef103ef6d6d143", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cea59acecf9a1c61c53653375cef103ef6d6d143", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cea59acecf9a1c61c53653375cef103ef6d6d143/comments", "author": null, "committer": null, "parents": [{"sha": "7cc2a03da23ef784bbd3f9c853af88e75b73cd7c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7cc2a03da23ef784bbd3f9c853af88e75b73cd7c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7cc2a03da23ef784bbd3f9c853af88e75b73cd7c"}], "stats": {"total": 59, "additions": 52, "deletions": 7}, "files": [{"sha": "1e10747c6f5c23f1439cd67b1379c2d8bc9ea6db", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cea59acecf9a1c61c53653375cef103ef6d6d143/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cea59acecf9a1c61c53653375cef103ef6d6d143/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=cea59acecf9a1c61c53653375cef103ef6d6d143", "patch": "@@ -1,3 +1,12 @@\n+2010-10-20  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR fortran/46079\n+\t* trans_stmt.c (gfc_trans_stop): Fix whitespace.  Build a call to new\n+\tF08 numeric stop function.\n+\t* trans.h: Add declaration for gfor_fndecl_stop_numeric_f08.\n+\t* trans-decl.c (gfc_build_builtin_function_decls): Build declaration\n+\tfor stop_numeric_f08.\n+\n 2010-10-18  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \t* gfortran.h: Remove definition of bt enumerator."}, {"sha": "f2905cd327ac77d8fea7336c45d19fadaf35e627", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cea59acecf9a1c61c53653375cef103ef6d6d143/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cea59acecf9a1c61c53653375cef103ef6d6d143/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=cea59acecf9a1c61c53653375cef103ef6d6d143", "patch": "@@ -87,6 +87,7 @@ tree gfc_static_ctors;\n tree gfor_fndecl_pause_numeric;\n tree gfor_fndecl_pause_string;\n tree gfor_fndecl_stop_numeric;\n+tree gfor_fndecl_stop_numeric_f08;\n tree gfor_fndecl_stop_string;\n tree gfor_fndecl_error_stop_numeric;\n tree gfor_fndecl_error_stop_string;\n@@ -2802,6 +2803,12 @@ gfc_build_builtin_function_decls (void)\n   /* STOP doesn't return.  */\n   TREE_THIS_VOLATILE (gfor_fndecl_stop_numeric) = 1;\n \n+  gfor_fndecl_stop_numeric_f08 = gfc_build_library_function_decl (\n+\tget_identifier (PREFIX(\"stop_numeric_f08\")),\n+\tvoid_type_node, 1, gfc_int4_type_node);\n+  /* STOP doesn't return.  */\n+  TREE_THIS_VOLATILE (gfor_fndecl_stop_numeric_f08) = 1;\n+\n   gfor_fndecl_stop_string = gfc_build_library_function_decl_with_spec (\n \tget_identifier (PREFIX(\"stop_string\")), \".R.\",\n \tvoid_type_node, 2, pchar_type_node, gfc_int4_type_node);"}, {"sha": "6e1a20b8c913fd295b3a970d4a4c821668b03f68", "filename": "gcc/fortran/trans-stmt.c", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cea59acecf9a1c61c53653375cef103ef6d6d143/gcc%2Ffortran%2Ftrans-stmt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cea59acecf9a1c61c53653375cef103ef6d6d143/gcc%2Ffortran%2Ftrans-stmt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-stmt.c?ref=cea59acecf9a1c61c53653375cef103ef6d6d143", "patch": "@@ -602,25 +602,25 @@ gfc_trans_stop (gfc_code *code, bool error_stop)\n     {\n       tmp = build_int_cst (gfc_int4_type_node, 0);\n       tmp = build_call_expr_loc (input_location,\n-\t\t\t     \t error_stop ? gfor_fndecl_error_stop_string\n+\t\t\t\t error_stop ? gfor_fndecl_error_stop_string\n \t\t\t\t : gfor_fndecl_stop_string,\n-\t\t\t     \t 2, build_int_cst (pchar_type_node, 0), tmp);\n+\t\t\t\t 2, build_int_cst (pchar_type_node, 0), tmp);\n     }\n   else if (code->expr1->ts.type == BT_INTEGER)\n     {\n       gfc_conv_expr (&se, code->expr1);\n       tmp = build_call_expr_loc (input_location,\n-      \t\t\t\t error_stop ? gfor_fndecl_error_stop_numeric\n-\t\t\t   \t : gfor_fndecl_stop_numeric, 1,\n+\t\t\t\t error_stop ? gfor_fndecl_error_stop_numeric\n+\t\t\t\t : gfor_fndecl_stop_numeric_f08, 1, \n \t\t\t\t fold_convert (gfc_int4_type_node, se.expr));\n     }\n   else\n     {\n       gfc_conv_expr_reference (&se, code->expr1);\n       tmp = build_call_expr_loc (input_location,\n-\t\t\t     \t error_stop ? gfor_fndecl_error_stop_string\n+\t\t\t\t error_stop ? gfor_fndecl_error_stop_string\n \t\t\t\t : gfor_fndecl_stop_string,\n-\t\t\t     \t 2, se.expr, se.string_length);\n+\t\t\t\t 2, se.expr, se.string_length);\n     }\n \n   gfc_add_expr_to_block (&se.pre, tmp);"}, {"sha": "efd5eb9e525d1872c54a9fd3a5a87d3f08e90789", "filename": "gcc/fortran/trans.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cea59acecf9a1c61c53653375cef103ef6d6d143/gcc%2Ffortran%2Ftrans.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cea59acecf9a1c61c53653375cef103ef6d6d143/gcc%2Ffortran%2Ftrans.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans.h?ref=cea59acecf9a1c61c53653375cef103ef6d6d143", "patch": "@@ -589,6 +589,7 @@ void gfc_omp_firstprivatize_type_sizes (struct gimplify_omp_ctx *, tree);\n extern GTY(()) tree gfor_fndecl_pause_numeric;\n extern GTY(()) tree gfor_fndecl_pause_string;\n extern GTY(()) tree gfor_fndecl_stop_numeric;\n+extern GTY(()) tree gfor_fndecl_stop_numeric_f08;\n extern GTY(()) tree gfor_fndecl_stop_string;\n extern GTY(()) tree gfor_fndecl_error_stop_numeric;\n extern GTY(()) tree gfor_fndecl_error_stop_string;"}, {"sha": "c47cac370b5bac13928aa9dfff1553450d47107d", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cea59acecf9a1c61c53653375cef103ef6d6d143/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cea59acecf9a1c61c53653375cef103ef6d6d143/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=cea59acecf9a1c61c53653375cef103ef6d6d143", "patch": "@@ -1,3 +1,10 @@\n+2010-10-20  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR libgfortran/46079\n+\t* runtime/stop.c (stop_numeric_f08): New function.\n+\t(stop_numeric): Restore\tto previous behavior.\n+\t* gfortran.map: Add symbol _gfortran_stop_numeric_f08.\n+\n 2010-10-18  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \t* io/io.h: Remove definition of the BT enumerator."}, {"sha": "b5fad17e0d4d43591ddd6347b2ea8cb3ac62148a", "filename": "libgfortran/gfortran.map", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cea59acecf9a1c61c53653375cef103ef6d6d143/libgfortran%2Fgfortran.map", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cea59acecf9a1c61c53653375cef103ef6d6d143/libgfortran%2Fgfortran.map", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fgfortran.map?ref=cea59acecf9a1c61c53653375cef103ef6d6d143", "patch": "@@ -1141,6 +1141,7 @@ GFORTRAN_1.4 {\n     _gfortran_parity_l8;\n     _gfortran_parity_l16;\n     _gfortran_selected_real_kind2008;\n+    _gfortran_stop_numeric_f08;\n     _gfortran_transfer_array_write;\n     _gfortran_transfer_character_write;\n     _gfortran_transfer_character_wide_write;"}, {"sha": "29f5031b3af5721bb866d0695a27ce64a52be7af", "filename": "libgfortran/runtime/stop.c", "status": "modified", "additions": 21, "deletions": 1, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cea59acecf9a1c61c53653375cef103ef6d6d143/libgfortran%2Fruntime%2Fstop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cea59acecf9a1c61c53653375cef103ef6d6d143/libgfortran%2Fruntime%2Fstop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fruntime%2Fstop.c?ref=cea59acecf9a1c61c53653375cef103ef6d6d143", "patch": "@@ -34,11 +34,30 @@ export_proto(stop_numeric);\n \n void\n stop_numeric (GFC_INTEGER_4 code)\n+{\n+  if (code == -1)\n+    code = 0;\n+  else\n+    st_printf (\"STOP %d\\n\", (int)code);\n+\n+  sys_exit (code);\n+}\n+\n+\n+/* A Fortran 2008 numeric STOP statement.  */\n+\n+extern void stop_numeric_f08 (GFC_INTEGER_4)\n+  __attribute__ ((noreturn));\n+export_proto(stop_numeric_f08);\n+\n+void\n+stop_numeric_f08 (GFC_INTEGER_4 code)\n {\n   st_printf (\"STOP %d\\n\", (int)code);\n   sys_exit (code);\n }\n \n+\n /* A character string or blank STOP statement.  */\n \n void\n@@ -75,7 +94,8 @@ error_stop_string (const char *string, GFC_INTEGER_4 len)\n   sys_exit (1);\n }\n \n-/* A numeric or blank ERROR STOP statement.  */\n+\n+/* A numeric ERROR STOP statement.  */\n \n extern void error_stop_numeric (GFC_INTEGER_4)\n   __attribute__ ((noreturn));"}]}