{"sha": "17aa6ab611c5e5ea4d7696aae0866b628fedb4b9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTdhYTZhYjYxMWM1ZTVlYTRkNzY5NmFhZTA4NjZiNjI4ZmVkYjRiOQ==", "commit": {"author": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2012-08-02T19:20:43Z"}, "committer": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2012-08-02T19:20:43Z"}, "message": "trans-array.h (gfc_conv_descriptor_rank): New prototype.\n\n\t* trans-array.h (gfc_conv_descriptor_rank): New prototype.\n\t* trans-array.c (gfc_conv_descriptor_rank): New function moved and\n\trenamed ...\n\t* trans-intrinsic.c (get_rank_from_desc): ... from this one.\n\t(gfc_conv_intrinsic_rank, gfc_conv_intrinsic_bound,\n\tgfc_conv_associated): Also rename function calls.\n\nFrom-SVN: r190095", "tree": {"sha": "0b14e1866a904ecdcb68e0e0bb7eff98e400e0c7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0b14e1866a904ecdcb68e0e0bb7eff98e400e0c7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/17aa6ab611c5e5ea4d7696aae0866b628fedb4b9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/17aa6ab611c5e5ea4d7696aae0866b628fedb4b9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/17aa6ab611c5e5ea4d7696aae0866b628fedb4b9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/17aa6ab611c5e5ea4d7696aae0866b628fedb4b9/comments", "author": null, "committer": null, "parents": [{"sha": "d357d991136f44feee3c05ae8940ea3b241698fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d357d991136f44feee3c05ae8940ea3b241698fd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d357d991136f44feee3c05ae8940ea3b241698fd"}], "stats": {"total": 44, "additions": 27, "deletions": 17}, "files": [{"sha": "036e973bcf132c9d9f38633fd8f7d06cae54a837", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17aa6ab611c5e5ea4d7696aae0866b628fedb4b9/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17aa6ab611c5e5ea4d7696aae0866b628fedb4b9/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=17aa6ab611c5e5ea4d7696aae0866b628fedb4b9", "patch": "@@ -1,3 +1,12 @@\n+2012-08-02  Mikael Morin  <mikael@gcc.gnu.org>\n+\n+\t* trans-array.h (gfc_conv_descriptor_rank): New prototype.\n+\t* trans-array.c (gfc_conv_descriptor_rank): New function moved and\n+\trenamed ...\n+\t* trans-intrinsic.c (get_rank_from_desc): ... from this one.\n+\t(gfc_conv_intrinsic_rank, gfc_conv_intrinsic_bound,\n+\tgfc_conv_associated): Also rename function calls.\n+\n 2012-08-02  Mikael Morin  <mikael@gcc.gnu.org>\n \n \t* iresolve.c (resolve_bound, gfc_resolve_shape):"}, {"sha": "abdb9eabd4fb132be316eaa9bb14ff84ce1a4b1e", "filename": "gcc/fortran/trans-array.c", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17aa6ab611c5e5ea4d7696aae0866b628fedb4b9/gcc%2Ffortran%2Ftrans-array.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17aa6ab611c5e5ea4d7696aae0866b628fedb4b9/gcc%2Ffortran%2Ftrans-array.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.c?ref=17aa6ab611c5e5ea4d7696aae0866b628fedb4b9", "patch": "@@ -248,6 +248,20 @@ gfc_conv_descriptor_dtype (tree desc)\n }\n \n \n+tree\n+gfc_conv_descriptor_rank (tree desc)\n+{\n+  tree tmp;\n+  tree dtype;\n+\n+  dtype = gfc_conv_descriptor_dtype (desc);\n+  tmp = build_int_cst (TREE_TYPE (dtype), GFC_DTYPE_RANK_MASK);\n+  tmp = fold_build2_loc (input_location, BIT_AND_EXPR, TREE_TYPE (dtype),\n+\t\t\t dtype, tmp);\n+  return fold_convert (gfc_get_int_type (gfc_default_integer_kind), tmp);\n+}\n+\n+\n tree\n gfc_get_descriptor_dimension (tree desc)\n {"}, {"sha": "5ad794ad752f779cd3c9393998a42379414bf04e", "filename": "gcc/fortran/trans-array.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17aa6ab611c5e5ea4d7696aae0866b628fedb4b9/gcc%2Ffortran%2Ftrans-array.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17aa6ab611c5e5ea4d7696aae0866b628fedb4b9/gcc%2Ffortran%2Ftrans-array.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.h?ref=17aa6ab611c5e5ea4d7696aae0866b628fedb4b9", "patch": "@@ -154,6 +154,7 @@ tree gfc_conv_descriptor_data_get (tree);\n tree gfc_conv_descriptor_data_addr (tree);\n tree gfc_conv_descriptor_offset_get (tree);\n tree gfc_conv_descriptor_dtype (tree);\n+tree gfc_conv_descriptor_rank (tree);\n tree gfc_get_descriptor_dimension (tree);\n tree gfc_conv_descriptor_stride_get (tree, tree);\n tree gfc_conv_descriptor_lbound_get (tree, tree);"}, {"sha": "fac29c7f5f60a5b6f459b65f00c22a45a82b0d41", "filename": "gcc/fortran/trans-intrinsic.c", "status": "modified", "additions": 3, "deletions": 17, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17aa6ab611c5e5ea4d7696aae0866b628fedb4b9/gcc%2Ffortran%2Ftrans-intrinsic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17aa6ab611c5e5ea4d7696aae0866b628fedb4b9/gcc%2Ffortran%2Ftrans-intrinsic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-intrinsic.c?ref=17aa6ab611c5e5ea4d7696aae0866b628fedb4b9", "patch": "@@ -1315,20 +1315,6 @@ trans_num_images (gfc_se * se)\n }\n \n \n-static tree\n-get_rank_from_desc (tree desc)\n-{\n-  tree tmp;\n-  tree dtype;\n-\n-  dtype = gfc_conv_descriptor_dtype (desc);\n-  tmp = build_int_cst (TREE_TYPE (dtype), GFC_DTYPE_RANK_MASK);\n-  tmp = fold_build2_loc (input_location, BIT_AND_EXPR, TREE_TYPE (dtype),\n-\t\t\t dtype, tmp);\n-  return fold_convert (gfc_get_int_type (gfc_default_integer_kind), tmp);\n-}\n-\n-\n static void\n gfc_conv_intrinsic_rank (gfc_se *se, gfc_expr *expr)\n {\n@@ -1345,7 +1331,7 @@ gfc_conv_intrinsic_rank (gfc_se *se, gfc_expr *expr)\n   gfc_add_block_to_block (&se->pre, &argse.pre);\n   gfc_add_block_to_block (&se->post, &argse.post);\n \n-  se->expr = get_rank_from_desc (argse.expr);\n+  se->expr = gfc_conv_descriptor_rank (argse.expr);\n }\n \n \n@@ -1434,7 +1420,7 @@ gfc_conv_intrinsic_bound (gfc_se * se, gfc_expr * expr, int upper)\n           cond = fold_build2_loc (input_location, LT_EXPR, boolean_type_node,\n \t\t\t\t  bound, build_int_cst (TREE_TYPE (bound), 0));\n \t  if (as && as->type == AS_ASSUMED_RANK)\n-\t    tmp = get_rank_from_desc (desc);\n+\t    tmp = gfc_conv_descriptor_rank (desc);\n \t  else\n \t    tmp = gfc_rank_cst[GFC_TYPE_ARRAY_RANK (TREE_TYPE (desc))];\n           tmp = fold_build2_loc (input_location, GE_EXPR, boolean_type_node,\n@@ -5895,7 +5881,7 @@ gfc_conv_associated (gfc_se *se, gfc_expr *expr)\n \t  gfc_conv_expr_lhs (&arg1se, arg1->expr);\n \t  if (arg1->expr->rank == -1)\n \t    {\n-\t      tmp = get_rank_from_desc (arg1se.expr);\n+\t      tmp = gfc_conv_descriptor_rank (arg1se.expr);\n \t      tmp = fold_build2_loc (input_location, MINUS_EXPR,\n \t\t\t\t     TREE_TYPE (tmp), tmp, gfc_index_one_node);\n \t    }"}]}