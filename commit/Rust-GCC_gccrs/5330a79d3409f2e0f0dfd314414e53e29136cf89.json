{"sha": "5330a79d3409f2e0f0dfd314414e53e29136cf89", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTMzMGE3OWQzNDA5ZjJlMGYwZGZkMzE0NDE0ZTUzZTI5MTM2Y2Y4OQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2015-10-12T06:08:06Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2015-10-12T06:08:06Z"}, "message": "cgraphbuild.c (compute_call_stmt_bb_frequency): Use counts when these are more informative.\n\n\n\t* cgraphbuild.c (compute_call_stmt_bb_frequency): Use\n\tcounts when these are more informative.\n\nFrom-SVN: r228703", "tree": {"sha": "d4accf58de2a34e8123d341b92a7158299ca171e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d4accf58de2a34e8123d341b92a7158299ca171e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5330a79d3409f2e0f0dfd314414e53e29136cf89", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5330a79d3409f2e0f0dfd314414e53e29136cf89", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5330a79d3409f2e0f0dfd314414e53e29136cf89", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5330a79d3409f2e0f0dfd314414e53e29136cf89/comments", "author": null, "committer": null, "parents": [{"sha": "86b7136a66a19238434916c6a6f5e9fe1c4ad54e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/86b7136a66a19238434916c6a6f5e9fe1c4ad54e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/86b7136a66a19238434916c6a6f5e9fe1c4ad54e"}], "stats": {"total": 21, "additions": 16, "deletions": 5}, "files": [{"sha": "5d38bf67c982916cadb9d90d72b9a567d3c38390", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5330a79d3409f2e0f0dfd314414e53e29136cf89/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5330a79d3409f2e0f0dfd314414e53e29136cf89/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5330a79d3409f2e0f0dfd314414e53e29136cf89", "patch": "@@ -1,3 +1,8 @@\n+2015-10-11  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* cgraphbuild.c (compute_call_stmt_bb_frequency): Use\n+\tcounts when these are more informative.\n+\n 2015-10-11  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* tree-profile.c (tree_profiling): Do not clear"}, {"sha": "a7b4af6d9fb3aa44347f8ea5ae1a7be83bd6d013", "filename": "gcc/cgraphbuild.c", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5330a79d3409f2e0f0dfd314414e53e29136cf89/gcc%2Fcgraphbuild.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5330a79d3409f2e0f0dfd314414e53e29136cf89/gcc%2Fcgraphbuild.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraphbuild.c?ref=5330a79d3409f2e0f0dfd314414e53e29136cf89", "patch": "@@ -202,15 +202,21 @@ compute_call_stmt_bb_frequency (tree decl, basic_block bb)\n {\n   int entry_freq = ENTRY_BLOCK_PTR_FOR_FN\n   \t\t     (DECL_STRUCT_FUNCTION (decl))->frequency;\n-  int freq = bb->frequency;\n+  gcov_type entry_count = ENTRY_BLOCK_PTR_FOR_FN\n+\t\t\t    (DECL_STRUCT_FUNCTION (decl))->count;\n+  gcov_type freq = bb->frequency;\n \n   if (profile_status_for_fn (DECL_STRUCT_FUNCTION (decl)) == PROFILE_ABSENT)\n     return CGRAPH_FREQ_BASE;\n \n-  if (!entry_freq)\n-    entry_freq = 1, freq++;\n-\n-  freq = freq * CGRAPH_FREQ_BASE / entry_freq;\n+  if (entry_count > entry_freq)\n+    freq = RDIV (bb->count * CGRAPH_FREQ_BASE, entry_count);\n+  else\n+    {\n+      if (!entry_freq)\n+        entry_freq = 1, freq++;\n+      freq = RDIV (freq * CGRAPH_FREQ_BASE, entry_freq);\n+    }\n   if (freq > CGRAPH_FREQ_MAX)\n     freq = CGRAPH_FREQ_MAX;\n "}]}