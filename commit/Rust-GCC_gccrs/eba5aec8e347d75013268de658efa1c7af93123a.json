{"sha": "eba5aec8e347d75013268de658efa1c7af93123a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWJhNWFlYzhlMzQ3ZDc1MDEzMjY4ZGU2NThlZmExYzdhZjkzMTIzYQ==", "commit": {"author": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2016-11-08T16:10:56Z"}, "committer": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2016-11-08T16:10:56Z"}, "message": "re PR fortran/77596 ([F03] procedure pointer component with implicit interface can point to a function)\n\n2016-11-08  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/77596\n\t* expr.c (gfc_check_pointer_assign): Add special check for procedure-\n\tpointer component with absent interface.\n\n2016-11-08  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/77596\n\t* gfortran.dg/proc_ptr_comp_46.f90: New test.\n\nFrom-SVN: r241972", "tree": {"sha": "bb815f15e29ab605ae862ca0d66b1ca1dc275e52", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bb815f15e29ab605ae862ca0d66b1ca1dc275e52"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/eba5aec8e347d75013268de658efa1c7af93123a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eba5aec8e347d75013268de658efa1c7af93123a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eba5aec8e347d75013268de658efa1c7af93123a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eba5aec8e347d75013268de658efa1c7af93123a/comments", "author": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c22d8787165e1d8f835bfc3a5e5802c286ace31a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c22d8787165e1d8f835bfc3a5e5802c286ace31a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c22d8787165e1d8f835bfc3a5e5802c286ace31a"}], "stats": {"total": 67, "additions": 58, "deletions": 9}, "files": [{"sha": "d3c16994ccac7f5fac248234e92d459d94a8e023", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eba5aec8e347d75013268de658efa1c7af93123a/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eba5aec8e347d75013268de658efa1c7af93123a/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=eba5aec8e347d75013268de658efa1c7af93123a", "patch": "@@ -1,3 +1,9 @@\n+2016-11-08  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/77596\n+\t* expr.c (gfc_check_pointer_assign): Add special check for procedure-\n+\tpointer component with absent interface.\n+\n 2016-11-07  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/78226"}, {"sha": "f059c3c1efa6acb8e5d36e77bab055425cd0001e", "filename": "gcc/fortran/expr.c", "status": "modified", "additions": 18, "deletions": 9, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eba5aec8e347d75013268de658efa1c7af93123a/gcc%2Ffortran%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eba5aec8e347d75013268de658efa1c7af93123a/gcc%2Ffortran%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fexpr.c?ref=eba5aec8e347d75013268de658efa1c7af93123a", "patch": "@@ -3445,7 +3445,7 @@ gfc_check_pointer_assign (gfc_expr *lvalue, gfc_expr *rvalue)\n     {\n       char err[200];\n       gfc_symbol *s1,*s2;\n-      gfc_component *comp;\n+      gfc_component *comp1, *comp2;\n       const char *name;\n \n       attr = gfc_expr_attr (rvalue);\n@@ -3549,28 +3549,28 @@ gfc_check_pointer_assign (gfc_expr *lvalue, gfc_expr *rvalue)\n \t    }\n \t}\n \n-      comp = gfc_get_proc_ptr_comp (lvalue);\n-      if (comp)\n-\ts1 = comp->ts.interface;\n+      comp1 = gfc_get_proc_ptr_comp (lvalue);\n+      if (comp1)\n+\ts1 = comp1->ts.interface;\n       else\n \t{\n \t  s1 = lvalue->symtree->n.sym;\n \t  if (s1->ts.interface)\n \t    s1 = s1->ts.interface;\n \t}\n \n-      comp = gfc_get_proc_ptr_comp (rvalue);\n-      if (comp)\n+      comp2 = gfc_get_proc_ptr_comp (rvalue);\n+      if (comp2)\n \t{\n \t  if (rvalue->expr_type == EXPR_FUNCTION)\n \t    {\n-\t      s2 = comp->ts.interface->result;\n+\t      s2 = comp2->ts.interface->result;\n \t      name = s2->name;\n \t    }\n \t  else\n \t    {\n-\t      s2 = comp->ts.interface;\n-\t      name = comp->name;\n+\t      s2 = comp2->ts.interface;\n+\t      name = comp2->name;\n \t    }\n \t}\n       else if (rvalue->expr_type == EXPR_FUNCTION)\n@@ -3591,6 +3591,15 @@ gfc_check_pointer_assign (gfc_expr *lvalue, gfc_expr *rvalue)\n       if (s2 && s2->attr.proc_pointer && s2->ts.interface)\n \ts2 = s2->ts.interface;\n \n+      /* Special check for the case of absent interface on the lvalue.\n+       * All other interface checks are done below. */\n+      if (!s1 && comp1 && comp1->attr.subroutine && s2 && s2->attr.function)\n+\t{\n+\t  gfc_error (\"Interface mismatch in procedure pointer assignment \"\n+\t\t     \"at %L: '%s' is not a subroutine\", &rvalue->where, name);\n+\t  return false;\n+\t}\n+\n       if (s1 == s2 || !s1 || !s2)\n \treturn true;\n "}, {"sha": "721b8f2ea6a18a6daacca431a9504c5d49f85374", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eba5aec8e347d75013268de658efa1c7af93123a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eba5aec8e347d75013268de658efa1c7af93123a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=eba5aec8e347d75013268de658efa1c7af93123a", "patch": "@@ -1,3 +1,8 @@\n+2016-11-08  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/77596\n+\t* gfortran.dg/proc_ptr_comp_46.f90: New test.\n+\n 2016-11-08  Bin Cheng  <bin.cheng@arm.com>\n \n \t* gcc.dg/vect/pr56541.c: Xfail on !vect_cond_mixed targets."}, {"sha": "c01b82212108e02d815f25ef92afa48045e51e53", "filename": "gcc/testsuite/gfortran.dg/proc_ptr_comp_46.f90", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eba5aec8e347d75013268de658efa1c7af93123a/gcc%2Ftestsuite%2Fgfortran.dg%2Fproc_ptr_comp_46.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eba5aec8e347d75013268de658efa1c7af93123a/gcc%2Ftestsuite%2Fgfortran.dg%2Fproc_ptr_comp_46.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fproc_ptr_comp_46.f90?ref=eba5aec8e347d75013268de658efa1c7af93123a", "patch": "@@ -0,0 +1,29 @@\n+! { dg-do compile }\n+!\n+! PR 77596: [F03] procedure pointer component with implicit interface can point to a function\n+!\n+! Contributed by toK <t.kondic@leeds.ac.uk>\n+\n+program xxx\n+  implicit none\n+\n+  type tf\n+     procedure(), nopass, pointer :: fp\n+  end type tf\n+\n+  call ass()\n+\n+contains\n+\n+  integer function ff(x)\n+    integer, intent(in) :: x\n+    ff = x + 1\n+  end function ff\n+\n+  subroutine ass()\n+    type(tf) :: p\n+    p%fp=>ff        ! { dg-error \"is not a subroutine\" }\n+    call p%fp(3)\n+  end subroutine ass\n+\n+end"}]}