{"sha": "f9764ea128c99ba1c10de21a092266cd7da8700a", "node_id": "C_kwDOANBUbNoAKGY5NzY0ZWExMjhjOTliYTFjMTBkZTIxYTA5MjI2NmNkN2RhODcwMGE", "commit": {"author": {"name": "Kewen Lin", "email": "linkw@linux.ibm.com", "date": "2022-06-28T02:50:26Z"}, "committer": {"name": "Kewen Lin", "email": "linkw@linux.ibm.com", "date": "2022-06-28T02:50:26Z"}, "message": "rs6000: Simplify *rotl<mode>3_insert_4 by removing DImode\n\ndefine_insn *rotl<mode>3_insert_4 use mode iterator GPR which\nconsists of SImode and conditional DImode, but the condition\nof this define_insn requires the mode should be SImode.  By\nfurther checking, it's found that the rldimi instruction can\nnot be used for this pattern since the required mask can not\nbe represented correctly.  We can have the fixed mask end 31\nwith rlwimi, but can not have the fixed mask end 63 with\nrldimi as it has to be (63 - SH) always.\n\nSo this patch simplifies this define_insn to use SImode only.\n\ngcc/ChangeLog:\n\n\t* config/rs6000/rs6000.md (*rotl<mode>3_insert_4): Replace mode\n\titerator GPR with SImode, adjust the condition and output template,\n\trename to ...\n\t(*rotlsi3_insert_4): ... this.", "tree": {"sha": "84f978f3999729bfe3fc2d46704bc777365dd9ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/84f978f3999729bfe3fc2d46704bc777365dd9ba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f9764ea128c99ba1c10de21a092266cd7da8700a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f9764ea128c99ba1c10de21a092266cd7da8700a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f9764ea128c99ba1c10de21a092266cd7da8700a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f9764ea128c99ba1c10de21a092266cd7da8700a/comments", "author": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9d3dd2185651c0a70919f6f3a35841cab68a81a6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d3dd2185651c0a70919f6f3a35841cab68a81a6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9d3dd2185651c0a70919f6f3a35841cab68a81a6"}], "stats": {"total": 25, "additions": 8, "deletions": 17}, "files": [{"sha": "1367a2cb779dee8c81fec1cf72d5a1a6e246b992", "filename": "gcc/config/rs6000/rs6000.md", "status": "modified", "additions": 8, "deletions": 17, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f9764ea128c99ba1c10de21a092266cd7da8700a/gcc%2Fconfig%2Frs6000%2Frs6000.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f9764ea128c99ba1c10de21a092266cd7da8700a/gcc%2Fconfig%2Frs6000%2Frs6000.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.md?ref=f9764ea128c99ba1c10de21a092266cd7da8700a", "patch": "@@ -4225,23 +4225,14 @@\n   operands[4] = GEN_INT ((HOST_WIDE_INT_1U << INTVAL (operands[2])) - 1);\n })\n \n-(define_insn \"*rotl<mode>3_insert_4\"\n-  [(set (match_operand:GPR 0 \"gpc_reg_operand\" \"=r\")\n-\t(ior:GPR (and:GPR (match_operand:GPR 3 \"gpc_reg_operand\" \"0\")\n-\t\t\t  (match_operand:GPR 4 \"const_int_operand\" \"n\"))\n-\t\t (lshiftrt:GPR (match_operand:GPR 1 \"gpc_reg_operand\" \"r\")\n-\t\t\t       (match_operand:SI 2 \"const_int_operand\" \"n\"))))]\n-  \"<MODE>mode == SImode &&\n-   GET_MODE_PRECISION (<MODE>mode)\n-   == INTVAL (operands[2]) + exact_log2 (-UINTVAL (operands[4]))\"\n-{\n-  operands[2] = GEN_INT (GET_MODE_PRECISION (<MODE>mode)\n-\t\t\t - INTVAL (operands[2]));\n-  if (<MODE>mode == SImode)\n-    return \"rlwimi %0,%1,%h2,32-%h2,31\";\n-  else\n-    return \"rldimi %0,%1,%H2,64-%H2\";\n-}\n+(define_insn \"*rotlsi3_insert_4\"\n+  [(set (match_operand:SI 0 \"gpc_reg_operand\" \"=r\")\n+\t(ior:SI (and:SI (match_operand:SI 3 \"gpc_reg_operand\" \"0\")\n+\t\t\t(match_operand:SI 4 \"const_int_operand\" \"n\"))\n+\t\t(lshiftrt:SI (match_operand:SI 1 \"gpc_reg_operand\" \"r\")\n+\t\t\t     (match_operand:SI 2 \"const_int_operand\" \"n\"))))]\n+  \"INTVAL (operands[2]) + exact_log2 (-UINTVAL (operands[4])) == 32\"\n+  \"rlwimi %0,%1,32-%h2,%h2,31\"\n   [(set_attr \"type\" \"insert\")])\n \n (define_insn \"*rotlsi3_insert_5\""}]}