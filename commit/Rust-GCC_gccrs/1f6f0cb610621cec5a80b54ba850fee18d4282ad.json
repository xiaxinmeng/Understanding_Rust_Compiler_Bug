{"sha": "1f6f0cb610621cec5a80b54ba850fee18d4282ad", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWY2ZjBjYjYxMDYyMWNlYzVhODBiNTRiYTg1MGZlZTE4ZDQyODJhZA==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2003-04-29T22:15:34Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2003-04-29T22:15:34Z"}, "message": "re PR c++/10551 (Failure to emit explicitly instantiated template w/--no-implicit-templates)\n\n\tPR c++/10551\n\t* pt.c (mark_decl_instantiated): Defer all explicit instantiations\n\tthat have not yet been written out.\n\n\tPR c++/10551\n\t* g++.dg/template/explicit1.C: New test.\n\nFrom-SVN: r66263", "tree": {"sha": "01084a77e16fc0970395d29f0d377781f92e0c60", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/01084a77e16fc0970395d29f0d377781f92e0c60"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1f6f0cb610621cec5a80b54ba850fee18d4282ad", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f6f0cb610621cec5a80b54ba850fee18d4282ad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1f6f0cb610621cec5a80b54ba850fee18d4282ad", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f6f0cb610621cec5a80b54ba850fee18d4282ad/comments", "author": null, "committer": null, "parents": [{"sha": "51dc3d74f84691bda6b24b495ec8cd0f9e52460d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51dc3d74f84691bda6b24b495ec8cd0f9e52460d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/51dc3d74f84691bda6b24b495ec8cd0f9e52460d"}], "stats": {"total": 46, "additions": 40, "deletions": 6}, "files": [{"sha": "f255e1390b1d79232198679e73f8642f47e54473", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f6f0cb610621cec5a80b54ba850fee18d4282ad/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f6f0cb610621cec5a80b54ba850fee18d4282ad/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=1f6f0cb610621cec5a80b54ba850fee18d4282ad", "patch": "@@ -1,3 +1,9 @@\n+2003-04-29  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/10551\n+\t* pt.c (mark_decl_instantiated): Defer all explicit instantiations\n+\tthat have not yet been written out.\n+\n 2003-04-29  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/10549"}, {"sha": "52df60b59cf84991e6697fe88878fe87d817f14d", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f6f0cb610621cec5a80b54ba850fee18d4282ad/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f6f0cb610621cec5a80b54ba850fee18d4282ad/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=1f6f0cb610621cec5a80b54ba850fee18d4282ad", "patch": "@@ -9915,11 +9915,6 @@ mark_decl_instantiated (result, extern_p)\n      tree result;\n      int extern_p;\n {\n-  if (TREE_CODE (result) != FUNCTION_DECL)\n-    /* The TREE_PUBLIC flag for function declarations will have been\n-       set correctly by tsubst.  */\n-    TREE_PUBLIC (result) = 1;\n-\n   /* We used to set this unconditionally; we moved that to\n      do_decl_instantiation so it wouldn't get set on members of\n      explicit class template instantiations.  But we still need to set\n@@ -9928,6 +9923,16 @@ mark_decl_instantiated (result, extern_p)\n   if (extern_p)\n     SET_DECL_EXPLICIT_INSTANTIATION (result);\n \n+  /* If this entity has already been written out, it's too late to\n+     make any modifications.  */\n+  if (TREE_ASM_WRITTEN (result))\n+    return;\n+\n+  if (TREE_CODE (result) != FUNCTION_DECL)\n+    /* The TREE_PUBLIC flag for function declarations will have been\n+       set correctly by tsubst.  */\n+    TREE_PUBLIC (result) = 1;\n+\n   if (! extern_p)\n     {\n       DECL_INTERFACE_KNOWN (result) = 1;\n@@ -9941,7 +9946,8 @@ mark_decl_instantiated (result, extern_p)\n       else if (TREE_PUBLIC (result))\n \tmaybe_make_one_only (result);\n     }\n-  else if (TREE_CODE (result) == FUNCTION_DECL)\n+\n+  if (TREE_CODE (result) == FUNCTION_DECL)\n     defer_fn (result);\n }\n "}, {"sha": "4a0d42cbea2577395f9dda27af021b7425afce9a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f6f0cb610621cec5a80b54ba850fee18d4282ad/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f6f0cb610621cec5a80b54ba850fee18d4282ad/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1f6f0cb610621cec5a80b54ba850fee18d4282ad", "patch": "@@ -1,3 +1,8 @@\n+2003-04-29  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/10551\n+\t* g++.dg/template/explicit1.C: New test.\n+\n 2003-04-29  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/10549"}, {"sha": "64f581e58dfc5d8d7604db2bd3a28bbc52834833", "filename": "gcc/testsuite/g++.dg/template/explicit1.C", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f6f0cb610621cec5a80b54ba850fee18d4282ad/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fexplicit1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f6f0cb610621cec5a80b54ba850fee18d4282ad/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fexplicit1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fexplicit1.C?ref=1f6f0cb610621cec5a80b54ba850fee18d4282ad", "patch": "@@ -0,0 +1,17 @@\n+// { dg-do link }\n+// { dg-options \"-fno-implicit-templates\" }\n+\n+template <class T> struct C {\n+  ~C();\n+};\n+template <class T> C<T>::~C() {}\n+\n+struct X {\n+  C<X> *p;\n+  ~X() { delete p; }\n+};\n+\n+template class C<X>;\n+C<X> x;\n+\n+int main () {}"}]}