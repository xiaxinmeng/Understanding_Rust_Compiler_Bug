{"sha": "4efde6781bba8d64b9dcff07e7efe71d35aa6f6a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGVmZGU2NzgxYmJhOGQ2NGI5ZGNmZjA3ZTdlZmU3MWQzNWFhNmY2YQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2020-12-14T19:40:44Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2020-12-15T15:43:23Z"}, "message": "c++: Modules Is Landing\n\nThis is the C++ modules implementation.  Dropping in the real\nmodule.cc file into the module-shaped hole I carved out.  I include\nsome sanity tests for now.  I'll commit the remaining tests when the\ninitial round of failures seems abated.\n\n\tgcc/cp/\n\t* module.cc: Replace stubs with implementation.\n\tgcc/testsuite/\n\t* g++.dg/modules/mod-decl-0-2a.C: New.\n\t* g++.dg/modules/mod-decl-0.C: New.\n\t* g++.dg/modules/mod-decl-1.C: New.\n\t* g++.dg/modules/mod-decl-2_a.C: New.\n\t* g++.dg/modules/mod-decl-2_b.C: New.\n\t* g++.dg/modules/mod-decl-2_c.C: New.\n\t* g++.dg/modules/mod-decl-3.C: New.\n\t* g++.dg/modules/mod-decl-5_a.C: New.\n\t* g++.dg/modules/mod-decl-5_b.C: New.", "tree": {"sha": "b5d1ce72629fac6faca3dd3b40c03cb2007549c6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b5d1ce72629fac6faca3dd3b40c03cb2007549c6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b7dfc2074c78415d451eb34d1608016c80b1c41a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b7dfc2074c78415d451eb34d1608016c80b1c41a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b7dfc2074c78415d451eb34d1608016c80b1c41a"}], "stats": {"total": 19910, "additions": 19843, "deletions": 67}, "files": [{"sha": "1b40a72a0d6085dd528d69ae889949f4b78abd5c", "filename": "gcc/cp/module.cc", "status": "modified", "additions": 19735, "deletions": 67, "changes": 19802, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Fcp%2Fmodule.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Fcp%2Fmodule.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fmodule.cc?ref=4efde6781bba8d64b9dcff07e7efe71d35aa6f6a"}, {"sha": "75406f80eea4716a61291ed734a3b0c30c34547c", "filename": "gcc/testsuite/g++.dg/modules/mod-decl-0-2a.C", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-0-2a.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-0-2a.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-0-2a.C?ref=4efde6781bba8d64b9dcff07e7efe71d35aa6f6a", "patch": "@@ -0,0 +1,6 @@\n+// { dg-options \"-fno-modules -std=c++2a\" }\n+\n+export // { dg-message \"enabled with\" }\n+module nope; // { dg-error \"not name a type\" }\n+// { dg-message \"only available with .-fmodules.\" \"\" { target *-*-* } .-1 }\n+// { dg-module-cmi \"!nope\" }"}, {"sha": "fcafc0bfd0a0373aa1214d6479c581d89ffe405a", "filename": "gcc/testsuite/g++.dg/modules/mod-decl-0.C", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-0.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-0.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-0.C?ref=4efde6781bba8d64b9dcff07e7efe71d35aa6f6a", "patch": "@@ -0,0 +1,6 @@\n+// { dg-options \"-fno-modules -std=c++17\" }\n+\n+export // { dg-message \"ignored\" }\n+module nope; // { dg-error \"not name a type\" }\n+// { dg-message \"only available with .-fmodules.\" \"\" { target *-*-* } .-1 }\n+// { dg-module-cmi \"!nope\" }"}, {"sha": "b2665bec7437a551495a0857091b538feec7a3ec", "filename": "gcc/testsuite/g++.dg/modules/mod-decl-1.C", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-1.C?ref=4efde6781bba8d64b9dcff07e7efe71d35aa6f6a", "patch": "@@ -0,0 +1,29 @@\n+// { dg-additional-options \"-fmodules-ts\" }\n+module;\n+\n+export module frist;\n+// { dg-module-cmi \"!frist\" }\n+\n+import frist; // { dg-error {cannot import module.* in its own purview} }\n+\n+module foo.second; // { dg-error \"not permitted here\" }\n+\n+namespace Foo \n+{\n+module third;  // { dg-error \"not permitted here\" }\n+}\n+\n+struct Baz\n+{\n+  module forth; // { dg-error \"expected\" }\n+};\n+\n+void Bink ()\n+{\n+  module fifth; // { dg-error \"expected\" }\n+}\n+\n+module a.; // { dg-error \"not permitted\" }\n+\n+// { dg-prune-output \"not writing module\" }\n+"}, {"sha": "9b4a92023cfa4daf0b01cc396c947dd5fa23df4a", "filename": "gcc/testsuite/g++.dg/modules/mod-decl-2_a.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-2_a.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-2_a.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-2_a.C?ref=4efde6781bba8d64b9dcff07e7efe71d35aa6f6a", "patch": "@@ -0,0 +1,8 @@\n+// { dg-additional-options \"-fmodules-ts\" }\n+export module bob;\n+// { dg-module-cmi \"bob\" }\n+export void Foo ();\n+export \n+{\n+  void Bar ();\n+}"}, {"sha": "a3ea9b5aa6ac53fceba2c61dff427da8ab479334", "filename": "gcc/testsuite/g++.dg/modules/mod-decl-2_b.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-2_b.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-2_b.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-2_b.C?ref=4efde6781bba8d64b9dcff07e7efe71d35aa6f6a", "patch": "@@ -0,0 +1,11 @@\n+// { dg-additional-options \"-fmodules-ts\" }\n+module bob;\n+\n+import bob; // { dg-error \"cannot import module.* in its own purview\" }\n+\n+// module linkage\n+void Baz ()\n+{\n+  Foo ();\n+  Bar ();\n+}"}, {"sha": "4808ad2b0de66d60a34aa0398419083bce6b98dd", "filename": "gcc/testsuite/g++.dg/modules/mod-decl-2_c.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-2_c.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-2_c.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-2_c.C?ref=4efde6781bba8d64b9dcff07e7efe71d35aa6f6a", "patch": "@@ -0,0 +1,8 @@\n+// { dg-additional-options \"-fmodules-ts\" }\n+import bob;\n+\n+void Baz ()\n+{\n+  Foo ();\n+  Bar ();\n+}"}, {"sha": "16fa5a85a565d200870ad9d6070875bc4f9e7009", "filename": "gcc/testsuite/g++.dg/modules/mod-decl-3.C", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-3.C?ref=4efde6781bba8d64b9dcff07e7efe71d35aa6f6a", "patch": "@@ -0,0 +1,26 @@\n+// { dg-additional-options \"-fmodules-ts -Wno-pedantic\" }\n+module;\n+# 4 \"mod-decl-3.C\" 1\n+export void Foo (); // { dg-error \"after a module interface\" }\n+\n+# 7 \"\" 2\n+export module bob;\n+// { dg-module-cmi \"!bob\" }\n+\n+export\n+export // { dg-error \"occur once\" }\n+void Baz ();\n+\n+export \n+{\n+  export // { dg-error \"occur once\" }\n+    void Bar ();\n+}\n+\n+namespace Bink\n+{\n+  import  // { dg-error \"does not name\" }\n+  ben;\n+}\n+\n+// { dg-prune-output \"not writing module\" }"}, {"sha": "c39807dbe9ddd25b7a4464836c9934d2bc3b51b0", "filename": "gcc/testsuite/g++.dg/modules/mod-decl-5_a.C", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-5_a.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-5_a.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-5_a.C?ref=4efde6781bba8d64b9dcff07e7efe71d35aa6f6a", "patch": "@@ -0,0 +1,3 @@\n+// { dg-additional-options \"-fmodules-ts\" }\n+export module thing.baz;\n+// { dg-module-cmi \"thing.baz\" }"}, {"sha": "b3eea76421a6eb72ab9b70685058aac069e3cec5", "filename": "gcc/testsuite/g++.dg/modules/mod-decl-5_b.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-5_b.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4efde6781bba8d64b9dcff07e7efe71d35aa6f6a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-5_b.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fmod-decl-5_b.C?ref=4efde6781bba8d64b9dcff07e7efe71d35aa6f6a", "patch": "@@ -0,0 +1,11 @@\n+// { dg-additional-options \"-fmodules-ts -Wno-pedantic\" }\n+module;\n+# 4 \"gmf\" 1\n+import thing.baz;\n+\n+export int foo (); // { dg-error \"after a module interface\" }\n+# 8 \"\" 2\n+export module thing.baz; // { dg-error \"module already imported\" }\n+\n+import thing.baz;\n+"}]}