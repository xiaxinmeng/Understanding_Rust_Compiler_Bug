{"sha": "9aee04a4c032b075d07bdde6f8bd22b06d709f42", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWFlZTA0YTRjMDMyYjA3NWQwN2JkZGU2ZjhiZDIyYjA2ZDcwOWY0Mg==", "commit": {"author": {"name": "Ville Voutilainen", "email": "ville.voutilainen@gmail.com", "date": "2018-04-05T14:43:55Z"}, "committer": {"name": "Ville Voutilainen", "email": "ville@gcc.gnu.org", "date": "2018-04-05T14:43:55Z"}, "message": "Implement P0969\n\ngcc/cp\n\nImplement P0969\n* decl.c (find_decomp_class_base): Check accessibility instead\nof declared access, adjust diagnostic.\n\ntestsuite/\n\nImplement P0969\n* g++.dg/cpp1z/decomp4.C: Adjust.\n* g++.dg/cpp1z/decomp38.C: New.\n\nFrom-SVN: r259129", "tree": {"sha": "562daa37ae4c3d95dbc0c2f235be8ce4c59101c0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/562daa37ae4c3d95dbc0c2f235be8ce4c59101c0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9aee04a4c032b075d07bdde6f8bd22b06d709f42", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9aee04a4c032b075d07bdde6f8bd22b06d709f42", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9aee04a4c032b075d07bdde6f8bd22b06d709f42", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9aee04a4c032b075d07bdde6f8bd22b06d709f42/comments", "author": {"login": "villevoutilainen", "id": 963599, "node_id": "MDQ6VXNlcjk2MzU5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/963599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/villevoutilainen", "html_url": "https://github.com/villevoutilainen", "followers_url": "https://api.github.com/users/villevoutilainen/followers", "following_url": "https://api.github.com/users/villevoutilainen/following{/other_user}", "gists_url": "https://api.github.com/users/villevoutilainen/gists{/gist_id}", "starred_url": "https://api.github.com/users/villevoutilainen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/villevoutilainen/subscriptions", "organizations_url": "https://api.github.com/users/villevoutilainen/orgs", "repos_url": "https://api.github.com/users/villevoutilainen/repos", "events_url": "https://api.github.com/users/villevoutilainen/events{/privacy}", "received_events_url": "https://api.github.com/users/villevoutilainen/received_events", "type": "User", "site_admin": false}, "committer": {"login": "villevoutilainen", "id": 963599, "node_id": "MDQ6VXNlcjk2MzU5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/963599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/villevoutilainen", "html_url": "https://github.com/villevoutilainen", "followers_url": "https://api.github.com/users/villevoutilainen/followers", "following_url": "https://api.github.com/users/villevoutilainen/following{/other_user}", "gists_url": "https://api.github.com/users/villevoutilainen/gists{/gist_id}", "starred_url": "https://api.github.com/users/villevoutilainen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/villevoutilainen/subscriptions", "organizations_url": "https://api.github.com/users/villevoutilainen/orgs", "repos_url": "https://api.github.com/users/villevoutilainen/repos", "events_url": "https://api.github.com/users/villevoutilainen/events{/privacy}", "received_events_url": "https://api.github.com/users/villevoutilainen/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0fb90182d8698bf65774f25431567cd70be25faf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0fb90182d8698bf65774f25431567cd70be25faf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0fb90182d8698bf65774f25431567cd70be25faf"}], "stats": {"total": 62, "additions": 58, "deletions": 4}, "files": [{"sha": "37d82bd8c4b3f566e1b887a05c7e877e7dcfa0c3", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9aee04a4c032b075d07bdde6f8bd22b06d709f42/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9aee04a4c032b075d07bdde6f8bd22b06d709f42/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=9aee04a4c032b075d07bdde6f8bd22b06d709f42", "patch": "@@ -1,3 +1,9 @@\n+2018-04-05  Ville Voutilainen  <ville.voutilainen@gmail.com>\n+\n+\tImplement P0969\n+\t* decl.c (find_decomp_class_base): Check accessibility instead\n+\tof declared access, adjust diagnostic.\n+\n 2018-04-05  Ville Voutilainen  <ville.voutilainen@gmail.com>\n \n \tImplement P0961"}, {"sha": "b2e509e4d05c36da8892dec8b742c5421c2e49d7", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9aee04a4c032b075d07bdde6f8bd22b06d709f42/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9aee04a4c032b075d07bdde6f8bd22b06d709f42/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=9aee04a4c032b075d07bdde6f8bd22b06d709f42", "patch": "@@ -7322,9 +7322,9 @@ find_decomp_class_base (location_t loc, tree type, tree ret)\n \tinform (DECL_SOURCE_LOCATION (field), \"declared here\");\n \treturn error_mark_node;\n       }\n-    else if (TREE_PRIVATE (field) || TREE_PROTECTED (field))\n+    else if (!accessible_p (type, field, true))\n       {\n-\terror_at (loc, \"cannot decompose non-public member %qD of %qT\",\n+\terror_at (loc, \"cannot decompose inaccessible member %qD of %qT\",\n \t\t  field, type);\n \tinform (DECL_SOURCE_LOCATION (field),\n \t\tTREE_PRIVATE (field)"}, {"sha": "fc69c02e4d39c45db5ba304021fe1f64755c82bb", "filename": "gcc/testsuite/g++.dg/cpp1z/decomp38.C", "status": "added", "additions": 48, "deletions": 0, "changes": 48, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9aee04a4c032b075d07bdde6f8bd22b06d709f42/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fdecomp38.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9aee04a4c032b075d07bdde6f8bd22b06d709f42/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fdecomp38.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fdecomp38.C?ref=9aee04a4c032b075d07bdde6f8bd22b06d709f42", "patch": "@@ -0,0 +1,48 @@\n+// { dg-additional-options -std=c++17 }\n+// { dg-do compile }\n+\n+class X\n+{\n+   int a, b;\n+   void f()\n+   {\n+     auto[x,y] = *this;\n+   }\n+};\n+\n+class X2\n+{\n+   int a, b;\n+   void f(X2& other)\n+   {\n+     auto[x,y] = other;\n+   }\n+};\n+\n+struct X3\n+{\n+  friend void foo();\n+private:\n+  int a;\n+};\n+\n+void foo()\n+{\n+  X3 x;\n+  auto [a] = x;\n+}\n+\n+struct X4\n+{\n+  int a;\n+};\n+\n+struct X5 : private X4\n+{\n+  friend void foo2();\n+};\n+\n+void foo2() {\n+  X5 x;\n+  auto [a] = x;\n+}"}, {"sha": "69b5455df3b94f43ac6eb644630f77c0f661ef83", "filename": "gcc/testsuite/g++.dg/cpp1z/decomp4.C", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9aee04a4c032b075d07bdde6f8bd22b06d709f42/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fdecomp4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9aee04a4c032b075d07bdde6f8bd22b06d709f42/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fdecomp4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fdecomp4.C?ref=9aee04a4c032b075d07bdde6f8bd22b06d709f42", "patch": "@@ -18,10 +18,10 @@ test (A &a, B &b, C &c, D &d, E &e, F &f, G &g, H &h, I &i)\n \t\t\t\t\t// { dg-warning \"structured bindings only available with -std=c..17 or -std=gnu..17\" \"\" { target c++14_down } .-1 }\n   auto [ k ] { b };\t\t\t// { dg-error \"cannot decompose class type 'B' because it has an anonymous union member\" }\n \t\t\t\t\t// { dg-warning \"structured bindings only available with -std=c..17 or -std=gnu..17\" \"\" { target c++14_down } .-1 }\n-  auto [ l, l2 ] = c;\t\t\t// { dg-error \"cannot decompose non-public member 'C::b' of 'C'\" }\n+  auto [ l, l2 ] = c;\t\t\t// { dg-error \"cannot decompose inaccessible member 'C::b' of 'C'\" }\n \t\t\t\t\t// { dg-warning \"structured bindings only available with -std=c..17 or -std=gnu..17\" \"\" { target c++14_down } .-1 }\n   auto [ m ] = d;\t\t\t// { dg-warning \"structured bindings only available with -std=c..17 or -std=gnu..17\" \"\" { target c++14_down } }\n-  auto [ n ] { e };\t\t\t// { dg-error \"cannot decompose non-public member 'E::a' of 'E'\" }\n+  auto [ n ] { e };\t\t\t// { dg-error \"cannot decompose inaccessible member 'E::a' of 'E'\" }\n \t\t\t\t\t// { dg-warning \"structured bindings only available with -std=c..17 or -std=gnu..17\" \"\" { target c++14_down } .-1 }\n   auto [ o ] { f };\t\t\t// { dg-warning \"structured bindings only available with -std=c..17 or -std=gnu..17\" \"\" { target c++14_down } }\n   auto & [ p ] { g };\t\t\t// { dg-error \"cannot decompose class type 'G': both it and its base class 'F' have non-static data members\" }"}]}