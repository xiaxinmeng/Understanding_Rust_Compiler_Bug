{"sha": "121075d7601b521973522cce134567beb0c913bb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTIxMDc1ZDc2MDFiNTIxOTczNTIyY2NlMTM0NTY3YmViMGM5MTNiYg==", "commit": {"author": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2017-11-20T19:52:14Z"}, "committer": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2017-11-20T19:52:14Z"}, "message": "i386.md (bswaphi2): New expander.\n\n\t* config/i386/i386.md (bswaphi2): New expander.\n\t(*bswaphi2_movbe): New insn pattern.\n\t(bswaphi -> rorhi pepehole2): New peephole pattern.\n\ntestsuite/ChangeLog:\n\n\t* gcc.target/i386/movbe-5.c: New test.\n\nFrom-SVN: r254967", "tree": {"sha": "13999dbb8d9dde6155bbfa0707f25258a840b4cd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/13999dbb8d9dde6155bbfa0707f25258a840b4cd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/121075d7601b521973522cce134567beb0c913bb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/121075d7601b521973522cce134567beb0c913bb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/121075d7601b521973522cce134567beb0c913bb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/121075d7601b521973522cce134567beb0c913bb/comments", "author": null, "committer": null, "parents": [{"sha": "6017b8f0cfadaad21ceaf8c58f940cbc118f1a17", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6017b8f0cfadaad21ceaf8c58f940cbc118f1a17", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6017b8f0cfadaad21ceaf8c58f940cbc118f1a17"}], "stats": {"total": 84, "additions": 71, "deletions": 13}, "files": [{"sha": "1499934c6f2528f86c4d82d3637c2e5b2c355685", "filename": "gcc/ChangeLog", "status": "modified", "additions": 15, "deletions": 13, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/121075d7601b521973522cce134567beb0c913bb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/121075d7601b521973522cce134567beb0c913bb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=121075d7601b521973522cce134567beb0c913bb", "patch": "@@ -1,3 +1,9 @@\n+2017-11-20  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\t* config/i386/i386.md (bswaphi2): New expander.\n+\t(*bswaphi2_movbe): New insn pattern.\n+\t(bswaphi -> rorhi pepehole2): New peephole pattern.\n+\n 2017-11-20  Jeff Law  <law@redhat.com>\n \n \t* Makefile.in (OBJS): Add gimple-ssa-evrp-analyze.o.\n@@ -161,8 +167,7 @@\n 2017-11-19  Jan Hubicka  <hubicka@ucw.cz>\n \n \tPR target/82713\n-\t* i386.c (ix86_builtin_vectorization_cost): Be ready for insane\n-\ttypes.\n+\t* i386.c (ix86_builtin_vectorization_cost): Be ready for insane types.\n \n 2017-11-19  Tom de Vries  <tom@codesourcery.com>\n \n@@ -301,8 +306,7 @@\n \n 2017-11-17  Jan Hubicka  <hubicka@ucw.cz>\n \n-\t* ipa-cp.c (update_profiling_info): Handle conversion to local\n-\tprofile.\n+\t* ipa-cp.c (update_profiling_info): Handle conversion to local profile.\n \t* tree-cfg.c (execute_fixup_cfg): Do fixup same way as inliner does.\n \n 2017-11-17  Jeff Law  <law@redhat.com>\n@@ -466,8 +470,7 @@\n \n \t* doc/invoke.texi (-std=c17): Refer to 2018 expected publication\n \tdate of C17.\n-\t(-std=c18, -std=iso9899:2018, -std=gnu18): Document option\n-\taliases.\n+\t(-std=c18, -std=iso9899:2018, -std=gnu18): Document option aliases.\n \n 2017-11-16  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n@@ -519,8 +522,8 @@\n \n 2017-11-16  Jan Hubicka  <hubicka@ucw.cz>\n \n-\t* predict.c (combine_predictions_for_bb): Preserve zero predicted\t\n-\teges.\n+\t* predict.c (combine_predictions_for_bb): Preserve zero predicted\n+\tedges.\n \t(expensive_function_p): Remove useless assert.\n \t(determine_unlikely_bbs): Propagate also forward; determine cold blocks\n \n@@ -2206,9 +2209,8 @@\n \n 2017-11-06  James Bowman  <james.bowman@ftdichip.com>\n \n-\t* gcc/dwarf2out.c (modified_type_die): Retain ADDR_SPACE\n-\tqualifiers.\n-        (add_type_attribute) likewise.\n+\t* gcc/dwarf2out.c (modified_type_die): Retain ADDR_SPACE qualifiers.\n+\t(add_type_attribute) likewise.\n \n 2017-11-06  H.J. Lu  <hongjiu.lu@intel.com>\n \n@@ -3448,7 +3450,7 @@\n \t* doc/tm.texi (TARGET_FLOATN_BUILTIN_P): Likewise.\n \n 2017-10-31  Matthew Fortune  <matthew.fortune@imgtec.com>\n-            Eric Botcazou  <ebotcazou@adacore.com>\n+\t    Eric Botcazou  <ebotcazou@adacore.com>\n \n \tPR rtl-optimization/81803\n \t* lra-constraints.c (curr_insn_transform): Also reload the whole\n@@ -3553,7 +3555,7 @@\n \n 2017-10-31  Olivier Hainque  <hainque@adacore.com>\n \n-        * gcc/Makefile.in (FLAGS_TO_PASS): Pass libsubdir as well.\n+\t* gcc/Makefile.in (FLAGS_TO_PASS): Pass libsubdir as well.\n \n 2017-10-31  Julia Koval  <julia.koval@intel.com>\n "}, {"sha": "0eaa1f244f31f5ef17210f829074c0b6aaeacfdb", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/121075d7601b521973522cce134567beb0c913bb/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/121075d7601b521973522cce134567beb0c913bb/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=121075d7601b521973522cce134567beb0c913bb", "patch": "@@ -14091,6 +14091,39 @@\n    (set_attr \"modrm\" \"0\")\n    (set_attr \"mode\" \"<MODE>\")])\n \n+(define_expand \"bswaphi2\"\n+  [(set (match_operand:HI 0 \"register_operand\")\n+\t(bswap:HI (match_operand:HI 1 \"nonimmediate_operand\")))]\n+  \"TARGET_MOVBE\")\n+\n+(define_insn \"*bswaphi2_movbe\"\n+  [(set (match_operand:HI 0 \"nonimmediate_operand\" \"=Q,r,m\")\n+\t(bswap:HI (match_operand:HI 1 \"nonimmediate_operand\" \"0,m,r\")))]\n+  \"TARGET_MOVBE\n+   && !(MEM_P (operands[0]) && MEM_P (operands[1]))\"\n+  \"@\n+    xchg{b}\\t{%h0, %b0|%b0, %h0}\n+    movbe\\t{%1, %0|%0, %1}\n+    movbe\\t{%1, %0|%0, %1}\"\n+  [(set_attr \"type\" \"imov\")\n+   (set_attr \"modrm\" \"*,1,1\")\n+   (set_attr \"prefix_0f\" \"*,1,1\")\n+   (set_attr \"prefix_extra\" \"*,1,1\")\n+   (set_attr \"pent_pair\" \"np,*,*\")\n+   (set_attr \"athlon_decode\" \"vector,*,*\")\n+   (set_attr \"amdfam10_decode\" \"double,*,*\")\n+   (set_attr \"bdver1_decode\" \"double,*,*\")\n+   (set_attr \"mode\" \"QI,HI,HI\")])\n+\n+(define_peephole2\n+  [(set (match_operand:HI 0 \"general_reg_operand\")\n+\t(bswap:HI (match_dup 0)))]\n+  \"TARGET_MOVBE\n+   && !(TARGET_USE_XCHGB || optimize_function_for_size_p (cfun))\n+   && peep2_regno_dead_p (0, FLAGS_REG)\"\n+  [(parallel [(set (match_dup 0) (rotate:HI (match_dup 0) (const_int 8)))\n+\t      (clobber (reg:CC FLAGS_REG))])])\n+\n (define_insn \"*bswaphi_lowpart_1\"\n   [(set (strict_low_part (match_operand:HI 0 \"register_operand\" \"+Q,r\"))\n \t(bswap:HI (match_dup 0)))"}, {"sha": "ee6a910958f8171e41ba075d6a5ce664e935577a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/121075d7601b521973522cce134567beb0c913bb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/121075d7601b521973522cce134567beb0c913bb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=121075d7601b521973522cce134567beb0c913bb", "patch": "@@ -1,3 +1,8 @@\n+2017-11-20  Uros Bizjak  <ubizjak@gmail.com>\n+\t    Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* gcc.target/i386/movbe-5.c: New test.\n+\n 2017-11-20  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/79072"}, {"sha": "72e4165391de46e941da67b07818c2a5b5e0b80d", "filename": "gcc/testsuite/gcc.target/i386/movbe-5.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/121075d7601b521973522cce134567beb0c913bb/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fmovbe-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/121075d7601b521973522cce134567beb0c913bb/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fmovbe-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fmovbe-5.c?ref=121075d7601b521973522cce134567beb0c913bb", "patch": "@@ -0,0 +1,18 @@\n+/* PR tree-optimization/78821 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -mmovbe\" } */\n+/* { dg-final { scan-assembler-times \"movbe\\[ \\t\\]\" 2 } } */\n+\n+unsigned short\n+foo (unsigned short *buf)\n+{\n+  unsigned short a = buf[0];\n+  return ((unsigned short) (a >> 8)) | (unsigned short) (a << 8);\n+}\n+\n+void\n+bar (char *buf, unsigned int data)\n+{\n+  buf[0] = data >> 8;\n+  buf[1] = data;\n+}"}]}