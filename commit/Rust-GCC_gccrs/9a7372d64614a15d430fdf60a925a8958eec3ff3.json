{"sha": "9a7372d64614a15d430fdf60a925a8958eec3ff3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWE3MzcyZDY0NjE0YTE1ZDQzMGZkZjYwYTkyNWE4OTU4ZWVjM2ZmMw==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@cygnus.com", "date": "2000-02-06T13:19:20Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2000-02-06T13:19:20Z"}, "message": "i386.c (ix86_can_use_return_insn_p): Fail for large poped args and for non-empty stack frames.\n\n        * i386.c (ix86_can_use_return_insn_p): Fail for large poped args\n        and for non-empty stack frames.\n        * i386.md (return): Expand to return-pop as needed.\n\nFrom-SVN: r31827", "tree": {"sha": "8df6ccbf96eb63f2169bbc0467efba575a5ec7a9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8df6ccbf96eb63f2169bbc0467efba575a5ec7a9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9a7372d64614a15d430fdf60a925a8958eec3ff3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a7372d64614a15d430fdf60a925a8958eec3ff3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9a7372d64614a15d430fdf60a925a8958eec3ff3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a7372d64614a15d430fdf60a925a8958eec3ff3/comments", "author": null, "committer": null, "parents": [{"sha": "69732dcb9c663d68d2a5d433ce76ed8da43e5632", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/69732dcb9c663d68d2a5d433ce76ed8da43e5632", "html_url": "https://github.com/Rust-GCC/gccrs/commit/69732dcb9c663d68d2a5d433ce76ed8da43e5632"}], "stats": {"total": 32, "additions": 29, "deletions": 3}, "files": [{"sha": "06b32fb45a2a26c428d7c8a08e906c0b81eb65bd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a7372d64614a15d430fdf60a925a8958eec3ff3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a7372d64614a15d430fdf60a925a8958eec3ff3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9a7372d64614a15d430fdf60a925a8958eec3ff3", "patch": "@@ -11,6 +11,10 @@\n \t* jump.c (jump_optimize_1): Remove code to insert a return insn\n \ton the fallthru to the exit block.\n \n+\t* i386.c (ix86_can_use_return_insn_p): Fail for large poped args\n+\tand for non-empty stack frames.\n+\t* i386.md (return): Expand to return-pop as needed.\n+\n 2000-02-06  Richard Henderson  <rth@cygnus.com>\n \n \t* simplify-rtx.c (simplify_relational_operation): Canonicalize"}, {"sha": "de8517a0e79d41d3f2022b457b7bb49411017d1f", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a7372d64614a15d430fdf60a925a8958eec3ff3/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a7372d64614a15d430fdf60a925a8958eec3ff3/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=9a7372d64614a15d430fdf60a925a8958eec3ff3", "patch": "@@ -1555,15 +1555,29 @@ symbolic_reference_mentioned_p (op)\n int\n ix86_can_use_return_insn_p ()\n {\n+  HOST_WIDE_INT tsize;\n+  int nregs;\n+\n #ifdef NON_SAVING_SETJMP\n   if (NON_SAVING_SETJMP && current_function_calls_setjmp)\n     return 0;\n #endif\n+#ifdef FUNCTION_BLOCK_PROFILER_EXIT\n+  if (profile_block_flag == 2)\n+    return 0;\n+#endif\n+\n+  if (! reload_completed || frame_pointer_needed)\n+    return 0;\n \n-  if (! reload_completed)\n+  /* Don't allow more than 32 pop, since that's all we can do\n+     with one instruction.  */\n+  if (current_function_pops_args\n+      && current_function_args_size >= 32768)\n     return 0;\n \n-  return ix86_nsaved_regs () == 0 || ! frame_pointer_needed;\n+  tsize = ix86_compute_frame_size (get_frame_size (), &nregs, NULL, NULL);\n+  return tsize == 0 && nregs == 0;\n }\n \f\n static char *pic_label_name;"}, {"sha": "7624f23b08f273a3ab9ad37917fbd15528c11341", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a7372d64614a15d430fdf60a925a8958eec3ff3/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a7372d64614a15d430fdf60a925a8958eec3ff3/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=9a7372d64614a15d430fdf60a925a8958eec3ff3", "patch": "@@ -7218,7 +7218,15 @@\n (define_expand \"return\"\n   [(return)]\n   \"ix86_can_use_return_insn_p ()\"\n-  \"\")\n+  \"\n+{\n+  if (current_function_pops_args)\n+    {\n+      rtx popc = GEN_INT (current_function_pops_args);\n+      emit_jump_insn (gen_return_pop_internal (popc));\n+      DONE;\n+    }\n+}\")\n \n (define_insn \"return_internal\"\n   [(return)]"}]}