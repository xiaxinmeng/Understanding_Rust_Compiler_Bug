{"sha": "e3b6d3a887fc0df09ea742c9c5a5acbc27c11ea7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTNiNmQzYTg4N2ZjMGRmMDllYTc0MmM5YzVhNWFjYmMyN2MxMWVhNw==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-05-14T13:19:50Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-05-17T11:13:41Z"}, "message": "libstdc++: Allow lualatex to be used for Doxygen PDF\n\nThis allows the Doxygen PDF to be built using lualatex instead of\npdflatex, which solves a problem with pdflatex running out of memory\nsometimes. This is done by adding a --latex_cmd option to the\nrun_doxygen script, which then sets the specified command in the\ngenerated user.cfg file used by Doxygen. The makefile is adjusted to\npass --latex_cmd=$(LATEX_CMD) to the script, so using running make with\nLATEX_CMD=lualatex will override the default.\n\nAdditionally, this does some refactoring of the doc/Makefile.am rules\nand the run_doxygen script.\n\nlibstdc++-v3/ChangeLog:\n\n\t* doc/Makefile.am: Simplify doxygen recipes and use --latex_cmd.\n\t* doc/Makefile.in: Regenerate.\n\t* doc/doxygen/user.cfg.in (LATEX_CMD_NAME): Add placeholder\n\tvalue.\n\t* scripts/run_doxygen (print_usage): Always print to stdout and\n\tdo not exit.\n\t(fail): New function for exiting on error.\n\t(parse_options): Handle --latex_cmd. Do not treat --help the\n\tsame as errors. Simplify handling of required arguments.", "tree": {"sha": "6d90a6933f3cc6f64cfbdb73e8641abf771804a4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6d90a6933f3cc6f64cfbdb73e8641abf771804a4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e3b6d3a887fc0df09ea742c9c5a5acbc27c11ea7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3b6d3a887fc0df09ea742c9c5a5acbc27c11ea7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e3b6d3a887fc0df09ea742c9c5a5acbc27c11ea7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3b6d3a887fc0df09ea742c9c5a5acbc27c11ea7/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a8e19fa4198ea2504c89d01741d11766e0e9e91b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a8e19fa4198ea2504c89d01741d11766e0e9e91b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a8e19fa4198ea2504c89d01741d11766e0e9e91b"}], "stats": {"total": 137, "additions": 78, "deletions": 59}, "files": [{"sha": "487e8621b2300da4da3fcab55089d3e4166d24d7", "filename": "libstdc++-v3/doc/Makefile.am", "status": "modified", "additions": 15, "deletions": 15, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3b6d3a887fc0df09ea742c9c5a5acbc27c11ea7/libstdc%2B%2B-v3%2Fdoc%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3b6d3a887fc0df09ea742c9c5a5acbc27c11ea7/libstdc%2B%2B-v3%2Fdoc%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fdoc%2FMakefile.am?ref=e3b6d3a887fc0df09ea742c9c5a5acbc27c11ea7", "patch": "@@ -226,10 +226,10 @@ ${doxygen_outdir}/man:\n \tmkdir -p ${doxygen_outdir}/man\n \n stamp-xml-doxygen: ${doxygen_outdir}/xml\n-\t-(srcdir=`cd ${top_srcdir}; ${PWD_COMMAND}`; \\\n-\t  builddir=`cd ..; ${PWD_COMMAND}`; \\\n+\t@builddir=`cd ..; ${PWD_COMMAND}`; \\\n \t  ${SHELL} ${doxygen_script} \\\n-\t  --host_alias=${host_alias} --mode=xml $${srcdir} $${builddir} NO)\n+\t  --host_alias=${host_alias} --mode=xml \\\n+\t  \"${top_srcdir}\" \"$${builddir}\" NO || true\n \t$(STAMP) stamp-xml-doxygen\n \n stamp-xml-single-doxygen: stamp-xml-doxygen\n@@ -239,29 +239,29 @@ stamp-xml-single-doxygen: stamp-xml-doxygen\n \t$(STAMP) stamp-xml-single-doxygen\n \n stamp-html-doxygen: ${doxygen_outdir}/html\n-\t-(srcdir=`cd ${top_srcdir}; ${PWD_COMMAND}`; \\\n-\t  builddir=`cd ..; ${PWD_COMMAND}`; \\\n+\t@builddir=`cd ..; ${PWD_COMMAND}`; \\\n \t  ${SHELL} ${doxygen_script} \\\n-\t  --host_alias=${host_alias} --mode=html $${srcdir} $${builddir} YES)\n+\t  --host_alias=${host_alias} --mode=html \\\n+\t  \"${top_srcdir}\" \"$${builddir}\" YES || true\n \t$(STAMP) stamp-html-doxygen\n \n stamp-latex-doxygen: ${doxygen_outdir}/latex\n-\t-(srcdir=`cd ${top_srcdir}; ${PWD_COMMAND}`; \\\n-\t  builddir=`cd ..; ${PWD_COMMAND}`; \\\n+\t@builddir=`cd ..; ${PWD_COMMAND}`; \\\n \t  ${SHELL} ${doxygen_script} \\\n-\t  --host_alias=${host_alias} --mode=latex $${srcdir} $${builddir} NO)\n+\t  --host_alias=${host_alias} --mode=latex --latex_cmd=$(LATEX_CMD) \\\n+\t  \"${top_srcdir}\" \"$${builddir}\" NO || true\n \t$(STAMP) stamp-latex-doxygen\n \n # Chance of loooooonnggg creation time on this rule.  Iff this fails,\n # look at refman.log and see if TeX's memory is exhausted. Symptoms\n # include asking a wizard to enlarge capacity. If this is the case,\n # find texmf.cnf and add a zero for pool_size, string_vacancies,\n-# max_strings, and pool_free values. A much simpler workaround is to install\n-# lualatex and set LATEX_CMD_NAME = lualatex in the doxygen user.cfg file.\n+# max_strings, and pool_free values. A much simpler workaround is to\n+# install lualatex and set LATEX_CMD=lualatex when running make.\n # Errors like \"File `foo.sty' not found\" mean a TeX package is missing.\n stamp-pdf-doxygen: stamp-latex-doxygen ${doxygen_outdir}/pdf\n-\t-(cd ${doxygen_outdir}/latex && $(MAKE) -i pdf;)\n \t@echo \"Generating doxygen pdf file...\";\n+\t-$(MAKE) -C ${doxygen_outdir}/latex -i pdf\n \t@if [ -f ${doxygen_pdf} ]; then \\\n \t  mv ${doxygen_pdf} ${api_pdf} ; \\\n \t  echo \":: PDF file is ${api_pdf}\"; \\\n@@ -274,10 +274,10 @@ stamp-pdf-doxygen: stamp-latex-doxygen ${doxygen_outdir}/pdf\n \t$(STAMP) stamp-pdf-doxygen\n \n stamp-man-doxygen: ${doxygen_outdir}/man\n-\t-(srcdir=`cd ${top_srcdir}; ${PWD_COMMAND}`; \\\n-\t  builddir=`cd ..; ${PWD_COMMAND}`; \\\n+\t@builddir=`cd ..; ${PWD_COMMAND}`; \\\n \t  ${SHELL} ${doxygen_script} \\\n-\t  --host_alias=${host_alias} --mode=man $${srcdir} $${builddir} YES)\n+\t  --host_alias=${host_alias} --mode=man \\\n+\t  \"${top_srcdir}\" \"$${builddir}\" YES || true\n \t$(STAMP) stamp-man-doxygen\n \n doc-xml-doxygen: stamp-xml-doxygen"}, {"sha": "fe1113eda34ecd26f233754b139be5e11e543a19", "filename": "libstdc++-v3/doc/Makefile.in", "status": "modified", "additions": 15, "deletions": 15, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3b6d3a887fc0df09ea742c9c5a5acbc27c11ea7/libstdc%2B%2B-v3%2Fdoc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3b6d3a887fc0df09ea742c9c5a5acbc27c11ea7/libstdc%2B%2B-v3%2Fdoc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fdoc%2FMakefile.in?ref=e3b6d3a887fc0df09ea742c9c5a5acbc27c11ea7", "patch": "@@ -917,10 +917,10 @@ ${doxygen_outdir}/man:\n \tmkdir -p ${doxygen_outdir}/man\n \n stamp-xml-doxygen: ${doxygen_outdir}/xml\n-\t-(srcdir=`cd ${top_srcdir}; ${PWD_COMMAND}`; \\\n-\t  builddir=`cd ..; ${PWD_COMMAND}`; \\\n+\t@builddir=`cd ..; ${PWD_COMMAND}`; \\\n \t  ${SHELL} ${doxygen_script} \\\n-\t  --host_alias=${host_alias} --mode=xml $${srcdir} $${builddir} NO)\n+\t  --host_alias=${host_alias} --mode=xml \\\n+\t  \"${top_srcdir}\" \"$${builddir}\" NO || true\n \t$(STAMP) stamp-xml-doxygen\n \n stamp-xml-single-doxygen: stamp-xml-doxygen\n@@ -930,29 +930,29 @@ stamp-xml-single-doxygen: stamp-xml-doxygen\n \t$(STAMP) stamp-xml-single-doxygen\n \n stamp-html-doxygen: ${doxygen_outdir}/html\n-\t-(srcdir=`cd ${top_srcdir}; ${PWD_COMMAND}`; \\\n-\t  builddir=`cd ..; ${PWD_COMMAND}`; \\\n+\t@builddir=`cd ..; ${PWD_COMMAND}`; \\\n \t  ${SHELL} ${doxygen_script} \\\n-\t  --host_alias=${host_alias} --mode=html $${srcdir} $${builddir} YES)\n+\t  --host_alias=${host_alias} --mode=html \\\n+\t  \"${top_srcdir}\" \"$${builddir}\" YES || true\n \t$(STAMP) stamp-html-doxygen\n \n stamp-latex-doxygen: ${doxygen_outdir}/latex\n-\t-(srcdir=`cd ${top_srcdir}; ${PWD_COMMAND}`; \\\n-\t  builddir=`cd ..; ${PWD_COMMAND}`; \\\n+\t@builddir=`cd ..; ${PWD_COMMAND}`; \\\n \t  ${SHELL} ${doxygen_script} \\\n-\t  --host_alias=${host_alias} --mode=latex $${srcdir} $${builddir} NO)\n+\t  --host_alias=${host_alias} --mode=latex --latex_cmd=$(LATEX_CMD) \\\n+\t  \"${top_srcdir}\" \"$${builddir}\" NO || true\n \t$(STAMP) stamp-latex-doxygen\n \n # Chance of loooooonnggg creation time on this rule.  Iff this fails,\n # look at refman.log and see if TeX's memory is exhausted. Symptoms\n # include asking a wizard to enlarge capacity. If this is the case,\n # find texmf.cnf and add a zero for pool_size, string_vacancies,\n-# max_strings, and pool_free values. A much simpler workaround is to install\n-# lualatex and set LATEX_CMD_NAME = lualatex in the doxygen user.cfg file.\n+# max_strings, and pool_free values. A much simpler workaround is to\n+# install lualatex and set LATEX_CMD=lualatex when running make.\n # Errors like \"File `foo.sty' not found\" mean a TeX package is missing.\n stamp-pdf-doxygen: stamp-latex-doxygen ${doxygen_outdir}/pdf\n-\t-(cd ${doxygen_outdir}/latex && $(MAKE) -i pdf;)\n \t@echo \"Generating doxygen pdf file...\";\n+\t-$(MAKE) -C ${doxygen_outdir}/latex -i pdf\n \t@if [ -f ${doxygen_pdf} ]; then \\\n \t  mv ${doxygen_pdf} ${api_pdf} ; \\\n \t  echo \":: PDF file is ${api_pdf}\"; \\\n@@ -965,10 +965,10 @@ stamp-pdf-doxygen: stamp-latex-doxygen ${doxygen_outdir}/pdf\n \t$(STAMP) stamp-pdf-doxygen\n \n stamp-man-doxygen: ${doxygen_outdir}/man\n-\t-(srcdir=`cd ${top_srcdir}; ${PWD_COMMAND}`; \\\n-\t  builddir=`cd ..; ${PWD_COMMAND}`; \\\n+\t@builddir=`cd ..; ${PWD_COMMAND}`; \\\n \t  ${SHELL} ${doxygen_script} \\\n-\t  --host_alias=${host_alias} --mode=man $${srcdir} $${builddir} YES)\n+\t  --host_alias=${host_alias} --mode=man \\\n+\t  \"${top_srcdir}\" \"$${builddir}\" YES || true\n \t$(STAMP) stamp-man-doxygen\n \n doc-xml-doxygen: stamp-xml-doxygen"}, {"sha": "8c4fed5c5a1ea4f8b77250fc04f07528a174bc56", "filename": "libstdc++-v3/doc/doxygen/user.cfg.in", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3b6d3a887fc0df09ea742c9c5a5acbc27c11ea7/libstdc%2B%2B-v3%2Fdoc%2Fdoxygen%2Fuser.cfg.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3b6d3a887fc0df09ea742c9c5a5acbc27c11ea7/libstdc%2B%2B-v3%2Fdoc%2Fdoxygen%2Fuser.cfg.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fdoc%2Fdoxygen%2Fuser.cfg.in?ref=e3b6d3a887fc0df09ea742c9c5a5acbc27c11ea7", "patch": "@@ -1945,7 +1945,7 @@ LATEX_OUTPUT           = latex\n # the output language.\n # This tag requires that the tag GENERATE_LATEX is set to YES.\n \n-LATEX_CMD_NAME         =\n+LATEX_CMD_NAME         = @latex_cmd@\n \n # The MAKEINDEX_CMD_NAME tag can be used to specify the command name to generate\n # index for LaTeX."}, {"sha": "a36772128ecf7c9cd5c4627534c4cb0996629664", "filename": "libstdc++-v3/scripts/run_doxygen", "status": "modified", "additions": 47, "deletions": 28, "changes": 75, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3b6d3a887fc0df09ea742c9c5a5acbc27c11ea7/libstdc%2B%2B-v3%2Fscripts%2Frun_doxygen", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3b6d3a887fc0df09ea742c9c5a5acbc27c11ea7/libstdc%2B%2B-v3%2Fscripts%2Frun_doxygen", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fscripts%2Frun_doxygen?ref=e3b6d3a887fc0df09ea742c9c5a5acbc27c11ea7", "patch": "@@ -35,8 +35,7 @@ find_doxygen() {\n       fi\n     done\n     if test -z \"$doxygen\"; then\n-\techo run_doxygen error:  Could not find Doxygen $DOXYVER in path. 1>&2\n-\tprint_usage\n+\tfail \"Could not find Doxygen $DOXYVER in path.\"\n     fi\n     # We need to use other tools from the same package/version.\n     echo :: Using Doxygen tools from ${dir}.\n@@ -45,57 +44,76 @@ find_doxygen() {\n }\n \n print_usage() {\n-    cat 1>&2 <<EOF\n-Usage:  run_doxygen --mode=MODE --host_alias=BUILD_ALIAS [<options>]\n+    cat <<EOF\n+Usage:  run_doxygen --mode=MODE --host_alias=HOST_ALIAS [<options>]\n \t\t    <v3-src-dir> <v3-build-dir> <shortnamesp>\n       MODE is one of:\n \t  html           Generate user-level HTML library documentation.\n \t  man            Generate user-level man pages.\n \t  xml            Generate user-level XML pages.\n \t  latex          Generate user-level LaTeX pages.\n \n-      BUILD_ALIAS is the GCC build alias set at configure time.\n+      HOST_ALIAS is the GCC host alias triplet set at configure time.\n+\n+      shortnamesp is one of YES or NO and is used as the SHORT_NAMES value\n+      in the Doxygen config file.\n+\n+      Supported options:\n+\n+      --help | -h      Print this message and exit.\n+      --latex_cmd=CMD  Set LATEX_CMD_NAME=CMD in the Doxygen config file.\n \n Note:  Requires Doxygen ${DOXYVER} or later; get it at\n        ftp://ftp.stack.nl/pub/users/dimitri/doxygen-${DOXYVER}.src.tar.gz\n \n EOF\n-    exit 1\n+}\n+\n+# Print an error message followed by usage to stderr, then exit.\n+fail() {\n+  echo \"$0: error: $*\" 1>&2\n+  echo 1>&2\n+  print_usage 1>&2\n+  exit 1\n }\n \n parse_options() {\n-  for o\n+  while [ $# -ne 0 ]\n   do\n     # Blatantly ripped from autoconf, er, I mean, \"gratefully standing\n     # on the shoulders of those giants who have gone before us.\"\n-    case \"$o\" in\n-      -*=*) arg=`echo \"$o\" | sed 's/[-_a-zA-Z0-9]*=//'` ;;\n+    case \"$1\" in\n+      -*=*) arg=`echo \"$1\" | sed 's/[-_a-zA-Z0-9]*=//'` ;;\n       *) arg= ;;\n     esac\n \n-    case \"$o\" in\n+    case \"$1\" in\n       --mode=*)\n \tmode=$arg ;;\n       --host_alias=*)\n \thost_alias=$arg ;;\n-      --mode | --host_alias | --help | -h)\n-\tprint_usage ;;\n+      --help | -h)\n+\tprint_usage ; exit ;;\n+      --mode | --host_alias)\n+\tfail \"missing argument: $1\" ;;\n+      --latex_cmd=*)\n+\tlatex_cmd=$arg ;;\n+      --*)\n+\tfail \"invalid option: $1\" ;;\n       *)\n-\t# this turned out to be a mess, maybe change to --srcdir=, etc\n-\tif test $srcdir = unset; then\n-\t  srcdir=$o\n-\telif test $outdir = unset; then\n-\t  builddir=${o}\n-\t  outdir=${o}/doc/doxygen\n-\telif test $shortname = unset; then\n-\t  shortname=$o\n-\telse\n-\t  echo run_doxygen error:  Too many arguments 1>&2\n-\t  exit 1\n-\tfi\n-\t;;\n-      esac\n+\tbreak ;;\n+    esac\n+    shift\n   done\n+\n+  if [ $# -ne 3 ]\n+  then\n+    fail \"wrong number of arguments\"\n+  fi\n+  srcdir=\"$1\"\n+  builddir=\"$2\"\n+  outdir=\"$2/doc/doxygen\"\n+  shortname=\"$3\"\n }\n \n \n@@ -109,6 +127,7 @@ do_html=false\n do_man=false\n do_xml=false\n do_latex=false\n+latex_cmd=\n enabled_sections=\n generate_tagfile=\n DATEtext=`date '+%Y-%m-%d'`\n@@ -121,8 +140,7 @@ find_doxygen\n \n if test $srcdir = unset || test $outdir = unset || test $mode = unset || test $shortname = unset || test $host_alias = unset; then\n     # this could be better\n-    echo run_doxygen error:  You have not given enough information...! 1>&2\n-    print_usage\n+    fail \"You have not given enough information...!  $srcdir - \"\n fi\n \n case x\"$mode\" in\n@@ -173,6 +191,7 @@ chmod u+w $outdir\n \t-e \"s=@enabled_sections@=${enabled_sections}=\" \\\n \t-e \"s=@do_html@=${do_html}=\" \\\n \t-e \"s=@do_latex@=${do_latex}=\" \\\n+\t-e \"s=@latex_cmd@=${latex_cmd}=\" \\\n \t-e \"s=@do_man@=${do_man}=\" \\\n \t-e \"s=@do_xml@=${do_xml}=\" \\\n \t-e \"s=@generate_tagfile@=${generate_tagfile}=\" \\"}]}