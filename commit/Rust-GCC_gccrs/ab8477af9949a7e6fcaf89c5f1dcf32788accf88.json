{"sha": "ab8477af9949a7e6fcaf89c5f1dcf32788accf88", "node_id": "C_kwDOANBUbNoAKGFiODQ3N2FmOTk0OWE3ZTZmY2FmODljNWYxZGNmMzI3ODhhY2NmODg", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2022-10-13T18:38:27Z"}, "committer": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2022-10-13T18:38:27Z"}, "message": "libgomp: Add Fortran testcases for omp_in_explicit_task\n\nFortranized testcases of commits r13-3257-ga58a965eb73\nand r13-3258-g0ec4e93fb9f.\n\nlibgomp/ChangeLog:\n\n\t* testsuite/libgomp.fortran/task-7.f90: New test.\n\t* testsuite/libgomp.fortran/task-8.f90: New test.\n\t* testsuite/libgomp.fortran/task-in-explicit-1.f90: New test.\n\t* testsuite/libgomp.fortran/task-in-explicit-2.f90: New test.\n\t* testsuite/libgomp.fortran/task-in-explicit-3.f90: New test.\n\t* testsuite/libgomp.fortran/task-reduction-17.f90: New test.\n\t* testsuite/libgomp.fortran/task-reduction-18.f90: New test.", "tree": {"sha": "8805829659680d943ca4cc03e45594819fd53d65", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8805829659680d943ca4cc03e45594819fd53d65"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ab8477af9949a7e6fcaf89c5f1dcf32788accf88", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab8477af9949a7e6fcaf89c5f1dcf32788accf88", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ab8477af9949a7e6fcaf89c5f1dcf32788accf88", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab8477af9949a7e6fcaf89c5f1dcf32788accf88/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c853d655ab27d288b9dcadb2920f7cd28dc1390d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c853d655ab27d288b9dcadb2920f7cd28dc1390d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c853d655ab27d288b9dcadb2920f7cd28dc1390d"}], "stats": {"total": 247, "additions": 247, "deletions": 0}, "files": [{"sha": "e806bd79663449cdad345318ca34c56c0d28484b", "filename": "libgomp/testsuite/libgomp.fortran/task-7.f90", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab8477af9949a7e6fcaf89c5f1dcf32788accf88/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-7.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab8477af9949a7e6fcaf89c5f1dcf32788accf88/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-7.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-7.f90?ref=ab8477af9949a7e6fcaf89c5f1dcf32788accf88", "patch": "@@ -0,0 +1,22 @@\n+! { dg-do run }\n+\n+program main\n+  use omp_lib\n+  implicit none\n+\n+  !$omp task final (.true.)\n+    if (.not. omp_in_final ()) &\n+      error stop\n+    !$omp task\n+      if (.not. omp_in_final ()) &\n+        error stop\n+      !$omp target nowait\n+      if (omp_in_final ()) &\n+        error stop\n+      !$omp end target\n+      if (.not. omp_in_final ()) &\n+        error stop\n+      !$omp taskwait\n+    !$omp end task\n+  !$omp end task\n+end"}, {"sha": "037c63b8fa3496e600c87317b435752d35e9fa52", "filename": "libgomp/testsuite/libgomp.fortran/task-8.f90", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab8477af9949a7e6fcaf89c5f1dcf32788accf88/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-8.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab8477af9949a7e6fcaf89c5f1dcf32788accf88/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-8.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-8.f90?ref=ab8477af9949a7e6fcaf89c5f1dcf32788accf88", "patch": "@@ -0,0 +1,13 @@\n+! { dg-do run }\n+\n+program main\n+  implicit none\n+  integer :: i\n+  i = 0\n+  !$omp task\n+    !$omp target nowait private (i)\n+      i = 1\n+    !$omp end target\n+    !$omp taskwait\n+  !$omp end task\n+end"}, {"sha": "b6fa21b2c22b8b0c5114b880febc32aa8b58f997", "filename": "libgomp/testsuite/libgomp.fortran/task-in-explicit-1.f90", "status": "added", "additions": 113, "deletions": 0, "changes": 113, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab8477af9949a7e6fcaf89c5f1dcf32788accf88/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-in-explicit-1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab8477af9949a7e6fcaf89c5f1dcf32788accf88/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-in-explicit-1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-in-explicit-1.f90?ref=ab8477af9949a7e6fcaf89c5f1dcf32788accf88", "patch": "@@ -0,0 +1,113 @@\n+! { dg-do run }\n+\n+program main\n+  use omp_lib\n+  implicit none\n+  integer :: i\n+\n+  if (omp_in_explicit_task ()) &\n+    error stop\n+  !$omp task\n+  if (.not. omp_in_explicit_task ()) &\n+    error stop\n+  !$omp end task\n+\n+  !$omp task final (.true.)\n+    if (.not. omp_in_explicit_task ()) &\n+      error stop\n+    !$omp task\n+    if (.not. omp_in_explicit_task ()) &\n+      error stop\n+    !$omp end task\n+  !$omp end task\n+\n+  !$omp parallel\n+    if (omp_in_explicit_task ()) &\n+      error stop\n+    !$omp task if (.false.)\n+        if (.not. omp_in_explicit_task ()) &\n+          error stop\n+        !$omp task if (.false.)\n+          if (.not. omp_in_explicit_task ()) &\n+            error stop\n+        !$omp end task\n+    !$omp end task\n+    !$omp task final (.true.)\n+      if (.not. omp_in_explicit_task ()) &\n+        error stop\n+    !$omp end task\n+    !$omp barrier\n+    if (omp_in_explicit_task ()) &\n+      error stop\n+    !$omp taskloop num_tasks (24)\n+    do i = 1, 32\n+      if (.not. omp_in_explicit_task ()) &\n+        error stop\n+    end do\n+    !$omp masked\n+    !$omp task\n+    if (.not. omp_in_explicit_task ()) &\n+      error stop\n+    !$omp end task\n+    !$omp end masked\n+    !$omp barrier\n+    if (omp_in_explicit_task ()) &\n+      error stop\n+  !$omp end parallel\n+\n+  !$omp target\n+    if (omp_in_explicit_task ()) &\n+      error stop\n+    !$omp task if (.false.)\n+    if (.not. omp_in_explicit_task ()) &\n+      error stop\n+    !$omp end task\n+    !$omp task\n+    if (.not. omp_in_explicit_task ()) &\n+      error stop\n+    !$omp end task\n+  !$omp end target\n+\n+  !$omp target teams\n+    !$omp distribute\n+    do i = 1, 4\n+      if (omp_in_explicit_task ()) then\n+        error stop\n+      else\n+          !$omp parallel\n+            if (omp_in_explicit_task ()) &\n+              error stop\n+            !$omp task\n+            if (.not. omp_in_explicit_task ()) &\n+              error stop\n+            !$omp end task\n+            !$omp barrier\n+            if (omp_in_explicit_task ()) &\n+              error stop\n+          !$omp end parallel\n+      end if\n+    end do\n+  !$omp end target teams\n+\n+  !$omp teams\n+    !$omp distribute\n+    do i = 1, 4\n+      if (omp_in_explicit_task ()) then\n+        error stop\n+      else\n+          !$omp parallel\n+            if (omp_in_explicit_task ()) &\n+              error stop\n+            !$omp task\n+            if (.not. omp_in_explicit_task ()) &\n+              error stop\n+            !$omp end task\n+            !$omp barrier\n+            if (omp_in_explicit_task ()) &\n+              error stop\n+          !$omp end parallel\n+      end if\n+    end do\n+    !$omp end distribute\n+  !$omp end teams\n+end"}, {"sha": "c615ff62daeda5602cd76bf47a16f01a3dcdea17", "filename": "libgomp/testsuite/libgomp.fortran/task-in-explicit-2.f90", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab8477af9949a7e6fcaf89c5f1dcf32788accf88/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-in-explicit-2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab8477af9949a7e6fcaf89c5f1dcf32788accf88/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-in-explicit-2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-in-explicit-2.f90?ref=ab8477af9949a7e6fcaf89c5f1dcf32788accf88", "patch": "@@ -0,0 +1,21 @@\n+! { dg-do run }\n+\n+program main\n+  use omp_lib\n+  implicit none\n+  !$omp task\n+    if (.not. omp_in_explicit_task ()) &\n+      error stop\n+    !$omp task\n+      if (.not. omp_in_explicit_task ()) &\n+        error stop\n+      !$omp target nowait\n+        if (omp_in_explicit_task ()) &\n+          error stop\n+      !$omp end target\n+      if (.not. omp_in_explicit_task ()) &\n+        error stop\n+      !$omp taskwait\n+    !$omp end task\n+  !$omp end task\n+end"}, {"sha": "629c5676c0577095589eee36e1fb103cadb56e31", "filename": "libgomp/testsuite/libgomp.fortran/task-in-explicit-3.f90", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab8477af9949a7e6fcaf89c5f1dcf32788accf88/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-in-explicit-3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab8477af9949a7e6fcaf89c5f1dcf32788accf88/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-in-explicit-3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-in-explicit-3.f90?ref=ab8477af9949a7e6fcaf89c5f1dcf32788accf88", "patch": "@@ -0,0 +1,31 @@\n+! { dg-do run }\n+\n+module m\n+  integer :: a\n+end module m\n+\n+program main\n+  use omp_lib\n+  use m\n+  implicit none\n+  !$omp task\n+    if (.not. omp_in_explicit_task ()) &\n+      error stop\n+    !$omp task\n+      if (.not. omp_in_explicit_task ()) &\n+        error stop\n+      !$omp taskgroup task_reduction (+: a)\n+        if (.not. omp_in_explicit_task ()) &\n+          error stop\n+\t!$omp task in_reduction (+: a)\n+          a = a + 1\n+          if (.not. omp_in_explicit_task ()) &\n+            error stop\n+\t!$omp end task\n+      !$omp end taskgroup\n+      if (.not. omp_in_explicit_task ()) &\n+        error stop\n+      !$omp taskwait\n+    !$omp end task\n+  !$omp end task\n+end"}, {"sha": "12a896269d3fdf77984a8c4b36ba3cc9dc9a1dbc", "filename": "libgomp/testsuite/libgomp.fortran/task-reduction-17.f90", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab8477af9949a7e6fcaf89c5f1dcf32788accf88/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-reduction-17.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab8477af9949a7e6fcaf89c5f1dcf32788accf88/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-reduction-17.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-reduction-17.f90?ref=ab8477af9949a7e6fcaf89c5f1dcf32788accf88", "patch": "@@ -0,0 +1,32 @@\n+! { dg-do run }\n+\n+module m\n+  integer a\n+end module m\n+\n+program main\n+  use omp_lib\n+  use m\n+  implicit none\n+\n+  !$omp task final (.true.)\n+    if (.not. omp_in_final ()) &\n+      error stop\n+    !$omp task\n+      if (.not. omp_in_final ()) &\n+        error stop\n+      !$omp taskgroup task_reduction (+: a)\n+        if (.not. omp_in_final ()) &\n+          error stop\n+        !$omp task in_reduction (+: a)\n+          a = a + 1\n+          if (.not. omp_in_final ()) &\n+            error stop\n+        !$omp end task\n+      !$omp end taskgroup\n+      if (.not. omp_in_final ()) &\n+        error stop\n+      !$omp taskwait\n+    !$omp end task\n+  !$omp end task\n+end"}, {"sha": "0cbd471832251fe6bbdcb30a29448ed0e2152269", "filename": "libgomp/testsuite/libgomp.fortran/task-reduction-18.f90", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab8477af9949a7e6fcaf89c5f1dcf32788accf88/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-reduction-18.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab8477af9949a7e6fcaf89c5f1dcf32788accf88/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-reduction-18.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftask-reduction-18.f90?ref=ab8477af9949a7e6fcaf89c5f1dcf32788accf88", "patch": "@@ -0,0 +1,15 @@\n+! { dg-do run }\n+\n+module m\n+  integer :: a = 0\n+end module m\n+\n+program main\n+  !$omp task\n+    !$omp taskgroup task_reduction (+: a)\n+      !$omp task in_reduction (+: a)\n+        a = a + 1\n+      !$omp end task\n+    !$omp end taskgroup\n+  !$omp end task\n+end"}]}