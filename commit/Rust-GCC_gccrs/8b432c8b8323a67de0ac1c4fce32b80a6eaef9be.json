{"sha": "8b432c8b8323a67de0ac1c4fce32b80a6eaef9be", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGI0MzJjOGI4MzIzYTY3ZGUwYWMxYzRmY2UzMmI4MGE2ZWFlZjliZQ==", "commit": {"author": {"name": "Alexander Monakov", "email": "amonakov@ispras.ru", "date": "2010-12-17T12:54:59Z"}, "committer": {"name": "Alexander Monakov", "email": "amonakov@gcc.gnu.org", "date": "2010-12-17T12:54:59Z"}, "message": "re PR middle-end/46761 (-fgraphite-identity produces wrong code for array initialization arr[i] = i)\n\n\tPR middle-end/46761\n\t* graphite-clast-to-gimple.c (graphite_create_new_loop_guard): Prefer\n\tto use unadjusted UB.\n\ntestsuite:\n\t* gcc.dg/graphite/pr46761.c: New.\n\nFrom-SVN: r167980", "tree": {"sha": "82650d43c859500d7f4079f0ccb5f35a7bc07a1d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/82650d43c859500d7f4079f0ccb5f35a7bc07a1d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8b432c8b8323a67de0ac1c4fce32b80a6eaef9be", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b432c8b8323a67de0ac1c4fce32b80a6eaef9be", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8b432c8b8323a67de0ac1c4fce32b80a6eaef9be", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b432c8b8323a67de0ac1c4fce32b80a6eaef9be/comments", "author": {"login": "amonakov", "id": 1997391, "node_id": "MDQ6VXNlcjE5OTczOTE=", "avatar_url": "https://avatars.githubusercontent.com/u/1997391?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amonakov", "html_url": "https://github.com/amonakov", "followers_url": "https://api.github.com/users/amonakov/followers", "following_url": "https://api.github.com/users/amonakov/following{/other_user}", "gists_url": "https://api.github.com/users/amonakov/gists{/gist_id}", "starred_url": "https://api.github.com/users/amonakov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amonakov/subscriptions", "organizations_url": "https://api.github.com/users/amonakov/orgs", "repos_url": "https://api.github.com/users/amonakov/repos", "events_url": "https://api.github.com/users/amonakov/events{/privacy}", "received_events_url": "https://api.github.com/users/amonakov/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7ca17033382c71cbfe6cd24da017c2c333b114af", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ca17033382c71cbfe6cd24da017c2c333b114af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7ca17033382c71cbfe6cd24da017c2c333b114af"}], "stats": {"total": 61, "additions": 49, "deletions": 12}, "files": [{"sha": "c5e80126a940278486d6b1d73e02257d153ba9ff", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b432c8b8323a67de0ac1c4fce32b80a6eaef9be/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b432c8b8323a67de0ac1c4fce32b80a6eaef9be/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8b432c8b8323a67de0ac1c4fce32b80a6eaef9be", "patch": "@@ -1,3 +1,9 @@\n+2010-12-17  Alexander Monakov  <amonakov@ispras.ru>\n+\n+\tPR middle-end/46761\n+\t* graphite-clast-to-gimple.c (graphite_create_new_loop_guard): Prefer\n+\tto use unadjusted UB.\n+\n 2010-12-17  Dodji Seketeli  <dodji@redhat.com>\n \n \t* dwarf2out.c (gen_type_die_with_usage): Do not try to emit debug"}, {"sha": "0937fc8eb94ab2ec6192cee1ecd1b82b315703e7", "filename": "gcc/graphite-clast-to-gimple.c", "status": "modified", "additions": 16, "deletions": 12, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b432c8b8323a67de0ac1c4fce32b80a6eaef9be/gcc%2Fgraphite-clast-to-gimple.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b432c8b8323a67de0ac1c4fce32b80a6eaef9be/gcc%2Fgraphite-clast-to-gimple.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgraphite-clast-to-gimple.c?ref=8b432c8b8323a67de0ac1c4fce32b80a6eaef9be", "patch": "@@ -975,20 +975,24 @@ graphite_create_new_loop_guard (sese region, edge entry_edge,\n \t\t\t\t     newivs_index, params_index);\n   tree ub = clast_to_gcc_expression (type, stmt->UB, region, newivs,\n \t\t\t\t     newivs_index, params_index);\n-  tree one = POINTER_TYPE_P (type) ? size_one_node\n-    : fold_convert (type, integer_one_node);\n-  /* Adding +1 and using LT_EXPR helps with loop latches that have a\n-     loop iteration count of \"PARAMETER - 1\".  For PARAMETER == 0 this becomes\n-     2^{32|64}, and the condition lb <= ub is true, even if we do not want this.\n-     However lb < ub + 1 is false, as expected.  */\n-  tree ub_one = fold_build2 (POINTER_TYPE_P (type) ? POINTER_PLUS_EXPR\n-\t\t\t     : PLUS_EXPR, type, ub, one);\n-\n-  /* When ub + 1 wraps around, use lb <= ub.  */\n-  if (integer_zerop (ub_one))\n+  /* When ub is simply a constant or a parameter, use lb <= ub.  */\n+  if (TREE_CODE (ub) == INTEGER_CST || TREE_CODE (ub) == SSA_NAME)\n     cond_expr = fold_build2 (LE_EXPR, boolean_type_node, lb, ub);\n   else\n-    cond_expr = fold_build2 (LT_EXPR, boolean_type_node, lb, ub_one);\n+    {\n+      tree one = (POINTER_TYPE_P (type)\n+\t\t  ? size_one_node\n+\t\t  : fold_convert (type, integer_one_node));\n+      /* Adding +1 and using LT_EXPR helps with loop latches that have a\n+\t loop iteration count of \"PARAMETER - 1\".  For PARAMETER == 0 this becomes\n+\t 2^k-1 due to integer overflow, and the condition lb <= ub is true,\n+\t even if we do not want this.  However lb < ub + 1 is false, as\n+\t expected.  */\n+      tree ub_one = fold_build2 (POINTER_TYPE_P (type) ? POINTER_PLUS_EXPR\n+\t\t\t\t : PLUS_EXPR, type, ub, one);\n+\n+      cond_expr = fold_build2 (LT_EXPR, boolean_type_node, lb, ub_one);\n+    }\n \n   exit_edge = create_empty_if_region_on_edge (entry_edge, cond_expr);\n "}, {"sha": "67799d0d9a7a5323bcee79a854a689ce5316ecef", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b432c8b8323a67de0ac1c4fce32b80a6eaef9be/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b432c8b8323a67de0ac1c4fce32b80a6eaef9be/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8b432c8b8323a67de0ac1c4fce32b80a6eaef9be", "patch": "@@ -1,3 +1,8 @@\n+2010-12-17  Alexander Monakov  <amonakov@ispras.ru>\n+\n+\tPR middle-end/46761\n+\t* gcc.dg/graphite/pr46761.c: New.\n+\n 2010-12-17  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/46849"}, {"sha": "f45398a2b479a25f71c720e185e21557e3bc2a6e", "filename": "gcc/testsuite/gcc.dg/graphite/pr46761.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b432c8b8323a67de0ac1c4fce32b80a6eaef9be/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr46761.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b432c8b8323a67de0ac1c4fce32b80a6eaef9be/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr46761.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr46761.c?ref=8b432c8b8323a67de0ac1c4fce32b80a6eaef9be", "patch": "@@ -0,0 +1,22 @@\n+/* { dg-do run } */\n+/* { dg-options \"-O -fgraphite-identity\" } */\n+\n+#define N 128\n+\n+int\n+main ()\n+{\n+  int arr[N], i, s = 0;\n+  for (i = 0; i < N; i++)\n+    arr[i] = i;\n+\n+  for (i = 0; i < N; i++)\n+    if (arr[i] != i)\n+      __builtin_abort ();\n+\n+  for (i = 0; i < N; i++)\n+    s += arr[i];\n+  if (s != (N * (N - 1)) / 2)\n+    __builtin_abort ();\n+  return 0;\n+}"}]}