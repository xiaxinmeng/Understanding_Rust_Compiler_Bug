{"sha": "0bc199fc5d4eef5a20ced20df892e5e3b8821b60", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGJjMTk5ZmM1ZDRlZWY1YTIwY2VkMjBkZjg5MmU1ZTNiODgyMWI2MA==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2020-10-28T13:19:21Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2020-10-28T13:19:21Z"}, "message": "libstdc++: Override BUFSIZ for Windows targets [PR 94268]\n\nThis replaces uses of BUFSIZ with a new _GLIBCXX_BUFSIZ macro that can\nbe overridden in target-specific config headers.\n\nThat allows the mingw and mingw-w64 targets to override it, because\nBUFSIZ is apparently defined to 512, resulting in poor performance. The\nMSVCRT stdio apparently uses 4096, so we use that too.\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/94268\n\t* config/os/mingw32-w64/os_defines.h (_GLIBCXX_BUFSIZ):\n\tDefine.\n\t* config/os/mingw32/os_defines.h (_GLIBCXX_BUFSIZ):\n\tDefine.\n\t* include/bits/fstream.tcc: Use _GLIBCXX_BUFSIZ instead\n\tof BUFSIZ.\n\t* include/ext/stdio_filebuf.h: Likewise.\n\t* include/std/fstream (_GLIBCXX_BUFSIZ): Define.", "tree": {"sha": "4a5bf3d02e15c7ce9eed8cec5ca87fd79d1a980a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4a5bf3d02e15c7ce9eed8cec5ca87fd79d1a980a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0bc199fc5d4eef5a20ced20df892e5e3b8821b60", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0bc199fc5d4eef5a20ced20df892e5e3b8821b60", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0bc199fc5d4eef5a20ced20df892e5e3b8821b60", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0bc199fc5d4eef5a20ced20df892e5e3b8821b60/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2acb33103c4cbc6766d8707ad58aa5cc9a804719", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2acb33103c4cbc6766d8707ad58aa5cc9a804719", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2acb33103c4cbc6766d8707ad58aa5cc9a804719"}], "stats": {"total": 17, "additions": 14, "deletions": 3}, "files": [{"sha": "39bdedd19e97ca594532a6201e4f8f673945bbd5", "filename": "libstdc++-v3/config/os/mingw32-w64/os_defines.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0bc199fc5d4eef5a20ced20df892e5e3b8821b60/libstdc%2B%2B-v3%2Fconfig%2Fos%2Fmingw32-w64%2Fos_defines.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0bc199fc5d4eef5a20ced20df892e5e3b8821b60/libstdc%2B%2B-v3%2Fconfig%2Fos%2Fmingw32-w64%2Fos_defines.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fos%2Fmingw32-w64%2Fos_defines.h?ref=0bc199fc5d4eef5a20ced20df892e5e3b8821b60", "patch": "@@ -90,4 +90,7 @@\n \n #define _GLIBCXX_USE_CRT_RAND_S 1\n \n+// See libstdc++/94268\n+#define _GLIBCXX_BUFSIZ 4096\n+\n #endif"}, {"sha": "9d2f2bda660c459fa04edbb11d87828ee59637c0", "filename": "libstdc++-v3/config/os/mingw32/os_defines.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0bc199fc5d4eef5a20ced20df892e5e3b8821b60/libstdc%2B%2B-v3%2Fconfig%2Fos%2Fmingw32%2Fos_defines.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0bc199fc5d4eef5a20ced20df892e5e3b8821b60/libstdc%2B%2B-v3%2Fconfig%2Fos%2Fmingw32%2Fos_defines.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fos%2Fmingw32%2Fos_defines.h?ref=0bc199fc5d4eef5a20ced20df892e5e3b8821b60", "patch": "@@ -78,4 +78,7 @@\n // See libstdc++/59807\n #define _GTHREAD_USE_MUTEX_INIT_FUNC 1\n \n+// See libstdc++/94268\n+#define _GLIBCXX_BUFSIZ 4096\n+\n #endif"}, {"sha": "a4ebbb84fe7376f3fa727a7eaa3b928c72a71d8d", "filename": "libstdc++-v3/include/bits/fstream.tcc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0bc199fc5d4eef5a20ced20df892e5e3b8821b60/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffstream.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0bc199fc5d4eef5a20ced20df892e5e3b8821b60/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffstream.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffstream.tcc?ref=0bc199fc5d4eef5a20ced20df892e5e3b8821b60", "patch": "@@ -80,7 +80,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n     basic_filebuf<_CharT, _Traits>::\n     basic_filebuf() : __streambuf_type(), _M_lock(), _M_file(&_M_lock),\n     _M_mode(ios_base::openmode(0)), _M_state_beg(), _M_state_cur(),\n-    _M_state_last(), _M_buf(0), _M_buf_size(BUFSIZ),\n+    _M_state_last(), _M_buf(0), _M_buf_size(_GLIBCXX_BUFSIZ),\n     _M_buf_allocated(false), _M_reading(false), _M_writing(false), _M_pback(), \n     _M_pback_cur_save(0), _M_pback_end_save(0), _M_pback_init(false),\n     _M_codecvt(0), _M_ext_buf(0), _M_ext_buf_size(0), _M_ext_next(0),"}, {"sha": "3b297285ad3e81fe3fe74b0b0f507aba63faf16d", "filename": "libstdc++-v3/include/ext/stdio_filebuf.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0bc199fc5d4eef5a20ced20df892e5e3b8821b60/libstdc%2B%2B-v3%2Finclude%2Fext%2Fstdio_filebuf.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0bc199fc5d4eef5a20ced20df892e5e3b8821b60/libstdc%2B%2B-v3%2Finclude%2Fext%2Fstdio_filebuf.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fext%2Fstdio_filebuf.h?ref=0bc199fc5d4eef5a20ced20df892e5e3b8821b60", "patch": "@@ -75,7 +75,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n        *  closed when the stdio_filebuf is closed/destroyed.\n       */\n       stdio_filebuf(int __fd, std::ios_base::openmode __mode,\n-\t\t    size_t __size = static_cast<size_t>(BUFSIZ));\n+\t\t    size_t __size = static_cast<size_t>(_GLIBCXX_BUFSIZ));\n \n       /**\n        *  @param  __f  An open @c FILE*.\n@@ -88,7 +88,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n        *  stdio_filebuf is closed/destroyed.\n       */\n       stdio_filebuf(std::__c_file* __f, std::ios_base::openmode __mode,\n-\t\t    size_t __size = static_cast<size_t>(BUFSIZ));\n+\t\t    size_t __size = static_cast<size_t>(_GLIBCXX_BUFSIZ));\n \n       /**\n        *  Closes the external data stream if the file descriptor constructor"}, {"sha": "d884a15be41b8f4a6a52f572069de09c9885f46c", "filename": "libstdc++-v3/include/std/fstream", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0bc199fc5d4eef5a20ced20df892e5e3b8821b60/libstdc%2B%2B-v3%2Finclude%2Fstd%2Ffstream", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0bc199fc5d4eef5a20ced20df892e5e3b8821b60/libstdc%2B%2B-v3%2Finclude%2Fstd%2Ffstream", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Ffstream?ref=0bc199fc5d4eef5a20ced20df892e5e3b8821b60", "patch": "@@ -44,6 +44,11 @@\n #include <string>             // For std::string overloads.\n #endif\n \n+// This can be overridden by the target's os_defines.h\n+#ifndef _GLIBCXX_BUFSIZ\n+# define _GLIBCXX_BUFSIZ BUFSIZ\n+#endif\n+\n namespace std _GLIBCXX_VISIBILITY(default)\n {\n _GLIBCXX_BEGIN_NAMESPACE_VERSION"}]}