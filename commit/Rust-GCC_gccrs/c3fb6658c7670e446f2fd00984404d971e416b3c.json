{"sha": "c3fb6658c7670e446f2fd00984404d971e416b3c", "node_id": "C_kwDOANBUbNoAKGMzZmI2NjU4Yzc2NzBlNDQ2ZjJmZDAwOTg0NDA0ZDk3MWU0MTZiM2M", "commit": {"author": {"name": "Christophe Lyon", "email": "christophe.lyon@arm.com", "date": "2022-09-06T16:08:36Z"}, "committer": {"name": "Christophe Lyon", "email": "christophe.lyon@arm.com", "date": "2022-09-08T09:43:45Z"}, "message": "arm: Fix constant immediates predicates and constraints for some MVE builtins\n\nSeveral MVE builtins incorrectly use the same predicate/constraint\npair for several modes, which does not match the specification.\nThis patch uses the appropriate iterator instead.\n\n2022-09-06  Christophe Lyon  <christophe.lyon@arm.com>\n\n\tgcc/\n\t* config/arm/mve.md (mve_vqshluq_n_s<mode>): Use\n\tMVE_pred/MVE_constraint instead of mve_imm_7/Ra.\n\t(mve_vqshluq_m_n_s<mode>): Likewise.\n\t(mve_vqrshrnbq_n_<supf><mode>): Use MVE_pred3/MVE_constraint3\n\tinstead of mve_imm_8/Rb.\n\t(mve_vqrshrunbq_n_s<mode>): Likewise.\n\t(mve_vqrshrntq_n_<supf><mode>): Likewise.\n\t(mve_vqrshruntq_n_s<mode>): Likewise.\n\t(mve_vrshrnbq_n_<supf><mode>): Likewise.\n\t(mve_vrshrntq_n_<supf><mode>): Likewise.\n\t(mve_vqrshrnbq_m_n_<supf><mode>): Likewise.\n\t(mve_vqrshrntq_m_n_<supf><mode>): Likewise.\n\t(mve_vrshrnbq_m_n_<supf><mode>): Likewise.\n\t(mve_vrshrntq_m_n_<supf><mode>): Likewise.\n\t(mve_vqrshrunbq_m_n_s<mode>): Likewise.\n\t(mve_vsriq_n_<supf><mode): Use MVE_pred2/MVE_constraint2 instead\n\tof mve_imm_selective_upto_8/Rg.\n\t(mve_vsriq_m_n_<supf><mode>): Likewise.", "tree": {"sha": "516e81a789eaac0001281a12a754ad08174cda09", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/516e81a789eaac0001281a12a754ad08174cda09"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c3fb6658c7670e446f2fd00984404d971e416b3c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3fb6658c7670e446f2fd00984404d971e416b3c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c3fb6658c7670e446f2fd00984404d971e416b3c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3fb6658c7670e446f2fd00984404d971e416b3c/comments", "author": null, "committer": null, "parents": [{"sha": "fbb550359beb904f00f22b86b64a47313c0ae45a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fbb550359beb904f00f22b86b64a47313c0ae45a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fbb550359beb904f00f22b86b64a47313c0ae45a"}], "stats": {"total": 30, "additions": 15, "deletions": 15}, "files": [{"sha": "714178609f725a89598b0df1a0f748c60efd9ddc", "filename": "gcc/config/arm/mve.md", "status": "modified", "additions": 15, "deletions": 15, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3fb6658c7670e446f2fd00984404d971e416b3c/gcc%2Fconfig%2Farm%2Fmve.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3fb6658c7670e446f2fd00984404d971e416b3c/gcc%2Fconfig%2Farm%2Fmve.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Fmve.md?ref=c3fb6658c7670e446f2fd00984404d971e416b3c", "patch": "@@ -1624,7 +1624,7 @@\n   [\n    (set (match_operand:MVE_2 0 \"s_register_operand\" \"=w\")\n \t(unspec:MVE_2 [(match_operand:MVE_2 1 \"s_register_operand\" \"w\")\n-\t\t       (match_operand:SI 2 \"mve_imm_7\" \"Ra\")]\n+\t\t       (match_operand:SI 2 \"<MVE_pred>\" \"<MVE_constraint>\")]\n \t VQSHLUQ_N_S))\n   ]\n   \"TARGET_HAVE_MVE\"\n@@ -2615,7 +2615,7 @@\n    (set (match_operand:<V_narrow_pack> 0 \"s_register_operand\" \"=w\")\n \t(unspec:<V_narrow_pack> [(match_operand:<V_narrow_pack> 1 \"s_register_operand\" \"0\")\n \t\t\t\t (match_operand:MVE_5 2 \"s_register_operand\" \"w\")\n-\t\t\t\t (match_operand:SI 3 \"mve_imm_8\" \"Rb\")]\n+\t\t\t\t (match_operand:SI 3 \"<MVE_pred3>\" \"<MVE_constraint3>\")]\n \t VQRSHRNBQ_N))\n   ]\n   \"TARGET_HAVE_MVE\"\n@@ -2630,7 +2630,7 @@\n    (set (match_operand:<V_narrow_pack> 0 \"s_register_operand\" \"=w\")\n \t(unspec:<V_narrow_pack> [(match_operand:<V_narrow_pack> 1 \"s_register_operand\" \"0\")\n \t\t\t\t (match_operand:MVE_5 2 \"s_register_operand\" \"w\")\n-\t\t\t\t (match_operand:SI 3 \"mve_imm_8\" \"Rb\")]\n+\t\t\t\t (match_operand:SI 3 \"<MVE_pred3>\" \"<MVE_constraint3>\")]\n \t VQRSHRUNBQ_N_S))\n   ]\n   \"TARGET_HAVE_MVE\"\n@@ -3570,7 +3570,7 @@\n    (set (match_operand:MVE_2 0 \"s_register_operand\" \"=w\")\n \t(unspec:MVE_2 [(match_operand:MVE_2 1 \"s_register_operand\" \"0\")\n \t\t       (match_operand:MVE_2 2 \"s_register_operand\" \"w\")\n-\t\t       (match_operand:SI 3 \"mve_imm_selective_upto_8\" \"Rg\")]\n+\t\t       (match_operand:SI 3 \"<MVE_pred2>\" \"<MVE_constraint2>\")]\n \t VSRIQ_N))\n   ]\n   \"TARGET_HAVE_MVE\"\n@@ -4473,7 +4473,7 @@\n    (set (match_operand:<V_narrow_pack> 0 \"s_register_operand\" \"=w\")\n \t(unspec:<V_narrow_pack> [(match_operand:<V_narrow_pack> 1 \"s_register_operand\" \"0\")\n \t\t       (match_operand:MVE_5 2 \"s_register_operand\" \"w\")\n-\t\t       (match_operand:SI 3 \"mve_imm_8\" \"Rb\")]\n+\t\t       (match_operand:SI 3 \"<MVE_pred3>\" \"<MVE_constraint3>\")]\n \t VQRSHRNTQ_N))\n   ]\n   \"TARGET_HAVE_MVE\"\n@@ -4489,7 +4489,7 @@\n    (set (match_operand:<V_narrow_pack> 0 \"s_register_operand\" \"=w\")\n \t(unspec:<V_narrow_pack> [(match_operand:<V_narrow_pack> 1 \"s_register_operand\" \"0\")\n \t\t       (match_operand:MVE_5 2 \"s_register_operand\" \"w\")\n-\t\t       (match_operand:SI 3 \"mve_imm_8\" \"Rb\")]\n+\t\t       (match_operand:SI 3 \"<MVE_pred3>\" \"<MVE_constraint3>\")]\n \t VQRSHRUNTQ_N_S))\n   ]\n   \"TARGET_HAVE_MVE\"\n@@ -4777,7 +4777,7 @@\n    (set (match_operand:<V_narrow_pack> 0 \"s_register_operand\" \"=w\")\n \t(unspec:<V_narrow_pack> [(match_operand:<V_narrow_pack> 1 \"s_register_operand\" \"0\")\n \t\t       (match_operand:MVE_5 2 \"s_register_operand\" \"w\")\n-\t\t       (match_operand:SI 3 \"mve_imm_8\" \"Rb\")]\n+\t\t       (match_operand:SI 3 \"<MVE_pred3>\" \"<MVE_constraint3>\")]\n \t VRSHRNBQ_N))\n   ]\n   \"TARGET_HAVE_MVE\"\n@@ -4793,7 +4793,7 @@\n    (set (match_operand:<V_narrow_pack> 0 \"s_register_operand\" \"=w\")\n \t(unspec:<V_narrow_pack> [(match_operand:<V_narrow_pack> 1 \"s_register_operand\" \"0\")\n \t\t       (match_operand:MVE_5 2 \"s_register_operand\" \"w\")\n-\t\t       (match_operand:SI 3 \"mve_imm_8\" \"Rb\")]\n+\t\t       (match_operand:SI 3 \"<MVE_pred3>\" \"<MVE_constraint3>\")]\n \t VRSHRNTQ_N))\n   ]\n   \"TARGET_HAVE_MVE\"\n@@ -4987,7 +4987,7 @@\n    (set (match_operand:MVE_2 0 \"s_register_operand\" \"=w\")\n \t(unspec:MVE_2 [(match_operand:MVE_2 1 \"s_register_operand\" \"0\")\n \t\t       (match_operand:MVE_2 2 \"s_register_operand\" \"w\")\n-\t\t       (match_operand:SI 3 \"mve_imm_7\" \"Ra\")\n+\t\t       (match_operand:SI 3 \"<MVE_pred>\" \"<MVE_constraint>\")\n \t\t       (match_operand:<MVE_VPRED> 4 \"vpr_register_operand\" \"Up\")]\n \t VQSHLUQ_M_N_S))\n   ]\n@@ -5019,7 +5019,7 @@\n    (set (match_operand:MVE_2 0 \"s_register_operand\" \"=w\")\n \t(unspec:MVE_2 [(match_operand:MVE_2 1 \"s_register_operand\" \"0\")\n \t\t       (match_operand:MVE_2 2 \"s_register_operand\" \"w\")\n-\t\t       (match_operand:SI 3 \"mve_imm_selective_upto_8\" \"Rg\")\n+\t\t       (match_operand:SI 3 \"<MVE_pred2>\" \"<MVE_constraint2>\")\n \t\t       (match_operand:<MVE_VPRED> 4 \"vpr_register_operand\" \"Up\")]\n \t VSRIQ_M_N))\n   ]\n@@ -6138,7 +6138,7 @@\n    (set (match_operand:<V_narrow_pack> 0 \"s_register_operand\" \"=w\")\n \t(unspec:<V_narrow_pack> [(match_operand:<V_narrow_pack> 1 \"s_register_operand\" \"0\")\n \t\t       (match_operand:MVE_5 2 \"s_register_operand\" \"w\")\n-\t\t       (match_operand:SI 3 \"mve_imm_8\" \"Rb\")\n+\t\t       (match_operand:SI 3 \"<MVE_pred3>\" \"<MVE_constraint3>\")\n \t\t       (match_operand:<MVE_VPRED> 4 \"vpr_register_operand\" \"Up\")]\n \t VQRSHRNBQ_M_N))\n   ]\n@@ -6155,7 +6155,7 @@\n    (set (match_operand:<V_narrow_pack> 0 \"s_register_operand\" \"=w\")\n \t(unspec:<V_narrow_pack> [(match_operand:<V_narrow_pack> 1 \"s_register_operand\" \"0\")\n \t\t       (match_operand:MVE_5 2 \"s_register_operand\" \"w\")\n-\t\t       (match_operand:SI 3 \"mve_imm_8\" \"Rb\")\n+\t\t       (match_operand:SI 3 \"<MVE_pred3>\" \"<MVE_constraint3>\")\n \t\t       (match_operand:<MVE_VPRED> 4 \"vpr_register_operand\" \"Up\")]\n \t VQRSHRNTQ_M_N))\n   ]\n@@ -6223,7 +6223,7 @@\n    (set (match_operand:<V_narrow_pack> 0 \"s_register_operand\" \"=w\")\n \t(unspec:<V_narrow_pack> [(match_operand:<V_narrow_pack> 1 \"s_register_operand\" \"0\")\n \t\t       (match_operand:MVE_5 2 \"s_register_operand\" \"w\")\n-\t\t       (match_operand:SI 3 \"mve_imm_8\" \"Rb\")\n+\t\t       (match_operand:SI 3 \"<MVE_pred3>\" \"<MVE_constraint3>\")\n \t\t       (match_operand:<MVE_VPRED> 4 \"vpr_register_operand\" \"Up\")]\n \t VRSHRNBQ_M_N))\n   ]\n@@ -6240,7 +6240,7 @@\n    (set (match_operand:<V_narrow_pack> 0 \"s_register_operand\" \"=w\")\n \t(unspec:<V_narrow_pack> [(match_operand:<V_narrow_pack> 1 \"s_register_operand\" \"0\")\n \t\t       (match_operand:MVE_5 2 \"s_register_operand\" \"w\")\n-\t\t       (match_operand:SI 3 \"mve_imm_8\" \"Rb\")\n+\t\t       (match_operand:SI 3 \"<MVE_pred3>\" \"<MVE_constraint3>\")\n \t\t       (match_operand:<MVE_VPRED> 4 \"vpr_register_operand\" \"Up\")]\n \t VRSHRNTQ_M_N))\n   ]\n@@ -6461,7 +6461,7 @@\n    (set (match_operand:<V_narrow_pack> 0 \"s_register_operand\" \"=w\")\n \t(unspec:<V_narrow_pack> [(match_operand:<V_narrow_pack> 1 \"s_register_operand\" \"0\")\n \t\t       (match_operand:MVE_5 2 \"s_register_operand\" \"w\")\n-\t\t       (match_operand:SI 3 \"mve_imm_8\" \"Rb\")\n+\t\t       (match_operand:SI 3 \"<MVE_pred3>\" \"<MVE_constraint3>\")\n \t\t       (match_operand:<MVE_VPRED> 4 \"vpr_register_operand\" \"Up\")]\n \t VQRSHRUNBQ_M_N_S))\n   ]"}]}