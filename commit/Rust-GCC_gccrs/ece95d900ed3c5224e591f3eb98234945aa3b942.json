{"sha": "ece95d900ed3c5224e591f3eb98234945aa3b942", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWNlOTVkOTAwZWQzYzUyMjRlNTkxZjNlYjk4MjM0OTQ1YWEzYjk0Mg==", "commit": {"author": {"name": "Scott Brumbaugh", "email": "scottb.lists@verizon.net", "date": "2004-07-03T02:19:27Z"}, "committer": {"name": "Giovanni Bajo", "email": "giovannibajo@gcc.gnu.org", "date": "2004-07-03T02:19:27Z"}, "message": "re PR c++/3761 (ICE in check_template_shadow, at cp/pt.c:2013, with friend and strange class hierarchy)\n\n\tPR c++/3761\n\t* name-lookup.c (push_class_level_binding): Don't pass a\n\tTREE_LIST of ambiguous names to check_template_shadow as it\n\tonly handles declarations. Instead, pull the declaration\n\tout and pass that.\n\n\tPR c++/3761\n\t* g++.dg/lookup/crash4.C: New test.\n\nFrom-SVN: r84045", "tree": {"sha": "99ab5461a3e7691bb95fa81acf5604562d732ade", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/99ab5461a3e7691bb95fa81acf5604562d732ade"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ece95d900ed3c5224e591f3eb98234945aa3b942", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ece95d900ed3c5224e591f3eb98234945aa3b942", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ece95d900ed3c5224e591f3eb98234945aa3b942", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ece95d900ed3c5224e591f3eb98234945aa3b942/comments", "author": null, "committer": {"login": "rasky", "id": 1014109, "node_id": "MDQ6VXNlcjEwMTQxMDk=", "avatar_url": "https://avatars.githubusercontent.com/u/1014109?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rasky", "html_url": "https://github.com/rasky", "followers_url": "https://api.github.com/users/rasky/followers", "following_url": "https://api.github.com/users/rasky/following{/other_user}", "gists_url": "https://api.github.com/users/rasky/gists{/gist_id}", "starred_url": "https://api.github.com/users/rasky/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rasky/subscriptions", "organizations_url": "https://api.github.com/users/rasky/orgs", "repos_url": "https://api.github.com/users/rasky/repos", "events_url": "https://api.github.com/users/rasky/events{/privacy}", "received_events_url": "https://api.github.com/users/rasky/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "50c6431753ab7961b4330c5f3c7e611ad81e9178", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50c6431753ab7961b4330c5f3c7e611ad81e9178", "html_url": "https://github.com/Rust-GCC/gccrs/commit/50c6431753ab7961b4330c5f3c7e611ad81e9178"}], "stats": {"total": 44, "additions": 43, "deletions": 1}, "files": [{"sha": "8baadc015a2d83f654dc14e28cd86a1d859d08a7", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ece95d900ed3c5224e591f3eb98234945aa3b942/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ece95d900ed3c5224e591f3eb98234945aa3b942/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=ece95d900ed3c5224e591f3eb98234945aa3b942", "patch": "@@ -1,3 +1,11 @@\n+2004-07-03  Scott Brumbaugh  <scottb.lists@verizon.net>\r\n+\r\n+\tPR c++/3761\r\n+\t* name-lookup.c (push_class_level_binding): Don't pass a\r\n+\tTREE_LIST of ambiguous names to check_template_shadow as it\r\n+\tonly handles declarations. Instead, pull the declaration \r\n+\tout and pass that.\r\n+\n 2004-07-03  Giovanni Bajo  <giovannibajo@gcc.gnu.org>\n \n \tPR c++/14971"}, {"sha": "ef1668938d58a89ffd091524bfa860bce71646fa", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ece95d900ed3c5224e591f3eb98234945aa3b942/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ece95d900ed3c5224e591f3eb98234945aa3b942/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=ece95d900ed3c5224e591f3eb98234945aa3b942", "patch": "@@ -2777,7 +2777,18 @@ push_class_level_binding (tree name, tree x)\n   /* Make sure that this new member does not have the same name\n      as a template parameter.  */\n   if (TYPE_BEING_DEFINED (current_class_type))\n-    check_template_shadow (x);\n+    {\n+      tree decl = x;\n+\n+      /* We could have been passed a tree list if this is an ambiguous\n+\t declaration. If so, pull the declaration out because\n+\t check_template_shadow will not handle a TREE_LIST. */\n+      if (TREE_CODE (decl) == TREE_LIST \n+\t  && TREE_TYPE (decl) == error_mark_node)\n+\tdecl = TREE_VALUE (decl);\n+      \n+      check_template_shadow (decl);\n+    }\n \n   /* [class.mem]\n "}, {"sha": "cc8bd6e0c4ae5fedd18ba06dc21a405f8409b73f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ece95d900ed3c5224e591f3eb98234945aa3b942/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ece95d900ed3c5224e591f3eb98234945aa3b942/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ece95d900ed3c5224e591f3eb98234945aa3b942", "patch": "@@ -1,3 +1,8 @@\n+2004-07-03  Scott Brumbaugh  <scottb.lists@verizon.net>\r\n+\r\n+\tPR c++/3761\r\n+\t* g++.dg/lookup/crash4.C: New test.\r\n+\n 2004-07-02  Zack Weinberg  <zack@codesourcery.com>\n \n \t* gcc.c-torture/execute/builtin-abs-1.c"}, {"sha": "65686512a9d097e8db0f6bbada4ac4af50fadea6", "filename": "gcc/testsuite/g++.dg/lookup/crash4.C", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ece95d900ed3c5224e591f3eb98234945aa3b942/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fcrash4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ece95d900ed3c5224e591f3eb98234945aa3b942/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fcrash4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fcrash4.C?ref=ece95d900ed3c5224e591f3eb98234945aa3b942", "patch": "@@ -0,0 +1,18 @@\n+// { dg-do compile }\n+//\n+// PR 3761\n+\n+struct A {};\n+\n+struct B {};\n+\n+template <class T>\n+struct Foo : A, B\n+{\n+  void func(void);\n+\n+  struct Nested\n+  {\n+    friend void Foo::func(void);\n+  };\n+};"}]}