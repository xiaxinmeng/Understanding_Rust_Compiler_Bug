{"sha": "1d5053d6b407b6fc493151a3581df7c628ffa72b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWQ1MDUzZDZiNDA3YjZmYzQ5MzE1MWEzNTgxZGY3YzYyOGZmYTcyYg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2010-03-03T19:02:08Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2010-03-03T19:02:08Z"}, "message": "re PR c++/12909 (ambiguity in mangling vector types)\n\n\tPR c++/12909\n\t* lto-streamer.h (LTO_tags): Add LTO_var_decl_alias.\n\t* lto-streamer-in.c (lto_input_tree): Read it.\n\t* lto-streamer-out.c (output_unreferenced_globals): Write it.\n\nFrom-SVN: r157204", "tree": {"sha": "194d8b86327b39798460337e66b7e50860713988", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/194d8b86327b39798460337e66b7e50860713988"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1d5053d6b407b6fc493151a3581df7c628ffa72b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1d5053d6b407b6fc493151a3581df7c628ffa72b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1d5053d6b407b6fc493151a3581df7c628ffa72b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1d5053d6b407b6fc493151a3581df7c628ffa72b/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2c71ac786646a4ed4d221a574b2797c66549e9d6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c71ac786646a4ed4d221a574b2797c66549e9d6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2c71ac786646a4ed4d221a574b2797c66549e9d6"}], "stats": {"total": 59, "additions": 59, "deletions": 0}, "files": [{"sha": "1b749f4da4201862968e76a88aad0a89d7573dcf", "filename": "gcc/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d5053d6b407b6fc493151a3581df7c628ffa72b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d5053d6b407b6fc493151a3581df7c628ffa72b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1d5053d6b407b6fc493151a3581df7c628ffa72b", "patch": "@@ -5,6 +5,9 @@\n \t* varpool.c (varpool_extra_name_alias): New.\n \t(varpool_assemble_decl): Emit extra name aliases.\n \t(varpool_mark_needed_node): Look past an extra name alias.\n+\t* lto-streamer.h (LTO_tags): Add LTO_var_decl_alias.\n+\t* lto-streamer-in.c (lto_input_tree): Read it.\n+\t* lto-streamer-out.c (output_unreferenced_globals): Write it.\n \n 2010-03-03  Eric Botcazou  <ebotcazou@adacore.com>\n "}, {"sha": "b098be2b4c0c0d8e6925705d5a90b8492a57796b", "filename": "gcc/lto-streamer-in.c", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d5053d6b407b6fc493151a3581df7c628ffa72b/gcc%2Flto-streamer-in.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d5053d6b407b6fc493151a3581df7c628ffa72b/gcc%2Flto-streamer-in.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-streamer-in.c?ref=1d5053d6b407b6fc493151a3581df7c628ffa72b", "patch": "@@ -2696,6 +2696,17 @@ lto_input_tree (struct lto_input_block *ib, struct data_in *data_in)\n \t the code and class.  */\n       result = lto_get_builtin_tree (ib, data_in);\n     }\n+  else if (tag == LTO_var_decl_alias)\n+    {\n+      /* An extra_name alias for a variable.  */\n+      unsigned HOST_WIDE_INT ix;\n+      tree target;\n+      ix = lto_input_uleb128 (ib);\n+      result = lto_file_decl_data_get_var_decl (data_in->file_data, ix);\n+      ix = lto_input_uleb128 (ib);\n+      target = lto_file_decl_data_get_var_decl (data_in->file_data, ix);\n+      varpool_extra_name_alias (result, target);\n+    }\n   else if (tag == lto_tree_code_to_tag (INTEGER_CST))\n     {\n       /* For integer constants we only need the type and its hi/low"}, {"sha": "f375282beac8e41e07be0e0f42217561d8dbdc0a", "filename": "gcc/lto-streamer-out.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d5053d6b407b6fc493151a3581df7c628ffa72b/gcc%2Flto-streamer-out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d5053d6b407b6fc493151a3581df7c628ffa72b/gcc%2Flto-streamer-out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-streamer-out.c?ref=1d5053d6b407b6fc493151a3581df7c628ffa72b", "patch": "@@ -1978,13 +1978,26 @@ output_unreferenced_globals (cgraph_node_set set)\n \n       if (TREE_CODE (var) == VAR_DECL)\n         {\n+\t  struct varpool_node *alias;\n+\n           /* Output the object in order to output references used in the\n              initialization. */\n           lto_output_tree (ob, var, true);\n \n           /* If it is public we also need a reference to the object itself. */\n           if (TREE_PUBLIC (var))\n             lto_output_tree_ref (ob, var);\n+\n+\t  /* Also output any extra_name aliases for this variable.  */\n+\t  for (alias = vnode->extra_name; alias; alias = alias->next)\n+\t    {\n+\t      lto_output_tree (ob, alias->decl, true);\n+\t      output_record_start (ob, LTO_var_decl_alias);\n+\t      lto_output_var_decl_index (ob->decl_state, ob->main_stream,\n+\t\t\t\t\t alias->decl);\n+\t      lto_output_var_decl_index (ob->decl_state, ob->main_stream,\n+\t\t\t\t\t var);\n+\t    }\n         }\n     }\n "}, {"sha": "e67b669387fa429459bad4f647b3a8a13e66e8b3", "filename": "gcc/lto-streamer.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d5053d6b407b6fc493151a3581df7c628ffa72b/gcc%2Flto-streamer.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d5053d6b407b6fc493151a3581df7c628ffa72b/gcc%2Flto-streamer.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-streamer.h?ref=1d5053d6b407b6fc493151a3581df7c628ffa72b", "patch": "@@ -217,6 +217,9 @@ enum LTO_tags\n   /* Special for global streamer. Reference to previously-streamed node.  */\n   LTO_tree_pickle_reference,\n \n+  /* A decl which exists only to provide an extra symbol for another var.  */\n+  LTO_var_decl_alias,\n+\n   /* References to indexable tree nodes.  These objects are stored in\n      tables that are written separately from the function bodies that\n      reference them.  This way they can be instantiated even when the"}, {"sha": "637680f163465da02cb2cb1fe92ea5cfa12d96ae", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d5053d6b407b6fc493151a3581df7c628ffa72b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d5053d6b407b6fc493151a3581df7c628ffa72b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1d5053d6b407b6fc493151a3581df7c628ffa72b", "patch": "@@ -3,6 +3,9 @@\n \tPR c++/12909\n \t* g++.dg/abi/mangle40.C: New.\n \t* g++.dg/abi/mangle41.C: New.\n+\t* g++.dg/lto/20100302_0.C: New.\n+\t* g++.dg/lto/20100302_1.C: New.\n+\t* g++.dg/lto/20100302.h: New.\n \n 2010-03-03  Paul Thomas  <pault@gcc.gnu.org>\n "}, {"sha": "7260be10c91521d648207d94a1db2eae9a64920f", "filename": "gcc/testsuite/g++.dg/lto/20100302.h", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d5053d6b407b6fc493151a3581df7c628ffa72b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2F20100302.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d5053d6b407b6fc493151a3581df7c628ffa72b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2F20100302.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2F20100302.h?ref=1d5053d6b407b6fc493151a3581df7c628ffa72b", "patch": "@@ -0,0 +1,9 @@\n+typedef float mm128 __attribute ((vector_size (16)));\n+\n+template <class T>\n+struct A\n+{\n+  static T t;\n+};\n+\n+void f (mm128 *);"}, {"sha": "13d4373aea3d094bffed2dbe9c925024242ae3be", "filename": "gcc/testsuite/g++.dg/lto/20100302_0.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d5053d6b407b6fc493151a3581df7c628ffa72b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2F20100302_0.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d5053d6b407b6fc493151a3581df7c628ffa72b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2F20100302_0.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2F20100302_0.C?ref=1d5053d6b407b6fc493151a3581df7c628ffa72b", "patch": "@@ -0,0 +1,9 @@\n+// Test for ABI forward-compatibility aliases with LTO.\n+// { dg-skip-if \"\" { ! { i?86-*-* x86_64-*-* } } { \"*\" } { \"\" } }\n+// { dg-lto-options {\"-flto -fabi-version=2\"} }\n+\n+#include \"20100302.h\"\n+\n+void f(mm128 *) { }\n+\n+template <> mm128 A<mm128>::t = { };"}, {"sha": "48548b63ae93d9eedd2731cabc6e2695150586b1", "filename": "gcc/testsuite/g++.dg/lto/20100302_1.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d5053d6b407b6fc493151a3581df7c628ffa72b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2F20100302_1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d5053d6b407b6fc493151a3581df7c628ffa72b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2F20100302_1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2F20100302_1.C?ref=1d5053d6b407b6fc493151a3581df7c628ffa72b", "patch": "@@ -0,0 +1,8 @@\n+// { dg-options \"-fabi-version=0\" }\n+\n+#include \"20100302.h\"\n+\n+int main()\n+{\n+  f(& A<mm128>::t);\n+}"}]}