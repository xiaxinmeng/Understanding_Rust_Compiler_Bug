{"sha": "c3c669ac811429033c0151f910b38fc009e21ca8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzNjNjY5YWM4MTE0MjkwMzNjMDE1MWY5MTBiMzhmYzAwOWUyMWNhOA==", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2021-08-27T18:49:05Z"}, "committer": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2021-08-29T19:51:29Z"}, "message": "Darwin: Fixes for darwin_libc_has_function.\n\nFirstly, the checks for availability need not be run for any\ncurrently supported Darwin version (or for any version of\nDarwin on x86).  In fact, the only test that is needed that\ndiffers from the default is for the availbaility of sincos.\nTest that and then fall back to the default implementation.\n\nSecondly, the funtion appears to be called from the Jit library\nbefore the value of darwin_macosx_version_min has been set up -\nat present we work around this by guarding the checks on having\na non-null pointer for darwin_macosx_version_min.\n\nSigned-off-by: Iain Sandoe <iain@sandoe.co.uk>\n\ngcc/ChangeLog:\n\n\t* config/darwin.c (darwin_libc_has_function): Do not run\n\tthe checks for x86 or modern Darwin.  Make sure that there\n\tis a value set for darwin_macosx_version_min before testing.", "tree": {"sha": "336153c29753db835d91736c4f4ef7ddbc4c111b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/336153c29753db835d91736c4f4ef7ddbc4c111b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c3c669ac811429033c0151f910b38fc009e21ca8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3c669ac811429033c0151f910b38fc009e21ca8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c3c669ac811429033c0151f910b38fc009e21ca8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3c669ac811429033c0151f910b38fc009e21ca8/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "766f5f8726965dfe69e70f234a08f6bccedc144e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/766f5f8726965dfe69e70f234a08f6bccedc144e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/766f5f8726965dfe69e70f234a08f6bccedc144e"}], "stats": {"total": 14, "additions": 9, "deletions": 5}, "files": [{"sha": "781742fe46f8d5365c39f92929c4f43f8b53c14e", "filename": "gcc/config/darwin.c", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3c669ac811429033c0151f910b38fc009e21ca8/gcc%2Fconfig%2Fdarwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3c669ac811429033c0151f910b38fc009e21ca8/gcc%2Fconfig%2Fdarwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.c?ref=c3c669ac811429033c0151f910b38fc009e21ca8", "patch": "@@ -42,6 +42,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"explow.h\"\n #include \"expr.h\"\n #include \"langhooks.h\"\n+#include \"targhooks.h\"\n #include \"toplev.h\"\n #include \"lto-section-names.h\"\n #include \"intl.h\"\n@@ -3661,19 +3662,22 @@ darwin_rename_builtins (void)\n     }\n }\n \n+/* Implementation for the TARGET_LIBC_HAS_FUNCTION hook.  */\n+\n bool\n darwin_libc_has_function (enum function_class fn_class,\n \t\t\t  tree type ATTRIBUTE_UNUSED)\n {\n-  if (fn_class == function_sincos)\n+  if (fn_class == function_sincos && darwin_macosx_version_min)\n     return (strverscmp (darwin_macosx_version_min, \"10.9\") >= 0);\n-\n+#if DARWIN_PPC && SUPPORT_DARWIN_LEGACY\n   if (fn_class == function_c99_math_complex\n       || fn_class == function_c99_misc)\n     return (TARGET_64BIT\n-\t    || strverscmp (darwin_macosx_version_min, \"10.3\") >= 0);\n-\n-  return true;\n+\t    || (darwin_macosx_version_min &&\n+\t\tstrverscmp (darwin_macosx_version_min, \"10.3\") >= 0));\n+#endif\n+  return default_libc_has_function (fn_class, type);\n }\n \n hashval_t"}]}