{"sha": "b88c92ccb2bd49a12ce31432a36a42bec4a9b8bd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yjg4YzkyY2NiMmJkNDlhMTJjZTMxNDMyYTM2YTQyYmVjNGE5YjhiZA==", "commit": {"author": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1997-06-09T13:19:15Z"}, "committer": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1997-06-09T13:19:15Z"}, "message": "(final_scan_insn): Use single_set to check cc_status.flags.\n\nFrom-SVN: r14177", "tree": {"sha": "e572f320b17b185307493fa2f8668bf6d98d9abe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e572f320b17b185307493fa2f8668bf6d98d9abe"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b88c92ccb2bd49a12ce31432a36a42bec4a9b8bd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b88c92ccb2bd49a12ce31432a36a42bec4a9b8bd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b88c92ccb2bd49a12ce31432a36a42bec4a9b8bd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b88c92ccb2bd49a12ce31432a36a42bec4a9b8bd/comments", "author": null, "committer": null, "parents": [{"sha": "f9dcab5273c6957efd1249ab66bbb63ef86edf38", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f9dcab5273c6957efd1249ab66bbb63ef86edf38", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f9dcab5273c6957efd1249ab66bbb63ef86edf38"}], "stats": {"total": 24, "additions": 14, "deletions": 10}, "files": [{"sha": "91ad4989940896c1077714fe379a31d60d60b7a4", "filename": "gcc/final.c", "status": "modified", "additions": 14, "deletions": 10, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b88c92ccb2bd49a12ce31432a36a42bec4a9b8bd/gcc%2Ffinal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b88c92ccb2bd49a12ce31432a36a42bec4a9b8bd/gcc%2Ffinal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffinal.c?ref=b88c92ccb2bd49a12ce31432a36a42bec4a9b8bd", "patch": "@@ -1651,7 +1651,7 @@ final_scan_insn (insn, file, optimize, prescan, nopeepholes)\n \n     default:\n       {\n-\tregister rtx body = PATTERN (insn);\n+\tregister rtx body = PATTERN (insn), set;\n \tint insn_code_number;\n \tchar *template;\n \trtx note;\n@@ -1853,6 +1853,8 @@ final_scan_insn (insn, file, optimize, prescan, nopeepholes)\n \tbody = PATTERN (insn);\n \n #ifdef HAVE_cc0\n+\tset = single_set(insn);\n+\n \t/* Check for redundant test and compare instructions\n \t   (when the condition codes are already set up as desired).\n \t   This is done only when optimizing; if not optimizing,\n@@ -1863,7 +1865,9 @@ final_scan_insn (insn, file, optimize, prescan, nopeepholes)\n \n \tif (optimize)\n \t  {\n+#if 0\n \t    rtx set = single_set(insn);\n+#endif\n \n \t    if (set\n \t\t&& GET_CODE (SET_DEST (set)) == CC0\n@@ -1978,20 +1982,20 @@ final_scan_insn (insn, file, optimize, prescan, nopeepholes)\n \t   handle conditional moves (if this machine has either one).  */\n \n \tif (cc_status.flags != 0\n-\t    && GET_CODE (body) == SET)\n+\t    && set != 0)\n \t  {\n \t    rtx cond_rtx, then_rtx, else_rtx;\n \t    \n \t    if (GET_CODE (insn) != JUMP_INSN\n-\t\t&& GET_CODE (SET_SRC (body)) == IF_THEN_ELSE)\n+\t\t&& GET_CODE (SET_SRC (set)) == IF_THEN_ELSE)\n \t      {\n-\t\tcond_rtx = XEXP (SET_SRC (body), 0);\n-\t\tthen_rtx = XEXP (SET_SRC (body), 1);\n-\t\telse_rtx = XEXP (SET_SRC (body), 2);\n+\t\tcond_rtx = XEXP (SET_SRC (set), 0);\n+\t\tthen_rtx = XEXP (SET_SRC (set), 1);\n+\t\telse_rtx = XEXP (SET_SRC (set), 2);\n \t      }\n \t    else\n \t      {\n-\t\tcond_rtx = SET_SRC (body);\n+\t\tcond_rtx = SET_SRC (set);\n \t\tthen_rtx = const_true_rtx;\n \t\telse_rtx = const0_rtx;\n \t      }\n@@ -2014,12 +2018,12 @@ final_scan_insn (insn, file, optimize, prescan, nopeepholes)\n \t\t    break;\n \t\t  result = alter_cond (cond_rtx);\n \t\t  if (result == 1)\n-\t\t    validate_change (insn, &SET_SRC (body), then_rtx, 0);\n+\t\t    validate_change (insn, &SET_SRC (set), then_rtx, 0);\n \t\t  else if (result == -1)\n-\t\t    validate_change (insn, &SET_SRC (body), else_rtx, 0);\n+\t\t    validate_change (insn, &SET_SRC (set), else_rtx, 0);\n \t\t  else if (result == 2)\n \t\t    INSN_CODE (insn) = -1;\n-\t\t  if (SET_DEST (body) == SET_SRC (body))\n+\t\t  if (SET_DEST (set) == SET_SRC (set))\n \t\t    {\n \t\t      PUT_CODE (insn, NOTE);\n \t\t      NOTE_LINE_NUMBER (insn) = NOTE_INSN_DELETED;"}]}