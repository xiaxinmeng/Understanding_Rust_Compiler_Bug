{"sha": "89f20c9ae4641f9b2e87e47f7dab3dc197faa0aa", "node_id": "C_kwDOANBUbNoAKDg5ZjIwYzlhZTQ2NDFmOWIyZTg3ZTQ3ZjdkYWIzZGMxOTdmYWEwYWE", "commit": {"author": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2022-10-09T18:43:32Z"}, "committer": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2022-10-14T20:16:57Z"}, "message": "Fortran: fix check of polymorphic elements in data transfers [PR100971]\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/100971\n\t* resolve.cc (resolve_transfer): Extend check for permissibility\n\tof polymorphic elements in a data transfer to arrays.\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/100971\n\t* gfortran.dg/der_io_5.f90: New test.", "tree": {"sha": "eb59194934bc7d22c0af1d85722278ca08d95e4b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eb59194934bc7d22c0af1d85722278ca08d95e4b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/89f20c9ae4641f9b2e87e47f7dab3dc197faa0aa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/89f20c9ae4641f9b2e87e47f7dab3dc197faa0aa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/89f20c9ae4641f9b2e87e47f7dab3dc197faa0aa", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/89f20c9ae4641f9b2e87e47f7dab3dc197faa0aa/comments", "author": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "committer": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b4a4c6382b14bc107d6d95ff809f3e9cd71944e7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b4a4c6382b14bc107d6d95ff809f3e9cd71944e7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b4a4c6382b14bc107d6d95ff809f3e9cd71944e7"}], "stats": {"total": 22, "additions": 22, "deletions": 0}, "files": [{"sha": "9202e2f10ad6d27bb90100fd0936523b98bf1d39", "filename": "gcc/fortran/resolve.cc", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/89f20c9ae4641f9b2e87e47f7dab3dc197faa0aa/gcc%2Ffortran%2Fresolve.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/89f20c9ae4641f9b2e87e47f7dab3dc197faa0aa/gcc%2Ffortran%2Fresolve.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.cc?ref=89f20c9ae4641f9b2e87e47f7dab3dc197faa0aa", "patch": "@@ -10017,6 +10017,7 @@ resolve_transfer (gfc_code *code)\n \n   if (exp == NULL || (exp->expr_type != EXPR_VARIABLE\n \t\t      && exp->expr_type != EXPR_FUNCTION\n+\t\t      && exp->expr_type != EXPR_ARRAY\n \t\t      && exp->expr_type != EXPR_STRUCTURE))\n     return;\n \n@@ -10030,6 +10031,7 @@ resolve_transfer (gfc_code *code)\n \n   const gfc_typespec *ts = exp->expr_type == EXPR_STRUCTURE\n \t\t\t|| exp->expr_type == EXPR_FUNCTION\n+\t\t\t|| exp->expr_type == EXPR_ARRAY\n \t\t\t ? &exp->ts : &exp->symtree->n.sym->ts;\n \n   /* Go to actual component transferred.  */\n@@ -10128,6 +10130,9 @@ resolve_transfer (gfc_code *code)\n   if (exp->expr_type == EXPR_STRUCTURE)\n     return;\n \n+  if (exp->expr_type == EXPR_ARRAY)\n+    return;\n+\n   sym = exp->symtree->n.sym;\n \n   if (sym->as != NULL && sym->as->type == AS_ASSUMED_SIZE && exp->ref"}, {"sha": "193916c4a651142db86d4fb52cefb586ec416e54", "filename": "gcc/testsuite/gfortran.dg/der_io_5.f90", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/89f20c9ae4641f9b2e87e47f7dab3dc197faa0aa/gcc%2Ftestsuite%2Fgfortran.dg%2Fder_io_5.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/89f20c9ae4641f9b2e87e47f7dab3dc197faa0aa/gcc%2Ftestsuite%2Fgfortran.dg%2Fder_io_5.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fder_io_5.f90?ref=89f20c9ae4641f9b2e87e47f7dab3dc197faa0aa", "patch": "@@ -0,0 +1,17 @@\n+! { dg-do compile }\n+! PR fortran/100971 - ICE: Bad IO basetype (7)\n+! Contributed by G.Steinmetz\n+\n+program p\n+  implicit none\n+  type t\n+  end type\n+  class(t), allocatable :: a, b(:)\n+  type(t)               :: x, y(1)\n+  integer               :: i\n+  allocate (a,b(1))\n+  print *, [a]            ! { dg-error \"Data transfer element at .1. cannot be polymorphic\" }\n+  print *, [(b(i),i=1,1)] ! { dg-error \"Data transfer element at .1. cannot be polymorphic\" }\n+  print *, [x]\n+  print *, [(y(i),i=1,1)]\n+end"}]}