{"sha": "08f8a7162498b232831808a37b7fe6b9d95c8536", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDhmOGE3MTYyNDk4YjIzMjgzMTgwOGEzN2I3ZmU2YjlkOTVjODUzNg==", "commit": {"author": {"name": "Olivier Hainque", "email": "hainque@adacore.com", "date": "2018-05-21T14:50:28Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-05-21T14:50:28Z"}, "message": "[Ada] Propagate load addresses for traceback cache on Linux\n\nSymbolization of traceback addresses through shared libraries\nrequires information on the shared libraries load addresses, which\nwas at hand on Linuxbut not propagated through the runtime when\ncaching is enabled.  This change fixes this.\n\n2018-05-21  Olivier Hainque  <hainque@adacore.com>\n\ngcc/ada/\n\n\t* libgnat/s-trasym__dwarf.adb (Add_Module_To_Cache): Expect a\n\tLoad_Address argument and pass it down to Init_Module.\n\t* libgnat/s-tsmona__linux.adb (Build_Cache_For_All_Modules): Pass\n\tlm.l_addr as the Load_Address to Add_Module_To_Cache.\n\nFrom-SVN: r260448", "tree": {"sha": "ff189a166d9a436bc0ac7bbc8f0c7104d7c2c012", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ff189a166d9a436bc0ac7bbc8f0c7104d7c2c012"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/08f8a7162498b232831808a37b7fe6b9d95c8536", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/08f8a7162498b232831808a37b7fe6b9d95c8536", "html_url": "https://github.com/Rust-GCC/gccrs/commit/08f8a7162498b232831808a37b7fe6b9d95c8536", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/08f8a7162498b232831808a37b7fe6b9d95c8536/comments", "author": {"login": "hainque", "id": 18735142, "node_id": "MDQ6VXNlcjE4NzM1MTQy", "avatar_url": "https://avatars.githubusercontent.com/u/18735142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hainque", "html_url": "https://github.com/hainque", "followers_url": "https://api.github.com/users/hainque/followers", "following_url": "https://api.github.com/users/hainque/following{/other_user}", "gists_url": "https://api.github.com/users/hainque/gists{/gist_id}", "starred_url": "https://api.github.com/users/hainque/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hainque/subscriptions", "organizations_url": "https://api.github.com/users/hainque/orgs", "repos_url": "https://api.github.com/users/hainque/repos", "events_url": "https://api.github.com/users/hainque/events{/privacy}", "received_events_url": "https://api.github.com/users/hainque/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "689751d2f7ae12bd34637801860a766d1196d960", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/689751d2f7ae12bd34637801860a766d1196d960", "html_url": "https://github.com/Rust-GCC/gccrs/commit/689751d2f7ae12bd34637801860a766d1196d960"}], "stats": {"total": 18, "additions": 14, "deletions": 4}, "files": [{"sha": "6eadcf957fadc6efec6b7f7f5c854896231c0b90", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08f8a7162498b232831808a37b7fe6b9d95c8536/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08f8a7162498b232831808a37b7fe6b9d95c8536/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=08f8a7162498b232831808a37b7fe6b9d95c8536", "patch": "@@ -1,3 +1,10 @@\n+2018-04-04  Olivier Hainque  <hainque@adacore.com>\n+\n+\t* libgnat/s-trasym__dwarf.adb (Add_Module_To_Cache): Expect a\n+\tLoad_Address argument and pass it down to Init_Module.\n+\t* libgnat/s-tsmona__linux.adb (Build_Cache_For_All_Modules): Pass\n+\tlm.l_addr as the Load_Address to Add_Module_To_Cache.\n+\n 2018-04-04  Piotr Trojanek  <trojanek@adacore.com>\n \n \t* einfo.adb (Has_Discriminants): Stronger assertion."}, {"sha": "5330e4a270f365ddfead2b11db0c9662d294de62", "filename": "gcc/ada/libgnat/s-trasym__dwarf.adb", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08f8a7162498b232831808a37b7fe6b9d95c8536/gcc%2Fada%2Flibgnat%2Fs-trasym__dwarf.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08f8a7162498b232831808a37b7fe6b9d95c8536/gcc%2Fada%2Flibgnat%2Fs-trasym__dwarf.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flibgnat%2Fs-trasym__dwarf.adb?ref=08f8a7162498b232831808a37b7fe6b9d95c8536", "patch": "@@ -123,7 +123,8 @@ package body System.Traceback.Symbolic is\n    --  Return the String contained in Item, up until the first NUL character\n \n    pragma Warnings (Off, \"*Add_Module_To_Cache*\");\n-   procedure Add_Module_To_Cache (Module_Name : String);\n+   procedure Add_Module_To_Cache (Module_Name : String;\n+                                  Load_Address : System.Address);\n    --  To be called by Build_Cache_For_All_Modules to add a new module to the\n    --  list. May not be referenced.\n \n@@ -217,12 +218,14 @@ package body System.Traceback.Symbolic is\n    -- Add_Module_To_Cache --\n    -------------------------\n \n-   procedure Add_Module_To_Cache (Module_Name : String) is\n+   procedure Add_Module_To_Cache (Module_Name : String;\n+                                  Load_Address : System.Address)\n+   is\n       Module  : Module_Cache_Acc;\n       Success : Boolean;\n    begin\n       Module := new Module_Cache;\n-      Init_Module (Module.all, Success, Module_Name);\n+      Init_Module (Module.all, Success, Module_Name, Load_Address);\n       if not Success then\n          Free (Module);\n          return;"}, {"sha": "ae91c40278cb713c77e70b8bbbfdcf7ae75d1af2", "filename": "gcc/ada/libgnat/s-tsmona__linux.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08f8a7162498b232831808a37b7fe6b9d95c8536/gcc%2Fada%2Flibgnat%2Fs-tsmona__linux.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08f8a7162498b232831808a37b7fe6b9d95c8536/gcc%2Fada%2Flibgnat%2Fs-tsmona__linux.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flibgnat%2Fs-tsmona__linux.adb?ref=08f8a7162498b232831808a37b7fe6b9d95c8536", "patch": "@@ -122,7 +122,7 @@ package body Module_Name is\n       while lm /= null loop\n          if Big_String_Conv.To_Pointer (lm.l_name) (1) /= ASCII.NUL then\n             --  Discard non-file (like the executable itself or the gate).\n-            Add_Module_To_Cache (Value (lm.l_name));\n+            Add_Module_To_Cache (Value (lm.l_name), lm.l_addr);\n          end if;\n          lm := lm.l_next;\n       end loop;"}]}