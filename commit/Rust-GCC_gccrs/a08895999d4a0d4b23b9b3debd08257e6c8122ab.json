{"sha": "a08895999d4a0d4b23b9b3debd08257e6c8122ab", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTA4ODk1OTk5ZDRhMGQ0YjIzYjliM2RlYmQwODI1N2U2YzgxMjJhYg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2017-01-19T15:59:04Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2017-01-19T15:59:04Z"}, "message": "Array decomposition fix.\n\n\t* decl.c (check_initializer): Always use build_aggr_init for array\n\tdecomposition.\n\nFrom-SVN: r244639", "tree": {"sha": "3a9f3941a9e336b00f7aaed2bc0405740119080c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3a9f3941a9e336b00f7aaed2bc0405740119080c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a08895999d4a0d4b23b9b3debd08257e6c8122ab", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a08895999d4a0d4b23b9b3debd08257e6c8122ab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a08895999d4a0d4b23b9b3debd08257e6c8122ab", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a08895999d4a0d4b23b9b3debd08257e6c8122ab/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b32e85fa42678b061f30fa6fc52e0713d980a6df", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b32e85fa42678b061f30fa6fc52e0713d980a6df", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b32e85fa42678b061f30fa6fc52e0713d980a6df"}], "stats": {"total": 35, "additions": 27, "deletions": 8}, "files": [{"sha": "90e230fc344ab0f7426aea4a8874dc616da33d39", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a08895999d4a0d4b23b9b3debd08257e6c8122ab/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a08895999d4a0d4b23b9b3debd08257e6c8122ab/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=a08895999d4a0d4b23b9b3debd08257e6c8122ab", "patch": "@@ -1,5 +1,8 @@\n 2017-01-19  Jason Merrill  <jason@redhat.com>\n \n+\t* decl.c (check_initializer): Always use build_aggr_init for array\n+\tdecomposition.\n+\n \tPR c++/79130 - decomposition and direct-initialization\n \t* init.c (build_aggr_init): Communicate direct-initialization to\n \tbuild_vec_init."}, {"sha": "792ebcc978c09810b42658c2ee4c73fc1e3d10ea", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a08895999d4a0d4b23b9b3debd08257e6c8122ab/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a08895999d4a0d4b23b9b3debd08257e6c8122ab/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=a08895999d4a0d4b23b9b3debd08257e6c8122ab", "patch": "@@ -6299,14 +6299,14 @@ check_initializer (tree decl, tree init, int flags, vec<tree, va_gc> **cleanups)\n       if (type == error_mark_node)\n \treturn NULL_TREE;\n \n-      if ((type_build_ctor_call (type) || CLASS_TYPE_P (type)\n-\t   || (DECL_DECOMPOSITION_P (decl) && TREE_CODE (type) == ARRAY_TYPE))\n-\t  && !(flags & LOOKUP_ALREADY_DIGESTED)\n-\t  && !(init && BRACE_ENCLOSED_INITIALIZER_P (init)\n-\t       && CP_AGGREGATE_TYPE_P (type)\n-\t       && (CLASS_TYPE_P (type)\n-\t\t   || !TYPE_NEEDS_CONSTRUCTING (type)\n-\t\t   || type_has_extended_temps (type))))\n+      if (((type_build_ctor_call (type) || CLASS_TYPE_P (type))\n+\t   && !(flags & LOOKUP_ALREADY_DIGESTED)\n+\t   && !(init && BRACE_ENCLOSED_INITIALIZER_P (init)\n+\t\t&& CP_AGGREGATE_TYPE_P (type)\n+\t\t&& (CLASS_TYPE_P (type)\n+\t\t    || !TYPE_NEEDS_CONSTRUCTING (type)\n+\t\t    || type_has_extended_temps (type))))\n+\t  || (DECL_DECOMPOSITION_P (decl) && TREE_CODE (type) == ARRAY_TYPE))\n \t{\n \t  init_code = build_aggr_init_full_exprs (decl, init, flags);\n "}, {"sha": "d046ed54a145ca4c86cf98b6530ad4cef7eb9bb9", "filename": "gcc/testsuite/g++.dg/cpp1z/decomp21.C", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a08895999d4a0d4b23b9b3debd08257e6c8122ab/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fdecomp21.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a08895999d4a0d4b23b9b3debd08257e6c8122ab/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fdecomp21.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fdecomp21.C?ref=a08895999d4a0d4b23b9b3debd08257e6c8122ab", "patch": "@@ -0,0 +1,16 @@\n+// { dg-options -std=c++1z }\n+\n+int a[3];\n+struct S { int b, c, d; } s;\n+void\n+foo ()\n+{\n+  auto [ b, c, d ] = a;\n+  auto [ e, f, g ] = s;\n+  auto [ h, i, j ] { s };\n+  auto [ k, l, m ] { s, };\n+  auto [ n, o, p ] { a };\n+  auto [ q, r, t ] ( s );\n+  auto [ u, v, w ] ( s, );      // { dg-error \"expected primary-expression before '.' token\" }\n+  auto [ x, y, z ] ( a );       // { dg-error \"expression list treated as compound expression in initializer\" \"\" { target *-*-* } .-1 }\n+}"}]}