{"sha": "3ed779689631ff8f398dcde06d5efa2a3c43ef27", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2VkNzc5Njg5NjMxZmY4ZjM5OGRjZGUwNmQ1ZWZhMmEzYzQzZWYyNw==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-08-17T09:23:06Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-08-17T09:24:14Z"}, "message": "tree-optimization/101868 - avoid PRE of trapping mems across calls\n\nThis adds the testcase from the fix for the PR.\n\n2021-08-17  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/101868\n\t* gcc.dg/lto/pr101868_0.c: New testcase.\n\t* gcc.dg/lto/pr101868_1.c: Likewise.\n\t* gcc.dg/lto/pr101868_2.c: Likewise.\n\t* gcc.dg/lto/pr101868_3.c: Likewise.", "tree": {"sha": "b4b967559a5fdd4a12af45519c964680b8625b5c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b4b967559a5fdd4a12af45519c964680b8625b5c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3ed779689631ff8f398dcde06d5efa2a3c43ef27", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ed779689631ff8f398dcde06d5efa2a3c43ef27", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3ed779689631ff8f398dcde06d5efa2a3c43ef27", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ed779689631ff8f398dcde06d5efa2a3c43ef27/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2e0d7f16da0897fb2eb83f5c1ffe67f0ad747e92", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2e0d7f16da0897fb2eb83f5c1ffe67f0ad747e92", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2e0d7f16da0897fb2eb83f5c1ffe67f0ad747e92"}], "stats": {"total": 75, "additions": 75, "deletions": 0}, "files": [{"sha": "c84d19b0267c123ff8e6e1cf24a4214b980fb22e", "filename": "gcc/testsuite/gcc.dg/lto/pr101868_0.c", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ed779689631ff8f398dcde06d5efa2a3c43ef27/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr101868_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ed779689631ff8f398dcde06d5efa2a3c43ef27/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr101868_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr101868_0.c?ref=3ed779689631ff8f398dcde06d5efa2a3c43ef27", "patch": "@@ -0,0 +1,33 @@\n+/* { dg-lto-do run } */\n+/* { dg-lto-options { \"-O2 -fno-strict-aliasing -flto\" } } */\n+\n+typedef unsigned long VALUE;\n+\n+__attribute__ ((cold))\n+void rb_check_type(VALUE, int);\n+\n+static VALUE\n+repro(VALUE dummy, VALUE hash)\n+{\n+    if (hash == 0) {\n+        rb_check_type(hash, 1);\n+    }\n+    else if (*(long *)hash) {\n+        rb_check_type(hash, 1);\n+    }\n+\n+\n+    return *(long *)hash;\n+}\n+\n+static VALUE (*that)(VALUE dummy, VALUE hash) = repro;\n+\n+int\n+main(int argc, char **argv)\n+{\n+        argc--;\n+        that(0, argc);\n+\n+        rb_check_type(argc, argc);\n+\n+}"}, {"sha": "146c14abc76d447d9ed03fcb757788d88ee3d50d", "filename": "gcc/testsuite/gcc.dg/lto/pr101868_1.c", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ed779689631ff8f398dcde06d5efa2a3c43ef27/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr101868_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ed779689631ff8f398dcde06d5efa2a3c43ef27/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr101868_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr101868_1.c?ref=3ed779689631ff8f398dcde06d5efa2a3c43ef27", "patch": "@@ -0,0 +1,23 @@\n+typedef unsigned long VALUE;\n+\n+\n+__attribute__ ((noreturn)) void rexc_raise(VALUE mesg);\n+\n+VALUE rb_donothing(VALUE klass);\n+\n+static void\n+funexpected_type(VALUE x, int xt, int t)\n+{\n+    rexc_raise(rb_donothing(0));\n+}\n+\n+__attribute__ ((cold))\n+void\n+rb_check_type(VALUE x, int t)\n+{\n+    int xt;\n+\n+    if (x == 0) {\n+        funexpected_type(x, xt, t);\n+    }\n+}"}, {"sha": "e6f01b23f45a8b672df99916fd753f74f8ce5bca", "filename": "gcc/testsuite/gcc.dg/lto/pr101868_2.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ed779689631ff8f398dcde06d5efa2a3c43ef27/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr101868_2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ed779689631ff8f398dcde06d5efa2a3c43ef27/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr101868_2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr101868_2.c?ref=3ed779689631ff8f398dcde06d5efa2a3c43ef27", "patch": "@@ -0,0 +1,11 @@\n+typedef unsigned long VALUE;\n+\n+static void thing(void) {}\n+static void (*ptr)(void) = &thing;\n+\n+VALUE\n+rb_donothing(VALUE klass)\n+{\n+        ptr();\n+        return 0;\n+}"}, {"sha": "61217625be7060627edc03533c3f985edbf0ba07", "filename": "gcc/testsuite/gcc.dg/lto/pr101868_3.c", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ed779689631ff8f398dcde06d5efa2a3c43ef27/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr101868_3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ed779689631ff8f398dcde06d5efa2a3c43ef27/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr101868_3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr101868_3.c?ref=3ed779689631ff8f398dcde06d5efa2a3c43ef27", "patch": "@@ -0,0 +1,8 @@\n+typedef unsigned long VALUE;\n+\n+__attribute__((noreturn))\n+void\n+rexc_raise(VALUE mesg)\n+{\n+        __builtin_exit(0);\n+}"}]}