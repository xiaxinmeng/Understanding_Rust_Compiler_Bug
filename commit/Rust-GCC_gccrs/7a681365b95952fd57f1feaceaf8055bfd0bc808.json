{"sha": "7a681365b95952fd57f1feaceaf8055bfd0bc808", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2E2ODEzNjViOTU5NTJmZDU3ZjFmZWFjZWFmODA1NWJmZDBiYzgwOA==", "commit": {"author": {"name": "Geoffrey Keating", "email": "geoffk@apple.com", "date": "2003-12-17T22:04:34Z"}, "committer": {"name": "Geoffrey Keating", "email": "geoffk@gcc.gnu.org", "date": "2003-12-17T22:04:34Z"}, "message": "re PR pch/12480 (pch error messages do not say they for PCH.)\n\n\tPR 12480\n\t* c-pch.c (pch_init): Improve error message when precompiled\n\theader can't be written.\n\n\tPR 12606\n\t* c-pch.c (pch_init): Make a PCH file appear invalid while it's\n\tbeing written.\n\t(c_common_write_pch): Make it valid once it's done.\n\nFrom-SVN: r74754", "tree": {"sha": "2780844c969fe224c893796f8799394d93765178", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2780844c969fe224c893796f8799394d93765178"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7a681365b95952fd57f1feaceaf8055bfd0bc808", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7a681365b95952fd57f1feaceaf8055bfd0bc808", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7a681365b95952fd57f1feaceaf8055bfd0bc808", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7a681365b95952fd57f1feaceaf8055bfd0bc808/comments", "author": {"login": "geoffk01", "id": 31905243, "node_id": "MDQ6VXNlcjMxOTA1MjQz", "avatar_url": "https://avatars.githubusercontent.com/u/31905243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/geoffk01", "html_url": "https://github.com/geoffk01", "followers_url": "https://api.github.com/users/geoffk01/followers", "following_url": "https://api.github.com/users/geoffk01/following{/other_user}", "gists_url": "https://api.github.com/users/geoffk01/gists{/gist_id}", "starred_url": "https://api.github.com/users/geoffk01/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/geoffk01/subscriptions", "organizations_url": "https://api.github.com/users/geoffk01/orgs", "repos_url": "https://api.github.com/users/geoffk01/repos", "events_url": "https://api.github.com/users/geoffk01/events{/privacy}", "received_events_url": "https://api.github.com/users/geoffk01/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "287ff1982c1e70f66d91ad56615a8694e9c09fa9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/287ff1982c1e70f66d91ad56615a8694e9c09fa9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/287ff1982c1e70f66d91ad56615a8694e9c09fa9"}], "stats": {"total": 20, "additions": 18, "deletions": 2}, "files": [{"sha": "2aa4fbc64064cfaba9a9c8e457fe32be51b39288", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a681365b95952fd57f1feaceaf8055bfd0bc808/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a681365b95952fd57f1feaceaf8055bfd0bc808/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7a681365b95952fd57f1feaceaf8055bfd0bc808", "patch": "@@ -1,3 +1,14 @@\n+2003-12-16  Geoffrey Keating  <geoffk@apple.com>\n+\n+\tPR 12480\n+\t* c-pch.c (pch_init): Improve error message when precompiled\n+\theader can't be written.\n+\n+\tPR 12606\n+\t* c-pch.c (pch_init): Make a PCH file appear invalid while it's\n+\tbeing written.\n+\t(c_common_write_pch): Make it valid once it's done.\n+\n 2003-12-17  Ulrich Weigand  <uweigand@de.ibm.com>\n \n \tPR target/11992"}, {"sha": "157061f917706d35fc1e1388efce9ba818bd4d8d", "filename": "gcc/c-pch.c", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a681365b95952fd57f1feaceaf8055bfd0bc808/gcc%2Fc-pch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a681365b95952fd57f1feaceaf8055bfd0bc808/gcc%2Fc-pch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-pch.c?ref=7a681365b95952fd57f1feaceaf8055bfd0bc808", "patch": "@@ -102,13 +102,14 @@ pch_init (void)\n   FILE *f;\n   struct c_pch_validity v;\n   void *target_validity;\n+  static const char partial_pch[IDENT_LENGTH] = \"gpcWrite\";\n   \n   if (! pch_file)\n     return;\n   \n   f = fopen (pch_file, \"w+b\");\n   if (f == NULL)\n-    fatal_error (\"can't open %s: %m\", pch_file);\n+    fatal_error (\"can't create precompiled header %s: %m\", pch_file);\n   pch_outfile = f;\n   \n   if (strlen (host_machine) > 255 || strlen (target_machine) > 255\n@@ -122,7 +123,7 @@ pch_init (void)\n   v.pch_init = &pch_init;\n   target_validity = targetm.get_pch_validity (&v.target_data_length);\n   \n-  if (fwrite (get_ident(), IDENT_LENGTH, 1, f) != 1\n+  if (fwrite (partial_pch, IDENT_LENGTH, 1, f) != 1\n       || fwrite (&v, sizeof (v), 1, f) != 1\n       || fwrite (host_machine, v.host_machine_length, 1, f) != 1\n       || fwrite (target_machine, v.target_machine_length, 1, f) != 1\n@@ -189,6 +190,10 @@ c_common_write_pch (void)\n   gt_pch_save (pch_outfile);\n   cpp_write_pch_state (parse_in, pch_outfile);\n \n+  if (fseek (pch_outfile, 0, SEEK_SET) != 0\n+      || fwrite (get_ident (), IDENT_LENGTH, 1, pch_outfile) != 1)\n+    fatal_error (\"can't write %s: %m\", pch_file);\n+\n   fclose (pch_outfile);\n }\n "}]}