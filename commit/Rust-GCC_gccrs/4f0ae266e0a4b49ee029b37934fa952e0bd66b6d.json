{"sha": "4f0ae266e0a4b49ee029b37934fa952e0bd66b6d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGYwYWUyNjZlMGE0YjQ5ZWUwMjliMzc5MzRmYTk1MmUwYmQ2NmI2ZA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2009-04-08T20:04:45Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2009-04-08T20:04:45Z"}, "message": "re PR middle-end/39573 (Linking fails on AMD with -march=native and -fopenmp, works with generic x86_64)\n\n\tPR middle-end/39573\n\t* omp-low.c (expand_omp_taskreg): Finalize taskreg static local_decls\n\tvariables.\n\n\t* libgomp.c++/pr39573.C: New test.\n\nFrom-SVN: r145772", "tree": {"sha": "1f9294de165086bb00dcf11817a395d75138daaa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1f9294de165086bb00dcf11817a395d75138daaa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4f0ae266e0a4b49ee029b37934fa952e0bd66b6d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f0ae266e0a4b49ee029b37934fa952e0bd66b6d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f0ae266e0a4b49ee029b37934fa952e0bd66b6d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f0ae266e0a4b49ee029b37934fa952e0bd66b6d/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "dead0bae538e7d7014947a7898aec6b5596f5e4a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dead0bae538e7d7014947a7898aec6b5596f5e4a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dead0bae538e7d7014947a7898aec6b5596f5e4a"}], "stats": {"total": 56, "additions": 56, "deletions": 0}, "files": [{"sha": "45ed3e53d29e39a52966628c07899123162e5e28", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f0ae266e0a4b49ee029b37934fa952e0bd66b6d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f0ae266e0a4b49ee029b37934fa952e0bd66b6d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4f0ae266e0a4b49ee029b37934fa952e0bd66b6d", "patch": "@@ -5,6 +5,10 @@\n \t(gen_variable_die): Use DW_TAG_member tag for static data member\n \tdeclarations instead of DW_TAG_variable.\n \n+\tPR middle-end/39573\n+\t* omp-low.c (expand_omp_taskreg): Finalize taskreg static local_decls\n+\tvariables.\n+\n 2009-04-08  Richard Guenther  <rguenther@suse.de>\n \n \t* tree-ssa-sccvn.c (valueize_refs): Do not continue to"}, {"sha": "b0066ed18906d415fa24027015d0b6fcc2606009", "filename": "gcc/omp-low.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f0ae266e0a4b49ee029b37934fa952e0bd66b6d/gcc%2Fomp-low.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f0ae266e0a4b49ee029b37934fa952e0bd66b6d/gcc%2Fomp-low.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-low.c?ref=4f0ae266e0a4b49ee029b37934fa952e0bd66b6d", "patch": "@@ -3412,6 +3412,14 @@ expand_omp_taskreg (struct omp_region *region)\n       /* Declare local variables needed in CHILD_CFUN.  */\n       block = DECL_INITIAL (child_fn);\n       BLOCK_VARS (block) = list2chain (child_cfun->local_decls);\n+      /* The gimplifier could record temporaries in parallel/task block\n+\t rather than in containing function's local_decls chain,\n+\t which would mean cgraph missed finalizing them.  Do it now.  */\n+      for (t = BLOCK_VARS (block); t; t = TREE_CHAIN (t))\n+\tif (TREE_CODE (t) == VAR_DECL\n+\t    && TREE_STATIC (t)\n+\t    && !DECL_EXTERNAL (t))\n+\t  varpool_finalize_decl (t);\n       DECL_SAVED_TREE (child_fn) = NULL;\n       gimple_set_body (child_fn, bb_seq (single_succ (entry_bb)));\n       TREE_USED (block) = 1;"}, {"sha": "3a6a7edcafcf24bcdcad4c7dc6901a0db1a4ff39", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f0ae266e0a4b49ee029b37934fa952e0bd66b6d/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f0ae266e0a4b49ee029b37934fa952e0bd66b6d/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=4f0ae266e0a4b49ee029b37934fa952e0bd66b6d", "patch": "@@ -1,3 +1,8 @@\n+2009-04-08  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/39573\n+\t* libgomp.c++/pr39573.C: New test.\n+\n 2009-04-01  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR other/39591"}, {"sha": "0167222bc68eecc37801a3eb194fb3a467ef5b23", "filename": "libgomp/testsuite/libgomp.c++/pr39573.C", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f0ae266e0a4b49ee029b37934fa952e0bd66b6d/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr39573.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f0ae266e0a4b49ee029b37934fa952e0bd66b6d/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr39573.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2B%2B%2Fpr39573.C?ref=4f0ae266e0a4b49ee029b37934fa952e0bd66b6d", "patch": "@@ -0,0 +1,39 @@\n+// PR middle-end/39573\n+// { dg-do run }\n+\n+int z;\n+\n+void __attribute__((noinline))\n+bar (int *x)\n+{\n+  #pragma omp atomic\n+    z += x[2];\n+  x[2] += x[3];\n+}\n+\n+int\n+main ()\n+{\n+  int i;\n+#pragma omp parallel for\n+  for (i = 0; i < 65536; i++)\n+    {\n+      int x[] =\n+\t{\n+\t  0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1,\n+\t  0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1,\n+\t  0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1,\n+\t  0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1,\n+\t  0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1,\n+\t  0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1,\n+\t  0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1,\n+\t  0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1,\n+\t  0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1,\n+\t  0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1,\n+\t  0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1,\n+\t  0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1,\n+\t  0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1,\n+\t};\n+      bar (x);\n+    }\n+}"}]}