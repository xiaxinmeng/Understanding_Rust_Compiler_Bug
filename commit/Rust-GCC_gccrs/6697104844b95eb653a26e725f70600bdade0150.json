{"sha": "6697104844b95eb653a26e725f70600bdade0150", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjY5NzEwNDg0NGI5NWViNjUzYTI2ZTcyNWY3MDYwMGJkYWRlMDE1MA==", "commit": {"author": {"name": "Teresa Johnson", "email": "tejohnson@google.com", "date": "2015-09-25T16:53:40Z"}, "committer": {"name": "Teresa Johnson", "email": "tejohnson@gcc.gnu.org", "date": "2015-09-25T16:53:40Z"}, "message": "This patch unsets -freorder-blocks-and-partition when -fprofile-use is not specified.\n\nThis patch unsets -freorder-blocks-and-partition when -fprofile-use\nis not specified. Function splitting was not actually being performed\nin that case, as probably_never_executed_bb_p does not distinguish\nany basic blocks as being cold vs hot when there is no profile data.\nLeaving it enabled, however, causes the assembly code generator to create\n(empty) cold sections and labels, leading to unnecessary size overhead.\n\n2015-09-25  Teresa Johnson  <tejohnson@google.com>\n\n\t* opts.c (finish_options): Unset -freorder-blocks-and-partition\n\tif not using profile.\n\nFrom-SVN: r228136", "tree": {"sha": "0929635a605ef836dda743b622ad63f002335dba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0929635a605ef836dda743b622ad63f002335dba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6697104844b95eb653a26e725f70600bdade0150", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6697104844b95eb653a26e725f70600bdade0150", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6697104844b95eb653a26e725f70600bdade0150", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6697104844b95eb653a26e725f70600bdade0150/comments", "author": {"login": "teresajohnson", "id": 20446403, "node_id": "MDQ6VXNlcjIwNDQ2NDAz", "avatar_url": "https://avatars.githubusercontent.com/u/20446403?v=4", "gravatar_id": "", "url": "https://api.github.com/users/teresajohnson", "html_url": "https://github.com/teresajohnson", "followers_url": "https://api.github.com/users/teresajohnson/followers", "following_url": "https://api.github.com/users/teresajohnson/following{/other_user}", "gists_url": "https://api.github.com/users/teresajohnson/gists{/gist_id}", "starred_url": "https://api.github.com/users/teresajohnson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/teresajohnson/subscriptions", "organizations_url": "https://api.github.com/users/teresajohnson/orgs", "repos_url": "https://api.github.com/users/teresajohnson/repos", "events_url": "https://api.github.com/users/teresajohnson/events{/privacy}", "received_events_url": "https://api.github.com/users/teresajohnson/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5e2f2cd5842d2543721a895c64a3b2a553542344", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e2f2cd5842d2543721a895c64a3b2a553542344", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5e2f2cd5842d2543721a895c64a3b2a553542344"}], "stats": {"total": 15, "additions": 15, "deletions": 0}, "files": [{"sha": "11424466667f87238c6a4b4b05ead1f5a4954ab1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6697104844b95eb653a26e725f70600bdade0150/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6697104844b95eb653a26e725f70600bdade0150/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6697104844b95eb653a26e725f70600bdade0150", "patch": "@@ -1,3 +1,8 @@\n+2015-09-25  Teresa Johnson  <tejohnson@google.com>\n+\n+\t* opts.c (finish_options): Unset -freorder-blocks-and-partition\n+\tif not using profile.\n+\n 2015-09-25  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n \n \tPR pretty-print/67567"}, {"sha": "2bbf6534077984ed2266f25cf9a206e8861ccfc9", "filename": "gcc/opts.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6697104844b95eb653a26e725f70600bdade0150/gcc%2Fopts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6697104844b95eb653a26e725f70600bdade0150/gcc%2Fopts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fopts.c?ref=6697104844b95eb653a26e725f70600bdade0150", "patch": "@@ -821,6 +821,16 @@ finish_options (struct gcc_options *opts, struct gcc_options *opts_set,\n       opts->x_flag_reorder_blocks = 1;\n     }\n \n+  /* Disable -freorder-blocks-and-partition when -fprofile-use is not in\n+     effect. Function splitting was not actually being performed in that case,\n+     as probably_never_executed_bb_p does not distinguish any basic blocks as\n+     being cold vs hot when there is no profile data. Leaving it enabled,\n+     however, causes the assembly code generator to create (empty) cold\n+     sections and labels, leading to unnecessary size overhead.  */\n+  if (opts->x_flag_reorder_blocks_and_partition\n+      && !opts_set->x_flag_profile_use)\n+    opts->x_flag_reorder_blocks_and_partition = 0;\n+\n   if (opts->x_flag_reorder_blocks_and_partition\n       && !opts_set->x_flag_reorder_functions)\n     opts->x_flag_reorder_functions = 1;"}]}