{"sha": "9d33785f57daf29dc0c106c919da319fe1906bc6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWQzMzc4NWY1N2RhZjI5ZGMwYzEwNmM5MTlkYTMxOWZlMTkwNmJjNg==", "commit": {"author": {"name": "Kyrylo Tkachov", "email": "kyrylo.tkachov@arm.com", "date": "2021-01-21T16:33:49Z"}, "committer": {"name": "Kyrylo Tkachov", "email": "kyrylo.tkachov@arm.com", "date": "2021-01-22T16:40:57Z"}, "message": "tree-ssa-mathopts: Use proper poly_int64 comparison with param_avoid_fma_max_bits [PR 98766]\n\nWe ICE here because we end up comparing a poly_int64 with a scalar using\n<= rather than maybe_le.\nThis patch fixes that in the way rich suggests in the PR.\n\ngcc/ChangeLog:\n\n\tPR tree-optimization/98766\n\t* tree-ssa-math-opts.c (convert_mult_to_fma): Use maybe_le when\n\tcomparing against type size with param_avoid_fma_max_bits.\n\ngcc/testsuite/ChangeLog:\n\n\tPR tree-optimization/98766\n\t* gcc.dg/pr98766.c: New test.", "tree": {"sha": "5ef5cda41196b8498b67440934cc6cf83cec8f57", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5ef5cda41196b8498b67440934cc6cf83cec8f57"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9d33785f57daf29dc0c106c919da319fe1906bc6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d33785f57daf29dc0c106c919da319fe1906bc6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9d33785f57daf29dc0c106c919da319fe1906bc6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d33785f57daf29dc0c106c919da319fe1906bc6/comments", "author": {"login": "ktkachov-arm", "id": 74917949, "node_id": "MDQ6VXNlcjc0OTE3OTQ5", "avatar_url": "https://avatars.githubusercontent.com/u/74917949?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ktkachov-arm", "html_url": "https://github.com/ktkachov-arm", "followers_url": "https://api.github.com/users/ktkachov-arm/followers", "following_url": "https://api.github.com/users/ktkachov-arm/following{/other_user}", "gists_url": "https://api.github.com/users/ktkachov-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/ktkachov-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ktkachov-arm/subscriptions", "organizations_url": "https://api.github.com/users/ktkachov-arm/orgs", "repos_url": "https://api.github.com/users/ktkachov-arm/repos", "events_url": "https://api.github.com/users/ktkachov-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/ktkachov-arm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ktkachov-arm", "id": 74917949, "node_id": "MDQ6VXNlcjc0OTE3OTQ5", "avatar_url": "https://avatars.githubusercontent.com/u/74917949?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ktkachov-arm", "html_url": "https://github.com/ktkachov-arm", "followers_url": "https://api.github.com/users/ktkachov-arm/followers", "following_url": "https://api.github.com/users/ktkachov-arm/following{/other_user}", "gists_url": "https://api.github.com/users/ktkachov-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/ktkachov-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ktkachov-arm/subscriptions", "organizations_url": "https://api.github.com/users/ktkachov-arm/orgs", "repos_url": "https://api.github.com/users/ktkachov-arm/repos", "events_url": "https://api.github.com/users/ktkachov-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/ktkachov-arm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eee8ed2f22b36dfe64a9516171871476e8ede477", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eee8ed2f22b36dfe64a9516171871476e8ede477", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eee8ed2f22b36dfe64a9516171871476e8ede477"}], "stats": {"total": 16, "additions": 14, "deletions": 2}, "files": [{"sha": "d388fd2aa87f90b03872a232f9334c7012136d13", "filename": "gcc/testsuite/gcc.dg/pr98766.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d33785f57daf29dc0c106c919da319fe1906bc6/gcc%2Ftestsuite%2Fgcc.dg%2Fpr98766.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d33785f57daf29dc0c106c919da319fe1906bc6/gcc%2Ftestsuite%2Fgcc.dg%2Fpr98766.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr98766.c?ref=9d33785f57daf29dc0c106c919da319fe1906bc6", "patch": "@@ -0,0 +1,12 @@\n+/* PR tree-optimization/98766.  */\n+\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 --param=avoid-fma-max-bits=8 \" } */\n+/* { dg-additional-options \"-march=armv8.2-a+sve\" { target aarch64*-*-* } } */\n+\n+extern int a[];\n+void c(short *d) {\n+  for (int e = 0; e < 9; e++)\n+    a[e] = d[e] * 2;\n+}\n+"}, {"sha": "c4a6492b50df25b4cf296a75bd51e5af34eeacc7", "filename": "gcc/tree-ssa-math-opts.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d33785f57daf29dc0c106c919da319fe1906bc6/gcc%2Ftree-ssa-math-opts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d33785f57daf29dc0c106c919da319fe1906bc6/gcc%2Ftree-ssa-math-opts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-math-opts.c?ref=9d33785f57daf29dc0c106c919da319fe1906bc6", "patch": "@@ -3252,8 +3252,8 @@ convert_mult_to_fma (gimple *mul_stmt, tree op1, tree op2,\n \n   bool check_defer\n     = (state->m_deferring_p\n-       && (tree_to_shwi (TYPE_SIZE (type))\n-\t   <= param_avoid_fma_max_bits));\n+       && maybe_le (tree_to_poly_int64 (TYPE_SIZE (type)),\n+\t\t    param_avoid_fma_max_bits));\n   bool defer = check_defer;\n   bool seen_negate_p = false;\n   /* Make sure that the multiplication statement becomes dead after"}]}