{"sha": "b0670cc0eb260ce182c7eb2c0b25bcc0b59a0e68", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjA2NzBjYzBlYjI2MGNlMTgyYzdlYjJjMGIyNWJjYzBiNTlhMGU2OA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-01-26T21:45:57Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-01-26T21:45:57Z"}, "message": "re PR c++/79129 (ICE with -fdebug-types-section starting with r240578)\n\n\tPR debug/79129\n\t* dwarf2out.c (generate_skeleton_bottom_up): For children with\n\tcomdat_type_p set, just clone them, but keep the children in the\n\toriginal DIE.\n\n\t* g++.dg/debug/dwarf2/pr79129.C: New test.\n\nFrom-SVN: r244955", "tree": {"sha": "7847f74b9e981fab439502e6718fdac6e5b14fce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7847f74b9e981fab439502e6718fdac6e5b14fce"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b0670cc0eb260ce182c7eb2c0b25bcc0b59a0e68", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0670cc0eb260ce182c7eb2c0b25bcc0b59a0e68", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b0670cc0eb260ce182c7eb2c0b25bcc0b59a0e68", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0670cc0eb260ce182c7eb2c0b25bcc0b59a0e68/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f7c06c0f9955a6d12dd7eaef040de563fe279166", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f7c06c0f9955a6d12dd7eaef040de563fe279166", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f7c06c0f9955a6d12dd7eaef040de563fe279166"}], "stats": {"total": 34, "additions": 34, "deletions": 0}, "files": [{"sha": "2dc64c6dcc0b140915b08ec3f30b2dba913d2fc0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0670cc0eb260ce182c7eb2c0b25bcc0b59a0e68/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0670cc0eb260ce182c7eb2c0b25bcc0b59a0e68/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b0670cc0eb260ce182c7eb2c0b25bcc0b59a0e68", "patch": "@@ -1,5 +1,10 @@\n 2017-01-26  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR debug/79129\n+\t* dwarf2out.c (generate_skeleton_bottom_up): For children with\n+\tcomdat_type_p set, just clone them, but keep the children in the\n+\toriginal DIE.\n+\n \tPR debug/78835\n \t* dwarf2out.c (prune_unused_types): Mark all functions with DIEs\n \twhich have direct callers with -fvar-tracking-assignments enabled"}, {"sha": "1b2c04cc00a3a17510caf00561557518a4b2da24", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0670cc0eb260ce182c7eb2c0b25bcc0b59a0e68/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0670cc0eb260ce182c7eb2c0b25bcc0b59a0e68/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=b0670cc0eb260ce182c7eb2c0b25bcc0b59a0e68", "patch": "@@ -7918,6 +7918,19 @@ generate_skeleton_bottom_up (skeleton_chain_node *parent)\n \t    add_child_die (parent->new_die, c);\n \t    c = prev;\n \t  }\n+\telse if (c->comdat_type_p)\n+\t  {\n+\t    /* This is the skeleton of earlier break_out_comdat_types\n+\t       type.  Clone the existing DIE, but keep the children\n+\t       under the original (which is in the main CU).  */\n+\t    dw_die_ref clone = clone_die (c);\n+\n+\t    replace_child (c, clone, prev);\n+\t    generate_skeleton_ancestor_tree (parent);\n+\t    add_child_die (parent->new_die, c);\n+\t    c = clone;\n+\t    continue;\n+\t  }\n \telse\n \t  {\n \t    /* Clone the existing DIE, move the original to the skeleton\n@@ -7936,6 +7949,7 @@ generate_skeleton_bottom_up (skeleton_chain_node *parent)\n \t    replace_child (c, clone, prev);\n \t    generate_skeleton_ancestor_tree (parent);\n \t    add_child_die (parent->new_die, c);\n+\t    node.old_die = clone;\n \t    node.new_die = c;\n \t    c = clone;\n \t  }"}, {"sha": "4d427fa9689515a800aaa754f9a6639b60de4481", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0670cc0eb260ce182c7eb2c0b25bcc0b59a0e68/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0670cc0eb260ce182c7eb2c0b25bcc0b59a0e68/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b0670cc0eb260ce182c7eb2c0b25bcc0b59a0e68", "patch": "@@ -1,5 +1,8 @@\n 2017-01-26  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR debug/79129\n+\t* g++.dg/debug/dwarf2/pr79129.C: New test.\n+\n \tPR debug/78835\n \t* g++.dg/debug/dwarf2/pr78835.C: New test.\n "}, {"sha": "a1ffd3d8246cbb3a8130f073be3fa139b5ebe175", "filename": "gcc/testsuite/g++.dg/debug/dwarf2/pr79129.C", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0670cc0eb260ce182c7eb2c0b25bcc0b59a0e68/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fpr79129.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0670cc0eb260ce182c7eb2c0b25bcc0b59a0e68/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fpr79129.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fpr79129.C?ref=b0670cc0eb260ce182c7eb2c0b25bcc0b59a0e68", "patch": "@@ -0,0 +1,12 @@\n+/* PR debug/79129 */\n+/* { dg-do compile } */\n+/* { dg-options \"-gdwarf-4 -O2 -fdebug-types-section\" } */\n+\n+struct B\n+{\n+  struct A { void foo (int &); };\n+  A *bar ();\n+  ~B () { int a = 1; bar ()->foo (a); }\n+};\n+struct C { ~C (); B c; };\n+C::~C () {}"}]}