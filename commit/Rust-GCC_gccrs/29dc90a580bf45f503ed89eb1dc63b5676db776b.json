{"sha": "29dc90a580bf45f503ed89eb1dc63b5676db776b", "node_id": "C_kwDOANBUbNoAKDI5ZGM5MGE1ODBiZjQ1ZjUwM2VkODllYjFkYzYzYjU2NzZkYjc3NmI", "commit": {"author": {"name": "Takayuki 'January June' Suwa", "email": "jjsuwa_sys3175@yahoo.co.jp", "date": "2022-05-29T10:57:35Z"}, "committer": {"name": "Max Filippov", "email": "jcmvbkbc@gmail.com", "date": "2022-06-09T22:07:59Z"}, "message": "xtensa: Add clrsbsi2 insn pattern\n\n> (clrsb:m x)\n> Represents the number of redundant leading sign bits in x, represented\n> as an integer of mode m, starting at the most significant bit position.\n\nThis explanation is just what the NSA instruction (not ever emitted before)\ncalculates in Xtensa ISA.\n\ngcc/ChangeLog:\n\n\t* config/xtensa/xtensa.md (clrsbsi2): New insn pattern.\n\nlibgcc/ChangeLog:\n\n\t* config/xtensa/lib1funcs.S (__clrsbsi2): New function.\n\t* config/xtensa/t-xtensa (LIB1ASMFUNCS): Add _clrsbsi2.", "tree": {"sha": "7f8a6051eb3d5f2d4b2048eb40555252c89f5a97", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7f8a6051eb3d5f2d4b2048eb40555252c89f5a97"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/29dc90a580bf45f503ed89eb1dc63b5676db776b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29dc90a580bf45f503ed89eb1dc63b5676db776b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/29dc90a580bf45f503ed89eb1dc63b5676db776b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29dc90a580bf45f503ed89eb1dc63b5676db776b/comments", "author": {"login": "jjsuwa-sys3175", "id": 73290592, "node_id": "MDQ6VXNlcjczMjkwNTky", "avatar_url": "https://avatars.githubusercontent.com/u/73290592?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jjsuwa-sys3175", "html_url": "https://github.com/jjsuwa-sys3175", "followers_url": "https://api.github.com/users/jjsuwa-sys3175/followers", "following_url": "https://api.github.com/users/jjsuwa-sys3175/following{/other_user}", "gists_url": "https://api.github.com/users/jjsuwa-sys3175/gists{/gist_id}", "starred_url": "https://api.github.com/users/jjsuwa-sys3175/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jjsuwa-sys3175/subscriptions", "organizations_url": "https://api.github.com/users/jjsuwa-sys3175/orgs", "repos_url": "https://api.github.com/users/jjsuwa-sys3175/repos", "events_url": "https://api.github.com/users/jjsuwa-sys3175/events{/privacy}", "received_events_url": "https://api.github.com/users/jjsuwa-sys3175/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jcmvbkbc", "id": 166731, "node_id": "MDQ6VXNlcjE2NjczMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/166731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jcmvbkbc", "html_url": "https://github.com/jcmvbkbc", "followers_url": "https://api.github.com/users/jcmvbkbc/followers", "following_url": "https://api.github.com/users/jcmvbkbc/following{/other_user}", "gists_url": "https://api.github.com/users/jcmvbkbc/gists{/gist_id}", "starred_url": "https://api.github.com/users/jcmvbkbc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jcmvbkbc/subscriptions", "organizations_url": "https://api.github.com/users/jcmvbkbc/orgs", "repos_url": "https://api.github.com/users/jcmvbkbc/repos", "events_url": "https://api.github.com/users/jcmvbkbc/events{/privacy}", "received_events_url": "https://api.github.com/users/jcmvbkbc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e44e7face13f38f9b228e2619786ba0add9ef77b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e44e7face13f38f9b228e2619786ba0add9ef77b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e44e7face13f38f9b228e2619786ba0add9ef77b"}], "stats": {"total": 37, "additions": 35, "deletions": 2}, "files": [{"sha": "8ff6f9a95fe3ca81d964f5be04d1ebe571527bf4", "filename": "gcc/config/xtensa/xtensa.md", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29dc90a580bf45f503ed89eb1dc63b5676db776b/gcc%2Fconfig%2Fxtensa%2Fxtensa.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29dc90a580bf45f503ed89eb1dc63b5676db776b/gcc%2Fconfig%2Fxtensa%2Fxtensa.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.md?ref=29dc90a580bf45f503ed89eb1dc63b5676db776b", "patch": "@@ -429,7 +429,17 @@\n    (set_attr \"length\"\t\"3\")])\n \n \f\n-;; Count leading/trailing zeros and find first bit.\n+;; Count redundant leading sign bits and leading/trailing zeros,\n+;; and find first bit.\n+\n+(define_insn \"clrsbsi2\"\n+  [(set (match_operand:SI 0 \"register_operand\" \"=a\")\n+\t(clrsb:SI (match_operand:SI 1 \"register_operand\" \"r\")))]\n+  \"TARGET_NSA\"\n+  \"nsa\\t%0, %1\"\n+  [(set_attr \"type\"\t\"arith\")\n+   (set_attr \"mode\"\t\"SI\")\n+   (set_attr \"length\"\t\"3\")])\n \n (define_insn \"clzsi2\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=a\")"}, {"sha": "3932d206256f21175510ef5b00d66218c75d1cc0", "filename": "libgcc/config/xtensa/lib1funcs.S", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29dc90a580bf45f503ed89eb1dc63b5676db776b/libgcc%2Fconfig%2Fxtensa%2Flib1funcs.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29dc90a580bf45f503ed89eb1dc63b5676db776b/libgcc%2Fconfig%2Fxtensa%2Flib1funcs.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fxtensa%2Flib1funcs.S?ref=29dc90a580bf45f503ed89eb1dc63b5676db776b", "patch": "@@ -456,6 +456,29 @@ __nsau_data:\n #endif /* L_clz */\n \n \n+#ifdef L_clrsbsi2\n+\t.align\t4\n+\t.global\t__clrsbsi2\n+\t.type\t__clrsbsi2, @function\n+__clrsbsi2:\n+\tleaf_entry sp, 16\n+#if XCHAL_HAVE_NSA\n+\tnsa\ta2, a2\n+#else\n+\tsrai\ta3, a2, 31\n+\txor\ta3, a3, a2\n+\tmovi\ta2, 31\n+\tbeqz\ta3, .Lreturn\n+\tdo_nsau\ta2, a3, a4, a5\n+\taddi\ta2, a2, -1\n+.Lreturn:\n+#endif\n+\tleaf_return\n+\t.size\t__clrsbsi2, . - __clrsbsi2\n+\n+#endif /* L_clrsbsi2 */\n+\n+\n #ifdef L_clzsi2\n \t.align\t4\n \t.global\t__clzsi2"}, {"sha": "084618b382e5b4d547ca203281c17b74e7fad868", "filename": "libgcc/config/xtensa/t-xtensa", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29dc90a580bf45f503ed89eb1dc63b5676db776b/libgcc%2Fconfig%2Fxtensa%2Ft-xtensa", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29dc90a580bf45f503ed89eb1dc63b5676db776b/libgcc%2Fconfig%2Fxtensa%2Ft-xtensa", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fxtensa%2Ft-xtensa?ref=29dc90a580bf45f503ed89eb1dc63b5676db776b", "patch": "@@ -1,6 +1,6 @@\n LIB1ASMSRC = xtensa/lib1funcs.S\n LIB1ASMFUNCS = _mulsi3 _divsi3 _modsi3 _udivsi3 _umodsi3 \\\n-\t_umulsidi3 _clz _clzsi2 _ctzsi2 _ffssi2 \\\n+\t_umulsidi3 _clz _clrsbsi2 _clzsi2 _ctzsi2 _ffssi2 \\\n \t_ashldi3 _ashrdi3 _lshrdi3 \\\n \t_bswapsi2 _bswapdi2 \\\n \t_negsf2 _addsubsf3 _mulsf3 _divsf3 _cmpsf2 _fixsfsi _fixsfdi \\"}]}