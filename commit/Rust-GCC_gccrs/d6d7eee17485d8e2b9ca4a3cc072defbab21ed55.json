{"sha": "d6d7eee17485d8e2b9ca4a3cc072defbab21ed55", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDZkN2VlZTE3NDg1ZDhlMmI5Y2E0YTNjYzA3MmRlZmJhYjIxZWQ1NQ==", "commit": {"author": {"name": "Guozhi Wei", "email": "carrot@google.com", "date": "2013-05-04T01:26:52Z"}, "committer": {"name": "Wei Guozhi", "email": "carrot@gcc.gnu.org", "date": "2013-05-04T01:26:52Z"}, "message": "coverage.c (coverage_obj_init): Move the construction of gcov constructor to\n\n\t* coverage.c (coverage_obj_init): Move the construction of gcov\n\tconstructor to\n\t(build_init_ctor): here.\n\nFrom-SVN: r198591", "tree": {"sha": "05c685ce86de0cc60a8cd32359155af10f9bfaaf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/05c685ce86de0cc60a8cd32359155af10f9bfaaf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d6d7eee17485d8e2b9ca4a3cc072defbab21ed55", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6d7eee17485d8e2b9ca4a3cc072defbab21ed55", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d6d7eee17485d8e2b9ca4a3cc072defbab21ed55", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6d7eee17485d8e2b9ca4a3cc072defbab21ed55/comments", "author": {"login": "weiguozhi", "id": 57237827, "node_id": "MDQ6VXNlcjU3MjM3ODI3", "avatar_url": "https://avatars.githubusercontent.com/u/57237827?v=4", "gravatar_id": "", "url": "https://api.github.com/users/weiguozhi", "html_url": "https://github.com/weiguozhi", "followers_url": "https://api.github.com/users/weiguozhi/followers", "following_url": "https://api.github.com/users/weiguozhi/following{/other_user}", "gists_url": "https://api.github.com/users/weiguozhi/gists{/gist_id}", "starred_url": "https://api.github.com/users/weiguozhi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/weiguozhi/subscriptions", "organizations_url": "https://api.github.com/users/weiguozhi/orgs", "repos_url": "https://api.github.com/users/weiguozhi/repos", "events_url": "https://api.github.com/users/weiguozhi/events{/privacy}", "received_events_url": "https://api.github.com/users/weiguozhi/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "898ca809f55faec456713a0bef9861e2ccd8d3a0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/898ca809f55faec456713a0bef9861e2ccd8d3a0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/898ca809f55faec456713a0bef9861e2ccd8d3a0"}], "stats": {"total": 52, "additions": 34, "deletions": 18}, "files": [{"sha": "bb1a3bb12e92a13e5b5331b6656b3ff767f194b6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6d7eee17485d8e2b9ca4a3cc072defbab21ed55/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6d7eee17485d8e2b9ca4a3cc072defbab21ed55/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d6d7eee17485d8e2b9ca4a3cc072defbab21ed55", "patch": "@@ -1,3 +1,9 @@\n+2013-05-03  Guozhi Wei  <carrot@google.com>\n+\n+\t* coverage.c (coverage_obj_init): Move the construction of gcov\n+\tconstructor to\n+\t(build_init_ctor): here.\n+\n 2013-05-03  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n \n \t* gimple-ssa-strength-reduction.c (cand_kind): Add CAND_PHI."}, {"sha": "7c395f4750b17e81740e80043c391552c0d00e56", "filename": "gcc/coverage.c", "status": "modified", "additions": 28, "deletions": 18, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6d7eee17485d8e2b9ca4a3cc072defbab21ed55/gcc%2Fcoverage.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6d7eee17485d8e2b9ca4a3cc072defbab21ed55/gcc%2Fcoverage.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcoverage.c?ref=d6d7eee17485d8e2b9ca4a3cc072defbab21ed55", "patch": "@@ -967,14 +967,40 @@ build_info (tree info_type, tree fn_ary)\n   return build_constructor (info_type, v1);\n }\n \n+/* Generate the constructor function to call __gcov_init.  */\n+\n+static void\n+build_init_ctor (tree gcov_info_type)\n+{\n+  tree ctor, stmt, init_fn;\n+\n+  /* Build a decl for __gcov_init.  */\n+  init_fn = build_pointer_type (gcov_info_type);\n+  init_fn = build_function_type_list (void_type_node, init_fn, NULL);\n+  init_fn = build_decl (BUILTINS_LOCATION, FUNCTION_DECL,\n+\t\t\tget_identifier (\"__gcov_init\"), init_fn);\n+  TREE_PUBLIC (init_fn) = 1;\n+  DECL_EXTERNAL (init_fn) = 1;\n+  DECL_ASSEMBLER_NAME (init_fn);\n+\n+  /* Generate a call to __gcov_init(&gcov_info).  */\n+  ctor = NULL;\n+  stmt = build_fold_addr_expr (gcov_info_var);\n+  stmt = build_call_expr (init_fn, 1, stmt);\n+  append_to_statement_list (stmt, &ctor);\n+\n+  /* Generate a constructor to run it.  */\n+  cgraph_build_static_cdtor ('I', ctor, DEFAULT_INIT_PRIORITY);\n+}\n+\n /* Create the gcov_info types and object.  Generate the constructor\n    function to call __gcov_init.  Does not generate the initializer\n    for the object.  Returns TRUE if coverage data is being emitted.  */\n \n static bool\n coverage_obj_init (void)\n {\n-  tree gcov_info_type, ctor, stmt, init_fn;\n+  tree gcov_info_type;\n   unsigned n_counters = 0;\n   unsigned ix;\n   struct coverage_data *fn;\n@@ -1020,23 +1046,7 @@ coverage_obj_init (void)\n   ASM_GENERATE_INTERNAL_LABEL (name_buf, \"LPBX\", 0);\n   DECL_NAME (gcov_info_var) = get_identifier (name_buf);\n \n-  /* Build a decl for __gcov_init.  */\n-  init_fn = build_pointer_type (gcov_info_type);\n-  init_fn = build_function_type_list (void_type_node, init_fn, NULL);\n-  init_fn = build_decl (BUILTINS_LOCATION, FUNCTION_DECL,\n-\t\t\tget_identifier (\"__gcov_init\"), init_fn);\n-  TREE_PUBLIC (init_fn) = 1;\n-  DECL_EXTERNAL (init_fn) = 1;\n-  DECL_ASSEMBLER_NAME (init_fn);\n-\n-  /* Generate a call to __gcov_init(&gcov_info).  */\n-  ctor = NULL;\n-  stmt = build_fold_addr_expr (gcov_info_var);\n-  stmt = build_call_expr (init_fn, 1, stmt);\n-  append_to_statement_list (stmt, &ctor);\n-\n-  /* Generate a constructor to run it.  */\n-  cgraph_build_static_cdtor ('I', ctor, DEFAULT_INIT_PRIORITY);\n+  build_init_ctor (gcov_info_type);\n \n   return true;\n }"}]}