{"sha": "5795ec0edc30e077a9900cf3ca0a04ad8ac5ac97", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTc5NWVjMGVkYzMwZTA3N2E5OTAwY2YzY2EwYTA0YWQ4YWM1YWM5Nw==", "commit": {"author": {"name": "Uros Bizjak", "email": "ubizjak@gmail.com", "date": "2021-05-07T15:14:34Z"}, "committer": {"name": "Uros Bizjak", "email": "ubizjak@gmail.com", "date": "2021-05-07T15:15:26Z"}, "message": "i386: Implement mmx_pblendv to optimize SSE conditional moves [PR98218]\n\nImplement mmx_pblendv to optimize V8HI, V4HI and V2SI mode\nconditional moves for SSE4.1 targets.\n\n2021-05-07  Uro\u0161 Bizjak  <ubizjak@gmail.com>\n\ngcc/\n\tPR target/98218\n\t* config/i386/i386-expand.c (ix86_expand_sse_movcc):\n\tHandle V8QI, V4HI and V2SI modes.\n\t* config/i386/mmx.md (mmx_pblendvb): New insn pattern.\n\t* config/i386/sse.md (unspec): Move UNSPEC_BLENDV ...\n\t* config/i386/i386.md (unspec): ... here.", "tree": {"sha": "0f30b09d338a754955904f8eeaf27af42f360b73", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0f30b09d338a754955904f8eeaf27af42f360b73"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5795ec0edc30e077a9900cf3ca0a04ad8ac5ac97", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5795ec0edc30e077a9900cf3ca0a04ad8ac5ac97", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5795ec0edc30e077a9900cf3ca0a04ad8ac5ac97", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5795ec0edc30e077a9900cf3ca0a04ad8ac5ac97/comments", "author": {"login": "ubizjak", "id": 55479990, "node_id": "MDQ6VXNlcjU1NDc5OTkw", "avatar_url": "https://avatars.githubusercontent.com/u/55479990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ubizjak", "html_url": "https://github.com/ubizjak", "followers_url": "https://api.github.com/users/ubizjak/followers", "following_url": "https://api.github.com/users/ubizjak/following{/other_user}", "gists_url": "https://api.github.com/users/ubizjak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ubizjak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ubizjak/subscriptions", "organizations_url": "https://api.github.com/users/ubizjak/orgs", "repos_url": "https://api.github.com/users/ubizjak/repos", "events_url": "https://api.github.com/users/ubizjak/events{/privacy}", "received_events_url": "https://api.github.com/users/ubizjak/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ubizjak", "id": 55479990, "node_id": "MDQ6VXNlcjU1NDc5OTkw", "avatar_url": "https://avatars.githubusercontent.com/u/55479990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ubizjak", "html_url": "https://github.com/ubizjak", "followers_url": "https://api.github.com/users/ubizjak/followers", "following_url": "https://api.github.com/users/ubizjak/following{/other_user}", "gists_url": "https://api.github.com/users/ubizjak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ubizjak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ubizjak/subscriptions", "organizations_url": "https://api.github.com/users/ubizjak/orgs", "repos_url": "https://api.github.com/users/ubizjak/repos", "events_url": "https://api.github.com/users/ubizjak/events{/privacy}", "received_events_url": "https://api.github.com/users/ubizjak/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "33b647956caa977d1ae489f9baed9cef70b4f382", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33b647956caa977d1ae489f9baed9cef70b4f382", "html_url": "https://github.com/Rust-GCC/gccrs/commit/33b647956caa977d1ae489f9baed9cef70b4f382"}], "stats": {"total": 35, "additions": 34, "deletions": 1}, "files": [{"sha": "e9f11bca78a2e11ad8776b982ea56a77f3464f2b", "filename": "gcc/config/i386/i386-expand.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5795ec0edc30e077a9900cf3ca0a04ad8ac5ac97/gcc%2Fconfig%2Fi386%2Fi386-expand.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5795ec0edc30e077a9900cf3ca0a04ad8ac5ac97/gcc%2Fconfig%2Fi386%2Fi386-expand.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386-expand.c?ref=5795ec0edc30e077a9900cf3ca0a04ad8ac5ac97", "patch": "@@ -3702,6 +3702,19 @@ ix86_expand_sse_movcc (rtx dest, rtx cmp, rtx op_true, rtx op_false)\n \t  op_true = force_reg (mode, op_true);\n \t}\n       break;\n+    case E_V8QImode:\n+    case E_V4HImode:\n+    case E_V2SImode:\n+      if (TARGET_SSE4_1)\n+\t{\n+\t  gen = gen_mmx_pblendvb;\n+\t  if (mode != V8QImode)\n+\t    d = gen_reg_rtx (V8QImode);\n+\t  op_false = gen_lowpart (V8QImode, op_false);\n+\t  op_true = gen_lowpart (V8QImode, op_true);\n+\t  cmp = gen_lowpart (V8QImode, cmp);\n+\t}\n+      break;\n     case E_V16QImode:\n     case E_V8HImode:\n     case E_V4SImode:"}, {"sha": "74e924f3c041ec8c825f0beb85e72406b110159b", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5795ec0edc30e077a9900cf3ca0a04ad8ac5ac97/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5795ec0edc30e077a9900cf3ca0a04ad8ac5ac97/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=5795ec0edc30e077a9900cf3ca0a04ad8ac5ac97", "patch": "@@ -118,6 +118,7 @@\n   UNSPEC_FIX_NOTRUNC\n   UNSPEC_MASKMOV\n   UNSPEC_MOVMSK\n+  UNSPEC_BLENDV\n   UNSPEC_RCP\n   UNSPEC_RSQRT\n   UNSPEC_PSADBW"}, {"sha": "f08570856f938e9fa48bb418dd0c185c8367b6f3", "filename": "gcc/config/i386/mmx.md", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5795ec0edc30e077a9900cf3ca0a04ad8ac5ac97/gcc%2Fconfig%2Fi386%2Fmmx.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5795ec0edc30e077a9900cf3ca0a04ad8ac5ac97/gcc%2Fconfig%2Fi386%2Fmmx.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fmmx.md?ref=5795ec0edc30e077a9900cf3ca0a04ad8ac5ac97", "patch": "@@ -1700,6 +1700,26 @@\n   DONE;\n })\n \n+(define_insn \"mmx_pblendvb\"\n+  [(set (match_operand:V8QI 0 \"register_operand\" \"=Yr,*x,x\")\n+\t(unspec:V8QI\n+\t  [(match_operand:V8QI 1 \"register_operand\" \"0,0,x\")\n+\t   (match_operand:V8QI 2 \"register_operand\" \"Yr,*x,x\")\n+\t   (match_operand:V8QI 3 \"register_operand\" \"Yz,Yz,x\")]\n+\t  UNSPEC_BLENDV))]\n+  \"TARGET_SSE4_1 && TARGET_MMX_WITH_SSE\"\n+  \"@\n+   pblendvb\\t{%3, %2, %0|%0, %2, %3}\n+   pblendvb\\t{%3, %2, %0|%0, %2, %3}\n+   vpblendvb\\t{%3, %2, %1, %0|%0, %1, %2, %3}\"\n+  [(set_attr \"isa\" \"noavx,noavx,avx\")\n+   (set_attr \"type\" \"ssemov\")\n+   (set_attr \"prefix_extra\" \"1\")\n+   (set_attr \"length_immediate\" \"*,*,1\")\n+   (set_attr \"prefix\" \"orig,orig,vex\")\n+   (set_attr \"btver2_decode\" \"vector\")\n+   (set_attr \"mode\" \"TI\")])\n+\n ;; XOP parallel XMM conditional moves\n (define_insn \"*xop_pcmov_<mode>\"\n   [(set (match_operand:MMXMODEI 0 \"register_operand\" \"=x\")"}, {"sha": "244fb13e97a5ad68c7591934e47d7c258b85a04b", "filename": "gcc/config/i386/sse.md", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5795ec0edc30e077a9900cf3ca0a04ad8ac5ac97/gcc%2Fconfig%2Fi386%2Fsse.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5795ec0edc30e077a9900cf3ca0a04ad8ac5ac97/gcc%2Fconfig%2Fi386%2Fsse.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fsse.md?ref=5795ec0edc30e077a9900cf3ca0a04ad8ac5ac97", "patch": "@@ -39,7 +39,6 @@\n   UNSPEC_INSERTQ\n \n   ;; For SSE4.1 support\n-  UNSPEC_BLENDV\n   UNSPEC_INSERTPS\n   UNSPEC_DP\n   UNSPEC_MOVNTDQA"}]}