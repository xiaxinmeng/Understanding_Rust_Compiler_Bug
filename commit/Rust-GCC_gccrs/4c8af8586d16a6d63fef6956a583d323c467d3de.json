{"sha": "4c8af8586d16a6d63fef6956a583d323c467d3de", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGM4YWY4NTg2ZDE2YTZkNjNmZWY2OTU2YTU4M2QzMjNjNDY3ZDNkZQ==", "commit": {"author": {"name": "Steven Bosscher", "email": "steven@gcc.gnu.org", "date": "2013-04-16T06:26:18Z"}, "committer": {"name": "Steven Bosscher", "email": "steven@gcc.gnu.org", "date": "2013-04-16T06:26:18Z"}, "message": "cfgrtl.c (cfg_layout_merge_blocks): Revert r184005...\n\n\t* cfgrtl.c (cfg_layout_merge_blocks): Revert r184005, implement\n\tcorrect fix by moving header and footer insn to the footer of\n\tthe merged basic block.  Clear BB_END of the merged-away block.\n\nFrom-SVN: r197995", "tree": {"sha": "e59dfcb18955037dc4447fba23bccfc4ee7c2ec0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e59dfcb18955037dc4447fba23bccfc4ee7c2ec0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4c8af8586d16a6d63fef6956a583d323c467d3de", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4c8af8586d16a6d63fef6956a583d323c467d3de", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4c8af8586d16a6d63fef6956a583d323c467d3de", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4c8af8586d16a6d63fef6956a583d323c467d3de/comments", "author": null, "committer": null, "parents": [{"sha": "96fba5210e819b3354e8ca8d99c1b13e417277d8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/96fba5210e819b3354e8ca8d99c1b13e417277d8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/96fba5210e819b3354e8ca8d99c1b13e417277d8"}], "stats": {"total": 67, "additions": 38, "deletions": 29}, "files": [{"sha": "3d7e60b213838f2f95c5687a2967a775f67942cf", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c8af8586d16a6d63fef6956a583d323c467d3de/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c8af8586d16a6d63fef6956a583d323c467d3de/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4c8af8586d16a6d63fef6956a583d323c467d3de", "patch": "@@ -1,5 +1,9 @@\n 2013-04-16  Steven Bosscher  <steven@gcc.gnu.org>\n \n+\t* cfgrtl.c (cfg_layout_merge_blocks): Revert r184005, implement\n+\tcorrect fix by moving header and footer insn to the footer of\n+\tthe merged basic block.  Clear BB_END of the merged-away block.\n+\n \tPR middle-end/43631\n \t* emit-rtl.c (make_note_raw): New function.\n \t(link_insn_into_chain): New static inline function."}, {"sha": "9b12d28d8f59bcfb71effca52d282f4b8b258640", "filename": "gcc/cfgrtl.c", "status": "modified", "additions": 34, "deletions": 29, "changes": 63, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c8af8586d16a6d63fef6956a583d323c467d3de/gcc%2Fcfgrtl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c8af8586d16a6d63fef6956a583d323c467d3de/gcc%2Fcfgrtl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgrtl.c?ref=4c8af8586d16a6d63fef6956a583d323c467d3de", "patch": "@@ -4083,18 +4083,40 @@ cfg_layout_merge_blocks (basic_block a, basic_block b)\n   if (!optimize)\n     emit_nop_for_unique_locus_between (a, b);\n \n-  /* Possible line number notes should appear in between.  */\n-  if (BB_HEADER (b))\n+  /* Move things from b->footer after a->footer.  */\n+  if (BB_FOOTER (b))\n     {\n-      rtx first = BB_END (a), last;\n-\n-      last = emit_insn_after_noloc (BB_HEADER (b), BB_END (a), a);\n-      /* The above might add a BARRIER as BB_END, but as barriers\n-\t aren't valid parts of a bb, remove_insn doesn't update\n-\t BB_END if it is a barrier.  So adjust BB_END here.  */\n-      while (BB_END (a) != first && BARRIER_P (BB_END (a)))\n-\tBB_END (a) = PREV_INSN (BB_END (a));\n-      delete_insn_chain (NEXT_INSN (first), last, false);\n+      if (!BB_FOOTER (a))\n+\tBB_FOOTER (a) = BB_FOOTER (b);\n+      else\n+\t{\n+\t  rtx last = BB_FOOTER (a);\n+\n+\t  while (NEXT_INSN (last))\n+\t    last = NEXT_INSN (last);\n+\t  NEXT_INSN (last) = BB_FOOTER (b);\n+\t  PREV_INSN (BB_FOOTER (b)) = last;\n+\t}\n+      BB_FOOTER (b) = NULL;\n+    }\n+\n+  /* Move things from b->header before a->footer.\n+     Note that this may include dead tablejump data, but we don't clean\n+     those up until we go out of cfglayout mode.  */\n+   if (BB_HEADER (b))\n+     {\n+      if (! BB_FOOTER (a))\n+\tBB_FOOTER (a) = BB_HEADER (b);\n+      else\n+\t{\n+\t  rtx last = BB_HEADER (b);\n+ \n+\t  while (NEXT_INSN (last))\n+\t    last = NEXT_INSN (last);\n+\t  NEXT_INSN (last) = BB_FOOTER (a);\n+\t  PREV_INSN (BB_FOOTER (a)) = last;\n+\t  BB_FOOTER (a) = BB_HEADER (b);\n+\t}\n       BB_HEADER (b) = NULL;\n     }\n \n@@ -4120,28 +4142,11 @@ cfg_layout_merge_blocks (basic_block a, basic_block b)\n   if (!NOTE_INSN_BASIC_BLOCK_P (insn))\n     insn = NEXT_INSN (insn);\n   gcc_assert (NOTE_INSN_BASIC_BLOCK_P (insn));\n-  BB_HEAD (b) = NULL;\n+  BB_HEAD (b) = BB_END (b) = NULL;\n   delete_insn (insn);\n \n   df_bb_delete (b->index);\n \n-  /* Possible tablejumps and barriers should appear after the block.  */\n-  if (BB_FOOTER (b))\n-    {\n-      if (!BB_FOOTER (a))\n-\tBB_FOOTER (a) = BB_FOOTER (b);\n-      else\n-\t{\n-\t  rtx last = BB_FOOTER (a);\n-\n-\t  while (NEXT_INSN (last))\n-\t    last = NEXT_INSN (last);\n-\t  NEXT_INSN (last) = BB_FOOTER (b);\n-\t  PREV_INSN (BB_FOOTER (b)) = last;\n-\t}\n-      BB_FOOTER (b) = NULL;\n-    }\n-\n   /* If B was a forwarder block, propagate the locus on the edge.  */\n   if (forwarder_p\n       && LOCATION_LOCUS (EDGE_SUCC (b, 0)->goto_locus) == UNKNOWN_LOCATION)"}]}