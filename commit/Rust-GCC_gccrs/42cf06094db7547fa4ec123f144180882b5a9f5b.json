{"sha": "42cf06094db7547fa4ec123f144180882b5a9f5b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDJjZjA2MDk0ZGI3NTQ3ZmE0ZWMxMjNmMTQ0MTgwODgyYjVhOWY1Yg==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2012-01-24T21:11:49Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2012-01-24T21:11:49Z"}, "message": "optabs.c (maybe_emit_atomic_test_and_set): Mark model unused.\n\n        * optabs.c (maybe_emit_atomic_test_and_set): Mark model unused.\n        Allow non-QImode mem inputs.\n\nFrom-SVN: r183497", "tree": {"sha": "f535526f6c0ea5c6e4a5f7018c80c2d1271f1daf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f535526f6c0ea5c6e4a5f7018c80c2d1271f1daf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/42cf06094db7547fa4ec123f144180882b5a9f5b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/42cf06094db7547fa4ec123f144180882b5a9f5b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/42cf06094db7547fa4ec123f144180882b5a9f5b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/42cf06094db7547fa4ec123f144180882b5a9f5b/comments", "author": null, "committer": null, "parents": [{"sha": "625d0ab2fd2894879590ccce150e71516c504288", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/625d0ab2fd2894879590ccce150e71516c504288", "html_url": "https://github.com/Rust-GCC/gccrs/commit/625d0ab2fd2894879590ccce150e71516c504288"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "3581f4b593be74b964c729169d08c33c96f1865a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42cf06094db7547fa4ec123f144180882b5a9f5b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42cf06094db7547fa4ec123f144180882b5a9f5b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=42cf06094db7547fa4ec123f144180882b5a9f5b", "patch": "@@ -1,3 +1,8 @@\n+2012-01-25  Richard Henderson  <rth@redhat.com>\n+\n+\t* optabs.c (maybe_emit_atomic_test_and_set): Allow non-QImode\n+\tmem inputs.\n+\n 2012-01-24  Richard Sandiford  <rdsandiford@googlemail.com>\n \n \t* optabs.c (gen_atomic_test_and_set): Use each argument."}, {"sha": "fb0132046535daca8fb376c4e1d0776ebcc17214", "filename": "gcc/optabs.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42cf06094db7547fa4ec123f144180882b5a9f5b/gcc%2Foptabs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42cf06094db7547fa4ec123f144180882b5a9f5b/gcc%2Foptabs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Foptabs.c?ref=42cf06094db7547fa4ec123f144180882b5a9f5b", "patch": "@@ -1,7 +1,7 @@\n /* Expand the basic unary and binary arithmetic operations, for GNU compiler.\n    Copyright (C) 1987, 1988, 1992, 1993, 1994, 1995, 1996, 1997, 1998,\n    1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,\n-   2011  Free Software Foundation, Inc.\n+   2011, 2012  Free Software Foundation, Inc.\n \n This file is part of GCC.\n \n@@ -7330,7 +7330,13 @@ maybe_emit_atomic_test_and_set (rtx target, rtx mem, enum memmodel model)\n   /* ??? We only support test-and-set on single bytes at the moment.\n      We'd have to change the builtin to allow wider memories.  */\n   gcc_checking_assert (id->operand[1].mode == QImode);\n-  gcc_checking_assert (GET_MODE (mem) == QImode);\n+\n+  /* While we always get QImode from __atomic_test_and_set, we get\n+     other memory modes from __sync_lock_test_and_set.  Note that we\n+     use no endian adjustment here.  This matches the 4.6 behavior\n+     in the Sparc backend.  */\n+  if (GET_MODE (mem) != QImode)\n+    mem = adjust_address_nv (mem, QImode, 0);\n \n   if (target == NULL || GET_MODE (target) != pat_bool_mode)\n     target = gen_reg_rtx (pat_bool_mode);"}]}