{"sha": "9fa5d5de369171b7149827fbc784aedb27eb6b84", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWZhNWQ1ZGUzNjkxNzFiNzE0OTgyN2ZiYzc4NGFlZGIyN2ViNmI4NA==", "commit": {"author": {"name": "Iain Buclaw", "email": "ibuclaw@gdcproject.org", "date": "2019-03-09T19:29:29Z"}, "committer": {"name": "Iain Buclaw", "email": "ibuclaw@gcc.gnu.org", "date": "2019-03-09T19:29:29Z"}, "message": "d: Fix ICE in get_frame_for_symbol\n\nWhen generating code for a non-nested delegate literal, there is no\ncontext pointer required to pass to the function.\n\n2019-03-09  Iain Buclaw  <ibuclaw@gdcproject.org>\n\ngcc/d/\n\tPR d/89041\n\t* d-codegen.cc (get_frame_for_symbol): Delegate literals defined in\n\tglobal scope don't have a frame pointer.\n\ngcc/testsuite/\n\tPR d/89041\n\t* gdc.dg/pr89041.d: New test.\n\nFrom-SVN: r269533", "tree": {"sha": "062447e1859790cef12a54126fa7ba1bcecadd74", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/062447e1859790cef12a54126fa7ba1bcecadd74"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9fa5d5de369171b7149827fbc784aedb27eb6b84", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9fa5d5de369171b7149827fbc784aedb27eb6b84", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9fa5d5de369171b7149827fbc784aedb27eb6b84", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9fa5d5de369171b7149827fbc784aedb27eb6b84/comments", "author": {"login": "ibuclaw", "id": 397929, "node_id": "MDQ6VXNlcjM5NzkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibuclaw", "html_url": "https://github.com/ibuclaw", "followers_url": "https://api.github.com/users/ibuclaw/followers", "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}", "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions", "organizations_url": "https://api.github.com/users/ibuclaw/orgs", "repos_url": "https://api.github.com/users/ibuclaw/repos", "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}", "received_events_url": "https://api.github.com/users/ibuclaw/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4ea60a393eee13a0a7715b7c8134e2115195c7f7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4ea60a393eee13a0a7715b7c8134e2115195c7f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4ea60a393eee13a0a7715b7c8134e2115195c7f7"}], "stats": {"total": 39, "additions": 36, "deletions": 3}, "files": [{"sha": "4d9fb99a8d8d743b58a23deeb8030332c10e93e5", "filename": "gcc/d/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9fa5d5de369171b7149827fbc784aedb27eb6b84/gcc%2Fd%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9fa5d5de369171b7149827fbc784aedb27eb6b84/gcc%2Fd%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fd%2FChangeLog?ref=9fa5d5de369171b7149827fbc784aedb27eb6b84", "patch": "@@ -1,3 +1,9 @@\n+2019-03-09  Iain Buclaw  <ibuclaw@gdcproject.org>\n+\n+\tPR d/89041\n+\t* d-codegen.cc (get_frame_for_symbol): Delegate literals defined in\n+\tglobal scope don't have a frame pointer.\n+\n 2019-03-01  Iain Buclaw  <ibuclaw@gdcproject.org>\n \n \t* d-builtins.cc (d_init_versions): Add CppRuntime_Gcc as predefined"}, {"sha": "e8233b43c67198a10e8c7c15e07e6b23cb7a951c", "filename": "gcc/d/d-codegen.cc", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9fa5d5de369171b7149827fbc784aedb27eb6b84/gcc%2Fd%2Fd-codegen.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9fa5d5de369171b7149827fbc784aedb27eb6b84/gcc%2Fd%2Fd-codegen.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fd%2Fd-codegen.cc?ref=9fa5d5de369171b7149827fbc784aedb27eb6b84", "patch": "@@ -2172,16 +2172,25 @@ get_frame_for_symbol (Dsymbol *sym)\n       fdparent = (FuncDeclaration *) sym;\n     }\n \n-  gcc_assert (fdparent != NULL);\n+  /* Not a nested function, there is no frame pointer to pass.  */\n+  if (fdparent == NULL)\n+    {\n+      /* Only delegate literals report as being nested, even if they are in\n+\t global scope.  */\n+      gcc_assert (fd && fd->isFuncLiteralDeclaration ());\n+      return null_pointer_node;\n+    }\n+\n+  gcc_assert (thisfd != NULL);\n \n   if (thisfd != fdparent)\n     {\n       /* If no frame pointer for this function.  */\n       if (!thisfd->vthis)\n \t{\n \t  error_at (make_location_t (sym->loc),\n-\t\t    \"is a nested function and cannot be accessed from %qs\",\n-\t\t    thisfd->toChars ());\n+\t\t    \"%qs is a nested function and cannot be accessed from %qs\",\n+\t\t    fd->toPrettyChars (), thisfd->toPrettyChars ());\n \t  return null_pointer_node;\n \t}\n "}, {"sha": "cb4bf77efefe1440bc2d3e6d32701d673ae02310", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9fa5d5de369171b7149827fbc784aedb27eb6b84/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9fa5d5de369171b7149827fbc784aedb27eb6b84/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9fa5d5de369171b7149827fbc784aedb27eb6b84", "patch": "@@ -1,3 +1,8 @@\n+2019-03-09  Iain Buclaw  <ibuclaw@gdcproject.org>\n+\n+\tPR d/89041\n+\t* gdc.dg/pr89041.d: New test.\n+\n 2019-03-09  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/71544"}, {"sha": "b62c2db85d4609a3da2c6c43696cadd7e79aaf52", "filename": "gcc/testsuite/gdc.dg/pr89041.d", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9fa5d5de369171b7149827fbc784aedb27eb6b84/gcc%2Ftestsuite%2Fgdc.dg%2Fpr89041.d", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9fa5d5de369171b7149827fbc784aedb27eb6b84/gcc%2Ftestsuite%2Fgdc.dg%2Fpr89041.d", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgdc.dg%2Fpr89041.d?ref=9fa5d5de369171b7149827fbc784aedb27eb6b84", "patch": "@@ -0,0 +1,13 @@\n+// https://gcc.gnu.org/bugzilla/show_bug.cgi?id=89041\n+module pr89041;\n+\n+enum dg = delegate {};\n+\n+void fn()\n+{\n+    auto var = dg;\n+\n+    auto inner() {\n+        return dg();\n+    }\n+}"}]}