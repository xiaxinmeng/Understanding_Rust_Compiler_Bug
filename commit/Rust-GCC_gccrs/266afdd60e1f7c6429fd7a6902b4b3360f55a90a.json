{"sha": "266afdd60e1f7c6429fd7a6902b4b3360f55a90a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjY2YWZkZDYwZTFmN2M2NDI5ZmQ3YTY5MDJiNGIzMzYwZjU1YTkwYQ==", "commit": {"author": {"name": "Kai Tietz", "email": "kai.tietz@onevision.com", "date": "2010-12-02T13:15:10Z"}, "committer": {"name": "Kai Tietz", "email": "ktietz@gcc.gnu.org", "date": "2010-12-02T13:15:10Z"}, "message": "re PR libstdc++/43738 (basic_file_stdio.cc uses ioctl on a fd, but not available on mingw32)\n\n2010-12-02  Kai Tietz  <kai.tietz@onevision.com>\n\n        PR libstdc++/43738\n        * config/io/basic_file_stdio.cc (showmanyc): Check _GLIBCXX_NO_IOCTL\n        before use of ioctl.\n        * config/os/mingw32/os_defines.h (_GLIBCXX_NO_IOCTL): New.\n\nFrom-SVN: r167369", "tree": {"sha": "65f772231a2553dee779bca49e775b496d6e941a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/65f772231a2553dee779bca49e775b496d6e941a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/266afdd60e1f7c6429fd7a6902b4b3360f55a90a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/266afdd60e1f7c6429fd7a6902b4b3360f55a90a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/266afdd60e1f7c6429fd7a6902b4b3360f55a90a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/266afdd60e1f7c6429fd7a6902b4b3360f55a90a/comments", "author": null, "committer": null, "parents": [{"sha": "8529e24b969fa5bb0446977c8817210c115b9517", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8529e24b969fa5bb0446977c8817210c115b9517", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8529e24b969fa5bb0446977c8817210c115b9517"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "c5f6ab9555f2bba852fde00086157aa68fdf491b", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/266afdd60e1f7c6429fd7a6902b4b3360f55a90a/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/266afdd60e1f7c6429fd7a6902b4b3360f55a90a/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=266afdd60e1f7c6429fd7a6902b4b3360f55a90a", "patch": "@@ -1,3 +1,10 @@\n+2010-12-02  Kai Tietz  <kai.tietz@onevision.com>\n+\n+\tPR libstdc++/43738\n+\t* config/io/basic_file_stdio.cc (showmanyc): Check _GLIBCXX_NO_IOCTL\n+\tbefore use of ioctl.\n+\t* config/os/mingw32/os_defines.h (_GLIBCXX_NO_IOCTL): New.\n+\n 2010-12-01  Fran\u00e7ois Dumont  <francois.cppdevs@free.fr>\n \n \t* testsuite/23_containers/deque/cons/2.cc: Fix to explicitely invoke"}, {"sha": "d2de028f099ad67d24887ec1fa75da02f17a9f3c", "filename": "libstdc++-v3/config/io/basic_file_stdio.cc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/266afdd60e1f7c6429fd7a6902b4b3360f55a90a/libstdc%2B%2B-v3%2Fconfig%2Fio%2Fbasic_file_stdio.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/266afdd60e1f7c6429fd7a6902b4b3360f55a90a/libstdc%2B%2B-v3%2Fconfig%2Fio%2Fbasic_file_stdio.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fio%2Fbasic_file_stdio.cc?ref=266afdd60e1f7c6429fd7a6902b4b3360f55a90a", "patch": "@@ -334,6 +334,7 @@ _GLIBCXX_BEGIN_NAMESPACE(std)\n   streamsize\n   __basic_file<char>::showmanyc()\n   {\n+#ifndef _GLIBCXX_NO_IOCTL\n #ifdef FIONREAD\n     // Pipes and sockets.    \n #ifdef _GLIBCXX_FIONREAD_TAKES_OFF_T\n@@ -344,7 +345,8 @@ _GLIBCXX_BEGIN_NAMESPACE(std)\n     int __r = ioctl(this->fd(), FIONREAD, &__num);\n     if (!__r && __num >= 0)\n       return __num; \n-#endif    \n+#endif\n+#endif\n \n #ifdef _GLIBCXX_HAVE_POLL\n     // Cheap test."}, {"sha": "22a11f5a9d963c1699e373f460397a0f5a6d1378", "filename": "libstdc++-v3/config/os/mingw32/os_defines.h", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/266afdd60e1f7c6429fd7a6902b4b3360f55a90a/libstdc%2B%2B-v3%2Fconfig%2Fos%2Fmingw32%2Fos_defines.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/266afdd60e1f7c6429fd7a6902b4b3360f55a90a/libstdc%2B%2B-v3%2Fconfig%2Fos%2Fmingw32%2Fos_defines.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fos%2Fmingw32%2Fos_defines.h?ref=266afdd60e1f7c6429fd7a6902b4b3360f55a90a", "patch": "@@ -60,4 +60,9 @@\n // See  libstdc++/37522.\n #define _GLIBCXX_HAVE_BROKEN_VSWPRINTF 1\n \n+// See libstdc++/43738\n+// On native windows targets there is no ioctl function. And the existing\n+// ioctlsocket function doesn't work for normal file-descriptors.\n+#define _GLIBCXX_NO_IOCTL 1\n+\n #endif"}]}