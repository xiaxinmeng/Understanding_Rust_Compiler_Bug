{"sha": "c2baf133923865be3d30f6286c6ad821369d2955", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzJiYWYxMzM5MjM4NjViZTNkMzBmNjI4NmM2YWQ4MjEzNjlkMjk1NQ==", "commit": {"author": {"name": "Michael Meissner", "email": "meissner@gcc.gnu.org", "date": "1995-03-08T16:42:26Z"}, "committer": {"name": "Michael Meissner", "email": "meissner@gcc.gnu.org", "date": "1995-03-08T16:42:26Z"}, "message": "Define _RELOCATABLE if -mrelocatable; Rewrite eabi.asm for use with -mrelocatable.\n\nFrom-SVN: r9130", "tree": {"sha": "3368a15611775ae023cfd3800a6c7b90bf7c6bab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3368a15611775ae023cfd3800a6c7b90bf7c6bab"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c2baf133923865be3d30f6286c6ad821369d2955", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c2baf133923865be3d30f6286c6ad821369d2955", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c2baf133923865be3d30f6286c6ad821369d2955", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c2baf133923865be3d30f6286c6ad821369d2955/comments", "author": null, "committer": null, "parents": [{"sha": "8a552066c6da40dace18225bbffda66b5b9e3883", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a552066c6da40dace18225bbffda66b5b9e3883", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8a552066c6da40dace18225bbffda66b5b9e3883"}], "stats": {"total": 48, "additions": 40, "deletions": 8}, "files": [{"sha": "b903d2bb4d079a2325bc7fb41711085c62cb913c", "filename": "gcc/config/rs6000/eabi.asm", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c2baf133923865be3d30f6286c6ad821369d2955/gcc%2Fconfig%2Frs6000%2Feabi.asm", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c2baf133923865be3d30f6286c6ad821369d2955/gcc%2Fconfig%2Frs6000%2Feabi.asm", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Feabi.asm?ref=c2baf133923865be3d30f6286c6ad821369d2955", "patch": "@@ -5,19 +5,25 @@\n \t.section \".text\"\n \t.globl\t __eabi\n \n-\t.long\t0x4000\t\t\t\t# traceback table\n-__eabi:\tmflr\t0\n-\tbl\t.Laddr\t\t\t\t# get current address\n+\t .section \".got2\",\"aw\"\n+.LCTOC1 = .+32768\n \n # Table of addresses\n-.Ltable:\n-\t.long\t.Ltable\t\t\t\t# address we are really at\n+.Ltable = .-.LCTOC1\n+\t.long\t.Laddr\t\t\t\t# address we are really at\n \t.long\t_GLOBAL_OFFSET_TABLE_\t\t# normal GOT address\n \t.long\t_GOT2_START_\t\t\t# -mrelocatable GOT pointers start\n \t.long\t_GOT2_END_\t\t\t# -mrelocatable GOT pointers end\n \n+\t.text\n+.Lptr:\t.long\t.LCTOC1-.Laddr\t\t\t# PC relative pointer to .got2\n+\t.long\t0x4000\t\t\t\t# traceback table\n+\n+__eabi:\tmflr\t0\n+\tbl\t.Laddr\t\t\t\t# get current address\n .Laddr:\tmflr\t11\t\t\t\t# real address of .Ltable\n-\tlwz\t12,0(11)\t\t\t# linker generated address of .Ltable\n+\tlwz\t12,(.Laddr-.Lptr)(11)\t\t# linker generated address of .Ltable\n+\tadd\t12,12,11\t\t\t# correct to real pointer\n \tsubf.\t12,12,11\t\t\t# calculate difference\n \tbc\t4,2,.Lreloc\t\t\t# skip if we need to relocate\n "}, {"sha": "4a4ee0ac2a093516fe068e393bacc4990a01de8c", "filename": "gcc/config/rs6000/sysv4.h", "status": "modified", "additions": 28, "deletions": 2, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c2baf133923865be3d30f6286c6ad821369d2955/gcc%2Fconfig%2Frs6000%2Fsysv4.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c2baf133923865be3d30f6286c6ad821369d2955/gcc%2Fconfig%2Frs6000%2Fsysv4.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fsysv4.h?ref=c2baf133923865be3d30f6286c6ad821369d2955", "patch": "@@ -262,8 +262,34 @@ extern int rs6000_pic_labelno;\n #undef TARGET_VERSION\n #define TARGET_VERSION fprintf (stderr, \" (PowerPC System V.4)\");\n \n-/* FIXME: These should actually indicate PowerPC, when there is some\n-   standard way of expressing that.  */\n #undef CPP_PREDEFINES\n #define CPP_PREDEFINES \\\n   \"-DPPC -Dunix -D__svr4__ -Asystem(unix) -Asystem(svr4) -Acpu(powerpc) -Amachine(powerpc)\"\n+\n+#undef CPP_SPEC\n+#define CPP_SPEC \"\\\n+%{posix: -D_POSIX_SOURCE} \\\n+%{mrelocatable: -D_RELOCATABLE} \\\n+%{!mcpu*: \\\n+  %{mpower: %{!mpower2: -D_ARCH_PWR}} \\\n+  %{mpower2: -D_ARCH_PWR2} \\\n+  %{mpowerpc*: -D_ARCH_PPC} \\\n+  %{mno-powerpc: %{!mpower: %{!mpower2: -D_ARCH_COM}}} \\\n+  %{!mno-powerpc: -D_ARCH_PPC}} \\\n+%{mcpu=common: -D_ARCH_COM} \\\n+%{mcpu=power: -D_ARCH_PWR} \\\n+%{mcpu=powerpc: -D_ARCH_PPC} \\\n+%{mcpu=rios: -D_ARCH_PWR} \\\n+%{mcpu=rios1: -D_ARCH_PWR} \\\n+%{mcpu=rios2: -D_ARCH_PWR2} \\\n+%{mcpu=rsc: -D_ARCH_PWR} \\\n+%{mcpu=rsc1: -D_ARCH_PWR} \\\n+%{mcpu=601: -D_ARCH_PPC -D_ARCH_PWR} \\\n+%{mcpu=mpc601: -D_ARCH_PPC -D_ARCH_PWR} \\\n+%{mcpu=ppc601: -D_ARCH_PPC -D_ARCH_PWR} \\\n+%{mcpu=603: -D_ARCH_PPC} \\\n+%{mcpu=mpc603: -D_ARCH_PPC} \\\n+%{mcpu=ppc603: -D_ARCH_PPC} \\\n+%{mcpu=604: -D_ARCH_PPC} \\\n+%{mcpu=mpc604: -D_ARCH_PPC} \\\n+%{mcpu=ppc604: -D_ARCH_PPC}\""}]}