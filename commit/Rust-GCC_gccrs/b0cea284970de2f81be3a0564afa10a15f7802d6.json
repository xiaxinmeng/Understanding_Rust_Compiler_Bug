{"sha": "b0cea284970de2f81be3a0564afa10a15f7802d6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjBjZWEyODQ5NzBkZTJmODFiZTNhMDU2NGFmYTEwYTE1Zjc4MDJkNg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-08-12T19:56:26Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-08-12T19:56:26Z"}, "message": "re PR c/71512 (ICE: verify_gimple failed with UBSAN)\n\n\tPR c/71512\n\t* ubsan.c (instrument_si_overflow): Pass true instead of false\n\tto gsi_replace.\n\t(pass_ubsan::execute): Call gimple_purge_dead_eh_edges at the end\n\tof bbs.  Return TODO_cleanup_cfg if any returned true.\n\n\t* g++.dg/ubsan/pr71512.C: New test.\n\t* c-c++-common/ubsan/pr71512-1.c: New test.\n\t* c-c++-common/ubsan/pr71512-2.c: New test.\n\nFrom-SVN: r239430", "tree": {"sha": "452ba5392a5f769e1c601d722988d77bf90bf45b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/452ba5392a5f769e1c601d722988d77bf90bf45b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b0cea284970de2f81be3a0564afa10a15f7802d6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0cea284970de2f81be3a0564afa10a15f7802d6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b0cea284970de2f81be3a0564afa10a15f7802d6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0cea284970de2f81be3a0564afa10a15f7802d6/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e86aefb8e955a9545ffd16c960ff70cbad5fc9ad", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e86aefb8e955a9545ffd16c960ff70cbad5fc9ad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e86aefb8e955a9545ffd16c960ff70cbad5fc9ad"}], "stats": {"total": 54, "additions": 51, "deletions": 3}, "files": [{"sha": "db6138d9aa7614da7cea2962511137cf081231cb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0cea284970de2f81be3a0564afa10a15f7802d6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0cea284970de2f81be3a0564afa10a15f7802d6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b0cea284970de2f81be3a0564afa10a15f7802d6", "patch": "@@ -1,3 +1,11 @@\n+2016-08-12  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/71512\n+\t* ubsan.c (instrument_si_overflow): Pass true instead of false\n+\tto gsi_replace.\n+\t(pass_ubsan::execute): Call gimple_purge_dead_eh_edges at the end\n+\tof bbs.  Return TODO_cleanup_cfg if any returned true.\n+\n 2016-08-12  Michael Meissner  <meissner@linux.vnet.ibm.com>\n \n \t* config/rs6000/vsx.md (vsx_concat_<mode>): Add support for the"}, {"sha": "6ea002dba666c3c0185d9346347a7903422ec3a0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0cea284970de2f81be3a0564afa10a15f7802d6/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0cea284970de2f81be3a0564afa10a15f7802d6/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b0cea284970de2f81be3a0564afa10a15f7802d6", "patch": "@@ -1,3 +1,10 @@\n+2016-08-12  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/71512\n+\t* g++.dg/ubsan/pr71512.C: New test.\n+\t* c-c++-common/ubsan/pr71512-1.c: New test.\n+\t* c-c++-common/ubsan/pr71512-2.c: New test.\n+\n 2016-08-12  Michael Meissner  <meissner@linux.vnet.ibm.com>\n \n \t* gcc.target/powerpc/vec-init-1.c: New tests to test various"}, {"sha": "2a90ab18d5179f2d22bbc24b8428a96a3c8058ba", "filename": "gcc/testsuite/c-c++-common/ubsan/pr71512-1.c", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0cea284970de2f81be3a0564afa10a15f7802d6/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fpr71512-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0cea284970de2f81be3a0564afa10a15f7802d6/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fpr71512-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fpr71512-1.c?ref=b0cea284970de2f81be3a0564afa10a15f7802d6", "patch": "@@ -0,0 +1,5 @@\n+/* PR c/71512 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fnon-call-exceptions -ftrapv -fexceptions -fsanitize=undefined\" } */\n+\n+#include \"../../gcc.dg/pr44545.c\""}, {"sha": "1c955930be83bc4be5eb6207a11e990c017ffc3b", "filename": "gcc/testsuite/c-c++-common/ubsan/pr71512-2.c", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0cea284970de2f81be3a0564afa10a15f7802d6/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fpr71512-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0cea284970de2f81be3a0564afa10a15f7802d6/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fpr71512-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Fpr71512-2.c?ref=b0cea284970de2f81be3a0564afa10a15f7802d6", "patch": "@@ -0,0 +1,5 @@\n+/* PR c/71512 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O -fexceptions -fnon-call-exceptions -ftrapv -fsanitize=undefined\" } */\n+\n+#include \"../../gcc.dg/pr47086.c\""}, {"sha": "9822c989a1cf92d2d8ab49f8bcd8055bcc6a0d9b", "filename": "gcc/testsuite/g++.dg/ubsan/pr71512.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0cea284970de2f81be3a0564afa10a15f7802d6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fubsan%2Fpr71512.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0cea284970de2f81be3a0564afa10a15f7802d6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fubsan%2Fpr71512.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fubsan%2Fpr71512.C?ref=b0cea284970de2f81be3a0564afa10a15f7802d6", "patch": "@@ -0,0 +1,20 @@\n+/* PR c/71512 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -ftrapv -fnon-call-exceptions -fsanitize=undefined\" } */\n+\n+bool\n+foo (int *x, int *y, int *z)\n+{\n+  try\n+    {\n+      x[0] = y[0] + z[0];\n+      x[1] = y[1] - z[1];\n+      x[2] = y[2] * z[2];\n+      x[3] = -y[3];\n+    }\n+  catch (...)\n+    {\n+      return true;\n+    }\n+  return false;\n+}"}, {"sha": "a118af297f8e13426ca3f78ede2df90b65ed1ae1", "filename": "gcc/ubsan.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0cea284970de2f81be3a0564afa10a15f7802d6/gcc%2Fubsan.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0cea284970de2f81be3a0564afa10a15f7802d6/gcc%2Fubsan.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fubsan.c?ref=b0cea284970de2f81be3a0564afa10a15f7802d6", "patch": "@@ -1292,7 +1292,7 @@ instrument_si_overflow (gimple_stmt_iterator gsi)\n \t\t\t\t      ? IFN_UBSAN_CHECK_SUB\n \t\t\t\t      : IFN_UBSAN_CHECK_MUL, 2, a, b);\n       gimple_call_set_lhs (g, lhs);\n-      gsi_replace (&gsi, g, false);\n+      gsi_replace (&gsi, g, true);\n       break;\n     case NEGATE_EXPR:\n       /* Represent i = -u;\n@@ -1302,7 +1302,7 @@ instrument_si_overflow (gimple_stmt_iterator gsi)\n       b = gimple_assign_rhs1 (stmt);\n       g = gimple_build_call_internal (IFN_UBSAN_CHECK_SUB, 2, a, b);\n       gimple_call_set_lhs (g, lhs);\n-      gsi_replace (&gsi, g, false);\n+      gsi_replace (&gsi, g, true);\n       break;\n     case ABS_EXPR:\n       /* Transform i = ABS_EXPR<u>;\n@@ -1955,6 +1955,7 @@ pass_ubsan::execute (function *fun)\n {\n   basic_block bb;\n   gimple_stmt_iterator gsi;\n+  unsigned int ret = 0;\n \n   initialize_sanitizer_builtins ();\n \n@@ -2013,8 +2014,10 @@ pass_ubsan::execute (function *fun)\n \n \t  gsi_next (&gsi);\n \t}\n+      if (gimple_purge_dead_eh_edges (bb))\n+\tret = TODO_cleanup_cfg;\n     }\n-  return 0;\n+  return ret;\n }\n \n } // anon namespace"}]}