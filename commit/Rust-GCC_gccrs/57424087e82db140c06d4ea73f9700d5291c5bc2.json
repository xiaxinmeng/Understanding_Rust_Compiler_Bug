{"sha": "57424087e82db140c06d4ea73f9700d5291c5bc2", "node_id": "C_kwDOANBUbNoAKDU3NDI0MDg3ZTgyZGIxNDBjMDZkNGVhNzNmOTcwMGQ1MjkxYzViYzI", "commit": {"author": {"name": "Xionghu Luo", "email": "xionghuluo@tencent.com", "date": "2022-06-09T07:46:30Z"}, "committer": {"name": "Xionghu Luo", "email": "xionghuluo@tencent.com", "date": "2022-06-21T09:26:45Z"}, "message": "if-to-switch: Don't skip the first condition bb when find_conditions in if-to-switch [PR105740]\n\nThe if condition is at last of first bb, so side effect statement in first BB\ndoesn't matter, then the first if condition could also be folded to switch\ntable.\n\ngcc/ChangeLog:\n\n\tPR target/105740\n\t* gimple-if-to-switch.cc (find_conditions): Don't skip the first\n\tcondition bb.\n\ngcc/testsuite/ChangeLog:\n\n\tPR target/105740\n\t* gcc.dg/tree-ssa/if-to-switch-11.c: New test.\n\nSigned-off-by: Xionghu Luo <xionghuluo@tencent.com>", "tree": {"sha": "d4591e9522d7914d858507e0cf678a3bc18530ab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d4591e9522d7914d858507e0cf678a3bc18530ab"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/57424087e82db140c06d4ea73f9700d5291c5bc2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57424087e82db140c06d4ea73f9700d5291c5bc2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/57424087e82db140c06d4ea73f9700d5291c5bc2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57424087e82db140c06d4ea73f9700d5291c5bc2/comments", "author": null, "committer": null, "parents": [{"sha": "70454c50b4592fe6876ecca13268264e395e058f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/70454c50b4592fe6876ecca13268264e395e058f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/70454c50b4592fe6876ecca13268264e395e058f"}], "stats": {"total": 32, "additions": 31, "deletions": 1}, "files": [{"sha": "ca276d790c322f62619437588b93f81106ce420c", "filename": "gcc/gimple-if-to-switch.cc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57424087e82db140c06d4ea73f9700d5291c5bc2/gcc%2Fgimple-if-to-switch.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57424087e82db140c06d4ea73f9700d5291c5bc2/gcc%2Fgimple-if-to-switch.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-if-to-switch.cc?ref=57424087e82db140c06d4ea73f9700d5291c5bc2", "patch": "@@ -389,7 +389,9 @@ find_conditions (basic_block bb,\n   if (cond == NULL)\n     return;\n \n-  if (!no_side_effect_bb (bb))\n+  /* An empty conditions_in_bbs indicates we are processing the first\n+     basic-block then no need check side effect.  */\n+  if (!conditions_in_bbs->is_empty () && !no_side_effect_bb (bb))\n     return;\n \n   tree lhs = gimple_cond_lhs (cond);"}, {"sha": "3dffee04812bd0439eecb5db1440b6c849c54202", "filename": "gcc/testsuite/gcc.dg/tree-ssa/if-to-switch-11.c", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57424087e82db140c06d4ea73f9700d5291c5bc2/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fif-to-switch-11.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57424087e82db140c06d4ea73f9700d5291c5bc2/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fif-to-switch-11.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fif-to-switch-11.c?ref=57424087e82db140c06d4ea73f9700d5291c5bc2", "patch": "@@ -0,0 +1,28 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-iftoswitch-optimized\" } */\n+\n+struct f {\n+  int len;\n+  int arr[4];\n+};\n+\n+int\n+test (struct f const *const f)\n+{\n+  if (f->arr[3] == 1) {\n+    return 12;\n+  } else if (f->arr[3] == 2) {\n+    return 27;\n+  } else if (f->arr[3] == 3) {\n+    return 38;\n+  } else if (f->arr[3] == 4) {\n+    return 18;\n+  } else if (f->arr[3] == 5) {\n+    return 58;\n+  } else if (f->arr[3] == 6) {\n+    return 68;\n+  }\n+  return 0;\n+}\n+\n+/* { dg-final { scan-tree-dump \"Canonical GIMPLE case clusters: 1 2 3 4 5 6\" \"iftoswitch\" } } */"}]}