{"sha": "318c48e30402eadaeee86dee9486733678c5fef4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzE4YzQ4ZTMwNDAyZWFkYWVlZTg2ZGVlOTQ4NjczMzY3OGM1ZmVmNA==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2017-07-06T11:54:10Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2017-07-06T11:54:10Z"}, "message": "Prevent __uses_alloc from holding dangling references\n\n\t* include/bits/uses_allocator.h (__use_alloc(const _Alloc&&)): Add\n\tdeleted overload to prevent dangling references to rvalues.\n\t* include/experimental/memory_resource\n\t(polymorphic_allocator::construct): Do not call __use_alloc with\n\trvalue arguments.\n\nFrom-SVN: r250019", "tree": {"sha": "e5525d528a0fa911bbca4a5b836c9fd1a0a559c1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e5525d528a0fa911bbca4a5b836c9fd1a0a559c1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/318c48e30402eadaeee86dee9486733678c5fef4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/318c48e30402eadaeee86dee9486733678c5fef4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/318c48e30402eadaeee86dee9486733678c5fef4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/318c48e30402eadaeee86dee9486733678c5fef4/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "68d872d728caced187cfef59c8a5a04af34b2c64", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68d872d728caced187cfef59c8a5a04af34b2c64", "html_url": "https://github.com/Rust-GCC/gccrs/commit/68d872d728caced187cfef59c8a5a04af34b2c64"}], "stats": {"total": 23, "additions": 19, "deletions": 4}, "files": [{"sha": "1c50a3b2b4c9b1fd10280d9eb9add5a2bc4d3425", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/318c48e30402eadaeee86dee9486733678c5fef4/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/318c48e30402eadaeee86dee9486733678c5fef4/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=318c48e30402eadaeee86dee9486733678c5fef4", "patch": "@@ -1,3 +1,11 @@\n+2017-07-06  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\t* include/bits/uses_allocator.h (__use_alloc(const _Alloc&&)): Add\n+\tdeleted overload to prevent dangling references to rvalues.\n+\t* include/experimental/memory_resource\n+\t(polymorphic_allocator::construct): Do not call __use_alloc with\n+\trvalue arguments.\n+\n 2017-06-27  Tim Shen  <timshen@google.com>\n \n \tPR libstdc++/80187"}, {"sha": "4d60716b494fedf800f3672c3ac6e754e830efd9", "filename": "libstdc++-v3/include/bits/uses_allocator.h", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/318c48e30402eadaeee86dee9486733678c5fef4/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fuses_allocator.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/318c48e30402eadaeee86dee9486733678c5fef4/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fuses_allocator.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fuses_allocator.h?ref=318c48e30402eadaeee86dee9486733678c5fef4", "patch": "@@ -109,6 +109,11 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       __ret._M_a = std::__addressof(__a);\n       return __ret;\n     }\n+\n+  template<typename _Tp, typename _Alloc, typename... _Args>\n+    void\n+    __use_alloc(const _Alloc&&) = delete;\n+\n #if __cplusplus > 201402L\n   template <typename _Tp, typename _Alloc>\n     inline constexpr bool uses_allocator_v ="}, {"sha": "99ace7a7f81b52a5f42f7d1ae9c5ce37a46aa3a8", "filename": "libstdc++-v3/include/experimental/memory_resource", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/318c48e30402eadaeee86dee9486733678c5fef4/libstdc%2B%2B-v3%2Finclude%2Fexperimental%2Fmemory_resource", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/318c48e30402eadaeee86dee9486733678c5fef4/libstdc%2B%2B-v3%2Finclude%2Fexperimental%2Fmemory_resource", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fexperimental%2Fmemory_resource?ref=318c48e30402eadaeee86dee9486733678c5fef4", "patch": "@@ -168,8 +168,9 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       template <typename _Tp1, typename... _Args> //used here\n \tvoid construct(_Tp1* __p, _Args&&... __args)\n \t{\n-\t  auto __use_tag = __use_alloc<_Tp1, memory_resource*,\n-\t       _Args...>(this->resource());\n+\t  memory_resource* const __resource = this->resource();\n+\t  auto __use_tag\n+\t    = __use_alloc<_Tp1, memory_resource*, _Args...>(__resource);\n \t  _M_construct(__use_tag, __p, std::forward<_Args>(__args)...);\n \t}\n \n@@ -180,10 +181,11 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t\t       tuple<_Args1...> __x,\n \t\t       tuple<_Args2...> __y)\n \t{\n+\t  memory_resource* const __resource = this->resource();\n \t  auto __x_use_tag =\n-\t    __use_alloc<_Tp1, memory_resource*, _Args1...>(this->resource());\n+\t    __use_alloc<_Tp1, memory_resource*, _Args1...>(__resource);\n \t  auto __y_use_tag =\n-\t    __use_alloc<_Tp2, memory_resource*, _Args2...>(this->resource());\n+\t    __use_alloc<_Tp2, memory_resource*, _Args2...>(__resource);\n \n \t  ::new(__p) std::pair<_Tp1, _Tp2>(piecewise_construct,\n \t\t\t\t\t   _M_construct_p(__x_use_tag, __x),"}]}