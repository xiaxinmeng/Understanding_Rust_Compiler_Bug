{"sha": "47c217252a6ddb70babcaf3b544a17a3b33bd80f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDdjMjE3MjUyYTZkZGI3MGJhYmNhZjNiNTQ0YTE3YTNiMzNiZDgwZg==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2010-11-12T17:53:36Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2010-11-12T17:53:36Z"}, "message": "xtensa: Convert to fma.\n\n        * config.gcc [xtensa] (extra_options): Add fused-madd.opt.\n        * config/xtensa/xtensa.opt (mfused-madd): Remove.\n        * config/xtensa/xtensa.c (TARGET_DEFAULT_TARGET_FLAGS): Remove\n        MASK_FUSED_MADD.\n        * config/xtensa/xtensa.md (fmasf4): Rename from muladdsf3; use\n        * fma.\n        (fnmasf4): Rename from mulsubsf3; use fma.\n\nFrom-SVN: r166666", "tree": {"sha": "b52955f1bbf013daa3c5d5060ab58cc99ba73847", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b52955f1bbf013daa3c5d5060ab58cc99ba73847"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/47c217252a6ddb70babcaf3b544a17a3b33bd80f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47c217252a6ddb70babcaf3b544a17a3b33bd80f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/47c217252a6ddb70babcaf3b544a17a3b33bd80f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47c217252a6ddb70babcaf3b544a17a3b33bd80f/comments", "author": null, "committer": null, "parents": [{"sha": "f1cb6795d3c9394f06d19d8be6999d9d8a108b19", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f1cb6795d3c9394f06d19d8be6999d9d8a108b19", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f1cb6795d3c9394f06d19d8be6999d9d8a108b19"}], "stats": {"total": 41, "additions": 25, "deletions": 16}, "files": [{"sha": "923a120442607026a41c1344cf192b0caac7fca7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47c217252a6ddb70babcaf3b544a17a3b33bd80f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47c217252a6ddb70babcaf3b544a17a3b33bd80f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=47c217252a6ddb70babcaf3b544a17a3b33bd80f", "patch": "@@ -1,3 +1,12 @@\n+2010-11-12  Richard Henderson  <rth@redhat.com>\n+\n+\t* config.gcc [xtensa] (extra_options): Add fused-madd.opt.\n+\t* config/xtensa/xtensa.opt (mfused-madd): Remove.\n+\t* config/xtensa/xtensa.c (TARGET_DEFAULT_TARGET_FLAGS): Remove\n+\tMASK_FUSED_MADD.\n+\t* config/xtensa/xtensa.md (fmasf4): Rename from muladdsf3; use fma.\n+\t(fnmasf4): Rename from mulsubsf3; use fma.\n+\n 2010-11-12  Joern Rennecke  <amylaar@spamcop.net>\n \t    Richard Henderson  <rth@redhat.com>\n "}, {"sha": "cb718b4b2f626ff56bc4a68e23d63072e33e95b9", "filename": "gcc/config.gcc", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47c217252a6ddb70babcaf3b544a17a3b33bd80f/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47c217252a6ddb70babcaf3b544a17a3b33bd80f/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=47c217252a6ddb70babcaf3b544a17a3b33bd80f", "patch": "@@ -399,6 +399,9 @@ sh[123456789lbe]*-*-* | sh-*-*)\n \tcpu_type=sh\n \tneed_64bit_hwint=yes\n \t;;\n+xtensa*-*-*)\n+\textra_options=\"${extra_options} fused-madd.opt\"\n+\t;;\n esac\n \n tm_file=${cpu_type}/${cpu_type}.h"}, {"sha": "033779c3d58f86aefc64cc08913a9b2d8ca2b686", "filename": "gcc/config/xtensa/xtensa.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47c217252a6ddb70babcaf3b544a17a3b33bd80f/gcc%2Fconfig%2Fxtensa%2Fxtensa.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47c217252a6ddb70babcaf3b544a17a3b33bd80f/gcc%2Fconfig%2Fxtensa%2Fxtensa.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.c?ref=47c217252a6ddb70babcaf3b544a17a3b33bd80f", "patch": "@@ -193,7 +193,7 @@ static const struct default_options xtensa_option_optimization_table[] =\n #define TARGET_ASM_SELECT_RTX_SECTION  xtensa_select_rtx_section\n \n #undef TARGET_DEFAULT_TARGET_FLAGS\n-#define TARGET_DEFAULT_TARGET_FLAGS (TARGET_DEFAULT | MASK_FUSED_MADD)\n+#define TARGET_DEFAULT_TARGET_FLAGS (TARGET_DEFAULT)\n \n #undef TARGET_LEGITIMIZE_ADDRESS\n #define TARGET_LEGITIMIZE_ADDRESS xtensa_legitimize_address"}, {"sha": "9d9bf9c246d2504af8c0e7be938043526671961e", "filename": "gcc/config/xtensa/xtensa.md", "status": "modified", "additions": 12, "deletions": 11, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47c217252a6ddb70babcaf3b544a17a3b33bd80f/gcc%2Fconfig%2Fxtensa%2Fxtensa.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47c217252a6ddb70babcaf3b544a17a3b33bd80f/gcc%2Fconfig%2Fxtensa%2Fxtensa.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.md?ref=47c217252a6ddb70babcaf3b544a17a3b33bd80f", "patch": "@@ -315,24 +315,25 @@\n    (set_attr \"mode\"\t\"SF\")\n    (set_attr \"length\"\t\"3\")])\n \n-(define_insn \"muladdsf3\"\n+(define_insn \"fmasf4\"\n   [(set (match_operand:SF 0 \"register_operand\" \"=f\")\n-\t(plus:SF (mult:SF (match_operand:SF 1 \"register_operand\" \"%f\")\n-\t\t\t  (match_operand:SF 2 \"register_operand\" \"f\"))\n-\t\t (match_operand:SF 3 \"register_operand\" \"0\")))]\n-  \"TARGET_HARD_FLOAT && TARGET_FUSED_MADD\"\n+\t(fma:SF (match_operand:SF 1 \"register_operand\" \"f\")\n+\t\t(match_operand:SF 2 \"register_operand\" \"f\")\n+\t\t(match_operand:SF 3 \"register_operand\" \"0\")))]\n+  \"TARGET_HARD_FLOAT\"\n   \"madd.s\\t%0, %1, %2\"\n   [(set_attr \"type\"\t\"fmadd\")\n    (set_attr \"mode\"\t\"SF\")\n    (set_attr \"length\"\t\"3\")])\n \n-(define_insn \"mulsubsf3\"\n+;; Note that (C - A*B) = (-A*B + C)\n+(define_insn \"fnmasf4\"\n   [(set (match_operand:SF 0 \"register_operand\" \"=f\")\n-\t(minus:SF (match_operand:SF 1 \"register_operand\" \"0\")\n-\t\t  (mult:SF (match_operand:SF 2 \"register_operand\" \"%f\")\n-\t\t\t   (match_operand:SF 3 \"register_operand\" \"f\"))))]\n-  \"TARGET_HARD_FLOAT && TARGET_FUSED_MADD\"\n-  \"msub.s\\t%0, %2, %3\"\n+\t(fma:SF (neg:SF (match_operand:SF 1 \"register_operand\" \"f\"))\n+\t\t(match_operand:SF 2 \"register_operand\" \"f\")\n+\t\t(match_operand:SF 3 \"register_operand\" \"0\")))]\n+  \"TARGET_HARD_FLOAT\"\n+  \"msub.s\\t%0, %1, %2\"\n   [(set_attr \"type\"\t\"fmadd\")\n    (set_attr \"mode\"\t\"SF\")\n    (set_attr \"length\"\t\"3\")])"}, {"sha": "9ae8b392eff94132bf7b558346d0dab981c9ddf5", "filename": "gcc/config/xtensa/xtensa.opt", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47c217252a6ddb70babcaf3b544a17a3b33bd80f/gcc%2Fconfig%2Fxtensa%2Fxtensa.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47c217252a6ddb70babcaf3b544a17a3b33bd80f/gcc%2Fconfig%2Fxtensa%2Fxtensa.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.opt?ref=47c217252a6ddb70babcaf3b544a17a3b33bd80f", "patch": "@@ -22,10 +22,6 @@ mconst16\n Target Report Mask(CONST16)\n Use CONST16 instruction to load constants\n \n-mfused-madd\n-Target Report Mask(FUSED_MADD)\n-Enable fused multiply/add and multiply/subtract FP instructions\n-\n mforce-no-pic\n Target Report Mask(FORCE_NO_PIC)\n Disable position-independent code (PIC) for use in OS kernel code"}]}