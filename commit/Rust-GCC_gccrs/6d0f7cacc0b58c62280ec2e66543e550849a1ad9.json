{"sha": "6d0f7cacc0b58c62280ec2e66543e550849a1ad9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmQwZjdjYWNjMGI1OGM2MjI4MGVjMmU2NjU0M2U1NTA4NDlhMWFkOQ==", "commit": {"author": {"name": "Benjamin Kosnik", "email": "bkoz@redhat.com", "date": "2012-04-25T22:47:52Z"}, "committer": {"name": "Benjamin Kosnik", "email": "bkoz@gcc.gnu.org", "date": "2012-04-25T22:47:52Z"}, "message": "re PR libstdc++/52689 (static linking with libstdc++ fails)\n\n2012-04-25  Benjamin Kosnik  <bkoz@redhat.com>\n\n\tPR libstdc++/52689\n\t* testsuite/17_intro/static.cc: Fix.\n\t* testsuite/lib/dg-options.exp (dg-require-static-libstdcxx): New.\n\nFrom-SVN: r186845", "tree": {"sha": "689f97a10b524a49f9bb9a883715f27f56e26dc7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/689f97a10b524a49f9bb9a883715f27f56e26dc7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6d0f7cacc0b58c62280ec2e66543e550849a1ad9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d0f7cacc0b58c62280ec2e66543e550849a1ad9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6d0f7cacc0b58c62280ec2e66543e550849a1ad9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d0f7cacc0b58c62280ec2e66543e550849a1ad9/comments", "author": null, "committer": null, "parents": [{"sha": "8ca72b98a6a19f8ba37aab7579dd7cbde1d82d94", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ca72b98a6a19f8ba37aab7579dd7cbde1d82d94", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8ca72b98a6a19f8ba37aab7579dd7cbde1d82d94"}], "stats": {"total": 66, "additions": 63, "deletions": 3}, "files": [{"sha": "455931163b99465318a5dab740a346463e0bb6ca", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d0f7cacc0b58c62280ec2e66543e550849a1ad9/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d0f7cacc0b58c62280ec2e66543e550849a1ad9/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=6d0f7cacc0b58c62280ec2e66543e550849a1ad9", "patch": "@@ -1,3 +1,10 @@\n+2012-04-25  Benjamin Kosnik  <bkoz@redhat.com>\n+\n+\tPR libstdc++/52689\n+\t* testsuite/17_intro/static.cc: Fix.\n+\t* testsuite/lib/dg-options.exp (dg-require-static-libstdcxx): New.\n+\t* testsuite/lib/libstdc++.exp (check_v3_target_static_libstdcxx): New.\n+\n 2012-04-25  Jonathan Wakely  <jwakely.gcc@gmail.com>\n \n \t* include/std/scoped_allocator (scoped_allocator::__outermost): Do"}, {"sha": "6b1d2c4d5fca1c6ee1002b54fb0d503fcc5fea7e", "filename": "libstdc++-v3/testsuite/17_intro/static.cc", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d0f7cacc0b58c62280ec2e66543e550849a1ad9/libstdc%2B%2B-v3%2Ftestsuite%2F17_intro%2Fstatic.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d0f7cacc0b58c62280ec2e66543e550849a1ad9/libstdc%2B%2B-v3%2Ftestsuite%2F17_intro%2Fstatic.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F17_intro%2Fstatic.cc?ref=6d0f7cacc0b58c62280ec2e66543e550849a1ad9", "patch": "@@ -1,6 +1,6 @@\n // { dg-do link }\n-// { dg-require-effective-target static }\n-// { dg-options \"-static -std=gnu++11\" }\n+// { dg-require-static-libstdcxx }\n+// { dg-options \"-static-libstdc++ -std=gnu++11\" }\n \n // Copyright (C) 2012 Free Software Foundation, Inc.\n //\n@@ -25,7 +25,7 @@\n \n int main()\n {\n-  std::locale c = std::locale::global();\n+  std::locale c __attribute__((unused)) = std::locale::classic();\n   std::cout << \"i am old-skool\\n\";\n   return 0;\n }"}, {"sha": "9d5624aedbb17d8d57779d325c36b5fa34b80de4", "filename": "libstdc++-v3/testsuite/lib/dg-options.exp", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d0f7cacc0b58c62280ec2e66543e550849a1ad9/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Fdg-options.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d0f7cacc0b58c62280ec2e66543e550849a1ad9/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Fdg-options.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Fdg-options.exp?ref=6d0f7cacc0b58c62280ec2e66543e550849a1ad9", "patch": "@@ -197,6 +197,15 @@ proc dg-require-nprocs { args } {\n     return\n }\n \n+proc dg-require-static-libstdcxx { args } {\n+    if { ![ check_v3_target_static_libstdcxx ] } {\n+        upvar dg-do-what dg-do-what\n+        set dg-do-what [list [lindex ${dg-do-what} 0] \"N\" \"P\"]\n+        return\n+    }\n+    return\n+}\n+\n proc add_options_for_no_pch { flags } {\n     # This forces any generated and possibly included PCH to be invalid.\n     return \"-D__GLIBCXX__=99999999\""}, {"sha": "9a9e0cba62528accb396dabf4c3a4711ecb71ca5", "filename": "libstdc++-v3/testsuite/lib/libstdc++.exp", "status": "modified", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d0f7cacc0b58c62280ec2e66543e550849a1ad9/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d0f7cacc0b58c62280ec2e66543e550849a1ad9/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp?ref=6d0f7cacc0b58c62280ec2e66543e550849a1ad9", "patch": "@@ -1693,5 +1693,49 @@ proc check_v3_target_nprocs { } {\n     return $et_nprocs\n }\n \n+proc check_v3_target_static_libstdcxx { } {\n+    global cxxflags\n+    global DEFAULT_CXXFLAGS\n+    global et_static_libstdcxx\n+\n+    global tool\n+\n+    if [info exists et_static_libstdcxx] {\n+\tverbose \"check_v3_target_static_libstdcxx: using cached result\" 2\n+    } else {\n+\tset et_static_libstdcxx 0\n+\n+\t# Set up and link a C++0x test program that depends\n+\t# on static linking\n+\tset src static-maybe[pid].cc\n+\n+\tset f [open $src \"w\"]\n+        puts $f \"#include <iostream>\"\n+\tputs $f \"int main() {\"\n+\tputs $f \"int i(415);\"\n+\tputs $f \"std::cout<< i << std::endl;\"\n+\tputs $f \"return 0; }\"\n+\tputs $f \"\"\n+\tclose $f\n+\n+\tset cxxflags_saved $cxxflags\n+\tset cxxflags \"$cxxflags $DEFAULT_CXXFLAGS -static-libstdc++\"\n+\n+\tset lines [v3_target_compile $src /dev/null executable \"\"]\n+\tset cxxflags $cxxflags_saved\n+\tfile delete $src\n+\n+\tif [string match \"\" $lines] {\n+\t    # No error message, link succeeded.\n+\t    set et_static_libstdcxx 1\n+\t} else {\n+\t    verbose \"check_v3_target_static_libstdcxx: compilation failed\" 2\n+\t}\n+    }\n+    verbose \"check_v3_target_static_libstdcxx: $et_static_libstdcxx\" 2\n+    return $et_static_libstdcxx\n+}\n+\n+\n \n set additional_prunes \"\""}]}