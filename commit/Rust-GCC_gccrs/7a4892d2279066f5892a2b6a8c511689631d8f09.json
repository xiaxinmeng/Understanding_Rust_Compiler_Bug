{"sha": "7a4892d2279066f5892a2b6a8c511689631d8f09", "node_id": "C_kwDOANBUbNoAKDdhNDg5MmQyMjc5MDY2ZjU4OTJhMmI2YThjNTExNjg5NjMxZDhmMDk", "commit": {"author": {"name": "Marc Poulhi\u00e8s", "email": "poulhies@adacore.com", "date": "2022-01-28T15:55:43Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2022-05-12T12:38:34Z"}, "message": "[Ada] Fix style checking rule for square brackets in Ada 2022 and above\n\nThe square bracket syntax introduced in Ada 2022 was incorrectly handled\nby the style checker and incorrect spacing was enforced. The issue was\nin part caused by the wide character syntax (support removed starting\nfrom Ada 2022) that treats the square bracket as a valid identifier\ncharacter.\n\ngcc/ada/\n\n\t* csets.adb (Initialize): Only treat square bracket as valid\n\tidentifier character for Ada versions prior to Ada 2022.\n\t* style.ads (Check_Left_Paren): Rename...\n\t(Check_Left_Paren_Square_Bracket): ...to this.\n\t* styleg.adb (Check_Left_Bracket): Rename...\n\t(Check_Left_Paren_Square_Bracket): ...to this.\n\t* styleg.ads (Check_Left_Paren): Rename...\n\t(Check_Left_Paren_Square_Bracket): ...to this.\n\t* scng.adb (Scan): Add check for spacing around left square\n\tbracket and use new name for Check_Left_Paren_Square_Bracket.\n\t* libgnat/a-szmzco.ads (Control_Ranges, Graphic_Ranges)\n\t(Letter_Ranges, Decimal_Digit_Ranges, ISO_646_Ranges)\n\t(Character_Ranges): Fix style (remove extra space).\n\t* libgnat/a-swmwco.ads (Control_Ranges, Graphic_Ranges)\n\t(Letter_Ranges, Decimal_Digit_Ranges, ISO_646_Ranges)\n\t(Character_Ranges): Likewise.\n\t* opt.adb (Set_Config_Switches): Remove [ from Identifier_Char\n\tset.", "tree": {"sha": "6becd5efcffef1731fcb790743d195b61624920b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6becd5efcffef1731fcb790743d195b61624920b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7a4892d2279066f5892a2b6a8c511689631d8f09", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7a4892d2279066f5892a2b6a8c511689631d8f09", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7a4892d2279066f5892a2b6a8c511689631d8f09", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7a4892d2279066f5892a2b6a8c511689631d8f09/comments", "author": {"login": "dkm", "id": 87603, "node_id": "MDQ6VXNlcjg3NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/87603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkm", "html_url": "https://github.com/dkm", "followers_url": "https://api.github.com/users/dkm/followers", "following_url": "https://api.github.com/users/dkm/following{/other_user}", "gists_url": "https://api.github.com/users/dkm/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkm/subscriptions", "organizations_url": "https://api.github.com/users/dkm/orgs", "repos_url": "https://api.github.com/users/dkm/repos", "events_url": "https://api.github.com/users/dkm/events{/privacy}", "received_events_url": "https://api.github.com/users/dkm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b9cff88ca79664ade8bd1c870d01b56f8599afa4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b9cff88ca79664ade8bd1c870d01b56f8599afa4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b9cff88ca79664ade8bd1c870d01b56f8599afa4"}], "stats": {"total": 92, "additions": 52, "deletions": 40}, "files": [{"sha": "bd2ba928661798e5b206759b8c07265300b91f33", "filename": "gcc/ada/csets.adb", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a4892d2279066f5892a2b6a8c511689631d8f09/gcc%2Fada%2Fcsets.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a4892d2279066f5892a2b6a8c511689631d8f09/gcc%2Fada%2Fcsets.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fcsets.adb?ref=7a4892d2279066f5892a2b6a8c511689631d8f09", "patch": "@@ -1145,12 +1145,13 @@ package body Csets is\n          Identifier_Char (J) := (Fold_Upper (J) /= ' ');\n       end loop;\n \n-      --  Always add [ as an identifier character to deal with the brackets\n-      --  notation for wide characters used in identifiers. Note that if\n-      --  we are not allowing wide characters in identifiers, then any use\n-      --  of this notation will be flagged as an error in Scan_Identifier.\n+      --  Add [ as an identifier character to deal with the brackets notation\n+      --  for wide characters used in identifiers for versions up to Ada 2012.\n+      --  Note that if we are not allowing wide characters in identifiers, then\n+      --  any use of this notation will be flagged as an error in\n+      --  Scan_Identifier.\n \n-      Identifier_Char ('[') := True;\n+      Identifier_Char ('[') := Ada_Version < Ada_2022;\n \n       --  Add entry for ESC if wide characters in use with a wide character\n       --  encoding method active that uses the ESC code for encoding."}, {"sha": "ed377187f213acd7b577e00df550d4b370e0c4c3", "filename": "gcc/ada/libgnat/a-swmwco.ads", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a4892d2279066f5892a2b6a8c511689631d8f09/gcc%2Fada%2Flibgnat%2Fa-swmwco.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a4892d2279066f5892a2b6a8c511689631d8f09/gcc%2Fada%2Flibgnat%2Fa-swmwco.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flibgnat%2Fa-swmwco.ads?ref=7a4892d2279066f5892a2b6a8c511689631d8f09", "patch": "@@ -66,27 +66,27 @@ private\n    subtype WC is Wide_Character;\n \n    Control_Ranges           : aliased constant Wide_Character_Ranges :=\n-     [ (W.NUL, W.US),\n-       (W.DEL, W.APC)];\n+     [(W.NUL, W.US),\n+      (W.DEL, W.APC)];\n \n    Control_Set              : constant Wide_Character_Set :=\n      (AF.Controlled with\n       Control_Ranges'Unrestricted_Access);\n \n    Graphic_Ranges           : aliased constant Wide_Character_Ranges :=\n-     [ (W.Space,      W.Tilde),\n-       (WC'Val (256), WC'Last)];\n+     [(W.Space,      W.Tilde),\n+      (WC'Val (256), WC'Last)];\n \n    Graphic_Set              : constant Wide_Character_Set :=\n      (AF.Controlled with\n       Graphic_Ranges'Unrestricted_Access);\n \n    Letter_Ranges            : aliased constant Wide_Character_Ranges :=\n-     [ ('A',                   'Z'),\n-       (W.LC_A,                W.LC_Z),\n-       (W.UC_A_Grave,          W.UC_O_Diaeresis),\n-       (W.UC_O_Oblique_Stroke, W.LC_O_Diaeresis),\n-       (W.LC_O_Oblique_Stroke, W.LC_Y_Diaeresis)];\n+     [('A',                   'Z'),\n+      (W.LC_A,                W.LC_Z),\n+      (W.UC_A_Grave,          W.UC_O_Diaeresis),\n+      (W.UC_O_Oblique_Stroke, W.LC_O_Diaeresis),\n+      (W.LC_O_Oblique_Stroke, W.LC_Y_Diaeresis)];\n \n    Letter_Set               : constant Wide_Character_Set :=\n      (AF.Controlled with\n@@ -126,7 +126,7 @@ private\n       Basic_Ranges'Unrestricted_Access);\n \n    Decimal_Digit_Ranges     : aliased constant Wide_Character_Ranges :=\n-     [ ('0', '9')];\n+     [('0', '9')];\n \n    Decimal_Digit_Set        : constant Wide_Character_Set :=\n      (AF.Controlled with\n@@ -167,14 +167,14 @@ private\n       Special_Graphic_Ranges'Unrestricted_Access);\n \n    ISO_646_Ranges           : aliased constant Wide_Character_Ranges :=\n-     [ (W.NUL, W.DEL)];\n+     [(W.NUL, W.DEL)];\n \n    ISO_646_Set              : constant Wide_Character_Set :=\n      (AF.Controlled with\n       ISO_646_Ranges'Unrestricted_Access);\n \n    Character_Ranges         : aliased constant Wide_Character_Ranges :=\n-     [ (W.NUL, WC'Val (255))];\n+     [(W.NUL, WC'Val (255))];\n \n    Character_Set            : constant Wide_Character_Set :=\n      (AF.Controlled with"}, {"sha": "e8de549382fe93d2ad6777e8b15160fba7680111", "filename": "gcc/ada/libgnat/a-szmzco.ads", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a4892d2279066f5892a2b6a8c511689631d8f09/gcc%2Fada%2Flibgnat%2Fa-szmzco.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a4892d2279066f5892a2b6a8c511689631d8f09/gcc%2Fada%2Flibgnat%2Fa-szmzco.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flibgnat%2Fa-szmzco.ads?ref=7a4892d2279066f5892a2b6a8c511689631d8f09", "patch": "@@ -66,27 +66,27 @@ private\n    subtype WC is Wide_Wide_Character;\n \n    Control_Ranges           : aliased constant Wide_Wide_Character_Ranges :=\n-     [ (W.NUL, W.US),\n-       (W.DEL, W.APC)];\n+     [(W.NUL, W.US),\n+      (W.DEL, W.APC)];\n \n    Control_Set              : constant Wide_Wide_Character_Set :=\n      (AF.Controlled with\n       Control_Ranges'Unrestricted_Access);\n \n    Graphic_Ranges           : aliased constant Wide_Wide_Character_Ranges :=\n-     [ (W.Space,      W.Tilde),\n-       (WC'Val (256), WC'Last)];\n+     [(W.Space,      W.Tilde),\n+      (WC'Val (256), WC'Last)];\n \n    Graphic_Set              : constant Wide_Wide_Character_Set :=\n      (AF.Controlled with\n       Graphic_Ranges'Unrestricted_Access);\n \n    Letter_Ranges            : aliased constant Wide_Wide_Character_Ranges :=\n-     [ ('A',                  'Z'),\n-       (W.LC_A,                W.LC_Z),\n-       (W.UC_A_Grave,          W.UC_O_Diaeresis),\n-       (W.UC_O_Oblique_Stroke, W.LC_O_Diaeresis),\n-       (W.LC_O_Oblique_Stroke, W.LC_Y_Diaeresis)];\n+     [('A',                  'Z'),\n+      (W.LC_A,                W.LC_Z),\n+      (W.UC_A_Grave,          W.UC_O_Diaeresis),\n+      (W.UC_O_Oblique_Stroke, W.LC_O_Diaeresis),\n+      (W.LC_O_Oblique_Stroke, W.LC_Y_Diaeresis)];\n \n    Letter_Set               : constant Wide_Wide_Character_Set :=\n      (AF.Controlled with\n@@ -126,7 +126,7 @@ private\n       Basic_Ranges'Unrestricted_Access);\n \n    Decimal_Digit_Ranges     : aliased constant Wide_Wide_Character_Ranges :=\n-     [ ('0', '9')];\n+     [('0', '9')];\n \n    Decimal_Digit_Set        : constant Wide_Wide_Character_Set :=\n      (AF.Controlled with\n@@ -167,14 +167,14 @@ private\n       Special_Graphic_Ranges'Unrestricted_Access);\n \n    ISO_646_Ranges           : aliased constant Wide_Wide_Character_Ranges :=\n-     [ (W.NUL, W.DEL)];\n+     [(W.NUL, W.DEL)];\n \n    ISO_646_Set              : constant Wide_Wide_Character_Set :=\n      (AF.Controlled with\n       ISO_646_Ranges'Unrestricted_Access);\n \n    Character_Ranges         : aliased constant Wide_Wide_Character_Ranges :=\n-     [ (W.NUL, WC'Val (255))];\n+     [(W.NUL, WC'Val (255))];\n \n    Character_Set            : constant Wide_Wide_Character_Set :=\n      (AF.Controlled with"}, {"sha": "ae6b844052efff77db1a223dcde1ee48c5fc30ae", "filename": "gcc/ada/opt.adb", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a4892d2279066f5892a2b6a8c511689631d8f09/gcc%2Fada%2Fopt.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a4892d2279066f5892a2b6a8c511689631d8f09/gcc%2Fada%2Fopt.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fopt.adb?ref=7a4892d2279066f5892a2b6a8c511689631d8f09", "patch": "@@ -23,6 +23,8 @@\n --                                                                          --\n ------------------------------------------------------------------------------\n \n+with Csets;          use Csets;\n+\n package body Opt is\n \n    -------------------------\n@@ -210,6 +212,7 @@ package body Opt is\n          Prefix_Exception_Messages   := True;\n          Uneval_Old                  := 'E';\n          Use_VADS_Size               := False;\n+         Identifier_Char ('[')       := False;\n \n          --  Note: we do not need to worry about Warnings_As_Errors_Count since\n          --  we do not expect to get any warnings from compiling such a unit."}, {"sha": "cd10d1d4497aa17123f858ae7c29bd4a202cd442", "filename": "gcc/ada/scng.adb", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a4892d2279066f5892a2b6a8c511689631d8f09/gcc%2Fada%2Fscng.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a4892d2279066f5892a2b6a8c511689631d8f09/gcc%2Fada%2Fscng.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fscng.adb?ref=7a4892d2279066f5892a2b6a8c511689631d8f09", "patch": "@@ -1421,7 +1421,7 @@ package body Scng is\n             Token := Tok_Left_Paren;\n \n             if Style_Check then\n-               Style.Check_Left_Paren;\n+               Style.Check_Left_Paren_Square_Bracket;\n             end if;\n \n             return;\n@@ -1437,6 +1437,11 @@ package body Scng is\n             if Ada_Version >= Ada_2022 then\n                Scan_Ptr := Scan_Ptr + 1;\n                Token := Tok_Left_Bracket;\n+\n+               if Style_Check then\n+                  Style.Check_Left_Paren_Square_Bracket;\n+               end if;\n+\n                return;\n \n             elsif Source (Scan_Ptr + 1) = '\"' then"}, {"sha": "209dff851ee7487b11a93bb6db0c2bef8d767250", "filename": "gcc/ada/style.ads", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a4892d2279066f5892a2b6a8c511689631d8f09/gcc%2Fada%2Fstyle.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a4892d2279066f5892a2b6a8c511689631d8f09/gcc%2Fada%2Fstyle.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fstyle.ads?ref=7a4892d2279066f5892a2b6a8c511689631d8f09", "patch": "@@ -147,9 +147,10 @@ package Style is\n    --  is that the starting column is appropriate to the indentation rules if\n    --  Token_Ptr is the first token on the line.\n \n-   procedure Check_Left_Paren\n-     renames Style_Inst.Check_Left_Paren;\n-   --  Called after scanning out a left parenthesis to check spacing\n+   procedure Check_Left_Paren_Square_Bracket\n+     renames Style_Inst.Check_Left_Paren_Square_Bracket;\n+   --  Called after scanning out a left parenthesis to check spacing. If\n+   --  Ada_Version >= Ada_2022 then called similarly for a left square bracket.\n \n    procedure Check_Line_Terminator (Len : Int)\n      renames Style_Inst.Check_Line_Terminator;"}, {"sha": "6a785b5835aadbd566ac985d5560ff9be25c35f2", "filename": "gcc/ada/styleg.adb", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a4892d2279066f5892a2b6a8c511689631d8f09/gcc%2Fada%2Fstyleg.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a4892d2279066f5892a2b6a8c511689631d8f09/gcc%2Fada%2Fstyleg.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fstyleg.adb?ref=7a4892d2279066f5892a2b6a8c511689631d8f09", "patch": "@@ -721,15 +721,16 @@ package body Styleg is\n       end if;\n    end Check_Indentation;\n \n-   ----------------------\n-   -- Check_Left_Paren --\n-   ----------------------\n+   -------------------------------------\n+   -- Check_Left_Paren_Square_Bracket --\n+   -------------------------------------\n \n    --  In check token mode (-gnatyt), left paren must not be preceded by an\n    --  identifier character or digit (a separating space is required) and may\n    --  never be followed by a space.\n+   --  Same applies for the left square bracket starting from Ada version 2022.\n \n-   procedure Check_Left_Paren is\n+   procedure Check_Left_Paren_Square_Bracket is\n    begin\n       if Style_Check_Tokens then\n          if Token_Ptr > Source_First (Current_Source_File)\n@@ -740,7 +741,7 @@ package body Styleg is\n \n          Check_No_Space_After;\n       end if;\n-   end Check_Left_Paren;\n+   end Check_Left_Paren_Square_Bracket;\n \n    ---------------------------\n    -- Check_Line_Max_Length --"}, {"sha": "23a1ee4b86ff3f1a5e8150d766a45ab9bac64f77", "filename": "gcc/ada/styleg.ads", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a4892d2279066f5892a2b6a8c511689631d8f09/gcc%2Fada%2Fstyleg.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a4892d2279066f5892a2b6a8c511689631d8f09/gcc%2Fada%2Fstyleg.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fstyleg.ads?ref=7a4892d2279066f5892a2b6a8c511689631d8f09", "patch": "@@ -111,8 +111,9 @@ package Styleg is\n    --  is that the starting column is appropriate to the indentation rules if\n    --  Token_Ptr is the first token on the line.\n \n-   procedure Check_Left_Paren;\n-   --  Called after scanning out a left parenthesis to check spacing\n+   procedure Check_Left_Paren_Square_Bracket;\n+   --  Called after scanning out a left parenthesis to check spacing. If\n+   --  Ada_Version >= Ada_2022 then called similarly for a left square bracket.\n \n    procedure Check_Line_Max_Length (Len : Nat);\n    --  Called with Scan_Ptr pointing to the first line terminator character"}]}