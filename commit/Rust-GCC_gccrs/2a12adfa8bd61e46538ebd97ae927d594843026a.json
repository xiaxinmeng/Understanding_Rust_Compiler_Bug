{"sha": "2a12adfa8bd61e46538ebd97ae927d594843026a", "node_id": "C_kwDOANBUbNoAKDJhMTJhZGZhOGJkNjFlNDY1MzhlYmQ5N2FlOTI3ZDU5NDg0MzAyNmE", "commit": {"author": {"name": "Roger Sayle", "email": "roger@nextmovesoftware.com", "date": "2022-05-30T20:23:15Z"}, "committer": {"name": "Roger Sayle", "email": "roger@nextmovesoftware.com", "date": "2022-05-30T20:23:15Z"}, "message": "Make the default rtx_costs of MULT/DIV variants consistent.\n\nGCC's middle-end provides a default cost model for RTL expressions, for\nbackends that don't specify their own instruction timings, that can be\nsummarized as multiplications are COSTS_N_INSNS(4), divisions are\nCOSTS_N_INSNS(7) and all other operations are COSTS_N_INSNS(1).\nThis patch tweaks the above definition so that fused-multiply-add\n(FMA) and high-part multiplications cost the same as regular multiplications,\nor more importantly aren't (by default) considered less expensive.  Likewise\nthe saturating forms of multiplication and division cost the same as the\nregular variants.  These values can always be changed by the target, but\nthe goal is to avoid RTL expansion substituting a suitable operation with\nits saturating equivalent because it (accidentally) looks much cheaper.\nFor example, PR 89845 is about implementing division/modulus via highpart\nmultiply, which may accidentally look extremely cheap.\n\n2022-05-30  Roger Sayle  <roger@nextmovesoftware.com>\n\ngcc/ChangeLog\n\t* rtlanal.cc (rtx_cost) <MULT>: Treat FMA, SS_MULT, US_MULT,\n\tSMUL_HIGHPART and UMUL_HIGHPART as having the same cost as MULT.\n\t<DIV>: Likewise, SS_DIV and US_DIV have the same default as DIV.", "tree": {"sha": "2c993ead0156141eefd817d4eef5706613e66705", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2c993ead0156141eefd817d4eef5706613e66705"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2a12adfa8bd61e46538ebd97ae927d594843026a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a12adfa8bd61e46538ebd97ae927d594843026a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2a12adfa8bd61e46538ebd97ae927d594843026a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a12adfa8bd61e46538ebd97ae927d594843026a/comments", "author": {"login": "rogersayle", "id": 13512313, "node_id": "MDQ6VXNlcjEzNTEyMzEz", "avatar_url": "https://avatars.githubusercontent.com/u/13512313?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rogersayle", "html_url": "https://github.com/rogersayle", "followers_url": "https://api.github.com/users/rogersayle/followers", "following_url": "https://api.github.com/users/rogersayle/following{/other_user}", "gists_url": "https://api.github.com/users/rogersayle/gists{/gist_id}", "starred_url": "https://api.github.com/users/rogersayle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rogersayle/subscriptions", "organizations_url": "https://api.github.com/users/rogersayle/orgs", "repos_url": "https://api.github.com/users/rogersayle/repos", "events_url": "https://api.github.com/users/rogersayle/events{/privacy}", "received_events_url": "https://api.github.com/users/rogersayle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rogersayle", "id": 13512313, "node_id": "MDQ6VXNlcjEzNTEyMzEz", "avatar_url": "https://avatars.githubusercontent.com/u/13512313?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rogersayle", "html_url": "https://github.com/rogersayle", "followers_url": "https://api.github.com/users/rogersayle/followers", "following_url": "https://api.github.com/users/rogersayle/following{/other_user}", "gists_url": "https://api.github.com/users/rogersayle/gists{/gist_id}", "starred_url": "https://api.github.com/users/rogersayle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rogersayle/subscriptions", "organizations_url": "https://api.github.com/users/rogersayle/orgs", "repos_url": "https://api.github.com/users/rogersayle/repos", "events_url": "https://api.github.com/users/rogersayle/events{/privacy}", "received_events_url": "https://api.github.com/users/rogersayle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "43201f2c2173894bf7c423cad6da1c21567e06c0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/43201f2c2173894bf7c423cad6da1c21567e06c0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/43201f2c2173894bf7c423cad6da1c21567e06c0"}], "stats": {"total": 7, "additions": 7, "deletions": 0}, "files": [{"sha": "d78cc6024007c0df438c4620c0424419c0b33ba7", "filename": "gcc/rtlanal.cc", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a12adfa8bd61e46538ebd97ae927d594843026a/gcc%2Frtlanal.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a12adfa8bd61e46538ebd97ae927d594843026a/gcc%2Frtlanal.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frtlanal.cc?ref=2a12adfa8bd61e46538ebd97ae927d594843026a", "patch": "@@ -4578,6 +4578,11 @@ rtx_cost (rtx x, machine_mode mode, enum rtx_code outer_code,\n   switch (code)\n     {\n     case MULT:\n+    case FMA:\n+    case SS_MULT:\n+    case US_MULT:\n+    case SMUL_HIGHPART:\n+    case UMUL_HIGHPART:\n       /* Multiplication has time-complexity O(N*N), where N is the\n \t number of units (translated from digits) when using\n \t schoolbook long multiplication.  */\n@@ -4587,6 +4592,8 @@ rtx_cost (rtx x, machine_mode mode, enum rtx_code outer_code,\n     case UDIV:\n     case MOD:\n     case UMOD:\n+    case SS_DIV:\n+    case US_DIV:\n       /* Similarly, complexity for schoolbook long division.  */\n       total = factor * factor * COSTS_N_INSNS (7);\n       break;"}]}