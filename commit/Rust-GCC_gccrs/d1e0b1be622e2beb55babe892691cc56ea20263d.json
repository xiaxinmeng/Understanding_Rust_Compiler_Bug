{"sha": "d1e0b1be622e2beb55babe892691cc56ea20263d", "node_id": "C_kwDOANBUbNoAKGQxZTBiMWJlNjIyZTJiZWI1NWJhYmU4OTI2OTFjYzU2ZWEyMDI2M2Q", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2021-12-03T12:38:08Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2022-01-07T16:24:11Z"}, "message": "[Ada] Remove repeated routines for printing AST in Mixed_Case\n\ngcc/ada/\n\n\t* osint.adb (To_Lower): Clarify that only To_Lower function\n\tcauses bootstrap issues; fix style.\n\t* treepr.adb (Print_Str_Mixed_Case): Reuse existing case\n\tconversion routine.\n\t(To_Mixed): Rename from Capitalize; reuse System.Case_Util\n\tprocedure and explain the bootstrap issue.", "tree": {"sha": "1bf25037f47d5de1bea3c2f0c5d4a0d40f5dbdaa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1bf25037f47d5de1bea3c2f0c5d4a0d40f5dbdaa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d1e0b1be622e2beb55babe892691cc56ea20263d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1e0b1be622e2beb55babe892691cc56ea20263d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d1e0b1be622e2beb55babe892691cc56ea20263d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1e0b1be622e2beb55babe892691cc56ea20263d/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c31cbf91a0e2740cb317a4339a62cebd1d633475", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c31cbf91a0e2740cb317a4339a62cebd1d633475", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c31cbf91a0e2740cb317a4339a62cebd1d633475"}], "stats": {"total": 71, "additions": 21, "deletions": 50}, "files": [{"sha": "5e4f3fc96e42ba00fce09853a141b69472b27712", "filename": "gcc/ada/osint.adb", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1e0b1be622e2beb55babe892691cc56ea20263d/gcc%2Fada%2Fosint.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1e0b1be622e2beb55babe892691cc56ea20263d/gcc%2Fada%2Fosint.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fosint.adb?ref=d1e0b1be622e2beb55babe892691cc56ea20263d", "patch": "@@ -1061,7 +1061,8 @@ package body Osint is\n    function File_Names_Equal (File1, File2 : String) return Boolean is\n \n       function To_Lower (A : String) return String;\n-      --  For bootstrap reasons, we cannot use To_Lower from System.Case_Util\n+      --  For bootstrap reasons, we cannot use To_Lower function from\n+      --  System.Case_Util.\n \n       --------------\n       -- To_Lower --\n@@ -1074,6 +1075,8 @@ package body Osint is\n          return Result;\n       end To_Lower;\n \n+   --  Start of processing for File_Names_Equal\n+\n    begin\n       if File_Names_Case_Sensitive then\n          return File1 = File2;"}, {"sha": "166667c474c0a8170ac162b5068f824430cacc67", "filename": "gcc/ada/treepr.adb", "status": "modified", "additions": 17, "deletions": 49, "changes": 66, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1e0b1be622e2beb55babe892691cc56ea20263d/gcc%2Fada%2Ftreepr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1e0b1be622e2beb55babe892691cc56ea20263d/gcc%2Fada%2Ftreepr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ftreepr.adb?ref=d1e0b1be622e2beb55babe892691cc56ea20263d", "patch": "@@ -25,7 +25,6 @@\n \n with Aspects;              use Aspects;\n with Atree;                use Atree;\n-with Csets;                use Csets;\n with Debug;                use Debug;\n with Einfo;                use Einfo;\n with Einfo.Entities;       use Einfo.Entities;\n@@ -45,6 +44,7 @@ with Snames;               use Snames;\n with Sinput;               use Sinput;\n with Stand;                use Stand;\n with Stringt;              use Stringt;\n+with System.Case_Util;     use System.Case_Util;\n with SCIL_LL;              use SCIL_LL;\n with Uintp;                use Uintp;\n with Urealp;               use Urealp;\n@@ -135,9 +135,9 @@ package body Treepr is\n    function From_Union is new Unchecked_Conversion (Union_Id, Uint);\n    function From_Union is new Unchecked_Conversion (Union_Id, Ureal);\n \n-   function Capitalize (S : String) return String;\n-   procedure Capitalize (S : in out String);\n-   --  Turns an identifier into Mixed_Case\n+   function To_Mixed (S : String) return String;\n+   --  Turns an identifier into Mixed_Case. For bootstrap reasons, we cannot\n+   --  use To_Mixed function from System.Case_Util.\n \n    function Image (F : Node_Or_Entity_Field) return String;\n \n@@ -255,35 +255,6 @@ package body Treepr is\n    --  descendants are to be printed. Prefix_Str is to be added to all\n    --  printed lines.\n \n-   ----------------\n-   -- Capitalize --\n-   ----------------\n-\n-   procedure Capitalize (S : in out String) is\n-      Cap : Boolean := True;\n-   begin\n-      for J in S'Range loop\n-         declare\n-            Old : constant Character := S (J);\n-         begin\n-            if Cap then\n-               S (J) := Fold_Upper (S (J));\n-            else\n-               S (J) := Fold_Lower (S (J));\n-            end if;\n-\n-            Cap := Old = '_';\n-         end;\n-      end loop;\n-   end Capitalize;\n-\n-   function Capitalize (S : String) return String is\n-   begin\n-      return Result : String (S'Range) := S do\n-         Capitalize (Result);\n-      end return;\n-   end Capitalize;\n-\n    ----------\n    -- Hash --\n    ----------\n@@ -400,7 +371,7 @@ package body Treepr is\n \n          when others =>\n             declare\n-               Result : constant String := Capitalize (F'Img);\n+               Result : constant String := To_Mixed (F'Img);\n             begin\n                return Result (3 .. Result'Last); -- Remove \"F_\"\n             end;\n@@ -1713,22 +1684,8 @@ package body Treepr is\n    --------------------------\n \n    procedure Print_Str_Mixed_Case (S : String) is\n-      Ucase : Boolean;\n-\n    begin\n-      if Phase = Printing then\n-         Ucase := True;\n-\n-         for J in S'Range loop\n-            if Ucase then\n-               Write_Char (S (J));\n-            else\n-               Write_Char (Fold_Lower (S (J)));\n-            end if;\n-\n-            Ucase := (S (J) = '_');\n-         end loop;\n-      end if;\n+      Print_Str (To_Mixed (S));\n    end Print_Str_Mixed_Case;\n \n    ----------------\n@@ -1862,6 +1819,17 @@ package body Treepr is\n       Next_Serial_Number := Next_Serial_Number + 1;\n    end Set_Serial_Number;\n \n+   --------------\n+   -- To_Mixed --\n+   --------------\n+\n+   function To_Mixed (S : String) return String is\n+   begin\n+      return Result : String (S'Range) := S do\n+         To_Mixed (Result);\n+      end return;\n+   end To_Mixed;\n+\n    ---------------\n    -- Tree_Dump --\n    ---------------"}]}