{"sha": "8a49324e8a22e47e38656d0a7e2073af186204d6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGE0OTMyNGU4YTIyZTQ3ZTM4NjU2ZDBhN2UyMDczYWYxODYyMDRkNg==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2018-05-21T12:52:44Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2018-05-21T12:52:44Z"}, "message": "Fix std::filesystem::absolute for empty paths\n\n\t* src/filesystem/std-ops.cc (absolute): Report an error for empty\n\tpaths.\n\t(weakly_canonical(const path&)): Do not call canonical on empty path.\n\t(weakly_canonical(const path&, error_code&)): Likewise.\n\t* testsuite/27_io/filesystem/operations/absolute.cc: Check for errors.\n\nFrom-SVN: r260441", "tree": {"sha": "5068c314d6c6bfe307c4e16a72b4cbdbd9b4f026", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5068c314d6c6bfe307c4e16a72b4cbdbd9b4f026"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8a49324e8a22e47e38656d0a7e2073af186204d6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a49324e8a22e47e38656d0a7e2073af186204d6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8a49324e8a22e47e38656d0a7e2073af186204d6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a49324e8a22e47e38656d0a7e2073af186204d6/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cc343938cbb65881f9a6e3bc019aeff6c5a38137", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc343938cbb65881f9a6e3bc019aeff6c5a38137", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cc343938cbb65881f9a6e3bc019aeff6c5a38137"}], "stats": {"total": 28, "additions": 23, "deletions": 5}, "files": [{"sha": "78f5df691d8ebf2d1eefd895281d6ba7ac9c2889", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a49324e8a22e47e38656d0a7e2073af186204d6/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a49324e8a22e47e38656d0a7e2073af186204d6/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=8a49324e8a22e47e38656d0a7e2073af186204d6", "patch": "@@ -1,5 +1,11 @@\n 2018-05-21  Jonathan Wakely  <jwakely@redhat.com>\n \n+\t* src/filesystem/std-ops.cc (absolute): Report an error for empty\n+\tpaths.\n+\t(weakly_canonical(const path&)): Do not call canonical on empty path.\n+\t(weakly_canonical(const path&, error_code&)): Likewise.\n+\t* testsuite/27_io/filesystem/operations/absolute.cc: Check for errors.\n+\n \tPR libstdc++/85818\n \t* testsuite/experimental/filesystem/path/preferred_separator.cc: Add\n \tdg-require-filesystem-ts."}, {"sha": "00e4f987fc3a7c659671fa650dd3c43a3476725a", "filename": "libstdc++-v3/src/filesystem/std-ops.cc", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a49324e8a22e47e38656d0a7e2073af186204d6/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fstd-ops.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a49324e8a22e47e38656d0a7e2073af186204d6/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fstd-ops.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fstd-ops.cc?ref=8a49324e8a22e47e38656d0a7e2073af186204d6", "patch": "@@ -84,13 +84,20 @@ fs::absolute(const path& p)\n fs::path\n fs::absolute(const path& p, error_code& ec)\n {\n+  path ret;\n+  if (p.empty())\n+    {\n+      ec = make_error_code(std::errc::no_such_file_or_directory);\n+      return ret;\n+    }\n #ifdef _GLIBCXX_FILESYSTEM_IS_WINDOWS\n   ec = std::make_error_code(errc::not_supported);\n-  return {};\n #else\n   ec.clear();\n-  return current_path() / p;\n+  ret = current_path();\n+  ret /= p;\n #endif\n+  return ret;\n }\n \n namespace\n@@ -1513,7 +1520,8 @@ fs::weakly_canonical(const path& p)\n       ++iter;\n     }\n   // canonicalize:\n-  result = canonical(result);\n+  if (!result.empty())\n+    result = canonical(result);\n   // append the non-existing elements:\n   while (iter != end)\n     result /= *iter++;\n@@ -1551,7 +1559,7 @@ fs::weakly_canonical(const path& p, error_code& ec)\n       ++iter;\n     }\n   // canonicalize:\n-  if (!ec)\n+  if (!ec && !result.empty())\n     result = canonical(result, ec);\n   if (ec)\n     result.clear();"}, {"sha": "413a86758f083eada786a9462bb53b333bcc681c", "filename": "libstdc++-v3/testsuite/27_io/filesystem/operations/absolute.cc", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a49324e8a22e47e38656d0a7e2073af186204d6/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Foperations%2Fabsolute.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a49324e8a22e47e38656d0a7e2073af186204d6/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Foperations%2Fabsolute.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Foperations%2Fabsolute.cc?ref=8a49324e8a22e47e38656d0a7e2073af186204d6", "patch": "@@ -31,7 +31,11 @@ void\n test01()\n {\n   for (const path& p : __gnu_test::test_paths)\n-    VERIFY( absolute(p).is_absolute() );\n+  {\n+    std::error_code ec;\n+    path abs = absolute(p, ec);\n+    VERIFY( ec || abs.is_absolute() );\n+  }\n }\n \n void"}]}