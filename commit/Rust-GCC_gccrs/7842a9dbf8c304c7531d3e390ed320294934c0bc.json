{"sha": "7842a9dbf8c304c7531d3e390ed320294934c0bc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Nzg0MmE5ZGJmOGMzMDRjNzUzMWQzZTM5MGVkMzIwMjk0OTM0YzBiYw==", "commit": {"author": {"name": "Dodji Seketeli", "email": "dodji@redhat.com", "date": "2009-08-27T07:05:24Z"}, "committer": {"name": "Dodji Seketeli", "email": "dodji@gcc.gnu.org", "date": "2009-08-27T07:05:24Z"}, "message": "re PR debug/41170 (namespace DIE not generated when it contains only a typedef)\n\nFix for PR debug/41170\n\ngcc/ChangeLog:\n\tPR debug/41770\n\t* dwarf2out.c (get_context_die): Declare this static function.\n\t(gen_type_die_with_usage): Make sure a DIE is a generated for\n\tthe context of a typedef.\n\ngcc/testsuite/ChangeLog:\n\tPR debug/41770\n\t* debug/dwarf2/namespace-1.C: New test.\n\nFrom-SVN: r151138", "tree": {"sha": "64a74d89344e23c148800c250e8ad2dd351db5da", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/64a74d89344e23c148800c250e8ad2dd351db5da"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7842a9dbf8c304c7531d3e390ed320294934c0bc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7842a9dbf8c304c7531d3e390ed320294934c0bc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7842a9dbf8c304c7531d3e390ed320294934c0bc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7842a9dbf8c304c7531d3e390ed320294934c0bc/comments", "author": null, "committer": null, "parents": [{"sha": "3d1be5be4ce82b9382952a902e3d3f2e530126f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d1be5be4ce82b9382952a902e3d3f2e530126f1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d1be5be4ce82b9382952a902e3d3f2e530126f1"}], "stats": {"total": 45, "additions": 44, "deletions": 1}, "files": [{"sha": "95800ceddcdaa76ea4d799dde7835eba1ade7a88", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7842a9dbf8c304c7531d3e390ed320294934c0bc/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7842a9dbf8c304c7531d3e390ed320294934c0bc/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7842a9dbf8c304c7531d3e390ed320294934c0bc", "patch": "@@ -1,3 +1,10 @@\n+2009-08-27  Dodji Seketeli  <dodji@redhat.com>\n+\n+\tPR debug/41770\n+\t* dwarf2out.c (get_context_die): Declare this static function.\n+\t(gen_type_die_with_usage): Make sure a DIE is a generated for\n+\tthe context of a typedef.\n+\n 2009-08-26  Anatoly Sokolov  <aesok@post.ru>\n \n \t* doc/invoke.texi (AVR Options): Remove documentation of -minit-stack"}, {"sha": "ad956f83324b8919b6b8a2bef2dc93ac47e45a58", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7842a9dbf8c304c7531d3e390ed320294934c0bc/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7842a9dbf8c304c7531d3e390ed320294934c0bc/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=7842a9dbf8c304c7531d3e390ed320294934c0bc", "patch": "@@ -5887,6 +5887,7 @@ static void gen_type_die (tree, dw_die_ref);\n static void gen_block_die (tree, dw_die_ref, int);\n static void decls_for_scope (tree, dw_die_ref, int);\n static int is_redundant_typedef (const_tree);\n+static inline dw_die_ref get_context_die (tree);\n static void gen_namespace_die (tree, dw_die_ref);\n static void gen_decl_die (tree, tree, dw_die_ref);\n static dw_die_ref force_decl_die (tree);\n@@ -15436,7 +15437,7 @@ gen_type_die_with_usage (tree type, dw_die_ref context_die,\n          the type description DIE we want to generate.  */\n       if (DECL_CONTEXT (TYPE_NAME (type))\n \t  && TREE_CODE (DECL_CONTEXT (TYPE_NAME (type))) == NAMESPACE_DECL)\n-\tcontext_die = lookup_decl_die (DECL_CONTEXT (TYPE_NAME (type)));\n+\tcontext_die = get_context_die (DECL_CONTEXT (TYPE_NAME (type)));\n \n       TREE_ASM_WRITTEN (type) = 1;\n       gen_decl_die (TYPE_NAME (type), NULL, context_die);"}, {"sha": "8448541c76bd7f73df97f7378ec4775a4732be68", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7842a9dbf8c304c7531d3e390ed320294934c0bc/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7842a9dbf8c304c7531d3e390ed320294934c0bc/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7842a9dbf8c304c7531d3e390ed320294934c0bc", "patch": "@@ -1,3 +1,8 @@\n+2009-08-27  Dodji Seketeli  <dodji@redhat.com>\n+\n+\tPR debug/41770\n+\t* debug/dwarf2/namespace-1.C: New test.\n+\n 2009-08-26  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR fortran/41162"}, {"sha": "aad89ba5c3037132702ba4e739f1d5c579510877", "filename": "gcc/testsuite/g++.dg/debug/dwarf2/namespace-1.C", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7842a9dbf8c304c7531d3e390ed320294934c0bc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fnamespace-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7842a9dbf8c304c7531d3e390ed320294934c0bc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fnamespace-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fnamespace-1.C?ref=7842a9dbf8c304c7531d3e390ed320294934c0bc", "patch": "@@ -0,0 +1,30 @@\n+// Contributed by Dodji Seketeli <dodji@redhat.com>\n+// Origin PR debug/41170\n+// { dg-options \"-g -dA\" }\n+//\n+// We want to test that there is a DW_TAG_namespace DIE DW_AT_name is set\n+// to \"not_emitted\". That namespace die has a child DW_TAG_typedef DIE\n+// which DW_AT_name is the null terminated string \"T\".\n+// { dg-final { scan-assembler-times \"DIE +\\\\(.*?\\\\) DW_TAG_namespace\" 1 } }\n+// { dg-final { scan-assembler-times \"DW_AT_name: \\\"not_emitted\\\"\" 1 } }\n+// { dg-final { scan-assembler-times \"DIE +\\\\(.*?\\\\) DW_TAG_typedef\" 1 } }\n+// { dg-final { scan-assembler-times \"\\.ascii \\\"T.0\\\"\\[\\t \\]+# DW_AT_name\" 1 } }\n+\n+struct strukt\n+{\n+  int m;\n+};\n+\n+namespace not_emitted\n+{\n+  typedef strukt T;\n+}\n+\n+int\n+main()\n+{\n+  not_emitted::T t;\n+  t.m = 0;\n+  return 0;\n+}\n+"}]}