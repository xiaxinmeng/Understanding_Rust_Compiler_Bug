{"sha": "e17fa93eca7611415368af47d6e4dd2796c8fd7b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTE3ZmE5M2VjYTc2MTE0MTUzNjhhZjQ3ZDZlNGRkMjc5NmM4ZmQ3Yg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2019-01-11T19:04:32Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-01-11T19:04:32Z"}, "message": "re PR tree-optimization/88693 (Wrong code since r263018)\n\n\tPR tree-optimization/88693\n\t* tree-ssa-strlen.c (get_min_string_length): Don't set *full_string_p\n\tfor STRING_CSTs that don't contain any NUL characters in the first\n\tTREE_STRING_LENGTH bytes.\n\n\t* gcc.c-torture/execute/pr88693.c: New test.\n\nFrom-SVN: r267852", "tree": {"sha": "e9be5dbe9676ad05dd0f5d1a798704ef081424ea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e9be5dbe9676ad05dd0f5d1a798704ef081424ea"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e17fa93eca7611415368af47d6e4dd2796c8fd7b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e17fa93eca7611415368af47d6e4dd2796c8fd7b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e17fa93eca7611415368af47d6e4dd2796c8fd7b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e17fa93eca7611415368af47d6e4dd2796c8fd7b/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0f64d96d93ce2fb7b7e5cd174c17e903f66c4a1e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f64d96d93ce2fb7b7e5cd174c17e903f66c4a1e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0f64d96d93ce2fb7b7e5cd174c17e903f66c4a1e"}], "stats": {"total": 71, "additions": 69, "deletions": 2}, "files": [{"sha": "bca96c04ac81479f1b4927960d3659fbc04d38b3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e17fa93eca7611415368af47d6e4dd2796c8fd7b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e17fa93eca7611415368af47d6e4dd2796c8fd7b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e17fa93eca7611415368af47d6e4dd2796c8fd7b", "patch": "@@ -1,3 +1,10 @@\n+2019-01-11  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/88693\n+\t* tree-ssa-strlen.c (get_min_string_length): Don't set *full_string_p\n+\tfor STRING_CSTs that don't contain any NUL characters in the first\n+\tTREE_STRING_LENGTH bytes.\n+\n 2019-01-11  Alan Modra  <amodra@gmail.com>\n \n \tPR 88777"}, {"sha": "3b1de48f99020f07b1ba7b62350e149d229cd728", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e17fa93eca7611415368af47d6e4dd2796c8fd7b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e17fa93eca7611415368af47d6e4dd2796c8fd7b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e17fa93eca7611415368af47d6e4dd2796c8fd7b", "patch": "@@ -1,3 +1,8 @@\n+2019-01-11  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/88693\n+\t* gcc.c-torture/execute/pr88693.c: New test.\n+\n 2019-01-11  Tamar Christina  <tamar.christina@arm.com>\n \n \t* gcc.target/aarch64/advsimd-intrinsics/vector-complex_f16.c: Require neon"}, {"sha": "7e78aea50f5763c36c97d1097b1f0a4800daa7f3", "filename": "gcc/testsuite/gcc.c-torture/execute/pr88693.c", "status": "added", "additions": 54, "deletions": 0, "changes": 54, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e17fa93eca7611415368af47d6e4dd2796c8fd7b/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr88693.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e17fa93eca7611415368af47d6e4dd2796c8fd7b/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr88693.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr88693.c?ref=e17fa93eca7611415368af47d6e4dd2796c8fd7b", "patch": "@@ -0,0 +1,54 @@\n+/* PR tree-optimization/88693 */\n+\n+__attribute__((noipa)) void\n+foo (char *p)\n+{\n+  if (__builtin_strlen (p) != 9)\n+    __builtin_abort ();\n+}\n+\n+__attribute__((noipa)) void\n+quux (char *p)\n+{\n+  int i;\n+  for (i = 0; i < 100; i++)\n+    if (p[i] != 'x')\n+      __builtin_abort ();\n+}\n+\n+__attribute__((noipa)) void\n+qux (void)\n+{\n+  char b[100];\n+  __builtin_memset (b, 'x', sizeof (b));\n+  quux (b);\n+}\n+\n+__attribute__((noipa)) void\n+bar (void)\n+{\n+  static unsigned char u[9] = \"abcdefghi\";\n+  char b[100];\n+  __builtin_memcpy (b, u, sizeof (u));\n+  b[sizeof (u)] = 0;\n+  foo (b);\n+}\n+\n+__attribute__((noipa)) void\n+baz (void)\n+{\n+  static unsigned char u[] = { 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r' };\n+  char b[100];\n+  __builtin_memcpy (b, u, sizeof (u));\n+  b[sizeof (u)] = 0;\n+  foo (b);\n+}\n+\n+int\n+main ()\n+{\n+  qux ();\n+  bar ();\n+  baz ();\n+  return 0;\n+}"}, {"sha": "02ed1b4c77783ed969a9a0e9eabc88e659b356f6", "filename": "gcc/tree-ssa-strlen.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e17fa93eca7611415368af47d6e4dd2796c8fd7b/gcc%2Ftree-ssa-strlen.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e17fa93eca7611415368af47d6e4dd2796c8fd7b/gcc%2Ftree-ssa-strlen.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-strlen.c?ref=e17fa93eca7611415368af47d6e4dd2796c8fd7b", "patch": "@@ -3232,8 +3232,9 @@ get_min_string_length (tree rhs, bool *full_string_p)\n \n   if (rhs && TREE_CODE (rhs) == STRING_CST)\n     {\n-      *full_string_p = true;\n-      return strlen (TREE_STRING_POINTER (rhs));\n+      HOST_WIDE_INT len = strlen (TREE_STRING_POINTER (rhs));\n+      *full_string_p = len < TREE_STRING_LENGTH (rhs);\n+      return len;\n     }\n \n   return -1;"}]}