{"sha": "39ecc4b530b5898afe646f82ec3a7bdbf2063afe", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzllY2M0YjUzMGI1ODk4YWZlNjQ2ZjgyZWMzYTdiZGJmMjA2M2FmZQ==", "commit": {"author": {"name": "Hans-Peter Nilsson", "email": "hp@gcc.gnu.org", "date": "2007-12-15T21:37:37Z"}, "committer": {"name": "Hans-Peter Nilsson", "email": "hp@gcc.gnu.org", "date": "2007-12-15T21:37:37Z"}, "message": "linux.h: Sanity-check TARGET_CPU_DEFAULT for presence and contents.\n\n\t* config/cris/linux.h: Sanity-check TARGET_CPU_DEFAULT for\n\tpresence and contents.\n\t(CRIS_SUBTARGET_DEFAULT_ARCH): New macro, MASK_AVOID_GOTPLT for\n\tv32, 0 otherwise.\n\t(CRIS_CPP_SUBTARGET_SPEC, CRIS_CC1_SUBTARGET_SPEC,\n\tCRIS_ASM_SUBTARGET_SPEC): Adjust for different\n\tTARGET_CPU_DEFAULT.\n\t(CRIS_SUBTARGET_DEFAULT): Add CRIS_SUBTARGET_DEFAULT_ARCH.\n\nFrom-SVN: r130969", "tree": {"sha": "51ab2c3ccf533c165af95d70ccf68877dc842904", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/51ab2c3ccf533c165af95d70ccf68877dc842904"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/39ecc4b530b5898afe646f82ec3a7bdbf2063afe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39ecc4b530b5898afe646f82ec3a7bdbf2063afe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/39ecc4b530b5898afe646f82ec3a7bdbf2063afe", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39ecc4b530b5898afe646f82ec3a7bdbf2063afe/comments", "author": null, "committer": null, "parents": [{"sha": "3261b8c4f84710c62ae8ffc23e29275c6310b401", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3261b8c4f84710c62ae8ffc23e29275c6310b401", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3261b8c4f84710c62ae8ffc23e29275c6310b401"}], "stats": {"total": 40, "additions": 35, "deletions": 5}, "files": [{"sha": "0d0b7f4a7e7d578f2d54ff18cb8e1afca1f7586d", "filename": "gcc/config/cris/linux.h", "status": "modified", "additions": 35, "deletions": 5, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39ecc4b530b5898afe646f82ec3a7bdbf2063afe/gcc%2Fconfig%2Fcris%2Flinux.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39ecc4b530b5898afe646f82ec3a7bdbf2063afe/gcc%2Fconfig%2Fcris%2Flinux.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fcris%2Flinux.h?ref=39ecc4b530b5898afe646f82ec3a7bdbf2063afe", "patch": "@@ -35,6 +35,13 @@ along with GCC; see the file COPYING3.  If not see\n /* This file defines the macros for cris-axis-linux-gnu that are not\n    covered by cris.h, elfos.h and (config/)linux.h.  */\n \n+/* Make sure we have a valid TARGET_CPU_DEFAULT, so we can assume it\n+   and take shortcuts below.  */\n+#ifndef TARGET_CPU_DEFAULT\n+#error \"TARGET_CPU_DEFAULT not defined\"\n+#elif (TARGET_CPU_DEFAULT+0) != 10 && (TARGET_CPU_DEFAULT+0) != 32\n+#error \"TARGET_CPU_DEFAULT must be 10 or 32, or this file be updated\"\n+#endif\n \n /* Node: Instruction Output */\n \n@@ -45,19 +52,41 @@ along with GCC; see the file COPYING3.  If not see\n /* These macros are CRIS-specific, but used in target driver macros.  */\n \n #undef CRIS_CPP_SUBTARGET_SPEC\n-#define CRIS_CPP_SUBTARGET_SPEC \\\n+#if TARGET_CPU_DEFAULT == 32\n+# define CRIS_CPP_SUBTARGET_SPEC \\\n+  \"%{pthread:-D_REENTRANT}\\\n+   %{!march=*:%{!cpu=*:-D__arch_v32 -D__CRIS_arch_version=32}}\"\n+#else\n+# define CRIS_CPP_SUBTARGET_SPEC \\\n   \"%{pthread:-D_REENTRANT}\\\n    %{!march=*:%{!cpu=*:-D__arch_v10 -D__CRIS_arch_version=10}}\"\n+#endif\n \n #undef CRIS_CC1_SUBTARGET_SPEC\n-#define CRIS_CC1_SUBTARGET_SPEC \\\n+#if TARGET_CPU_DEFAULT == 32\n+# define CRIS_CC1_SUBTARGET_SPEC \\\n+ \"%{!march=*:%{!cpu=*:-march=v32}}\"\n+#define CRIS_SUBTARGET_DEFAULT_ARCH MASK_AVOID_GOTPLT\n+#else\n+# define CRIS_CC1_SUBTARGET_SPEC \\\n  \"%{!march=*:%{!cpu=*:-march=v10}}\"\n+#define CRIS_SUBTARGET_DEFAULT_ARCH 0\n+#endif\n \n #undef CRIS_ASM_SUBTARGET_SPEC\n-#define CRIS_ASM_SUBTARGET_SPEC \\\n- \"--em=criself\\\n+#if TARGET_CPU_DEFAULT == 32\n+# define CRIS_ASM_SUBTARGET_SPEC \\\n+ \"--em=criself \\\n+  %{!march=*:%{!cpu=*:--march=v32}} \\\n+  %{!fleading-underscore:--no-underscore}\\\n+  %{fPIC|fpic|fPIE|fpie: --pic}\"\n+#else\n+# define CRIS_ASM_SUBTARGET_SPEC \\\n+ \"--em=criself \\\n+  %{!march=*:%{!cpu=*:--march=v10}} \\\n   %{!fleading-underscore:--no-underscore}\\\n   %{fPIC|fpic|fPIE|fpie: --pic}\"\n+#endif\n \n /* Previously controlled by target_flags.  */\n #undef TARGET_LINUX\n@@ -67,7 +96,8 @@ along with GCC; see the file COPYING3.  If not see\n #define CRIS_SUBTARGET_DEFAULT\t\t\t\\\n   (MASK_SVINTO\t\t\t\t\t\\\n    + MASK_ETRAX4_ADD\t\t\t\t\\\n-   + MASK_ALIGN_BY_32)\n+   + MASK_ALIGN_BY_32\t\t\t\t\\\n+   + CRIS_SUBTARGET_DEFAULT_ARCH)\n \n #undef CRIS_DEFAULT_CPU_VERSION\n #define CRIS_DEFAULT_CPU_VERSION CRIS_CPU_NG"}]}