{"sha": "13c62176e5659bb66597ec395d24741eab6970a7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTNjNjIxNzZlNTY1OWJiNjY1OTdlYzM5NWQyNDc0MWVhYjY5NzBhNw==", "commit": {"author": {"name": "Dorit Naishlos", "email": "dorit@il.ibm.com", "date": "2004-10-13T11:04:24Z"}, "committer": {"name": "Dorit Nuzman", "email": "dorit@gcc.gnu.org", "date": "2004-10-13T11:04:24Z"}, "message": "rs6000.c (altivec_builtin_mask_for_load): Made static GTY(()).\n\n2004-10-13  Dorit Naishlos  <dorit@il.ibm.com>\n\n        * rs6000.c (altivec_builtin_mask_for_load): Made static GTY(()).\n        (altivec_builtin_mask_for_store): Likewise.\n        (altivec_init_builtins): Use lang_hooks.builtin_function to\n        create the decls for builtin_altivec_mask_for_load/store.\n\nFrom-SVN: r88978", "tree": {"sha": "57aca1d51f50a47bb50dabebc912c0f9d9d52704", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/57aca1d51f50a47bb50dabebc912c0f9d9d52704"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/13c62176e5659bb66597ec395d24741eab6970a7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/13c62176e5659bb66597ec395d24741eab6970a7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/13c62176e5659bb66597ec395d24741eab6970a7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/13c62176e5659bb66597ec395d24741eab6970a7/comments", "author": null, "committer": null, "parents": [{"sha": "1ce3d58afa8c65eb1638d73c7fb93e7651f8bef5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ce3d58afa8c65eb1638d73c7fb93e7651f8bef5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ce3d58afa8c65eb1638d73c7fb93e7651f8bef5"}], "stats": {"total": 56, "additions": 34, "deletions": 22}, "files": [{"sha": "815a79d700094865804d099f8fa1bec921b71d01", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/13c62176e5659bb66597ec395d24741eab6970a7/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/13c62176e5659bb66597ec395d24741eab6970a7/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=13c62176e5659bb66597ec395d24741eab6970a7", "patch": "@@ -1,3 +1,10 @@\n+2004-10-13  Dorit Naishlos  <dorit@il.ibm.com>\n+\n+\t* rs6000.c (altivec_builtin_mask_for_load): Made static GTY(()).\n+\t(altivec_builtin_mask_for_store): Likewise.\n+\t(altivec_init_builtins): Use lang_hooks.builtin_function to\n+\tcreate the decls for builtin_altivec_mask_for_load/store.\n+\n 2004-10-13  Nick Clifton  <nickc@redhat.com>\n \n \t* config/c4x/c4x.c: Remove inclusion of loop.h."}, {"sha": "14240f5b3fa30d23d06eb9cc9db5fcd77f273eed", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 27, "deletions": 22, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/13c62176e5659bb66597ec395d24741eab6970a7/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/13c62176e5659bb66597ec395d24741eab6970a7/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=13c62176e5659bb66597ec395d24741eab6970a7", "patch": "@@ -143,9 +143,9 @@ const char *rs6000_sched_insert_nops_str;\n enum rs6000_nop_insertion rs6000_sched_insert_nops;\n \n /* Support targetm.vectorize.builtin_mask_for_load.  */\n-tree altivec_builtin_mask_for_load;\n+static GTY(()) tree altivec_builtin_mask_for_load;\n /* Support targetm.vectorize.builtin_mask_for_store.  */\n-tree altivec_builtin_mask_for_store;\n+static GTY(()) tree altivec_builtin_mask_for_store;\n \n /* Size of long double */\n const char *rs6000_long_double_size_string;\n@@ -7795,9 +7795,6 @@ altivec_init_builtins (void)\n     = build_function_type_list (integer_type_node,\n \t\t\t\tpcchar_type_node, NULL_TREE);\n \n-  tree id;\n-  tree decl;\n-\n   def_builtin (MASK_ALTIVEC, \"__builtin_altivec_ld_internal_4sf\", v4sf_ftype_pcfloat,\n \t       ALTIVEC_BUILTIN_LD_INTERNAL_4sf);\n   def_builtin (MASK_ALTIVEC, \"__builtin_altivec_st_internal_4sf\", void_ftype_pfloat_v4sf,\n@@ -7900,23 +7897,31 @@ altivec_init_builtins (void)\n       def_builtin (d->mask, d->name, type, d->code);\n     }\n \n-  /* Initialize target builtin that implements\n-     targetm.vectorize.builtin_mask_for_load.  */\n-  id = get_identifier (\"__builtin_altivec_mask_for_load\");\n-  decl = build_decl (FUNCTION_DECL, id, v16qi_ftype_long_pcvoid);\n-  DECL_BUILT_IN_CLASS (decl) = BUILT_IN_MD;\n-  DECL_FUNCTION_CODE (decl) = ALTIVEC_BUILTIN_MASK_FOR_LOAD;\n-  /* Record the decl. Will be used by rs6000_builtin_mask_for_load.  */\n-  altivec_builtin_mask_for_load = decl;\n-\n-  /* Initialize target builtin that implements\n-     targetm.vectorize.builtin_mask_for_store.  */\n-  id = get_identifier (\"__builtin_altivec_mask_for_store\");\n-  decl = build_decl (FUNCTION_DECL, id, v16qi_ftype_long_pcvoid);\n-  DECL_BUILT_IN_CLASS (decl) = BUILT_IN_MD;\n-  DECL_FUNCTION_CODE (decl) = ALTIVEC_BUILTIN_MASK_FOR_STORE;\n-  /* Record the decl. Will be used by rs6000_builtin_mask_for_store.  */\n-  altivec_builtin_mask_for_store = decl;\n+  if (TARGET_ALTIVEC)\n+    {\n+      tree decl;\n+\n+      /* Initialize target builtin that implements\n+         targetm.vectorize.builtin_mask_for_load.  */\n+\n+      decl = lang_hooks.builtin_function (\"__builtin_altivec_mask_for_load\",\n+                               v16qi_ftype_long_pcvoid,\n+                               ALTIVEC_BUILTIN_MASK_FOR_LOAD,\n+                               BUILT_IN_MD, NULL, NULL_TREE);\n+      /* Record the decl. Will be used by rs6000_builtin_mask_for_load.  */\n+      altivec_builtin_mask_for_load = decl;\n+\n+\n+      /* Initialize target builtin that implements\n+         targetm.vectorize.builtin_mask_for_store.  */\n+\n+      decl = lang_hooks.builtin_function (\"__builtin_altivec_mask_for_store\",\n+                               v16qi_ftype_long_pcvoid,\n+                               ALTIVEC_BUILTIN_MASK_FOR_STORE,\n+                               BUILT_IN_MD, NULL, NULL_TREE);\n+      /* Record the decl. Will be used by rs6000_builtin_mask_for_store.  */\n+      altivec_builtin_mask_for_store = decl;\n+    }\n }\n \n static void"}]}