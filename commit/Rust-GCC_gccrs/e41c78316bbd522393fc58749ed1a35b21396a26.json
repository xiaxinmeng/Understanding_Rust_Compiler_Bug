{"sha": "e41c78316bbd522393fc58749ed1a35b21396a26", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTQxYzc4MzE2YmJkNTIyMzkzZmM1ODc0OWVkMWEzNWIyMTM5NmEyNg==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2002-01-06T10:25:07Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2002-01-06T10:25:07Z"}, "message": "reorg.c (emit_delay_sequence): Remove death notes, not merely nop them out.\n\n        * reorg.c (emit_delay_sequence): Remove death notes, not merely\n        nop them out.  Increment label reference count for REG_LABEL.\n        (fill_slots_from_thread): Frob label reference count around\n        delete_related_insns.\n\nFrom-SVN: r48580", "tree": {"sha": "3677ed9e91241831d42f7e0441f47b6f3070b970", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3677ed9e91241831d42f7e0441f47b6f3070b970"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e41c78316bbd522393fc58749ed1a35b21396a26", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e41c78316bbd522393fc58749ed1a35b21396a26", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e41c78316bbd522393fc58749ed1a35b21396a26", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e41c78316bbd522393fc58749ed1a35b21396a26/comments", "author": null, "committer": null, "parents": [{"sha": "9efc7479a2d31964be153f018848774d4b89d9b9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9efc7479a2d31964be153f018848774d4b89d9b9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9efc7479a2d31964be153f018848774d4b89d9b9"}], "stats": {"total": 47, "additions": 41, "deletions": 6}, "files": [{"sha": "b76365c17d467482499a359f3823ea3d2f46de25", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e41c78316bbd522393fc58749ed1a35b21396a26/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e41c78316bbd522393fc58749ed1a35b21396a26/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e41c78316bbd522393fc58749ed1a35b21396a26", "patch": "@@ -1,3 +1,10 @@\n+2002-01-06  Richard Henderson  <rth@redhat.com>\n+\n+\t* reorg.c (emit_delay_sequence): Remove death notes, not merely\n+\tnop them out.  Increment label reference count for REG_LABEL.\n+\t(fill_slots_from_thread): Frob label reference count around\n+\tdelete_related_insns.\n+\n 2002-01-05  Richard Henderson  <rth@redhat.com>\n \n \t* cfgcleanup.c (try_forward_edges): Detect infinite loops while"}, {"sha": "b1c33f5bf0dfce34a71dcf571172479ac7df1fea", "filename": "gcc/reorg.c", "status": "modified", "additions": 34, "deletions": 6, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e41c78316bbd522393fc58749ed1a35b21396a26/gcc%2Freorg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e41c78316bbd522393fc58749ed1a35b21396a26/gcc%2Freorg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Freorg.c?ref=e41c78316bbd522393fc58749ed1a35b21396a26", "patch": "@@ -489,7 +489,7 @@ emit_delay_sequence (insn, list, length)\n   for (li = list; li; li = XEXP (li, 1), i++)\n     {\n       rtx tem = XEXP (li, 0);\n-      rtx note;\n+      rtx note, next;\n \n       /* Show that this copy of the insn isn't deleted.  */\n       INSN_DELETED_P (tem) = 0;\n@@ -498,11 +498,26 @@ emit_delay_sequence (insn, list, length)\n       PREV_INSN (tem) = XVECEXP (seq, 0, i - 1);\n       NEXT_INSN (XVECEXP (seq, 0, i - 1)) = tem;\n \n-      /* Remove any REG_DEAD notes because we can't rely on them now\n-\t that the insn has been moved.  */\n-      for (note = REG_NOTES (tem); note; note = XEXP (note, 1))\n-\tif (REG_NOTE_KIND (note) == REG_DEAD)\n-\t  XEXP (note, 0) = const0_rtx;\n+      for (note = REG_NOTES (tem); note; note = next)\n+\t{\n+\t  next = XEXP (note, 1);\n+\t  switch (REG_NOTE_KIND (note))\n+\t    {\n+\t    case REG_DEAD:\n+\t      /* Remove any REG_DEAD notes because we can't rely on them now\n+\t\t that the insn has been moved.  */\n+\t      remove_note (tem, note);\n+\t      break;\n+\n+\t    case REG_LABEL:\n+\t      /* Keep the label reference count up to date.  */\n+\t      LABEL_NUSES (XEXP (note, 0)) ++;\n+\t      break;\n+\n+\t    default:\n+\t      break;\n+\t    }\n+\t}\n     }\n \n   NEXT_INSN (XVECEXP (seq, 0, length)) = NEXT_INSN (seq_insn);\n@@ -2703,14 +2718,27 @@ fill_slots_from_thread (insn, condition, thread, opposite_thread, likely,\n \t\t     starting point of this thread.  */\n \t\t  if (own_thread)\n \t\t    {\n+\t\t      rtx note;\n+\n \t\t      update_block (trial, thread);\n \t\t      if (trial == thread)\n \t\t\t{\n \t\t\t  thread = next_active_insn (thread);\n \t\t\t  if (new_thread == trial)\n \t\t\t    new_thread = thread;\n \t\t\t}\n+\n+\t\t      /* We are moving this insn, not deleting it.  We must\n+\t\t\t temporarily increment the use count on any referenced\n+\t\t\t label lest it be deleted by delete_related_insns.  */\n+\t\t      note = find_reg_note (trial, REG_LABEL, 0);\n+\t\t      if (note)\n+\t\t\tLABEL_NUSES (XEXP (note, 0))++;\n+\n \t\t      delete_related_insns (trial);\n+\n+\t\t      if (note)\n+\t\t\tLABEL_NUSES (XEXP (note, 0))--;\n \t\t    }\n \t\t  else\n \t\t    new_thread = next_active_insn (trial);"}]}