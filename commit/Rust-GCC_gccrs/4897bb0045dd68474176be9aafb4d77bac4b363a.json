{"sha": "4897bb0045dd68474176be9aafb4d77bac4b363a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDg5N2JiMDA0NWRkNjg0NzQxNzZiZTlhYWZiNGQ3N2JhYzRiMzYzYQ==", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2020-03-23T14:29:05Z"}, "committer": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2020-03-23T14:29:05Z"}, "message": "libgomp \u2013 fix declare target link handling (PR94251)\n\n\tPR libgomp/94251\n\t* target.c (gomp_load_image_to_device): Fix link\n\tvariable handling.", "tree": {"sha": "ee7ee000f0bde82e6fb2b2dfda58b068a1e9e5e1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ee7ee000f0bde82e6fb2b2dfda58b068a1e9e5e1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4897bb0045dd68474176be9aafb4d77bac4b363a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4897bb0045dd68474176be9aafb4d77bac4b363a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4897bb0045dd68474176be9aafb4d77bac4b363a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4897bb0045dd68474176be9aafb4d77bac4b363a/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ce6413087deba5888a0a9a24f95f3b796e46add9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce6413087deba5888a0a9a24f95f3b796e46add9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ce6413087deba5888a0a9a24f95f3b796e46add9"}], "stats": {"total": 11, "additions": 9, "deletions": 2}, "files": [{"sha": "c90cbdcc711eceb1958e31017e198aaa8d9d3271", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4897bb0045dd68474176be9aafb4d77bac4b363a/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4897bb0045dd68474176be9aafb4d77bac4b363a/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=4897bb0045dd68474176be9aafb4d77bac4b363a", "patch": "@@ -1,3 +1,9 @@\n+2020-03-20  Tobias Burnus  <tobias@codesourcery.com>\n+\n+\tPR libgomp/94251\n+\t* target.c (gomp_load_image_to_device): Fix link\n+\tvariable handling.\n+\n 2020-03-19  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/93931"}, {"sha": "c99dd5196fab66145335d79b2bd4ebe261a4ca94", "filename": "libgomp/target.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4897bb0045dd68474176be9aafb4d77bac4b363a/libgomp%2Ftarget.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4897bb0045dd68474176be9aafb4d77bac4b363a/libgomp%2Ftarget.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftarget.c?ref=4897bb0045dd68474176be9aafb4d77bac4b363a", "patch": "@@ -1648,8 +1648,9 @@ gomp_load_image_to_device (struct gomp_device_descr *devicep, unsigned version,\n     {\n       struct addr_pair *target_var = &target_table[num_funcs + i];\n       uintptr_t target_size = target_var->end - target_var->start;\n+      bool is_link_var = link_bit & (uintptr_t) host_var_table[i * 2 + 1];\n \n-      if ((uintptr_t) host_var_table[i * 2 + 1] != target_size)\n+      if (!is_link_var && (uintptr_t) host_var_table[i * 2 + 1] != target_size)\n \t{\n \t  gomp_mutex_unlock (&devicep->lock);\n \t  if (is_register_lock)\n@@ -1663,7 +1664,7 @@ gomp_load_image_to_device (struct gomp_device_descr *devicep, unsigned version,\n \t= k->host_start + (size_mask & (uintptr_t) host_var_table[i * 2 + 1]);\n       k->tgt = tgt;\n       k->tgt_offset = target_var->start;\n-      k->refcount = target_size & link_bit ? REFCOUNT_LINK : REFCOUNT_INFINITY;\n+      k->refcount = is_link_var ? REFCOUNT_LINK : REFCOUNT_INFINITY;\n       k->virtual_refcount = 0;\n       k->aux = NULL;\n       array->left = NULL;"}]}