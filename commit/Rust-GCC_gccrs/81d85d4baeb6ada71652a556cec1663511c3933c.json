{"sha": "81d85d4baeb6ada71652a556cec1663511c3933c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODFkODVkNGJhZWI2YWRhNzE2NTJhNTU2Y2VjMTY2MzUxMWMzOTMzYw==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2018-09-26T09:17:05Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-09-26T09:17:05Z"}, "message": "[Ada] Fix assertion failure on record subtype with -gnatRj\n\nThe JSON output of the -gnatR machinery was choking on record subtypes\nand the change fixes this oversight.\n\nThe following package must now compile properly with -gnatRj:\n\npackage P is\n\n  type Rec (D : Integer) is record\n      C : Integer;\n\n      case D is\n         when 1 =>\n            S : String (1 .. 20);\n         when 2 =>\n            B : Boolean;\n         when others =>\n            Ch1 : Character;\n            F   : Float;\n            Ch2 : Character;\n      end case;\n\n   end record;\n\n   subtype Rec1 is Rec (1);\n\nend P;\n\n2018-09-26  Eric Botcazou  <ebotcazou@adacore.com>\n\ngcc/ada/\n\n\t* repinfo.adb (List_Record_Layout): Be prepared for JSON output.\n\t(List_Record_Info): Use the flat representation for record\n\tsubtypes in the JSON format.\n\nFrom-SVN: r264609", "tree": {"sha": "79af3198a79338d30d795c9898c973c38f3e8a9b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/79af3198a79338d30d795c9898c973c38f3e8a9b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/81d85d4baeb6ada71652a556cec1663511c3933c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81d85d4baeb6ada71652a556cec1663511c3933c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/81d85d4baeb6ada71652a556cec1663511c3933c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81d85d4baeb6ada71652a556cec1663511c3933c/comments", "author": null, "committer": null, "parents": [{"sha": "05a84157e98dfb25500705c0bc2570139a01075f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/05a84157e98dfb25500705c0bc2570139a01075f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/05a84157e98dfb25500705c0bc2570139a01075f"}], "stats": {"total": 24, "additions": 22, "deletions": 2}, "files": [{"sha": "83685b4d07793284d1db131df9e21e7900702c68", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81d85d4baeb6ada71652a556cec1663511c3933c/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81d85d4baeb6ada71652a556cec1663511c3933c/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=81d85d4baeb6ada71652a556cec1663511c3933c", "patch": "@@ -1,3 +1,9 @@\n+2018-09-26  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* repinfo.adb (List_Record_Layout): Be prepared for JSON output.\n+\t(List_Record_Info): Use the flat representation for record\n+\tsubtypes in the JSON format.\n+\n 2018-09-26  Justin Squirek  <squirek@adacore.com>\n \n \t* lib-writ.adb, lib-writ.ads (Write_With_Lines): Add"}, {"sha": "d5c099fcd5b2e09d1c2f5de1dd39d9013d30152f", "filename": "gcc/ada/repinfo.adb", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81d85d4baeb6ada71652a556cec1663511c3933c/gcc%2Fada%2Frepinfo.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81d85d4baeb6ada71652a556cec1663511c3933c/gcc%2Fada%2Frepinfo.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Frepinfo.adb?ref=81d85d4baeb6ada71652a556cec1663511c3933c", "patch": "@@ -1358,7 +1358,8 @@ package body Repinfo is\n          Starting_First_Bit : Uint := Uint_0;\n          Prefix             : String := \"\")\n       is\n-         Comp : Entity_Id;\n+         Comp  : Entity_Id;\n+         First : Boolean := True;\n \n       begin\n          Comp := First_Component_Or_Discriminant (Ent);\n@@ -1413,6 +1414,15 @@ package body Repinfo is\n                   goto Continue;\n                end if;\n \n+               if List_Representation_Info_To_JSON then\n+                  if First then\n+                     Write_Eol;\n+                     First := False;\n+                  else\n+                     Write_Line (\",\");\n+                  end if;\n+               end if;\n+\n                List_Component_Layout (Comp,\n                  Starting_Position, Starting_First_Bit, Prefix);\n             end;\n@@ -1678,7 +1688,11 @@ package body Repinfo is\n          Write_Line (\",\");\n          Write_Str (\"  \"\"record\"\": [\");\n \n-         List_Structural_Record_Layout (Ent, Ent);\n+         if Is_Base_Type (Ent) then\n+            List_Structural_Record_Layout (Ent, Ent);\n+         else\n+            List_Record_Layout (Ent);\n+         end if;\n \n          Write_Eol;\n          Write_Str (\"  ]\");"}]}