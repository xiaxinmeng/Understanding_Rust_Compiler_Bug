{"sha": "ba8011e6c03cdda4c71762f3172fc10ee00ef1b9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmE4MDExZTZjMDNjZGRhNGM3MTc2MmYzMTcyZmMxMGVlMDBlZjFiOQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2013-04-27T12:26:05Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2013-04-27T12:26:05Z"}, "message": "re PR target/56866 (with '-O3 -march=bdver2' misscompiles glibc-2.17/crypt/sha512.c)\n\n\tPR target/56866\n\t* config/i386/i386.c (ix86_expand_mul_widen_evenodd): Don't\n\tuse xop_pmacsdqh if uns_p.\n\t* config/i386/sse.md (xop_rotr<mode>3): Fix up computation of\n\tthe immediate rotate count.\n\n\t* gcc.c-torture/execute/pr56866.c: New test.\n\t* gcc.target/i386/pr56866.c: New test.\n\nFrom-SVN: r198355", "tree": {"sha": "db9dd65f63556f9e7284ee71edab4af4053299fc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/db9dd65f63556f9e7284ee71edab4af4053299fc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ba8011e6c03cdda4c71762f3172fc10ee00ef1b9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba8011e6c03cdda4c71762f3172fc10ee00ef1b9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ba8011e6c03cdda4c71762f3172fc10ee00ef1b9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba8011e6c03cdda4c71762f3172fc10ee00ef1b9/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "95715ffbe68c5618aceef8fabbe794ea69bf31ac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/95715ffbe68c5618aceef8fabbe794ea69bf31ac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/95715ffbe68c5618aceef8fabbe794ea69bf31ac"}], "stats": {"total": 82, "additions": 80, "deletions": 2}, "files": [{"sha": "980a6ba402e932bbbda3233d36fcbc03a44749b4", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba8011e6c03cdda4c71762f3172fc10ee00ef1b9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba8011e6c03cdda4c71762f3172fc10ee00ef1b9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ba8011e6c03cdda4c71762f3172fc10ee00ef1b9", "patch": "@@ -1,3 +1,11 @@\n+2013-04-27  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/56866\n+\t* config/i386/i386.c (ix86_expand_mul_widen_evenodd): Don't\n+\tuse xop_pmacsdqh if uns_p.\n+\t* config/i386/sse.md (xop_rotr<mode>3): Fix up computation of\n+\tthe immediate rotate count.\n+\n 2013-04-26  Vladimir Makarov  <vmakarov@redhat.com>\n \n \t* rtl.h (struct rtx_def): Add comment for field jump."}, {"sha": "886f15a0f6ea5bf0de16b759709cb3fc425ee9de", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba8011e6c03cdda4c71762f3172fc10ee00ef1b9/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba8011e6c03cdda4c71762f3172fc10ee00ef1b9/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=ba8011e6c03cdda4c71762f3172fc10ee00ef1b9", "patch": "@@ -40841,7 +40841,9 @@ ix86_expand_mul_widen_evenodd (rtx dest, rtx op1, rtx op2,\n      the even slots.  For some cpus this is faster than a PSHUFD.  */\n   if (odd_p)\n     {\n-      if (TARGET_XOP && mode == V4SImode)\n+      /* For XOP use vpmacsdqh, but only for smult, as it is only\n+\t signed.  */\n+      if (TARGET_XOP && mode == V4SImode && !uns_p)\n \t{\n \t  x = force_reg (wmode, CONST0_RTX (wmode));\n \t  emit_insn (gen_xop_pmacsdqh (dest, op1, op2, x));"}, {"sha": "45973855f07bf347c08c16b8285b4b1df58ec8a1", "filename": "gcc/config/i386/sse.md", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba8011e6c03cdda4c71762f3172fc10ee00ef1b9/gcc%2Fconfig%2Fi386%2Fsse.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba8011e6c03cdda4c71762f3172fc10ee00ef1b9/gcc%2Fconfig%2Fi386%2Fsse.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fsse.md?ref=ba8011e6c03cdda4c71762f3172fc10ee00ef1b9", "patch": "@@ -9924,7 +9924,8 @@\n \t (match_operand:SI 2 \"const_0_to_<sserotatemax>_operand\" \"n\")))]\n   \"TARGET_XOP\"\n {\n-  operands[3] = GEN_INT ((<ssescalarnum> * 8) - INTVAL (operands[2]));\n+  operands[3]\n+    = GEN_INT (GET_MODE_BITSIZE (<ssescalarmode>mode) - INTVAL (operands[2]));\n   return \\\"vprot<ssemodesuffix>\\t{%3, %1, %0|%0, %1, %3}\\\";\n }\n   [(set_attr \"type\" \"sseishft\")"}, {"sha": "5777334a0c05d0534efc9315ed2fcee1624072ca", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba8011e6c03cdda4c71762f3172fc10ee00ef1b9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba8011e6c03cdda4c71762f3172fc10ee00ef1b9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ba8011e6c03cdda4c71762f3172fc10ee00ef1b9", "patch": "@@ -1,3 +1,9 @@\n+2013-04-27  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/56866\n+\t* gcc.c-torture/execute/pr56866.c: New test.\n+\t* gcc.target/i386/pr56866.c: New test.\n+\n 2013-04-26  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR go/57045"}, {"sha": "260b8ff187606803753b5bf03ca529d43d31f156", "filename": "gcc/testsuite/gcc.c-torture/execute/pr56866.c", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba8011e6c03cdda4c71762f3172fc10ee00ef1b9/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr56866.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba8011e6c03cdda4c71762f3172fc10ee00ef1b9/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr56866.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr56866.c?ref=ba8011e6c03cdda4c71762f3172fc10ee00ef1b9", "patch": "@@ -0,0 +1,45 @@\n+/* PR target/56866 */\n+\n+int\n+main ()\n+{\n+#if __CHAR_BIT__ == 8 && __SIZEOF_LONG_LONG__ == 8 && __SIZEOF_INT__ == 4 && __SIZEOF_SHORT__ == 2\n+  unsigned long long wq[256], rq[256];\n+  unsigned int wi[256], ri[256];\n+  unsigned short ws[256], rs[256];\n+  unsigned char wc[256], rc[256];\n+  int t;\n+\n+  __builtin_memset (wq, 0, sizeof wq);\n+  __builtin_memset (wi, 0, sizeof wi);\n+  __builtin_memset (ws, 0, sizeof ws);\n+  __builtin_memset (wc, 0, sizeof wc);\n+  wq[0] = 0x0123456789abcdefULL;\n+  wi[0] = 0x01234567;\n+  ws[0] = 0x4567;\n+  wc[0] = 0x73;\n+\n+  asm volatile (\"\" : : \"g\" (wq), \"g\" (wi), \"g\" (ws), \"g\" (wc) : \"memory\");\n+\n+  for (t = 0; t < 256; ++t)\n+    rq[t] = (wq[t] >> 8) | (wq[t] << (sizeof (wq[0]) * __CHAR_BIT__ - 8));\n+  for (t = 0; t < 256; ++t)\n+    ri[t] = (wi[t] >> 8) | (wi[t] << (sizeof (wi[0]) * __CHAR_BIT__ - 8));\n+  for (t = 0; t < 256; ++t)\n+    rs[t] = (ws[t] >> 9) | (ws[t] << (sizeof (ws[0]) * __CHAR_BIT__ - 9));\n+  for (t = 0; t < 256; ++t)\n+    rc[t] = (wc[t] >> 5) | (wc[t] << (sizeof (wc[0]) * __CHAR_BIT__ - 5));\n+\n+  asm volatile (\"\" : : \"g\" (rq), \"g\" (ri), \"g\" (rs), \"g\" (rc) : \"memory\");\n+\n+  if (rq[0] != 0xef0123456789abcdULL || rq[1])\n+    __builtin_abort ();\n+  if (ri[0] != 0x67012345 || ri[1])\n+    __builtin_abort ();\n+  if (rs[0] != 0xb3a2 || rs[1])\n+    __builtin_abort ();\n+  if (rc[0] != 0x9b || rc[1])\n+    __builtin_abort ();\n+#endif\n+  return 0;\n+}"}, {"sha": "fbd151745697b1d74af377e70a3ae363081ff6e3", "filename": "gcc/testsuite/gcc.target/i386/pr56866.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba8011e6c03cdda4c71762f3172fc10ee00ef1b9/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr56866.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba8011e6c03cdda4c71762f3172fc10ee00ef1b9/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr56866.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr56866.c?ref=ba8011e6c03cdda4c71762f3172fc10ee00ef1b9", "patch": "@@ -0,0 +1,16 @@\n+/* PR target/56866 */\n+/* { dg-do run } */\n+/* { dg-require-effective-target xop } */\n+/* { dg-options \"-O3 -mxop\" } */\n+\n+#define main xop_test_main\n+#include \"../../gcc.c-torture/execute/pr56866.c\"\n+#undef main\n+\n+#include \"xop-check.h\"\n+\n+static void\n+xop_test (void)\n+{\n+  xop_test_main ();\n+}"}]}