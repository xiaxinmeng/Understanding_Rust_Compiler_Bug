{"sha": "7f967bd2a7ba156ede3fbb147e66dea5fb7137a6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2Y5NjdiZDJhN2JhMTU2ZWRlM2ZiYjE0N2U2NmRlYTVmYjcxMzdhNg==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2020-06-18T18:37:51Z"}, "committer": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2020-06-24T07:24:06Z"}, "message": "options: Properly compare string options.\n\ngcc/ChangeLog:\n\n\t* optc-save-gen.awk: Compare string options in cl_optimization_compare\n\tby strcmp.", "tree": {"sha": "d878005d2bf9eb6a66d34a86e132021134b3eff2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d878005d2bf9eb6a66d34a86e132021134b3eff2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7f967bd2a7ba156ede3fbb147e66dea5fb7137a6", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCAAdFiEE6I4wzqqylQBfXaRhTcGC3A+nN4UFAl7y/5YACgkQTcGC3A+n\nN4Uy4wf/eP14QRKeXcw4bQXOvhPWEWoLDOV5RILXAcsUX1/lX34lYSbcgqcOau6m\nYv6YJpPYcfsIgEGbZsWGKeJZ68GaBVHEJchWoGJXZBK4CFCvnWWe7FWAkRh44Kwh\nFpefVzb/4ZFmtEb1bb1oAcFZnMhbmKLWPSzkvgFwgPmCv5cG/uaSgyvEAduEcv91\nmbRarCafW3VQ+c7vHi4NFteYv64PC/0L1udxetjvKKwyiwLPhUDm+d+qhcY44ZWM\nFrZUwLFCapStCe2+4yIOfOWXOrGORn4cDtTk96oK2s/t5I3+a1WtockUuStH8sPj\n+MCbqdQk+1UU2YoZRanwMd5Ymdd0TQ==\n=Al7c\n-----END PGP SIGNATURE-----", "payload": "tree d878005d2bf9eb6a66d34a86e132021134b3eff2\nparent 4543acc87455646f2a910fe7a3322395a45255f0\nauthor Martin Liska <mliska@suse.cz> 1592505471 +0200\ncommitter Martin Liska <mliska@suse.cz> 1592983446 +0200\n\noptions: Properly compare string options.\n\ngcc/ChangeLog:\n\n\t* optc-save-gen.awk: Compare string options in cl_optimization_compare\n\tby strcmp.\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f967bd2a7ba156ede3fbb147e66dea5fb7137a6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f967bd2a7ba156ede3fbb147e66dea5fb7137a6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f967bd2a7ba156ede3fbb147e66dea5fb7137a6/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4543acc87455646f2a910fe7a3322395a45255f0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4543acc87455646f2a910fe7a3322395a45255f0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4543acc87455646f2a910fe7a3322395a45255f0"}], "stats": {"total": 20, "additions": 16, "deletions": 4}, "files": [{"sha": "760bf26721ac06ed230cf1cd3169aa125a74853e", "filename": "gcc/optc-save-gen.awk", "status": "modified", "additions": 16, "deletions": 4, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f967bd2a7ba156ede3fbb147e66dea5fb7137a6/gcc%2Foptc-save-gen.awk", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f967bd2a7ba156ede3fbb147e66dea5fb7137a6/gcc%2Foptc-save-gen.awk", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Foptc-save-gen.awk?ref=7f967bd2a7ba156ede3fbb147e66dea5fb7137a6", "patch": "@@ -126,8 +126,10 @@ for (i = 0; i < n_opts; i++) {\n \t\t\telse if (otype ~ \"^signed +char *$\")\n \t\t\t\tvar_opt_range[name] = \"-128, 127\"\n \t\t}\n-\t\telse if (otype ~ \"^const char \\\\**$\")\n+\t\telse if (otype ~ \"^const char \\\\**$\") {\n \t\t\tvar_opt_string[n_opt_string++] = name;\n+\t\t\tstring_options_names[name]++\n+\t\t}\n \t\telse\n \t\t\tvar_opt_other[n_opt_other++] = name;\n \t}\n@@ -382,8 +384,10 @@ if (have_save) {\n \t\t\t\tif (otype == var_type(flags[i]))\n \t\t\t\t\tvar_target_range[name] = \"\"\n \t\t\t}\n-\t\t\telse if (otype ~ \"^const char \\\\**$\")\n+\t\t\telse if (otype ~ \"^const char \\\\**$\") {\n \t\t\t\tvar_target_string[n_target_string++] = name;\n+\t\t\t\tstring_options_names[name]++\n+\t\t\t}\n \t\t\telse\n \t\t\t\tvar_target_other[n_target_other++] = name;\n \t\t}\n@@ -966,8 +970,16 @@ for (i = 0; i < n_opts; i++) {\n \t\tcontinue;\n \tchecked_options[name]++\n \n-\tprint \"  if (ptr1->x_\" name \" != ptr2->x_\" name \")\"\n-\tprint \"    internal_error (\\\"%<global_options%> are modified in local context\\\");\";\n+\tif (name in string_options_names) {\n+\t  print \"  if (ptr1->x_\" name \" != ptr2->x_\" name \"\";\n+\t  print \"      && (!ptr1->x_\" name\" || !ptr2->x_\" name\n+\t  print \"          || strcmp (ptr1->x_\" name\", ptr2->x_\" name \")))\";\n+\t  print \"    internal_error (\\\"%<global_options%> are modified in local context\\\");\";\n+\t}\n+\telse {\n+\t  print \"  if (ptr1->x_\" name \" != ptr2->x_\" name \")\"\n+\t  print \"    internal_error (\\\"%<global_options%> are modified in local context\\\");\";\n+\t}\n }\n \n print \"}\";"}]}