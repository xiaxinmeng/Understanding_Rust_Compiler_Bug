{"sha": "3696163cb43bdd7c3a22bef46a0e3f4576d0fc44", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzY5NjE2M2NiNDNiZGQ3YzNhMjJiZWY0NmEwZTNmNDU3NmQwZmM0NA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2014-08-04T15:45:50Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2014-08-04T15:45:50Z"}, "message": "task.c (GOMP_taskgroup_end): If taskgroup->num_children is not zero...\n\n\t* task.c (GOMP_taskgroup_end): If taskgroup->num_children\n\tis not zero, but taskgroup->children is NULL and there are\n\tany task->children, schedule those instead of waiting.\n\t* testsuite/libgomp.c/depend-6.c: New test.\n\t* testsuite/libgomp.c/depend-7.c: New test.\n\t* testsuite/libgomp.c/depend-8.c: New test.\n\t* testsuite/libgomp.c/depend-9.c: New test.\n\t* testsuite/libgomp.c/depend-10.c: New test.\n\nFrom-SVN: r213592", "tree": {"sha": "802bd51205c193f686bd365074adad2cdcb92704", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/802bd51205c193f686bd365074adad2cdcb92704"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c6d4f6b465566cfec138c47702727fcf5c09c7e2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c6d4f6b465566cfec138c47702727fcf5c09c7e2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c6d4f6b465566cfec138c47702727fcf5c09c7e2"}], "stats": {"total": 64, "additions": 44, "deletions": 20}, "files": [{"sha": "ee73689e702ecb403c1cfa96e10b079378d64b67", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=3696163cb43bdd7c3a22bef46a0e3f4576d0fc44", "patch": "@@ -1,3 +1,14 @@\n+2014-08-04  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* task.c (GOMP_taskgroup_end): If taskgroup->num_children\n+\tis not zero, but taskgroup->children is NULL and there are\n+\tany task->children, schedule those instead of waiting.\n+\t* testsuite/libgomp.c/depend-6.c: New test.\n+\t* testsuite/libgomp.c/depend-7.c: New test.\n+\t* testsuite/libgomp.c/depend-8.c: New test.\n+\t* testsuite/libgomp.c/depend-9.c: New test.\n+\t* testsuite/libgomp.c/depend-10.c: New test.\n+\n 2014-08-01  Jakub Jelinek  <jakub@redhat.com>\n \n \t* libgomp.h (struct gomp_task_depend_entry): Add redundant_out field."}, {"sha": "7d3233c6e1b3506dee10d5bfa4b2d23cd883eeaf", "filename": "libgomp/task.c", "status": "modified", "additions": 18, "deletions": 20, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44/libgomp%2Ftask.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44/libgomp%2Ftask.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftask.c?ref=3696163cb43bdd7c3a22bef46a0e3f4576d0fc44", "patch": "@@ -1115,18 +1115,26 @@ GOMP_taskgroup_end (void)\n       if (taskgroup->children == NULL)\n \t{\n \t  if (taskgroup->num_children)\n-\t    goto do_wait;\n-\t  gomp_mutex_unlock (&team->task_lock);\n-\t  if (to_free)\n \t    {\n-\t      gomp_finish_task (to_free);\n-\t      free (to_free);\n+\t      if (task->children == NULL)\n+\t\tgoto do_wait;\n+\t      child_task = task->children;\n+            }\n+          else\n+\t    {\n+\t      gomp_mutex_unlock (&team->task_lock);\n+\t      if (to_free)\n+\t\t{\n+\t\t  gomp_finish_task (to_free);\n+\t\t  free (to_free);\n+\t\t}\n+\t      goto finish;\n \t    }\n-\t  goto finish;\n \t}\n-      if (taskgroup->children->kind == GOMP_TASK_WAITING)\n+      else\n+\tchild_task = taskgroup->children;\n+      if (child_task->kind == GOMP_TASK_WAITING)\n \t{\n-\t  child_task = taskgroup->children;\n \t  cancelled\n \t    = gomp_task_run_pre (child_task, child_task->parent, taskgroup,\n \t\t\t\t team);\n@@ -1143,6 +1151,7 @@ GOMP_taskgroup_end (void)\n \t}\n       else\n \t{\n+\t  child_task = NULL;\n \t do_wait:\n \t  /* All tasks we are waiting for are already running\n \t     in other threads.  Wait for them.  */\n@@ -1174,20 +1183,9 @@ GOMP_taskgroup_end (void)\n \t finish_cancelled:;\n \t  size_t new_tasks\n \t    = gomp_task_run_post_handle_depend (child_task, team);\n-\t  child_task->prev_taskgroup->next_taskgroup\n-\t    = child_task->next_taskgroup;\n-\t  child_task->next_taskgroup->prev_taskgroup\n-\t    = child_task->prev_taskgroup;\n-\t  --taskgroup->num_children;\n-\t  if (taskgroup->children == child_task)\n-\t    {\n-\t      if (child_task->next_taskgroup != child_task)\n-\t\ttaskgroup->children = child_task->next_taskgroup;\n-\t      else\n-\t\ttaskgroup->children = NULL;\n-\t    }\n \t  gomp_task_run_post_remove_parent (child_task);\n \t  gomp_clear_parent (child_task->children);\n+\t  gomp_task_run_post_remove_taskgroup (child_task);\n \t  to_free = child_task;\n \t  child_task = NULL;\n \t  team->task_count--;"}, {"sha": "2137bf9471d3413de49bc18930a238078b6c717b", "filename": "libgomp/testsuite/libgomp.c/depend-10.c", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44/libgomp%2Ftestsuite%2Flibgomp.c%2Fdepend-10.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44/libgomp%2Ftestsuite%2Flibgomp.c%2Fdepend-10.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2Fdepend-10.c?ref=3696163cb43bdd7c3a22bef46a0e3f4576d0fc44", "patch": "@@ -0,0 +1,3 @@\n+/* { dg-set-target-env-var OMP_NUM_THREADS \"1\" } */\n+\n+#include \"depend-5.c\""}, {"sha": "d30e6e9dd907df0d3dc50645fcb24b98fffdd78f", "filename": "libgomp/testsuite/libgomp.c/depend-6.c", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44/libgomp%2Ftestsuite%2Flibgomp.c%2Fdepend-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44/libgomp%2Ftestsuite%2Flibgomp.c%2Fdepend-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2Fdepend-6.c?ref=3696163cb43bdd7c3a22bef46a0e3f4576d0fc44", "patch": "@@ -0,0 +1,3 @@\n+/* { dg-set-target-env-var OMP_NUM_THREADS \"1\" } */\n+\n+#include \"depend-1.c\""}, {"sha": "bd4a3f9dec0b092f36f5f07c94fd3f084b1b6e67", "filename": "libgomp/testsuite/libgomp.c/depend-7.c", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44/libgomp%2Ftestsuite%2Flibgomp.c%2Fdepend-7.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44/libgomp%2Ftestsuite%2Flibgomp.c%2Fdepend-7.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2Fdepend-7.c?ref=3696163cb43bdd7c3a22bef46a0e3f4576d0fc44", "patch": "@@ -0,0 +1,3 @@\n+/* { dg-set-target-env-var OMP_NUM_THREADS \"1\" } */\n+\n+#include \"depend-2.c\""}, {"sha": "4dcce671c0980fb411a751369caa3f472e3d19e2", "filename": "libgomp/testsuite/libgomp.c/depend-8.c", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44/libgomp%2Ftestsuite%2Flibgomp.c%2Fdepend-8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44/libgomp%2Ftestsuite%2Flibgomp.c%2Fdepend-8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2Fdepend-8.c?ref=3696163cb43bdd7c3a22bef46a0e3f4576d0fc44", "patch": "@@ -0,0 +1,3 @@\n+/* { dg-set-target-env-var OMP_NUM_THREADS \"1\" } */\n+\n+#include \"depend-3.c\""}, {"sha": "a52c47ac6dbeed87568d3166399776067deb629f", "filename": "libgomp/testsuite/libgomp.c/depend-9.c", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44/libgomp%2Ftestsuite%2Flibgomp.c%2Fdepend-9.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3696163cb43bdd7c3a22bef46a0e3f4576d0fc44/libgomp%2Ftestsuite%2Flibgomp.c%2Fdepend-9.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2Fdepend-9.c?ref=3696163cb43bdd7c3a22bef46a0e3f4576d0fc44", "patch": "@@ -0,0 +1,3 @@\n+/* { dg-set-target-env-var OMP_NUM_THREADS \"1\" } */\n+\n+#include \"depend-4.c\""}]}