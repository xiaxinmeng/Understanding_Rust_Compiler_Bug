{"sha": "fe217ba0ee93975a42c5a068156e5a295a5cf844", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmUyMTdiYTBlZTkzOTc1YTQyYzVhMDY4MTU2ZTVhMjk1YTVjZjg0NA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-03-12T23:40:20Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-03-12T23:40:20Z"}, "message": "re PR c++/84808 (ICE with constexpr and array)\n\n\tPR c++/84808\n\t* constexpr.c (find_array_ctor_elt): Don't use elt reference after\n\tfirst potential CONSTRUCTOR_ELTS reallocation.  Convert dindex to\n\tsizetype.  Formatting fixes.\n\n\t* g++.dg/cpp1y/constexpr-84808.C: New test.\n\nFrom-SVN: r258471", "tree": {"sha": "f873ee849e8d064841abbd6b90f19a30ef18a998", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f873ee849e8d064841abbd6b90f19a30ef18a998"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fe217ba0ee93975a42c5a068156e5a295a5cf844", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fe217ba0ee93975a42c5a068156e5a295a5cf844", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fe217ba0ee93975a42c5a068156e5a295a5cf844", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fe217ba0ee93975a42c5a068156e5a295a5cf844/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "038df1baecf93ad9d17ba7deafb47e99b3e287ad", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/038df1baecf93ad9d17ba7deafb47e99b3e287ad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/038df1baecf93ad9d17ba7deafb47e99b3e287ad"}], "stats": {"total": 49, "additions": 44, "deletions": 5}, "files": [{"sha": "9b5f0c36663b9ccf8a9abda06753c2fecfee5a8d", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe217ba0ee93975a42c5a068156e5a295a5cf844/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe217ba0ee93975a42c5a068156e5a295a5cf844/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=fe217ba0ee93975a42c5a068156e5a295a5cf844", "patch": "@@ -1,3 +1,10 @@\n+2018-03-13  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/84808\n+\t* constexpr.c (find_array_ctor_elt): Don't use elt reference after\n+\tfirst potential CONSTRUCTOR_ELTS reallocation.  Convert dindex to\n+\tsizetype.  Formatting fixes.\n+\n 2018-03-12  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/84355 - ICE with deduction for member class template."}, {"sha": "05a1cb64d61e2c6c84b27a564ddd8ae0ddb31326", "filename": "gcc/cp/constexpr.c", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe217ba0ee93975a42c5a068156e5a295a5cf844/gcc%2Fcp%2Fconstexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe217ba0ee93975a42c5a068156e5a295a5cf844/gcc%2Fcp%2Fconstexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fconstexpr.c?ref=fe217ba0ee93975a42c5a068156e5a295a5cf844", "patch": "@@ -2194,9 +2194,9 @@ find_array_ctor_elt (tree ary, tree dindex, bool insert = false)\n      that the same is true of the other elements and index directly.  */\n   if (end > 0)\n     {\n-      tree cindex = (*elts)[end-1].index;\n+      tree cindex = (*elts)[end - 1].index;\n       if (TREE_CODE (cindex) == INTEGER_CST\n-\t  && compare_tree_int (cindex, end-1) == 0)\n+\t  && compare_tree_int (cindex, end - 1) == 0)\n \t{\n \t  if (i < end)\n \t    return i;\n@@ -2225,6 +2225,8 @@ find_array_ctor_elt (tree ary, tree dindex, bool insert = false)\n \t      constructor_elt e;\n \t      tree lo = TREE_OPERAND (idx, 0);\n \t      tree hi = TREE_OPERAND (idx, 1);\n+\t      tree value = elt.value;\n+\t      dindex = fold_convert (sizetype, dindex);\n \t      if (tree_int_cst_lt (lo, dindex))\n \t\t{\n \t\t  /* There are still some lower elts; shorten the range.  */\n@@ -2238,7 +2240,7 @@ find_array_ctor_elt (tree ary, tree dindex, bool insert = false)\n \t\t  /* Append the element we want to insert.  */\n \t\t  ++middle;\n \t\t  e.index = dindex;\n-\t\t  e.value = unshare_constructor (elt.value);\n+\t\t  e.value = unshare_constructor (value);\n \t\t  vec_safe_insert (CONSTRUCTOR_ELTS (ary), middle, e);\n \t\t}\n \t      else\n@@ -2254,8 +2256,8 @@ find_array_ctor_elt (tree ary, tree dindex, bool insert = false)\n \t\t    e.index = hi;\n \t\t  else\n \t\t    e.index = build2 (RANGE_EXPR, sizetype, new_lo, hi);\n-\t\t  e.value = unshare_constructor (elt.value);\n-\t\t  vec_safe_insert (CONSTRUCTOR_ELTS (ary), middle+1, e);\n+\t\t  e.value = unshare_constructor (value);\n+\t\t  vec_safe_insert (CONSTRUCTOR_ELTS (ary), middle + 1, e);\n \t\t}\n \t    }\n \t  return middle;"}, {"sha": "367a269d43709b08e704ea011f4bd681f9f057c1", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe217ba0ee93975a42c5a068156e5a295a5cf844/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe217ba0ee93975a42c5a068156e5a295a5cf844/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=fe217ba0ee93975a42c5a068156e5a295a5cf844", "patch": "@@ -1,5 +1,8 @@\n 2018-03-13  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/84808\n+\t* g++.dg/cpp1y/constexpr-84808.C: New test.\n+\n \tPR c++/84704\n \t* g++.dg/debug/pr84704.C: New test.\n "}, {"sha": "2f0eeac07c7b875a9a4b7051ed062dba0a8933fa", "filename": "gcc/testsuite/g++.dg/cpp1y/constexpr-84808.C", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe217ba0ee93975a42c5a068156e5a295a5cf844/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fconstexpr-84808.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe217ba0ee93975a42c5a068156e5a295a5cf844/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fconstexpr-84808.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fconstexpr-84808.C?ref=fe217ba0ee93975a42c5a068156e5a295a5cf844", "patch": "@@ -0,0 +1,27 @@\n+// PR c++/84808\n+// { dg-do compile { target c++14 } }\n+\n+struct A { int i; constexpr A () : i() {} };\n+struct B { A a[24]; };\n+\n+constexpr int\n+foo (int n)\n+{\n+  B b;\n+  ++b.a[n + 20].i;\n+  ++b.a[n + 18].i;\n+  ++b.a[n + 16].i;\n+  ++b.a[n + 14].i;\n+  ++b.a[n + 12].i;\n+  ++b.a[n + 10].i;\n+  ++b.a[n + 8].i;\n+  ++b.a[n + 6].i;\n+  ++b.a[n + 4].i;\n+  ++b.a[n + 2].i;\n+  ++b.a[n].i;\n+  return b.a[2].i + b.a[4].i + b.a[6].i + b.a[8].i + b.a[10].i\n+\t + b.a[12].i + b.a[14].i + b.a[16].i + b.a[18].i + b.a[20].i + b.a[22].i;\n+}\n+\n+constexpr int i = foo (2);\n+static_assert (i == 11, \"\");"}]}