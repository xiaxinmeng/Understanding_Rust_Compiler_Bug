{"sha": "216a5f1b3fd8bc312748ff226ab5e3c9c2db273c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjE2YTVmMWIzZmQ4YmMzMTI3NDhmZjIyNmFiNWUzYzljMmRiMjczYw==", "commit": {"author": {"name": "Joseph Myers", "email": "jsm@polyomino.org.uk", "date": "2004-10-10T00:47:20Z"}, "committer": {"name": "Joseph Myers", "email": "jsm28@gcc.gnu.org", "date": "2004-10-10T00:47:20Z"}, "message": "re PR c/17189 (bogus warning for  struct Foo { int; };)\n\n\tPR c/17189\n\t* c-decl.c (grokfield): Make diagnostic for bad cases of unnamed\n\tfields a pedwarn.  Pedwarn here for unnamed structs/unions if\n\tpedantic.\n\t* c-parse.in (component_decl): Don't pedwarn here for unnamed\n\tfields.\n\ntestsuite:\n\t* gcc.dg/anon-struct-5.c: New test.\n\nFrom-SVN: r88834", "tree": {"sha": "f192e170635c25ee19d58894e6355d869f6e0d82", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f192e170635c25ee19d58894e6355d869f6e0d82"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/216a5f1b3fd8bc312748ff226ab5e3c9c2db273c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/216a5f1b3fd8bc312748ff226ab5e3c9c2db273c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/216a5f1b3fd8bc312748ff226ab5e3c9c2db273c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/216a5f1b3fd8bc312748ff226ab5e3c9c2db273c/comments", "author": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fb643d23f7fae28aa40eaacb0b23db038feece8e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fb643d23f7fae28aa40eaacb0b23db038feece8e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fb643d23f7fae28aa40eaacb0b23db038feece8e"}], "stats": {"total": 46, "additions": 33, "deletions": 13}, "files": [{"sha": "2437467375f171438a05e6ffcaff047ad36d0b68", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/216a5f1b3fd8bc312748ff226ab5e3c9c2db273c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/216a5f1b3fd8bc312748ff226ab5e3c9c2db273c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=216a5f1b3fd8bc312748ff226ab5e3c9c2db273c", "patch": "@@ -1,3 +1,12 @@\n+2004-10-10  Joseph S. Myers  <jsm@polyomino.org.uk>\n+\n+\tPR c/17189\n+\t* c-decl.c (grokfield): Make diagnostic for bad cases of unnamed\n+\tfields a pedwarn.  Pedwarn here for unnamed structs/unions if\n+\tpedantic.\n+\t* c-parse.in (component_decl): Don't pedwarn here for unnamed\n+\tfields.\n+\n 2004-10-09  Zdenek Dvorak  <dvorakz@suse.cz>\n \n \tPR tree-optimization/17906"}, {"sha": "f2f9a27d7c307edeb52c0c4bd0fd62028c713b55", "filename": "gcc/c-decl.c", "status": "modified", "additions": 12, "deletions": 10, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/216a5f1b3fd8bc312748ff226ab5e3c9c2db273c/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/216a5f1b3fd8bc312748ff226ab5e3c9c2db273c/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=216a5f1b3fd8bc312748ff226ab5e3c9c2db273c", "patch": "@@ -5003,27 +5003,29 @@ grokfield (struct c_declarator *declarator, struct c_declspecs *declspecs,\n \t that took root before someone noticed the bug...  */\n \n       tree type = declspecs->type;\n+      bool type_ok = (TREE_CODE (type) == RECORD_TYPE\n+\t\t      || TREE_CODE (type) == UNION_TYPE);\n+      bool ok = false;\n \n-      if (type\n-\t  && (TREE_CODE (type) == RECORD_TYPE\n-\t      || TREE_CODE (type) == UNION_TYPE)\n+      if (type_ok\n \t  && (flag_ms_extensions || !declspecs->typedef_p))\n \t{\n \t  if (flag_ms_extensions)\n-\t    ; /* ok */\n+\t    ok = true;\n \t  else if (flag_iso)\n-\t    goto warn_unnamed_field;\n+\t    ok = false;\n \t  else if (TYPE_NAME (type) == NULL)\n-\t    ; /* ok */\n+\t    ok = true;\n \t  else\n-\t    goto warn_unnamed_field;\n+\t    ok = false;\n \t}\n-      else\n+      if (!ok)\n \t{\n-\twarn_unnamed_field:\n-\t  warning (\"declaration does not declare anything\");\n+\t  pedwarn (\"declaration does not declare anything\");\n \t  return NULL_TREE;\n \t}\n+      if (pedantic)\n+\tpedwarn (\"ISO C doesn't support unnamed structs/unions\");\n     }\n \n   value = grokdeclarator (declarator, declspecs, FIELD, false,"}, {"sha": "e4696776c5ba6c5469c98aa2c5c5eac09434afad", "filename": "gcc/c-parse.in", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/216a5f1b3fd8bc312748ff226ab5e3c9c2db273c/gcc%2Fc-parse.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/216a5f1b3fd8bc312748ff226ab5e3c9c2db273c/gcc%2Fc-parse.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-parse.in?ref=216a5f1b3fd8bc312748ff226ab5e3c9c2db273c", "patch": "@@ -1738,9 +1738,6 @@ component_decl:\n \t\t  /* Support for unnamed structs or unions as members of\n \t\t     structs or unions (which is [a] useful and [b] supports\n \t\t     MS P-SDK).  */\n-\t\t  if (pedantic)\n-\t\t    pedwarn (\"ISO C doesn't support unnamed structs/unions\");\n-\n \t\t  $$ = grokfield (build_id_declarator (NULL_TREE),\n \t\t\t\t  current_declspecs, NULL_TREE);\n \t\t  POP_DECLSPEC_STACK; }"}, {"sha": "dd56e1b3e62bc40a806cd732725079e457292666", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/216a5f1b3fd8bc312748ff226ab5e3c9c2db273c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/216a5f1b3fd8bc312748ff226ab5e3c9c2db273c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=216a5f1b3fd8bc312748ff226ab5e3c9c2db273c", "patch": "@@ -1,3 +1,8 @@\n+2004-10-10  Joseph S. Myers  <jsm@polyomino.org.uk>\n+\n+\tPR c/17189\n+\t* gcc.dg/anon-struct-5.c: New test.\n+\n 2004-10-09  Joseph S. Myers  <jsm@polyomino.org.uk>\n \n \tPR c/17844"}, {"sha": "f7d1278963c87bf954db4250c4b06fcc2b51f053", "filename": "gcc/testsuite/gcc.dg/anon-struct-5.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/216a5f1b3fd8bc312748ff226ab5e3c9c2db273c/gcc%2Ftestsuite%2Fgcc.dg%2Fanon-struct-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/216a5f1b3fd8bc312748ff226ab5e3c9c2db273c/gcc%2Ftestsuite%2Fgcc.dg%2Fanon-struct-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanon-struct-5.c?ref=216a5f1b3fd8bc312748ff226ab5e3c9c2db273c", "patch": "@@ -0,0 +1,7 @@\n+/* Test bad warning for anonymous int in structure.  Bug 17189.  */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=c99 -pedantic-errors\" } */\n+\n+struct Foo { int; }; /* { dg-bogus \"unnamed\" } */\n+/* { dg-error \"error: declaration does not declare anything\" \"int;\" { target *-*-* } 5 } */\n+/* { dg-error \"error: struct has no members\" \"no members\" { target *-*-* } 5 } */"}]}