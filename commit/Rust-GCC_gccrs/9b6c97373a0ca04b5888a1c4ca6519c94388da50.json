{"sha": "9b6c97373a0ca04b5888a1c4ca6519c94388da50", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWI2Yzk3MzczYTBjYTA0YjU4ODhhMWM0Y2E2NTE5Yzk0Mzg4ZGE1MA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-12-07T23:55:18Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-12-07T23:55:18Z"}, "message": "re PR tree-optimization/83075 (Invalid strncpy optimization)\n\n\tPR tree-optimization/83075\n\t* gcc.dg/tree-ssa/strncpy-2.c: Use size_t instead of unsigned, add\n\tseparate function with noipa attribute to also verify behavior when\n\toptimizers don't know the sizes and aliasing, verify resulting sizes\n\tand array content.  Add -Wstringop-overflow to dg-options.\n\t* gcc.dg/tree-ssa/strncat.c: Likewise.\n\nFrom-SVN: r255485", "tree": {"sha": "3df943309df2540a9af1e2dc0cd7ef3408202d85", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3df943309df2540a9af1e2dc0cd7ef3408202d85"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9b6c97373a0ca04b5888a1c4ca6519c94388da50", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b6c97373a0ca04b5888a1c4ca6519c94388da50", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9b6c97373a0ca04b5888a1c4ca6519c94388da50", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b6c97373a0ca04b5888a1c4ca6519c94388da50/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "38b28c6eb28463feadfc7e18d553f8f2327a2219", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38b28c6eb28463feadfc7e18d553f8f2327a2219", "html_url": "https://github.com/Rust-GCC/gccrs/commit/38b28c6eb28463feadfc7e18d553f8f2327a2219"}], "stats": {"total": 89, "additions": 65, "deletions": 24}, "files": [{"sha": "d4cb0d20fdd8f0a966e13c84581fd38828fa94b5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b6c97373a0ca04b5888a1c4ca6519c94388da50/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b6c97373a0ca04b5888a1c4ca6519c94388da50/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9b6c97373a0ca04b5888a1c4ca6519c94388da50", "patch": "@@ -1,3 +1,12 @@\n+2017-12-08  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/83075\n+\t* gcc.dg/tree-ssa/strncpy-2.c: Use size_t instead of unsigned, add\n+\tseparate function with noipa attribute to also verify behavior when\n+\toptimizers don't know the sizes and aliasing, verify resulting sizes\n+\tand array content.  Add -Wstringop-overflow to dg-options.\n+\t* gcc.dg/tree-ssa/strncat.c: Likewise.\n+\n 2017-12-07  Thomas Preud'homme  <thomas.preudhomme@arm.com>\n \n \t* lib/target-supports.exp (check_effective_target_fstack_protector):"}, {"sha": "9b8cf238297e8947f35090f013ae6b7c9f56a4d4", "filename": "gcc/testsuite/gcc.dg/tree-ssa/strncat.c", "status": "modified", "additions": 28, "deletions": 12, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b6c97373a0ca04b5888a1c4ca6519c94388da50/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fstrncat.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b6c97373a0ca04b5888a1c4ca6519c94388da50/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fstrncat.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fstrncat.c?ref=9b6c97373a0ca04b5888a1c4ca6519c94388da50", "patch": "@@ -1,19 +1,35 @@\n-/* PR tree-optimization/83075 - Invalid strncpy optimization\n-   { dg-do run }\n-   { dg-options \"-O2 -Wno-stringop-overflow\" } */\n+/* PR tree-optimization/83075 - Invalid strncpy optimization */\n+/* { dg-do run } */\n+/* { dg-options \"-O2 -Wstringop-overflow\" } */\n \n-int main (void)\n+typedef __SIZE_TYPE__ size_t;\n+\n+__attribute__((noipa)) size_t\n+foo (char *p, char *q, size_t *r)\n {\n-  char a[8] = \"\";\n+  size_t n0 = __builtin_strlen (p);\n+  __builtin_strncat (q, p, n0);\t\t/* { dg-warning \"specified bound depends on the length\" } */\n+  size_t n1 = __builtin_strlen (p);\n+  *r = n0;\n+  return n1;\n+}\n \n+int\n+main ()\n+{\n+  char a[8] = \"\";\n   __builtin_strcpy (a, \"123\");\n-\n-  unsigned n0 = __builtin_strlen (a);\n-\n-  __builtin_strncat (a + 3, a, n0);\n-\n-  unsigned n1 = __builtin_strlen (a);\n-\n+  size_t n0 = __builtin_strlen (a);\n+  __builtin_strncat (a + 3, a, n0);\t/* { dg-warning \"specified bound depends on the length\" } */\n+  size_t n1 = __builtin_strlen (a);\n   if (n1 == n0)\n     __builtin_abort ();\n+  a[6] = '7';\n+  __builtin_strcpy (a, \"456\");\n+  size_t n2;\n+  if (foo (a, a + 3, &n2) != 6 || n2 != 3)\n+    __builtin_abort ();\n+  if (__builtin_memcmp (a, \"456456\\0\", sizeof \"456456\\0\"))\n+    __builtin_abort ();\n+  return 0;\n }"}, {"sha": "2ef9cd61bee7ef5ca2a0c850fe6a47ab031f1a90", "filename": "gcc/testsuite/gcc.dg/tree-ssa/strncpy-2.c", "status": "modified", "additions": 28, "deletions": 12, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b6c97373a0ca04b5888a1c4ca6519c94388da50/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fstrncpy-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b6c97373a0ca04b5888a1c4ca6519c94388da50/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fstrncpy-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fstrncpy-2.c?ref=9b6c97373a0ca04b5888a1c4ca6519c94388da50", "patch": "@@ -1,19 +1,35 @@\n-/* PR tree-optimization/83075 - Invalid strncpy optimization\n-   { dg-do run }\n-   { dg-options \"-O2 -Wno-stringop-overflow\" } */\n+/* PR tree-optimization/83075 - Invalid strncpy optimization */\n+/* { dg-do run } */\n+/* { dg-options \"-O2 -Wstringop-overflow\" } */\n \n-int main (void)\n+typedef __SIZE_TYPE__ size_t;\n+\n+__attribute__((noipa)) size_t\n+foo (char *p, char *q, size_t *r)\n {\n-  char a[8] = \"\";\n+  size_t n0 = __builtin_strlen (p);\n+  __builtin_strncpy (q, p, n0);\t\t/* { dg-warning \"specified bound depends on the length\" } */\n+  size_t n1 = __builtin_strlen (p);\n+  *r = n0;\n+  return n1;\n+}\n \n+int\n+main ()\n+{\n+  char a[8] = \"\";\n   __builtin_strcpy (a, \"123\");\n-\n-  unsigned n0 = __builtin_strlen (a);\n-\n-  __builtin_strncpy (a + 3, a, n0);\n-\n-  unsigned n1 = __builtin_strlen (a);\n-\n+  size_t n0 = __builtin_strlen (a);\n+  __builtin_strncpy (a + 3, a, n0);\t/* { dg-warning \"specified bound depends on the length\" } */\n+  size_t n1 = __builtin_strlen (a);\n   if (n1 == n0)\n     __builtin_abort ();\n+  a[6] = '7';\n+  __builtin_strcpy (a, \"456\");\n+  size_t n2;\n+  if (foo (a, a + 3, &n2) != 7 || n2 != 3)\n+    __builtin_abort ();\n+  if (__builtin_memcmp (a, \"4564567\", sizeof \"4564567\"))\n+    __builtin_abort ();\n+  return 0;\n }"}]}