{"sha": "4876b2b427de2df3c92aee16b7fbd7348022026f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDg3NmIyYjQyN2RlMmRmM2M5MmFlZTE2YjdmYmQ3MzQ4MDIyMDI2Zg==", "commit": {"author": {"name": "Daniel Jacobowitz", "email": "drow@mvista.com", "date": "2003-02-20T22:11:13Z"}, "committer": {"name": "Daniel Jacobowitz", "email": "drow@gcc.gnu.org", "date": "2003-02-20T22:11:13Z"}, "message": "Makefile.in (CFILES): Add lrealpath.c.\n\n\t* Makefile.in (CFILES): Add lrealpath.c.\n\t(REQUIRED_OFILES): Add lrealpath.o.\n\t(lrealpath.o): Add rule.\n\t* aclocal.m4 (libiberty_NEED_DECLARATION): Add.\n\t* configure.in: Add realpath and canonicalize_file_name to\n\tcheckfuncs and AC_CHECK_FUNCS.  Use libiberty_NEED_DECLARATION\n\tfor canonicalize_file_name.\n\t* lrealpath.c: New file.\n\t* make-relative-prefix.c: Update documentation.\n\t(make_relative_prefix): Simplify.  Use lbasename and lrealpath.\n\t* config.in: Regenerated.\n\t* configure: Regenerated.\n\t* functions.texi: Regenerated.\n\nFrom-SVN: r63186", "tree": {"sha": "e345914b98acba3281c7933fd21ce8beecd43bb6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e345914b98acba3281c7933fd21ce8beecd43bb6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4876b2b427de2df3c92aee16b7fbd7348022026f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4876b2b427de2df3c92aee16b7fbd7348022026f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4876b2b427de2df3c92aee16b7fbd7348022026f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4876b2b427de2df3c92aee16b7fbd7348022026f/comments", "author": null, "committer": null, "parents": [{"sha": "378ca31ee55f94be3bed464c205b09e0e64a9a52", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/378ca31ee55f94be3bed464c205b09e0e64a9a52", "html_url": "https://github.com/Rust-GCC/gccrs/commit/378ca31ee55f94be3bed464c205b09e0e64a9a52"}], "stats": {"total": 547, "additions": 426, "deletions": 121}, "files": [{"sha": "f4703805c720b542197285f565f2f2f2106bd724", "filename": "libiberty/ChangeLog", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2FChangeLog?ref=4876b2b427de2df3c92aee16b7fbd7348022026f", "patch": "@@ -1,3 +1,19 @@\n+2003-02-20  Daniel Jacobowitz  <drow@mvista.com>\n+\n+\t* Makefile.in (CFILES): Add lrealpath.c.\n+\t(REQUIRED_OFILES): Add lrealpath.o.\n+\t(lrealpath.o): Add rule.\n+\t* aclocal.m4 (libiberty_NEED_DECLARATION): Add.\n+\t* configure.in: Add realpath and canonicalize_file_name to\n+\tcheckfuncs and AC_CHECK_FUNCS.  Use libiberty_NEED_DECLARATION\n+\tfor canonicalize_file_name.\n+\t* lrealpath.c: New file.\n+\t* make-relative-prefix.c: Update documentation.\n+\t(make_relative_prefix): Simplify.  Use lbasename and lrealpath.\n+\t* config.in: Regenerated.\n+\t* configure: Regenerated.\n+\t* functions.texi: Regenerated.\n+\n 2003-02-20  jmc  <jmc@prioris.mini.pw.edu.pl>\n \n \t* cplus_dem.c: Fix typo: intializes -> initializes."}, {"sha": "c5763579a8661addeb58bd5a6df6e3f1a620f78c", "filename": "libiberty/Makefile.in", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2FMakefile.in?ref=4876b2b427de2df3c92aee16b7fbd7348022026f", "patch": "@@ -137,6 +137,7 @@ CFILES = alloca.c argv.c asprintf.c atexit.c\t\t\t\t\\\n \thashtab.c hex.c\t\t\t\t\t\t\t\\\n \tindex.c insque.c\t\t\t\t\t\t\\\n \tlbasename.c\t\t\t\t\t\t\t\\\n+\tlrealpath.c\t\t\t\t\t\t\t\\\n \tmake-relative-prefix.c\t\t\t\t\t\t\\\n \tmake-temp-file.c md5.c memchr.c memcmp.c memcpy.c memmove.c\t\\\n \t memset.c mkstemps.c\t\t\t\t\t\t\\\n@@ -165,6 +166,7 @@ REQUIRED_OFILES = regex.o cplus-dem.o cp-demangle.o md5.o\t\t\\\n \tgetopt.o getopt1.o getpwd.o getruntime.o\t\t\t\\\n \thashtab.o hex.o\t\t\t\t\t\t\t\\\n \tlbasename.o\t\t\t\t\t\t\t\\\n+\tlrealpath.o\t\t\t\t\t\t\t\\\n \tmake-relative-prefix.o\t\t\t\t\t\t\\\n \tmake-temp-file.o\t\t\t\t\t\t\\\n \tobjalloc.o obstack.o\t\t\t\t\t\t\\\n@@ -443,6 +445,7 @@ hashtab.o: config.h $(INCDIR)/ansidecl.h $(INCDIR)/hashtab.h \\\n hex.o: $(INCDIR)/ansidecl.h $(INCDIR)/libiberty.h\n lbasename.o: $(INCDIR)/ansidecl.h $(INCDIR)/libiberty.h \\\n \t$(INCDIR)/safe-ctype.h\n+lrealpath.o: config.h $(INCDIR)/ansidecl.h $(INCDIR)/libiberty.h\n make-relative-prefix.o: config.h $(INCDIR)/ansidecl.h $(INCDIR)/libiberty.h\n make-temp-file.o: config.h $(INCDIR)/ansidecl.h $(INCDIR)/libiberty.h\n md5.o: config.h $(INCDIR)/ansidecl.h $(INCDIR)/md5.h"}, {"sha": "6c5dc6ac64b43e9f82c72d3699ce7de171c42c61", "filename": "libiberty/aclocal.m4", "status": "modified", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2Faclocal.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2Faclocal.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Faclocal.m4?ref=4876b2b427de2df3c92aee16b7fbd7348022026f", "patch": "@@ -87,6 +87,35 @@ then AC_DEFINE(NEED_DECLARATION_ERRNO, 1,\n fi\n ])\n \n+dnl See whether we need a declaration for a function.\n+AC_DEFUN(libiberty_NEED_DECLARATION,\n+[AC_MSG_CHECKING([whether $1 must be declared])\n+AC_CACHE_VAL(libiberty_cv_decl_needed_$1,\n+[AC_TRY_COMPILE([\n+#include \"confdefs.h\"\n+#include <stdio.h>\n+#ifdef HAVE_STRING_H\n+#include <string.h>\n+#else\n+#ifdef HAVE_STRINGS_H\n+#include <strings.h>\n+#endif\n+#endif\n+#ifdef HAVE_STDLIB_H\n+#include <stdlib.h>\n+#endif\n+#ifdef HAVE_UNISTD_H\n+#include <unistd.h>\n+#endif],\n+[char *(*pfn) = (char *(*)) $1],\n+libiberty_cv_decl_needed_$1=no, libiberty_cv_decl_needed_$1=yes)])\n+AC_MSG_RESULT($libiberty_cv_decl_needed_$1)\n+if test $libiberty_cv_decl_needed_$1 = yes; then\n+  AC_DEFINE([NEED_DECLARATION_]translit($1, [a-z], [A-Z]), 1,\n+            [Define if $1 is not declared in system header files.])\n+fi\n+])dnl\n+\n # FIXME: We temporarily define our own version of AC_PROG_CC.  This is\n # copied from autoconf 2.12, but does not call AC_PROG_CC_WORKS.  We\n # are probably using a cross compiler, which will not be able to fully"}, {"sha": "738f075fff609fa36e4f5559a0faaea009bea32b", "filename": "libiberty/config.in", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2Fconfig.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2Fconfig.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fconfig.in?ref=4876b2b427de2df3c92aee16b7fbd7348022026f", "patch": "@@ -1,4 +1,4 @@\n-/* config.in.  Generated automatically from configure.in by autoheader.  */\n+/* config.in.  Generated automatically from configure.in by autoheader 2.13.  */\n \n /* Define to empty if the keyword does not work.  */\n #undef const\n@@ -63,6 +63,9 @@\n /* Define if you have the calloc function.  */\n #undef HAVE_CALLOC\n \n+/* Define if you have the canonicalize_file_name function.  */\n+#undef HAVE_CANONICALIZE_FILE_NAME\n+\n /* Define if you have the clock function.  */\n #undef HAVE_CLOCK\n \n@@ -117,6 +120,9 @@\n /* Define if you have the random function.  */\n #undef HAVE_RANDOM\n \n+/* Define if you have the realpath function.  */\n+#undef HAVE_REALPATH\n+\n /* Define if you have the rename function.  */\n #undef HAVE_RENAME\n \n@@ -258,3 +264,6 @@\n         STACK_DIRECTION = 0 => direction of growth unknown */\n #undef STACK_DIRECTION\n \n+/* Define if canonicalize_file_name is not declared in system header files. */\n+#undef NEED_DECLARATION_CANONICALIZE_FILE_NAME\n+"}, {"sha": "320d8546a026e6038ddd275c971e17ec167b7270", "filename": "libiberty/configure", "status": "modified", "additions": 177, "deletions": 86, "changes": 263, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fconfigure?ref=4876b2b427de2df3c92aee16b7fbd7348022026f", "patch": "@@ -1738,19 +1738,20 @@ funcs=\"$funcs waitpid\"\n vars=\"sys_errlist sys_nerr sys_siglist\"\n \n checkfuncs=\"getrusage on_exit psignal strerror strsignal sysconf times sbrk gettimeofday\"\n+checkfuncs=\"$checkfuncs realpath canonicalize_file_name\"\n \n # These are neither executed nor required, but they help keep\n # autoheader happy without adding a bunch of text to acconfig.h.\n if test \"x\" = \"y\"; then\n   for ac_func in asprintf atexit basename bcmp bcopy bsearch bzero calloc clock\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:1749: checking for $ac_func\" >&5\n+echo \"configure:1750: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1754 \"configure\"\n+#line 1755 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -1773,7 +1774,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:1777: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:1778: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -1800,12 +1801,12 @@ done\n   for ac_func in getcwd getpagesize index insque mkstemps memchr memcmp memcpy\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:1804: checking for $ac_func\" >&5\n+echo \"configure:1805: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1809 \"configure\"\n+#line 1810 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -1828,7 +1829,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:1832: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:1833: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -1855,12 +1856,12 @@ done\n   for ac_func in memmove memset putenv random rename rindex sigsetmask\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:1859: checking for $ac_func\" >&5\n+echo \"configure:1860: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1864 \"configure\"\n+#line 1865 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -1883,7 +1884,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:1887: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:1888: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -1910,12 +1911,12 @@ done\n   for ac_func in strcasecmp setenv strchr strdup strncasecmp strrchr strstr\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:1914: checking for $ac_func\" >&5\n+echo \"configure:1915: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1919 \"configure\"\n+#line 1920 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -1938,7 +1939,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:1942: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:1943: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -1965,12 +1966,12 @@ done\n   for ac_func in strtod strtol strtoul tmpnam vasprintf vfprintf vprintf\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:1969: checking for $ac_func\" >&5\n+echo \"configure:1970: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1974 \"configure\"\n+#line 1975 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -1993,7 +1994,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:1997: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:1998: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2020,12 +2021,12 @@ done\n   for ac_func in vsprintf waitpid getrusage on_exit psignal strerror strsignal\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2024: checking for $ac_func\" >&5\n+echo \"configure:2025: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2029 \"configure\"\n+#line 2030 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2048,7 +2049,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2052: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2053: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2075,12 +2076,12 @@ done\n   for ac_func in sysconf times sbrk gettimeofday ffs\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2079: checking for $ac_func\" >&5\n+echo \"configure:2080: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2084 \"configure\"\n+#line 2085 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2103,7 +2104,62 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2107: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2108: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+  rm -rf conftest*\n+  eval \"ac_cv_func_$ac_func=yes\"\n+else\n+  echo \"configure: failed program was:\" >&5\n+  cat conftest.$ac_ext >&5\n+  rm -rf conftest*\n+  eval \"ac_cv_func_$ac_func=no\"\n+fi\n+rm -f conftest*\n+fi\n+\n+if eval \"test \\\"`echo '$ac_cv_func_'$ac_func`\\\" = yes\"; then\n+  echo \"$ac_t\"\"yes\" 1>&6\n+    ac_tr_func=HAVE_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`\n+  cat >> confdefs.h <<EOF\n+#define $ac_tr_func 1\n+EOF\n+ \n+else\n+  echo \"$ac_t\"\"no\" 1>&6\n+fi\n+done\n+\n+  for ac_func in realpath canonicalize_file_name\n+do\n+echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n+echo \"configure:2135: checking for $ac_func\" >&5\n+if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  cat > conftest.$ac_ext <<EOF\n+#line 2140 \"configure\"\n+#include \"confdefs.h\"\n+/* System header to define __stub macros and hopefully few prototypes,\n+    which can conflict with char $ac_func(); below.  */\n+#include <assert.h>\n+/* Override any gcc2 internal prototype to avoid an error.  */\n+/* We use char because int might match the return type of a gcc2\n+    builtin and then its argument prototype would still apply.  */\n+char $ac_func();\n+\n+int main() {\n+\n+/* The GNU C library defines this for functions which it implements\n+    to always fail with ENOSYS.  Some functions are actually named\n+    something starting with __ and the normal name is an alias.  */\n+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)\n+choke me\n+#else\n+$ac_func();\n+#endif\n+\n+; return 0; }\n+EOF\n+if { (eval echo configure:2163: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2333,7 +2389,7 @@ if test -z \"${setobjs}\"; then\n   # We haven't set the list of objects yet.  Use the standard autoconf\n   # tests.  This will only work if the compiler works.\n   echo $ac_n \"checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works\"\"... $ac_c\" 1>&6\n-echo \"configure:2337: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works\" >&5\n+echo \"configure:2393: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works\" >&5\n \n ac_ext=c\n # CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.\n@@ -2344,12 +2400,12 @@ cross_compiling=$ac_cv_prog_cc_cross\n \n cat > conftest.$ac_ext << EOF\n \n-#line 2348 \"configure\"\n+#line 2404 \"configure\"\n #include \"confdefs.h\"\n \n main(){return(0);}\n EOF\n-if { (eval echo configure:2353: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2409: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   ac_cv_prog_cc_works=yes\n   # If we can't run a trivial program, we are probably using a cross compiler.\n   if (./conftest; exit) 2>/dev/null; then\n@@ -2375,19 +2431,19 @@ if test $ac_cv_prog_cc_works = no; then\n   { echo \"configure: error: installation or configuration problem: C compiler cannot create executables.\" 1>&2; exit 1; }\n fi\n echo $ac_n \"checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler\"\"... $ac_c\" 1>&6\n-echo \"configure:2379: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler\" >&5\n+echo \"configure:2435: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler\" >&5\n echo \"$ac_t\"\"$ac_cv_prog_cc_cross\" 1>&6\n cross_compiling=$ac_cv_prog_cc_cross\n \n   for ac_func in $funcs\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2386: checking for $ac_func\" >&5\n+echo \"configure:2442: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2391 \"configure\"\n+#line 2447 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2410,7 +2466,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2414: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2470: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2437,12 +2493,12 @@ done\n \n \n   echo $ac_n \"checking whether alloca needs Cray hooks\"\"... $ac_c\" 1>&6\n-echo \"configure:2441: checking whether alloca needs Cray hooks\" >&5\n+echo \"configure:2497: checking whether alloca needs Cray hooks\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_os_cray'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2446 \"configure\"\n+#line 2502 \"configure\"\n #include \"confdefs.h\"\n #if defined(CRAY) && ! defined(CRAY2)\n webecray\n@@ -2467,12 +2523,12 @@ echo \"$ac_t\"\"$ac_cv_os_cray\" 1>&6\n if test $ac_cv_os_cray = yes; then\n   for ac_func in _getb67 GETB67 getb67; do\n     echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2471: checking for $ac_func\" >&5\n+echo \"configure:2527: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2476 \"configure\"\n+#line 2532 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2495,7 +2551,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2499: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2555: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2521,15 +2577,15 @@ fi\n fi\n \n echo $ac_n \"checking stack direction for C alloca\"\"... $ac_c\" 1>&6\n-echo \"configure:2525: checking stack direction for C alloca\" >&5\n+echo \"configure:2581: checking stack direction for C alloca\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_c_stack_direction'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test \"$cross_compiling\" = yes; then\n   ac_cv_c_stack_direction=0\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2533 \"configure\"\n+#line 2589 \"configure\"\n #include \"confdefs.h\"\n find_stack_direction ()\n {\n@@ -2548,7 +2604,7 @@ main ()\n   exit (find_stack_direction() < 0);\n }\n EOF\n-if { (eval echo configure:2552: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:2608: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   ac_cv_c_stack_direction=1\n else\n@@ -2570,17 +2626,17 @@ EOF\n \n   ac_safe=`echo \"vfork.h\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for vfork.h\"\"... $ac_c\" 1>&6\n-echo \"configure:2574: checking for vfork.h\" >&5\n+echo \"configure:2630: checking for vfork.h\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2579 \"configure\"\n+#line 2635 \"configure\"\n #include \"confdefs.h\"\n #include <vfork.h>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:2584: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:2640: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -2605,18 +2661,18 @@ else\n fi\n \n echo $ac_n \"checking for working vfork\"\"... $ac_c\" 1>&6\n-echo \"configure:2609: checking for working vfork\" >&5\n+echo \"configure:2665: checking for working vfork\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_vfork_works'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test \"$cross_compiling\" = yes; then\n   echo $ac_n \"checking for vfork\"\"... $ac_c\" 1>&6\n-echo \"configure:2615: checking for vfork\" >&5\n+echo \"configure:2671: checking for vfork\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_vfork'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2620 \"configure\"\n+#line 2676 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char vfork(); below.  */\n@@ -2639,7 +2695,7 @@ vfork();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2643: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2699: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_vfork=yes\"\n else\n@@ -2661,7 +2717,7 @@ fi\n ac_cv_func_vfork_works=$ac_cv_func_vfork\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2665 \"configure\"\n+#line 2721 \"configure\"\n #include \"confdefs.h\"\n /* Thanks to Paul Eggert for this test.  */\n #include <stdio.h>\n@@ -2756,7 +2812,7 @@ main() {\n   }\n }\n EOF\n-if { (eval echo configure:2760: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:2816: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   ac_cv_func_vfork_works=yes\n else\n@@ -2788,12 +2844,12 @@ fi\n     for ac_func in _doprnt\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2792: checking for $ac_func\" >&5\n+echo \"configure:2848: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2797 \"configure\"\n+#line 2853 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2816,7 +2872,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2820: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2876: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2846,12 +2902,12 @@ done\n     for ac_func in _doprnt\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2850: checking for $ac_func\" >&5\n+echo \"configure:2906: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2855 \"configure\"\n+#line 2911 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2874,7 +2930,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2878: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2934: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2902,19 +2958,19 @@ done\n \n   for v in $vars; do\n     echo $ac_n \"checking for $v\"\"... $ac_c\" 1>&6\n-echo \"configure:2906: checking for $v\" >&5\n+echo \"configure:2962: checking for $v\" >&5\n     if eval \"test \\\"`echo '$''{'libiberty_cv_var_$v'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2911 \"configure\"\n+#line 2967 \"configure\"\n #include \"confdefs.h\"\n int *p;\n int main() {\n extern int $v []; p = $v;\n ; return 0; }\n EOF\n-if { (eval echo configure:2918: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2974: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"libiberty_cv_var_$v=yes\"\n else\n@@ -2940,12 +2996,12 @@ EOF\n   for ac_func in $checkfuncs\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2944: checking for $ac_func\" >&5\n+echo \"configure:3000: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2949 \"configure\"\n+#line 3005 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2968,7 +3024,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2972: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3028: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2992,6 +3048,54 @@ else\n fi\n done\n \n+  echo $ac_n \"checking whether canonicalize_file_name must be declared\"\"... $ac_c\" 1>&6\n+echo \"configure:3053: checking whether canonicalize_file_name must be declared\" >&5\n+if eval \"test \\\"`echo '$''{'libiberty_cv_decl_needed_canonicalize_file_name'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  cat > conftest.$ac_ext <<EOF\n+#line 3058 \"configure\"\n+#include \"confdefs.h\"\n+\n+#include \"confdefs.h\"\n+#include <stdio.h>\n+#ifdef HAVE_STRING_H\n+#include <string.h>\n+#else\n+#ifdef HAVE_STRINGS_H\n+#include <strings.h>\n+#endif\n+#endif\n+#ifdef HAVE_STDLIB_H\n+#include <stdlib.h>\n+#endif\n+#ifdef HAVE_UNISTD_H\n+#include <unistd.h>\n+#endif\n+int main() {\n+char *(*pfn) = (char *(*)) canonicalize_file_name\n+; return 0; }\n+EOF\n+if { (eval echo configure:3080: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+  rm -rf conftest*\n+  libiberty_cv_decl_needed_canonicalize_file_name=no\n+else\n+  echo \"configure: failed program was:\" >&5\n+  cat conftest.$ac_ext >&5\n+  rm -rf conftest*\n+  libiberty_cv_decl_needed_canonicalize_file_name=yes\n+fi\n+rm -f conftest*\n+fi\n+\n+echo \"$ac_t\"\"$libiberty_cv_decl_needed_canonicalize_file_name\" 1>&6\n+if test $libiberty_cv_decl_needed_canonicalize_file_name = yes; then\n+  cat >> confdefs.h <<\\EOF\n+#define NEED_DECLARATION_CANONICALIZE_FILE_NAME 1\n+EOF\n+\n+fi\n+\n fi\n \n # Figure out which version of pexecute to use.\n@@ -3004,21 +3108,21 @@ case \"${host}\" in\n esac\n \n \n-for ac_hdr in stdlib.h unistd.h sys/stat.h sys/types.h\n+for ac_hdr in unistd.h\n do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:3012: checking for $ac_hdr\" >&5\n+echo \"configure:3116: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3017 \"configure\"\n+#line 3121 \"configure\"\n #include \"confdefs.h\"\n #include <$ac_hdr>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:3022: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:3126: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -3047,12 +3151,12 @@ done\n for ac_func in getpagesize\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3051: checking for $ac_func\" >&5\n+echo \"configure:3155: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3056 \"configure\"\n+#line 3160 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3075,7 +3179,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3079: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3183: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3100,15 +3204,15 @@ fi\n done\n \n echo $ac_n \"checking for working mmap\"\"... $ac_c\" 1>&6\n-echo \"configure:3104: checking for working mmap\" >&5\n+echo \"configure:3208: checking for working mmap\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_mmap_fixed_mapped'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test \"$cross_compiling\" = yes; then\n   ac_cv_func_mmap_fixed_mapped=no\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3112 \"configure\"\n+#line 3216 \"configure\"\n #include \"confdefs.h\"\n \n /* Thanks to Mike Haertel and Jim Avera for this test.\n@@ -3136,24 +3240,11 @@ else\n #include <fcntl.h>\n #include <sys/mman.h>\n \n-#if HAVE_SYS_TYPES_H\n-# include <sys/types.h>\n-#endif\n-\n-#if HAVE_STDLIB_H\n-# include <stdlib.h>\n-#endif\n-\n-#if HAVE_SYS_STAT_H\n-# include <sys/stat.h>\n-#endif\n-\n-#if HAVE_UNISTD_H\n-# include <unistd.h>\n-#endif\n-\n /* This mess was copied from the GNU getpagesize.h.  */\n #ifndef HAVE_GETPAGESIZE\n+# ifdef HAVE_UNISTD_H\n+#  include <unistd.h>\n+# endif\n \n /* Assume that all systems that can run configure have sys/param.h.  */\n # ifndef HAVE_SYS_PARAM_H\n@@ -3261,7 +3352,7 @@ main()\n }\n \n EOF\n-if { (eval echo configure:3265: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:3356: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   ac_cv_func_mmap_fixed_mapped=yes\n else\n@@ -3285,15 +3376,15 @@ fi\n \n \n echo $ac_n \"checking for working strncmp\"\"... $ac_c\" 1>&6\n-echo \"configure:3289: checking for working strncmp\" >&5\n+echo \"configure:3380: checking for working strncmp\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_strncmp_works'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test \"$cross_compiling\" = yes; then\n   ac_cv_func_strncmp_works=no\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3297 \"configure\"\n+#line 3388 \"configure\"\n #include \"confdefs.h\"\n \n /* Test by Jim Wilson and Kaveh Ghazi.\n@@ -3357,7 +3448,7 @@ main ()\n }\n \n EOF\n-if { (eval echo configure:3361: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:3452: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   ac_cv_func_strncmp_works=yes\n else"}, {"sha": "d170a9f7e11977856e83a51d70cda5c62076271d", "filename": "libiberty/configure.in", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2Fconfigure.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2Fconfigure.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fconfigure.in?ref=4876b2b427de2df3c92aee16b7fbd7348022026f", "patch": "@@ -207,6 +207,7 @@ funcs=\"$funcs waitpid\"\n vars=\"sys_errlist sys_nerr sys_siglist\"\n \n checkfuncs=\"getrusage on_exit psignal strerror strsignal sysconf times sbrk gettimeofday\"\n+checkfuncs=\"$checkfuncs realpath canonicalize_file_name\"\n \n # These are neither executed nor required, but they help keep\n # autoheader happy without adding a bunch of text to acconfig.h.\n@@ -218,6 +219,7 @@ if test \"x\" = \"y\"; then\n   AC_CHECK_FUNCS(strtod strtol strtoul tmpnam vasprintf vfprintf vprintf)\n   AC_CHECK_FUNCS(vsprintf waitpid getrusage on_exit psignal strerror strsignal)\n   AC_CHECK_FUNCS(sysconf times sbrk gettimeofday ffs)\n+  AC_CHECK_FUNCS(realpath canonicalize_file_name)\n   AC_DEFINE(HAVE_SYS_ERRLIST, 1, [Define if you have the sys_errlist variable.])\n   AC_DEFINE(HAVE_SYS_NERR,    1, [Define if you have the sys_nerr variable.])\n   AC_DEFINE(HAVE_SYS_SIGLIST, 1, [Define if you have the sys_siglist variable.])\n@@ -424,6 +426,7 @@ if test -z \"${setobjs}\"; then\n     fi\n   done\n   AC_CHECK_FUNCS($checkfuncs)\n+  libiberty_NEED_DECLARATION(canonicalize_file_name)\n fi\n \n # Figure out which version of pexecute to use."}, {"sha": "2c7b9e1276ac768777e7e36b8fb7fddef8b992aa", "filename": "libiberty/functions.texi", "status": "modified", "additions": 29, "deletions": 10, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2Ffunctions.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2Ffunctions.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Ffunctions.texi?ref=4876b2b427de2df3c92aee16b7fbd7348022026f", "patch": "@@ -392,19 +392,38 @@ and a path ending in @code{/} returns the empty string after it.\n \n @end deftypefn\n \n-@c make-relative-prefix.c:24\n-@deftypefn Extension {const char*} make_relative_prefix (const char *@var{progname}, const char *@var{bin_prefix}, const char *@var{prefix})\n+@c lrealpath.c:25\n+@deftypefn Replacement {const char*} lrealpath (const char *@var{name})\n+\n+Given a pointer to a string containing a pathname, returns a canonical\n+version of the filename.  Symlinks will be resolved, and ``.'' and ``..''\n+components will be simplified.  The returned value will be allocated using\n+@code{xmalloc} or @code{malloc}.\n \n-Given three strings @var{progname}, @var{bin_prefix}, @var{prefix}, return a string\n-that gets to @var{prefix} starting with the directory portion of @var{progname} and\n-a relative pathname of the difference between @var{bin_prefix} and @var{prefix}.\n+@end deftypefn\n \n-For example, if @var{bin_prefix} is @code{/alpha/beta/gamma/gcc/delta}, @var{prefix}\n-is @code{/alpha/beta/gamma/omega/}, and @var{progname} is @code{/red/green/blue/gcc},\n-then this function will return @code{/red/green/blue/../../omega/}.\n+@c make-relative-prefix.c:24\n+@deftypefn Extension {const char*} make_relative_prefix (const char *@var{progname}, const char *@var{bin_prefix}, const char *@var{prefix})\n \n-The return value is normally allocated via @code{malloc}.  If no relative prefix\n-can be found, return @code{NULL}.\n+Given three paths @var{progname}, @var{bin_prefix}, @var{prefix},\n+return the path that is in the same position relative to\n+@var{progname}'s directory as @var{prefix} is relative to\n+@var{bin_prefix}.  That is, a string starting with the directory\n+portion of @var{progname}, followed by a relative pathname of the\n+difference between @var{bin_prefix} and @var{prefix}.\n+\n+If @var{progname} does not contain any directory separators,\n+@code{make_relative_prefix} will search @env{PATH} to find a program\n+named @var{progname}.  Also, if @var{progname} is a symbolic link,\n+the symbolic link will be resolved.\n+\n+For example, if @var{bin_prefix} is @code{/alpha/beta/gamma/gcc/delta},\n+@var{prefix} is @code{/alpha/beta/gamma/omega/}, and @var{progname} is\n+@code{/red/green/blue/gcc}, then this function will return\n+@code{/red/green/blue/../../omega/}.\n+\n+The return value is normally allocated via @code{malloc}.  If no\n+relative prefix can be found, return @code{NULL}.\n \n @end deftypefn\n "}, {"sha": "b001b38ef66325a61f93d8d8a81c64b6cd78eced", "filename": "libiberty/lrealpath.c", "status": "added", "additions": 128, "deletions": 0, "changes": 128, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2Flrealpath.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2Flrealpath.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Flrealpath.c?ref=4876b2b427de2df3c92aee16b7fbd7348022026f", "patch": "@@ -0,0 +1,128 @@\n+/* Libiberty realpath.  Like realpath, but more consistent behavior.\n+   Based on gdb_realpath from GDB.\n+\n+   Copyright 2003 Free Software Foundation, Inc.\n+\n+   This file is part of the libiberty library.\n+\n+   This program is free software; you can redistribute it and/or modify\n+   it under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 2 of the License, or\n+   (at your option) any later version.\n+\n+   This program is distributed in the hope that it will be useful,\n+   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+   GNU General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with this program; if not, write to the Free Software\n+   Foundation, Inc., 59 Temple Place - Suite 330,\n+   Boston, MA 02111-1307, USA.  */\n+\n+/*\n+\n+@deftypefn Replacement {const char*} lrealpath (const char *@var{name})\n+\n+Given a pointer to a string containing a pathname, returns a canonical\n+version of the filename.  Symlinks will be resolved, and ``.'' and ``..''\n+components will be simplified.  The returned value will be allocated using\n+@code{malloc}, or @code{NULL} will be returned on a memory allocation error.\n+\n+@end deftypefn\n+\n+*/\n+\n+#include \"config.h\"\n+#include \"ansidecl.h\"\n+#include \"libiberty.h\"\n+\n+#ifdef HAVE_LIMITS_H\n+#include <limits.h>\n+#endif\n+#ifdef HAVE_STDLIB_H\n+#include <stdlib.h>\n+#endif\n+#ifdef HAVE_UNISTD_H\n+#include <unistd.h>\n+#endif\n+#ifdef HAVE_STRING_H\n+#include <string.h>\n+#endif\n+\n+/* On GNU libc systems the declaration is only visible with _GNU_SOURCE.  */\n+#if defined(HAVE_CANONICALIZE_FILE_NAME) \\\n+    && defined(NEED_DECLARATION_CANONICALIZE_FILE_NAME)\n+extern char *canonicalize_file_name (const char *);\n+#endif\n+\n+#if defined(HAVE_REALPATH)\n+# if defined (PATH_MAX)\n+#  define REALPATH_LIMIT PATH_MAX\n+# else\n+#  if defined (MAXPATHLEN)\n+#   define REALPATH_LIMIT MAXPATHLEN\n+#  endif\n+# endif\n+#endif\n+\n+char *\n+lrealpath (filename)\n+     const char *filename;\n+{\n+  /* Method 1: The system has a compile time upper bound on a filename\n+     path.  Use that and realpath() to canonicalize the name.  This is\n+     the most common case.  Note that, if there isn't a compile time\n+     upper bound, you want to avoid realpath() at all costs.  */\n+#if defined(REALPATH_LIMIT)\n+  {\n+    char buf[REALPATH_LIMIT];\n+    const char *rp = realpath (filename, buf);\n+    if (rp == NULL)\n+      rp = filename;\n+    return strdup (rp);\n+  }\n+#endif /* REALPATH_LIMIT */\n+\n+  /* Method 2: The host system (i.e., GNU) has the function\n+     canonicalize_file_name() which malloc's a chunk of memory and\n+     returns that, use that.  */\n+#if defined(HAVE_CANONICALIZE_FILE_NAME)\n+  {\n+    char *rp = canonicalize_file_name (filename);\n+    if (rp == NULL)\n+      return strdup (filename);\n+    else\n+      return rp;\n+  }\n+#endif\n+\n+  /* Method 3: Now we're getting desperate!  The system doesn't have a\n+     compile time buffer size and no alternative function.  Query the\n+     OS, using pathconf(), for the buffer limit.  Care is needed\n+     though, some systems do not limit PATH_MAX (return -1 for\n+     pathconf()) making it impossible to pass a correctly sized buffer\n+     to realpath() (it could always overflow).  On those systems, we\n+     skip this.  */\n+#if defined (HAVE_REALPATH) && defined (HAVE_UNISTD_H)\n+  {\n+    /* Find out the max path size.  */\n+    long path_max = pathconf (\"/\", _PC_PATH_MAX);\n+    if (path_max > 0)\n+      {\n+\t/* PATH_MAX is bounded.  */\n+\tchar *buf, *rp, *ret;\n+\tbuf = malloc (path_max);\n+\tif (buf == NULL)\n+\t  return NULL;\n+\trp = realpath (filename, buf);\n+\tret = strdup (rp ? rp : filename);\n+\tfree (buf);\n+\treturn ret;\n+      }\n+  }\n+#endif\n+\n+  /* This system is a lost cause, just duplicate the filename.  */\n+  return strdup (filename);\n+}"}, {"sha": "dc4f8d5259d07e2323d30f159f138615c2e771e5", "filename": "libiberty/make-relative-prefix.c", "status": "modified", "additions": 31, "deletions": 24, "changes": 55, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2Fmake-relative-prefix.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4876b2b427de2df3c92aee16b7fbd7348022026f/libiberty%2Fmake-relative-prefix.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fmake-relative-prefix.c?ref=4876b2b427de2df3c92aee16b7fbd7348022026f", "patch": "@@ -23,16 +23,25 @@ Software Foundation, 59 Temple Place - Suite 330, Boston, MA\n \n @deftypefn Extension {const char*} make_relative_prefix (const char *@var{progname}, const char *@var{bin_prefix}, const char *@var{prefix})\n \n-Given three strings @var{progname}, @var{bin_prefix}, @var{prefix}, return a string\n-that gets to @var{prefix} starting with the directory portion of @var{progname} and\n-a relative pathname of the difference between @var{bin_prefix} and @var{prefix}.\n-\n-For example, if @var{bin_prefix} is @code{/alpha/beta/gamma/gcc/delta}, @var{prefix}\n-is @code{/alpha/beta/gamma/omega/}, and @var{progname} is @code{/red/green/blue/gcc},\n-then this function will return @code{/red/green/blue/../../omega/}.\n-\n-The return value is normally allocated via @code{malloc}.  If no relative prefix\n-can be found, return @code{NULL}.\n+Given three paths @var{progname}, @var{bin_prefix}, @var{prefix},\n+return the path that is in the same position relative to\n+@var{progname}'s directory as @var{prefix} is relative to\n+@var{bin_prefix}.  That is, a string starting with the directory\n+portion of @var{progname}, followed by a relative pathname of the\n+difference between @var{bin_prefix} and @var{prefix}.\n+\n+If @var{progname} does not contain any directory separators,\n+@code{make_relative_prefix} will search @env{PATH} to find a program\n+named @var{progname}.  Also, if @var{progname} is a symbolic link,\n+the symbolic link will be resolved.\n+\n+For example, if @var{bin_prefix} is @code{/alpha/beta/gamma/gcc/delta},\n+@var{prefix} is @code{/alpha/beta/gamma/omega/}, and @var{progname} is\n+@code{/red/green/blue/gcc}, then this function will return\n+@code{/red/green/blue/../../omega/}.\n+\n+The return value is normally allocated via @code{malloc}.  If no\n+relative prefix can be found, return @code{NULL}.\n \n @end deftypefn\n \n@@ -223,19 +232,14 @@ make_relative_prefix (progname, bin_prefix, prefix)\n   int prog_num, bin_num, prefix_num;\n   int i, n, common;\n   int needed_len;\n-  char *ret, *ptr;\n+  char *ret, *ptr, *full_progname = NULL;\n \n   if (progname == NULL || bin_prefix == NULL || prefix == NULL)\n     return NULL;\n \n-  prog_dirs = split_directories (progname, &prog_num);\n-  bin_dirs = split_directories (bin_prefix, &bin_num);\n-  if (bin_dirs == NULL || prog_dirs == NULL)\n-    return NULL;\n-\n   /* If there is no full pathname, try to find the program by checking in each\n      of the directories specified in the PATH environment variable.  */\n-  if (prog_num == 1)\n+  if (lbasename (progname) == progname)\n     {\n       char *temp;\n \n@@ -278,14 +282,7 @@ make_relative_prefix (progname, bin_prefix, prefix)\n #endif\n \t\t      )\n \t\t    {\n-\t\t      free_split_directories (prog_dirs);\n \t\t      progname = nstore;\n-\t\t      prog_dirs = split_directories (progname, &prog_num);\n-\t\t      if (prog_dirs == NULL)\n-\t\t\t{\n-\t\t\t  free_split_directories (bin_dirs);\n-\t\t\t  return NULL;\n-\t\t\t}\n \t\t      break;\n \t\t    }\n \n@@ -299,6 +296,16 @@ make_relative_prefix (progname, bin_prefix, prefix)\n \t}\n     }\n \n+  full_progname = lrealpath (progname);\n+  if (full_progname == NULL)\n+    return NULL;\n+\n+  prog_dirs = split_directories (full_progname, &prog_num);\n+  bin_dirs = split_directories (bin_prefix, &bin_num);\n+  free (full_progname);\n+  if (bin_dirs == NULL || prog_dirs == NULL)\n+    return NULL;\n+\n   /* Remove the program name from comparison of directory names.  */\n   prog_num--;\n "}]}