{"sha": "ed57136d4a6bbf190126322a818175debee588b4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWQ1NzEzNmQ0YTZiYmYxOTAxMjYzMjJhODE4MTc1ZGViZWU1ODhiNA==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-08T14:54:32Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-08T14:54:32Z"}, "message": "[multiple changes]\n\n2009-04-08  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_util.adb (Is_Protected_Self_Reference): Add guard to check for\n\tpresence of entity.\n\n\t* usage.adb, gnat_ugn.texi: add info on -gnatyO: overriding indicators\n\n2009-04-08  Vincent Celier  <celier@adacore.com>\n\n\t* vms_data.ads: Add VMS equivalent for -gnatyO (OVERRIDING_INDICATORS)\n\n2009-04-08  Thomas Quinot  <quinot@adacore.com>\n\n\t* checks.ads: Minor reformatting\n\n2009-04-08  Robert Dewar  <dewar@adacore.com>\n\n\t* gnat_rm.texi: Update documentation of pragma Obsolescent\n\t\n\t* sem_prag.adb (Analyze_Pragma, case Obsolescent): Allow identifiers to\n\tbe omitted, and allow Entity parameter to be omitted.\n\nFrom-SVN: r145745", "tree": {"sha": "1c12ec670540ac16c3dca88dd113ff65931217ec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1c12ec670540ac16c3dca88dd113ff65931217ec"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ed57136d4a6bbf190126322a818175debee588b4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ed57136d4a6bbf190126322a818175debee588b4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ed57136d4a6bbf190126322a818175debee588b4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ed57136d4a6bbf190126322a818175debee588b4/comments", "author": null, "committer": null, "parents": [{"sha": "ef7c5692f12132cb8672a61c67070deef4fd600e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ef7c5692f12132cb8672a61c67070deef4fd600e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ef7c5692f12132cb8672a61c67070deef4fd600e"}], "stats": {"total": 135, "additions": 88, "deletions": 47}, "files": [{"sha": "b02ec43597d8c1844305f0e6e85c44df9647bce7", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed57136d4a6bbf190126322a818175debee588b4/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed57136d4a6bbf190126322a818175debee588b4/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=ed57136d4a6bbf190126322a818175debee588b4", "patch": "@@ -1,3 +1,25 @@\n+2009-04-08  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_util.adb (Is_Protected_Self_Reference): Add guard to check for\n+\tpresence of entity.\n+\n+\t* usage.adb, gnat_ugn.texi: add info on -gnatyO: overriding indicators\n+\n+2009-04-08  Vincent Celier  <celier@adacore.com>\n+\n+\t* vms_data.ads: Add VMS equivalent for -gnatyO (OVERRIDING_INDICATORS)\n+\n+2009-04-08  Thomas Quinot  <quinot@adacore.com>\n+\n+\t* checks.ads: Minor reformatting\n+\n+2009-04-08  Robert Dewar  <dewar@adacore.com>\n+\n+\t* gnat_rm.texi: Update documentation of pragma Obsolescent\n+\t\n+\t* sem_prag.adb (Analyze_Pragma, case Obsolescent): Allow identifiers to\n+\tbe omitted, and allow Entity parameter to be omitted.\n+\n 2009-04-08  Thomas Quinot  <quinot@adacore.com>\n \n \t* exp_util.adb: Minor comment fix"}, {"sha": "07ac272254965549cdede41c0fea42e3f8b759b6", "filename": "gcc/ada/checks.ads", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed57136d4a6bbf190126322a818175debee588b4/gcc%2Fada%2Fchecks.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed57136d4a6bbf190126322a818175debee588b4/gcc%2Fada%2Fchecks.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fchecks.ads?ref=ed57136d4a6bbf190126322a818175debee588b4", "patch": "@@ -32,7 +32,7 @@\n --  checks, is to attempt to detect at compilation time that a constraint\n --  error will occur. If this is detected a warning or error is issued and the\n --  offending expression or statement replaced with a constraint error node.\n---  This always occurs whether checks are suppressed or not.  Dynamic range\n+--  This always occurs whether checks are suppressed or not. Dynamic range\n --  checks are, of course, not inserted if checks are suppressed.\n \n with Namet;  use Namet;\n@@ -233,9 +233,9 @@ package Checks is\n    --  First this routine determines if an overflow check is needed by doing\n    --  an appropriate range check. If a check is not needed, then the call\n    --  has no effect. If a check is needed then this routine sets the flag\n-   --  Set Do_Overflow_Check in node N to True, unless it can be determined\n-   --  that the check is not needed. The only condition under which this is\n-   --  the case is if there was an identical check earlier on.\n+   --  Do_Overflow_Check in node N to True, unless it can be determined that\n+   --  the check is not needed. The only condition under which this is the\n+   --  case is if there was an identical check earlier on.\n \n    procedure Enable_Range_Check (N : Node_Id);\n    --  Set Do_Range_Check flag in node N True, unless it can be determined\n@@ -445,7 +445,7 @@ package Checks is\n    --  Some of the earlier processing for checks results in temporarily setting\n    --  the Do_Range_Check flag rather than actually generating checks. Now we\n    --  are moving the generation of such checks into the front end for reasons\n-   --  of efficiency and simplicity (there were difficutlies in handling this\n+   --  of efficiency and simplicity (there were difficulties in handling this\n    --  in the back end when side effects were present in the expressions being\n    --  checked).\n "}, {"sha": "5f344b00e48a51c93db35fe4cc2404ff8afd920c", "filename": "gcc/ada/gnat_rm.texi", "status": "modified", "additions": 30, "deletions": 28, "changes": 58, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed57136d4a6bbf190126322a818175debee588b4/gcc%2Fada%2Fgnat_rm.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed57136d4a6bbf190126322a818175debee588b4/gcc%2Fada%2Fgnat_rm.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnat_rm.texi?ref=ed57136d4a6bbf190126322a818175debee588b4", "patch": "@@ -3463,19 +3463,26 @@ will always generate an invalid value if one exists.\n Syntax:\n \n @smallexample @c ada\n-pragma Obsolescent\n-  [([Entity  =>] NAME\n-  [,[Message =>] static_string_EXPRESSION\n-  [,[Version =>] Ada_05]])];\n+pragma Obsolescent;\n+\n+pragma Obsolescent (\n+  [Message =>] static_string_EXPRESSION\n+[,[Version =>] Ada_05]]);\n+\n+pragma Obsolescent (\n+  [Entity  =>] NAME\n+[,[Message =>] static_string_EXPRESSION\n+[,[Version =>] Ada_05]] );\n @end smallexample\n \n @noindent\n This pragma can occur immediately following a declaration of an entity,\n-including the case of a record component, and usually the Entity name\n-must match the name of the entity declared by this declaration.\n-Alternatively, the pragma can immediately follow an\n-enumeration type declaration, where the entity argument names one of the\n-enumeration literals.\n+including the case of a record component. If no Entity argument is present,\n+then this declaration is the one to which the pragma applies. If an Entity\n+parameter is present, it must either match the name of the entity in this\n+declaration, or alternatively, the pragma can immediately follow an enumeration\n+type declaration, where the Entity argument names one of the enumeration\n+literals.\n \n This pragma is used to indicate that the named entity\n is considered obsolescent and should not be used. Typically this is\n@@ -3484,13 +3491,12 @@ existing subprograms or other entities. The pragma can be used at an\n intermediate stage when the entity is still present, but will be\n removed later.\n \n-The effect of this pragma is to output a warning message on\n-a call to a program thus marked that the\n-subprogram is obsolescent if the appropriate warning option in the\n-compiler is activated. If the string parameter is present, then a second\n-warning message is given containing this text.\n-In addition, a call to such a program is considered a violation of\n-pragma Restrictions (No_Obsolescent_Features).\n+The effect of this pragma is to output a warning message on a reference to\n+an entity thus marked that the subprogram is obsolescent if the appropriate\n+warning option in the compiler is activated. If the Message parameter is\n+present, then a second warning message is given containing this text. In\n+addition, a reference to the eneity is considered to be a violation of pragma\n+Restrictions (No_Obsolescent_Features).\n \n This pragma can also be used as a program unit pragma for a package,\n in which case the entity name is the name of the package, and the\n@@ -3499,7 +3505,7 @@ obsolescent. In this case a client @code{with}'ing such a package\n violates the restriction, and the @code{with} statement is\n flagged with warnings if the warning option is set.\n \n-If the optional third parameter is present (which must be exactly\n+If the Version parameter is present (which must be exactly\n the identifier Ada_05, no other argument is allowed), then the\n indication of obsolescence applies only when compiling in Ada 2005\n mode. This is primarily intended for dealing with the situations\n@@ -3511,15 +3517,12 @@ The following examples show typical uses of this pragma:\n \n @smallexample @c ada\n package p is\n-   pragma Obsolescent\n-     (Entity => p, Message => \"use pp instead of p\");\n+   pragma Obsolescent (p, Message => \"use pp instead of p\");\n end p;\n \n package q is\n    procedure q2;\n-   pragma Obsolescent\n-     (Entity  => q2,\n-      Message => \"use q2new instead\");\n+   pragma Obsolescent (\"use q2new instead\");\n \n    type R is new integer;\n    pragma Obsolescent\n@@ -3530,7 +3533,7 @@ package q is\n    type M is record\n       F1 : Integer;\n       F2 : Integer;\n-      pragma Obsolescent (Entity => F2);\n+      pragma Obsolescent;\n       F3 : Integer;\n    end record;\n \n@@ -3545,11 +3548,10 @@ end;\n @end smallexample\n \n @noindent\n-In an earlier version of GNAT, the Entity parameter was not required,\n-and this form is still accepted for compatibility purposes. If the\n-Entity parameter is omitted, then the pragma applies to the declaration\n-immediately preceding the pragma (this form cannot be used for the\n-enumeration literal case).\n+Note that, as for all pragmas, if you use a pragma argument identifier,\n+then all subsequent parameters must also use a pragma argument identifier.\n+So if you specify \"Entity =>\" for the Entity argument, and a Message\n+argument is present, it must be preceded by \"Message =>\".\n \n @node Pragma Optimize_Alignment\n @unnumberedsec Pragma Optimize_Alignment"}, {"sha": "6d4390d6f3b9081a8a532cccd1e4bd0643faa070", "filename": "gcc/ada/gnat_ugn.texi", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed57136d4a6bbf190126322a818175debee588b4/gcc%2Fada%2Fgnat_ugn.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed57136d4a6bbf190126322a818175debee588b4/gcc%2Fada%2Fgnat_ugn.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnat_ugn.texi?ref=ed57136d4a6bbf190126322a818175debee588b4", "patch": "@@ -6059,6 +6059,11 @@ of letters, except that if there is a trailing numeric suffix, then\n the value of this suffix is used in the ordering (e.g.@: Junk2 comes\n before Junk10).\n \n+@item ^O^OVERRIDING_INDICATORS^\n+@emph{Check that overriding subprograms are explicitly marked as such.}\n+The declaration of a primitive operation of a type extension that overrides\n+an inherited operation must carry an overriding indicator.\n+\n @item ^p^PRAGMA^\n @emph{Check pragma casing.}\n Pragma names must be written in mixed case, that is, the"}, {"sha": "c9500f82b5b5798dce7b5ebc61fa6e4b95efec63", "filename": "gcc/ada/sem_prag.adb", "status": "modified", "additions": 16, "deletions": 14, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed57136d4a6bbf190126322a818175debee588b4/gcc%2Fada%2Fsem_prag.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed57136d4a6bbf190126322a818175debee588b4/gcc%2Fada%2Fsem_prag.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_prag.adb?ref=ed57136d4a6bbf190126322a818175debee588b4", "patch": "@@ -9058,10 +9058,16 @@ package body Sem_Prag is\n          -- Obsolescent --\n          -----------------\n \n-         --  pragma Obsolescent [(\n-         --    [Entity  => NAME,]\n-         --    [Message => static_string_EXPRESSION\n-         --  [,[Version => Ada_05]] )];\n+         --  pragma Obsolescent;\n+\n+         --  pragma Obsolescent (\n+         --    [Message =>] static_string_EXPRESSION\n+         --  [,[Version =>] Ada_05]]);\n+\n+         --  pragma Obsolescent (\n+         --    [Entity  =>] NAME\n+         --  [,[Message =>] static_string_EXPRESSION\n+         --  [,[Version =>] Ada_05]] );\n \n          when Pragma_Obsolescent => Obsolescent : declare\n             Ename : Node_Id;\n@@ -9186,19 +9192,15 @@ package body Sem_Prag is\n             --  See if first argument specifies an entity name\n \n             if Arg_Count >= 1\n-              and then Chars (Arg1) = Name_Entity\n+              and then\n+                (Chars (Arg1) = Name_Entity\n+                   or else\n+                     Nkind_In (Get_Pragma_Arg (Arg1), N_Character_Literal,\n+                                                      N_Identifier,\n+                                                      N_Operator_Symbol))\n             then\n                Ename := Get_Pragma_Arg (Arg1);\n \n-               if Nkind (Ename) /= N_Character_Literal\n-                    and then\n-                  Nkind (Ename) /= N_Identifier\n-                    and then\n-                  Nkind (Ename) /= N_Operator_Symbol\n-               then\n-                  Error_Pragma_Arg (\"entity name expected for pragma%\", Arg1);\n-               end if;\n-\n                --  Eliminate first argument, so we can share processing\n \n                Arg1 := Arg2;"}, {"sha": "b2651553f2ec8eb9349522906c8e57caa3b75228", "filename": "gcc/ada/sem_util.adb", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed57136d4a6bbf190126322a818175debee588b4/gcc%2Fada%2Fsem_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed57136d4a6bbf190126322a818175debee588b4/gcc%2Fada%2Fsem_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.adb?ref=ed57136d4a6bbf190126322a818175debee588b4", "patch": "@@ -6411,8 +6411,15 @@ package body Sem_Util is\n    --  Start of processing for Is_Protected_Self_Reference\n \n    begin\n+      --  Verify that prefix is analyzed and has the proper form. Note that\n+      --  the attributes Elab_Spec, Elab_Body, and UET_Address, which also\n+      --  produce the address of an entity, do not analyze their prefix\n+      --  because they denote entities that are not necessarily visible.\n+      --  Neither of them can apply to a protected type.\n+\n       return Ada_Version >= Ada_05\n         and then Is_Entity_Name (N)\n+        and then Present (Entity (N))\n         and then Is_Protected_Type (Entity (N))\n         and then In_Open_Scopes (Entity (N))\n         and then not In_Access_Definition (N);"}, {"sha": "e69695b04fb9ccb491ba9acb0770e9e9694dbbbd", "filename": "gcc/ada/usage.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed57136d4a6bbf190126322a818175debee588b4/gcc%2Fada%2Fusage.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed57136d4a6bbf190126322a818175debee588b4/gcc%2Fada%2Fusage.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fusage.adb?ref=ed57136d4a6bbf190126322a818175debee588b4", "patch": "@@ -525,6 +525,7 @@ begin\n    Write_Line (\"        Mnn  check line length <= nn characters\");\n    Write_Line (\"        N    turn off all checks\");\n    Write_Line (\"        o    check subprogram bodies in alphabetical order\");\n+   Write_Line (\"        O    check overriding indicators\");\n    Write_Line (\"        p    check pragma casing\");\n    Write_Line (\"        r    check casing for identifier references\");\n    Write_Line (\"        s    check separate subprogram specs present\");"}, {"sha": "91f7647a411a4a6d7b69177853ce4a6fb784b592", "filename": "gcc/ada/vms_data.ads", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed57136d4a6bbf190126322a818175debee588b4/gcc%2Fada%2Fvms_data.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed57136d4a6bbf190126322a818175debee588b4/gcc%2Fada%2Fvms_data.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fvms_data.ads?ref=ed57136d4a6bbf190126322a818175debee588b4", "patch": "@@ -2242,6 +2242,8 @@ package VMS_Data is\n                                                \"-gnaty-n \"                 &\n                                             \"ORDERED_SUBPROGRAMS \"         &\n                                                \"-gnatyo \"                  &\n+                                            \"OVERRIDING_INDICATORS \"       &\n+                                               \"-gnatyO \"                  &\n                                             \"NOORDERED_SUBPROGRAMS \"       &\n                                                \"-gnaty-o \"                 &\n                                             \"PRAGMA \"                      &"}]}