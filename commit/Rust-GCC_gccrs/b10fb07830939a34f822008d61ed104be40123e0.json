{"sha": "b10fb07830939a34f822008d61ed104be40123e0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjEwZmIwNzgzMDkzOWEzNGY4MjIwMDhkNjFlZDEwNGJlNDAxMjNlMA==", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2018-10-28T09:25:43Z"}, "committer": {"name": "Iain Sandoe", "email": "iains@gcc.gnu.org", "date": "2018-10-28T09:25:43Z"}, "message": "darwin - fix powerpc-darwin stack alignments\n\n2018-10-28  Iain Sandoe  <iain@sandoe.co.uk>\n\n\tPR target/85669\n\t* config/rs6000/darwin.h (STACK_BOUNDARY): New.\n\t(RS6000_STARTING_FRAME_OFFSET): Adjust to preserve 16byte alignment.\n\t(STACK_DYNAMIC_OFFSET): Likewise.\n\nFrom-SVN: r265568", "tree": {"sha": "2d55aaf4bcb61ed700f1c60845b1d29eee0db662", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2d55aaf4bcb61ed700f1c60845b1d29eee0db662"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b10fb07830939a34f822008d61ed104be40123e0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b10fb07830939a34f822008d61ed104be40123e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b10fb07830939a34f822008d61ed104be40123e0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b10fb07830939a34f822008d61ed104be40123e0/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "01497ce738c10fa63772f2591fc8f153199a9f98", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/01497ce738c10fa63772f2591fc8f153199a9f98", "html_url": "https://github.com/Rust-GCC/gccrs/commit/01497ce738c10fa63772f2591fc8f153199a9f98"}], "stats": {"total": 45, "additions": 40, "deletions": 5}, "files": [{"sha": "349716f74cb8d1cb1e9c5bc1c2c97266ecf5d108", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b10fb07830939a34f822008d61ed104be40123e0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b10fb07830939a34f822008d61ed104be40123e0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b10fb07830939a34f822008d61ed104be40123e0", "patch": "@@ -1,3 +1,10 @@\n+2018-10-28  Iain Sandoe  <iain@sandoe.co.uk>\n+\n+\tPR target/85669\n+\t* config/rs6000/darwin.h (STACK_BOUNDARY): New.\n+\t(RS6000_STARTING_FRAME_OFFSET): Adjust to preserve 16byte alignment.\n+\t(STACK_DYNAMIC_OFFSET): Likewise.\n+\n 2018-10-27  Sandra Loosemore  <sandra@codesourcery.com>\n \n \tPR target/80024"}, {"sha": "2b5628cac5686f9d943ec193f7adecc0a7303323", "filename": "gcc/config/rs6000/darwin.h", "status": "modified", "additions": 33, "deletions": 5, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b10fb07830939a34f822008d61ed104be40123e0/gcc%2Fconfig%2Frs6000%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b10fb07830939a34f822008d61ed104be40123e0/gcc%2Fconfig%2Frs6000%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fdarwin.h?ref=b10fb07830939a34f822008d61ed104be40123e0", "patch": "@@ -159,17 +159,45 @@ extern int darwin_emit_branch_islands;\n #undef  RS6000_PIC_OFFSET_TABLE_REGNUM\n #define RS6000_PIC_OFFSET_TABLE_REGNUM 31\n \n-/* Pad the outgoing args area to 16 bytes instead of the usual 8.  */\n+/* Darwin's stack must remain 16-byte aligned for both 32 and 64 bit\n+   ABIs.  */\n+\n+#undef  STACK_BOUNDARY\n+#define STACK_BOUNDARY 128\n+\n+/* Offset within stack frame to start allocating local variables at.\n+   For supported Darwin versions, FRAME_GROWS_DOWNWARD is true, therefore\n+   this value is the offset to the END of the first local allocated.\n+\n+   On the RS/6000, the frame pointer is the same as the stack pointer,\n+   except for dynamic allocations.  So we start after the fixed area and\n+   outgoing parameter area.\n+\n+   If the function uses dynamic stack space (CALLS_ALLOCA is set), that\n+   space needs to be aligned to STACK_BOUNDARY, i.e. the sum of the\n+   sizes of the fixed area and the parameter area must be a multiple of\n+   STACK_BOUNDARY.  */\n \n #undef RS6000_STARTING_FRAME_OFFSET\n #define RS6000_STARTING_FRAME_OFFSET\t\t\t\t\t\\\n-  (RS6000_ALIGN (crtl->outgoing_args_size, 16)\t\t\t\t\\\n-   + RS6000_SAVE_AREA)\n+  (cfun->calls_alloca\t\t\t\t\t\t\t\\\n+   ? RS6000_ALIGN (crtl->outgoing_args_size + RS6000_SAVE_AREA, 16)\t\\\n+   : (RS6000_ALIGN (crtl->outgoing_args_size, 16) + RS6000_SAVE_AREA))\n+\n+/* Offset from the stack pointer register to an item dynamically\n+   allocated on the stack, e.g., by `alloca'.\n+\n+   The default value for this macro is `STACK_POINTER_OFFSET' plus the\n+   length of the outgoing arguments.  The default is correct for most\n+   machines.  See `function.c' for details.\n+\n+   This value must be a multiple of STACK_BOUNDARY (hard coded in\n+   `emit-rtl.c').  */\n \n #undef STACK_DYNAMIC_OFFSET\n #define STACK_DYNAMIC_OFFSET(FUNDECL)\t\t\t\t\t\\\n-  (RS6000_ALIGN (crtl->outgoing_args_size.to_constant (), 16)\t\t\\\n-   + (STACK_POINTER_OFFSET))\n+  RS6000_ALIGN (crtl->outgoing_args_size.to_constant()\t\t\t\\\n+\t\t+ STACK_POINTER_OFFSET, 16)\n \n /* Darwin uses a function call if everything needs to be saved/restored.  */\n "}]}