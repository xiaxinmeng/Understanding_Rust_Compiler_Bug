{"sha": "e2e11048ae4f1436fd315193d89f49c25c0a0aea", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTJlMTEwNDhhZTRmMTQzNmZkMzE1MTkzZDg5ZjQ5YzI1YzBhMGFlYQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2000-05-25T11:13:17Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2000-05-25T11:13:17Z"}, "message": "tinfo.h (__user_type_info::contained_virtual_p): New predicate.\n\n\t* tinfo.h (__user_type_info::contained_virtual_p): New\n\tpredicate.\n\t* tinfo.cc (__user_type_info::do_upcast): Fix bug with diamond\n\tshaped heirarchy.\n\t(__vmi_class_type_info::__do_upcast): Fix bug with NULL pointer to\n\tdiamond shaped heirarchy. Add early out for mixed diamond and\n\tduplicate shaped heirarchy.\n\nFrom-SVN: r34163", "tree": {"sha": "099b40138fa1a7ad00c56458d578f6f197c5d395", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/099b40138fa1a7ad00c56458d578f6f197c5d395"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e2e11048ae4f1436fd315193d89f49c25c0a0aea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2e11048ae4f1436fd315193d89f49c25c0a0aea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e2e11048ae4f1436fd315193d89f49c25c0a0aea", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2e11048ae4f1436fd315193d89f49c25c0a0aea/comments", "author": null, "committer": null, "parents": [{"sha": "bf93f43bb4b949e16227425777ed5667f37cdd20", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf93f43bb4b949e16227425777ed5667f37cdd20", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bf93f43bb4b949e16227425777ed5667f37cdd20"}], "stats": {"total": 26, "additions": 24, "deletions": 2}, "files": [{"sha": "11df3c13d85509c288325c41d60908149c0496fc", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2e11048ae4f1436fd315193d89f49c25c0a0aea/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2e11048ae4f1436fd315193d89f49c25c0a0aea/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=e2e11048ae4f1436fd315193d89f49c25c0a0aea", "patch": "@@ -1,3 +1,13 @@\n+2000-05-25  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* tinfo.h (__user_type_info::contained_virtual_p): New\n+\tpredicate.\n+\t* tinfo.cc (__user_type_info::do_upcast): Fix bug with diamond\n+\tshaped heirarchy.\n+\t(__vmi_class_type_info::__do_upcast): Fix bug with NULL pointer to\n+\tdiamond shaped heirarchy. Add early out for mixed diamond and\n+\tduplicate shaped heirarchy.\n+\n 2000-05-24  Mark Mitchell  <mark@codesourcery.com>\n \n \t* cp-tree.h (build_delete): Change prototype."}, {"sha": "58247e398fef6175b9b0f27fef9b0cb239c5f85a", "filename": "gcc/cp/tinfo.cc", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2e11048ae4f1436fd315193d89f49c25c0a0aea/gcc%2Fcp%2Ftinfo.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2e11048ae4f1436fd315193d89f49c25c0a0aea/gcc%2Fcp%2Ftinfo.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftinfo.cc?ref=e2e11048ae4f1436fd315193d89f49c25c0a0aea", "patch": "@@ -286,7 +286,8 @@ do_upcast (sub_kind access_path,\n \tsub_access = sub_kind (sub_access | contained_virtual_mask);\n       if (base_list[i].access != PUBLIC)\n         sub_access = sub_kind (sub_access & ~contained_public_mask);\n-      if (base_list[i].base->do_upcast (sub_access, target, p, result2))\n+      if (base_list[i].base->do_upcast (sub_access, target, p, result2)\n+          && !contained_virtual_p (result2.whole2target))\n         return true; // must fail\n       if (result2.base_type)\n         {\n@@ -321,6 +322,8 @@ do_upcast (sub_kind access_path,\n                   result.whole2target = contained_ambig;\n                   return true;\n                 }\n+              result.whole2target\n+                  = sub_kind (result.whole2target | result2.whole2target);\n             }\n         }\n     }\n@@ -1095,8 +1098,10 @@ __do_upcast (const __class_type_info *dst, const void *obj_ptr,\n                 }\n               else\n                 {\n+                  if (!virtual_p (result.part2dst))\n+                    return true; // cannot have another path\n                   if (!(vmi_flags & diamond_shaped_mask))\n-                    return true; // cannot have a more accessible base\n+                    return true; // cannot have a more accessible path\n                 }\n             }\n           else if (result.dst_ptr != result2.dst_ptr)\n@@ -1125,6 +1130,8 @@ __do_upcast (const __class_type_info *dst, const void *obj_ptr,\n                   result.part2dst = __contained_ambig;\n                   return true;\n                 }\n+              result.part2dst\n+                  = __sub_kind (result.part2dst | result2.part2dst);\n             }\n         }\n     }"}, {"sha": "b52f681a3a8b4add5fdaa1e7290fac6613f0d9ab", "filename": "gcc/cp/tinfo.h", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2e11048ae4f1436fd315193d89f49c25c0a0aea/gcc%2Fcp%2Ftinfo.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2e11048ae4f1436fd315193d89f49c25c0a0aea/gcc%2Fcp%2Ftinfo.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftinfo.h?ref=e2e11048ae4f1436fd315193d89f49c25c0a0aea", "patch": "@@ -79,6 +79,11 @@ struct __user_type_info : public std::type_info {\n     return (access_path & (contained_mask | contained_virtual_mask))\n            == contained_mask;\n   }\n+  static inline bool contained_virtual_p (sub_kind access_path)\n+  {\n+    return (access_path & (contained_mask | contained_virtual_mask))\n+           == (contained_mask | contained_virtual_mask);\n+  }\n   \n   struct upcast_result\n   {"}]}