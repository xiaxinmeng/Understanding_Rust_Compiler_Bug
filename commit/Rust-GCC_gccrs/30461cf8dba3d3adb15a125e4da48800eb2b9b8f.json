{"sha": "30461cf8dba3d3adb15a125e4da48800eb2b9b8f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzA0NjFjZjhkYmEzZDNhZGIxNWExMjVlNGRhNDg4MDBlYjJiOWI4Zg==", "commit": {"author": {"name": "Richard Earnshaw", "email": "rearnsha@arm.com", "date": "2021-06-18T16:18:37Z"}, "committer": {"name": "Richard Earnshaw", "email": "rearnsha@arm.com", "date": "2021-08-24T10:45:13Z"}, "message": "arm: fix vlldm erratum for Armv8.1-m [PR102035]\n\nFor Armv8.1-m we generate code that emits VLLDM directly and do not\nrely on support code in the library, so emit the mitigation directly\nas well, when required.  In this case, we can use the compiler options\nto determine when to apply the fix and when it is safe to omit it.\n\ngcc:\n\tPR target/102035\n\t* config/arm/arm.md (attribute arch): Add fix_vlldm.\n\t(arch_enabled): Use it.\n\t* config/arm/vfp.md (lazy_store_multiple_insn): Add alternative to\n\tuse when erratum mitigation is needed.", "tree": {"sha": "7a06380277d84c1780f7f458664a2e67563c30bc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7a06380277d84c1780f7f458664a2e67563c30bc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/30461cf8dba3d3adb15a125e4da48800eb2b9b8f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/30461cf8dba3d3adb15a125e4da48800eb2b9b8f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/30461cf8dba3d3adb15a125e4da48800eb2b9b8f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/30461cf8dba3d3adb15a125e4da48800eb2b9b8f/comments", "author": null, "committer": null, "parents": [{"sha": "574e7950bd6b34e9e2cacce18c802b45505d1d0a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/574e7950bd6b34e9e2cacce18c802b45505d1d0a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/574e7950bd6b34e9e2cacce18c802b45505d1d0a"}], "stats": {"total": 21, "additions": 16, "deletions": 5}, "files": [{"sha": "5d3f21b91c4e931270b9a7c532abef15a1e82260", "filename": "gcc/config/arm/arm.md", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/30461cf8dba3d3adb15a125e4da48800eb2b9b8f/gcc%2Fconfig%2Farm%2Farm.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/30461cf8dba3d3adb15a125e4da48800eb2b9b8f/gcc%2Fconfig%2Farm%2Farm.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.md?ref=30461cf8dba3d3adb15a125e4da48800eb2b9b8f", "patch": "@@ -132,9 +132,12 @@\n ; TARGET_32BIT, \"t1\" or \"t2\" to specify a specific Thumb mode.  \"v6\"\n ; for ARM or Thumb-2 with arm_arch6, and nov6 for ARM without\n ; arm_arch6.  \"v6t2\" for Thumb-2 with arm_arch6 and \"v8mb\" for ARMv8-M\n-; Baseline.  This attribute is used to compute attribute \"enabled\",\n+; Baseline.  \"fix_vlldm\" is for fixing the v8-m/v8.1-m VLLDM erratum.\n+; This attribute is used to compute attribute \"enabled\",\n ; use type \"any\" to enable an alternative in all cases.\n-(define_attr \"arch\" \"any,a,t,32,t1,t2,v6,nov6,v6t2,v8mb,iwmmxt,iwmmxt2,armv6_or_vfpv3,neon,mve\"\n+(define_attr \"arch\" \"any, a, t, 32, t1, t2, v6,nov6, v6t2, \\\n+\t\t     v8mb, fix_vlldm, iwmmxt, iwmmxt2, armv6_or_vfpv3, \\\n+\t\t     neon, mve\"\n   (const_string \"any\"))\n \n (define_attr \"arch_enabled\" \"no,yes\"\n@@ -177,6 +180,10 @@\n \t      (match_test \"TARGET_THUMB1 && arm_arch8\"))\n \t (const_string \"yes\")\n \n+\t (and (eq_attr \"arch\" \"fix_vlldm\")\n+\t      (match_test \"fix_vlldm\"))\n+\t (const_string \"yes\")\n+\n \t (and (eq_attr \"arch\" \"iwmmxt2\")\n \t      (match_test \"TARGET_REALLY_IWMMXT2\"))\n \t (const_string \"yes\")"}, {"sha": "f0030a8c36a4493e920f332866e26cbb711ea3dc", "filename": "gcc/config/arm/vfp.md", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/30461cf8dba3d3adb15a125e4da48800eb2b9b8f/gcc%2Fconfig%2Farm%2Fvfp.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/30461cf8dba3d3adb15a125e4da48800eb2b9b8f/gcc%2Fconfig%2Farm%2Fvfp.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Fvfp.md?ref=30461cf8dba3d3adb15a125e4da48800eb2b9b8f", "patch": "@@ -1720,11 +1720,15 @@\n \n (define_insn \"lazy_load_multiple_insn\"\n   [(unspec_volatile\n-    [(mem:BLK (match_operand:SI 0 \"s_register_operand\" \"rk\"))]\n+    [(mem:BLK (match_operand:SI 0 \"s_register_operand\" \"rk,rk\"))]\n     VUNSPEC_VLLDM)]\n   \"use_cmse && reload_completed\"\n-  \"vlldm%?\\\\t%0\"\n-  [(set_attr \"predicable\" \"yes\")\n+  \"@\n+   vscclrm\\\\t{vpr}\\;vlldm\\\\t%0\n+   vlldm\\\\t%0\"\n+  [(set_attr \"arch\" \"fix_vlldm,*\")\n+   (set_attr \"predicable\" \"no\")\n+   (set_attr \"length\" \"8,4\")\n    (set_attr \"type\" \"load_4\")]\n )\n "}]}