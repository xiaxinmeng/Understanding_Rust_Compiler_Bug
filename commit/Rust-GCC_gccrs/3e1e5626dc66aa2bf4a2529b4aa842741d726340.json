{"sha": "3e1e5626dc66aa2bf4a2529b4aa842741d726340", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2UxZTU2MjZkYzY2YWEyYmY0YTI1MjliNGFhODQyNzQxZDcyNjM0MA==", "commit": {"author": {"name": "Daniel Kraft", "email": "d@domob.eu", "date": "2008-09-01T13:43:10Z"}, "committer": {"name": "Daniel Kraft", "email": "domob@gcc.gnu.org", "date": "2008-09-01T13:43:10Z"}, "message": "re PR fortran/37193 (\"USE mod, ONLY: i, i=>j\" does not import \"i\")\n\n2008-09-01  Daniel Kraft  <d@domob.eu>\n\n\tPR fortran/37193\n\t* module.c (read_module): Initialize use_only flag on used symbols.\n\n2008-09-01  Daniel Kraft  <d@domob.eu>\n\n\tPR fortran/37193\n\t* gfortran.dg/use_rename_4.f90: New test.\n\t* gfortran.dg/use_rename_5.f90: New test.\n\nFrom-SVN: r139866", "tree": {"sha": "0fc3cb984d5be7e10c9ff226b82425a557ec7801", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0fc3cb984d5be7e10c9ff226b82425a557ec7801"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3e1e5626dc66aa2bf4a2529b4aa842741d726340", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e1e5626dc66aa2bf4a2529b4aa842741d726340", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3e1e5626dc66aa2bf4a2529b4aa842741d726340", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e1e5626dc66aa2bf4a2529b4aa842741d726340/comments", "author": {"login": "domob1812", "id": 4943644, "node_id": "MDQ6VXNlcjQ5NDM2NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4943644?v=4", "gravatar_id": "", "url": "https://api.github.com/users/domob1812", "html_url": "https://github.com/domob1812", "followers_url": "https://api.github.com/users/domob1812/followers", "following_url": "https://api.github.com/users/domob1812/following{/other_user}", "gists_url": "https://api.github.com/users/domob1812/gists{/gist_id}", "starred_url": "https://api.github.com/users/domob1812/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/domob1812/subscriptions", "organizations_url": "https://api.github.com/users/domob1812/orgs", "repos_url": "https://api.github.com/users/domob1812/repos", "events_url": "https://api.github.com/users/domob1812/events{/privacy}", "received_events_url": "https://api.github.com/users/domob1812/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "51c69ddb914f062d93c2180a293c944107fbf999", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51c69ddb914f062d93c2180a293c944107fbf999", "html_url": "https://github.com/Rust-GCC/gccrs/commit/51c69ddb914f062d93c2180a293c944107fbf999"}], "stats": {"total": 59, "additions": 57, "deletions": 2}, "files": [{"sha": "516a9745cad28ce2c92afa3fc6517046c8232db0", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e1e5626dc66aa2bf4a2529b4aa842741d726340/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e1e5626dc66aa2bf4a2529b4aa842741d726340/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=3e1e5626dc66aa2bf4a2529b4aa842741d726340", "patch": "@@ -1,3 +1,8 @@\n+2008-09-01  Daniel Kraft  <d@domob.eu>\n+\n+\tPR fortran/37193\n+\t* module.c (read_module): Initialize use_only flag on used symbols.\n+\n 2008-09-01  Daniel Kraft  <d@domob.eu>\n \n \t* gfc-internals.texi (F2003 OOP), (Type-bound Procedures): New chapter"}, {"sha": "907002bc93a0e83dd0288639d627e3ab8eb3d3b3", "filename": "gcc/fortran/module.c", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e1e5626dc66aa2bf4a2529b4aa842741d726340/gcc%2Ffortran%2Fmodule.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e1e5626dc66aa2bf4a2529b4aa842741d726340/gcc%2Ffortran%2Fmodule.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmodule.c?ref=3e1e5626dc66aa2bf4a2529b4aa842741d726340", "patch": "@@ -4094,9 +4094,9 @@ read_module (void)\n \t      st = gfc_find_symtree (gfc_current_ns->sym_root, name);\n \n \t      /* Delete the symtree if the symbol has been added by a USE\n-\t\t statement without an ONLY(11.3.2). Remember that the rsym\n+\t\t statement without an ONLY(11.3.2).  Remember that the rsym\n \t\t will be the same as the symbol found in the symtree, for\n-\t\t this case.*/\n+\t\t this case.  */\n \t      if (st && (only_flag || info->u.rsym.renamed)\n \t\t     && !st->n.sym->attr.use_only\n \t\t     && !st->n.sym->attr.use_rename\n@@ -4132,6 +4132,11 @@ read_module (void)\n \t      if (strcmp (name, p) != 0)\n \t\tsym->attr.use_rename = 1;\n \n+\t      /* We need to set the only_flag here so that symbols from the\n+\t\t same USE...ONLY but earlier are not deleted from the tree in\n+\t\t the gfc_delete_symtree above.  */\n+\t      sym->attr.use_only = only_flag;\n+\n \t      /* Store the symtree pointing to this symbol.  */\n \t      info->u.rsym.symtree = st;\n "}, {"sha": "44b789a4a85359e71ebbfa79d38f473305025753", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e1e5626dc66aa2bf4a2529b4aa842741d726340/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e1e5626dc66aa2bf4a2529b4aa842741d726340/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3e1e5626dc66aa2bf4a2529b4aa842741d726340", "patch": "@@ -1,3 +1,9 @@\n+2008-09-01  Daniel Kraft  <d@domob.eu>\n+\n+\tPR fortran/37193\n+\t* gfortran.dg/use_rename_4.f90: New test.\n+\t* gfortran.dg/use_rename_5.f90: New test.\n+\n 2008-09-01  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/37305"}, {"sha": "e0e83b89181a11247d5e5bad972dc681c350463e", "filename": "gcc/testsuite/gfortran.dg/use_rename_4.f90", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e1e5626dc66aa2bf4a2529b4aa842741d726340/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_rename_4.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e1e5626dc66aa2bf4a2529b4aa842741d726340/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_rename_4.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_rename_4.f90?ref=3e1e5626dc66aa2bf4a2529b4aa842741d726340", "patch": "@@ -0,0 +1,22 @@\n+! { dg-do run }\n+\n+! PR fortran/37193\n+! Check fix for problem with re-using the same symbol both renamed and\n+! plain.\n+\n+MODULE m\n+  IMPLICIT NONE\n+  INTEGER :: i\n+END MODULE m\n+\n+PROGRAM main\n+  USE m, ONLY: i, j => i\n+  IMPLICIT NONE\n+\n+  i = 4\n+  j = 5\n+\n+  IF (i /= j) THEN\n+    CALL abort ()\n+  END IF\n+END PROGRAM main"}, {"sha": "3d7839a0d121f5750bd733afbf40a5539c3f2115", "filename": "gcc/testsuite/gfortran.dg/use_rename_5.f90", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e1e5626dc66aa2bf4a2529b4aa842741d726340/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_rename_5.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e1e5626dc66aa2bf4a2529b4aa842741d726340/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_rename_5.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_rename_5.f90?ref=3e1e5626dc66aa2bf4a2529b4aa842741d726340", "patch": "@@ -0,0 +1,17 @@\n+! { dg-do compile }\n+\n+! PR fortran/37193\n+! Check that renamed symbols are not accessiable uner their target name.\n+\n+MODULE m\n+  IMPLICIT NONE\n+  INTEGER :: i\n+END MODULE m\n+\n+PROGRAM main\n+  USE m, ONLY: j => i\n+  IMPLICIT NONE\n+\n+  i = 4 ! { dg-error \"no IMPLICIT type\" }\n+  j = 5\n+END PROGRAM main"}]}