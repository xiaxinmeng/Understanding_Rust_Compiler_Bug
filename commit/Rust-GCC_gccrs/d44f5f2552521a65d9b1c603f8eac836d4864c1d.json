{"sha": "d44f5f2552521a65d9b1c603f8eac836d4864c1d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDQ0ZjVmMjU1MjUyMWE2NWQ5YjFjNjAzZjhlYWM4MzZkNDg2NGMxZA==", "commit": {"author": {"name": "Sterling Augustine", "email": "saugustine@google.com", "date": "2012-06-26T17:54:02Z"}, "committer": {"name": "Sterling Augustine", "email": "sterling@gcc.gnu.org", "date": "2012-06-26T17:54:02Z"}, "message": "dwarf2out.c (output_pubnames): Add check for DW_TAG_enumerator.\n\n2012-06-26  Sterling Augustine <saugustine@google.com>\n\n        * dwarf2out.c (output_pubnames): Add check for DW_TAG_enumerator.\n        (prune_unused_types): Likewise.\n\nFrom-SVN: r188992", "tree": {"sha": "652a2faa5f2b08b4e47e4a933a3f4f0e5a55256d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/652a2faa5f2b08b4e47e4a933a3f4f0e5a55256d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d44f5f2552521a65d9b1c603f8eac836d4864c1d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d44f5f2552521a65d9b1c603f8eac836d4864c1d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d44f5f2552521a65d9b1c603f8eac836d4864c1d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d44f5f2552521a65d9b1c603f8eac836d4864c1d/comments", "author": {"login": "Sterling-Augustine", "id": 56981066, "node_id": "MDQ6VXNlcjU2OTgxMDY2", "avatar_url": "https://avatars.githubusercontent.com/u/56981066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Sterling-Augustine", "html_url": "https://github.com/Sterling-Augustine", "followers_url": "https://api.github.com/users/Sterling-Augustine/followers", "following_url": "https://api.github.com/users/Sterling-Augustine/following{/other_user}", "gists_url": "https://api.github.com/users/Sterling-Augustine/gists{/gist_id}", "starred_url": "https://api.github.com/users/Sterling-Augustine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Sterling-Augustine/subscriptions", "organizations_url": "https://api.github.com/users/Sterling-Augustine/orgs", "repos_url": "https://api.github.com/users/Sterling-Augustine/repos", "events_url": "https://api.github.com/users/Sterling-Augustine/events{/privacy}", "received_events_url": "https://api.github.com/users/Sterling-Augustine/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "01a07a642e8b9435327efc7d603fa5bf849a8c25", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/01a07a642e8b9435327efc7d603fa5bf849a8c25", "html_url": "https://github.com/Rust-GCC/gccrs/commit/01a07a642e8b9435327efc7d603fa5bf849a8c25"}], "stats": {"total": 20, "additions": 17, "deletions": 3}, "files": [{"sha": "3944f3c3eb5c698e83a86b3659e0dcecd8d5efb1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d44f5f2552521a65d9b1c603f8eac836d4864c1d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d44f5f2552521a65d9b1c603f8eac836d4864c1d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d44f5f2552521a65d9b1c603f8eac836d4864c1d", "patch": "@@ -1,3 +1,8 @@\n+2012-06-26  Sterling Augustine <saugustine@google.com>\n+\n+        * dwarf2out.c (output_pubnames): Add check for DW_TAG_enumerator.\n+        (prune_unused_types): Likewise.\n+\n 2012-06-26  Steven Bosscher  <steven@gcc.gnu.org>\n \n \t* system.h (UNALIGNED_SHORT_ASM_OP, UNALIGNED_INT_ASM_OP,"}, {"sha": "fc0659b45e4bc01abd609ad9a147307db9b13300", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d44f5f2552521a65d9b1c603f8eac836d4864c1d/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d44f5f2552521a65d9b1c603f8eac836d4864c1d/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=d44f5f2552521a65d9b1c603f8eac836d4864c1d", "patch": "@@ -8284,6 +8284,12 @@ output_pubnames (VEC (pubname_entry, gc) * names)\n \n   FOR_EACH_VEC_ELT (pubname_entry, names, i, pub)\n     {\n+      /* Enumerator names are part of the pubname table, but the parent\n+         DW_TAG_enumeration_type die may have been pruned.  Don't output\n+         them if that is the case.  */\n+      if (pub->die->die_tag == DW_TAG_enumerator && !pub->die->die_mark)\n+        continue;\n+\n       /* We shouldn't see pubnames for DIEs outside of the main CU.  */\n       if (names == pubname_table)\n \tgcc_assert (pub->die->die_mark);\n@@ -21239,10 +21245,13 @@ prune_unused_types (void)\n       prune_unused_types_mark (ctnode->type_die, 1);\n     }\n \n-  /* Also set the mark on nodes referenced from the\n-     pubname_table.  */\n+  /* Also set the mark on nodes referenced from the pubname_table.  Enumerators\n+     are unusual in that they are pubnames that are the children of pubtypes.\n+     They should only be marked via their parent DW_TAG_enumeration_type die,\n+     not as roots in themselves.  */\n   FOR_EACH_VEC_ELT (pubname_entry, pubname_table, i, pub)\n-    prune_unused_types_mark (pub->die, 1);\n+    if (pub->die->die_tag != DW_TAG_enumerator)\n+      prune_unused_types_mark (pub->die, 1);\n   for (i = 0; VEC_iterate (dw_die_ref, base_types, i, base_type); i++)\n     prune_unused_types_mark (base_type, 1);\n "}]}