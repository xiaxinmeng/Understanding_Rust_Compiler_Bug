{"sha": "1474fe46658b9f862fea62b270754bd5a3eb243c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTQ3NGZlNDY2NThiOWY4NjJmZWE2MmIyNzA3NTRiZDVhM2ViMjQzYw==", "commit": {"author": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1994-04-06T11:31:44Z"}, "committer": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1994-04-06T11:31:44Z"}, "message": "(warn_missing_declarations): New variable.\n\n(c_decode_option): -Wmissing-declarations.\n(start_function): Actually do the checking.\n\nFrom-SVN: r6981", "tree": {"sha": "434770c36939635a3a719d72eb063b9d683d5846", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/434770c36939635a3a719d72eb063b9d683d5846"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1474fe46658b9f862fea62b270754bd5a3eb243c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1474fe46658b9f862fea62b270754bd5a3eb243c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1474fe46658b9f862fea62b270754bd5a3eb243c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1474fe46658b9f862fea62b270754bd5a3eb243c/comments", "author": null, "committer": null, "parents": [{"sha": "812fe08e5a54874b5265b504787afcb79d02769d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/812fe08e5a54874b5265b504787afcb79d02769d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/812fe08e5a54874b5265b504787afcb79d02769d"}], "stats": {"total": 24, "additions": 23, "deletions": 1}, "files": [{"sha": "53b08ee22535aa5f9070cc9caa187acc4bd8bd60", "filename": "gcc/c-decl.c", "status": "modified", "additions": 23, "deletions": 1, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1474fe46658b9f862fea62b270754bd5a3eb243c/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1474fe46658b9f862fea62b270754bd5a3eb243c/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=1474fe46658b9f862fea62b270754bd5a3eb243c", "patch": "@@ -484,6 +484,11 @@ int warn_strict_prototypes;\n \n int warn_missing_prototypes;\n \n+/* Nonzero means warn for any global function def\n+   without separate previous decl.  */\n+\n+int warn_missing_declarations;\n+\n /* Nonzero means warn about multiple (redundant) decls for the same single\n    variable or function.  */\n \n@@ -627,6 +632,10 @@ c_decode_option (p)\n     warn_missing_prototypes = 1;\n   else if (!strcmp (p, \"-Wno-missing-prototypes\"))\n     warn_missing_prototypes = 0;\n+  else if (!strcmp (p, \"-Wmissing-declarations\"))\n+    warn_missing_declarations = 1;\n+  else if (!strcmp (p, \"-Wno-missing-declarations\"))\n+    warn_missing_declarations = 0;\n   else if (!strcmp (p, \"-Wredundant-decls\"))\n     warn_redundant_decls = 1;\n   else if (!strcmp (p, \"-Wno-redundant-decls\"))\n@@ -5832,7 +5841,20 @@ start_function (declspecs, declarator, nested)\n   else if (warn_missing_prototypes\n \t   && old_decl != 0 && TREE_USED (old_decl)\n \t   && !(old_decl != 0 && TYPE_ARG_TYPES (TREE_TYPE (old_decl)) != 0))\n-    warning_with_decl (decl1, \"`%s' was used with no prototype before its definition\");\n+    warning_with_decl (decl1,\n+\t\t      \"`%s' was used with no prototype before its definition\");\n+  /* Optionally warn of any global def with no previous declaration.  */\n+  else if (warn_missing_declarations\n+\t   && TREE_PUBLIC (decl1)\n+\t   && old_decl == 0\n+\t   && strcmp (\"main\", IDENTIFIER_POINTER (DECL_NAME (decl1))))\n+    warning_with_decl (decl1, \"no previous declaration for `%s'\");\n+  /* Optionally warn of any def with no previous declaration\n+     if the function has already been used.  */\n+  else if (warn_missing_declarations\n+\t   && old_decl != 0 && TREE_USED (old_decl))\n+    warning_with_decl (decl1,\n+\t\t    \"`%s' was used with no declaration before its definition\");\n \n   /* This is a definition, not a reference.\n      So normally clear DECL_EXTERNAL."}]}