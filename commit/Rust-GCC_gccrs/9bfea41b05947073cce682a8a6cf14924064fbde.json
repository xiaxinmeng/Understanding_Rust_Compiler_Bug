{"sha": "9bfea41b05947073cce682a8a6cf14924064fbde", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWJmZWE0MWIwNTk0NzA3M2NjZTY4MmE4YTZjZjE0OTI0MDY0ZmJkZQ==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2009-01-06T03:27:39Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2009-01-06T03:27:39Z"}, "message": "re PR c++/38698 (ICE initializing union with initializer list)\n\n        PR c++/38698\n        * typeck2.c (process_init_constructor_union): Handle union with\n        no fields.\n\n        * mangle.c (write_expression): Remove mangling for zero-operand\n        casts.\n\nFrom-SVN: r143111", "tree": {"sha": "9733822ded9e2fc2f88167786037c4eadb498da2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9733822ded9e2fc2f88167786037c4eadb498da2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9bfea41b05947073cce682a8a6cf14924064fbde", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9bfea41b05947073cce682a8a6cf14924064fbde", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9bfea41b05947073cce682a8a6cf14924064fbde", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9bfea41b05947073cce682a8a6cf14924064fbde/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "77d96a79bfcc66cba3e59bee6b80477c5bd08df2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/77d96a79bfcc66cba3e59bee6b80477c5bd08df2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/77d96a79bfcc66cba3e59bee6b80477c5bd08df2"}], "stats": {"total": 27, "additions": 22, "deletions": 5}, "files": [{"sha": "1e85539e988e2cd9f6e4ac36268b1a10c777a697", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9bfea41b05947073cce682a8a6cf14924064fbde/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9bfea41b05947073cce682a8a6cf14924064fbde/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=9bfea41b05947073cce682a8a6cf14924064fbde", "patch": "@@ -5,6 +5,13 @@\n \n 2009-01-05  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/38698\n+\t* typeck2.c (process_init_constructor_union): Handle union with\n+\tno fields.\n+\n+\t* mangle.c (write_expression): Remove mangling for zero-operand\n+\tcasts.\n+\n \tPR c++/38701\n \t* decl.c (cp_finish_decl): Clear DECL_INITIAL for invalid\n \tdefaulting."}, {"sha": "a7b466217ebd0aaf7e32d07636681d67f8f05f0d", "filename": "gcc/cp/mangle.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9bfea41b05947073cce682a8a6cf14924064fbde/gcc%2Fcp%2Fmangle.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9bfea41b05947073cce682a8a6cf14924064fbde/gcc%2Fcp%2Fmangle.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fmangle.c?ref=9bfea41b05947073cce682a8a6cf14924064fbde", "patch": "@@ -2348,12 +2348,12 @@ write_expression (tree expr)\n \n \tcase CAST_EXPR:\n \t  write_type (TREE_TYPE (expr));\n+\t  /* There is no way to mangle a zero-operand cast like\n+\t     \"T()\".  */\n \t  if (!TREE_OPERAND (expr, 0))\n-\t    /* \"T()\" is mangled as \"T(void)\".  */\n-\t    write_char ('v');\n+\t    sorry (\"zero-operand casts cannot be mangled due to a defect \"\n+\t\t   \"in the C++ ABI\");\n \t  else if (list_length (TREE_OPERAND (expr, 0)) > 1)\n-\t    /* FIXME the above hack for T() needs to be replaced with\n-\t       something more general.  */\n \t    sorry (\"mangling function-style cast with more than one argument\");\n \t  else\n \t    write_expression (TREE_VALUE (TREE_OPERAND (expr, 0)));"}, {"sha": "60e4ef1725429dfc01635bb0dea59908b9362512", "filename": "gcc/cp/typeck2.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9bfea41b05947073cce682a8a6cf14924064fbde/gcc%2Fcp%2Ftypeck2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9bfea41b05947073cce682a8a6cf14924064fbde/gcc%2Fcp%2Ftypeck2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck2.c?ref=9bfea41b05947073cce682a8a6cf14924064fbde", "patch": "@@ -1147,7 +1147,11 @@ process_init_constructor_union (tree type, tree init)\n       tree field = TYPE_FIELDS (type);\n       while (field && (!DECL_NAME (field) || TREE_CODE (field) != FIELD_DECL))\n \tfield = TREE_CHAIN (field);\n-      gcc_assert (field);\n+      if (field == NULL_TREE)\n+\t{\n+\t  error (\"too many initializers for %qT\", type);\n+\t  ce->value = error_mark_node;\n+\t}\n       ce->index = field;\n     }\n "}, {"sha": "7c43f7826750f0b18adf80e75162dcb457b64ee9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9bfea41b05947073cce682a8a6cf14924064fbde/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9bfea41b05947073cce682a8a6cf14924064fbde/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9bfea41b05947073cce682a8a6cf14924064fbde", "patch": "@@ -53,6 +53,8 @@\n \n 2009-01-05  Jason Merrill  <jason@redhat.com>\n \n+\t* g++.dg/cpp0x/initlist12.C: Add another test.\n+\n \t* g++.dg/cpp0x/defaulted7.C: New test.\n \n 2009-01-05  Thomas Koenig  <tkoenig@gcc.gnu.org>"}, {"sha": "31d34c4e71db85aa17306639e8e995887738898e", "filename": "gcc/testsuite/g++.dg/cpp0x/initlist12.C", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9bfea41b05947073cce682a8a6cf14924064fbde/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finitlist12.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9bfea41b05947073cce682a8a6cf14924064fbde/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finitlist12.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finitlist12.C?ref=9bfea41b05947073cce682a8a6cf14924064fbde", "patch": "@@ -14,3 +14,7 @@ union U\n };\n \n U u({1,2});\t\t\t// { dg-error \"too many initializers\" }\n+\n+union V {};\n+\n+V v({1});\t\t\t// { dg-error \"too many initializers\" }"}]}