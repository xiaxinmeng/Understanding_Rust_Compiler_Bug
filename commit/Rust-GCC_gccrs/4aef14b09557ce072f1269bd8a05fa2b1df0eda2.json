{"sha": "4aef14b09557ce072f1269bd8a05fa2b1df0eda2", "node_id": "C_kwDOANBUbNoAKDRhZWYxNGIwOTU1N2NlMDcyZjEyNjliZDhhMDVmYTJiMWRmMGVkYTI", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2021-10-07T12:55:48Z"}, "committer": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2021-10-15T18:49:00Z"}, "message": "Darwin: Update specs handling '-r'.\n\nWe were not wrapping all the default libraries in checks for whether\nthey should be used.  We were also wasting a process launch calling\ndsymutil for 'r' link lines (a NOP in practice).  Order the checks\nthat exclude linking from most likely to occur, downwards.\n\nSigned-off-by: Iain Sandoe <iain@sandoe.co.uk>\n\ngcc/ChangeLog:\n\n\t* config/darwin.h (LINK_COMMAND_SPEC_A): Update 'r' handling to\n\tskip gomp and itm when r or nodefaultlibs is given.\n\t(DSYMUTIL_SPEC): Do not call dsymutil for '-r' link lines.\n\tUpdate ordering of exclusions, remove duplicate 'v' addition\n\t(collect2 will add this from the main command line).", "tree": {"sha": "ad197b9e1e7d92c8e426b9307b1768f87bb2342f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ad197b9e1e7d92c8e426b9307b1768f87bb2342f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4aef14b09557ce072f1269bd8a05fa2b1df0eda2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4aef14b09557ce072f1269bd8a05fa2b1df0eda2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4aef14b09557ce072f1269bd8a05fa2b1df0eda2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4aef14b09557ce072f1269bd8a05fa2b1df0eda2/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "353cb291a486af3be93dd9320dde9e38b542a1bd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/353cb291a486af3be93dd9320dde9e38b542a1bd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/353cb291a486af3be93dd9320dde9e38b542a1bd"}], "stats": {"total": 33, "additions": 18, "deletions": 15}, "files": [{"sha": "27cb3e4bb3042757b9f6266fda51706163244f3d", "filename": "gcc/config/darwin.h", "status": "modified", "additions": 18, "deletions": 15, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4aef14b09557ce072f1269bd8a05fa2b1df0eda2/gcc%2Fconfig%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4aef14b09557ce072f1269bd8a05fa2b1df0eda2/gcc%2Fconfig%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.h?ref=4aef14b09557ce072f1269bd8a05fa2b1df0eda2", "patch": "@@ -349,7 +349,7 @@ extern GTY(()) int darwin_ms_struct;\n    linkers, and for positional arguments like libraries.  */\n \n #define LINK_COMMAND_SPEC_A \\\n-   \"%{!fdump=*:%{!fsyntax-only:%{!c:%{!M:%{!MM:%{!E:%{!S:\\\n+   \"%{!c:%{!E:%{!S:%{!M:%{!MM:%{!fsyntax-only:%{!fdump=*: \\\n     %(linker)\" \\\n     LINK_PLUGIN_SPEC \\\n     \"%{flto*:%<fcompare-debug*} \\\n@@ -358,20 +358,23 @@ extern GTY(()) int darwin_ms_struct;\n    \"%X %{s} %{t} %{Z} %{u*} \\\n     %{e*} %{r} \\\n     %{o*}%{!o:-o a.out} \\\n-    %{!nostdlib:%{!r:%{!nostartfiles:%S}}} \\\n-    %{L*} %(link_libgcc) %o %{fprofile-arcs|fprofile-generate*|coverage:-lgcov} \\\n-    %{fopenacc|fopenmp|%:gt(%{ftree-parallelize-loops=*:%*} 1): \\\n-      %{static|static-libgcc|static-libstdc++|static-libgfortran: libgomp.a%s; : -lgomp } } \\\n-    %{fgnu-tm: \\\n-      %{static|static-libgcc|static-libstdc++|static-libgfortran: libitm.a%s; : -litm } } \\\n-    %{!nostdlib:%{!r:%{!nodefaultlibs:\\\n+    %{!r:%{!nostdlib:%{!nostartfiles:%S}}} \\\n+    %{L*} %(link_libgcc) %o \\\n+    %{!r:%{!nostdlib:%{!nodefaultlibs:\\\n+      %{fprofile-arcs|fprofile-generate*|coverage:-lgcov} \\\n+      %{fopenacc|fopenmp|%:gt(%{ftree-parallelize-loops=*:%*} 1): \\\n+\t%{static|static-libgcc|static-libstdc++|static-libgfortran: \\\n+\t  libgomp.a%s; : -lgomp }} \\\n+      %{fgnu-tm: \\\n+\t%{static|static-libgcc|static-libstdc++|static-libgfortran: \\\n+\t  libitm.a%s; : -litm }} \\\n       %{%:sanitize(address): -lasan } \\\n       %{%:sanitize(undefined): -lubsan } \\\n       %(link_ssp) \\\n       %:version-compare(>< 10.6 10.7 mmacosx-version-min= -ld10-uwfef) \\\n       %(link_gcc_c_sequence) \\\n     }}}\\\n-    %{!nostdlib:%{!r:%{!nostartfiles:%E}}} %{T*} %{F*} \"\\\n+    %{!r:%{!nostdlib:%{!nostartfiles:%E}}} %{T*} %{F*} \"\\\n     DARWIN_PIE_SPEC \\\n     DARWIN_NOPIE_SPEC \\\n     DARWIN_RDYNAMIC \\\n@@ -384,12 +387,12 @@ extern GTY(()) int darwin_ms_struct;\n    enabled).  */\n \n #define DSYMUTIL_SPEC \\\n-   \"%{!fdump=*:%{!fsyntax-only:%{!c:%{!M:%{!MM:%{!E:%{!S:\\\n-    %{v} \\\n-    %{g*:%{!gctf:%{!gbtf:%{!gstabs*:%{%:debug-level-gt(0): -idsym}}}}}\\\n-    %{.c|.cc|.C|.cpp|.cp|.c++|.cxx|.CPP|.m|.mm|.s|.f|.f90|\\\n-      .f95|.f03|.f77|.for|.F|.F90|.F95|.F03|.d: \\\n-    %{g*:%{!gctf:%{!gbtf:%{!gstabs*:%{%:debug-level-gt(0): -dsym}}}}}}}}}}}}}\"\n+  \"%{!c:%{!E:%{!S:%{!r:%{!M:%{!MM:%{!fsyntax-only:%{!fdump=*:\\\n+     %{g*:%{!gctf:%{!gbtf:%{!gstabs*:%{%:debug-level-gt(0): -idsym \\\n+       %{.c|.cc|.C|.cpp|.cp|.c++|.cxx|.CPP|.m|.mm|.s|.f|.f90|\\\n+\t .f95|.f03|.f77|.for|.F|.F90|.F95|.F03|.d: -dsym }\\\n+      }}}}}\\\n+   }}}}}}}}\"\n \n #define LINK_COMMAND_SPEC LINK_COMMAND_SPEC_A DSYMUTIL_SPEC\n "}]}