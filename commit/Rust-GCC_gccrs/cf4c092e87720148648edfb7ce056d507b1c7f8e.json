{"sha": "cf4c092e87720148648edfb7ce056d507b1c7f8e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2Y0YzA5MmU4NzcyMDE0ODY0OGVkZmI3Y2UwNTZkNTA3YjFjN2Y4ZQ==", "commit": {"author": {"name": "Catherine Moore", "email": "clm@redhat.com", "date": "2001-10-19T21:23:29Z"}, "committer": {"name": "Catherine Moore", "email": "clm@gcc.gnu.org", "date": "2001-10-19T21:23:29Z"}, "message": "stormy-abi: Updates to varargs descriptions.\n\n        * config/stormy16/stormy-abi:  Updates to varargs descriptions.\n        * config/stormy16/stormy16.c (stormy16_build_va_list):  Reverse\n        base and count fields.\n        (stormy16_expand_builtin_va_start):  last_reg_count changed to\n        size_of_reg_args.  Use count + size in first comparison.\n\nFrom-SVN: r46365", "tree": {"sha": "63570e12cc6dec26d59ba5a82abc651957a2af20", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/63570e12cc6dec26d59ba5a82abc651957a2af20"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cf4c092e87720148648edfb7ce056d507b1c7f8e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf4c092e87720148648edfb7ce056d507b1c7f8e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cf4c092e87720148648edfb7ce056d507b1c7f8e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf4c092e87720148648edfb7ce056d507b1c7f8e/comments", "author": null, "committer": null, "parents": [{"sha": "16f7dac7f50249b115103ce71cf55301b1c35538", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16f7dac7f50249b115103ce71cf55301b1c35538", "html_url": "https://github.com/Rust-GCC/gccrs/commit/16f7dac7f50249b115103ce71cf55301b1c35538"}], "stats": {"total": 42, "additions": 29, "deletions": 13}, "files": [{"sha": "9e5da09b60d071a0dc20392e4f6cb2f77c51262d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf4c092e87720148648edfb7ce056d507b1c7f8e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf4c092e87720148648edfb7ce056d507b1c7f8e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=cf4c092e87720148648edfb7ce056d507b1c7f8e", "patch": "@@ -1,3 +1,11 @@\n+2001-10-19  Catherine Moore  <clm@redhat.com>\n+\n+        * config/stormy16/stormy-abi:  Updates to varargs descriptions.\n+        * config/stormy16/stormy16.c (stormy16_build_va_list):  Reverse\n+        base and count fields.\n+        (stormy16_expand_builtin_va_start):  last_reg_count changed to\n+        size_of_reg_args.  Use count + size in first comparison.\n+\n Fri Oct 19 15:24:39 2001  Richard Kenner  <kenner@vlsi1.ultra.nyu.edu>\n \n \t* langhooks.h (LANG_HOOKS_HONOR_READONLY): New macro."}, {"sha": "c613757f22025e3fe56a40dcf14c24032a144ee0", "filename": "gcc/config/stormy16/stormy-abi", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf4c092e87720148648edfb7ce056d507b1c7f8e/gcc%2Fconfig%2Fstormy16%2Fstormy-abi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf4c092e87720148648edfb7ce056d507b1c7f8e/gcc%2Fconfig%2Fstormy16%2Fstormy-abi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fstormy16%2Fstormy-abi?ref=cf4c092e87720148648edfb7ce056d507b1c7f8e", "patch": "@@ -70,11 +70,13 @@ Both fields are 16 bits.  An argument of size N bytes\n (N will be even) is accessed as if by the following code:\n \n char *result;\n-if (count + N > 16)\n+/* count = #bytes non-variable arguments */\n+/* 12 = #bytes for register arguments */\n+if (count + N > 12)\n   {\n-    if (count < 16)\n-      count = 16;\n-    result = base - (count + N - 16 + 4);\n+    if (count < 12)\n+      count = 12;\n+    result = base - (count + N - 12 + 4);\n   }\n else\n   {\n@@ -98,8 +100,8 @@ SP ->\n \tr3\n count->\tr2\n \tReturn address (two words)\n-\t9th procedure parameter word\n-\t10th procedure parameter word\n+\t7th procedure parameter word\n+\t8th procedure parameter word\n \t...\n \tlast procedure parameter word\n "}, {"sha": "6b69e5c33417e60dc1445b4825ce2a803e2a2842", "filename": "gcc/config/stormy16/stormy16.c", "status": "modified", "additions": 13, "deletions": 7, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf4c092e87720148648edfb7ce056d507b1c7f8e/gcc%2Fconfig%2Fstormy16%2Fstormy16.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf4c092e87720148648edfb7ce056d507b1c7f8e/gcc%2Fconfig%2Fstormy16%2Fstormy16.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fstormy16%2Fstormy16.c?ref=cf4c092e87720148648edfb7ce056d507b1c7f8e", "patch": "@@ -1131,9 +1131,9 @@ stormy16_build_va_list ()\n   record = make_lang_type (RECORD_TYPE);\n   type_decl = build_decl (TYPE_DECL, get_identifier (\"__va_list_tag\"), record);\n \n-  f_2 = build_decl (FIELD_DECL, get_identifier (\"base\"),\n+  f_1 = build_decl (FIELD_DECL, get_identifier (\"base\"),\n \t\t      ptr_type_node);\n-  f_1 = build_decl (FIELD_DECL, get_identifier (\"count\"), \n+  f_2 = build_decl (FIELD_DECL, get_identifier (\"count\"), \n \t\t      unsigned_type_node);\n \n   DECL_FIELD_CONTEXT (f_1) = record;\n@@ -1186,7 +1186,9 @@ stormy16_expand_builtin_va_start (stdarg_p, valist, nextarg)\n }\n \n /* Implement the stdarg/varargs va_arg macro.  VALIST is the variable\n-   of type va_list as a tree, TYPE is the type passed to va_arg.  */\n+   of type va_list as a tree, TYPE is the type passed to va_arg.\n+   Note:  This algorithm is documented in stormy-abi.  */\n+   \n rtx\n stormy16_expand_builtin_va_arg (valist, type)\n      tree valist;\n@@ -1197,8 +1199,9 @@ stormy16_expand_builtin_va_arg (valist, type)\n   rtx count_rtx, addr_rtx, r;\n   rtx lab_gotaddr, lab_fromstack;\n   tree t;\n-  int size, last_reg_count;\n+  int size, size_of_reg_args;\n   tree size_tree, count_plus_size;\n+  rtx count_plus_size_rtx;\n   \n   f_base = TYPE_FIELDS (va_list_type_node);\n   f_count = TREE_CHAIN (f_base);\n@@ -1209,14 +1212,17 @@ stormy16_expand_builtin_va_arg (valist, type)\n   size = PUSH_ROUNDING (int_size_in_bytes (type));\n   size_tree = round_up (size_in_bytes (type), UNITS_PER_WORD);\n   \n-  last_reg_count = NUM_ARGUMENT_REGISTERS * UNITS_PER_WORD - size;\n+  size_of_reg_args = NUM_ARGUMENT_REGISTERS * UNITS_PER_WORD;\n \n   count_rtx = expand_expr (count, NULL_RTX, HImode, EXPAND_NORMAL);\n   lab_gotaddr = gen_label_rtx ();\n   lab_fromstack = gen_label_rtx ();\n   addr_rtx = gen_reg_rtx (Pmode);\n-  emit_cmp_and_jump_insns (count_rtx, GEN_INT (last_reg_count),\n-\t\t\t  GTU, const1_rtx, HImode, 1, 1, lab_fromstack);\n+\n+  count_plus_size = build (PLUS_EXPR, TREE_TYPE (count), count, size_tree);\n+  count_plus_size_rtx = expand_expr (count_plus_size, NULL_RTX, HImode, EXPAND_NORMAL);\n+  emit_cmp_and_jump_insns (count_plus_size_rtx, GEN_INT (size_of_reg_args),\n+\t\t\t   GTU, const1_rtx, HImode, 1, 1, lab_fromstack);\n   \n   t = build (PLUS_EXPR, ptr_type_node, base, count);\n   r = expand_expr (t, addr_rtx, Pmode, EXPAND_NORMAL);"}]}