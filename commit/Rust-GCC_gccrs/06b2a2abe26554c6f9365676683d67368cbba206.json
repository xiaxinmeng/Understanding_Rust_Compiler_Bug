{"sha": "06b2a2abe26554c6f9365676683d67368cbba206", "node_id": "C_kwDOANBUbNoAKDA2YjJhMmFiZTI2NTU0YzZmOTM2NTY3NjY4M2Q2NzM2OGNiYmEyMDY", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2022-07-11T07:33:19Z"}, "committer": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2022-07-11T09:23:33Z"}, "message": "Enhance '_Pragma' diagnostics verification in OMP C/C++ test cases\n\nFollow-up to recent commit 0587cef3d7962a8b0f44779589ba2920dd3d71e5\n\"c: Fix location for _Pragma tokens [PR97498]\".\n\n\tgcc/testsuite/\n\t* c-c++-common/gomp/pragma-3.c: Enhance '_Pragma' diagnostics\n\tverification.\n\t* c-c++-common/gomp/pragma-5.c: Likewise.\n\tlibgomp/\n\t* testsuite/libgomp.oacc-c-c++-common/reduction-5.c: Enhance\n\t'_Pragma' diagnostics verification.", "tree": {"sha": "a01d98b250ff10e44f48dafe771d882dcdb75240", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a01d98b250ff10e44f48dafe771d882dcdb75240"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/06b2a2abe26554c6f9365676683d67368cbba206", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/06b2a2abe26554c6f9365676683d67368cbba206", "html_url": "https://github.com/Rust-GCC/gccrs/commit/06b2a2abe26554c6f9365676683d67368cbba206", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/06b2a2abe26554c6f9365676683d67368cbba206/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4c94382a132a4b2b9d020806549a006fa6764d1b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4c94382a132a4b2b9d020806549a006fa6764d1b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4c94382a132a4b2b9d020806549a006fa6764d1b"}], "stats": {"total": 24, "additions": 15, "deletions": 9}, "files": [{"sha": "3e1b2111c3d0675ad3c889d37fe6309f06ab6113", "filename": "gcc/testsuite/c-c++-common/gomp/pragma-3.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06b2a2abe26554c6f9365676683d67368cbba206/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpragma-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06b2a2abe26554c6f9365676683d67368cbba206/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpragma-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpragma-3.c?ref=06b2a2abe26554c6f9365676683d67368cbba206", "patch": "@@ -2,13 +2,15 @@\n /* PR preprocessor/103165  */\n \n #define inner(...) #__VA_ARGS__ ; _Pragma(\"omp error severity(warning) message (\\\"Test\\\") at(compilation)\") /* { dg-line inner_location } */\n-#define outer(...) inner(__VA_ARGS__)\n+#define outer(...) inner(__VA_ARGS__) /* { dg-line outer_location } */\n \n void\n f (void)\n {\n-  const char *str = outer(inner(1,2));\n-  /* { dg-warning \"'pragma omp error' encountered: Test\" \"inner expansion\" { target *-*-* } inner_location } */\n+  const char *str = outer(inner(1,2)); /* { dg-line str_location } */\n+  /* { dg-warning \"35:'pragma omp error' encountered: Test\" \"\" { target *-*-* } inner_location }\n+     { dg-note \"20:in expansion of macro 'inner'\" \"\" { target *-*-* } outer_location }\n+     { dg-note \"21:in expansion of macro 'outer'\" \"\" { target *-*-* } str_location } */\n }\n \n #if 0"}, {"sha": "173c25e803af649ec7d3c6c70c6a5f1982aa5e44", "filename": "gcc/testsuite/c-c++-common/gomp/pragma-5.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06b2a2abe26554c6f9365676683d67368cbba206/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpragma-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06b2a2abe26554c6f9365676683d67368cbba206/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpragma-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpragma-5.c?ref=06b2a2abe26554c6f9365676683d67368cbba206", "patch": "@@ -2,13 +2,15 @@\n /* PR preprocessor/103165  */\n \n #define inner(...) #__VA_ARGS__ ; _Pragma   (\t\"   omp\t\terror severity   (warning)\tmessage (\\\"Test\\\") at(compilation)\" ) /* { dg-line inner_location } */\n-#define outer(...) inner(__VA_ARGS__)\n+#define outer(...) inner(__VA_ARGS__) /* { dg-line outer_location } */\n \n void\n f (void)\n {\n-  const char *str = outer(inner(1,2));\n-  /* { dg-warning \"'pragma omp error' encountered: Test\" \"inner expansion\" { target *-*-* } inner_location } */\n+  const char *str = outer(inner(1,2)); /* { dg-line str_location } */\n+  /* { dg-warning \"35:'pragma omp error' encountered: Test\" \"\" { target *-*-* } inner_location }\n+     { dg-note \"20:in expansion of macro 'inner'\" \"\" { target *-*-* } outer_location }\n+     { dg-note \"21:in expansion of macro 'outer'\" \"\" { target *-*-* } str_location } */\n }\n \n #if 0"}, {"sha": "72094609f0fa181fd6e5f959df7d8405768073ee", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/reduction-5.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06b2a2abe26554c6f9365676683d67368cbba206/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Freduction-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06b2a2abe26554c6f9365676683d67368cbba206/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Freduction-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Freduction-5.c?ref=06b2a2abe26554c6f9365676683d67368cbba206", "patch": "@@ -17,7 +17,7 @@ const int n = 100;\n #define check_reduction(gwv_par, gwv_loop)\t\t\\\n   {\t\t\t\t\t\t\t\\\n   s1 = 2; s2 = 5;\t\t\t\t\t\\\n-DO_PRAGMA (acc parallel gwv_par copy (s1, s2))\t\t\\\n+DO_PRAGMA (acc parallel gwv_par copy (s1, s2)) /* { dg-line DO_PRAGMA_loc } */ \\\n DO_PRAGMA (acc loop gwv_loop reduction (+:s1, s2))\t\\\n     for (i = 0; i < n; i++)\t\t\t\t\\\n       {\t\t\t\t\t\t\t\\\n@@ -45,8 +45,10 @@ main (void)\n \n   /* Nvptx targets require a vector_length or 32 in to allow spinlocks with\n      gangs.  */\n-  check_reduction (num_workers (nw) vector_length (vl), worker);\n-  /* { dg-warning \"region is vector partitioned but does not contain vector partitioned code\" \"test1\" { target *-*-* } pragma_loc } */\n+  check_reduction (num_workers (nw) vector_length (vl), worker); /* { dg-line check_reduction_loc }\n+  /* { dg-warning \"22:region is vector partitioned but does not contain vector partitioned code\" \"\" { target *-*-* } pragma_loc }\n+     { dg-note \"1:in expansion of macro 'DO_PRAGMA'\" \"\" { target *-*-* } DO_PRAGMA_loc }\n+     { dg-note \"3:in expansion of macro 'check_reduction'\" \"\" { target *-*-* } check_reduction_loc } */\n   check_reduction (vector_length (vl), vector);\n   check_reduction (num_gangs (ng) num_workers (nw) vector_length (vl), gang\n \t\t   worker vector);"}]}