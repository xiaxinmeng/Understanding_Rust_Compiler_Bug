{"sha": "ed7e7620188dc0e653815bdd40d8802bd5446638", "node_id": "C_kwDOANBUbNoAKGVkN2U3NjIwMTg4ZGMwZTY1MzgxNWJkZDQwZDg4MDJiZDU0NDY2Mzg", "commit": {"author": {"name": "Immad Mir", "email": "mirimmad@outlook.com", "date": "2022-08-15T16:51:27Z"}, "committer": {"name": "Immad Mir", "email": "mirimmad@outlook.com", "date": "2022-08-15T16:51:36Z"}, "message": "analyzer: fix for ICE in sm-fd.cc [PR106551]\n\nThis patch fixes the ICE caused by valid_to_unchecked_state\nin sm-fd.cc by exiting early if first argument of any \"dup\"\nfunctions is invalid.\n\ngcc/analyzer/ChangeLog:\n\tPR analyzer/106551\n\t* sm-fd.cc (check_for_dup): exit early if first\n\targument is invalid for all dup functions.\n\ngcc/testsuite/ChangeLog:\n\tPR analyzer/106551\n\t* gcc.dg/analyzer/fd-dup-1.c: New testcase.\n\nSigned-off-by: Immad Mir <mirimmad@outlook.com>", "tree": {"sha": "a3a31c61fb9c9941944fc1e19ebe401ea9573cdd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a3a31c61fb9c9941944fc1e19ebe401ea9573cdd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ed7e7620188dc0e653815bdd40d8802bd5446638", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ed7e7620188dc0e653815bdd40d8802bd5446638", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ed7e7620188dc0e653815bdd40d8802bd5446638", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ed7e7620188dc0e653815bdd40d8802bd5446638/comments", "author": null, "committer": null, "parents": [{"sha": "f8cada540d85ac9d53b10f2e9265cb51f6f72514", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f8cada540d85ac9d53b10f2e9265cb51f6f72514", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f8cada540d85ac9d53b10f2e9265cb51f6f72514"}], "stats": {"total": 14, "additions": 12, "deletions": 2}, "files": [{"sha": "505d598f3f0b837b94121c188ec6f3913a77e6c1", "filename": "gcc/analyzer/sm-fd.cc", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed7e7620188dc0e653815bdd40d8802bd5446638/gcc%2Fanalyzer%2Fsm-fd.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed7e7620188dc0e653815bdd40d8802bd5446638/gcc%2Fanalyzer%2Fsm-fd.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fsm-fd.cc?ref=ed7e7620188dc0e653815bdd40d8802bd5446638", "patch": "@@ -976,8 +976,7 @@ fd_state_machine::check_for_dup (sm_context *sm_ctxt, const supernode *node,\n     {\n       check_for_open_fd (sm_ctxt, node, stmt, call, callee_fndecl,\n \t\t\t DIRS_READ_WRITE);\n-      if (kind == DUP_1)\n-\treturn;\n+      return;\n     }\n   switch (kind)\n     {"}, {"sha": "b4f43e7f0ef788d1ce23f45e5c890d560ca3d1ee", "filename": "gcc/testsuite/gcc.dg/analyzer/fd-dup-1.c", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed7e7620188dc0e653815bdd40d8802bd5446638/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ffd-dup-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed7e7620188dc0e653815bdd40d8802bd5446638/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ffd-dup-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ffd-dup-1.c?ref=ed7e7620188dc0e653815bdd40d8802bd5446638", "patch": "@@ -245,4 +245,15 @@ test_22 (int flags)\n     close (fd);\n }\n \n+void do_something();\n+void\n+test_23 ()\n+{\n+    int nullfd = -1;\n+    int fd = 1;\n+    if (dup2 (nullfd, fd) < 0) /* { dg-warning \"'dup2' on possibly invalid file descriptor 'nullfd'\" } */\n+    {\n+        do_something();\n+    }\n+}\n "}]}