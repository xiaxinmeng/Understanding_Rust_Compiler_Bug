{"sha": "e5bef2e40095525c3e12d3543d2f921703bc95b1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTViZWYyZTQwMDk1NTI1YzNlMTJkMzU0M2QyZjkyMTcwM2JjOTViMQ==", "commit": {"author": {"name": "Herman A.J. ten Brugge", "email": "Haj.Ten.Brugge@net.HCC.nl", "date": "2001-04-04T15:42:04Z"}, "committer": {"name": "Bernd Schmidt", "email": "bernds@gcc.gnu.org", "date": "2001-04-04T15:42:04Z"}, "message": "When splitting insns, properly update label usage counts\n\nFrom-SVN: r41084", "tree": {"sha": "ceab558c90e66a03053d71c0ac910f0dbb1d2a89", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ceab558c90e66a03053d71c0ac910f0dbb1d2a89"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e5bef2e40095525c3e12d3543d2f921703bc95b1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5bef2e40095525c3e12d3543d2f921703bc95b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e5bef2e40095525c3e12d3543d2f921703bc95b1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5bef2e40095525c3e12d3543d2f921703bc95b1/comments", "author": null, "committer": null, "parents": [{"sha": "347f344069b04a3bd333dc0341de7f1db2714af3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/347f344069b04a3bd333dc0341de7f1db2714af3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/347f344069b04a3bd333dc0341de7f1db2714af3"}], "stats": {"total": 40, "additions": 40, "deletions": 0}, "files": [{"sha": "69e2eacbc3c8577bf42d4ff095dfed104f604223", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5bef2e40095525c3e12d3543d2f921703bc95b1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5bef2e40095525c3e12d3543d2f921703bc95b1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e5bef2e40095525c3e12d3543d2f921703bc95b1", "patch": "@@ -1,3 +1,9 @@\n+2001-04-04 Herman A.J. ten Brugge <Haj.Ten.Brugge@net.HCC.nl>\n+\n+\t* emit-rtl.c (mark_label_nuses) Increment the label uses for\n+\tall labels present in rtx.\n+\t(try_split) Call new function for all split insns.\n+\n 2001-04-04  Jakub Jelinek  <jakub@redhat.com>\n \n \t* recog.c (validate_replace_rtx_1): Instead of aborting just make"}, {"sha": "2acb55547fa5d28d2530109a21d04bcc6b932c0f", "filename": "gcc/emit-rtl.c", "status": "modified", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5bef2e40095525c3e12d3543d2f921703bc95b1/gcc%2Femit-rtl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5bef2e40095525c3e12d3543d2f921703bc95b1/gcc%2Femit-rtl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Femit-rtl.c?ref=e5bef2e40095525c3e12d3543d2f921703bc95b1", "patch": "@@ -177,6 +177,7 @@ static void mark_sequence_stack         PARAMS ((struct sequence_stack *));\n static void unshare_all_rtl_1\t\tPARAMS ((rtx));\n static void unshare_all_decls\t\tPARAMS ((tree));\n static void reset_used_decls\t\tPARAMS ((tree));\n+static void mark_label_nuses\t\tPARAMS ((rtx));\n static hashval_t const_int_htab_hash    PARAMS ((const void *));\n static int const_int_htab_eq            PARAMS ((const void *,\n \t\t\t\t\t\t const void *));\n@@ -2521,6 +2522,32 @@ prev_cc0_setter (insn)\n   return insn;\n }\n #endif\n+\n+/* Increment the label uses for all labels present in rtx.  */\n+\n+static void\n+mark_label_nuses(x)\n+    rtx x;\n+{\n+  register enum rtx_code code;\n+  register int i, j;\n+  register const char *fmt;\n+\n+  code = GET_CODE (x);\n+  if (code == LABEL_REF)\n+    LABEL_NUSES (XEXP (x, 0))++;\n+\n+  fmt = GET_RTX_FORMAT (code);\n+  for (i = GET_RTX_LENGTH (code) - 1; i >= 0; i--)\n+    {\n+      if (fmt[i] == 'e')\n+        mark_label_nuses (XEXP (x, i));\n+      else if (fmt[i] == 'E')\n+        for (j = XVECLEN (x, i) - 1; j >= 0; j--)\n+\t  mark_label_nuses (XVECEXP (x, i, j));\n+    }\n+}\n+\n \f\n /* Try splitting insns that can be split for better scheduling.\n    PAT is the pattern which might split.\n@@ -2580,6 +2607,13 @@ try_split (pat, trial, last)\n \t\tCALL_INSN_FUNCTION_USAGE (XVECEXP (seq, 0, i))\n \t\t  = CALL_INSN_FUNCTION_USAGE (trial);\n \n+\t  /* If there are LABELS inside the split insns increment the\n+\t     usage count so we don't delete the label.  */\n+\t  if (GET_CODE (trial) == INSN)\n+\t    for (i = XVECLEN (seq, 0) - 1; i >= 0; i--)\n+\t      if (GET_CODE (XVECEXP (seq, 0, i)) == INSN)\n+\t        mark_label_nuses (PATTERN (XVECEXP (seq, 0, i)));\n+\n \t  tem = emit_insn_after (seq, before);\n \n \t  delete_insn (trial);"}]}