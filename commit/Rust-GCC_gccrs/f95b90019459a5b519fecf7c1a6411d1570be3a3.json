{"sha": "f95b90019459a5b519fecf7c1a6411d1570be3a3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Zjk1YjkwMDE5NDU5YTViNTE5ZmVjZjdjMWE2NDExZDE1NzBiZTNhMw==", "commit": {"author": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1995-11-05T23:36:49Z"}, "committer": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1995-11-05T23:36:49Z"}, "message": "(cmpxf): Don't call force_const_mem, it looses for PIC;\n\nget predicates right instead.  Get rid of separate DEFINE_EXPAND.\n(addxf3, subxf3, mulxf3, divxf3): Likewise.\n(All XFmode patterns): Delete `F' and `G' constraints.\n(absxf2): Delete spurious condition on TARGET_FPA.\n(negxf2): Likewise.\n\nFrom-SVN: r10563", "tree": {"sha": "258e1f51ce0915c5e9d0ed221111e2a4683d1e76", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/258e1f51ce0915c5e9d0ed221111e2a4683d1e76"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f95b90019459a5b519fecf7c1a6411d1570be3a3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f95b90019459a5b519fecf7c1a6411d1570be3a3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f95b90019459a5b519fecf7c1a6411d1570be3a3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f95b90019459a5b519fecf7c1a6411d1570be3a3/comments", "author": null, "committer": null, "parents": [{"sha": "5ca582cfa036ef5fa9f15c34435c0f79b2b556ce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5ca582cfa036ef5fa9f15c34435c0f79b2b556ce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5ca582cfa036ef5fa9f15c34435c0f79b2b556ce"}], "stats": {"total": 135, "additions": 30, "deletions": 105}, "files": [{"sha": "8c115bcf0f1704631c6638327ba61b3857b2dedd", "filename": "gcc/config/m68k/m68k.md", "status": "modified", "additions": 30, "deletions": 105, "changes": 135, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f95b90019459a5b519fecf7c1a6411d1570be3a3/gcc%2Fconfig%2Fm68k%2Fm68k.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f95b90019459a5b519fecf7c1a6411d1570be3a3/gcc%2Fconfig%2Fm68k%2Fm68k.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fm68k%2Fm68k.md?ref=f95b90019459a5b519fecf7c1a6411d1570be3a3", "patch": "@@ -6454,24 +6454,10 @@\n   return \\\"ftst%.x %0\\\";\n }\")\n \n-\n-(define_expand \"cmpxf\"\n+(define_insn \"cmpxf\"\n   [(set (cc0)\n-\t(compare (match_operand:XF 0 \"general_operand\" \"f,mG\")\n-\t\t (match_operand:XF 1 \"general_operand\" \"fmG,f\")))]\n-  \"TARGET_68881\"\n-  \"\n-{\n-  if (CONSTANT_P (operands[0]))\n-      operands[0] = force_const_mem (XFmode, operands[0]);\n-  if (CONSTANT_P (operands[1]))\n-      operands[1] = force_const_mem (XFmode, operands[1]);\n-}\")\n-\n-(define_insn \"\"\n-  [(set (cc0)\n-\t(compare (match_operand:XF 0 \"nonimmediate_operand\" \"f,mG\")\n-\t\t (match_operand:XF 1 \"nonimmediate_operand\" \"fmG,f\")))]\n+\t(compare (match_operand:XF 0 \"nonimmediate_operand\" \"f,m\")\n+\t\t (match_operand:XF 1 \"nonimmediate_operand\" \"fm,f\")))]\n   \"TARGET_68881\"\n   \"*\n {\n@@ -6617,30 +6603,17 @@\n   \"TARGET_68881\"\n   \"fmove%.l %1,%0\")\n \n-(define_expand \"addxf3\"\n-  [(set (match_operand:XF 0 \"general_operand\" \"\")\n-\t(plus:XF (match_operand:XF 1 \"general_operand\" \"\")\n-\t\t (match_operand:XF 2 \"general_operand\" \"\")))]\n-  \"TARGET_68881\"\n-  \"\n-{\n-  if (CONSTANT_P (operands[1]))\n-    operands[1] = force_const_mem (XFmode, operands[1]);\n-  if (CONSTANT_P (operands[2]))\n-    operands[2] = force_const_mem (XFmode, operands[2]);\n-}\")\n-\n (define_insn \"\"\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n \t(plus:XF (float:XF (match_operand:SI 2 \"general_operand\" \"dmi\"))\n-\t\t (match_operand:XF 1 \"general_operand\" \"0\")))]\n+\t\t (match_operand:XF 1 \"nonimmediate_operand\" \"0\")))]\n   \"TARGET_68881\"\n   \"fadd%.l %2,%0\")\n \n (define_insn \"\"\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n \t(plus:XF (float:XF (match_operand:HI 2 \"general_operand\" \"dmn\"))\n-\t\t (match_operand:XF 1 \"general_operand\" \"0\")))]\n+\t\t (match_operand:XF 1 \"nonimmediate_operand\" \"0\")))]\n   \"TARGET_68881\"\n   \"fadd%.w %2,%0\")\n \n@@ -6651,10 +6624,10 @@\n   \"TARGET_68881\"\n   \"fadd%.b %2,%0\")\n \n-(define_insn \"\"\n+(define_insn \"addxf3\"\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n \t(plus:XF (match_operand:XF 1 \"nonimmediate_operand\" \"%0\")\n-\t\t (match_operand:XF 2 \"nonimmediate_operand\" \"fmG\")))]\n+\t\t (match_operand:XF 2 \"nonimmediate_operand\" \"fm\")))]\n   \"TARGET_68881\"\n   \"*\n {\n@@ -6663,44 +6636,31 @@\n   return \\\"fadd%.x %f2,%0\\\";\n }\")\n \n-(define_expand \"subxf3\"\n-  [(set (match_operand:XF 0 \"general_operand\" \"\")\n-\t(minus:XF (match_operand:XF 1 \"general_operand\" \"\")\n-\t\t (match_operand:XF 2 \"general_operand\" \"\")))]\n-  \"TARGET_68881\"\n-  \"\n-{\n-  if (CONSTANT_P (operands[1]))\n-    operands[1] = force_const_mem (XFmode, operands[1]);\n-  if (CONSTANT_P (operands[2]))\n-    operands[2] = force_const_mem (XFmode, operands[2]);\n-}\")\n-\n (define_insn \"\"\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n-\t(minus:XF (match_operand:XF 1 \"general_operand\" \"0\")\n+\t(minus:XF (match_operand:XF 1 \"nonimmediate_operand\" \"0\")\n \t\t  (float:XF (match_operand:SI 2 \"general_operand\" \"dmi\"))))]\n   \"TARGET_68881\"\n   \"fsub%.l %2,%0\")\n \n (define_insn \"\"\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n-\t(minus:XF (match_operand:XF 1 \"general_operand\" \"0\")\n+\t(minus:XF (match_operand:XF 1 \"nonimmediate_operand\" \"0\")\n \t\t  (float:XF (match_operand:HI 2 \"general_operand\" \"dmn\"))))]\n   \"TARGET_68881\"\n   \"fsub%.w %2,%0\")\n \n (define_insn \"\"\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n-\t(minus:XF (match_operand:XF 1 \"general_operand\" \"0\")\n+\t(minus:XF (match_operand:XF 1 \"nonimmediate_operand\" \"0\")\n \t\t  (float:XF (match_operand:QI 2 \"general_operand\" \"dmn\"))))]\n   \"TARGET_68881\"\n   \"fsub%.b %2,%0\")\n \n (define_insn \"\"\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n \t(minus:XF (match_operand:XF 1 \"nonimmediate_operand\" \"0\")\n-\t\t (match_operand:XF 2 \"nonimmediate_operand\" \"fmG\")))]\n+\t\t (match_operand:XF 2 \"nonimmediate_operand\" \"fm\")))]\n   \"TARGET_68881\"\n   \"*\n {\n@@ -6709,44 +6669,31 @@\n   return \\\"fsub%.x %f2,%0\\\";\n }\")\n \n-(define_expand \"mulxf3\"\n-  [(set (match_operand:XF 0 \"general_operand\" \"\")\n-\t(mult:XF (match_operand:XF 1 \"general_operand\" \"\")\n-\t\t(match_operand:XF 2 \"general_operand\" \"\")))]\n-  \"TARGET_68881\"\n-  \"\n-{\n-  if (CONSTANT_P (operands[1]))\n-    operands[1] = force_const_mem (XFmode, operands[1]);\n-  if (CONSTANT_P (operands[2]))\n-    operands[2] = force_const_mem (XFmode, operands[2]);\n-}\")\n-\n (define_insn \"\"\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n \t(mult:XF (float:XF (match_operand:SI 2 \"general_operand\" \"dmi\"))\n-\t\t (match_operand:XF 1 \"general_operand\" \"0\")))]\n+\t\t (match_operand:XF 1 \"nonimmediate_operand\" \"0\")))]\n   \"TARGET_68881\"\n   \"fmul%.l %2,%0\")\n \n (define_insn \"\"\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n \t(mult:XF (float:XF (match_operand:HI 2 \"general_operand\" \"dmn\"))\n-\t\t (match_operand:XF 1 \"general_operand\" \"0\")))]\n+\t\t (match_operand:XF 1 \"nonimmediate_operand\" \"0\")))]\n   \"TARGET_68881\"\n   \"fmul%.w %2,%0\")\n \n (define_insn \"\"\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n \t(mult:XF (float:XF (match_operand:QI 2 \"general_operand\" \"dmn\"))\n-\t\t (match_operand:XF 1 \"general_operand\" \"0\")))]\n+\t\t (match_operand:XF 1 \"nonimmediate_operand\" \"0\")))]\n   \"TARGET_68881\"\n   \"fmul%.b %2,%0\")\n \n-(define_insn \"\"\n+(define_insn \"mulxf3\"\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n \t(mult:XF (match_operand:XF 1 \"nonimmediate_operand\" \"%0\")\n-\t\t(match_operand:XF 2 \"nonimmediate_operand\" \"fmG\")))]\n+\t\t (match_operand:XF 2 \"nonimmediate_operand\" \"fm\")))]\n   \"TARGET_68881\"\n   \"*\n {\n@@ -6755,44 +6702,31 @@\n   return \\\"fmul%.x %f2,%0\\\";\n }\")\n \n-(define_expand \"divxf3\"\n-  [(set (match_operand:XF 0 \"general_operand\" \"\")\n-\t(div:XF (match_operand:XF 1 \"general_operand\" \"\")\n-\t\t(match_operand:XF 2 \"general_operand\" \"\")))]\n-  \"TARGET_68881\"\n-  \"\n-{\n-  if (CONSTANT_P (operands[1]))\n-    operands[1] = force_const_mem (XFmode, operands[1]);\n-  if (CONSTANT_P (operands[2]))\n-    operands[2] = force_const_mem (XFmode, operands[2]);\n-}\")\n-\n (define_insn \"\"\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n-\t(div:XF (match_operand:XF 1 \"general_operand\" \"0\")\n+\t(div:XF (match_operand:XF 1 \"nonimmediate_operand\" \"0\")\n \t\t(float:XF (match_operand:SI 2 \"general_operand\" \"dmi\"))))]\n   \"TARGET_68881\"\n   \"fdiv%.l %2,%0\")\n \n (define_insn \"\"\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n-\t(div:XF (match_operand:XF 1 \"general_operand\" \"0\")\n+\t(div:XF (match_operand:XF 1 \"nonimmediate_operand\" \"0\")\n \t\t(float:XF (match_operand:HI 2 \"general_operand\" \"dmn\"))))]\n   \"TARGET_68881\"\n   \"fdiv%.w %2,%0\")\n \n (define_insn \"\"\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n-\t(div:XF (match_operand:XF 1 \"general_operand\" \"0\")\n+\t(div:XF (match_operand:XF 1 \"nonimmediate_operand\" \"0\")\n \t\t(float:XF (match_operand:QI 2 \"general_operand\" \"dmn\"))))]\n   \"TARGET_68881\"\n   \"fdiv%.b %2,%0\")\n \n-(define_insn \"\"\n+(define_insn \"divxf3\"\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n \t(div:XF (match_operand:XF 1 \"nonimmediate_operand\" \"0\")\n-\t\t(match_operand:XF 2 \"nonimmediate_operand\" \"fmG\")))]\n+\t\t(match_operand:XF 2 \"nonimmediate_operand\" \"fm\")))]\n   \"TARGET_68881\"\n   \"*\n {\n@@ -6803,13 +6737,13 @@\n \n (define_expand \"negxf2\"\n   [(set (match_operand:XF 0 \"general_operand\" \"\")\n-\t(neg:XF (match_operand:XF 1 \"general_operand\" \"\")))]\n+\t(neg:XF (match_operand:XF 1 \"nonimmediate_operand\" \"\")))]\n   \"\"\n   \"\n {\n   /* ??? There isn't an FPA define_insn so we could handle it here too.\n      For now we don't (paranoia).  */\n-  if (!TARGET_FPA && !TARGET_68881)\n+  if (!TARGET_68881)\n     {\n       rtx result;\n       rtx target;\n@@ -6841,7 +6775,7 @@\n \n (define_insn \"negxf2_68881\"\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n-\t(neg:XF (match_operand:XF 1 \"nonimmediate_operand\" \"fmF\")))]\n+\t(neg:XF (match_operand:XF 1 \"nonimmediate_operand\" \"fm\")))]\n   \"TARGET_68881\"\n   \"*\n {\n@@ -6852,13 +6786,13 @@\n \n (define_expand \"absxf2\"\n   [(set (match_operand:XF 0 \"general_operand\" \"\")\n-\t(abs:XF (match_operand:XF 1 \"general_operand\" \"\")))]\n+\t(abs:XF (match_operand:XF 1 \"nonimmediate_operand\" \"\")))]\n   \"\"\n   \"\n {\n   /* ??? There isn't an FPA define_insn so we could handle it here too.\n      For now we don't (paranoia).  */\n-  if (!TARGET_FPA && !TARGET_68881)\n+  if (!TARGET_68881)\n     {\n       rtx result;\n       rtx target;\n@@ -6890,7 +6824,7 @@\n \n (define_insn \"absxf2_68881\"\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n-\t(abs:XF (match_operand:XF 1 \"nonimmediate_operand\" \"fmF\")))]\n+\t(abs:XF (match_operand:XF 1 \"nonimmediate_operand\" \"fm\")))]\n   \"TARGET_68881\"\n   \"*\n {\n@@ -6903,10 +6837,7 @@\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n \t(sqrt:XF (match_operand:XF 1 \"nonimmediate_operand\" \"fm\")))]\n   \"TARGET_68881\"\n-  \"*\n-{\n-    return \\\"fsqrt%.x %1,%0\\\";\n-}\")\n+  \"fsqrt%.x %1,%0\")\n \n (define_insn \"sinsf2\"\n   [(set (match_operand:SF 0 \"general_operand\" \"=f\")\n@@ -6936,10 +6867,7 @@\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n \t(unspec:XF [(match_operand:XF 1 \"nonimmediate_operand\" \"fm\")] 1))]\n   \"TARGET_68881 && flag_fast_math\"\n-  \"*\n-{\n-    return \\\"fsin%.x %1,%0\\\";\n-}\")\n+  \"fsin%.x %1,%0\")\n \n (define_insn \"cossf2\"\n   [(set (match_operand:SF 0 \"general_operand\" \"=f\")\n@@ -6969,7 +6897,4 @@\n   [(set (match_operand:XF 0 \"general_operand\" \"=f\")\n \t(unspec:XF [(match_operand:XF 1 \"nonimmediate_operand\" \"fm\")] 2))]\n   \"TARGET_68881 && flag_fast_math\"\n-  \"*\n-{\n-    return \\\"fcos%.x %1,%0\\\";\n-}\")\n+  \"fcos%.x %1,%0\")"}]}