{"sha": "b0d9e66374cae4f996a4a2f8f2a58b9f70819ad1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjBkOWU2NjM3NGNhZTRmOTk2YTRhMmY4ZjJhNThiOWY3MDgxOWFkMQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2010-07-07T12:04:09Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2010-07-07T12:04:09Z"}, "message": "lto-cgraph.c (output_cgraph): Output toplevel asms only into first partition.\n\n\n\t* lto-cgraph.c (output_cgraph): Output toplevel asms only into first\n\tpartition.\n\nFrom-SVN: r161904", "tree": {"sha": "673227f670cc8407b1b362afe606908aa7b44318", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/673227f670cc8407b1b362afe606908aa7b44318"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b0d9e66374cae4f996a4a2f8f2a58b9f70819ad1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0d9e66374cae4f996a4a2f8f2a58b9f70819ad1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b0d9e66374cae4f996a4a2f8f2a58b9f70819ad1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0d9e66374cae4f996a4a2f8f2a58b9f70819ad1/comments", "author": null, "committer": null, "parents": [{"sha": "38be945b90fb0b72fda14d60ade541b9f7874e06", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38be945b90fb0b72fda14d60ade541b9f7874e06", "html_url": "https://github.com/Rust-GCC/gccrs/commit/38be945b90fb0b72fda14d60ade541b9f7874e06"}], "stats": {"total": 26, "additions": 19, "deletions": 7}, "files": [{"sha": "6c661c865942f32c2ce973f8ebe39ec32157f3a0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0d9e66374cae4f996a4a2f8f2a58b9f70819ad1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0d9e66374cae4f996a4a2f8f2a58b9f70819ad1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b0d9e66374cae4f996a4a2f8f2a58b9f70819ad1", "patch": "@@ -1,3 +1,8 @@\n+2010-07-06  Jan Hubicka  <jh@suse.cz>\n+\n+\t* lto-cgraph.c (output_cgraph): Output toplevel asms only into first\n+\tpartition.\n+\n 2010-07-06  Alexandre Oliva  <aoliva@redhat.com>\n \n \t* doc/gimple.texi (GIMPLE_DEBUG): Document."}, {"sha": "04f5407a800b5f05fc88bb54ef791494cc7edf9d", "filename": "gcc/lto-cgraph.c", "status": "modified", "additions": 14, "deletions": 7, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0d9e66374cae4f996a4a2f8f2a58b9f70819ad1/gcc%2Flto-cgraph.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0d9e66374cae4f996a4a2f8f2a58b9f70819ad1/gcc%2Flto-cgraph.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-cgraph.c?ref=b0d9e66374cae4f996a4a2f8f2a58b9f70819ad1", "patch": "@@ -881,14 +881,21 @@ output_cgraph (cgraph_node_set set, varpool_node_set vset)\n \n   lto_output_uleb128_stream (ob->main_stream, 0);\n \n-  /* Emit toplevel asms.  */\n-  for (can = cgraph_asm_nodes; can; can = can->next)\n+  /* Emit toplevel asms.\n+     When doing WPA we must output every asm just once.  Since we do not partition asm\n+     nodes at all, output them to first output.  This is kind of hack, but should work\n+     well.  */\n+  if (!asm_nodes_output)\n     {\n-      int len = TREE_STRING_LENGTH (can->asm_str);\n-      lto_output_uleb128_stream (ob->main_stream, len);\n-      for (i = 0; i < len; ++i)\n-\tlto_output_1_stream (ob->main_stream,\n-\t\t\t     TREE_STRING_POINTER (can->asm_str)[i]);\n+      asm_nodes_output = true;\n+      for (can = cgraph_asm_nodes; can; can = can->next)\n+\t{\n+\t  int len = TREE_STRING_LENGTH (can->asm_str);\n+\t  lto_output_uleb128_stream (ob->main_stream, len);\n+\t  for (i = 0; i < len; ++i)\n+\t    lto_output_1_stream (ob->main_stream,\n+\t\t\t\t TREE_STRING_POINTER (can->asm_str)[i]);\n+\t}\n     }\n \n   lto_output_uleb128_stream (ob->main_stream, 0);"}]}