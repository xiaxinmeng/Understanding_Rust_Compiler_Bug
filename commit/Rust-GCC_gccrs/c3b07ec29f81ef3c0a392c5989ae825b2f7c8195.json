{"sha": "c3b07ec29f81ef3c0a392c5989ae825b2f7c8195", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzNiMDdlYzI5ZjgxZWYzYzBhMzkyYzU5ODlhZTgyNWIyZjdjODE5NQ==", "commit": {"author": {"name": "Geoffrey Keating", "email": "geoffk@apple.com", "date": "2007-10-09T22:56:58Z"}, "committer": {"name": "Geoffrey Keating", "email": "geoffk@gcc.gnu.org", "date": "2007-10-09T22:56:58Z"}, "message": "Index: gcc/ChangeLog\n2007-10-09  Geoffrey Keating  <geoffk@apple.com>\n\n\t* dwarf2out.c (output_call_frame_info): FDEs are always emitted\n\tif flag_exceptions is not set.\n\t* config/darwin.c (darwin_emit_unwind_label): Rewrite to use\n\tassemble_name rather than incorrectly emulating it.\n\nIndex: gcc/testsuite/ChangeLog\n2007-10-09  Geoffrey Keating  <geoffk@apple.com>\n\n\t* gcc.dg/unwind-1.c: New.\n\nFrom-SVN: r129187", "tree": {"sha": "33144a308be03d23ddc724e1545cbf9cd9ddc413", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/33144a308be03d23ddc724e1545cbf9cd9ddc413"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c3b07ec29f81ef3c0a392c5989ae825b2f7c8195", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3b07ec29f81ef3c0a392c5989ae825b2f7c8195", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c3b07ec29f81ef3c0a392c5989ae825b2f7c8195", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3b07ec29f81ef3c0a392c5989ae825b2f7c8195/comments", "author": {"login": "geoffk01", "id": 31905243, "node_id": "MDQ6VXNlcjMxOTA1MjQz", "avatar_url": "https://avatars.githubusercontent.com/u/31905243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/geoffk01", "html_url": "https://github.com/geoffk01", "followers_url": "https://api.github.com/users/geoffk01/followers", "following_url": "https://api.github.com/users/geoffk01/following{/other_user}", "gists_url": "https://api.github.com/users/geoffk01/gists{/gist_id}", "starred_url": "https://api.github.com/users/geoffk01/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/geoffk01/subscriptions", "organizations_url": "https://api.github.com/users/geoffk01/orgs", "repos_url": "https://api.github.com/users/geoffk01/repos", "events_url": "https://api.github.com/users/geoffk01/events{/privacy}", "received_events_url": "https://api.github.com/users/geoffk01/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "32e26ecee6887e1a07a4208d96fe43718ae860bc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/32e26ecee6887e1a07a4208d96fe43718ae860bc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/32e26ecee6887e1a07a4208d96fe43718ae860bc"}], "stats": {"total": 63, "additions": 36, "deletions": 27}, "files": [{"sha": "cb9b8784d549765a98b2e46e5fbcc8d89a58419e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3b07ec29f81ef3c0a392c5989ae825b2f7c8195/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3b07ec29f81ef3c0a392c5989ae825b2f7c8195/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c3b07ec29f81ef3c0a392c5989ae825b2f7c8195", "patch": "@@ -1,5 +1,10 @@\n 2007-10-09  Geoffrey Keating  <geoffk@apple.com>\n \n+\t* dwarf2out.c (output_call_frame_info): FDEs are always emitted\n+\tif flag_exceptions is not set.\n+\t* config/darwin.c (darwin_emit_unwind_label): Rewrite to use\n+\tassemble_name rather than incorrectly emulating it.\n+\n \t* doc/extend.texi (Deprecated Features): Mention that <? and >? and\n \tfriends are removed from G++.\n "}, {"sha": "66d1ab046475c6765b36077abee83c18fb3ae4aa", "filename": "gcc/config/darwin.c", "status": "modified", "additions": 19, "deletions": 27, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3b07ec29f81ef3c0a392c5989ae825b2f7c8195/gcc%2Fconfig%2Fdarwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3b07ec29f81ef3c0a392c5989ae825b2f7c8195/gcc%2Fconfig%2Fdarwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.c?ref=c3b07ec29f81ef3c0a392c5989ae825b2f7c8195", "patch": "@@ -1465,12 +1465,6 @@ darwin_handle_weak_import_attribute (tree *node, tree name,\n   return NULL_TREE;\n }\n \n-static void\n-no_dead_strip (FILE *file, const char *lab)\n-{\n-  fprintf (file, \".no_dead_strip %s\\n\", lab);\n-}\n-\n /* Emit a label for an FDE, making it global and/or weak if appropriate.\n    The third parameter is nonzero if this is for exception handling.\n    The fourth parameter is nonzero if this is just a placeholder for an\n@@ -1479,46 +1473,44 @@ no_dead_strip (FILE *file, const char *lab)\n void\n darwin_emit_unwind_label (FILE *file, tree decl, int for_eh, int empty)\n {\n-  const char *base;\n   char *lab;\n-  bool need_quotes;\n-\n-  if (DECL_ASSEMBLER_NAME_SET_P (decl))\n-    base = IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (decl));\n-  else\n-    base = IDENTIFIER_POINTER (DECL_NAME (decl));\n-\n-  base = targetm.strip_name_encoding (base);\n-  need_quotes = name_needs_quotes (base);\n \n   if (! for_eh)\n     return;\n \n-  lab = concat (need_quotes ? \"\\\"\" : \"\", user_label_prefix, base, \".eh\",\n-\t\tneed_quotes ? \"\\\"\" : \"\", NULL);\n+  lab = concat (IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (decl)), \".eh\", NULL);\n \n   if (TREE_PUBLIC (decl))\n-    fprintf (file, \"\\t%s %s\\n\",\n-\t     (DECL_VISIBILITY (decl) != VISIBILITY_HIDDEN\n-\t      ? \".globl\"\n-\t      : \".private_extern\"),\n-\t     lab);\n+    {\n+      targetm.asm_out.globalize_label (file, lab);\n+      if (DECL_VISIBILITY (decl) == VISIBILITY_HIDDEN)\n+\t{\n+\t  fputs (\"\\t.private_extern \", file);\n+\t  assemble_name (file, lab);\n+\t  fputc ('\\n', file);\n+\t}\n+    }\n \n   if (DECL_WEAK (decl))\n-    fprintf (file, \"\\t.weak_definition %s\\n\", lab);\n+    {\n+      fputs (\"\\t.weak_definition \", file);\n+      assemble_name (file, lab);\n+      fputc ('\\n', file);\n+    }\n \n+  assemble_name (file, lab);\n   if (empty)\n     {\n-      fprintf (file, \"%s = 0\\n\", lab);\n+      fputs (\" = 0\\n\", file);\n \n       /* Mark the absolute .eh and .eh1 style labels as needed to\n \t ensure that we don't dead code strip them and keep such\n \t labels from another instantiation point until we can fix this\n \t properly with group comdat support.  */\n-      no_dead_strip (file, lab);\n+      darwin_mark_decl_preserved (lab);\n     }\n   else\n-    fprintf (file, \"%s:\\n\", lab);\n+    fputs (\":\\n\", file);\n \n   free (lab);\n }"}, {"sha": "8a398e4d465d3324596dc88e8eb80dfff6627c21", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3b07ec29f81ef3c0a392c5989ae825b2f7c8195/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3b07ec29f81ef3c0a392c5989ae825b2f7c8195/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=c3b07ec29f81ef3c0a392c5989ae825b2f7c8195", "patch": "@@ -2223,6 +2223,7 @@ output_call_frame_info (int for_eh)\n      specialization doesn't.  */\n   if (TARGET_USES_WEAK_UNWIND_INFO\n       && ! flag_asynchronous_unwind_tables\n+      && flag_exceptions\n       && for_eh)\n     for (i = 0; i < fde_table_in_use; i++)\n       if ((fde_table[i].nothrow || fde_table[i].all_throwers_are_sibcalls)"}, {"sha": "a764dfecec3d564495798ea6c441203d7a6aa49e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3b07ec29f81ef3c0a392c5989ae825b2f7c8195/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3b07ec29f81ef3c0a392c5989ae825b2f7c8195/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c3b07ec29f81ef3c0a392c5989ae825b2f7c8195", "patch": "@@ -1,3 +1,7 @@\n+2007-10-09  Geoffrey Keating  <geoffk@apple.com>\n+\n+\t* gcc.dg/unwind-1.c: New.\n+\n 2007-10-09  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR libfortran/33683"}, {"sha": "a24af9249c83042cc7fdc616f025280e752332df", "filename": "gcc/testsuite/gcc.dg/unwind-1.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3b07ec29f81ef3c0a392c5989ae825b2f7c8195/gcc%2Ftestsuite%2Fgcc.dg%2Funwind-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3b07ec29f81ef3c0a392c5989ae825b2f7c8195/gcc%2Ftestsuite%2Fgcc.dg%2Funwind-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Funwind-1.c?ref=c3b07ec29f81ef3c0a392c5989ae825b2f7c8195", "patch": "@@ -0,0 +1,7 @@\n+/* { dg-do assemble } */\n+/* { dg-options \"-fleading-underscore -funwind-tables\" } */\n+\n+void func(void) __asm(\"_func\");\n+void _func(int x) {}\n+void func(void) {}\n+"}]}