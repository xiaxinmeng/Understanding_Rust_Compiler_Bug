{"sha": "58496de135a8b4fdfe552d0d9b18c9d1db147582", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTg0OTZkZTEzNWE4YjRmZGZlNTUyZDBkOWIxOGM5ZDFkYjE0NzU4Mg==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2003-12-30T10:07:13Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2003-12-30T10:07:13Z"}, "message": "re PR c++/13494 (ICE on bidimensional array subscription in template function.)\n\ncp:\n\tPR c++/13494\n\t* tree.c (build_cplus_array_type_1): Only build a minimal array\n\ttype for dependent types or domains.\ntestsuite:\n\tPR c++/13494\n\t* g++.dg/template/array2-1.C: New test.\n\t* g++.dg/template/array2-2.C: New test.\n\nFrom-SVN: r75225", "tree": {"sha": "782381548209213cb65d0241617ed7102f9f7f2d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/782381548209213cb65d0241617ed7102f9f7f2d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/58496de135a8b4fdfe552d0d9b18c9d1db147582", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58496de135a8b4fdfe552d0d9b18c9d1db147582", "html_url": "https://github.com/Rust-GCC/gccrs/commit/58496de135a8b4fdfe552d0d9b18c9d1db147582", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58496de135a8b4fdfe552d0d9b18c9d1db147582/comments", "author": null, "committer": null, "parents": [{"sha": "a043b1f5c90b437896c826c80244aa06e7fd2926", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a043b1f5c90b437896c826c80244aa06e7fd2926", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a043b1f5c90b437896c826c80244aa06e7fd2926"}], "stats": {"total": 51, "additions": 43, "deletions": 8}, "files": [{"sha": "15947ba7a3b3c400b4c14264238dfef07e0c3e13", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58496de135a8b4fdfe552d0d9b18c9d1db147582/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58496de135a8b4fdfe552d0d9b18c9d1db147582/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=58496de135a8b4fdfe552d0d9b18c9d1db147582", "patch": "@@ -1,3 +1,9 @@\n+2003-12-30  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\tPR c++/13494\n+\t* tree.c (build_cplus_array_type_1): Only build a minimal array\n+\ttype for dependent types or domains.\n+\n 2003-12-29  Nathan Sidwell  <nathan@codesourcery.com>\n \n \tPR c++/12774"}, {"sha": "bedbbe96b444bfdbd0ca65a5fb8ecc883fcf3808", "filename": "gcc/cp/tree.c", "status": "modified", "additions": 3, "deletions": 8, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58496de135a8b4fdfe552d0d9b18c9d1db147582/gcc%2Fcp%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58496de135a8b4fdfe552d0d9b18c9d1db147582/gcc%2Fcp%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftree.c?ref=58496de135a8b4fdfe552d0d9b18c9d1db147582", "patch": "@@ -363,14 +363,9 @@ build_cplus_array_type_1 (tree elt_type, tree index_type)\n   if (elt_type == error_mark_node || index_type == error_mark_node)\n     return error_mark_node;\n \n-  /* Don't do the minimal thing just because processing_template_decl is\n-     set; we want to give string constants the right type immediately, so\n-     we don't have to fix them up at instantiation time.  */\n-  if ((processing_template_decl\n-       && index_type && TYPE_MAX_VALUE (index_type)\n-       && TREE_CODE (TYPE_MAX_VALUE (index_type)) != INTEGER_CST)\n-      || uses_template_parms (elt_type) \n-      || (index_type && uses_template_parms (index_type)))\n+  if (dependent_type_p (elt_type)\n+      || (index_type\n+\t  && value_dependent_expression_p (TYPE_MAX_VALUE (index_type))))\n     {\n       t = make_node (ARRAY_TYPE);\n       TREE_TYPE (t) = elt_type;"}, {"sha": "992e6f4345a892d2bb94fe4256b6f6eb6d95f028", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58496de135a8b4fdfe552d0d9b18c9d1db147582/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58496de135a8b4fdfe552d0d9b18c9d1db147582/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=58496de135a8b4fdfe552d0d9b18c9d1db147582", "patch": "@@ -1,3 +1,9 @@\n+2003-12-30  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\tPR c++/13494\n+\t* g++.dg/template/array2-1.C: New test.\n+\t* g++.dg/template/array2-2.C: New test.\n+\n 2003-12-29  Mark Mitchell  <mark@codesourcery.com>\n \n \t* g++.old-deja/g++.pt/static11.C: Correct XFAIL syntax."}, {"sha": "2980a1fd186e90f636e63f4d78b4c6739c53bb8f", "filename": "gcc/testsuite/g++.dg/template/array2-1.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58496de135a8b4fdfe552d0d9b18c9d1db147582/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Farray2-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58496de135a8b4fdfe552d0d9b18c9d1db147582/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Farray2-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Farray2-1.C?ref=58496de135a8b4fdfe552d0d9b18c9d1db147582", "patch": "@@ -0,0 +1,14 @@\n+// { dg-do compile }\n+// { dg-options \"-fabi-version=1\" }\n+\n+// Copyright (C) 2003 Free Software Foundation, Inc.\n+// Contributed by Nathan Sidwell 29 Dec 2003 <nathan@codesourcery.com>\n+\n+// PR c++/13494. ICE\n+\n+template<typename T>\n+int foo(int d[][4])\n+{\n+  return d[0][0];\n+}\n+"}, {"sha": "dd3e7f0e265e20cba89e26056a809d444b8704dd", "filename": "gcc/testsuite/g++.dg/template/array2-2.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58496de135a8b4fdfe552d0d9b18c9d1db147582/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Farray2-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58496de135a8b4fdfe552d0d9b18c9d1db147582/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Farray2-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Farray2-2.C?ref=58496de135a8b4fdfe552d0d9b18c9d1db147582", "patch": "@@ -0,0 +1,14 @@\n+// { dg-do compile }\n+// { dg-options \"-fabi-version=2\" }\n+\n+// Copyright (C) 2003 Free Software Foundation, Inc.\n+// Contributed by Nathan Sidwell 29 Dec 2003 <nathan@codesourcery.com>\n+\n+// PR c++/13494. ICE\n+\n+template<typename T>\n+int foo(int d[][4])\n+{\n+  return d[0][0];\n+}\n+"}]}