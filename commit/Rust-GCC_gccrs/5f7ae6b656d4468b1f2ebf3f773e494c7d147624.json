{"sha": "5f7ae6b656d4468b1f2ebf3f773e494c7d147624", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWY3YWU2YjY1NmQ0NDY4YjFmMmViZjNmNzczZTQ5NGM3ZDE0NzYyNA==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2010-09-04T16:02:38Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2010-09-04T16:02:38Z"}, "message": "foldconst-1.c: New testcase.\n\n\n\t* gcc.dg/tree-ssa/foldconst-1.c: New testcase.\n\t* tree-switch-conversion.c (build_one_array): Set constructor to be\n\tstatic.\n\t* varpool.c (varpool_finalize_decl): Compute const_value_known.\n\nFrom-SVN: r163860", "tree": {"sha": "34c358bbc15941d02b800987838c29b526be48e7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/34c358bbc15941d02b800987838c29b526be48e7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5f7ae6b656d4468b1f2ebf3f773e494c7d147624", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f7ae6b656d4468b1f2ebf3f773e494c7d147624", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5f7ae6b656d4468b1f2ebf3f773e494c7d147624", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f7ae6b656d4468b1f2ebf3f773e494c7d147624/comments", "author": null, "committer": null, "parents": [{"sha": "8b2b54f9d6dc34cafebf59ecb154ac52a354ecc1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b2b54f9d6dc34cafebf59ecb154ac52a354ecc1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8b2b54f9d6dc34cafebf59ecb154ac52a354ecc1"}], "stats": {"total": 38, "additions": 38, "deletions": 0}, "files": [{"sha": "feece9ea969ee267d07e763affbaf558db53d085", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f7ae6b656d4468b1f2ebf3f773e494c7d147624/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f7ae6b656d4468b1f2ebf3f773e494c7d147624/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5f7ae6b656d4468b1f2ebf3f773e494c7d147624", "patch": "@@ -1,3 +1,9 @@\n+2010-09-04  Jan Hubicka  <jh@suse.cz>\n+\n+\t* tree-switch-conversion.c (build_one_array): Set constructor to be\n+\tstatic.\n+\t* varpool.c (varpool_finalize_decl): Compute const_value_known.\n+\n 2010-09-04  Richard Guenther  <rguenther@suse.de>\n \n \tPR bootstrap/45519"}, {"sha": "9e3da0325546ecfe262006eb56ad4678b81a9f5d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f7ae6b656d4468b1f2ebf3f773e494c7d147624/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f7ae6b656d4468b1f2ebf3f773e494c7d147624/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5f7ae6b656d4468b1f2ebf3f773e494c7d147624", "patch": "@@ -1,3 +1,7 @@\n+2010-09-04  Jan Hubicka  <jh@suse.cz>\n+\n+\t* gcc.dg/tree-ssa/foldconst-1.c: New testcase.\n+\n 2010-09-04  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/45507"}, {"sha": "10414a2a50c07adcd6f0ae3df7b86ee2ce4a0a78", "filename": "gcc/testsuite/gcc.dg/tree-ssa/foldconst-1.c", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f7ae6b656d4468b1f2ebf3f773e494c7d147624/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Ffoldconst-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f7ae6b656d4468b1f2ebf3f773e494c7d147624/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Ffoldconst-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Ffoldconst-1.c?ref=5f7ae6b656d4468b1f2ebf3f773e494c7d147624", "patch": "@@ -0,0 +1,26 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-optimized\" } */\n+void bar (unsigned int);\n+\n+void\n+foo (void)\n+{\n+  char buf[1] = { 3 };\n+  const char *p = buf;\n+  const char **q = &p;\n+  unsigned int ch;\n+  switch (**q)\n+    {\n+    case 1:  ch = 5; break;\n+    case 2:  ch = 4; break;\n+    case 3:  ch = 3; break;\n+    case 4:  ch = 2; break;\n+    case 5:  ch = 1; break;\n+    default: ch = 0; break;\n+    }\n+  bar (ch);\n+}\n+/* The switch should be switch converted and later constant propagated.  */\n+/* { dg-final { scan-tree-dump-not \"CSWTCH\" \"optimized\"} } */\n+/* { dg-final { scan-tree-dump-not \"switch\" \"optimized\"} } */\n+/* { dg-final { cleanup-tree-dump \"optimized\" } } */"}, {"sha": "05c0a6525164e2011b6b41b8388449c23d286305", "filename": "gcc/tree-switch-conversion.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f7ae6b656d4468b1f2ebf3f773e494c7d147624/gcc%2Ftree-switch-conversion.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f7ae6b656d4468b1f2ebf3f773e494c7d147624/gcc%2Ftree-switch-conversion.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-switch-conversion.c?ref=5f7ae6b656d4468b1f2ebf3f773e494c7d147624", "patch": "@@ -518,6 +518,7 @@ build_one_array (gimple swtch, int num, tree arr_index_type, gimple phi,\n       array_type = build_array_type (value_type, arr_index_type);\n       ctor = build_constructor (array_type, info.constructors[num]);\n       TREE_CONSTANT (ctor) = true;\n+      TREE_STATIC (ctor) = true;\n \n       decl = build_decl (loc, VAR_DECL, NULL_TREE, array_type);\n       TREE_STATIC (decl) = 1;"}, {"sha": "2b0809456ea3e2002092c0122e9132b0a9c4e271", "filename": "gcc/varpool.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f7ae6b656d4468b1f2ebf3f773e494c7d147624/gcc%2Fvarpool.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f7ae6b656d4468b1f2ebf3f773e494c7d147624/gcc%2Fvarpool.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarpool.c?ref=5f7ae6b656d4468b1f2ebf3f773e494c7d147624", "patch": "@@ -423,6 +423,7 @@ varpool_finalize_decl (tree decl)\n      there.  */\n   else if (TREE_PUBLIC (decl) && !DECL_COMDAT (decl) && !DECL_EXTERNAL (decl))\n     varpool_mark_needed_node (node);\n+  node->const_value_known |= varpool_decide_const_value_known (node);\n   if (cgraph_global_info_ready)\n     varpool_assemble_pending_decls ();\n }"}]}