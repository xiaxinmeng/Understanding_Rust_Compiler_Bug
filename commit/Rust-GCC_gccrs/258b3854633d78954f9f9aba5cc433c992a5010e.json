{"sha": "258b3854633d78954f9f9aba5cc433c992a5010e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjU4YjM4NTQ2MzNkNzg5NTRmOWY5YWJhNWNjNDMzYzk5MmE1MDEwZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-11-16T16:41:54Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-11-16T16:41:54Z"}, "message": "re PR middle-end/87854 (gcc.c-torture/compile/pr46534.c ICE for 16-bit size_t)\n\n\tPR middle-end/87854\n\t* c-common.c (fix_string_type): Reject string literals larger than\n\tTYPE_MAX_VALUE (ssizetype) bytes.\n\nFrom-SVN: r266217", "tree": {"sha": "f908eaeb33bb5702b4ae09cf8c2f344702a08fc0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f908eaeb33bb5702b4ae09cf8c2f344702a08fc0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/258b3854633d78954f9f9aba5cc433c992a5010e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/258b3854633d78954f9f9aba5cc433c992a5010e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/258b3854633d78954f9f9aba5cc433c992a5010e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/258b3854633d78954f9f9aba5cc433c992a5010e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7f46559c8282d7e6e9b2b8d67cd390b7775ce1bc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f46559c8282d7e6e9b2b8d67cd390b7775ce1bc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f46559c8282d7e6e9b2b8d67cd390b7775ce1bc"}], "stats": {"total": 29, "additions": 24, "deletions": 5}, "files": [{"sha": "ed700f8decac7e5b1c4b4816d8b2f733794d3f5a", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/258b3854633d78954f9f9aba5cc433c992a5010e/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/258b3854633d78954f9f9aba5cc433c992a5010e/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=258b3854633d78954f9f9aba5cc433c992a5010e", "patch": "@@ -1,3 +1,9 @@\n+2018-11-16  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/87854\n+\t* c-common.c (fix_string_type): Reject string literals larger than\n+\tTYPE_MAX_VALUE (ssizetype) bytes.\n+\n 2018-11-15  Martin Sebor  <msebor@redhat.com>\n \n \tPR c++/87541"}, {"sha": "4034b64bbe2a5f6410863274b291cf172dcf3c94", "filename": "gcc/c-family/c-common.c", "status": "modified", "additions": 18, "deletions": 5, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/258b3854633d78954f9f9aba5cc433c992a5010e/gcc%2Fc-family%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/258b3854633d78954f9f9aba5cc433c992a5010e/gcc%2Fc-family%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.c?ref=258b3854633d78954f9f9aba5cc433c992a5010e", "patch": "@@ -737,31 +737,44 @@ tree\n fix_string_type (tree value)\n {\n   int length = TREE_STRING_LENGTH (value);\n-  int nchars;\n+  int nchars, charsz;\n   tree e_type, i_type, a_type;\n \n   /* Compute the number of elements, for the array type.  */\n   if (TREE_TYPE (value) == char_array_type_node || !TREE_TYPE (value))\n     {\n-      nchars = length;\n+      charsz = 1;\n       e_type = char_type_node;\n     }\n   else if (TREE_TYPE (value) == char16_array_type_node)\n     {\n-      nchars = length / (TYPE_PRECISION (char16_type_node) / BITS_PER_UNIT);\n+      charsz = TYPE_PRECISION (char16_type_node) / BITS_PER_UNIT;\n       e_type = char16_type_node;\n     }\n   else if (TREE_TYPE (value) == char32_array_type_node)\n     {\n-      nchars = length / (TYPE_PRECISION (char32_type_node) / BITS_PER_UNIT);\n+      charsz = TYPE_PRECISION (char32_type_node) / BITS_PER_UNIT;\n       e_type = char32_type_node;\n     }\n   else\n     {\n-      nchars = length / (TYPE_PRECISION (wchar_type_node) / BITS_PER_UNIT);\n+      charsz = TYPE_PRECISION (wchar_type_node) / BITS_PER_UNIT;\n       e_type = wchar_type_node;\n     }\n \n+  /* This matters only for targets where ssizetype has smaller precision\n+     than 32 bits.  */\n+  if (wi::lts_p (wi::to_wide (TYPE_MAX_VALUE (ssizetype)), length))\n+    {\n+      error (\"size of string literal is too large\");\n+      length = tree_to_shwi (TYPE_MAX_VALUE (ssizetype)) / charsz * charsz;\n+      char *str = CONST_CAST (char *, TREE_STRING_POINTER (value));\n+      memset (str + length, '\\0',\n+\t      MIN (TREE_STRING_LENGTH (value) - length, charsz));\n+      TREE_STRING_LENGTH (value) = length;\n+    }\n+  nchars = length / charsz;\n+\n   /* C89 2.2.4.1, C99 5.2.4.1 (Translation limits).  The analogous\n      limit in C++98 Annex B is very large (65536) and is not normative,\n      so we do not diagnose it (warn_overlength_strings is forced off"}]}