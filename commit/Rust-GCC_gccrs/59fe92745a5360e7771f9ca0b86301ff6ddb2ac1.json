{"sha": "59fe92745a5360e7771f9ca0b86301ff6ddb2ac1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTlmZTkyNzQ1YTUzNjBlNzc3MWY5Y2EwYjg2MzAxZmY2ZGRiMmFjMQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2007-08-15T12:08:42Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2007-08-15T12:08:42Z"}, "message": "re PR c++/32992 (Incorrect code generated for anonymous union and return)\n\n\tPR c++/32992\n\t* typeck.c (check_return_expr): Don't NRV optimize vars in\n\tanonymous unions.\n\t* decl.c (finish_function): Comment fix.\n\n\t* g++.dg/opt/nrv14.C: New test.\n\nFrom-SVN: r127510", "tree": {"sha": "daf776af0f24665a9da545d0d072b17b91ce13ed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/daf776af0f24665a9da545d0d072b17b91ce13ed"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/59fe92745a5360e7771f9ca0b86301ff6ddb2ac1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/59fe92745a5360e7771f9ca0b86301ff6ddb2ac1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/59fe92745a5360e7771f9ca0b86301ff6ddb2ac1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/59fe92745a5360e7771f9ca0b86301ff6ddb2ac1/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9bf5a5e86cc0d361ab73e0386b44adc7c7d00db5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9bf5a5e86cc0d361ab73e0386b44adc7c7d00db5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9bf5a5e86cc0d361ab73e0386b44adc7c7d00db5"}], "stats": {"total": 54, "additions": 53, "deletions": 1}, "files": [{"sha": "6a7a4a41dfd79fdbbc141635e8a47b2adae30f3f", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/59fe92745a5360e7771f9ca0b86301ff6ddb2ac1/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/59fe92745a5360e7771f9ca0b86301ff6ddb2ac1/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=59fe92745a5360e7771f9ca0b86301ff6ddb2ac1", "patch": "@@ -1,3 +1,10 @@\n+2007-08-15  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/32992\n+\t* typeck.c (check_return_expr): Don't NRV optimize vars in\n+\tanonymous unions.\n+\t* decl.c (finish_function): Comment fix.\n+\n 2007-08-15  Paolo Carlini  <pcarlini@suse.de>\n \n \tPR c++/33035"}, {"sha": "b04fda369ef8519f0f3e101b29fa26c33b34f365", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/59fe92745a5360e7771f9ca0b86301ff6ddb2ac1/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/59fe92745a5360e7771f9ca0b86301ff6ddb2ac1/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=59fe92745a5360e7771f9ca0b86301ff6ddb2ac1", "patch": "@@ -11569,7 +11569,7 @@ finish_function (int flags)\n   gcc_assert (stmts_are_full_exprs_p ());\n \n   /* Set up the named return value optimization, if we can.  Candidate\n-     variables are selected in check_return_value.  */\n+     variables are selected in check_return_expr.  */\n   if (current_function_return_value)\n     {\n       tree r = current_function_return_value;"}, {"sha": "a79f6e2dd46add26747ca47b18e042524cd313ae", "filename": "gcc/cp/typeck.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/59fe92745a5360e7771f9ca0b86301ff6ddb2ac1/gcc%2Fcp%2Ftypeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/59fe92745a5360e7771f9ca0b86301ff6ddb2ac1/gcc%2Fcp%2Ftypeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck.c?ref=59fe92745a5360e7771f9ca0b86301ff6ddb2ac1", "patch": "@@ -6703,6 +6703,7 @@ check_return_expr (tree retval, bool *no_warning)\n      && TREE_CODE (retval) == VAR_DECL\n      && DECL_CONTEXT (retval) == current_function_decl\n      && ! TREE_STATIC (retval)\n+     && ! DECL_ANON_UNION_VAR_P (retval)\n      && (DECL_ALIGN (retval)\n          >= DECL_ALIGN (DECL_RESULT (current_function_decl)))\n      /* The cv-unqualified type of the returned value must be the"}, {"sha": "45fc15cd363deb09b09993146ae327c4cc6486e8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/59fe92745a5360e7771f9ca0b86301ff6ddb2ac1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/59fe92745a5360e7771f9ca0b86301ff6ddb2ac1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=59fe92745a5360e7771f9ca0b86301ff6ddb2ac1", "patch": "@@ -1,3 +1,8 @@\n+2007-08-15  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/32992\n+\t* g++.dg/opt/nrv14.C: New test.\n+\n 2007-08-15  Paolo Carlini  <pcarlini@suse.de>\n \n \tPR c++/33035"}, {"sha": "22526d6b59a4e9a9379108e14f678212ae33b2bf", "filename": "gcc/testsuite/g++.dg/opt/nrv14.C", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/59fe92745a5360e7771f9ca0b86301ff6ddb2ac1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fnrv14.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/59fe92745a5360e7771f9ca0b86301ff6ddb2ac1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fnrv14.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fnrv14.C?ref=59fe92745a5360e7771f9ca0b86301ff6ddb2ac1", "patch": "@@ -0,0 +1,39 @@\n+// PR c++/32992\n+// { dg-do run }\n+// { dg-options \"-O2\" }\n+\n+extern \"C\" void abort (void);\n+\n+struct A\n+{\n+  long int a1;\n+  long int a2;\n+  long int a3;\n+};\n+\n+struct B\n+{\n+  long int f[3];\n+  operator A ()\n+  {\n+    union\n+    {\n+      long int t[3];\n+      A a;\n+    };\n+    for (int i = 0; i < 3; i++)\n+      t[i] = f[i];\n+    return a;\n+  }\n+};\n+\n+int\n+main ()\n+{\n+  B b = { {1, 3, 5} };\n+  A a = b;\n+\n+  if (a.a1 != b.f[0] || a.a2 != b.f[1] || a.a3 != b.f[2])\n+    abort ();\n+  return 0;\n+}"}]}