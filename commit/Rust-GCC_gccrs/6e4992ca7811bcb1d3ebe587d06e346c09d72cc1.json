{"sha": "6e4992ca7811bcb1d3ebe587d06e346c09d72cc1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmU0OTkyY2E3ODExYmNiMWQzZWJlNTg3ZDA2ZTM0NmMwOWQ3MmNjMQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2014-12-18T17:53:55Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2014-12-18T17:53:55Z"}, "message": "re PR c++/60955 (Erroneous warning about taking address of register with std=c++1y)\n\n/cp\n2014-12-18  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/60955\n\t* pt.c (struct warning_sentinel): Move it...\n\t* cp-tree.h: ... here.\n\t* semantics.c (force_paren_expr): Use it.\n\n/testsuite\n2014-12-18  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/60955\n\t* g++.dg/warn/register-parm-1.C: New.\n\nFrom-SVN: r218871", "tree": {"sha": "7e294e7ddc4eda46df7d1533f7a367674c178de6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7e294e7ddc4eda46df7d1533f7a367674c178de6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6e4992ca7811bcb1d3ebe587d06e346c09d72cc1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e4992ca7811bcb1d3ebe587d06e346c09d72cc1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6e4992ca7811bcb1d3ebe587d06e346c09d72cc1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e4992ca7811bcb1d3ebe587d06e346c09d72cc1/comments", "author": null, "committer": null, "parents": [{"sha": "fbe575b652f5bdcc459f447a0e6f0e059996d4ef", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fbe575b652f5bdcc459f447a0e6f0e059996d4ef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fbe575b652f5bdcc459f447a0e6f0e059996d4ef"}], "stats": {"total": 46, "additions": 36, "deletions": 10}, "files": [{"sha": "e22b516ae7509a92126159b22d819396f78477b5", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e4992ca7811bcb1d3ebe587d06e346c09d72cc1/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e4992ca7811bcb1d3ebe587d06e346c09d72cc1/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=6e4992ca7811bcb1d3ebe587d06e346c09d72cc1", "patch": "@@ -1,3 +1,10 @@\n+2014-12-18  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/60955\n+\t* pt.c (struct warning_sentinel): Move it...\n+\t* cp-tree.h: ... here.\n+\t* semantics.c (force_paren_expr): Use it.\n+\n 2014-12-17  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/64333"}, {"sha": "9487e503ae136bae0371adc1a1eb18b0822ac28f", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e4992ca7811bcb1d3ebe587d06e346c09d72cc1/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e4992ca7811bcb1d3ebe587d06e346c09d72cc1/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=6e4992ca7811bcb1d3ebe587d06e346c09d72cc1", "patch": "@@ -1149,6 +1149,18 @@ struct processing_template_decl_sentinel\n   }\n };\n \n+/* RAII sentinel to disable certain warnings during template substitution\n+   and elsewhere.  */\n+\n+struct warning_sentinel\n+{\n+  int &flag;\n+  int val;\n+  warning_sentinel(int& flag, bool suppress=true)\n+    : flag(flag), val(flag) { if (suppress) flag = 0; }\n+  ~warning_sentinel() { flag = val; }\n+};\n+\n /* The cached class binding level, from the most recently exited\n    class, or NULL if none.  */\n "}, {"sha": "9f036846f58c02ce292e738aa5e76a89b46d8b14", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e4992ca7811bcb1d3ebe587d06e346c09d72cc1/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e4992ca7811bcb1d3ebe587d06e346c09d72cc1/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=6e4992ca7811bcb1d3ebe587d06e346c09d72cc1", "patch": "@@ -14438,16 +14438,6 @@ tsubst_non_call_postfix_expression (tree t, tree args,\n   return t;\n }\n \n-/* Sentinel to disable certain warnings during template substitution.  */\n-\n-struct warning_sentinel {\n-  int &flag;\n-  int val;\n-  warning_sentinel(int& flag, bool suppress=true)\n-    : flag(flag), val(flag) { if (suppress) flag = 0; }\n-  ~warning_sentinel() { flag = val; }\n-};\n-\n /* Like tsubst but deals with expressions and performs semantic\n    analysis.  FUNCTION_P is true if T is the \"F\" in \"F (ARGS)\".  */\n "}, {"sha": "bea3b1fbe68288764521caf2a42b07ad01d4e187", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e4992ca7811bcb1d3ebe587d06e346c09d72cc1/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e4992ca7811bcb1d3ebe587d06e346c09d72cc1/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=6e4992ca7811bcb1d3ebe587d06e346c09d72cc1", "patch": "@@ -1660,6 +1660,9 @@ force_paren_expr (tree expr)\n \t  tree type = unlowered_expr_type (expr);\n \t  bool rval = !!(kind & clk_rvalueref);\n \t  type = cp_build_reference_type (type, rval);\n+\t  /* This inhibits warnings in, eg, cxx_mark_addressable\n+\t     (c++/60955).  */\n+\t  warning_sentinel s (extra_warnings);\n \t  expr = build_static_cast (type, expr, tf_error);\n \t  if (expr != error_mark_node)\n \t    REF_PARENTHESIZED_P (expr) = true;"}, {"sha": "5ad3d9ab82d91d2359374ee1c10ca5e48930f054", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e4992ca7811bcb1d3ebe587d06e346c09d72cc1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e4992ca7811bcb1d3ebe587d06e346c09d72cc1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6e4992ca7811bcb1d3ebe587d06e346c09d72cc1", "patch": "@@ -1,3 +1,8 @@\n+2014-12-18  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/60955\n+\t* g++.dg/warn/register-parm-1.C: New.\n+\n 2014-12-18  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* gcc.target/i386/amd64-abi-7.c: New tests."}, {"sha": "44232d3cf41ad746e1d99ae97487cad545367c5c", "filename": "gcc/testsuite/g++.dg/warn/register-parm-1.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e4992ca7811bcb1d3ebe587d06e346c09d72cc1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fregister-parm-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e4992ca7811bcb1d3ebe587d06e346c09d72cc1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fregister-parm-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fregister-parm-1.C?ref=6e4992ca7811bcb1d3ebe587d06e346c09d72cc1", "patch": "@@ -0,0 +1,9 @@\n+// PR c++/60955\n+// { dg-options \"-Wextra\" }\n+\n+unsigned int erroneous_warning(register int a) {\n+    if ((a) & 0xff) return 1; else return 0;\n+}\n+unsigned int no_erroneous_warning(register int a) {\n+    if (a & 0xff) return 1; else return 0;\n+}"}]}