{"sha": "ec3fba517279402b4686129c23af1d34f23b5ce0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWMzZmJhNTE3Mjc5NDAyYjQ2ODYxMjljMjNhZjFkMzRmMjNiNWNlMA==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2015-04-30T13:35:44Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2015-04-30T13:35:44Z"}, "message": "c-typeck.c (c_build_va_arg): Clarify the error message.\n\n\t* c-typeck.c (c_build_va_arg): Clarify the error message.\n\n\t* gcc.dg/pr65901.c (foo): Adjust dg-error.\n\t* gcc.c-torture/compile/pr48767.c (foo): Likewise.\n\nFrom-SVN: r222626", "tree": {"sha": "12c27f55b052dc69bf525409a1a916d114a67287", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/12c27f55b052dc69bf525409a1a916d114a67287"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ec3fba517279402b4686129c23af1d34f23b5ce0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec3fba517279402b4686129c23af1d34f23b5ce0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ec3fba517279402b4686129c23af1d34f23b5ce0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec3fba517279402b4686129c23af1d34f23b5ce0/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4d1919ed6b1380ed3941f74e16e53529f26ddf9f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d1919ed6b1380ed3941f74e16e53529f26ddf9f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4d1919ed6b1380ed3941f74e16e53529f26ddf9f"}], "stats": {"total": 28, "additions": 18, "deletions": 10}, "files": [{"sha": "2ef895a639cf4e97c83392c1f586e04bb700e8f4", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec3fba517279402b4686129c23af1d34f23b5ce0/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec3fba517279402b4686129c23af1d34f23b5ce0/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=ec3fba517279402b4686129c23af1d34f23b5ce0", "patch": "@@ -6,6 +6,8 @@\n \t* c-typeck.c (c_incomplete_type_error): Refactor to use %qT.  Print\n \tthe type of a decl.\n \n+\t* c-typeck.c (c_build_va_arg): Clarify the error message.\n+\n 2015-04-29  Thomas Schwinge  <thomas@codesourcery.com>\n \n \t* c-parser.c (c_parser_oacc_enter_exit_data): Use"}, {"sha": "328f294899b8e7c183b635f30b59b26bf1770963", "filename": "gcc/c/c-typeck.c", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec3fba517279402b4686129c23af1d34f23b5ce0/gcc%2Fc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec3fba517279402b4686129c23af1d34f23b5ce0/gcc%2Fc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-typeck.c?ref=ec3fba517279402b4686129c23af1d34f23b5ce0", "patch": "@@ -12635,14 +12635,17 @@ c_build_qualified_type (tree type, int type_quals)\n tree\n c_build_va_arg (location_t loc, tree expr, tree type)\n {\n-  if (warn_cxx_compat && TREE_CODE (type) == ENUMERAL_TYPE)\n-    warning_at (loc, OPT_Wc___compat,\n-\t\t\"C++ requires promoted type, not enum type, in %<va_arg%>\");\n-  if (type == error_mark_node || !COMPLETE_TYPE_P (type))\n+  if (error_operand_p (type))\n+    return error_mark_node;\n+  else if (!COMPLETE_TYPE_P (type))\n     {\n-      c_incomplete_type_error (NULL_TREE, type);\n+      error_at (loc, \"second argument to %<va_arg%> is of incomplete \"\n+\t\t\"type %qT\", type);\n       return error_mark_node;\n     }\n+  else if (warn_cxx_compat && TREE_CODE (type) == ENUMERAL_TYPE)\n+    warning_at (loc, OPT_Wc___compat,\n+\t\t\"C++ requires promoted type, not enum type, in %<va_arg%>\");\n   return build_va_arg (loc, expr, type);\n }\n "}, {"sha": "3ab0afee08b8f596506ba73d998372df05c5ed30", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec3fba517279402b4686129c23af1d34f23b5ce0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec3fba517279402b4686129c23af1d34f23b5ce0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ec3fba517279402b4686129c23af1d34f23b5ce0", "patch": "@@ -2,6 +2,9 @@\n \n \t* c-c++-common/Wbool-compare-3.c: New test.\n \n+\t* gcc.dg/pr65901.c (foo): Adjust dg-error.\n+\t* gcc.c-torture/compile/pr48767.c (foo): Likewise.\n+\n 2015-04-30  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/57610"}, {"sha": "f504fe0030bf0bd213730d1aeebd6a837b010192", "filename": "gcc/testsuite/gcc.c-torture/compile/pr48767.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec3fba517279402b4686129c23af1d34f23b5ce0/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr48767.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec3fba517279402b4686129c23af1d34f23b5ce0/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr48767.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr48767.c?ref=ec3fba517279402b4686129c23af1d34f23b5ce0", "patch": "@@ -3,5 +3,5 @@\n void\n foo (__builtin_va_list ap)\n {\n-  __builtin_va_arg (ap, void);  /* { dg-error \"invalid use of void expression\" } */\n+  __builtin_va_arg (ap, void); /* { dg-error \"second argument to .va_arg. is of incomplete type .void.\" } */\n }"}, {"sha": "b40eea3339276880cb529f0c877eeebb3d067083", "filename": "gcc/testsuite/gcc.dg/pr65901.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec3fba517279402b4686129c23af1d34f23b5ce0/gcc%2Ftestsuite%2Fgcc.dg%2Fpr65901.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec3fba517279402b4686129c23af1d34f23b5ce0/gcc%2Ftestsuite%2Fgcc.dg%2Fpr65901.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr65901.c?ref=ec3fba517279402b4686129c23af1d34f23b5ce0", "patch": "@@ -9,8 +9,8 @@ union U;\n void\n foo (__builtin_va_list ap)\n {\n-  __builtin_va_arg (ap, void);  /* { dg-error \"invalid use of void expression\" } */\n-  __builtin_va_arg (ap, struct S);  /* { dg-error \"invalid use of undefined type\" } */\n-  __builtin_va_arg (ap, enum E);  /* { dg-error \"invalid use of undefined type\" } */\n-  __builtin_va_arg (ap, union U);  /* { dg-error \"invalid use of undefined type\" } */\n+  __builtin_va_arg (ap, void);  /* { dg-error \"second argument to .va_arg. is of incomplete type .void.\" } */\n+  __builtin_va_arg (ap, struct S);  /* { dg-error \"second argument to .va_arg. is of incomplete type .struct S.\" } */\n+  __builtin_va_arg (ap, enum E);  /* { dg-error \"second argument to .va_arg. is of incomplete type .enum E.\" } */\n+  __builtin_va_arg (ap, union U);  /* { dg-error \"second argument to .va_arg. is of incomplete type .union U.\" } */\n }"}]}