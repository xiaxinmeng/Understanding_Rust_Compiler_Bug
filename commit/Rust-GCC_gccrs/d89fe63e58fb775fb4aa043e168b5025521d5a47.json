{"sha": "d89fe63e58fb775fb4aa043e168b5025521d5a47", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDg5ZmU2M2U1OGZiNzc1ZmI0YWEwNDNlMTY4YjUwMjU1MjFkNWE0Nw==", "commit": {"author": {"name": "Tamar Christina", "email": "tamar.christina@arm.com", "date": "2018-06-27T08:08:48Z"}, "committer": {"name": "Tamar Christina", "email": "tnfchris@gcc.gnu.org", "date": "2018-06-27T08:08:48Z"}, "message": "Add SIMD to REG pattern for movhf without armv8.2-a support for AArch64\n\nThis fixes a regression where we don't have an instruction for pre Armv8.2-a\nto do a move of an fp16 value from a GP reg to a SIMD reg.\n\nThis patch adds that pattern to movhf_aarch64 using a dup and only selectes it\nusing a very low priority.\n\nThis fixes an ICE at -O0.\n\ngcc/\n2018-06-20  Tamar Christina  <tamar.christina@arm.com>\n\n\tPR target/85769\n\t* config/aarch64/aarch64.md (*movhf_aarch64): Add dup v0.4h pattern.\n\ngcc/testsuite/\n2018-06-20  Tamar Christina  <tamar.christina@arm.com>\n\n\tPR target/85769\n\t* gcc.target/aarch64/f16_mov_immediate_3.c: New.\n\nFrom-SVN: r262178", "tree": {"sha": "2665165a6b88000bc4e71ea1456a1b4a4d228d2d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2665165a6b88000bc4e71ea1456a1b4a4d228d2d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d89fe63e58fb775fb4aa043e168b5025521d5a47", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d89fe63e58fb775fb4aa043e168b5025521d5a47", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d89fe63e58fb775fb4aa043e168b5025521d5a47", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d89fe63e58fb775fb4aa043e168b5025521d5a47/comments", "author": {"login": "TamarChristinaArm", "id": 48126768, "node_id": "MDQ6VXNlcjQ4MTI2NzY4", "avatar_url": "https://avatars.githubusercontent.com/u/48126768?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TamarChristinaArm", "html_url": "https://github.com/TamarChristinaArm", "followers_url": "https://api.github.com/users/TamarChristinaArm/followers", "following_url": "https://api.github.com/users/TamarChristinaArm/following{/other_user}", "gists_url": "https://api.github.com/users/TamarChristinaArm/gists{/gist_id}", "starred_url": "https://api.github.com/users/TamarChristinaArm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TamarChristinaArm/subscriptions", "organizations_url": "https://api.github.com/users/TamarChristinaArm/orgs", "repos_url": "https://api.github.com/users/TamarChristinaArm/repos", "events_url": "https://api.github.com/users/TamarChristinaArm/events{/privacy}", "received_events_url": "https://api.github.com/users/TamarChristinaArm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0e97b84bfc542a51c1db1dd4571faa827a02064a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0e97b84bfc542a51c1db1dd4571faa827a02064a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0e97b84bfc542a51c1db1dd4571faa827a02064a"}], "stats": {"total": 40, "additions": 35, "deletions": 5}, "files": [{"sha": "194d2eef3be27d91292f25218b041470a146c26f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d89fe63e58fb775fb4aa043e168b5025521d5a47/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d89fe63e58fb775fb4aa043e168b5025521d5a47/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d89fe63e58fb775fb4aa043e168b5025521d5a47", "patch": "@@ -1,3 +1,8 @@\n+2018-06-27 Tamar Christina  <tamar.christina@arm.com>\n+\n+\tPR target/85769\n+\t* config/aarch64/aarch64.md (*movhf_aarch64): Add dup v0.4h pattern.\n+\n 2018-06-27  Siddhesh Poyarekar  <siddhesh@sourceware.org>\n \n \t* config/aarch64/aarch64.h (CALL_USE_REGISTERS): Fix obsolete"}, {"sha": "4ac6332a2001ac5869f9fe300a9c350a4621fdbf", "filename": "gcc/config/aarch64/aarch64.md", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d89fe63e58fb775fb4aa043e168b5025521d5a47/gcc%2Fconfig%2Faarch64%2Faarch64.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d89fe63e58fb775fb4aa043e168b5025521d5a47/gcc%2Fconfig%2Faarch64%2Faarch64.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64.md?ref=d89fe63e58fb775fb4aa043e168b5025521d5a47", "patch": "@@ -1161,13 +1161,14 @@\n )\n \n (define_insn \"*movhf_aarch64\"\n-  [(set (match_operand:HF 0 \"nonimmediate_operand\" \"=w,w  ,?r,w,w  ,w  ,w,m,r,m ,r\")\n-\t(match_operand:HF 1 \"general_operand\"      \"Y ,?rY, w,w,Ufc,Uvi,m,w,m,rY,r\"))]\n+  [(set (match_operand:HF 0 \"nonimmediate_operand\" \"=w,w  , w,?r,w,w  ,w  ,w,m,r,m ,r\")\n+\t(match_operand:HF 1 \"general_operand\"      \"Y ,?rY,?r, w,w,Ufc,Uvi,m,w,m,rY,r\"))]\n   \"TARGET_FLOAT && (register_operand (operands[0], HFmode)\n     || aarch64_reg_or_fp_zero (operands[1], HFmode))\"\n   \"@\n    movi\\\\t%0.4h, #0\n    fmov\\\\t%h0, %w1\n+   dup\\\\t%w0.4h, %w1\n    umov\\\\t%w0, %1.h[0]\n    mov\\\\t%0.h[0], %1.h[0]\n    fmov\\\\t%h0, %1\n@@ -1177,10 +1178,10 @@\n    ldrh\\\\t%w0, %1\n    strh\\\\t%w1, %0\n    mov\\\\t%w0, %w1\"\n-  [(set_attr \"type\" \"neon_move,f_mcr,neon_to_gp,neon_move,fconsts, \\\n+  [(set_attr \"type\" \"neon_move,f_mcr,neon_move,neon_to_gp, neon_move,fconsts, \\\n \t\t     neon_move,f_loads,f_stores,load_4,store_4,mov_reg\")\n-   (set_attr \"simd\" \"yes,*,yes,yes,*,yes,*,*,*,*,*\")\n-   (set_attr \"fp16\"   \"*,yes,*,*,yes,*,*,*,*,*,*\")]\n+   (set_attr \"simd\" \"yes,*,yes,yes,yes,*,yes,*,*,*,*,*\")\n+   (set_attr \"fp16\"   \"*,yes,*,*,*,yes,*,*,*,*,*,*\")]\n )\n \n (define_insn \"*movsf_aarch64\""}, {"sha": "f20147a7027204435bba5602c4c316e3f188104d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d89fe63e58fb775fb4aa043e168b5025521d5a47/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d89fe63e58fb775fb4aa043e168b5025521d5a47/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d89fe63e58fb775fb4aa043e168b5025521d5a47", "patch": "@@ -1,3 +1,8 @@\n+2018-06-27 Tamar Christina  <tamar.christina@arm.com>\n+\n+\tPR target/85769\n+\t* gcc.target/aarch64/f16_mov_immediate_3.c: New.\n+\n 2018-06-26  Kelvin Nilsen  <kelvin@gcc.gnu.org>\n \n \t* gcc.target/powerpc/builtins-1.c: Correct a comment."}, {"sha": "6dc325b10b76b2a04f7081f892ce175622eaf49d", "filename": "gcc/testsuite/gcc.target/aarch64/f16_mov_immediate_3.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d89fe63e58fb775fb4aa043e168b5025521d5a47/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Ff16_mov_immediate_3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d89fe63e58fb775fb4aa043e168b5025521d5a47/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Ff16_mov_immediate_3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Ff16_mov_immediate_3.c?ref=d89fe63e58fb775fb4aa043e168b5025521d5a47", "patch": "@@ -0,0 +1,19 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O0\" } */\n+\n+extern __fp16 foo ();\n+\n+__fp16 f4 ()\n+{\n+  __fp16 a = 0;\n+  __fp16 b = 1;\n+  __fp16 c = 2;\n+  __fp16 d = 4;\n+\n+  __fp16 z = a + b;\n+  z = z + c;\n+  z = z - d;\n+  return z;\n+}\n+\n+/* { dg-final { scan-assembler-times {dup\\tv[0-9]+.4h, w[0-9]+} 1 } } */"}]}