{"sha": "e3a174d0d1eef07442fca5867cfcdd05f3b845f8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTNhMTc0ZDBkMWVlZjA3NDQyZmNhNTg2N2NmY2RkMDVmM2I4NDVmOA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-01-03T20:58:48Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-01-03T20:58:48Z"}, "message": "re PR debug/83645 (ICE: in get_insn_template, at final.c:2100 with -gstatement-frontiers)\n\n\tPR debug/83645\n\t* var-tracking.c (delete_vta_debug_insn): New inline function.\n\t(delete_vta_debug_insns): Add USE_CFG argument, if true, walk just\n\tinsns from get_insns () to NULL instead of each bb separately.\n\tUse delete_vta_debug_insn.  No longer static.\n\t(vt_debug_insns_local, variable_tracking_main_1): Adjust\n\tdelete_vta_debug_insns callers.\n\t* rtl.h (delete_vta_debug_insns): Declare.\n\t* final.c (rest_of_handle_final): Call delete_vta_debug_insns\n\tinstead of variable_tracking_main.\n\n\t* gcc.dg/pr83645.c: New test.\n\nFrom-SVN: r256189", "tree": {"sha": "fcf5c9f1f35dfaaf30eb261142828e2c780f0293", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fcf5c9f1f35dfaaf30eb261142828e2c780f0293"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e3a174d0d1eef07442fca5867cfcdd05f3b845f8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3a174d0d1eef07442fca5867cfcdd05f3b845f8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e3a174d0d1eef07442fca5867cfcdd05f3b845f8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3a174d0d1eef07442fca5867cfcdd05f3b845f8/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a594cff3b56f22153e50759c9eb4e0dbe54f3388", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a594cff3b56f22153e50759c9eb4e0dbe54f3388", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a594cff3b56f22153e50759c9eb4e0dbe54f3388"}], "stats": {"total": 115, "additions": 82, "deletions": 33}, "files": [{"sha": "62856ceaa26ea19c60d16d479d724a71672a23fb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3a174d0d1eef07442fca5867cfcdd05f3b845f8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3a174d0d1eef07442fca5867cfcdd05f3b845f8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e3a174d0d1eef07442fca5867cfcdd05f3b845f8", "patch": "@@ -1,3 +1,16 @@\n+2018-01-03  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/83645\n+\t* var-tracking.c (delete_vta_debug_insn): New inline function.\n+\t(delete_vta_debug_insns): Add USE_CFG argument, if true, walk just\n+\tinsns from get_insns () to NULL instead of each bb separately.\n+\tUse delete_vta_debug_insn.  No longer static.\n+\t(vt_debug_insns_local, variable_tracking_main_1): Adjust\n+\tdelete_vta_debug_insns callers.\n+\t* rtl.h (delete_vta_debug_insns): Declare.\n+\t* final.c (rest_of_handle_final): Call delete_vta_debug_insns\n+\tinstead of variable_tracking_main.\n+\n 2018-01-03  Martin Sebor  <msebor@redhat.com>\n \n \tPR c/83559"}, {"sha": "db3095c5526248cd7c35519a2e36c48e4fb87924", "filename": "gcc/final.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3a174d0d1eef07442fca5867cfcdd05f3b845f8/gcc%2Ffinal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3a174d0d1eef07442fca5867cfcdd05f3b845f8/gcc%2Ffinal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffinal.c?ref=e3a174d0d1eef07442fca5867cfcdd05f3b845f8", "patch": "@@ -4544,7 +4544,7 @@ rest_of_handle_final (void)\n   /* Turn debug markers into notes if the var-tracking pass has not\n      been invoked.  */\n   if (!flag_var_tracking && MAY_HAVE_DEBUG_MARKER_INSNS)\n-    variable_tracking_main ();\n+    delete_vta_debug_insns (false);\n \n   assemble_start_function (current_function_decl, fnname);\n   final_start_function (get_insns (), asm_out_file, optimize);"}, {"sha": "e2a9c06193cfaaa3094bf26f9891fe46207b0679", "filename": "gcc/rtl.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3a174d0d1eef07442fca5867cfcdd05f3b845f8/gcc%2Frtl.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3a174d0d1eef07442fca5867cfcdd05f3b845f8/gcc%2Frtl.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frtl.h?ref=e3a174d0d1eef07442fca5867cfcdd05f3b845f8", "patch": "@@ -4254,6 +4254,7 @@ extern GTY(()) rtx stack_limit_rtx;\n \n /* In var-tracking.c */\n extern unsigned int variable_tracking_main (void);\n+extern void delete_vta_debug_insns (bool);\n \n /* In stor-layout.c.  */\n extern void get_mode_bounds (scalar_int_mode, int,"}, {"sha": "e4d16a590ccc37c6c9578b65ef02ae441745596c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3a174d0d1eef07442fca5867cfcdd05f3b845f8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3a174d0d1eef07442fca5867cfcdd05f3b845f8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e3a174d0d1eef07442fca5867cfcdd05f3b845f8", "patch": "@@ -1,3 +1,8 @@\n+2018-01-03  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/83645\n+\t* gcc.dg/pr83645.c: New test.\n+\n 2018-01-03  Martin Sebor  <msebor@redhat.com>\n \n \tPR c/83559"}, {"sha": "4ac2be2d6121e935bb029848085946ed0cf66b95", "filename": "gcc/testsuite/gcc.dg/pr83645.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3a174d0d1eef07442fca5867cfcdd05f3b845f8/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83645.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3a174d0d1eef07442fca5867cfcdd05f3b845f8/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83645.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83645.c?ref=e3a174d0d1eef07442fca5867cfcdd05f3b845f8", "patch": "@@ -0,0 +1,14 @@\n+/* PR debug/83645 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -g -fno-var-tracking\" } */\n+\n+int a, b, c[1];\n+\n+void\n+foo (void)\n+{\n+  int i = 0;\n+  b = a;\n+  for (;;)\n+    c[i++] = 7;\n+}"}, {"sha": "98d09c0544c127db70fcd2e5964f39c332232ffe", "filename": "gcc/var-tracking.c", "status": "modified", "additions": 48, "deletions": 32, "changes": 80, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3a174d0d1eef07442fca5867cfcdd05f3b845f8/gcc%2Fvar-tracking.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3a174d0d1eef07442fca5867cfcdd05f3b845f8/gcc%2Fvar-tracking.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvar-tracking.c?ref=e3a174d0d1eef07442fca5867cfcdd05f3b845f8", "patch": "@@ -10271,45 +10271,61 @@ vt_initialize (void)\n \n static int debug_label_num = 1;\n \n+/* Remove from the insn stream a single debug insn used for\n+   variable tracking at assignments.  */\n+\n+static inline void\n+delete_vta_debug_insn (rtx_insn *insn)\n+{\n+  if (DEBUG_MARKER_INSN_P (insn))\n+    {\n+      reemit_marker_as_note (insn);\n+      return;\n+    }\n+\n+  tree decl = INSN_VAR_LOCATION_DECL (insn);\n+  if (TREE_CODE (decl) == LABEL_DECL\n+      && DECL_NAME (decl)\n+      && !DECL_RTL_SET_P (decl))\n+    {\n+      PUT_CODE (insn, NOTE);\n+      NOTE_KIND (insn) = NOTE_INSN_DELETED_DEBUG_LABEL;\n+      NOTE_DELETED_LABEL_NAME (insn)\n+\t= IDENTIFIER_POINTER (DECL_NAME (decl));\n+      SET_DECL_RTL (decl, insn);\n+      CODE_LABEL_NUMBER (insn) = debug_label_num++;\n+    }\n+  else\n+    delete_insn (insn);\n+}\n+\n /* Remove from the insn stream all debug insns used for variable\n-   tracking at assignments.  */\n+   tracking at assignments.  USE_CFG should be false if the cfg is no\n+   longer usable.  */\n \n-static void\n-delete_vta_debug_insns (void)\n+void\n+delete_vta_debug_insns (bool use_cfg)\n {\n   basic_block bb;\n   rtx_insn *insn, *next;\n \n   if (!MAY_HAVE_DEBUG_INSNS)\n     return;\n \n-  FOR_EACH_BB_FN (bb, cfun)\n-    {\n-      FOR_BB_INSNS_SAFE (bb, insn, next)\n+  if (use_cfg)\n+    FOR_EACH_BB_FN (bb, cfun)\n+      {\n+\tFOR_BB_INSNS_SAFE (bb, insn, next)\n+\t  if (DEBUG_INSN_P (insn))\n+\t    delete_vta_debug_insn (insn);\n+      }\n+  else\n+    for (insn = get_insns (); insn; insn = next)\n+      {\n+\tnext = NEXT_INSN (insn);\n \tif (DEBUG_INSN_P (insn))\n-\t  {\n-\t    if (DEBUG_MARKER_INSN_P (insn))\n-\t      {\n-\t\treemit_marker_as_note (insn);\n-\t\tcontinue;\n-\t      }\n-\n-\t    tree decl = INSN_VAR_LOCATION_DECL (insn);\n-\t    if (TREE_CODE (decl) == LABEL_DECL\n-\t\t&& DECL_NAME (decl)\n-\t\t&& !DECL_RTL_SET_P (decl))\n-\t      {\n-\t\tPUT_CODE (insn, NOTE);\n-\t\tNOTE_KIND (insn) = NOTE_INSN_DELETED_DEBUG_LABEL;\n-\t\tNOTE_DELETED_LABEL_NAME (insn)\n-\t\t  = IDENTIFIER_POINTER (DECL_NAME (decl));\n-\t\tSET_DECL_RTL (decl, insn);\n-\t\tCODE_LABEL_NUMBER (insn) = debug_label_num++;\n-\t      }\n-\t    else\n-\t      delete_insn (insn);\n-\t  }\n-    }\n+\t  delete_vta_debug_insn (insn);\n+      }\n }\n \n /* Run a fast, BB-local only version of var tracking, to take care of\n@@ -10322,7 +10338,7 @@ static void\n vt_debug_insns_local (bool skipped ATTRIBUTE_UNUSED)\n {\n   /* ??? Just skip it all for now.  */\n-  delete_vta_debug_insns ();\n+  delete_vta_debug_insns (true);\n }\n \n /* Free the data structures needed for variable tracking.  */\n@@ -10395,7 +10411,7 @@ variable_tracking_main_1 (void)\n \t any pseudos at this point.  */\n       || targetm.no_register_allocation)\n     {\n-      delete_vta_debug_insns ();\n+      delete_vta_debug_insns (true);\n       return 0;\n     }\n \n@@ -10423,7 +10439,7 @@ variable_tracking_main_1 (void)\n     {\n       vt_finalize ();\n \n-      delete_vta_debug_insns ();\n+      delete_vta_debug_insns (true);\n \n       /* This is later restored by our caller.  */\n       flag_var_tracking_assignments = 0;"}]}