{"sha": "29e1039ca211c4e3f1053925eda0a81c57cbcb0c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjllMTAzOWNhMjExYzRlM2YxMDUzOTI1ZWRhMGE4MWM1N2NiY2IwYw==", "commit": {"author": {"name": "H.J. Lu", "email": "hjl.tools@gmail.com", "date": "2020-07-18T11:43:10Z"}, "committer": {"name": "H.J. Lu", "email": "hjl.tools@gmail.com", "date": "2020-07-19T11:10:04Z"}, "message": "x86: Add __cpuidex and include guard to <cpuid.h>\n\nAdd\n\nvoid __cpuidex (int __cpuid_info[4], int __leaf, int __subleaf);\n\nas well as include guard to <cpuid.h>.\n\ngcc/\n\n\tPR target/95973\n\tPR target/96238\n\t* config/i386/cpuid.h: Add include guard.\n\t(__cpuidex): New.\n\ngcc/testsuite/\n\n\tPR target/95973\n\tPR target/96238\n\t* gcc.target/i386/pr95973.c: New test.", "tree": {"sha": "4d4f14320ba26cc0f022a662e40d106972b01e48", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4d4f14320ba26cc0f022a662e40d106972b01e48"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/29e1039ca211c4e3f1053925eda0a81c57cbcb0c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29e1039ca211c4e3f1053925eda0a81c57cbcb0c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/29e1039ca211c4e3f1053925eda0a81c57cbcb0c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29e1039ca211c4e3f1053925eda0a81c57cbcb0c/comments", "author": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "committer": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3055d879edb1bc2a3923f92a5e681c8f6774fbc3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3055d879edb1bc2a3923f92a5e681c8f6774fbc3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3055d879edb1bc2a3923f92a5e681c8f6774fbc3"}], "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "bca61d620db84e0a3091707793ea83d9b4d2d887", "filename": "gcc/config/i386/cpuid.h", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29e1039ca211c4e3f1053925eda0a81c57cbcb0c/gcc%2Fconfig%2Fi386%2Fcpuid.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29e1039ca211c4e3f1053925eda0a81c57cbcb0c/gcc%2Fconfig%2Fi386%2Fcpuid.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fcpuid.h?ref=29e1039ca211c4e3f1053925eda0a81c57cbcb0c", "patch": "@@ -21,6 +21,9 @@\n  * <http://www.gnu.org/licenses/>.\n  */\n \n+#ifndef _CPUID_H_INCLUDED\n+#define _CPUID_H_INCLUDED\n+\n /* %eax */\n #define bit_AVX512BF16\t(1 << 5)\n \n@@ -313,3 +316,12 @@ __get_cpuid_count (unsigned int __leaf, unsigned int __subleaf,\n   __cpuid_count (__leaf, __subleaf, *__eax, *__ebx, *__ecx, *__edx);\n   return 1;\n }\n+\n+static __inline void\n+__cpuidex (int __cpuid_info[4], int __leaf, int __subleaf)\n+{\n+  __cpuid_count (__leaf, __subleaf, __cpuid_info[0], __cpuid_info[1],\n+\t\t __cpuid_info[2], __cpuid_info[3]);\n+}\n+\n+#endif /* _CPUID_H_INCLUDED */"}, {"sha": "08c7dba8f464c3e64531d2c49679c1cb989d3896", "filename": "gcc/testsuite/gcc.target/i386/pr95973.c", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29e1039ca211c4e3f1053925eda0a81c57cbcb0c/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr95973.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29e1039ca211c4e3f1053925eda0a81c57cbcb0c/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr95973.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr95973.c?ref=29e1039ca211c4e3f1053925eda0a81c57cbcb0c", "patch": "@@ -0,0 +1,25 @@\n+/* { dg-do run } */\n+/* { dg-options \"-O2 -Wall\" } */\n+\n+#include <cpuid.h>\n+#include <cpuid.h>\n+\n+int\n+main ()\n+{\n+  unsigned int eax, ebx, ecx, edx;\n+  int cpuid_info[4];\n+\n+  if (!__get_cpuid_count (7, 0, &eax, &ebx, &ecx, &edx))\n+    return 0;\n+\n+  __cpuidex (cpuid_info, 7, 0);\n+\n+  if (cpuid_info[0] != eax\n+      || cpuid_info[1] != ebx\n+      || cpuid_info[2] != ecx\n+      || cpuid_info[3] != edx)\n+    __builtin_abort ();\n+\n+  return 0;\n+}"}]}