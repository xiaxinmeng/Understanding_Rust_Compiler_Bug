{"sha": "5074d72c59a2d98e1c5162b1144d060d319bd519", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTA3NGQ3MmM1OWEyZDk4ZTFjNTE2MmIxMTQ0ZDA2MGQzMTliZDUxOQ==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2010-10-09T18:28:16Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2010-10-09T18:28:16Z"}, "message": "re PR lto/45956 (Promoted statics conflict)\n\n2010-10-09  Richard Guenther  <rguenther@suse.de>\n\n\tPR lto/45956\n\t* lto-streamer-in.c (lto_register_var_decl_in_symtab):\n\tProperly check if a decl is an automatic var.\n\n\t* gcc.dg/lto/20101009-2_0.c: New testcase.\n\t* gcc.dg/lto/20101009-2_1.c: Likewise.\n\t* gcc.dg/lto/20101009-2_2.c: Likewise.\n\nFrom-SVN: r165235", "tree": {"sha": "b6d32175f905f948e2fb23d15798400a1502b13a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b6d32175f905f948e2fb23d15798400a1502b13a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5074d72c59a2d98e1c5162b1144d060d319bd519", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5074d72c59a2d98e1c5162b1144d060d319bd519", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5074d72c59a2d98e1c5162b1144d060d319bd519", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5074d72c59a2d98e1c5162b1144d060d319bd519/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "865e8e8e51cfb9ab312c2f6618ff9d0d713e1b39", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/865e8e8e51cfb9ab312c2f6618ff9d0d713e1b39", "html_url": "https://github.com/Rust-GCC/gccrs/commit/865e8e8e51cfb9ab312c2f6618ff9d0d713e1b39"}], "stats": {"total": 67, "additions": 46, "deletions": 21}, "files": [{"sha": "5cb3cecba2c1ea6e4b62088ce47564a0d25a9cb9", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5074d72c59a2d98e1c5162b1144d060d319bd519/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5074d72c59a2d98e1c5162b1144d060d319bd519/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5074d72c59a2d98e1c5162b1144d060d319bd519", "patch": "@@ -1,3 +1,9 @@\n+2010-10-09  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR lto/45956\n+\t* lto-streamer-in.c (lto_register_var_decl_in_symtab):\n+\tProperly check if a decl is an automatic var.\n+\n 2010-10-09  Richard Guenther  <rguenther@suse.de>\n \n \tPR lto/45947"}, {"sha": "72ac6eca2f306d8538db10ec774114b07ac08627", "filename": "gcc/lto-streamer-in.c", "status": "modified", "additions": 20, "deletions": 21, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5074d72c59a2d98e1c5162b1144d060d319bd519/gcc%2Flto-streamer-in.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5074d72c59a2d98e1c5162b1144d060d319bd519/gcc%2Flto-streamer-in.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-streamer-in.c?ref=5074d72c59a2d98e1c5162b1144d060d319bd519", "patch": "@@ -2367,27 +2367,26 @@ lto_input_tree_pointers (struct lto_input_block *ib, struct data_in *data_in,\n static void\n lto_register_var_decl_in_symtab (struct data_in *data_in, tree decl)\n {\n-  /* Register symbols with file or global scope to mark what input\n-     file has their definition.  */\n-  if (decl_function_context (decl) == NULL_TREE)\n-    {\n-      /* Variable has file scope, not local. Need to ensure static variables\n-\t between different files don't clash unexpectedly.  */\n-      if (!TREE_PUBLIC (decl))\n-        {\n-\t  /* ??? We normally pre-mangle names before we serialize them\n-\t     out.  Here, in lto1, we do not know the language, and\n-\t     thus cannot do the mangling again. Instead, we just\n-\t     append a suffix to the mangled name.  The resulting name,\n-\t     however, is not a properly-formed mangled name, and will\n-\t     confuse any attempt to unmangle it.  */\n-\t  const char *name = IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (decl));\n-\t  char *label;\n-\n-\t  ASM_FORMAT_PRIVATE_NAME (label, name, DECL_UID (decl));\n-\t  SET_DECL_ASSEMBLER_NAME (decl, get_identifier (label));\n-          rest_of_decl_compilation (decl, 1, 0);\n-        }\n+  tree context;\n+\n+  /* Variable has file scope, not local. Need to ensure static variables\n+     between different files don't clash unexpectedly.  */\n+  if (!TREE_PUBLIC (decl)\n+      && !((context = decl_function_context (decl))\n+\t   && auto_var_in_fn_p (decl, context)))\n+    {\n+      /* ??? We normally pre-mangle names before we serialize them\n+\t out.  Here, in lto1, we do not know the language, and\n+\t thus cannot do the mangling again. Instead, we just\n+\t append a suffix to the mangled name.  The resulting name,\n+\t however, is not a properly-formed mangled name, and will\n+\t confuse any attempt to unmangle it.  */\n+      const char *name = IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (decl));\n+      char *label;\n+\n+      ASM_FORMAT_PRIVATE_NAME (label, name, DECL_UID (decl));\n+      SET_DECL_ASSEMBLER_NAME (decl, get_identifier (label));\n+      rest_of_decl_compilation (decl, 1, 0);\n     }\n \n   /* If this variable has already been declared, queue the"}, {"sha": "d5af564c7ebcad22c21125056cd418a5c4e76632", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5074d72c59a2d98e1c5162b1144d060d319bd519/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5074d72c59a2d98e1c5162b1144d060d319bd519/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5074d72c59a2d98e1c5162b1144d060d319bd519", "patch": "@@ -1,3 +1,10 @@\n+2010-10-09  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR lto/45956\n+\t* gcc.dg/lto/20101009-2_0.c: New testcase.\n+\t* gcc.dg/lto/20101009-2_1.c: Likewise.\n+\t* gcc.dg/lto/20101009-2_2.c: Likewise.\n+\n 2010-10-09  Richard Guenther  <rguenther@suse.de>\n \n \tPR lto/45947"}, {"sha": "249d0e079e00625a972925d4f3eadef861485567", "filename": "gcc/testsuite/gcc.dg/lto/20101009-2_0.c", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5074d72c59a2d98e1c5162b1144d060d319bd519/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2F20101009-2_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5074d72c59a2d98e1c5162b1144d060d319bd519/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2F20101009-2_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2F20101009-2_0.c?ref=5074d72c59a2d98e1c5162b1144d060d319bd519", "patch": "@@ -0,0 +1,3 @@\n+/* { dg-lto-do link } */\n+\n+int main() { return 0; }"}, {"sha": "887057db7a5ec87f5934e713e5bde770b5472fb1", "filename": "gcc/testsuite/gcc.dg/lto/20101009-2_1.c", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5074d72c59a2d98e1c5162b1144d060d319bd519/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2F20101009-2_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5074d72c59a2d98e1c5162b1144d060d319bd519/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2F20101009-2_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2F20101009-2_1.c?ref=5074d72c59a2d98e1c5162b1144d060d319bd519", "patch": "@@ -0,0 +1,5 @@\n+int foo (void)\n+{\n+  static int i;\n+  return ++i;\n+}"}, {"sha": "4a97fe8062078d5e065cbf3a8577f55a3885674a", "filename": "gcc/testsuite/gcc.dg/lto/20101009-2_2.c", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5074d72c59a2d98e1c5162b1144d060d319bd519/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2F20101009-2_2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5074d72c59a2d98e1c5162b1144d060d319bd519/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2F20101009-2_2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2F20101009-2_2.c?ref=5074d72c59a2d98e1c5162b1144d060d319bd519", "patch": "@@ -0,0 +1,5 @@\n+int bar (void)\n+{\n+  static int i;\n+  return ++i;\n+}"}]}