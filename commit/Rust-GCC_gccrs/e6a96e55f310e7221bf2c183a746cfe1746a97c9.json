{"sha": "e6a96e55f310e7221bf2c183a746cfe1746a97c9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTZhOTZlNTVmMzEwZTcyMjFiZjJjMTgzYTc0NmNmZTE3NDZhOTdjOQ==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2010-09-09T12:37:05Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2010-09-09T12:37:05Z"}, "message": "[multiple changes]\n\n2010-09-09  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem.adb (Walk_Library_Items): Traverse context of subunits of the\n\tmain unit.\n\t(Is_Subunit_Of_Main): Handle null nodes properly.\n\n2010-09-09  Robert Dewar  <dewar@adacore.com>\n\n\t* par-ch2.adb: Update comments.\n\nFrom-SVN: r164083", "tree": {"sha": "0eaeed3aaa3182cf44357a7cc4257133d48d651b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0eaeed3aaa3182cf44357a7cc4257133d48d651b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e6a96e55f310e7221bf2c183a746cfe1746a97c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e6a96e55f310e7221bf2c183a746cfe1746a97c9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e6a96e55f310e7221bf2c183a746cfe1746a97c9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e6a96e55f310e7221bf2c183a746cfe1746a97c9/comments", "author": null, "committer": null, "parents": [{"sha": "913eb73e8a1057c50771e484dda36cf305cd4d57", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/913eb73e8a1057c50771e484dda36cf305cd4d57", "html_url": "https://github.com/Rust-GCC/gccrs/commit/913eb73e8a1057c50771e484dda36cf305cd4d57"}], "stats": {"total": 57, "additions": 51, "deletions": 6}, "files": [{"sha": "b81b46b1f5da082cdcd05ede70e9700e7d5d3aff", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6a96e55f310e7221bf2c183a746cfe1746a97c9/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6a96e55f310e7221bf2c183a746cfe1746a97c9/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=e6a96e55f310e7221bf2c183a746cfe1746a97c9", "patch": "@@ -1,3 +1,13 @@\n+2010-09-09  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem.adb (Walk_Library_Items): Traverse context of subunits of the\n+\tmain unit.\n+\t(Is_Subunit_Of_Main): Handle null nodes properly.\n+\n+2010-09-09  Robert Dewar  <dewar@adacore.com>\n+\n+\t* par-ch2.adb: Update comments.\n+\n 2010-09-09  Ben Brosgol  <brosgol@adacore.com>\n \n \t* gnat_rm.texi: Minor wordsmithing of section on pragma Ordered."}, {"sha": "f0a0bcebf6c3d51788b4a741222194278ba84ec8", "filename": "gcc/ada/par-ch2.adb", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6a96e55f310e7221bf2c183a746cfe1746a97c9/gcc%2Fada%2Fpar-ch2.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6a96e55f310e7221bf2c183a746cfe1746a97c9/gcc%2Fada%2Fpar-ch2.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fpar-ch2.adb?ref=e6a96e55f310e7221bf2c183a746cfe1746a97c9", "patch": "@@ -501,11 +501,14 @@ package body Ch2 is\n          Id_Present := False;\n       end if;\n \n-      if Identifier_Seen and not Id_Present and not CodePeer_Mode then\n-         --  In CodePeer mode, we do not generate an error for compatibility\n-         --  with legacy code, since this error can be safely ignored when\n-         --  generating SCIL.\n+      --  Diagnose error of \"positional\" argument for pragma appearing after\n+      --  a \"named\" argument (quotes here are because that's not quite accurate\n+      --  Ada RM terminology).\n+\n+      --  Since older GNAT versions did not generate this error, disable this\n+      --  message in codepeer mode to help legacy code using codepeer.\n \n+      if Identifier_Seen and not Id_Present and not CodePeer_Mode then\n          Error_Msg_SC (\"|pragma argument identifier required here\");\n          Error_Msg_SC (\"\\since previous argument had identifier (RM 2.8(4))\");\n       end if;"}, {"sha": "d3d07cb74a7085ce3c50540a0e51900b78106625", "filename": "gcc/ada/sem.adb", "status": "modified", "additions": 34, "deletions": 2, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6a96e55f310e7221bf2c183a746cfe1746a97c9/gcc%2Fada%2Fsem.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6a96e55f310e7221bf2c183a746cfe1746a97c9/gcc%2Fada%2Fsem.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem.adb?ref=e6a96e55f310e7221bf2c183a746cfe1746a97c9", "patch": "@@ -1985,15 +1985,47 @@ package body Sem is\n       if not Done (Main_Unit) then\n          Do_Main := True;\n \n-         declare\n+         Process_Main : declare\n             Parent_CU : Node_Id;\n             Body_CU   : Node_Id;\n             Body_U    : Unit_Number_Type;\n             Child     : Entity_Id;\n \n+            function Is_Subunit_Of_Main (U : Node_Id) return Boolean;\n+            --  If the main unit has subunits, their context may include\n+            --  bodies that are needed in the body of main. We must examine\n+            --  the context of the subunits, which are otherwise not made\n+            --  explicit in the main unit.\n+\n+            ------------------------\n+            -- Is_Subunit_Of_Main --\n+            ------------------------\n+\n+            function Is_Subunit_Of_Main (U : Node_Id) return Boolean is\n+               Lib : Node_Id;\n+            begin\n+               if No (U) then\n+                  return False;\n+               else\n+                  Lib := Library_Unit (U);\n+                  return Nkind (Unit (U)) = N_Subunit\n+                    and then\n+                      (Lib = Cunit (Main_Unit)\n+                        or else Is_Subunit_Of_Main (Lib));\n+               end if;\n+            end Is_Subunit_Of_Main;\n+\n+         --  Start of processing for Process_Main\n+\n          begin\n             Process_Bodies_In_Context (Main_CU);\n \n+            for Unit_Num in Done'Range loop\n+               if Is_Subunit_Of_Main (Cunit (Unit_Num)) then\n+                  Process_Bodies_In_Context (Cunit (Unit_Num));\n+               end if;\n+            end loop;\n+\n             --  If the main unit is a child unit, parent bodies may be present\n             --  because they export instances or inlined subprograms. Check for\n             --  presence of these, which are not present in context clauses.\n@@ -2023,7 +2055,7 @@ package body Sem is\n \n             Do_Action (Main_CU, Unit (Main_CU));\n             Done (Main_Unit) := True;\n-         end;\n+         end Process_Main;\n       end if;\n \n       if Debug_Unit_Walk then"}]}