{"sha": "12029c04d01c7ba0f775cdc208edf29490ee5db6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTIwMjljMDRkMDFjN2JhMGY3NzVjZGMyMDhlZGYyOTQ5MGVlNWRiNg==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2021-04-07T18:46:37Z"}, "committer": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2021-04-07T18:46:37Z"}, "message": "testsuite: Fix many UNRESOLVEDs for gcc.dg/vect\n\nIt turns out that, on targets that use testglue, many gcc.dg/vect\nscan-dump tests became UNRESOLVED after the change to the dump\nfile naming scheme.\n\nThe problem is that, when creating an executable, we normally name\nthe dump file after both the executable and the source file name.\nHowever, as an exception, we name it after only the source file\nname if:\n\n(a) there is only one source file name and\n(b) the source file and the executable have the same basename\n\nBoth (a) and (b) are normally true when building executables from\ngcc.dg/vect.  But (a) is not true when linking against testglue.\nThe harness was therefore looking for a dump file based only on the\nsource file name while the compiler was producing a dump file that\ncontained both names.\n\nWe get around this for dg-additional-sources using:\n\n\t# This option restores naming of aux and dump output files\n\t# after input files when multiple input files are named,\n\t# instead of getting them combined with the output name.\n\tlappend options \"additional_flags=-dumpbase \\\"\\\"\"\n\nThis patch does the same thing for executables that are linked\nagainst testglue.  This removes over 2400 UNRESOLVEDs from an\narmeb-eabi test run, but in so doing introduces FAILs for some\ntests that were previously skipped.\n\ngcc/testsuite/\n\t* lib/gcc.exp (gcc_target_compile): Add -dumpbase \"\"\n\twhen building an executable with testglue.", "tree": {"sha": "fe1e2c1cfdb3f975a4fbb51bae1aa22683c98212", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fe1e2c1cfdb3f975a4fbb51bae1aa22683c98212"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/12029c04d01c7ba0f775cdc208edf29490ee5db6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/12029c04d01c7ba0f775cdc208edf29490ee5db6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/12029c04d01c7ba0f775cdc208edf29490ee5db6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/12029c04d01c7ba0f775cdc208edf29490ee5db6/comments", "author": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e06d3f5dd7d0c6b4a20fe813e6ee5addd097f560", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e06d3f5dd7d0c6b4a20fe813e6ee5addd097f560", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e06d3f5dd7d0c6b4a20fe813e6ee5addd097f560"}], "stats": {"total": 3, "additions": 3, "deletions": 0}, "files": [{"sha": "4d80606d38642f769885ad6fde227850ec15e35f", "filename": "gcc/testsuite/lib/gcc.exp", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/12029c04d01c7ba0f775cdc208edf29490ee5db6/gcc%2Ftestsuite%2Flib%2Fgcc.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/12029c04d01c7ba0f775cdc208edf29490ee5db6/gcc%2Ftestsuite%2Flib%2Fgcc.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fgcc.exp?ref=12029c04d01c7ba0f775cdc208edf29490ee5db6", "patch": "@@ -134,6 +134,9 @@ proc gcc_target_compile { source dest type options } {\n \t    [info exists gluefile] } {\n \tlappend options \"libs=${gluefile}\"\n \tlappend options \"ldflags=$wrap_flags\"\n+\tif { $type == \"executable\" } {\n+\t    set options [concat \"{additional_flags=-dumpbase \\\"\\\"}\" $options]\n+\t}\n     }\n \n     global TEST_EXTRA_LIBS"}]}