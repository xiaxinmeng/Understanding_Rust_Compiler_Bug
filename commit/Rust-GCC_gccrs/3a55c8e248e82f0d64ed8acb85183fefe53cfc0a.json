{"sha": "3a55c8e248e82f0d64ed8acb85183fefe53cfc0a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2E1NWM4ZTI0OGU4MmYwZDY0ZWQ4YWNiODUxODNmZWZlNTNjZmMwYQ==", "commit": {"author": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2019-01-26T20:45:55Z"}, "committer": {"name": "Harald Anlauf", "email": "anlauf@gcc.gnu.org", "date": "2019-01-26T20:45:55Z"}, "message": "re PR fortran/57553 ([F08] Valid use of STORAGE_SIZE rejected, bad error message for invalid use)\n\n2019-01-26  Harald Anlauf  <anlauf@gmx.de>\n\n\tPR fortran/57553\n\t* expr.c (check_inquiry): Add list of inquiry functions allowed in\n\tconstant expressions for F2008+.\n\n2019-01-26  Harald Anlauf  <anlauf@gmx.de>\n\n\tPR fortran/57553\n\t* gfortran.dg/pr57553.f90: New test.\n\nFrom-SVN: r268303", "tree": {"sha": "145fc1e32ff23706a5373d253e338f8d4da0aaf4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/145fc1e32ff23706a5373d253e338f8d4da0aaf4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3a55c8e248e82f0d64ed8acb85183fefe53cfc0a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3a55c8e248e82f0d64ed8acb85183fefe53cfc0a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3a55c8e248e82f0d64ed8acb85183fefe53cfc0a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3a55c8e248e82f0d64ed8acb85183fefe53cfc0a/comments", "author": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "fac29445acaf19d58717927e6ee7e6624d2b3cce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fac29445acaf19d58717927e6ee7e6624d2b3cce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fac29445acaf19d58717927e6ee7e6624d2b3cce"}], "stats": {"total": 40, "additions": 37, "deletions": 3}, "files": [{"sha": "c1d252606523d33e3aae3ba43010c8d7d62c6d2d", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3a55c8e248e82f0d64ed8acb85183fefe53cfc0a/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3a55c8e248e82f0d64ed8acb85183fefe53cfc0a/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=3a55c8e248e82f0d64ed8acb85183fefe53cfc0a", "patch": "@@ -1,3 +1,9 @@\n+2019-01-26  Harald Anlauf  <anlauf@gmx.de>\n+\n+\tPR fortran/57553\n+\t* expr.c (check_inquiry): Add list of inquiry functions allowed in\n+\tconstant expressions for F2008+.\n+\n 2019-01-25  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/85780"}, {"sha": "a9e7f36c491a7179d31261c70aac8da325ec173a", "filename": "gcc/fortran/expr.c", "status": "modified", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3a55c8e248e82f0d64ed8acb85183fefe53cfc0a/gcc%2Ffortran%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3a55c8e248e82f0d64ed8acb85183fefe53cfc0a/gcc%2Ffortran%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fexpr.c?ref=3a55c8e248e82f0d64ed8acb85183fefe53cfc0a", "patch": "@@ -2515,7 +2515,8 @@ check_init_expr_arguments (gfc_expr *e)\n static bool check_restricted (gfc_expr *);\n \n /* F95, 7.1.6.1, Initialization expressions, (7)\n-   F2003, 7.1.7 Initialization expression, (8)  */\n+   F2003, 7.1.7 Initialization expression, (8)\n+   F2008, 7.1.12 Constant expression, (4)  */\n \n static match\n check_inquiry (gfc_expr *e, int not_restricted)\n@@ -2539,6 +2540,15 @@ check_inquiry (gfc_expr *e, int not_restricted)\n     \"new_line\", NULL\n   };\n \n+  /* std=f2008+ or -std=gnu */\n+  static const char *const inquiry_func_gnu[] = {\n+    \"lbound\", \"shape\", \"size\", \"ubound\",\n+    \"bit_size\", \"len\", \"kind\",\n+    \"digits\", \"epsilon\", \"huge\", \"maxexponent\", \"minexponent\",\n+    \"precision\", \"radix\", \"range\", \"tiny\",\n+    \"new_line\", \"storage_size\", NULL\n+  };\n+\n   int i = 0;\n   gfc_actual_arglist *ap;\n \n@@ -2565,8 +2575,11 @@ check_inquiry (gfc_expr *e, int not_restricted)\n     {\n       name = e->symtree->n.sym->name;\n \n-      functions = (gfc_option.warn_std & GFC_STD_F2003)\n-\t\t? inquiry_func_f2003 : inquiry_func_f95;\n+      functions = inquiry_func_gnu;\n+      if (gfc_option.warn_std & GFC_STD_F2003)\n+\tfunctions = inquiry_func_f2003;\n+      if (gfc_option.warn_std & GFC_STD_F95)\n+\tfunctions = inquiry_func_f95;\n \n       for (i = 0; functions[i]; i++)\n \tif (strcmp (functions[i], name) == 0)"}, {"sha": "d6f6e0f266f31a7a9df4fade2a1836d2d6648c26", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3a55c8e248e82f0d64ed8acb85183fefe53cfc0a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3a55c8e248e82f0d64ed8acb85183fefe53cfc0a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3a55c8e248e82f0d64ed8acb85183fefe53cfc0a", "patch": "@@ -1,3 +1,8 @@\n+2019-01-26  Harald Anlauf  <anlauf@gmx.de>\n+\n+\tPR fortran/57553\n+\t* gfortran.dg/pr57553.f90: New test.\n+\n 2019-01-26  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/array34.adb: New test."}, {"sha": "afd0cc14d90abf90d029f4689648ec775fe6e5a0", "filename": "gcc/testsuite/gfortran.dg/pr57553.f90", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3a55c8e248e82f0d64ed8acb85183fefe53cfc0a/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr57553.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3a55c8e248e82f0d64ed8acb85183fefe53cfc0a/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr57553.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr57553.f90?ref=3a55c8e248e82f0d64ed8acb85183fefe53cfc0a", "patch": "@@ -0,0 +1,10 @@\n+! { dg-do compile }\n+!\n+! PR fortran/57553 - bad error message for invalid use of STORAGE_SIZE\n+!\n+! Testcase contributed by Tobias Burnus\n+\n+subroutine S (A)\n+  character(len=*), intent(in) :: A\n+  integer, parameter :: ESize = (storage_size(a) + 7) / 8 ! { dg-error \"does not reduce to a constant\" }\n+end"}]}