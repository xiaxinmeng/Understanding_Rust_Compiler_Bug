{"sha": "b388214880aab8692ddb35a63b067a01f552080c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjM4ODIxNDg4MGFhYjg2OTJkZGIzNWE2M2IwNjdhMDFmNTUyMDgwYw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2011-07-28T16:23:20Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2011-07-28T16:23:20Z"}, "message": "dwarf2out.c (resolve_addr): For -gdwarf-2 don't optimize DW_AT_data_member_location containing just...\n\n\t* dwarf2out.c (resolve_addr): For -gdwarf-2 don't\n\toptimize DW_AT_data_member_location containing just\n\tDW_OP_plus_uconst.\n\nFrom-SVN: r176878", "tree": {"sha": "978e4c99bd11ba21d448c3730073956bfc28a7d7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/978e4c99bd11ba21d448c3730073956bfc28a7d7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b388214880aab8692ddb35a63b067a01f552080c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b388214880aab8692ddb35a63b067a01f552080c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b388214880aab8692ddb35a63b067a01f552080c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b388214880aab8692ddb35a63b067a01f552080c/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "64153cceb266ecd5794c158db93e92025b457d5d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/64153cceb266ecd5794c158db93e92025b457d5d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/64153cceb266ecd5794c158db93e92025b457d5d"}], "stats": {"total": 31, "additions": 24, "deletions": 7}, "files": [{"sha": "630a8d05da29e4858fc4a0203eb8bc000b579965", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b388214880aab8692ddb35a63b067a01f552080c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b388214880aab8692ddb35a63b067a01f552080c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b388214880aab8692ddb35a63b067a01f552080c", "patch": "@@ -1,5 +1,9 @@\n 2011-07-28  Jakub Jelinek  <jakub@redhat.com>\n \n+\t* dwarf2out.c (resolve_addr): For -gdwarf-2 don't\n+\toptimize DW_AT_data_member_location containing just\n+\tDW_OP_plus_uconst.\n+\n \tPR debug/49871\n \t* dwarf2out.c (size_of_die, value_format, output_die): Use\n \tDW_FORM_udata instead of DW_FORM_data[48] for"}, {"sha": "a38bcf8f21cdc8628485057175e45a5514adec05", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 20, "deletions": 7, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b388214880aab8692ddb35a63b067a01f552080c/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b388214880aab8692ddb35a63b067a01f552080c/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=b388214880aab8692ddb35a63b067a01f552080c", "patch": "@@ -21809,13 +21809,26 @@ resolve_addr (dw_die_ref die)\n \t  }\n \tbreak;\n       case dw_val_class_loc:\n-\tif (!resolve_addr_in_expr (AT_loc (a)))\n-\t  {\n-\t    remove_AT (die, a->dw_attr);\n-\t    ix--;\n-\t  }\n-\telse\n-\t  mark_base_types (AT_loc (a));\n+\t{\n+\t  dw_loc_descr_ref l = AT_loc (a);\n+\t  /* For -gdwarf-2 don't attempt to optimize\n+\t     DW_AT_data_member_location containing\n+\t     DW_OP_plus_uconst - older consumers might\n+\t     rely on it being that op instead of a more complex,\n+\t     but shorter, location description.  */\n+\t  if ((dwarf_version > 2\n+\t       || a->dw_attr != DW_AT_data_member_location\n+\t       || l == NULL\n+\t       || l->dw_loc_opc != DW_OP_plus_uconst\n+\t       || l->dw_loc_next != NULL)\n+\t      && !resolve_addr_in_expr (l))\n+\t    {\n+\t      remove_AT (die, a->dw_attr);\n+\t      ix--;\n+\t    }\n+\t  else\n+\t    mark_base_types (l);\n+\t}\n \tbreak;\n       case dw_val_class_addr:\n \tif (a->dw_attr == DW_AT_const_value"}]}