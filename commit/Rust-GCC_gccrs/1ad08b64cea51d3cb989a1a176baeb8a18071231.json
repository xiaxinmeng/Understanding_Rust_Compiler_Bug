{"sha": "1ad08b64cea51d3cb989a1a176baeb8a18071231", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWFkMDhiNjRjZWE1MWQzY2I5ODlhMWExNzZiYWViOGExODA3MTIzMQ==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2020-10-02T20:10:55Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2020-10-02T21:18:51Z"}, "message": "libstdc++: Fix testcase by using terminate handler\n\nThis test was supposed to verify that when __libc_single_threaded is\navailable we successfully detect recursive static initialization even\nwhen linked to libpthread. But I forgot to that when recursive init is\ndetected, we terminate, and so the test fails.\n\nThis adds a terminate handler that exits cleanly, so the test passes\nwhen recursive init is detected.\n\nlibstdc++-v3/ChangeLog:\n\n\t* testsuite/18_support/96817.cc: Use terminate handler that\n\tcalls _Exit(0).", "tree": {"sha": "8ff431d73dd1b109672e9c4b78a859b2e52dbced", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8ff431d73dd1b109672e9c4b78a859b2e52dbced"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1ad08b64cea51d3cb989a1a176baeb8a18071231", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ad08b64cea51d3cb989a1a176baeb8a18071231", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ad08b64cea51d3cb989a1a176baeb8a18071231", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ad08b64cea51d3cb989a1a176baeb8a18071231/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "679dbc9dcec0d1240951442947199ba155f494b6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/679dbc9dcec0d1240951442947199ba155f494b6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/679dbc9dcec0d1240951442947199ba155f494b6"}], "stats": {"total": 6, "additions": 6, "deletions": 0}, "files": [{"sha": "19399c473ef17ec9318759cd6d68a0737e60fbe2", "filename": "libstdc++-v3/testsuite/18_support/96817.cc", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1ad08b64cea51d3cb989a1a176baeb8a18071231/libstdc%2B%2B-v3%2Ftestsuite%2F18_support%2F96817.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1ad08b64cea51d3cb989a1a176baeb8a18071231/libstdc%2B%2B-v3%2Ftestsuite%2F18_support%2F96817.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F18_support%2F96817.cc?ref=1ad08b64cea51d3cb989a1a176baeb8a18071231", "patch": "@@ -21,6 +21,9 @@\n \n // PR libstdc++/96817\n \n+#include <exception>\n+#include <stdlib.h>\n+\n int init()\n {\n #if __has_include(<sys/single_threaded.h>)\n@@ -32,8 +35,11 @@ int init()\n   return 0;\n }\n \n+void clean_terminate() { _Exit(0); }\n+\n int\n main (int argc, char **argv)\n {\n+  std::set_terminate(clean_terminate);\n   init();\n }"}]}