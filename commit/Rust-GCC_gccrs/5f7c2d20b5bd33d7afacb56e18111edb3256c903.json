{"sha": "5f7c2d20b5bd33d7afacb56e18111edb3256c903", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWY3YzJkMjBiNWJkMzNkN2FmYWNiNTZlMTgxMTFlZGIzMjU2YzkwMw==", "commit": {"author": {"name": "David Edelsohn", "email": "dje.gcc@gmail.com", "date": "2021-04-08T01:34:02Z"}, "committer": {"name": "David Edelsohn", "email": "dje.gcc@gmail.com", "date": "2021-04-08T21:40:23Z"}, "message": "aix: revert TLS common change\n\nGCC uses TLS common for both public common / BSS and local common / BSS.\nThis patch reverts to use .comm directive to allocate TLS\ncommon / BSS.  This also changes the priority of section selection\nto use BSS before data section.\n\ngcc/ChangeLog:\n\n\t* config/rs6000/rs6000.c (rs6000_xcoff_select_section): Select\n\tTLS BSS before TLS data.\n\t* config/rs6000/xcoff.h (ASM_OUTPUT_TLS_COMMON): Use .comm.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/gomp/tls-5.C: Expect tbss failure on AIX.", "tree": {"sha": "1a97142946c9e9c88f59a376ff921bf21737362d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1a97142946c9e9c88f59a376ff921bf21737362d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5f7c2d20b5bd33d7afacb56e18111edb3256c903", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f7c2d20b5bd33d7afacb56e18111edb3256c903", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5f7c2d20b5bd33d7afacb56e18111edb3256c903", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f7c2d20b5bd33d7afacb56e18111edb3256c903/comments", "author": {"login": "edelsohn", "id": 667700, "node_id": "MDQ6VXNlcjY2NzcwMA==", "avatar_url": "https://avatars.githubusercontent.com/u/667700?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edelsohn", "html_url": "https://github.com/edelsohn", "followers_url": "https://api.github.com/users/edelsohn/followers", "following_url": "https://api.github.com/users/edelsohn/following{/other_user}", "gists_url": "https://api.github.com/users/edelsohn/gists{/gist_id}", "starred_url": "https://api.github.com/users/edelsohn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edelsohn/subscriptions", "organizations_url": "https://api.github.com/users/edelsohn/orgs", "repos_url": "https://api.github.com/users/edelsohn/repos", "events_url": "https://api.github.com/users/edelsohn/events{/privacy}", "received_events_url": "https://api.github.com/users/edelsohn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "edelsohn", "id": 667700, "node_id": "MDQ6VXNlcjY2NzcwMA==", "avatar_url": "https://avatars.githubusercontent.com/u/667700?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edelsohn", "html_url": "https://github.com/edelsohn", "followers_url": "https://api.github.com/users/edelsohn/followers", "following_url": "https://api.github.com/users/edelsohn/following{/other_user}", "gists_url": "https://api.github.com/users/edelsohn/gists{/gist_id}", "starred_url": "https://api.github.com/users/edelsohn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edelsohn/subscriptions", "organizations_url": "https://api.github.com/users/edelsohn/orgs", "repos_url": "https://api.github.com/users/edelsohn/repos", "events_url": "https://api.github.com/users/edelsohn/events{/privacy}", "received_events_url": "https://api.github.com/users/edelsohn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b5242b284549cc7994a8dc073f9e1479ee0ae915", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5242b284549cc7994a8dc073f9e1479ee0ae915", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b5242b284549cc7994a8dc073f9e1479ee0ae915"}], "stats": {"total": 18, "additions": 9, "deletions": 9}, "files": [{"sha": "48b8efd732b251c059628096314848305deb0c0b", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f7c2d20b5bd33d7afacb56e18111edb3256c903/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f7c2d20b5bd33d7afacb56e18111edb3256c903/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=5f7c2d20b5bd33d7afacb56e18111edb3256c903", "patch": "@@ -21285,14 +21285,14 @@ rs6000_xcoff_select_section (tree decl, int reloc,\n #if HAVE_AS_TLS\n       if (TREE_CODE (decl) == VAR_DECL && DECL_THREAD_LOCAL_P (decl))\n \t{\n-\t  if (TREE_PUBLIC (decl))\n-\t    return tls_data_section;\n-\t  else if (bss_initializer_p (decl))\n+\t  if (bss_initializer_p (decl))\n \t    {\n \t      /* Convert to COMMON to emit in BSS.  */\n \t      DECL_COMMON (decl) = 1;\n \t      return tls_comm_section;\n \t    }\n+\t  else if (TREE_PUBLIC (decl))\n+\t    return tls_data_section;\n \t  else\n \t    return tls_private_data_section;\n \t}"}, {"sha": "c01667809a515cc6cf5c40a569c769a0b62ae9a6", "filename": "gcc/config/rs6000/xcoff.h", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f7c2d20b5bd33d7afacb56e18111edb3256c903/gcc%2Fconfig%2Frs6000%2Fxcoff.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f7c2d20b5bd33d7afacb56e18111edb3256c903/gcc%2Fconfig%2Frs6000%2Fxcoff.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fxcoff.h?ref=5f7c2d20b5bd33d7afacb56e18111edb3256c903", "patch": "@@ -255,11 +255,11 @@\n      } while (0)\n \n #ifdef HAVE_AS_TLS\n-#define ASM_OUTPUT_TLS_COMMON(FILE, DECL, NAME, SIZE)   \\\n-  do { fputs (LOCAL_COMMON_ASM_OP, (FILE));             \\\n-       fprintf ((FILE), \"%s,\" HOST_WIDE_INT_PRINT_UNSIGNED\",%s[UL],3\\n\", \\\n-\t\t(*targetm.strip_name_encoding) (NAME), (SIZE),\t\\\n-\t\t(*targetm.strip_name_encoding) (NAME));\t\\\n+#define ASM_OUTPUT_TLS_COMMON(FILE, DECL, NAME, SIZE)\t\\\n+  do { fputs (COMMON_ASM_OP, (FILE));\t\t\t\\\n+       RS6000_OUTPUT_BASENAME ((FILE), (NAME));\t\t\\\n+       fprintf ((FILE), \"[UL],\" HOST_WIDE_INT_PRINT_UNSIGNED\"\\n\", \\\n+       (SIZE));\t\t\t\t\t\t\\\n   } while (0)\n #endif\n "}, {"sha": "81431e82a9679c40b78c3587960de39445693cf7", "filename": "gcc/testsuite/g++.dg/gomp/tls-5.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f7c2d20b5bd33d7afacb56e18111edb3256c903/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgomp%2Ftls-5.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f7c2d20b5bd33d7afacb56e18111edb3256c903/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgomp%2Ftls-5.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgomp%2Ftls-5.C?ref=5f7c2d20b5bd33d7afacb56e18111edb3256c903", "patch": "@@ -1,7 +1,7 @@\n // The reference temp should be TLS, not normal data.\n // { dg-require-effective-target c++11 }\n // { dg-final { scan-assembler-not \"\\\\.data\" { target tls_native xfail powerpc-*-aix* } } }\n-// { dg-final { scan-assembler-symbol-section {^_?ir$} {^\\.tbss|\\[TL\\]} { target tls_native } } }\n+// { dg-final { scan-assembler-symbol-section {^_?ir$} {^\\.tbss} { target tls_native xfail powerpc-*-aix* } } }\n // { dg-final { scan-assembler-symbol-section {^_?_ZGR2ir_$} {^\\.tdata|\\[TL\\]} { target tls_native } } }\n \n extern int&& ir;"}]}