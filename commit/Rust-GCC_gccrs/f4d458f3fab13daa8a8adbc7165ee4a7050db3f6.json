{"sha": "f4d458f3fab13daa8a8adbc7165ee4a7050db3f6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjRkNDU4ZjNmYWIxM2RhYThhOGFkYmM3MTY1ZWU0YTcwNTBkYjNmNg==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2018-12-17T21:49:58Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2018-12-17T21:49:58Z"}, "message": "PR c++/52321 print note for static_cast to/from incomplete type\n\n\tPR c++/52321\n\t* typeck.c (build_static_cast): Print a note when the destination\n\ttype or the operand is a pointer/reference to incomplete class type.\n\nFrom-SVN: r267219", "tree": {"sha": "2c6206affa21424fe0236ece52816cb41f2b1ef8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2c6206affa21424fe0236ece52816cb41f2b1ef8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f4d458f3fab13daa8a8adbc7165ee4a7050db3f6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f4d458f3fab13daa8a8adbc7165ee4a7050db3f6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f4d458f3fab13daa8a8adbc7165ee4a7050db3f6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f4d458f3fab13daa8a8adbc7165ee4a7050db3f6/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "693ad66b86dcadc9764a2ef4365902b153560dde", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/693ad66b86dcadc9764a2ef4365902b153560dde", "html_url": "https://github.com/Rust-GCC/gccrs/commit/693ad66b86dcadc9764a2ef4365902b153560dde"}], "stats": {"total": 50, "additions": 48, "deletions": 2}, "files": [{"sha": "a7ec887d9c02afd56b9572f0fa30ef3100e72e43", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f4d458f3fab13daa8a8adbc7165ee4a7050db3f6/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f4d458f3fab13daa8a8adbc7165ee4a7050db3f6/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=f4d458f3fab13daa8a8adbc7165ee4a7050db3f6", "patch": "@@ -1,3 +1,9 @@\n+2018-12-17  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\tPR c++/52321\n+\t* typeck.c (build_static_cast): Print a note when the destination\n+\ttype or the operand is a pointer/reference to incomplete class type.\n+\n 2018-12-16  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/88482"}, {"sha": "47ddad16fc1019473fe1a0dfa045abd531aac832", "filename": "gcc/cp/typeck.c", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f4d458f3fab13daa8a8adbc7165ee4a7050db3f6/gcc%2Fcp%2Ftypeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f4d458f3fab13daa8a8adbc7165ee4a7050db3f6/gcc%2Fcp%2Ftypeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck.c?ref=f4d458f3fab13daa8a8adbc7165ee4a7050db3f6", "patch": "@@ -7348,8 +7348,21 @@ build_static_cast (tree type, tree oexpr, tsubst_flags_t complain)\n     }\n \n   if (complain & tf_error)\n-    error (\"invalid static_cast from type %qT to type %qT\",\n-           TREE_TYPE (expr), type);\n+    {\n+      error (\"invalid static_cast from type %qT to type %qT\",\n+\t     TREE_TYPE (expr), type);\n+      if ((TYPE_PTR_P (type) || TYPE_REF_P (type))\n+\t  && CLASS_TYPE_P (TREE_TYPE (type))\n+\t    && !COMPLETE_TYPE_P (TREE_TYPE (type)))\n+\tinform (DECL_SOURCE_LOCATION (TYPE_MAIN_DECL (TREE_TYPE (type))),\n+\t\t\"class type %qT is incomplete\", TREE_TYPE (type));\n+      tree expr_type = TREE_TYPE (expr);\n+      if (TYPE_PTR_P (expr_type))\n+\texpr_type = TREE_TYPE (expr_type);\n+      if (CLASS_TYPE_P (expr_type) && !COMPLETE_TYPE_P (expr_type))\n+\tinform (DECL_SOURCE_LOCATION (TYPE_MAIN_DECL (expr_type)),\n+\t\t\"class type %qT is incomplete\", expr_type);\n+    }\n   return error_mark_node;\n }\n "}, {"sha": "dc4d2162d6c2ceabd8e9e63eac6d2baa86b5e6b3", "filename": "gcc/testsuite/g++.dg/expr/static_cast8.C", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f4d458f3fab13daa8a8adbc7165ee4a7050db3f6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fexpr%2Fstatic_cast8.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f4d458f3fab13daa8a8adbc7165ee4a7050db3f6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fexpr%2Fstatic_cast8.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fexpr%2Fstatic_cast8.C?ref=f4d458f3fab13daa8a8adbc7165ee4a7050db3f6", "patch": "@@ -0,0 +1,27 @@\n+// PR c++/52321\n+struct A1; // { dg-message \"note: class type 'A1' is incomplete\" }\n+struct A2; // { dg-message \"note: class type 'A2' is incomplete\" }\n+struct B1; // { dg-message \"note: class type 'B1' is incomplete\" }\n+struct B2; // { dg-message \"note: class type 'B2' is incomplete\" }\n+\n+struct C { };\n+extern C* c;\n+\n+void pointers(C* c, A2* a2, B1* b1)\n+{\n+  (void) static_cast<A1*>(c);\t// { dg-error \"invalid static_cast\" }\n+  (void) static_cast<C*>(a2);\t// { dg-error \"invalid static_cast\" }\n+  (void) static_cast<B2*>(b1);\t// { dg-error \"invalid static_cast\" }\n+}\n+\n+struct D1; // { dg-message \"note: class type 'D1' is incomplete\" }\n+struct D2; // { dg-message \"note: class type 'D2' is incomplete\" }\n+struct E1; // { dg-message \"note: class type 'E1' is incomplete\" }\n+struct E2; // { dg-message \"note: class type 'E2' is incomplete\" }\n+\n+void references(C& c, D2& d2, E1& e1)\n+{\n+  (void) static_cast<D1&>(c);\t// { dg-error \"invalid static_cast\" }\n+  (void) static_cast<C&>(d2);\t// { dg-error \"invalid static_cast\" }\n+  (void) static_cast<E2&>(e1);\t// { dg-error \"invalid static_cast\" }\n+}"}]}