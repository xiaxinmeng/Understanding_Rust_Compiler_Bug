{"sha": "b03ad138a61f64d8a77876d6864aad5103fff498", "node_id": "C_kwDOANBUbNoAKGIwM2FkMTM4YTYxZjY0ZDhhNzc4NzZkNjg2NGFhZDUxMDNmZmY0OTg", "commit": {"author": {"name": "Andrew Pinski", "email": "apinski@marvell.com", "date": "2022-11-19T20:48:27Z"}, "committer": {"name": "Andrew Pinski", "email": "apinski@marvell.com", "date": "2022-11-21T07:40:17Z"}, "message": "Fix PR 106560: Another ICE after conflicting types of redeclaration\n\nThis another one of these ICE after error issues with the\ngimplifier and a fallout from r12-3278-g823685221de986af.\nThe problem here is gimplify_modify_expr does not\ncheck if either from or to was an error operand.\nThis adds the check and fixes the ICE.\n\nOK? Bootstrapped and tested on x86_64-linux-gnu with no regressions.\n\ngcc/ChangeLog:\n\n\t* gimplify.cc (gimplify_modify_expr): If\n\teither *from_p or *to_p were error_operand\n\treturn early.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.dg/redecl-23.c: New test.\n\t* gcc.dg/redecl-24.c: New test.\n\t* gcc.dg/redecl-25.c: New test.", "tree": {"sha": "1e2718340f90bca09f078d7b6132fd25170d4171", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1e2718340f90bca09f078d7b6132fd25170d4171"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b03ad138a61f64d8a77876d6864aad5103fff498", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b03ad138a61f64d8a77876d6864aad5103fff498", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b03ad138a61f64d8a77876d6864aad5103fff498", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b03ad138a61f64d8a77876d6864aad5103fff498/comments", "author": {"login": "apinski-cavium", "id": 6335315, "node_id": "MDQ6VXNlcjYzMzUzMTU=", "avatar_url": "https://avatars.githubusercontent.com/u/6335315?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apinski-cavium", "html_url": "https://github.com/apinski-cavium", "followers_url": "https://api.github.com/users/apinski-cavium/followers", "following_url": "https://api.github.com/users/apinski-cavium/following{/other_user}", "gists_url": "https://api.github.com/users/apinski-cavium/gists{/gist_id}", "starred_url": "https://api.github.com/users/apinski-cavium/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apinski-cavium/subscriptions", "organizations_url": "https://api.github.com/users/apinski-cavium/orgs", "repos_url": "https://api.github.com/users/apinski-cavium/repos", "events_url": "https://api.github.com/users/apinski-cavium/events{/privacy}", "received_events_url": "https://api.github.com/users/apinski-cavium/received_events", "type": "User", "site_admin": false}, "committer": {"login": "apinski-cavium", "id": 6335315, "node_id": "MDQ6VXNlcjYzMzUzMTU=", "avatar_url": "https://avatars.githubusercontent.com/u/6335315?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apinski-cavium", "html_url": "https://github.com/apinski-cavium", "followers_url": "https://api.github.com/users/apinski-cavium/followers", "following_url": "https://api.github.com/users/apinski-cavium/following{/other_user}", "gists_url": "https://api.github.com/users/apinski-cavium/gists{/gist_id}", "starred_url": "https://api.github.com/users/apinski-cavium/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apinski-cavium/subscriptions", "organizations_url": "https://api.github.com/users/apinski-cavium/orgs", "repos_url": "https://api.github.com/users/apinski-cavium/repos", "events_url": "https://api.github.com/users/apinski-cavium/events{/privacy}", "received_events_url": "https://api.github.com/users/apinski-cavium/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "183db4fb73a64bc4641604c30cdbbd9d9e8a6ed6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/183db4fb73a64bc4641604c30cdbbd9d9e8a6ed6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/183db4fb73a64bc4641604c30cdbbd9d9e8a6ed6"}], "stats": {"total": 24, "additions": 24, "deletions": 0}, "files": [{"sha": "02415cb1b5c3a0b9001fd6571a525cfc813ba6a4", "filename": "gcc/gimplify.cc", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b03ad138a61f64d8a77876d6864aad5103fff498/gcc%2Fgimplify.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b03ad138a61f64d8a77876d6864aad5103fff498/gcc%2Fgimplify.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimplify.cc?ref=b03ad138a61f64d8a77876d6864aad5103fff498", "patch": "@@ -6054,6 +6054,9 @@ gimplify_modify_expr (tree *expr_p, gimple_seq *pre_p, gimple_seq *post_p,\n   location_t loc = EXPR_LOCATION (*expr_p);\n   gimple_stmt_iterator gsi;\n \n+  if (error_operand_p (*from_p) || error_operand_p (*to_p))\n+    return GS_ERROR;\n+\n   gcc_assert (TREE_CODE (*expr_p) == MODIFY_EXPR\n \t      || TREE_CODE (*expr_p) == INIT_EXPR);\n "}, {"sha": "425721df2ff4703285d325c4397003653b54ddf9", "filename": "gcc/testsuite/gcc.dg/redecl-23.c", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b03ad138a61f64d8a77876d6864aad5103fff498/gcc%2Ftestsuite%2Fgcc.dg%2Fredecl-23.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b03ad138a61f64d8a77876d6864aad5103fff498/gcc%2Ftestsuite%2Fgcc.dg%2Fredecl-23.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fredecl-23.c?ref=b03ad138a61f64d8a77876d6864aad5103fff498", "patch": "@@ -0,0 +1,6 @@\n+/* We used to ICE in the gimplifier, PR 106560. */\n+/* { dg-do compile } */\n+/* { dg-options \"-w\" } */\n+void **a; /* { dg-note \"\" } */\n+void b() { void **c = a; }\n+a; /* { dg-error \"\" } */"}, {"sha": "f0f7a723ab81674d6390e31a8c056091a1144e05", "filename": "gcc/testsuite/gcc.dg/redecl-24.c", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b03ad138a61f64d8a77876d6864aad5103fff498/gcc%2Ftestsuite%2Fgcc.dg%2Fredecl-24.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b03ad138a61f64d8a77876d6864aad5103fff498/gcc%2Ftestsuite%2Fgcc.dg%2Fredecl-24.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fredecl-24.c?ref=b03ad138a61f64d8a77876d6864aad5103fff498", "patch": "@@ -0,0 +1,6 @@\n+/* We used to ICE in the gimplifier, PR 106560 */\n+/* { dg-do compile } */\n+/* { dg-options \"-w\" } */\n+void **a, **b; /* { dg-note \"\" } */\n+c(){b = a;}  \n+a = /* { dg-error \"\" } */"}, {"sha": "4232e19d9a7cbabee663a97cacd27e646e35cf07", "filename": "gcc/testsuite/gcc.dg/redecl-25.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b03ad138a61f64d8a77876d6864aad5103fff498/gcc%2Ftestsuite%2Fgcc.dg%2Fredecl-25.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b03ad138a61f64d8a77876d6864aad5103fff498/gcc%2Ftestsuite%2Fgcc.dg%2Fredecl-25.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fredecl-25.c?ref=b03ad138a61f64d8a77876d6864aad5103fff498", "patch": "@@ -0,0 +1,9 @@\n+/* We used to ICE in the gimplifier, PR 106560 */\n+/* { dg-do compile } */\n+/* { dg-options \"-w\" } */\n+void **a; /* { dg-note \"\" } */\n+void b() {\n+  void **c; \n+    c = a /* { dg-error \"\" } */\n+}\n+a; /* { dg-error \"\" } */"}]}