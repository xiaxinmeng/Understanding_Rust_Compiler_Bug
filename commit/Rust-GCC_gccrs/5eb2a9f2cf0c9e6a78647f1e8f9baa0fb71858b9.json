{"sha": "5eb2a9f2cf0c9e6a78647f1e8f9baa0fb71858b9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWViMmE5ZjJjZjBjOWU2YTc4NjQ3ZjFlOGY5YmFhMGZiNzE4NThiOQ==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard@codesourcery.com", "date": "2007-08-02T10:25:24Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2007-08-02T10:25:24Z"}, "message": "emit-rtl.c (reset_used_decls): Rename to...\n\ngcc/\n\t* emit-rtl.c (reset_used_decls): Rename to...\n\t(set_used_decls): ...this.  Set the used flag rather than clearing it.\n\t(unshare_all_rtl_again): Update accordingly.  Set flags on argument\n\tDECL_RTLs rather than resetting them.\n\nFrom-SVN: r127153", "tree": {"sha": "05f51c09c852995eee508fef5bd9b68fa5eb609c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/05f51c09c852995eee508fef5bd9b68fa5eb609c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5eb2a9f2cf0c9e6a78647f1e8f9baa0fb71858b9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5eb2a9f2cf0c9e6a78647f1e8f9baa0fb71858b9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5eb2a9f2cf0c9e6a78647f1e8f9baa0fb71858b9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5eb2a9f2cf0c9e6a78647f1e8f9baa0fb71858b9/comments", "author": null, "committer": null, "parents": [{"sha": "a15da80d336a43788411f1da71059303d77f9a6d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a15da80d336a43788411f1da71059303d77f9a6d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a15da80d336a43788411f1da71059303d77f9a6d"}], "stats": {"total": 29, "additions": 22, "deletions": 7}, "files": [{"sha": "3f67eb9356d3924ac326481bd81e01b5a7c3e902", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5eb2a9f2cf0c9e6a78647f1e8f9baa0fb71858b9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5eb2a9f2cf0c9e6a78647f1e8f9baa0fb71858b9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5eb2a9f2cf0c9e6a78647f1e8f9baa0fb71858b9", "patch": "@@ -1,3 +1,10 @@\n+2007-08-02  Richard Sandiford  <richard@codesourcery.com>\n+\n+\t* emit-rtl.c (reset_used_decls): Rename to...\n+\t(set_used_decls): ...this.  Set the used flag rather than clearing it.\n+\t(unshare_all_rtl_again): Update accordingly.  Set flags on argument\n+\tDECL_RTLs rather than resetting them.\n+\n 2007-08-02  Andreas Krebbel  <krebbel1@de.ibm.com>\n \n \t* config/s390/s390.md (\"*xordi3_cconly\"): Change xr to xg."}, {"sha": "020847afdce32c33e54c1a8b72393b4c5ae03f3d", "filename": "gcc/emit-rtl.c", "status": "modified", "additions": 15, "deletions": 7, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5eb2a9f2cf0c9e6a78647f1e8f9baa0fb71858b9/gcc%2Femit-rtl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5eb2a9f2cf0c9e6a78647f1e8f9baa0fb71858b9/gcc%2Femit-rtl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Femit-rtl.c?ref=5eb2a9f2cf0c9e6a78647f1e8f9baa0fb71858b9", "patch": "@@ -167,7 +167,7 @@ static GTY ((if_marked (\"ggc_marked_p\"), param_is (struct rtx_def)))\n \n static rtx make_call_insn_raw (rtx);\n static rtx change_address_1 (rtx, enum machine_mode, rtx, int);\n-static void reset_used_decls (tree);\n+static void set_used_decls (tree);\n static void mark_label_nuses (rtx);\n static hashval_t const_int_htab_hash (const void *);\n static int const_int_htab_eq (const void *, const void *);\n@@ -2160,11 +2160,11 @@ unshare_all_rtl_again (rtx insn)\n       }\n \n   /* Make sure that virtual stack slots are not shared.  */\n-  reset_used_decls (DECL_INITIAL (cfun->decl));\n+  set_used_decls (DECL_INITIAL (cfun->decl));\n \n   /* Make sure that virtual parameters are not shared.  */\n   for (decl = DECL_ARGUMENTS (cfun->decl); decl; decl = TREE_CHAIN (decl))\n-    reset_used_flags (DECL_RTL (decl));\n+    set_used_flags (DECL_RTL (decl));\n \n   reset_used_flags (stack_slot_list);\n \n@@ -2353,20 +2353,28 @@ unshare_all_rtl_in_chain (rtx insn)\n }\n \n /* Go through all virtual stack slots of a function and mark them as\n-   not shared.  */\n+   shared.  We never replace the DECL_RTLs themselves with a copy,\n+   but expressions mentioned into a DECL_RTL cannot be shared with\n+   expressions in the instruction stream.\n+\n+   Note that reload may convert pseudo registers into memories in-place.\n+   Pseudo registers are always shared, but MEMs never are.  Thus if we\n+   reset the used flags on MEMs in the instruction stream, we must set\n+   them again on MEMs that appear in DECL_RTLs.  */\n+\n static void\n-reset_used_decls (tree blk)\n+set_used_decls (tree blk)\n {\n   tree t;\n \n   /* Mark decls.  */\n   for (t = BLOCK_VARS (blk); t; t = TREE_CHAIN (t))\n     if (DECL_RTL_SET_P (t))\n-      reset_used_flags (DECL_RTL (t));\n+      set_used_flags (DECL_RTL (t));\n \n   /* Now process sub-blocks.  */\n   for (t = BLOCK_SUBBLOCKS (blk); t; t = TREE_CHAIN (t))\n-    reset_used_decls (t);\n+    set_used_decls (t);\n }\n \n /* Mark ORIG as in use, and return a copy of it if it was already in use."}]}