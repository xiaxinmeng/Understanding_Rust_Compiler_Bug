{"sha": "af4133b2b7245c826bcf91206242c9fe0f17ab5b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWY0MTMzYjJiNzI0NWM4MjZiY2Y5MTIwNjI0MmM5ZmUwZjE3YWI1Yg==", "commit": {"author": {"name": "Samuel Tardieu", "email": "sam@gcc.gnu.org", "date": "2008-04-29T21:43:39Z"}, "committer": {"name": "Samuel Tardieu", "email": "sam@gcc.gnu.org", "date": "2008-04-29T21:43:39Z"}, "message": "[multiple changes]\n\n2008-04-29  Ed Schonberg  <schonberg@adacore.com>\n\n    gcc/ada/\n\tPR ada/35792\n\t* sem_ch3.adb (Find_Type_Name): Refuse completion of an incomplete\n\ttagged type by an untagged protected or task type.\n\n2008-04-29  Samuel Tardieu  <sam@rfc1149.net>\n\n    gcc/testsuite/\n\tPR ada/35792\n\t* gnat.dg/specs/tag2.ads: New.\n\nFrom-SVN: r134810", "tree": {"sha": "21cd54ec877bb1fc1dee9d607f5bb03dfa8908fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/21cd54ec877bb1fc1dee9d607f5bb03dfa8908fd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/af4133b2b7245c826bcf91206242c9fe0f17ab5b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af4133b2b7245c826bcf91206242c9fe0f17ab5b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/af4133b2b7245c826bcf91206242c9fe0f17ab5b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af4133b2b7245c826bcf91206242c9fe0f17ab5b/comments", "author": null, "committer": null, "parents": [{"sha": "cf2758e3d4b726640ddc27628506700ffa623009", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf2758e3d4b726640ddc27628506700ffa623009", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cf2758e3d4b726640ddc27628506700ffa623009"}], "stats": {"total": 51, "additions": 46, "deletions": 5}, "files": [{"sha": "f46c7b825f5762f027832c8f270296ad7a8dad9c", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af4133b2b7245c826bcf91206242c9fe0f17ab5b/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af4133b2b7245c826bcf91206242c9fe0f17ab5b/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=af4133b2b7245c826bcf91206242c9fe0f17ab5b", "patch": "@@ -1,3 +1,9 @@\n+2008-04-29  Ed Schonberg  <schonberg@adacore.com>\n+\n+\tPR ada/35792\n+\t* sem_ch3.adb (Find_Type_Name): Refuse completion of an incomplete\n+\ttagged type by an untagged protected or task type.\n+\n 2008-04-28  Eric Botcazou  <ebotcazou@adacore.com>\n             Tristan Gingold  <gingold@adacore.com>\n "}, {"sha": "d050d1b0505ba33166e75b060f8d43b18f31f5c7", "filename": "gcc/ada/sem_ch3.adb", "status": "modified", "additions": 18, "deletions": 5, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af4133b2b7245c826bcf91206242c9fe0f17ab5b/gcc%2Fada%2Fsem_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af4133b2b7245c826bcf91206242c9fe0f17ab5b/gcc%2Fada%2Fsem_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch3.adb?ref=af4133b2b7245c826bcf91206242c9fe0f17ab5b", "patch": "@@ -13046,13 +13046,26 @@ package body Sem_Ch3 is\n          if Is_Type (Prev)\n            and then (Is_Tagged_Type (Prev)\n                       or else Present (Class_Wide_Type (Prev)))\n-           and then not Nkind_In (N, N_Task_Type_Declaration,\n-                                     N_Protected_Type_Declaration)\n          then\n-            --  The full declaration is either a tagged record or an\n-            --  extension otherwise this is an error\n+            --  The full declaration is either a tagged type (including\n+            --  a synchronized type that implements interfaces) or a\n+            --  type extension, otherwise this is an error.\n+\n+            if Nkind_In (N, N_Task_Type_Declaration,\n+                         N_Protected_Type_Declaration)\n+            then\n+               if No (Interface_List (N))\n+                 and then not Error_Posted (N)\n+               then\n+                  Error_Msg_NE\n+                    (\"full declaration of } must be a tagged type \", Id, Prev);\n+               end if;\n+\n+            elsif Nkind (Type_Definition (N)) = N_Record_Definition then\n+\n+               --  Indicate that the previous declaration (tagged incomplete\n+               --  or private declaration) requires the same on the full one.\n \n-            if Nkind (Type_Definition (N)) = N_Record_Definition then\n                if not Tagged_Present (Type_Definition (N)) then\n                   Error_Msg_NE\n                     (\"full declaration of } must be tagged\", Prev, Id);"}, {"sha": "9e0aef64c98abff952936662080b1d49bceffc79", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af4133b2b7245c826bcf91206242c9fe0f17ab5b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af4133b2b7245c826bcf91206242c9fe0f17ab5b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=af4133b2b7245c826bcf91206242c9fe0f17ab5b", "patch": "@@ -1,3 +1,8 @@\n+2008-04-29  Samuel Tardieu  <sam@rfc1149.net>\n+\n+\tPR ada/35792\n+\t* gnat.dg/specs/tag2.ads: New.\n+\n 2008-04-29  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/36078"}, {"sha": "8e09f25a0594443466133dd1d5b7c62abf7ab236", "filename": "gcc/testsuite/gnat.dg/specs/tag2.ads", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af4133b2b7245c826bcf91206242c9fe0f17ab5b/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Ftag2.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af4133b2b7245c826bcf91206242c9fe0f17ab5b/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Ftag2.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Ftag2.ads?ref=af4133b2b7245c826bcf91206242c9fe0f17ab5b", "patch": "@@ -0,0 +1,17 @@\n+-- { dg-do compile }\n+\n+package tag2 is\n+   type I is synchronized interface;\n+   type T1 is tagged;\n+   type T2 is tagged;\n+   type T3 is tagged;\n+   type T4 is tagged;\n+   type T5 is tagged;\n+   type T6 is tagged;\n+   protected type T1 is end T1; -- { dg-error \"must be a tagged type\" }\n+   task type T2;                -- { dg-error \"must be a tagged type\" }\n+   type T3 is null record;      -- { dg-error \"must be tagged\" }\n+   task type T4 is new I with end;\n+   protected type T5 is new I with end;\n+   type T6 is tagged null record;\n+end tag2;"}]}