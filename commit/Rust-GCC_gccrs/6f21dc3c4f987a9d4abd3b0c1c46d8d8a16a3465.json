{"sha": "6f21dc3c4f987a9d4abd3b0c1c46d8d8a16a3465", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmYyMWRjM2M0Zjk4N2E5ZDRhYmQzYjBjMWM0NmQ4ZDhhMTZhMzQ2NQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-03-20T21:07:13Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-03-20T21:07:13Z"}, "message": "re PR debug/84875 (ICE in maybe_record_trace_start, at dwarf2cfi.c:2348 on s390x)\n\n\tPR debug/84875\n\t* dce.c (delete_unmarked_insns): Don't remove frame related noop moves\n\tholding REG_CFA_RESTORE notes, instead turn them into a USE.\n\n\t* gcc.dg/pr84875.c: New test.\n\nFrom-SVN: r258692", "tree": {"sha": "468156d990c6bc0e8476053962782e524467b5c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/468156d990c6bc0e8476053962782e524467b5c4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6f21dc3c4f987a9d4abd3b0c1c46d8d8a16a3465", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f21dc3c4f987a9d4abd3b0c1c46d8d8a16a3465", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6f21dc3c4f987a9d4abd3b0c1c46d8d8a16a3465", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f21dc3c4f987a9d4abd3b0c1c46d8d8a16a3465/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1efb1dc2d893db2fa8f15945d506410aab628b60", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1efb1dc2d893db2fa8f15945d506410aab628b60", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1efb1dc2d893db2fa8f15945d506410aab628b60"}], "stats": {"total": 66, "additions": 63, "deletions": 3}, "files": [{"sha": "f604631205c9330a973a91fc47e091610e0b4e5d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6f21dc3c4f987a9d4abd3b0c1c46d8d8a16a3465/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6f21dc3c4f987a9d4abd3b0c1c46d8d8a16a3465/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6f21dc3c4f987a9d4abd3b0c1c46d8d8a16a3465", "patch": "@@ -1,3 +1,9 @@\n+2018-03-20  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/84875\n+\t* dce.c (delete_unmarked_insns): Don't remove frame related noop moves\n+\tholding REG_CFA_RESTORE notes, instead turn them into a USE.\n+\n 2018-03-20  Peter Bergner  <bergner@vnet.ibm.com>\n \n \tPR target/83789"}, {"sha": "e4d442c62b59c2dc74b0dbd99ac474607e714316", "filename": "gcc/dce.c", "status": "modified", "additions": 24, "deletions": 3, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6f21dc3c4f987a9d4abd3b0c1c46d8d8a16a3465/gcc%2Fdce.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6f21dc3c4f987a9d4abd3b0c1c46d8d8a16a3465/gcc%2Fdce.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdce.c?ref=6f21dc3c4f987a9d4abd3b0c1c46d8d8a16a3465", "patch": "@@ -569,9 +569,19 @@ delete_unmarked_insns (void)\n     FOR_BB_INSNS_REVERSE_SAFE (bb, insn, next)\n       if (NONDEBUG_INSN_P (insn))\n \t{\n+\t  rtx turn_into_use = NULL_RTX;\n+\n \t  /* Always delete no-op moves.  */\n \t  if (noop_move_p (insn))\n-\t    ;\n+\t    {\n+\t      if (RTX_FRAME_RELATED_P (insn))\n+\t\tturn_into_use\n+\t\t  = find_reg_note (insn, REG_CFA_RESTORE, NULL);\n+\t      if (turn_into_use && REG_P (XEXP (turn_into_use, 0)))\n+\t\tturn_into_use = XEXP (turn_into_use, 0);\n+\t      else\n+\t\tturn_into_use = NULL_RTX;\n+\t    }\n \n \t  /* Otherwise rely only on the DCE algorithm.  */\n \t  else if (marked_insn_p (insn))\n@@ -611,8 +621,19 @@ delete_unmarked_insns (void)\n \t  if (CALL_P (insn))\n \t    must_clean = true;\n \n-\t  /* Now delete the insn.  */\n-\t  delete_insn_and_edges (insn);\n+\t  if (turn_into_use)\n+\t    {\n+\t      /* Don't remove frame related noop moves if they cary\n+\t\t REG_CFA_RESTORE note, while we don't need to emit any code,\n+\t\t we need it to emit the CFI restore note.  */\n+\t      PATTERN (insn)\n+\t\t= gen_rtx_USE (GET_MODE (turn_into_use), turn_into_use);\n+\t      INSN_CODE (insn) = -1;\n+\t      df_insn_rescan (insn);\n+\t    }\n+\t  else\n+\t    /* Now delete the insn.  */\n+\t    delete_insn_and_edges (insn);\n \t}\n \n   /* Deleted a pure or const call.  */"}, {"sha": "79cc52cb3e71f1af94a87a535cb8a7f070e93cc6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6f21dc3c4f987a9d4abd3b0c1c46d8d8a16a3465/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6f21dc3c4f987a9d4abd3b0c1c46d8d8a16a3465/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6f21dc3c4f987a9d4abd3b0c1c46d8d8a16a3465", "patch": "@@ -1,3 +1,8 @@\n+2018-03-20  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/84875\n+\t* gcc.dg/pr84875.c: New test.\n+\n 2018-03-20  Marek Polacek  <polacek@redhat.com>\n \n \tPR c++/84978, ICE with NRVO."}, {"sha": "257176de205c94443d033cb2e9c81810614a0780", "filename": "gcc/testsuite/gcc.dg/pr84875.c", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6f21dc3c4f987a9d4abd3b0c1c46d8d8a16a3465/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84875.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6f21dc3c4f987a9d4abd3b0c1c46d8d8a16a3465/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84875.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84875.c?ref=6f21dc3c4f987a9d4abd3b0c1c46d8d8a16a3465", "patch": "@@ -0,0 +1,28 @@\n+/* PR debug/84875 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Os\" } */\n+/* { dg-additional-options \"-fpie\" { target pie } } */\n+/* { dg-additional-options \"-march=z196\" { target s390*-*-* } } */\n+\n+static long *a[100];\n+static int b[100];\n+long *c;\n+int d;\n+void foo (long *);\n+\n+void\n+bar ()\n+{\n+  long *g = c;\n+  g--;\n+  d = *g;\n+  if (d)\n+    if (b[d] < 8)\n+      {\n+\t*(void **)g = a[d];\n+\ta[d] = g;\n+\tb[d]++;\n+\treturn;\n+      }\n+  foo (g);\n+}"}]}