{"sha": "1fb32d7293b8a1849e23502fd58afa46d670ec94", "node_id": "C_kwDOANBUbNoAKDFmYjMyZDcyOTNiOGExODQ5ZTIzNTAyZmQ1OGFmYTQ2ZDY3MGVjOTQ", "commit": {"author": {"name": "Pierre-Emmanuel Patry", "email": "pierre-emmanuel.patry@embecosm.com", "date": "2023-04-18T15:26:07Z"}, "committer": {"name": "CohenArthur", "email": "arthur.cohen@embecosm.com", "date": "2023-04-28T16:26:38Z"}, "message": "cli: Add frust-extern option\n\nAdd a new option to gather extern crates location.\n\ngcc/rust/ChangeLog:\n\n\t* lang.opt: Add frust-extern option.\n\t* rust-session-manager.cc (Session::handle_extern_option): Add\n\tfrust-extern option handler.\n\t* rust-session-manager.h (struct Session): Add an unordered map\n\tto store library name and locations.\n\nSigned-off-by: Pierre-Emmanuel Patry <pierre-emmanuel.patry@embecosm.com>", "tree": {"sha": "e1709f62311c8570dd61224e61245279150965ff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e1709f62311c8570dd61224e61245279150965ff"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1fb32d7293b8a1849e23502fd58afa46d670ec94", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1fb32d7293b8a1849e23502fd58afa46d670ec94", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1fb32d7293b8a1849e23502fd58afa46d670ec94", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1fb32d7293b8a1849e23502fd58afa46d670ec94/comments", "author": {"login": "P-E-P", "id": 32375388, "node_id": "MDQ6VXNlcjMyMzc1Mzg4", "avatar_url": "https://avatars.githubusercontent.com/u/32375388?v=4", "gravatar_id": "", "url": "https://api.github.com/users/P-E-P", "html_url": "https://github.com/P-E-P", "followers_url": "https://api.github.com/users/P-E-P/followers", "following_url": "https://api.github.com/users/P-E-P/following{/other_user}", "gists_url": "https://api.github.com/users/P-E-P/gists{/gist_id}", "starred_url": "https://api.github.com/users/P-E-P/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/P-E-P/subscriptions", "organizations_url": "https://api.github.com/users/P-E-P/orgs", "repos_url": "https://api.github.com/users/P-E-P/repos", "events_url": "https://api.github.com/users/P-E-P/events{/privacy}", "received_events_url": "https://api.github.com/users/P-E-P/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fef6c560017c33a4d5e439067bad09a85630f851", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fef6c560017c33a4d5e439067bad09a85630f851", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fef6c560017c33a4d5e439067bad09a85630f851"}], "stats": {"total": 26, "additions": 26, "deletions": 0}, "files": [{"sha": "537b93fa5459e11054812b047d6c86751d3cf26c", "filename": "gcc/rust/lang.opt", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fb32d7293b8a1849e23502fd58afa46d670ec94/gcc%2Frust%2Flang.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fb32d7293b8a1849e23502fd58afa46d670ec94/gcc%2Frust%2Flang.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Flang.opt?ref=1fb32d7293b8a1849e23502fd58afa46d670ec94", "patch": "@@ -62,6 +62,10 @@ frust-crate=\n Rust Joined RejectNegative\n -frust-crate=<name>             Set the crate name for the compilation\n \n+frust-extern=\n+Rust RejectNegative Joined\n+-frust-extern=              Specify where an external library is located\n+\n frust-debug\n Rust Var(flag_rust_debug)\n Dump various Rust front end internals."}, {"sha": "5d1326e5aca139ee0d6398b5eb1eeb3974568dbc", "filename": "gcc/rust/rust-session-manager.cc", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fb32d7293b8a1849e23502fd58afa46d670ec94/gcc%2Frust%2Frust-session-manager.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fb32d7293b8a1849e23502fd58afa46d670ec94/gcc%2Frust%2Frust-session-manager.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Frust-session-manager.cc?ref=1fb32d7293b8a1849e23502fd58afa46d670ec94", "patch": "@@ -190,6 +190,11 @@ Session::handle_option (\n       }\n       break;\n \n+      case OPT_frust_extern_: {\n+\tstd::string input (arg);\n+\tret = handle_extern_option (input);\n+      }\n+      break;\n     case OPT_frust_crate_:\n       // set the crate name\n       if (arg != nullptr)\n@@ -249,6 +254,20 @@ Session::handle_option (\n   return ret;\n }\n \n+bool\n+Session::handle_extern_option (std::string &input)\n+{\n+  auto pos = input.find ('=');\n+  if (std::string::npos == pos)\n+    return false;\n+\n+  std::string libname = input.substr (0, pos);\n+  std::string path = input.substr (pos + 1);\n+\n+  extern_crates.insert ({libname, path});\n+  return true;\n+}\n+\n bool\n Session::handle_cfg_option (std::string &input)\n {"}, {"sha": "85d4d43e1b9e92bd537ea25ae4a9a26911d4fe33", "filename": "gcc/rust/rust-session-manager.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fb32d7293b8a1849e23502fd58afa46d670ec94/gcc%2Frust%2Frust-session-manager.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fb32d7293b8a1849e23502fd58afa46d670ec94/gcc%2Frust%2Frust-session-manager.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Frust-session-manager.h?ref=1fb32d7293b8a1849e23502fd58afa46d670ec94", "patch": "@@ -288,6 +288,7 @@ struct Session\n   /* This should really be in a per-crate storage area but it is wiped with\n    * every file so eh. */\n   std::string injected_crate_name;\n+  std::map<std::string, std::string> extern_crates;\n \n   /* extra files get included during late stages of compilation (e.g. macro\n    * expansion) */\n@@ -366,6 +367,8 @@ struct Session\n \n   // handle cfg_option\n   bool handle_cfg_option (std::string &data);\n+\n+  bool handle_extern_option (std::string &data);\n };\n \n } // namespace Rust"}]}