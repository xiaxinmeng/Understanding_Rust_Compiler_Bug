{"sha": "04dfc6df2e1cc1b2534f8160a58d8c9e2c3f18f6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDRkZmM2ZGYyZTFjYzFiMjUzNGY4MTYwYTU4ZDhjOWUyYzNmMThmNg==", "commit": {"author": {"name": "J\u00fcrgen Urban", "email": "JuergenUrban@gmx.de", "date": "2013-07-22T18:48:32Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2013-07-22T18:48:32Z"}, "message": "config.gcc (mips*-*-*): Add --with-fpu support.\n\ngcc/\n2013-07-26  J\u00fcrgen Urban  <JuergenUrban@gmx.de>\n\n\t* config.gcc (mips*-*-*): Add --with-fpu support.  Make single the\n\tdefault for R5900 targets.\n\t* config/mips/mips.h (OPTION_DEFAULT_SPECS): Handle --with-fpu.\n\t(ISA_HAS_LDC1_SDC1): Set to false for TARGET_MIPS5900.\n\t* config/mips/mips.c (mips_option_override): Report an error for\n\t-march=r5900 -mhard-float -mdouble-float.  Use spu_single_format\n\tfor -march=r5900 -mhard-float.\n\nFrom-SVN: r201143", "tree": {"sha": "887fe9a17b4b2dac2e4736cf69d07484405e5cd1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/887fe9a17b4b2dac2e4736cf69d07484405e5cd1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/04dfc6df2e1cc1b2534f8160a58d8c9e2c3f18f6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04dfc6df2e1cc1b2534f8160a58d8c9e2c3f18f6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/04dfc6df2e1cc1b2534f8160a58d8c9e2c3f18f6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04dfc6df2e1cc1b2534f8160a58d8c9e2c3f18f6/comments", "author": {"login": "jur", "id": 1646215, "node_id": "MDQ6VXNlcjE2NDYyMTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1646215?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jur", "html_url": "https://github.com/jur", "followers_url": "https://api.github.com/users/jur/followers", "following_url": "https://api.github.com/users/jur/following{/other_user}", "gists_url": "https://api.github.com/users/jur/gists{/gist_id}", "starred_url": "https://api.github.com/users/jur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jur/subscriptions", "organizations_url": "https://api.github.com/users/jur/orgs", "repos_url": "https://api.github.com/users/jur/repos", "events_url": "https://api.github.com/users/jur/events{/privacy}", "received_events_url": "https://api.github.com/users/jur/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5656d96ecc468139423ce8a5ad846a38cbbeebbe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5656d96ecc468139423ce8a5ad846a38cbbeebbe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5656d96ecc468139423ce8a5ad846a38cbbeebbe"}], "stats": {"total": 45, "additions": 43, "deletions": 2}, "files": [{"sha": "efc9ac7e51de34a1182986aa90384026c7abefbe", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04dfc6df2e1cc1b2534f8160a58d8c9e2c3f18f6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04dfc6df2e1cc1b2534f8160a58d8c9e2c3f18f6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=04dfc6df2e1cc1b2534f8160a58d8c9e2c3f18f6", "patch": "@@ -1,3 +1,13 @@\n+2013-07-22  J\u00fcrgen Urban  <JuergenUrban@gmx.de>\n+\n+\t* config.gcc (mips*-*-*): Add --with-fpu support.  Make single the\n+\tdefault for R5900 targets.\n+\t* config/mips/mips.h (OPTION_DEFAULT_SPECS): Handle --with-fpu.\n+\t(ISA_HAS_LDC1_SDC1): Set to false for TARGET_MIPS5900.\n+\t* config/mips/mips.c (mips_option_override): Report an error for\n+\t-march=r5900 -mhard-float -mdouble-float.  Use spu_single_format\n+\tfor -march=r5900 -mhard-float.\n+\n 2013-07-22  Chang  <pchang9@cs.wisc.edu>\n \n \t* df-problems.c (can_move_insns_across): Exit loop once we"}, {"sha": "1a398a7232fc9b4d78c5889b38a9071a591fcc5a", "filename": "gcc/config.gcc", "status": "modified", "additions": 21, "deletions": 1, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04dfc6df2e1cc1b2534f8160a58d8c9e2c3f18f6/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04dfc6df2e1cc1b2534f8160a58d8c9e2c3f18f6/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=04dfc6df2e1cc1b2534f8160a58d8c9e2c3f18f6", "patch": "@@ -3091,6 +3091,16 @@ if test x$with_float = x; then\n   esac\n fi\n \n+# Infer a default setting for --with-fpu.\n+if test x$with_fpu = x; then\n+  case ${target} in\n+    mips64r5900-*-* | mips64r5900el-*-* | mipsr5900-*-* | mipsr5900el-*-*)\n+      # The R5900 FPU only supports single precision.\n+      with_fpu=single\n+      ;;\n+  esac\n+fi\n+\n # Support --with-fpmath.\n if test x$with_fpmath != x; then\n   case ${target} in\n@@ -3469,7 +3479,7 @@ case \"${target}\" in\n \t\t;;\n \n \tmips*-*-*)\n-\t\tsupported_defaults=\"abi arch arch_32 arch_64 float tune tune_32 tune_64 divide llsc mips-plt synci\"\n+\t\tsupported_defaults=\"abi arch arch_32 arch_64 float fpu tune tune_32 tune_64 divide llsc mips-plt synci\"\n \n \t\tcase ${with_float} in\n \t\t\"\" | soft | hard)\n@@ -3481,6 +3491,16 @@ case \"${target}\" in\n \t\t\t;;\n \t\tesac\n \n+\t\tcase ${with_fpu} in\n+\t\t\"\" | single | double)\n+\t\t\t# OK\n+\t\t\t;;\n+\t\t*)\n+\t\t\techo \"Unknown fpu type used in --with-fpu=$with_fpu\" 1>&2\n+\t\t\texit 1\n+\t\t\t;;\n+\t\tesac\n+\n \t\tcase ${with_abi} in\n \t\t\"\" | 32 | o64 | n32 | 64 | eabi)\n \t\t\t# OK"}, {"sha": "a3735dc598d4c1d99203ed972f0cfc9a0c8b7eb6", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04dfc6df2e1cc1b2534f8160a58d8c9e2c3f18f6/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04dfc6df2e1cc1b2534f8160a58d8c9e2c3f18f6/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=04dfc6df2e1cc1b2534f8160a58d8c9e2c3f18f6", "patch": "@@ -16832,6 +16832,11 @@ mips_option_override (void)\n \n   /* End of code shared with GAS.  */\n \n+  /* The R5900 FPU only supports single precision.  */\n+  if (TARGET_MIPS5900 && TARGET_HARD_FLOAT_ABI && TARGET_DOUBLE_FLOAT)\n+    error (\"unsupported combination: %s\",\n+\t   \"-march=r5900 -mhard-float -mdouble-float\");\n+\n   /* If a -mlong* option was given, check that it matches the ABI,\n      otherwise infer the -mlong* setting from the other options.  */\n   if ((target_flags_explicit & MASK_LONG64) != 0)\n@@ -17139,6 +17144,9 @@ mips_option_override (void)\n      filling.  Registering the pass must be done at start up.  It's\n      convenient to do it here.  */\n   register_pass (&insert_pass_mips_machine_reorg2);\n+\n+  if (TARGET_HARD_FLOAT_ABI && TARGET_MIPS5900)\n+    REAL_MODE_FORMAT (SFmode) = &spu_single_format;\n }\n \n /* Swap the register information for registers I and I + 1, which"}, {"sha": "2dcccd48b8fd42f4f59c21fffac0c9322bc05065", "filename": "gcc/config/mips/mips.h", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04dfc6df2e1cc1b2534f8160a58d8c9e2c3f18f6/gcc%2Fconfig%2Fmips%2Fmips.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04dfc6df2e1cc1b2534f8160a58d8c9e2c3f18f6/gcc%2Fconfig%2Fmips%2Fmips.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.h?ref=04dfc6df2e1cc1b2534f8160a58d8c9e2c3f18f6", "patch": "@@ -754,6 +754,7 @@ struct mips_cpu_info {\n   {\"tune_64\", \"%{\" OPT_ARCH64 \":%{!mtune=*:-mtune=%(VALUE)}}\" }, \\\n   {\"abi\", \"%{!mabi=*:-mabi=%(VALUE)}\" }, \\\n   {\"float\", \"%{!msoft-float:%{!mhard-float:-m%(VALUE)-float}}\" }, \\\n+  {\"fpu\", \"%{!msingle-float:%{!mdouble-float:-m%(VALUE)-float}}\" }, \\\n   {\"divide\", \"%{!mdivide-traps:%{!mdivide-breaks:-mdivide-%(VALUE)}}\" }, \\\n   {\"llsc\", \"%{!mllsc:%{!mno-llsc:-m%(VALUE)}}\" }, \\\n   {\"mips-plt\", \"%{!mplt:%{!mno-plt:-m%(VALUE)}}\" }, \\\n@@ -859,7 +860,9 @@ struct mips_cpu_info {\n \t\t\t\t || TARGET_LOONGSON_2EF)\n \n /* ISA has LDC1 and SDC1.  */\n-#define ISA_HAS_LDC1_SDC1\t(!ISA_MIPS1 && !TARGET_MIPS16)\n+#define ISA_HAS_LDC1_SDC1\t(!ISA_MIPS1\t\t\t\t\\\n+\t\t\t\t && !TARGET_MIPS5900\t\t\t\\\n+\t\t\t\t && !TARGET_MIPS16)\n \n /* ISA has the mips4 FP condition code instructions: FP-compare to CC,\n    branch on CC, and move (both FP and non-FP) on CC.  */"}]}