{"sha": "603107fbb0da3acb1ce296dfef1a592a6451c0b4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjAzMTA3ZmJiMGRhM2FjYjFjZTI5NmRmZWYxYTU5MmE2NDUxYzBiNA==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2016-06-30T14:28:50Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2016-06-30T14:28:50Z"}, "message": "Fix bogus option suggestions for RejectNegative options (PR driver/71651)\n\ngcc/ChangeLog:\n\tPR driver/71651\n\t* gcc.c (driver::build_option_suggestions): Pass \"option\" to\n\tadd_misspelling_candidates.\n\t* opts-common.c (add_misspelling_candidates): Add \"option\" param;\n\tuse it to avoid adding negated forms for options marked with\n\tRejectNegative.\n\t* opts.h (add_misspelling_candidates): Add \"option\" param.\n\ngcc/testsuite/ChangeLog:\n\tPR driver/71651\n\t* gcc.dg/spellcheck-options-12.c: New test case.\n\nFrom-SVN: r237880", "tree": {"sha": "40d1bc99d4ff173785ae8b7f061698acb8a05f26", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/40d1bc99d4ff173785ae8b7f061698acb8a05f26"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/603107fbb0da3acb1ce296dfef1a592a6451c0b4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/603107fbb0da3acb1ce296dfef1a592a6451c0b4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/603107fbb0da3acb1ce296dfef1a592a6451c0b4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/603107fbb0da3acb1ce296dfef1a592a6451c0b4/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "72fb6bae83446096e467e3713e8e40b2433f8220", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72fb6bae83446096e467e3713e8e40b2433f8220", "html_url": "https://github.com/Rust-GCC/gccrs/commit/72fb6bae83446096e467e3713e8e40b2433f8220"}], "stats": {"total": 42, "additions": 37, "deletions": 5}, "files": [{"sha": "28b938707318fb7ba225bcd349a10f0f9fa3eb87", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/603107fbb0da3acb1ce296dfef1a592a6451c0b4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/603107fbb0da3acb1ce296dfef1a592a6451c0b4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=603107fbb0da3acb1ce296dfef1a592a6451c0b4", "patch": "@@ -1,3 +1,13 @@\n+2016-06-30  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR driver/71651\n+\t* gcc.c (driver::build_option_suggestions): Pass \"option\" to\n+\tadd_misspelling_candidates.\n+\t* opts-common.c (add_misspelling_candidates): Add \"option\" param;\n+\tuse it to avoid adding negated forms for options marked with\n+\tRejectNegative.\n+\t* opts.h (add_misspelling_candidates): Add \"option\" param.\n+\n 2016-06-30  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR middle-end/71693"}, {"sha": "634f8e6002a9d8ed7426942c0411a05562bbaf1d", "filename": "gcc/gcc.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/603107fbb0da3acb1ce296dfef1a592a6451c0b4/gcc%2Fgcc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/603107fbb0da3acb1ce296dfef1a592a6451c0b4/gcc%2Fgcc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgcc.c?ref=603107fbb0da3acb1ce296dfef1a592a6451c0b4", "patch": "@@ -7700,12 +7700,14 @@ driver::build_option_suggestions (void)\n \t      for (unsigned j = 0; e->values[j].arg != NULL; j++)\n \t\t{\n \t\t  char *with_arg = concat (opt_text, e->values[j].arg, NULL);\n-\t\t  add_misspelling_candidates (m_option_suggestions, with_arg);\n+\t\t  add_misspelling_candidates (m_option_suggestions, option,\n+\t\t\t\t\t      with_arg);\n \t\t  free (with_arg);\n \t\t}\n \t    }\n \t  else\n-\t    add_misspelling_candidates (m_option_suggestions, opt_text);\n+\t    add_misspelling_candidates (m_option_suggestions, option,\n+\t\t\t\t\topt_text);\n \t  break;\n \n \tcase OPT_fsanitize_:\n@@ -7729,7 +7731,8 @@ driver::build_option_suggestions (void)\n \t\t/* Add with_arg and all of its variant spellings e.g.\n \t\t   \"-fno-sanitize=address\" to candidates (albeit without\n \t\t   leading dashes).  */\n-\t\tadd_misspelling_candidates (m_option_suggestions, with_arg);\n+\t\tadd_misspelling_candidates (m_option_suggestions, option,\n+\t\t\t\t\t    with_arg);\n \t\tfree (with_arg);\n \t      }\n \t  }"}, {"sha": "8634b520ecf2009b64b9275798db05f1a7afe862", "filename": "gcc/opts-common.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/603107fbb0da3acb1ce296dfef1a592a6451c0b4/gcc%2Fopts-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/603107fbb0da3acb1ce296dfef1a592a6451c0b4/gcc%2Fopts-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fopts-common.c?ref=603107fbb0da3acb1ce296dfef1a592a6451c0b4", "patch": "@@ -374,8 +374,9 @@ static const struct option_map option_map[] =\n    to specific options.  We want to do the reverse: to find all the ways\n    that a user could validly spell an option.\n \n-   Given valid OPT_TEXT (with a leading dash), add it and all of its valid\n-   variant spellings to CANDIDATES, each without a leading dash.\n+   Given valid OPT_TEXT (with a leading dash) for OPTION, add it and all\n+   of its valid variant spellings to CANDIDATES, each without a leading\n+   dash.\n \n    For example, given \"-Wabi-tag\", the following are added to CANDIDATES:\n      \"Wabi-tag\"\n@@ -387,9 +388,11 @@ static const struct option_map option_map[] =\n \n void\n add_misspelling_candidates (auto_vec<char *> *candidates,\n+\t\t\t    const struct cl_option *option,\n \t\t\t    const char *opt_text)\n {\n   gcc_assert (candidates);\n+  gcc_assert (option);\n   gcc_assert (opt_text);\n   candidates->safe_push (xstrdup (opt_text + 1));\n   for (unsigned i = 0; i < ARRAY_SIZE (option_map); i++)\n@@ -398,6 +401,9 @@ add_misspelling_candidates (auto_vec<char *> *candidates,\n       const char *new_prefix = option_map[i].new_prefix;\n       size_t new_prefix_len = strlen (new_prefix);\n \n+      if (option->cl_reject_negative && option_map[i].negated)\n+\tcontinue;\n+\n       if (strncmp (opt_text, new_prefix, new_prefix_len) == 0)\n \t{\n \t  char *alternative = concat (opt0 + 1, opt_text + new_prefix_len,"}, {"sha": "25d32c1ad49fff9c5beb073be32da80328c782a2", "filename": "gcc/opts.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/603107fbb0da3acb1ce296dfef1a592a6451c0b4/gcc%2Fopts.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/603107fbb0da3acb1ce296dfef1a592a6451c0b4/gcc%2Fopts.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fopts.h?ref=603107fbb0da3acb1ce296dfef1a592a6451c0b4", "patch": "@@ -417,6 +417,7 @@ extern const struct sanitizer_opts_s\n } sanitizer_opts[];\n \n extern void add_misspelling_candidates (auto_vec<char *> *candidates,\n+\t\t\t\t\tconst struct cl_option *option,\n \t\t\t\t\tconst char *base_option);\n \n #endif"}, {"sha": "8527a2fed0142a4cdbb1d63fb0f227b118dd8306", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/603107fbb0da3acb1ce296dfef1a592a6451c0b4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/603107fbb0da3acb1ce296dfef1a592a6451c0b4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=603107fbb0da3acb1ce296dfef1a592a6451c0b4", "patch": "@@ -1,3 +1,8 @@\n+2016-06-30  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR driver/71651\n+\t* gcc.dg/spellcheck-options-12.c: New test case.\n+\n 2016-06-30  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR middle-end/71693"}, {"sha": "b5e65e54a395889f1be34afc27040fde9a5a3c0f", "filename": "gcc/testsuite/gcc.dg/spellcheck-options-12.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/603107fbb0da3acb1ce296dfef1a592a6451c0b4/gcc%2Ftestsuite%2Fgcc.dg%2Fspellcheck-options-12.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/603107fbb0da3acb1ce296dfef1a592a6451c0b4/gcc%2Ftestsuite%2Fgcc.dg%2Fspellcheck-options-12.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fspellcheck-options-12.c?ref=603107fbb0da3acb1ce296dfef1a592a6451c0b4", "patch": "@@ -0,0 +1,7 @@\n+/* Verify that we don't include -Wno- variants for options marked\n+   with RejectNegative when considering hints for misspelled options\n+   (PR driver/71651).  */\n+\n+/* { dg-do compile } */\n+/* { dg-options \"-fno-stack-protector-explicit\" } */\n+/* { dg-error \"unrecognized command line option .-fno-stack-protector-explicit.; did you mean .-fstack-protector-explicit..\" \"\" { target *-*-* } 0 } */"}]}