{"sha": "bfb139b409e012903a3faf0c6934792cc7d2a838", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmZiMTM5YjQwOWUwMTI5MDNhM2ZhZjBjNjkzNDc5MmNjN2QyYTgzOA==", "commit": {"author": {"name": "Danny Smith", "email": "dannysmith@users.sourceforge.net", "date": "2008-12-02T08:02:07Z"}, "committer": {"name": "Danny Smith", "email": "dannysmith@gcc.gnu.org", "date": "2008-12-02T08:02:07Z"}, "message": "re PR target/38054 (Assertion failed in change_decl_assembler_name())\n\n        PR target/38054\n\t* config/i386/winnt.c (i386_pe_encode_section_info): Condition stdcall\n\tdecoration of function RTL names here on Ada language.\n\nFrom-SVN: r142347", "tree": {"sha": "5109a690c950cbf8364dcb1f6d0ab07d968cede6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5109a690c950cbf8364dcb1f6d0ab07d968cede6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bfb139b409e012903a3faf0c6934792cc7d2a838", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bfb139b409e012903a3faf0c6934792cc7d2a838", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bfb139b409e012903a3faf0c6934792cc7d2a838", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bfb139b409e012903a3faf0c6934792cc7d2a838/comments", "author": null, "committer": null, "parents": [{"sha": "a40fff0edbfec21b0e4cda87e3a8be26b0970f72", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a40fff0edbfec21b0e4cda87e3a8be26b0970f72", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a40fff0edbfec21b0e4cda87e3a8be26b0970f72"}], "stats": {"total": 37, "additions": 18, "deletions": 19}, "files": [{"sha": "75fa2e759ca77035735cbfab13a4847599ca1b21", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bfb139b409e012903a3faf0c6934792cc7d2a838/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bfb139b409e012903a3faf0c6934792cc7d2a838/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bfb139b409e012903a3faf0c6934792cc7d2a838", "patch": "@@ -1,3 +1,9 @@\n+2008-12-02  Danny Smith   <dannysmith@users.sourceforge.net>\n+\n+        PR target/38054\n+\t* config/i386/winnt.c (i386_pe_encode_section_info): Condition stdcall\n+\tdecoration of function RTL names here on Ada language.\n+\n 2008-12-01  Vladimir Makarov  <vmakarov@redhat.com>\n \n \tPR rtl-optimization/38280"}, {"sha": "48b82131d3fc0b6e717a01c9da3fd39719d53922", "filename": "gcc/config/i386/winnt.c", "status": "modified", "additions": 12, "deletions": 19, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bfb139b409e012903a3faf0c6934792cc7d2a838/gcc%2Fconfig%2Fi386%2Fwinnt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bfb139b409e012903a3faf0c6934792cc7d2a838/gcc%2Fconfig%2Fi386%2Fwinnt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fwinnt.c?ref=bfb139b409e012903a3faf0c6934792cc7d2a838", "patch": "@@ -32,6 +32,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"tm_p.h\"\n #include \"toplev.h\"\n #include \"hashtab.h\"\n+#include \"langhooks.h\"\n #include \"ggc.h\"\n #include \"target.h\"\n \n@@ -258,27 +259,19 @@ i386_pe_encode_section_info (tree decl, rtx rtl, int first)\n   switch (TREE_CODE (decl))\n     {\n     case FUNCTION_DECL:\n-      if (first)\n+      /* FIXME:  Imported stdcall names are not modified by the Ada frontend.\n+\t Check and decorate the RTL name now.  */\n+      if  (strcmp (lang_hooks.name, \"GNU Ada\") == 0)\n \t{\n-\t  /* FIXME: In Ada, and perhaps other language frontends,\n-\t     imported stdcall names may not yet have been modified.\n-\t     Check and do it know.  */\n-         tree new_id;\n-         tree old_id = DECL_ASSEMBLER_NAME (decl);\n-     \t  const char* asm_str = IDENTIFIER_POINTER (old_id);\n-          /* Do not change the identifier if a verbatim asmspec\n+\t  tree new_id;\n+\t  tree old_id = DECL_ASSEMBLER_NAME (decl);\n+\t  const char* asm_str = IDENTIFIER_POINTER (old_id);\n+\t  /* Do not change the identifier if a verbatim asmspec\n \t     or if stdcall suffix already added. */\n-      \t  if (*asm_str == '*' || strchr (asm_str, '@'))\n-            break;\n-\t  if ((new_id = i386_pe_maybe_mangle_decl_assembler_name (decl, old_id)))\n-\t    {\n-\t      /* These attributes must be present on first declaration,\n-\t\t change_decl_assembler_name will warn if they are added\n-\t\t later and the decl has been referenced, but duplicate_decls\n-\t\t should catch the mismatch first.  */\n-\t      change_decl_assembler_name (decl, new_id);\n-\t      XSTR (symbol, 0) = IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (decl));\n-\t    }\n+\t  if (!(*asm_str == '*' || strchr (asm_str, '@'))\n+\t      && (new_id = i386_pe_maybe_mangle_decl_assembler_name (decl,\n+\t\t\t\t\t\t\t\t     old_id)))\n+\t    XSTR (symbol, 0) = IDENTIFIER_POINTER (new_id);\n \t}\n       break;\n "}]}