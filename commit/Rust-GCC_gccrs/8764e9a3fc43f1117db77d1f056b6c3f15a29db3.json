{"sha": "8764e9a3fc43f1117db77d1f056b6c3f15a29db3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODc2NGU5YTNmYzQzZjExMTdkYjc3ZDFmMDU2YjZjM2YxNWEyOWRiMw==", "commit": {"author": {"name": "Alex Coplan", "email": "alex.coplan@arm.com", "date": "2020-07-20T15:15:29Z"}, "committer": {"name": "Alex Coplan", "email": "alex.coplan@arm.com", "date": "2020-07-20T15:31:57Z"}, "message": "jit: Fix truncation of testsuite output [PR69435]\n\nThis fixes a bug in jit.exp which causes the DejaGnu output of the\nlibgccjit testsuite to be nondeterministically truncated. This bug was\ncopied from DejaGnu's own implementation of the host_execute function.\nSee the upstream bug report [0] where the maintainers point out that the\nregex patterns in host_execute should (but don't currently) explicitly\nmatch newlines to avoid relying on DejaGnu not reading more than one\nline of the output (which is not guaranteed).\n\nThis should make it easier to test jit patches in the future, since it\nmakes it possible to reliably compare the output of two jit.sum files\n(as with the other tests in GCC).\n\n[0] : https://debbugs.gnu.org/cgi/bugreport.cgi?bug=42399\n\ngcc/testsuite/\n\tPR jit/69435\n\t* jit.dg/jit.exp (fixed_host_execute): Fix regex patterns to\n\talways explicitly match newlines.", "tree": {"sha": "9030c89c70aba76f55a71019d62e5b4d4150b1f5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9030c89c70aba76f55a71019d62e5b4d4150b1f5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8764e9a3fc43f1117db77d1f056b6c3f15a29db3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8764e9a3fc43f1117db77d1f056b6c3f15a29db3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8764e9a3fc43f1117db77d1f056b6c3f15a29db3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8764e9a3fc43f1117db77d1f056b6c3f15a29db3/comments", "author": {"login": "acoplan-arm", "id": 86676934, "node_id": "MDQ6VXNlcjg2Njc2OTM0", "avatar_url": "https://avatars.githubusercontent.com/u/86676934?v=4", "gravatar_id": "", "url": "https://api.github.com/users/acoplan-arm", "html_url": "https://github.com/acoplan-arm", "followers_url": "https://api.github.com/users/acoplan-arm/followers", "following_url": "https://api.github.com/users/acoplan-arm/following{/other_user}", "gists_url": "https://api.github.com/users/acoplan-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/acoplan-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/acoplan-arm/subscriptions", "organizations_url": "https://api.github.com/users/acoplan-arm/orgs", "repos_url": "https://api.github.com/users/acoplan-arm/repos", "events_url": "https://api.github.com/users/acoplan-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/acoplan-arm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "acoplan-arm", "id": 86676934, "node_id": "MDQ6VXNlcjg2Njc2OTM0", "avatar_url": "https://avatars.githubusercontent.com/u/86676934?v=4", "gravatar_id": "", "url": "https://api.github.com/users/acoplan-arm", "html_url": "https://github.com/acoplan-arm", "followers_url": "https://api.github.com/users/acoplan-arm/followers", "following_url": "https://api.github.com/users/acoplan-arm/following{/other_user}", "gists_url": "https://api.github.com/users/acoplan-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/acoplan-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/acoplan-arm/subscriptions", "organizations_url": "https://api.github.com/users/acoplan-arm/orgs", "repos_url": "https://api.github.com/users/acoplan-arm/repos", "events_url": "https://api.github.com/users/acoplan-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/acoplan-arm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "57d4771b7c15db139043bf41a03b8abe01e11f18", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57d4771b7c15db139043bf41a03b8abe01e11f18", "html_url": "https://github.com/Rust-GCC/gccrs/commit/57d4771b7c15db139043bf41a03b8abe01e11f18"}], "stats": {"total": 20, "additions": 10, "deletions": 10}, "files": [{"sha": "2d8c884b6b8c76c5919418adb77e6ac98399456c", "filename": "gcc/testsuite/jit.dg/jit.exp", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8764e9a3fc43f1117db77d1f056b6c3f15a29db3/gcc%2Ftestsuite%2Fjit.dg%2Fjit.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8764e9a3fc43f1117db77d1f056b6c3f15a29db3/gcc%2Ftestsuite%2Fjit.dg%2Fjit.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fjit.dg%2Fjit.exp?ref=8764e9a3fc43f1117db77d1f056b6c3f15a29db3", "patch": "@@ -202,37 +202,37 @@ proc fixed_host_execute {args} {\n \t    set timetol 0\n \t    exp_continue\n \t}\n-\t-re \"^$prefix\\tNOTE:${text}*\" {\n+\t-re \"^$prefix\\tNOTE:\\[^\\r\\n\\]+\\r\\n\" {\n \t    regsub \"\\[\\n\\r\\t\\]*NOTE: $text\\r\\n\" $expect_out(0,string) \"\" output\n-\t    set output [string range $output 6 end]\n+\t    set output [string range $output 6 end-2]\n \t    verbose \"$output\" 2\n \t    set timetol 0\n \t    exp_continue\n \t}\n-\t-re \"^$prefix\\tPASSED:${text}*\" {\n+\t-re \"^$prefix\\tPASSED:\\[^\\r\\n\\]+\\r\\n\" {\n \t    regsub \"\\[\\n\\r\\t\\]*PASSED: $text\\r\\n\" $expect_out(0,string) \"\" output\n-\t    set output [string range $output 8 end]\n+\t    set output [string range $output 8 end-2]\n \t    pass \"$output\"\n \t    set timetol 0\n \t    exp_continue\n \t}\n-\t-re \"^$prefix\\tFAILED:${text}*\" {\n+\t-re \"^$prefix\\tFAILED:\\[^\\r\\n\\]+\\r\\n\" {\n \t    regsub \"\\[\\n\\r\\t\\]*FAILED: $text\\r\\n\" $expect_out(0,string) \"\" output\n-\t    set output [string range $output 8 end]\n+\t    set output [string range $output 8 end-2]\n \t    fail \"$output\"\n \t    set timetol 0\n \t    exp_continue\n \t}\n-\t-re \"^$prefix\\tUNTESTED:${text}*\" {\n+\t-re \"^$prefix\\tUNTESTED:\\[^\\r\\n\\]+\\r\\n\" {\n \t    regsub \"\\[\\n\\r\\t\\]*TESTED: $text\\r\\n\" $expect_out(0,string) \"\" output\n-\t    set output [string range $output 8 end]\n+\t    set output [string range $output 8 end-2]\n \t    untested \"$output\"\n \t    set timetol 0\n \t    exp_continue\n \t}\n-\t-re \"^$prefix\\tUNRESOLVED:${text}*\" {\n+\t-re \"^$prefix\\tUNRESOLVED:\\[^\\r\\n\\]+\\r\\n\" {\n \t    regsub \"\\[\\n\\r\\t\\]*UNRESOLVED: $text\\r\\n\" $expect_out(0,string) \"\" output\n-\t    set output [string range $output 8 end]\n+\t    set output [string range $output 8 end-2]\n \t    unresolved \"$output\"\n \t    set timetol 0\n \t    exp_continue"}]}