{"sha": "20b6cf0194331045a8afa61ebf6432bb18f1ae87", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjBiNmNmMDE5NDMzMTA0NWE4YWZhNjFlYmY2NDMyYmIxOGYxYWU4Nw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-09-08T12:19:21Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-09-08T12:19:21Z"}, "message": "re PR fortran/77500 (ICE in gfc_trans_omp_atomic, at fortran/trans-openmp.c:2822)\n\n\tPR fortran/77500\n\t* trans-openmp.c (gfc_trans_omp_atomic): For atomic write or\n\tswap, don't try to look through GFC_ISYM_CONVERSION.  In other cases,\n\tcheck that value.function.isym is non-NULL before dereferencing it.\n\n\t* gfortran.dg/gomp/pr77500.f90: New test.\n\nFrom-SVN: r240038", "tree": {"sha": "b1d8b8516958e62a4a514a5777a0d8fa0db25594", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b1d8b8516958e62a4a514a5777a0d8fa0db25594"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/20b6cf0194331045a8afa61ebf6432bb18f1ae87", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/20b6cf0194331045a8afa61ebf6432bb18f1ae87", "html_url": "https://github.com/Rust-GCC/gccrs/commit/20b6cf0194331045a8afa61ebf6432bb18f1ae87", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/20b6cf0194331045a8afa61ebf6432bb18f1ae87/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8ebc1e0f8ee2e46d3dfc27a4b9a339074378d883", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ebc1e0f8ee2e46d3dfc27a4b9a339074378d883", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8ebc1e0f8ee2e46d3dfc27a4b9a339074378d883"}], "stats": {"total": 29, "additions": 28, "deletions": 1}, "files": [{"sha": "a0be0741ff16a1e665fe02d6e0784f802b850a40", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20b6cf0194331045a8afa61ebf6432bb18f1ae87/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20b6cf0194331045a8afa61ebf6432bb18f1ae87/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=20b6cf0194331045a8afa61ebf6432bb18f1ae87", "patch": "@@ -1,3 +1,10 @@\n+2016-09-08  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/77500\n+\t* trans-openmp.c (gfc_trans_omp_atomic): For atomic write or\n+\tswap, don't try to look through GFC_ISYM_CONVERSION.  In other cases,\n+\tcheck that value.function.isym is non-NULL before dereferencing it.\n+\n 2016-09-04  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/77391"}, {"sha": "e4a2975719e6676e1bca804337b6a572d4024022", "filename": "gcc/fortran/trans-openmp.c", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20b6cf0194331045a8afa61ebf6432bb18f1ae87/gcc%2Ffortran%2Ftrans-openmp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20b6cf0194331045a8afa61ebf6432bb18f1ae87/gcc%2Ffortran%2Ftrans-openmp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-openmp.c?ref=20b6cf0194331045a8afa61ebf6432bb18f1ae87", "patch": "@@ -2818,7 +2818,11 @@ gfc_trans_omp_atomic (gfc_code *code)\n   gfc_start_block (&block);\n \n   expr2 = code->expr2;\n-  if (expr2->expr_type == EXPR_FUNCTION\n+  if (((atomic_code->ext.omp_atomic & GFC_OMP_ATOMIC_MASK)\n+       != GFC_OMP_ATOMIC_WRITE)\n+      && (atomic_code->ext.omp_atomic & GFC_OMP_ATOMIC_SWAP) == 0\n+      && expr2->expr_type == EXPR_FUNCTION\n+      && expr2->value.function.isym\n       && expr2->value.function.isym->id == GFC_ISYM_CONVERSION)\n     expr2 = expr2->value.function.actual->expr;\n \n@@ -2857,6 +2861,7 @@ gfc_trans_omp_atomic (gfc_code *code)\n \t  var = code->expr1->symtree->n.sym;\n \t  expr2 = code->expr2;\n \t  if (expr2->expr_type == EXPR_FUNCTION\n+\t      && expr2->value.function.isym\n \t      && expr2->value.function.isym->id == GFC_ISYM_CONVERSION)\n \t    expr2 = expr2->value.function.actual->expr;\n \t}\n@@ -2914,6 +2919,7 @@ gfc_trans_omp_atomic (gfc_code *code)\n \t}\n       e = expr2->value.op.op1;\n       if (e->expr_type == EXPR_FUNCTION\n+\t  && e->value.function.isym\n \t  && e->value.function.isym->id == GFC_ISYM_CONVERSION)\n \te = e->value.function.actual->expr;\n       if (e->expr_type == EXPR_VARIABLE\n@@ -2927,6 +2933,7 @@ gfc_trans_omp_atomic (gfc_code *code)\n \t{\n \t  e = expr2->value.op.op2;\n \t  if (e->expr_type == EXPR_FUNCTION\n+\t      && e->value.function.isym\n \t      && e->value.function.isym->id == GFC_ISYM_CONVERSION)\n \t    e = e->value.function.actual->expr;\n \t  gcc_assert (e->expr_type == EXPR_VARIABLE\n@@ -3041,6 +3048,7 @@ gfc_trans_omp_atomic (gfc_code *code)\n \t  code = code->next;\n \t  expr2 = code->expr2;\n \t  if (expr2->expr_type == EXPR_FUNCTION\n+\t      && expr2->value.function.isym\n \t      && expr2->value.function.isym->id == GFC_ISYM_CONVERSION)\n \t    expr2 = expr2->value.function.actual->expr;\n "}, {"sha": "7cbb87abd0464813e5dc1008cc93fc110b87c674", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20b6cf0194331045a8afa61ebf6432bb18f1ae87/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20b6cf0194331045a8afa61ebf6432bb18f1ae87/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=20b6cf0194331045a8afa61ebf6432bb18f1ae87", "patch": "@@ -1,5 +1,8 @@\n 2016-09-08  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR fortran/77500\n+\t* gfortran.dg/gomp/pr77500.f90: New test.\n+\n \tPR fortran/77516\n \t* gfortran.dg/gomp/pr77516.f90: New test.\n "}, {"sha": "1572d5ceb243ac6a2cb36b9b8bef3fbd279bb155", "filename": "gcc/testsuite/gfortran.dg/gomp/pr77500.f90", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20b6cf0194331045a8afa61ebf6432bb18f1ae87/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr77500.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20b6cf0194331045a8afa61ebf6432bb18f1ae87/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr77500.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr77500.f90?ref=20b6cf0194331045a8afa61ebf6432bb18f1ae87", "patch": "@@ -0,0 +1,9 @@\n+! PR fortran/77500\n+! { dg-do compile }\n+\n+program pr77500\n+   real :: x\n+!$omp atomic write\n+   x = f()\n+!$omp end atomic\n+end"}]}