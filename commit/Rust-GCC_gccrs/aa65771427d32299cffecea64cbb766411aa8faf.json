{"sha": "aa65771427d32299cffecea64cbb766411aa8faf", "node_id": "C_kwDOANBUbNoAKGFhNjU3NzE0MjdkMzIyOTljZmZlY2VhNjRjYmI3NjY0MTFhYThmYWY", "commit": {"author": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2023-04-12T17:04:36Z"}, "committer": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2023-04-12T17:04:36Z"}, "message": "libstdc++: Implement LWG 3904 change to lazy_split_view's iterator\n\nlibstdc++-v3/ChangeLog:\n\n\t* include/std/ranges (lazy_split_view::_OuterIter::_OuterIter):\n\tPropagate _M_trailing_empty in the const-converting constructor\n\tas per LWG 3904.\n\t* testsuite/std/ranges/adaptors/adjacent/1.cc (test04): Correct\n\tassertion.\n\t* testsuite/std/ranges/adaptors/lazy_split.cc (test12): New test.", "tree": {"sha": "ca22b0a9b356596319f9b9315784b7f8075abbfc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ca22b0a9b356596319f9b9315784b7f8075abbfc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/aa65771427d32299cffecea64cbb766411aa8faf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa65771427d32299cffecea64cbb766411aa8faf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aa65771427d32299cffecea64cbb766411aa8faf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa65771427d32299cffecea64cbb766411aa8faf/comments", "author": null, "committer": null, "parents": [{"sha": "13669111e7219ed1f71b2079c7b5794c11f6e3ce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/13669111e7219ed1f71b2079c7b5794c11f6e3ce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/13669111e7219ed1f71b2079c7b5794c11f6e3ce"}], "stats": {"total": 21, "additions": 19, "deletions": 2}, "files": [{"sha": "c21528138e5444c54e4fce4a1b39b3e51a67d58d", "filename": "libstdc++-v3/include/std/ranges", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aa65771427d32299cffecea64cbb766411aa8faf/libstdc%2B%2B-v3%2Finclude%2Fstd%2Franges", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aa65771427d32299cffecea64cbb766411aa8faf/libstdc%2B%2B-v3%2Finclude%2Fstd%2Franges", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Franges?ref=aa65771427d32299cffecea64cbb766411aa8faf", "patch": "@@ -3209,7 +3209,8 @@ namespace views::__adaptor\n \t  _OuterIter(_OuterIter<!_Const> __i)\n \t    requires _Const\n \t      && convertible_to<iterator_t<_Vp>, iterator_t<_Base>>\n-\t    : _M_parent(__i._M_parent), _M_current(std::move(__i._M_current))\n+\t    : _M_parent(__i._M_parent), _M_current(std::move(__i._M_current)),\n+\t      _M_trailing_empty(__i._M_trailing_empty)\n \t  { }\n \n \t  constexpr value_type"}, {"sha": "19640abfe93b0b91ed3f0573ca2b474026512912", "filename": "libstdc++-v3/testsuite/std/ranges/adaptors/adjacent/1.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aa65771427d32299cffecea64cbb766411aa8faf/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fadaptors%2Fadjacent%2F1.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aa65771427d32299cffecea64cbb766411aa8faf/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fadaptors%2Fadjacent%2F1.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fadaptors%2Fadjacent%2F1.cc?ref=aa65771427d32299cffecea64cbb766411aa8faf", "patch": "@@ -107,7 +107,7 @@ test04()\n   // PR libstdc++/106798\n   auto r = views::single(0) | views::lazy_split(0) | views::pairwise;\n   decltype(ranges::cend(r)) s = r.end();\n-  VERIFY( r.begin() == s );\n+  VERIFY( r.begin() != s );\n \n   return true;\n }"}, {"sha": "4e5c0dc3ed5b22f3779e021f863e617b9cecec80", "filename": "libstdc++-v3/testsuite/std/ranges/adaptors/lazy_split.cc", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aa65771427d32299cffecea64cbb766411aa8faf/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fadaptors%2Flazy_split.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aa65771427d32299cffecea64cbb766411aa8faf/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fadaptors%2Flazy_split.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fadaptors%2Flazy_split.cc?ref=aa65771427d32299cffecea64cbb766411aa8faf", "patch": "@@ -22,6 +22,7 @@\n #include <ranges>\n #include <string>\n #include <string_view>\n+#include <utility>\n #include <vector>\n #include <testsuite_hooks.h>\n #include <testsuite_iterators.h>\n@@ -218,6 +219,20 @@ test11()\n   static_assert(ranges::distance(views::lazy_split(\"text\"sv, \"\"sv)) == 4);\n }\n \n+constexpr bool\n+test12()\n+{\n+  // LWG 3904\n+  auto r = views::single(0) | views::lazy_split(0);\n+  auto i = r.begin();\n+  ++i;\n+  VERIFY( i != r.end() );\n+  decltype(std::as_const(r).begin()) j = i;\n+  VERIFY( j != r.end() );\n+\n+  return true;\n+}\n+\n int\n main()\n {\n@@ -232,4 +247,5 @@ main()\n   test09();\n   test10();\n   test11();\n+  static_assert(test12());\n }"}]}