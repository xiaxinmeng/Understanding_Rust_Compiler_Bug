{"sha": "2731a5b331e812427b95801d121a7567998e030c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjczMWE1YjMzMWU4MTI0MjdiOTU4MDFkMTIxYTc1Njc5OThlMDMwYw==", "commit": {"author": {"name": "Andreas Krebbel", "email": "krebbel@linux.vnet.ibm.com", "date": "2017-07-31T11:31:09Z"}, "committer": {"name": "Andreas Krebbel", "email": "krebbel@gcc.gnu.org", "date": "2017-07-31T11:31:09Z"}, "message": "[Committed] S/390: Support z14 as CPU name.\n\nWith IBM z14 officially announced we can add support for z14 as\npreferred CPU name.  We still pass arch12 to Binutils in order to keep\nolder Binutils versions supported.\n\ngcc/ChangeLog:\n\n2017-07-31  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n\n\t* config.gcc: Add z14.\n\t* config/s390/driver-native.c (s390_host_detect_local_cpu): Add\n\tCPU model numbers for z13s and z14.\n\t* config/s390/s390-c.c (s390_resolve_overloaded_builtin): Replace\n\tarch12 with z14.\n\t* config/s390/s390-opts.h (enum processor_type): Rename\n\tPROCESSOR_ARCH12 to PROCESSOR_3906_Z14.\n\t* config/s390/s390.c (processor_table): Add field for CPU name to\n\tbe passed to Binutils.\n\t(s390_asm_output_machine_for_arch): Use the new field in\n\tprocessor_table for Binutils.\n\t(s390_expand_builtin): Replace arch12 with z14.\n\t(s390_issue_rate): Rename PROCESSOR_ARCH12 to PROCESSOR_3906_Z14.\n\t(s390_get_sched_attrmask): Likewise.\n\t(s390_get_unit_mask): Likewise.\n\t* config/s390/s390.opt: Add z14 to processor_type enum.\n\nFrom-SVN: r250739", "tree": {"sha": "d5f6e1d0b675ffb4bd22af00f4559ad0b2539def", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d5f6e1d0b675ffb4bd22af00f4559ad0b2539def"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2731a5b331e812427b95801d121a7567998e030c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2731a5b331e812427b95801d121a7567998e030c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2731a5b331e812427b95801d121a7567998e030c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2731a5b331e812427b95801d121a7567998e030c/comments", "author": null, "committer": null, "parents": [{"sha": "0688f9c15297a8164c73bcd79bdd2983ea1ab000", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0688f9c15297a8164c73bcd79bdd2983ea1ab000", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0688f9c15297a8164c73bcd79bdd2983ea1ab000"}], "stats": {"total": 76, "additions": 53, "deletions": 23}, "files": [{"sha": "27e4af12cbce6d73b9188d3fb958f927e3a9c144", "filename": "gcc/ChangeLog", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2731a5b331e812427b95801d121a7567998e030c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2731a5b331e812427b95801d121a7567998e030c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2731a5b331e812427b95801d121a7567998e030c", "patch": "@@ -1,3 +1,22 @@\n+2017-07-31  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n+\n+\t* config.gcc: Add z14.\n+\t* config/s390/driver-native.c (s390_host_detect_local_cpu): Add\n+\tCPU model numbers for z13s and z14.\n+\t* config/s390/s390-c.c (s390_resolve_overloaded_builtin): Replace\n+\tarch12 with z14.\n+\t* config/s390/s390-opts.h (enum processor_type): Rename\n+\tPROCESSOR_ARCH12 to PROCESSOR_3906_Z14.\n+\t* config/s390/s390.c (processor_table): Add field for CPU name to\n+\tbe passed to Binutils.\n+\t(s390_asm_output_machine_for_arch): Use the new field in\n+\tprocessor_table for Binutils.\n+\t(s390_expand_builtin): Replace arch12 with z14.\n+\t(s390_issue_rate): Rename PROCESSOR_ARCH12 to PROCESSOR_3906_Z14.\n+\t(s390_get_sched_attrmask): Likewise.\n+\t(s390_get_unit_mask): Likewise.\n+\t* config/s390/s390.opt: Add z14 to processor_type enum.\n+\n 2017-07-31  Martin Jambor  <mjambor@suse.cz>\n \n \tPR hsa/81477"}, {"sha": "fdf4cb845ae1d6b724acb8a5a455bc3742fb976e", "filename": "gcc/config.gcc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2731a5b331e812427b95801d121a7567998e030c/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2731a5b331e812427b95801d121a7567998e030c/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=2731a5b331e812427b95801d121a7567998e030c", "patch": "@@ -4368,7 +4368,7 @@ case \"${target}\" in\n \t\tfor which in arch tune; do\n \t\t\teval \"val=\\$with_$which\"\n \t\t\tcase ${val} in\n-\t\t\t\"\" | native | g5 | g6 | z900 | z990 | z9-109 | z9-ec | z10 | z196 | zEC12 | z13 | arch3 | arch5 | arch6 | arch7 | arch8 | arch9 | arch10 | arch11 | arch12)\n+\t\t\t\"\" | native | g5 | g6 | z900 | z990 | z9-109 | z9-ec | z10 | z196 | zEC12 | z13 | z14 | arch3 | arch5 | arch6 | arch7 | arch8 | arch9 | arch10 | arch11 | arch12)\n \t\t\t\t# OK\n \t\t\t\t;;\n \t\t\t*)"}, {"sha": "acb983613c24ed0291321935b16622d4271154ae", "filename": "gcc/config/s390/driver-native.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2731a5b331e812427b95801d121a7567998e030c/gcc%2Fconfig%2Fs390%2Fdriver-native.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2731a5b331e812427b95801d121a7567998e030c/gcc%2Fconfig%2Fs390%2Fdriver-native.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fdriver-native.c?ref=2731a5b331e812427b95801d121a7567998e030c", "patch": "@@ -112,10 +112,14 @@ s390_host_detect_local_cpu (int argc, const char **argv)\n \t      cpu = \"zEC12\";\n \t      break;\n \t    case 0x2964:\n+\t    case 0x2965:\n \t      cpu = \"z13\";\n \t      break;\n+\t    case 0x3906:\n+\t      cpu = \"z14\";\n+\t      break;\n \t    default:\n-\t      cpu = \"arch12\";\n+\t      cpu = \"z14\";\n \t      break;\n \t    }\n \t}"}, {"sha": "07224ad7f394e5f815a750cbca48360143390aaf", "filename": "gcc/config/s390/s390-c.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2731a5b331e812427b95801d121a7567998e030c/gcc%2Fconfig%2Fs390%2Fs390-c.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2731a5b331e812427b95801d121a7567998e030c/gcc%2Fconfig%2Fs390%2Fs390-c.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390-c.c?ref=2731a5b331e812427b95801d121a7567998e030c", "patch": "@@ -886,7 +886,7 @@ s390_resolve_overloaded_builtin (location_t loc,\n \n   if (!TARGET_VXE && (ob_flags & B_VXE))\n     {\n-      error_at (loc, \"%qF requires -march=arch12 or higher\", ob_fndecl);\n+      error_at (loc, \"%qF requires z14 or higher\", ob_fndecl);\n       return error_mark_node;\n     }\n \n@@ -963,7 +963,7 @@ s390_resolve_overloaded_builtin (location_t loc,\n   if (!TARGET_VXE\n       && bflags_overloaded_builtin_var[last_match_index] & B_VXE)\n     {\n-      error_at (loc, \"%qs matching variant requires -march=arch12 or higher\",\n+      error_at (loc, \"%qs matching variant requires z14 or higher\",\n \t\tIDENTIFIER_POINTER (DECL_NAME (ob_fndecl)));\n       return error_mark_node;\n     }"}, {"sha": "6d506e2c9e3969c1b59617b4c3f9780605b4a425", "filename": "gcc/config/s390/s390-opts.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2731a5b331e812427b95801d121a7567998e030c/gcc%2Fconfig%2Fs390%2Fs390-opts.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2731a5b331e812427b95801d121a7567998e030c/gcc%2Fconfig%2Fs390%2Fs390-opts.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390-opts.h?ref=2731a5b331e812427b95801d121a7567998e030c", "patch": "@@ -38,7 +38,7 @@ enum processor_type\n   PROCESSOR_2817_Z196,\n   PROCESSOR_2827_ZEC12,\n   PROCESSOR_2964_Z13,\n-  PROCESSOR_ARCH12,\n+  PROCESSOR_3906_Z14,\n   PROCESSOR_NATIVE,\n   PROCESSOR_max\n };"}, {"sha": "77b0e7f5404e2170bd35684e56d5c5b02884794b", "filename": "gcc/config/s390/s390.c", "status": "modified", "additions": 21, "deletions": 17, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2731a5b331e812427b95801d121a7567998e030c/gcc%2Fconfig%2Fs390%2Fs390.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2731a5b331e812427b95801d121a7567998e030c/gcc%2Fconfig%2Fs390%2Fs390.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.c?ref=2731a5b331e812427b95801d121a7567998e030c", "patch": "@@ -318,24 +318,27 @@ struct processor_costs zEC12_cost =\n \n static struct\n {\n+  /* The preferred name to be used in user visible output.  */\n   const char *const name;\n+  /* CPU name as it should be passed to Binutils via .machine  */\n+  const char *const binutils_name;\n   const enum processor_type processor;\n   const struct processor_costs *cost;\n }\n const processor_table[] =\n {\n-  { \"g5\",     PROCESSOR_9672_G5,     &z900_cost },\n-  { \"g6\",     PROCESSOR_9672_G6,     &z900_cost },\n-  { \"z900\",   PROCESSOR_2064_Z900,   &z900_cost },\n-  { \"z990\",   PROCESSOR_2084_Z990,   &z990_cost },\n-  { \"z9-109\", PROCESSOR_2094_Z9_109, &z9_109_cost },\n-  { \"z9-ec\",  PROCESSOR_2094_Z9_EC,  &z9_109_cost },\n-  { \"z10\",    PROCESSOR_2097_Z10,    &z10_cost },\n-  { \"z196\",   PROCESSOR_2817_Z196,   &z196_cost },\n-  { \"zEC12\",  PROCESSOR_2827_ZEC12,  &zEC12_cost },\n-  { \"z13\",    PROCESSOR_2964_Z13,    &zEC12_cost },\n-  { \"arch12\", PROCESSOR_ARCH12,      &zEC12_cost },\n-  { \"native\", PROCESSOR_NATIVE,      NULL }\n+  { \"g5\",     \"g5\",     PROCESSOR_9672_G5,     &z900_cost },\n+  { \"g6\",     \"g6\",     PROCESSOR_9672_G6,     &z900_cost },\n+  { \"z900\",   \"z900\",   PROCESSOR_2064_Z900,   &z900_cost },\n+  { \"z990\",   \"z990\",   PROCESSOR_2084_Z990,   &z990_cost },\n+  { \"z9-109\", \"z9-109\", PROCESSOR_2094_Z9_109, &z9_109_cost },\n+  { \"z9-ec\",  \"z9-ec\",  PROCESSOR_2094_Z9_EC,  &z9_109_cost },\n+  { \"z10\",    \"z10\",    PROCESSOR_2097_Z10,    &z10_cost },\n+  { \"z196\",   \"z196\",   PROCESSOR_2817_Z196,   &z196_cost },\n+  { \"zEC12\",  \"zEC12\",  PROCESSOR_2827_ZEC12,  &zEC12_cost },\n+  { \"z13\",    \"z13\",    PROCESSOR_2964_Z13,    &zEC12_cost },\n+  { \"z14\",    \"arch12\", PROCESSOR_3906_Z14,    &zEC12_cost },\n+  { \"native\", \"\",       PROCESSOR_NATIVE,      NULL }\n };\n \n extern int reload_completed;\n@@ -847,7 +850,7 @@ s390_expand_builtin (tree exp, rtx target, rtx subtarget ATTRIBUTE_UNUSED,\n \n       if ((bflags & B_VXE) && !TARGET_VXE)\n \t{\n-\t  error (\"Builtin %qF requires arch12 or higher.\", fndecl);\n+\t  error (\"Builtin %qF requires z14 or higher.\", fndecl);\n \t  return const0_rtx;\n \t}\n     }\n@@ -7359,7 +7362,8 @@ s390_asm_output_machine_for_arch (FILE *asm_out_file)\n {\n   fprintf (asm_out_file, \"\\t.machinemode %s\\n\",\n \t   (TARGET_ZARCH) ? \"zarch\" : \"esa\");\n-  fprintf (asm_out_file, \"\\t.machine \\\"%s\", processor_table[s390_arch].name);\n+  fprintf (asm_out_file, \"\\t.machine \\\"%s\",\n+\t   processor_table[s390_arch].binutils_name);\n   if (S390_USE_ARCHITECTURE_MODIFIERS)\n     {\n       int cpu_flags;\n@@ -8093,7 +8097,7 @@ s390_issue_rate (void)\n \t instruction gets issued per cycle.  */\n     case PROCESSOR_2827_ZEC12:\n     case PROCESSOR_2964_Z13:\n-    case PROCESSOR_ARCH12:\n+    case PROCESSOR_3906_Z14:\n     default:\n       return 1;\n     }\n@@ -14309,7 +14313,7 @@ s390_get_sched_attrmask (rtx_insn *insn)\n \tmask |= S390_SCHED_ATTR_MASK_GROUPALONE;\n       break;\n     case PROCESSOR_2964_Z13:\n-    case PROCESSOR_ARCH12:\n+    case PROCESSOR_3906_Z14:\n       if (get_attr_z13_cracked (insn))\n \tmask |= S390_SCHED_ATTR_MASK_CRACKED;\n       if (get_attr_z13_expanded (insn))\n@@ -14333,7 +14337,7 @@ s390_get_unit_mask (rtx_insn *insn, int *units)\n   switch (s390_tune)\n     {\n     case PROCESSOR_2964_Z13:\n-    case PROCESSOR_ARCH12:\n+    case PROCESSOR_3906_Z14:\n       *units = 3;\n       if (get_attr_z13_unit_lsu (insn))\n \tmask |= 1 << 0;"}, {"sha": "4dab1b655a3e3feb9c79b89bfc247d99d24f94ff", "filename": "gcc/config/s390/s390.opt", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2731a5b331e812427b95801d121a7567998e030c/gcc%2Fconfig%2Fs390%2Fs390.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2731a5b331e812427b95801d121a7567998e030c/gcc%2Fconfig%2Fs390%2Fs390.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.opt?ref=2731a5b331e812427b95801d121a7567998e030c", "patch": "@@ -113,7 +113,10 @@ EnumValue\n Enum(processor_type) String(arch11) Value(PROCESSOR_2964_Z13)\n \n EnumValue\n-Enum(processor_type) String(arch12) Value(PROCESSOR_ARCH12)\n+Enum(processor_type) String(z14) Value(PROCESSOR_3906_Z14)\n+\n+EnumValue\n+Enum(processor_type) String(arch12) Value(PROCESSOR_3906_Z14)\n \n EnumValue\n Enum(processor_type) String(native) Value(PROCESSOR_NATIVE) DriverOnly"}]}