{"sha": "2f1364c2b325eec008bf461a0d77264618a9afe8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmYxMzY0YzJiMzI1ZWVjMDA4YmY0NjFhMGQ3NzI2NDYxOGE5YWZlOA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-08-12T16:04:33Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-08-12T16:04:33Z"}, "message": "re PR c/67410 (c/c-typeck.c references out of bounds array)\n\n\tPR c/67410\n\t* c-typeck.c (set_nonincremental_init_from_string): Use / instead of\n\t% to determine val element to change.  Assert that\n\twchar_bytes * charwidth fits into val array.\n\n\t* gcc.dg/pr67410.c: New test.\n\nCo-Authored-By: Martin Liska <mliska@suse.cz>\n\nFrom-SVN: r239419", "tree": {"sha": "2e00735b63167cdb3d3b63e5b6d1ae320e43c34a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2e00735b63167cdb3d3b63e5b6d1ae320e43c34a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2f1364c2b325eec008bf461a0d77264618a9afe8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f1364c2b325eec008bf461a0d77264618a9afe8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2f1364c2b325eec008bf461a0d77264618a9afe8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f1364c2b325eec008bf461a0d77264618a9afe8/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d186f41d35f7dd1190bf175b9224fa6f941ffbc0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d186f41d35f7dd1190bf175b9224fa6f941ffbc0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d186f41d35f7dd1190bf175b9224fa6f941ffbc0"}], "stats": {"total": 32, "additions": 31, "deletions": 1}, "files": [{"sha": "522da71ff6423aa7bb793b0a78c2910166a4ec2b", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f1364c2b325eec008bf461a0d77264618a9afe8/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f1364c2b325eec008bf461a0d77264618a9afe8/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=2f1364c2b325eec008bf461a0d77264618a9afe8", "patch": "@@ -1,3 +1,11 @@\n+2016-08-12  Jakub Jelinek  <jakub@redhat.com>\n+\t    Martin Liska  <mliska@suse.cz>\n+\n+\tPR c/67410\n+\t* c-typeck.c (set_nonincremental_init_from_string): Use / instead of\n+\t% to determine val element to change.  Assert that\n+\twchar_bytes * charwidth fits into val array.\n+\n 2016-08-12  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/7652"}, {"sha": "2e1e09dab00c99be368b2e6f2679afb1ed6aaef1", "filename": "gcc/c/c-typeck.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f1364c2b325eec008bf461a0d77264618a9afe8/gcc%2Fc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f1364c2b325eec008bf461a0d77264618a9afe8/gcc%2Fc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-typeck.c?ref=2f1364c2b325eec008bf461a0d77264618a9afe8", "patch": "@@ -8558,6 +8558,8 @@ set_nonincremental_init_from_string (tree str,\n \n   wchar_bytes = TYPE_PRECISION (TREE_TYPE (TREE_TYPE (str))) / BITS_PER_UNIT;\n   charwidth = TYPE_PRECISION (char_type_node);\n+  gcc_assert ((size_t) wchar_bytes * charwidth\n+\t      <= ARRAY_SIZE (val) * HOST_BITS_PER_WIDE_INT);\n   type = TREE_TYPE (constructor_type);\n   p = TREE_STRING_POINTER (str);\n   end = p + TREE_STRING_LENGTH (str);\n@@ -8583,7 +8585,7 @@ set_nonincremental_init_from_string (tree str,\n \t\tbitpos = (wchar_bytes - byte - 1) * charwidth;\n \t      else\n \t\tbitpos = byte * charwidth;\n-\t      val[bitpos % HOST_BITS_PER_WIDE_INT]\n+\t      val[bitpos / HOST_BITS_PER_WIDE_INT]\n \t\t|= ((unsigned HOST_WIDE_INT) ((unsigned char) *p++))\n \t\t   << (bitpos % HOST_BITS_PER_WIDE_INT);\n \t    }"}, {"sha": "8040f34e775c33243101bb5e1cda2d597290b9c3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f1364c2b325eec008bf461a0d77264618a9afe8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f1364c2b325eec008bf461a0d77264618a9afe8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2f1364c2b325eec008bf461a0d77264618a9afe8", "patch": "@@ -1,3 +1,8 @@\n+2016-08-12  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/67410\n+\t* gcc.dg/pr67410.c: New test.\n+\n 2016-08-12  Bin Cheng  <bin.cheng@arm.com>\n \n \tPR tree-optimization/69848"}, {"sha": "ff3c4f16867dcaaee954b2e09fabf078032c51f1", "filename": "gcc/testsuite/gcc.dg/pr67410.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f1364c2b325eec008bf461a0d77264618a9afe8/gcc%2Ftestsuite%2Fgcc.dg%2Fpr67410.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f1364c2b325eec008bf461a0d77264618a9afe8/gcc%2Ftestsuite%2Fgcc.dg%2Fpr67410.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr67410.c?ref=2f1364c2b325eec008bf461a0d77264618a9afe8", "patch": "@@ -0,0 +1,15 @@\n+/* PR c/67410 */\n+/* { dg-do run } */\n+/* { dg-options \"-std=gnu11\" } */\n+\n+struct {\n+  __CHAR16_TYPE__ s[2];\n+} a[] = { u\"ff\", [0].s[0] = u'x', [1] = u\"\\u1234\\u4567\", [1].s[0] = u'\\u89ab' };\n+\n+int\n+main ()\n+{\n+  if (a[0].s[0] != u'x' || a[0].s[1] != u'f' || a[1].s[0] != u'\\u89ab' || a[1].s[1] != u'\\u4567')\n+    __builtin_abort ();\n+  return 0;\n+}"}]}