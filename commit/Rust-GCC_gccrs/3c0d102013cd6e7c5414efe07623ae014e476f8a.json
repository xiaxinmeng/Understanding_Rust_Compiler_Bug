{"sha": "3c0d102013cd6e7c5414efe07623ae014e476f8a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2MwZDEwMjAxM2NkNmU3YzU0MTRlZmUwNzYyM2FlMDE0ZTQ3NmY4YQ==", "commit": {"author": {"name": "Daniel Berlin", "email": "dberlin@dberlin.org", "date": "2005-03-04T03:08:10Z"}, "committer": {"name": "Daniel Berlin", "email": "dberlin@gcc.gnu.org", "date": "2005-03-04T03:08:10Z"}, "message": "re PR debug/20253 (Macro debug info broken due to lexer change)\n\n2005-03-03  Daniel Berlin <dberlin@dbrelin.org>\n\n\tFix PR debug/20253\n\n\t* c-opts.c (c_common_parse_file): Call start_source_file\n\tand end_source_file at the approriate times.\n\n\t* dwarf2out.c (dwarf2out_finish): Don't auto-end\n\tthe main file, it will be done for us now.\n\nFrom-SVN: r95872", "tree": {"sha": "8b30afa78d4a038ac01a473a3fda126b6bbd2757", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8b30afa78d4a038ac01a473a3fda126b6bbd2757"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3c0d102013cd6e7c5414efe07623ae014e476f8a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3c0d102013cd6e7c5414efe07623ae014e476f8a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3c0d102013cd6e7c5414efe07623ae014e476f8a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3c0d102013cd6e7c5414efe07623ae014e476f8a/comments", "author": {"login": "dberlin", "id": 324715, "node_id": "MDQ6VXNlcjMyNDcxNQ==", "avatar_url": "https://avatars.githubusercontent.com/u/324715?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dberlin", "html_url": "https://github.com/dberlin", "followers_url": "https://api.github.com/users/dberlin/followers", "following_url": "https://api.github.com/users/dberlin/following{/other_user}", "gists_url": "https://api.github.com/users/dberlin/gists{/gist_id}", "starred_url": "https://api.github.com/users/dberlin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dberlin/subscriptions", "organizations_url": "https://api.github.com/users/dberlin/orgs", "repos_url": "https://api.github.com/users/dberlin/repos", "events_url": "https://api.github.com/users/dberlin/events{/privacy}", "received_events_url": "https://api.github.com/users/dberlin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9bdae6af0e9d0e9825c5df7b3754f9d815a657f9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9bdae6af0e9d0e9825c5df7b3754f9d815a657f9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9bdae6af0e9d0e9825c5df7b3754f9d815a657f9"}], "stats": {"total": 37, "additions": 33, "deletions": 4}, "files": [{"sha": "b6765aca02cbf346ce2ac8a7b6c5d85b5b09a992", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c0d102013cd6e7c5414efe07623ae014e476f8a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c0d102013cd6e7c5414efe07623ae014e476f8a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3c0d102013cd6e7c5414efe07623ae014e476f8a", "patch": "@@ -1,3 +1,13 @@\n+2005-03-03  Daniel Berlin <dberlin@dbrelin.org>\n+\n+\tFix PR debug/20253\n+\t\n+\t* c-opts.c (c_common_parse_file): Call start_source_file\n+\tand end_source_file at the approriate times.\n+\n+\t* dwarf2out.c (dwarf2out_finish): Don't auto-end\n+\tthe main file, it will be done for us now.\n+\t\n 2005-03-04  Kazu Hirata  <kazu@cs.umass.edu>\n \n \t* fold-const.c (fold_ternary): New."}, {"sha": "d2abeb527b6e7f0cd8f398839520c4b27f95e2f1", "filename": "gcc/c-opts.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c0d102013cd6e7c5414efe07623ae014e476f8a/gcc%2Fc-opts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c0d102013cd6e7c5414efe07623ae014e476f8a/gcc%2Fc-opts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-opts.c?ref=3c0d102013cd6e7c5414efe07623ae014e476f8a", "patch": "@@ -1089,13 +1089,16 @@ c_common_parse_file (int set_yydebug)\n   i = 0;\n   for (;;)\n     {\n+      /* Start the main input file */\n+      (*debug_hooks->start_source_file) (0, this_input_filename);\n       finish_options ();\n       pch_init ();\n       push_file_scope ();\n       c_parse_file ();\n       finish_file ();\n       pop_file_scope ();\n-\n+      /* And end the main input file. */\n+      (*debug_hooks->end_source_file) (0);\n       if (++i >= num_in_fnames)\n \tbreak;\n       cpp_undef_all (parse_in);"}, {"sha": "5157ae358bcc2a8180efbdb3b15c99c4340340f1", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c0d102013cd6e7c5414efe07623ae014e476f8a/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c0d102013cd6e7c5414efe07623ae014e476f8a/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=3c0d102013cd6e7c5414efe07623ae014e476f8a", "patch": "@@ -10497,8 +10497,12 @@ add_abstract_origin_attribute (dw_die_ref die, tree origin)\n \n       if (TYPE_P (fn))\n \tfn = TYPE_STUB_DECL (fn);\n+      \n+      /* TYPE_STUB_DECL may have given us a NULL, which decl_function_context\n+\t won't like.  */\n+      if (fn)\t\n+\tfn = decl_function_context (fn);\n \n-      fn = decl_function_context (fn);\n       if (fn)\n \tdwarf2out_abstract_function (fn);\n     }\n@@ -13795,11 +13799,10 @@ dwarf2out_finish (const char *filename)\n       output_ranges ();\n     }\n \n-  /* Have to end the primary source file.  */\n+  /* Have to end the macro section.  */\n   if (debug_info_level >= DINFO_LEVEL_VERBOSE)\n     {\n       named_section_flags (DEBUG_MACINFO_SECTION, SECTION_DEBUG);\n-      dw2_asm_output_data (1, DW_MACINFO_end_file, \"End file\");\n       dw2_asm_output_data (1, 0, \"End compilation unit\");\n     }\n "}, {"sha": "45e937372830abd370c91a4f901a285a682b0e09", "filename": "gcc/testsuite/gcc.dg/debug/dwarf2/dwarf2-macro.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c0d102013cd6e7c5414efe07623ae014e476f8a/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fdwarf2%2Fdwarf2-macro.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c0d102013cd6e7c5414efe07623ae014e476f8a/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fdwarf2%2Fdwarf2-macro.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fdwarf2%2Fdwarf2-macro.c?ref=3c0d102013cd6e7c5414efe07623ae014e476f8a", "patch": "@@ -0,0 +1,13 @@\n+/* Test to make sure the mcaro info includes a start file command for the main source */\n+/* { dg-do compile */\n+/* { dg-options \"-g3 -gdwarf-2 -dA -fverbose-asm\" } */\n+/* { dg-final { scan-assembler \"Start new file\" } } */\n+\n+#define ADD(x) (M + x)\n+\n+int main (void)\n+{\n+#define N 28\n+#define M 42\n+   return ADD(N);\n+}"}]}