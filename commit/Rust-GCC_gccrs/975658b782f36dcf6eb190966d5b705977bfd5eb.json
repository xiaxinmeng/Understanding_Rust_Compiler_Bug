{"sha": "975658b782f36dcf6eb190966d5b705977bfd5eb", "node_id": "C_kwDOANBUbNoAKDk3NTY1OGI3ODJmMzZkY2Y2ZWIxOTA5NjZkNWI3MDU5NzdiZmQ1ZWI", "commit": {"author": {"name": "Peter Bergner", "email": "bergner@linux.ibm.com", "date": "2022-06-18T04:43:23Z"}, "committer": {"name": "Peter Bergner", "email": "bergner@linux.ibm.com", "date": "2022-07-26T15:04:44Z"}, "message": "c: Handle initializations of opaque types [PR106016]\n\nThe initial commit that added opaque types thought that there couldn't\nbe any valid initializations for variables of these types, but the test\ncase in the bug report shows that isn't true.  The solution is to handle\nOPAQUE_TYPE initializations like the other scalar types.\n\n2022-06-17  Peter Bergner  <bergner@linux.ibm.com>\n\ngcc/\n\tPR c/106016\n\t* expr.cc (count_type_elements): Handle OPAQUE_TYPE.\n\ngcc/testsuite/\n\tPR c/106016\n\t* gcc.target/powerpc/pr106016.c: New test.", "tree": {"sha": "34cf4546577b46404d91bf0f6c5a969369ee148e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/34cf4546577b46404d91bf0f6c5a969369ee148e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/975658b782f36dcf6eb190966d5b705977bfd5eb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/975658b782f36dcf6eb190966d5b705977bfd5eb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/975658b782f36dcf6eb190966d5b705977bfd5eb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/975658b782f36dcf6eb190966d5b705977bfd5eb/comments", "author": {"login": "peter-bergner", "id": 17504345, "node_id": "MDQ6VXNlcjE3NTA0MzQ1", "avatar_url": "https://avatars.githubusercontent.com/u/17504345?v=4", "gravatar_id": "", "url": "https://api.github.com/users/peter-bergner", "html_url": "https://github.com/peter-bergner", "followers_url": "https://api.github.com/users/peter-bergner/followers", "following_url": "https://api.github.com/users/peter-bergner/following{/other_user}", "gists_url": "https://api.github.com/users/peter-bergner/gists{/gist_id}", "starred_url": "https://api.github.com/users/peter-bergner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/peter-bergner/subscriptions", "organizations_url": "https://api.github.com/users/peter-bergner/orgs", "repos_url": "https://api.github.com/users/peter-bergner/repos", "events_url": "https://api.github.com/users/peter-bergner/events{/privacy}", "received_events_url": "https://api.github.com/users/peter-bergner/received_events", "type": "User", "site_admin": false}, "committer": {"login": "peter-bergner", "id": 17504345, "node_id": "MDQ6VXNlcjE3NTA0MzQ1", "avatar_url": "https://avatars.githubusercontent.com/u/17504345?v=4", "gravatar_id": "", "url": "https://api.github.com/users/peter-bergner", "html_url": "https://github.com/peter-bergner", "followers_url": "https://api.github.com/users/peter-bergner/followers", "following_url": "https://api.github.com/users/peter-bergner/following{/other_user}", "gists_url": "https://api.github.com/users/peter-bergner/gists{/gist_id}", "starred_url": "https://api.github.com/users/peter-bergner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/peter-bergner/subscriptions", "organizations_url": "https://api.github.com/users/peter-bergner/orgs", "repos_url": "https://api.github.com/users/peter-bergner/repos", "events_url": "https://api.github.com/users/peter-bergner/events{/privacy}", "received_events_url": "https://api.github.com/users/peter-bergner/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5b96c823e591980a80481eb3fe72092a6146f742", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b96c823e591980a80481eb3fe72092a6146f742", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5b96c823e591980a80481eb3fe72092a6146f742"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "80bb1b8a4c5b8350fb1b8f57a99fd52e5882fcb6", "filename": "gcc/expr.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/975658b782f36dcf6eb190966d5b705977bfd5eb/gcc%2Fexpr.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/975658b782f36dcf6eb190966d5b705977bfd5eb/gcc%2Fexpr.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpr.cc?ref=975658b782f36dcf6eb190966d5b705977bfd5eb", "patch": "@@ -6462,13 +6462,13 @@ count_type_elements (const_tree type, bool for_ctor_p)\n     case OFFSET_TYPE:\n     case REFERENCE_TYPE:\n     case NULLPTR_TYPE:\n+    case OPAQUE_TYPE:\n       return 1;\n \n     case ERROR_MARK:\n       return 0;\n \n     case VOID_TYPE:\n-    case OPAQUE_TYPE:\n     case METHOD_TYPE:\n     case FUNCTION_TYPE:\n     case LANG_TYPE:"}, {"sha": "3db8345dcc68ecad7da24a8d73fde0f102cf7074", "filename": "gcc/testsuite/gcc.target/powerpc/pr106016.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/975658b782f36dcf6eb190966d5b705977bfd5eb/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr106016.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/975658b782f36dcf6eb190966d5b705977bfd5eb/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr106016.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr106016.c?ref=975658b782f36dcf6eb190966d5b705977bfd5eb", "patch": "@@ -0,0 +1,14 @@\n+/* PR target/106016 */\n+/* { dg-require-effective-target power10_ok } */\n+/* { dg-options \"-O2 -mdejagnu-cpu=power10\" } */\n+\n+/* Make sure we do not ICE on the following test case.  */\n+\n+extern void bar (__vector_quad *);\n+\n+void\n+foo (__vector_quad *a, __vector_quad *b)\n+{\n+  __vector_quad arr[2] = {*a, *b};\n+  bar (&arr[0]);\n+}"}]}