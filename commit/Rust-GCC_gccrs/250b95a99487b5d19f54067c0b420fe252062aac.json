{"sha": "250b95a99487b5d19f54067c0b420fe252062aac", "node_id": "C_kwDOANBUbNoAKDI1MGI5NWE5OTQ4N2I1ZDE5ZjU0MDY3YzBiNDIwZmUyNTIwNjJhYWM", "commit": {"author": {"name": "Alexandre Oliva", "email": "oliva@adacore.com", "date": "2022-06-27T13:34:14Z"}, "committer": {"name": "Alexandre Oliva", "email": "oliva@gnu.org", "date": "2022-06-27T13:34:14Z"}, "message": "libstdc++: xfail experimental/net tests on rtems\n\nSome net/timer/waitable tests fail on rtems because poll() is not\navailable.\n\nThe above, as well as net/internet/resolver/ops tests and\nnet/timer/waitable/cons.cc, will fail early at runtime unless mkfifo\nis enabled in the RTEMS configuration, because the io_context ctor\nthrows when pipe() fails.\n\nHowever, even enabling pipes and adjusting the net_ts link command to\nuse --gc-sections for -lbsd as recommended, both\nnet/internet/resolver/ops still fail at runtime.\n\n\nfor  libstdc++-v3/ChangeLog\n\n\t* testsuite/lib/dg-options.exp (add_options_for_net_ts):\n\tAdd -Wl,--gc-sections for RTEMS targets.\n\t* testsuite/experimental/net/timer/waitable/dest.cc: Link-time\n\txfail on RTEMS.\n\t* testsuite/experimental/net/timer/waitable/ops.cc: Likewise.\n\t* testsuite/experimental/net/internet/resolver/ops/lookup.cc:\n\tExecution-time xfail on RTEMS.\n\t* testsuite/experimental/net/internet/resolver/ops/reverse.cc:\n\tLikewise.", "tree": {"sha": "5d09d2033861963c47213e3ee576229d71142bc1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5d09d2033861963c47213e3ee576229d71142bc1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/250b95a99487b5d19f54067c0b420fe252062aac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/250b95a99487b5d19f54067c0b420fe252062aac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/250b95a99487b5d19f54067c0b420fe252062aac", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/250b95a99487b5d19f54067c0b420fe252062aac/comments", "author": null, "committer": null, "parents": [{"sha": "b06a282921c71bbc5cab69bc515804bd80f55e92", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b06a282921c71bbc5cab69bc515804bd80f55e92", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b06a282921c71bbc5cab69bc515804bd80f55e92"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "0ac9cb3513d7e0cbd572bdac076ca8d9f348e600", "filename": "libstdc++-v3/testsuite/experimental/net/internet/resolver/ops/lookup.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/250b95a99487b5d19f54067c0b420fe252062aac/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Finternet%2Fresolver%2Fops%2Flookup.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/250b95a99487b5d19f54067c0b420fe252062aac/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Finternet%2Fresolver%2Fops%2Flookup.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Finternet%2Fresolver%2Fops%2Flookup.cc?ref=250b95a99487b5d19f54067c0b420fe252062aac", "patch": "@@ -18,6 +18,7 @@\n // { dg-do run { target c++14 } }\n // { dg-require-effective-target net_ts_ip }\n // { dg-add-options net_ts }\n+// { dg-xfail-run-if \"io_context requires a working pipe\" { *-*-rtems* } }\n \n #include <experimental/internet>\n #include <testsuite_hooks.h>"}, {"sha": "dfdf855c68cd7189be58f0624d416731c23a5036", "filename": "libstdc++-v3/testsuite/experimental/net/internet/resolver/ops/reverse.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/250b95a99487b5d19f54067c0b420fe252062aac/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Finternet%2Fresolver%2Fops%2Freverse.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/250b95a99487b5d19f54067c0b420fe252062aac/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Finternet%2Fresolver%2Fops%2Freverse.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Finternet%2Fresolver%2Fops%2Freverse.cc?ref=250b95a99487b5d19f54067c0b420fe252062aac", "patch": "@@ -18,6 +18,7 @@\n // { dg-do run { target c++14 } }\n // { dg-require-effective-target net_ts_ip }\n // { dg-add-options net_ts }\n+// { dg-xfail-run-if \"io_context requires a working pipe\" { *-*-rtems* } }\n \n #include <experimental/internet>\n #include <testsuite_hooks.h>"}, {"sha": "384f768c2b56d02558da7f11b8234c556aba8a54", "filename": "libstdc++-v3/testsuite/experimental/net/timer/waitable/dest.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/250b95a99487b5d19f54067c0b420fe252062aac/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Ftimer%2Fwaitable%2Fdest.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/250b95a99487b5d19f54067c0b420fe252062aac/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Ftimer%2Fwaitable%2Fdest.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Ftimer%2Fwaitable%2Fdest.cc?ref=250b95a99487b5d19f54067c0b420fe252062aac", "patch": "@@ -17,6 +17,7 @@\n \n // { dg-do run { target c++14 } }\n // { dg-add-options libatomic }\n+// { dg-xfail-if \"poll not available\" { *-*-rtems* } }\n \n #include <experimental/timer>\n #include <testsuite_hooks.h>"}, {"sha": "815ad71578035ae4c621fb5bf91e0e5ebcf81921", "filename": "libstdc++-v3/testsuite/experimental/net/timer/waitable/ops.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/250b95a99487b5d19f54067c0b420fe252062aac/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Ftimer%2Fwaitable%2Fops.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/250b95a99487b5d19f54067c0b420fe252062aac/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Ftimer%2Fwaitable%2Fops.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Ftimer%2Fwaitable%2Fops.cc?ref=250b95a99487b5d19f54067c0b420fe252062aac", "patch": "@@ -17,6 +17,7 @@\n \n // { dg-do run { target c++14 } }\n // { dg-add-options libatomic }\n+// { dg-xfail-if \"poll not available\" { *-*-rtems* } }\n \n #include <experimental/timer>\n #include <testsuite_hooks.h>"}, {"sha": "cc312edc172e41807369122cd7fc2e35ae9d78ed", "filename": "libstdc++-v3/testsuite/lib/dg-options.exp", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/250b95a99487b5d19f54067c0b420fe252062aac/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Fdg-options.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/250b95a99487b5d19f54067c0b420fe252062aac/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Fdg-options.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Fdg-options.exp?ref=250b95a99487b5d19f54067c0b420fe252062aac", "patch": "@@ -281,11 +281,7 @@ proc add_options_for_net_ts { flags } {\n     if { [istarget *-*-solaris2*] } {\n \treturn \"$flags -lsocket -lnsl\"\n     } elseif { [istarget *-*-rtems*] } {\n-\t# Adding -Wl,--gc-sections would enable a few more tests to\n-\t# link, but all of them fail at runtime anyway, because the\n-\t# io_context ctor calls pipe(), which always fails, and thus\n-\t# the ctor throws a system error.\n-\treturn \"$flags -lbsd\"\n+\treturn \"$flags -lbsd -Wl,--gc-sections\"\n     }\n     return $flags\n }"}]}