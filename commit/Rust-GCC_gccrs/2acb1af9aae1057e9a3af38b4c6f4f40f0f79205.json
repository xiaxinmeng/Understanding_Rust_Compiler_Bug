{"sha": "2acb1af9aae1057e9a3af38b4c6f4f40f0f79205", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmFjYjFhZjlhYWUxMDU3ZTlhM2FmMzhiNGM2ZjRmNDBmMGY3OTIwNQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2005-10-14T08:38:59Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2005-10-14T08:38:59Z"}, "message": "re PR c++/23984 (second operand of PLUS_EXPR is NULL (in constructor))\n\ncp:\n\tPR c++/23984\n\t* class.c (build_base_path): The vtable is always the first thing\n\tin the vtt.\ntestsuite:\n\tPR c++/23984\n\t* g++.dg/init/ctor7.C: New.\n\nFrom-SVN: r105396", "tree": {"sha": "c983855f345976b96424a89472edf36390feb567", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c983855f345976b96424a89472edf36390feb567"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2acb1af9aae1057e9a3af38b4c6f4f40f0f79205", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2acb1af9aae1057e9a3af38b4c6f4f40f0f79205", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2acb1af9aae1057e9a3af38b4c6f4f40f0f79205", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2acb1af9aae1057e9a3af38b4c6f4f40f0f79205/comments", "author": null, "committer": null, "parents": [{"sha": "9da32d6309c03def6f4c2d661547c36024381d4e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9da32d6309c03def6f4c2d661547c36024381d4e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9da32d6309c03def6f4c2d661547c36024381d4e"}], "stats": {"total": 72, "additions": 66, "deletions": 6}, "files": [{"sha": "75ca0198b237df69bd675780208e692c69de2a98", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2acb1af9aae1057e9a3af38b4c6f4f40f0f79205/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2acb1af9aae1057e9a3af38b4c6f4f40f0f79205/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=2acb1af9aae1057e9a3af38b4c6f4f40f0f79205", "patch": "@@ -1,3 +1,9 @@\n+2005-10-13  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\tPR c++/23984\n+\t* class.c (build_base_path): The vtable is always the first thing\n+\tin the vtt.\n+\n 2005-10-13  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/20721"}, {"sha": "dc52975204b208f7e38da8aa298fbd7569830139", "filename": "gcc/cp/class.c", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2acb1af9aae1057e9a3af38b4c6f4f40f0f79205/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2acb1af9aae1057e9a3af38b4c6f4f40f0f79205/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=2acb1af9aae1057e9a3af38b4c6f4f40f0f79205", "patch": "@@ -325,16 +325,14 @@ build_base_path (enum tree_code code,\n \n       if (fixed_type_p < 0 && in_base_initializer)\n \t{\n-\t  /* In a base member initializer, we cannot rely on\n-\t     the vtable being set up. We have to use the vtt_parm.  */\n-\t  tree derived = BINFO_INHERITANCE_CHAIN (v_binfo);\n+\t  /* In a base member initializer, we cannot rely on the\n+\t     vtable being set up.  We have to indirect via the\n+\t     vtt_parm.  */\n \t  tree t;\n \n-\t  t = TREE_TYPE (TYPE_VFIELD (BINFO_TYPE (derived)));\n+\t  t = TREE_TYPE (TYPE_VFIELD (current_class_type));\n \t  t = build_pointer_type (t);\n \t  v_offset = convert (t, current_vtt_parm);\n-\t  v_offset = build2 (PLUS_EXPR, t, v_offset,\n-\t\t\t     BINFO_VPTR_INDEX (derived));\n \t  v_offset = build_indirect_ref (v_offset, NULL);\n \t}\n       else"}, {"sha": "a119dca6aa44c975fb66e5e9531eabfe8c8e36e4", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2acb1af9aae1057e9a3af38b4c6f4f40f0f79205/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2acb1af9aae1057e9a3af38b4c6f4f40f0f79205/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2acb1af9aae1057e9a3af38b4c6f4f40f0f79205", "patch": "@@ -1,3 +1,8 @@\n+2005-10-14  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\tPR c++/23984\n+\t* g++.dg/init/ctor7.C: New.\n+\n 2005-10-13  David Edelsohn  <edelsohn@gnu.org>\n \n \tPR c++/23730"}, {"sha": "3378a150e2e0267d09fbe35e5a6dcdb005fab5c9", "filename": "gcc/testsuite/g++.dg/init/ctor7.C", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2acb1af9aae1057e9a3af38b4c6f4f40f0f79205/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fctor7.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2acb1af9aae1057e9a3af38b4c6f4f40f0f79205/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fctor7.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fctor7.C?ref=2acb1af9aae1057e9a3af38b4c6f4f40f0f79205", "patch": "@@ -0,0 +1,51 @@\n+// { dg-do run }\n+\n+// Copyright (C) 2005 Free Software Foundation, Inc.\n+// Contributed by Nathan Sidwell 13 Oct 2005 <nathan@codesourcery.com>\n+\n+// PR 23984:ICE\n+// Origin:  Andrew Pinski pinskia@gcc.gnu.org\n+\n+struct B\n+{\n+  virtual void Foo ();\n+};\n+\n+void B::Foo ()\n+{\n+}\n+\n+struct D : virtual B\n+{\n+};\n+\n+struct E\n+{\n+  B *ptr;\n+  \n+  E (B *);\n+};\n+\n+static B *ptr;\n+\n+E::E (B *ptr_)\n+  :ptr (ptr_)\n+{\n+}\n+\n+struct G : D, E\n+{\n+  G ();\n+};\n+\n+G::G ()\n+  : E (this)\n+{\n+}\n+\n+int main ()\n+{\n+  G object;\n+\n+  return object.ptr != &object;\n+}"}]}