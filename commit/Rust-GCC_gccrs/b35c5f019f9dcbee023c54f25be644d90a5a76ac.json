{"sha": "b35c5f019f9dcbee023c54f25be644d90a5a76ac", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjM1YzVmMDE5ZjlkY2JlZTAyM2M1NGYyNWJlNjQ0ZDkwYTVhNzZhYw==", "commit": {"author": {"name": "Tobias Schl\u00fcter", "email": "tobi@gcc.gnu.org", "date": "2007-09-02T15:04:11Z"}, "committer": {"name": "Tobias Schl\u00fcter", "email": "tobi@gcc.gnu.org", "date": "2007-09-02T15:04:11Z"}, "message": "dump-parse-tree.c (show_char_const): New function.\n\nfortran/\n* dump-parse-tree.c (show_char_const): New function.\n(gfc_show_expr): Use it.\n* expr.c (find_substring_ref): Rework to not keep characters\ndangling beyond end of string.\ntestsuite/\n* gfortran.dg/substr_6.f90: New test.\n\nFrom-SVN: r128027", "tree": {"sha": "b1033e746be3cb7c89de5e10ac9e96f485193407", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b1033e746be3cb7c89de5e10ac9e96f485193407"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b35c5f019f9dcbee023c54f25be644d90a5a76ac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b35c5f019f9dcbee023c54f25be644d90a5a76ac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b35c5f019f9dcbee023c54f25be644d90a5a76ac", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b35c5f019f9dcbee023c54f25be644d90a5a76ac/comments", "author": {"login": "TobiSchluter", "id": 11887541, "node_id": "MDQ6VXNlcjExODg3NTQx", "avatar_url": "https://avatars.githubusercontent.com/u/11887541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobiSchluter", "html_url": "https://github.com/TobiSchluter", "followers_url": "https://api.github.com/users/TobiSchluter/followers", "following_url": "https://api.github.com/users/TobiSchluter/following{/other_user}", "gists_url": "https://api.github.com/users/TobiSchluter/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobiSchluter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobiSchluter/subscriptions", "organizations_url": "https://api.github.com/users/TobiSchluter/orgs", "repos_url": "https://api.github.com/users/TobiSchluter/repos", "events_url": "https://api.github.com/users/TobiSchluter/events{/privacy}", "received_events_url": "https://api.github.com/users/TobiSchluter/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TobiSchluter", "id": 11887541, "node_id": "MDQ6VXNlcjExODg3NTQx", "avatar_url": "https://avatars.githubusercontent.com/u/11887541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobiSchluter", "html_url": "https://github.com/TobiSchluter", "followers_url": "https://api.github.com/users/TobiSchluter/followers", "following_url": "https://api.github.com/users/TobiSchluter/following{/other_user}", "gists_url": "https://api.github.com/users/TobiSchluter/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobiSchluter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobiSchluter/subscriptions", "organizations_url": "https://api.github.com/users/TobiSchluter/orgs", "repos_url": "https://api.github.com/users/TobiSchluter/repos", "events_url": "https://api.github.com/users/TobiSchluter/events{/privacy}", "received_events_url": "https://api.github.com/users/TobiSchluter/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3c83544d6217312fff8dd1808e626e3c6188d449", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3c83544d6217312fff8dd1808e626e3c6188d449", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3c83544d6217312fff8dd1808e626e3c6188d449"}], "stats": {"total": 86, "additions": 58, "deletions": 28}, "files": [{"sha": "d6c5e0946f73d4f91312177d1aa902dcd0d73521", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b35c5f019f9dcbee023c54f25be644d90a5a76ac/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b35c5f019f9dcbee023c54f25be644d90a5a76ac/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=b35c5f019f9dcbee023c54f25be644d90a5a76ac", "patch": "@@ -1,3 +1,10 @@\n+2007-09-02  Tobias Schl\ufffduter  <tobi@gcc.gnu.org>\n+\n+\t* dump-parse-tree.c (show_char_const): New function.\n+\t(gfc_show_expr): Use it.\n+\t* expr.c (find_substring_ref): Rework to not keep characters\n+\tdangling beyond end of string.\n+\n 2007-09-02  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR fortran/33276"}, {"sha": "ce46e3513f780207a7f60ad9066e070d7453caad", "filename": "gcc/fortran/dump-parse-tree.c", "status": "modified", "additions": 25, "deletions": 24, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b35c5f019f9dcbee023c54f25be644d90a5a76ac/gcc%2Ffortran%2Fdump-parse-tree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b35c5f019f9dcbee023c54f25be644d90a5a76ac/gcc%2Ffortran%2Fdump-parse-tree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdump-parse-tree.c?ref=b35c5f019f9dcbee023c54f25be644d90a5a76ac", "patch": "@@ -290,6 +290,28 @@ gfc_show_constructor (gfc_constructor *c)\n }\n \n \n+static void\n+show_char_const (const char *c, int length)\n+{\n+  int i;\n+\n+  gfc_status_char ('\\'');\n+  for (i = 0; i < length; i++)\n+    {\n+      if (c[i] == '\\'')\n+\tgfc_status (\"''\");\n+      else if (ISPRINT (c[i]))\n+\tgfc_status_char (c[i]);\n+      else\n+\t{\n+\t  gfc_status (\"' // ACHAR(\");\n+\t  printf (\"%d\", c[i]);\n+\t  gfc_status (\") // '\");\n+\t}\n+    }\n+  gfc_status_char ('\\'');\n+}\n+\n /* Show an expression.  */\n \n void\n@@ -307,16 +329,7 @@ gfc_show_expr (gfc_expr *p)\n   switch (p->expr_type)\n     {\n     case EXPR_SUBSTRING:\n-      c = p->value.character.string;\n-\n-      for (i = 0; i < p->value.character.length; i++, c++)\n-\t{\n-\t  if (*c == '\\'')\n-\t    gfc_status (\"''\");\n-\t  else\n-\t    gfc_status (\"%c\", *c);\n-\t}\n-\n+      show_char_const (p->value.character.string, p->value.character.length);\n       gfc_show_ref (p->ref);\n       break;\n \n@@ -362,20 +375,8 @@ gfc_show_expr (gfc_expr *p)\n \t  break;\n \n \tcase BT_CHARACTER:\n-\t  c = p->value.character.string;\n-\n-\t  gfc_status_char ('\\'');\n-\n-\t  for (i = 0; i < p->value.character.length; i++, c++)\n-\t    {\n-\t      if (*c == '\\'')\n-\t\tgfc_status (\"''\");\n-\t      else\n-\t\tgfc_status_char (*c);\n-\t    }\n-\n-\t  gfc_status_char ('\\'');\n-\n+\t  show_char_const (p->value.character.string, \n+\t\t\t   p->value.character.length);\n \t  break;\n \n \tcase BT_COMPLEX:"}, {"sha": "ebed1f2283286066397e9c5770b8ca6579e67e06", "filename": "gcc/fortran/expr.c", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b35c5f019f9dcbee023c54f25be644d90a5a76ac/gcc%2Ffortran%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b35c5f019f9dcbee023c54f25be644d90a5a76ac/gcc%2Ffortran%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fexpr.c?ref=b35c5f019f9dcbee023c54f25be644d90a5a76ac", "patch": "@@ -1329,20 +1329,24 @@ find_substring_ref (gfc_expr *p, gfc_expr **newp)\n {\n   int end;\n   int start;\n+  int length;\n   char *chr;\n \n   if (p->ref->u.ss.start->expr_type != EXPR_CONSTANT\n       || p->ref->u.ss.end->expr_type != EXPR_CONSTANT)\n     return FAILURE;\n \n   *newp = gfc_copy_expr (p);\n-  chr = p->value.character.string;\n+  gfc_free ((*newp)->value.character.string);\n+\n   end = (int) mpz_get_ui (p->ref->u.ss.end->value.integer);\n   start = (int) mpz_get_ui (p->ref->u.ss.start->value.integer);\n+  length = end - start + 1;\n \n-  (*newp)->value.character.length = end - start + 1;\n-  strncpy ((*newp)->value.character.string, &chr[start - 1],\n-\t   (*newp)->value.character.length);\n+  chr = (*newp)->value.character.string = gfc_getmem (length + 1);\n+  (*newp)->value.character.length = length;\n+  memcpy (chr, &p->value.character.string[start - 1], length);\n+  chr[length] = '\\0';\n   return SUCCESS;\n }\n "}, {"sha": "63b0967737565a598ff40ce0c04d553e0c5286e7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b35c5f019f9dcbee023c54f25be644d90a5a76ac/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b35c5f019f9dcbee023c54f25be644d90a5a76ac/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b35c5f019f9dcbee023c54f25be644d90a5a76ac", "patch": "@@ -1,3 +1,7 @@\n+2007-09-02  Tobias Schl\ufffduter  <tobi@gcc.gnu.org>\n+\n+\t* gfortran.dg/substr_6.f90: New test.\n+\n 2007-09-02  Paolo Carlini  <pcarlini@suse.de>\n \n \tPR c++/33208"}, {"sha": "ee0eae49e0ea42ac0ce2b014207fa361c3acc81a", "filename": "gcc/testsuite/gfortran.dg/substr_6.f90", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b35c5f019f9dcbee023c54f25be644d90a5a76ac/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubstr_6.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b35c5f019f9dcbee023c54f25be644d90a5a76ac/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubstr_6.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubstr_6.f90?ref=b35c5f019f9dcbee023c54f25be644d90a5a76ac", "patch": "@@ -0,0 +1,14 @@\n+! { dg-do run }\n+! Check that NULs don't mess up constant substring simplification\n+CHARACTER(5), parameter :: c0(1) = (/ \"123\" // ACHAR(0) // \"5\" /)\n+CHARACTER*5 c(1)\n+CHARACTER(1), parameter :: c1(5) = (/ \"1\", \"2\", \"3\", ACHAR(0), \"5\" /)\n+\n+c = c0(1)(-5:-8)\n+if (c(1) /= \"     \") call abort()\n+c = (/ c0(1)(1:5) /)\n+do i=1,5\n+   if (c(1)(i:i) /= c1(i)) call abort()\n+end do\n+print *, c(1)\n+end"}]}