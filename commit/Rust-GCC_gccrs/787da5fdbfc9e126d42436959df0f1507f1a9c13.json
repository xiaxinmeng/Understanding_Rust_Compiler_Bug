{"sha": "787da5fdbfc9e126d42436959df0f1507f1a9c13", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Nzg3ZGE1ZmRiZmM5ZTEyNmQ0MjQzNjk1OWRmMGYxNTA3ZjFhOWMxMw==", "commit": {"author": {"name": "Joost VandeVondele", "email": "vondele@gcc.gnu.org", "date": "2015-10-19T10:24:37Z"}, "committer": {"name": "Joost VandeVondele", "email": "vondele@gcc.gnu.org", "date": "2015-10-19T10:24:37Z"}, "message": "Fix PR68002, add -fkeep-static-functions\n\ngcc/ChangeLog:\n\n2015-10-17  Joost VandeVondele  <vondele@gnu.gcc.org>\n\n        PR middle-end/68002\n        * common.opt (fkeep-static-functions): New option.\n        * doc/invoke.texi: Document it.\n        * cgraphunit.c (cgraph_node::finalize_function): Use it.\n\ngcc/testsuite/ChangeLog:\n\n2015-10-17  Joost VandeVondele  <vondele@gnu.gcc.org>\n\n        PR middle-end/68002\n        * gcc.dg/PR68002.c: New test.\n\nFrom-SVN: r228965", "tree": {"sha": "29da81662086457f8b063de69a5914e50c81d499", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/29da81662086457f8b063de69a5914e50c81d499"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/787da5fdbfc9e126d42436959df0f1507f1a9c13", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/787da5fdbfc9e126d42436959df0f1507f1a9c13", "html_url": "https://github.com/Rust-GCC/gccrs/commit/787da5fdbfc9e126d42436959df0f1507f1a9c13", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/787da5fdbfc9e126d42436959df0f1507f1a9c13/comments", "author": {"login": "vondele", "id": 4202567, "node_id": "MDQ6VXNlcjQyMDI1Njc=", "avatar_url": "https://avatars.githubusercontent.com/u/4202567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vondele", "html_url": "https://github.com/vondele", "followers_url": "https://api.github.com/users/vondele/followers", "following_url": "https://api.github.com/users/vondele/following{/other_user}", "gists_url": "https://api.github.com/users/vondele/gists{/gist_id}", "starred_url": "https://api.github.com/users/vondele/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vondele/subscriptions", "organizations_url": "https://api.github.com/users/vondele/orgs", "repos_url": "https://api.github.com/users/vondele/repos", "events_url": "https://api.github.com/users/vondele/events{/privacy}", "received_events_url": "https://api.github.com/users/vondele/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vondele", "id": 4202567, "node_id": "MDQ6VXNlcjQyMDI1Njc=", "avatar_url": "https://avatars.githubusercontent.com/u/4202567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vondele", "html_url": "https://github.com/vondele", "followers_url": "https://api.github.com/users/vondele/followers", "following_url": "https://api.github.com/users/vondele/following{/other_user}", "gists_url": "https://api.github.com/users/vondele/gists{/gist_id}", "starred_url": "https://api.github.com/users/vondele/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vondele/subscriptions", "organizations_url": "https://api.github.com/users/vondele/orgs", "repos_url": "https://api.github.com/users/vondele/repos", "events_url": "https://api.github.com/users/vondele/events{/privacy}", "received_events_url": "https://api.github.com/users/vondele/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9c99fe750c477ab4408f48d8df2cd186307159ff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c99fe750c477ab4408f48d8df2cd186307159ff", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9c99fe750c477ab4408f48d8df2cd186307159ff"}], "stats": {"total": 34, "additions": 31, "deletions": 3}, "files": [{"sha": "43d6a3f83bf0b0054896af0ae3f2c2a20a42bd94", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/787da5fdbfc9e126d42436959df0f1507f1a9c13/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/787da5fdbfc9e126d42436959df0f1507f1a9c13/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=787da5fdbfc9e126d42436959df0f1507f1a9c13", "patch": "@@ -1,3 +1,10 @@\n+2015-10-19  Joost VandeVondele  <vondele@gnu.gcc.org>\n+\n+\tPR middle-end/68002\n+\t* common.opt (fkeep-static-functions): New option.\n+\t* doc/invoke.texi: Document it.\n+\t* cgraphunit.c (cgraph_node::finalize_function): Use it.\n+\n 2015-10-19  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n \n \t* sched-int.h (struct autopref_multipass_data_): Remove offset"}, {"sha": "0b0c0f4b6f49c9e071f79545d98c21580f9cfe8b", "filename": "gcc/cgraphunit.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/787da5fdbfc9e126d42436959df0f1507f1a9c13/gcc%2Fcgraphunit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/787da5fdbfc9e126d42436959df0f1507f1a9c13/gcc%2Fcgraphunit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraphunit.c?ref=787da5fdbfc9e126d42436959df0f1507f1a9c13", "patch": "@@ -451,7 +451,7 @@ cgraph_node::finalize_function (tree decl, bool no_collect)\n      declared inline and nested functions.  These were optimized out\n      in the original implementation and it is unclear whether we want\n      to change the behavior here.  */\n-  if ((!opt_for_fn (decl, optimize)\n+  if (((!opt_for_fn (decl, optimize) || flag_keep_static_functions)\n        && !node->cpp_implicit_alias\n        && !DECL_DISREGARD_INLINE_LIMITS (decl)\n        && !DECL_DECLARED_INLINE_P (decl)"}, {"sha": "224d3ad7fbd2517a2b416df1c423f3a6231487ad", "filename": "gcc/common.opt", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/787da5fdbfc9e126d42436959df0f1507f1a9c13/gcc%2Fcommon.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/787da5fdbfc9e126d42436959df0f1507f1a9c13/gcc%2Fcommon.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcommon.opt?ref=787da5fdbfc9e126d42436959df0f1507f1a9c13", "patch": "@@ -1589,6 +1589,10 @@ fkeep-inline-functions\n Common Report Var(flag_keep_inline_functions)\n Generate code for functions even if they are fully inlined\n \n+fkeep-static-functions\n+Common Report Var(flag_keep_static_functions)\n+Generate code for static functions even if they are never called \n+\n fkeep-static-consts\n Common Report Var(flag_keep_static_consts) Init(1)\n Emit static const variables even if they are not used"}, {"sha": "dba4023036000763da6bf441299e028aa9faf439", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/787da5fdbfc9e126d42436959df0f1507f1a9c13/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/787da5fdbfc9e126d42436959df0f1507f1a9c13/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=787da5fdbfc9e126d42436959df0f1507f1a9c13", "patch": "@@ -410,8 +410,8 @@ Objective-C and Objective-C++ Dialects}.\n -fira-loop-pressure -fno-ira-share-save-slots @gol\n -fno-ira-share-spill-slots -fira-verbose=@var{n} @gol\n -fisolate-erroneous-paths-dereference -fisolate-erroneous-paths-attribute @gol\n--fivopts -fkeep-inline-functions -fkeep-static-consts @gol\n--flive-range-shrinkage @gol\n+-fivopts -fkeep-inline-functions -fkeep-static-functions @gol\n+-fkeep-static-consts -flive-range-shrinkage @gol\n -floop-block -floop-interchange -floop-strip-mine @gol\n -floop-unroll-and-jam -floop-nest-optimize @gol\n -floop-parallelize-all -flra-remat -flto -flto-compression-level @gol\n@@ -8013,6 +8013,11 @@ of its callers.  This switch does not affect functions using the\n @code{extern inline} extension in GNU C90@.  In C++, emit any and all\n inline functions into the object file.\n \n+@item -fkeep-static-functions\n+@optindex fkeep-static-functions\n+Emit @code{static} functions into the object file, even if the function\n+is never used.\n+\n @item -fkeep-static-consts\n @opindex fkeep-static-consts\n Emit variables declared @code{static const} when optimization isn't turned"}, {"sha": "874632de3b2064c4027549c81559d653322e6c5f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/787da5fdbfc9e126d42436959df0f1507f1a9c13/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/787da5fdbfc9e126d42436959df0f1507f1a9c13/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=787da5fdbfc9e126d42436959df0f1507f1a9c13", "patch": "@@ -1,3 +1,8 @@\n+2015-10-17  Joost VandeVondele  <vondele@gnu.gcc.org>\n+\n+\tPR middle-end/68002\n+\t* gcc.dg/PR68002.c: New test.\n+\n 2015-10-19  Richard Sandiford  <richard.sandiford@arm.com>\n \n \t* gcc.dg/builtins-20.c: Remove undefined behavior."}, {"sha": "b61b0950f19c49752ddbf606f5a3fef76e02d887", "filename": "gcc/testsuite/gcc.dg/PR68002.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/787da5fdbfc9e126d42436959df0f1507f1a9c13/gcc%2Ftestsuite%2Fgcc.dg%2FPR68002.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/787da5fdbfc9e126d42436959df0f1507f1a9c13/gcc%2Ftestsuite%2Fgcc.dg%2FPR68002.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FPR68002.c?ref=787da5fdbfc9e126d42436959df0f1507f1a9c13", "patch": "@@ -0,0 +1,7 @@\n+/* Ensure static functions can be kept.  */\n+/* { dg-do compile } */\n+/* { dg-options \"-O1 -fkeep-static-functions\" } */\n+\n+static void bar () { }\n+\n+/* { dg-final { scan-assembler \"bar\" } } */"}]}