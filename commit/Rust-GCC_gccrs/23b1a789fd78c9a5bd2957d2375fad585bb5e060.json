{"sha": "23b1a789fd78c9a5bd2957d2375fad585bb5e060", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjNiMWE3ODlmZDc4YzlhNWJkMjk1N2QyMzc1ZmFkNTg1YmI1ZTA2MA==", "commit": {"author": {"name": "Jan Kratochvil", "email": "jan.kratochvil@redhat.com", "date": "2009-07-17T19:09:54Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2009-07-17T19:09:54Z"}, "message": "demangle.h (enum demangle_component_type <DEMANGLE_COMPONENT_GLOBAL_CONSTRUCTORS>) (enum demangle_component_type <DEMANGLE_COMPONENT_GLOBAL_DESTRUCTORS>): New.\n\ninclude\n2009-07-17  Jan Kratochvil  <jan.kratochvil@redhat.com>\n\n\t* demangle.h\n\t(enum demangle_component_type <DEMANGLE_COMPONENT_GLOBAL_CONSTRUCTORS>)\n\t(enum demangle_component_type <DEMANGLE_COMPONENT_GLOBAL_DESTRUCTORS>):\n\tNew.\nlibiberty\n2009-07-17  Jan Kratochvil  <jan.kratochvil@redhat.com>\n\n\t* cp-demangle.c (d_print_comp <DEMANGLE_COMPONENT_GLOBAL_CONSTRUCTORS>)\n\t(d_print_comp <DEMANGLE_COMPONENT_GLOBAL_DESTRUCTORS): New.\n\t(d_make_comp <DEMANGLE_COMPONENT_GLOBAL_CONSTRUCTORS>)\n\t(d_make_comp <DEMANGLE_COMPONENT_GLOBAL_DESTRUCTORS): New.\n\t(d_demangle_callback): The variable type is now declared as enum.\n\tReplace parser of _GLOBAL_ symbols by a d_make_comp call.\n\nFrom-SVN: r149756", "tree": {"sha": "35a27ed8e0c745eb394b8267477a628113ffd7f3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/35a27ed8e0c745eb394b8267477a628113ffd7f3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/23b1a789fd78c9a5bd2957d2375fad585bb5e060", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23b1a789fd78c9a5bd2957d2375fad585bb5e060", "html_url": "https://github.com/Rust-GCC/gccrs/commit/23b1a789fd78c9a5bd2957d2375fad585bb5e060", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23b1a789fd78c9a5bd2957d2375fad585bb5e060/comments", "author": {"login": "jankratochvil", "id": 1223939, "node_id": "MDQ6VXNlcjEyMjM5Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1223939?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jankratochvil", "html_url": "https://github.com/jankratochvil", "followers_url": "https://api.github.com/users/jankratochvil/followers", "following_url": "https://api.github.com/users/jankratochvil/following{/other_user}", "gists_url": "https://api.github.com/users/jankratochvil/gists{/gist_id}", "starred_url": "https://api.github.com/users/jankratochvil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jankratochvil/subscriptions", "organizations_url": "https://api.github.com/users/jankratochvil/orgs", "repos_url": "https://api.github.com/users/jankratochvil/repos", "events_url": "https://api.github.com/users/jankratochvil/events{/privacy}", "received_events_url": "https://api.github.com/users/jankratochvil/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a0ce0e6e57acacb2fb3ccbc1179dd5247401ea40", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0ce0e6e57acacb2fb3ccbc1179dd5247401ea40", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a0ce0e6e57acacb2fb3ccbc1179dd5247401ea40"}], "stats": {"total": 81, "additions": 63, "deletions": 18}, "files": [{"sha": "2c14069740b47311665e46131e779ce5982c694c", "filename": "include/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23b1a789fd78c9a5bd2957d2375fad585bb5e060/include%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23b1a789fd78c9a5bd2957d2375fad585bb5e060/include%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/include%2FChangeLog?ref=23b1a789fd78c9a5bd2957d2375fad585bb5e060", "patch": "@@ -1,3 +1,10 @@\n+2009-07-17  Jan Kratochvil  <jan.kratochvil@redhat.com>\n+\n+\t* demangle.h\n+\t(enum demangle_component_type <DEMANGLE_COMPONENT_GLOBAL_CONSTRUCTORS>)\n+\t(enum demangle_component_type <DEMANGLE_COMPONENT_GLOBAL_DESTRUCTORS>):\n+\tNew.\n+\n 2009-07-09  Jakub Jelinek  <jakub@redhat.com>\n \n \t* dwarf2.h (enum dwarf_location_atom): Add DW_OP_implicit_value"}, {"sha": "0bcae2fdbbb38a90fe15663b0fc1bccb94469281", "filename": "include/demangle.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23b1a789fd78c9a5bd2957d2375fad585bb5e060/include%2Fdemangle.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23b1a789fd78c9a5bd2957d2375fad585bb5e060/include%2Fdemangle.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/include%2Fdemangle.h?ref=23b1a789fd78c9a5bd2957d2375fad585bb5e060", "patch": "@@ -377,6 +377,10 @@ enum demangle_component_type\n   DEMANGLE_COMPONENT_CHARACTER,\n   /* A decltype type.  */\n   DEMANGLE_COMPONENT_DECLTYPE,\n+  /* Global constructors keyed to name.  */\n+  DEMANGLE_COMPONENT_GLOBAL_CONSTRUCTORS,\n+  /* Global destructors keyed to name.  */\n+  DEMANGLE_COMPONENT_GLOBAL_DESTRUCTORS,\n   /* A pack expansion.  */\n   DEMANGLE_COMPONENT_PACK_EXPANSION\n };"}, {"sha": "83f85e723c26dadd38c1420d0263fb0410b80f46", "filename": "libiberty/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23b1a789fd78c9a5bd2957d2375fad585bb5e060/libiberty%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23b1a789fd78c9a5bd2957d2375fad585bb5e060/libiberty%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2FChangeLog?ref=23b1a789fd78c9a5bd2957d2375fad585bb5e060", "patch": "@@ -1,3 +1,12 @@\n+2009-07-17  Jan Kratochvil  <jan.kratochvil@redhat.com>\n+\n+\t* cp-demangle.c (d_print_comp <DEMANGLE_COMPONENT_GLOBAL_CONSTRUCTORS>)\n+\t(d_print_comp <DEMANGLE_COMPONENT_GLOBAL_DESTRUCTORS): New.\n+\t(d_make_comp <DEMANGLE_COMPONENT_GLOBAL_CONSTRUCTORS>)\n+\t(d_make_comp <DEMANGLE_COMPONENT_GLOBAL_DESTRUCTORS): New.\n+\t(d_demangle_callback): The variable type is now declared as enum.\n+\tReplace parser of _GLOBAL_ symbols by a d_make_comp call.\n+\n 2009-06-21  Jakub Jelinek  <jakub@redhat.com>\n \n \t* hashtab.c (htab_traverse): Don't call htab_expand for"}, {"sha": "2c7296f7eef66f2830d906b003a3cf2c77b882d5", "filename": "libiberty/cp-demangle.c", "status": "modified", "additions": 43, "deletions": 18, "changes": 61, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23b1a789fd78c9a5bd2957d2375fad585bb5e060/libiberty%2Fcp-demangle.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23b1a789fd78c9a5bd2957d2375fad585bb5e060/libiberty%2Fcp-demangle.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fcp-demangle.c?ref=23b1a789fd78c9a5bd2957d2375fad585bb5e060", "patch": "@@ -819,6 +819,8 @@ d_make_comp (struct d_info *di, enum demangle_component_type type,\n     case DEMANGLE_COMPONENT_JAVA_RESOURCE:\n     case DEMANGLE_COMPONENT_DECLTYPE:\n     case DEMANGLE_COMPONENT_PACK_EXPANSION:\n+    case DEMANGLE_COMPONENT_GLOBAL_CONSTRUCTORS:\n+    case DEMANGLE_COMPONENT_GLOBAL_DESTRUCTORS:\n       if (left == NULL)\n \treturn NULL;\n       break;\n@@ -4054,6 +4056,16 @@ d_print_comp (struct d_print_info *dpi,\n \treturn;\n       }\n \n+    case DEMANGLE_COMPONENT_GLOBAL_CONSTRUCTORS:\n+      d_append_string (dpi, \"global constructors keyed to \");\n+      d_print_comp (dpi, dc->u.s_binary.left);\n+      return;\n+\n+    case DEMANGLE_COMPONENT_GLOBAL_DESTRUCTORS:\n+      d_append_string (dpi, \"global destructors keyed to \");\n+      d_print_comp (dpi, dc->u.s_binary.left);\n+      return;\n+\n     default:\n       d_print_error (dpi);\n       return;\n@@ -4484,33 +4496,30 @@ static int\n d_demangle_callback (const char *mangled, int options,\n                      demangle_callbackref callback, void *opaque)\n {\n-  int type;\n+  enum\n+    {\n+      DCT_TYPE,\n+      DCT_MANGLED,\n+      DCT_GLOBAL_CTORS,\n+      DCT_GLOBAL_DTORS\n+    }\n+  type;\n   struct d_info di;\n   struct demangle_component *dc;\n   int status;\n \n   if (mangled[0] == '_' && mangled[1] == 'Z')\n-    type = 0;\n+    type = DCT_MANGLED;\n   else if (strncmp (mangled, \"_GLOBAL_\", 8) == 0\n \t   && (mangled[8] == '.' || mangled[8] == '_' || mangled[8] == '$')\n \t   && (mangled[9] == 'D' || mangled[9] == 'I')\n \t   && mangled[10] == '_')\n-    {\n-      const char *intro;\n-\n-      intro = (mangled[9] == 'I')\n-              ? \"global constructors keyed to \"\n-              : \"global destructors keyed to \";\n-\n-      callback (intro, strlen (intro), opaque);\n-      callback (mangled + 11, strlen (mangled + 11), opaque);\n-      return 1;\n-    }\n+    type = mangled[9] == 'I' ? DCT_GLOBAL_CTORS : DCT_GLOBAL_DTORS;\n   else\n     {\n       if ((options & DMGL_TYPES) == 0)\n \treturn 0;\n-      type = 1;\n+      type = DCT_TYPE;\n     }\n \n   cplus_demangle_init_info (mangled, options, strlen (mangled), &di);\n@@ -4527,10 +4536,26 @@ d_demangle_callback (const char *mangled, int options,\n     di.subs = alloca (di.num_subs * sizeof (*di.subs));\n #endif\n \n-    if (type)\n-      dc = cplus_demangle_type (&di);\n-    else\n-      dc = cplus_demangle_mangled_name (&di, 1);\n+    switch (type)\n+      {\n+      case DCT_TYPE:\n+\tdc = cplus_demangle_type (&di);\n+\tbreak;\n+      case DCT_MANGLED:\n+\tdc = cplus_demangle_mangled_name (&di, 1);\n+\tbreak;\n+      case DCT_GLOBAL_CTORS:\n+      case DCT_GLOBAL_DTORS:\n+\td_advance (&di, 11);\n+\tdc = d_make_comp (&di,\n+\t\t\t  (type == DCT_GLOBAL_CTORS\n+\t\t\t   ? DEMANGLE_COMPONENT_GLOBAL_CONSTRUCTORS\n+\t\t\t   : DEMANGLE_COMPONENT_GLOBAL_DESTRUCTORS),\n+\t\t\t  d_make_name (&di, d_str (&di), strlen (d_str (&di))),\n+\t\t\t  NULL);\n+\td_advance (&di, strlen (d_str (&di)));\n+\tbreak;\n+      }\n \n     /* If DMGL_PARAMS is set, then if we didn't consume the entire\n        mangled string, then we didn't successfully demangle it.  If"}]}