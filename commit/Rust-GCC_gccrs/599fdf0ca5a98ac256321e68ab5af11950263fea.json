{"sha": "599fdf0ca5a98ac256321e68ab5af11950263fea", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTk5ZmRmMGNhNWE5OGFjMjU2MzIxZTY4YWI1YWYxMTk1MDI2M2ZlYQ==", "commit": {"author": {"name": "Hans-Peter Nilsson", "email": "hp@axis.com", "date": "2010-10-07T21:46:51Z"}, "committer": {"name": "Hans-Peter Nilsson", "email": "hp@gcc.gnu.org", "date": "2010-10-07T21:46:51Z"}, "message": "re PR libstdc++/45841 (r164529 cris-elf libstdc++ 27_io/basic_filebuf/seekoff/char/2-io.cc)\n\n\tPR libstdc++/45841\n\t* testsuite/lib/libstdc++.exp (check_v3_target_fileio): Rewrite to\n\tuse an actual testsuite file and machinery, not \".\".  Specifically\n\tcheck that incorrectly seeking backwards from 0 yields an error,\n\tand that reading, seeking backwards and reading again works.\n\nFrom-SVN: r165136", "tree": {"sha": "0686b70bd1d6f9d07c393fd73d751ee3dfe482f4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0686b70bd1d6f9d07c393fd73d751ee3dfe482f4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/599fdf0ca5a98ac256321e68ab5af11950263fea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/599fdf0ca5a98ac256321e68ab5af11950263fea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/599fdf0ca5a98ac256321e68ab5af11950263fea", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/599fdf0ca5a98ac256321e68ab5af11950263fea/comments", "author": {"login": "hpataxisdotcom", "id": 80339731, "node_id": "MDQ6VXNlcjgwMzM5NzMx", "avatar_url": "https://avatars.githubusercontent.com/u/80339731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hpataxisdotcom", "html_url": "https://github.com/hpataxisdotcom", "followers_url": "https://api.github.com/users/hpataxisdotcom/followers", "following_url": "https://api.github.com/users/hpataxisdotcom/following{/other_user}", "gists_url": "https://api.github.com/users/hpataxisdotcom/gists{/gist_id}", "starred_url": "https://api.github.com/users/hpataxisdotcom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hpataxisdotcom/subscriptions", "organizations_url": "https://api.github.com/users/hpataxisdotcom/orgs", "repos_url": "https://api.github.com/users/hpataxisdotcom/repos", "events_url": "https://api.github.com/users/hpataxisdotcom/events{/privacy}", "received_events_url": "https://api.github.com/users/hpataxisdotcom/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "38851a969d70820c9519bf99e569e1da0a55ffe6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38851a969d70820c9519bf99e569e1da0a55ffe6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/38851a969d70820c9519bf99e569e1da0a55ffe6"}], "stats": {"total": 29, "additions": 22, "deletions": 7}, "files": [{"sha": "10939d8f0dc29f0158ed091f3faf4bf01d3063ce", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/599fdf0ca5a98ac256321e68ab5af11950263fea/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/599fdf0ca5a98ac256321e68ab5af11950263fea/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=599fdf0ca5a98ac256321e68ab5af11950263fea", "patch": "@@ -1,5 +1,11 @@\n 2010-10-07  Hans-Peter Nilsson  <hp@axis.com>\n \n+\tPR libstdc++/45841\n+\t* testsuite/lib/libstdc++.exp (check_v3_target_fileio): Rewrite to\n+\tuse an actual testsuite file and machinery, not \".\".  Specifically\n+\tcheck that incorrectly seeking backwards from 0 yields an error,\n+\tand that reading, seeking backwards and reading again works.\n+\n \t* testsuite/libstdc++-dg/conformance.exp: Apply\n \tcheck_v3_target_fileio as a gate for tests in\n \tsubdirectories matching the substring _filebuf."}, {"sha": "a0279a55485a5e0df70f20cd78a49a09037ccc89", "filename": "libstdc++-v3/testsuite/lib/libstdc++.exp", "status": "modified", "additions": 16, "deletions": 7, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/599fdf0ca5a98ac256321e68ab5af11950263fea/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/599fdf0ca5a98ac256321e68ab5af11950263fea/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp?ref=599fdf0ca5a98ac256321e68ab5af11950263fea", "patch": "@@ -631,6 +631,7 @@ proc check_v3_target_fileio { } {\n     global et_fileio_saved\n     global et_fileio_target_name\n     global tool\t\n+    global srcdir\n \n     if { ![info exists et_fileio_target_name] } {\n \tset et_fileio_target_name \"\"\n@@ -656,27 +657,35 @@ proc check_v3_target_fileio { } {\n \t# the file functions\n \tset src fileio[pid].cc\n \tset exe fileio[pid].x\n+\tset testfile \"cin_unget-1.txt\"\n+\tv3-copy-files \"$srcdir/data/$testfile\"\n \n \tset f [open $src \"w\"]\n \tputs $f \"#include <sys/types.h>\"\n \tputs $f \"#include <sys/stat.h>\"\n \tputs $f \"#include <fcntl.h>\"\n \tputs $f \"#include <unistd.h>\"\n \tputs $f \"#include <errno.h>\"\n+\tputs $f \"#include <string.h>\"\n \tputs $f \"using namespace std;\"\t\n \tputs $f \"int main ()\"\n \tputs $f \"{\"\n-\tputs $f \"  int fd  = open (\\\".\\\", O_RDONLY);\"\n+\tputs $f \"  int fd  = open (\\\"$testfile\\\", O_RDONLY);\"\n \tputs $f \"  int ret = 0;\"\n+\tputs $f \"  char buf\\[10\\];\"\n \tputs $f \"  if (fd == -1)\"\n-\tputs $f \"  {\"\n-\tputs $f \"    int err = errno;\"\n-\tputs $f \"    if (err == EIO || err == ENOSYS)\"\n-\tputs $f \"      ret = 1;\"\n-\tputs $f \"  }\"\n+\tputs $f \"    ret = 1;\"\n \tputs $f \"  else\"\n \tputs $f \"  {\"\n-\tputs $f \"    if (lseek (fd, 0, SEEK_CUR) == -1)\"\n+\tputs $f \"    if (lseek (fd, -1, SEEK_CUR) != -1 || errno != EINVAL)\"\n+\tputs $f \"      ret = 1;\"\n+\tputs $f \"    errno = 0;\"\n+\tputs $f \"    if (lseek (fd, 0, SEEK_CUR) != 0\"\n+\tputs $f \"        || read (fd, buf, 4) != 4\"\n+\tputs $f \"        || memcmp (buf, \\\"1234\\\", 4) != 0\"\n+\tputs $f \"        || lseek (fd, -2, SEEK_CUR) != 2\"\n+\tputs $f \"        || read (fd, buf, 2) != 2\"\n+\tputs $f \"        || memcmp (buf, \\\"34\\\", 2) != 0)\"\n \tputs $f \"      ret = 1;\"\n \tputs $f \"    close (fd);\"\n \tputs $f \"  }\""}]}