{"sha": "e38fdc948a93ebe926ecbd243f1f78dbe018b853", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTM4ZmRjOTQ4YTkzZWJlOTI2ZWNiZDI0M2YxZjc4ZGJlMDE4Yjg1Mw==", "commit": {"author": {"name": "Ira Rosen", "email": "ira.rosen@linaro.org", "date": "2011-05-22T08:04:43Z"}, "committer": {"name": "Ira Rosen", "email": "irar@gcc.gnu.org", "date": "2011-05-22T08:04:43Z"}, "message": "re PR tree-optimization/49087 (crash in vect_is_slp_reduction)\n\n\n        PR tree-optimization/49087\n        * tree-vect-loop.c (vect_is_slp_reduction): Fail if\n        LHS has no uses.\n\nFrom-SVN: r174026", "tree": {"sha": "eb2861bc300eff037666eee88dcb1209c8bb5d8d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eb2861bc300eff037666eee88dcb1209c8bb5d8d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e38fdc948a93ebe926ecbd243f1f78dbe018b853", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e38fdc948a93ebe926ecbd243f1f78dbe018b853", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e38fdc948a93ebe926ecbd243f1f78dbe018b853", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e38fdc948a93ebe926ecbd243f1f78dbe018b853/comments", "author": null, "committer": null, "parents": [{"sha": "5b018c651a9ba855b19e60ad354c21400cc343a2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b018c651a9ba855b19e60ad354c21400cc343a2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5b018c651a9ba855b19e60ad354c21400cc343a2"}], "stats": {"total": 56, "additions": 55, "deletions": 1}, "files": [{"sha": "1ea25e418d448f45371144ebcab193d2f4785b85", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e38fdc948a93ebe926ecbd243f1f78dbe018b853/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e38fdc948a93ebe926ecbd243f1f78dbe018b853/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e38fdc948a93ebe926ecbd243f1f78dbe018b853", "patch": "@@ -1,3 +1,9 @@\n+2011-05-22  Ira Rosen  <ira.rosen@linaro.org>\n+\n+\tPR tree-optimization/49087\n+\t* tree-vect-loop.c (vect_is_slp_reduction): Fail if\n+\tLHS has no uses.\n+\n 2011-05-21  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/49092"}, {"sha": "0d937892dd2750448e8a24bae5802b5956bce35d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e38fdc948a93ebe926ecbd243f1f78dbe018b853/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e38fdc948a93ebe926ecbd243f1f78dbe018b853/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e38fdc948a93ebe926ecbd243f1f78dbe018b853", "patch": "@@ -1,3 +1,8 @@\n+2011-05-22  Ira Rosen  <ira.rosen@linaro.org>\n+\n+\tPR tree-optimization/49087\n+\t* gcc.dg/vect/O3-pr49087.c: New test.\n+\n 2011-05-21  Jason Merrill  <jason@redhat.com>\n \n \t* g++.dg/debug/const5.C: New."}, {"sha": "c897fbcd0c488fde33a0d3e212814e14f7b121b9", "filename": "gcc/testsuite/gcc.dg/vect/O3-pr49087.c", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e38fdc948a93ebe926ecbd243f1f78dbe018b853/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2FO3-pr49087.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e38fdc948a93ebe926ecbd243f1f78dbe018b853/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2FO3-pr49087.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2FO3-pr49087.c?ref=e38fdc948a93ebe926ecbd243f1f78dbe018b853", "patch": "@@ -0,0 +1,37 @@\n+/* { dg-do compile } */\n+\n+static char func2() { }\n+\n+struct S0\n+{\n+ int t;\n+};\n+\n+int g;\n+\n+struct S0 s0;\n+\n+int \n+foo (int arg)\n+{\n+  int *ptr = &g;\n+  int i, j;\n+  for (i = 0; i < 10; i += 1)\n+    {\n+      for (j = 0; j < 1; j += 1)\n+\t{\n+\t  int k;\n+\t  if (arg)\n+\t    {\n+\t      int l;\n+\t      for (k = 1; arg < 10; arg = func2 ())\n+\t\t{\n+\t\t  return l;\n+\t\t}\n+\t    }\n+\t  *ptr = func2 () ^ s0.t;\n+\t}\n+    }\n+}\n+\n+/* { dg-final { cleanup-tree-dump \"vect\" } } */"}, {"sha": "98bb113629e492afdac00b37922ab68c600932af", "filename": "gcc/tree-vect-loop.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e38fdc948a93ebe926ecbd243f1f78dbe018b853/gcc%2Ftree-vect-loop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e38fdc948a93ebe926ecbd243f1f78dbe018b853/gcc%2Ftree-vect-loop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop.c?ref=e38fdc948a93ebe926ecbd243f1f78dbe018b853", "patch": "@@ -1704,7 +1704,7 @@ vect_is_slp_reduction (loop_vec_info loop_info, gimple phi, gimple first_stmt)\n   tree lhs;\n   imm_use_iterator imm_iter;\n   use_operand_p use_p;\n-  int nloop_uses, size = 0;\n+  int nloop_uses, size = 0, nuses;\n   bool found = false;\n \n   if (loop != vect_loop)\n@@ -1715,9 +1715,11 @@ vect_is_slp_reduction (loop_vec_info loop_info, gimple phi, gimple first_stmt)\n   while (1)\n     {\n       nloop_uses = 0;\n+      nuses = 0;\n       FOR_EACH_IMM_USE_FAST (use_p, imm_iter, lhs)\n         {\n           use_stmt = USE_STMT (use_p);\n+          nuses++;\n           if (is_gimple_debug (use_stmt))\n             continue;\n \n@@ -1739,6 +1741,10 @@ vect_is_slp_reduction (loop_vec_info loop_info, gimple phi, gimple first_stmt)\n             return false;\n         }\n \n+      /* We reached a statement with no uses.  */\n+      if (nuses == 0)\n+\treturn false;\n+\n       if (found)\n         break;\n "}]}