{"sha": "8f6c317b3a16350698f3c9e0accb43a9b4acb4ae", "node_id": "C_kwDOANBUbNoAKDhmNmMzMTdiM2ExNjM1MDY5OGYzYzllMGFjY2I0M2E5YjRhY2I0YWU", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2022-06-14T12:05:53Z"}, "committer": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2022-06-14T12:05:53Z"}, "message": "Fix ipa-cp wrt volatile loads\n\nCheck for volatile flag to ipa_load_from_parm_agg.\n\ngcc/ChangeLog:\n\n2022-06-10  Jan Hubicka  <hubicka@ucw.cz>\n\n\tPR ipa/105739\n\t* ipa-prop.cc (ipa_load_from_parm_agg): Punt on volatile loads.\n\ngcc/testsuite/ChangeLog:\n\n2022-06-10  Jan Hubicka  <hubicka@ucw.cz>\n\n\t* gcc.dg/ipa/pr105739.c: New test.", "tree": {"sha": "174830d5fac2159ffe8a78df3f8fff266156b0c1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/174830d5fac2159ffe8a78df3f8fff266156b0c1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8f6c317b3a16350698f3c9e0accb43a9b4acb4ae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f6c317b3a16350698f3c9e0accb43a9b4acb4ae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8f6c317b3a16350698f3c9e0accb43a9b4acb4ae", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f6c317b3a16350698f3c9e0accb43a9b4acb4ae/comments", "author": null, "committer": null, "parents": [{"sha": "0247ad3e0f4a574273b42344fbaa9346599948f9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0247ad3e0f4a574273b42344fbaa9346599948f9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0247ad3e0f4a574273b42344fbaa9346599948f9"}], "stats": {"total": 34, "additions": 34, "deletions": 0}, "files": [{"sha": "c037668e7d8ac6701a043a80209708ec46511004", "filename": "gcc/ipa-prop.cc", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f6c317b3a16350698f3c9e0accb43a9b4acb4ae/gcc%2Fipa-prop.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f6c317b3a16350698f3c9e0accb43a9b4acb4ae/gcc%2Fipa-prop.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-prop.cc?ref=8f6c317b3a16350698f3c9e0accb43a9b4acb4ae", "patch": "@@ -1112,6 +1112,10 @@ ipa_load_from_parm_agg (struct ipa_func_body_info *fbi,\n   if (!base)\n     return false;\n \n+  /* We can not propagate across volatile loads.  */\n+  if (TREE_THIS_VOLATILE (op))\n+    return false;\n+\n   if (DECL_P (base))\n     {\n       int index = ipa_get_param_decl_index_1 (descriptors, base);"}, {"sha": "8dbe8fc24943405dff2d296871227ab0aae50153", "filename": "gcc/testsuite/gcc.dg/ipa/pr105739.c", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f6c317b3a16350698f3c9e0accb43a9b4acb4ae/gcc%2Ftestsuite%2Fgcc.dg%2Fipa%2Fpr105739.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f6c317b3a16350698f3c9e0accb43a9b4acb4ae/gcc%2Ftestsuite%2Fgcc.dg%2Fipa%2Fpr105739.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fipa%2Fpr105739.c?ref=8f6c317b3a16350698f3c9e0accb43a9b4acb4ae", "patch": "@@ -0,0 +1,30 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-optimized\" } */\n+\n+\n+__attribute__((noinline))\n+static int\n+test2(int a)\n+{\n+        if (__builtin_constant_p (a))\n+                __builtin_abort ();\n+        return a;\n+}\n+static int\n+test(int *a)\n+{\n+        int val = *(volatile int *)a;\n+        if (__builtin_constant_p (val))\n+                __builtin_abort ();\n+        if (val)\n+          return test2(val);\n+        return 0;\n+}\n+int a;\n+int\n+main()\n+{\n+        a = 0;\n+        return test (&a);\n+}\n+/* { dg-final { scan-tree-dump \"test2\" \"optimized\" } } */"}]}