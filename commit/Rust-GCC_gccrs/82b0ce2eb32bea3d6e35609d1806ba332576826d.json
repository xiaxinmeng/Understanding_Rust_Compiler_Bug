{"sha": "82b0ce2eb32bea3d6e35609d1806ba332576826d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODJiMGNlMmViMzJiZWEzZDZlMzU2MDlkMTgwNmJhMzMyNTc2ODI2ZA==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2017-08-29T19:40:21Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2017-08-29T19:40:21Z"}, "message": "Support copying local_specializations.\n\n\t* cp-tree.h (enum lss_policy): New.\n\t(local_specialization_stack): Add policy parameter to default ctor.\n\t* pt.c (local_specialization_stack): Copy local_specializations if\n\tlss_copy.\n\nFrom-SVN: r251424", "tree": {"sha": "10c63963369aa559008571925b862882ac197a20", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/10c63963369aa559008571925b862882ac197a20"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/82b0ce2eb32bea3d6e35609d1806ba332576826d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/82b0ce2eb32bea3d6e35609d1806ba332576826d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/82b0ce2eb32bea3d6e35609d1806ba332576826d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/82b0ce2eb32bea3d6e35609d1806ba332576826d/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a0ab7ccd216184853052cec1bce7900cbdeed0b4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0ab7ccd216184853052cec1bce7900cbdeed0b4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a0ab7ccd216184853052cec1bce7900cbdeed0b4"}], "stats": {"total": 16, "additions": 13, "deletions": 3}, "files": [{"sha": "b4e21f6f0643169419f897fd5ae64f678d854b10", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/82b0ce2eb32bea3d6e35609d1806ba332576826d/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/82b0ce2eb32bea3d6e35609d1806ba332576826d/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=82b0ce2eb32bea3d6e35609d1806ba332576826d", "patch": "@@ -1,5 +1,11 @@\n 2017-08-29  Jason Merrill  <jason@redhat.com>\n \n+\tSupport copying local_specializations.\n+\t* cp-tree.h (enum lss_policy): New.\n+\t(local_specialization_stack): Add policy parameter to default ctor.\n+\t* pt.c (local_specialization_stack): Copy local_specializations if\n+\tlss_copy.\n+\n \t* constexpr.c (potential_constant_expression_1): Add \"now\" parm.\n \t(is_constant_expression, require_constant_expression): New.\n \t(is_static_init_expression, is_nondependent_constant_expression)"}, {"sha": "a58e7bd0cc00f9922fc7119c417c20aa6ec1fab8", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/82b0ce2eb32bea3d6e35609d1806ba332576826d/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/82b0ce2eb32bea3d6e35609d1806ba332576826d/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=82b0ce2eb32bea3d6e35609d1806ba332576826d", "patch": "@@ -5117,9 +5117,10 @@ enum unification_kind_t {\n // An RAII class used to create a new pointer map for local\n // specializations. When the stack goes out of scope, the\n // previous pointer map is restored.\n+enum lss_policy { lss_blank, lss_copy };\n struct local_specialization_stack\n {\n-  local_specialization_stack ();\n+  local_specialization_stack (lss_policy = lss_blank);\n   ~local_specialization_stack ();\n \n   hash_map<tree, tree> *saved;"}, {"sha": "1b726ff53985e8b76d22f0e9e0e718d6642ec73d", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/82b0ce2eb32bea3d6e35609d1806ba332576826d/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/82b0ce2eb32bea3d6e35609d1806ba332576826d/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=82b0ce2eb32bea3d6e35609d1806ba332576826d", "patch": "@@ -77,10 +77,13 @@ static tree cur_stmt_expr;\n //\n // Implementation of the RAII helper for creating new local\n // specializations.\n-local_specialization_stack::local_specialization_stack ()\n+local_specialization_stack::local_specialization_stack (lss_policy policy)\n   : saved (local_specializations)\n {\n-  local_specializations = new hash_map<tree, tree>;\n+  if (policy == lss_blank || !saved)\n+    local_specializations = new hash_map<tree, tree>;\n+  else\n+    local_specializations = new hash_map<tree, tree>(*saved);\n }\n \n local_specialization_stack::~local_specialization_stack ()"}]}