{"sha": "4fb2b4f7ea6b80ae75d3efb6f86e7c6179080535", "node_id": "C_kwDOANBUbNoAKDRmYjJiNGY3ZWE2YjgwYWU3NWQzZWZiNmY4NmU3YzYxNzkwODA1MzU", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2022-05-24T08:41:43Z"}, "committer": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2022-05-24T08:45:26Z"}, "message": "OpenMP: Support nowait with Fortran [PR105378]\n\nFortran part to C/C++/libgomp\ncommit r13-724-gb43836914bdc2a37563cf31359b2c4803bfe4374\n\ngcc/fortran/\n\n\tPR c/105378\n\t* openmp.cc (gfc_match_omp_taskwait): Accept nowait.\n\ngcc/testsuite/\n\n\tPR c/105378\n\t* gfortran.dg/gomp/taskwait-depend-nowait-1.f90: New.\n\nlibgomp/\n\n\tPR c/105378\n\t* libgomp.texi (OpenMP 5.1): Set 'taskwait nowait' to 'Y'.\n\t* testsuite/libgomp.fortran/taskwait-depend-nowait-1.f90: New.", "tree": {"sha": "d47491145e4e0ef0d7fcb234c6c1d6599b9d7638", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d47491145e4e0ef0d7fcb234c6c1d6599b9d7638"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4fb2b4f7ea6b80ae75d3efb6f86e7c6179080535", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4fb2b4f7ea6b80ae75d3efb6f86e7c6179080535", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4fb2b4f7ea6b80ae75d3efb6f86e7c6179080535", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4fb2b4f7ea6b80ae75d3efb6f86e7c6179080535/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b646d7d279ae0c0d35564542d09866bf3e8afac0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b646d7d279ae0c0d35564542d09866bf3e8afac0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b646d7d279ae0c0d35564542d09866bf3e8afac0"}], "stats": {"total": 61, "additions": 59, "deletions": 2}, "files": [{"sha": "6172ec27687708c6e263868c3a439da3ba544835", "filename": "gcc/fortran/openmp.cc", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4fb2b4f7ea6b80ae75d3efb6f86e7c6179080535/gcc%2Ffortran%2Fopenmp.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4fb2b4f7ea6b80ae75d3efb6f86e7c6179080535/gcc%2Ffortran%2Fopenmp.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fopenmp.cc?ref=4fb2b4f7ea6b80ae75d3efb6f86e7c6179080535", "patch": "@@ -5701,7 +5701,8 @@ gfc_match_omp_taskwait (void)\n       new_st.ext.omp_clauses = NULL;\n       return MATCH_YES;\n     }\n-  return match_omp (EXEC_OMP_TASKWAIT, omp_mask (OMP_CLAUSE_DEPEND));\n+  return match_omp (EXEC_OMP_TASKWAIT,\n+\t\t    omp_mask (OMP_CLAUSE_DEPEND) | OMP_CLAUSE_NOWAIT);\n }\n \n "}, {"sha": "cd2f1d288be216648a2723161e600b7a335b5595", "filename": "gcc/testsuite/gfortran.dg/gomp/taskwait-depend-nowait-1.f90", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4fb2b4f7ea6b80ae75d3efb6f86e7c6179080535/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Ftaskwait-depend-nowait-1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4fb2b4f7ea6b80ae75d3efb6f86e7c6179080535/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Ftaskwait-depend-nowait-1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Ftaskwait-depend-nowait-1.f90?ref=4fb2b4f7ea6b80ae75d3efb6f86e7c6179080535", "patch": "@@ -0,0 +1,14 @@\n+subroutine foo (p)\n+  integer :: p(*)\n+  !$omp taskwait depend(iterator(i = 1:17) , in : p(i)) nowait depend(out : p(32))\n+end\n+\n+subroutine bar (p)\n+  implicit none\n+  integer :: p(*)\n+  !$omp taskwait depend(mutexinoutset : p(1)) nowait\t! { dg-error \"'mutexinoutset' kind in 'depend' clause on a 'taskwait' construct\" }\n+end\n+\n+subroutine baz\n+  !$omp taskwait nowait\t! { dg-error \"'taskwait' construct with 'nowait' clause but no 'depend' clauses\" }\n+end"}, {"sha": "56724687fb48848d19bf71424f01beb49db1777f", "filename": "libgomp/libgomp.texi", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4fb2b4f7ea6b80ae75d3efb6f86e7c6179080535/libgomp%2Flibgomp.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4fb2b4f7ea6b80ae75d3efb6f86e7c6179080535/libgomp%2Flibgomp.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Flibgomp.texi?ref=4fb2b4f7ea6b80ae75d3efb6f86e7c6179080535", "patch": "@@ -303,7 +303,7 @@ The OpenMP 4.5 specification is fully supported.\n       @code{target} regions @tab N @tab\n @item @code{interop} directive @tab N @tab\n @item @code{omp_interop_t} object support in runtime routines @tab N @tab\n-@item @code{nowait} clause in @code{taskwait} directive @tab N @tab\n+@item @code{nowait} clause in @code{taskwait} directive @tab Y @tab\n @item Extensions to the @code{atomic} directive @tab Y @tab\n @item @code{seq_cst} clause on a @code{flush} construct @tab Y @tab\n @item @code{inoutset} argument to the @code{depend} clause @tab Y @tab"}, {"sha": "a5b058d4a4fa1bb54d04eca1e8dd3add3b5c98f4", "filename": "libgomp/testsuite/libgomp.fortran/taskwait-depend-nowait-1.f90", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4fb2b4f7ea6b80ae75d3efb6f86e7c6179080535/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftaskwait-depend-nowait-1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4fb2b4f7ea6b80ae75d3efb6f86e7c6179080535/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftaskwait-depend-nowait-1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.fortran%2Ftaskwait-depend-nowait-1.f90?ref=4fb2b4f7ea6b80ae75d3efb6f86e7c6179080535", "patch": "@@ -0,0 +1,42 @@\n+program main\n+  implicit none\n+  integer :: a(0:63), b = 1\n+  !$omp parallel num_threads (4)\n+  block\n+    !$omp single\n+    block\n+      integer :: i\n+      !$omp taskwait depend(in: a) nowait\n+      !$omp taskwait depend(in: a) nowait\n+      !$omp taskwait\n+      !$omp taskgroup\n+      block\n+        !$omp taskwait depend(in: a) nowait\n+        !$omp taskwait depend(in: a) nowait\n+      end block\n+      do i = 0, 63\n+        !$omp task depend(in: a) shared(a)\n+        block\n+          a(i) = i\n+        end block\n+      end do\n+      !$omp taskwait depend(inout: a) nowait\n+      do i = 0, 63\n+        !$omp task depend(inoutset: a) shared(a)\n+        block\n+          if (a(i) /= i) then\n+            error stop\n+          else\n+            a(i) = 2 * i + 1\n+          end if\n+        end block\n+      end do\n+      !$omp taskwait nowait depend(out: a) depend(in: b)\n+      !$omp taskwait depend(inout: b)\n+      do i = 0, 63\n+        if (a(i) /= 2 * i + 1) &\n+          error stop\n+      end do\n+    end block\n+  end block\n+end program"}]}