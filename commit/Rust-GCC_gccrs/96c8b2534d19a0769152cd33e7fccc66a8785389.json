{"sha": "96c8b2534d19a0769152cd33e7fccc66a8785389", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTZjOGIyNTM0ZDE5YTA3NjkxNTJjZDMzZTdmY2NjNjZhODc4NTM4OQ==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-03-18T17:51:57Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-03-18T17:51:57Z"}, "message": "re PR fortran/77414 (ICE in create_function_arglist, at fortran/trans-decl.c:2410)\n\n2018-03-18  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/77414\n\t* decl.c (get_proc_name):  Check for a subroutine re-defined in\n\tthe contain portion of a subroutine.  Change language of existing\n\terror message to better describe the issue. While here fix whitespace\n\tissues.\n\n2018-03-18  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/77414\n\t* gfortran.dg/pr77414.f90: New test.\n\t* gfortran.dg/internal_references_1.f90: Adjust error message.\n\nFrom-SVN: r258633", "tree": {"sha": "ff06ab0f94a74091ec8b716ec3ed15cf47bc3d7f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ff06ab0f94a74091ec8b716ec3ed15cf47bc3d7f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/96c8b2534d19a0769152cd33e7fccc66a8785389", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/96c8b2534d19a0769152cd33e7fccc66a8785389", "html_url": "https://github.com/Rust-GCC/gccrs/commit/96c8b2534d19a0769152cd33e7fccc66a8785389", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/96c8b2534d19a0769152cd33e7fccc66a8785389/comments", "author": null, "committer": null, "parents": [{"sha": "81ea7c11e1995736f39b0bbd8aa14160d7f08626", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81ea7c11e1995736f39b0bbd8aa14160d7f08626", "html_url": "https://github.com/Rust-GCC/gccrs/commit/81ea7c11e1995736f39b0bbd8aa14160d7f08626"}], "stats": {"total": 55, "additions": 43, "deletions": 12}, "files": [{"sha": "7b550aa75db313f179d0ad091f8286ac5be6e6a3", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96c8b2534d19a0769152cd33e7fccc66a8785389/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96c8b2534d19a0769152cd33e7fccc66a8785389/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=96c8b2534d19a0769152cd33e7fccc66a8785389", "patch": "@@ -1,3 +1,11 @@\n+2018-03-18  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/77414\n+\t* decl.c (get_proc_name):  Check for a subroutine re-defined in\n+\tthe contain portion of a subroutine.  Change language of existing\n+\terror message to better describe the issue. While here fix whitespace\n+\tissues.\n+\n 2018-03-18  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/65453"}, {"sha": "f6649cf95000749b9b944fbf2ca52665754c6ada", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 16, "deletions": 9, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96c8b2534d19a0769152cd33e7fccc66a8785389/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96c8b2534d19a0769152cd33e7fccc66a8785389/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=96c8b2534d19a0769152cd33e7fccc66a8785389", "patch": "@@ -1172,14 +1172,12 @@ get_proc_name (const char *name, gfc_symbol **result, bool module_fcn_entry)\n   if (sym->attr.proc == PROC_ST_FUNCTION)\n     return rc;\n \n-  if (sym->attr.module_procedure\n-      && sym->attr.if_source == IFSRC_IFBODY)\n+  if (sym->attr.module_procedure && sym->attr.if_source == IFSRC_IFBODY)\n     {\n       /* Create a partially populated interface symbol to carry the\n \t characteristics of the procedure and the result.  */\n       sym->tlink = gfc_new_symbol (name, sym->ns);\n-      gfc_add_type (sym->tlink, &(sym->ts),\n-\t\t    &gfc_current_locus);\n+      gfc_add_type (sym->tlink, &(sym->ts), &gfc_current_locus);\n       gfc_copy_attr (&sym->tlink->attr, &sym->attr, NULL);\n       if (sym->attr.dimension)\n \tsym->tlink->as = gfc_copy_array_spec (sym->as);\n@@ -1244,7 +1242,16 @@ get_proc_name (const char *name, gfc_symbol **result, bool module_fcn_entry)\n \t  && sym->attr.access == 0\n \t  && !module_fcn_entry)\n \tgfc_error_now (\"Procedure %qs at %C has an explicit interface \"\n-\t\t       \"and must not have attributes declared at %L\",\n+\t\t       \"from a previous declaration\",  name);\n+    }\n+\n+    if (sym && !sym->gfc_new\n+\t&& sym->attr.flavor != FL_UNKNOWN\n+\t&& sym->attr.referenced == 0 && sym->attr.subroutine == 1\n+\t&& gfc_state_stack->state == COMP_CONTAINS\n+\t&& gfc_state_stack->previous->state == COMP_SUBROUTINE)\n+    {\n+\tgfc_error_now (\"Procedure %qs at %C is already defined at %L\",\n \t\t       name, &sym->declared_at);\n     }\n \n@@ -1269,10 +1276,10 @@ get_proc_name (const char *name, gfc_symbol **result, bool module_fcn_entry)\n   /* See if the procedure should be a module procedure.  */\n \n   if (((sym->ns->proc_name != NULL\n-\t\t&& sym->ns->proc_name->attr.flavor == FL_MODULE\n-\t\t&& sym->attr.proc != PROC_MODULE)\n-\t    || (module_fcn_entry && sym->attr.proc != PROC_MODULE))\n-\t&& !gfc_add_procedure (&sym->attr, PROC_MODULE, sym->name, NULL))\n+\t&& sym->ns->proc_name->attr.flavor == FL_MODULE\n+\t&& sym->attr.proc != PROC_MODULE)\n+       || (module_fcn_entry && sym->attr.proc != PROC_MODULE))\n+      && !gfc_add_procedure (&sym->attr, PROC_MODULE, sym->name, NULL))\n     rc = 2;\n \n   return rc;"}, {"sha": "a7b96dda9661ec326fdf4e72f154fab974dfca9b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96c8b2534d19a0769152cd33e7fccc66a8785389/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96c8b2534d19a0769152cd33e7fccc66a8785389/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=96c8b2534d19a0769152cd33e7fccc66a8785389", "patch": "@@ -1,3 +1,9 @@\n+2018-03-17  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/77414\n+\t* gfortran.dg/pr77414.f90: New test.\n+\t* gfortran.dg/internal_references_1.f90: Adjust error message.\n+\n 2018-03-18  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/65453"}, {"sha": "2434e28d5e30f4c1e6bd659ec07012f5d55d477e", "filename": "gcc/testsuite/gfortran.dg/internal_references_1.f90", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96c8b2534d19a0769152cd33e7fccc66a8785389/gcc%2Ftestsuite%2Fgfortran.dg%2Finternal_references_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96c8b2534d19a0769152cd33e7fccc66a8785389/gcc%2Ftestsuite%2Fgfortran.dg%2Finternal_references_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Finternal_references_1.f90?ref=96c8b2534d19a0769152cd33e7fccc66a8785389", "patch": "@@ -11,7 +11,7 @@ module m\n   implicit none\n contains\n \n-  subroutine p (i)   ! { dg-error \"is already defined\" }\n+  subroutine p (i)   ! { dg-error \"(1)\" }\n     integer :: i\n   end subroutine\n \n@@ -22,14 +22,15 @@ subroutine p (i)   ! { dg-error \"is already defined\" }\n !\n ! PR25124 - would happily ignore the declaration of foo in the main program.\n program test\n-real :: foo, x      ! { dg-error \"explicit interface and must not have attributes declared\" }\n+real :: foo, x\n x = bar ()          ! This is OK because it is a regular reference.\n x = foo ()\n contains\n-    function foo () ! { dg-error \"explicit interface and must not have attributes declared\" }\n+    function foo () ! { dg-error \"explicit interface from a previous\" }\n       foo = 1.0\n     end function foo\n     function bar ()\n       bar = 1.0\n     end function bar\n end program test\n+"}, {"sha": "222c1a315422fd55e21ae604e49cc85be956a46f", "filename": "gcc/testsuite/gfortran.dg/pr77414.f90", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96c8b2534d19a0769152cd33e7fccc66a8785389/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr77414.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96c8b2534d19a0769152cd33e7fccc66a8785389/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr77414.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr77414.f90?ref=96c8b2534d19a0769152cd33e7fccc66a8785389", "patch": "@@ -0,0 +1,9 @@\n+! { dg-do compile }\n+! PR fortran/77414\n+subroutine a(x)               ! { dg-error \"(1)\" }\n+   character(*) :: x\n+   contains\n+      subroutine a(x)         ! { dg-error \" is already defined at\" }\n+         character(*) :: x\n+      end subroutine a\n+end subroutine a"}]}