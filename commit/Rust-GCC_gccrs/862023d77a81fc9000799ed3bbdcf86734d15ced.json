{"sha": "862023d77a81fc9000799ed3bbdcf86734d15ced", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODYyMDIzZDc3YTgxZmM5MDAwNzk5ZWQzYmJkY2Y4NjczNGQxNWNlZA==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely.gcc@gmail.com", "date": "2012-04-25T18:03:03Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2012-04-25T18:03:03Z"}, "message": "scoped_allocator (scoped_allocator::__outermost): Do not pass non-POD to varargs function.\n\n\t* include/std/scoped_allocator (scoped_allocator::__outermost): Do\n\tnot pass non-POD to varargs function.\n\t* testsuite/20_util/scoped_allocator/1.cc: Fix test.\n\nFrom-SVN: r186836", "tree": {"sha": "28099b063a68faa1527cf3db21bb956881137c82", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/28099b063a68faa1527cf3db21bb956881137c82"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/862023d77a81fc9000799ed3bbdcf86734d15ced", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/862023d77a81fc9000799ed3bbdcf86734d15ced", "html_url": "https://github.com/Rust-GCC/gccrs/commit/862023d77a81fc9000799ed3bbdcf86734d15ced", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/862023d77a81fc9000799ed3bbdcf86734d15ced/comments", "author": null, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "98095aa3379c4db453d656b82f368e3bbacbfa07", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/98095aa3379c4db453d656b82f368e3bbacbfa07", "html_url": "https://github.com/Rust-GCC/gccrs/commit/98095aa3379c4db453d656b82f368e3bbacbfa07"}], "stats": {"total": 32, "additions": 21, "deletions": 11}, "files": [{"sha": "678c7a4c5724a1b74d133c1f5d2cb839e9d92489", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/862023d77a81fc9000799ed3bbdcf86734d15ced/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/862023d77a81fc9000799ed3bbdcf86734d15ced/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=862023d77a81fc9000799ed3bbdcf86734d15ced", "patch": "@@ -1,3 +1,9 @@\n+2012-04-25  Jonathan Wakely  <jwakely.gcc@gmail.com>\n+\n+\t* include/std/scoped_allocator (scoped_allocator::__outermost): Do\n+\tnot pass non-POD to varargs function.\n+\t* testsuite/20_util/scoped_allocator/1.cc: Fix test.\n+\n 2012-04-24  Benjamin Kosnik  <bkoz@redhat.com>\n \n \tPR libstdc++/52689"}, {"sha": "fc2db7cbd66f2c5b649a9662043d4cd8ebdd60fe", "filename": "libstdc++-v3/include/std/scoped_allocator", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/862023d77a81fc9000799ed3bbdcf86734d15ced/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fscoped_allocator", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/862023d77a81fc9000799ed3bbdcf86734d15ced/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fscoped_allocator", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fscoped_allocator?ref=862023d77a81fc9000799ed3bbdcf86734d15ced", "patch": "@@ -1,6 +1,6 @@\n // <scoped_allocator> -*- C++ -*-\n \n-// Copyright (C) 2011 Free Software Foundation, Inc.\n+// Copyright (C) 2011, 2012 Free Software Foundation, Inc.\n //\n // This file is part of the GNU ISO C++ Library.  This library is free\n // software; you can redistribute it and/or modify it under the\n@@ -77,7 +77,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n   \n   template<typename _Alloc>\n     inline auto\n-    __do_outermost(_Alloc& __a, _Alloc&) -> decltype(__a.outer_allocator())\n+    __do_outermost(_Alloc& __a, _Alloc*) -> decltype(__a.outer_allocator())\n     { return __a.outer_allocator(); }\n \n   template<typename _Alloc>\n@@ -87,8 +87,8 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \n   template<typename _Alloc>\n     inline auto\n-    __outermost(_Alloc& __a) -> decltype(__do_outermost(__a, __a))\n-    { return __do_outermost(__a, __a); }\n+    __outermost(_Alloc& __a) -> decltype(__do_outermost(__a, &__a))\n+    { return __do_outermost(__a, &__a); }\n \n   template<typename _OuterAlloc, typename... _InnerAllocs>\n     class scoped_allocator_adaptor;"}, {"sha": "21d1b05551276dc6ecc3f9f82ef180375597558c", "filename": "libstdc++-v3/testsuite/20_util/scoped_allocator/1.cc", "status": "modified", "additions": 11, "deletions": 7, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/862023d77a81fc9000799ed3bbdcf86734d15ced/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fscoped_allocator%2F1.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/862023d77a81fc9000799ed3bbdcf86734d15ced/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fscoped_allocator%2F1.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fscoped_allocator%2F1.cc?ref=862023d77a81fc9000799ed3bbdcf86734d15ced", "patch": "@@ -1,6 +1,6 @@\n // { dg-options \"-std=gnu++0x\" }\n \n-// Copyright (C) 2011 Free Software Foundation, Inc.\n+// Copyright (C) 2011, 2012 Free Software Foundation, Inc.\n //\n // This file is part of the GNU ISO C++ Library.  This library is free\n // software; you can redistribute it and/or modify it under the\n@@ -33,7 +33,7 @@ struct Element\n \n   Element(const allocator_type& a = allocator_type()) : alloc(a) { }\n \n-  Element(std::allocator_arg_t, const allocator_type& a, int i = 0)\n+  Element(std::allocator_arg_t, const allocator_type& a, int = 0)\n   : alloc(a) { }\n \n   Element(std::allocator_arg_t, const allocator_type& a, const Element&)\n@@ -53,21 +53,24 @@ void test01()\n   alloc1_type a1(1);\n   Element e;\n   EltVec ev1(1, e, a1);\n+  VERIFY( ev1.get_allocator().get_personality() == 1 );\n   VERIFY( ev1[0].get_allocator().get_personality() == 1 );\n }\n \n void test02()\n {\n   bool test __attribute((unused)) = false;\n \n-  typedef std::vector<Element, Element::allocator_type> EltVec;\n+  typedef std::scoped_allocator_adaptor<Element::allocator_type> inner_alloc_type;\n \n-  typedef std::scoped_allocator_adaptor<EltVec::allocator_type,\n-\t                                Element::allocator_type> alloc_type;\n+  typedef std::vector<Element, inner_alloc_type> EltVec;\n+\n+  typedef std::scoped_allocator_adaptor<Element::allocator_type,\n+                                        Element::allocator_type> alloc_type;\n \n   typedef std::vector<EltVec, alloc_type> EltVecVec;\n \n-  alloc_type a(1, 2);\n+  alloc_type a(1, Element::allocator_type(2)); // outer=1, inner=2\n   Element e;\n   EltVec ev(1, e);\n   EltVecVec evv(1, ev, a);\n@@ -76,7 +79,7 @@ void test02()\n   VERIFY( evv[0].get_allocator().get_personality() == 2 );\n   VERIFY( evv[0][0].get_allocator().get_personality() == 2 );\n \n-  alloc_type a2(3, 4);\n+  alloc_type a2(3, Element::allocator_type(4)); // outer=3, inner=4\n \n   EltVecVec evv2(evv, a2); // copy with a different allocator\n \n@@ -96,4 +99,5 @@ void test02()\n int main()\n {\n   test01();\n+  test02();\n }"}]}