{"sha": "dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9", "node_id": "C_kwDOANBUbNoAKGRmZTM4YjhkNWRiZmUzZGQ1MjA5YWVjZTRjZTJmN2E2YjMwM2EyZjk", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2022-05-17T19:13:58Z"}, "committer": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2022-05-18T14:33:13Z"}, "message": "c++: fix SIGFPE with -Wclass-memaccess [PR105634]\n\nHere we crash because we attempt to % by 0.  Thus fixed.\nWhile at it, I've moved the -Wclass-memaccess tests into warn/.\nI've checked that the # of expected passes is the same before/after\nthe move.\n\n\tPR c++/105634\n\ngcc/cp/ChangeLog:\n\n\t* call.cc (maybe_warn_class_memaccess): Avoid % by zero.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/Wclass-memaccess-2.C: Moved to...\n\t* g++.dg/warn/Wclass-memaccess-2.C: ...here.\n\t* g++.dg/Wclass-memaccess-3.C: Moved to...\n\t* g++.dg/warn/Wclass-memaccess-3.C: ...here.\n\t* g++.dg/Wclass-memaccess-4.C: Moved to...\n\t* g++.dg/warn/Wclass-memaccess-4.C: ...here.\n\t* g++.dg/Wclass-memaccess-5.C: Moved to...\n\t* g++.dg/warn/Wclass-memaccess-5.C: ...here.\n\t* g++.dg/Wclass-memaccess-6.C: Moved to...\n\t* g++.dg/warn/Wclass-memaccess-6.C: ...here.\n\t* g++.dg/Wclass-memaccess.C: Moved to...\n\t* g++.dg/warn/Wclass-memaccess.C: ...here.\n\t* g++.dg/warn/Wclass-memaccess-7.C: New test.", "tree": {"sha": "ce63010fef0197b72f8ee4a5243eeffb3feb6d8c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ce63010fef0197b72f8ee4a5243eeffb3feb6d8c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0d189b16f81fb9dced0b29495b5d100492b779d8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0d189b16f81fb9dced0b29495b5d100492b779d8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0d189b16f81fb9dced0b29495b5d100492b779d8"}], "stats": {"total": 15, "additions": 15, "deletions": 0}, "files": [{"sha": "14c6037729ffeb920de0a7dd6afb8b94de4feaf0", "filename": "gcc/cp/call.cc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9/gcc%2Fcp%2Fcall.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9/gcc%2Fcp%2Fcall.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.cc?ref=dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9", "patch": "@@ -10329,6 +10329,8 @@ maybe_warn_class_memaccess (location_t loc, tree fndecl,\n \t  /* Finally, warn on partial copies.  */\n \t  unsigned HOST_WIDE_INT typesize\n \t    = tree_to_uhwi (TYPE_SIZE_UNIT (desttype));\n+\t  if (typesize == 0)\n+\t    break;\n \t  if (unsigned HOST_WIDE_INT partial = tree_to_uhwi (sz) % typesize)\n \t    warned = warning_at (loc, OPT_Wclass_memaccess,\n \t\t\t\t (typesize - partial > 1"}, {"sha": "f138b8b357e1e9f448209c14feaa1e6f67d737ac", "filename": "gcc/testsuite/g++.dg/warn/Wclass-memaccess-2.C", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-2.C?ref=dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9", "previous_filename": "gcc/testsuite/g++.dg/Wclass-memaccess-2.C"}, {"sha": "36e0e682c387246443964f2c9e06b9ae7a32abbe", "filename": "gcc/testsuite/g++.dg/warn/Wclass-memaccess-3.C", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-3.C?ref=dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9", "previous_filename": "gcc/testsuite/g++.dg/Wclass-memaccess-3.C"}, {"sha": "69b8c780c8b73fb93c493d435d356005ad13fa01", "filename": "gcc/testsuite/g++.dg/warn/Wclass-memaccess-4.C", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-4.C?ref=dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9", "previous_filename": "gcc/testsuite/g++.dg/Wclass-memaccess-4.C"}, {"sha": "d0fffead56d3afaf5f9c2ffe2ed9917713eb23a6", "filename": "gcc/testsuite/g++.dg/warn/Wclass-memaccess-5.C", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-5.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-5.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-5.C?ref=dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9", "previous_filename": "gcc/testsuite/g++.dg/Wclass-memaccess-5.C"}, {"sha": "7f6fe03a9391745fd708d891517942ee151f4cb9", "filename": "gcc/testsuite/g++.dg/warn/Wclass-memaccess-6.C", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-6.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-6.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-6.C?ref=dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9", "previous_filename": "gcc/testsuite/g++.dg/Wclass-memaccess-6.C"}, {"sha": "7e86b2486298c76bbb657580a1c336492c5bde43", "filename": "gcc/testsuite/g++.dg/warn/Wclass-memaccess-7.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-7.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-7.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess-7.C?ref=dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9", "patch": "@@ -0,0 +1,13 @@\n+// PR c++/105634\n+// { dg-do compile { target { c++11 } } }\n+// { dg-options \"-Wall\" }\n+\n+struct s\n+{\n+  struct {} a[] = 1.0; // { dg-error \"\" }\n+  void f (char *c)\n+  {\n+    s s;\n+    __builtin_memcpy (&s, c, sizeof(s));\n+  }\n+};"}, {"sha": "1dc23dfab7e61fa766f87efa460bc190772106f7", "filename": "gcc/testsuite/g++.dg/warn/Wclass-memaccess.C", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWclass-memaccess.C?ref=dfe38b8d5dbfe3dd5209aece4ce2f7a6b303a2f9", "previous_filename": "gcc/testsuite/g++.dg/Wclass-memaccess.C"}]}