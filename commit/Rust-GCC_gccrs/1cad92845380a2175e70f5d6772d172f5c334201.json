{"sha": "1cad92845380a2175e70f5d6772d172f5c334201", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWNhZDkyODQ1MzgwYTIxNzVlNzBmNWQ2NzcyZDE3MmY1YzMzNDIwMQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-08-19T15:30:33Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-08-19T15:30:33Z"}, "message": "re PR fortran/71014 (associate statement inside omp parallel do appears to disable default private attribute for inner loop indices)\n\n\tPR fortran/71014\n\t* resolve.c (gfc_resolve): For ns->construct_entities don't save, clear\n\tand restore omp state around the resolving.\n\n\t* testsuite/libgomp.fortran/pr71014.f90: New test.\n\nFrom-SVN: r239620", "tree": {"sha": "c842c4c7d0803c5787383e84c95b89f6c746b55b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c842c4c7d0803c5787383e84c95b89f6c746b55b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1cad92845380a2175e70f5d6772d172f5c334201", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1cad92845380a2175e70f5d6772d172f5c334201", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1cad92845380a2175e70f5d6772d172f5c334201", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1cad92845380a2175e70f5d6772d172f5c334201/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "fbdbd4b6d78bb9730107ebf5b2e7351f0d3dbf33", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fbdbd4b6d78bb9730107ebf5b2e7351f0d3dbf33", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fbdbd4b6d78bb9730107ebf5b2e7351f0d3dbf33"}], "stats": {"total": 35, "additions": 33, "deletions": 2}, "files": [{"sha": "23386cce487ab3fa9b89b6aa7171b6413421397a", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1cad92845380a2175e70f5d6772d172f5c334201/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1cad92845380a2175e70f5d6772d172f5c334201/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=1cad92845380a2175e70f5d6772d172f5c334201", "patch": "@@ -1,5 +1,9 @@\n 2016-08-19  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR fortran/71014\n+\t* resolve.c (gfc_resolve): For ns->construct_entities don't save, clear\n+\tand restore omp state around the resolving.\n+\n \tPR fortran/69281\n \t* trans-openmp.c (gfc_trans_omp_parallel, gfc_trans_omp_task,\n \tgfc_trans_omp_target): Wrap gfc_trans_omp_code result in an extra"}, {"sha": "b7036a82837a328d01a9230d967044383a312adb", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1cad92845380a2175e70f5d6772d172f5c334201/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1cad92845380a2175e70f5d6772d172f5c334201/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=1cad92845380a2175e70f5d6772d172f5c334201", "patch": "@@ -15587,7 +15587,8 @@ gfc_resolve (gfc_namespace *ns)\n   /* As gfc_resolve can be called during resolution of an OpenMP construct\n      body, we should clear any state associated to it, so that say NS's\n      DO loops are not interpreted as OpenMP loops.  */\n-  gfc_omp_save_and_clear_state (&old_omp_state);\n+  if (!ns->construct_entities)\n+    gfc_omp_save_and_clear_state (&old_omp_state);\n \n   resolve_types (ns);\n   component_assignment_level = 0;\n@@ -15599,5 +15600,6 @@ gfc_resolve (gfc_namespace *ns)\n \n   gfc_run_passes (ns);\n \n-  gfc_omp_restore_state (&old_omp_state);\n+  if (!ns->construct_entities)\n+    gfc_omp_restore_state (&old_omp_state);\n }"}, {"sha": "32b11ec067f8de919dd8b2813faff7a442e702f4", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1cad92845380a2175e70f5d6772d172f5c334201/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1cad92845380a2175e70f5d6772d172f5c334201/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=1cad92845380a2175e70f5d6772d172f5c334201", "patch": "@@ -1,3 +1,8 @@\n+2016-08-19  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/71014\n+\t* testsuite/libgomp.fortran/pr71014.f90: New test.\n+\n 2016-08-18  Chung-Lin Tang  <cltang@codesourcery.com>\n \n \tPR middle-end/70895"}, {"sha": "6d0d6bec46d34b6c7c46c7106014ac93286dc631", "filename": "libgomp/testsuite/libgomp.fortran/pr71014.f90", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1cad92845380a2175e70f5d6772d172f5c334201/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fpr71014.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1cad92845380a2175e70f5d6772d172f5c334201/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fpr71014.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fpr71014.f90?ref=1cad92845380a2175e70f5d6772d172f5c334201", "patch": "@@ -0,0 +1,20 @@\n+! PR fortran/71014\n+! { dg-do run }\n+! { dg-additional-options \"-O0\" }\n+\n+program pr71014\n+  implicit none\n+  integer :: i, j\n+  integer, parameter :: t = 100*101/2\n+  integer :: s(16)\n+  s(:) = 0\n+!$omp parallel do\n+  do j = 1, 16\n+    associate (k => j)\n+      do i = 1, 100\n+        s(j) = s(j) + i\n+      end do\n+    end associate\n+  end do\n+  if (any(s /= t)) call abort\n+end program pr71014"}]}