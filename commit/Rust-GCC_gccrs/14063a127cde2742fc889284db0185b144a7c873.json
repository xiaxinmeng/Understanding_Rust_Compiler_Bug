{"sha": "14063a127cde2742fc889284db0185b144a7c873", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTQwNjNhMTI3Y2RlMjc0MmZjODg5Mjg0ZGIwMTg1YjE0NGE3Yzg3Mw==", "commit": {"author": {"name": "Robert Dewar", "email": "dewar@adacore.com", "date": "2008-03-26T07:43:18Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2008-03-26T07:43:18Z"}, "message": "g-byorma.adb (Read_BOM): Reorder tests so that UTF_32 is recognized\n\n2008-03-26  Robert Dewar  <dewar@adacore.com>\n\n\t* g-byorma.adb (Read_BOM): Reorder tests so that UTF_32 is recognized\n\nFrom-SVN: r133584", "tree": {"sha": "75dbd24d57fb4aa9b026b8565de51a5e073092d2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/75dbd24d57fb4aa9b026b8565de51a5e073092d2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/14063a127cde2742fc889284db0185b144a7c873", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/14063a127cde2742fc889284db0185b144a7c873", "html_url": "https://github.com/Rust-GCC/gccrs/commit/14063a127cde2742fc889284db0185b144a7c873", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/14063a127cde2742fc889284db0185b144a7c873/comments", "author": null, "committer": null, "parents": [{"sha": "2a6b365a3049bc42f9e94060c32d4b639244cf3f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a6b365a3049bc42f9e94060c32d4b639244cf3f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2a6b365a3049bc42f9e94060c32d4b639244cf3f"}], "stats": {"total": 39, "additions": 21, "deletions": 18}, "files": [{"sha": "6bbaedf8b719904675e89dedbceec747634afa3d", "filename": "gcc/ada/g-byorma.adb", "status": "modified", "additions": 21, "deletions": 18, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14063a127cde2742fc889284db0185b144a7c873/gcc%2Fada%2Fg-byorma.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14063a127cde2742fc889284db0185b144a7c873/gcc%2Fada%2Fg-byorma.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-byorma.adb?ref=14063a127cde2742fc889284db0185b144a7c873", "patch": "@@ -44,27 +44,13 @@ package body GNAT.Byte_Order_Mark is\n       XML_Support : Boolean := False)\n    is\n    begin\n-      --  UTF-16 (big-endian)\n-\n-      if Str'Length >= 2\n-        and then Str (Str'First) = Character'Val (16#FE#)\n-        and then Str (Str'First + 1) = Character'Val (16#FF#)\n-      then\n-         Len := 2;\n-         BOM := UTF16_BE;\n-\n-      --  UTF-16 (little-endian)\n-\n-      elsif Str'Length >= 2\n-        and then Str (Str'First) = Character'Val (16#FF#)\n-        and then Str (Str'First + 1) = Character'Val (16#FE#)\n-      then\n-         Len := 2;\n-         BOM := UTF16_LE;\n+      --  Note: the order of these tests is important, because in some cases\n+      --  one sequence is a prefix of a longer sequence, and we must test for\n+      --  the longer sequence first\n \n       --  UTF-32 (big-endian)\n \n-      elsif Str'Length >= 4\n+      if Str'Length >= 4\n         and then Str (Str'First)     = Character'Val (16#00#)\n         and then Str (Str'First + 1) = Character'Val (16#00#)\n         and then Str (Str'First + 2) = Character'Val (16#FE#)\n@@ -84,6 +70,23 @@ package body GNAT.Byte_Order_Mark is\n          Len := 4;\n          BOM := UTF32_LE;\n \n+      --  UTF-16 (big-endian)\n+\n+      elsif Str'Length >= 2\n+        and then Str (Str'First) = Character'Val (16#FE#)\n+        and then Str (Str'First + 1) = Character'Val (16#FF#)\n+      then\n+         Len := 2;\n+         BOM := UTF16_BE;\n+\n+      --  UTF-16 (little-endian)\n+\n+      elsif Str'Length >= 2\n+        and then Str (Str'First) = Character'Val (16#FF#)\n+        and then Str (Str'First + 1) = Character'Val (16#FE#)\n+      then\n+         Len := 2;\n+         BOM := UTF16_LE;\n       --  UTF-8 (endian-independent)\n \n       elsif Str'Length >= 3"}]}