{"sha": "54c2f04ba05ce07e701345bc66d038b7d47a9bed", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTRjMmYwNGJhMDVjZTA3ZTcwMTM0NWJjNjZkMDM4YjdkNDdhOWJlZA==", "commit": {"author": {"name": "Anthony Green", "email": "green@redhat.com", "date": "2000-04-02T15:34:17Z"}, "committer": {"name": "Anthony Green", "email": "green@gcc.gnu.org", "date": "2000-04-02T15:34:17Z"}, "message": "JVMPI changes...\n\nSun Apr  2 08:27:18 2000  Anthony Green  <green@redhat.com>\n\n        * configure: Rebuilt.\n\t* configure.in: Add --disable-jvmpi.\n        * include/config.h.in: Rebuilt.\n        * acconfig.h: Add ENABLE_JVMPI.\n\n\t* include/jvm.h: Declare _Jv_DisableGC and _Jv_EnableGC.\n        (_Jv_JVMPI_Notify_OBJECT_ALLOC): New define.\n        (_Jv_JVMPI_Notify_THREAD_END): New define.\n        (_Jv_JVMPI_Notify_THREAD_END): New define.\n        * prims.cc (_Jv_JVMPI_Notify_OBJECT_ALLOC): Declare.\n\t(_Jv_JVMPI_Notify_THREAD_END): Declare.\n        (_Jv_JVMPI_Notify_THREAD_END): Declare.\n\n\t* prims.cc (_Jv_AllocObject): Generate JVMPI object allocation\n        events.\n\n        * java/lang/natThread.cc: Include JVMPI headers if necessary.\n        (finish_): Generate JVMPI thread end events.\n        (run_): Generate JVMPI thread start events.\n\t* gnu/gcj/runtime/natFirstThread.cc (run): Call JNI_OnLoad for any\n        preloaded JNI library.\n        Include JVMPI headers if necessary.\n        (run): Generate JVMPI thread start events.\n\n        * boehm.cc: Define GC_disable and GC_enable.\n\t(_Jv_DisableGC): New function.\n        (_Jv_EnableGC): New function.\n        (disable_gc_mutex): Declare.\n        * nogc.cc (_Jv_DisableGC): New function.\n\t(_Jv_EnableGC): New function.\n\n        * jni.cc (_Jv_JNI_GetEnv): Handle JVMPI interface requests.\n        (_Jv_JVMPI_Interface): Define.\n        (jvmpiEnableEvent): New function.\n        (_Jv_JNI_Init): Initialize _Jv_JVMPI_Interface.\n\n        * include/jvmpi.h: New file.\n\nFrom-SVN: r32866", "tree": {"sha": "199d2b90d14943e4a167f1af547706f43926aeb3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/199d2b90d14943e4a167f1af547706f43926aeb3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/54c2f04ba05ce07e701345bc66d038b7d47a9bed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/54c2f04ba05ce07e701345bc66d038b7d47a9bed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/54c2f04ba05ce07e701345bc66d038b7d47a9bed", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/54c2f04ba05ce07e701345bc66d038b7d47a9bed/comments", "author": {"login": "atgreen", "id": 89993, "node_id": "MDQ6VXNlcjg5OTkz", "avatar_url": "https://avatars.githubusercontent.com/u/89993?v=4", "gravatar_id": "", "url": "https://api.github.com/users/atgreen", "html_url": "https://github.com/atgreen", "followers_url": "https://api.github.com/users/atgreen/followers", "following_url": "https://api.github.com/users/atgreen/following{/other_user}", "gists_url": "https://api.github.com/users/atgreen/gists{/gist_id}", "starred_url": "https://api.github.com/users/atgreen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/atgreen/subscriptions", "organizations_url": "https://api.github.com/users/atgreen/orgs", "repos_url": "https://api.github.com/users/atgreen/repos", "events_url": "https://api.github.com/users/atgreen/events{/privacy}", "received_events_url": "https://api.github.com/users/atgreen/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "49d1b8712898e27fde111afc2310e0d43768e8d7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/49d1b8712898e27fde111afc2310e0d43768e8d7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/49d1b8712898e27fde111afc2310e0d43768e8d7"}], "stats": {"total": 848, "additions": 636, "deletions": 212}, "files": [{"sha": "411965280a5e1bd6be2095b574ccddf35e79a471", "filename": "libjava/ChangeLog", "status": "modified", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=54c2f04ba05ce07e701345bc66d038b7d47a9bed", "patch": "@@ -1,3 +1,43 @@\n+Sun Apr  2 08:27:18 2000  Anthony Green  <green@redhat.com>\n+\n+\t* configure: Rebuilt.\n+\t* configure.in: Add --disable-jvmpi.\n+\t* include/config.h.in: Rebuilt.\n+\t* acconfig.h: Add ENABLE_JVMPI.\n+\t \n+\t* include/jvm.h: Declare _Jv_DisableGC and _Jv_EnableGC.\n+\t(_Jv_JVMPI_Notify_OBJECT_ALLOC): New define.\n+\t(_Jv_JVMPI_Notify_THREAD_END): New define.\n+\t(_Jv_JVMPI_Notify_THREAD_END): New define.\n+\t* prims.cc (_Jv_JVMPI_Notify_OBJECT_ALLOC): Declare.\n+\t(_Jv_JVMPI_Notify_THREAD_END): Declare.\n+\t(_Jv_JVMPI_Notify_THREAD_END): Declare.\n+\n+\t* prims.cc (_Jv_AllocObject): Generate JVMPI object allocation\n+\tevents.\n+\n+\t* java/lang/natThread.cc: Include JVMPI headers if necessary.\n+\t(finish_): Generate JVMPI thread end events.\n+\t(run_): Generate JVMPI thread start events.\n+\t* gnu/gcj/runtime/natFirstThread.cc (run): Call JNI_OnLoad for any\n+\tpreloaded JNI library.\n+\tInclude JVMPI headers if necessary.\n+\t(run): Generate JVMPI thread start events.\n+\n+\t* boehm.cc: Define GC_disable and GC_enable.\n+\t(_Jv_DisableGC): New function.\n+\t(_Jv_EnableGC): New function.\n+\t(disable_gc_mutex): Declare.\n+\t* nogc.cc (_Jv_DisableGC): New function.\n+\t(_Jv_EnableGC): New function.\n+\t  \n+\t* jni.cc (_Jv_JNI_GetEnv): Handle JVMPI interface requests.\n+\t(_Jv_JVMPI_Interface): Define.\n+\t(jvmpiEnableEvent): New function.\n+\t(_Jv_JNI_Init): Initialize _Jv_JVMPI_Interface.\n+\t  \n+\t* include/jvmpi.h: New file.\n+\n 2000-03-27  Bryce McKinlay  <bryce@albatross.co.nz>\n \n \t* Makefile.in: New #defines and friends for Thread.h."}, {"sha": "0a4d96544a9ad89d521e1e78ccc5bb70547ce754", "filename": "libjava/acconfig.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Facconfig.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Facconfig.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Facconfig.h?ref=54c2f04ba05ce07e701345bc66d038b7d47a9bed", "patch": "@@ -137,3 +137,6 @@\n \n /* Define if you have working iconv() function.  */\n #undef HAVE_ICONV\n+\n+/* Define if you are using JVMPI.  */\n+#undef ENABLE_JVMPI"}, {"sha": "ba60ba0b6aaace4a92d139659e708055ddeabe15", "filename": "libjava/boehm.cc", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Fboehm.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Fboehm.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fboehm.cc?ref=54c2f04ba05ce07e701345bc66d038b7d47a9bed", "patch": "@@ -69,6 +69,9 @@ static ptr_t *obj_free_list;\n // Freelist used for Java arrays.\n static ptr_t *array_free_list;\n \n+// Lock used to protect access to Boehm's GC_enable/GC_disable functions.\n+static _Jv_Mutex_t disable_gc_mutex;\n+\n \f\n \n // This is called by the GC during the mark phase.  It marks a Java\n@@ -391,6 +394,26 @@ _Jv_GCSetMaximumHeapSize (size_t size)\n   GC_set_max_heap_size ((GC_word) size);\n }\n \n+// From boehm's misc.c \n+extern \"C\" void GC_enable();\n+extern \"C\" void GC_disable();\n+\n+void\n+_Jv_DisableGC (void)\n+{\n+  _Jv_MutexLock (&disable_gc_mutex); \n+  GC_disable();\n+  _Jv_MutexUnlock (&disable_gc_mutex); \n+}\n+\n+void\n+_Jv_EnableGC (void)\n+{\n+  _Jv_MutexLock (&disable_gc_mutex); \n+  GC_enable();\n+  _Jv_MutexUnlock (&disable_gc_mutex); \n+}\n+\n void\n _Jv_InitGC (void)\n {\n@@ -443,6 +466,8 @@ _Jv_InitGC (void)\n   GC_obj_kinds[array_kind_x].ok_relocate_descr = FALSE;\n   GC_obj_kinds[array_kind_x].ok_init = TRUE;\n \n+  _Jv_MutexInit (&disable_gc_mutex);\n+\n   UNLOCK ();\n   ENABLE_SIGNALS ();\n }"}, {"sha": "a45dc3c889dca72efc850ff1a39ec52419641583", "filename": "libjava/configure", "status": "modified", "additions": 266, "deletions": 210, "changes": 476, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fconfigure?ref=54c2f04ba05ce07e701345bc66d038b7d47a9bed", "patch": "@@ -44,6 +44,8 @@ ac_help=\"$ac_help\n   --enable-sjlj-exceptions    use setjmp/longjmp exceptions\"\n ac_help=\"$ac_help\n   --disable-java-net      disable java.net\"\n+ac_help=\"$ac_help\n+  --disable-jvmpi         disable JVMPI support\"\n ac_help=\"$ac_help\n   --with-ecos             enable runtime eCos target support\"\n ac_help=\"$ac_help\n@@ -622,7 +624,7 @@ else { echo \"configure: error: can not run $ac_config_sub\" 1>&2; exit 1; }\n fi\n \n echo $ac_n \"checking host system type\"\"... $ac_c\" 1>&6\n-echo \"configure:626: checking host system type\" >&5\n+echo \"configure:628: checking host system type\" >&5\n \n host_alias=$host\n case \"$host_alias\" in\n@@ -643,7 +645,7 @@ host_os=`echo $host | sed 's/^\\([^-]*\\)-\\([^-]*\\)-\\(.*\\)$/\\3/'`\n echo \"$ac_t\"\"$host\" 1>&6\n \n echo $ac_n \"checking target system type\"\"... $ac_c\" 1>&6\n-echo \"configure:647: checking target system type\" >&5\n+echo \"configure:649: checking target system type\" >&5\n \n target_alias=$target\n case \"$target_alias\" in\n@@ -661,7 +663,7 @@ target_os=`echo $target | sed 's/^\\([^-]*\\)-\\([^-]*\\)-\\(.*\\)$/\\3/'`\n echo \"$ac_t\"\"$target\" 1>&6\n \n echo $ac_n \"checking build system type\"\"... $ac_c\" 1>&6\n-echo \"configure:665: checking build system type\" >&5\n+echo \"configure:667: checking build system type\" >&5\n \n build_alias=$build\n case \"$build_alias\" in\n@@ -709,7 +711,7 @@ fi\n # SVR4 /usr/ucb/install, which tries to use the nonexistent group \"staff\"\n # ./install, which can be erroneously created by make from ./install.sh.\n echo $ac_n \"checking for a BSD compatible install\"\"... $ac_c\" 1>&6\n-echo \"configure:713: checking for a BSD compatible install\" >&5\n+echo \"configure:715: checking for a BSD compatible install\" >&5\n if test -z \"$INSTALL\"; then\n if eval \"test \\\"`echo '$''{'ac_cv_path_install'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n@@ -762,7 +764,7 @@ test -z \"$INSTALL_SCRIPT\" && INSTALL_SCRIPT='${INSTALL_PROGRAM}'\n test -z \"$INSTALL_DATA\" && INSTALL_DATA='${INSTALL} -m 644'\n \n echo $ac_n \"checking whether build environment is sane\"\"... $ac_c\" 1>&6\n-echo \"configure:766: checking whether build environment is sane\" >&5\n+echo \"configure:768: checking whether build environment is sane\" >&5\n # Just in case\n sleep 1\n echo timestamp > conftestfile\n@@ -819,7 +821,7 @@ test \"$program_suffix\" != NONE &&\n test \"$program_transform_name\" = \"\" && program_transform_name=\"s,x,x,\"\n \n echo $ac_n \"checking whether ${MAKE-make} sets \\${MAKE}\"\"... $ac_c\" 1>&6\n-echo \"configure:823: checking whether ${MAKE-make} sets \\${MAKE}\" >&5\n+echo \"configure:825: checking whether ${MAKE-make} sets \\${MAKE}\" >&5\n set dummy ${MAKE-make}; ac_make=`echo \"$2\" | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_prog_make_${ac_make}_set'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n@@ -852,12 +854,12 @@ else\n fi\n \n echo $ac_n \"checking for Cygwin environment\"\"... $ac_c\" 1>&6\n-echo \"configure:856: checking for Cygwin environment\" >&5\n+echo \"configure:858: checking for Cygwin environment\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_cygwin'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 861 \"configure\"\n+#line 863 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n@@ -868,7 +870,7 @@ int main() {\n return __CYGWIN__;\n ; return 0; }\n EOF\n-if { (eval echo configure:872: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:874: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   ac_cv_cygwin=yes\n else\n@@ -885,19 +887,19 @@ echo \"$ac_t\"\"$ac_cv_cygwin\" 1>&6\n CYGWIN=\n test \"$ac_cv_cygwin\" = yes && CYGWIN=yes\n echo $ac_n \"checking for mingw32 environment\"\"... $ac_c\" 1>&6\n-echo \"configure:889: checking for mingw32 environment\" >&5\n+echo \"configure:891: checking for mingw32 environment\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_mingw32'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 894 \"configure\"\n+#line 896 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n return __MINGW32__;\n ; return 0; }\n EOF\n-if { (eval echo configure:901: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:903: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   ac_cv_mingw32=yes\n else\n@@ -945,7 +947,7 @@ else { echo \"configure: error: can not run $ac_config_sub\" 1>&2; exit 1; }\n fi\n \n echo $ac_n \"checking host system type\"\"... $ac_c\" 1>&6\n-echo \"configure:949: checking host system type\" >&5\n+echo \"configure:951: checking host system type\" >&5\n \n host_alias=$host\n case \"$host_alias\" in\n@@ -987,7 +989,7 @@ EOF\n \n missing_dir=`cd $ac_aux_dir && pwd`\n echo $ac_n \"checking for working aclocal\"\"... $ac_c\" 1>&6\n-echo \"configure:991: checking for working aclocal\" >&5\n+echo \"configure:993: checking for working aclocal\" >&5\n # Run test in a subshell; some versions of sh will print an error if\n # an executable is not found, even if stderr is redirected.\n # Redirect stdin to placate older versions of autoconf.  Sigh.\n@@ -1000,7 +1002,7 @@ else\n fi\n \n echo $ac_n \"checking for working autoconf\"\"... $ac_c\" 1>&6\n-echo \"configure:1004: checking for working autoconf\" >&5\n+echo \"configure:1006: checking for working autoconf\" >&5\n # Run test in a subshell; some versions of sh will print an error if\n # an executable is not found, even if stderr is redirected.\n # Redirect stdin to placate older versions of autoconf.  Sigh.\n@@ -1013,7 +1015,7 @@ else\n fi\n \n echo $ac_n \"checking for working automake\"\"... $ac_c\" 1>&6\n-echo \"configure:1017: checking for working automake\" >&5\n+echo \"configure:1019: checking for working automake\" >&5\n # Run test in a subshell; some versions of sh will print an error if\n # an executable is not found, even if stderr is redirected.\n # Redirect stdin to placate older versions of autoconf.  Sigh.\n@@ -1026,7 +1028,7 @@ else\n fi\n \n echo $ac_n \"checking for working autoheader\"\"... $ac_c\" 1>&6\n-echo \"configure:1030: checking for working autoheader\" >&5\n+echo \"configure:1032: checking for working autoheader\" >&5\n # Run test in a subshell; some versions of sh will print an error if\n # an executable is not found, even if stderr is redirected.\n # Redirect stdin to placate older versions of autoconf.  Sigh.\n@@ -1039,7 +1041,7 @@ else\n fi\n \n echo $ac_n \"checking for working makeinfo\"\"... $ac_c\" 1>&6\n-echo \"configure:1043: checking for working makeinfo\" >&5\n+echo \"configure:1045: checking for working makeinfo\" >&5\n # Run test in a subshell; some versions of sh will print an error if\n # an executable is not found, even if stderr is redirected.\n # Redirect stdin to placate older versions of autoconf.  Sigh.\n@@ -1065,7 +1067,7 @@ fi\n # Extract the first word of \"gcc\", so it can be a program name with args.\n set dummy gcc; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1069: checking for $ac_word\" >&5\n+echo \"configure:1071: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CC'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1095,7 +1097,7 @@ if test -z \"$CC\"; then\n   # Extract the first word of \"cc\", so it can be a program name with args.\n set dummy cc; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1099: checking for $ac_word\" >&5\n+echo \"configure:1101: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CC'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1144,7 +1146,7 @@ fi\n fi\n \n echo $ac_n \"checking whether we are using GNU C\"\"... $ac_c\" 1>&6\n-echo \"configure:1148: checking whether we are using GNU C\" >&5\n+echo \"configure:1150: checking whether we are using GNU C\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_gcc'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1153,7 +1155,7 @@ else\n   yes;\n #endif\n EOF\n-if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:1157: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n+if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:1159: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n   ac_cv_prog_gcc=yes\n else\n   ac_cv_prog_gcc=no\n@@ -1168,7 +1170,7 @@ if test $ac_cv_prog_gcc = yes; then\n   ac_save_CFLAGS=\"$CFLAGS\"\n   CFLAGS=\n   echo $ac_n \"checking whether ${CC-cc} accepts -g\"\"... $ac_c\" 1>&6\n-echo \"configure:1172: checking whether ${CC-cc} accepts -g\" >&5\n+echo \"configure:1174: checking whether ${CC-cc} accepts -g\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_cc_g'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1205,7 +1207,7 @@ do\n # Extract the first word of \"$ac_prog\", so it can be a program name with args.\n set dummy $ac_prog; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1209: checking for $ac_word\" >&5\n+echo \"configure:1211: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CXX'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1238,7 +1240,7 @@ test -n \"$CXX\" || CXX=\"gcc\"\n test -z \"$CXX\" && { echo \"configure: error: no acceptable c++ found in \\$PATH\" 1>&2; exit 1; }\n \n echo $ac_n \"checking whether we are using GNU C++\"\"... $ac_c\" 1>&6\n-echo \"configure:1242: checking whether we are using GNU C++\" >&5\n+echo \"configure:1244: checking whether we are using GNU C++\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_gxx'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1247,7 +1249,7 @@ else\n   yes;\n #endif\n EOF\n-if { ac_try='${CXX-g++} -E conftest.C'; { (eval echo configure:1251: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n+if { ac_try='${CXX-g++} -E conftest.C'; { (eval echo configure:1253: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n   ac_cv_prog_gxx=yes\n else\n   ac_cv_prog_gxx=no\n@@ -1262,7 +1264,7 @@ if test $ac_cv_prog_gxx = yes; then\n   ac_save_CXXFLAGS=\"$CXXFLAGS\"\n   CXXFLAGS=\n   echo $ac_n \"checking whether ${CXX-g++} accepts -g\"\"... $ac_c\" 1>&6\n-echo \"configure:1266: checking whether ${CXX-g++} accepts -g\" >&5\n+echo \"configure:1268: checking whether ${CXX-g++} accepts -g\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_cxx_g'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1295,7 +1297,7 @@ fi\n # LIBGCJ_CONFIGURE, which doesn't work because that means that it will\n # be run before AC_CANONICAL_HOST.\n echo $ac_n \"checking build system type\"\"... $ac_c\" 1>&6\n-echo \"configure:1299: checking build system type\" >&5\n+echo \"configure:1301: checking build system type\" >&5\n \n build_alias=$build\n case \"$build_alias\" in\n@@ -1316,7 +1318,7 @@ echo \"$ac_t\"\"$build\" 1>&6\n # Extract the first word of \"${ac_tool_prefix}as\", so it can be a program name with args.\n set dummy ${ac_tool_prefix}as; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1320: checking for $ac_word\" >&5\n+echo \"configure:1322: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_AS'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1348,7 +1350,7 @@ fi\n # Extract the first word of \"${ac_tool_prefix}ar\", so it can be a program name with args.\n set dummy ${ac_tool_prefix}ar; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1352: checking for $ac_word\" >&5\n+echo \"configure:1354: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_AR'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1380,7 +1382,7 @@ fi\n # Extract the first word of \"${ac_tool_prefix}ranlib\", so it can be a program name with args.\n set dummy ${ac_tool_prefix}ranlib; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1384: checking for $ac_word\" >&5\n+echo \"configure:1386: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1412,7 +1414,7 @@ if test -n \"$ac_tool_prefix\"; then\n   # Extract the first word of \"ranlib\", so it can be a program name with args.\n set dummy ranlib; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1416: checking for $ac_word\" >&5\n+echo \"configure:1418: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1457,7 +1459,7 @@ fi\n # SVR4 /usr/ucb/install, which tries to use the nonexistent group \"staff\"\n # ./install, which can be erroneously created by make from ./install.sh.\n echo $ac_n \"checking for a BSD compatible install\"\"... $ac_c\" 1>&6\n-echo \"configure:1461: checking for a BSD compatible install\" >&5\n+echo \"configure:1463: checking for a BSD compatible install\" >&5\n if test -z \"$INSTALL\"; then\n if eval \"test \\\"`echo '$''{'ac_cv_path_install'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n@@ -1511,7 +1513,7 @@ test -z \"$INSTALL_DATA\" && INSTALL_DATA='${INSTALL} -m 644'\n \n \n echo $ac_n \"checking whether to enable maintainer-specific portions of Makefiles\"\"... $ac_c\" 1>&6\n-echo \"configure:1515: checking whether to enable maintainer-specific portions of Makefiles\" >&5\n+echo \"configure:1517: checking whether to enable maintainer-specific portions of Makefiles\" >&5\n     # Check whether --enable-maintainer-mode or --disable-maintainer-mode was given.\n if test \"${enable_maintainer_mode+set}\" = set; then\n   enableval=\"$enable_maintainer_mode\"\n@@ -1545,7 +1547,7 @@ if false; then\n   \n \n echo $ac_n \"checking for executable suffix\"\"... $ac_c\" 1>&6\n-echo \"configure:1549: checking for executable suffix\" >&5\n+echo \"configure:1551: checking for executable suffix\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_exeext'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1555,7 +1557,7 @@ else\n   rm -f conftest*\n   echo 'int main () { return 0; }' > conftest.$ac_ext\n   ac_cv_exeext=\n-  if { (eval echo configure:1559: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; }; then\n+  if { (eval echo configure:1561: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; }; then\n     for file in conftest.*; do\n       case $file in\n       *.c | *.o | *.obj | *.ilk | *.pdb) ;;\n@@ -1699,7 +1701,7 @@ fi\n # Extract the first word of \"ranlib\", so it can be a program name with args.\n set dummy ranlib; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1703: checking for $ac_word\" >&5\n+echo \"configure:1705: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1738,7 +1740,7 @@ ac_prog=ld\n if test \"$ac_cv_prog_gcc\" = yes; then\n   # Check if gcc -print-prog-name=ld gives a path.\n   echo $ac_n \"checking for ld used by GCC\"\"... $ac_c\" 1>&6\n-echo \"configure:1742: checking for ld used by GCC\" >&5\n+echo \"configure:1744: checking for ld used by GCC\" >&5\n   ac_prog=`($CC -print-prog-name=ld) 2>&5`\n   case \"$ac_prog\" in\n     # Accept absolute paths.\n@@ -1762,10 +1764,10 @@ echo \"configure:1742: checking for ld used by GCC\" >&5\n   esac\n elif test \"$with_gnu_ld\" = yes; then\n   echo $ac_n \"checking for GNU ld\"\"... $ac_c\" 1>&6\n-echo \"configure:1766: checking for GNU ld\" >&5\n+echo \"configure:1768: checking for GNU ld\" >&5\n else\n   echo $ac_n \"checking for non-GNU ld\"\"... $ac_c\" 1>&6\n-echo \"configure:1769: checking for non-GNU ld\" >&5\n+echo \"configure:1771: checking for non-GNU ld\" >&5\n fi\n if eval \"test \\\"`echo '$''{'ac_cv_path_LD'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n@@ -1800,7 +1802,7 @@ else\n fi\n test -z \"$LD\" && { echo \"configure: error: no acceptable ld found in \\$PATH\" 1>&2; exit 1; }\n echo $ac_n \"checking if the linker ($LD) is GNU ld\"\"... $ac_c\" 1>&6\n-echo \"configure:1804: checking if the linker ($LD) is GNU ld\" >&5\n+echo \"configure:1806: checking if the linker ($LD) is GNU ld\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_gnu_ld'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1816,7 +1818,7 @@ echo \"$ac_t\"\"$ac_cv_prog_gnu_ld\" 1>&6\n \n \n echo $ac_n \"checking for BSD-compatible nm\"\"... $ac_c\" 1>&6\n-echo \"configure:1820: checking for BSD-compatible nm\" >&5\n+echo \"configure:1822: checking for BSD-compatible nm\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_path_NM'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1852,7 +1854,7 @@ NM=\"$ac_cv_path_NM\"\n echo \"$ac_t\"\"$NM\" 1>&6\n \n echo $ac_n \"checking whether ln -s works\"\"... $ac_c\" 1>&6\n-echo \"configure:1856: checking whether ln -s works\" >&5\n+echo \"configure:1858: checking whether ln -s works\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_LN_S'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1901,8 +1903,8 @@ test x\"$silent\" = xyes && libtool_flags=\"$libtool_flags --silent\"\n case \"$lt_target\" in\n *-*-irix6*)\n   # Find out which ABI we are using.\n-  echo '#line 1905 \"configure\"' > conftest.$ac_ext\n-  if { (eval echo configure:1906: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+  echo '#line 1907 \"configure\"' > conftest.$ac_ext\n+  if { (eval echo configure:1908: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n     case \"`/usr/bin/file conftest.o`\" in\n     *32-bit*)\n       LD=\"${LD-ld} -32\"\n@@ -1923,19 +1925,19 @@ case \"$lt_target\" in\n   SAVE_CFLAGS=\"$CFLAGS\"\n   CFLAGS=\"$CFLAGS -belf\"\n   echo $ac_n \"checking whether the C compiler needs -belf\"\"... $ac_c\" 1>&6\n-echo \"configure:1927: checking whether the C compiler needs -belf\" >&5\n+echo \"configure:1929: checking whether the C compiler needs -belf\" >&5\n if eval \"test \\\"`echo '$''{'lt_cv_cc_needs_belf'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1932 \"configure\"\n+#line 1934 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n \n ; return 0; }\n EOF\n-if { (eval echo configure:1939: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:1941: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   lt_cv_cc_needs_belf=yes\n else\n@@ -2142,18 +2144,18 @@ if test \"$ac_cv_prog_gnu_ld\" = yes; then\n fi   \n \n echo $ac_n \"checking for data_start\"\"... $ac_c\" 1>&6\n-echo \"configure:2146: checking for data_start\" >&5\n+echo \"configure:2148: checking for data_start\" >&5\n LIBDATASTARTSPEC=\n NEEDS_DATA_START=\n cat > conftest.$ac_ext <<EOF\n-#line 2150 \"configure\"\n+#line 2152 \"configure\"\n #include \"confdefs.h\"\n extern int data_start;\n int main() {\n return ((int) &data_start);\n ; return 0; }\n EOF\n-if { (eval echo configure:2157: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2159: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   echo \"$ac_t\"\"found it\" 1>&6\n else\n@@ -2184,6 +2186,20 @@ EOF\n \n fi\n \n+# Check whether --enable-jvmpi or --disable-jvmpi was given.\n+if test \"${enable_jvmpi+set}\" = set; then\n+  enableval=\"$enable_jvmpi\"\n+  :\n+fi\n+\n+\n+if test \"$enable_jvmpi\" != no; then\n+    cat >> confdefs.h <<\\EOF\n+#define ENABLE_JVMPI 1\n+EOF\n+\n+fi\n+\n TARGET_ECOS=\"no\"\n # Check whether --with-ecos or --without-ecos was given.\n if test \"${with_ecos+set}\" = set; then\n@@ -2209,7 +2225,7 @@ EOF\n esac\n \n echo $ac_n \"checking how to run the C preprocessor\"\"... $ac_c\" 1>&6\n-echo \"configure:2213: checking how to run the C preprocessor\" >&5\n+echo \"configure:2229: checking how to run the C preprocessor\" >&5\n # On Suns, sometimes $CPP names a directory.\n if test -n \"$CPP\" && test -d \"$CPP\"; then\n   CPP=\n@@ -2224,13 +2240,13 @@ else\n   # On the NeXT, cc -E runs the code through the compiler's parser,\n   # not just through cpp.\n   cat > conftest.$ac_ext <<EOF\n-#line 2228 \"configure\"\n+#line 2244 \"configure\"\n #include \"confdefs.h\"\n #include <assert.h>\n Syntax Error\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:2234: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:2250: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   :\n@@ -2241,13 +2257,13 @@ else\n   rm -rf conftest*\n   CPP=\"${CC-cc} -E -traditional-cpp\"\n   cat > conftest.$ac_ext <<EOF\n-#line 2245 \"configure\"\n+#line 2261 \"configure\"\n #include \"confdefs.h\"\n #include <assert.h>\n Syntax Error\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:2251: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:2267: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   :\n@@ -2258,13 +2274,13 @@ else\n   rm -rf conftest*\n   CPP=\"${CC-cc} -nologo -E\"\n   cat > conftest.$ac_ext <<EOF\n-#line 2262 \"configure\"\n+#line 2278 \"configure\"\n #include \"confdefs.h\"\n #include <assert.h>\n Syntax Error\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:2268: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:2284: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   :\n@@ -2289,7 +2305,7 @@ fi\n echo \"$ac_t\"\"$CPP\" 1>&6\n \n cat > conftest.$ac_ext <<EOF\n-#line 2293 \"configure\"\n+#line 2309 \"configure\"\n #include \"confdefs.h\"\n #include <stdint.h>\n EOF\n@@ -2304,7 +2320,7 @@ fi\n rm -f conftest*\n \n cat > conftest.$ac_ext <<EOF\n-#line 2308 \"configure\"\n+#line 2324 \"configure\"\n #include \"confdefs.h\"\n #include <inttypes.h>\n EOF\n@@ -2319,7 +2335,7 @@ fi\n rm -f conftest*\n \n cat > conftest.$ac_ext <<EOF\n-#line 2323 \"configure\"\n+#line 2339 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n EOF\n@@ -2334,7 +2350,7 @@ fi\n rm -f conftest*\n \n cat > conftest.$ac_ext <<EOF\n-#line 2338 \"configure\"\n+#line 2354 \"configure\"\n #include \"confdefs.h\"\n #include <sys/config.h>\n EOF\n@@ -2351,7 +2367,7 @@ rm -f conftest*\n \n \n cat > conftest.$ac_ext <<EOF\n-#line 2355 \"configure\"\n+#line 2371 \"configure\"\n #include \"confdefs.h\"\n #include <time.h>\n EOF\n@@ -2366,7 +2382,7 @@ fi\n rm -f conftest*\n \n cat > conftest.$ac_ext <<EOF\n-#line 2370 \"configure\"\n+#line 2386 \"configure\"\n #include \"confdefs.h\"\n #include <time.h>\n EOF\n@@ -2409,7 +2425,7 @@ ZLIBTESTSPEC=\n libsubdir=.libs\n \n echo $ac_n \"checking for garbage collector to use\"\"... $ac_c\" 1>&6\n-echo \"configure:2413: checking for garbage collector to use\" >&5\n+echo \"configure:2429: checking for garbage collector to use\" >&5\n # Check whether --enable-java-gc or --disable-java-gc was given.\n if test \"${enable_java_gc+set}\" = set; then\n   enableval=\"$enable_java_gc\"\n@@ -2462,7 +2478,7 @@ esac\n \n \n echo $ac_n \"checking for threads package to use\"\"... $ac_c\" 1>&6\n-echo \"configure:2466: checking for threads package to use\" >&5\n+echo \"configure:2482: checking for threads package to use\" >&5\n # Check whether --enable-threads or --disable-threads was given.\n if test \"${enable_threads+set}\" = set; then\n   enableval=\"$enable_threads\"\n@@ -2643,12 +2659,12 @@ else\n    for ac_func in strerror ioctl select fstat open fsync sleep\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2647: checking for $ac_func\" >&5\n+echo \"configure:2663: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2652 \"configure\"\n+#line 2668 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2671,7 +2687,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2675: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2691: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2698,12 +2714,12 @@ done\n    for ac_func in gmtime_r localtime_r readdir_r getpwuid_r getcwd\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2702: checking for $ac_func\" >&5\n+echo \"configure:2718: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2707 \"configure\"\n+#line 2723 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2726,7 +2742,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2730: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2746: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2753,12 +2769,12 @@ done\n    for ac_func in access stat mkdir rename rmdir unlink realpath iconv\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2757: checking for $ac_func\" >&5\n+echo \"configure:2773: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2762 \"configure\"\n+#line 2778 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2781,7 +2797,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2785: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2801: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2808,12 +2824,12 @@ done\n    for ac_func in inet_aton inet_addr\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2812: checking for $ac_func\" >&5\n+echo \"configure:2828: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2817 \"configure\"\n+#line 2833 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2836,7 +2852,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2840: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2856: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2863,12 +2879,12 @@ done\n    for ac_func in inet_pton uname inet_ntoa\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2867: checking for $ac_func\" >&5\n+echo \"configure:2883: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2872 \"configure\"\n+#line 2888 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2891,7 +2907,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2895: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2911: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2918,12 +2934,12 @@ done\n    for ac_func in backtrace fork execvp pipe\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2922: checking for $ac_func\" >&5\n+echo \"configure:2938: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2927 \"configure\"\n+#line 2943 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2946,7 +2962,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2950: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2966: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2974,17 +2990,17 @@ done\n do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:2978: checking for $ac_hdr\" >&5\n+echo \"configure:2994: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2983 \"configure\"\n+#line 2999 \"configure\"\n #include \"confdefs.h\"\n #include <$ac_hdr>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:2988: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:3004: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -3011,15 +3027,15 @@ fi\n done\n  \n    echo $ac_n \"checking for dladdr in -ldl\"\"... $ac_c\" 1>&6\n-echo \"configure:3015: checking for dladdr in -ldl\" >&5\n+echo \"configure:3031: checking for dladdr in -ldl\" >&5\n ac_lib_var=`echo dl'_'dladdr | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-ldl  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 3023 \"configure\"\n+#line 3039 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -3030,7 +3046,7 @@ int main() {\n dladdr()\n ; return 0; }\n EOF\n-if { (eval echo configure:3034: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3050: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -3059,7 +3075,7 @@ do\n \n ac_safe=`echo \"$ac_file\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_file\"\"... $ac_c\" 1>&6\n-echo \"configure:3063: checking for $ac_file\" >&5\n+echo \"configure:3079: checking for $ac_file\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_file_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3094,12 +3110,12 @@ done\n    for ac_func in gethostbyname_r\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3098: checking for $ac_func\" >&5\n+echo \"configure:3114: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3103 \"configure\"\n+#line 3119 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3122,7 +3138,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3126: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3142: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3149,7 +3165,7 @@ EOF\n      # We look for the one that returns `int'.\n      # Hopefully this check is robust enough.\n      cat > conftest.$ac_ext <<EOF\n-#line 3153 \"configure\"\n+#line 3169 \"configure\"\n #include \"confdefs.h\"\n #include <netdb.h>\n EOF\n@@ -3169,7 +3185,7 @@ rm -f conftest*\n      *\" -D_REENTRANT \"*) ;;\n      *)\n \t\techo $ac_n \"checking whether gethostbyname_r declaration requires -D_REENTRANT\"\"... $ac_c\" 1>&6\n-echo \"configure:3173: checking whether gethostbyname_r declaration requires -D_REENTRANT\" >&5\n+echo \"configure:3189: checking whether gethostbyname_r declaration requires -D_REENTRANT\" >&5\n if eval \"test \\\"`echo '$''{'libjava_cv_gethostbyname_r_needs_reentrant'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3182,14 +3198,14 @@ ac_link='${CXX-g++} -o conftest${ac_exeext} $CXXFLAGS $CPPFLAGS $LDFLAGS conftes\n cross_compiling=$ac_cv_prog_cxx_cross\n \n \t  cat > conftest.$ac_ext <<EOF\n-#line 3186 \"configure\"\n+#line 3202 \"configure\"\n #include \"confdefs.h\"\n #include <netdb.h>\n int main() {\n gethostbyname_r(\"\", 0, 0);\n ; return 0; }\n EOF\n-if { (eval echo configure:3193: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:3209: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   libjava_cv_gethostbyname_r_needs_reentrant=no\n else\n@@ -3199,14 +3215,14 @@ else\n   \t\tCPPFLAGS_SAVE=\"$CPPFLAGS\"\n \t\tCPPFLAGS=\"$CPPFLAGS -D_REENTRANT\"\n \t\tcat > conftest.$ac_ext <<EOF\n-#line 3203 \"configure\"\n+#line 3219 \"configure\"\n #include \"confdefs.h\"\n #include <netdb.h>\n int main() {\n gethostbyname_r(\"\", 0, 0);\n ; return 0; }\n EOF\n-if { (eval echo configure:3210: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:3226: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   libjava_cv_gethostbyname_r_needs_reentrant=yes\n else\n@@ -3241,12 +3257,12 @@ EOF\n      esac\n \n      echo $ac_n \"checking for struct hostent_data\"\"... $ac_c\" 1>&6\n-echo \"configure:3245: checking for struct hostent_data\" >&5\n+echo \"configure:3261: checking for struct hostent_data\" >&5\n if eval \"test \\\"`echo '$''{'libjava_cv_struct_hostent_data'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   \tcat > conftest.$ac_ext <<EOF\n-#line 3250 \"configure\"\n+#line 3266 \"configure\"\n #include \"confdefs.h\"\n \n #if GETHOSTBYNAME_R_NEEDS_REENTRANT && !defined(_REENTRANT)\n@@ -3257,7 +3273,7 @@ int main() {\n struct hostent_data data;\n ; return 0; }\n EOF\n-if { (eval echo configure:3261: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:3277: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   libjava_cv_struct_hostent_data=yes\n else\n@@ -3286,12 +3302,12 @@ done\n    for ac_func in gethostbyaddr_r\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3290: checking for $ac_func\" >&5\n+echo \"configure:3306: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3295 \"configure\"\n+#line 3311 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3314,7 +3330,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3318: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3334: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3341,7 +3357,7 @@ EOF\n      # We look for the one that returns `int'.\n      # Hopefully this check is robust enough.\n      cat > conftest.$ac_ext <<EOF\n-#line 3345 \"configure\"\n+#line 3361 \"configure\"\n #include \"confdefs.h\"\n #include <netdb.h>\n EOF\n@@ -3365,12 +3381,12 @@ done\n    for ac_func in gethostname\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3369: checking for $ac_func\" >&5\n+echo \"configure:3385: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3374 \"configure\"\n+#line 3390 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3393,7 +3409,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3397: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3413: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3417,7 +3433,7 @@ EOF\n EOF\n \n      cat > conftest.$ac_ext <<EOF\n-#line 3421 \"configure\"\n+#line 3437 \"configure\"\n #include \"confdefs.h\"\n #include <unistd.h>\n EOF\n@@ -3448,12 +3464,12 @@ done\n       for ac_func in pthread_mutexattr_settype pthread_mutexattr_setkind_np\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3452: checking for $ac_func\" >&5\n+echo \"configure:3468: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3457 \"configure\"\n+#line 3473 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3476,7 +3492,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3480: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3496: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3506,12 +3522,12 @@ done\n       for ac_func in sched_yield\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3510: checking for $ac_func\" >&5\n+echo \"configure:3526: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3515 \"configure\"\n+#line 3531 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3534,7 +3550,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3538: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3554: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3556,15 +3572,15 @@ EOF\n else\n   echo \"$ac_t\"\"no\" 1>&6\n echo $ac_n \"checking for sched_yield in -lrt\"\"... $ac_c\" 1>&6\n-echo \"configure:3560: checking for sched_yield in -lrt\" >&5\n+echo \"configure:3576: checking for sched_yield in -lrt\" >&5\n ac_lib_var=`echo rt'_'sched_yield | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lrt  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 3568 \"configure\"\n+#line 3584 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -3575,7 +3591,7 @@ int main() {\n sched_yield()\n ; return 0; }\n EOF\n-if { (eval echo configure:3579: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3595: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -3601,15 +3617,15 @@ else\n   echo \"$ac_t\"\"no\" 1>&6\n \n \t  echo $ac_n \"checking for sched_yield in -lposix4\"\"... $ac_c\" 1>&6\n-echo \"configure:3605: checking for sched_yield in -lposix4\" >&5\n+echo \"configure:3621: checking for sched_yield in -lposix4\" >&5\n ac_lib_var=`echo posix4'_'sched_yield | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lposix4  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 3613 \"configure\"\n+#line 3629 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -3620,7 +3636,7 @@ int main() {\n sched_yield()\n ; return 0; }\n EOF\n-if { (eval echo configure:3624: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3640: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -3656,7 +3672,7 @@ done\n       # We can save a little space at runtime if the mutex has m_count\n       # or __m_count.  This is a nice hack for Linux.\n       cat > conftest.$ac_ext <<EOF\n-#line 3660 \"configure\"\n+#line 3676 \"configure\"\n #include \"confdefs.h\"\n #include <pthread.h>\n int main() {\n@@ -3665,7 +3681,7 @@ int main() {\n         \n ; return 0; }\n EOF\n-if { (eval echo configure:3669: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:3685: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define PTHREAD_MUTEX_HAVE_M_COUNT 1\n@@ -3677,7 +3693,7 @@ else\n   rm -rf conftest*\n   \n \tcat > conftest.$ac_ext <<EOF\n-#line 3681 \"configure\"\n+#line 3697 \"configure\"\n #include \"confdefs.h\"\n #include <pthread.h>\n int main() {\n@@ -3686,7 +3702,7 @@ int main() {\n \t  \n ; return 0; }\n EOF\n-if { (eval echo configure:3690: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:3706: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define PTHREAD_MUTEX_HAVE___M_COUNT 1\n@@ -3706,12 +3722,12 @@ rm -f conftest*\n    for ac_func in gettimeofday time ftime\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3710: checking for $ac_func\" >&5\n+echo \"configure:3726: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3715 \"configure\"\n+#line 3731 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3734,7 +3750,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3738: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3754: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3765,12 +3781,12 @@ done\n    for ac_func in memmove\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3769: checking for $ac_func\" >&5\n+echo \"configure:3785: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3774 \"configure\"\n+#line 3790 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3793,7 +3809,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3797: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3813: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3823,12 +3839,12 @@ done\n    for ac_func in memcpy\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3827: checking for $ac_func\" >&5\n+echo \"configure:3843: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3832 \"configure\"\n+#line 3848 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3851,7 +3867,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3855: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3871: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3899,20 +3915,20 @@ done\n    #--------------------------------------------------------------------\n \n    echo $ac_n \"checking for socket libraries\"\"... $ac_c\" 1>&6\n-echo \"configure:3903: checking for socket libraries\" >&5\n+echo \"configure:3919: checking for socket libraries\" >&5\n if eval \"test \\\"`echo '$''{'gcj_cv_lib_sockets'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   gcj_cv_lib_sockets=\n      gcj_checkBoth=0\n      unset ac_cv_func_connect\n      echo $ac_n \"checking for connect\"\"... $ac_c\" 1>&6\n-echo \"configure:3911: checking for connect\" >&5\n+echo \"configure:3927: checking for connect\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_connect'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3916 \"configure\"\n+#line 3932 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char connect(); below.  */\n@@ -3935,7 +3951,7 @@ connect();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3939: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3955: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_connect=yes\"\n else\n@@ -3958,22 +3974,22 @@ fi\n      if test \"$gcj_checkSocket\" = 1; then\n \t unset ac_cv_func_connect\n \t echo $ac_n \"checking for main in -lsocket\"\"... $ac_c\" 1>&6\n-echo \"configure:3962: checking for main in -lsocket\" >&5\n+echo \"configure:3978: checking for main in -lsocket\" >&5\n ac_lib_var=`echo socket'_'main | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lsocket  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 3970 \"configure\"\n+#line 3986 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n main()\n ; return 0; }\n EOF\n-if { (eval echo configure:3977: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3993: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4000,12 +4016,12 @@ fi\n \t LIBS=\"$LIBS -lsocket -lnsl\"\n \t unset ac_cv_func_accept\n \t echo $ac_n \"checking for accept\"\"... $ac_c\" 1>&6\n-echo \"configure:4004: checking for accept\" >&5\n+echo \"configure:4020: checking for accept\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_accept'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4009 \"configure\"\n+#line 4025 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char accept(); below.  */\n@@ -4028,7 +4044,7 @@ accept();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4032: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4048: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_accept=yes\"\n else\n@@ -4055,12 +4071,12 @@ fi\n      gcj_oldLibs=$LIBS\n      LIBS=\"$LIBS $gcj_cv_lib_sockets\"\n      echo $ac_n \"checking for gethostbyname\"\"... $ac_c\" 1>&6\n-echo \"configure:4059: checking for gethostbyname\" >&5\n+echo \"configure:4075: checking for gethostbyname\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_gethostbyname'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4064 \"configure\"\n+#line 4080 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char gethostbyname(); below.  */\n@@ -4083,7 +4099,7 @@ gethostbyname();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4087: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4103: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_gethostbyname=yes\"\n else\n@@ -4101,22 +4117,22 @@ if eval \"test \\\"`echo '$ac_cv_func_'gethostbyname`\\\" = yes\"; then\n else\n   echo \"$ac_t\"\"no\" 1>&6\n echo $ac_n \"checking for main in -lnsl\"\"... $ac_c\" 1>&6\n-echo \"configure:4105: checking for main in -lnsl\" >&5\n+echo \"configure:4121: checking for main in -lnsl\" >&5\n ac_lib_var=`echo nsl'_'main | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lnsl  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4113 \"configure\"\n+#line 4129 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n main()\n ; return 0; }\n EOF\n-if { (eval echo configure:4120: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4136: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4148,15 +4164,15 @@ echo \"$ac_t\"\"$gcj_cv_lib_sockets\" 1>&6\n \n    if test \"$with_system_zlib\" = yes; then\n       echo $ac_n \"checking for deflate in -lz\"\"... $ac_c\" 1>&6\n-echo \"configure:4152: checking for deflate in -lz\" >&5\n+echo \"configure:4168: checking for deflate in -lz\" >&5\n ac_lib_var=`echo z'_'deflate | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lz  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4160 \"configure\"\n+#line 4176 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -4167,7 +4183,7 @@ int main() {\n deflate()\n ; return 0; }\n EOF\n-if { (eval echo configure:4171: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4187: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4197,22 +4213,22 @@ fi\n    # requires -ldl.\n    if test \"$GC\" = boehm; then\n       echo $ac_n \"checking for main in -ldl\"\"... $ac_c\" 1>&6\n-echo \"configure:4201: checking for main in -ldl\" >&5\n+echo \"configure:4217: checking for main in -ldl\" >&5\n ac_lib_var=`echo dl'_'main | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-ldl  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4209 \"configure\"\n+#line 4225 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n main()\n ; return 0; }\n EOF\n-if { (eval echo configure:4216: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4232: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4243,6 +4259,46 @@ fi\n    fi\n fi\n \n+echo $ac_n \"checking size of void *\"\"... $ac_c\" 1>&6\n+echo \"configure:4264: checking size of void *\" >&5\n+if eval \"test \\\"`echo '$''{'ac_cv_sizeof_void_p'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  if test \"$cross_compiling\" = yes; then\n+    { echo \"configure: error: can not run test program while cross compiling\" 1>&2; exit 1; }\n+else\n+  cat > conftest.$ac_ext <<EOF\n+#line 4272 \"configure\"\n+#include \"confdefs.h\"\n+#include <stdio.h>\n+main()\n+{\n+  FILE *f=fopen(\"conftestval\", \"w\");\n+  if (!f) exit(1);\n+  fprintf(f, \"%d\\n\", sizeof(void *));\n+  exit(0);\n+}\n+EOF\n+if { (eval echo configure:4283: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+then\n+  ac_cv_sizeof_void_p=`cat conftestval`\n+else\n+  echo \"configure: failed program was:\" >&5\n+  cat conftest.$ac_ext >&5\n+  rm -fr conftest*\n+  ac_cv_sizeof_void_p=0\n+fi\n+rm -fr conftest*\n+fi\n+\n+fi\n+echo \"$ac_t\"\"$ac_cv_sizeof_void_p\" 1>&6\n+cat >> confdefs.h <<EOF\n+#define SIZEOF_VOID_P $ac_cv_sizeof_void_p\n+EOF\n+\n+\n+\n ZLIBS=\n ZDEPS=\n ZINCS=\n@@ -4332,7 +4388,7 @@ EOF\n # See if gcj supports -fuse-divide-subroutine.  gcc 2.95 does not, and\n # we want to continue to support that version.\n echo $ac_n \"checking whether gcj supports -fuse-divide-subroutine\"\"... $ac_c\" 1>&6\n-echo \"configure:4336: checking whether gcj supports -fuse-divide-subroutine\" >&5\n+echo \"configure:4392: checking whether gcj supports -fuse-divide-subroutine\" >&5\n cat > conftest.java << 'END'\n public class conftest { }\n END\n@@ -4349,18 +4405,18 @@ echo \"$ac_t\"\"$use_fuse\" 1>&6\n \n \n echo $ac_n \"checking for g++ -ffloat-store bug\"\"... $ac_c\" 1>&6\n-echo \"configure:4353: checking for g++ -ffloat-store bug\" >&5\n+echo \"configure:4409: checking for g++ -ffloat-store bug\" >&5\n save_CFLAGS=\"$CFLAGS\"\n CFLAGS=\"-x c++ -O2 -ffloat-store\"\n cat > conftest.$ac_ext <<EOF\n-#line 4357 \"configure\"\n+#line 4413 \"configure\"\n #include \"confdefs.h\"\n #include <math.h>\n int main() {\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4364: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:4420: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   echo \"$ac_t\"\"no\" 1>&6\n else\n@@ -4380,17 +4436,17 @@ for ac_hdr in unistd.h bstring.h sys/time.h sys/types.h fcntl.h sys/ioctl.h sys/\n do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:4384: checking for $ac_hdr\" >&5\n+echo \"configure:4440: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4389 \"configure\"\n+#line 4445 \"configure\"\n #include \"confdefs.h\"\n #include <$ac_hdr>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:4394: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:4450: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -4420,17 +4476,17 @@ for ac_hdr in dirent.h\n do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:4424: checking for $ac_hdr\" >&5\n+echo \"configure:4480: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4429 \"configure\"\n+#line 4485 \"configure\"\n #include \"confdefs.h\"\n #include <$ac_hdr>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:4434: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:4490: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -4458,20 +4514,20 @@ done\n \n \n echo $ac_n \"checking for ANSI C header files\"\"... $ac_c\" 1>&6\n-echo \"configure:4462: checking for ANSI C header files\" >&5\n+echo \"configure:4518: checking for ANSI C header files\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_stdc'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4467 \"configure\"\n+#line 4523 \"configure\"\n #include \"confdefs.h\"\n #include <stdlib.h>\n #include <stdarg.h>\n #include <string.h>\n #include <float.h>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:4475: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:4531: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -4488,7 +4544,7 @@ rm -f conftest*\n if test $ac_cv_header_stdc = yes; then\n   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.\n cat > conftest.$ac_ext <<EOF\n-#line 4492 \"configure\"\n+#line 4548 \"configure\"\n #include \"confdefs.h\"\n #include <string.h>\n EOF\n@@ -4506,7 +4562,7 @@ fi\n if test $ac_cv_header_stdc = yes; then\n   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.\n cat > conftest.$ac_ext <<EOF\n-#line 4510 \"configure\"\n+#line 4566 \"configure\"\n #include \"confdefs.h\"\n #include <stdlib.h>\n EOF\n@@ -4527,7 +4583,7 @@ if test \"$cross_compiling\" = yes; then\n   :\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4531 \"configure\"\n+#line 4587 \"configure\"\n #include \"confdefs.h\"\n #include <ctype.h>\n #define ISLOWER(c) ('a' <= (c) && (c) <= 'z')\n@@ -4538,7 +4594,7 @@ if (XOR (islower (i), ISLOWER (i)) || toupper (i) != TOUPPER (i)) exit(2);\n exit (0); }\n \n EOF\n-if { (eval echo configure:4542: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:4598: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   :\n else\n@@ -4562,12 +4618,12 @@ EOF\n fi\n \n echo $ac_n \"checking for ssize_t\"\"... $ac_c\" 1>&6\n-echo \"configure:4566: checking for ssize_t\" >&5\n+echo \"configure:4622: checking for ssize_t\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_type_ssize_t'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4571 \"configure\"\n+#line 4627 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #if STDC_HEADERS\n@@ -4596,9 +4652,9 @@ fi\n \n \n echo $ac_n \"checking for in_addr_t\"\"... $ac_c\" 1>&6\n-echo \"configure:4600: checking for in_addr_t\" >&5\n+echo \"configure:4656: checking for in_addr_t\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 4602 \"configure\"\n+#line 4658 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #if STDC_HEADERS\n@@ -4612,7 +4668,7 @@ int main() {\n in_addr_t foo;\n ; return 0; }\n EOF\n-if { (eval echo configure:4616: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:4672: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_IN_ADDR_T 1\n@@ -4628,16 +4684,16 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking whether struct ip_mreq is in netinet/in.h\"\"... $ac_c\" 1>&6\n-echo \"configure:4632: checking whether struct ip_mreq is in netinet/in.h\" >&5\n+echo \"configure:4688: checking whether struct ip_mreq is in netinet/in.h\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 4634 \"configure\"\n+#line 4690 \"configure\"\n #include \"confdefs.h\"\n #include <netinet/in.h>\n int main() {\n struct ip_mreq mreq;\n ; return 0; }\n EOF\n-if { (eval echo configure:4641: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:4697: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_STRUCT_IP_MREQ 1\n@@ -4653,16 +4709,16 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking whether struct sockaddr_in6 is in netinet/in.h\"\"... $ac_c\" 1>&6\n-echo \"configure:4657: checking whether struct sockaddr_in6 is in netinet/in.h\" >&5\n+echo \"configure:4713: checking whether struct sockaddr_in6 is in netinet/in.h\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 4659 \"configure\"\n+#line 4715 \"configure\"\n #include \"confdefs.h\"\n #include <netinet/in.h>\n int main() {\n struct sockaddr_in6 addr6;\n ; return 0; }\n EOF\n-if { (eval echo configure:4666: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:4722: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_INET6 1\n@@ -4678,16 +4734,16 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking for socklen_t in sys/socket.h\"\"... $ac_c\" 1>&6\n-echo \"configure:4682: checking for socklen_t in sys/socket.h\" >&5\n+echo \"configure:4738: checking for socklen_t in sys/socket.h\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 4684 \"configure\"\n+#line 4740 \"configure\"\n #include \"confdefs.h\"\n #include <sys/socket.h>\n int main() {\n socklen_t x = 5;\n ; return 0; }\n EOF\n-if { (eval echo configure:4691: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:4747: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_SOCKLEN_T 1\n@@ -4703,16 +4759,16 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking for tm_gmtoff in struct tm\"\"... $ac_c\" 1>&6\n-echo \"configure:4707: checking for tm_gmtoff in struct tm\" >&5\n+echo \"configure:4763: checking for tm_gmtoff in struct tm\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 4709 \"configure\"\n+#line 4765 \"configure\"\n #include \"confdefs.h\"\n #include <time.h>\n int main() {\n struct tm tim; tim.tm_gmtoff = 0;\n ; return 0; }\n EOF\n-if { (eval echo configure:4716: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:4772: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define STRUCT_TM_HAS_GMTOFF 1\n@@ -4725,16 +4781,16 @@ else\n   rm -rf conftest*\n   echo \"$ac_t\"\"no\" 1>&6\n    echo $ac_n \"checking for global timezone variable\"\"... $ac_c\" 1>&6\n-echo \"configure:4729: checking for global timezone variable\" >&5\n+echo \"configure:4785: checking for global timezone variable\" >&5\n             cat > conftest.$ac_ext <<EOF\n-#line 4731 \"configure\"\n+#line 4787 \"configure\"\n #include \"confdefs.h\"\n #include <time.h>\n int main() {\n long z2 = timezone;\n ; return 0; }\n EOF\n-if { (eval echo configure:4738: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:4794: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_TIMEZONE 1\n@@ -4754,19 +4810,19 @@ rm -f conftest*\n # The Ultrix 4.2 mips builtin alloca declared by alloca.h only works\n # for constant arguments.  Useless!\n echo $ac_n \"checking for working alloca.h\"\"... $ac_c\" 1>&6\n-echo \"configure:4758: checking for working alloca.h\" >&5\n+echo \"configure:4814: checking for working alloca.h\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_alloca_h'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4763 \"configure\"\n+#line 4819 \"configure\"\n #include \"confdefs.h\"\n #include <alloca.h>\n int main() {\n char *p = alloca(2 * sizeof(int));\n ; return 0; }\n EOF\n-if { (eval echo configure:4770: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4826: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_header_alloca_h=yes\n else\n@@ -4787,12 +4843,12 @@ EOF\n fi\n \n echo $ac_n \"checking for alloca\"\"... $ac_c\" 1>&6\n-echo \"configure:4791: checking for alloca\" >&5\n+echo \"configure:4847: checking for alloca\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_alloca_works'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4796 \"configure\"\n+#line 4852 \"configure\"\n #include \"confdefs.h\"\n \n #ifdef __GNUC__\n@@ -4820,7 +4876,7 @@ int main() {\n char *p = (char *) alloca(1);\n ; return 0; }\n EOF\n-if { (eval echo configure:4824: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4880: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_func_alloca_works=yes\n else\n@@ -4852,12 +4908,12 @@ EOF\n \n \n echo $ac_n \"checking whether alloca needs Cray hooks\"\"... $ac_c\" 1>&6\n-echo \"configure:4856: checking whether alloca needs Cray hooks\" >&5\n+echo \"configure:4912: checking whether alloca needs Cray hooks\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_os_cray'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4861 \"configure\"\n+#line 4917 \"configure\"\n #include \"confdefs.h\"\n #if defined(CRAY) && ! defined(CRAY2)\n webecray\n@@ -4882,12 +4938,12 @@ echo \"$ac_t\"\"$ac_cv_os_cray\" 1>&6\n if test $ac_cv_os_cray = yes; then\n for ac_func in _getb67 GETB67 getb67; do\n   echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4886: checking for $ac_func\" >&5\n+echo \"configure:4942: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4891 \"configure\"\n+#line 4947 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4910,7 +4966,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4914: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4970: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4937,15 +4993,15 @@ done\n fi\n \n echo $ac_n \"checking stack direction for C alloca\"\"... $ac_c\" 1>&6\n-echo \"configure:4941: checking stack direction for C alloca\" >&5\n+echo \"configure:4997: checking stack direction for C alloca\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_c_stack_direction'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test \"$cross_compiling\" = yes; then\n   ac_cv_c_stack_direction=0\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4949 \"configure\"\n+#line 5005 \"configure\"\n #include \"confdefs.h\"\n find_stack_direction ()\n {\n@@ -4964,7 +5020,7 @@ main ()\n   exit (find_stack_direction() < 0);\n }\n EOF\n-if { (eval echo configure:4968: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:5024: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   ac_cv_c_stack_direction=1\n else\n@@ -4991,7 +5047,7 @@ do\n # Extract the first word of \"$ac_prog\", so it can be a program name with args.\n set dummy $ac_prog; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4995: checking for $ac_word\" >&5\n+echo \"configure:5051: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_PERL'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else"}, {"sha": "161275abb125f93ed6ab14d87d4226a3bd62683e", "filename": "libjava/configure.in", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Fconfigure.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Fconfigure.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fconfigure.in?ref=54c2f04ba05ce07e701345bc66d038b7d47a9bed", "patch": "@@ -127,6 +127,14 @@ if test \"$enable_java_net\" = no; then\n    AC_DEFINE(DISABLE_JAVA_NET)\n fi\n \n+dnl See if the user wants to disable JVMPI support.\n+AC_ARG_ENABLE(jvmpi,\n+[  --disable-jvmpi         disable JVMPI support])\n+\n+if test \"$enable_jvmpi\" != no; then\n+    AC_DEFINE(ENABLE_JVMPI)\n+fi\n+\n dnl If the target is an eCos system, use the appropriate eCos\n dnl I/O routines.\n dnl FIXME: this should not be a local option but a global target"}, {"sha": "c498ff84d7856f8749e5ac02473fc40518ec648c", "filename": "libjava/gnu/gcj/runtime/natFirstThread.cc", "status": "modified", "additions": 96, "deletions": 1, "changes": 97, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Fgnu%2Fgcj%2Fruntime%2FnatFirstThread.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Fgnu%2Fgcj%2Fruntime%2FnatFirstThread.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgnu%2Fgcj%2Fruntime%2FnatFirstThread.cc?ref=54c2f04ba05ce07e701345bc66d038b7d47a9bed", "patch": "@@ -1,6 +1,6 @@\n // natFirstThread.cc - Implementation of FirstThread native methods.\n \n-/* Copyright (C) 1998, 1999  Free Software Foundation\n+/* Copyright (C) 1998, 1999, 2000  Free Software Foundation\n \n    This file is part of libgcj.\n \n@@ -14,6 +14,7 @@ details.  */\n \n #include <gcj/cni.h>\n #include <jvm.h>\n+#include <jni.h>\n \n #include <gnu/gcj/runtime/FirstThread.h>\n #include <java/lang/Class.h>\n@@ -22,16 +23,56 @@ details.  */\n #include <java/lang/reflect/Modifier.h>\n #include <java/io/PrintStream.h>\n \n+#ifdef ENABLE_JVMPI\n+#include <jvmpi.h>\n+#include <java/lang/ThreadGroup.h>\n+#include <java/lang/UnsatisfiedLinkError.h>\n+#endif\n+\n #define DIE(Message)  die (JvNewStringLatin1 (Message))\n \n typedef void main_func (jobject);\n \n+#ifdef WITH_JVMPI\n+extern void (*_Jv_JVMPI_Notify_THREAD_START) (JVMPI_Event *event);\n+#endif\n+\n+/* This will be non-NULL if the user has preloaded a JNI library, or\n+   linked one into the executable.  */\n+extern \"C\" \n+{\n+#pragma weak JNI_OnLoad\n+  extern jint JNI_OnLoad (JavaVM *, void *) __attribute__((weak));\n+}\n+\n void\n gnu::gcj::runtime::FirstThread::run (void)\n {\n+\n   Utf8Const* main_signature = _Jv_makeUtf8Const (\"([Ljava.lang.String;)V\", 22);\n   Utf8Const* main_name = _Jv_makeUtf8Const (\"main\", 4);\n \n+  /* Some systems let you preload shared libraries before running a\n+     program.  Under Linux, this is done by setting the LD_PRELOAD\n+     environment variable.  We take advatage of this here to allow for\n+     dynamically loading a JNI library into a fully linked executable.  */\n+\n+  if (JNI_OnLoad != NULL)\n+    {\n+      JavaVM *vm = _Jv_GetJavaVM ();\n+      if (vm == NULL)\n+\t{\n+\t  // FIXME: what?\n+\t  return;\n+\t}\n+      jint vers = JNI_OnLoad (vm, NULL);\n+      if (vers != JNI_VERSION_1_1 && vers != JNI_VERSION_1_2)\n+\t{\n+\t  // FIXME: unload the library.\n+\t  _Jv_Throw (new java::lang::UnsatisfiedLinkError (JvNewStringLatin1 (\"unrecognized version from preloaded JNI_OnLoad\")));\n+\t}\n+    }\n+\n   if (klass == NULL)\n     {\n       klass = java::lang::Class::forName (klass_name);\n@@ -48,6 +89,60 @@ gnu::gcj::runtime::FirstThread::run (void)\n   if (! java::lang::reflect::Modifier::isPublic(meth->accflags))\n     DIE (\"`main' must be public\");\n \n+#ifdef WITH_JVMPI\n+  if (_Jv_JVMPI_Notify_THREAD_START)\n+    {\n+      JVMPI_Event event;\n+\n+      jstring thread_name = getName ();\n+      jstring group_name = NULL, parent_name = NULL;\n+      java::lang::ThreadGroup *group = getThreadGroup ();\n+\n+      if (group)\n+\t{\n+\t  group_name = group->getName ();\n+\t  group = group->getParent ();\n+\n+\t  if (group)\n+\t    parent_name = group->getName ();\n+\t}\n+\n+      int thread_len = thread_name ? JvGetStringUTFLength (thread_name) : 0;\n+      int group_len = group_name ? JvGetStringUTFLength (group_name) : 0;\n+      int parent_len = parent_name ? JvGetStringUTFLength (parent_name) : 0;\n+\n+      char thread_chars[thread_len + 1];\n+      char group_chars[group_len + 1];\n+      char parent_chars[parent_len + 1];\n+\n+      if (thread_name)\n+\tJvGetStringUTFRegion (thread_name, 0, \n+\t\t\t      thread_name->length(), thread_chars);\n+      if (group_name)\n+\tJvGetStringUTFRegion (group_name, 0, \n+\t\t\t      group_name->length(), group_chars);\n+      if (parent_name)\n+\tJvGetStringUTFRegion (parent_name, 0, \n+\t\t\t      parent_name->length(), parent_chars);\n+\n+      thread_chars[thread_len] = '\\0';\n+      group_chars[group_len] = '\\0';\n+      parent_chars[parent_len] = '\\0';\n+\n+      event.event_type = JVMPI_EVENT_THREAD_START;\n+      event.env_id = NULL;\n+      event.u.thread_start.thread_name = thread_chars;\n+      event.u.thread_start.group_name = group_chars;\n+      event.u.thread_start.parent_name = parent_chars;\n+      event.u.thread_start.thread_id = (jobjectID) this;\n+      event.u.thread_start.thread_env_id = _Jv_GetCurrentJNIEnv ();\n+\n+      _Jv_DisableGC ();\n+      (*_Jv_JVMPI_Notify_THREAD_START) (&event);\n+      _Jv_EnableGC ();\n+    }\n+#endif\n+\n   main_func *real_main = (main_func *) meth->ncode;\n   (*real_main) (args);\n }"}, {"sha": "10b74af151d2660a9a391fd822e77a254c3e740d", "filename": "libjava/include/config.h.in", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Finclude%2Fconfig.h.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Finclude%2Fconfig.h.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Finclude%2Fconfig.h.in?ref=54c2f04ba05ce07e701345bc66d038b7d47a9bed", "patch": "@@ -152,6 +152,12 @@\n /* Define if g++ has a bug preventing us from inlining math routines.  */\n #undef __NO_MATH_INLINES\n \n+/* Define if you are using JVMPI.  */\n+#undef ENABLE_JVMPI\n+\n+/* The number of bytes in a void *.  */\n+#undef SIZEOF_VOID_P\n+\n /* Define if you have the access function.  */\n #undef HAVE_ACCESS\n "}, {"sha": "19b03fbc9c65ffea4e9f377ab249eca69fa1807f", "filename": "libjava/include/jvm.h", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Finclude%2Fjvm.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Finclude%2Fjvm.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Finclude%2Fjvm.h?ref=54c2f04ba05ce07e701345bc66d038b7d47a9bed", "patch": "@@ -82,6 +82,9 @@ void _Jv_RunFinalizers (void);\n void _Jv_RunAllFinalizers (void);\n /* Perform a GC.  */\n void _Jv_RunGC (void);\n+/* Disable and enable GC.  */\n+void _Jv_DisableGC (void);\n+void _Jv_EnableGC (void);\n \n /* Return approximation of total size of heap.  */\n long _Jv_GCTotalMemory (void);\n@@ -216,4 +219,12 @@ void _Jv_SetCurrentJNIEnv (_Jv_JNIEnv *);\n struct _Jv_JavaVM;\n _Jv_JavaVM *_Jv_GetJavaVM ();\n \n+#ifdef ENABLE_JVMPI\n+#include \"jvmpi.h\"\n+\n+extern void (*_Jv_JVMPI_Notify_OBJECT_ALLOC) (JVMPI_Event *event);\n+extern void (*_Jv_JVMPI_Notify_THREAD_START) (JVMPI_Event *event);\n+extern void (*_Jv_JVMPI_Notify_THREAD_END) (JVMPI_Event *event);\n+#endif\n+\n #endif /* __JAVA_JVM_H__ */"}, {"sha": "7a5e9004c64d42ad188c7ab6c4b47581573c623f", "filename": "libjava/java/lang/natThread.cc", "status": "modified", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Fjava%2Flang%2FnatThread.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Fjava%2Flang%2FnatThread.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FnatThread.cc?ref=54c2f04ba05ce07e701345bc66d038b7d47a9bed", "patch": "@@ -27,6 +27,10 @@ details.  */\n \n #include <jni.h>\n \n+#ifdef ENABLE_JVMPI\n+#include <jvmpi.h>\n+#endif\n+\n \f\n \n // This structure is used to represent all the data the native side\n@@ -173,6 +177,21 @@ java::lang::Thread::finish_ ()\n   natThread *nt = (natThread *) data;\n   \n   group->remove (this);\n+\n+#ifdef ENABLE_JVMPI  \n+  if (_Jv_JVMPI_Notify_THREAD_END)\n+    {\n+      JVMPI_Event event;\n+\n+      event.event_type = JVMPI_EVENT_THREAD_END;\n+      event.env_id = _Jv_GetCurrentJNIEnv ();\n+\n+      _Jv_DisableGC ();\n+      (*_Jv_JVMPI_Notify_THREAD_END) (&event);\n+      _Jv_EnableGC ();\n+    }\n+#endif\n+\n   group = NULL;\n   \n   // Signal any threads that are waiting to join() us.\n@@ -188,6 +207,60 @@ java::lang::Thread::run_ (jobject obj)\n   java::lang::Thread *thread = (java::lang::Thread *) obj;\n   try\n     {\n+#ifdef ENABLE_JVMPI\n+      if (_Jv_JVMPI_Notify_THREAD_START)\n+\t{\n+\t  JVMPI_Event event;\n+\t  \n+\t  jstring thread_name = thread->getName ();\n+\t  jstring group_name = NULL, parent_name = NULL;\n+\t  java::lang::ThreadGroup *group = thread->getThreadGroup ();\n+\n+\t  if (group)\n+\t    {\n+\t      group_name = group->getName ();\n+\t      group = group->getParent ();\n+\t      \n+\t      if (group)\n+\t\tparent_name = group->getName ();\n+\t    }\n+\t  \n+\t  int thread_len = thread_name ? JvGetStringUTFLength (thread_name) : 0;\n+\t  int group_len = group_name ? JvGetStringUTFLength (group_name) : 0;\n+\t  int parent_len = parent_name ? JvGetStringUTFLength (parent_name) : 0;\n+\t  \n+\t  char thread_chars[thread_len + 1];\n+\t  char group_chars[group_len + 1];\n+\t  char parent_chars[parent_len + 1];\n+\t  \n+\t  if (thread_name)\n+\t    JvGetStringUTFRegion (thread_name, 0, \n+\t\t\t\t  thread_name->length(), thread_chars);\n+\t  if (group_name)\n+\t    JvGetStringUTFRegion (group_name, 0, \n+\t\t\t\t  group_name->length(), group_chars);\n+\t  if (parent_name)\n+\t    JvGetStringUTFRegion (parent_name, 0, \n+\t\t\t\t  parent_name->length(), parent_chars);\n+\t  \n+\t  thread_chars[thread_len] = '\\0';\n+\t  group_chars[group_len] = '\\0';\n+\t  parent_chars[parent_len] = '\\0';\n+\t  \n+\t  event.event_type = JVMPI_EVENT_THREAD_START;\n+\t  event.env_id = NULL;\n+\t  event.u.thread_start.thread_name = thread_chars;\n+\t  event.u.thread_start.group_name = group_chars;\n+\t  event.u.thread_start.parent_name = parent_chars;\n+\t  event.u.thread_start.thread_id = (jobjectID) thread;\n+\t  event.u.thread_start.thread_env_id = _Jv_GetCurrentJNIEnv ();\n+\t  \n+\t  _Jv_DisableGC ();\n+\t  (*_Jv_JVMPI_Notify_THREAD_START) (&event);\n+\t  _Jv_EnableGC ();\n+\t}\n+#endif\n+\n       thread->run ();\n     }\n   catch (java::lang::Throwable *t)"}, {"sha": "ea2f03974f3636f7df1c7867608aa35e5b6ee319", "filename": "libjava/jni.cc", "status": "modified", "additions": 66, "deletions": 0, "changes": 66, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Fjni.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Fjni.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjni.cc?ref=54c2f04ba05ce07e701345bc66d038b7d47a9bed", "patch": "@@ -20,6 +20,9 @@ details.  */\n #include <jvm.h>\n #include <java-assert.h>\n #include <jni.h>\n+#ifdef ENABLE_JVMPI\n+#include <jvmpi.h>\n+#endif\n \n #include <java/lang/Class.h>\n #include <java/lang/ClassLoader.h>\n@@ -105,12 +108,66 @@ static java::util::Hashtable *ref_table;\n // The only VM.\n static JavaVM *the_vm;\n \n+#ifdef ENABLE_JVMPI\n+// The only JVMPI interface description.\n+static JVMPI_Interface _Jv_JVMPI_Interface;\n+\n+static jint\n+jvmpiEnableEvent (jint event_type, void *)\n+{\n+  switch (event_type)\n+    {\n+    case JVMPI_EVENT_OBJECT_ALLOC:\n+      _Jv_JVMPI_Notify_OBJECT_ALLOC = _Jv_JVMPI_Interface.NotifyEvent;\n+      break;\n+      \n+    case JVMPI_EVENT_THREAD_START:\n+      _Jv_JVMPI_Notify_THREAD_START = _Jv_JVMPI_Interface.NotifyEvent;\n+      break;\n+      \n+    case JVMPI_EVENT_THREAD_END:\n+      _Jv_JVMPI_Notify_THREAD_END = _Jv_JVMPI_Interface.NotifyEvent;\n+      break;\n+      \n+    default:\n+      return JVMPI_NOT_AVAILABLE;\n+    }\n+  \n+  return JVMPI_SUCCESS;\n+}\n+\n+static jint\n+jvmpiDisableEvent (jint event_type, void *)\n+{\n+  switch (event_type)\n+    {\n+    case JVMPI_EVENT_OBJECT_ALLOC:\n+      _Jv_JVMPI_Notify_OBJECT_ALLOC = NULL;\n+      break;\n+      \n+    default:\n+      return JVMPI_NOT_AVAILABLE;\n+    }\n+  \n+  return JVMPI_SUCCESS;\n+}\n+#endif\n+\n \f\n \n void\n _Jv_JNI_Init (void)\n {\n   ref_table = new java::util::Hashtable;\n+  \n+#ifdef ENABLE_JVMPI\n+  _Jv_JVMPI_Interface.version = 1;\n+  _Jv_JVMPI_Interface.EnableEvent = &jvmpiEnableEvent;\n+  _Jv_JVMPI_Interface.DisableEvent = &jvmpiDisableEvent;\n+  _Jv_JVMPI_Interface.EnableGC = &_Jv_EnableGC;\n+  _Jv_JVMPI_Interface.DisableGC = &_Jv_DisableGC;\n+  _Jv_JVMPI_Interface.RunGC = &_Jv_RunGC;\n+#endif\n }\n \n // Tell the GC that a certain pointer is live.\n@@ -1868,6 +1925,15 @@ _Jv_JNI_GetEnv (JavaVM *, void **penv, jint version)\n       return JNI_EDETACHED;\n     }\n \n+#ifdef ENABLE_JVMPI\n+  // Handle JVMPI requests.\n+  if (version == JVMPI_VERSION_1)\n+    {\n+      *penv = (void *) &_Jv_JVMPI_Interface;\n+      return 0;\n+    }\n+#endif\n+\n   // FIXME: do we really want to support 1.1?\n   if (version != JNI_VERSION_1_2 && version != JNI_VERSION_1_1)\n     {"}, {"sha": "10d4f80ed00dc909e3fa448ca5bc8aa3dbb22031", "filename": "libjava/nogc.cc", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Fnogc.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Fnogc.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fnogc.cc?ref=54c2f04ba05ce07e701345bc66d038b7d47a9bed", "patch": "@@ -1,6 +1,6 @@\n // nogc.cc - Code to implement no GC.\n \n-/* Copyright (C) 1998, 1999  Free Software Foundation\n+/* Copyright (C) 1998, 1999, 2000  Free Software Foundation\n \n    This file is part of libgcj.\n \n@@ -85,6 +85,16 @@ _Jv_GCSetMaximumHeapSize (size_t size)\n {\n }\n \n+void\n+_Jv_DisableGC (void)\n+{\n+}\n+\n+void\n+_Jv_EnableGC (void)\n+{\n+}\n+\n void\n _Jv_InitGC (void)\n {"}, {"sha": "5b1e62d4ba31b960366accebfe4eba3578d3092d", "filename": "libjava/prims.cc", "status": "modified", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Fprims.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54c2f04ba05ce07e701345bc66d038b7d47a9bed/libjava%2Fprims.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fprims.cc?ref=54c2f04ba05ce07e701345bc66d038b7d47a9bed", "patch": "@@ -34,6 +34,10 @@ details.  */\n #include <java-signal.h>\n #include <java-threads.h>\n \n+#ifdef ENABLE_JVMPI\n+#include <jvmpi.h>\n+#endif\n+\n #ifndef DISABLE_GETENV_PROPERTIES\n #include <ctype.h>\n #include <java-props.h>\n@@ -83,6 +87,12 @@ property_pair *_Jv_Environment_Properties;\n // The name of this executable.\n static char * _Jv_execName;\n \n+#ifdef ENABLE_JVMPI\n+// Pointer to JVMPI notification functions.\n+void (*_Jv_JVMPI_Notify_OBJECT_ALLOC) (JVMPI_Event *event);\n+void (*_Jv_JVMPI_Notify_THREAD_START) (JVMPI_Event *event);\n+void (*_Jv_JVMPI_Notify_THREAD_END) (JVMPI_Event *event);\n+#endif\n \f\n \n #ifdef HANDLE_SEGV\n@@ -326,6 +336,27 @@ _Jv_AllocObject (jclass c, jint size)\n   if (c->vtable->method[1] != ObjectClass.vtable->method[1])\n     _Jv_RegisterFinalizer (obj, _Jv_FinalizeObject);\n \n+#ifdef ENABLE_JVMPI\n+  // Service JVMPI request.\n+\n+  if (_Jv_JVMPI_Notify_OBJECT_ALLOC)\n+    {\n+      JVMPI_Event event;\n+\n+      event.event_type = JVMPI_EVENT_OBJECT_ALLOC;\n+      event.env_id = NULL;\n+      event.u.obj_alloc.arena_id = 0;\n+      event.u.obj_alloc.class_id = (jobjectID) c;\n+      event.u.obj_alloc.is_array = 0;\n+      event.u.obj_alloc.size = size;\n+      event.u.obj_alloc.obj_id = (jobjectID) obj;\n+\n+      _Jv_DisableGC ();\n+      (*_Jv_JVMPI_Notify_OBJECT_ALLOC) (&event);\n+      _Jv_EnableGC ();\n+    }\n+#endif\n+\n   return obj;\n }\n "}]}