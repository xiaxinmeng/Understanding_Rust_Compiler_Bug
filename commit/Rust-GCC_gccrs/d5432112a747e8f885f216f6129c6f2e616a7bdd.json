{"sha": "d5432112a747e8f885f216f6129c6f2e616a7bdd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDU0MzIxMTJhNzQ3ZThmODg1ZjIxNmY2MTI5YzZmMmU2MTZhN2JkZA==", "commit": {"author": {"name": "Toma Tabacu", "email": "toma.tabacu@imgtec.com", "date": "2017-01-18T10:57:17Z"}, "committer": {"name": "Toma Tabacu", "email": "tomtab@gcc.gnu.org", "date": "2017-01-18T10:57:17Z"}, "message": "MIPS: Fix generation of Loongson-specific division and modulo instructions.\n\ngcc\n\n\t* config/mips/mips.h (ISA_HAS_DIV3): Remove unused macro.\n\t(ISA_AVOID_DIV_HILO): New macro.\n\t(ISA_HAS_DIV): Use new ISA_AVOID_DIV_HILO macro.\n\t(ISA_HAS_DDIV): Likewise.\n\nFrom-SVN: r244570", "tree": {"sha": "d07625f70f9465ba9e7eb3d3459c2beefeb8e5bf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d07625f70f9465ba9e7eb3d3459c2beefeb8e5bf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d5432112a747e8f885f216f6129c6f2e616a7bdd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d5432112a747e8f885f216f6129c6f2e616a7bdd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d5432112a747e8f885f216f6129c6f2e616a7bdd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d5432112a747e8f885f216f6129c6f2e616a7bdd/comments", "author": null, "committer": null, "parents": [{"sha": "01f9d481c5f6f37fcdab7212318f7a2e35591404", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/01f9d481c5f6f37fcdab7212318f7a2e35591404", "html_url": "https://github.com/Rust-GCC/gccrs/commit/01f9d481c5f6f37fcdab7212318f7a2e35591404"}], "stats": {"total": 23, "additions": 18, "deletions": 5}, "files": [{"sha": "07f01a97bab19f6367bcaab8e4f366bed8aa1206", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5432112a747e8f885f216f6129c6f2e616a7bdd/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5432112a747e8f885f216f6129c6f2e616a7bdd/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d5432112a747e8f885f216f6129c6f2e616a7bdd", "patch": "@@ -1,3 +1,10 @@\n+2017-01-18  Toma Tabacu  <toma.tabacu@imgtec.com>\n+\n+\t* config/mips/mips.h (ISA_HAS_DIV3): Remove unused macro.\n+\t(ISA_AVOID_DIV_HILO): New macro.\n+\t(ISA_HAS_DIV): Use new ISA_AVOID_DIV_HILO macro.\n+\t(ISA_HAS_DDIV): Likewise.\n+\n 2017-01-18  Markus Trippelsdorf  <markus@trippelsdorf.de>\n \n \t* doc/invoke.texi (fabi-version): Correct number of occurrences."}, {"sha": "fbd7011512e2658dc4c0cb269b87d246fbbb7d42", "filename": "gcc/config/mips/mips.h", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5432112a747e8f885f216f6129c6f2e616a7bdd/gcc%2Fconfig%2Fmips%2Fmips.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5432112a747e8f885f216f6129c6f2e616a7bdd/gcc%2Fconfig%2Fmips%2Fmips.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.h?ref=d5432112a747e8f885f216f6129c6f2e616a7bdd", "patch": "@@ -967,19 +967,25 @@ struct mips_cpu_info {\n /* ISA supports instructions DMUL, DMULU, DMUH, DMUHU.  */\n #define ISA_HAS_R6DMUL\t\t(TARGET_64BIT && mips_isa_rev >= 6)\n \n+/* For Loongson, it is preferable to use the Loongson-specific division and\n+   modulo instructions instead of the regular (D)DIV(U) instruction,\n+   because the former are faster and can also have the effect of reducing\n+   code size.  */\n+#define ISA_AVOID_DIV_HILO\t((TARGET_LOONGSON_2EF\t\t\t\\\n+\t\t\t\t  || TARGET_LOONGSON_3A)\t\t\\\n+\t\t\t\t && !TARGET_MIPS16)\n+\n /* ISA supports instructions DDIV and DDIVU. */\n #define ISA_HAS_DDIV\t\t(TARGET_64BIT\t\t\t\t\\\n \t\t\t\t && !TARGET_MIPS5900\t\t\t\\\n+\t\t\t\t && !ISA_AVOID_DIV_HILO\t\t\t\\\n \t\t\t\t && mips_isa_rev <= 5)\n \n /* ISA supports instructions DIV and DIVU.\n    This is always true, but the macro is needed for ISA_HAS_<D>DIV\n    in mips.md.  */\n-#define ISA_HAS_DIV\t\t(mips_isa_rev <= 5)\n-\n-#define ISA_HAS_DIV3\t\t((TARGET_LOONGSON_2EF\t\t\t\\\n-\t\t\t\t  || TARGET_LOONGSON_3A)\t\t\\\n-\t\t\t\t && !TARGET_MIPS16)\n+#define ISA_HAS_DIV\t\t(!ISA_AVOID_DIV_HILO\t\t\t\\\n+\t\t\t\t && mips_isa_rev <= 5)\n \n /* ISA supports instructions DIV, DIVU, MOD and MODU.  */\n #define ISA_HAS_R6DIV\t\t(mips_isa_rev >= 6)"}]}