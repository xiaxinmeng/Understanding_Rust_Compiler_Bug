{"sha": "e586831971cda2da0e25e21a81eeeea60514a89e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTU4NjgzMTk3MWNkYTJkYTBlMjVlMjFhODFlZWVlYTYwNTE0YTg5ZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-02-26T19:46:34Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-02-26T19:46:34Z"}, "message": "re PR debug/83917 (with -mcall-ms2sysv-xlogues, stepping into x86 tail-call restore stub gives bad backtrace)\n\n\tPR debug/83917\n\t* config/i386/i386-asm.h (PACKAGE_VERSION, PACKAGE_NAME,\n\tPACKAGE_STRING, PACKAGE_TARNAME, PACKAGE_URL): Undefine between\n\tinclusion of auto-target.h and auto-host.h.\n\t(USE_GAS_CFI_DIRECTIVES): Define if not defined already based on\n\t__GCC_HAVE_DWARF2_CFI_ASM.\n\t(cfi_startproc, cfi_endproc, cfi_adjust_cfa_offset,\n\tcfi_def_cfa_register, cfi_def_cfa, cfi_register, cfi_offset, cfi_push,\n\tcfi_pop): Define.\n\t* config/i386/cygwin.S: Don't include auto-host.h here, just\n\tdefine USE_GAS_CFI_DIRECTIVES to 1 or 0 and include i386-asm.h.\n\t(cfi_startproc, cfi_endproc, cfi_adjust_cfa_offset,\n\tcfi_def_cfa_register, cfi_register, cfi_push, cfi_pop): Remove.\n\t* config/i386/resms64fx.h: Add cfi_* directives.\n\t* config/i386/resms64x.h: Likewise.\n\nFrom-SVN: r258010", "tree": {"sha": "c4946ab031d9b0b044d5fbc4279f972ec92e7cfb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c4946ab031d9b0b044d5fbc4279f972ec92e7cfb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e586831971cda2da0e25e21a81eeeea60514a89e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e586831971cda2da0e25e21a81eeeea60514a89e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e586831971cda2da0e25e21a81eeeea60514a89e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e586831971cda2da0e25e21a81eeeea60514a89e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "106b15eac3345e62475f6087d53711c9e33c25d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/106b15eac3345e62475f6087d53711c9e33c25d5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/106b15eac3345e62475f6087d53711c9e33c25d5"}], "stats": {"total": 92, "additions": 70, "deletions": 22}, "files": [{"sha": "d29f2f495e076a9e09710ba5e2d203b804861a85", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e586831971cda2da0e25e21a81eeeea60514a89e/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e586831971cda2da0e25e21a81eeeea60514a89e/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=e586831971cda2da0e25e21a81eeeea60514a89e", "patch": "@@ -1,3 +1,21 @@\n+2018-02-26  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/83917\n+\t* config/i386/i386-asm.h (PACKAGE_VERSION, PACKAGE_NAME,\n+\tPACKAGE_STRING, PACKAGE_TARNAME, PACKAGE_URL): Undefine between\n+\tinclusion of auto-target.h and auto-host.h.\n+\t(USE_GAS_CFI_DIRECTIVES): Define if not defined already based on\n+\t__GCC_HAVE_DWARF2_CFI_ASM.\n+\t(cfi_startproc, cfi_endproc, cfi_adjust_cfa_offset,\n+\tcfi_def_cfa_register, cfi_def_cfa, cfi_register, cfi_offset, cfi_push,\n+\tcfi_pop): Define.\n+\t* config/i386/cygwin.S: Don't include auto-host.h here, just\n+\tdefine USE_GAS_CFI_DIRECTIVES to 1 or 0 and include i386-asm.h.\n+\t(cfi_startproc, cfi_endproc, cfi_adjust_cfa_offset,\n+\tcfi_def_cfa_register, cfi_register, cfi_push, cfi_pop): Remove.\n+\t* config/i386/resms64fx.h: Add cfi_* directives.\n+\t* config/i386/resms64x.h: Likewise.\n+\n 2018-02-20  Max Filippov  <jcmvbkbc@gmail.com>\n \n \t* config/xtensa/ieee754-df.S (__adddf3_aux): Add"}, {"sha": "f856be3e88a4665caa543aaaeb2b23ff429c1925", "filename": "libgcc/config/i386/cygwin.S", "status": "modified", "additions": 4, "deletions": 22, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e586831971cda2da0e25e21a81eeeea60514a89e/libgcc%2Fconfig%2Fi386%2Fcygwin.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e586831971cda2da0e25e21a81eeeea60514a89e/libgcc%2Fconfig%2Fi386%2Fcygwin.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fi386%2Fcygwin.S?ref=e586831971cda2da0e25e21a81eeeea60514a89e", "patch": "@@ -23,31 +23,13 @@\n  * <http://www.gnu.org/licenses/>.\n  */\n \n-#include \"auto-host.h\"\n-\n #ifdef HAVE_GAS_CFI_SECTIONS_DIRECTIVE\n+# define USE_GAS_CFI_DIRECTIVES 1\n \t.cfi_sections\t.debug_frame\n-# define cfi_startproc()\t\t.cfi_startproc\n-# define cfi_endproc()\t\t\t.cfi_endproc\n-# define cfi_adjust_cfa_offset(X) \t.cfi_adjust_cfa_offset X\n-# define cfi_def_cfa_register(X)\t.cfi_def_cfa_register X\n-# define cfi_register(D,S)\t\t.cfi_register D, S\n-# ifdef __x86_64__\n-#  define cfi_push(X)\t\t.cfi_adjust_cfa_offset 8; .cfi_rel_offset X, 0\n-#  define cfi_pop(X)\t\t.cfi_adjust_cfa_offset -8; .cfi_restore X\n-# else\n-#  define cfi_push(X)\t\t.cfi_adjust_cfa_offset 4; .cfi_rel_offset X, 0\n-#  define cfi_pop(X)\t\t.cfi_adjust_cfa_offset -4; .cfi_restore X\n-# endif\n #else\n-# define cfi_startproc()\n-# define cfi_endproc()\n-# define cfi_adjust_cfa_offset(X)\n-# define cfi_def_cfa_register(X)\n-# define cfi_register(D,S)\n-# define cfi_push(X)\n-# define cfi_pop(X)\n-#endif /* HAVE_GAS_CFI_SECTIONS_DIRECTIVE */\n+# define USE_GAS_CFI_DIRECTIVES 0\n+#endif\n+#include \"i386-asm.h\"\n \n #ifdef L_chkstk\n /* Function prologue calls __chkstk to probe the stack when allocating more"}, {"sha": "dbf99564b0c00c3397afba6387ba6b5ea6ce1313", "filename": "libgcc/config/i386/i386-asm.h", "status": "modified", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e586831971cda2da0e25e21a81eeeea60514a89e/libgcc%2Fconfig%2Fi386%2Fi386-asm.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e586831971cda2da0e25e21a81eeeea60514a89e/libgcc%2Fconfig%2Fi386%2Fi386-asm.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fi386%2Fi386-asm.h?ref=e586831971cda2da0e25e21a81eeeea60514a89e", "patch": "@@ -27,8 +27,47 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n #define I386_ASM_H\n \n #include \"auto-target.h\"\n+#undef PACKAGE_VERSION\n+#undef PACKAGE_NAME\n+#undef PACKAGE_STRING\n+#undef PACKAGE_TARNAME\n+#undef PACKAGE_URL\n #include \"auto-host.h\"\n \n+#ifndef USE_GAS_CFI_DIRECTIVES\n+# ifdef __GCC_HAVE_DWARF2_CFI_ASM\n+#  define USE_GAS_CFI_DIRECTIVES 1\n+# else\n+#  define USE_GAS_CFI_DIRECTIVES 0\n+# endif\n+#endif\n+#if USE_GAS_CFI_DIRECTIVES\n+# define cfi_startproc()\t\t.cfi_startproc\n+# define cfi_endproc()\t\t\t.cfi_endproc\n+# define cfi_adjust_cfa_offset(X) \t.cfi_adjust_cfa_offset X\n+# define cfi_def_cfa_register(X)\t.cfi_def_cfa_register X\n+# define cfi_def_cfa(R,O)\t\t.cfi_def_cfa R, O\n+# define cfi_register(D,S)\t\t.cfi_register D, S\n+# define cfi_offset(R,O)\t\t.cfi_offset R, O\n+# ifdef __x86_64__\n+#  define cfi_push(X)\t\t.cfi_adjust_cfa_offset 8; .cfi_rel_offset X, 0\n+#  define cfi_pop(X)\t\t.cfi_adjust_cfa_offset -8; .cfi_restore X\n+# else\n+#  define cfi_push(X)\t\t.cfi_adjust_cfa_offset 4; .cfi_rel_offset X, 0\n+#  define cfi_pop(X)\t\t.cfi_adjust_cfa_offset -4; .cfi_restore X\n+# endif\n+#else\n+# define cfi_startproc()\n+# define cfi_endproc()\n+# define cfi_adjust_cfa_offset(X)\n+# define cfi_def_cfa_register(X)\n+# define cfi_def_cfa(R,O)\n+# define cfi_register(D,S)\n+# define cfi_offset(R,O)\n+# define cfi_push(X)\n+# define cfi_pop(X)\n+#endif\n+\n #define PASTE2(a, b) PASTE2a(a, b)\n #define PASTE2a(a, b) a ## b\n "}, {"sha": "88d36f39ac82dd4019aa041b7f7a9f00755488d4", "filename": "libgcc/config/i386/resms64fx.h", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e586831971cda2da0e25e21a81eeeea60514a89e/libgcc%2Fconfig%2Fi386%2Fresms64fx.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e586831971cda2da0e25e21a81eeeea60514a89e/libgcc%2Fconfig%2Fi386%2Fresms64fx.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fi386%2Fresms64fx.h?ref=e586831971cda2da0e25e21a81eeeea60514a89e", "patch": "@@ -33,6 +33,9 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n  * from the function.  */\n \n \t.text\n+\tcfi_startproc()\n+\tcfi_offset(%rbp, -16)\n+\tcfi_def_cfa(%rbp, 16)\n MS2SYSV_STUB_BEGIN(resms64fx_17)\n \tmov\t-0x68(%rsi),%r15\n MS2SYSV_STUB_BEGIN(resms64fx_16)\n@@ -48,7 +51,9 @@ MS2SYSV_STUB_BEGIN(resms64fx_12)\n \tSSE_RESTORE\n \tmov\t-0x38(%rsi),%rsi\n \tleaveq\n+\tcfi_def_cfa(%rsp, 8)\n \tret\n+\tcfi_endproc()\n MS2SYSV_STUB_END(resms64fx_12)\n MS2SYSV_STUB_END(resms64fx_13)\n MS2SYSV_STUB_END(resms64fx_14)"}, {"sha": "cf6830f3fd78ff5c1f0f4fb80f65cf85f056a8c4", "filename": "libgcc/config/i386/resms64x.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e586831971cda2da0e25e21a81eeeea60514a89e/libgcc%2Fconfig%2Fi386%2Fresms64x.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e586831971cda2da0e25e21a81eeeea60514a89e/libgcc%2Fconfig%2Fi386%2Fresms64x.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fi386%2Fresms64x.h?ref=e586831971cda2da0e25e21a81eeeea60514a89e", "patch": "@@ -32,6 +32,8 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n  * function.  */\n \n \t.text\n+\tcfi_startproc()\n+\tcfi_def_cfa(%r10, 8)\n MS2SYSV_STUB_BEGIN(resms64x_18)\n \tmov\t-0x70(%rsi),%r15\n MS2SYSV_STUB_BEGIN(resms64x_17)\n@@ -49,7 +51,9 @@ MS2SYSV_STUB_BEGIN(resms64x_12)\n \tSSE_RESTORE\n \tmov\t-0x38(%rsi),%rsi\n \tmov\t%r10,%rsp\n+\tcfi_def_cfa_register(%rsp)\n \tret\n+\tcfi_endproc()\n MS2SYSV_STUB_END(resms64x_12)\n MS2SYSV_STUB_END(resms64x_13)\n MS2SYSV_STUB_END(resms64x_14)"}]}