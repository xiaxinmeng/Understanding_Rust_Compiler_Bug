{"sha": "6cf598659e764d8955a1a90c32d2519ab689cea0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmNmNTk4NjU5ZTc2NGQ4OTU1YTFhOTBjMzJkMjUxOWFiNjg5Y2VhMA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2008-06-13T09:38:31Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2008-06-13T09:38:31Z"}, "message": "re PR c/36507 (ISO C99 inline semantics doesn't play together with nested functions)\n\n\tPR c/36507\n\t* c-decl.c (merge_decls): Don't clear DECL_EXTERNAL for\n\tnested inline functions.\n\t(start_decl, start_function): Don't invert DECL_EXTERNAL\n\tfor nested inline functions.\n\n\t* gcc.dg/inline-28.c: New test.\n\t* gcc.dg/inline-29.c: New test.\n\t* gcc.dg/inline-30.c: New test.\n\nFrom-SVN: r136745", "tree": {"sha": "5af24d70e0a73823535ae8c8ff4e6923ffecee6a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5af24d70e0a73823535ae8c8ff4e6923ffecee6a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6cf598659e764d8955a1a90c32d2519ab689cea0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6cf598659e764d8955a1a90c32d2519ab689cea0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6cf598659e764d8955a1a90c32d2519ab689cea0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6cf598659e764d8955a1a90c32d2519ab689cea0/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6a4533e55451309198c5d36558a4b875b5555c88", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6a4533e55451309198c5d36558a4b875b5555c88", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6a4533e55451309198c5d36558a4b875b5555c88"}], "stats": {"total": 109, "additions": 106, "deletions": 3}, "files": [{"sha": "37ff36aaa9ed901140915bdc21e055abb8db740d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cf598659e764d8955a1a90c32d2519ab689cea0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cf598659e764d8955a1a90c32d2519ab689cea0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6cf598659e764d8955a1a90c32d2519ab689cea0", "patch": "@@ -1,3 +1,11 @@\n+2008-06-13  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/36507\n+\t* c-decl.c (merge_decls): Don't clear DECL_EXTERNAL for\n+\tnested inline functions.\n+\t(start_decl, start_function): Don't invert DECL_EXTERNAL\n+\tfor nested inline functions.\n+\n 2008-06-13  Richard Sandiford  <rdsandiford@googlemail.com>\n \n \t* config/mips/mips.md: Remove TARGET_DEBUG_D_MODE conditions from"}, {"sha": "89fdf3d1b45cdaf342a161021db9132677af6e51", "filename": "gcc/c-decl.c", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cf598659e764d8955a1a90c32d2519ab689cea0/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cf598659e764d8955a1a90c32d2519ab689cea0/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=6cf598659e764d8955a1a90c32d2519ab689cea0", "patch": "@@ -1763,7 +1763,9 @@ merge_decls (tree newdecl, tree olddecl, tree newtype, tree oldtype)\n \t  || !DECL_DECLARED_INLINE_P (olddecl)\n \t  || !DECL_EXTERNAL (olddecl))\n       && DECL_EXTERNAL (newdecl)\n-      && !lookup_attribute (\"gnu_inline\", DECL_ATTRIBUTES (newdecl)))\n+      && !lookup_attribute (\"gnu_inline\", DECL_ATTRIBUTES (newdecl))\n+      && (DECL_CONTEXT (newdecl) == NULL_TREE\n+\t  || TREE_CODE (DECL_CONTEXT (newdecl)) != FUNCTION_DECL))\n     DECL_EXTERNAL (newdecl) = 0;\n \n   if (DECL_EXTERNAL (newdecl))\n@@ -3264,7 +3266,8 @@ start_decl (struct c_declarator *declarator, struct c_declspecs *declspecs,\n   if (declspecs->inline_p\n       && !flag_gnu89_inline\n       && TREE_CODE (decl) == FUNCTION_DECL\n-      && lookup_attribute (\"gnu_inline\", DECL_ATTRIBUTES (decl)))\n+      && (lookup_attribute (\"gnu_inline\", DECL_ATTRIBUTES (decl))\n+\t  || current_function_decl))\n     {\n       if (declspecs->storage_class == csc_auto && current_scope != file_scope)\n \t;\n@@ -6094,7 +6097,8 @@ start_function (struct c_declspecs *declspecs, struct c_declarator *declarator,\n   if (declspecs->inline_p\n       && !flag_gnu89_inline\n       && TREE_CODE (decl1) == FUNCTION_DECL\n-      && lookup_attribute (\"gnu_inline\", DECL_ATTRIBUTES (decl1)))\n+      && (lookup_attribute (\"gnu_inline\", DECL_ATTRIBUTES (decl1))\n+\t  || current_function_decl))\n     {\n       if (declspecs->storage_class != csc_static)\n \tDECL_EXTERNAL (decl1) = !DECL_EXTERNAL (decl1);"}, {"sha": "c9e1e422496c4dafc80096afcaf595a4471ad77e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cf598659e764d8955a1a90c32d2519ab689cea0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cf598659e764d8955a1a90c32d2519ab689cea0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6cf598659e764d8955a1a90c32d2519ab689cea0", "patch": "@@ -1,3 +1,10 @@\n+2008-06-13  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/36507\n+\t* gcc.dg/inline-28.c: New test.\n+\t* gcc.dg/inline-29.c: New test.\n+\t* gcc.dg/inline-30.c: New test.\n+\n 2008-06-12  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/36462"}, {"sha": "20916aef992b7d5644fd26f425a4849d4d878196", "filename": "gcc/testsuite/gcc.dg/inline-28.c", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cf598659e764d8955a1a90c32d2519ab689cea0/gcc%2Ftestsuite%2Fgcc.dg%2Finline-28.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cf598659e764d8955a1a90c32d2519ab689cea0/gcc%2Ftestsuite%2Fgcc.dg%2Finline-28.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Finline-28.c?ref=6cf598659e764d8955a1a90c32d2519ab689cea0", "patch": "@@ -0,0 +1,28 @@\n+/* PR c/36507 */\n+/* { dg-do run } */\n+/* { dg-options \"-O0 -std=gnu89\" } */\n+\n+int\n+main (void)\n+{\n+  int i = 2;\n+  auto inline int f1 (void)\n+  {\n+    return i;\n+  }\n+  inline int f2 (void)\n+  {\n+    return i;\n+  }\n+  auto inline int f3 (void);\n+  auto inline int f3 (void)\n+  {\n+    return i;\n+  }\n+  auto inline int f4 (void);\n+  inline int f4 (void)\n+  {\n+    return i;\n+  }\n+  return f1 () + f2 () + f3 () + f4 () - 8;\n+}"}, {"sha": "77672f34295ad3ee8faa01a75554ed3339cd8690", "filename": "gcc/testsuite/gcc.dg/inline-29.c", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cf598659e764d8955a1a90c32d2519ab689cea0/gcc%2Ftestsuite%2Fgcc.dg%2Finline-29.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cf598659e764d8955a1a90c32d2519ab689cea0/gcc%2Ftestsuite%2Fgcc.dg%2Finline-29.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Finline-29.c?ref=6cf598659e764d8955a1a90c32d2519ab689cea0", "patch": "@@ -0,0 +1,28 @@\n+/* PR c/36507 */\n+/* { dg-do run } */\n+/* { dg-options \"-O0 -std=gnu99\" } */\n+\n+int\n+main (void)\n+{\n+  int i = 2;\n+  auto inline int f1 (void)\n+  {\n+    return i;\n+  }\n+  inline int f2 (void)\n+  {\n+    return i;\n+  }\n+  auto inline int f3 (void);\n+  auto inline int f3 (void)\n+  {\n+    return i;\n+  }\n+  auto inline int f4 (void);\n+  inline int f4 (void)\n+  {\n+    return i;\n+  }\n+  return f1 () + f2 () + f3 () + f4 () - 8;\n+}"}, {"sha": "bb9b2b4776b7af3720232a3dd311a1b199ad6c52", "filename": "gcc/testsuite/gcc.dg/inline-30.c", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cf598659e764d8955a1a90c32d2519ab689cea0/gcc%2Ftestsuite%2Fgcc.dg%2Finline-30.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cf598659e764d8955a1a90c32d2519ab689cea0/gcc%2Ftestsuite%2Fgcc.dg%2Finline-30.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Finline-30.c?ref=6cf598659e764d8955a1a90c32d2519ab689cea0", "patch": "@@ -0,0 +1,28 @@\n+/* PR c/36507 */\n+/* { dg-do run } */\n+/* { dg-options \"-O0 -std=gnu99 -fgnu89-inline\" } */\n+\n+int\n+main (void)\n+{\n+  int i = 2;\n+  auto inline int f1 (void)\n+  {\n+    return i;\n+  }\n+  inline int f2 (void)\n+  {\n+    return i;\n+  }\n+  auto inline int f3 (void);\n+  auto inline int f3 (void)\n+  {\n+    return i;\n+  }\n+  auto inline int f4 (void);\n+  inline int f4 (void)\n+  {\n+    return i;\n+  }\n+  return f1 () + f2 () + f3 () + f4 () - 8;\n+}"}]}