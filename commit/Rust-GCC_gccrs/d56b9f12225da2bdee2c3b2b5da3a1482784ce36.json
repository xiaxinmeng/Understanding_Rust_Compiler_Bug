{"sha": "d56b9f12225da2bdee2c3b2b5da3a1482784ce36", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDU2YjlmMTIyMjVkYTJiZGVlMmMzYjJiNWRhM2ExNDgyNzg0Y2UzNg==", "commit": {"author": {"name": "Sandra Loosemore", "email": "sandra@codesourcery.com", "date": "2007-07-16T18:12:01Z"}, "committer": {"name": "Sandra Loosemore", "email": "sandra@gcc.gnu.org", "date": "2007-07-16T18:12:01Z"}, "message": "mips.h (TUNE_24K): Define.\n\n2007-07-16  Sandra Loosemore  <sandra@codesourcery.com>\n\t    David Ung  <davidu@mips.com>\n\n        gcc/\n\n        * config/mips/mips.h (TUNE_24K): Define.\n\t(TUNE_MACC_CHAINS): Add TUNE_24K.\n        * config/mips/mips.md: (*mul_acc_si, *mul_sub_si): Change type to\n        imadd.\n        * config/mips/74k.md (r74k_int_mult): Split madd/msub to ..\n        (r74k_int_madd): .. this new reservation.\n        (define_bypass): Fixed bypasses for r74k_int_madd to use\n\tmips_linked_madd_p.\n        * config/mips/24k.md (define_bypass): Define new\n        r24k_int_mul3->r24k_int_madd bypass using mips_linked_madd_p.\n\n\tgcc/testsuite/\n\n        * gcc.target/mips/mips-sched-madd.c: New test case.\n\nCo-Authored-By: David Ung <davidu@mips.com>\n\nFrom-SVN: r126688", "tree": {"sha": "cf3417c7321ebd6b0afef62d1f1999bb37cb5aff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cf3417c7321ebd6b0afef62d1f1999bb37cb5aff"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d56b9f12225da2bdee2c3b2b5da3a1482784ce36", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d56b9f12225da2bdee2c3b2b5da3a1482784ce36", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d56b9f12225da2bdee2c3b2b5da3a1482784ce36", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d56b9f12225da2bdee2c3b2b5da3a1482784ce36/comments", "author": {"login": "SandraLoosemore", "id": 104087111, "node_id": "U_kgDOBjQ-Rw", "avatar_url": "https://avatars.githubusercontent.com/u/104087111?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SandraLoosemore", "html_url": "https://github.com/SandraLoosemore", "followers_url": "https://api.github.com/users/SandraLoosemore/followers", "following_url": "https://api.github.com/users/SandraLoosemore/following{/other_user}", "gists_url": "https://api.github.com/users/SandraLoosemore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SandraLoosemore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SandraLoosemore/subscriptions", "organizations_url": "https://api.github.com/users/SandraLoosemore/orgs", "repos_url": "https://api.github.com/users/SandraLoosemore/repos", "events_url": "https://api.github.com/users/SandraLoosemore/events{/privacy}", "received_events_url": "https://api.github.com/users/SandraLoosemore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0015c873f4b96d1c12632dd509da8472c8001a23", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0015c873f4b96d1c12632dd509da8472c8001a23", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0015c873f4b96d1c12632dd509da8472c8001a23"}], "stats": {"total": 71, "additions": 63, "deletions": 8}, "files": [{"sha": "2d99d1f180bc5f0650e125487f33075a301b1662", "filename": "gcc/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d56b9f12225da2bdee2c3b2b5da3a1482784ce36/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d56b9f12225da2bdee2c3b2b5da3a1482784ce36/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d56b9f12225da2bdee2c3b2b5da3a1482784ce36", "patch": "@@ -1,3 +1,17 @@\n+2007-07-16  Sandra Loosemore  <sandra@codesourcery.com>\n+\t    David Ung  <davidu@mips.com>\n+\n+        * config/mips/mips.h (TUNE_24K): Define.\n+\t(TUNE_MACC_CHAINS): Add TUNE_24K.\n+        * config/mips/mips.md: (*mul_acc_si, *mul_sub_si): Change type to\n+        imadd.\n+        * config/mips/74k.md (r74k_int_mult): Split madd/msub to ..\n+        (r74k_int_madd): .. this new reservation.\n+        (define_bypass): Fixed bypasses for r74k_int_madd to use\n+\tmips_linked_madd_p.\n+        * config/mips/24k.md (define_bypass): Define new\n+        r24k_int_mul3->r24k_int_madd bypass using mips_linked_madd_p.\n+\n 2007-07-16  Sandra Loosemore  <sandra@codesourcery.com>\n \t    Nigel Stephens  <nigel@mips.com>\n "}, {"sha": "10fd79cb2db2f21404f055edd3aa70eac583c8e7", "filename": "gcc/config/mips/24k.md", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d56b9f12225da2bdee2c3b2b5da3a1482784ce36/gcc%2Fconfig%2Fmips%2F24k.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d56b9f12225da2bdee2c3b2b5da3a1482784ce36/gcc%2Fconfig%2Fmips%2F24k.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2F24k.md?ref=d56b9f12225da2bdee2c3b2b5da3a1482784ce36", "patch": "@@ -188,6 +188,9 @@\n (define_bypass 6 \"r24k_int_mul3\" \"r24k_int_store\" \"!store_data_bypass_p\")\n (define_bypass 6 \"r24k_int_mul3\" \"r24k_int_prefetch\")\n \n+;; mul3->madd/msub : 1 cycle\n+(define_bypass 1 \"r24k_int_mul3\" \"r24k_int_madd\" \"mips_linked_madd_p\")\n+\n ;; mfhilo->next use  : 5 cycles (default)\n ;; mfhilo->l/s base  : 6 cycles\n ;; mfhilo->prefetch  : 6 cycles"}, {"sha": "23597cad69ccf92bf651412c1650960e7512f413", "filename": "gcc/config/mips/74k.md", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d56b9f12225da2bdee2c3b2b5da3a1482784ce36/gcc%2Fconfig%2Fmips%2F74k.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d56b9f12225da2bdee2c3b2b5da3a1482784ce36/gcc%2Fconfig%2Fmips%2F74k.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2F74k.md?ref=d56b9f12225da2bdee2c3b2b5da3a1482784ce36", "patch": "@@ -60,10 +60,16 @@\n   \"r74k_agen*2\")\n \n ;; MDU: fully pipelined multiplier\n-;; mult, madd, msub - delivers result to hi/lo in 4 cycle (pipelined)\n+;; mult - delivers result to hi/lo in 4 cycle (pipelined)\n (define_insn_reservation \"r74k_int_mult\" 4\n   (and (eq_attr \"cpu\" \"74kc,74kf2_1,74kf1_1,74kf3_2\")\n-       (eq_attr \"type\" \"imul,imadd\"))\n+       (eq_attr \"type\" \"imul\"))\n+  \"r74k_alu+r74k_mul\")\n+\n+;; madd, msub - delivers result to hi/lo in 4 cycle (pipelined)\n+(define_insn_reservation \"r74k_int_madd\" 4\n+  (and (eq_attr \"cpu\" \"74kc,74kf2_1,74kf1_1,74kf3_2\")\n+       (eq_attr \"type\" \"imadd\"))\n   \"r74k_alu+r74k_mul\")\n \n ;; mul - delivers result to general register in 7 cycles\n@@ -160,9 +166,13 @@\n (define_bypass 5 \"r74k_int_cmove\"  \"r74k_int_load\")\n (define_bypass 5 \"r74k_int_cmove\"  \"r74k_int_store\" \"!store_data_bypass_p\")\n \n-;; mult/madd->int_mfhilo  : 4 cycles (default)\n-;; mult/madd->mult/madd   : 1 cycles\n-(define_bypass 1 \"r74k_int_mult\" \"r74k_int_mult\")\n+;; mult/madd/msub->int_mfhilo  : 4 cycles (default)\n+;; mult->madd/msub             : 1 cycles\n+;; madd/msub->madd/msub        : 1 cycles\n+(define_bypass 1 \"r74k_int_mult,r74k_int_mul3\" \"r74k_int_madd\"\n+  \"mips_linked_madd_p\")\n+(define_bypass 1 \"r74k_int_madd\" \"r74k_int_madd\"\n+  \"mips_linked_madd_p\")\n \n ;; --------------------------------------------------------------\n ;; Floating Point Instructions"}, {"sha": "3696ce7fe988a46e47c979b312715aea290fd4f8", "filename": "gcc/config/mips/mips.h", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d56b9f12225da2bdee2c3b2b5da3a1482784ce36/gcc%2Fconfig%2Fmips%2Fmips.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d56b9f12225da2bdee2c3b2b5da3a1482784ce36/gcc%2Fconfig%2Fmips%2Fmips.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.h?ref=d56b9f12225da2bdee2c3b2b5da3a1482784ce36", "patch": "@@ -250,6 +250,9 @@ extern const struct mips_rtx_cost_data *mips_cost;\n #define TUNE_MIPS9000               (mips_tune == PROCESSOR_R9000)\n #define TUNE_SB1                    (mips_tune == PROCESSOR_SB1\t\t\\\n \t\t\t\t     || mips_tune == PROCESSOR_SB1A)\n+#define TUNE_24K\t\t    (mips_tune == PROCESSOR_24KC\t\\\n+\t\t\t\t     || mips_tune == PROCESSOR_24KF2_1\t\\\n+\t\t\t\t     || mips_tune == PROCESSOR_24KF1_1)\n #define TUNE_74K                    (mips_tune == PROCESSOR_74KC\t\\\n \t\t\t\t     || mips_tune == PROCESSOR_74KF2_1\t\\\n \t\t\t\t     || mips_tune == PROCESSOR_74KF1_1  \\\n@@ -289,7 +292,8 @@ extern const struct mips_rtx_cost_data *mips_cost;\n    than others, so this macro is defined on an opt-in basis.  */\n #define TUNE_MACC_CHAINS\t    (TUNE_MIPS5500\t\t\\\n \t\t\t\t     || TUNE_MIPS4120\t\t\\\n-\t\t\t\t     || TUNE_MIPS4130)\n+\t\t\t\t     || TUNE_MIPS4130\t\t\\\n+\t\t\t\t     || TUNE_24K)\n \n #define TARGET_OLDABI\t\t    (mips_abi == ABI_32 || mips_abi == ABI_O64)\n #define TARGET_NEWABI\t\t    (mips_abi == ABI_N32 || mips_abi == ABI_64)"}, {"sha": "84347d7237c892fedf06e980d9db3d98474420bd", "filename": "gcc/config/mips/mips.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d56b9f12225da2bdee2c3b2b5da3a1482784ce36/gcc%2Fconfig%2Fmips%2Fmips.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d56b9f12225da2bdee2c3b2b5da3a1482784ce36/gcc%2Fconfig%2Fmips%2Fmips.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.md?ref=d56b9f12225da2bdee2c3b2b5da3a1482784ce36", "patch": "@@ -1228,7 +1228,7 @@\n     return \"#\";\n   return madd[which_alternative];\n }\n-  [(set_attr \"type\"\t\"imadd,imadd,multi\")\n+  [(set_attr \"type\"\t\"imadd\")\n    (set_attr \"mode\"\t\"SI\")\n    (set_attr \"length\"\t\"4,4,8\")])\n \n@@ -1483,7 +1483,7 @@\n    msub\\t%2,%3\n    #\n    #\"\n-  [(set_attr \"type\"     \"imadd,multi,multi\")\n+  [(set_attr \"type\"     \"imadd\")\n    (set_attr \"mode\"     \"SI\")\n    (set_attr \"length\"   \"4,8,8\")])\n "}, {"sha": "70a92963d94f9defaebbced85613c8efaadf810b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d56b9f12225da2bdee2c3b2b5da3a1482784ce36/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d56b9f12225da2bdee2c3b2b5da3a1482784ce36/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d56b9f12225da2bdee2c3b2b5da3a1482784ce36", "patch": "@@ -1,3 +1,8 @@\n+2007-07-16  Sandra Loosemore  <sandra@codesourcery.com>\n+\t    David Ung  <davidu@mips.com>\n+\n+        * gcc.target/mips/mips-sched-madd.c: New test case.\n+\n 2007-07-15  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR libfortran/32611"}, {"sha": "40e1fc28a6128dfc4181181ca1f9c308c65a6646", "filename": "gcc/testsuite/gcc.target/mips/mips-sched-madd.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d56b9f12225da2bdee2c3b2b5da3a1482784ce36/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-sched-madd.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d56b9f12225da2bdee2c3b2b5da3a1482784ce36/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-sched-madd.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips-sched-madd.c?ref=d56b9f12225da2bdee2c3b2b5da3a1482784ce36", "patch": "@@ -0,0 +1,19 @@\n+/* Test for case where another independent multiply insn may interfere\n+   with a macc chain.  */\n+/* { dg-do compile } */\n+/* { dg-mips-options \"-Os -march=24kf -mno-mips16\" } */\n+\n+int foo (int a, int b, int c, int d, int e, int f, int g)\n+{\n+  int temp;\n+  int acc;\n+\n+  acc = a * b;\n+  temp = a * c;\n+  acc = d * e + acc;\n+  acc = f * g + acc;\n+  return acc > temp ? acc : temp;\n+}\n+\n+/* { dg-final { scan-assembler \"\\tmult\\t\" } } */\n+/* { dg-final { scan-assembler \"\\tmadd\\t\" } } */"}]}