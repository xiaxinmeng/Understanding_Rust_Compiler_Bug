{"sha": "577d05fc914338cd7ddc254f3bee4532331f5c13", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTc3ZDA1ZmM5MTQzMzhjZDdkZGMyNTRmM2JlZTQ1MzIzMzFmNWMxMw==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-03-09T08:29:29Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-04-26T08:10:06Z"}, "message": "tree-optimization/99473 - more cselim\n\nThis fixes the pre-condition on cselim to include all references\nand decls when they end up as auto-var.\n\nBootstrapped/tested on x86_64-linux\n\n2021-03-09  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/99473\n\t* tree-ssa-phiopt.c (cond_store_replacement): Handle all\n\tstores.\n\n\t* gcc.dg/tree-ssa/pr99473-1.c: New testcase.", "tree": {"sha": "7071eb36cedbf04600f64367a1a73c9485f03ce7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7071eb36cedbf04600f64367a1a73c9485f03ce7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/577d05fc914338cd7ddc254f3bee4532331f5c13", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/577d05fc914338cd7ddc254f3bee4532331f5c13", "html_url": "https://github.com/Rust-GCC/gccrs/commit/577d05fc914338cd7ddc254f3bee4532331f5c13", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/577d05fc914338cd7ddc254f3bee4532331f5c13/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "52a5515ed6619739eb122f05ce26057dd8b06fb6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52a5515ed6619739eb122f05ce26057dd8b06fb6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/52a5515ed6619739eb122f05ce26057dd8b06fb6"}], "stats": {"total": 19, "additions": 16, "deletions": 3}, "files": [{"sha": "a9fd5427694208d5f44097a00b35b3bbf0f8b6fe", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr99473-1.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/577d05fc914338cd7ddc254f3bee4532331f5c13/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr99473-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/577d05fc914338cd7ddc254f3bee4532331f5c13/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr99473-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr99473-1.c?ref=577d05fc914338cd7ddc254f3bee4532331f5c13", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fallow-store-data-races -fdump-tree-cselim-details\" } */\n+\n+void f (int*);\n+\n+void g3 (int i)\n+{\n+  int x = 0;\n+  if (i)\n+    x = i;\n+  f (&x);\n+}\n+\n+/* { dg-final { scan-tree-dump \"Conditional store replacement happened\" \"cselim\" } } */"}, {"sha": "13e5c4971d2c857051cc26d184e745396b9d792b", "filename": "gcc/tree-ssa-phiopt.c", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/577d05fc914338cd7ddc254f3bee4532331f5c13/gcc%2Ftree-ssa-phiopt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/577d05fc914338cd7ddc254f3bee4532331f5c13/gcc%2Ftree-ssa-phiopt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-phiopt.c?ref=577d05fc914338cd7ddc254f3bee4532331f5c13", "patch": "@@ -2490,9 +2490,8 @@ cond_store_replacement (basic_block middle_bb, basic_block join_bb,\n   locus = gimple_location (assign);\n   lhs = gimple_assign_lhs (assign);\n   rhs = gimple_assign_rhs1 (assign);\n-  if ((TREE_CODE (lhs) != MEM_REF\n-       && TREE_CODE (lhs) != ARRAY_REF\n-       && TREE_CODE (lhs) != COMPONENT_REF)\n+  if ((!REFERENCE_CLASS_P (lhs)\n+       && !DECL_P (lhs))\n       || !is_gimple_reg_type (TREE_TYPE (lhs)))\n     return false;\n "}]}