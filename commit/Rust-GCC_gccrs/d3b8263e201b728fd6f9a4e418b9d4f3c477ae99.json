{"sha": "d3b8263e201b728fd6f9a4e418b9d4f3c477ae99", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDNiODI2M2UyMDFiNzI4ZmQ2ZjlhNGU0MThiOWQ0ZjNjNDc3YWU5OQ==", "commit": {"author": {"name": "Fran\u00e7ois Dumont", "email": "francois.cppdevs@free.fr", "date": "2010-11-27T13:09:47Z"}, "committer": {"name": "Fran\u00e7ois Dumont", "email": "fdumont@gcc.gnu.org", "date": "2010-11-27T13:09:47Z"}, "message": "unordered_map (unordered_multimap<>::erase): Fix to erase all elements associated to the key.\n\n2010-11-27  Fran\u00e7ois Dumont  <francois.cppdevs@free.fr>\n\n        * include/debug/unordered_map (unordered_multimap<>::erase): Fix to\n        erase all elements associated to the key.\n        * include/debug/unordered_set (unordered_multiset<>::erase): Likewise.\n        * testsuite/23_containers/unordered_multimap/erase/1.cc: Modify to\n        check for multiple erase.\n        * testsuite/23_containers/unordered_multiset/erase/1.cc: Likewise.\n\nFrom-SVN: r167199", "tree": {"sha": "b1e668914d0cfcfaf6fb2e80a84f58feb16664ad", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b1e668914d0cfcfaf6fb2e80a84f58feb16664ad"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d3b8263e201b728fd6f9a4e418b9d4f3c477ae99", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d3b8263e201b728fd6f9a4e418b9d4f3c477ae99", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d3b8263e201b728fd6f9a4e418b9d4f3c477ae99", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d3b8263e201b728fd6f9a4e418b9d4f3c477ae99/comments", "author": null, "committer": null, "parents": [{"sha": "d66411ba660260db97daea07900c88fcd4b2f432", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d66411ba660260db97daea07900c88fcd4b2f432", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d66411ba660260db97daea07900c88fcd4b2f432"}], "stats": {"total": 57, "additions": 35, "deletions": 22}, "files": [{"sha": "54e31c2a15c2c62420abcbeecec9989081e40ccf", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3b8263e201b728fd6f9a4e418b9d4f3c477ae99/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3b8263e201b728fd6f9a4e418b9d4f3c477ae99/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=d3b8263e201b728fd6f9a4e418b9d4f3c477ae99", "patch": "@@ -1,3 +1,12 @@\n+2010-11-27  Fran\u00e7ois Dumont  <francois.cppdevs@free.fr>\n+\n+\t* include/debug/unordered_map (unordered_multimap<>::erase): Fix to\n+\terase all elements associated to the key.\n+\t* include/debug/unordered_set (unordered_multiset<>::erase): Likewise.\n+\t* testsuite/23_containers/unordered_multimap/erase/1.cc: Modify to\n+\tcheck for multiple erase.\n+\t* testsuite/23_containers/unordered_multiset/erase/1.cc: Likewise.\n+\n 2010-11-27  Fran\u00e7ois Dumont  <francois.cppdevs@free.fr>\n \n \t* include/debug/unordered_map, unordered_set (unordered_map<>::insert,"}, {"sha": "5ea35acfac12ccdfd89f908cf73ef30927f407a4", "filename": "libstdc++-v3/include/debug/unordered_map", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3b8263e201b728fd6f9a4e418b9d4f3c477ae99/libstdc%2B%2B-v3%2Finclude%2Fdebug%2Funordered_map", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3b8263e201b728fd6f9a4e418b9d4f3c477ae99/libstdc%2B%2B-v3%2Finclude%2Fdebug%2Funordered_map", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fdebug%2Funordered_map?ref=d3b8263e201b728fd6f9a4e418b9d4f3c477ae99", "patch": "@@ -538,12 +538,13 @@ namespace __debug\n       erase(const key_type& __key)\n       {\n \tsize_type __ret(0);\n-\t_Base_iterator __victim(_Base::find(__key));\n-\tif (__victim != _Base::end())\n+\tstd::pair<_Base_iterator, _Base_iterator> __pair =\n+\t  _Base::equal_range(__key);\n+\tfor (_Base_iterator __victim = __pair.first; __victim != __pair.second;)\n \t  {\n \t    this->_M_invalidate_if(_Equal(__victim));\n-\t    _Base::erase(__victim);\n-\t    __ret = 1;\n+\t    _Base::erase(__victim++);\n+\t    ++__ret;\n \t  }\n \treturn __ret;\n       }"}, {"sha": "3e771a86dafbf2039eec7a79c133fa28c47bf47f", "filename": "libstdc++-v3/include/debug/unordered_set", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3b8263e201b728fd6f9a4e418b9d4f3c477ae99/libstdc%2B%2B-v3%2Finclude%2Fdebug%2Funordered_set", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3b8263e201b728fd6f9a4e418b9d4f3c477ae99/libstdc%2B%2B-v3%2Finclude%2Fdebug%2Funordered_set", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fdebug%2Funordered_set?ref=d3b8263e201b728fd6f9a4e418b9d4f3c477ae99", "patch": "@@ -519,12 +519,13 @@ namespace __debug\n       erase(const key_type& __key)\n       {\n \tsize_type __ret(0);\n-\t_Base_iterator __victim(_Base::find(__key));\n-\tif (__victim != _Base::end())\n+\tstd::pair<_Base_iterator, _Base_iterator> __pair =\n+\t  _Base::equal_range(__key);\n+\tfor (_Base_iterator __victim = __pair.first; __victim != __pair.second;)\n \t  {\n \t    this->_M_invalidate_if(_Equal(__victim));\n-\t    _Base::erase(__victim);\n-\t    __ret = 1;\n+\t    _Base::erase(__victim++);\n+\t    ++__ret;\n \t  }\n \treturn __ret;\n       }"}, {"sha": "09515726598ed3ba073222763e34ce574a7a6bec", "filename": "libstdc++-v3/testsuite/23_containers/unordered_multimap/erase/1.cc", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3b8263e201b728fd6f9a4e418b9d4f3c477ae99/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Funordered_multimap%2Ferase%2F1.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3b8263e201b728fd6f9a4e418b9d4f3c477ae99/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Funordered_multimap%2Ferase%2F1.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Funordered_multimap%2Ferase%2F1.cc?ref=d3b8263e201b728fd6f9a4e418b9d4f3c477ae99", "patch": "@@ -44,33 +44,34 @@ void test01()\n   mm1.insert(value_type(\"umbra/penumbra\", 8));\n   mm1.insert(value_type(\"belonging (no longer mix)\", 9));\n   mm1.insert(value_type(\"one line behind\", 10));\n-  VERIFY( mm1.size() == 10 );\n+  mm1.insert(value_type(\"because to why\", 11));\n+  VERIFY( mm1.size() == 11 );\n \n   VERIFY( mm1.erase(\"eeilo\") == 1 );\n-  VERIFY( mm1.size() == 9 );\n+  VERIFY( mm1.size() == 10 );\n   iterator it1 = mm1.find(\"eeilo\");\n   VERIFY( it1 == mm1.end() );\n \n   VERIFY( mm1.erase(\"tillsammans\") == 1 );\n-  VERIFY( mm1.size() == 8 );\n+  VERIFY( mm1.size() == 9 );\n   iterator it2 = mm1.find(\"tillsammans\");\n   VERIFY( it2 == mm1.end() );\n \n   // Must work (see DR 526)\n   iterator it3 = mm1.find(\"belonging (no longer mix)\");\n   VERIFY( it3 != mm1.end() );\n   VERIFY( mm1.erase(it3->first) == 1 );\n-  VERIFY( mm1.size() == 7 );\n+  VERIFY( mm1.size() == 8 );\n   it3 = mm1.find(\"belonging (no longer mix)\");\n   VERIFY( it3 == mm1.end() );\n \n   VERIFY( !mm1.erase(\"abra\") );\n-  VERIFY( mm1.size() == 7 );\n+  VERIFY( mm1.size() == 8 );\n \n   VERIFY( !mm1.erase(\"eeilo\") );\n-  VERIFY( mm1.size() == 7 );\n+  VERIFY( mm1.size() == 8 );\n \n-  VERIFY( mm1.erase(\"because to why\") == 1 );\n+  VERIFY( mm1.erase(\"because to why\") == 2 );\n   VERIFY( mm1.size() == 6 );\n   iterator it4 = mm1.find(\"because to why\");\n   VERIFY( it4 == mm1.end() );"}, {"sha": "327dc4bd0b22442f976ed48890c30d3083a5980b", "filename": "libstdc++-v3/testsuite/23_containers/unordered_multiset/erase/1.cc", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3b8263e201b728fd6f9a4e418b9d4f3c477ae99/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Funordered_multiset%2Ferase%2F1.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3b8263e201b728fd6f9a4e418b9d4f3c477ae99/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Funordered_multiset%2Ferase%2F1.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Funordered_multiset%2Ferase%2F1.cc?ref=d3b8263e201b728fd6f9a4e418b9d4f3c477ae99", "patch": "@@ -43,33 +43,34 @@ void test01()\n   ms1.insert(\"umbra/penumbra\");\n   ms1.insert(\"belonging (no longer mix)\");\n   ms1.insert(\"one line behind\");\n-  VERIFY( ms1.size() == 10 );\n+  ms1.insert(\"because to why\");\n+  VERIFY( ms1.size() == 11 );\n \n   VERIFY( ms1.erase(\"eeilo\") == 1 );\n-  VERIFY( ms1.size() == 9 );\n+  VERIFY( ms1.size() == 10 );\n   iterator it1 = ms1.find(\"eeilo\");\n   VERIFY( it1 == ms1.end() );\n \n   VERIFY( ms1.erase(\"tillsammans\") == 1 );\n-  VERIFY( ms1.size() == 8 );\n+  VERIFY( ms1.size() == 9 );\n   iterator it2 = ms1.find(\"tillsammans\");\n   VERIFY( it2 == ms1.end() );\n \n   // Must work (see DR 526)\n   iterator it3 = ms1.find(\"belonging (no longer mix)\");\n   VERIFY( it3 != ms1.end() );\n   VERIFY( ms1.erase(*it3) == 1 );\n-  VERIFY( ms1.size() == 7 );\n+  VERIFY( ms1.size() == 8 );\n   it3 = ms1.find(\"belonging (no longer mix)\");\n   VERIFY( it3 == ms1.end() );\n \n   VERIFY( !ms1.erase(\"abra\") );\n-  VERIFY( ms1.size() == 7 );\n+  VERIFY( ms1.size() == 8 );\n \n   VERIFY( !ms1.erase(\"eeilo\") );\n-  VERIFY( ms1.size() == 7 );\n+  VERIFY( ms1.size() == 8 );\n \n-  VERIFY( ms1.erase(\"because to why\") == 1 );\n+  VERIFY( ms1.erase(\"because to why\") == 2 );\n   VERIFY( ms1.size() == 6 );\n   iterator it4 = ms1.find(\"because to why\");\n   VERIFY( it4 == ms1.end() );"}]}