{"sha": "d9634d537130407bc8ea2ada9508e2386e1b714b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDk2MzRkNTM3MTMwNDA3YmM4ZWEyYWRhOTUwOGUyMzg2ZTFiNzE0Yg==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2004-07-02T23:56:38Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2004-07-02T23:56:38Z"}, "message": "re PR c++/16240 (g++ generates incorrect mangled name)\n\n\tPR c++/16240\n\t* mangle.c (write_template_arg): Correct mangling.\n\n\tPR c++/16240\n\t* g++.dg/abi/mangle22.C: New test.\n\t* g++.dg/abi/mangle23.C: Likewise.\n\nFrom-SVN: r84033", "tree": {"sha": "107d4bc8e7c8de072b0bf2b4d32c6f3a7f367652", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/107d4bc8e7c8de072b0bf2b4d32c6f3a7f367652"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d9634d537130407bc8ea2ada9508e2386e1b714b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9634d537130407bc8ea2ada9508e2386e1b714b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d9634d537130407bc8ea2ada9508e2386e1b714b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9634d537130407bc8ea2ada9508e2386e1b714b/comments", "author": null, "committer": null, "parents": [{"sha": "1568430fae5e11fe4496dcc194c9771f6e088bf1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1568430fae5e11fe4496dcc194c9771f6e088bf1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1568430fae5e11fe4496dcc194c9771f6e088bf1"}], "stats": {"total": 43, "additions": 39, "deletions": 4}, "files": [{"sha": "8e21875e4c892f7300e4f58409087679c62c1804", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9634d537130407bc8ea2ada9508e2386e1b714b/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9634d537130407bc8ea2ada9508e2386e1b714b/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=d9634d537130407bc8ea2ada9508e2386e1b714b", "patch": "@@ -1,5 +1,8 @@\n 2004-07-02  Mark Mitchell  <mark@codesourcery.com>\n \n+\tPR c++/16240\n+\t* mangle.c (write_template_arg): Correct mangling.\n+\n \tPR c++/16297\n \t* decl.c (grokdeclarator): Robustify.\n "}, {"sha": "97d4309fcf278b1fe3e20d7f86f8d0c3b697d468", "filename": "gcc/cp/mangle.c", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9634d537130407bc8ea2ada9508e2386e1b714b/gcc%2Fcp%2Fmangle.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9634d537130407bc8ea2ada9508e2386e1b714b/gcc%2Fcp%2Fmangle.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fmangle.c?ref=d9634d537130407bc8ea2ada9508e2386e1b714b", "patch": "@@ -2203,12 +2203,20 @@ write_template_arg (tree node)\n     write_template_arg_literal (node);\n   else if (DECL_P (node))\n     {\n-      /* G++ 3.2 incorrectly mangled non-type template arguments of\n-\t enumeration type using their names.  */\n-      if (code == CONST_DECL)\n+      /* Until ABI version 2, non-type template arguments of\n+\t enumeration type were mangled using their names.  */ \n+      if (code == CONST_DECL && !abi_version_at_least (2))\n \tG.need_abi_warning = 1;\n       write_char ('L');\n-      write_char ('Z');\n+      /* Until ABI version 3, the underscore before the mangled name\n+\t was incorrectly omitted.  */\n+      if (!abi_version_at_least (3))\n+\t{\n+\t  G.need_abi_warning = 1;\n+\t  write_char ('Z');\n+\t}\n+      else\n+\twrite_string (\"_Z\");\n       write_encoding (node);\n       write_char ('E');\n     }"}, {"sha": "8638c0ed6462b083842b3ea56eecc850435e0b8e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9634d537130407bc8ea2ada9508e2386e1b714b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9634d537130407bc8ea2ada9508e2386e1b714b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d9634d537130407bc8ea2ada9508e2386e1b714b", "patch": "@@ -1,3 +1,9 @@\n+2004-07-02  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/16240\n+\t* g++.dg/abi/mangle22.C: New test.\n+\t* g++.dg/abi/mangle23.C: Likewise.\n+\n 2004-07-02  David Billinghurst  (David.Billinghurst@riotinto.com)\n \n \tPR fortran/16290"}, {"sha": "93ddd1e8740bca5cb1326a071a0e38f1e1af6a2c", "filename": "gcc/testsuite/g++.dg/abi/mangle22.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9634d537130407bc8ea2ada9508e2386e1b714b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fmangle22.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9634d537130407bc8ea2ada9508e2386e1b714b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fmangle22.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fmangle22.C?ref=d9634d537130407bc8ea2ada9508e2386e1b714b", "patch": "@@ -0,0 +1,9 @@\n+// PR c++/16240\n+// { dg-options \"-fabi-version=3\" }\n+\n+void foo(char);\n+template<void (&)(char)> struct CB {};\n+\n+void g(CB<foo> i) {}\n+\n+// { dg-final { scan-assembler \"\\n_?_Z1g2CBIL_Z3foocEE\\[: \\t\\n\\]\" } }"}, {"sha": "c17f54b4a720a85450c995f55841e2e769c40739", "filename": "gcc/testsuite/g++.dg/abi/mangle23.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9634d537130407bc8ea2ada9508e2386e1b714b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fmangle23.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9634d537130407bc8ea2ada9508e2386e1b714b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fmangle23.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fmangle23.C?ref=d9634d537130407bc8ea2ada9508e2386e1b714b", "patch": "@@ -0,0 +1,9 @@\n+// PR c++/16240\n+// { dg-options \"-fabi-version=2\" }\n+\n+void foo(char);\n+template<void (&)(char)> struct CB {};\n+\n+void g(CB<foo> i) {}\n+\n+// { dg-final { scan-assembler \"\\n_?_Z1g2CBILZ3foocEE\\[: \\t\\n\\]\" } }"}]}