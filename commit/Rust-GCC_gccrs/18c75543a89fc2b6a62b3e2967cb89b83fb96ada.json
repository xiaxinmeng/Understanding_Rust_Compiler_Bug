{"sha": "18c75543a89fc2b6a62b3e2967cb89b83fb96ada", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MThjNzU1NDNhODlmYzJiNmE2MmIzZTI5NjdjYjg5YjgzZmI5NmFkYQ==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2005-10-11T06:19:13Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2005-10-11T06:19:13Z"}, "message": "re PR libstdc++/13583 (__use_cache not threadsafe)\n\n\tPR libstdc++/13583\n\t* include/bits/locale_classes.h (locale::_Impl::_M_install_cache):\n\tMove out of line.\n\t* src/locale.cc: Define here, add mutex.\n\t* configure.ac (libtool_VERSION): To 6:7:0.\n\t* configure: Regenerate.\n\t* testsuite/testsuite_abi.cc (check_version): Add GLIBCXX_3.4.7.\n\t* config/linker-map.gnu: Export locale::_Impl::_M_install_cache.\n\nFrom-SVN: r105221", "tree": {"sha": "a25c3b10a5e437f7a6875e11b8b8bd9c85f26839", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a25c3b10a5e437f7a6875e11b8b8bd9c85f26839"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/18c75543a89fc2b6a62b3e2967cb89b83fb96ada", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18c75543a89fc2b6a62b3e2967cb89b83fb96ada", "html_url": "https://github.com/Rust-GCC/gccrs/commit/18c75543a89fc2b6a62b3e2967cb89b83fb96ada", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18c75543a89fc2b6a62b3e2967cb89b83fb96ada/comments", "author": null, "committer": null, "parents": [{"sha": "e0c48a517ebd8213c2300b7d63907b2e85c0ef9c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e0c48a517ebd8213c2300b7d63907b2e85c0ef9c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e0c48a517ebd8213c2300b7d63907b2e85c0ef9c"}], "stats": {"total": 65, "additions": 56, "deletions": 9}, "files": [{"sha": "e9f68830103dcdf6c813c915a8dbdb3756794147", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18c75543a89fc2b6a62b3e2967cb89b83fb96ada/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18c75543a89fc2b6a62b3e2967cb89b83fb96ada/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=18c75543a89fc2b6a62b3e2967cb89b83fb96ada", "patch": "@@ -1,3 +1,17 @@\n+2005-10-10  Benjamin Kosnik  <bkoz@redhat.com>\n+\n+\t* configure.ac (libtool_VERSION): To 6:7:0.\n+\t* configure: Regenerate.\n+\t* testsuite/testsuite_abi.cc (check_version): Add GLIBCXX_3.4.7.\n+\t* config/linker-map.gnu: Export locale::_Impl::_M_install_cache.\n+\n+2005-10-10  Ian Lance Taylor  <ian@airs.com>\n+\n+\tPR libstdc++/13583\n+\t* include/bits/locale_classes.h (locale::_Impl::_M_install_cache):\n+\tMove out of line.\n+\t* src/locale.cc: Define here, add mutex.\n+\n 2005-10-09  Paolo Carlini  <pcarlini@suse.de>\n \n \tPR libstdc++/24061 (issue 6.19)"}, {"sha": "fa13a614e2e1bec7751639b69e33ac7e7efb0b5e", "filename": "libstdc++-v3/config/linker-map.gnu", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18c75543a89fc2b6a62b3e2967cb89b83fb96ada/libstdc%2B%2B-v3%2Fconfig%2Flinker-map.gnu", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18c75543a89fc2b6a62b3e2967cb89b83fb96ada/libstdc%2B%2B-v3%2Fconfig%2Flinker-map.gnu", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Flinker-map.gnu?ref=18c75543a89fc2b6a62b3e2967cb89b83fb96ada", "patch": "@@ -84,7 +84,7 @@ GLIBCXX_3.4 {\n       std::locale::[A-Zj-z]*;\n       std::locale::_[A-Ha-z]*;\n       std::locale::_Impl::[A-Za-z]*;\n-      std::locale::_Impl::_M_[A-Za-z]*;\n+#     std::locale::_Impl::_M_[A-Za-z]*;\n       std::locale::_[J-Ra-z]*;\n       std::locale::_S_normalize_category*;\n       std::locale::_[T-Za-z]*;\n@@ -468,6 +468,12 @@ GLIBCXX_3.4 {\n \n     _ZNSt19istreambuf_iteratorI[cw]St11char_traitsI[cw]EEppEv;\n \n+    # std::locale::Impl _M_ members\n+    _ZNSt6locale5_Impl16_M_install_facetEPKNS_2idEPKNS_5facetE;\n+    _ZNSt6locale5_Impl16_M_replace_facetEPKS0_PKNS_2idE;\n+    _ZNSt6locale5_Impl19_M_replace_categoryEPKS0_PKPKNS_2idE;\n+    _ZNSt6locale5_Impl21_M_replace_categoriesEPKS0_i;\n+\n   # DO NOT DELETE THIS LINE.  Port-specific symbols, if any, will be here.\n \n   local:\n@@ -571,10 +577,16 @@ GLIBCXX_3.4.6 {\n \n     _ZNKSt15basic_stringbufIwSt11char_traitsIwESaIwEE3strEv;\n \n-   _ZN9__gnu_cxx6__poolILb1EE13_M_initializeEv;\n+    _ZN9__gnu_cxx6__poolILb1EE13_M_initializeEv;\n \n } GLIBCXX_3.4.5;\n \n+GLIBCXX_3.4.7 {\n+\n+    _ZNSt6locale5_Impl16_M_install_cacheEPKNS_5facetE[jm];\n+\n+} GLIBCXX_3.4.6;\n+\n # Symbols in the support library (libsupc++) have their own tag.\n CXXABI_1.3 {\n "}, {"sha": "5a25997476643e4edfae9e03ad0ff24382407185", "filename": "libstdc++-v3/configure", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18c75543a89fc2b6a62b3e2967cb89b83fb96ada/libstdc%2B%2B-v3%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18c75543a89fc2b6a62b3e2967cb89b83fb96ada/libstdc%2B%2B-v3%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfigure?ref=18c75543a89fc2b6a62b3e2967cb89b83fb96ada", "patch": "@@ -1376,7 +1376,7 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu\n ### am handles this now?  ORIGINAL_LD_FOR_MULTILIBS=$LD\n \n # For libtool versioning info, format is CURRENT:REVISION:AGE\n-libtool_VERSION=6:6:0\n+libtool_VERSION=6:7:0\n \n \n # Find the rest of the source tree framework."}, {"sha": "fc31bc68b6e267ea96f0a6f5d0ec875056b7e0b9", "filename": "libstdc++-v3/configure.ac", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18c75543a89fc2b6a62b3e2967cb89b83fb96ada/libstdc%2B%2B-v3%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18c75543a89fc2b6a62b3e2967cb89b83fb96ada/libstdc%2B%2B-v3%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfigure.ac?ref=18c75543a89fc2b6a62b3e2967cb89b83fb96ada", "patch": "@@ -12,7 +12,7 @@ AC_CONFIG_HEADER(config.h)\n ### am handles this now?  ORIGINAL_LD_FOR_MULTILIBS=$LD\n \n # For libtool versioning info, format is CURRENT:REVISION:AGE\n-libtool_VERSION=6:6:0\n+libtool_VERSION=6:7:0\n AC_SUBST(libtool_VERSION)\n \n # Find the rest of the source tree framework."}, {"sha": "aed938d0c108753c2cea81a6fde429706b123610", "filename": "libstdc++-v3/include/bits/locale_classes.h", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18c75543a89fc2b6a62b3e2967cb89b83fb96ada/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_classes.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18c75543a89fc2b6a62b3e2967cb89b83fb96ada/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_classes.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_classes.h?ref=18c75543a89fc2b6a62b3e2967cb89b83fb96ada", "patch": "@@ -559,11 +559,7 @@ namespace std\n       { _M_install_facet(&_Facet::id, __facet); }\n \n     void\n-    _M_install_cache(const facet* __cache, size_t __index) throw()\n-    {\n-      __cache->_M_add_reference();\n-      _M_caches[__index] = __cache;\n-    }\n+    _M_install_cache(const facet*, size_t);\n   };\n \n   template<typename _Facet>"}, {"sha": "5498eaee7a3e8a2b691c575c0f49e351d0533131", "filename": "libstdc++-v3/src/locale.cc", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18c75543a89fc2b6a62b3e2967cb89b83fb96ada/libstdc%2B%2B-v3%2Fsrc%2Flocale.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18c75543a89fc2b6a62b3e2967cb89b83fb96ada/libstdc%2B%2B-v3%2Fsrc%2Flocale.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fsrc%2Flocale.cc?ref=18c75543a89fc2b6a62b3e2967cb89b83fb96ada", "patch": "@@ -33,6 +33,13 @@\n #include <cwctype>     // For towupper, etc.\n #include <locale>\n #include <bits/atomicity.h>\n+#include <bits/concurrence.h>\n+\n+namespace __gnu_internal\n+{\n+  // Mutex object for cache access\n+  static __glibcxx_mutex_define_initialized(locale_cache_mutex);\n+}\n \n namespace std \n {\n@@ -366,6 +373,23 @@ namespace std\n       }\n   }\n \n+  void\n+  locale::_Impl::\n+  _M_install_cache(const facet* __cache, size_t __index)\n+  {\n+    __gnu_cxx::lock sentry(__gnu_internal::locale_cache_mutex);\n+    if (_M_caches[__index] != 0)\n+      {\n+\t// Some other thread got in first.\n+\tdelete __cache;\n+      }\n+    else\n+      {\n+\t__cache->_M_add_reference();\n+\t_M_caches[__index] = __cache;\n+      }\n+  }\n+\n   // locale::id\n   // Definitions for static const data members of locale::id\n   _Atomic_word locale::id::_S_refcount;  // init'd to 0 by linker"}, {"sha": "d0e65afcf597b1f1f6a8f46822e8f5727afd06f6", "filename": "libstdc++-v3/testsuite/testsuite_abi.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18c75543a89fc2b6a62b3e2967cb89b83fb96ada/libstdc%2B%2B-v3%2Ftestsuite%2Ftestsuite_abi.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18c75543a89fc2b6a62b3e2967cb89b83fb96ada/libstdc%2B%2B-v3%2Ftestsuite%2Ftestsuite_abi.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Ftestsuite_abi.cc?ref=18c75543a89fc2b6a62b3e2967cb89b83fb96ada", "patch": "@@ -185,6 +185,7 @@ check_version(symbol& test, bool added)\n       known_versions.push_back(\"GLIBCXX_3.4.4\"); \n       known_versions.push_back(\"GLIBCXX_3.4.5\");\n       known_versions.push_back(\"GLIBCXX_3.4.6\");\n+      known_versions.push_back(\"GLIBCXX_3.4.7\");\n       known_versions.push_back(\"CXXABI_1.3\");\n       known_versions.push_back(\"CXXABI_1.3.1\");\n     }"}]}