{"sha": "29f0d7d457668f1a6acd3bd8b9ac67d37315d999", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjlmMGQ3ZDQ1NzY2OGYxYTZhY2QzYmQ4YjlhYzY3ZDM3MzE1ZDk5OQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-12-07T15:20:04Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-12-07T15:20:04Z"}, "message": "re PR c++/86669 (Complete object constructor clone omits length for a c++11 braced initialiser)\n\n\tPR c++/86669\n\t* call.c (make_temporary_var_for_ref_to_temp): Call pushdecl even for\n\tautomatic vars.\n\n\t* g++.dg/cpp0x/initlist105.C: New test.\n\t* g++.dg/cpp0x/initlist106.C: New test.\n\t* g++.dg/other/pr86669.C: New test.\n\nFrom-SVN: r266893", "tree": {"sha": "42003eabe14eb777579eb4f5ce87ea29bf3abfde", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/42003eabe14eb777579eb4f5ce87ea29bf3abfde"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/29f0d7d457668f1a6acd3bd8b9ac67d37315d999", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29f0d7d457668f1a6acd3bd8b9ac67d37315d999", "html_url": "https://github.com/Rust-GCC/gccrs/commit/29f0d7d457668f1a6acd3bd8b9ac67d37315d999", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29f0d7d457668f1a6acd3bd8b9ac67d37315d999/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "26004f51f9cfb83d88d445903933fb8c39a841f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26004f51f9cfb83d88d445903933fb8c39a841f1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/26004f51f9cfb83d88d445903933fb8c39a841f1"}], "stats": {"total": 82, "additions": 79, "deletions": 3}, "files": [{"sha": "6481ad4d4dbea1f2d14eb1f033966500062b03c8", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29f0d7d457668f1a6acd3bd8b9ac67d37315d999/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29f0d7d457668f1a6acd3bd8b9ac67d37315d999/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=29f0d7d457668f1a6acd3bd8b9ac67d37315d999", "patch": "@@ -1,5 +1,9 @@\n 2018-12-07  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/86669\n+\t* call.c (make_temporary_var_for_ref_to_temp): Call pushdecl even for\n+\tautomatic vars.\n+\n \tPR c++/87506\n \t* constexpr.c (adjust_temp_type): Handle EMPTY_CLASS_EXPR.\n "}, {"sha": "6328a36b6049dca5c7fdd30888e7b8d947c0494a", "filename": "gcc/cp/call.c", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29f0d7d457668f1a6acd3bd8b9ac67d37315d999/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29f0d7d457668f1a6acd3bd8b9ac67d37315d999/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=29f0d7d457668f1a6acd3bd8b9ac67d37315d999", "patch": "@@ -11148,14 +11148,12 @@ make_temporary_var_for_ref_to_temp (tree decl, tree type)\n       tree name = mangle_ref_init_variable (decl);\n       DECL_NAME (var) = name;\n       SET_DECL_ASSEMBLER_NAME (var, name);\n-\n-      var = pushdecl (var);\n     }\n   else\n     /* Create a new cleanup level if necessary.  */\n     maybe_push_cleanup_level (type);\n \n-  return var;\n+  return pushdecl (var);\n }\n \n /* EXPR is the initializer for a variable DECL of reference or"}, {"sha": "fd940b465b58ef615dd52a3940aeadc50e847fa8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29f0d7d457668f1a6acd3bd8b9ac67d37315d999/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29f0d7d457668f1a6acd3bd8b9ac67d37315d999/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=29f0d7d457668f1a6acd3bd8b9ac67d37315d999", "patch": "@@ -1,3 +1,10 @@\n+2018-12-07  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/86669\n+\t* g++.dg/cpp0x/initlist105.C: New test.\n+\t* g++.dg/cpp0x/initlist106.C: New test.\n+\t* g++.dg/other/pr86669.C: New test.\n+\n 2018-12-07  Richard Sandiford  <richard.sandiford@arm.com>\n \n \t* gcc.target/aarch64/sve/pred_elim_2.c: New test."}, {"sha": "3720a2da83c47b264a56e3d4260fcee1fa1007dc", "filename": "gcc/testsuite/g++.dg/cpp0x/initlist105.C", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29f0d7d457668f1a6acd3bd8b9ac67d37315d999/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finitlist105.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29f0d7d457668f1a6acd3bd8b9ac67d37315d999/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finitlist105.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finitlist105.C?ref=29f0d7d457668f1a6acd3bd8b9ac67d37315d999", "patch": "@@ -0,0 +1,28 @@\n+// PR c++/86669\n+// { dg-do run { target c++11 } }\n+\n+#include <initializer_list>\n+\n+struct S { S (); };\n+struct T : public S {};\n+int cnt;\n+void foo (int) { cnt++; }\n+\n+S::S ()\n+{\n+  int e = 1, f = 2, g = 3, h = 4;\n+\n+  for (auto k : { e, f, g, h })\n+    foo (k);\n+}\n+\n+int\n+main ()\n+{\n+  S s;\n+  if (cnt != 4)\n+    __builtin_abort ();\n+  T t;\n+  if (cnt != 8)\n+    __builtin_abort ();\n+}"}, {"sha": "df0afac8088d4826a12ed14c716addb92cbcba6b", "filename": "gcc/testsuite/g++.dg/cpp0x/initlist106.C", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29f0d7d457668f1a6acd3bd8b9ac67d37315d999/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finitlist106.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29f0d7d457668f1a6acd3bd8b9ac67d37315d999/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finitlist106.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Finitlist106.C?ref=29f0d7d457668f1a6acd3bd8b9ac67d37315d999", "patch": "@@ -0,0 +1,29 @@\n+// PR c++/86669\n+// { dg-do run { target c++11 } }\n+\n+#include <initializer_list>\n+\n+struct A { };\n+struct S : virtual public A { S (); };\n+struct T : public S, virtual public A {};\n+int cnt;\n+void foo (int) { cnt++; }\n+\n+S::S ()\n+{\n+  int e = 1, f = 2, g = 3, h = 4;\n+\n+  for (auto k : { e, f, g, h })\n+    foo (k);\n+}\n+\n+int\n+main ()\n+{\n+  S s;\n+  if (cnt != 4)\n+    __builtin_abort ();\n+  T t;\n+  if (cnt != 8)\n+    __builtin_abort ();\n+}"}, {"sha": "d986bb1966b6add1fe1e73521be27c99664e0017", "filename": "gcc/testsuite/g++.dg/other/pr86669.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29f0d7d457668f1a6acd3bd8b9ac67d37315d999/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr86669.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29f0d7d457668f1a6acd3bd8b9ac67d37315d999/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr86669.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr86669.C?ref=29f0d7d457668f1a6acd3bd8b9ac67d37315d999", "patch": "@@ -0,0 +1,10 @@\n+// PR c++/86669\n+// { dg-do compile }\n+\n+struct S { S (); };\n+struct T : public S {};\n+\n+S::S ()\n+{\n+  int *p = { (int *) &p };\n+}"}]}