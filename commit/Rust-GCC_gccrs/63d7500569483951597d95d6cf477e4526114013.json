{"sha": "63d7500569483951597d95d6cf477e4526114013", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjNkNzUwMDU2OTQ4Mzk1MTU5N2Q5NWQ2Y2Y0NzdlNDUyNjExNDAxMw==", "commit": {"author": {"name": "Neil Booth", "email": "neil@cat.daikokuya.demon.co.uk", "date": "2001-11-05T22:26:13Z"}, "committer": {"name": "Neil Booth", "email": "neil@gcc.gnu.org", "date": "2001-11-05T22:26:13Z"}, "message": "cppexp.c (lex, [...]): Update warning about defined.\n\n\t* cppexp.c (lex, parse_defined): Update warning about defined.\n\t* gcc.dg/cpp/defined.c: Update.\n\nFrom-SVN: r46794", "tree": {"sha": "f0c6212de4e1011133e309e692cd9ad0e138101c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f0c6212de4e1011133e309e692cd9ad0e138101c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/63d7500569483951597d95d6cf477e4526114013", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63d7500569483951597d95d6cf477e4526114013", "html_url": "https://github.com/Rust-GCC/gccrs/commit/63d7500569483951597d95d6cf477e4526114013", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63d7500569483951597d95d6cf477e4526114013/comments", "author": null, "committer": null, "parents": [{"sha": "a5356269d3d2f8c1a48184c27fdfc052934ae0c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5356269d3d2f8c1a48184c27fdfc052934ae0c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a5356269d3d2f8c1a48184c27fdfc052934ae0c4"}], "stats": {"total": 44, "additions": 34, "deletions": 10}, "files": [{"sha": "a1018aa46edc815273d51ada43f3d17c4297daf2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63d7500569483951597d95d6cf477e4526114013/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63d7500569483951597d95d6cf477e4526114013/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=63d7500569483951597d95d6cf477e4526114013", "patch": "@@ -1,3 +1,7 @@\n+2001-11-05  Neil Booth  <neil@cat.daikokuya.demon.co.uk>\n+\n+\t* cppexp.c (lex, parse_defined): Update warning about defined.\n+\n 2001-11-05  Geoffrey Keating  <geoffk@redhat.com>\n \n \t* config/rs6000/rs6000.c (rs6000_select_section): Handle"}, {"sha": "ac222eebda88ed93d61bbe541d798ba0260eca17", "filename": "gcc/cppexp.c", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63d7500569483951597d95d6cf477e4526114013/gcc%2Fcppexp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63d7500569483951597d95d6cf477e4526114013/gcc%2Fcppexp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcppexp.c?ref=63d7500569483951597d95d6cf477e4526114013", "patch": "@@ -219,6 +219,7 @@ parse_defined (pfile)\n   cpp_hashnode *node = 0;\n   const cpp_token *token;\n   struct op op;\n+  cpp_context *initial_context = pfile->context;\n \n   /* Don't expand macros.  */\n   pfile->state.prevent_expansion++;\n@@ -259,6 +260,9 @@ parse_defined (pfile)\n     op.op = CPP_ERROR;\n   else\n     {\n+      if (pfile->context != initial_context)\n+\tcpp_warning (pfile, \"this use of \\\"defined\\\" may not be portable\");\n+\n       op.value = node->type == NT_MACRO;\n       op.unsignedp = 0;\n       op.op = CPP_NUMBER;\n@@ -314,12 +318,7 @@ lex (pfile, skip_evaluation)\n \n     case CPP_NAME:\n       if (token->val.node == pfile->spec_nodes.n_defined)\n-\t{\n-\t  if (pfile->context->prev && CPP_PEDANTIC (pfile))\n-\t    cpp_pedwarn (pfile, \"\\\"defined\\\" operator appears during macro expansion\");\n-\n-\t  return parse_defined (pfile);\n-\t}\n+\treturn parse_defined (pfile);\n       else if (CPP_OPTION (pfile, cplusplus)\n \t       && (token->val.node == pfile->spec_nodes.n_true\n \t\t   || token->val.node == pfile->spec_nodes.n_false))"}, {"sha": "2badf85577933c585c009374af56193696c861e0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63d7500569483951597d95d6cf477e4526114013/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63d7500569483951597d95d6cf477e4526114013/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=63d7500569483951597d95d6cf477e4526114013", "patch": "@@ -1,3 +1,7 @@\n+2001-11-05  Neil Booth  <neil@cat.daikokuya.demon.co.uk>\n+\n+\t* gcc.dg/cpp/defined.c: Update.\n+\n 2001-11-04  Neil Booth  <neil@cat.daikokuya.demon.co.uk>\n \n \t* gcc.c-torture/execute/anon-1.c: New test."}, {"sha": "864ef1ddd89d0354bc458ef0aff2f92ae5828b83", "filename": "gcc/testsuite/gcc.dg/cpp/defined.c", "status": "modified", "additions": 21, "deletions": 4, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63d7500569483951597d95d6cf477e4526114013/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fdefined.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63d7500569483951597d95d6cf477e4526114013/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fdefined.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fdefined.c?ref=63d7500569483951597d95d6cf477e4526114013", "patch": "@@ -21,7 +21,7 @@\n \n /* The behaviour of \"defined\" when it comes from a macro expansion is\n    now documented.  */\n-#if is_Z_defined\t\t/* { dg-warning \"macro expansion\" } */\n+#if is_Z_defined\n #error Macro expanding into defined operator test 1\n #endif\n \n@@ -31,7 +31,7 @@\n #error Z is defined\n #endif\n \n-#if !is_Z_defined\t\t/* { dg-warning \"macro expansion\" } */\n+#if !is_Z_defined\n #error Macro expanding into defined operator test 2\n #endif\n \n@@ -53,7 +53,7 @@\n \n /* The behaviour of \"defined\" when it comes from a macro expansion is\n    now documented.  */\n-#if is_Z_defined\t\t/* { dg-warning \"macro expansion\" } */\n+#if is_Z_defined\n #error Macro expanding into defined operator test 1\n #endif\n \n@@ -63,6 +63,23 @@\n #error Z is defined\n #endif\n \n-#if !is_Z_defined\t\t/* { dg-warning \"macro expansion\" } */\n+#if !is_Z_defined\n #error Macro expanding into defined operator test 2\n #endif\n+\n+/* Use of defined in different contexts.  */\n+\n+#define bad1 defined\n+#if !bad1 Z\t\t\t/* { dg-warning \"may not be portable\" } */\n+#error Z is defined\n+#endif \n+\n+#if !bad1 (Z)\t\t\t/* { dg-warning \"may not be portable\" } */\n+#error Z is defined\n+#endif \n+\n+#define bad2 defined (Z\n+#if !bad2)\t\t\t/* { dg-warning \"may not be portable\" } */\n+#error Z is defined\n+#endif \n+"}]}