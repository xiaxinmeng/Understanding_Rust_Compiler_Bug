{"sha": "d748c543b603704ac8ec8214cc8614ddf01aea47", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDc0OGM1NDNiNjAzNzA0YWM4ZWM4MjE0Y2M4NjE0ZGRmMDFhZWE0Nw==", "commit": {"author": {"name": "Thomas Rodgers", "email": "trodgers@redhat.com", "date": "2019-05-21T01:06:32Z"}, "committer": {"name": "Thomas Rodgers", "email": "rodgertq@gcc.gnu.org", "date": "2019-05-21T01:06:32Z"}, "message": "Check TBB version in tbb-backed effective target check\n\n      * testsuite/lib/libstdc++.exp (check_effective_target_tbb-backend):\n      Add check for Thread Building Blocks 2018 or later.\n\nFrom-SVN: r271450", "tree": {"sha": "41a832934f0cb1871aac537fa9da5ee228f5559e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/41a832934f0cb1871aac537fa9da5ee228f5559e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d748c543b603704ac8ec8214cc8614ddf01aea47", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d748c543b603704ac8ec8214cc8614ddf01aea47", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d748c543b603704ac8ec8214cc8614ddf01aea47", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d748c543b603704ac8ec8214cc8614ddf01aea47/comments", "author": {"login": "rodgert", "id": 120839, "node_id": "MDQ6VXNlcjEyMDgzOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/120839?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rodgert", "html_url": "https://github.com/rodgert", "followers_url": "https://api.github.com/users/rodgert/followers", "following_url": "https://api.github.com/users/rodgert/following{/other_user}", "gists_url": "https://api.github.com/users/rodgert/gists{/gist_id}", "starred_url": "https://api.github.com/users/rodgert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rodgert/subscriptions", "organizations_url": "https://api.github.com/users/rodgert/orgs", "repos_url": "https://api.github.com/users/rodgert/repos", "events_url": "https://api.github.com/users/rodgert/events{/privacy}", "received_events_url": "https://api.github.com/users/rodgert/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "469528f22eeef522e4a67fb1fc64ee02a91a05bf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/469528f22eeef522e4a67fb1fc64ee02a91a05bf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/469528f22eeef522e4a67fb1fc64ee02a91a05bf"}], "stats": {"total": 47, "additions": 28, "deletions": 19}, "files": [{"sha": "5633216ca3d13aa5e69bb542219e99cb8b6852f9", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d748c543b603704ac8ec8214cc8614ddf01aea47/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d748c543b603704ac8ec8214cc8614ddf01aea47/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=d748c543b603704ac8ec8214cc8614ddf01aea47", "patch": "@@ -1,3 +1,8 @@\n+2019-05-20  Thomas Rodgers  <trodgers@redhat.com>\n+\n+\t* testsuite/lib/libstdc++.exp (check_effective_target_tbb-backend):\n+\tAdd check for Thread Building Blocks 2018 or later.\n+\n 2019-05-20  Jonathan Wakely  <jwakely@redhat.com>\n \n \t* testsuite/experimental/names.cc: Only include Networking TS headers"}, {"sha": "011630f6d32f15fc82ab81647c927249acbaaf43", "filename": "libstdc++-v3/testsuite/lib/libstdc++.exp", "status": "modified", "additions": 23, "deletions": 19, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d748c543b603704ac8ec8214cc8614ddf01aea47/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d748c543b603704ac8ec8214cc8614ddf01aea47/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp?ref=d748c543b603704ac8ec8214cc8614ddf01aea47", "patch": "@@ -1581,25 +1581,29 @@ proc check_effective_target_random_device { } {\n \n # Return 1 if tbb parallel backend is available\n proc check_effective_target_tbb-backend { } {\n-\t\tglobal cxxflags\n-\n-\t\t# Set up and preprocess a C++ test program that depends\n-\t\t# on tbb\n-\t\tset src tbb_backend[pid].cc\n-\n-\t\tset f [open $src \"w\"]\n-\t\tputs $f \"#include <tbb/tbb.h>\"\n-\t\tclose $f\n-\t\tset lines [v3_target_compile $src /dev/null preprocess \"\"]\n-\t\tfile delete $src\n-\n-\t\tif [string match \"\" $lines] {\n-\t\t\t\t# No error message, preprocessing succeeded.\n-\t\t\t\tverbose \"check_v3_tbb-backend: `1'\" 2\n-\t\t\t\treturn 1\n-\t\t}\n-\t\tverbose \"check_v3_tbb-backend: `0'\" 2\n-\t\treturn 0\n+    global cxxflags\n+\n+    # Set up and preprocess a C++ test program that depends\n+    # on tbb\n+    set src tbb_backend[pid].cc\n+\n+    set f [open $src \"w\"]\n+    puts $f \"#include <tbb/tbb.h>\"\n+    puts $f \"#if TBB_INTERFACE_VERSION < 10000\"\n+    puts $f \"#  error Intel(R) Threading Building Blocks 2018 is required; older versions are not supported.\"\n+    puts $f \"#endif\"\n+    close $f\n+    \n+    set lines [v3_target_compile $src /dev/null preprocess \"\"]\n+    file delete $src\n+\n+    if [string match \"\" $lines] {\n+\t# No error message, preprocessing succeeded.\n+\tverbose \"check_v3_tbb-backend: `1'\" 2\n+\treturn 1\n+    }\n+    verbose \"check_v3_tbb-backend: `0'\" 2\n+    return 0\n }\n \n set additional_prunes \"\""}]}