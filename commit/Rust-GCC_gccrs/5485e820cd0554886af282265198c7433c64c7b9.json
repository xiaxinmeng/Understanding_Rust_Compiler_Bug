{"sha": "5485e820cd0554886af282265198c7433c64c7b9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTQ4NWU4MjBjZDA1NTQ4ODZhZjI4MjI2NTE5OGM3NDMzYzY0YzdiOQ==", "commit": {"author": {"name": "Michael Meissner", "email": "meissner@linux.ibm.com", "date": "2021-07-27T01:27:00Z"}, "committer": {"name": "Michael Meissner", "email": "meissner@linux.ibm.com", "date": "2021-07-27T01:32:39Z"}, "message": "PR 100170: Fix eq/ne tests on power10.\n\nThis patch updates eq/ne tests in the testsuite to adjust the test if\npower10 code generation is used.\n\n2021-07-26  Michael Meissner  <meissner@linux.ibm.com>\n\ngcc/testsuite/\n\tPR testsuite/100170\n\t* gcc.target/powerpc/ppc-eq0-1.c: Adjust insn counts if power10\n\tcode is generated.\n\t* gcc.target/powerpc/ppc-ne0-1.c: (ne0): Adjust insn counts if\n\tpower10 code is generated.\n\t(plus_ne0): Move to ppc-ne0-2.c.\n\t(cmp_plus_ne): Likewise.\n\t(plus_ne0_cmp): Likewise.\n\t* gcc.target/powerpc/ppc-ne0-2.c: New file.", "tree": {"sha": "2e3ed8559bf07f580818225bb7c3cf39b30f15d0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2e3ed8559bf07f580818225bb7c3cf39b30f15d0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5485e820cd0554886af282265198c7433c64c7b9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5485e820cd0554886af282265198c7433c64c7b9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5485e820cd0554886af282265198c7433c64c7b9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5485e820cd0554886af282265198c7433c64c7b9/comments", "author": null, "committer": null, "parents": [{"sha": "1a7febe9432f5302620aebc9cb5760c6c1d31d4c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a7febe9432f5302620aebc9cb5760c6c1d31d4c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1a7febe9432f5302620aebc9cb5760c6c1d31d4c"}], "stats": {"total": 59, "additions": 33, "deletions": 26}, "files": [{"sha": "9f9b13ec2ab6b1d8152d9388ef7cdb1d6a5a78d3", "filename": "gcc/testsuite/gcc.target/powerpc/ppc-eq0-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5485e820cd0554886af282265198c7433c64c7b9/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fppc-eq0-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5485e820cd0554886af282265198c7433c64c7b9/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fppc-eq0-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fppc-eq0-1.c?ref=5485e820cd0554886af282265198c7433c64c7b9", "patch": "@@ -7,4 +7,4 @@ int foo(int x)\n   return x == 0;\n }\n \n-/* { dg-final { scan-assembler \"cntlzw|isel\" } } */\n+/* { dg-final { scan-assembler {\\m(cntlzw|isel|setbc)\\M} } } */"}, {"sha": "27ed38f040ad3a9cf58efb618382d0e5ff2a4582", "filename": "gcc/testsuite/gcc.target/powerpc/ppc-ne0-1.c", "status": "modified", "additions": 5, "deletions": 25, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5485e820cd0554886af282265198c7433c64c7b9/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fppc-ne0-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5485e820cd0554886af282265198c7433c64c7b9/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fppc-ne0-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fppc-ne0-1.c?ref=5485e820cd0554886af282265198c7433c64c7b9", "patch": "@@ -1,33 +1,13 @@\n /* PR target/51274 */\n /* { dg-do compile } */\n-/* { dg-options \"-O2 -mno-isel\" } */\n+/* { dg-options \"-O2\" } */\n \n-/* { dg-final { scan-assembler-times \"addic\" 4 } } */\n-/* { dg-final { scan-assembler-times \"subfe\" 1 } } */\n-/* { dg-final { scan-assembler-times \"addze\" 3 } } */\n+/* { dg-final { scan-assembler-times {\\mcmp[wd]i\\M} 1 { target {   has_arch_pwr10 } } } } */\n+/* { dg-final { scan-assembler-times {\\msetbcr\\M}   1 { target {   has_arch_pwr10 } } } } */\n+/* { dg-final { scan-assembler-times {\\maddic\\M}    1 { target { ! has_arch_pwr10 } } } } */\n+/* { dg-final { scan-assembler-times {\\msubfe\\M}    1 { target { ! has_arch_pwr10 } } } } */\n \n long ne0(long a)\n {\n   return a != 0;\n }\n-\n-long plus_ne0(long a, long b)\n-{\n-  return (a != 0) + b;\n-}\n-\n-void dummy(void);\n-\n-void cmp_plus_ne0(long a, long b)\n-{\n-  if ((a != 0) + b)\n-    dummy();\n-}\n-\n-long plus_ne0_cmp(long a, long b)\n-{\n-  a = (a != 0) + b;\n-  if (a)\n-    dummy();\n-  return a;\n-}"}, {"sha": "9b0b025fe2b9dc3e4e51fd57a0742a71c0ae50ab", "filename": "gcc/testsuite/gcc.target/powerpc/ppc-ne0-2.c", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5485e820cd0554886af282265198c7433c64c7b9/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fppc-ne0-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5485e820cd0554886af282265198c7433c64c7b9/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fppc-ne0-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fppc-ne0-2.c?ref=5485e820cd0554886af282265198c7433c64c7b9", "patch": "@@ -0,0 +1,27 @@\n+/* PR target/51274 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2\" } */\n+\n+/* { dg-final { scan-assembler-times {\\maddic\\M} 3 } } */\n+/* { dg-final { scan-assembler-times {\\maddze\\M} 3 } } */\n+\n+long plus_ne0(long a, long b)\n+{\n+  return (a != 0) + b;\n+}\n+\n+void dummy(void);\n+\n+void cmp_plus_ne0(long a, long b)\n+{\n+  if ((a != 0) + b)\n+    dummy();\n+}\n+\n+long plus_ne0_cmp(long a, long b)\n+{\n+  a = (a != 0) + b;\n+  if (a)\n+    dummy();\n+  return a;\n+}"}]}