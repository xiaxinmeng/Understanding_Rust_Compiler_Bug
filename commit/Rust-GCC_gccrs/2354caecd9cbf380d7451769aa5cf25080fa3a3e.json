{"sha": "2354caecd9cbf380d7451769aa5cf25080fa3a3e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjM1NGNhZWNkOWNiZjM4MGQ3NDUxNzY5YWE1Y2YyNTA4MGZhM2EzZQ==", "commit": {"author": {"name": "Ilya Verbin", "email": "ilya.verbin@intel.com", "date": "2014-12-10T20:52:10Z"}, "committer": {"name": "Ilya Verbin", "email": "iverbin@gcc.gnu.org", "date": "2014-12-10T20:52:10Z"}, "message": "Force output of vars with \"omp declare target\" attribute in gcc/varpool.c\n\ngcc/\n\t* varpool.c (varpool_node::get_create): Force output of vars with\n\t\"omp declare target\" attribute.\nlibgomp/\n\t* testsuite/libgomp.c/target-9.c: New test.\n\nFrom-SVN: r218607", "tree": {"sha": "8841eb668cfea73c85c62faccb4a57c31e68a65a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8841eb668cfea73c85c62faccb4a57c31e68a65a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2354caecd9cbf380d7451769aa5cf25080fa3a3e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2354caecd9cbf380d7451769aa5cf25080fa3a3e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2354caecd9cbf380d7451769aa5cf25080fa3a3e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2354caecd9cbf380d7451769aa5cf25080fa3a3e/comments", "author": null, "committer": null, "parents": [{"sha": "c44f74e4cb760a204865655d2abc80276d7b6c4e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c44f74e4cb760a204865655d2abc80276d7b6c4e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c44f74e4cb760a204865655d2abc80276d7b6c4e"}], "stats": {"total": 47, "additions": 47, "deletions": 0}, "files": [{"sha": "6befea5041c4c632b43afb1e9845690ae4ed1d97", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2354caecd9cbf380d7451769aa5cf25080fa3a3e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2354caecd9cbf380d7451769aa5cf25080fa3a3e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2354caecd9cbf380d7451769aa5cf25080fa3a3e", "patch": "@@ -1,3 +1,8 @@\n+2014-12-10  Ilya Verbin  <ilya.verbin@intel.com>\n+\n+\t* varpool.c (varpool_node::get_create): Force output of vars with\n+\t\"omp declare target\" attribute.\n+\n 2014-12-10  Marc Glisse  <marc.glisse@inria.fr>\n \n \t* real.h (HONOR_NANS): Replace macro with 3 overloaded declarations."}, {"sha": "db28c2acd90cb1a82596c760b0f97a7834370960", "filename": "gcc/varpool.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2354caecd9cbf380d7451769aa5cf25080fa3a3e/gcc%2Fvarpool.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2354caecd9cbf380d7451769aa5cf25080fa3a3e/gcc%2Fvarpool.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarpool.c?ref=2354caecd9cbf380d7451769aa5cf25080fa3a3e", "patch": "@@ -175,6 +175,7 @@ varpool_node::get_create (tree decl)\n       g->have_offload = true;\n       if (!in_lto_p)\n \tvec_safe_push (offload_vars, decl);\n+      node->force_output = 1;\n #endif\n     }\n "}, {"sha": "8d8b8d8d6ec215c39d7de181a04fdd42d231a468", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2354caecd9cbf380d7451769aa5cf25080fa3a3e/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2354caecd9cbf380d7451769aa5cf25080fa3a3e/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=2354caecd9cbf380d7451769aa5cf25080fa3a3e", "patch": "@@ -1,3 +1,7 @@\n+2014-12-10  Ilya Verbin  <ilya.verbin@intel.com>\n+\n+\t* testsuite/libgomp.c/target-9.c: New test.\n+\n 2014-12-09  Varvara Rainchik  <varvara.rainchik@intel.com>\n \n \t* config.h.in: Regenerate."}, {"sha": "00fe0cb170298fb0d9b975093991eede77a9bc31", "filename": "libgomp/testsuite/libgomp.c/target-9.c", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2354caecd9cbf380d7451769aa5cf25080fa3a3e/libgomp%2Ftestsuite%2Flibgomp.c%2Ftarget-9.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2354caecd9cbf380d7451769aa5cf25080fa3a3e/libgomp%2Ftestsuite%2Flibgomp.c%2Ftarget-9.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2Ftarget-9.c?ref=2354caecd9cbf380d7451769aa5cf25080fa3a3e", "patch": "@@ -0,0 +1,37 @@\n+/* { dg-do run } */\n+/* { dg-options \"-O1\" } */\n+/* { dg-additional-options \"-flto\" { target lto } } */\n+\n+#include <stdlib.h>\n+\n+#define N 123456\n+\n+#pragma omp declare target\n+int X, Y;\n+#pragma omp end declare target\n+\n+void\n+foo ()\n+{\n+  #pragma omp target map(alloc: X)\n+    X = N;\n+}\n+\n+int\n+main ()\n+{\n+  int res;\n+\n+  foo ();\n+\n+  #pragma omp target map(alloc: X, Y) map(from: res)\n+    {\n+      Y = N;\n+      res = X + Y;\n+    }\n+\n+  if (res != N + N)\n+    abort ();\n+\n+  return 0;\n+}"}]}