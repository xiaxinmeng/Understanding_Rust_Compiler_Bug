{"sha": "11e1ee1b38f0d3a825b0cb70122cb345636b0534", "node_id": "C_kwDOANBUbNoAKDExZTFlZTFiMzhmMGQzYTgyNWIwY2I3MDEyMmNiMzQ1NjM2YjA1MzQ", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-05-26T14:44:08Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-05-26T21:29:04Z"}, "message": "libstdc++: Fix atomic and error_code printers for versioned namespace\n\nThis fixes the printers to work with std::__8::atomic and\nstd::__v8::ios_errc and std::__v8::future_errc.\n\nlibstdc++-v3/ChangeLog:\n\n\t* python/libstdcxx/v6/printers.py (StdErrorCodePrinter): Make\n\tlookup for ios_errc and future_errc check versioned namespace.\n\t(StdAtomicPrinter): Strip versioned namespace from typename.", "tree": {"sha": "8ad43a4cdab30c67440c73cfc8c1959bf029ca1c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8ad43a4cdab30c67440c73cfc8c1959bf029ca1c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/11e1ee1b38f0d3a825b0cb70122cb345636b0534", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/11e1ee1b38f0d3a825b0cb70122cb345636b0534", "html_url": "https://github.com/Rust-GCC/gccrs/commit/11e1ee1b38f0d3a825b0cb70122cb345636b0534", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/11e1ee1b38f0d3a825b0cb70122cb345636b0534/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ae3ea143ef4222707ce751f89f7b45d8f913caf3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae3ea143ef4222707ce751f89f7b45d8f913caf3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ae3ea143ef4222707ce751f89f7b45d8f913caf3"}], "stats": {"total": 15, "additions": 12, "deletions": 3}, "files": [{"sha": "17c33c1e54f2460f93ef7699e898981c4ca299ab", "filename": "libstdc++-v3/python/libstdcxx/v6/printers.py", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/11e1ee1b38f0d3a825b0cb70122cb345636b0534/libstdc%2B%2B-v3%2Fpython%2Flibstdcxx%2Fv6%2Fprinters.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/11e1ee1b38f0d3a825b0cb70122cb345636b0534/libstdc%2B%2B-v3%2Fpython%2Flibstdcxx%2Fv6%2Fprinters.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fpython%2Flibstdcxx%2Fv6%2Fprinters.py?ref=11e1ee1b38f0d3a825b0cb70122cb345636b0534", "patch": "@@ -1551,6 +1551,15 @@ def _find_errc_enum(name):\n             return typ\n         return None\n \n+    @classmethod\n+    def _find_standard_errc_enum(cls, name):\n+        for ns in ['', _versioned_namespace]:\n+            try:\n+                qname = 'std::{}{}'.format(ns, name)\n+                return cls._find_errc_enum(qname)\n+            except RuntimeError:\n+                pass\n+\n     @classmethod\n     def _match_net_ts_category(cls, cat):\n         net_cats = ['stream', 'socket', 'ip::resolver']\n@@ -1592,10 +1601,10 @@ def _category_info(cls, cat):\n             is_errno = cls._system_is_posix\n         if typ.tag.endswith('::future_error_category'):\n             name = 'future'\n-            enum = cls._find_errc_enum('std::future_errc')\n+            enum = cls._find_standard_errc_enum('future_errc')\n         if typ.tag.endswith('::io_error_category'):\n             name = 'io'\n-            enum = cls._find_errc_enum('std::io_errc')\n+            enum = cls._find_standard_errc_enum('io_errc')\n \n         if name is None:\n             try:\n@@ -1725,7 +1734,7 @@ class StdAtomicPrinter:\n     \"Print a std:atomic\"\n \n     def __init__(self, typename, val):\n-        self.typename = typename\n+        self.typename = strip_versioned_namespace(typename)\n         self.val = val\n         self.shptr_printer = None\n         self.value_type = self.val.type.template_argument(0)"}]}