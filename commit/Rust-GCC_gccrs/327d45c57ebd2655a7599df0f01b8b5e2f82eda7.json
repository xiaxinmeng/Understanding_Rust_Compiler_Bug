{"sha": "327d45c57ebd2655a7599df0f01b8b5e2f82eda7", "node_id": "C_kwDOANBUbNoAKDMyN2Q0NWM1N2ViZDI2NTVhNzU5OWRmMGYwMWI4YjVlMmY4MmVkYTc", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2023-01-24T21:26:50Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2023-01-24T22:11:52Z"}, "message": "c++: \"\" #pragma at BOF [PR108504]\n\nSince r11-2095 we pass flags to cp_lexer_get_preprocessor_token, and\ncp_lexer_new_main passes C_LEX_STRING_NO_JOIN when lexing most of the\ntranslation unit, but doesn't do that for the very first token; as a\nresult, if the first token is a string literal, we try to join strings and\nget confused if that encounters a pragma.\n\n\tPR c++/108504\n\ngcc/cp/ChangeLog:\n\n\t* parser.cc (cp_lexer_new_main): Pass C_LEX_STRING_NO_JOIN for first\n\ttoken, too.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/ext/pragma1.C: New test.", "tree": {"sha": "ce23762b7478d06501080542a32993cedba14177", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ce23762b7478d06501080542a32993cedba14177"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/327d45c57ebd2655a7599df0f01b8b5e2f82eda7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/327d45c57ebd2655a7599df0f01b8b5e2f82eda7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/327d45c57ebd2655a7599df0f01b8b5e2f82eda7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/327d45c57ebd2655a7599df0f01b8b5e2f82eda7/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "39ade88fa1632c659c5c4ed065fa2b62d16a8670", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39ade88fa1632c659c5c4ed065fa2b62d16a8670", "html_url": "https://github.com/Rust-GCC/gccrs/commit/39ade88fa1632c659c5c4ed065fa2b62d16a8670"}], "stats": {"total": 6, "additions": 5, "deletions": 1}, "files": [{"sha": "07ec0e1449120011a10517be53adb4689a973843", "filename": "gcc/cp/parser.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/327d45c57ebd2655a7599df0f01b8b5e2f82eda7/gcc%2Fcp%2Fparser.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/327d45c57ebd2655a7599df0f01b8b5e2f82eda7/gcc%2Fcp%2Fparser.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.cc?ref=327d45c57ebd2655a7599df0f01b8b5e2f82eda7", "patch": "@@ -705,7 +705,7 @@ cp_lexer_new_main (void)\n   /* It's possible that parsing the first pragma will load a PCH file,\n      which is a GC collection point.  So we have to do that before\n      allocating any memory.  */\n-  cp_lexer_get_preprocessor_token (0, &token);\n+  cp_lexer_get_preprocessor_token (C_LEX_STRING_NO_JOIN, &token);\n   cp_parser_initial_pragma (&token);\n   c_common_no_more_pch ();\n "}, {"sha": "bb258dac9a749c458a9b69e50c13aff6b3956a97", "filename": "gcc/testsuite/g++.dg/ext/pragma1.C", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/327d45c57ebd2655a7599df0f01b8b5e2f82eda7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fpragma1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/327d45c57ebd2655a7599df0f01b8b5e2f82eda7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fpragma1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fpragma1.C?ref=327d45c57ebd2655a7599df0f01b8b5e2f82eda7", "patch": "@@ -0,0 +1,4 @@\n+// PR c++/108504\n+\n+\"1\"\t\t\t\t// { dg-error \"\" }\n+#pragma GCC diagnostic push"}]}