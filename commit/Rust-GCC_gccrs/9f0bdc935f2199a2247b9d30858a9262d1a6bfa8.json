{"sha": "9f0bdc935f2199a2247b9d30858a9262d1a6bfa8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWYwYmRjOTM1ZjIxOTlhMjI0N2I5ZDMwODU4YTkyNjJkMWE2YmZhOA==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2013-05-20T17:01:09Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2013-05-20T17:01:09Z"}, "message": "re PR c++/57325 (ICE in strip_typedefs, at cp/tree.c:1306)\n\n\tPR c++/57325\n\t* tree.c (build_cplus_array_type): Copy layout info if element\n\ttype is complete.\n\nFrom-SVN: r199113", "tree": {"sha": "29e63f39501d7b153fe603378cbc7d205bbf7167", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/29e63f39501d7b153fe603378cbc7d205bbf7167"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9f0bdc935f2199a2247b9d30858a9262d1a6bfa8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f0bdc935f2199a2247b9d30858a9262d1a6bfa8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9f0bdc935f2199a2247b9d30858a9262d1a6bfa8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f0bdc935f2199a2247b9d30858a9262d1a6bfa8/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "14c2ec26e2d1232b88906927355517d34ffdbab6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/14c2ec26e2d1232b88906927355517d34ffdbab6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/14c2ec26e2d1232b88906927355517d34ffdbab6"}], "stats": {"total": 52, "additions": 50, "deletions": 2}, "files": [{"sha": "5ea7a27625a93b1b90d54b37fad67121b0e0d9e2", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f0bdc935f2199a2247b9d30858a9262d1a6bfa8/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f0bdc935f2199a2247b9d30858a9262d1a6bfa8/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=9f0bdc935f2199a2247b9d30858a9262d1a6bfa8", "patch": "@@ -1,3 +1,9 @@\n+2013-05-20  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/57325\n+\t* tree.c (build_cplus_array_type): Copy layout info if element\n+\ttype is complete.\n+\n 2013-05-20  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/23608"}, {"sha": "9c324e34b31644c8ab7d9d20a74e4bcdc2afef7a", "filename": "gcc/cp/tree.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f0bdc935f2199a2247b9d30858a9262d1a6bfa8/gcc%2Fcp%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f0bdc935f2199a2247b9d30858a9262d1a6bfa8/gcc%2Fcp%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftree.c?ref=9f0bdc935f2199a2247b9d30858a9262d1a6bfa8", "patch": "@@ -829,10 +829,12 @@ build_cplus_array_type (tree elt_type, tree index_type)\n \n       if (TYPE_MAIN_VARIANT (t) != m)\n \t{\n-\t  if (COMPLETE_TYPE_P (t) && !COMPLETE_TYPE_P (m))\n+\t  if (COMPLETE_TYPE_P (TREE_TYPE (t)) && !COMPLETE_TYPE_P (m))\n \t    {\n \t      /* m was built before the element type was complete, so we\n-\t\t also need to copy the layout info from t.  */\n+\t\t also need to copy the layout info from t.  We might\n+\t         end up doing this multiple times if t is an array of\n+\t         unknown bound.  */\n \t      tree size = TYPE_SIZE (t);\n \t      tree size_unit = TYPE_SIZE_UNIT (t);\n \t      unsigned int align = TYPE_ALIGN (t);"}, {"sha": "6692071694db628a80e39c4be555c35c1939f07f", "filename": "gcc/testsuite/g++.dg/template/array26.C", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f0bdc935f2199a2247b9d30858a9262d1a6bfa8/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Farray26.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f0bdc935f2199a2247b9d30858a9262d1a6bfa8/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Farray26.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Farray26.C?ref=9f0bdc935f2199a2247b9d30858a9262d1a6bfa8", "patch": "@@ -0,0 +1,40 @@\n+// PR c++/57325\n+\n+class valarray { int _M_data; };\n+template < typename > struct SimpleJet { valarray partials; };\n+\n+template < class C > struct scoped_ptr_impl\n+{\n+    scoped_ptr_impl (C *):data_ () { }\n+    struct Data\n+    {\n+        C ptr;\n+    };\n+    Data data_;\n+};\n+\n+template < class, class = int >struct scoped_ptr;\n+template < class C, class D > struct scoped_ptr <C[], D >\n+{\n+    scoped_ptr ():impl_ (0) { }\n+    scoped_ptr_impl < C > impl_;\n+};\n+\n+template < typename JetsT > void\n+TestJets (JetsT *)\n+{\n+    typedef typename JetsT::JetType JetT;\n+    scoped_ptr < JetT[] > a;\n+}\n+\n+template < typename T > struct SimpleJets\n+{\n+    typedef SimpleJet < T > JetType;\n+    scoped_ptr < SimpleJet < T >[] > vars_;\n+};\n+\n+void fn ()\n+{\n+    SimpleJets < double >b;\n+    TestJets (&b);\n+}"}]}