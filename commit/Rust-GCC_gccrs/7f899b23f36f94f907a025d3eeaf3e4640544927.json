{"sha": "7f899b23f36f94f907a025d3eeaf3e4640544927", "node_id": "C_kwDOANBUbNoAKDdmODk5YjIzZjM2Zjk0ZjkwN2EwMjVkM2VlYWYzZTQ2NDA1NDQ5Mjc", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2021-10-27T08:59:27Z"}, "committer": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2021-10-27T08:59:27Z"}, "message": "Fortran: Fix 'select rank' for allocatables/pointers\n\ngcc/fortran/ChangeLog:\n\n\t* trans-stmt.c (gfc_trans_select_rank_cases): Fix condition\n\tfor allocatables/pointers.\n\ngcc/testsuite/ChangeLog:\n\n\t* gfortran.dg/PR93963.f90: Extend testcase by scan-tree-dump test.", "tree": {"sha": "c27dda6573c88324d1556d89b80255f005a1a66b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c27dda6573c88324d1556d89b80255f005a1a66b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7f899b23f36f94f907a025d3eeaf3e4640544927", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f899b23f36f94f907a025d3eeaf3e4640544927", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f899b23f36f94f907a025d3eeaf3e4640544927", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f899b23f36f94f907a025d3eeaf3e4640544927/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4f1fe0dc25391a1d73c1034a85b3b6bf04c5e26e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f1fe0dc25391a1d73c1034a85b3b6bf04c5e26e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f1fe0dc25391a1d73c1034a85b3b6bf04c5e26e"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "eaf2cc25f214e59e1d6aa7e9fe6a450cb9020327", "filename": "gcc/fortran/trans-stmt.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f899b23f36f94f907a025d3eeaf3e4640544927/gcc%2Ffortran%2Ftrans-stmt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f899b23f36f94f907a025d3eeaf3e4640544927/gcc%2Ffortran%2Ftrans-stmt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-stmt.c?ref=7f899b23f36f94f907a025d3eeaf3e4640544927", "patch": "@@ -3685,7 +3685,7 @@ gfc_trans_select_rank_cases (gfc_code * code)\n   rank = gfc_conv_descriptor_rank (se.expr);\n   rank = gfc_evaluate_now (rank, &block);\n   symbol_attribute attr = gfc_expr_attr (code->expr1);\n-  if (!attr.pointer || !attr.allocatable)\n+  if (!attr.pointer && !attr.allocatable)\n     {\n       /* Special case for assumed-rank ('rank(*)', internally -1):\n \t rank = (rank == 0 || ubound[rank-1] != -1) ? rank : -1.  */"}, {"sha": "6769d7fe061049456291e46b6517e74d92a5cdd0", "filename": "gcc/testsuite/gfortran.dg/PR93963.f90", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f899b23f36f94f907a025d3eeaf3e4640544927/gcc%2Ftestsuite%2Fgfortran.dg%2FPR93963.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f899b23f36f94f907a025d3eeaf3e4640544927/gcc%2Ftestsuite%2Fgfortran.dg%2FPR93963.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2FPR93963.f90?ref=7f899b23f36f94f907a025d3eeaf3e4640544927", "patch": "@@ -1,4 +1,5 @@\n ! { dg-do run }\n+! { dg-additional-options \"-fdump-tree-original\" }\n !\n ! Test the fix for PR93963\n !\n@@ -190,3 +191,7 @@ program selr_p\n   deallocate(inta)\n \n end program selr_p\n+\n+! Special code for assumed rank - but only if not allocatable/pointer\n+! Thus, expect it only once for subroutine rank_o but not for rank_a or rank_p\n+! { dg-final { scan-tree-dump-times \"ubound != -1\" 1 \"original\" } }"}]}