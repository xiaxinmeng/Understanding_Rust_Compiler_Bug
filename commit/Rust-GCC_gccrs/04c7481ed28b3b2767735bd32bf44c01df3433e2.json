{"sha": "04c7481ed28b3b2767735bd32bf44c01df3433e2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDRjNzQ4MWVkMjhiM2IyNzY3NzM1YmQzMmJmNDRjMDFkZjM0MzNlMg==", "commit": {"author": {"name": "Benjamin Kosnik", "email": "bkoz@redhat.com", "date": "2002-11-01T05:38:27Z"}, "committer": {"name": "Benjamin Kosnik", "email": "bkoz@gcc.gnu.org", "date": "2002-11-01T05:38:27Z"}, "message": "re PR libstdc++/8348 (fail() flag is set in istringstream when eof() flag is set !)\n\n\n2002-10-31  Benjamin Kosnik  <bkoz@redhat.com>\n\n\tPR libstdc++/8348\n\t* include/bits/istream.tcc (istream::tellg): Remove sentry bits.\n\t(istream::seekg): Same.\n\t* testsuite/27_io/istream_seeks.cc (test06): New.\n\nFrom-SVN: r58703", "tree": {"sha": "5300fc4a8ade525eb2191e63aa079db2cc2b894e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5300fc4a8ade525eb2191e63aa079db2cc2b894e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/04c7481ed28b3b2767735bd32bf44c01df3433e2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04c7481ed28b3b2767735bd32bf44c01df3433e2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/04c7481ed28b3b2767735bd32bf44c01df3433e2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04c7481ed28b3b2767735bd32bf44c01df3433e2/comments", "author": null, "committer": null, "parents": [{"sha": "5e81d5beff4813ceaa0133f1b272a38df8e9115a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e81d5beff4813ceaa0133f1b272a38df8e9115a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5e81d5beff4813ceaa0133f1b272a38df8e9115a"}], "stats": {"total": 125, "additions": 63, "deletions": 62}, "files": [{"sha": "3a2ee83669cafe47b2143c117fedcb0cc57b653a", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04c7481ed28b3b2767735bd32bf44c01df3433e2/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04c7481ed28b3b2767735bd32bf44c01df3433e2/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=04c7481ed28b3b2767735bd32bf44c01df3433e2", "patch": "@@ -1,3 +1,10 @@\n+2002-10-31  Benjamin Kosnik  <bkoz@redhat.com>\n+\n+\tPR libstdc++/8348\n+\t* include/bits/istream.tcc (istream::tellg): Remove sentry bits.\n+\t(istream::seekg): Same.\n+\t* testsuite/27_io/istream_seeks.cc (test06): New.\n+\t\n 2002-10-28  Jason Thorpe  <thorpej@wasabisystems.com>\n \n \t* testsuite/thread/pthread5.cc: Include <unistd.h>"}, {"sha": "617110d953b8f4c804c2f7159ca64f3939724089", "filename": "libstdc++-v3/include/bits/istream.tcc", "status": "modified", "additions": 11, "deletions": 50, "changes": 61, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04c7481ed28b3b2767735bd32bf44c01df3433e2/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fistream.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04c7481ed28b3b2767735bd32bf44c01df3433e2/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fistream.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fistream.tcc?ref=04c7481ed28b3b2767735bd32bf44c01df3433e2", "patch": "@@ -935,23 +935,8 @@ namespace std\n     tellg(void)\n     {\n       pos_type __ret = pos_type(-1);\n-      _M_gcount = 0;\n-      sentry __cerb(*this, true);\n-      if (__cerb) \n-\t{\n-\t  try \n-\t    {\n-\t     __ret = this->rdbuf()->pubseekoff(0, ios_base::cur, ios_base::in);\n-\t    }\n-\t  catch(exception& __fail)\n-\t    {\n-\t      // 27.6.1.3 paragraph 1\n-\t      // Turn this on without causing an ios::failure to be thrown.\n-\t      this->setstate(ios_base::badbit);\n-\t      if ((this->exceptions() & ios_base::badbit) != 0)\n-\t\t__throw_exception_again;\n-\t    }\n-\t}\n+      if (!this->fail())\n+\t__ret = this->rdbuf()->pubseekoff(0, ios_base::cur, ios_base::in);\n       return __ret;\n     }\n \n@@ -962,28 +947,16 @@ namespace std\n     seekg(pos_type __pos)\n     {\n       _M_gcount = 0;\n-      sentry __cerb(*this, true);\n-      if (__cerb) \n+      if (!this->fail())\n \t{\n-\t  try \n-\t    {\n #ifdef _GLIBCPP_RESOLVE_LIB_DEFECTS\n // 136.  seekp, seekg setting wrong streams?\n-\t      pos_type __err = this->rdbuf()->pubseekpos(__pos, ios_base::in);\n+\t  pos_type __err = this->rdbuf()->pubseekpos(__pos, ios_base::in);\n \n // 129. Need error indication from seekp() and seekg()\n-\t      if (__err == pos_type(off_type(-1)))\n-\t\tthis->setstate(ios_base::failbit);\n+\t  if (__err == pos_type(off_type(-1)))\n+\t    this->setstate(ios_base::failbit);\n #endif\n-\t    }\n-\t  catch(exception& __fail)\n-\t    {\n-\t      // 27.6.1.3 paragraph 1\n-\t      // Turn this on without causing an ios::failure to be thrown.\n-\t      this->setstate(ios_base::badbit);\n-\t      if ((this->exceptions() & ios_base::badbit) != 0)\n-\t\t__throw_exception_again;\n-\t    }\n \t}\n       return *this;\n     }\n@@ -994,29 +967,17 @@ namespace std\n     seekg(off_type __off, ios_base::seekdir __dir)\n     {\n       _M_gcount = 0;\n-      sentry __cerb(*this, true);\n-      if (__cerb) \n+      if (!this->fail())\n \t{\n-\t  try \n-\t    {\n #ifdef _GLIBCPP_RESOLVE_LIB_DEFECTS\n // 136.  seekp, seekg setting wrong streams?\n-\t      pos_type __err = this->rdbuf()->pubseekoff(__off, __dir, \n-\t\t\t\t\t\t\t ios_base::in);\n+\t  pos_type __err = this->rdbuf()->pubseekoff(__off, __dir, \n+\t\t\t\t\t\t     ios_base::in);\n \n // 129. Need error indication from seekp() and seekg()\n-\t      if (__err == pos_type(off_type(-1)))\n-\t\tthis->setstate(ios_base::failbit);\n+\t  if (__err == pos_type(off_type(-1)))\n+\t    this->setstate(ios_base::failbit);\n #endif\n-\t    }\n-\t  catch(exception& __fail)\n-\t    {\n-\t      // 27.6.1.3 paragraph 1\n-\t      // Turn this on without causing an ios::failure to be thrown.\n-\t      this->setstate(ios_base::badbit);\n-\t      if ((this->exceptions() & ios_base::badbit) != 0)\n-\t\t__throw_exception_again;\n-\t    }\n \t}\n       return *this;\n     }"}, {"sha": "892e10bcb1ee61cf7a7388cb850643fc9fa333bc", "filename": "libstdc++-v3/testsuite/27_io/istream_seeks.cc", "status": "modified", "additions": 45, "deletions": 12, "changes": 57, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04c7481ed28b3b2767735bd32bf44c01df3433e2/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Fistream_seeks.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04c7481ed28b3b2767735bd32bf44c01df3433e2/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Fistream_seeks.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Fistream_seeks.cc?ref=04c7481ed28b3b2767735bd32bf44c01df3433e2", "patch": "@@ -55,11 +55,6 @@ bool test01()\n   p4 = ifs2.tellg();\n \n   VERIFY( p3 == p4 );\n-\n-#ifdef DEBUG_ASSERT\n-  assert(test);\n-#endif\n-\n   return test;\n }\n \n@@ -237,10 +232,6 @@ void test04(void)\n   if01.peek();\n   pos02 = if01.tellg();\n   VERIFY( pos02 == pos01 );\n-\n-#ifdef DEBUG_ASSERT\n-  assert(test);\n-#endif\n }\n \n // stringstreams\n@@ -351,10 +342,50 @@ void test05(void)\n   VERIFY( state01 == state02 );\n   pos06 = is03.tellg(); \n   VERIFY( pos05 == pos06 ); \n+}\n \n-#ifdef DEBUG_ASSERT\n-  assert(test);\n-#endif\n+// libstdc++/8348\n+void test06(void)\n+{\n+  using namespace std;\n+  bool test = true;\n+  string num1(\"555\");\n+\n+  // tellg\n+  {\n+    istringstream iss(num1);\n+    istream::pos_type pos1 = iss.tellg();\n+    int asNum = 0;\n+    iss >> asNum;\n+    VERIFY( test = iss.eof() );\n+    VERIFY( test = !iss.fail() );\n+    iss.tellg();\n+    VERIFY( test = !iss.fail() );\n+  }\n+\n+  // seekg\n+  {\n+    istringstream iss(num1);\n+    istream::pos_type pos1 = iss.tellg();\n+    int asNum = 0;\n+    iss >> asNum;\n+    VERIFY( test = iss.eof() );\n+    VERIFY( test = !iss.fail() );\n+    iss.seekg(0, ios_base::beg);\n+    VERIFY( test = !iss.fail() );\n+  }\n+\n+  // seekg\n+  {\n+    istringstream iss(num1);\n+    istream::pos_type pos1 = iss.tellg();\n+    int asNum = 0;\n+    iss >> asNum;\n+    VERIFY( test = iss.eof() );\n+    VERIFY( test = !iss.fail() );\n+    iss.seekg(pos1);\n+    VERIFY( test = !iss.fail() );\n+  }\n }\n \n int main()\n@@ -366,6 +397,8 @@ int main()\n \n   test04();\n   test05();\n+\n+  test06();\n   return 0;\n }\n "}]}