{"sha": "4bd5f767e6f29e585f7dc048889baf1ec33357b2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGJkNWY3NjdlNmYyOWU1ODVmN2RjMDQ4ODg5YmFmMWVjMzMzNTdiMg==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2015-03-01T01:10:32Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2015-03-01T01:10:32Z"}, "message": "ipa-icf-gimple.c (func_checker::compare_operand): Fix handling of OBJ_TYPE_REF.\n\n\t* ipa-icf-gimple.c (func_checker::compare_operand): Fix handling\n\tof OBJ_TYPE_REF.\n\nFrom-SVN: r221086", "tree": {"sha": "600fa254df54b044fbc358f14a92640ecd60f828", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/600fa254df54b044fbc358f14a92640ecd60f828"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4bd5f767e6f29e585f7dc048889baf1ec33357b2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4bd5f767e6f29e585f7dc048889baf1ec33357b2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4bd5f767e6f29e585f7dc048889baf1ec33357b2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4bd5f767e6f29e585f7dc048889baf1ec33357b2/comments", "author": null, "committer": null, "parents": [{"sha": "c7a06bc12629ce9c897e3cbf155a475eb7ac6375", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c7a06bc12629ce9c897e3cbf155a475eb7ac6375", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c7a06bc12629ce9c897e3cbf155a475eb7ac6375"}], "stats": {"total": 34, "additions": 22, "deletions": 12}, "files": [{"sha": "b47008e9750aa00afacec123e438d08660a75957", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4bd5f767e6f29e585f7dc048889baf1ec33357b2/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4bd5f767e6f29e585f7dc048889baf1ec33357b2/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4bd5f767e6f29e585f7dc048889baf1ec33357b2", "patch": "@@ -1,3 +1,8 @@\n+2015-02-28  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* ipa-icf-gimple.c (func_checker::compare_operand): Fix handling\n+\tof OBJ_TYPE_REF.\n+\n 2015-02-28  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* ipa-icf.c (sem_function::merge): Fix handling of COMDAT."}, {"sha": "18631730b69cbe4540a7de746bdd24c35b11e263", "filename": "gcc/ipa-icf-gimple.c", "status": "modified", "additions": 17, "deletions": 12, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4bd5f767e6f29e585f7dc048889baf1ec33357b2/gcc%2Fipa-icf-gimple.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4bd5f767e6f29e585f7dc048889baf1ec33357b2/gcc%2Fipa-icf-gimple.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-icf-gimple.c?ref=4bd5f767e6f29e585f7dc048889baf1ec33357b2", "patch": "@@ -448,18 +448,23 @@ func_checker::compare_operand (tree t1, tree t2)\n     /* Virtual table call.  */\n     case OBJ_TYPE_REF:\n       {\n-\tx1 = TREE_OPERAND (t1, 0);\n-\tx2 = TREE_OPERAND (t2, 0);\n-\ty1 = TREE_OPERAND (t1, 1);\n-\ty2 = TREE_OPERAND (t2, 1);\n-\tz1 = TREE_OPERAND (t1, 2);\n-\tz2 = TREE_OPERAND (t2, 2);\n-\n-\tret = compare_ssa_name (x1, x2)\n-\t      && compare_operand (y1, y2)\n-\t      && compare_cst_or_decl (z1, z2);\n-\n-\treturn return_with_debug (ret);\n+\tif (!compare_ssa_name (OBJ_TYPE_REF_EXPR (t1), OBJ_TYPE_REF_EXPR (t2)))\n+\t  return return_false ();\n+\tif (opt_for_fn (m_source_func_decl, flag_devirtualize)\n+\t    && virtual_method_call_p (t1))\n+\t  {\n+\t    if (tree_to_uhwi (OBJ_TYPE_REF_TOKEN (t1))\n+\t\t!= tree_to_uhwi (OBJ_TYPE_REF_TOKEN (t2)))\n+\t      return return_false_with_msg (\"OBJ_TYPE_REF token mismatch\");\n+\t    if (!types_same_for_odr (obj_type_ref_class (t1),\n+\t\t\t\t     obj_type_ref_class (t2)))\n+\t      return return_false_with_msg (\"OBJ_TYPE_REF OTR type mismatch\");\n+\t    if (!compare_ssa_name (OBJ_TYPE_REF_OBJECT (t1),\n+\t\t\t\t   OBJ_TYPE_REF_OBJECT (t2)))\n+\t      return return_false_with_msg (\"OBJ_TYPE_REF object mismatch\");\n+\t  }\n+\n+\treturn return_with_debug (true);\n       }\n     case IMAGPART_EXPR:\n     case REALPART_EXPR:"}]}