{"sha": "321e76fbf83720a7d88948d3e157ea9097e099ad", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzIxZTc2ZmJmODM3MjBhN2Q4ODk0OGQzZTE1N2VhOTA5N2UwOTlhZA==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2016-09-19T07:20:16Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2016-09-19T07:20:16Z"}, "message": "dwarf2out.c (early_dwarf_finished): New global.\n\n2016-09-16  Richard Biener  <rguenther@suse.de>\n\n\t* dwarf2out.c (early_dwarf_finished): New global.\n\t(set_early_dwarf::set_early_dwarf): Assert early_dwarf_finished\n\tis false.\n\t(dwarf2out_early_finish): Set early_dwarf_finished at the end,\n\tif called from LTO exit early.\n\t(dwarf2out_late_global_decl): When being during the early\n\tdebug phase do not add locations but only const value attributes.\n\tAdjust the way we generate early DIEs for LTO.\n\n\tlto/\n\t* lto.c (lto_main): Invoke early_finish debug hook.\n\nFrom-SVN: r240228", "tree": {"sha": "b2a2ed3d1067076874c7b9afa52e6cdfe3344e21", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b2a2ed3d1067076874c7b9afa52e6cdfe3344e21"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/321e76fbf83720a7d88948d3e157ea9097e099ad", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/321e76fbf83720a7d88948d3e157ea9097e099ad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/321e76fbf83720a7d88948d3e157ea9097e099ad", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/321e76fbf83720a7d88948d3e157ea9097e099ad/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ae5276392fb59dbdec56dd8cc6cc8253d9334c8b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae5276392fb59dbdec56dd8cc6cc8253d9334c8b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ae5276392fb59dbdec56dd8cc6cc8253d9334c8b"}], "stats": {"total": 63, "additions": 55, "deletions": 8}, "files": [{"sha": "2f3f91b4a03fa8b04ec22444393991b9f3998edb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/321e76fbf83720a7d88948d3e157ea9097e099ad/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/321e76fbf83720a7d88948d3e157ea9097e099ad/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=321e76fbf83720a7d88948d3e157ea9097e099ad", "patch": "@@ -1,3 +1,14 @@\n+2016-09-19  Richard Biener  <rguenther@suse.de>\n+\n+\t* dwarf2out.c (early_dwarf_finished): New global.\n+\t(set_early_dwarf::set_early_dwarf): Assert early_dwarf_finished\n+\tis false.\n+\t(dwarf2out_early_finish): Set early_dwarf_finished at the end,\n+\tif called from LTO exit early.\n+\t(dwarf2out_late_global_decl): When being during the early\n+\tdebug phase do not add locations but only const value attributes.\n+\tAdjust the way we generate early DIEs for LTO.\n+\n 2016-09-19  Richard Biener  <rguenther@suse.de>\n \n \tPR middle-end/77605"}, {"sha": "434a2fc8b5a669c94e6fc3f0c58f3d6a6adf631f", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 37, "deletions": 8, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/321e76fbf83720a7d88948d3e157ea9097e099ad/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/321e76fbf83720a7d88948d3e157ea9097e099ad/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=321e76fbf83720a7d88948d3e157ea9097e099ad", "patch": "@@ -2711,9 +2711,14 @@ die_node;\n \n /* Set to TRUE while dwarf2out_early_global_decl is running.  */\n static bool early_dwarf;\n+static bool early_dwarf_finished;\n struct set_early_dwarf {\n   bool saved;\n-  set_early_dwarf () : saved(early_dwarf) { early_dwarf = true; }\n+  set_early_dwarf () : saved(early_dwarf)\n+    {\n+      gcc_assert (! early_dwarf_finished);\n+      early_dwarf = true;\n+    }\n   ~set_early_dwarf () { early_dwarf = saved; }\n };\n \n@@ -23878,18 +23883,31 @@ dwarf2out_early_global_decl (tree decl)\n static void\n dwarf2out_late_global_decl (tree decl)\n {\n-  /* We have to generate early debug late for LTO.  */\n-  if (in_lto_p)\n-    dwarf2out_early_global_decl (decl);\n-\n-    /* Fill-in any location information we were unable to determine\n-       on the first pass.  */\n+  /* Fill-in any location information we were unable to determine\n+     on the first pass.  */\n   if (TREE_CODE (decl) == VAR_DECL\n       && !POINTER_BOUNDS_P (decl))\n     {\n       dw_die_ref die = lookup_decl_die (decl);\n+\n+      /* We have to generate early debug late for LTO.  */\n+      if (! die && in_lto_p)\n+\t{\n+\t  dwarf2out_decl (decl);\n+\t  die = lookup_decl_die (decl);\n+\t}\n+\n       if (die)\n-\tadd_location_or_const_value_attribute (die, decl, false);\n+\t{\n+\t  /* We get called during the early debug phase via the symtab\n+\t     code invoking late_global_decl for symbols that are optimized\n+\t     out.  When the early phase is not finished, do not add\n+\t     locations.  */\n+\t  if (! early_dwarf_finished)\n+\t    tree_add_const_value_attribute_for_decl (die, decl);\n+\t  else\n+\t    add_location_or_const_value_attribute (die, decl, false);\n+\t}\n     }\n }\n \n@@ -28137,6 +28155,14 @@ dwarf2out_early_finish (void)\n {\n   set_early_dwarf s;\n \n+  /* With LTO early dwarf was really finished at compile-time, so make\n+     sure to adjust the phase after annotating the LTRANS CU DIE.  */\n+  if (in_lto_p)\n+    {\n+      early_dwarf_finished = true;\n+      return;\n+    }\n+\n   /* Walk through the list of incomplete types again, trying once more to\n      emit full debugging info for them.  */\n   retry_incomplete_types ();\n@@ -28163,6 +28189,9 @@ dwarf2out_early_finish (void)\n \t}\n     }\n   deferred_asm_name = NULL;\n+\n+  /* The early debug phase is now finished.  */\n+  early_dwarf_finished = true;\n }\n \n /* Reset all state within dwarf2out.c so that we can rerun the compiler"}, {"sha": "c5bd7a07a6ea7d1c2f938d075ea7948fbff6e63a", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/321e76fbf83720a7d88948d3e157ea9097e099ad/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/321e76fbf83720a7d88948d3e157ea9097e099ad/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=321e76fbf83720a7d88948d3e157ea9097e099ad", "patch": "@@ -1,3 +1,7 @@\n+2016-09-19  Richard Biener  <rguenther@suse.de>\n+\n+\t* lto.c (lto_main): Invoke early_finish debug hook.\n+\n 2016-07-25  Richard Biener  <rguenther@suse.de>\n \n \t* lto.c (compare_tree_sccs_1): Remove streamer_handle_as_builtin_p uses."}, {"sha": "c94ed622307eae682d318befc42a5d7990dea716", "filename": "gcc/lto/lto.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/321e76fbf83720a7d88948d3e157ea9097e099ad/gcc%2Flto%2Flto.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/321e76fbf83720a7d88948d3e157ea9097e099ad/gcc%2Flto%2Flto.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto.c?ref=321e76fbf83720a7d88948d3e157ea9097e099ad", "patch": "@@ -3315,6 +3315,9 @@ lto_main (void)\n \t  if (!flag_ltrans)\n \t    lto_promote_statics_nonwpa ();\n \n+\t  /* Annotate the CU DIE and mark the early debug phase as finished.  */\n+\t  debug_hooks->early_finish ();\n+\n \t  /* Let the middle end know that we have read and merged all of\n \t     the input files.  */ \n \t  symtab->compile ();"}]}