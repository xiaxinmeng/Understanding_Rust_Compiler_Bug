{"sha": "4dae67e09042d48c5f330d540d5fdde5f51db656", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGRhZTY3ZTA5MDQyZDQ4YzVmMzMwZDU0MGQ1ZmRkZTVmNTFkYjY1Ng==", "commit": {"author": {"name": "Tim Shen", "email": "timshen91@gmail.com", "date": "2014-05-20T04:31:54Z"}, "committer": {"name": "Tim Shen", "email": "timshen@gcc.gnu.org", "date": "2014-05-20T04:31:54Z"}, "message": "re PR libstdc++/61227 ([C++11] Regex [\\w] does not work)\n\n2014-05-20  Tim Shen  <timshen91@gmail.com>\n\n\tPR libstdc++/61227\n\t* include/bits/regex_compiler.h\n\t(_BracketMatcher<>::_M_add_character_class): Add negative character\n\tclass support.\n\t* include/bits/regex_compiler.tcc (_BracketMatcher<>::_M_apply):\n\tLikewise.\n\t* testsuite/28_regex/algorithms/regex_match/ecma/char/quoted_char.cc:\n\tAdd more testcases.\n\nFrom-SVN: r210630", "tree": {"sha": "74895c6c4d3b7bd0cb06ef89d5dfe1ac83f3449f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/74895c6c4d3b7bd0cb06ef89d5dfe1ac83f3449f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4dae67e09042d48c5f330d540d5fdde5f51db656", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4dae67e09042d48c5f330d540d5fdde5f51db656", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4dae67e09042d48c5f330d540d5fdde5f51db656", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4dae67e09042d48c5f330d540d5fdde5f51db656/comments", "author": {"login": "timshen91", "id": 1157432, "node_id": "MDQ6VXNlcjExNTc0MzI=", "avatar_url": "https://avatars.githubusercontent.com/u/1157432?v=4", "gravatar_id": "", "url": "https://api.github.com/users/timshen91", "html_url": "https://github.com/timshen91", "followers_url": "https://api.github.com/users/timshen91/followers", "following_url": "https://api.github.com/users/timshen91/following{/other_user}", "gists_url": "https://api.github.com/users/timshen91/gists{/gist_id}", "starred_url": "https://api.github.com/users/timshen91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/timshen91/subscriptions", "organizations_url": "https://api.github.com/users/timshen91/orgs", "repos_url": "https://api.github.com/users/timshen91/repos", "events_url": "https://api.github.com/users/timshen91/events{/privacy}", "received_events_url": "https://api.github.com/users/timshen91/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b9b7e07c270c2788f8ee4dd63b48ec00cd5f75bc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b9b7e07c270c2788f8ee4dd63b48ec00cd5f75bc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b9b7e07c270c2788f8ee4dd63b48ec00cd5f75bc"}], "stats": {"total": 49, "additions": 44, "deletions": 5}, "files": [{"sha": "247af1264e2ebf54a6bdb9675a40be34694cd71a", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4dae67e09042d48c5f330d540d5fdde5f51db656/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4dae67e09042d48c5f330d540d5fdde5f51db656/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=4dae67e09042d48c5f330d540d5fdde5f51db656", "patch": "@@ -1,3 +1,14 @@\n+2014-05-20  Tim Shen  <timshen91@gmail.com>\n+\n+\tPR libstdc++/61227\n+\t* include/bits/regex_compiler.h\n+\t(_BracketMatcher<>::_M_add_character_class): Add negative character\n+\tclass support.\n+\t* include/bits/regex_compiler.tcc (_BracketMatcher<>::_M_apply):\n+\tLikewise.\n+\t* testsuite/28_regex/algorithms/regex_match/ecma/char/quoted_char.cc:\n+\tAdd more testcases.\n+\n 2014-05-19  Jonathan Wakely  <jwakely@redhat.com>\n \n \t* python/libstdcxx/v6/printers.py: Use Python3 raise syntax."}, {"sha": "52f7235c8dbbcc9fdb23aa85d3f1701e7524731c", "filename": "libstdc++-v3/include/bits/regex_compiler.h", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4dae67e09042d48c5f330d540d5fdde5f51db656/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_compiler.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4dae67e09042d48c5f330d540d5fdde5f51db656/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_compiler.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_compiler.h?ref=4dae67e09042d48c5f330d540d5fdde5f51db656", "patch": "@@ -369,15 +369,19 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n #endif\n       }\n \n+      // __neg should be true for \\D, \\S and \\W only.\n       void\n-      _M_add_character_class(const _StringT& __s)\n+      _M_add_character_class(const _StringT& __s, bool __neg)\n       {\n \tauto __mask = _M_traits.lookup_classname(__s.data(),\n \t\t\t\t\t\t __s.data() + __s.size(),\n \t\t\t\t\t\t __icase);\n \tif (__mask == 0)\n \t  __throw_regex_error(regex_constants::error_ctype);\n-\t_M_class_set |= __mask;\n+\tif (!__neg)\n+\t  _M_class_set |= __mask;\n+\telse\n+\t  _M_neg_class_set.push_back(__mask);\n #ifdef _GLIBCXX_DEBUG\n \t_M_is_ready = false;\n #endif\n@@ -387,7 +391,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       _M_make_range(_CharT __l, _CharT __r)\n       {\n \t_M_range_set.push_back(make_pair(_M_translator._M_transform(__l),\n-\t\t\t\t      _M_translator._M_transform(__r)));\n+\t\t\t\t\t _M_translator._M_transform(__r)));\n #ifdef _GLIBCXX_DEBUG\n \t_M_is_ready = false;\n #endif\n@@ -435,6 +439,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       std::vector<_CharT>                       _M_char_set;\n       std::vector<_StringT>                     _M_equiv_set;\n       std::vector<pair<_StrTransT, _StrTransT>> _M_range_set;\n+      std::vector<_CharClassT>                  _M_neg_class_set;\n       _CharClassT                               _M_class_set;\n       _TransT                                   _M_translator;\n       const _TraitsT&                           _M_traits;"}, {"sha": "472cf1ff49c1b9606e8cf4e4a0360085e28e76a7", "filename": "libstdc++-v3/include/bits/regex_compiler.tcc", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4dae67e09042d48c5f330d540d5fdde5f51db656/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_compiler.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4dae67e09042d48c5f330d540d5fdde5f51db656/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_compiler.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_compiler.tcc?ref=4dae67e09042d48c5f330d540d5fdde5f51db656", "patch": "@@ -397,7 +397,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       _GLIBCXX_DEBUG_ASSERT(_M_value.size() == 1);\n       _BracketMatcher<_TraitsT, __icase, __collate> __matcher\n \t(_M_ctype.is(_CtypeT::upper, _M_value[0]), _M_traits);\n-      __matcher._M_add_character_class(_M_value);\n+      __matcher._M_add_character_class(_M_value, false);\n       __matcher._M_ready();\n       _M_stack.push(_StateSeqT(_M_nfa,\n \t_M_nfa._M_insert_matcher(std::move(__matcher))));\n@@ -428,7 +428,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       else if (_M_match_token(_ScannerT::_S_token_equiv_class_name))\n \t__matcher._M_add_equivalence_class(_M_value);\n       else if (_M_match_token(_ScannerT::_S_token_char_class_name))\n-\t__matcher._M_add_character_class(_M_value);\n+\t__matcher._M_add_character_class(_M_value, false);\n       else if (_M_try_char()) // [a\n \t{\n \t  auto __ch = _M_value[0];\n@@ -451,6 +451,10 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t    }\n \t  __matcher._M_add_char(__ch);\n \t}\n+      else if (_M_match_token(_ScannerT::_S_token_quoted_class))\n+\t__matcher._M_add_character_class(_M_value,\n+\t\t\t\t\t _M_ctype.is(_CtypeT::upper,\n+\t\t\t\t\t\t     _M_value[0]));\n       else\n \t__throw_regex_error(regex_constants::error_brack);\n     }\n@@ -527,6 +531,15 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t\t\t     _M_traits.transform_primary(&__ch, &__ch+1))\n \t\t   != _M_equiv_set.end())\n \t    __ret = true;\n+\t  else\n+\t    {\n+\t      for (auto& __it : _M_neg_class_set)\n+\t\tif (!_M_traits.isctype(__ch, __it))\n+\t\t  {\n+\t\t    __ret = true;\n+\t\t    break;\n+\t\t  }\n+\t    }\n \t}\n       if (_M_is_non_matching)\n \treturn !__ret;"}, {"sha": "86417323516d8352a436a7715c889c63ba1ec873", "filename": "libstdc++-v3/testsuite/28_regex/algorithms/regex_match/ecma/char/quoted_char.cc", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4dae67e09042d48c5f330d540d5fdde5f51db656/libstdc%2B%2B-v3%2Ftestsuite%2F28_regex%2Falgorithms%2Fregex_match%2Fecma%2Fchar%2Fquoted_char.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4dae67e09042d48c5f330d540d5fdde5f51db656/libstdc%2B%2B-v3%2Ftestsuite%2F28_regex%2Falgorithms%2Fregex_match%2Fecma%2Fchar%2Fquoted_char.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F28_regex%2Falgorithms%2Fregex_match%2Fecma%2Fchar%2Fquoted_char.cc?ref=4dae67e09042d48c5f330d540d5fdde5f51db656", "patch": "@@ -44,6 +44,16 @@ test01()\n   VERIFY(regex_match_debug(\"_az\", regex(\"\\\\w*\")));\n   VERIFY(regex_match_debug(\"!@#$%\", regex(\"\\\\W*\")));\n   VERIFY(!regex_match_debug(\"_01234\", regex(\"\\\\W*\")));\n+\n+  VERIFY(regex_match_debug(\"01\", regex(\"[\\\\d]*\")));\n+  VERIFY(regex_match_debug(\"asdfjkl\", regex(\"[\\\\D]*\")));\n+  VERIFY(!regex_match_debug(\"asdfjkl0\", regex(\"[\\\\D]*\")));\n+  VERIFY(regex_match_debug(\"\\r\\t\\v\\f \", regex(\"[\\\\s]*\")));\n+  VERIFY(regex_match_debug(\"asdfjkl\", regex(\"[\\\\S]*\")));\n+  VERIFY(!regex_match_debug(\"asdfjkl\\r\", regex(\"[\\\\S]*\")));\n+  VERIFY(regex_match_debug(\"_az\", regex(\"[\\\\w]*\")));\n+  VERIFY(regex_match_debug(\"!@#$%\", regex(\"[\\\\W]*\")));\n+  VERIFY(!regex_match_debug(\"_01234\", regex(\"[\\\\W]*\")));\n }\n \n int"}]}