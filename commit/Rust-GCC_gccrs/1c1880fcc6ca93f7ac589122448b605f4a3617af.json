{"sha": "1c1880fcc6ca93f7ac589122448b605f4a3617af", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWMxODgwZmNjNmNhOTNmN2FjNTg5MTIyNDQ4YjYwNWY0YTM2MTdhZg==", "commit": {"author": {"name": "Adam Butcher", "email": "adam@jessamine.co.uk", "date": "2013-09-12T18:54:42Z"}, "committer": {"name": "Adam Butcher", "email": "abutcher@gcc.gnu.org", "date": "2013-09-12T18:54:42Z"}, "message": "Support decl instantiation in function-local templates.\n\n\t* pt.c (instantiate_decl): Save/restore cp_unevaluated_operand and\n\tc_inhibit_evaluation_warnings.  Reset if instantiating within a\n\tfunction-local template.\n\nFrom-SVN: r202538", "tree": {"sha": "a6f6b2c23f5262d18787189b8876f20b0297dd79", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a6f6b2c23f5262d18787189b8876f20b0297dd79"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1c1880fcc6ca93f7ac589122448b605f4a3617af", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1c1880fcc6ca93f7ac589122448b605f4a3617af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1c1880fcc6ca93f7ac589122448b605f4a3617af", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1c1880fcc6ca93f7ac589122448b605f4a3617af/comments", "author": {"login": "abutcher-gh", "id": 10379705, "node_id": "MDQ6VXNlcjEwMzc5NzA1", "avatar_url": "https://avatars.githubusercontent.com/u/10379705?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abutcher-gh", "html_url": "https://github.com/abutcher-gh", "followers_url": "https://api.github.com/users/abutcher-gh/followers", "following_url": "https://api.github.com/users/abutcher-gh/following{/other_user}", "gists_url": "https://api.github.com/users/abutcher-gh/gists{/gist_id}", "starred_url": "https://api.github.com/users/abutcher-gh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abutcher-gh/subscriptions", "organizations_url": "https://api.github.com/users/abutcher-gh/orgs", "repos_url": "https://api.github.com/users/abutcher-gh/repos", "events_url": "https://api.github.com/users/abutcher-gh/events{/privacy}", "received_events_url": "https://api.github.com/users/abutcher-gh/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "84f6d9fa3de366017eafa07730e2ee9a1886f3d7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84f6d9fa3de366017eafa07730e2ee9a1886f3d7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/84f6d9fa3de366017eafa07730e2ee9a1886f3d7"}], "stats": {"total": 19, "additions": 17, "deletions": 2}, "files": [{"sha": "cbad022031a3244364b7b7007c2fe9771d6f80ab", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c1880fcc6ca93f7ac589122448b605f4a3617af/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c1880fcc6ca93f7ac589122448b605f4a3617af/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=1c1880fcc6ca93f7ac589122448b605f4a3617af", "patch": "@@ -1,3 +1,9 @@\n+2013-09-12  Adam Butcher  <adam@jessamine.co.uk>\n+\n+\t* pt.c (instantiate_decl): Save/restore cp_unevaluated_operand and\n+\tc_inhibit_evaluation_warnings.  Reset if instantiating within a\n+\tfunction-local template.\n+\n 2013-09-12  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \t* semantics.c (finish_pseudo_destructor_expr): Add location_t"}, {"sha": "3ae679a055b1d8a6357661a44391c879849b383f", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c1880fcc6ca93f7ac589122448b605f4a3617af/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c1880fcc6ca93f7ac589122448b605f4a3617af/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=1c1880fcc6ca93f7ac589122448b605f4a3617af", "patch": "@@ -18947,6 +18947,8 @@ instantiate_decl (tree d, int defer_ok,\n   tree gen_tmpl;\n   bool pattern_defined;\n   location_t saved_loc = input_location;\n+  int saved_unevaluated_operand = cp_unevaluated_operand;\n+  int saved_inhibit_evaluation_warnings = c_inhibit_evaluation_warnings;\n   bool external_p;\n   tree fn_context;\n   bool nested;\n@@ -19158,8 +19160,13 @@ instantiate_decl (tree d, int defer_ok,\n   nested = (current_function_decl != NULL_TREE);\n   if (!fn_context)\n     push_to_top_level ();\n-  else if (nested)\n-    push_function_context ();\n+  else\n+    {\n+      if (nested)\n+\tpush_function_context ();\n+      cp_unevaluated_operand = 0;\n+      c_inhibit_evaluation_warnings = 0;\n+    }\n \n   /* Mark D as instantiated so that recursive calls to\n      instantiate_decl do not try to instantiate it again.  */\n@@ -19283,6 +19290,8 @@ instantiate_decl (tree d, int defer_ok,\n \n out:\n   input_location = saved_loc;\n+  cp_unevaluated_operand = saved_unevaluated_operand;\n+  c_inhibit_evaluation_warnings = saved_inhibit_evaluation_warnings;\n   pop_deferring_access_checks ();\n   pop_tinst_level ();\n "}]}