{"sha": "c8d3b44dfa2851659f966627835497667c5fed6c", "node_id": "C_kwDOANBUbNoAKGM4ZDNiNDRkZmEyODUxNjU5Zjk2NjYyNzgzNTQ5NzY2N2M1ZmVkNmM", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-09-08T10:22:26Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-09-08T11:11:32Z"}, "message": "tree-optimization/106881 - constrain uninit control edge add\n\nThe following avoids adding fallthru edges to the control chain from\nthe post-dominator walk.\n\n\tPR tree-optimization/106881\n\t* gimple-predicate-analysis.cc (compute_control_dep_chain_pdom):\n\tAdd only non-fallthru edges and avoid the same set of edges\n\tas the caller does.\n\n\t* gcc.dg/uninit-pr106881.c: New testcase.", "tree": {"sha": "53ac590dec21943b05a62252a189fe876d9e5716", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/53ac590dec21943b05a62252a189fe876d9e5716"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c8d3b44dfa2851659f966627835497667c5fed6c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8d3b44dfa2851659f966627835497667c5fed6c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c8d3b44dfa2851659f966627835497667c5fed6c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8d3b44dfa2851659f966627835497667c5fed6c/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "794a01d7dcf306578bc5d0d147895c58a91506de", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/794a01d7dcf306578bc5d0d147895c58a91506de", "html_url": "https://github.com/Rust-GCC/gccrs/commit/794a01d7dcf306578bc5d0d147895c58a91506de"}], "stats": {"total": 25, "additions": 22, "deletions": 3}, "files": [{"sha": "910ab97a29e04f663234043a8f6c51e041b8884f", "filename": "gcc/gimple-predicate-analysis.cc", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8d3b44dfa2851659f966627835497667c5fed6c/gcc%2Fgimple-predicate-analysis.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8d3b44dfa2851659f966627835497667c5fed6c/gcc%2Fgimple-predicate-analysis.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-predicate-analysis.cc?ref=c8d3b44dfa2851659f966627835497667c5fed6c", "patch": "@@ -1060,9 +1060,12 @@ compute_control_dep_chain_pdom (basic_block cd_bb, const_basic_block dep_bb,\n \t gcc.dg/unninit-pred-12.c and PR106754.  */\n       if (single_pred_p (cd_bb))\n \t{\n-\t  edge e2 = find_edge (prev_cd_bb, cd_bb);\n-\t  gcc_assert (e2);\n-\t  cur_cd_chain.safe_push (e2);\n+\t  edge e2 = single_pred_edge (cd_bb);\n+\t  gcc_assert (e2->src == prev_cd_bb);\n+\t  /* But avoid adding fallthru or abnormal edges.  */\n+\t  if (!(e2->flags & (EDGE_FAKE | EDGE_ABNORMAL | EDGE_DFS_BACK))\n+\t      && !single_succ_p (prev_cd_bb))\n+\t    cur_cd_chain.safe_push (e2);\n \t}\n     }\n   return found_cd_chain;"}, {"sha": "343b13ed73d810ed33d5d243318922e85d22494a", "filename": "gcc/testsuite/gcc.dg/uninit-pr106881.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8d3b44dfa2851659f966627835497667c5fed6c/gcc%2Ftestsuite%2Fgcc.dg%2Funinit-pr106881.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8d3b44dfa2851659f966627835497667c5fed6c/gcc%2Ftestsuite%2Fgcc.dg%2Funinit-pr106881.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Funinit-pr106881.c?ref=c8d3b44dfa2851659f966627835497667c5fed6c", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O -fexceptions -Wuninitialized\" } */\n+\n+void l_free (void *);\n+char *l_settings_get_string ();\n+void eap_append_secret ();\n+inline void auto_free(void *a) {\n+  void **p = a;\n+  l_free(*p); /* { dg-warning \"uninitialized\" } */\n+}\n+void eap_gtc_check_settings() {\n+  char *identity __attribute__((cleanup(auto_free)));\n+  char password __attribute__((cleanup(auto_free)));\n+  identity = l_settings_get_string();\n+  eap_append_secret();\n+}"}]}