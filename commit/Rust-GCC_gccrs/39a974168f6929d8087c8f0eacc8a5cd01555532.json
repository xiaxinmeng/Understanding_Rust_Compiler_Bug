{"sha": "39a974168f6929d8087c8f0eacc8a5cd01555532", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzlhOTc0MTY4ZjY5MjlkODA4N2M4ZjBlYWNjOGE1Y2QwMTU1NTUzMg==", "commit": {"author": {"name": "Samuel Tardieu", "email": "sam@rfc1149.net", "date": "2007-11-28T20:43:25Z"}, "committer": {"name": "Samuel Tardieu", "email": "sam@gcc.gnu.org", "date": "2007-11-28T20:43:25Z"}, "message": "re PR ada/15803 (Illegal program not detected, RM 8.3(19))\n\n    gcc/ada/\n\tPR ada/15803\n\t* par-ch3.adb (P_Variant_Part): Signal an error when anything other\n\tthan an identifier is used after \"case\" in a variant_part.\n\n    gcc/testsuite/\n\tPR ada/15803\n\t* gnat.dg/specs/variant_part.ads: New test.\n\nFrom-SVN: r130495", "tree": {"sha": "0d990d51d9d78228db2fc228dd766b7dbff67ff2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0d990d51d9d78228db2fc228dd766b7dbff67ff2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/39a974168f6929d8087c8f0eacc8a5cd01555532", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39a974168f6929d8087c8f0eacc8a5cd01555532", "html_url": "https://github.com/Rust-GCC/gccrs/commit/39a974168f6929d8087c8f0eacc8a5cd01555532", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39a974168f6929d8087c8f0eacc8a5cd01555532/comments", "author": {"login": "samueltardieu", "id": 44656, "node_id": "MDQ6VXNlcjQ0NjU2", "avatar_url": "https://avatars.githubusercontent.com/u/44656?v=4", "gravatar_id": "", "url": "https://api.github.com/users/samueltardieu", "html_url": "https://github.com/samueltardieu", "followers_url": "https://api.github.com/users/samueltardieu/followers", "following_url": "https://api.github.com/users/samueltardieu/following{/other_user}", "gists_url": "https://api.github.com/users/samueltardieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/samueltardieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/samueltardieu/subscriptions", "organizations_url": "https://api.github.com/users/samueltardieu/orgs", "repos_url": "https://api.github.com/users/samueltardieu/repos", "events_url": "https://api.github.com/users/samueltardieu/events{/privacy}", "received_events_url": "https://api.github.com/users/samueltardieu/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "93d15c33318942014feda60caa687a96ecea2499", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/93d15c33318942014feda60caa687a96ecea2499", "html_url": "https://github.com/Rust-GCC/gccrs/commit/93d15c33318942014feda60caa687a96ecea2499"}], "stats": {"total": 38, "additions": 36, "deletions": 2}, "files": [{"sha": "31f9d19ba519afe9a8947d6820223eae2d9a1121", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39a974168f6929d8087c8f0eacc8a5cd01555532/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39a974168f6929d8087c8f0eacc8a5cd01555532/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=39a974168f6929d8087c8f0eacc8a5cd01555532", "patch": "@@ -1,3 +1,9 @@\n+2007-11-28  Samuel Tardieu  <sam@rfc1149.net>\n+\n+\tPR ada/15803\n+\t* par-ch3.adb (P_Variant_Part): Signal an error when anything other\n+\tthan an identifier is used after \"case\" in a variant_part.\n+\n 2007-11-26  Andreas Krebbel  <krebbel1@de.ibm.com>\n \n         PR 34081/C++"}, {"sha": "910d16174feb8512fe61c89eb46d5cac165e690d", "filename": "gcc/ada/par-ch3.adb", "status": "modified", "additions": 17, "deletions": 2, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39a974168f6929d8087c8f0eacc8a5cd01555532/gcc%2Fada%2Fpar-ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39a974168f6929d8087c8f0eacc8a5cd01555532/gcc%2Fada%2Fpar-ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fpar-ch3.adb?ref=39a974168f6929d8087c8f0eacc8a5cd01555532", "patch": "@@ -3395,6 +3395,7 @@ package body Ch3 is\n       Variant_Part_Node : Node_Id;\n       Variants_List     : List_Id;\n       Case_Node         : Node_Id;\n+      Ident_Token       : Token_Type;\n \n    begin\n       Variant_Part_Node := New_Node (N_Variant_Part, Token_Ptr);\n@@ -3404,11 +3405,25 @@ package body Ch3 is\n       Scope.Table (Scope.Last).Ecol := Start_Column;\n \n       Scan; -- past CASE\n+\n+      --  A discriminant name between parentheses will be returned as\n+      --  a N_Identifier although it is not allowed by RM 3.8.1. We\n+      --  save the token type to check it later. However, in case of\n+      --  a discriminant name with parentheses, we can continue the\n+      --  analysis as if only the discriminant name had been given.\n+\n+      Ident_Token := Token;\n       Case_Node := P_Expression;\n-      Set_Name (Variant_Part_Node, Case_Node);\n \n-      if Nkind (Case_Node) /= N_Identifier then\n+      if Nkind (Case_Node) = N_Identifier then\n+         Set_Name (Variant_Part_Node, Case_Node);\n+      else\n          Set_Name (Variant_Part_Node, Error);\n+      end if;\n+\n+      if Nkind (Case_Node) /= N_Identifier\n+        or else Ident_Token /= Tok_Identifier\n+      then\n          Error_Msg (\"discriminant name expected\", Sloc (Case_Node));\n       end if;\n "}, {"sha": "fc5de7d497a9ea306ecb4b3ad86a7f357e636c57", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39a974168f6929d8087c8f0eacc8a5cd01555532/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39a974168f6929d8087c8f0eacc8a5cd01555532/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=39a974168f6929d8087c8f0eacc8a5cd01555532", "patch": "@@ -1,3 +1,8 @@\n+2007-11-28  Samuel Tardieu  <sam@rfc1149.net>\n+\n+\tPR ada/15803\n+\t* gnat.dg/specs/variant_part.ads: New test.\n+\n 2007-11-28  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR tree-optimization/34140"}, {"sha": "b7ac16ccd4204b0bccf6ed6c458093be16ee1320", "filename": "gcc/testsuite/gnat.dg/specs/variant_part.ads", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39a974168f6929d8087c8f0eacc8a5cd01555532/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Fvariant_part.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39a974168f6929d8087c8f0eacc8a5cd01555532/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Fvariant_part.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Fvariant_part.ads?ref=39a974168f6929d8087c8f0eacc8a5cd01555532", "patch": "@@ -0,0 +1,8 @@\n+-- { dg-do compile }\n+package Variant_Part is\n+   type T1(b: boolean) is record\n+     case (b) is              -- { dg-error \"discriminant name expected\" }\n+        when others => null;\n+     end case;\n+   end record;\n+end Variant_Part;"}]}