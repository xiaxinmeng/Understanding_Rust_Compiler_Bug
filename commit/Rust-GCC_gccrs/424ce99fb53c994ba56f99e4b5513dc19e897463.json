{"sha": "424ce99fb53c994ba56f99e4b5513dc19e897463", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDI0Y2U5OWZiNTNjOTk0YmE1NmY5OWU0YjU1MTNkYzE5ZTg5NzQ2Mw==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@adacore.com", "date": "2020-04-23T18:46:27Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2020-06-18T09:08:36Z"}, "message": "[Ada] ACATS 4.1J - B854003 - Subtype conformance check missed\n\n2020-06-18  Arnaud Charlet  <charlet@adacore.com>\n\ngcc/ada/\n\n\t* sem_ch6.ads, sem_ch6.adb (Check_Formal_Conformance): New\n\tsubprogram.\n\t(Check_Conformance): Move code to Check_Formal_Conformance.\n\t* sem_ch8.adb (Analyze_Subprogram_Renaming): Check for formal\n\tconformance when needed.", "tree": {"sha": "ad2f329e78c545abf502e1e290e2b42ddd698e6c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ad2f329e78c545abf502e1e290e2b42ddd698e6c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/424ce99fb53c994ba56f99e4b5513dc19e897463", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/424ce99fb53c994ba56f99e4b5513dc19e897463", "html_url": "https://github.com/Rust-GCC/gccrs/commit/424ce99fb53c994ba56f99e4b5513dc19e897463", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/424ce99fb53c994ba56f99e4b5513dc19e897463/comments", "author": {"login": "ArnaudCharlet", "id": 30291825, "node_id": "MDQ6VXNlcjMwMjkxODI1", "avatar_url": "https://avatars.githubusercontent.com/u/30291825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ArnaudCharlet", "html_url": "https://github.com/ArnaudCharlet", "followers_url": "https://api.github.com/users/ArnaudCharlet/followers", "following_url": "https://api.github.com/users/ArnaudCharlet/following{/other_user}", "gists_url": "https://api.github.com/users/ArnaudCharlet/gists{/gist_id}", "starred_url": "https://api.github.com/users/ArnaudCharlet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ArnaudCharlet/subscriptions", "organizations_url": "https://api.github.com/users/ArnaudCharlet/orgs", "repos_url": "https://api.github.com/users/ArnaudCharlet/repos", "events_url": "https://api.github.com/users/ArnaudCharlet/events{/privacy}", "received_events_url": "https://api.github.com/users/ArnaudCharlet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6c8e4f7e38ec5c8aae7b3d475462bf64e61eea99", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6c8e4f7e38ec5c8aae7b3d475462bf64e61eea99", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6c8e4f7e38ec5c8aae7b3d475462bf64e61eea99"}], "stats": {"total": 57, "additions": 46, "deletions": 11}, "files": [{"sha": "96099e77b430ead047140284c824decc6c5062c4", "filename": "gcc/ada/sem_ch6.adb", "status": "modified", "additions": 33, "deletions": 10, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/424ce99fb53c994ba56f99e4b5513dc19e897463/gcc%2Fada%2Fsem_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/424ce99fb53c994ba56f99e4b5513dc19e897463/gcc%2Fada%2Fsem_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch6.adb?ref=424ce99fb53c994ba56f99e4b5513dc19e897463", "patch": "@@ -5734,16 +5734,8 @@ package body Sem_Ch6 is\n             end if;\n \n             return;\n-\n-         elsif Is_Formal_Subprogram (Old_Id)\n-           or else Is_Formal_Subprogram (New_Id)\n-           or else (Is_Subprogram (New_Id)\n-                     and then Present (Alias (New_Id))\n-                     and then Is_Formal_Subprogram (Alias (New_Id)))\n-         then\n-            Conformance_Error\n-              (\"\\formal subprograms are not subtype conformant \"\n-               & \"(RM 6.3.1 (17/3))\");\n+         else\n+            Check_Formal_Subprogram_Conformance (New_Id, Old_Id, Err_Loc);\n          end if;\n       end if;\n \n@@ -6516,6 +6508,37 @@ package body Sem_Ch6 is\n       end if;\n    end Check_Discriminant_Conformance;\n \n+   -----------------------------------------\n+   -- Check_Formal_Subprogram_Conformance --\n+   -----------------------------------------\n+\n+   procedure Check_Formal_Subprogram_Conformance\n+     (New_Id  : Entity_Id;\n+      Old_Id  : Entity_Id;\n+      Err_Loc : Node_Id := Empty)\n+   is\n+      N : Node_Id;\n+   begin\n+      if Is_Formal_Subprogram (Old_Id)\n+        or else Is_Formal_Subprogram (New_Id)\n+        or else (Is_Subprogram (New_Id)\n+                  and then Present (Alias (New_Id))\n+                  and then Is_Formal_Subprogram (Alias (New_Id)))\n+      then\n+         if Present (Err_Loc) then\n+            N := Err_Loc;\n+         else\n+            N := New_Id;\n+         end if;\n+\n+         Error_Msg_Sloc := Sloc (Old_Id);\n+         Error_Msg_N (\"not subtype conformant with declaration#!\", N);\n+         Error_Msg_NE\n+           (\"\\formal subprograms are not subtype conformant \"\n+            & \"(RM 6.3.1 (17/3))\", N, New_Id);\n+      end if;\n+   end Check_Formal_Subprogram_Conformance;\n+\n    ----------------------------\n    -- Check_Fully_Conformant --\n    ----------------------------"}, {"sha": "81b4821d5760e5662e397628583e49cd60a79759", "filename": "gcc/ada/sem_ch6.ads", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/424ce99fb53c994ba56f99e4b5513dc19e897463/gcc%2Fada%2Fsem_ch6.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/424ce99fb53c994ba56f99e4b5513dc19e897463/gcc%2Fada%2Fsem_ch6.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch6.ads?ref=424ce99fb53c994ba56f99e4b5513dc19e897463", "patch": "@@ -69,6 +69,16 @@ package Sem_Ch6 is\n    --  the source location of the partial view, which may be different than\n    --  Prev in the case of private types.\n \n+   procedure Check_Formal_Subprogram_Conformance\n+     (New_Id  : Entity_Id;\n+      Old_Id  : Entity_Id;\n+      Err_Loc : Node_Id := Empty);\n+   --  Check RM 6.3.1(17/3): the profile of a generic formal subprogram is not\n+   --  subtype conformant with any other profile and post an error message if\n+   --  either New_Id or Old_Id denotes a formal subprogram, with the flag being\n+   --  placed on the Err_Loc node if it is specified, and on New_Id if not. See\n+   --  also spec of Check_Fully_Conformant below for New_Id and Old_Id usage.\n+\n    procedure Check_Fully_Conformant\n      (New_Id  : Entity_Id;\n       Old_Id  : Entity_Id;"}, {"sha": "4e85a1508d7360fa7ba3b40d524e0a4107615197", "filename": "gcc/ada/sem_ch8.adb", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/424ce99fb53c994ba56f99e4b5513dc19e897463/gcc%2Fada%2Fsem_ch8.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/424ce99fb53c994ba56f99e4b5513dc19e897463/gcc%2Fada%2Fsem_ch8.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch8.adb?ref=424ce99fb53c994ba56f99e4b5513dc19e897463", "patch": "@@ -3171,7 +3171,7 @@ package body Sem_Ch8 is\n \n       Set_Kill_Elaboration_Checks (New_S, True);\n \n-      --  If we had a previous error, indicate a completely is present to stop\n+      --  If we had a previous error, indicate a completion is present to stop\n       --  junk cascaded messages, but don't take any further action.\n \n       if Etype (Nam) = Any_Type then\n@@ -3409,6 +3409,8 @@ package body Sem_Ch8 is\n \n                if Original_Subprogram (Old_S) = Rename_Spec then\n                   Error_Msg_N (\"unfrozen subprogram cannot rename itself \", N);\n+               else\n+                  Check_Formal_Subprogram_Conformance (New_S, Old_S, Spec);\n                end if;\n             else\n                Check_Subtype_Conformant (New_S, Old_S, Spec);"}]}