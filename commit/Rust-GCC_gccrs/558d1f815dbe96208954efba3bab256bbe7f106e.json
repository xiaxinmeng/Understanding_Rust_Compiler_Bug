{"sha": "558d1f815dbe96208954efba3bab256bbe7f106e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTU4ZDFmODE1ZGJlOTYyMDg5NTRlZmJhM2JhYjI1NmJiZTdmMTA2ZQ==", "commit": {"author": {"name": "Joseph Myers", "email": "jsm@polyomino.org.uk", "date": "2004-07-31T17:21:27Z"}, "committer": {"name": "Joseph Myers", "email": "jsm28@gcc.gnu.org", "date": "2004-07-31T17:21:27Z"}, "message": "c-decl.c (diagnose_mismatched_decls): Give error for external redeclaration of identifier declared with no linkage...\n\n\t* c-decl.c (diagnose_mismatched_decls): Give error for external\n\tredeclaration of identifier declared with no linkage, not just\n\twarning with -Wtraditional.  Do not check DECL_CONTEXT to give\n\terror for redeclaration with no linkage.\n\ntestsuite:\n\t* gcc.dg/redecl-2.c: New test.\n\nFrom-SVN: r85386", "tree": {"sha": "37c2094176ebe279ec60f8c89c341f5502370a4b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/37c2094176ebe279ec60f8c89c341f5502370a4b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/558d1f815dbe96208954efba3bab256bbe7f106e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/558d1f815dbe96208954efba3bab256bbe7f106e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/558d1f815dbe96208954efba3bab256bbe7f106e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/558d1f815dbe96208954efba3bab256bbe7f106e/comments", "author": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2347da644d23390399cc060fe3f2358314efc1b6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2347da644d23390399cc060fe3f2358314efc1b6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2347da644d23390399cc060fe3f2358314efc1b6"}], "stats": {"total": 95, "additions": 89, "deletions": 6}, "files": [{"sha": "226591d1dc4bb57838a4999c41fa116f1a24249b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/558d1f815dbe96208954efba3bab256bbe7f106e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/558d1f815dbe96208954efba3bab256bbe7f106e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=558d1f815dbe96208954efba3bab256bbe7f106e", "patch": "@@ -1,3 +1,10 @@\n+2004-07-31  Joseph S. Myers  <jsm@polyomino.org.uk>\n+\n+\t* c-decl.c (diagnose_mismatched_decls): Give error for external\n+\tredeclaration of identifier declared with no linkage, not just\n+\twarning with -Wtraditional.  Do not check DECL_CONTEXT to give\n+\terror for redeclaration with no linkage.\n+\n 2004-07-30  Geoffrey Keating  <geoffk@apple.com>\n \t    Fariborz Jahanian <fjahanian@apple.com>\n "}, {"sha": "27860b4bd29916171d89ec01e7bdaee3e1ffedfe", "filename": "gcc/c-decl.c", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/558d1f815dbe96208954efba3bab256bbe7f106e/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/558d1f815dbe96208954efba3bab256bbe7f106e/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=558d1f815dbe96208954efba3bab256bbe7f106e", "patch": "@@ -1325,7 +1325,14 @@ diagnose_mismatched_decls (tree newdecl, tree olddecl,\n \t{\n \t  if (DECL_EXTERNAL (newdecl))\n \t    {\n-\t      if (warn_traditional)\n+\t      if (!DECL_FILE_SCOPE_P (olddecl))\n+\t\t{\n+\t\t  error (\"%Jextern declaration of %qD follows \"\n+\t\t\t \"declaration with no linkage\", newdecl, newdecl);\n+\t\t  locate_old_decl (olddecl, error);\n+\t\t  return false;\n+\t\t}\n+\t      else if (warn_traditional)\n \t\t{\n \t\t  warning (\"%Jnon-static declaration of '%D' follows \"\n \t\t\t   \"static declaration\", newdecl, newdecl);\n@@ -1347,13 +1354,10 @@ diagnose_mismatched_decls (tree newdecl, tree olddecl,\n \t}\n       /* Two objects with the same name declared at the same block\n \t scope must both be external references (6.7p3).  */\n-      else if (!DECL_FILE_SCOPE_P (newdecl)\n-\t       && DECL_CONTEXT (newdecl) == DECL_CONTEXT (olddecl)\n-\t       && (!DECL_EXTERNAL (newdecl) || !DECL_EXTERNAL (olddecl)))\n+      else if (!DECL_FILE_SCOPE_P (newdecl))\n \t{\n \t  if (DECL_EXTERNAL (newdecl))\n-\t    error (\"%Jextern declaration of '%D' follows \"\n-\t\t   \"declaration with no linkage\", newdecl, newdecl);\n+\t    abort ();\n \t  else if (DECL_EXTERNAL (olddecl))\n \t    error (\"%Jdeclaration of '%D' with no linkage follows \"\n \t\t   \"extern declaration\", newdecl, newdecl);"}, {"sha": "28d487c4f54d4da73957ac17f3d8f2fecc478118", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/558d1f815dbe96208954efba3bab256bbe7f106e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/558d1f815dbe96208954efba3bab256bbe7f106e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=558d1f815dbe96208954efba3bab256bbe7f106e", "patch": "@@ -1,3 +1,7 @@\n+2004-07-31  Joseph S. Myers  <jsm@polyomino.org.uk>\n+\n+\t* gcc.dg/redecl-2.c: New test.\n+\n 2004-07-30  Geoffrey Keating  <geoffk@apple.com>\n \n \t* gcc.dg/darwin-longdouble.c: New file."}, {"sha": "b1b7dc929debd49b057dd9d3ea7be437bf768c32", "filename": "gcc/testsuite/gcc.dg/redecl-2.c", "status": "added", "additions": 68, "deletions": 0, "changes": 68, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/558d1f815dbe96208954efba3bab256bbe7f106e/gcc%2Ftestsuite%2Fgcc.dg%2Fredecl-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/558d1f815dbe96208954efba3bab256bbe7f106e/gcc%2Ftestsuite%2Fgcc.dg%2Fredecl-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fredecl-2.c?ref=558d1f815dbe96208954efba3bab256bbe7f106e", "patch": "@@ -0,0 +1,68 @@\n+/* Test for multiple declarations of an identifier at same block\n+   scope: only valid case is all extern.  */\n+/* Origin: Joseph Myers <jsm@polyomino.org.uk> */\n+/* { dg-do compile } */\n+/* { dg-options \"\" } */\n+\n+void\n+fa0 (void)\n+{\n+  int a0; /* { dg-error \"previous declaration\" } */\n+  int a0; /* { dg-error \"redeclaration\" } */\n+}\n+\n+void\n+fa1 (void)\n+{\n+  int a1; /* { dg-error \"previous declaration\" } */\n+  static int a1; /* { dg-error \"redeclaration\" } */\n+}\n+\n+void\n+fa2 (void)\n+{\n+  int a2; /* { dg-error \"previous declaration\" } */\n+  extern int a2; /* { dg-error \"follows declaration with no linkage\" } */\n+}\n+\n+void\n+fa3 (void)\n+{\n+  static int a3; /* { dg-error \"previous declaration\" } */\n+  int a3; /* { dg-error \"redeclaration\" } */\n+}\n+\n+void\n+fa4 (void)\n+{\n+  static int a4; /* { dg-error \"previous declaration\" } */\n+  static int a4; /* { dg-error \"redeclaration\" } */\n+}\n+\n+void\n+fa5 (void)\n+{\n+  static int a5; /* { dg-error \"previous declaration\" } */\n+  extern int a5; /* { dg-error \"follows declaration with no linkage\" } */\n+}\n+\n+void\n+fa6 (void)\n+{\n+  extern int a6; /* { dg-error \"previous declaration\" } */\n+  int a6; /* { dg-error \"follows extern declaration\" } */\n+}\n+\n+void\n+fa7 (void)\n+{\n+  extern int a7; /* { dg-error \"previous declaration\" } */\n+  static int a7; /* { dg-error \"follows extern declaration\" } */\n+}\n+\n+void\n+fa8 (void)\n+{\n+  extern int a8;\n+  extern int a8;\n+}"}]}