{"sha": "8575c72f04019a5ffc6be359e1d513bb2e1fb2d8", "node_id": "C_kwDOANBUbNoAKDg1NzVjNzJmMDQwMTlhNWZmYzZiZTM1OWUxZDUxM2JiMmUxZmIyZDg", "commit": {"author": {"name": "Ghjuvan Lacambre", "email": "lacambre@adacore.com", "date": "2022-05-17T18:03:44Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2022-06-02T09:06:42Z"}, "message": "[Ada] Add precise subprogram identification to -fdiagnostics-format=json\n\nThis commit adds information allowing identification of the subprogram\nsurrounding the message emitted by gnat when using -gnatdJ along with\n-fdiagnostics-format=json.\n\ngcc/ada/\n\n\t* errout.adb (Write_JSON_Span): Add subprogram name to emitted\n\tJSON.", "tree": {"sha": "e8af4784ceabb61a4b7d9c8a1063022ed35dd21f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e8af4784ceabb61a4b7d9c8a1063022ed35dd21f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8575c72f04019a5ffc6be359e1d513bb2e1fb2d8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8575c72f04019a5ffc6be359e1d513bb2e1fb2d8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8575c72f04019a5ffc6be359e1d513bb2e1fb2d8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8575c72f04019a5ffc6be359e1d513bb2e1fb2d8/comments", "author": {"login": "glacambre", "id": 11534587, "node_id": "MDQ6VXNlcjExNTM0NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/11534587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/glacambre", "html_url": "https://github.com/glacambre", "followers_url": "https://api.github.com/users/glacambre/followers", "following_url": "https://api.github.com/users/glacambre/following{/other_user}", "gists_url": "https://api.github.com/users/glacambre/gists{/gist_id}", "starred_url": "https://api.github.com/users/glacambre/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/glacambre/subscriptions", "organizations_url": "https://api.github.com/users/glacambre/orgs", "repos_url": "https://api.github.com/users/glacambre/repos", "events_url": "https://api.github.com/users/glacambre/events{/privacy}", "received_events_url": "https://api.github.com/users/glacambre/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "615682bc665e17f5b38e12878a1fa98f5062b5e4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/615682bc665e17f5b38e12878a1fa98f5062b5e4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/615682bc665e17f5b38e12878a1fa98f5062b5e4"}], "stats": {"total": 21, "additions": 15, "deletions": 6}, "files": [{"sha": "4e095a739daafc69a994bf848f3b3d75a819416d", "filename": "gcc/ada/errout.adb", "status": "modified", "additions": 15, "deletions": 6, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8575c72f04019a5ffc6be359e1d513bb2e1fb2d8/gcc%2Fada%2Ferrout.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8575c72f04019a5ffc6be359e1d513bb2e1fb2d8/gcc%2Fada%2Ferrout.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ferrout.adb?ref=8575c72f04019a5ffc6be359e1d513bb2e1fb2d8", "patch": "@@ -2097,11 +2097,14 @@ package body Errout is\n       --  Write Sptr as a JSON location, an object containing a file attribute,\n       --  a line number and a column number.\n \n-      procedure Write_JSON_Span (Span : Source_Span);\n-      --  Write Span as a JSON span, an object containing a \"caret\" attribute\n-      --  whose value is the JSON location of Span.Ptr. If Span.First and\n-      --  Span.Last are different from Span.Ptr, they will be printed as JSON\n+      procedure Write_JSON_Span (Error : Error_Msg_Object);\n+      --  Write Error as a JSON span, an object containing a \"caret\" attribute\n+      --  whose value is the JSON location of Error.Sptr.Ptr. If Sptr.First and\n+      --  Sptr.Last are different from Sptr.Ptr, they will be printed as JSON\n       --  locations under the names \"start\" and \"finish\".\n+      --  When Include_Subprogram_In_Messages is true (-gnatdJ) an additional,\n+      --  non-standard, attribute named \"subprogram\" will be added, allowing\n+      --  precisely identifying the subprogram surrounding the span.\n \n       -----------------------\n       --  Is_Continuation  --\n@@ -2162,7 +2165,8 @@ package body Errout is\n       -- Write_JSON_Span --\n       ---------------------\n \n-      procedure Write_JSON_Span (Span : Source_Span) is\n+      procedure Write_JSON_Span (Error : Error_Msg_Object) is\n+         Span : constant Source_Span := Error.Sptr;\n       begin\n          Write_Str (\"{\"\"caret\"\":\");\n          Write_JSON_Location (Span.Ptr);\n@@ -2177,6 +2181,11 @@ package body Errout is\n             Write_JSON_Location (Span.Last);\n          end if;\n \n+         if Include_Subprogram_In_Messages then\n+            Write_Str\n+              (\",\"\"subprogram\"\":\"\"\" & Subprogram_Name_Ptr (Error.Node) & \"\"\"\");\n+         end if;\n+\n          Write_Str (\"}\");\n       end Write_JSON_Span;\n \n@@ -2210,7 +2219,7 @@ package body Errout is\n       --  Print message location\n \n       Write_Str (\",\"\"locations\"\":[\");\n-      Write_JSON_Span (Errors.Table (E).Sptr);\n+      Write_JSON_Span (Errors.Table (E));\n \n       if Errors.Table (E).Optr /= Errors.Table (E).Sptr.Ptr then\n          Write_Str (\",{\"\"caret\"\":\");"}]}