{"sha": "8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODE3NWMxOWMxYmE2ZTUxZWE0NGUwMGVhNGJmZjVhMzcyNWRkYmRkYg==", "commit": {"author": {"name": "Rainer Orth", "email": "ro@CeBiTec.Uni-Bielefeld.DE", "date": "2011-07-25T16:44:22Z"}, "committer": {"name": "Rainer Orth", "email": "ro@gcc.gnu.org", "date": "2011-07-25T16:44:22Z"}, "message": "sourcebuild.texi (Effective-Target Keywords, [...]): Document mmap.\n\n\tgcc:\n\t* doc/sourcebuild.texi (Effective-Target Keywords, Environment\n\tattributes): Document mmap.\n\n\tgcc/testsuite:\n\t* lib/target-supports.exp (check_effective_target_mmap): New proc.\n\n\t* gcc.c-torture/execute/loop-2f.c: Remove #ifdef __unix__.\n\t* gcc.c-torture/execute/loop-2g.c: Likewise.\n\t* gcc.c-torture/execute/loop-2f.x: Load target-supports.exp.\n\tRequire mmap support.\n\t* gcc.c-torture/execute/loop-2g.x: Likewise.\n\t* gcc.dg/20030711-1.c: Replace dg-do target list by mmap.\n\t(MAP_ANON): Provide default.\n\t* gcc.dg/20050826-1.c: Likewise.\n\t* gcc.target/i386/pr36533.c: Likewise.\n\t* gcc.dg/vect/pr49038.c: Remove dg-do run.\n\tUse dg-require-effective-target mmap.\n\nFrom-SVN: r176760", "tree": {"sha": "22bb96fab4d0da9edd57cf1d1a46ee1591f2645f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/22bb96fab4d0da9edd57cf1d1a46ee1591f2645f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/comments", "author": {"login": "rorth", "id": 3930951, "node_id": "MDQ6VXNlcjM5MzA5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/3930951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rorth", "html_url": "https://github.com/rorth", "followers_url": "https://api.github.com/users/rorth/followers", "following_url": "https://api.github.com/users/rorth/following{/other_user}", "gists_url": "https://api.github.com/users/rorth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rorth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rorth/subscriptions", "organizations_url": "https://api.github.com/users/rorth/orgs", "repos_url": "https://api.github.com/users/rorth/repos", "events_url": "https://api.github.com/users/rorth/events{/privacy}", "received_events_url": "https://api.github.com/users/rorth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5057fa13b7b65fe878f1e9b4c48421fc21483d30", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5057fa13b7b65fe878f1e9b4c48421fc21483d30", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5057fa13b7b65fe878f1e9b4c48421fc21483d30"}], "stats": {"total": 62, "additions": 54, "deletions": 8}, "files": [{"sha": "8ffc8f10660905b92fb50f45c62813e0f5728f28", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb", "patch": "@@ -1,3 +1,8 @@\n+2011-07-25  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n+\n+\t* doc/sourcebuild.texi (Effective-Target Keywords, Environment\n+\tattributes): Document mmap.\n+\n 2011-07-25  Anatoly Sokolov  <aesok@post.ru>\n \n \t* config/mmix/mmix.h (PRINT_OPERAND, PRINT_OPERAND_ADDRESS,"}, {"sha": "ea6fedb239067e01eb1ff0359575d284268ac70b", "filename": "gcc/doc/sourcebuild.texi", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Fdoc%2Fsourcebuild.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Fdoc%2Fsourcebuild.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Fsourcebuild.texi?ref=8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb", "patch": "@@ -1679,6 +1679,9 @@ Target might have errors of a few ULP in string to floating-point\n conversion functions and overflow is not always detected correctly by\n those functions.\n \n+@item mmap\n+Target supports @code{mmap}.\n+\n @item newlib\n Target supports Newlib.\n "}, {"sha": "b90356962f8a8b2ec791b86c2bd2a41073a5d4a0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb", "patch": "@@ -1,3 +1,19 @@\n+2011-07-25  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n+\n+\t* lib/target-supports.exp (check_effective_target_mmap): New proc.\n+\n+\t* gcc.c-torture/execute/loop-2f.c: Remove #ifdef __unix__.\n+\t* gcc.c-torture/execute/loop-2g.c: Likewise.\n+\t* gcc.c-torture/execute/loop-2f.x: Load target-supports.exp.\n+\tRequire mmap support.\n+\t* gcc.c-torture/execute/loop-2g.x: Likewise.\n+\t* gcc.dg/20030711-1.c: Replace dg-do target list by mmap.\n+\t(MAP_ANON): Provide default.\n+\t* gcc.dg/20050826-1.c: Likewise.\n+\t* gcc.target/i386/pr36533.c: Likewise.\n+\t* gcc.dg/vect/pr49038.c: Remove dg-do run.\n+\tUse dg-require-effective-target mmap.\n+\n 2011-07-25  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/49838"}, {"sha": "4803d64daa9d501a69eaeca3a218e2fc08d415ea", "filename": "gcc/testsuite/gcc.c-torture/execute/loop-2f.c", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Floop-2f.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Floop-2f.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Floop-2f.c?ref=8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb", "patch": "@@ -1,6 +1,5 @@\n #include <limits.h>\n \n-#ifdef __unix__ /* ??? Is that good enough? */\n #include <sys/types.h>\n #include <sys/mman.h>\n #include <sys/stat.h>\n@@ -18,7 +17,6 @@\n #ifndef MAP_FIXED\n #define MAP_FIXED 0\n #endif\n-#endif\n \n #define MAP_START (void *)0x7fff8000\n #define MAP_LEN 0x10000"}, {"sha": "ad024dd493877ef5f98ef187302e96504912480b", "filename": "gcc/testsuite/gcc.c-torture/execute/loop-2f.x", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Floop-2f.x", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Floop-2f.x", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Floop-2f.x?ref=8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb", "patch": "@@ -1,3 +1,9 @@\n+load_lib target-supports.exp\n+\n+if { ! [check_effective_target_mmap] } {\n+        return 1\n+}\n+\n if [istarget \"m68k-*-linux*\"] {\n     # the executable is at the same position the test tries to remap\n     return 1"}, {"sha": "91af41323276cf85a9e04d076bd4d5b9c93576cf", "filename": "gcc/testsuite/gcc.c-torture/execute/loop-2g.c", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Floop-2g.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Floop-2g.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Floop-2g.c?ref=8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb", "patch": "@@ -1,6 +1,5 @@\n #include <limits.h>\n \n-#ifdef __unix__ /* ??? Is that good enough? */\n #include <sys/types.h>\n #include <sys/mman.h>\n #include <sys/stat.h>\n@@ -18,7 +17,6 @@\n #ifndef MAP_FIXED\n #define MAP_FIXED 0\n #endif\n-#endif\n \n #define MAP_START (void *)0x7fff8000\n #define MAP_LEN 0x10000"}, {"sha": "ad024dd493877ef5f98ef187302e96504912480b", "filename": "gcc/testsuite/gcc.c-torture/execute/loop-2g.x", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Floop-2g.x", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Floop-2g.x", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Floop-2g.x?ref=8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb", "patch": "@@ -1,3 +1,9 @@\n+load_lib target-supports.exp\n+\n+if { ! [check_effective_target_mmap] } {\n+        return 1\n+}\n+\n if [istarget \"m68k-*-linux*\"] {\n     # the executable is at the same position the test tries to remap\n     return 1"}, {"sha": "7649059c6cff93ded21d43d4192e0fc1c6bc5222", "filename": "gcc/testsuite/gcc.dg/20030711-1.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Fgcc.dg%2F20030711-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Fgcc.dg%2F20030711-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2F20030711-1.c?ref=8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb", "patch": "@@ -1,13 +1,16 @@\n /* Test whether strncmp has not been \"optimized\" into memcmp\n    nor any code with memcmp semantics.  */\n-/* { dg-do run { target i?86-*-linux* x86_64-*-linux* ia64-*-linux* alpha*-*-linux* powerpc*-*-linux* s390*-*-linux* sparc*-*-linux* *-*-darwin* } } */\n+/* { dg-do run { target mmap } } */\n /* { dg-options \"-O2\" } */\n #include <stddef.h>\n #include <stdio.h>\n #include <sys/mman.h>\n #ifndef MAP_ANONYMOUS\n #define MAP_ANONYMOUS MAP_ANON\n #endif\n+#ifndef MAP_ANON\n+#define MAP_ANON 0\n+#endif\n #include <stdlib.h>\n \n void __attribute__((noinline)) test (const char *p)"}, {"sha": "e622505e7da17f65e6e1fa6617bb41158e94e5b2", "filename": "gcc/testsuite/gcc.dg/20050826-1.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Fgcc.dg%2F20050826-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Fgcc.dg%2F20050826-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2F20050826-1.c?ref=8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb", "patch": "@@ -1,6 +1,6 @@\n /* Test whether strncmp has not been \"optimized\" into memcmp\n    nor any code with memcmp semantics.  */\n-/* { dg-do run { target i?86-*-linux* x86_64-*-linux* ia64-*-linux* alpha*-*-linux* powerpc*-*-linux* s390*-*-linux* sparc*-*-linux* *-*-darwin* } } */\n+/* { dg-do run { target mmap } } */\n /* { dg-options \"-O2\" } */\n #include <stddef.h>\n #include <stdio.h>\n@@ -9,6 +9,9 @@\n #ifndef MAP_ANONYMOUS\n #define MAP_ANONYMOUS MAP_ANON\n #endif\n+#ifndef MAP_ANON\n+#define MAP_ANON 0\n+#endif\n #include <stdlib.h>\n \n     struct Flags {"}, {"sha": "c760ef57b755951f8ed75e79cfedc66d2c2227dc", "filename": "gcc/testsuite/gcc.dg/vect/pr49038.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fpr49038.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fpr49038.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fpr49038.c?ref=8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do run { target i?86-*-linux* x86_64-*-linux* ia64-*-linux* alpha*-*-linux* powerpc*-*-linux* s390*-*-linux* sparc*-*-linux* *-*-darwin* } } */\n+/* { dg-require-effective-target mmap } */\n \n #include <sys/mman.h>\n #include <stdio.h>"}, {"sha": "8d71ece199d1fef1112e4b1a911ec29f4ab2588c", "filename": "gcc/testsuite/gcc.target/i386/pr36533.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr36533.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr36533.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr36533.c?ref=8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb", "patch": "@@ -1,5 +1,5 @@\n /* PR target/36533 */\n-/* { dg-do run { target { { i?86-*-linux* x86_64-*-linux* } && ilp32 } } } */\n+/* { dg-do run { target { mmap && ilp32 } } } */\n /* { dg-options \"-Os\" } */\n #include <string.h>\n #include <sys/mman.h>"}, {"sha": "f7027bdb6abbe60782c41d8850e307a15cb5afcc", "filename": "gcc/testsuite/lib/target-supports.exp", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp?ref=8175c19c1ba6e51ea44e00ea4bff5a3725ddbddb", "patch": "@@ -697,6 +697,14 @@ proc check_effective_target_fopenmp {} {\n     } \"-fopenmp\"]\n }\n \n+# Return 1 if the target supports mmap, 0 otherwise.\n+\n+proc check_effective_target_mmap {} {\n+    return [check_no_compiler_messages mmap assembly {\n+\t#include <sys/mman.h>\n+    }]\n+}\n+\n # Return 1 if compilation with -pthread is error-free for trivial\n # code, 0 otherwise.\n "}]}