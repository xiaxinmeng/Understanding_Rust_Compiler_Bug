{"sha": "472e0df9f0f70801be6a5097799d3fefba9ad078", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDcyZTBkZjlmMGY3MDgwMWJlNmE1MDk3Nzk5ZDNmZWZiYTlhZDA3OA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2009-05-07T15:27:40Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2009-05-07T15:27:40Z"}, "message": "re PR middle-end/40057 (Incorrect right shift by 31 with long long)\n\n\tPR middle-end/40057\n\t* dojump.c (prefer_and_bit_test): Use immed_double_const instead of\n\tGEN_INT for 1 << bitnum.\n\t(do_jump) <case BIT_AND_EXPR>: Use build_int_cst_wide_type instead of\n\tbuild_int_cst_type.\n\n\t* gcc.c-torture/execute/pr40057.c: New test.\n\nFrom-SVN: r147241", "tree": {"sha": "afa7d064f452e1ca909d3885ee825f7486fd3cdc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/afa7d064f452e1ca909d3885ee825f7486fd3cdc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/472e0df9f0f70801be6a5097799d3fefba9ad078", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/472e0df9f0f70801be6a5097799d3fefba9ad078", "html_url": "https://github.com/Rust-GCC/gccrs/commit/472e0df9f0f70801be6a5097799d3fefba9ad078", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/472e0df9f0f70801be6a5097799d3fefba9ad078/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "262118b947e0b9c200996e425acb8d75970ff1ff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/262118b947e0b9c200996e425acb8d75970ff1ff", "html_url": "https://github.com/Rust-GCC/gccrs/commit/262118b947e0b9c200996e425acb8d75970ff1ff"}], "stats": {"total": 59, "additions": 55, "deletions": 4}, "files": [{"sha": "db8a9dbdd5abb0a132b746fa1b783e80d8b89e2b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/472e0df9f0f70801be6a5097799d3fefba9ad078/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/472e0df9f0f70801be6a5097799d3fefba9ad078/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=472e0df9f0f70801be6a5097799d3fefba9ad078", "patch": "@@ -1,3 +1,11 @@\n+2009-05-07  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/40057\n+\t* dojump.c (prefer_and_bit_test): Use immed_double_const instead of\n+\tGEN_INT for 1 << bitnum.\n+\t(do_jump) <case BIT_AND_EXPR>: Use build_int_cst_wide_type instead of\n+\tbuild_int_cst_type.\n+\n 2009-05-07  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* doc/md.texi (Standard Pattern Names For Generation) [sync_nand]:"}, {"sha": "364308513931c11504cdcc3ebd4d60a2ae0aaaee", "filename": "gcc/dojump.c", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/472e0df9f0f70801be6a5097799d3fefba9ad078/gcc%2Fdojump.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/472e0df9f0f70801be6a5097799d3fefba9ad078/gcc%2Fdojump.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdojump.c?ref=472e0df9f0f70801be6a5097799d3fefba9ad078", "patch": "@@ -141,7 +141,8 @@ prefer_and_bit_test (enum machine_mode mode, int bitnum)\n     }\n \n   /* Fill in the integers.  */\n-  XEXP (and_test, 1) = GEN_INT ((unsigned HOST_WIDE_INT) 1 << bitnum);\n+  XEXP (and_test, 1)\n+    = immed_double_const ((unsigned HOST_WIDE_INT) 1 << bitnum, 0, mode);\n   XEXP (XEXP (shift_test, 0), 1) = GEN_INT (bitnum);\n \n   return (rtx_cost (and_test, IF_THEN_ELSE, optimize_insn_for_speed_p ())\n@@ -474,10 +475,10 @@ do_jump (tree exp, rtx if_false_label, rtx if_true_label)\n \t\t  && prefer_and_bit_test (TYPE_MODE (argtype),\n \t\t\t\t\t  TREE_INT_CST_LOW (shift)))\n \t\t{\n-\t\t  HOST_WIDE_INT mask = (HOST_WIDE_INT) 1\n-\t\t\t\t       << TREE_INT_CST_LOW (shift);\n+\t\t  unsigned HOST_WIDE_INT mask\n+\t\t    = (unsigned HOST_WIDE_INT) 1 << TREE_INT_CST_LOW (shift);\n \t\t  do_jump (build2 (BIT_AND_EXPR, argtype, arg,\n-\t\t\t\t   build_int_cst_type (argtype, mask)),\n+\t\t\t\t   build_int_cst_wide_type (argtype, mask, 0)),\n \t\t\t   clr_label, set_label);\n \t\t  break;\n \t\t}"}, {"sha": "eff2991e1a727f9c5d8bb880bc8decc68c517036", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/472e0df9f0f70801be6a5097799d3fefba9ad078/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/472e0df9f0f70801be6a5097799d3fefba9ad078/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=472e0df9f0f70801be6a5097799d3fefba9ad078", "patch": "@@ -1,3 +1,8 @@\n+2009-05-07  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/40057\n+\t* gcc.c-torture/execute/pr40057.c: New test.\n+\n 2009-05-06  James E. Wilson  <wilson@codesourcery.com>\n \n \t* gcc.c-torture/compile/const-high-part.c: New test."}, {"sha": "9d5c4e31e87e2f7be7bf43952ab6552faae50dba", "filename": "gcc/testsuite/gcc.c-torture/execute/pr40057.c", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/472e0df9f0f70801be6a5097799d3fefba9ad078/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr40057.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/472e0df9f0f70801be6a5097799d3fefba9ad078/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr40057.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr40057.c?ref=472e0df9f0f70801be6a5097799d3fefba9ad078", "patch": "@@ -0,0 +1,37 @@\n+/* PR middle-end/40057 */\n+\n+extern void abort (void);\n+\n+__attribute__((noinline)) int\n+foo (unsigned long long x)\n+{\n+  unsigned long long y = (x >> 31ULL) & 1ULL;\n+  if (y == 0ULL)\n+    return 0;\n+  return -1;\n+}\n+\n+__attribute__((noinline)) int\n+bar (long long x)\n+{\n+  long long y = (x >> 31LL) & 1LL;\n+  if (y == 0LL)\n+    return 0;\n+  return -1;\n+}\n+\n+int\n+main (void)\n+{\n+  if (sizeof (long long) != 8)\n+    return 0;\n+  if (foo (0x1682a9aaaULL))\n+    abort ();\n+  if (!foo (0x1882a9aaaULL))\n+    abort ();\n+  if (bar (0x1682a9aaaLL))\n+    abort ();\n+  if (!bar (0x1882a9aaaLL))\n+    abort ();\n+  return 0;\n+}"}]}