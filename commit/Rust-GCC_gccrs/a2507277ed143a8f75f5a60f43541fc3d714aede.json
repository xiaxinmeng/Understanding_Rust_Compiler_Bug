{"sha": "a2507277ed143a8f75f5a60f43541fc3d714aede", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTI1MDcyNzdlZDE0M2E4Zjc1ZjVhNjBmNDM1NDFmYzNkNzE0YWVkZQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2003-08-18T12:44:22Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2003-08-18T12:44:22Z"}, "message": "pt.c (instantiate_class_template): Push to class's scope before tsubsting base.\n\ncp:\n\t* pt.c (instantiate_class_template): Push to class's scope before\n\ttsubsting base.\ntestsuite:\n\t* g++.dg/template/scope2.C: New test.\n\t* g++.dg/template/error2.C: Correct dg-error\n\nFrom-SVN: r70540", "tree": {"sha": "b9b8dd3cfa93329fef867add520e83622dd43de1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b9b8dd3cfa93329fef867add520e83622dd43de1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a2507277ed143a8f75f5a60f43541fc3d714aede", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2507277ed143a8f75f5a60f43541fc3d714aede", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a2507277ed143a8f75f5a60f43541fc3d714aede", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2507277ed143a8f75f5a60f43541fc3d714aede/comments", "author": null, "committer": null, "parents": [{"sha": "5d8725642675ddbb94dc26e8dd03b67369d47d22", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5d8725642675ddbb94dc26e8dd03b67369d47d22", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5d8725642675ddbb94dc26e8dd03b67369d47d22"}], "stats": {"total": 54, "additions": 53, "deletions": 1}, "files": [{"sha": "19562e612a61ce9765ee546a4465a0b8f2a051f7", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2507277ed143a8f75f5a60f43541fc3d714aede/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2507277ed143a8f75f5a60f43541fc3d714aede/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=a2507277ed143a8f75f5a60f43541fc3d714aede", "patch": "@@ -1,3 +1,8 @@\n+2003-08-18  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* pt.c (instantiate_class_template): Push to class's scope before\n+\ttsubsting base.\n+\n Sun Aug 17 10:05:38 CEST 2003  Jan Hubicka  <jh@suse.cz>\n \n \tPR C++/11702"}, {"sha": "e0dfcb787742da035e3b91ef3e6518399cebbf55", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2507277ed143a8f75f5a60f43541fc3d714aede/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2507277ed143a8f75f5a60f43541fc3d714aede/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=a2507277ed143a8f75f5a60f43541fc3d714aede", "patch": "@@ -5173,8 +5173,14 @@ instantiate_class_template (tree type)\n       tree base_list = NULL_TREE;\n       tree pbases = BINFO_BASETYPES (pbinfo);\n       tree paccesses = BINFO_BASEACCESSES (pbinfo);\n+      tree context = TYPE_CONTEXT (type);\n       int i;\n \n+      /* We must enter the scope containing the type, as that is where\n+\t the accessibility of types named in dependent bases are\n+\t looked up from.  */\n+      push_scope (context ? context : global_namespace);\n+  \n       /* Substitute into each of the bases to determine the actual\n \t basetypes.  */\n       for (i = 0; i < TREE_VEC_LENGTH (pbases); ++i)\n@@ -5201,6 +5207,8 @@ instantiate_class_template (tree type)\n       /* Now call xref_basetypes to set up all the base-class\n \t information.  */\n       xref_basetypes (type, base_list);\n+\n+      pop_scope (context ? context : global_namespace);\n     }\n \n   /* Now that our base classes are set up, enter the scope of the"}, {"sha": "6a38f18f506c64312314b09b8485aaf1b61622ac", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2507277ed143a8f75f5a60f43541fc3d714aede/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2507277ed143a8f75f5a60f43541fc3d714aede/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a2507277ed143a8f75f5a60f43541fc3d714aede", "patch": "@@ -1,3 +1,8 @@\n+2003-08-18  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* g++.dg/template/scope2.C: New test.\n+\t* g++.dg/template/error2.C: Correct dg-error\n+\n 2003-08-18  Richard Sandiford  <rsandifo@redhat.com>\n \n \t* gcc.c-torture/compile/mipscop*.c: Turn into compile-only tests."}, {"sha": "0f3e975cd4ff843429db936dcdf8e263e31ca368", "filename": "gcc/testsuite/g++.dg/template/error2.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2507277ed143a8f75f5a60f43541fc3d714aede/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ferror2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2507277ed143a8f75f5a60f43541fc3d714aede/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ferror2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ferror2.C?ref=a2507277ed143a8f75f5a60f43541fc3d714aede", "patch": "@@ -14,7 +14,7 @@ template<class T >\n struct Derived\n {\n   class Nested : public X<T>\n-  { // { dg-error \"instantiated\"\n+  { // { dg-error \"instantiated\" \"\" }\n   };\n   \n   Nested m; // { dg-error \"instantiated\" \"\" }"}, {"sha": "79b520cbeab1788a51fb6f2d8f33a6c1b2d88416", "filename": "gcc/testsuite/g++.dg/template/scope2.C", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2507277ed143a8f75f5a60f43541fc3d714aede/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fscope2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2507277ed143a8f75f5a60f43541fc3d714aede/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fscope2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fscope2.C?ref=a2507277ed143a8f75f5a60f43541fc3d714aede", "patch": "@@ -0,0 +1,34 @@\n+// { dg-do compile }\n+\n+// Copyright (C) 2003 Free Software Foundation, Inc.\n+// Contributed by Nathan Sidwell 15 Aug 2003 <nathan@codesourcery.com>\n+\n+// checked instantiated bases in wrong scope.\n+\n+class Helper {};\n+\n+template<class T> struct X { };\n+\n+template<class T> class Base\n+{\n+  protected:\n+  typedef Helper H;\n+};\n+\n+template<class T >\n+struct Derived : Base<T>\n+{\n+  typedef Base<T> Parent;\n+  typedef typename Parent::H H;\n+  \n+  class Nested : public X<H> {};\n+  \n+  Nested m;\n+  \n+  void Foo ();\n+};\n+\n+void Foo (Derived<char> &x)\n+{\n+  x.Foo ();\n+}"}]}