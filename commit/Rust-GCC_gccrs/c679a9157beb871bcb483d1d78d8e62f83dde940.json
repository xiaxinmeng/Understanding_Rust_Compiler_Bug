{"sha": "c679a9157beb871bcb483d1d78d8e62f83dde940", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzY3OWE5MTU3YmViODcxYmNiNDgzZDFkNzhkOGU2MmY4M2RkZTk0MA==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2010-05-10T21:52:45Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2010-05-10T21:52:45Z"}, "message": "exp_disp.adb (Make_Tags): Mark the imported view of dispatch tables built for interfaces.\n\n\t* exp_disp.adb (Make_Tags): Mark the imported view of dispatch tables\n\tbuilt for interfaces.\n\t* gcc-interface/decl.c (gnat_to_gnu_entity) <E_Variable>: Use\n\timported_p instead of Is_Imported when considering constants.\n\tDo not promote alignment of exported objects.\n\t<E_Record_Subtype>: Strip all suffixes for dispatch table entities.\n\nFrom-SVN: r159247", "tree": {"sha": "5b71d0685e03c2017302b6c00b900592ddfc9e32", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5b71d0685e03c2017302b6c00b900592ddfc9e32"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c679a9157beb871bcb483d1d78d8e62f83dde940", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c679a9157beb871bcb483d1d78d8e62f83dde940", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c679a9157beb871bcb483d1d78d8e62f83dde940", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c679a9157beb871bcb483d1d78d8e62f83dde940/comments", "author": null, "committer": null, "parents": [{"sha": "5a40306bb6bf3f305bc3b6e265aa583c69049449", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5a40306bb6bf3f305bc3b6e265aa583c69049449", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5a40306bb6bf3f305bc3b6e265aa583c69049449"}], "stats": {"total": 64, "additions": 59, "deletions": 5}, "files": [{"sha": "e361cca7a3d6b4ebac301fb863c774e64b90be9e", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c679a9157beb871bcb483d1d78d8e62f83dde940/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c679a9157beb871bcb483d1d78d8e62f83dde940/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=c679a9157beb871bcb483d1d78d8e62f83dde940", "patch": "@@ -1,3 +1,12 @@\n+2010-05-10  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* exp_disp.adb (Make_Tags): Mark the imported view of dispatch tables\n+\tbuilt for interfaces.\n+\t* gcc-interface/decl.c (gnat_to_gnu_entity) <E_Variable>: Use\n+\timported_p instead of Is_Imported when considering constants.\n+\tDo not promote alignment of exported objects.\n+\t<E_Record_Subtype>: Strip all suffixes for dispatch table entities.\n+\n 2010-05-08  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* exp_disp.adb (Make_Tags): Mark the imported view of dispatch tables."}, {"sha": "b7f31c36c4aeb3b9a0a222bb0a9c0a1cab09cf20", "filename": "gcc/ada/exp_disp.adb", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c679a9157beb871bcb483d1d78d8e62f83dde940/gcc%2Fada%2Fexp_disp.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c679a9157beb871bcb483d1d78d8e62f83dde940/gcc%2Fada%2Fexp_disp.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_disp.adb?ref=c679a9157beb871bcb483d1d78d8e62f83dde940", "patch": "@@ -6244,7 +6244,7 @@ package body Exp_Disp is\n       DT               : Node_Id := Empty;\n       DT_Ptr           : Node_Id;\n       Predef_Prims_Ptr : Node_Id;\n-      Iface_DT         : Node_Id;\n+      Iface_DT         : Node_Id := Empty;\n       Iface_DT_Ptr     : Node_Id;\n       New_Node         : Node_Id;\n       Suffix_Index     : Int;\n@@ -6570,6 +6570,11 @@ package body Exp_Disp is\n          Set_Is_Dispatch_Table_Entity (Etype (DT));\n       end if;\n \n+      if Present (Iface_DT) then\n+         Set_Is_Dispatch_Table_Entity (Iface_DT);\n+         Set_Is_Dispatch_Table_Entity (Etype (Iface_DT));\n+      end if;\n+\n       Set_Ekind        (DT_Ptr, E_Constant);\n       Set_Is_Tag       (DT_Ptr);\n       Set_Related_Type (DT_Ptr, Typ);"}, {"sha": "3118cfc2bd463d7447b3ff9e40fbc5a4d36578fe", "filename": "gcc/ada/gcc-interface/decl.c", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c679a9157beb871bcb483d1d78d8e62f83dde940/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c679a9157beb871bcb483d1d78d8e62f83dde940/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Fdecl.c?ref=c679a9157beb871bcb483d1d78d8e62f83dde940", "patch": "@@ -561,7 +561,7 @@ gnat_to_gnu_entity (Entity_Id gnat_entity, tree gnu_expr, int definition)\n \t\t   == N_Object_Declaration)\n \t\t  && Present (Expression (Declaration_Node (gnat_entity))))\n \t\t || Present (Renamed_Object (gnat_entity))\n-\t\t || Is_Imported (gnat_entity)));\n+\t\t || imported_p));\n \tbool inner_const_flag = const_flag;\n \tbool static_p = Is_Statically_Allocated (gnat_entity);\n \tbool mutable_p = false;\n@@ -742,6 +742,7 @@ gnat_to_gnu_entity (Entity_Id gnat_entity, tree gnu_expr, int definition)\n \t\t    && kind != E_Out_Parameter\n \t\t    && Is_Composite_Type (Etype (gnat_entity))\n \t\t    && !Is_Constr_Subt_For_UN_Aliased (Etype (gnat_entity))\n+\t\t    && !Is_Exported (gnat_entity)\n \t\t    && !imported_p\n \t\t    && No (Renamed_Object (gnat_entity))\n \t\t    && No (Address_Clause (gnat_entity))))\n@@ -1000,7 +1001,7 @@ gnat_to_gnu_entity (Entity_Id gnat_entity, tree gnu_expr, int definition)\n \tif ((Treat_As_Volatile (gnat_entity)\n \t     || (!const_flag\n \t\t && (Is_Exported (gnat_entity)\n-\t\t     || Is_Imported (gnat_entity)\n+\t\t     || imported_p\n \t\t     || Present (Address_Clause (gnat_entity)))))\n \t    && !TYPE_VOLATILE (gnu_type))\n \t  gnu_type = build_qualified_type (gnu_type,\n@@ -2984,9 +2985,9 @@ gnat_to_gnu_entity (Entity_Id gnat_entity, tree gnu_expr, int definition)\n \t    {\n \t      char *p;\n \t      Get_Encoded_Name (gnat_entity);\n-\t      p = strrchr (Name_Buffer, '_');\n+\t      p = strchr (Name_Buffer, '_');\n \t      gcc_assert (p);\n-\t      strcpy (p+1, \"dtS\");\n+\t      strcpy (p+2, \"dtS\");\n \t      gnu_entity_name = get_identifier (Name_Buffer);\n \t    }\n "}, {"sha": "81b584b0133ba2aad3a5928984d9226c1b9a8e14", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c679a9157beb871bcb483d1d78d8e62f83dde940/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c679a9157beb871bcb483d1d78d8e62f83dde940/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c679a9157beb871bcb483d1d78d8e62f83dde940", "patch": "@@ -1,3 +1,8 @@\n+2010-05-10  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/lto7.adb: New test.\n+\t* gnat.dg/lto7_pkg.ad[sb]: New helper.\n+\n 2010-05-10  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/44017"}, {"sha": "cb81495a9b1f3fbfd3f0ac52a3db3ea838b04ca8", "filename": "gcc/testsuite/gnat.dg/lto7.adb", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c679a9157beb871bcb483d1d78d8e62f83dde940/gcc%2Ftestsuite%2Fgnat.dg%2Flto7.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c679a9157beb871bcb483d1d78d8e62f83dde940/gcc%2Ftestsuite%2Fgnat.dg%2Flto7.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Flto7.adb?ref=c679a9157beb871bcb483d1d78d8e62f83dde940", "patch": "@@ -0,0 +1,12 @@\n+-- { dg-do run }\n+-- { dg-options \"-flto\" { target lto } }\n+\n+with Lto7_Pkg; use Lto7_Pkg;\n+\n+procedure Lto7 is\n+   view2 : access Iface_2'Class;\n+   obj   : aliased DT := (m_name => \"Abdu\");\n+begin\n+   view2 := Iface_2'Class(obj)'Access;\n+   view2.all.op2;\n+end;"}, {"sha": "dd973dad34a2e57b187a7b7f333461d2f8058704", "filename": "gcc/testsuite/gnat.dg/lto7_pkg.adb", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c679a9157beb871bcb483d1d78d8e62f83dde940/gcc%2Ftestsuite%2Fgnat.dg%2Flto7_pkg.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c679a9157beb871bcb483d1d78d8e62f83dde940/gcc%2Ftestsuite%2Fgnat.dg%2Flto7_pkg.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Flto7_pkg.adb?ref=c679a9157beb871bcb483d1d78d8e62f83dde940", "patch": "@@ -0,0 +1,6 @@\n+package body Lto7_Pkg is\n+\n+   procedure op1 (this : Root) is begin null; end;\n+   procedure op2 (this : DT)   is begin null; end;\n+\n+end Lto7_Pkg;"}, {"sha": "284745fad1249d3af7e721f3a8e3b096088bab66", "filename": "gcc/testsuite/gnat.dg/lto7_pkg.ads", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c679a9157beb871bcb483d1d78d8e62f83dde940/gcc%2Ftestsuite%2Fgnat.dg%2Flto7_pkg.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c679a9157beb871bcb483d1d78d8e62f83dde940/gcc%2Ftestsuite%2Fgnat.dg%2Flto7_pkg.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Flto7_pkg.ads?ref=c679a9157beb871bcb483d1d78d8e62f83dde940", "patch": "@@ -0,0 +1,16 @@\n+package Lto7_Pkg is\n+   type Iface_1 is interface;\n+   procedure op1(this : Iface_1) is abstract;\n+\n+   type Iface_2 is interface;\n+   procedure op2 (this : Iface_2) is abstract;\n+\n+   type Root is new Iface_1 with record\n+      m_name : String(1..4);\n+   end record;\n+\n+   procedure op1 (this : Root);\n+\n+   type DT is new Root and Iface_2 with null record;\n+   procedure op2 (this : DT);\n+end Lto7_Pkg;"}]}