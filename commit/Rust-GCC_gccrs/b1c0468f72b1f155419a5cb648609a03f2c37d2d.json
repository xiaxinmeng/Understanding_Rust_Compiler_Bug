{"sha": "b1c0468f72b1f155419a5cb648609a03f2c37d2d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjFjMDQ2OGY3MmIxZjE1NTQxOWE1Y2I2NDg2MDlhMDNmMmMzN2QyZA==", "commit": {"author": {"name": "Damian Rouson", "email": "damian@sourceryinstitute.org", "date": "2017-04-11T16:34:07Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2017-04-11T16:34:07Z"}, "message": "download_prerequisites (md5_check): New function emulates Linux 'md5 --check' on macOS.\n\n2017-04-11  Damian Rouson  <damian@sourceryinstitute.org>\n\n        * download_prerequisites (md5_check): New function emulates Linux\n        'md5 --check' on macOS.  Modified script for macOS compatibility.\n\nFrom-SVN: r246845", "tree": {"sha": "bb335fd9a5ca10b24f9c1f4637627e94a6991229", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bb335fd9a5ca10b24f9c1f4637627e94a6991229"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b1c0468f72b1f155419a5cb648609a03f2c37d2d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b1c0468f72b1f155419a5cb648609a03f2c37d2d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b1c0468f72b1f155419a5cb648609a03f2c37d2d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b1c0468f72b1f155419a5cb648609a03f2c37d2d/comments", "author": {"login": "rouson", "id": 13108868, "node_id": "MDQ6VXNlcjEzMTA4ODY4", "avatar_url": "https://avatars.githubusercontent.com/u/13108868?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rouson", "html_url": "https://github.com/rouson", "followers_url": "https://api.github.com/users/rouson/followers", "following_url": "https://api.github.com/users/rouson/following{/other_user}", "gists_url": "https://api.github.com/users/rouson/gists{/gist_id}", "starred_url": "https://api.github.com/users/rouson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rouson/subscriptions", "organizations_url": "https://api.github.com/users/rouson/orgs", "repos_url": "https://api.github.com/users/rouson/repos", "events_url": "https://api.github.com/users/rouson/events{/privacy}", "received_events_url": "https://api.github.com/users/rouson/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9b523c934a3bf65645254b811de3333fe18ef40c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b523c934a3bf65645254b811de3333fe18ef40c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9b523c934a3bf65645254b811de3333fe18ef40c"}], "stats": {"total": 68, "additions": 61, "deletions": 7}, "files": [{"sha": "dfe58892f1b18bfbe773f41f4b7402d96619e3ff", "filename": "contrib/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b1c0468f72b1f155419a5cb648609a03f2c37d2d/contrib%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b1c0468f72b1f155419a5cb648609a03f2c37d2d/contrib%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2FChangeLog?ref=b1c0468f72b1f155419a5cb648609a03f2c37d2d", "patch": "@@ -1,3 +1,8 @@\n+2017-04-11  Damian Rouson  <damian@sourceryinstitute.org>\n+\n+        * download_prerequisites (md5_check): New function emulates Linux\n+        'md5 --check' on macOS.  Modified script for macOS compatibility.\n+\n 2017-02-06  Palmer Dabbelt  <palmer@dabbelt.com>\n \n \t* config-list.mki (LIST): Add riscv32-unknown-linux-gun and"}, {"sha": "3430ce1f19e3235b4dc98960b858238bc754ad53", "filename": "contrib/download_prerequisites", "status": "modified", "additions": 56, "deletions": 7, "changes": 63, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b1c0468f72b1f155419a5cb648609a03f2c37d2d/contrib%2Fdownload_prerequisites", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b1c0468f72b1f155419a5cb648609a03f2c37d2d/contrib%2Fdownload_prerequisites", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fdownload_prerequisites?ref=b1c0468f72b1f155419a5cb648609a03f2c37d2d", "patch": "@@ -20,7 +20,6 @@\n # You should have received a copy of the GNU General Public License\n # along with this program. If not, see http://www.gnu.org/licenses/.\n \n-\n program='download_prerequisites'\n version='(unversioned)'\n \n@@ -45,7 +44,23 @@ echo_archives() {\n graphite=1\n verify=1\n force=0\n-chksum='sha512'\n+OS=$(uname)\n+\n+case $OS in\n+  \"Darwin\")\n+    chksum='shasum -a 512 --check'\n+  ;;\n+  *)\n+    chksum='sha512sum --check'\n+  ;;\n+esac\n+\n+if type wget > /dev/null ; then\n+  fetch='wget'\n+else\n+  fetch='curl -LO -u anonymous:'\n+fi\n+chksum_extension='sha512'\n directory='.'\n \n helptext=\"usage: ${program} [OPTION...]\n@@ -95,6 +110,24 @@ do\n done\n unset arg\n \n+# Emulate Linux's 'md5 --check' on macOS\n+md5_check() {\n+  # Store the standard input: a line from contrib/prerequisites.md5:\n+  md5_checksum_line=$(cat -)\n+  # Grab the text before the first space\n+  md5_checksum_expected=\"${md5_checksum_line%% *}\"\n+  # Grab the text after the first space\n+  file_to_check=\"${md5_checksum_line##* }\"\n+  # Calculate the md5 checksum for the downloaded file\n+  md5_checksum_output=$(md5 -r \"${file_to_check}\")\n+  # Grab the text before the first space\n+  md5_checksum_detected=\"${md5_checksum_output%% *}\"\n+  [ \"${md5_checksum_expected}\" == \"${md5_checksum_detected}\" ] \\\n+    || die \"Cannot verify integrity of possibly corrupted file ${file_to_check}\"\n+  echo \"${file_to_check}: OK\"\n+}\n+\n+\n argnext=\n for arg in \"$@\"\n do\n@@ -126,11 +159,27 @@ do\n                 verify=0\n                 ;;\n             --sha512)\n-                chksum='sha512'\n+                case $OS in\n+                  \"Darwin\")\n+                    chksum='shasum -a 512 --check'\n+                  ;;\n+                  *)\n+                    chksum='sha512sum --check'\n+                  ;;\n+                esac\n+                chksum_extension='sha512'\n                 verify=1\n                 ;;\n             --md5)\n-                chksum='md5'\n+                case $OS in\n+                  \"Darwin\")\n+                    chksum='md5_check'\n+                  ;;\n+                  *)\n+                    chksum='md5 --check'\n+                  ;;\n+                esac\n+                chksum_extension='md5'\n                 verify=1\n                 ;;\n             -*)\n@@ -170,19 +219,19 @@ for ar in $(echo_archives)\n do\n     if [ ${force} -gt 0 ]; then rm -f \"${directory}/${ar}\"; fi\n     [ -e \"${directory}/${ar}\" ]                                               \\\n-        || wget --no-verbose -O \"${directory}/${ar}\" \"${base_url}${ar}\"       \\\n+        || ${fetch} --no-verbose -O \"${directory}/${ar}\" \"${base_url}${ar}\"       \\\n         || die \"Cannot download ${ar} from ${base_url}\"\n done\n unset ar\n \n if [ ${verify} -gt 0 ]\n then\n-    chksumfile=\"contrib/prerequisites.${chksum}\"\n+    chksumfile=\"contrib/prerequisites.${chksum_extension}\"\n     [ -r \"${chksumfile}\" ] || die \"No checksums available\"\n     for ar in $(echo_archives)\n     do\n         grep \"${ar}\" \"${chksumfile}\"                                          \\\n-            | ( cd \"${directory}\" && \"${chksum}sum\" --check )                 \\\n+            | ( cd \"${directory}\" && ${chksum} )                              \\\n             || die \"Cannot verify integrity of possibly corrupted file ${ar}\"\n     done\n     unset chksumfile"}]}