{"sha": "3f30f2d1dbb3228b8468b26239fe60c2974ce2ac", "node_id": "C_kwDOANBUbNoAKDNmMzBmMmQxZGJiMzIyOGI4NDY4YjI2MjM5ZmU2MGMyOTc0Y2UyYWM", "commit": {"author": {"name": "Bill Schmidt", "email": "wschmidt@linux.ibm.com", "date": "2022-02-03T03:24:22Z"}, "committer": {"name": "Bill Schmidt", "email": "wschmidt@linux.ibm.com", "date": "2022-02-03T17:17:18Z"}, "message": "rs6000: Fix LE code gen for vec_cnt[lt]z_lsbb [PR95082]\n\nThese built-ins were misimplemented as always having big-endian semantics.\n\n2022-01-18  Bill Schmidt  <wschmidt@linux.ibm.com>\n\ngcc/\n\tPR target/95082\n\t* config/rs6000/rs6000-builtin.cc (rs6000_expand_builtin): Handle\n\tendianness for vclzlsbb and vctzlsbb.\n\t* config/rs6000/rs6000-builtins.def (VCLZLSBB_V16QI): Change\n\tdefault pattern and indicate a different pattern will be used for\n\tbig endian.\n\t(VCLZLSBB_V4SI): Likewise.\n\t(VCLZLSBB_V8HI): Likewise.\n\t(VCTZLSBB_V16QI): Likewise.\n\t(VCTZLSBB_V4SI): Likewise.\n\t(VCTZLSBB_V8HI): Likewise.\n\ngcc/testsuite/\n\tPR target/95082\n\t* gcc.target/powerpc/vsu/vec-cntlz-lsbb-0.c: Restrict to -mbig.\n\t* gcc.target/powerpc/vsu/vec-cntlz-lsbb-1.c: Likewise.\n\t* gcc.target/powerpc/vsu/vec-cntlz-lsbb-3.c: New.\n\t* gcc.target/powerpc/vsu/vec-cntlz-lsbb-4.c: New.\n\t* gcc.target/powerpc/vsu/vec-cnttz-lsbb-0.c: Restrict to -mbig.\n\t* gcc.target/powerpc/vsu/vec-cnttz-lsbb-1.c: Likewise.\n\t* gcc.target/powerpc/vsu/vec-cnttz-lsbb-3.c: New.\n\t* gcc.target/powerpc/vsu/vec-cnttz-lsbb-4.c: New.", "tree": {"sha": "1e0093d4b7d93b42d43e077a90d4d2fffc9a8e39", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1e0093d4b7d93b42d43e077a90d4d2fffc9a8e39"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/comments", "author": null, "committer": null, "parents": [{"sha": "eecee223f435fa01fb07a2fdba1615b89627d710", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eecee223f435fa01fb07a2fdba1615b89627d710", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eecee223f435fa01fb07a2fdba1615b89627d710"}], "stats": {"total": 92, "additions": 82, "deletions": 10}, "files": [{"sha": "69f8cee5b280c5134f5863c81fc1add0ca104d04", "filename": "gcc/config/rs6000/rs6000-builtin.cc", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Fconfig%2Frs6000%2Frs6000-builtin.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Fconfig%2Frs6000%2Frs6000-builtin.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000-builtin.cc?ref=3f30f2d1dbb3228b8468b26239fe60c2974ce2ac", "patch": "@@ -3485,6 +3485,18 @@ rs6000_expand_builtin (tree exp, rtx target, rtx /* subtarget */,\n \ticode = CODE_FOR_vsx_store_v8hi;\n       else if (fcode == RS6000_BIF_ST_ELEMREV_V16QI)\n \ticode = CODE_FOR_vsx_store_v16qi;\n+      else if (fcode == RS6000_BIF_VCLZLSBB_V16QI)\n+\ticode = CODE_FOR_vclzlsbb_v16qi;\n+      else if (fcode == RS6000_BIF_VCLZLSBB_V4SI)\n+\ticode = CODE_FOR_vclzlsbb_v4si;\n+      else if (fcode == RS6000_BIF_VCLZLSBB_V8HI)\n+\ticode = CODE_FOR_vclzlsbb_v8hi;\n+      else if (fcode == RS6000_BIF_VCTZLSBB_V16QI)\n+\ticode = CODE_FOR_vctzlsbb_v16qi;\n+      else if (fcode == RS6000_BIF_VCTZLSBB_V4SI)\n+\ticode = CODE_FOR_vctzlsbb_v4si;\n+      else if (fcode == RS6000_BIF_VCTZLSBB_V8HI)\n+\ticode = CODE_FOR_vctzlsbb_v8hi;\n       else\n \tgcc_unreachable ();\n     }"}, {"sha": "7f527b6709fbcb4da27d0e6313603c6ffecfe075", "filename": "gcc/config/rs6000/rs6000-builtins.def", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Fconfig%2Frs6000%2Frs6000-builtins.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Fconfig%2Frs6000%2Frs6000-builtins.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000-builtins.def?ref=3f30f2d1dbb3228b8468b26239fe60c2974ce2ac", "patch": "@@ -2550,13 +2550,13 @@\n     VBPERMD altivec_vbpermd {}\n \n   const signed int __builtin_altivec_vclzlsbb_v16qi (vsc);\n-    VCLZLSBB_V16QI vclzlsbb_v16qi {}\n+    VCLZLSBB_V16QI vctzlsbb_v16qi {endian}\n \n   const signed int __builtin_altivec_vclzlsbb_v4si (vsi);\n-    VCLZLSBB_V4SI vclzlsbb_v4si {}\n+    VCLZLSBB_V4SI vctzlsbb_v4si {endian}\n \n   const signed int __builtin_altivec_vclzlsbb_v8hi (vss);\n-    VCLZLSBB_V8HI vclzlsbb_v8hi {}\n+    VCLZLSBB_V8HI vctzlsbb_v8hi {endian}\n \n   const vsc __builtin_altivec_vctzb (vsc);\n     VCTZB ctzv16qi2 {}\n@@ -2571,13 +2571,13 @@\n     VCTZW ctzv4si2 {}\n \n   const signed int __builtin_altivec_vctzlsbb_v16qi (vsc);\n-    VCTZLSBB_V16QI vctzlsbb_v16qi {}\n+    VCTZLSBB_V16QI vclzlsbb_v16qi {endian}\n \n   const signed int __builtin_altivec_vctzlsbb_v4si (vsi);\n-    VCTZLSBB_V4SI vctzlsbb_v4si {}\n+    VCTZLSBB_V4SI vclzlsbb_v4si {endian}\n \n   const signed int __builtin_altivec_vctzlsbb_v8hi (vss);\n-    VCTZLSBB_V8HI vctzlsbb_v8hi {}\n+    VCTZLSBB_V8HI vclzlsbb_v8hi {endian}\n \n   const signed int __builtin_altivec_vcmpaeb_p (vsc, vsc);\n     VCMPAEB_P vector_ae_v16qi_p {}"}, {"sha": "dc92d6fdd655b6f3c9d56334b1d674d72a460684", "filename": "gcc/testsuite/gcc.target/powerpc/vsu/vec-cntlz-lsbb-0.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cntlz-lsbb-0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cntlz-lsbb-0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cntlz-lsbb-0.c?ref=3f30f2d1dbb3228b8468b26239fe60c2974ce2ac", "patch": "@@ -1,6 +1,6 @@\n /* { dg-do compile { target { powerpc*-*-* } } } */\n /* { dg-require-effective-target powerpc_p9vector_ok } */\n-/* { dg-options \"-mdejagnu-cpu=power9\" } */\n+/* { dg-options \"-mdejagnu-cpu=power9 -mbig\" } */\n \n #include <altivec.h>\n "}, {"sha": "6fefb8939368c23528b1fce6a9bc62ede131abe3", "filename": "gcc/testsuite/gcc.target/powerpc/vsu/vec-cntlz-lsbb-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cntlz-lsbb-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cntlz-lsbb-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cntlz-lsbb-1.c?ref=3f30f2d1dbb3228b8468b26239fe60c2974ce2ac", "patch": "@@ -1,6 +1,6 @@\n /* { dg-do compile { target { powerpc*-*-* } } } */\n /* { dg-require-effective-target powerpc_p9vector_ok } */\n-/* { dg-options \"-mdejagnu-cpu=power9\" } */\n+/* { dg-options \"-mdejagnu-cpu=power9 -mbig\" } */\n \n #include <altivec.h>\n "}, {"sha": "6ee31a11aee8d5562d4d21d695d2070bc1f3e3ca", "filename": "gcc/testsuite/gcc.target/powerpc/vsu/vec-cntlz-lsbb-3.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cntlz-lsbb-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cntlz-lsbb-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cntlz-lsbb-3.c?ref=3f30f2d1dbb3228b8468b26239fe60c2974ce2ac", "patch": "@@ -0,0 +1,15 @@\n+/* { dg-do compile { target { powerpc*-*-* } } } */\n+/* { dg-require-effective-target powerpc_p9vector_ok } */\n+/* { dg-options \"-mdejagnu-cpu=power9 -mlittle\" } */\n+\n+#include <altivec.h>\n+\n+int\n+count_leading_zero_byte_bits (vector signed char *arg1_p)\n+{\n+  vector signed char arg_1 = *arg1_p;\n+\n+  return vec_cntlz_lsbb (arg_1);\n+}\n+\n+/* { dg-final { scan-assembler \"vctzlsbb\" } } */"}, {"sha": "6105091b016319817ecd64b9b254cd6b38ae5c35", "filename": "gcc/testsuite/gcc.target/powerpc/vsu/vec-cntlz-lsbb-4.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cntlz-lsbb-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cntlz-lsbb-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cntlz-lsbb-4.c?ref=3f30f2d1dbb3228b8468b26239fe60c2974ce2ac", "patch": "@@ -0,0 +1,15 @@\n+/* { dg-do compile { target { powerpc*-*-* } } } */\n+/* { dg-require-effective-target powerpc_p9vector_ok } */\n+/* { dg-options \"-mdejagnu-cpu=power9 -mlittle\" } */\n+\n+#include <altivec.h>\n+\n+int\n+count_leading_zero_byte_bits (vector unsigned char *arg1_p)\n+{\n+  vector unsigned char arg_1 = *arg1_p;\n+\n+  return vec_cntlz_lsbb (arg_1);\n+}\n+\n+/* { dg-final { scan-assembler \"vctzlsbb\" } } */"}, {"sha": "68d6c5ff4e828ea6412086829850936652d48574", "filename": "gcc/testsuite/gcc.target/powerpc/vsu/vec-cnttz-lsbb-0.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cnttz-lsbb-0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cnttz-lsbb-0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cnttz-lsbb-0.c?ref=3f30f2d1dbb3228b8468b26239fe60c2974ce2ac", "patch": "@@ -1,6 +1,6 @@\n /* { dg-do compile { target { powerpc*-*-* } } } */\n /* { dg-require-effective-target powerpc_p9vector_ok } */\n-/* { dg-options \"-mdejagnu-cpu=power9\" } */\n+/* { dg-options \"-mdejagnu-cpu=power9 -mbig\" } */\n \n #include <altivec.h>\n "}, {"sha": "f971ea0a807070abcbb5ae35cd1a06564136baef", "filename": "gcc/testsuite/gcc.target/powerpc/vsu/vec-cnttz-lsbb-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cnttz-lsbb-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cnttz-lsbb-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cnttz-lsbb-1.c?ref=3f30f2d1dbb3228b8468b26239fe60c2974ce2ac", "patch": "@@ -1,6 +1,6 @@\n /* { dg-do compile { target { powerpc*-*-* } } } */\n /* { dg-require-effective-target powerpc_p9vector_ok } */\n-/* { dg-options \"-mdejagnu-cpu=power9\" } */\n+/* { dg-options \"-mdejagnu-cpu=power9 -mbig\" } */\n \n #include <altivec.h>\n "}, {"sha": "a9245d8200c05c4caf4c60ed7405f070ac7fef5f", "filename": "gcc/testsuite/gcc.target/powerpc/vsu/vec-cnttz-lsbb-3.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cnttz-lsbb-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cnttz-lsbb-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cnttz-lsbb-3.c?ref=3f30f2d1dbb3228b8468b26239fe60c2974ce2ac", "patch": "@@ -0,0 +1,15 @@\n+/* { dg-do compile { target { powerpc*-*-* } } } */\n+/* { dg-require-effective-target powerpc_p9vector_ok } */\n+/* { dg-options \"-mdejagnu-cpu=power9 -mlittle\" } */\n+\n+#include <altivec.h>\n+\n+int\n+count_trailing_zero_byte_bits (vector signed char *arg1_p)\n+{\n+  vector signed char arg_1 = *arg1_p;\n+\n+  return vec_cnttz_lsbb (arg_1);\n+}\n+\n+/* { dg-final { scan-assembler \"vclzlsbb\" } } */"}, {"sha": "71fea5306c1e8603e60eb5065245a3d9d3436d91", "filename": "gcc/testsuite/gcc.target/powerpc/vsu/vec-cnttz-lsbb-4.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cnttz-lsbb-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f30f2d1dbb3228b8468b26239fe60c2974ce2ac/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cnttz-lsbb-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fvsu%2Fvec-cnttz-lsbb-4.c?ref=3f30f2d1dbb3228b8468b26239fe60c2974ce2ac", "patch": "@@ -0,0 +1,15 @@\n+/* { dg-do compile { target { powerpc*-*-* } } } */\n+/* { dg-require-effective-target powerpc_p9vector_ok } */\n+/* { dg-options \"-mdejagnu-cpu=power9 -mlittle\" } */\n+\n+#include <altivec.h>\n+\n+int\n+count_trailing_zero_byte_bits (vector unsigned char *arg1_p)\n+{\n+  vector unsigned char arg_1 = *arg1_p;\n+\n+  return vec_cnttz_lsbb (arg_1);\n+}\n+\n+/* { dg-final { scan-assembler \"vclzlsbb\" } } */"}]}