{"sha": "bd1cab35c5eabf51d9392751036fa3a71758d263", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmQxY2FiMzVjNWVhYmY1MWQ5MzkyNzUxMDM2ZmEzYTcxNzU4ZDI2Mw==", "commit": {"author": {"name": "Chung-Lin Tang", "email": "cltang@codesourcery.com", "date": "2018-05-31T14:10:10Z"}, "committer": {"name": "Cesar Philippidis", "email": "cesar@gcc.gnu.org", "date": "2018-05-31T14:10:10Z"}, "message": "re PR middle-end/85879 (ICE in expand_debug_locations, at cfgexpand.c:5405)\n\nFix PR middle-end/85879\n\n\tgcc/\n\t* gimplify.c (gimplify_adjust_omp_clauses): Add 'remove = true'\n\twhen emitting error on private/firstprivate reductions.\n\t* omp-low.c (lower_omp_target): Avoid reference-type processing\n\ton pointers for firstprivate clause.\n\n\tgcc/testsuite/\n\t* gfortran.dg/goacc/pr77371-1.f90: New test.\n\t* gfortran.dg/goacc/pr77371-2.f90: New test.\n\t* gfortran.dg/goacc/pr85879.f90: New test.\n\nCo-Authored-By: Cesar Philippidis <cesar@codesourcery.com>\n\nFrom-SVN: r261025", "tree": {"sha": "b3173fd010fc1a205b8af74f166a3e091a389ad5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b3173fd010fc1a205b8af74f166a3e091a389ad5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bd1cab35c5eabf51d9392751036fa3a71758d263", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bd1cab35c5eabf51d9392751036fa3a71758d263", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bd1cab35c5eabf51d9392751036fa3a71758d263", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bd1cab35c5eabf51d9392751036fa3a71758d263/comments", "author": {"login": "cltang", "id": 4055966, "node_id": "MDQ6VXNlcjQwNTU5NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/4055966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cltang", "html_url": "https://github.com/cltang", "followers_url": "https://api.github.com/users/cltang/followers", "following_url": "https://api.github.com/users/cltang/following{/other_user}", "gists_url": "https://api.github.com/users/cltang/gists{/gist_id}", "starred_url": "https://api.github.com/users/cltang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cltang/subscriptions", "organizations_url": "https://api.github.com/users/cltang/orgs", "repos_url": "https://api.github.com/users/cltang/repos", "events_url": "https://api.github.com/users/cltang/events{/privacy}", "received_events_url": "https://api.github.com/users/cltang/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "22f1f4c790759674d47b704e0faa140343e542d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/22f1f4c790759674d47b704e0faa140343e542d5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/22f1f4c790759674d47b704e0faa140343e542d5"}], "stats": {"total": 57, "additions": 53, "deletions": 4}, "files": [{"sha": "c9cf570599c20c998db3db5fb729ce5171c67497", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bd1cab35c5eabf51d9392751036fa3a71758d263/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bd1cab35c5eabf51d9392751036fa3a71758d263/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bd1cab35c5eabf51d9392751036fa3a71758d263", "patch": "@@ -1,3 +1,12 @@\n+2018-05-31  Chung-Lin Tang  <cltang@codesourcery.com>\n+\t    Cesar Philippidis  <cesar@codesourcery.com>\n+\n+\tPR middle-end/85879\n+\t* gimplify.c (gimplify_adjust_omp_clauses): Add 'remove = true'\n+\twhen emitting error on private/firstprivate reductions.\n+\t* omp-low.c (lower_omp_target): Avoid reference-type processing\n+\ton pointers for firstprivate clause.\n+\n 2018-05-31 Sameera Deshpande <sameera.deshpande@linaro.org>\n \n \t* config/aarch64/aarch64-simd-builtins.def (ld1x3): New."}, {"sha": "44cb784620afb4f3316ed85436498e2aea079f99", "filename": "gcc/gimplify.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bd1cab35c5eabf51d9392751036fa3a71758d263/gcc%2Fgimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bd1cab35c5eabf51d9392751036fa3a71758d263/gcc%2Fgimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimplify.c?ref=bd1cab35c5eabf51d9392751036fa3a71758d263", "patch": "@@ -9275,13 +9275,16 @@ gimplify_adjust_omp_clauses (gimple_seq *pre_p, gimple_seq body, tree *list_p,\n \tcase OMP_CLAUSE_REDUCTION:\n \t  decl = OMP_CLAUSE_DECL (c);\n \t  /* OpenACC reductions need a present_or_copy data clause.\n-\t     Add one if necessary.  Error is the reduction is private.  */\n+\t     Add one if necessary.  Emit error when the reduction is private.  */\n \t  if (ctx->region_type == ORT_ACC_PARALLEL)\n \t    {\n \t      n = splay_tree_lookup (ctx->variables, (splay_tree_key) decl);\n \t      if (n->value & (GOVD_PRIVATE | GOVD_FIRSTPRIVATE))\n-\t\terror_at (OMP_CLAUSE_LOCATION (c), \"invalid private \"\n-\t\t\t  \"reduction on %qE\", DECL_NAME (decl));\n+\t\t{\n+\t\t  remove = true;\n+\t\t  error_at (OMP_CLAUSE_LOCATION (c), \"invalid private \"\n+\t\t\t    \"reduction on %qE\", DECL_NAME (decl));\n+\t\t}\n \t      else if ((n->value & GOVD_MAP) == 0)\n \t\t{\n \t\t  tree next = OMP_CLAUSE_CHAIN (c);"}, {"sha": "ba6c705cf8bd6959db4b48da1900ec1e3de37b8c", "filename": "gcc/omp-low.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bd1cab35c5eabf51d9392751036fa3a71758d263/gcc%2Fomp-low.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bd1cab35c5eabf51d9392751036fa3a71758d263/gcc%2Fomp-low.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-low.c?ref=bd1cab35c5eabf51d9392751036fa3a71758d263", "patch": "@@ -7700,7 +7700,8 @@ lower_omp_target (gimple_stmt_iterator *gsi_p, omp_context *ctx)\n \t    if (OMP_CLAUSE_CODE (c) == OMP_CLAUSE_FIRSTPRIVATE)\n \t      {\n \t\tgcc_assert (is_gimple_omp_oacc (ctx->stmt));\n-\t\tif (omp_is_reference (new_var))\n+\t\tif (omp_is_reference (new_var)\n+\t\t    && TREE_CODE (TREE_TYPE (new_var)) != POINTER_TYPE)\n \t\t  {\n \t\t    /* Create a local object to hold the instance\n \t\t       value.  */"}, {"sha": "188ea7d7ed5d8bda4e3481b46f28cc5631ae05a9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bd1cab35c5eabf51d9392751036fa3a71758d263/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bd1cab35c5eabf51d9392751036fa3a71758d263/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bd1cab35c5eabf51d9392751036fa3a71758d263", "patch": "@@ -1,3 +1,11 @@\n+2018-05-31  Chung-Lin Tang  <cltang@codesourcery.com>\n+\t    Cesar Philippidis  <cesar@codesourcery.com>\n+\n+\tPR middle-end/85879\n+\t* gfortran.dg/goacc/pr77371-1.f90: New test.\n+\t* gfortran.dg/goacc/pr77371-2.f90: New test.\n+\t* gfortran.dg/goacc/pr85879.f90: New test.\n+\n 2018-05-31  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/stack_usage1.adb: Replace -fstack-usage with -Wstack-usage."}, {"sha": "11c29ba3e6d90a4d8d8b732b86018ccd46e017d0", "filename": "gcc/testsuite/gfortran.dg/goacc/pr77371-1.f90", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bd1cab35c5eabf51d9392751036fa3a71758d263/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr77371-1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bd1cab35c5eabf51d9392751036fa3a71758d263/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr77371-1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr77371-1.f90?ref=bd1cab35c5eabf51d9392751036fa3a71758d263", "patch": "@@ -0,0 +1,9 @@\n+! PR fortran/77371\n+! { dg-do compile }\n+program p\n+  character(:), allocatable :: z\n+  !$acc parallel\n+  z = 'abc' \n+  !$acc end parallel\n+  print *, z\n+end"}, {"sha": "9d42c17ac4e98e92be1f3b79ae89dfa88fe1a08b", "filename": "gcc/testsuite/gfortran.dg/goacc/pr77371-2.f90", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bd1cab35c5eabf51d9392751036fa3a71758d263/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr77371-2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bd1cab35c5eabf51d9392751036fa3a71758d263/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr77371-2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr77371-2.f90?ref=bd1cab35c5eabf51d9392751036fa3a71758d263", "patch": "@@ -0,0 +1,7 @@\n+! PR fortran/77371\n+! { dg-do compile }\n+program p\n+   integer, allocatable :: n\n+!$acc parallel reduction (+:n) private(n) ! { dg-error \"invalid private reduction\" }\n+!$acc end parallel\n+end"}, {"sha": "cd50be2fdb47af16934b3db8db1f06c14d36f762", "filename": "gcc/testsuite/gfortran.dg/goacc/pr85879.f90", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bd1cab35c5eabf51d9392751036fa3a71758d263/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr85879.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bd1cab35c5eabf51d9392751036fa3a71758d263/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr85879.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr85879.f90?ref=bd1cab35c5eabf51d9392751036fa3a71758d263", "patch": "@@ -0,0 +1,12 @@\n+! PR middle-end/85879\n+! { dg-do compile }\n+\n+program p\n+   integer, pointer :: i\n+   integer, target :: j\n+   j = 2\n+   i => j\n+   !$acc parallel\n+   j = i\n+   !$acc end parallel\n+end"}]}