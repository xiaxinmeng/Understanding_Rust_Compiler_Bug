{"sha": "df8fe4adb0721ab0e4486bc58482b501fe06287d", "node_id": "C_kwDOANBUbNoAKGRmOGZlNGFkYjA3MjFhYjBlNDQ4NmJjNTg0ODJiNTAxZmUwNjI4N2Q", "commit": {"author": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2022-08-29T15:52:20Z"}, "committer": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2022-08-30T09:26:24Z"}, "message": "A == 0 ? A : -A    same as -A (when A is 0.0)\n\nThe upcoming work for frange triggers a regression in\ngcc.dg/tree-ssa/phi-opt-24.c.\n\nFor -O2 -fno-signed-zeros, we fail to transform the following into -A:\n\nfloat f0(float A)\n{\n  //     A == 0? A : -A    same as -A\n  if (A == 0)  return A;\n  return -A;\n}\n\nThis is because the abs/negative match.pd pattern here:\n\n/* abs/negative simplifications moved from fold_cond_expr_with_comparison,\n   Need to handle (A - B) case as fold_cond_expr_with_comparison does.\n   Need to handle UN* comparisons.\n   ...\n   ...\n\nSees IL that has the 0.0 propagated.\n\nInstead of:\n\n  <bb 2> [local count: 1073741824]:\n  if (A_2(D) == 0.0)\n    goto <bb 4>; [34.00%]\n  else\n    goto <bb 3>; [66.00%]\n\n  <bb 3> [local count: 708669601]:\n  _3 = -A_2(D);\n\n  <bb 4> [local count: 1073741824]:\n  # _1 = PHI <A_2(D)(2), _3(3)>\n\nIt now sees:\n\n  <bb 4> [local count: 1073741824]:\n  # _1 = PHI <0.0(2), _3(3)>\n\nwhich it leaves untouched, causing the if conditional to survive.\n\nChanging integger_zerop to zerop fixes the problem.\n\nI did not include a testcase, as it's just phi-opt-24.c which will get\ntriggered when I commit the frange with endpoints work.\n\ngcc/ChangeLog:\n\n\t* match.pd ((cmp @0 zerop) real_zerop (negate@1 @0)): Add variant\n\tfor real zero.", "tree": {"sha": "57f8aa32e21771f4d329930f4525d926177317e6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/57f8aa32e21771f4d329930f4525d926177317e6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/df8fe4adb0721ab0e4486bc58482b501fe06287d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df8fe4adb0721ab0e4486bc58482b501fe06287d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/df8fe4adb0721ab0e4486bc58482b501fe06287d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df8fe4adb0721ab0e4486bc58482b501fe06287d/comments", "author": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "34ad7155fe2a4a5d0b1815c79ce8b2af4c772c9e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/34ad7155fe2a4a5d0b1815c79ce8b2af4c772c9e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/34ad7155fe2a4a5d0b1815c79ce8b2af4c772c9e"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "f5fec6342798c47b7efae5b8648f164d3c7d693b", "filename": "gcc/match.pd", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df8fe4adb0721ab0e4486bc58482b501fe06287d/gcc%2Fmatch.pd", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df8fe4adb0721ab0e4486bc58482b501fe06287d/gcc%2Fmatch.pd", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmatch.pd?ref=df8fe4adb0721ab0e4486bc58482b501fe06287d", "patch": "@@ -4804,7 +4804,7 @@ DEFINE_INT_AND_FLOAT_ROUND_FN (RINT)\n     (if (!HONOR_SIGNED_ZEROS (type))\n      @1))\n   (simplify\n-   (cnd (cmp @0 zerop) integer_zerop (negate@1 @0))\n+   (cnd (cmp @0 zerop) zerop (negate@1 @0))\n     (if (!HONOR_SIGNED_ZEROS (type))\n      @1))\n  )"}]}