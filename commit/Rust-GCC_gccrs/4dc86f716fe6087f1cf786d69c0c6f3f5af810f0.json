{"sha": "4dc86f716fe6087f1cf786d69c0c6f3f5af810f0", "node_id": "C_kwDOANBUbNoAKDRkYzg2ZjcxNmZlNjA4N2YxY2Y3ODZkNjljMGM2ZjNmNWFmODEwZjA", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-05-11T13:44:57Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-05-11T17:50:39Z"}, "message": "c++: fix arm-eabi bootstrap [PR105567]\n\nSince my r13-112, in the template we were changing 'return' to 'return this'\non cdtor_returns_this targets, and then getting confused by that when\ninstantiating.  So only make that change at instantiation time.\n\n\tPR bootstrap/105567\n\ngcc/cp/ChangeLog:\n\n\t* typeck.cc (check_return_expr): Don't mess with ctor return value\n\twhile parsing a template.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/template/ctor10.C: New test.", "tree": {"sha": "7b5cda30b62f9adc5d5c258f50d79b0110d4ac00", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7b5cda30b62f9adc5d5c258f50d79b0110d4ac00"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4dc86f716fe6087f1cf786d69c0c6f3f5af810f0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4dc86f716fe6087f1cf786d69c0c6f3f5af810f0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4dc86f716fe6087f1cf786d69c0c6f3f5af810f0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4dc86f716fe6087f1cf786d69c0c6f3f5af810f0/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0acdbe29f66017fc5cca40dcbd72a0dd41491d07", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0acdbe29f66017fc5cca40dcbd72a0dd41491d07", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0acdbe29f66017fc5cca40dcbd72a0dd41491d07"}], "stats": {"total": 14, "additions": 12, "deletions": 2}, "files": [{"sha": "6ecdd97697d7e04617b38747872fca8892809dfa", "filename": "gcc/cp/typeck.cc", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4dc86f716fe6087f1cf786d69c0c6f3f5af810f0/gcc%2Fcp%2Ftypeck.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4dc86f716fe6087f1cf786d69c0c6f3f5af810f0/gcc%2Fcp%2Ftypeck.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck.cc?ref=4dc86f716fe6087f1cf786d69c0c6f3f5af810f0", "patch": "@@ -10448,7 +10448,7 @@ check_return_expr (tree retval, bool *no_warning)\n       if (retval)\n \terror_at (loc, \"returning a value from a destructor\");\n \n-      if (targetm.cxx.cdtor_returns_this ())\n+      if (targetm.cxx.cdtor_returns_this () && !processing_template_decl)\n \tretval = current_class_ptr;\n       else\n \treturn NULL_TREE;\n@@ -10463,7 +10463,7 @@ check_return_expr (tree retval, bool *no_warning)\n \t/* You can't return a value from a constructor.  */\n \terror_at (loc, \"returning a value from a constructor\");\n \n-      if (targetm.cxx.cdtor_returns_this ())\n+      if (targetm.cxx.cdtor_returns_this () && !processing_template_decl)\n \tretval = current_class_ptr;\n       else\n \treturn NULL_TREE;"}, {"sha": "cf10fc5b19ae5d648d4c58a6119f70ec32fbf37a", "filename": "gcc/testsuite/g++.dg/template/ctor10.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4dc86f716fe6087f1cf786d69c0c6f3f5af810f0/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fctor10.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4dc86f716fe6087f1cf786d69c0c6f3f5af810f0/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fctor10.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fctor10.C?ref=4dc86f716fe6087f1cf786d69c0c6f3f5af810f0", "patch": "@@ -0,0 +1,10 @@\n+// PR bootstrap/105567\n+// This was breaking with cdtor_returns_this.\n+\n+template <class T>\n+struct A\n+{\n+  A() { return; }\n+};\n+\n+A<int> a;"}]}