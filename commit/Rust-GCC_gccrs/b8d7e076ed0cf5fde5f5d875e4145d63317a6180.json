{"sha": "b8d7e076ed0cf5fde5f5d875e4145d63317a6180", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjhkN2UwNzZlZDBjZjVmZGU1ZjVkODc1ZTQxNDVkNjMzMTdhNjE4MA==", "commit": {"author": {"name": "Kito Cheng", "email": "kito.cheng@gmail.com", "date": "2017-12-13T06:25:06Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "2017-12-13T06:25:06Z"}, "message": "Use C version of multi3 for RVE support.\n\n\tlibgcc/\n\t* config/riscv/t-elf: Use multi3.c instead of multi3.S.\n\t* config/riscv/multi3.c: New file.\n\t* config/riscv/multi3.S: Remove.\n\nFrom-SVN: r255598", "tree": {"sha": "f456399ff4a729c9702a67f54499856a3869b3cd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f456399ff4a729c9702a67f54499856a3869b3cd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b8d7e076ed0cf5fde5f5d875e4145d63317a6180", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8d7e076ed0cf5fde5f5d875e4145d63317a6180", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b8d7e076ed0cf5fde5f5d875e4145d63317a6180", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8d7e076ed0cf5fde5f5d875e4145d63317a6180/comments", "author": {"login": "kito-cheng", "id": 2723185, "node_id": "MDQ6VXNlcjI3MjMxODU=", "avatar_url": "https://avatars.githubusercontent.com/u/2723185?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kito-cheng", "html_url": "https://github.com/kito-cheng", "followers_url": "https://api.github.com/users/kito-cheng/followers", "following_url": "https://api.github.com/users/kito-cheng/following{/other_user}", "gists_url": "https://api.github.com/users/kito-cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/kito-cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kito-cheng/subscriptions", "organizations_url": "https://api.github.com/users/kito-cheng/orgs", "repos_url": "https://api.github.com/users/kito-cheng/repos", "events_url": "https://api.github.com/users/kito-cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/kito-cheng/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9e921ddb437b0ce607d234caa08423addef5ff2e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e921ddb437b0ce607d234caa08423addef5ff2e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9e921ddb437b0ce607d234caa08423addef5ff2e"}], "stats": {"total": 184, "additions": 93, "deletions": 91}, "files": [{"sha": "b7956211440229e63ac910abe924107a08bf1387", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8d7e076ed0cf5fde5f5d875e4145d63317a6180/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8d7e076ed0cf5fde5f5d875e4145d63317a6180/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=b8d7e076ed0cf5fde5f5d875e4145d63317a6180", "patch": "@@ -1,3 +1,9 @@\n+2017-12-12  Kito Cheng <kito.cheng@gmail.com>\n+\n+\t* config/riscv/t-elf: Use multi3.c instead of multi3.S.\n+\t* config/riscv/multi3.c: New file.\n+\t* config/riscv/multi3.S: Remove.\n+\n 2017-12-08  Jim Wilson  <jimw@sifive.com>\n \n \t* config/riscv/div.S: Use FUNC_* macros."}, {"sha": "a3b89c65206b0dfb24ad8617729bbad2cd21b66b", "filename": "libgcc/config/riscv/multi3.S", "status": "removed", "additions": 0, "deletions": 90, "changes": 90, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e921ddb437b0ce607d234caa08423addef5ff2e/libgcc%2Fconfig%2Friscv%2Fmulti3.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e921ddb437b0ce607d234caa08423addef5ff2e/libgcc%2Fconfig%2Friscv%2Fmulti3.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Friscv%2Fmulti3.S?ref=9e921ddb437b0ce607d234caa08423addef5ff2e", "patch": "@@ -1,90 +0,0 @@\n-/* Integer multiplication routines for RISC-V.\n-\n-   Copyright (C) 2016-2017 Free Software Foundation, Inc.\n-\n-This file is part of GCC.\n-\n-GCC is free software; you can redistribute it and/or modify it under\n-the terms of the GNU General Public License as published by the Free\n-Software Foundation; either version 3, or (at your option) any later\n-version.\n-\n-GCC is distributed in the hope that it will be useful, but WITHOUT ANY\n-WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-for more details.\n-\n-Under Section 7 of GPL version 3, you are granted additional\n-permissions described in the GCC Runtime Library Exception, version\n-3.1, as published by the Free Software Foundation.\n-\n-You should have received a copy of the GNU General Public License and\n-a copy of the GCC Runtime Library Exception along with this program;\n-see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n-<http://www.gnu.org/licenses/>.  */\n-\n-#include \"riscv-asm.h\"\n-\n-  .text\n-  .align 2\n-\n-#if __riscv_xlen == 32\n-/* Our RV64 64-bit routines are equivalent to our RV32 32-bit routines.  */\n-# define __multi3 __muldi3\n-#endif\n-\n-FUNC_BEGIN (__multi3)\n-\n-#if __riscv_xlen == 32\n-/* Our RV64 64-bit routines are equivalent to our RV32 32-bit routines.  */\n-# define __muldi3 __mulsi3\n-#endif\n-\n-/* We rely on the fact that __muldi3 doesn't clobber the t-registers.  */\n-\n-  mv  t0, ra\n-  mv  t5, a0\n-  mv  a0, a1\n-  mv  t6, a3\n-  mv  a1, t5\n-  mv  a4, a2\n-  li  a5, 0\n-  li  t2, 0\n-  li  t4, 0\n-.L1:\n-  add  a6, t2, a1\n-  andi t3, a4, 1\n-  slli a7, a5, 1\n-  slti t1, a1, 0\n-  srli a4, a4, 1\n-  add  a5, t4, a5\n-  beqz t3, .L2\n-  sltu t3, a6, t2\n-  mv   t2, a6\n-  add  t4, t3, a5\n-.L2:\n-  slli a1, a1, 1\n-  or   a5, t1, a7\n-  bnez a4, .L1\n-  beqz a0, .L3\n-  mv   a1, a2\n-  call __muldi3\n-  add  t4, t4, a0\n-.L3:\n-  beqz t6, .L4\n-  mv   a1, t6\n-  mv   a0, t5\n-  call  __muldi3\n-  add  t4, t4, a0\n-.L4:\n-  mv  a0, t2\n-  mv  a1, t4\n-  jr  t0\n-\n-#if __riscv_xlen == 32\n-/* Our RV64 64-bit routines are equivalent to our RV32 32-bit routines.  */\n-# undef __muldi3\n-#endif\n-\n-FUNC_END (__multi3)\n-\t"}, {"sha": "3606a5f220b093cdb03304cdfe0e62f4bbcaec1e", "filename": "libgcc/config/riscv/multi3.c", "status": "added", "additions": 86, "deletions": 0, "changes": 86, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8d7e076ed0cf5fde5f5d875e4145d63317a6180/libgcc%2Fconfig%2Friscv%2Fmulti3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8d7e076ed0cf5fde5f5d875e4145d63317a6180/libgcc%2Fconfig%2Friscv%2Fmulti3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Friscv%2Fmulti3.c?ref=b8d7e076ed0cf5fde5f5d875e4145d63317a6180", "patch": "@@ -0,0 +1,86 @@\n+/* Multiplication two double word integers for RISC-V.\n+\n+   Copyright (C) 2016-2017 Free Software Foundation, Inc.\n+\n+This file is part of GCC.\n+\n+GCC is free software; you can redistribute it and/or modify it under\n+the terms of the GNU General Public License as published by the Free\n+Software Foundation; either version 3, or (at your option) any later\n+version.\n+\n+GCC is distributed in the hope that it will be useful, but WITHOUT ANY\n+WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+for more details.\n+\n+Under Section 7 of GPL version 3, you are granted additional\n+permissions described in the GCC Runtime Library Exception, version\n+3.1, as published by the Free Software Foundation.\n+\n+You should have received a copy of the GNU General Public License and\n+a copy of the GCC Runtime Library Exception along with this program;\n+see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n+<http://www.gnu.org/licenses/>.  */\n+\n+#include \"tconfig.h\"\n+#include \"tsystem.h\"\n+#include \"coretypes.h\"\n+#include \"tm.h\"\n+#include \"libgcc_tm.h\"\n+#define LIBGCC2_UNITS_PER_WORD (__riscv_xlen / 8)\n+\n+#include \"libgcc2.h\"\n+\n+#if __riscv_xlen == 32\n+/* Our RV64 64-bit routines are equivalent to our RV32 32-bit routines.  */\n+# define __multi3 __muldi3\n+#endif\n+\n+DWtype\n+__multi3 (DWtype u, DWtype v)\n+{\n+  const DWunion uu = {.ll = u};\n+  const DWunion vv = {.ll = v};\n+  DWunion w;\n+  UWtype u_low = uu.s.low;\n+  UWtype v_low = vv.s.low;\n+  UWtype u_low_msb;\n+  UWtype w_low = 0;\n+  UWtype new_w_low;\n+  UWtype w_high = 0;\n+  UWtype w_high_tmp = 0;\n+  UWtype w_high_tmp2x;\n+  UWtype carry;\n+\n+  /* Calculate low half part of u and v, and get a UDWtype result just like\n+     what __umulsidi3 do.  */\n+  do\n+    {\n+      new_w_low = w_low + u_low;\n+      w_high_tmp2x = w_high_tmp << 1;\n+      w_high_tmp += w_high;\n+      if (v_low & 1)\n+\t{\n+\t  carry = new_w_low < w_low;\n+\t  w_low = new_w_low;\n+\t  w_high = carry + w_high_tmp;\n+\t}\n+      u_low_msb = (u_low >> ((sizeof (UWtype) * 8) - 1));\n+      v_low >>= 1;\n+      u_low <<= 1;\n+      w_high_tmp = u_low_msb | w_high_tmp2x;\n+    }\n+  while (v_low);\n+\n+  w.s.low = w_low;\n+  w.s.high = w_high;\n+\n+  if (uu.s.high)\n+    w.s.high = w.s.high + __muluw3(vv.s.low, uu.s.high);\n+\n+  if (vv.s.high)\n+    w.s.high += __muluw3(uu.s.low, vv.s.high);\n+\n+  return w.ll;\n+}"}, {"sha": "dbc8f85dfc5ca5abf057229d7a7b79472e0f5dd2", "filename": "libgcc/config/riscv/t-elf", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8d7e076ed0cf5fde5f5d875e4145d63317a6180/libgcc%2Fconfig%2Friscv%2Ft-elf", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8d7e076ed0cf5fde5f5d875e4145d63317a6180/libgcc%2Fconfig%2Friscv%2Ft-elf", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Friscv%2Ft-elf?ref=b8d7e076ed0cf5fde5f5d875e4145d63317a6180", "patch": "@@ -1,6 +1,6 @@\n LIB2ADD += $(srcdir)/config/riscv/save-restore.S \\\n \t   $(srcdir)/config/riscv/muldi3.S \\\n-\t   $(srcdir)/config/riscv/multi3.S \\\n+\t   $(srcdir)/config/riscv/multi3.c \\\n \t   $(srcdir)/config/riscv/div.S \\\n \t   $(srcdir)/config/riscv/atomic.c \\\n "}]}