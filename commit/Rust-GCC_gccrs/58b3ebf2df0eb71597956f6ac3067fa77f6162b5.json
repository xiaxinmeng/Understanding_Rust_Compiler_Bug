{"sha": "58b3ebf2df0eb71597956f6ac3067fa77f6162b5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NThiM2ViZjJkZjBlYjcxNTk3OTU2ZjZhYzMwNjdmYTc3ZjYxNjJiNQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2012-01-19T18:58:02Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2012-01-19T18:58:02Z"}, "message": "re PR libmudflap/40778 (Mudflap instrumentation missing in cloned function.)\n\n\tPR libmudflap/40778\n\t* tree-mudflap.c (mf_artificial): New function.\n\t(execute_mudflap_function_ops, execute_mudflap_function_decls,\n\tmx_register_decls, mudflap_enqueue_decl): Use it.\n\n\t* testsuite/libmudflap.c/fail68-frag.c: New test.\n\nFrom-SVN: r183307", "tree": {"sha": "ef8d3b826fee39c7f1f196a3aa6ebd16183d1bd6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ef8d3b826fee39c7f1f196a3aa6ebd16183d1bd6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/58b3ebf2df0eb71597956f6ac3067fa77f6162b5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58b3ebf2df0eb71597956f6ac3067fa77f6162b5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/58b3ebf2df0eb71597956f6ac3067fa77f6162b5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58b3ebf2df0eb71597956f6ac3067fa77f6162b5/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "dc2c7a529b8045d63623f8318a7d1131ee88f205", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc2c7a529b8045d63623f8318a7d1131ee88f205", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dc2c7a529b8045d63623f8318a7d1131ee88f205"}], "stats": {"total": 58, "additions": 51, "deletions": 7}, "files": [{"sha": "6a30fa74f74b8d71c6c87a76a0f67542e130843f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58b3ebf2df0eb71597956f6ac3067fa77f6162b5/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58b3ebf2df0eb71597956f6ac3067fa77f6162b5/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=58b3ebf2df0eb71597956f6ac3067fa77f6162b5", "patch": "@@ -1,5 +1,10 @@\n 2012-01-19  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR libmudflap/40778\n+\t* tree-mudflap.c (mf_artificial): New function.\n+\t(execute_mudflap_function_ops, execute_mudflap_function_decls,\n+\tmx_register_decls, mudflap_enqueue_decl): Use it.\n+\n \tPR target/51876\n \t* config/arm/neon.md (*neon_vswp<mode>): Fix up operand\n \tnumbers in the insn pattern."}, {"sha": "e4f6ec0b3319c94599400e20f0df673409c353df", "filename": "gcc/tree-mudflap.c", "status": "modified", "additions": 14, "deletions": 7, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58b3ebf2df0eb71597956f6ac3067fa77f6162b5/gcc%2Ftree-mudflap.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58b3ebf2df0eb71597956f6ac3067fa77f6162b5/gcc%2Ftree-mudflap.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-mudflap.c?ref=58b3ebf2df0eb71597956f6ac3067fa77f6162b5", "patch": "@@ -1,5 +1,5 @@\n /* Mudflap: narrow-pointer bounds-checking by tree rewriting.\n-   Copyright (C) 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010\n+   Copyright (C) 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2012\n    Free Software Foundation, Inc.\n    Contributed by Frank Ch. Eigler <fche@redhat.com>\n    and Graydon Hoare <graydon@redhat.com>\n@@ -69,6 +69,13 @@ static tree mx_xfn_xform_decls (gimple_stmt_iterator *, bool *,\n static gimple_seq mx_register_decls (tree, gimple_seq, location_t);\n static unsigned int execute_mudflap_function_decls (void);\n \n+/* Return true if DECL is artificial stub that shouldn't be instrumented by\n+   mf.  We should instrument clones of non-artificial functions.  */\n+static inline bool\n+mf_artificial (const_tree decl)\n+{\n+  return DECL_ARTIFICIAL (DECL_ORIGIN (decl));\n+}\n \n /* ------------------------------------------------------------------------ */\n /* Some generally helpful functions for mudflap instrumentation.  */\n@@ -412,8 +419,8 @@ execute_mudflap_function_ops (void)\n \n   /* Don't instrument functions such as the synthetic constructor\n      built during mudflap_finish_file.  */\n-  if (mf_marked_p (current_function_decl) ||\n-      DECL_ARTIFICIAL (current_function_decl))\n+  if (mf_marked_p (current_function_decl)\n+      || mf_artificial (current_function_decl))\n     return 0;\n \n   push_gimplify_context (&gctx);\n@@ -994,8 +1001,8 @@ execute_mudflap_function_decls (void)\n \n   /* Don't instrument functions such as the synthetic constructor\n      built during mudflap_finish_file.  */\n-  if (mf_marked_p (current_function_decl) ||\n-      DECL_ARTIFICIAL (current_function_decl))\n+  if (mf_marked_p (current_function_decl)\n+      || mf_artificial (current_function_decl))\n     return 0;\n \n   push_gimplify_context (&gctx);\n@@ -1078,7 +1085,7 @@ mx_register_decls (tree decl, gimple_seq seq, location_t location)\n           /* Add the __mf_register call at the current appending point.  */\n           if (gsi_end_p (initially_stmts))\n \t    {\n-\t      if (!DECL_ARTIFICIAL (decl))\n+\t      if (!mf_artificial (decl))\n \t\twarning (OPT_Wmudflap,\n \t\t\t \"mudflap cannot track %qE in stub function\",\n \t\t\t DECL_NAME (decl));\n@@ -1249,7 +1256,7 @@ mudflap_enqueue_decl (tree obj)\n      during mudflap_finish_file ().  That would confuse the user,\n      since the text would refer to variables that don't show up in the\n      user's source code.  */\n-  if (DECL_P (obj) && DECL_EXTERNAL (obj) && DECL_ARTIFICIAL (obj))\n+  if (DECL_P (obj) && DECL_EXTERNAL (obj) && mf_artificial (obj))\n     return;\n \n   VEC_safe_push (tree, gc, deferred_static_decls, obj);"}, {"sha": "3d3e5af21a93934a45b4d43326071ce9d995e67d", "filename": "libmudflap/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58b3ebf2df0eb71597956f6ac3067fa77f6162b5/libmudflap%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58b3ebf2df0eb71597956f6ac3067fa77f6162b5/libmudflap%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2FChangeLog?ref=58b3ebf2df0eb71597956f6ac3067fa77f6162b5", "patch": "@@ -1,3 +1,8 @@\n+2012-01-19  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR libmudflap/40778\n+\t* testsuite/libmudflap.c/fail68-frag.c: New test.\n+\n 2012-01-01  Jakub Jelinek  <jakub@redhat.com>\n \n \t* mf-runtime.c (__mf_usage): Update copyright notice dates."}, {"sha": "7b2f8cf2cb04aeb4a3e0c4448958dc60b2878849", "filename": "libmudflap/testsuite/libmudflap.c/fail68-frag.c", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58b3ebf2df0eb71597956f6ac3067fa77f6162b5/libmudflap%2Ftestsuite%2Flibmudflap.c%2Ffail68-frag.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58b3ebf2df0eb71597956f6ac3067fa77f6162b5/libmudflap%2Ftestsuite%2Flibmudflap.c%2Ffail68-frag.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2Ftestsuite%2Flibmudflap.c%2Ffail68-frag.c?ref=58b3ebf2df0eb71597956f6ac3067fa77f6162b5", "patch": "@@ -0,0 +1,27 @@\n+/* PR libmudflap/40778 */\n+\n+char p[32];\n+static int j;\n+\n+__attribute__((noinline))\n+static void foo (int i)\n+{\n+  if (j++ == 0)\n+    p[i + 4] = 12;\n+  else\n+    p[i - 4] = 13;\n+}\n+\n+int\n+main ()\n+{\n+  foo (30);\n+  foo (30);\n+  foo (30);\n+  return 0;\n+}\n+\n+/* { dg-output \"mudflap violation 1.*\" } */\n+/* { dg-output \"Nearby object 1.*\" } */\n+/* { dg-output \"mudflap object.*name.*p\" } */\n+/* { dg-do run { xfail *-*-* } } */"}]}