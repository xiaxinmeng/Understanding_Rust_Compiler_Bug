{"sha": "505590b796df18ec3fcdcd6b8060f6f1410660b2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTA1NTkwYjc5NmRmMThlYzNmY2RjZDZiODA2MGY2ZjE0MTA2NjBiMg==", "commit": {"author": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2020-09-09T07:51:43Z"}, "committer": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2020-09-09T12:33:19Z"}, "message": "[nvptx] Fix boolean type test in write_fn_proto\n\nWhen running this libgomp testcase for nvptx accelerator:\n...\n/* { dg-do run } */\n__uint128_t v;\nint main () {\n  #pragma omp target\n  {\n    __uint128_t exp = 2;\n    __atomic_compare_exchange_n (&v, &exp, 7, false, __ATOMIC_RELEASE,\n\t\t\t\t __ATOMIC_ACQUIRE);\n  }\n}\n...\nwe run into this assert in write_fn_proto:\n...\n913             gcc_assert (type == boolean_type_node);\n...\n\nThis happens when doing some special-handling code for\n__atomic_compare_exchange_1/2/4/8/16.  The function decls have a parameter\ncalled weak of type bool, which is skipped when writing the decl because\nthe corresponding libatomic functions do not have that parameter.  The assert\nis there to verify that we skip the correct parameter.\n\nHowever, we assert because we have different type of bools:\n...\n(gdb) call debug_generic_expr (type)\n_Bool\n(gdb) call debug_generic_expr (global_trees[TI_BOOLEAN_TYPE])\nbool\n...\n\nFix this by checking for TREE_CODE (type) == BOOLEAN_TYPE instead.\n\nTested libgomp on x86_64-linux with nvptx accelerator.\n\nLikewise, tested that the test-case above does not ICE anymore.\n\ngcc/ChangeLog:\n\n\tPR target/96991\n\t* config/nvptx/nvptx.c (write_fn_proto): Fix boolean type check.", "tree": {"sha": "6c238eb226a910cd607058b58d758dad5603d787", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6c238eb226a910cd607058b58d758dad5603d787"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/505590b796df18ec3fcdcd6b8060f6f1410660b2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/505590b796df18ec3fcdcd6b8060f6f1410660b2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/505590b796df18ec3fcdcd6b8060f6f1410660b2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/505590b796df18ec3fcdcd6b8060f6f1410660b2/comments", "author": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "db918db2c305adf8ba727a5981a684c19de1510e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/db918db2c305adf8ba727a5981a684c19de1510e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/db918db2c305adf8ba727a5981a684c19de1510e"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "6f393dfea01ee7c8cc18968243c1dc700b760e17", "filename": "gcc/config/nvptx/nvptx.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/505590b796df18ec3fcdcd6b8060f6f1410660b2/gcc%2Fconfig%2Fnvptx%2Fnvptx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/505590b796df18ec3fcdcd6b8060f6f1410660b2/gcc%2Fconfig%2Fnvptx%2Fnvptx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Fnvptx.c?ref=505590b796df18ec3fcdcd6b8060f6f1410660b2", "patch": "@@ -910,7 +910,7 @@ write_fn_proto (std::stringstream &s, bool is_defn,\n       if (not_atomic_weak_arg)\n \targno = write_arg_type (s, -1, argno, type, prototyped);\n       else\n-\tgcc_assert (type == boolean_type_node);\n+\tgcc_assert (TREE_CODE (type) == BOOLEAN_TYPE);\n     }\n \n   if (stdarg_p (fntype))"}]}