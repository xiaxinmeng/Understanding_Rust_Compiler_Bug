{"sha": "4c1fd0845eabe44ffba3cce6d79aef941829396d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGMxZmQwODQ1ZWFiZTQ0ZmZiYTNjY2U2ZDc5YWVmOTQxODI5Mzk2ZA==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2012-01-26T22:07:44Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2012-01-26T22:07:44Z"}, "message": "m68k: Convert to atomic_test_and_set.\n\n        * config/m68k/m68k.c (TARGET_ATOMIC_TEST_AND_SET_TRUEVAL): New.\n        * config/m68k/sync.md (atomic_test_and_set): Rename from\n        sync_test_and_setqi and adjust the operands.\n        (atomic_test_and_set_1): Rename from sync_test_and_setqi_1\n        and unconditionally enable.\n\nFrom-SVN: r183585", "tree": {"sha": "52d58fbc37dd79db140c46acbe70b676f06aa5c6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/52d58fbc37dd79db140c46acbe70b676f06aa5c6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4c1fd0845eabe44ffba3cce6d79aef941829396d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4c1fd0845eabe44ffba3cce6d79aef941829396d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4c1fd0845eabe44ffba3cce6d79aef941829396d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4c1fd0845eabe44ffba3cce6d79aef941829396d/comments", "author": null, "committer": null, "parents": [{"sha": "5a843a13dca3c000691cfd9f1570500ad2d53efe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5a843a13dca3c000691cfd9f1570500ad2d53efe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5a843a13dca3c000691cfd9f1570500ad2d53efe"}], "stats": {"total": 30, "additions": 20, "deletions": 10}, "files": [{"sha": "d849d96d6c8bf1744962c86237407b678c85fdb5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c1fd0845eabe44ffba3cce6d79aef941829396d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c1fd0845eabe44ffba3cce6d79aef941829396d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4c1fd0845eabe44ffba3cce6d79aef941829396d", "patch": "@@ -1,3 +1,11 @@\n+2012-01-27  Richard Henderson  <rth@redhat.com>\n+\n+\t* config/m68k/m68k.c (TARGET_ATOMIC_TEST_AND_SET_TRUEVAL): New.\n+\t* config/m68k/sync.md (atomic_test_and_set): Rename from\n+\tsync_test_and_setqi and adjust the operands.\n+\t(atomic_test_and_set_1): Rename from sync_test_and_setqi_1\n+\tand unconditionally enable.\n+\n 2012-01-27  Richard Henderson  <rth@redhat.com>\n \n \t* config/sparc/sparc.c (TARGET_ATOMIC_TEST_AND_SET_TRUEVAL): New."}, {"sha": "d3ed82b81ea262c3b30d521974bbb6390c1022f1", "filename": "gcc/config/m68k/m68k.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c1fd0845eabe44ffba3cce6d79aef941829396d/gcc%2Fconfig%2Fm68k%2Fm68k.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c1fd0845eabe44ffba3cce6d79aef941829396d/gcc%2Fconfig%2Fm68k%2Fm68k.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fm68k%2Fm68k.c?ref=4c1fd0845eabe44ffba3cce6d79aef941829396d", "patch": "@@ -303,6 +303,10 @@ static void m68k_init_sync_libfuncs (void) ATTRIBUTE_UNUSED;\n #undef TARGET_ASM_OUTPUT_ADDR_CONST_EXTRA\n #define TARGET_ASM_OUTPUT_ADDR_CONST_EXTRA m68k_output_addr_const_extra\n \n+/* The value stored by TAS.  */\n+#undef TARGET_ATOMIC_TEST_AND_SET_TRUEVAL\n+#define TARGET_ATOMIC_TEST_AND_SET_TRUEVAL 128\n+\n static const struct attribute_spec m68k_attribute_table[] =\n {\n   /* { name, min_len, max_len, decl_req, type_req, fn_type_req, handler,"}, {"sha": "5d5002a9c812fcabf041467e0597755ff8331980", "filename": "gcc/config/m68k/sync.md", "status": "modified", "additions": 8, "deletions": 10, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c1fd0845eabe44ffba3cce6d79aef941829396d/gcc%2Fconfig%2Fm68k%2Fsync.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c1fd0845eabe44ffba3cce6d79aef941829396d/gcc%2Fconfig%2Fm68k%2Fsync.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fm68k%2Fsync.md?ref=4c1fd0845eabe44ffba3cce6d79aef941829396d", "patch": "@@ -56,25 +56,23 @@\n   ;; Elide the seq if operands[0] is dead.\n   \"cas<sz> %1,%4,%2\\;seq %0\")\n \n-(define_expand \"sync_test_and_setqi\"\n-  [(match_operand:QI 0 \"register_operand\" \"\")\n-   (match_operand:QI 1 \"memory_operand\" \"\")\n-   (match_operand:QI 2 \"general_operand\" \"\")]\n-  \"!TARGET_CAS\"\n+(define_expand \"atomic_test_and_set\"\n+  [(match_operand:QI 0 \"register_operand\" \"\")\t\t;; bool success output\n+   (match_operand:QI 1 \"memory_operand\" \"\")\t\t;; memory\n+   (match_operand:SI 2 \"const_int_operand\" \"\")]\t\t;; model\n+  \"\"\n {\n-  if (operands[2] != const1_rtx)\n-    FAIL;\n-  emit_insn (gen_sync_test_and_setqi_1 (operands[0], operands[1]));\n+  emit_insn (gen_atomic_test_and_set_1 (operands[0], operands[1]));\n   emit_insn (gen_negqi2 (operands[0], operands[0]));\n   DONE;\n })\n \n-(define_insn \"sync_test_and_setqi_1\"\n+(define_insn \"atomic_test_and_set_1\"\n   [(set (match_operand:QI 0 \"register_operand\" \"=d\")\n \t(unspec_volatile:QI\n \t  [(match_operand:QI 1 \"memory_operand\" \"+m\")]\n \t  UNSPECV_TAS_1))\n    (set (match_dup 1)\n \t(unspec_volatile:QI [(match_dup 1)] UNSPECV_TAS_2))]\n-  \"!TARGET_CAS\"\n+  \"\"\n   \"tas %1\\;sne %0\")"}]}