{"sha": "bdaa2c546bee30f44c39076d2b75a349ab84adf9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmRhYTJjNTQ2YmVlMzBmNDRjMzkwNzZkMmI3NWEzNDlhYjg0YWRmOQ==", "commit": {"author": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2018-07-13T10:08:37Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2018-07-13T10:08:37Z"}, "message": "[debug] Reuse debug exprs generated in remap_ssa_name\n\nWhen compiling gcc.dg/vla-1.c with -O3 -g, vla a and b in f1 are optimized\naway, and f1 is cloned to a version f1.constprop with no parameters, eliminating\nparameter i.  Debug info is generated to describe the sizes of a and b, but\nthat process generates debug expressions that are not reused.\n\nFix the duplication by saving and reusing the generated debug expressions in\nremap_ssa_name.  Concretely: reuse D#7 here instead of generating D#8:\n...\n __attribute__((noinline))\n f1.constprop ()\n {\n   intD.6 iD.1935;\n\n   <bb 3>\n   # DEBUG D#10 s=> iD.1897\n   # DEBUG iD.1935 => D#10\n\n   <bb 2>\n-  # DEBUG D#8 s=> iD.1935\n   # DEBUG D#7 s=> iD.1935\n   saved_stack.2_1 = __builtin_stack_save ();\n   # DEBUG BEGIN_STMT\n   # DEBUG D#6 => D#7 + 1\n   # DEBUG D#5 => (long intD.8) D#6\n   # DEBUG D#4 => D#5 + -1\n   # DEBUG D.1937 => (sizetype) D#4\n   # DEBUG a.0D.1942 => NULL\n   # DEBUG BEGIN_STMT\n-  # DEBUG D#3 => D#8 + 2\n+  # DEBUG D#3 => D#7 + 2\n   # DEBUG D#2 => (long intD.8) D#3\n   # DEBUG D#1 => D#2 + -1\n   # DEBUG D.1944 => (sizetype) D#1\n   # DEBUG b.1D.1949 => NULL\n...\n\nBootstrapped and reg-tested on x86_64.\n\n2018-07-13  Tom de Vries  <tdevries@suse.de>\n\n\t* tree-inline.c (remap_ssa_name): Save and reuse debug exprs generated\n\tin remap_ssa_name.\n\n\t* gcc.dg/vla-1.c: Update.\n\nFrom-SVN: r262628", "tree": {"sha": "fed2cee0eccdfb07dfbffb94679fbd9429d837e3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fed2cee0eccdfb07dfbffb94679fbd9429d837e3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bdaa2c546bee30f44c39076d2b75a349ab84adf9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bdaa2c546bee30f44c39076d2b75a349ab84adf9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bdaa2c546bee30f44c39076d2b75a349ab84adf9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bdaa2c546bee30f44c39076d2b75a349ab84adf9/comments", "author": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "bddcac9d1c32e592fb7c3427f99b274847135050", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bddcac9d1c32e592fb7c3427f99b274847135050", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bddcac9d1c32e592fb7c3427f99b274847135050"}], "stats": {"total": 18, "additions": 16, "deletions": 2}, "files": [{"sha": "3f70e46d19333fcd0a833953fb08453e9ee70bb8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdaa2c546bee30f44c39076d2b75a349ab84adf9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdaa2c546bee30f44c39076d2b75a349ab84adf9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bdaa2c546bee30f44c39076d2b75a349ab84adf9", "patch": "@@ -1,3 +1,8 @@\n+2018-07-13  Tom de Vries  <tdevries@suse.de>\n+\n+\t* tree-inline.c (remap_ssa_name): Save and reuse debug exprs generated\n+\tin remap_ssa_name.\n+\n 2018-07-13  Jackson Woodruff  <jackson.woodruff@arm.com>\n \n \t* config/aarch64/aarch64.c (aarch64_operands_adjust_ok_for_ldpstp): Use"}, {"sha": "49ca6c527dd51d4eb1daa8b295a42f3de56f56ad", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdaa2c546bee30f44c39076d2b75a349ab84adf9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdaa2c546bee30f44c39076d2b75a349ab84adf9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bdaa2c546bee30f44c39076d2b75a349ab84adf9", "patch": "@@ -1,3 +1,7 @@\n+2018-07-13  Tom de Vries  <tdevries@suse.de>\n+\n+\t* gcc.dg/vla-1.c: Update.\n+\n 2018-07-13  Tom de Vries  <tdevries@suse.de>\n \n \t* gcc.src/maintainers.exp: New file."}, {"sha": "902166cb18c964ad9d52e95aa68e2447b3deb668", "filename": "gcc/testsuite/gcc.dg/vla-1.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdaa2c546bee30f44c39076d2b75a349ab84adf9/gcc%2Ftestsuite%2Fgcc.dg%2Fvla-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdaa2c546bee30f44c39076d2b75a349ab84adf9/gcc%2Ftestsuite%2Fgcc.dg%2Fvla-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvla-1.c?ref=bdaa2c546bee30f44c39076d2b75a349ab84adf9", "patch": "@@ -20,6 +20,7 @@ main ()\n   return 0;\n }\n \n-/* One debug source bind is generated for the parameter, and two to describe the\n+/* One debug source bind is generated for the parameter, and one to describe the\n    sizes of a and b.  */\n-/* { dg-final { scan-tree-dump-times \" s=> i\" 3 \"optimized\" } } */\n+/* { dg-final { scan-tree-dump-times \" s=> i\" 2 \"optimized\" } } */\n+"}, {"sha": "6a16ce546cb04d5a858def36612cc1028a5a22c2", "filename": "gcc/tree-inline.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bdaa2c546bee30f44c39076d2b75a349ab84adf9/gcc%2Ftree-inline.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bdaa2c546bee30f44c39076d2b75a349ab84adf9/gcc%2Ftree-inline.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-inline.c?ref=bdaa2c546bee30f44c39076d2b75a349ab84adf9", "patch": "@@ -214,12 +214,16 @@ remap_ssa_name (tree name, copy_body_data *id)\n \t      processing_debug_stmt = -1;\n \t      return name;\n \t    }\n+\t  n = id->decl_map->get (val);\n+\t  if (n && TREE_CODE (*n) == DEBUG_EXPR_DECL)\n+\t    return *n;\n \t  def_temp = gimple_build_debug_source_bind (vexpr, val, NULL);\n \t  DECL_ARTIFICIAL (vexpr) = 1;\n \t  TREE_TYPE (vexpr) = TREE_TYPE (name);\n \t  SET_DECL_MODE (vexpr, DECL_MODE (SSA_NAME_VAR (name)));\n \t  gsi = gsi_after_labels (single_succ (ENTRY_BLOCK_PTR_FOR_FN (cfun)));\n \t  gsi_insert_before (&gsi, def_temp, GSI_SAME_STMT);\n+\t  insert_decl_map (id, val, vexpr);\n \t  return vexpr;\n \t}\n "}]}