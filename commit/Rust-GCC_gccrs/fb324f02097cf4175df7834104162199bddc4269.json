{"sha": "fb324f02097cf4175df7834104162199bddc4269", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmIzMjRmMDIwOTdjZjQxNzVkZjc4MzQxMDQxNjIxOTliZGRjNDI2OQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-11-16T23:22:16Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-11-16T23:22:16Z"}, "message": "re PR rtl-optimization/78378 (wrong code when combining shift + mult + zero_extend)\n\n\tPR rtl-optimization/78378\n\t* combine.c (make_extraction): Use force_to_mode for non-{REG,MEM}\n\tinner only if pos is 0.  Fix up formatting.\n\n\t* gcc.c-torture/execute/pr78378.c: New test.\n\nFrom-SVN: r242526", "tree": {"sha": "72f534b97622655d109468e279fca8aefac13b32", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/72f534b97622655d109468e279fca8aefac13b32"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fb324f02097cf4175df7834104162199bddc4269", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fb324f02097cf4175df7834104162199bddc4269", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fb324f02097cf4175df7834104162199bddc4269", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fb324f02097cf4175df7834104162199bddc4269/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8972f7e90b58d35906601e67c9c5e4b04f1a880e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8972f7e90b58d35906601e67c9c5e4b04f1a880e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8972f7e90b58d35906601e67c9c5e4b04f1a880e"}], "stats": {"total": 37, "additions": 33, "deletions": 4}, "files": [{"sha": "f7121991a1bdffc400a2402429bf76a4611e955d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fb324f02097cf4175df7834104162199bddc4269/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fb324f02097cf4175df7834104162199bddc4269/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=fb324f02097cf4175df7834104162199bddc4269", "patch": "@@ -1,3 +1,9 @@\n+2016-11-16  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR rtl-optimization/78378\n+\t* combine.c (make_extraction): Use force_to_mode for non-{REG,MEM}\n+\tinner only if pos is 0.  Fix up formatting.\n+\n 2016-11-17  Alan Modra  <amodra@gmail.com>\n \n \tPR rtl-optimization/78325"}, {"sha": "5f920c4a55e9413aa5fd46a2eeb891d5bbb809ca", "filename": "gcc/combine.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fb324f02097cf4175df7834104162199bddc4269/gcc%2Fcombine.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fb324f02097cf4175df7834104162199bddc4269/gcc%2Fcombine.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcombine.c?ref=fb324f02097cf4175df7834104162199bddc4269", "patch": "@@ -7382,6 +7382,7 @@ make_extraction (machine_mode mode, rtx inner, HOST_WIDE_INT pos,\n   if (tmode != BLKmode\n       && ((pos_rtx == 0 && (pos % BITS_PER_WORD) == 0\n \t   && !MEM_P (inner)\n+\t   && (pos == 0 || REG_P (inner))\n \t   && (inner_mode == tmode\n \t       || !REG_P (inner)\n \t       || TRULY_NOOP_TRUNCATION_MODES_P (tmode, inner_mode)\n@@ -7458,10 +7459,9 @@ make_extraction (machine_mode mode, rtx inner, HOST_WIDE_INT pos,\n \t}\n       else\n \tnew_rtx = force_to_mode (inner, tmode,\n-\t\t\t     len >= HOST_BITS_PER_WIDE_INT\n-\t\t\t     ? HOST_WIDE_INT_M1U\n-\t\t\t     : (HOST_WIDE_INT_1U << len) - 1,\n-\t\t\t     0);\n+\t\t\t\t len >= HOST_BITS_PER_WIDE_INT\n+\t\t\t\t ? HOST_WIDE_INT_M1U\n+\t\t\t\t : (HOST_WIDE_INT_1U << len) - 1, 0);\n \n       /* If this extraction is going into the destination of a SET,\n \t make a STRICT_LOW_PART unless we made a MEM.  */"}, {"sha": "20fcf383322f5bee178e0775eeaff08722792d18", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fb324f02097cf4175df7834104162199bddc4269/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fb324f02097cf4175df7834104162199bddc4269/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=fb324f02097cf4175df7834104162199bddc4269", "patch": "@@ -1,3 +1,8 @@\n+2016-11-16  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR rtl-optimization/78378\n+\t* gcc.c-torture/execute/pr78378.c: New test.\n+\n 2016-11-16  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* gcc.dg/tree-prof/section-attr-1.c: New file."}, {"sha": "05c1f9c771c1f5ab55bece43c27098eafc473348", "filename": "gcc/testsuite/gcc.c-torture/execute/pr78378.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fb324f02097cf4175df7834104162199bddc4269/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr78378.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fb324f02097cf4175df7834104162199bddc4269/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr78378.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr78378.c?ref=fb324f02097cf4175df7834104162199bddc4269", "patch": "@@ -0,0 +1,18 @@\n+/* PR rtl-optimization/78378 */\n+\n+unsigned long long __attribute__ ((noinline, noclone))\n+foo (unsigned long long x)\n+{\n+  x <<= 41;\n+  x /= 232;\n+  return 1 + (unsigned short) x;\n+}\n+\n+int\n+main ()\n+{\n+  unsigned long long x = foo (1);\n+  if (x != 0x2c24)\n+    __builtin_abort();\n+  return 0;\n+}"}]}