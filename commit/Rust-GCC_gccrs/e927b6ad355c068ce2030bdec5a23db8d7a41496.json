{"sha": "e927b6ad355c068ce2030bdec5a23db8d7a41496", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTkyN2I2YWQzNTVjMDY4Y2UyMDMwYmRlYzVhMjNkYjhkN2E0MTQ5Ng==", "commit": {"author": {"name": "Rainer Orth", "email": "ro@CeBiTec.Uni-Bielefeld.DE", "date": "2013-04-15T10:31:57Z"}, "committer": {"name": "Rainer Orth", "email": "ro@gcc.gnu.org", "date": "2013-04-15T10:31:57Z"}, "message": "Use -z ignore instead of --as-needed on Solaris\n\n\t* configure.ac (gcc_cv_ld_as_needed): Set\n\tgcc_cv_ld_as_needed_option, gcc_cv_no_as_needed_option.\n\tUse -z ignore, -z record on *-*-solaris2*.\n\t(HAVE_LD_AS_NEEDED): Update comment.\n\t(LD_AS_NEEDED_OPTION, LD_NO_AS_NEEDED_OPTION): Define.\n\t* configure: Regenerate.\n\t* config.in: Regenerate.\n\t* gcc.c (init_gcc_specs) [USE_LD_AS_NEEDED]: Use\n\tLD_AS_NEEDED_OPTION, LD_NO_AS_NEEDED_OPTION.\n\t* config/sol2.h [HAVE_LD_AS_NEEDED] (USE_LD_AS_NEEDED): Define.\n\t* doc/tm.texi.in (USE_LD_AS_NEEDED): Allow for --as-needed\n\tequivalents.  Fix markup.\n\t* doc/tm.texi: Regenerate.\n\nFrom-SVN: r197964", "tree": {"sha": "c14f024bbdb6a514a3b90e6bfd980a6fc278ed5a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c14f024bbdb6a514a3b90e6bfd980a6fc278ed5a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e927b6ad355c068ce2030bdec5a23db8d7a41496", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e927b6ad355c068ce2030bdec5a23db8d7a41496", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e927b6ad355c068ce2030bdec5a23db8d7a41496", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e927b6ad355c068ce2030bdec5a23db8d7a41496/comments", "author": {"login": "rorth", "id": 3930951, "node_id": "MDQ6VXNlcjM5MzA5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/3930951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rorth", "html_url": "https://github.com/rorth", "followers_url": "https://api.github.com/users/rorth/followers", "following_url": "https://api.github.com/users/rorth/following{/other_user}", "gists_url": "https://api.github.com/users/rorth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rorth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rorth/subscriptions", "organizations_url": "https://api.github.com/users/rorth/orgs", "repos_url": "https://api.github.com/users/rorth/repos", "events_url": "https://api.github.com/users/rorth/events{/privacy}", "received_events_url": "https://api.github.com/users/rorth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e0ea8797bb997ccc5ab228580498dfe2b727dcef", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e0ea8797bb997ccc5ab228580498dfe2b727dcef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e0ea8797bb997ccc5ab228580498dfe2b727dcef"}], "stats": {"total": 87, "additions": 80, "deletions": 7}, "files": [{"sha": "d4dbb22ba2520279bf50eca139c3382f9c75f378", "filename": "gcc/ChangeLog", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e927b6ad355c068ce2030bdec5a23db8d7a41496/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e927b6ad355c068ce2030bdec5a23db8d7a41496/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e927b6ad355c068ce2030bdec5a23db8d7a41496", "patch": "@@ -1,3 +1,19 @@\n+2013-04-15  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n+\n+\t* configure.ac (gcc_cv_ld_as_needed): Set\n+\tgcc_cv_ld_as_needed_option, gcc_cv_no_as_needed_option.\n+\tUse -z ignore, -z record on *-*-solaris2*.\n+\t(HAVE_LD_AS_NEEDED): Update comment.\n+\t(LD_AS_NEEDED_OPTION, LD_NO_AS_NEEDED_OPTION): Define.\n+\t* configure: Regenerate.\n+\t* config.in: Regenerate.\n+\t* gcc.c (init_gcc_specs) [USE_LD_AS_NEEDED]: Use\n+\tLD_AS_NEEDED_OPTION, LD_NO_AS_NEEDED_OPTION.\n+\t* config/sol2.h [HAVE_LD_AS_NEEDED] (USE_LD_AS_NEEDED): Define.\n+\t* doc/tm.texi.in (USE_LD_AS_NEEDED): Allow for --as-needed\n+\tequivalents.  Fix markup.\n+\t* doc/tm.texi: Regenerate.\n+\n 2013-04-15  Andrew Hsieh  <andrewhsieh.google.com>\n \n \t* config/i386/i386.opt: New option mstack-protector-guard=."}, {"sha": "66e47caa3ff2047060f029e850d540c7acca049a", "filename": "gcc/config.in", "status": "modified", "additions": 14, "deletions": 1, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e927b6ad355c068ce2030bdec5a23db8d7a41496/gcc%2Fconfig.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e927b6ad355c068ce2030bdec5a23db8d7a41496/gcc%2Fconfig.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.in?ref=e927b6ad355c068ce2030bdec5a23db8d7a41496", "patch": "@@ -1205,7 +1205,8 @@\n #endif\n \n \n-/* Define if your linker supports --as-needed and --no-as-needed options. */\n+/* Define if your linker supports --as-needed/--no-as-needed or equivalent\n+   options. */\n #ifndef USED_FOR_TARGET\n #undef HAVE_LD_AS_NEEDED\n #endif\n@@ -1642,12 +1643,24 @@\n #endif\n \n \n+/* Define to the linker option to ignore unused dependencies. */\n+#ifndef USED_FOR_TARGET\n+#undef LD_AS_NEEDED_OPTION\n+#endif\n+\n+\n /* Define to the linker option to enable use of shared objects. */\n #ifndef USED_FOR_TARGET\n #undef LD_DYNAMIC_OPTION\n #endif\n \n \n+/* Define to the linker option to keep unused dependencies. */\n+#ifndef USED_FOR_TARGET\n+#undef LD_NO_AS_NEEDED_OPTION\n+#endif\n+\n+\n /* Define to the linker option to disable use of shared objects. */\n #ifndef USED_FOR_TARGET\n #undef LD_STATIC_OPTION"}, {"sha": "4c9b334e7a7730e0884c403f988912471b000ba5", "filename": "gcc/config/sol2.h", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e927b6ad355c068ce2030bdec5a23db8d7a41496/gcc%2Fconfig%2Fsol2.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e927b6ad355c068ce2030bdec5a23db8d7a41496/gcc%2Fconfig%2Fsol2.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsol2.h?ref=e927b6ad355c068ce2030bdec5a23db8d7a41496", "patch": "@@ -181,6 +181,11 @@ along with GCC; see the file COPYING3.  If not see\n    %(link_arch) \\\n    %{Qy:} %{!Qn:-Qy}\"\n \n+/* Use --as-needed/-z ignore -lgcc_s for eh support.  */\n+#ifdef HAVE_LD_AS_NEEDED\n+#define USE_LD_AS_NEEDED 1\n+#endif\n+\n #ifdef USE_GLD\n /* Solaris 11 build 135+ implements dl_iterate_phdr.  GNU ld needs\n    --eh-frame-hdr to create the required .eh_frame_hdr sections.  */"}, {"sha": "a33da7a73f8d2fffb38a48ac6a3029ad9a59b27b", "filename": "gcc/configure", "status": "modified", "additions": 23, "deletions": 2, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e927b6ad355c068ce2030bdec5a23db8d7a41496/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e927b6ad355c068ce2030bdec5a23db8d7a41496/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=e927b6ad355c068ce2030bdec5a23db8d7a41496", "patch": "@@ -17830,7 +17830,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 17831 \"configure\"\n+#line 17833 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -17936,7 +17936,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 17937 \"configure\"\n+#line 17939 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -26557,6 +26557,8 @@ if test \"${gcc_cv_ld_as_needed+set}\" = set; then :\n   $as_echo_n \"(cached) \" >&6\n else\n   gcc_cv_ld_as_needed=no\n+gcc_cv_ld_as_needed_option='--as-needed'\n+gcc_cv_ld_no_as_needed_option='--no-as-needed'\n if test $in_tree_ld = yes ; then\n   if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 16 -o \"$gcc_cv_gld_major_version\" -gt 2 \\\n      && test $in_tree_ld_is_elf = yes; then\n@@ -26566,6 +26568,15 @@ elif test x$gcc_cv_ld != x; then\n \t# Check if linker supports --as-needed and --no-as-needed options\n \tif $gcc_cv_ld --help 2>/dev/null | grep as-needed > /dev/null; then\n \t\tgcc_cv_ld_as_needed=yes\n+\telse\n+\t  case \"$target\" in\n+\t    # Solaris 2 ld always supports -z ignore/-z record.\n+\t    *-*-solaris2*)\n+\t      gcc_cv_ld_as_needed=yes\n+\t      gcc_cv_ld_as_needed_option=\"-z ignore\"\n+\t      gcc_cv_ld_no_as_needed_option=\"-z record\"\n+\t      ;;\n+\t  esac\n \tfi\n fi\n \n@@ -26576,6 +26587,16 @@ if test x\"$gcc_cv_ld_as_needed\" = xyes; then\n \n $as_echo \"#define HAVE_LD_AS_NEEDED 1\" >>confdefs.h\n \n+\n+cat >>confdefs.h <<_ACEOF\n+#define LD_AS_NEEDED_OPTION \"$gcc_cv_ld_as_needed_option\"\n+_ACEOF\n+\n+\n+cat >>confdefs.h <<_ACEOF\n+#define LD_NO_AS_NEEDED_OPTION \"$gcc_cv_ld_no_as_needed_option\"\n+_ACEOF\n+\n fi\n \n case \"$target:$tm_file\" in"}, {"sha": "1d5175b9f7eb60901e7bb1d43fae29d58cb539eb", "filename": "gcc/configure.ac", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e927b6ad355c068ce2030bdec5a23db8d7a41496/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e927b6ad355c068ce2030bdec5a23db8d7a41496/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=e927b6ad355c068ce2030bdec5a23db8d7a41496", "patch": "@@ -4538,6 +4538,8 @@ AC_MSG_RESULT($gcc_cv_ld_eh_gc_sections_bug)\n AC_CACHE_CHECK(linker --as-needed support,\n gcc_cv_ld_as_needed,\n [gcc_cv_ld_as_needed=no\n+gcc_cv_ld_as_needed_option='--as-needed'\n+gcc_cv_ld_no_as_needed_option='--no-as-needed'\n if test $in_tree_ld = yes ; then\n   if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 16 -o \"$gcc_cv_gld_major_version\" -gt 2 \\\n      && test $in_tree_ld_is_elf = yes; then\n@@ -4547,12 +4549,25 @@ elif test x$gcc_cv_ld != x; then\n \t# Check if linker supports --as-needed and --no-as-needed options\n \tif $gcc_cv_ld --help 2>/dev/null | grep as-needed > /dev/null; then\n \t\tgcc_cv_ld_as_needed=yes\n+\telse\n+\t  case \"$target\" in\n+\t    # Solaris 2 ld always supports -z ignore/-z record.\n+\t    *-*-solaris2*)\n+\t      gcc_cv_ld_as_needed=yes\n+\t      gcc_cv_ld_as_needed_option=\"-z ignore\"\n+\t      gcc_cv_ld_no_as_needed_option=\"-z record\"\n+\t      ;;\n+\t  esac\n \tfi\n fi\n ])\n if test x\"$gcc_cv_ld_as_needed\" = xyes; then\n \tAC_DEFINE(HAVE_LD_AS_NEEDED, 1,\n-[Define if your linker supports --as-needed and --no-as-needed options.])\n+[Define if your linker supports --as-needed/--no-as-needed or equivalent options.])\n+\tAC_DEFINE_UNQUOTED(LD_AS_NEEDED_OPTION, \"$gcc_cv_ld_as_needed_option\",\n+[Define to the linker option to ignore unused dependencies.])\n+\tAC_DEFINE_UNQUOTED(LD_NO_AS_NEEDED_OPTION, \"$gcc_cv_ld_no_as_needed_option\",\n+[Define to the linker option to keep unused dependencies.])\n fi\n \n case \"$target:$tm_file\" in"}, {"sha": "c88a89f28c3a65738f878f71fdc5c5feee2a884f", "filename": "gcc/doc/tm.texi", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e927b6ad355c068ce2030bdec5a23db8d7a41496/gcc%2Fdoc%2Ftm.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e927b6ad355c068ce2030bdec5a23db8d7a41496/gcc%2Fdoc%2Ftm.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Ftm.texi?ref=e927b6ad355c068ce2030bdec5a23db8d7a41496", "patch": "@@ -260,7 +260,8 @@ line, but, unlike @code{LIBGCC_SPEC}, it is used unmodified.\n @defmac USE_LD_AS_NEEDED\n A macro that controls the modifications to @code{LIBGCC_SPEC}\n mentioned in @code{REAL_LIBGCC_SPEC}.  If nonzero, a spec will be\n-generated that uses --as-needed and the shared libgcc in place of the\n+generated that uses @option{--as-needed} or equivalent options and the\n+shared @file{libgcc} in place of the\n static exception handler library, when linking without any of\n @code{-static}, @code{-static-libgcc}, or @code{-shared-libgcc}.\n @end defmac"}, {"sha": "d70ce4cfd36984ccb39ddb4919f0c40be2b97427", "filename": "gcc/doc/tm.texi.in", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e927b6ad355c068ce2030bdec5a23db8d7a41496/gcc%2Fdoc%2Ftm.texi.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e927b6ad355c068ce2030bdec5a23db8d7a41496/gcc%2Fdoc%2Ftm.texi.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Ftm.texi.in?ref=e927b6ad355c068ce2030bdec5a23db8d7a41496", "patch": "@@ -260,7 +260,8 @@ line, but, unlike @code{LIBGCC_SPEC}, it is used unmodified.\n @defmac USE_LD_AS_NEEDED\n A macro that controls the modifications to @code{LIBGCC_SPEC}\n mentioned in @code{REAL_LIBGCC_SPEC}.  If nonzero, a spec will be\n-generated that uses --as-needed and the shared libgcc in place of the\n+generated that uses @option{--as-needed} or equivalent options and the\n+shared @file{libgcc} in place of the\n static exception handler library, when linking without any of\n @code{-static}, @code{-static-libgcc}, or @code{-shared-libgcc}.\n @end defmac"}, {"sha": "27072f007743429a6b8f121408af5d00b182d18e", "filename": "gcc/gcc.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e927b6ad355c068ce2030bdec5a23db8d7a41496/gcc%2Fgcc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e927b6ad355c068ce2030bdec5a23db8d7a41496/gcc%2Fgcc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgcc.c?ref=e927b6ad355c068ce2030bdec5a23db8d7a41496", "patch": "@@ -1361,7 +1361,8 @@ init_gcc_specs (struct obstack *obstack, const char *shared_name,\n \t\t\"%{!static:%{!static-libgcc:\"\n #if USE_LD_AS_NEEDED\n \t\t\"%{!shared-libgcc:\",\n-\t\tstatic_name, \" --as-needed \", shared_name, \" --no-as-needed\"\n+\t\tstatic_name, \" \" LD_AS_NEEDED_OPTION \" \",\n+\t\tshared_name, \" \" LD_NO_AS_NEEDED_OPTION\n \t\t\"}\"\n \t\t\"%{shared-libgcc:\",\n \t\tshared_name, \"%{!shared: \", static_name, \"}\""}]}