{"sha": "dd1291e050cf44de57036bf76ca9f226ce0fc300", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGQxMjkxZTA1MGNmNDRkZTU3MDM2YmY3NmNhOWYyMjZjZTBmYzMwMA==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2016-02-27T19:07:13Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2016-02-27T19:07:13Z"}, "message": "re PR fortran/69910 (ICE with NEWUNIT)\n\n2016-02-27  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\t    Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/69110\n\t* io.c (gfc_match_open): Check that open status is an expression\n\tconstant before comparing string to 'scratch' with NEWUNIT.\n\n\t* gfortran.dg/newunit_4.f90: New test.\n\nCo-Authored-By: Steven G. Kargl <kargl@gcc.gnu.org>\n\nFrom-SVN: r233782", "tree": {"sha": "c686964239be3631c430037ede762ee23acb2c54", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c686964239be3631c430037ede762ee23acb2c54"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dd1291e050cf44de57036bf76ca9f226ce0fc300", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dd1291e050cf44de57036bf76ca9f226ce0fc300", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dd1291e050cf44de57036bf76ca9f226ce0fc300", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dd1291e050cf44de57036bf76ca9f226ce0fc300/comments", "author": null, "committer": null, "parents": [{"sha": "5cfefb592a4f0c63d683569015c44ad52a82542d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5cfefb592a4f0c63d683569015c44ad52a82542d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5cfefb592a4f0c63d683569015c44ad52a82542d"}], "stats": {"total": 36, "additions": 29, "deletions": 7}, "files": [{"sha": "80ec195a84bee6edf46aa55d3fb8fa8a49faeff5", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dd1291e050cf44de57036bf76ca9f226ce0fc300/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dd1291e050cf44de57036bf76ca9f226ce0fc300/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=dd1291e050cf44de57036bf76ca9f226ce0fc300", "patch": "@@ -1,3 +1,10 @@\n+2016-02-27  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\t    Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/69110\n+\t* io.c (gfc_match_open): Check that open status is an expression\n+\tconstant before comparing string to 'scratch' with NEWUNIT.\n+\n 2016-02-27  Alessandro Fanfarillo  <fanfarillo.gcc@gmail.com>\n \n \t* trans.c (gfc_allocate_allocatable): size conversion"}, {"sha": "da0e1c5ec49416f61a2018520e32c9e5ea50bd06", "filename": "gcc/fortran/io.c", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dd1291e050cf44de57036bf76ca9f226ce0fc300/gcc%2Ffortran%2Fio.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dd1291e050cf44de57036bf76ca9f226ce0fc300/gcc%2Ffortran%2Fio.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fio.c?ref=dd1291e050cf44de57036bf76ca9f226ce0fc300", "patch": "@@ -1890,13 +1890,16 @@ gfc_match_open (void)\n \t  goto cleanup;\n \t}\n \n-      if (!(open->file || (open->status\n-          && gfc_wide_strncasecmp (open->status->value.character.string,\n-\t\t\t\t   \"scratch\", 7) == 0)))\n-\t{\n-\t  gfc_error (\"NEWUNIT specifier must have FILE= \"\n-\t\t     \"or STATUS='scratch' at %C\");\n-\t  goto cleanup;\n+      if (!open->file && open->status)\n+        {\n+\t  if (open->status->expr_type == EXPR_CONSTANT\n+\t     && gfc_wide_strncasecmp (open->status->value.character.string,\n+\t\t\t\t       \"scratch\", 7) != 0)\n+\t   {\n+\t     gfc_error (\"NEWUNIT specifier must have FILE= \"\n+\t\t\t\"or STATUS='scratch' at %C\");\n+\t     goto cleanup;\n+\t   }\n \t}\n     }\n   else if (!open->unit)"}, {"sha": "f64a07dae516955b0800afcfede02b7c7788e75e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dd1291e050cf44de57036bf76ca9f226ce0fc300/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dd1291e050cf44de57036bf76ca9f226ce0fc300/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=dd1291e050cf44de57036bf76ca9f226ce0fc300", "patch": "@@ -1,3 +1,8 @@\n+2016-02-27  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR fortran/69110\n+\t* gfortran.dg/newunit_4.f90: New test.\n+\n 2016-02-27  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR target/69613"}, {"sha": "4d7d73826f700eaff03b4864963b4f132205228b", "filename": "gcc/testsuite/gfortran.dg/newunit_4.f90", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dd1291e050cf44de57036bf76ca9f226ce0fc300/gcc%2Ftestsuite%2Fgfortran.dg%2Fnewunit_4.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dd1291e050cf44de57036bf76ca9f226ce0fc300/gcc%2Ftestsuite%2Fgfortran.dg%2Fnewunit_4.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fnewunit_4.f90?ref=dd1291e050cf44de57036bf76ca9f226ce0fc300", "patch": "@@ -0,0 +1,7 @@\n+! { dg-do compile }\n+! PR69110 ICE with NEWUNIT \n+subroutine open_file_safe(fname, fstatus, faction, fposition, funit)\n+  character(*), intent(in)  :: fname, fstatus, faction, fposition\n+  integer, intent(out)      :: funit\n+  open(newunit=funit, status=fstatus)\n+end subroutine open_file_safe"}]}