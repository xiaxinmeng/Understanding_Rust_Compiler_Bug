{"sha": "ad8adad11752db7a98fce95d9090f4c6fbb849b7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWQ4YWRhZDExNzUyZGI3YTk4ZmNlOTVkOTA5MGY0YzZmYmI4NDliNw==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2018-07-17T08:05:29Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-07-17T08:05:29Z"}, "message": "[Ada] Fix unnesting issues involving tasks\n\n2018-07-17  Ed Schonberg  <schonberg@adacore.com>\n\ngcc/ada/\n\n\t* sem_util.adb (Enclosing_Subprogram): Handle properly entries, and\n\tsynchronized types that are completions of limited types or private\n\textensions.\n\t(Scope_Within): Handle properly accept statements in task bodies.\n\nFrom-SVN: r262769", "tree": {"sha": "2941ff6bac237308cf8c36980db098063b826c12", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2941ff6bac237308cf8c36980db098063b826c12"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ad8adad11752db7a98fce95d9090f4c6fbb849b7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ad8adad11752db7a98fce95d9090f4c6fbb849b7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ad8adad11752db7a98fce95d9090f4c6fbb849b7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ad8adad11752db7a98fce95d9090f4c6fbb849b7/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8d45ce773959d3e89c18790d9f5b48d526dcdd07", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d45ce773959d3e89c18790d9f5b48d526dcdd07", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d45ce773959d3e89c18790d9f5b48d526dcdd07"}], "stats": {"total": 34, "additions": 30, "deletions": 4}, "files": [{"sha": "294602ee19aed562e6d83c5befa1ed2916d93753", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ad8adad11752db7a98fce95d9090f4c6fbb849b7/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ad8adad11752db7a98fce95d9090f4c6fbb849b7/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=ad8adad11752db7a98fce95d9090f4c6fbb849b7", "patch": "@@ -1,3 +1,10 @@\n+2018-07-17  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_util.adb (Enclosing_Subprogram): Handle properly entries, and\n+\tsynchronized types that are completions of limited types or private\n+\textensions.\n+\t(Scope_Within): Handle properly accept statements in task bodies.\n+\n 2018-07-17  Hristian Kirtchev  <kirtchev@adacore.com>\n \n \t* sem_prag.adb (Has_Visible_State): Do not consider generic formals"}, {"sha": "3b142521da9df8b7bf6f3179e7114e28485b2548", "filename": "gcc/ada/sem_util.adb", "status": "modified", "additions": 23, "deletions": 4, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ad8adad11752db7a98fce95d9090f4c6fbb849b7/gcc%2Fada%2Fsem_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ad8adad11752db7a98fce95d9090f4c6fbb849b7/gcc%2Fada%2Fsem_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.adb?ref=ad8adad11752db7a98fce95d9090f4c6fbb849b7", "patch": "@@ -6906,17 +6906,21 @@ package body Sem_Util is\n       elsif Ekind (Dynamic_Scope) = E_Subprogram_Body then\n          return Corresponding_Spec (Parent (Parent (Dynamic_Scope)));\n \n-      elsif Ekind (Dynamic_Scope) = E_Block\n-        or else Ekind (Dynamic_Scope) = E_Return_Statement\n+      elsif Ekind_In (Dynamic_Scope, E_Block, E_Return_Statement, E_Entry)\n       then\n          return Enclosing_Subprogram (Dynamic_Scope);\n \n       elsif Ekind (Dynamic_Scope) = E_Task_Type then\n          return Get_Task_Body_Procedure (Dynamic_Scope);\n \n-      elsif Ekind (Dynamic_Scope) = E_Limited_Private_Type\n+      --  The scope may appear as a private type or as a private extension\n+      --  whose completion is a task or protected type.\n+\n+      elsif Ekind_In (Dynamic_Scope,\n+              E_Limited_Private_Type, E_Record_Type_With_Private)\n         and then Present (Full_View (Dynamic_Scope))\n-        and then Ekind (Full_View (Dynamic_Scope)) = E_Task_Type\n+        and then Ekind_In (Full_View (Dynamic_Scope),\n+                            E_Task_Type, E_Protected_Type)\n       then\n          return Get_Task_Body_Procedure (Full_View (Dynamic_Scope));\n \n@@ -23994,6 +23998,21 @@ package body Sem_Util is\n \n          if Curr = Outer then\n             return True;\n+\n+         --  A selective accept body appears within a task type, but the\n+         --  enclosing subprogram is the procedure of the task body.\n+\n+         elsif Ekind (Curr) = E_Task_Type\n+           and then Outer = Task_Body_Procedure (Curr)\n+         then\n+            return True;\n+\n+         --  Ditto for the body of a protected operation.\n+\n+         elsif Is_Subprogram (Curr)\n+           and then Outer = Protected_Body_Subprogram (Curr)\n+         then\n+            return True;\n          end if;\n       end loop;\n "}]}