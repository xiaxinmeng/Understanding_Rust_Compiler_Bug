{"sha": "3f54004b095d1cd513e63753ee0f8f9f13698347", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2Y1NDAwNGIwOTVkMWNkNTEzZTYzNzUzZWUwZjhmOWYxMzY5ODM0Nw==", "commit": {"author": {"name": "Bin Cheng", "email": "bin.cheng@arm.com", "date": "2017-01-27T14:42:23Z"}, "committer": {"name": "Bin Cheng", "email": "amker@gcc.gnu.org", "date": "2017-01-27T14:42:23Z"}, "message": "re PR rtl-optimization/78559 (wrong code due to tree if-conversion?)\n\n\tPR rtl-optimization/78559\n\t* combine.c (try_combine): Discard REG_EQUAL and REG_EQUIV for\n\tother_insn in combine.\n\n\tgcc/testsuite\n\tPR rtl-optimization/78559\n\t* gcc.c-torture/execute/pr78559.c: New test.\n\nFrom-SVN: r244979", "tree": {"sha": "ae40843953b1dc70672e14ac10486ab8b3e101a6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ae40843953b1dc70672e14ac10486ab8b3e101a6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3f54004b095d1cd513e63753ee0f8f9f13698347", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3f54004b095d1cd513e63753ee0f8f9f13698347", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3f54004b095d1cd513e63753ee0f8f9f13698347", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3f54004b095d1cd513e63753ee0f8f9f13698347/comments", "author": null, "committer": null, "parents": [{"sha": "f6a24a94a63abf72a349346c0af46426a63aba1a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f6a24a94a63abf72a349346c0af46426a63aba1a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f6a24a94a63abf72a349346c0af46426a63aba1a"}], "stats": {"total": 56, "additions": 55, "deletions": 1}, "files": [{"sha": "b70acef6953e1a8d867a5a949f7bc0bb8a6ac6e4", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f54004b095d1cd513e63753ee0f8f9f13698347/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f54004b095d1cd513e63753ee0f8f9f13698347/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3f54004b095d1cd513e63753ee0f8f9f13698347", "patch": "@@ -1,3 +1,9 @@\n+2017-01-27  Bin Cheng  <bin.cheng@arm.com>\n+\n+\tPR rtl-optimization/78559\n+\t* combine.c (try_combine): Discard REG_EQUAL and REG_EQUIV for\n+\tother_insn in combine.\n+\n 2017-01-27  Pekka J\u00e4\u00e4skel\u00e4inen  <pekka.jaaskelainen@parmance.com>\n \n \t* builtin-types.def: Use unsigned_char_type_node for BT_UINT8.  Use"}, {"sha": "727299bdf501d8cf0a9d1d9d5ea1d0df677b89d9", "filename": "gcc/combine.c", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f54004b095d1cd513e63753ee0f8f9f13698347/gcc%2Fcombine.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f54004b095d1cd513e63753ee0f8f9f13698347/gcc%2Fcombine.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcombine.c?ref=3f54004b095d1cd513e63753ee0f8f9f13698347", "patch": "@@ -4148,7 +4148,16 @@ try_combine (rtx_insn *i3, rtx_insn *i2, rtx_insn *i1, rtx_insn *i0,\n \t\t\t\t     PATTERN (undobuf.other_insn)))\n \t      ||(REG_NOTE_KIND (note) == REG_UNUSED\n \t\t && !reg_set_p (XEXP (note, 0),\n-\t\t\t\tPATTERN (undobuf.other_insn))))\n+\t\t\t\tPATTERN (undobuf.other_insn)))\n+\t      /* Simply drop equal note since it may be no longer valid\n+\t\t for other_insn.  It may be possible to record that CC\n+\t\t register is changed and only discard those notes, but\n+\t\t in practice it's unnecessary complication and doesn't\n+\t\t give any meaningful improvement.\n+\n+\t\t See PR78559.  */\n+\t      || REG_NOTE_KIND (note) == REG_EQUAL\n+\t      || REG_NOTE_KIND (note) == REG_EQUIV)\n \t    remove_note (undobuf.other_insn, note);\n \t}\n "}, {"sha": "2dce32ecd59377fc295881a4e092e2ef53e7dfff", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f54004b095d1cd513e63753ee0f8f9f13698347/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f54004b095d1cd513e63753ee0f8f9f13698347/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3f54004b095d1cd513e63753ee0f8f9f13698347", "patch": "@@ -1,3 +1,8 @@\n+2017-01-27  Bin Cheng  <bin.cheng@arm.com>\n+\n+\tPR rtl-optimization/78559\n+\t* gcc.c-torture/execute/pr78559.c: New test.\n+\n 2017-01-27  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/79245"}, {"sha": "8d7b8e3004b5c6fdb160124d21ab1f2dd19b22ab", "filename": "gcc/testsuite/gcc.c-torture/execute/pr78559.c", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3f54004b095d1cd513e63753ee0f8f9f13698347/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr78559.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3f54004b095d1cd513e63753ee0f8f9f13698347/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr78559.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr78559.c?ref=3f54004b095d1cd513e63753ee0f8f9f13698347", "patch": "@@ -0,0 +1,34 @@\n+/* PR rtl-optimization/78559 */\n+\n+int g = 20;\n+int d = 0;\n+\n+short\n+fn2 (int p1, int p2)\n+{\n+  return p2 >= 2 || 5 >> p2 ? p1 : p1 << p2;\n+}\n+\n+int\n+main ()\n+{\n+  int result = 0;\n+lbl_2582:\n+  if (g)\n+    {\n+      for (int c = -3; c; c++)\n+        result = fn2 (1, g);\n+    }\n+  else\n+    {\n+      for (int i = 0; i < 2; i += 2)\n+        if (d)\n+          goto lbl_2582;\n+    }\n+  if (result != 1)\n+    __builtin_abort ();\n+  return 0;\n+}\n+\n+\n+"}]}