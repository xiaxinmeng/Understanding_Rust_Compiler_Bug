{"sha": "41ed243ff0f5c098b930eb3fcc333077b346348a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDFlZDI0M2ZmMGY1YzA5OGI5MzBlYjNmY2MzMzMwNzdiMzQ2MzQ4YQ==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2006-04-04T15:44:59Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2006-04-04T15:44:59Z"}, "message": "Temporarily reverting previous patch due to build-breaking bug.\n\nFrom-SVN: r112671", "tree": {"sha": "02f1e178f534d6216a8adca22d7b0bdc9d7e927f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/02f1e178f534d6216a8adca22d7b0bdc9d7e927f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/41ed243ff0f5c098b930eb3fcc333077b346348a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41ed243ff0f5c098b930eb3fcc333077b346348a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/41ed243ff0f5c098b930eb3fcc333077b346348a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41ed243ff0f5c098b930eb3fcc333077b346348a/comments", "author": null, "committer": null, "parents": [{"sha": "3967bc2db066d725dc3142af6646d30856e19619", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3967bc2db066d725dc3142af6646d30856e19619", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3967bc2db066d725dc3142af6646d30856e19619"}], "stats": {"total": 116, "additions": 39, "deletions": 77}, "files": [{"sha": "56ade6d6efcc5cfabdad8c9da5bd6ef255b7226e", "filename": "libjava/classpath/ChangeLog.gcj", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41ed243ff0f5c098b930eb3fcc333077b346348a/libjava%2Fclasspath%2FChangeLog.gcj", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41ed243ff0f5c098b930eb3fcc333077b346348a/libjava%2Fclasspath%2FChangeLog.gcj", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2FChangeLog.gcj?ref=41ed243ff0f5c098b930eb3fcc333077b346348a", "patch": "@@ -1,15 +1,3 @@\n-2006-04-04  Mark Wielaard  <mark@klomp.org>\n-\n-\t* lib/gen-classlist.sh.in: Use classes.tmp, not classes.2\n-\tas temporary file name.\n-\n-2006-04-04  Tom Tromey  <tromey@redhat.com>\n-\n-\t* lib/split-for-gcj.sh: Updated for multi-field format.\n-\t* lib/Makefile.am (CLEANFILES): Added classes.2.\n-\t* lib/gen-classlist.sh.in (GCJ): Removed.  Create classes.1 and\n-\tclasses.2 using multiple fields.\n-\n 2006-03-29  Tom Tromey  <tromey@redhat.com>\n \n \tPR gcc/26901:"}, {"sha": "d73be80a09a55a3bfbe9cb228af2cb049229eeea", "filename": "libjava/classpath/lib/Makefile.am", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41ed243ff0f5c098b930eb3fcc333077b346348a/libjava%2Fclasspath%2Flib%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41ed243ff0f5c098b930eb3fcc333077b346348a/libjava%2Fclasspath%2Flib%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Flib%2FMakefile.am?ref=41ed243ff0f5c098b930eb3fcc333077b346348a", "patch": "@@ -159,7 +159,7 @@ endif\n \n EXTRA_DIST = standard.omit mkcollections.pl.in Makefile.gcj split-for-gcj.sh\n CLEANFILES = compile-classes resources classes \\\n-\tglibj.zip classes.1 classes.2 \\\n+\tglibj.zip classes.1 \\\n \t$(top_builddir)/java/util/LocaleData.java \\\n \t$(JAVA_DEPEND)\n "}, {"sha": "e9b4f228f21e210589fb5abf581677630caedee1", "filename": "libjava/classpath/lib/Makefile.in", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41ed243ff0f5c098b930eb3fcc333077b346348a/libjava%2Fclasspath%2Flib%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41ed243ff0f5c098b930eb3fcc333077b346348a/libjava%2Fclasspath%2Flib%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Flib%2FMakefile.in?ref=41ed243ff0f5c098b930eb3fcc333077b346348a", "patch": "@@ -42,11 +42,9 @@ DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \\\n \t$(srcdir)/copy-vmresources.sh.in $(srcdir)/gen-classlist.sh.in \\\n \t$(srcdir)/mkcollections.pl.in\n ACLOCAL_M4 = $(top_srcdir)/aclocal.m4\n-am__aclocal_m4_deps = $(top_srcdir)/../../config/depstand.m4 \\\n-\t$(top_srcdir)/../../config/lead-dot.m4 \\\n-\t$(top_srcdir)/../../config/no-executables.m4 \\\n-\t$(top_srcdir)/../../libtool.m4 $(top_srcdir)/m4/acattribute.m4 \\\n-\t$(top_srcdir)/m4/accross.m4 $(top_srcdir)/m4/acinclude.m4 \\\n+am__aclocal_m4_deps = $(top_srcdir)/../../libtool.m4 \\\n+\t$(top_srcdir)/m4/acattribute.m4 $(top_srcdir)/m4/accross.m4 \\\n+\t$(top_srcdir)/m4/acinclude.m4 \\\n \t$(top_srcdir)/m4/ax_create_stdint_h.m4 \\\n \t$(top_srcdir)/m4/iconv.m4 $(top_srcdir)/m4/lib-ld.m4 \\\n \t$(top_srcdir)/m4/lib-link.m4 $(top_srcdir)/m4/lib-prefix.m4 \\\n@@ -278,7 +276,7 @@ JAVAH = $(USER_JAVAH) -jni -classpath .:$(USER_CLASSLIB)\n @BUILD_CLASS_FILES_TRUE@noinst_DATA = genclasses compile-classes resources\n EXTRA_DIST = standard.omit mkcollections.pl.in Makefile.gcj split-for-gcj.sh\n CLEANFILES = compile-classes resources classes \\\n-\tglibj.zip classes.1 classes.2 \\\n+\tglibj.zip classes.1 \\\n \t$(top_builddir)/java/util/LocaleData.java \\\n \t$(JAVA_DEPEND)\n "}, {"sha": "4c3a836eb49a92535bac3f9ceecfe1d24c06d94e", "filename": "libjava/classpath/lib/gen-classlist.sh.in", "status": "modified", "additions": 21, "deletions": 43, "changes": 64, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41ed243ff0f5c098b930eb3fcc333077b346348a/libjava%2Fclasspath%2Flib%2Fgen-classlist.sh.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41ed243ff0f5c098b930eb3fcc333077b346348a/libjava%2Fclasspath%2Flib%2Fgen-classlist.sh.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Flib%2Fgen-classlist.sh.in?ref=41ed243ff0f5c098b930eb3fcc333077b346348a", "patch": "@@ -7,34 +7,16 @@\n LC_ALL=C; export LC_ALL\n LANG=C; export LANG\n \n-echo \"Adding java source files from srcdir '@top_srcdir@'.\"\n-# We construct 'classes.1' as a series of lines.  Each line\n-# has three fields, which are separated by spaces.  The first\n-# field is the package of this class (separated by \"/\"s).\n-# The second field is the name of the top-level directory for\n-# this file, relative to the build directory.  E.g., it might\n-# look like \"../../classpath/vm/reference\".\n-# The third field is the file name, like \"java/lang/Object.java\".\n-# We do this because it makes splitting for the gcj build much\n-# cheaper.\n-(cd @top_srcdir@\n- @FIND@ java javax gnu org -follow -name '*.java' -print |\n- sort -r | sed -e 's,/\\([^/]*\\)$, \\1,' |\n- while read pkg file; do\n-    echo $pkg @top_srcdir@ $pkg/$file\n- done) > ${top_builddir}/lib/classes.1\n+# We use this to decide whether we need to invoke the split script.\n+GCJ=\"@GCJ@\"\n \n-# The same, but for the external code.\n-# Right now all external code is in org/.\n-for dir in @top_srcdir@/external/w3c_dom \\\n-   @top_srcdir@/external/sax @top_srcdir@/external/relaxngDatatype; do\n-  (cd $dir\n-  @FIND@ org -follow -name '*.java' -print |\n-  sort -r | sed -e 's,/\\([^/]*\\)$, \\1,' |\n-  while read pkg file; do\n-     echo $pkg $dir $pkg/$file\n-  done)\n-done >> ${top_builddir}/lib/classes.1\n+echo \"Adding java source files from srcdir '@top_srcdir@'.\"\n+@FIND@ @top_srcdir@/java @top_srcdir@/javax @top_srcdir@/gnu \\\n+       @top_srcdir@/org \\\n+       @top_srcdir@/external/w3c_dom @top_srcdir@/external/sax \\\n+       @top_srcdir@/external/relaxngDatatype \\\n+       -follow -type f -print | sort -r | grep '\\.java$' \\\n+       > ${top_builddir}/lib/classes.1\n \n # Generate files for the VM classes.\n : > vm.omit\n@@ -47,19 +29,18 @@ for dir in $vm_dirlist; do\n       if test -d $subdir; then\n \t @FIND@ $subdir -name '*.java' -print\n       fi\n-   done) | sed -e 's,/\\([^/]*\\)$, \\1,' |\n-   while read pkg file; do\n-      echo $pkg $dir $pkg/$file >> vm.add\n-      echo $pkg/$file >> vm.omit\n+   done) |\n+   while read f; do\n+      echo $dir/$f >> vm.add\n+      echo $f >> vm.omit\n    done\n done\n \n # Only include generated files once.\n if test ! \"${top_builddir}\" -ef \"@top_srcdir@\"; then\n   echo \"Adding generated files in builddir '${top_builddir}'.\"\n-  # Currently the only generated files are in gnu.*.\n-  @FIND@ ${top_builddir}/gnu -follow -name '*.java' -print \\\n-  | sort >> ${top_builddir}/lib/classes.1\n+  @FIND@ ${top_builddir}/gnu ${top_builddir}/java -follow -type f -print \\\n+  | sort | grep '\\.java$' >> ${top_builddir}/lib/classes.1\n fi\n \n \n@@ -70,10 +51,9 @@ for dir in $vm_dirlist; do\n    fi\n done\n \n-# FIXME: could be more efficient by constructing a series of greps.\n for filexp in `cat tmp.omit`; do\n-   grep -v ${filexp} < ${top_builddir}/lib/classes.1 > ${top_builddir}/lib/classes.tmp\n-   mv ${top_builddir}/lib/classes.tmp ${top_builddir}/lib/classes.1\n+   grep -v ${filexp} < ${top_builddir}/lib/classes.1 > ${top_builddir}/lib/classes.2\n+   mv ${top_builddir}/lib/classes.2 ${top_builddir}/lib/classes.1\n done\n \n \n@@ -92,20 +72,18 @@ rm vm.add\n rm tmp.omit\n \n new=\n-if test -e ${top_builddir}/lib/classes.2; then\n-  p=`diff ${top_builddir}/lib/classes.2 ${top_builddir}/lib/classes.1`\n+if test -e ${top_builddir}/lib/classes; then\n+  p=`diff ${top_builddir}/lib/classes ${top_builddir}/lib/classes.1`\n   if test \"$p\" != \"\"; then\n     new=\"true\"\n+    cp ${top_builddir}/lib/classes.1 ${top_builddir}/lib/classes\n   fi\n else\n   new=\"true\"\n+  cp ${top_builddir}/lib/classes.1 ${top_builddir}/lib/classes\n fi\n \n if test \"$new\" = \"true\"; then\n-  cp ${top_builddir}/lib/classes.1 ${top_builddir}/lib/classes.2\n-  # Strip the package part.\n-  sed -e 's/^[^ ]* //' -e 's, ,/,' < ${top_builddir}/lib/classes.1 \\\n-     > ${top_builddir}/lib/classes\n   echo \"JAVA_SRCS = \\\\\" > ${top_builddir}/lib/java.dep\n   for i in `cat ${top_builddir}/lib/classes` ; do\n     echo $i \"\\\\\" >> ${top_builddir}/lib/java.dep"}, {"sha": "f69b79797288d14aa38957d1fd33dfe8f19a98f5", "filename": "libjava/classpath/lib/split-for-gcj.sh", "status": "modified", "additions": 13, "deletions": 15, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41ed243ff0f5c098b930eb3fcc333077b346348a/libjava%2Fclasspath%2Flib%2Fsplit-for-gcj.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41ed243ff0f5c098b930eb3fcc333077b346348a/libjava%2Fclasspath%2Flib%2Fsplit-for-gcj.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Flib%2Fsplit-for-gcj.sh?ref=41ed243ff0f5c098b930eb3fcc333077b346348a", "patch": "@@ -22,24 +22,22 @@\n # java/awt/BitwiseXORComposite.class: lists/java-awt.stamp\n # lists/java-awt.list: /home/aph/gcc/gcc/libjava/classpath/gnu/java/awt/BitwiseXORComposite.java\n \n+# This uses a somewhat hacky procedure for finding the package of a\n+# given file.\n+\n echo \"Splitting for gcj\"\n rm -f Makefile.dtmp > /dev/null 2>&1\n test -d lists || mkdir lists\n-# Much more efficient to do processing outside the loop...\n-# The first expression computes the .class file name.\n-# We only want the first three package components, and\n-# we want them separated by '-'; this is the remaining expressions.\n-sed -e 's, \\(.*\\)[.]java$, \\1.java \\1.class,' \\\n-   -e 's,^\\([^/ ]*\\)/\\([^/ ]*\\) ,\\1-\\2 ,' \\\n-   -e 's,^\\([^/ ]*\\)/\\([^/ ]*\\)/\\([^/ ]*\\) ,\\1-\\2-\\3 ,' \\\n-   -e 's,^\\([^/ ]*\\)/\\([^/ ]*\\)/\\([^/ ]*\\)/[^ ]* ,\\1-\\2-\\3 ,' \\\n-   classes.2 |\n-while read pkg dir file f2; do\n-   list=lists/$pkg\n-   echo \"$dir/$file\" >> ${list}.list.1\n-\n-   echo \"$f2: ${list}.stamp\" >> Makefile.dtmp\n-   echo \"${list}.list: $dir/$file\" >> Makefile.dtmp\n+for dir in java javax gnu org; do\n+   fgrep /$dir/ classes | while read file; do\n+      pkg=`echo \"$file \" | sed -n -e \"s,^.*/\\($dir/.*\\)/[^/]*$,\\1,p\"`\n+      list=lists/`echo $pkg | sed -e 's,/,-,g' | cut -f1-3 -d-`\n+      echo \"$file\" >> ${list}.list.1\n+      f2=`echo \"$file\" | sed -n -e \"s,^.*/\\($dir/.*\\)$,\\1,p\"`\n+      f2=`echo \"$f2\" | sed -e 's/.java$//'`.class\n+      echo \"$f2: ${list}.stamp\" >> Makefile.dtmp\n+      echo \"${list}.list: $file\" >> Makefile.dtmp\n+   done\n done\n \n # Only update a .list file if it changed."}]}