{"sha": "ddd84654d90b8056c5aa1a5f164cb685db327aa0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGRkODQ2NTRkOTBiODA1NmM1YWExYTVmMTY0Y2I2ODVkYjMyN2FhMA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2013-02-01T16:54:14Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2013-02-01T16:54:14Z"}, "message": "re PR debug/54793 (the location of a formal_parameter is not started from a function entry with -mfentry)\n\n\tPR debug/54793\n\t* final.c (need_profile_function): New variable.\n\t(final_start_function): Drop ATTRIBUTE_UNUSED from first argument.\n\tIf first of NOTE_INSN_BASIC_BLOCK or NOTE_INSN_FUNCTION_BEG\n\tis only preceeded by NOTE_INSN_VAR_LOCATION or NOTE_INSN_DELETED\n\tnotes, targetm.asm_out.function_prologue doesn't emit anything,\n\tHAVE_prologue and profiler should be emitted before prologue,\n\tset need_profile_function instead of emitting it.\n\t(final_scan_insn): If need_profile_function, emit\n\tprofile_function on the first NOTE_INSN_BASIC_BLOCK or\n\tNOTE_INSN_FUNCTION_BEG note.\n\nFrom-SVN: r195669", "tree": {"sha": "4264a1a3f1368ddcd45a42f2892206f8d366b30c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4264a1a3f1368ddcd45a42f2892206f8d366b30c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ddd84654d90b8056c5aa1a5f164cb685db327aa0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ddd84654d90b8056c5aa1a5f164cb685db327aa0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ddd84654d90b8056c5aa1a5f164cb685db327aa0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ddd84654d90b8056c5aa1a5f164cb685db327aa0/comments", "author": null, "committer": null, "parents": [{"sha": "ff2a9d88b4748f1ccbf2e8e368fa499fa861c9c7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff2a9d88b4748f1ccbf2e8e368fa499fa861c9c7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff2a9d88b4748f1ccbf2e8e368fa499fa861c9c7"}], "stats": {"total": 71, "additions": 68, "deletions": 3}, "files": [{"sha": "bbe5a665f1d246478571c3c725dfdae92d8e0a9c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ddd84654d90b8056c5aa1a5f164cb685db327aa0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ddd84654d90b8056c5aa1a5f164cb685db327aa0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ddd84654d90b8056c5aa1a5f164cb685db327aa0", "patch": "@@ -1,4 +1,18 @@\n-2013-02-01  Richard Henderson <rth@redhat.com>\n+2013-02-01  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/54793\n+\t* final.c (need_profile_function): New variable.\n+\t(final_start_function): Drop ATTRIBUTE_UNUSED from first argument.\n+\tIf first of NOTE_INSN_BASIC_BLOCK or NOTE_INSN_FUNCTION_BEG\n+\tis only preceeded by NOTE_INSN_VAR_LOCATION or NOTE_INSN_DELETED\n+\tnotes, targetm.asm_out.function_prologue doesn't emit anything,\n+\tHAVE_prologue and profiler should be emitted before prologue,\n+\tset need_profile_function instead of emitting it.\n+\t(final_scan_insn): If need_profile_function, emit\n+\tprofile_function on the first NOTE_INSN_BASIC_BLOCK or\n+\tNOTE_INSN_FUNCTION_BEG note.\n+\n+2013-02-01  Richard Henderson  <rth@redhat.com>\n \n \t* config/rs6000/rs6000.md (smulditi3): New.\n \t(umulditi3): New."}, {"sha": "d25b8e0b7e4b9657ce34ad66ee8d4c6c25c368f7", "filename": "gcc/final.c", "status": "modified", "additions": 53, "deletions": 2, "changes": 55, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ddd84654d90b8056c5aa1a5f164cb685db327aa0/gcc%2Ffinal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ddd84654d90b8056c5aa1a5f164cb685db327aa0/gcc%2Ffinal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffinal.c?ref=ddd84654d90b8056c5aa1a5f164cb685db327aa0", "patch": "@@ -200,6 +200,9 @@ rtx current_insn_predicate;\n /* True if printing into -fdump-final-insns= dump.  */   \n bool final_insns_dump_p;\n \n+/* True if profile_function should be called, but hasn't been called yet.  */\n+static bool need_profile_function;\n+\n static int asm_insn_count (rtx);\n static void profile_function (FILE *);\n static void profile_after_prologue (FILE *);\n@@ -1668,13 +1671,15 @@ reemit_insn_block_notes (void)\n      test and compare insns.  */\n \n void\n-final_start_function (rtx first ATTRIBUTE_UNUSED, FILE *file,\n+final_start_function (rtx first, FILE *file,\n \t\t      int optimize_p ATTRIBUTE_UNUSED)\n {\n   block_depth = 0;\n \n   this_is_asm_operands = 0;\n \n+  need_profile_function = false;\n+\n   last_filename = LOCATION_FILE (prologue_location);\n   last_linenum = LOCATION_LINE (prologue_location);\n   last_discriminator = discriminator = 0;\n@@ -1695,7 +1700,41 @@ final_start_function (rtx first ATTRIBUTE_UNUSED, FILE *file,\n   /* The Sun386i and perhaps other machines don't work right\n      if the profiling code comes after the prologue.  */\n   if (targetm.profile_before_prologue () && crtl->profile)\n-    profile_function (file);\n+    {\n+      if (targetm.asm_out.function_prologue\n+\t  == default_function_pro_epilogue\n+#ifdef HAVE_prologue\n+\t  && HAVE_prologue\n+#endif\n+\t )\n+\t{\n+\t  rtx insn;\n+\t  for (insn = first; insn; insn = NEXT_INSN (insn))\n+\t    if (!NOTE_P (insn))\n+\t      {\n+\t\tinsn = NULL_RTX;\n+\t\tbreak;\n+\t      }\n+\t    else if (NOTE_KIND (insn) == NOTE_INSN_BASIC_BLOCK\n+\t\t     || NOTE_KIND (insn) == NOTE_INSN_FUNCTION_BEG)\n+\t      break;\n+\t    else if (NOTE_KIND (insn) == NOTE_INSN_DELETED\n+\t\t     || NOTE_KIND (insn) == NOTE_INSN_VAR_LOCATION)\n+\t      continue;\n+\t    else\n+\t      {\n+\t\tinsn = NULL_RTX;\n+\t\tbreak;\n+\t      }\n+\n+\t  if (insn)\n+\t    need_profile_function = true;\n+\t  else\n+\t    profile_function (file);\n+\t}\n+      else\n+\tprofile_function (file);\n+    }\n \n   /* If debugging, assign block numbers to all of the blocks in this\n      function.  */\n@@ -2075,6 +2114,12 @@ final_scan_insn (rtx insn, FILE *file, int optimize_p ATTRIBUTE_UNUSED,\n \t  break;\n \n \tcase NOTE_INSN_BASIC_BLOCK:\n+\t  if (need_profile_function)\n+\t    {\n+\t      profile_function (asm_out_file);\n+\t      need_profile_function = false;\n+\t    }\n+\n \t  if (targetm.asm_out.unwind_emit)\n \t    targetm.asm_out.unwind_emit (asm_out_file, insn);\n \n@@ -2130,6 +2175,12 @@ final_scan_insn (rtx insn, FILE *file, int optimize_p ATTRIBUTE_UNUSED,\n \t  break;\n \n \tcase NOTE_INSN_FUNCTION_BEG:\n+\t  if (need_profile_function)\n+\t    {\n+\t      profile_function (asm_out_file);\n+\t      need_profile_function = false;\n+\t    }\n+\n \t  app_disable ();\n \t  if (!DECL_IGNORED_P (current_function_decl))\n \t    debug_hooks->end_prologue (last_linenum, last_filename);"}]}