{"sha": "5f6e1c559b08a262977b1cbcfe16f75116fef4f7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWY2ZTFjNTU5YjA4YTI2Mjk3N2IxY2JjZmUxNmY3NTExNmZlZjRmNw==", "commit": {"author": {"name": "Marc Glisse", "email": "marc.glisse@inria.fr", "date": "2012-10-01T09:53:26Z"}, "committer": {"name": "Marc Glisse", "email": "glisse@gcc.gnu.org", "date": "2012-10-01T09:53:26Z"}, "message": "simplify-rtx.c (simplify_binary_operation_1): Detect the identity.\n\n2012-10-01  Marc Glisse  <marc.glisse@inria.fr>\n\ngcc/\n\t* simplify-rtx.c (simplify_binary_operation_1) <VEC_SELECT>:\n\tDetect the identity.\n\t<VEC_CONCAT>: Handle VEC_SELECTs from the same vector.\n\ngcc/testsuite/\n\t* gcc.target/i386/vect-rebuild.c: New testcase.\n\nFrom-SVN: r191909", "tree": {"sha": "323d8a354041efc900f2e813aecb6d428aa1da25", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/323d8a354041efc900f2e813aecb6d428aa1da25"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5f6e1c559b08a262977b1cbcfe16f75116fef4f7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f6e1c559b08a262977b1cbcfe16f75116fef4f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5f6e1c559b08a262977b1cbcfe16f75116fef4f7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f6e1c559b08a262977b1cbcfe16f75116fef4f7/comments", "author": {"login": "mglisse", "id": 10097863, "node_id": "MDQ6VXNlcjEwMDk3ODYz", "avatar_url": "https://avatars.githubusercontent.com/u/10097863?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mglisse", "html_url": "https://github.com/mglisse", "followers_url": "https://api.github.com/users/mglisse/followers", "following_url": "https://api.github.com/users/mglisse/following{/other_user}", "gists_url": "https://api.github.com/users/mglisse/gists{/gist_id}", "starred_url": "https://api.github.com/users/mglisse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mglisse/subscriptions", "organizations_url": "https://api.github.com/users/mglisse/orgs", "repos_url": "https://api.github.com/users/mglisse/repos", "events_url": "https://api.github.com/users/mglisse/events{/privacy}", "received_events_url": "https://api.github.com/users/mglisse/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3c321286b46e0819f24f2b6749da8687685e8b8b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3c321286b46e0819f24f2b6749da8687685e8b8b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3c321286b46e0819f24f2b6749da8687685e8b8b"}], "stats": {"total": 78, "additions": 78, "deletions": 0}, "files": [{"sha": "35c062c5979ad7a98b07ad108c997e97798a7303", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f6e1c559b08a262977b1cbcfe16f75116fef4f7/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f6e1c559b08a262977b1cbcfe16f75116fef4f7/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5f6e1c559b08a262977b1cbcfe16f75116fef4f7", "patch": "@@ -1,3 +1,9 @@\n+2012-10-01  Marc Glisse  <marc.glisse@inria.fr>\n+\n+\t* simplify-rtx.c (simplify_binary_operation_1) <VEC_SELECT>:\n+\tDetect the identity.\n+\t<VEC_CONCAT>: Handle VEC_SELECTs from the same vector.\n+\n 2012-10-01  Oleg Endo  <olegendo@gcc.gnu.org>\n \n \tPR target/50457"}, {"sha": "aebe6bbd93b9bb8d97ffb977ab199bb2c938df8d", "filename": "gcc/simplify-rtx.c", "status": "modified", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f6e1c559b08a262977b1cbcfe16f75116fef4f7/gcc%2Fsimplify-rtx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f6e1c559b08a262977b1cbcfe16f75116fef4f7/gcc%2Fsimplify-rtx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsimplify-rtx.c?ref=5f6e1c559b08a262977b1cbcfe16f75116fef4f7", "patch": "@@ -3246,6 +3246,23 @@ simplify_binary_operation_1 (enum rtx_code code, enum machine_mode mode,\n \t      return gen_rtx_CONST_VECTOR (mode, v);\n \t    }\n \n+\t  /* Recognize the identity.  */\n+\t  if (GET_MODE (trueop0) == mode)\n+\t    {\n+\t      bool maybe_ident = true;\n+\t      for (int i = 0; i < XVECLEN (trueop1, 0); i++)\n+\t\t{\n+\t\t  rtx j = XVECEXP (trueop1, 0, i);\n+\t\t  if (!CONST_INT_P (j) || INTVAL (j) != i)\n+\t\t    {\n+\t\t      maybe_ident = false;\n+\t\t      break;\n+\t\t    }\n+\t\t}\n+\t      if (maybe_ident)\n+\t\treturn trueop0;\n+\t    }\n+\n \t  /* If we build {a,b} then permute it, build the result directly.  */\n \t  if (XVECLEN (trueop1, 0) == 2\n \t      && CONST_INT_P (XVECEXP (trueop1, 0, 0))\n@@ -3371,6 +3388,24 @@ simplify_binary_operation_1 (enum rtx_code code, enum machine_mode mode,\n \n \t    return gen_rtx_CONST_VECTOR (mode, v);\n \t  }\n+\n+\t/* Try to merge VEC_SELECTs from the same vector into a single one.  */\n+\tif (GET_CODE (trueop0) == VEC_SELECT\n+\t    && GET_CODE (trueop1) == VEC_SELECT\n+\t    && rtx_equal_p (XEXP (trueop0, 0), XEXP (trueop1, 0)))\n+\t  {\n+\t    rtx par0 = XEXP (trueop0, 1);\n+\t    rtx par1 = XEXP (trueop1, 1);\n+\t    int len0 = XVECLEN (par0, 0);\n+\t    int len1 = XVECLEN (par1, 0);\n+\t    rtvec vec = rtvec_alloc (len0 + len1);\n+\t    for (int i = 0; i < len0; i++)\n+\t      RTVEC_ELT (vec, i) = XVECEXP (par0, 0, i);\n+\t    for (int i = 0; i < len1; i++)\n+\t      RTVEC_ELT (vec, len0 + i) = XVECEXP (par1, 0, i);\n+\t    return simplify_gen_binary (VEC_SELECT, mode, XEXP (trueop0, 0),\n+\t\t\t\t\tgen_rtx_PARALLEL (VOIDmode, vec));\n+\t  }\n       }\n       return 0;\n "}, {"sha": "aa9ddad7a842448b1750bbada7f71b2913acec96", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f6e1c559b08a262977b1cbcfe16f75116fef4f7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f6e1c559b08a262977b1cbcfe16f75116fef4f7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5f6e1c559b08a262977b1cbcfe16f75116fef4f7", "patch": "@@ -1,3 +1,7 @@\n+2012-10-01  Marc Glisse  <marc.glisse@inria.fr>\n+\n+\t* gcc.target/i386/vect-rebuild.c: New testcase.\n+\n 2012-09-30  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* gcc.target/i386/pad-10.c (foo2): Return x - z."}, {"sha": "570967f6b5c8b8c2fe4609a815d46652e1f64ee4", "filename": "gcc/testsuite/gcc.target/i386/vect-rebuild.c", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f6e1c559b08a262977b1cbcfe16f75116fef4f7/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fvect-rebuild.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f6e1c559b08a262977b1cbcfe16f75116fef4f7/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fvect-rebuild.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fvect-rebuild.c?ref=5f6e1c559b08a262977b1cbcfe16f75116fef4f7", "patch": "@@ -0,0 +1,33 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O -mavx -fno-tree-forwprop\" } */\n+\n+typedef double v2df __attribute__ ((__vector_size__ (16)));\n+typedef double v4df __attribute__ ((__vector_size__ (32)));\n+\n+v2df f1 (v2df x)\n+{\n+  v2df xx = { x[0], x[1] };\n+  return xx;\n+}\n+\n+v4df f2 (v4df x)\n+{\n+  v4df xx = { x[0], x[1], x[2], x[3] };\n+  return xx;\n+}\n+\n+v2df g (v2df x)\n+{\n+  v2df xx = { x[1], x[0] };\n+  return xx;\n+}\n+\n+v2df h (v4df x)\n+{\n+  v2df xx = { x[2], x[3] };\n+  return xx;\n+}\n+\n+/* { dg-final { scan-assembler-not \"unpck\" } } */\n+/* { dg-final { scan-assembler-times \"\\tv?permilpd\\[ \\t\\]\" 1 } } */\n+/* { dg-final { scan-assembler-times \"\\tv?extractf128\\[ \\t\\]\" 1 } } */"}]}