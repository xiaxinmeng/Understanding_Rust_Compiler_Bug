{"sha": "50c9d049978e096b754415819c521c9d9504173e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTBjOWQwNDk5NzhlMDk2Yjc1NDQxNTgxOWM1MjFjOWQ5NTA0MTczZQ==", "commit": {"author": {"name": "Richard Earnshaw", "email": "rearnsha@arm.com", "date": "2011-12-22T14:13:09Z"}, "committer": {"name": "Richard Earnshaw", "email": "rearnsha@gcc.gnu.org", "date": "2011-12-22T14:13:09Z"}, "message": "re PR target/51643 (Incorrect code produced for tail-call of weak function with -O2/-O3 option)\n\n\tPR target/51643\n\t* arm.c (arm_function_ok_for_sibcall): Don't try to tailcall a\n\tweak function on bare-metal EABI targets.\n\n\t* gcc.target/arm/sibcall-2.c: New test.\n\nFrom-SVN: r182621", "tree": {"sha": "bce6c504cb06327a64dfee7c868d0aae7206e80c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bce6c504cb06327a64dfee7c868d0aae7206e80c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/50c9d049978e096b754415819c521c9d9504173e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50c9d049978e096b754415819c521c9d9504173e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/50c9d049978e096b754415819c521c9d9504173e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50c9d049978e096b754415819c521c9d9504173e/comments", "author": null, "committer": null, "parents": [{"sha": "9dacb44bf10a5151a0d0e1a2a22865ed00575d40", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9dacb44bf10a5151a0d0e1a2a22865ed00575d40", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9dacb44bf10a5151a0d0e1a2a22865ed00575d40"}], "stats": {"total": 31, "additions": 31, "deletions": 0}, "files": [{"sha": "d1c9a2f625369ae138f8c4ceb5f5975b7cd1f35b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50c9d049978e096b754415819c521c9d9504173e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50c9d049978e096b754415819c521c9d9504173e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=50c9d049978e096b754415819c521c9d9504173e", "patch": "@@ -1,3 +1,9 @@\n+2011-12-21  Richard Earnshaw  <rearnsha@arm.com>\n+\n+\tPR target/51643\n+\t* arm.c (arm_function_ok_for_sibcall): Don't try to tailcall a\n+\tweak function on bare-metal EABI targets.\n+\n 2011-12-21  Jonathan Wakely  <jwakely.gcc@gmail.com>\n \t    Jim Avera  <james_avera@yahoo.com>\n "}, {"sha": "fec43fba90399666ae5291fcd4bc804c9f82ac86", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50c9d049978e096b754415819c521c9d9504173e/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50c9d049978e096b754415819c521c9d9504173e/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=50c9d049978e096b754415819c521c9d9504173e", "patch": "@@ -5250,6 +5250,14 @@ arm_function_ok_for_sibcall (tree decl, tree exp)\n   if (IS_STACKALIGN (func_type))\n     return false;\n \n+  /* The AAPCS says that, on bare-metal, calls to unresolved weak\n+     references should become a NOP.  Don't convert such calls into\n+     sibling calls.  */\n+  if (TARGET_AAPCS_BASED\n+      && arm_abi == ARM_ABI_AAPCS\n+      && lookup_attribute (\"weak\", DECL_ATTRIBUTES (decl)))\n+    return false;\n+\n   /* Everything else is ok.  */\n   return true;\n }"}, {"sha": "9e58adc714ca71866b2aefa6ae88d59698b08848", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50c9d049978e096b754415819c521c9d9504173e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50c9d049978e096b754415819c521c9d9504173e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=50c9d049978e096b754415819c521c9d9504173e", "patch": "@@ -1,3 +1,8 @@\n+2011-12-21  Richard Earnshaw  <rearnsha@arm.com>\n+\n+\tPR target/51643\n+\t* gcc.target/arm/sibcall-2.c: New test.\n+\n 2011-12-22  Uros Bizjak  <ubizjak@gmail.com>\n \n \tPR testsuite/51645"}, {"sha": "921c0f30284bb77f522f77c089628b950098a3da", "filename": "gcc/testsuite/gcc.target/arm/sibcall-2.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50c9d049978e096b754415819c521c9d9504173e/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fsibcall-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50c9d049978e096b754415819c521c9d9504173e/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fsibcall-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fsibcall-2.c?ref=50c9d049978e096b754415819c521c9d9504173e", "patch": "@@ -0,0 +1,12 @@\n+/* { dg-require-effective-target arm_eabi } */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -mabi=aapcs\" } */\n+\n+\n+extern void __attribute__((weak)) wfunc(void);\n+void main(void)\n+{\n+  wfunc();  /* Must not tail-call.  */\n+}\n+\n+/* { dg-final { scan-assembler-not \"b\\[\\\\t \\]+wfunc\" } } */"}]}