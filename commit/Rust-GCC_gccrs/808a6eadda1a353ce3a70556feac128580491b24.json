{"sha": "808a6eadda1a353ce3a70556feac128580491b24", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODA4YTZlYWRkYTFhMzUzY2UzYTcwNTU2ZmVhYzEyODU4MDQ5MWIyNA==", "commit": {"author": {"name": "Jose Rui Faustino de Sousa", "email": "jrfsousa@gmail.com", "date": "2020-04-22T16:20:26Z"}, "committer": {"name": "Thomas K\u00f6nig", "email": "tkoenig@gcc.gnu.org", "date": "2020-04-22T16:20:26Z"}, "message": "For assumed-size arrays check if the reference is to a full array.\n\n2020-04-22  Jos\u00e9 Rui Faustino de Sousa  <jrfsousa@gmail.com>\n\n\tPR fortran/90350\n\t* simplify.c (simplify_bound): In the case of assumed-size arrays\n\tcheck if the reference is to a full array.\n\n2020-04-22  Jos\u00e9 Rui Faustino de Sousa  <jrfsousa@gmail.com>\n\n\tPR fortran/90350\n\t* gfortran.dg/PR90350.f90: New test.", "tree": {"sha": "0625b3c4972f2ee041039fc19c22144e91c20998", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0625b3c4972f2ee041039fc19c22144e91c20998"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/808a6eadda1a353ce3a70556feac128580491b24", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/808a6eadda1a353ce3a70556feac128580491b24", "html_url": "https://github.com/Rust-GCC/gccrs/commit/808a6eadda1a353ce3a70556feac128580491b24", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/808a6eadda1a353ce3a70556feac128580491b24/comments", "author": {"login": "jrfsousa", "id": 56982651, "node_id": "MDQ6VXNlcjU2OTgyNjUx", "avatar_url": "https://avatars.githubusercontent.com/u/56982651?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jrfsousa", "html_url": "https://github.com/jrfsousa", "followers_url": "https://api.github.com/users/jrfsousa/followers", "following_url": "https://api.github.com/users/jrfsousa/following{/other_user}", "gists_url": "https://api.github.com/users/jrfsousa/gists{/gist_id}", "starred_url": "https://api.github.com/users/jrfsousa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jrfsousa/subscriptions", "organizations_url": "https://api.github.com/users/jrfsousa/orgs", "repos_url": "https://api.github.com/users/jrfsousa/repos", "events_url": "https://api.github.com/users/jrfsousa/events{/privacy}", "received_events_url": "https://api.github.com/users/jrfsousa/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "183e9006cc0300257d6f74d573514ef86f78cb4e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/183e9006cc0300257d6f74d573514ef86f78cb4e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/183e9006cc0300257d6f74d573514ef86f78cb4e"}], "stats": {"total": 34, "additions": 33, "deletions": 1}, "files": [{"sha": "1ab0514f49e3c971df25c2e4ed8bd186d8d61e13", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/808a6eadda1a353ce3a70556feac128580491b24/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/808a6eadda1a353ce3a70556feac128580491b24/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=808a6eadda1a353ce3a70556feac128580491b24", "patch": "@@ -1,3 +1,9 @@\n+2020-04-22  Jos\u00e9 Rui Faustino de Sousa  <jrfsousa@gmail.com>\n+\n+\tPR fortran/90350\n+\t* simplify.c (simplify_bound): In the case of assumed-size arrays\n+\tcheck if the reference is to a full array.\n+\n 2020-04-22  Tobias Burnus  <tobias@codesourcery.com>\n \n \tPR fortran/94709"}, {"sha": "eb8b2afeb29dedb3b346db2dc4ad2bf7e277cf82", "filename": "gcc/fortran/simplify.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/808a6eadda1a353ce3a70556feac128580491b24/gcc%2Ffortran%2Fsimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/808a6eadda1a353ce3a70556feac128580491b24/gcc%2Ffortran%2Fsimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsimplify.c?ref=808a6eadda1a353ce3a70556feac128580491b24", "patch": "@@ -4157,6 +4157,7 @@ simplify_bound (gfc_expr *array, gfc_expr *dim, gfc_expr *kind, int upper)\n {\n   gfc_ref *ref;\n   gfc_array_spec *as;\n+  ar_type type = AR_UNKNOWN;\n   int d;\n \n   if (array->ts.type == BT_CLASS)\n@@ -4180,6 +4181,7 @@ simplify_bound (gfc_expr *array, gfc_expr *dim, gfc_expr *kind, int upper)\n       switch (ref->type)\n \t{\n \tcase REF_ARRAY:\n+\t  type = ref->u.ar.type;\n \t  switch (ref->u.ar.type)\n \t    {\n \t    case AR_ELEMENT:\n@@ -4233,7 +4235,7 @@ simplify_bound (gfc_expr *array, gfc_expr *dim, gfc_expr *kind, int upper)\n       int k;\n \n       /* UBOUND(ARRAY) is not valid for an assumed-size array.  */\n-      if (upper && as && as->type == AS_ASSUMED_SIZE)\n+      if (upper && type == AR_FULL && as && as->type == AS_ASSUMED_SIZE)\n \t{\n \t  /* An error message will be emitted in\n \t     check_assumed_size_reference (resolve.c).  */"}, {"sha": "b23a2dd423b9b4225a1c77b9bd658321fc1a65d0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/808a6eadda1a353ce3a70556feac128580491b24/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/808a6eadda1a353ce3a70556feac128580491b24/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=808a6eadda1a353ce3a70556feac128580491b24", "patch": "@@ -1,3 +1,8 @@\n+2020-04-22  Jos\u00e9 Rui Faustino de Sousa  <jrfsousa@gmail.com>\n+\n+\tPR fortran/90350\n+\t* gfortran.dg/PR90350.f90: New test.\n+\n 2020-04-22  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/90448"}, {"sha": "2e2cf10a8139353a7e694304d15c513805051bd4", "filename": "gcc/testsuite/gfortran.dg/PR90350.f90", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/808a6eadda1a353ce3a70556feac128580491b24/gcc%2Ftestsuite%2Fgfortran.dg%2FPR90350.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/808a6eadda1a353ce3a70556feac128580491b24/gcc%2Ftestsuite%2Fgfortran.dg%2FPR90350.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2FPR90350.f90?ref=808a6eadda1a353ce3a70556feac128580491b24", "patch": "@@ -0,0 +1,19 @@\n+! { dg-do compile }\n+!\n+! Test the fix for PR90350\n+!\n+! Contributed by  <urbanjost@comcast.net>\n+!\n+\n+program artificial\n+implicit none\n+integer :: arr(-10:10)\n+   call asub(arr,size(arr))\n+end program artificial\n+subroutine asub(arr,n)\n+integer,intent(in) :: arr(*)\n+integer,intent(in) :: n\n+   write(*,*)'UPPER=',ubound(arr(:n))\n+   write(*,*)'LOWER=',lbound(arr(:n))\n+   write(*,*)'SIZE=',size(arr(:n))\n+end subroutine asub"}]}