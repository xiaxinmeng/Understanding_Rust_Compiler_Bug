{"sha": "5225a1389d0058ac8f64153efa64c8e07ec13c9a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTIyNWExMzg5ZDAwNThhYzhmNjQxNTNlZmE2NGM4ZTA3ZWMxM2M5YQ==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2009-04-22T22:01:57Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2009-04-22T22:01:57Z"}, "message": "utils.c (create_var_decl_1): Do not emit debug info for an external constant whose initializer is not absolute.\n\n\t* gcc-interface/utils.c (create_var_decl_1): Do not emit debug info\n\tfor an external constant whose initializer is not absolute.\n\nFrom-SVN: r146620", "tree": {"sha": "8d659d6b9745a45328c35d5aa08f6b9fea4c07b2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8d659d6b9745a45328c35d5aa08f6b9fea4c07b2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5225a1389d0058ac8f64153efa64c8e07ec13c9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5225a1389d0058ac8f64153efa64c8e07ec13c9a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5225a1389d0058ac8f64153efa64c8e07ec13c9a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5225a1389d0058ac8f64153efa64c8e07ec13c9a/comments", "author": null, "committer": null, "parents": [{"sha": "89043e8ac1a763e9791944acc993c6ef1d642e2a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/89043e8ac1a763e9791944acc993c6ef1d642e2a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/89043e8ac1a763e9791944acc993c6ef1d642e2a"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "acdc11cfc851f6d6a5c614a33509d167c855b6f9", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5225a1389d0058ac8f64153efa64c8e07ec13c9a/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5225a1389d0058ac8f64153efa64c8e07ec13c9a/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=5225a1389d0058ac8f64153efa64c8e07ec13c9a", "patch": "@@ -1,4 +1,9 @@\n-2009-04-21  Taras Glek <tglek@mozilla.com>\n+2009-04-22  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gcc-interface/utils.c (create_var_decl_1): Do not emit debug info\n+\tfor an external constant whose initializer is not absolute.\n+\n+2009-04-22  Taras Glek  <tglek@mozilla.com>\n \n \t* gcc-interface/ada-tree.h: Update GTY annotations to new syntax.\n \t* gcc-interface/trans.c: Likewise."}, {"sha": "6ea91389f6847ff13033f1be5d0984d237e3b390", "filename": "gcc/ada/gcc-interface/utils.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5225a1389d0058ac8f64153efa64c8e07ec13c9a/gcc%2Fada%2Fgcc-interface%2Futils.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5225a1389d0058ac8f64153efa64c8e07ec13c9a/gcc%2Fada%2Fgcc-interface%2Futils.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Futils.c?ref=5225a1389d0058ac8f64153efa64c8e07ec13c9a", "patch": "@@ -1347,6 +1347,15 @@ create_var_decl_1 (tree var_name, tree asm_name, tree type, tree var_init,\n   TREE_STATIC (var_decl)\n     = !extern_flag && (public_flag || static_flag || global_bindings_p ());\n \n+  /* For an external constant whose initializer is not absolute, do not emit\n+     debug info.  In DWARF this would mean a global relocation in a read-only\n+     section which runs afoul of the PE-COFF runtime relocation mechanism.  */\n+  if (extern_flag\n+      && constant_p\n+      && initializer_constant_valid_p (var_init, TREE_TYPE (var_init))\n+\t   != null_pointer_node)\n+    DECL_IGNORED_P (var_decl) = 1;\n+\n   if (asm_name && VAR_OR_FUNCTION_DECL_P (var_decl))\n     SET_DECL_ASSEMBLER_NAME (var_decl, asm_name);\n "}]}