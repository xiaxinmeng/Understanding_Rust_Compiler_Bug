{"sha": "64153cceb266ecd5794c158db93e92025b457d5d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjQxNTNjY2ViMjY2ZWNkNTc5NGMxNThkYjkzZTkyMDI1YjQ1N2Q1ZA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2011-07-28T16:21:08Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2011-07-28T16:21:08Z"}, "message": "re PR debug/49871 (-gdwarf-3 creates invalid DWARF3 with DW_AT_data_member_location attribute)\n\n\tPR debug/49871\n\t* dwarf2out.c (size_of_die, value_format, output_die): Use\n\tDW_FORM_udata instead of DW_FORM_data[48] for\n\tdw_val_class_unsigned_const DW_AT_data_member_location for DWARF 3.\n\n\t* gcc.dg/debug/dwarf2/pr49871.c: New test.\n\nFrom-SVN: r176876", "tree": {"sha": "7379b4d011cad1ddaa2ade0d8f107bdba79e0fc2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7379b4d011cad1ddaa2ade0d8f107bdba79e0fc2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/64153cceb266ecd5794c158db93e92025b457d5d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/64153cceb266ecd5794c158db93e92025b457d5d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/64153cceb266ecd5794c158db93e92025b457d5d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/64153cceb266ecd5794c158db93e92025b457d5d/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "844bf05b0d607c110483c0a01462c21a63b28c87", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/844bf05b0d607c110483c0a01462c21a63b28c87", "html_url": "https://github.com/Rust-GCC/gccrs/commit/844bf05b0d607c110483c0a01462c21a63b28c87"}], "stats": {"total": 53, "additions": 50, "deletions": 3}, "files": [{"sha": "4336abd717c11d2b46ffc4115592e72008ff5575", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/64153cceb266ecd5794c158db93e92025b457d5d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/64153cceb266ecd5794c158db93e92025b457d5d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=64153cceb266ecd5794c158db93e92025b457d5d", "patch": "@@ -1,3 +1,10 @@\n+2011-07-28  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/49871\n+\t* dwarf2out.c (size_of_die, value_format, output_die): Use\n+\tDW_FORM_udata instead of DW_FORM_data[48] for\n+\tdw_val_class_unsigned_const DW_AT_data_member_location for DWARF 3.\n+\n 2011-07-28  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* config/i386/i386.md (*tls_global_dynamic_64): Update"}, {"sha": "806c0d75c40e22245e2871cdbf057f54bba09052", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 26, "deletions": 3, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/64153cceb266ecd5794c158db93e92025b457d5d/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/64153cceb266ecd5794c158db93e92025b457d5d/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=64153cceb266ecd5794c158db93e92025b457d5d", "patch": "@@ -7652,7 +7652,15 @@ size_of_die (dw_die_ref die)\n \t  size += size_of_sleb128 (AT_int (a));\n \t  break;\n \tcase dw_val_class_unsigned_const:\n-\t  size += constant_size (AT_unsigned (a));\n+\t  {\n+\t    int csize = constant_size (AT_unsigned (a));\n+\t    if (dwarf_version == 3\n+\t\t&& a->dw_attr == DW_AT_data_member_location\n+\t\t&& csize >= 4)\n+\t      size += size_of_uleb128 (AT_unsigned (a));\n+\t    else\n+\t      size += csize;\n+\t  }\n \t  break;\n \tcase dw_val_class_const_double:\n \t  size += 2 * HOST_BITS_PER_WIDE_INT / HOST_BITS_PER_CHAR;\n@@ -7953,8 +7961,16 @@ value_format (dw_attr_ref a)\n \tcase 2:\n \t  return DW_FORM_data2;\n \tcase 4:\n+\t  /* In DWARF3 DW_AT_data_member_location with\n+\t     DW_FORM_data4 or DW_FORM_data8 is a loclistptr, not\n+\t     constant, so we need to use DW_FORM_udata if we need\n+\t     a large constant.  */\n+\t  if (dwarf_version == 3 && a->dw_attr == DW_AT_data_member_location)\n+\t    return DW_FORM_udata;\n \t  return DW_FORM_data4;\n \tcase 8:\n+\t  if (dwarf_version == 3 && a->dw_attr == DW_AT_data_member_location)\n+\t    return DW_FORM_udata;\n \t  return DW_FORM_data8;\n \tdefault:\n \t  gcc_unreachable ();\n@@ -8261,8 +8277,15 @@ output_die (dw_die_ref die)\n \t  break;\n \n \tcase dw_val_class_unsigned_const:\n-\t  dw2_asm_output_data (constant_size (AT_unsigned (a)),\n-\t\t\t       AT_unsigned (a), \"%s\", name);\n+\t  {\n+\t    int csize = constant_size (AT_unsigned (a));\n+\t    if (dwarf_version == 3\n+\t\t&& a->dw_attr == DW_AT_data_member_location\n+\t\t&& csize >= 4)\n+\t      dw2_asm_output_data_uleb128 (AT_unsigned (a), \"%s\", name);\n+\t    else\n+\t      dw2_asm_output_data (csize, AT_unsigned (a), \"%s\", name);\n+\t  }\n \t  break;\n \n \tcase dw_val_class_const_double:"}, {"sha": "e5837139646dda68007d389be3a97258b317bee7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/64153cceb266ecd5794c158db93e92025b457d5d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/64153cceb266ecd5794c158db93e92025b457d5d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=64153cceb266ecd5794c158db93e92025b457d5d", "patch": "@@ -1,3 +1,8 @@\n+2011-07-28  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/49871\n+\t* gcc.dg/debug/dwarf2/pr49871.c: New test.\n+\n 2011-07-28  Jakub Jelinek  <jakub@redhat.com>\n \n \t* gcc.target/i386/i386.exp (check_effective_target_bmi): Make sure"}, {"sha": "c1a58c4bd1aa5752f883ddc53e22010abaa3350d", "filename": "gcc/testsuite/gcc.dg/debug/dwarf2/pr49871.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/64153cceb266ecd5794c158db93e92025b457d5d/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fdwarf2%2Fpr49871.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/64153cceb266ecd5794c158db93e92025b457d5d/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fdwarf2%2Fpr49871.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fdwarf2%2Fpr49871.c?ref=64153cceb266ecd5794c158db93e92025b457d5d", "patch": "@@ -0,0 +1,12 @@\n+/* PR debug/49871 */\n+/* { dg-do compile } */\n+/* { dg-options \"-gdwarf-3 -dA -fno-merge-debug-strings\" } */\n+\n+struct S\n+{\n+  char a[1 << 16];\n+  int b;\n+} s;\n+\n+/* { dg-final { scan-assembler \"\\\\(DW_AT_data_member_location\\\\)\\[^\\\\r\\\\n\\]*\\[\\\\r\\\\n\\]+\\[^\\\\r\\\\n\\]*\\\\(DW_FORM_udata\\\\)\" } } */\n+/* { dg-final { scan-assembler-not \"\\\\(DW_AT_data_member_location\\\\)\\[^\\\\r\\\\n\\]*\\[\\\\r\\\\n\\]+\\[^\\\\r\\\\n\\]*\\\\(DW_FORM_data\\[48\\]\\\\)\" } } */"}]}