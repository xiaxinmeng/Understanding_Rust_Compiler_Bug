{"sha": "cc76c502a761ddaee215bcbd8fe4720e46d3b9dd", "node_id": "C_kwDOANBUbNoAKGNjNzZjNTAyYTc2MWRkYWVlMjE1YmNiZDhmZTQ3MjBlNDZkM2I5ZGQ", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-04-06T14:59:40Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-04-06T15:33:31Z"}, "message": "c++: -Wunused-value and array init [PR104702]\n\nHere, because of problems with the new warning-control code and expressions\nthat change location, the suppress_warning on the INDIRECT_REF didn't work.\nThose problems still need to be worked out, but it's simple to avoid needing\nto use suppress_warning in the first place by using a reference instead.\n\n\tPR c++/104702\n\ngcc/cp/ChangeLog:\n\n\t* init.cc (build_vec_init): Use a reference for the result.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/warn/Wunused-19.C: New test.", "tree": {"sha": "fe7c31789c257c90b6bb7905a9694ff495d19115", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fe7c31789c257c90b6bb7905a9694ff495d19115"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cc76c502a761ddaee215bcbd8fe4720e46d3b9dd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc76c502a761ddaee215bcbd8fe4720e46d3b9dd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cc76c502a761ddaee215bcbd8fe4720e46d3b9dd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc76c502a761ddaee215bcbd8fe4720e46d3b9dd/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "eac5c12c1838d51bf05bd6f30f3f5d7bb760e398", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eac5c12c1838d51bf05bd6f30f3f5d7bb760e398", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eac5c12c1838d51bf05bd6f30f3f5d7bb760e398"}], "stats": {"total": 21, "additions": 18, "deletions": 3}, "files": [{"sha": "c20ed211f1d49bf3a42e347f77202c05091f65c5", "filename": "gcc/cp/init.cc", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc76c502a761ddaee215bcbd8fe4720e46d3b9dd/gcc%2Fcp%2Finit.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc76c502a761ddaee215bcbd8fe4720e46d3b9dd/gcc%2Fcp%2Finit.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Finit.cc?ref=cc76c502a761ddaee215bcbd8fe4720e46d3b9dd", "patch": "@@ -4908,10 +4908,9 @@ build_vec_init (tree base, tree maxindex, tree init,\n   /* Now make the result have the correct type.  */\n   if (TREE_CODE (atype) == ARRAY_TYPE)\n     {\n-      atype = build_pointer_type (atype);\n+      atype = build_reference_type (atype);\n       stmt_expr = build1 (NOP_EXPR, atype, stmt_expr);\n-      stmt_expr = cp_build_fold_indirect_ref (stmt_expr);\n-      suppress_warning (stmt_expr /* What warning? */);\n+      stmt_expr = convert_from_reference (stmt_expr);\n     }\n \n   return stmt_expr;"}, {"sha": "2fc70b04c18bd103f72cfd4e43f0b4cd2d0cbb01", "filename": "gcc/testsuite/g++.dg/warn/Wunused-19.C", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc76c502a761ddaee215bcbd8fe4720e46d3b9dd/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWunused-19.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc76c502a761ddaee215bcbd8fe4720e46d3b9dd/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWunused-19.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWunused-19.C?ref=cc76c502a761ddaee215bcbd8fe4720e46d3b9dd", "patch": "@@ -0,0 +1,16 @@\n+// PR c++/104702\n+// { dg-additional-options \"-fno-exceptions -Wunused-value\" }\n+\n+struct FlyString {\n+  FlyString(char const*);\n+  ~FlyString();\n+};\n+\n+struct Array { FlyString __data[1]; };\n+\n+void frobnicate(Array&);\n+\n+int main() {\n+    Array s_reserved_words = { \"\" }; // { dg-bogus \"value computed is not used\" }\n+    frobnicate(s_reserved_words);\n+}"}]}