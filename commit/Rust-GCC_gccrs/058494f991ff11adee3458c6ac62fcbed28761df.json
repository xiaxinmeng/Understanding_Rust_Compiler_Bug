{"sha": "058494f991ff11adee3458c6ac62fcbed28761df", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDU4NDk0Zjk5MWZmMTFhZGVlMzQ1OGM2YWM2MmZjYmVkMjg3NjFkZg==", "commit": {"author": {"name": "Maxim Ostapenko", "email": "m.ostapenko@samsung.com", "date": "2018-03-19T19:59:56Z"}, "committer": {"name": "Maxim Ostapenko", "email": "chefmax@gcc.gnu.org", "date": "2018-03-19T19:59:56Z"}, "message": "re PR sanitizer/78651 (Incorrect exception handling when catch clause uses local class and PIC and sanitizer are active)\n\n2018-03-19  Maxim Ostapenko  <m.ostapenko@samsung.com>\n\ngcc/\n\n\tPR sanitizer/78651\n\t* dwarf2asm.c (dw2_output_indirect_constant_1): Disable ASan before\n\tcalling assemble_variable.\n\ngcc/testsuite/\n\n\tPR sanitizer/78651\n\t* g++.dg/asan/pr78651.C: New test.\n\nFrom-SVN: r258658", "tree": {"sha": "4bf60eb65a2d5f824ce45e226928b42888e5bbc3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4bf60eb65a2d5f824ce45e226928b42888e5bbc3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/058494f991ff11adee3458c6ac62fcbed28761df", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/058494f991ff11adee3458c6ac62fcbed28761df", "html_url": "https://github.com/Rust-GCC/gccrs/commit/058494f991ff11adee3458c6ac62fcbed28761df", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/058494f991ff11adee3458c6ac62fcbed28761df/comments", "author": null, "committer": null, "parents": [{"sha": "df1f46241d8f1869b492023c9f4e1389a12675c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df1f46241d8f1869b492023c9f4e1389a12675c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/df1f46241d8f1869b492023c9f4e1389a12675c4"}], "stats": {"total": 43, "additions": 43, "deletions": 0}, "files": [{"sha": "7745ef615481de93a7f46163d9ac571f21bf0ed2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/058494f991ff11adee3458c6ac62fcbed28761df/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/058494f991ff11adee3458c6ac62fcbed28761df/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=058494f991ff11adee3458c6ac62fcbed28761df", "patch": "@@ -1,3 +1,9 @@\n+2018-03-19  Maxim Ostapenko  <m.ostapenko@samsung.com>\n+\n+\tPR sanitizer/78651\n+\t* dwarf2asm.c (dw2_output_indirect_constant_1): Disable ASan before\n+\tcalling assemble_variable.\n+\n 2018-03-19  Sudakshina Das  <sudi.das@arm.com>\n \n \tPR target/81647"}, {"sha": "2e108acc0d78ef4a6b33d1ead837f4ccd48671dc", "filename": "gcc/dwarf2asm.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/058494f991ff11adee3458c6ac62fcbed28761df/gcc%2Fdwarf2asm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/058494f991ff11adee3458c6ac62fcbed28761df/gcc%2Fdwarf2asm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2asm.c?ref=058494f991ff11adee3458c6ac62fcbed28761df", "patch": "@@ -967,7 +967,13 @@ dw2_output_indirect_constant_1 (const char *sym, tree id)\n     }\n \n   sym_ref = gen_rtx_SYMBOL_REF (Pmode, sym);\n+  /* Disable ASan for decl because redzones cause ABI breakage between GCC and\n+     libstdc++ for `.LDFCM*' variables.  See PR 78651 for details.  */\n+  unsigned int save_flag_sanitize = flag_sanitize;\n+  flag_sanitize &= ~(SANITIZE_ADDRESS | SANITIZE_USER_ADDRESS\n+\t\t     | SANITIZE_KERNEL_ADDRESS);\n   assemble_variable (decl, 1, 1, 1);\n+  flag_sanitize = save_flag_sanitize;\n   assemble_integer (sym_ref, POINTER_SIZE_UNITS, POINTER_SIZE, 1);\n \n   return 0;"}, {"sha": "e3309b33d1b5367be4b0d42cd51d6b8787b17ea6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/058494f991ff11adee3458c6ac62fcbed28761df/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/058494f991ff11adee3458c6ac62fcbed28761df/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=058494f991ff11adee3458c6ac62fcbed28761df", "patch": "@@ -1,3 +1,8 @@\n+2018-03-19  Maxim Ostapenko  <m.ostapenko@samsung.com>\n+\n+\tPR sanitizer/78651\n+\t* g++.dg/asan/pr78651.C: New test.\n+\n 2018-03-19  Tom de Vries  <tom@codesourcery.com>\n \n \t* gcc.dg/tree-ssa/pr84512.c: Don't require effective target"}, {"sha": "09f1be538c3754040f89b18d20776956931a8e7a", "filename": "gcc/testsuite/g++.dg/asan/pr78651.C", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/058494f991ff11adee3458c6ac62fcbed28761df/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fasan%2Fpr78651.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/058494f991ff11adee3458c6ac62fcbed28761df/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fasan%2Fpr78651.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fasan%2Fpr78651.C?ref=058494f991ff11adee3458c6ac62fcbed28761df", "patch": "@@ -0,0 +1,26 @@\n+// PR sanitizer/78651\n+// { dg-do run }\n+// { dg-additional-options \"-fpic\" { target fpic } }\n+\n+struct A { };\n+\n+namespace {\n+\n+void thisThrows () {\n+  throw A();\n+}\n+\n+struct SomeRandomType {};\n+}\n+\n+int main() {\n+  try {\n+    thisThrows();\n+  }\n+  catch (SomeRandomType) {\n+    throw;\n+  }\n+  catch (A) {\n+  }\n+  return 0;\n+}"}]}