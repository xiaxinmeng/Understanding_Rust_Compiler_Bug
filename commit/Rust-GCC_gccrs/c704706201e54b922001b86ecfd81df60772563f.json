{"sha": "c704706201e54b922001b86ecfd81df60772563f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzcwNDcwNjIwMWU1NGI5MjIwMDFiODZlY2ZkODFkZjYwNzcyNTYzZg==", "commit": {"author": {"name": "Andreas Krebbel", "email": "krebbel@linux.vnet.ibm.com", "date": "2018-02-09T11:42:34Z"}, "committer": {"name": "Andreas Krebbel", "email": "krebbel@gcc.gnu.org", "date": "2018-02-09T11:42:34Z"}, "message": "S/390: Fix PR84295\n\ngcc/ChangeLog:\n\n2018-02-09  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n\n\tPR target/PR84295\n\t* config/s390/s390.c (s390_set_current_function): Invoke\n\ts390_indirect_branch_settings also if fndecl didn't change.\n\ngcc/testsuite/ChangeLog:\n\n2018-02-09  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n\n\tPR target/PR84295\n\t* gcc.target/s390/pr84295.c: New test.\n\nFrom-SVN: r257522", "tree": {"sha": "6d08d7278be77a7692b7ea3ef83092285ecfc894", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6d08d7278be77a7692b7ea3ef83092285ecfc894"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c704706201e54b922001b86ecfd81df60772563f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c704706201e54b922001b86ecfd81df60772563f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c704706201e54b922001b86ecfd81df60772563f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c704706201e54b922001b86ecfd81df60772563f/comments", "author": null, "committer": null, "parents": [{"sha": "0805a34d5f2a42052452ccc3ea45fde7975ff417", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0805a34d5f2a42052452ccc3ea45fde7975ff417", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0805a34d5f2a42052452ccc3ea45fde7975ff417"}], "stats": {"total": 30, "additions": 29, "deletions": 1}, "files": [{"sha": "7a01d21026e27516a323402d783b7cae6e868f57", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c704706201e54b922001b86ecfd81df60772563f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c704706201e54b922001b86ecfd81df60772563f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c704706201e54b922001b86ecfd81df60772563f", "patch": "@@ -1,3 +1,9 @@\n+2018-02-09  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n+\n+\tPR target/PR84295\n+\t* config/s390/s390.c (s390_set_current_function): Invoke\n+\ts390_indirect_branch_settings also if fndecl didn't change.\n+\n 2018-02-09  Alexandre Oliva <aoliva@redhat.com>\n \n \t* config/rs6000/rs6000.md (blockage): Set length to zero."}, {"sha": "298fdd164904102406ffb52c0ca3757627eada8f", "filename": "gcc/config/s390/s390.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c704706201e54b922001b86ecfd81df60772563f/gcc%2Fconfig%2Fs390%2Fs390.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c704706201e54b922001b86ecfd81df60772563f/gcc%2Fconfig%2Fs390%2Fs390.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.c?ref=c704706201e54b922001b86ecfd81df60772563f", "patch": "@@ -16135,7 +16135,10 @@ s390_set_current_function (tree fndecl)\n      several times in the course of compiling a function, and we don't want to\n      slow things down too much or call target_reinit when it isn't safe.  */\n   if (fndecl == s390_previous_fndecl)\n-    return;\n+    {\n+      s390_indirect_branch_settings (fndecl);\n+      return;\n+    }\n \n   tree old_tree;\n   if (s390_previous_fndecl == NULL_TREE)"}, {"sha": "25c8afca21c7fe1b4ac7ae6d53c7bc1f0d4ac06a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c704706201e54b922001b86ecfd81df60772563f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c704706201e54b922001b86ecfd81df60772563f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c704706201e54b922001b86ecfd81df60772563f", "patch": "@@ -1,3 +1,8 @@\n+2018-02-09  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n+\n+\tPR target/PR84295\n+\t* gcc.target/s390/pr84295.c: New test.\n+\n 2018-02-09  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/77522"}, {"sha": "4da43c3cded3bbfaeaab91257233231bc97b54f3", "filename": "gcc/testsuite/gcc.target/s390/pr84295.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c704706201e54b922001b86ecfd81df60772563f/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fpr84295.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c704706201e54b922001b86ecfd81df60772563f/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fpr84295.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fpr84295.c?ref=c704706201e54b922001b86ecfd81df60772563f", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -march=z900 -fgnu89-inline --save-temps -mfunction-return-reg=thunk -mindirect-branch-table\" } */\n+\n+extern void foo (void);\n+extern __inline  void foo (void) {}\n+void foo (void) {}\n+\n+/* { dg-final { scan-assembler-times \"jg\\t__s390_indirect_jump\" 1 } } */\n+/* { dg-final { scan-assembler \"ex\\t\" } } */\n+\n+/* { dg-final { scan-assembler-not \"section\\t.s390_indirect_jump\" } } */\n+/* { dg-final { scan-assembler-not \"section\\t.s390_indirect_call\" } } */\n+/* { dg-final { scan-assembler     \"section\\t.s390_return_reg\" } } */\n+/* { dg-final { scan-assembler-not \"section\\t.s390_return_mem\" } } */"}]}