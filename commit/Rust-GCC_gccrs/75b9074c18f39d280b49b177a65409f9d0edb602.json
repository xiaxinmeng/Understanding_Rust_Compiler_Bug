{"sha": "75b9074c18f39d280b49b177a65409f9d0edb602", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzViOTA3NGMxOGYzOWQyODBiNDliMTc3YTY1NDA5ZjlkMGVkYjYwMg==", "commit": {"author": {"name": "Alexandre Oliva", "email": "aoliva@redhat.com", "date": "2001-04-12T12:28:03Z"}, "committer": {"name": "Alexandre Oliva", "email": "aoliva@gcc.gnu.org", "date": "2001-04-12T12:28:03Z"}, "message": "ltconfig, [...]: Upgraded to libtool 1.4a 1.641.2.226.\n\n* ltconfig, ltmain.sh, libtool.m4, ltcf-c.sh, ltcf-cxx.sh,\nltcf-gcj.sh: Upgraded to libtool 1.4a 1.641.2.226.\n\nFrom-SVN: r41299", "tree": {"sha": "c3b5c823f6ca384bbc3ed595eb3c55af28bf22fc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c3b5c823f6ca384bbc3ed595eb3c55af28bf22fc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/75b9074c18f39d280b49b177a65409f9d0edb602", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/75b9074c18f39d280b49b177a65409f9d0edb602", "html_url": "https://github.com/Rust-GCC/gccrs/commit/75b9074c18f39d280b49b177a65409f9d0edb602", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/75b9074c18f39d280b49b177a65409f9d0edb602/comments", "author": null, "committer": null, "parents": [{"sha": "52c2897732e366fd1d63140b4f10cce41c5f0e0c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52c2897732e366fd1d63140b4f10cce41c5f0e0c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/52c2897732e366fd1d63140b4f10cce41c5f0e0c"}], "stats": {"total": 478, "additions": 334, "deletions": 144}, "files": [{"sha": "59a85b724d7aec8e30b3bf4c5070f92553a6c2fe", "filename": "ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75b9074c18f39d280b49b177a65409f9d0edb602/ChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75b9074c18f39d280b49b177a65409f9d0edb602/ChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ChangeLog?ref=75b9074c18f39d280b49b177a65409f9d0edb602", "patch": "@@ -1,3 +1,8 @@\n+2001-04-12  Alexandre Oliva  <aoliva@redhat.com>\n+\n+\t* ltconfig, ltmain.sh, libtool.m4, ltcf-c.sh, ltcf-cxx.sh,\n+\tltcf-gcj.sh: Upgraded to libtool 1.4a 1.641.2.226.\n+\n 2001-04-11  Stan Shebs  <shebs@apple.com>\n \n \t* MAINTAINERS: Add self as Darwin port maintainer."}, {"sha": "d4422290336f104249fdba68239ffaa840d5842c", "filename": "libtool.m4", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75b9074c18f39d280b49b177a65409f9d0edb602/libtool.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75b9074c18f39d280b49b177a65409f9d0edb602/libtool.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libtool.m4?ref=75b9074c18f39d280b49b177a65409f9d0edb602", "patch": "@@ -536,8 +536,15 @@ cygwin* | mingw* |pw32*)\n \n darwin* | rhapsody*)\n   lt_cv_deplibs_check_method='file_magic Mach-O dynamically linked shared library'\n-  lt_cv_file_magic_cmd=/usr/bin/file\n-  lt_cv_file_magic_test_file=`echo /System/Library/Frameworks/System.framework/Versions/*/System | head -1`\n+  lt_cv_file_magic_cmd='/usr/bin/file -L'\n+  case \"$host_os\" in\n+  rhapsody* | darwin1.[012])\n+    lt_cv_file_magic_test_file='/System/Library/Frameworks/System.framework/System'\n+    ;;\n+  *) # Darwin 1.3 on\n+    lt_cv_file_magic_test_file='/usr/lib/libSystem.dylib'\n+    ;;\n+  esac\n   ;;\n \n freebsd* )\n@@ -601,12 +608,10 @@ linux-gnu*)\n \n netbsd*)\n   if echo __ELF__ | $CC -E - | grep __ELF__ > /dev/null; then\n-    [lt_cv_deplibs_check_method='file_magic NetBSD/[a-z0-9]* demand paged shared library']\n+    [lt_cv_deplibs_check_method='match_pattern /lib[^/\\.]+\\.so\\.[0-9]+\\.[0-9]+$']\n   else\n-    [lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB shared object']\n+    [lt_cv_deplibs_check_method='match_pattern /lib[^/\\.]+\\.so$']\n   fi\n-  lt_cv_file_magic_cmd='/usr/bin/file -L'\n-  lt_cv_file_magic_test_file=`echo /usr/lib/libc.so*`\n   ;;\n \n newsos6)"}, {"sha": "17b65111c9277c98c62d1903b912f33ae3d3f24c", "filename": "ltcf-c.sh", "status": "modified", "additions": 33, "deletions": 27, "changes": 60, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75b9074c18f39d280b49b177a65409f9d0edb602/ltcf-c.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75b9074c18f39d280b49b177a65409f9d0edb602/ltcf-c.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ltcf-c.sh?ref=75b9074c18f39d280b49b177a65409f9d0edb602", "patch": "@@ -108,7 +108,7 @@ EOF\n       test -f $output_objdir/impgen.exe || (cd $output_objdir && \\\n       if test \"x$HOST_CC\" != \"x\" ; then $HOST_CC -o impgen impgen.c ; \\\n       else $CC -o impgen impgen.c ; fi)~\n-      $output_objdir/impgen $dir/$soname > $output_objdir/$soname-def'\n+      $output_objdir/impgen $dir/$soroot > $output_objdir/$soname-def'\n \n     old_archive_from_expsyms_cmds='$DLLTOOL --as=$AS --dllname $soname --def $output_objdir/$soname-def --output-lib $output_objdir/$newlib'\n \n@@ -166,23 +166,21 @@ EOF\n         done;\n       fi~\n       '\"$ltdll_cmds\"'\n-      $CC -Wl,--base-file,$output_objdir/$soname-base '$lt_cv_cc_dll_switch' -Wl,-e,'$dll_entry' -o $lib '$ltdll_obj'$libobjs $deplibs $compiler_flags~\n+      $CC -Wl,--base-file,$output_objdir/$soname-base '$lt_cv_cc_dll_switch' -Wl,-e,'$dll_entry' -o $output_objdir/$soname '$ltdll_obj'$libobjs $deplibs $compiler_flags~\n       $DLLTOOL --as=$AS --dllname $soname --exclude-symbols '$dll_exclude_symbols' --def $output_objdir/$soname-def --base-file $output_objdir/$soname-base --output-exp $output_objdir/$soname-exp~\n-      $CC -Wl,--base-file,$output_objdir/$soname-base $output_objdir/$soname-exp '$lt_cv_cc_dll_switch' -Wl,-e,'$dll_entry' -o $lib '$ltdll_obj'$libobjs $deplibs $compiler_flags~\n-      $DLLTOOL --as=$AS --dllname $soname --exclude-symbols '$dll_exclude_symbols' --def $output_objdir/$soname-def --base-file $output_objdir/$soname-base --output-exp $output_objdir/$soname-exp~\n-      $CC $output_objdir/$soname-exp '$lt_cv_cc_dll_switch' -Wl,-e,'$dll_entry' -o $lib '$ltdll_obj'$libobjs $deplibs $compiler_flags'\n+      $CC -Wl,--base-file,$output_objdir/$soname-base $output_objdir/$soname-exp '$lt_cv_cc_dll_switch' -Wl,-e,'$dll_entry' -o $output_objdir/$soname '$ltdll_obj'$libobjs $deplibs $compiler_flags~\n+      $DLLTOOL --as=$AS --dllname $soname --exclude-symbols '$dll_exclude_symbols' --def $output_objdir/$soname-def --base-file $output_objdir/$soname-base --output-exp $output_objdir/$soname-exp --output-lib $output_objdir/$libname.dll.a~\n+      $CC $output_objdir/$soname-exp '$lt_cv_cc_dll_switch' -Wl,-e,'$dll_entry' -o $output_objdir/$soname '$ltdll_obj'$libobjs $deplibs $compiler_flags'\n     ;;\n \n-  darwin*|rhapsody*)\n-    allow_undefined_flag='-undefined warning'\n-    archive_cmds='$CC $(if test \"$module\" = \"yes\"; then echo -bundle; else\n-      echo -dynamiclib; fi) -o $lib $libobjs $deplibs $linkopts'\n-    archive_expsym_cmds=\"$archive_cmds\"' && strip -s $export_symbols'\n-    ## What we need is to hardcode the path to the library, not the search path\n-    #hardcode_direct=yes\n-    #hardcode_libdir_flag_spec='-install_name $libdir/$lib'\n+  darwin* | rhapsody*)\n+    allow_undefined_flag='-undefined suppress'\n+    archive_cmds='$CC `test .$module = .yes && echo -bundle || echo -dynamiclib` $allow_undefined_flag -o $lib $libobjs $deplibs $linkopts -install_name $rpath/$soname `test -n \"$verstring\" -a x$verstring != x0.0 && echo $verstring`'\n+    # We need to add '_' to the symbols in $export_symbols first\n+    #archive_expsym_cmds=\"$archive_cmds\"' && strip -s $export_symbols'\n+    hardcode_direct=yes\n     hardcode_shlibpath_var=no\n-    whole_archive_flag_spec='-all_load'\n+    whole_archive_flag_spec='-all_load $convenience'\n     ;;\n \n   netbsd*)\n@@ -486,13 +484,16 @@ else\n     if test \"$with_gcc\" = yes; then\n       allow_undefined_flag=' ${wl}-expect_unresolved ${wl}\\*'\n       archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n \"$verstring\" && echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${objdir}/so_locations -o $lib'\n+      hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'\n     else\n       allow_undefined_flag=' -expect_unresolved \\*'\n       archive_cmds='$LD -shared${allow_undefined_flag} $libobjs $deplibs $linker_flags -msym -soname $soname `test -n \"$verstring\" && echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib'\n       archive_expsym_cmds='for i in `cat $export_symbols`; do printf \"-exported_symbol \" >> $lib.exp; echo \"\\$i\" >> $lib.exp; done; echo \"-hidden\">> $lib.exp~\n       $LD -shared${allow_undefined_flag} -input $lib.exp $linker_flags $libobjs $deplibs -soname $soname `test -n \"$verstring\" && echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib~$rm $lib.exp'\n+\n+      # cc supports -rpath directly\n+      hardcode_libdir_flag_spec='-rpath $libdir'\n     fi\n-    hardcode_libdir_flag_spec='-rpath $libdir'\n     hardcode_libdir_separator=:\n     ;;\n \n@@ -504,7 +505,7 @@ else\n     ;;\n \n   solaris*)\n-    no_undefined_flag=' -z text'\n+    no_undefined_flag=' -z defs'\n     # $CC -shared without GNU ld will not create a library from C++\n     # object files and a static libstdc++, better avoid it by now\n     archive_cmds='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'\n@@ -612,9 +613,6 @@ else\n     ac_cv_prog_cc_static='-static'\n \n     case $host_os in\n-    beos* | irix5* | irix6* | osf3* | osf4* | osf5*)\n-      # PIC is the default for these OSes.\n-      ;;\n     aix*)\n       # All AIX code is PIC.\n       if test \"$host_cpu\" = ia64; then\n@@ -624,20 +622,28 @@ else\n         lt_cv_prog_cc_static='-bnso -bI:/lib/syscalls.exp'\n       fi\n       ;;\n-    *djgpp*)\n-      # DJGPP does not support shared libraries at all\n-      ac_cv_prog_cc_pic=\n+    amigaos*)\n+      # FIXME: we need at least 68020 code to build shared libraries, but\n+      # adding the `-m68020' flag to GCC prevents building anything better,\n+      # like `-m68040'.\n+      ac_cv_prog_cc_pic='-m68020 -resident32 -malways-restore-a4'\n+      ;;\n+    beos* | irix5* | irix6* | osf3* | osf4* | osf5*)\n+      # PIC is the default for these OSes.\n       ;;\n     cygwin* | mingw* | os2*)\n       # This hack is so that the source file can tell whether it is being\n       # built for inclusion in a dll (and should export symbols for example).\n       ac_cv_prog_cc_pic='-DDLL_EXPORT'\n       ;;\n-    amigaos*)\n-      # FIXME: we need at least 68020 code to build shared libraries, but\n-      # adding the `-m68020' flag to GCC prevents building anything better,\n-      # like `-m68040'.\n-      ac_cv_prog_cc_pic='-m68020 -resident32 -malways-restore-a4'\n+    darwin* | rhapsody*)\n+      # PIC is the default on this platform\n+      # Common symbols not allowed in MH_DYLIB files\n+      lt_cv_prog_cc_pic='-fno-common'\n+      ;;\n+    *djgpp*)\n+      # DJGPP does not support shared libraries at all\n+      ac_cv_prog_cc_pic=\n       ;;\n     sysv4*MP*)\n       if test -d /usr/nec; then"}, {"sha": "aefc206f9e86868a68290eeea8fafd9a703141d1", "filename": "ltcf-cxx.sh", "status": "modified", "additions": 22, "deletions": 12, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75b9074c18f39d280b49b177a65409f9d0edb602/ltcf-cxx.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75b9074c18f39d280b49b177a65409f9d0edb602/ltcf-cxx.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ltcf-cxx.sh?ref=75b9074c18f39d280b49b177a65409f9d0edb602", "patch": "@@ -478,6 +478,10 @@ case $host_os in\n       cxx)\n         allow_undefined_flag=' -expect_unresolved \\*'\n         archive_cmds='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname `test -n \"$verstring\" && echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib'\n+\tarchive_expsym_cmds='for i in `cat $export_symbols`; do printf \"-exported_symbol \" >> $lib.exp; echo \"\\$i\" >> $lib.exp; done~\n+\t  echo \"-hidden\">> $lib.exp~\n+\t  $CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname -Wl,-input -Wl,$lib.exp  `test -n \"$verstring\" && echo -set_version\t$verstring` -update_registry $objdir/so_locations -o $lib~\n+\t  $rm $lib.exp'\n \n         hardcode_libdir_flag_spec='-rpath $libdir'\n         hardcode_libdir_separator=:\n@@ -536,7 +540,7 @@ case $host_os in\n     case $cc_basename in\n       CC)\n \t# Sun C++ 4.2, 5.x and Centerline C++\n-        no_undefined_flag=' -ztext'\n+        no_undefined_flag=' -zdefs'\n         archive_cmds='$CC -G${allow_undefined_flag} -nolib -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'\n         archive_expsym_cmds='$echo \"{ global:\" > $lib.exp~cat $export_symbols | sed -e \"s/\\(.*\\)/\\1;/\" >> $lib.exp~$echo \"local: *; };\" >> $lib.exp~\n         $CC -G${allow_undefined_flag} -nolib ${wl}-M ${wl}$lib.exp -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$rm $lib.exp'\n@@ -581,6 +585,7 @@ case $host_os in\n       *)\n         # GNU C++ compiler with Solaris linker\n         if test \"$with_gcc\" = yes && test \"$with_gnu_ld\" = no; then\n+\t  no_undefined_flag=' ${wl}-z ${wl}defs'\n           if $CC --version | egrep -v '^2\\.7' > /dev/null; then\n             archive_cmds='$CC -shared -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $linker_flags ${wl}-h $wl$soname -o $lib'\n             archive_expsym_cmds='$echo \"{ global:\" > $lib.exp~cat $export_symbols | sed -e \"s/\\(.*\\)/\\1;/\" >> $lib.exp~$echo \"local: *; };\" >> $lib.exp~\n@@ -655,9 +660,6 @@ if test \"$with_gcc\" = yes; then\n   ac_cv_prog_cc_static='-static'\n \n   case $host_os in\n-  beos* | irix5* | irix6* | osf3* | osf4* | osf5*)\n-    # PIC is the default for these OSes.\n-    ;;\n   aix*)\n     # All AIX code is PIC.\n     if test \"$host_cpu\" = ia64; then\n@@ -667,20 +669,28 @@ if test \"$with_gcc\" = yes; then\n       lt_cv_prog_cc_static='-bnso -bI:/lib/syscalls.exp'\n     fi\n     ;;\n-  *djgpp*)\n-    # DJGPP does not support shared libraries at all\n-    ac_cv_prog_cc_pic=\n+  amigaos*)\n+    # FIXME: we need at least 68020 code to build shared libraries, but\n+    # adding the `-m68020' flag to GCC prevents building anything better,\n+    # like `-m68040'.\n+    ac_cv_prog_cc_pic='-m68020 -resident32 -malways-restore-a4'\n+    ;;\n+  beos* | irix5* | irix6* | osf3* | osf4* | osf5*)\n+    # PIC is the default for these OSes.\n     ;;\n   cygwin* | mingw* | os2*)\n     # This hack is so that the source file can tell whether it is being\n     # built for inclusion in a dll (and should export symbols for example).\n     ac_cv_prog_cc_pic='-DDLL_EXPORT'\n     ;;\n-  amigaos*)\n-    # FIXME: we need at least 68020 code to build shared libraries, but\n-    # adding the `-m68020' flag to GCC prevents building anything better,\n-    # like `-m68040'.\n-    ac_cv_prog_cc_pic='-m68020 -resident32 -malways-restore-a4'\n+  darwin* | rhapsody*)\n+    # PIC is the default on this platform\n+    # Common symbols not allowed in MH_DYLIB files\n+    lt_cv_prog_cc_pic='-fno-common'\n+    ;;\n+  *djgpp*)\n+    # DJGPP does not support shared libraries at all\n+    ac_cv_prog_cc_pic=\n     ;;\n   sysv4*MP*)\n     if test -d /usr/nec; then"}, {"sha": "2fa090c1434994b47a412fcf3196d08b68c76b6f", "filename": "ltcf-gcj.sh", "status": "modified", "additions": 16, "deletions": 12, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75b9074c18f39d280b49b177a65409f9d0edb602/ltcf-gcj.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75b9074c18f39d280b49b177a65409f9d0edb602/ltcf-gcj.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ltcf-gcj.sh?ref=75b9074c18f39d280b49b177a65409f9d0edb602", "patch": "@@ -111,7 +111,7 @@ EOF\n       test -f $output_objdir/impgen.exe || (cd $output_objdir && \\\n       if test \"x$HOST_CC\" != \"x\" ; then $HOST_CC -o impgen impgen.c ; \\\n       else $CC -o impgen impgen.c ; fi)~\n-      $output_objdir/impgen $dir/$soname > $output_objdir/$soname-def'\n+      $output_objdir/impgen $dir/$soroot > $output_objdir/$soname-def'\n \n     old_archive_from_expsyms_cmds='$DLLTOOL --as=$AS --dllname $soname --def $output_objdir/$soname-def --output-lib $output_objdir/$newlib'\n \n@@ -169,11 +169,11 @@ EOF\n         done;\n       fi~\n       '\"$ltdll_cmds\"'\n-      $CC -Wl,--base-file,$output_objdir/$soname-base '$lt_cv_gcj_dll_switch' -Wl,-e,'$dll_entry' -o $lib '$ltdll_obj'$libobjs $deplibs $compiler_flags~\n+      $CC -Wl,--base-file,$output_objdir/$soname-base '$lt_cv_cc_dll_switch' -Wl,-e,'$dll_entry' -o $output_objdir/$soname '$ltdll_obj'$libobjs $deplibs $compiler_flags~\n       $DLLTOOL --as=$AS --dllname $soname --exclude-symbols '$dll_exclude_symbols' --def $output_objdir/$soname-def --base-file $output_objdir/$soname-base --output-exp $output_objdir/$soname-exp~\n-      $CC -Wl,--base-file,$output_objdir/$soname-base $output_objdir/$soname-exp '$lt_cv_gcj_dll_switch' -Wl,-e,'$dll_entry' -o $lib '$ltdll_obj'$libobjs $deplibs $compiler_flags~\n-      $DLLTOOL --as=$AS --dllname $soname --exclude-symbols '$dll_exclude_symbols' --def $output_objdir/$soname-def --base-file $output_objdir/$soname-base --output-exp $output_objdir/$soname-exp~\n-      $CC $output_objdir/$soname-exp '$lt_cv_gcj_dll_switch' -Wl,-e,'$dll_entry' -o $lib '$ltdll_obj'$libobjs $deplibs $compiler_flags'\n+      $CC -Wl,--base-file,$output_objdir/$soname-base $output_objdir/$soname-exp '$lt_cv_cc_dll_switch' -Wl,-e,'$dll_entry' -o $output_objdir/$soname '$ltdll_obj'$libobjs $deplibs $compiler_flags~\n+      $DLLTOOL --as=$AS --dllname $soname --exclude-symbols '$dll_exclude_symbols' --def $output_objdir/$soname-def --base-file $output_objdir/$soname-base --output-exp $output_objdir/$soname-exp --output-lib $output_objdir/$libname.dll.a~\n+      $CC $output_objdir/$soname-exp '$lt_cv_cc_dll_switch' -Wl,-e,'$dll_entry' -o $output_objdir/$soname '$ltdll_obj'$libobjs $deplibs $compiler_flags'\n     ;;\n \n   netbsd*)\n@@ -485,18 +485,22 @@ else\n     ;;\n \n   solaris*)\n-    no_undefined_flag=' -z text'\n-    # $CC -shared without GNU ld will not create a library from C++\n-    # object files and a static libstdc++, better avoid it by now\n-    archive_cmds='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'\n+    no_undefined_flag=' ${wl}-z ${wl}defs'\n+    archive_cmds='$CC -shared -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $linker_flags ${wl}-h $wl$soname -o $lib'\n     archive_expsym_cmds='$echo \"{ global:\" > $lib.exp~cat $export_symbols | sed -e \"s/\\(.*\\)/\\1;/\" >> $lib.exp~$echo \"local: *; };\" >> $lib.exp~\n-\t\t$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$rm $lib.exp'\n-    hardcode_libdir_flag_spec='-R$libdir'\n+      $CC -shared -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $linker_flags~$rm $lib.exp'\n+\n+    # Commands to make compiler produce verbose output that lists\n+    # what \"hidden\" libraries, object files and flags are used when\n+    # linking a shared library.\n+    output_verbose_link_cmds=\"$CC -shared $CFLAGS -v conftest.$objext 2>&1 | egrep \\\"\\-L\\\"\"\n+\n+    hardcode_libdir_flag_spec='${wl}-R $wl$libdir'\n     hardcode_shlibpath_var=no\n     case $host_os in\n     solaris2.[0-5] | solaris2.[0-5].*) ;;\n     *) # Supported since Solaris 2.6 (maybe 2.5.1?)\n-      whole_archive_flag_spec='-z allextract$convenience -z defaultextract' ;;\n+      whole_archive_flag_spec='${wl}-z ${wl}allextract$convenience ${wl}-z ${wl}defaultextract' ;;\n     esac\n     link_all_deplibs=yes\n     ;;"}, {"sha": "aad0a2b148a4cefdd578818160fe53ef06ccf06e", "filename": "ltconfig", "status": "modified", "additions": 46, "deletions": 37, "changes": 83, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75b9074c18f39d280b49b177a65409f9d0edb602/ltconfig", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75b9074c18f39d280b49b177a65409f9d0edb602/ltconfig", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ltconfig?ref=75b9074c18f39d280b49b177a65409f9d0edb602", "patch": "@@ -182,7 +182,7 @@ progname=`$echo \"X$0\" | $Xsed -e 's%^.*/%%'`\n PROGRAM=ltconfig\n PACKAGE=libtool\n VERSION=1.4a\n-TIMESTAMP=\" (1.641.2.198 2001/03/20 05:47:28)\"\n+TIMESTAMP=\" (1.641.2.226 2001/04/12 02:39:36)\"\n ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'\n ac_link='${CC-cc} -o conftest $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'\n rm=\"rm -f\"\n@@ -1068,7 +1068,14 @@ cygwin* | mingw* | pw32*)\n   need_lib_prefix=no\n   case $with_gcc,$host_os in\n   yes,cygwin*)\n-    library_names_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | sed -e 's/[.]/-/g'`${versuffix}.dll'\n+    library_names_spec='$libname.dll.a'\n+    soname_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | [sed -e 's/[.]/-/g']`${versuffix}.dll'\n+    postinstall_cmds='dlpath=`bash 2>&1 -c '\\''. $dir/${file}i; echo \\$dlname'\\''`~\n+      dldir=$destdir/`dirname \\$dlpath`~\n+      test -d \\$dldir || mkdir -p \\$dldir~\n+      $install_prog .libs/$dlname \\$dldir/$dlname'\n+    postuninstall_cmds='dldll=`bash 2>&1 -c '\\''. $file; echo \\$dlname'\\''`~\n+      dlpath=$dir/\\$dldll; $rm \\$dlpath'\n     ;;\n   yes,mingw*)\n     library_names_spec='${libname}`echo ${release} | sed -e 's/[.]/-/g'`${versuffix}.dll'\n@@ -1089,10 +1096,12 @@ cygwin* | mingw* | pw32*)\n   ;;\n \n darwin* | rhapsody*)\n-  library_names_spec='${libname}.`if test \"$module\" = \"yes\"; then echo so; else echo dylib; fi`'\n+  dynamic_linker=\"$host_os dyld\"\n+  version_type=darwin\n   need_lib_prefix=no\n   need_version=no\n-  postinstall_cmds='chmod +x $lib'\n+  library_names_spec='${libname}${release}${versuffix}.`test .$module = .yes && echo so || echo dylib` ${libname}${release}${major}.$`test .$module = .yes && echo so || echo dylib` ${libname}.`test .$module = .yes && echo so || echo dylib`'\n+  soname_spec='${libname}${release}${major}.`test .$module = .yes && echo so || echo dylib`'\n   shlibpath_overrides_runpath=yes\n   shlibpath_var=DYLD_LIBRARY_PATH\n   ;;\n@@ -1378,7 +1387,7 @@ sysv4)\n   ;;\n esac\n \n-# Handle CRLF in mingw too chain\n+# Handle CRLF in mingw tool chain\n opt_cr=\n case $host_os in\n mingw*)\n@@ -1412,11 +1421,11 @@ void nm_test_func(){}\n int main(){nm_test_var='a';nm_test_func();return(0);}\n EOF\n \n-  echo \"$progname:1414: checking if global_symbol_pipe works\" >&5\n-  if { (eval echo $progname:1415: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; } && test -s conftest.$objext; then\n+  echo \"$progname:1424: checking if global_symbol_pipe works\" >&5\n+  if { (eval echo $progname:1425: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; } && test -s conftest.$objext; then\n     # Now try to grab the symbols.\n     nlist=conftest.nm\n-    if { echo \"$progname:1418: eval \\\"$NM conftest.$objext | $global_symbol_pipe > $nlist\\\"\" >&5; eval \"$NM conftest.$objext | $global_symbol_pipe > $nlist 2>&5\"; } && test -s \"$nlist\"; then\n+    if { echo \"$progname:1428: eval \\\"$NM conftest.$objext | $global_symbol_pipe > $nlist\\\"\" >&5; eval \"$NM conftest.$objext | $global_symbol_pipe > $nlist 2>&5\"; } && test -s \"$nlist\"; then\n \n       # Try sorting and uniquifying the output.\n       if sort \"$nlist\" | uniq > \"$nlist\"T; then\n@@ -1468,7 +1477,7 @@ EOF\n \t  save_CFLAGS=\"$CFLAGS\"\n \t  LIBS=\"conftstm.$objext\"\n \t  CFLAGS=\"$CFLAGS$no_builtin_flag\"\n-\t  if { (eval echo $progname:1470: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+\t  if { (eval echo $progname:1480: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n \t    pipe_works=yes\n \t  else\n \t    echo \"$progname: failed program was:\" >&5\n@@ -1572,14 +1581,14 @@ else\n if test \"X${lt_cv_dlopen+set}\" != Xset; then\n   lt_cv_dlopen=no lt_cv_dlopen_libs=\n echo $ac_n \"checking for dlopen in -ldl\"\"... $ac_c\" 1>&6\n-echo \"$progname:1574: checking for dlopen in -ldl\" >&5\n+echo \"$progname:1584: checking for dlopen in -ldl\" >&5\n if test \"X${ac_cv_lib_dl_dlopen+set}\" = Xset; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-ldl  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 1581 \"ltconfig\"\n+#line 1591 \"ltconfig\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n     builtin and then its argument prototype would still apply.  */\n@@ -1592,7 +1601,7 @@ int main() {\n dlopen()\n ; return 0; }\n EOF\n-if { (eval echo $progname:1594: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo $progname:1604: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_lib_dl_dlopen=yes\n else\n@@ -1611,12 +1620,12 @@ if test \"X$ac_cv_lib_dl_dlopen\" = Xyes; then\n else\n   echo \"$ac_t\"\"no\" 1>&6\n echo $ac_n \"checking for dlopen\"\"... $ac_c\" 1>&6\n-echo \"$progname:1613: checking for dlopen\" >&5\n+echo \"$progname:1623: checking for dlopen\" >&5\n if test \"X${ac_cv_func_dlopen+set}\" = Xset; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1618 \"ltconfig\"\n+#line 1628 \"ltconfig\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char dlopen(); below.  */\n #include <assert.h>\n@@ -1641,7 +1650,7 @@ dlopen();\n \n ; return 0; }\n EOF\n-if { (eval echo $progname:1643: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo $progname:1653: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_func_dlopen=yes\n else\n@@ -1658,14 +1667,14 @@ if test \"X$ac_cv_func_dlopen\" = Xyes; then\n else\n   echo \"$ac_t\"\"no\" 1>&6\n echo $ac_n \"checking for dlopen in -lsvld\"\"... $ac_c\" 1>&6\n-echo \"$progname:1660: checking for dlopen in -lsvld\" >&5\n+echo \"$progname:1670: checking for dlopen in -lsvld\" >&5\n if test \"X${ac_cv_lib_svld_dlopen+set}\" = Xset; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lsvld  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 1667 \"ltconfig\"\n+#line 1677 \"ltconfig\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n     builtin and then its argument prototype would still apply.  */\n@@ -1678,7 +1687,7 @@ int main() {\n dlopen()\n ; return 0; }\n EOF\n-if { (eval echo $progname:1680: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo $progname:1690: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_lib_svld_dlopen=yes\n else\n@@ -1697,14 +1706,14 @@ if test \"X$ac_cv_lib_svld_dlopen\" = Xyes; then\n else\n   echo \"$ac_t\"\"no\" 1>&6\n echo $ac_n \"checking for dld_link in -ldld\"\"... $ac_c\" 1>&6\n-echo \"$progname:1699: checking for dld_link in -ldld\" >&5\n+echo \"$progname:1709: checking for dld_link in -ldld\" >&5\n if test \"X${ac_cv_lib_dld_dld_link+set}\" = Xset; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-ldld  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 1706 \"ltconfig\"\n+#line 1716 \"ltconfig\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n     builtin and then its argument prototype would still apply.  */\n@@ -1717,7 +1726,7 @@ int main() {\n dld_link()\n ; return 0; }\n EOF\n-if { (eval echo $progname:1719: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo $progname:1729: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_lib_dld_dld_link=yes\n else\n@@ -1736,12 +1745,12 @@ if test \"X$ac_cv_lib_dld_dld_link\" = Xyes; then\n else\n   echo \"$ac_t\"\"no\" 1>&6\n echo $ac_n \"checking for shl_load\"\"... $ac_c\" 1>&6\n-echo \"$progname:1738: checking for shl_load\" >&5\n+echo \"$progname:1748: checking for shl_load\" >&5\n if test \"X${ac_cv_func_shl_load+set}\" = Xset; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1743 \"ltconfig\"\n+#line 1753 \"ltconfig\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char shl_load(); below.  */\n #include <assert.h>\n@@ -1766,7 +1775,7 @@ shl_load();\n \n ; return 0; }\n EOF\n-if { (eval echo $progname:1768: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo $progname:1778: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_func_shl_load=yes\n else\n@@ -1784,14 +1793,14 @@ if test \"X$ac_cv_func_shl_load\" = Xyes; then\n else\n   echo \"$ac_t\"\"no\" 1>&6\n echo $ac_n \"checking for shl_load in -ldld\"\"... $ac_c\" 1>&6\n-echo \"$progname:1786: checking for shl_load in -ldld\" >&5\n+echo \"$progname:1796: checking for shl_load in -ldld\" >&5\n if test \"X${ac_cv_lib_dld_shl_load+set}\" = Xset; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-ldld  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 1793 \"ltconfig\"\n+#line 1803 \"ltconfig\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -1805,7 +1814,7 @@ int main() {\n shl_load()\n ; return 0; }\n EOF\n-if { (eval echo $progname:1807: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo $progname:1817: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_lib_dld_shl_load=yes\n else\n@@ -1852,18 +1861,18 @@ fi\n for ac_hdr in dlfcn.h; do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"$progname:1854: checking for $ac_hdr\" >&5\n+echo \"$progname:1864: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo 'X$''{'ac_cv_header_$ac_safe'+set}'`\\\" = Xset\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1859 \"ltconfig\"\n+#line 1869 \"ltconfig\"\n #include <$ac_hdr>\n int fnord = 0;\n int main () { return(0); }\n EOF\n ac_try=\"$ac_compile >/dev/null 2>conftest.out\"\n-{ (eval echo $progname:1865: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo $progname:1875: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -1891,15 +1900,15 @@ done\n     LIBS=\"$lt_cv_dlopen_libs $LIBS\"\n \n   echo $ac_n \"checking whether a program can dlopen itself\"\"... $ac_c\" 1>&6\n-echo \"$progname:1893: checking whether a program can dlopen itself\" >&5\n+echo \"$progname:1903: checking whether a program can dlopen itself\" >&5\n if test \"X${lt_cv_dlopen_self+set}\" = Xset; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test \"$cross_compiling\" = yes; then\n     lt_cv_dlopen_self=cross\n   else\n     cat > conftest.$ac_ext <<EOF\n-#line 1901 \"ltconfig\"\n+#line 1911 \"ltconfig\"\n \n #if HAVE_DLFCN_H\n #include <dlfcn.h>\n@@ -1946,7 +1955,7 @@ int main() {\n                if(ptr1 || ptr2) { dlclose(self); exit(0); } } exit(1); }\n \n EOF\n-if { (eval echo $progname:1948: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null\n+if { (eval echo $progname:1958: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null\n then\n   lt_cv_dlopen_self=yes\n else\n@@ -1965,15 +1974,15 @@ echo \"$ac_t\"\"$lt_cv_dlopen_self\" 1>&6\n   if test \"$lt_cv_dlopen_self\" = yes; then\n     LDFLAGS=\"$LDFLAGS $link_static_flag\"\n   echo $ac_n \"checking whether a statically linked program can dlopen itself\"\"... $ac_c\" 1>&6\n-echo \"$progname:1967: checking whether a statically linked program can dlopen itself\" >&5\n+echo \"$progname:1977: checking whether a statically linked program can dlopen itself\" >&5\n if test \"X${lt_cv_dlopen_self_static+set}\" = Xset; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test \"$cross_compiling\" = yes; then\n     lt_cv_dlopen_self_static=cross\n   else\n     cat > conftest.$ac_ext <<EOF\n-#line 1975 \"ltconfig\"\n+#line 1985 \"ltconfig\"\n \n #if HAVE_DLFCN_H\n #include <dlfcn.h>\n@@ -2020,7 +2029,7 @@ int main() {\n     if(ptr1 || ptr2) { dlclose(self); exit(0); } } exit(1); }\n \n EOF\n-if { (eval echo $progname:2022: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null\n+if { (eval echo $progname:2032: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null\n then\n   lt_cv_dlopen_self_static=yes\n else\n@@ -2616,7 +2625,7 @@ EOF\n #      filename = argv[1];\n #\n #      dll = open(filename, O_RDONLY|O_BINARY);\n-#      if (!dll)\n+#      if (dll < 1)\n #  \treturn 1;\n #\n #      dll_name = filename;"}, {"sha": "d8f53859067173568f76f56753d956c9aadeaea2", "filename": "ltmain.sh", "status": "modified", "additions": 201, "deletions": 50, "changes": 251, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75b9074c18f39d280b49b177a65409f9d0edb602/ltmain.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75b9074c18f39d280b49b177a65409f9d0edb602/ltmain.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ltmain.sh?ref=75b9074c18f39d280b49b177a65409f9d0edb602", "patch": "@@ -56,7 +56,7 @@ modename=\"$progname\"\n PROGRAM=ltmain.sh\n PACKAGE=libtool\n VERSION=1.4a\n-TIMESTAMP=\" (1.641.2.198 2001/03/20 05:47:28)\"\n+TIMESTAMP=\" (1.641.2.226 2001/04/12 02:39:36)\"\n \n default_mode=\n help=\"Try \\`$progname --help' for more information.\"\n@@ -136,13 +136,21 @@ do\n         ;;\n       esac\n \n-      if grep \"^### BEGIN LIBTOOL TAG CONFIG: $tagname$\" < \"$0\" > /dev/null; then\n-        taglist=\"$taglist $tagname\"\n-\t# Evaluate the configuration.\n-\teval \"`sed -n -e '/^### BEGIN LIBTOOL TAG CONFIG: '$tagname'$/,/^### END LIBTOOL TAG CONFIG: '$tagname'$/p' < $0`\"\n-      else\n-\techo \"$progname: ignoring unknown tag $tagname\" 1>&2\n-      fi\n+      case $tagname in\n+      CC)\n+\t# Don't test for the \"default\" C tag, as we know, it's there, but\n+\t# not specially marked.\n+\t;;\n+      *)\n+        if grep \"^### BEGIN LIBTOOL TAG CONFIG: $tagname$\" < \"$0\" > /dev/null; then\n+          taglist=\"$taglist $tagname\"\n+\t  # Evaluate the configuration.\n+\t  eval \"`sed -n -e '/^### BEGIN LIBTOOL TAG CONFIG: '$tagname'$/,/^### END LIBTOOL TAG CONFIG: '$tagname'$/p' < $0`\"\n+        else\n+\t  echo \"$progname: ignoring unknown tag $tagname\" 1>&2\n+        fi\n+        ;;\n+      esac\n       ;;\n     *)\n       eval \"$prev=\\$arg\"\n@@ -1205,9 +1213,10 @@ EOF\n \t    # These systems don't actually have c library (as such)\n \t    continue\n \t    ;;\n-\t  *-*-rhapsody* | *-*-darwin*)\n-\t    # Darwin C library is in the System framework\n+\t  *-*-rhapsody* | *-*-darwin1.[012])\n+\t    # Rhapsody C library is in the System framework\n \t    deplibs=\"$deplibs -framework System\"\n+\t    continue\n \t    ;;\n \t  esac\n \telif test \"$arg\" = \"-lm\"; then\n@@ -1216,9 +1225,10 @@ EOF\n \t    # These systems don't actually have math library (as such)\n \t    continue\n \t    ;;\n-\t  *-*-rhapsody* | *-*-darwin*)\n-\t    # Darwin math library is in the System framework\n+\t  *-*-rhapsody* | *-*-darwin1.[012])\n+\t    # Rhapsody math library is in the System framework\n \t    deplibs=\"$deplibs -framework System\"\n+\t    continue\n \t    ;;\n \t  esac\n \tfi\n@@ -1245,10 +1255,6 @@ EOF\n \t  $echo \"$modename: warning: assuming \\`-no-fast-install' instead\" 1>&2\n \t  fast_install=no\n \t  ;;\n-\t*-*-rhapsody* | *-*-darwin*)\n-\t  # Darwin C library is in the System framework\n-\t  deplibs=\"$deplibs -framework System\"\n-\t  ;;\n \t*)\n \t  no_install=yes\n \t  ;;\n@@ -1632,6 +1638,18 @@ EOF\n \n     if test $linkmode = lib; then\n       libs=\"$predeps $libs $compiler_lib_search_path $postdeps\"\n+\n+      # Compute libraries that are listed more than once in $predeps\n+      # $postdeps and mark them as special (i.e., whose duplicates are\n+      # not to be eliminated).\n+      pre_post_deps=\n+      for pre_post_dep in $predeps $postdeps; do\n+        case \"$pre_post_deps \" in\n+\t*\" $pre_post_dep \"*) specialdeplibs=\"$specialdeplibs $pre_post_deps\" ;;\n+\tesac\n+\tpre_post_deps=\"$pre_post_deps $pre_post_dep\"\n+      done\n+      pre_post_deps=\n     fi\n \n     deplibs=\n@@ -2081,13 +2099,25 @@ EOF\n \t    realname=\"$2\"\n \t    shift; shift\n \t    libname=`eval \\\\$echo \\\"$libname_spec\\\"`\n-\t    if test -n \"$soname_spec\"; then\n+\t    # use dlname if we got it. it's perfectly good, no?\n+\t    if test -n \"$dlname\"; then\n+\t      soname=\"$dlname\"\n+\t    elif test -n \"$soname_spec\"; then\n+\t      # bleh windows\n+\t      case $host in\n+\t      *cygwin*)\n+\t\tmajor=`expr $current - $age`\n+\t\tversuffix=\"-$major\"\n+\t\t;;\n+\t      esac\n \t      eval soname=\\\"$soname_spec\\\"\n \t    else\n \t      soname=\"$realname\"\n \t    fi\n \n \t    # Make a new name for the extract_expsyms_cmds to use\n+\t    soroot=\"$soname\"\n+\t    soname=`echo $soroot | sed -e 's/^.*\\///'`\n \t    newlib=\"libimp-`echo $soname | sed 's/^lib//;s/\\.dll$//'`.a\"\n \n \t    # If the library has no export list, then create one now\n@@ -2350,25 +2380,44 @@ EOF\n \t  vars=\"compile_deplibs finalize_deplibs\"\n \tfi\n \tfor var in $vars dependency_libs; do\n-\t  # Make sure that $var contains only unique libraries\n-\t  # and add them in reverse order\n+\t  # Add libraries to $var in reverse order\n \t  eval tmp_libs=\\\"\\$$var\\\"\n \t  new_libs=\n \t  for deplib in $tmp_libs; do\n+\t    # FIXME: Pedantically, this is the right thing to do, so\n+\t    #        that some nasty dependency loop isn't accidentally\n+\t    #        broken:\n+\t    #new_libs=\"$deplib $new_libs\"\n+\t    # Pragmatically, this seems to cause very few problems in\n+\t    # practice:\n \t    case $deplib in\n-\t    -L*) new_libs=\"$deplib $new_libs\" ;;\n-\t    *)\n-\t      case \" $specialdeplibs \" in\n-\t      *\" $deplib \"*) new_libs=\"$deplib $new_libs\" ;;\n-\t      *)\n-\t\tcase \" $new_libs \" in\n-\t\t*\" $deplib \"*) ;;\n-\t\t*) new_libs=\"$deplib $new_libs\" ;;\n-\t\tesac\n-\t\t;;\n-\t      esac\n-\t      ;;\n-\t    esac\n+            -L*) new_libs=\"$deplib $new_libs\" ;;\n+            *)\n+\t      # And here is the reason: when a library appears more\n+\t      # than once as an explicit dependence of a library, or\n+\t      # is implicitly linked in more than once by the\n+\t      # compiler, it is considered special, and multiple\n+\t      # occurrences thereof are not removed.  Compare this\n+\t      # with having the same library being listed as a\n+\t      # dependency of multiple other libraries: in this case,\n+\t      # we know (pedantically, we assume) the library does not\n+\t      # need to be listed more than once, so we keep only the\n+\t      # last copy.  This is not always right, but it is rare\n+\t      # enough that we require users that really mean to play\n+\t      # such unportable linking tricks to link the library\n+\t      # using -Wl,-lname, so that libtool does not consider it\n+\t      # for duplicate removal.\n+              case \" $specialdeplibs \" in\n+              *\" $deplib \"*) new_libs=\"$deplib $new_libs\" ;;\n+              *)\n+                case \" $new_libs \" in\n+                *\" $deplib \"*) ;;\n+                *) new_libs=\"$deplib $new_libs\" ;;\n+                esac\n+                ;;\n+              esac\n+              ;;\n+            esac\n \t  done\n \t  tmp_libs=\n \t  for deplib in $new_libs; do\n@@ -2510,7 +2559,7 @@ EOF\n \n \t# Check that each of the things are valid numbers.\n \tcase $current in\n-\t0 | [1-9] | [1-9][0-9]*) ;;\n+\t0 | [1-9] | [1-9][0-9] | [1-9][0-9][0-9]) ;;\n \t*)\n \t  $echo \"$modename: CURRENT \\`$current' is not a nonnegative integer\" 1>&2\n \t  $echo \"$modename: \\`$vinfo' is not valid version information\" 1>&2\n@@ -2519,7 +2568,7 @@ EOF\n \tesac\n \n \tcase $revision in\n-\t0 | [1-9] | [1-9][0-9]*) ;;\n+\t0 | [1-9] | [1-9][0-9] | [1-9][0-9][0-9]) ;;\n \t*)\n \t  $echo \"$modename: REVISION \\`$revision' is not a nonnegative integer\" 1>&2\n \t  $echo \"$modename: \\`$vinfo' is not valid version information\" 1>&2\n@@ -2528,7 +2577,7 @@ EOF\n \tesac\n \n \tcase $age in\n-\t0 | [1-9] | [1-9][0-9]*) ;;\n+\t0 | [1-9] | [1-9][0-9] | [1-9][0-9][0-9]) ;;\n \t*)\n \t  $echo \"$modename: AGE \\`$age' is not a nonnegative integer\" 1>&2\n \t  $echo \"$modename: \\`$vinfo' is not valid version information\" 1>&2\n@@ -2549,6 +2598,26 @@ EOF\n \tcase $version_type in\n \tnone) ;;\n \n+\tdarwin)\n+\t  # Like Linux, but with the current version available in\n+\t  # verstring for coding it into the library header\n+\t  major=.`expr $current - $age`\n+\t  versuffix=\"$major.$age.$revision\"\n+\t  # Darwin ld doesn't like 0 for these options...\n+\t  minor_current=`expr $current + 1`\n+\t  verstring=\"-compatibility_version $minor_current -current_version $minor_current.$revision\"\n+\t  ;;\n+\n+\tfreebsd-aout)\n+\t  major=\".$current\"\n+\t  versuffix=\".$current.$revision\";\n+\t  ;;\n+\n+\tfreebsd-elf)\n+\t  major=\".$current\"\n+\t  versuffix=\".$current\";\n+\t  ;;\n+\n \tirix)\n \t  major=`expr $current - $age + 1`\n \t  verstring=\"sgi$major.$revision\"\n@@ -2593,16 +2662,6 @@ EOF\n \t  versuffix=\".$current.$revision\"\n \t  ;;\n \n-\tfreebsd-aout)\n-\t  major=\".$current\"\n-\t  versuffix=\".$current.$revision\";\n-\t  ;;\n-\n-\tfreebsd-elf)\n-\t  major=\".$current\"\n-\t  versuffix=\".$current\";\n-\t  ;;\n-\n \twindows)\n \t  # Use '-' rather than '.', since we only want one\n \t  # extension on DOS 8.3 filesystems.\n@@ -2725,6 +2784,10 @@ EOF\n \t  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-*-beos*)\n \t    # these systems don't actually have a c library (as such)!\n \t    ;;\n+\t  *-*-rhapsody* | *-*-darwin1.[012])\n+\t    # Rhapsody C library is in the System framework\n+\t    deplibs=\"$deplibs -framework System\"\n+\t    ;;\n \t  *)\n  \t    # Add libc to deplibs on all other systems if necessary.\n  \t    if test $build_libtool_need_lc = \"yes\"; then\n@@ -2884,6 +2947,40 @@ EOF\n \t    fi\n \t  done # Gone through all deplibs.\n \t  ;;\n+\tmatch_pattern*)\n+\t  set dummy $deplibs_check_method\n+\t  match_pattern_regex=`expr \"$deplibs_check_method\" : \"$2 \\(.*\\)\"`\n+\t  for a_deplib in $deplibs; do\n+\t    name=\"`expr $a_deplib : '-l\\(.*\\)'`\"\n+\t    # If $name is empty we are operating on a -L argument.\n+\t    if test \"$name\" != \"\" -a \"$name\" != \"0\"; then\n+\t      libname=`eval \\\\$echo \\\"$libname_spec\\\"`\n+\t      for i in $lib_search_path $sys_lib_search_path $shlib_search_path; do\n+\t\tpotential_libs=`ls $i/$libname[.-]* 2>/dev/null`\n+\t\tfor potent_lib in $potential_libs; do\n+\t\t  if eval echo \\\"$potent_lib\\\" 2>/dev/null \\\n+\t\t      | sed 10q \\\n+\t\t      | egrep \"$match_pattern_regex\" > /dev/null; then\n+\t\t    newdeplibs=\"$newdeplibs $a_deplib\"\n+\t\t    a_deplib=\"\"\n+\t\t    break 2\n+\t\t  fi\n+\t\tdone\n+\t      done\n+\t      if test -n \"$a_deplib\" ; then\n+\t\tdroppeddeps=yes\n+\t\techo\n+\t\techo \"*** Warning: This library needs some functionality provided by $a_deplib.\"\n+\t\techo \"*** I have the capability to make that library automatically link in when\"\n+\t\techo \"*** you link to this library.  But I can only do this if you have a\"\n+\t\techo \"*** shared version of the library, which you do not appear to have.\"\n+\t      fi\n+\t    else\n+\t      # Add a -L argument.\n+\t      newdeplibs=\"$newdeplibs $a_deplib\"\n+\t    fi\n+\t  done # Gone through all deplibs.\n+\t  ;;\n \tnone | unknown | *)\n \t  newdeplibs=\"\"\n \t  if $echo \"X $deplibs\" | $Xsed -e 's/ -lc$//' \\\n@@ -3025,6 +3122,9 @@ EOF\n \telse\n \t  soname=\"$realname\"\n \tfi\n+\tif test x$dlname = x; then\n+\t  dlname=$soname\n+\tfi\n \n \tlib=\"$output_objdir/$realname\"\n \tfor link\n@@ -3434,6 +3534,9 @@ EOF\n       ;;\n \n     prog)\n+      case $host in\n+        *cygwin*) output=`echo $output | sed -e 's,.exe$,,;s,$,.exe,'` ;;\n+      esac\n       if test -n \"$vinfo\"; then\n \t$echo \"$modename: warning: \\`-version-info' is ignored for programs\" 1>&2\n       fi\n@@ -3877,6 +3980,11 @@ static const void *lt_preloaded_setup() {\n \tcase $output in\n \t  *.exe) output=`echo $output|sed 's,.exe$,,'` ;;\n \tesac\n+\t# test for cygwin because mv fails w/o .exe extensions\n+\tcase $host in\n+\t  *cygwin*) exeext=.exe ;;\n+\t  *) exeext= ;;\n+\tesac\n \t$rm $output\n \ttrap \"$rm $output; exit 1\" 1 2 15\n \n@@ -3955,7 +4063,7 @@ else\n \n \tif test \"$fast_install\" = yes; then\n \t  echo >> $output \"\\\n-  program=lt-'$outputname'\n+  program=lt-'$outputname'$exeext\n   progdir=\\\"\\$thisdir/$objdir\\\"\n \n   if test ! -f \\\"\\$progdir/\\$program\\\" || \\\\\n@@ -4263,6 +4371,11 @@ fi\\\n \t    dlprefiles=\"$newdlprefiles\"\n \t  fi\n \t  $rm $output\n+\t  # place dlname in correct position for cygwin\n+\t  tdlname=$dlname\n+\t  case $host,$output,$installed,$module,$dlname in\n+\t    *cygwin*,*lai,yes,no,*.dll) tdlname=../bin/$dlname ;;\n+\t  esac\n \t  $echo > $output \"\\\n # $outputname - a libtool library file\n # Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP\n@@ -4271,7 +4384,7 @@ fi\\\n # It is necessary for linking the library.\n \n # The name that we can dlopen(3).\n-dlname='$dlname'\n+dlname='$tdlname'\n \n # Names of this library.\n library_names='$library_names'\n@@ -4695,6 +4808,25 @@ relink_command=\\\"$relink_command\\\"\"\n \t  fi\n \tfi\n \n+\n+\t# remove .exe since cygwin /usr/bin/install will append another\n+\t# one anyways\n+\tcase $install_prog,$host in\n+\t*/usr/bin/install*,*cygwin*)\n+\t  case $file:$destfile in\n+\t  *.exe:*.exe)\n+\t    # this is ok\n+\t    ;;\n+\t  *.exe:*)\n+\t    destfile=$destfile.exe\n+\t    ;;\n+\t  *:*.exe)\n+\t    destfile=`echo $destfile | sed -e 's,.exe$,,'`\n+\t    ;;\n+\t  esac\n+\t  ;;\n+\tesac\n+\n \t$show \"$install_prog$stripme $file $destfile\"\n \t$run eval \"$install_prog\\$stripme \\$file \\$destfile\" || exit $?\n \ttest -n \"$outputname\" && ${rm}r \"$tmpdir\"\n@@ -4786,7 +4918,7 @@ relink_command=\\\"$relink_command\\\"\"\n     echo\n     echo \"If you ever happen to want to link against installed libraries\"\n     echo \"in a given directory, LIBDIR, you must either use libtool, and\"\n-    echo \"specify the full pathname of the library, or use \\`-LLIBDIR'\"\n+    echo \"specify the full pathname of the library, or use the \\`-LLIBDIR'\"\n     echo \"flag during linking and do at least one of the following:\"\n     if test -n \"$shlibpath_var\"; then\n       echo \"   - add LIBDIR to the \\`$shlibpath_var' environment variable\"\n@@ -4962,6 +5094,8 @@ relink_command=\\\"$relink_command\\\"\"\n     modename=\"$modename: $mode\"\n     rm=\"$nonopt\"\n     files=\n+    rmforce=\n+    exit_status=0\n \n     # This variable tells wrapper scripts just to set variables rather\n     # than running their programs.\n@@ -4970,6 +5104,7 @@ relink_command=\\\"$relink_command\\\"\"\n     for arg\n     do\n       case $arg in\n+      -f) rm=\"$rm $arg\"; rmforce=yes ;;\n       -*) rm=\"$rm $arg\" ;;\n       *) files=\"$files $arg\" ;;\n       esac\n@@ -5001,6 +5136,16 @@ relink_command=\\\"$relink_command\\\"\"\n \t  *) rmdirs=\"$rmdirs $objdir\" ;;\n \tesac\n       fi\n+      \n+      # Don't error if the file doesn't exist and rm -f was used.\n+      if test -L \"$file\" >/dev/null 2>&1 || test -f \"$file\"; then\n+        :\n+      elif test -d \"$file\"; then\n+        exit_status=1\n+\tcontinue\n+      elif test \"$rmforce\" = yes; then\n+        continue\n+      fi\n \n       rmfiles=\"$file\"\n \n@@ -5026,6 +5171,9 @@ relink_command=\\\"$relink_command\\\"\"\n \t\tIFS=\"$save_ifs\"\n \t\t$show \"$cmd\"\n \t\t$run eval \"$cmd\"\n+\t\tif test $? != 0 && test \"$rmforce\" != yes; then\n+\t\t  exit_status=1\n+\t\tfi\n \t      done\n \t      IFS=\"$save_ifs\"\n \t    fi\n@@ -5038,6 +5186,9 @@ relink_command=\\\"$relink_command\\\"\"\n \t\tIFS=\"$save_ifs\"\n \t\t$show \"$cmd\"\n \t\t$run eval \"$cmd\"\n+\t\tif test $? != 0 && test \"$rmforce\" != yes; then\n+\t\t  exit_status=1\n+\t\tfi\n \t      done\n \t      IFS=\"$save_ifs\"\n \t    fi\n@@ -5082,7 +5233,7 @@ relink_command=\\\"$relink_command\\\"\"\n \t;;\n       esac\n       $show \"$rm $rmfiles\"\n-      $run $rm $rmfiles\n+      $run $rm $rmfiles || exit_status=1\n     done\n \n     # Try to remove the ${objdir}s in the directories where we deleted files\n@@ -5093,7 +5244,7 @@ relink_command=\\\"$relink_command\\\"\"\n       fi\n     done\n \n-    exit 0\n+    exit $exit_status\n     ;;\n \n   \"\")"}]}