{"sha": "f33f618e35e8d321270d978cf17037cc1be98ae9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjMzZjYxOGUzNWU4ZDMyMTI3MGQ5NzhjZjE3MDM3Y2MxYmU5OGFlOQ==", "commit": {"author": {"name": "CohenArthur", "email": "arthur.cohen@epita.fr", "date": "2021-05-18T17:27:26Z"}, "committer": {"name": "CohenArthur", "email": "arthur.cohen@epita.fr", "date": "2021-05-18T17:31:06Z"}, "message": "resolve-unused: Check for underscore before warning about unused\nidentifiers", "tree": {"sha": "2c2de3c22368ec2cc89165caf0c4baf5d37b22a8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2c2de3c22368ec2cc89165caf0c4baf5d37b22a8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f33f618e35e8d321270d978cf17037cc1be98ae9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f33f618e35e8d321270d978cf17037cc1be98ae9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f33f618e35e8d321270d978cf17037cc1be98ae9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f33f618e35e8d321270d978cf17037cc1be98ae9/comments", "author": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "30e9cfbf6a60b034a85077b4dd242a2760180188", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/30e9cfbf6a60b034a85077b4dd242a2760180188", "html_url": "https://github.com/Rust-GCC/gccrs/commit/30e9cfbf6a60b034a85077b4dd242a2760180188"}], "stats": {"total": 15, "additions": 11, "deletions": 4}, "files": [{"sha": "bd711105f35938ce6a02d01ddf9affab57505bae", "filename": "gcc/rust/resolve/rust-ast-resolve-unused.h", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f33f618e35e8d321270d978cf17037cc1be98ae9/gcc%2Frust%2Fresolve%2Frust-ast-resolve-unused.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f33f618e35e8d321270d978cf17037cc1be98ae9/gcc%2Frust%2Fresolve%2Frust-ast-resolve-unused.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fresolve%2Frust-ast-resolve-unused.h?ref=f33f618e35e8d321270d978cf17037cc1be98ae9", "patch": "@@ -30,7 +30,13 @@ class ScanUnused\n   static void ScanRib (Rib *r)\n   {\n     r->iterate_decls ([&] (NodeId decl_node_id, Location locus) -> bool {\n-      if (!r->have_references_for_node (decl_node_id))\n+      CanonicalPath ident = CanonicalPath::create_empty ();\n+\n+      bool ok = r->lookup_canonical_path (decl_node_id, &ident);\n+      rust_assert (ok);\n+\n+      if (!r->have_references_for_node (decl_node_id)\n+\t  && ident.get ().at (0) != '_')\n \t{\n \t  rust_warning_at (locus, 0, \"unused name\");\n \t}"}, {"sha": "4004cd30b7b8ea349b145b46c3c55a1ce77b15b0", "filename": "gcc/testsuite/rust.test/compile/loop5.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f33f618e35e8d321270d978cf17037cc1be98ae9/gcc%2Ftestsuite%2Frust.test%2Fcompile%2Floop5.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f33f618e35e8d321270d978cf17037cc1be98ae9/gcc%2Ftestsuite%2Frust.test%2Fcompile%2Floop5.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust.test%2Fcompile%2Floop5.rs?ref=f33f618e35e8d321270d978cf17037cc1be98ae9", "patch": "@@ -4,7 +4,6 @@ fn main() {\n \n     // first number in Fibonacci sequence over 10:\n     let _fib = loop {\n-        // { dg-bogus \"unused name\" \"#361\" { xfail *-*-* } .-1 }\n         if b > 10 {\n             break b;\n         }"}, {"sha": "0cd844592b64d01f0dda16b0f4712e1225670812", "filename": "gcc/testsuite/rust.test/compile/loop7.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f33f618e35e8d321270d978cf17037cc1be98ae9/gcc%2Ftestsuite%2Frust.test%2Fcompile%2Floop7.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f33f618e35e8d321270d978cf17037cc1be98ae9/gcc%2Ftestsuite%2Frust.test%2Fcompile%2Floop7.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust.test%2Fcompile%2Floop7.rs?ref=f33f618e35e8d321270d978cf17037cc1be98ae9", "patch": "@@ -3,7 +3,6 @@ fn main() {\n     let mut b = 1;\n \n     let _fib = loop {\n-        // { dg-bogus \"unused name\" \"#361\" { xfail *-*-* } .-1 }\n         if (a % 2 == 0) {\n             continue;\n         }"}, {"sha": "3c0b24a391339805c0e0a87de3a346c858b1c61a", "filename": "gcc/testsuite/rust.test/compile/struct_base_init_1.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f33f618e35e8d321270d978cf17037cc1be98ae9/gcc%2Ftestsuite%2Frust.test%2Fcompile%2Fstruct_base_init_1.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f33f618e35e8d321270d978cf17037cc1be98ae9/gcc%2Ftestsuite%2Frust.test%2Fcompile%2Fstruct_base_init_1.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust.test%2Fcompile%2Fstruct_base_init_1.rs?ref=f33f618e35e8d321270d978cf17037cc1be98ae9", "patch": "@@ -9,5 +9,4 @@ fn foo() -> Foo {\n \n fn main() {\n     let _f = Foo { a: 10, ..foo() };\n-    // { dg-bogus \"unused name\" \"#361\" { xfail *-*-* } .-1 }\n }"}, {"sha": "2c106c55df9f7beb205730e32059277eabeab556", "filename": "gcc/testsuite/rust.test/compile/underscore_id.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f33f618e35e8d321270d978cf17037cc1be98ae9/gcc%2Ftestsuite%2Frust.test%2Fcompile%2Funderscore_id.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f33f618e35e8d321270d978cf17037cc1be98ae9/gcc%2Ftestsuite%2Frust.test%2Fcompile%2Funderscore_id.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust.test%2Fcompile%2Funderscore_id.rs?ref=f33f618e35e8d321270d978cf17037cc1be98ae9", "patch": "@@ -0,0 +1,4 @@\n+fn main() {\n+    let _unused_but_fine = 12;\n+    let unused = 12; // { dg-warning \"unused name\" }\n+}"}]}