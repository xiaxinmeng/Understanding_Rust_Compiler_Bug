{"sha": "0fe0caa6d942920ebaab6197c8bedb4e371e9110", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGZlMGNhYTZkOTQyOTIwZWJhYWI2MTk3YzhiZWRiNGUzNzFlOTExMA==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2004-09-12T04:45:59Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2004-09-12T04:45:59Z"}, "message": "pt.c (cur_stmt_expr): Move from tsubst_expr.\n\n        * pt.c (cur_stmt_expr): Move from tsubst_expr.\n        (tsubst_expr) <case STMT_EXPR>: Move ...\n        (tsubst_copy_and_build): ... here.\n\nFrom-SVN: r87385", "tree": {"sha": "924d91327c967d75aa12673c2b98f330d7f41add", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/924d91327c967d75aa12673c2b98f330d7f41add"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0fe0caa6d942920ebaab6197c8bedb4e371e9110", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0fe0caa6d942920ebaab6197c8bedb4e371e9110", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0fe0caa6d942920ebaab6197c8bedb4e371e9110", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0fe0caa6d942920ebaab6197c8bedb4e371e9110/comments", "author": null, "committer": null, "parents": [{"sha": "97b7c168e52660bec48a39d59cdba87e8f330123", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97b7c168e52660bec48a39d59cdba87e8f330123", "html_url": "https://github.com/Rust-GCC/gccrs/commit/97b7c168e52660bec48a39d59cdba87e8f330123"}], "stats": {"total": 53, "additions": 35, "deletions": 18}, "files": [{"sha": "c8ba24d4960ad2830006d39fe7a6024e960db942", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0fe0caa6d942920ebaab6197c8bedb4e371e9110/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0fe0caa6d942920ebaab6197c8bedb4e371e9110/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=0fe0caa6d942920ebaab6197c8bedb4e371e9110", "patch": "@@ -1,3 +1,10 @@\n+2004-09-11  Richard Henderson  <rth@redhat.com>\n+\n+\tPR c++/17404\n+        * pt.c (cur_stmt_expr): Move from tsubst_expr.\n+        (tsubst_expr) <case STMT_EXPR>: Move ...\n+        (tsubst_copy_and_build): ... here.\n+\n 2004-09-10  Zack Weinberg  <zack@codesourcery.com>\n \n \t* cp-tree.h (interface_only, interface_unknown): Delete declarations;"}, {"sha": "0a6b773d1ad5368455b4b4eeae91b2a3aaa536dd", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 18, "deletions": 18, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0fe0caa6d942920ebaab6197c8bedb4e371e9110/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0fe0caa6d942920ebaab6197c8bedb4e371e9110/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=0fe0caa6d942920ebaab6197c8bedb4e371e9110", "patch": "@@ -67,6 +67,11 @@ static GTY(()) tree current_tinst_level;\n \n static GTY(()) tree saved_access_scope;\n \n+/* Live only within one (recursive) call to tsubst_expr.  We use\n+   this to pass the statement expression node from the STMT_EXPR\n+   to the EXPR_STMT that is its result.  */\n+static tree cur_stmt_expr;\n+\n /* A map from local variable declarations in the body of the template\n    presently being instantiated to the corresponding instantiated\n    local variables.  */\n@@ -7790,11 +7795,6 @@ tsubst_copy (tree t, tree args, tsubst_flags_t complain, tree in_decl)\n static tree\n tsubst_expr (tree t, tree args, tsubst_flags_t complain, tree in_decl)\n {\n-  /* Live only within one (recursive) call to tsubst_expr.  We use\n-     this to pass the statement expression node from the STMT_EXPR\n-     to the EXPR_STMT that is its result.  */\n-  static tree cur_stmt_expr;\n-\n   tree stmt, tmp;\n \n   if (t == NULL_TREE || t == error_mark_node)\n@@ -7825,19 +7825,6 @@ tsubst_expr (tree t, tree args, tsubst_flags_t complain, tree in_decl)\n \t\t\t\t       args, complain, in_decl));\n       break;\n \n-    case STMT_EXPR:\n-      {\n-\ttree old_stmt_expr = cur_stmt_expr;\n-\ttree stmt_expr = begin_stmt_expr ();\n-\n-\tcur_stmt_expr = stmt_expr;\n-\ttsubst_expr (STMT_EXPR_STMT (t), args, complain, in_decl);\n-\tstmt_expr = finish_stmt_expr (stmt_expr, false);\n-\tcur_stmt_expr = old_stmt_expr;\n-\n-\treturn stmt_expr;\n-      }\n-\n     case EXPR_STMT:\n       tmp = tsubst_expr (EXPR_STMT_EXPR (t), args, complain, in_decl);\n       if (EXPR_STMT_STMT_EXPR_RESULT (t))\n@@ -8626,6 +8613,19 @@ tsubst_copy_and_build (tree t,\n     case OFFSETOF_EXPR:\n       return fold_offsetof (RECUR (TREE_OPERAND (t, 0)));\n \n+    case STMT_EXPR:\n+      {\n+\ttree old_stmt_expr = cur_stmt_expr;\n+\ttree stmt_expr = begin_stmt_expr ();\n+\n+\tcur_stmt_expr = stmt_expr;\n+\ttsubst_expr (STMT_EXPR_STMT (t), args, complain, in_decl);\n+\tstmt_expr = finish_stmt_expr (stmt_expr, false);\n+\tcur_stmt_expr = old_stmt_expr;\n+\n+\treturn stmt_expr;\n+      }\n+\n     default:\n       return tsubst_copy (t, args, complain, in_decl);\n     }"}, {"sha": "a470ca8f14f44f39586fc9eda98e0c8439479151", "filename": "gcc/testsuite/g++.dg/template/stmtexpr1.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0fe0caa6d942920ebaab6197c8bedb4e371e9110/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fstmtexpr1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0fe0caa6d942920ebaab6197c8bedb4e371e9110/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fstmtexpr1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fstmtexpr1.C?ref=0fe0caa6d942920ebaab6197c8bedb4e371e9110", "patch": "@@ -0,0 +1,10 @@\n+// PR c++/17404\n+// { dg-do compile }\n+// { dg-options \"\" }\n+\n+template <int> void foo ()\n+{\n+  __builtin_expect  (({0;}), 1);\n+}\n+ \n+template void foo<1> ();"}]}