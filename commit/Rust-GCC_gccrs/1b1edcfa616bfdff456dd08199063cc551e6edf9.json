{"sha": "1b1edcfa616bfdff456dd08199063cc551e6edf9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWIxZWRjZmE2MTZiZmRmZjQ1NmRkMDgxOTkwNjNjYzU1MWU2ZWRmOQ==", "commit": {"author": {"name": "David Edelsohn", "email": "dje@gcc.gnu.org", "date": "2003-02-10T20:13:01Z"}, "committer": {"name": "David Edelsohn", "email": "dje@gcc.gnu.org", "date": "2003-02-10T20:13:01Z"}, "message": "- Really commit ctz patch.\n\nFrom-SVN: r62649", "tree": {"sha": "5a8b8503658c09e1bd895db36f4829441226cea4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5a8b8503658c09e1bd895db36f4829441226cea4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1b1edcfa616bfdff456dd08199063cc551e6edf9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1b1edcfa616bfdff456dd08199063cc551e6edf9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1b1edcfa616bfdff456dd08199063cc551e6edf9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1b1edcfa616bfdff456dd08199063cc551e6edf9/comments", "author": null, "committer": null, "parents": [{"sha": "848f2ce8d5c3c0d124ece9955122418bba9e5d55", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/848f2ce8d5c3c0d124ece9955122418bba9e5d55", "html_url": "https://github.com/Rust-GCC/gccrs/commit/848f2ce8d5c3c0d124ece9955122418bba9e5d55"}], "stats": {"total": 70, "additions": 51, "deletions": 19}, "files": [{"sha": "f8144232096c3c646cba2349fa4257f27961703b", "filename": "gcc/config/rs6000/rs6000.md", "status": "modified", "additions": 51, "deletions": 19, "changes": 70, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1b1edcfa616bfdff456dd08199063cc551e6edf9/gcc%2Fconfig%2Frs6000%2Frs6000.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1b1edcfa616bfdff456dd08199063cc551e6edf9/gcc%2Fconfig%2Frs6000%2Frs6000.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.md?ref=1b1edcfa616bfdff456dd08199063cc551e6edf9", "patch": "@@ -2364,28 +2364,44 @@\n \t\t    (const_int 0)))]\n   \"\")\n \n-(define_expand \"ffssi2\"\n+(define_insn \"clzsi2\"\n+  [(set (match_operand:SI 0 \"gpc_reg_operand\" \"=r\")\n+\t(clz:SI (match_operand:SI 1 \"gpc_reg_operand\" \"r\")))]\n+  \"\"\n+  \"{cntlz|cntlzw} %0,%1\")\n+\n+(define_expand \"ctzsi2\"\n   [(set (match_dup 2)\n-        (neg:SI (match_operand:SI 1 \"gpc_reg_operand\" \"r\")))\n+\t(neg:SI (match_operand:SI 1 \"gpc_reg_operand\" \"r\")))\n    (parallel [(set (match_dup 3) (and:SI (match_dup 1)\n-                                         (match_dup 2)))\n-              (clobber (scratch:CC))])\n+\t\t\t\t\t (match_dup 2)))\n+\t      (clobber (scratch:CC))])\n    (set (match_dup 4) (clz:SI (match_dup 3)))\n    (set (match_operand:SI 0 \"gpc_reg_operand\" \"=r\")\n-        (minus:SI (const_int 32) (match_dup 4)))]\n+\t(minus:SI (const_int 31) (match_dup 4)))]\n   \"\"\n   {\n      operands[2] = gen_reg_rtx (SImode);\n      operands[3] = gen_reg_rtx (SImode);\n      operands[4] = gen_reg_rtx (SImode);\n   })\n   \n-(define_insn \"clzsi2\"\n-  [(set (match_operand:SI 0 \"gpc_reg_operand\" \"=r\")\n-\t(clz:SI (match_operand:SI 1 \"gpc_reg_operand\" \"r\")))]\n+(define_expand \"ffssi2\"\n+  [(set (match_dup 2)\n+\t(neg:SI (match_operand:SI 1 \"gpc_reg_operand\" \"r\")))\n+   (parallel [(set (match_dup 3) (and:SI (match_dup 1)\n+\t\t\t\t\t (match_dup 2)))\n+\t      (clobber (scratch:CC))])\n+   (set (match_dup 4) (clz:SI (match_dup 3)))\n+   (set (match_operand:SI 0 \"gpc_reg_operand\" \"=r\")\n+\t(minus:SI (const_int 32) (match_dup 4)))]\n   \"\"\n-  \"{cntlz|cntlzw} %0,%1\")\n-\n+  {\n+     operands[2] = gen_reg_rtx (SImode);\n+     operands[3] = gen_reg_rtx (SImode);\n+     operands[4] = gen_reg_rtx (SImode);\n+  })\n+  \n (define_expand \"mulsi3\"\n   [(use (match_operand:SI 0 \"gpc_reg_operand\" \"\"))\n    (use (match_operand:SI 1 \"gpc_reg_operand\" \"\"))\n@@ -6739,27 +6755,43 @@\n \t\t    (const_int 0)))]\n   \"\")\n \n-(define_expand \"ffsdi2\"\n+(define_insn \"clzdi2\"\n+  [(set (match_operand:DI 0 \"gpc_reg_operand\" \"=r\")\n+\t(clz:DI (match_operand:DI 1 \"gpc_reg_operand\" \"r\")))]\n+  \"TARGET_POWERPC64\"\n+  \"cntlzd %0,%1\")\n+\n+(define_expand \"ctzdi2\"\n   [(set (match_dup 2)\n-        (neg:DI (match_operand:DI 1 \"gpc_reg_operand\" \"r\")))\n+\t(neg:DI (match_operand:DI 1 \"gpc_reg_operand\" \"r\")))\n    (parallel [(set (match_dup 3) (and:DI (match_dup 1)      \n-                                         (match_dup 2)))   \n-              (clobber (scratch:CC))])\n+\t\t\t\t\t (match_dup 2)))   \n+\t      (clobber (scratch:CC))])\n    (set (match_dup 4) (clz:DI (match_dup 3)))\n    (set (match_operand:DI 0 \"gpc_reg_operand\" \"=r\")\n-        (minus:DI (const_int 64) (match_dup 4)))]\n+\t(minus:DI (const_int 63) (match_dup 4)))]\n   \"TARGET_POWERPC64\"\n   {\n      operands[2] = gen_reg_rtx (DImode); \n      operands[3] = gen_reg_rtx (DImode);\n      operands[4] = gen_reg_rtx (DImode);\n   })\n \n-(define_insn \"clzdi2\"\n-  [(set (match_operand:DI 0 \"gpc_reg_operand\" \"=r\")\n-\t(clz:DI (match_operand:DI 1 \"gpc_reg_operand\" \"r\")))]\n+(define_expand \"ffsdi2\"\n+  [(set (match_dup 2)\n+\t(neg:DI (match_operand:DI 1 \"gpc_reg_operand\" \"r\")))\n+   (parallel [(set (match_dup 3) (and:DI (match_dup 1)      \n+\t\t\t\t\t (match_dup 2)))   \n+\t      (clobber (scratch:CC))])\n+   (set (match_dup 4) (clz:DI (match_dup 3)))\n+   (set (match_operand:DI 0 \"gpc_reg_operand\" \"=r\")\n+\t(minus:DI (const_int 64) (match_dup 4)))]\n   \"TARGET_POWERPC64\"\n-  \"cntlzd %0,%1\")\n+  {\n+     operands[2] = gen_reg_rtx (DImode); \n+     operands[3] = gen_reg_rtx (DImode);\n+     operands[4] = gen_reg_rtx (DImode);\n+  })\n \n (define_insn \"muldi3\"\n   [(set (match_operand:DI 0 \"gpc_reg_operand\" \"=r\")"}]}