{"sha": "556655048b30188a560f135ccde732bc436eded2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTU2NjU1MDQ4YjMwMTg4YTU2MGYxMzVjY2RlNzMyYmM0MzZlZGVkMg==", "commit": {"author": {"name": "Alexandre Oliva", "email": "aoliva@redhat.com", "date": "2017-01-05T01:46:14Z"}, "committer": {"name": "Alexandre Oliva", "email": "aoliva@gcc.gnu.org", "date": "2017-01-05T01:46:14Z"}, "message": "[-fcompare-debug] skip more debug stmts in cleanup_empty_eh\n\nVarious Ada RTS files failed -fcompare-debug compilation because debug\nstmts prevented EH cleanups from taking place.  Adjusting\ncleanup_empty_eh to skip them fixes it.\n\nfor  gcc/ChangeLog\n\n\t* gimple-iterator.h (gsi_one_nondebug_before_end_p): New.\n\t* tree-eh.c (cleanup_empty_eh): Skip more debug stmts.\n\nFrom-SVN: r244088", "tree": {"sha": "97d67deb2126d6cba12c2c7c06b78b0d37401d62", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/97d67deb2126d6cba12c2c7c06b78b0d37401d62"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/556655048b30188a560f135ccde732bc436eded2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/556655048b30188a560f135ccde732bc436eded2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/556655048b30188a560f135ccde732bc436eded2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/556655048b30188a560f135ccde732bc436eded2/comments", "author": null, "committer": null, "parents": [{"sha": "692216906ba1c7734183c4940122d5684c05141f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/692216906ba1c7734183c4940122d5684c05141f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/692216906ba1c7734183c4940122d5684c05141f"}], "stats": {"total": 26, "additions": 23, "deletions": 3}, "files": [{"sha": "6f26a7a0e40c43b34e07076a81c44cd38795c3ce", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/556655048b30188a560f135ccde732bc436eded2/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/556655048b30188a560f135ccde732bc436eded2/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=556655048b30188a560f135ccde732bc436eded2", "patch": "@@ -1,3 +1,8 @@\n+2017-01-04  Alexandre Oliva <aoliva@redhat.com>\n+\n+\t* gimple-iterator.h (gsi_one_nondebug_before_end_p): New.\n+\t* tree-eh.c (cleanup_empty_eh): Skip more debug stmts.\n+\n 2017-01-04  Alexandre Oliva <aoliva@redhat.com>\n \n \t* multiple_target.c (create_dispatcher_calls): Init e_next."}, {"sha": "70f18beceffc10126f68cabb54ddfa3204624eb5", "filename": "gcc/gimple-iterator.h", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/556655048b30188a560f135ccde732bc436eded2/gcc%2Fgimple-iterator.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/556655048b30188a560f135ccde732bc436eded2/gcc%2Fgimple-iterator.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-iterator.h?ref=556655048b30188a560f135ccde732bc436eded2", "patch": "@@ -305,6 +305,20 @@ gsi_last_nondebug_bb (basic_block bb)\n   return i;\n }\n \n+/* Return true if I is followed only by debug statements in its\n+   sequence.  */\n+\n+static inline bool\n+gsi_one_nondebug_before_end_p (gimple_stmt_iterator i)\n+{\n+  if (gsi_one_before_end_p (i))\n+    return true;\n+  if (gsi_end_p (i))\n+    return false;\n+  gsi_next_nondebug (&i);\n+  return gsi_end_p (i);\n+}\n+\n /* Iterates I statement iterator to the next non-virtual statement.  */\n \n static inline void"}, {"sha": "45e6b9e4ebb3973e1bcd6267a512457c37d4044b", "filename": "gcc/tree-eh.c", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/556655048b30188a560f135ccde732bc436eded2/gcc%2Ftree-eh.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/556655048b30188a560f135ccde732bc436eded2/gcc%2Ftree-eh.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-eh.c?ref=556655048b30188a560f135ccde732bc436eded2", "patch": "@@ -4382,7 +4382,8 @@ cleanup_empty_eh (eh_landing_pad lp)\n       return false;\n     }\n \n-  resx = last_stmt (bb);\n+  gsi = gsi_last_nondebug_bb (bb);\n+  resx = gsi_stmt (gsi);\n   if (resx && is_gimple_resx (resx))\n     {\n       if (stmt_can_throw_external (resx))\n@@ -4416,12 +4417,12 @@ cleanup_empty_eh (eh_landing_pad lp)\n   resx = gsi_stmt (gsi);\n   if (!e_out && gimple_call_builtin_p (resx, BUILT_IN_STACK_RESTORE))\n     {\n-      gsi_next (&gsi);\n+      gsi_next_nondebug (&gsi);\n       resx = gsi_stmt (gsi);\n     }\n   if (!is_gimple_resx (resx))\n     return ret;\n-  gcc_assert (gsi_one_before_end_p (gsi));\n+  gcc_assert (gsi_one_nondebug_before_end_p (gsi));\n \n   /* Determine if there are non-EH edges, or resx edges into the handler.  */\n   has_non_eh_pred = false;"}]}