{"sha": "973a648b87fcb026397eaf72264b996cb314b8b3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTczYTY0OGI4N2ZjYjAyNjM5N2VhZjcyMjY0Yjk5NmNiMzE0YjhiMw==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@cygnus.com", "date": "1999-09-10T21:06:36Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "1999-09-10T21:06:36Z"}, "message": "builtins.c (expand_builtin_va_arg): Cope with an array-type va_list decomposing to pointer-type.\n\n        * builtins.c (expand_builtin_va_arg): Cope with an array-type\n        va_list decomposing to pointer-type.\n        * rs6000.c (rs6000_va_start) Unwrap the ARRAY_TYPE to get at fields.\n        (rs6000_va_arg): Likewise.\n\nFrom-SVN: r29276", "tree": {"sha": "9ed3d0a396689339582d39fcd98a54b7395c8709", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9ed3d0a396689339582d39fcd98a54b7395c8709"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/973a648b87fcb026397eaf72264b996cb314b8b3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/973a648b87fcb026397eaf72264b996cb314b8b3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/973a648b87fcb026397eaf72264b996cb314b8b3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/973a648b87fcb026397eaf72264b996cb314b8b3/comments", "author": null, "committer": null, "parents": [{"sha": "007598f98beabc445971351a4d6c60054f089491", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/007598f98beabc445971351a4d6c60054f089491", "html_url": "https://github.com/Rust-GCC/gccrs/commit/007598f98beabc445971351a4d6c60054f089491"}], "stats": {"total": 36, "additions": 31, "deletions": 5}, "files": [{"sha": "fc88dc39dd1207aae049ada1914e57e87e70f617", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/973a648b87fcb026397eaf72264b996cb314b8b3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/973a648b87fcb026397eaf72264b996cb314b8b3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=973a648b87fcb026397eaf72264b996cb314b8b3", "patch": "@@ -1,3 +1,10 @@\n+Fri Sep 10 14:04:07 1999  Richard Henderson  <rth@cygnus.com>\n+\n+\t* builtins.c (expand_builtin_va_arg): Cope with an array-type\n+\tva_list decomposing to pointer-type.\n+\t* rs6000.c (rs6000_va_start) Unwrap the ARRAY_TYPE to get at fields.\n+\t(rs6000_va_arg): Likewise.\n+\n Fri Sep 10 13:21:21 1999  Jim Wilson  <wilson@cygnus.com>\n \n \t* except.c (start_dynamic_handler): Compute size using"}, {"sha": "a77b0f860a62f92aeb649d2f055a4f22dba7937d", "filename": "gcc/builtins.c", "status": "modified", "additions": 22, "deletions": 3, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/973a648b87fcb026397eaf72264b996cb314b8b3/gcc%2Fbuiltins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/973a648b87fcb026397eaf72264b996cb314b8b3/gcc%2Fbuiltins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.c?ref=973a648b87fcb026397eaf72264b996cb314b8b3", "patch": "@@ -1974,14 +1974,33 @@ expand_builtin_va_arg (valist, type)\n      tree valist, type;\n {\n   rtx addr, result;\n-  tree promoted_type;\n+  tree promoted_type, want_va_type, have_va_type;\n \n-  if (TYPE_MAIN_VARIANT (TREE_TYPE (valist))\n-      != TYPE_MAIN_VARIANT (va_list_type_node))\n+  /* Verify that valist is of the proper type.  */\n+\n+  want_va_type = va_list_type_node;\n+  have_va_type = TREE_TYPE (valist);\n+  if (TREE_CODE (want_va_type) == ARRAY_TYPE)\n+    {\n+      /* If va_list is an array type, the argument may have decayed \n+\t to a pointer type, e.g. by being passed to another function.\n+         In that case, unwrap both types so that we can compare the\n+\t underlying records.  */\n+      if (TREE_CODE (have_va_type) == ARRAY_TYPE\n+\t  || TREE_CODE (have_va_type) == POINTER_TYPE)\n+\t{\n+\t  want_va_type = TREE_TYPE (want_va_type);\n+\t  have_va_type = TREE_TYPE (have_va_type);\n+\t}\n+    }\n+  if (TYPE_MAIN_VARIANT (want_va_type) != TYPE_MAIN_VARIANT (have_va_type))\n     {\n       error (\"first argument to `va_arg' not of type `va_list'\");\n       addr = const0_rtx;\n     }\n+\n+  /* Generate a diagnostic for requesting data of a type that cannot\n+     be passed through `...' due to type promotion at the call site.  */\n   else if ((promoted_type = (*lang_type_promotes_to) (type)) != NULL_TREE)\n     {\n       const char *name = \"<anonymous type>\", *pname;"}, {"sha": "edc986168e38bcc5ab6e0779678ac927ac212900", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/973a648b87fcb026397eaf72264b996cb314b8b3/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/973a648b87fcb026397eaf72264b996cb314b8b3/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=973a648b87fcb026397eaf72264b996cb314b8b3", "patch": "@@ -1828,7 +1828,7 @@ rs6000_va_start (stdarg_p, valist, nextarg)\n       return;\n     }\n \n-  f_gpr = TYPE_FIELDS (va_list_type_node);\n+  f_gpr = TYPE_FIELDS (TREE_TYPE (va_list_type_node));\n   f_fpr = TREE_CHAIN (f_gpr);\n   f_ovf = TREE_CHAIN (f_fpr);\n   f_sav = TREE_CHAIN (f_ovf);\n@@ -1888,7 +1888,7 @@ rs6000_va_arg (valist, type)\n   if (DEFAULT_ABI != ABI_V4 && DEFAULT_ABI != ABI_SOLARIS)\n     return std_expand_builtin_va_arg (valist, type);\n \n-  f_gpr = TYPE_FIELDS (va_list_type_node);\n+  f_gpr = TYPE_FIELDS (TREE_TYPE (va_list_type_node));\n   f_fpr = TREE_CHAIN (f_gpr);\n   f_ovf = TREE_CHAIN (f_fpr);\n   f_sav = TREE_CHAIN (f_ovf);"}]}