{"sha": "0766660bf94087754e89959cb4b1f27660f30afe", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDc2NjY2MGJmOTQwODc3NTRlODk5NTljYjRiMWYyNzY2MGYzMGFmZQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2015-11-19T22:05:03Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2015-11-19T22:05:03Z"}, "message": "nvptx.h (SUPPORTS_WEAK): Define.\n\n\tgcc/\n\t* config/nvptx/nvptx.h (SUPPORTS_WEAK): Define.\n\t* config/nvptx/nvptx.c (nvptx_write_function_decl): Support\n\tDECL_WEAK.\n\t(nvptx_declare_objec_name): Likewise.\n\n\tgcc/testsuite/\n\t* lib/target-supports.exp (check_weak_available): Add nvptx-*-*.\n\t* gcc.dg/attr-weakref-1.c: Skip for nvptx-*-*\n\t* gcc.dg/special/weak-2.c: Likewise.\n\t* gcc.dg/weak/weak-12.c: Likewise.\n\t* gcc.dg/weak/weak-15.c: Likewise.\n\t* gcc.dg/weak/weak-16.c: Likewise.\n\t* gcc.dg/weak/weak-1.c: Likewise.\n\t* gcc.dg/weak/weak-2.c: Likewise.\n\t* gcc.dg/weak/weak-4.c: Likewise.\n\t* gcc.dg/torture/pr53922.c: Likewise.\n\t* gcc.dg/torture/pr60092.c: Likewise.\n\nFrom-SVN: r230628", "tree": {"sha": "9b58207fedab59f51a80435e8b38056177fd0b25", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9b58207fedab59f51a80435e8b38056177fd0b25"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0766660bf94087754e89959cb4b1f27660f30afe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0766660bf94087754e89959cb4b1f27660f30afe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0766660bf94087754e89959cb4b1f27660f30afe", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0766660bf94087754e89959cb4b1f27660f30afe/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "433068ccab80943a0b1dac0fff62d0cfc5c50acb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/433068ccab80943a0b1dac0fff62d0cfc5c50acb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/433068ccab80943a0b1dac0fff62d0cfc5c50acb"}], "stats": {"total": 59, "additions": 54, "deletions": 5}, "files": [{"sha": "5fd82d2353f864fe62ff36c48fa4cf59bcc535eb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0766660bf94087754e89959cb4b1f27660f30afe", "patch": "@@ -1,3 +1,10 @@\n+2015-11-19  Nathan Sidwell  <nathan@acm.org>\n+\n+\t* config/nvptx/nvptx.h (SUPPORTS_WEAK): Define.\n+\t* config/nvptx/nvptx.c (nvptx_write_function_decl): Support\n+\tDECL_WEAK.\n+\t(nvptx_declare_objec_name): Likewise.\n+\n 2015-11-19  Aditya Kumar  <aditya.k7@samsung.com>\n \n \t* graphite-isl-ast-to-gimple.c (get_true_edge_from_guard_bb): Move..."}, {"sha": "044f545378477811418356caa0a35c701bdeeaa5", "filename": "gcc/config/nvptx/nvptx.c", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Fconfig%2Fnvptx%2Fnvptx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Fconfig%2Fnvptx%2Fnvptx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Fnvptx.c?ref=0766660bf94087754e89959cb4b1f27660f30afe", "patch": "@@ -379,7 +379,7 @@ nvptx_write_function_decl (std::stringstream &s, const char *name, const_tree de\n   if (DECL_EXTERNAL (decl))\n     s << \".extern \";\n   else if (TREE_PUBLIC (decl))\n-    s << \".visible \";\n+    s << (DECL_WEAK (decl) ? \".weak \" : \".visible \");\n \n   if (kernel)\n     s << \".entry \";\n@@ -1780,8 +1780,9 @@ nvptx_declare_object_name (FILE *file, const char *name, const_tree decl)\n       size = tree_to_uhwi (DECL_SIZE_UNIT (decl));\n       const char *section = nvptx_section_for_decl (decl);\n       fprintf (file, \"\\t%s%s .align %d .u%d \",\n-\t       TREE_PUBLIC (decl) ? \" .visible\" : \"\", section,\n-\t       DECL_ALIGN (decl) / BITS_PER_UNIT,\n+\t       !TREE_PUBLIC (decl) ? \"\"\n+\t       : DECL_WEAK (decl) ? \".weak\" : \".visible\",\n+\t       section, DECL_ALIGN (decl) / BITS_PER_UNIT,\n \t       decl_chunk_size * BITS_PER_UNIT);\n       assemble_name (file, name);\n       if (size > 0)"}, {"sha": "1a497be2b3fd52096b18d04881fb9bd1e6d4ea02", "filename": "gcc/config/nvptx/nvptx.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Fconfig%2Fnvptx%2Fnvptx.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Fconfig%2Fnvptx%2Fnvptx.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Fnvptx.h?ref=0766660bf94087754e89959cb4b1f27660f30afe", "patch": "@@ -349,6 +349,7 @@ struct GTY(()) machine_function\n #define CTZ_DEFINED_VALUE_AT_ZERO(MODE, VALUE) \\\n   ((VALUE) = GET_MODE_BITSIZE ((MODE)), 2)\n \n+#define SUPPORTS_WEAK 1\n #define NO_DOT_IN_LABEL\n #define ASM_COMMENT_START \"//\"\n "}, {"sha": "ebfe4f9fd709ccd1a39ce4f50aa043f2d51e7594", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0766660bf94087754e89959cb4b1f27660f30afe", "patch": "@@ -1,3 +1,17 @@\n+2015-11-19  Nathan Sidwell  <nathan@acm.org>\n+\n+\t* lib/target-supports.exp (check_weak_available): Add nvptx-*-*.\n+\t* gcc.dg/attr-weakref-1.c: Skip for nvptx-*-*\n+\t* gcc.dg/special/weak-2.c: Likewise.\n+\t* gcc.dg/weak/weak-12.c: Likewise.\n+\t* gcc.dg/weak/weak-15.c: Likewise.\n+\t* gcc.dg/weak/weak-16.c: Likewise.\n+\t* gcc.dg/weak/weak-1.c: Likewise.\n+\t* gcc.dg/weak/weak-2.c: Likewise.\n+\t* gcc.dg/weak/weak-4.c: Likewise.\n+\t* gcc.dg/torture/pr53922.c: Likewise.\n+\t* gcc.dg/torture/pr60092.c: Likewise.\n+\n 2015-11-19  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/68412"}, {"sha": "d327b40984fbe794fd0e53ddb744a38170911ed3", "filename": "gcc/testsuite/gcc.dg/attr-weakref-1.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-weakref-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-weakref-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-weakref-1.c?ref=0766660bf94087754e89959cb4b1f27660f30afe", "patch": "@@ -1,10 +1,12 @@\n // { dg-do run }\n // { dg-require-weak \"\" }\n // On darwin, we use attr-weakref-1-darwin.c.\n+\n // This test requires support for undefined weak symbols.  This support\n-// is not available on hppa*-*-hpux*.  The test is skipped rather than\n+// is not available on the following targets.  The test is skipped rather than\n // xfailed to suppress the warning that would otherwise arise.\n-// { dg-skip-if \"\" { \"hppa*-*-hpux*\" \"*-*-aix*\" } \"*\" { \"\" } }\n+// { dg-skip-if \"\" { \"hppa*-*-hpux*\" \"*-*-aix*\" \"nvptx-*-*\" } \"*\" { \"\" } }\n+\n // For kernel modules and static RTPs, the loader treats undefined weak\n // symbols in the same way as undefined strong symbols.  The test\n // therefore fails to load, so skip it."}, {"sha": "91a92e6ccc5dfb3393ac6b0c8b7fe55e1afac7d0", "filename": "gcc/testsuite/gcc.dg/special/weak-2.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Fspecial%2Fweak-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Fspecial%2Fweak-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fspecial%2Fweak-2.c?ref=0766660bf94087754e89959cb4b1f27660f30afe", "patch": "@@ -2,6 +2,10 @@\n /* { dg-require-weak \"\" } */\n /* { dg-additional-sources \"weak-2a.c weak-2b.c\" } */\n \n+/* NVPTX's implementation of weak is broken when a strong symbol is in\n+   a later object file than the weak definition.   */\n+/* { dg-skip-if \"\" { \"nvptx-*-*\" } \"*\" { \"\" } } */\n+\n #include <stdlib.h>\n \n extern int foo(void);"}, {"sha": "fac054d9ce3f03f65c2ee1c07da0e10da3840642", "filename": "gcc/testsuite/gcc.dg/torture/pr53922.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr53922.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr53922.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr53922.c?ref=0766660bf94087754e89959cb4b1f27660f30afe", "patch": "@@ -3,6 +3,7 @@\n /* { dg-skip-if \"No undefined\" { *-*-mingw* } { \"*\" } { \"\" } } */\n /* { dg-skip-if \"No undefined weak\" { *-*-aix* } { \"*\" } { \"\" } } */\n /* { dg-skip-if \"No undefined weak\" { hppa*-*-hpux* && { ! lp64 } } { \"*\" } { \"\" } } */\n+/* { dg-skip-if \"No undefined weak\" { nvptx-*-* } { \"*\" } { \"\" } } */\n /* { dg-options \"-Wl,-undefined,dynamic_lookup\" { target *-*-darwin* } } */\n /* { dg-additional-options \"-Wl,-flat_namespace\" { target *-*-darwin[89]* } } */\n "}, {"sha": "d66e3f2444e80fad19bc10350659facf82900d82", "filename": "gcc/testsuite/gcc.dg/torture/pr60092.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr60092.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr60092.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr60092.c?ref=0766660bf94087754e89959cb4b1f27660f30afe", "patch": "@@ -1,6 +1,7 @@\n /* { dg-do run } */\n /* { dg-require-weak \"\" } */\n /* { dg-skip-if \"No undefined weak\" { hppa*-*-hpux* && { ! lp64 } } } */\n+/* { dg-skip-if \"No undefined weak\" { nvptx-*-* } { \"*\" } { \"\" } } */\n /* { dg-additional-options \"-Wl,-undefined,dynamic_lookup\" { target *-*-darwin* } } */\n /* { dg-additional-options \"-Wl,-flat_namespace\" { target *-*-darwin[89]* } } */\n /* { dg-xfail-run-if \"posix_memalign modifies first arg on error\" { *-*-solaris2.11* } { \"-O0\" } } */"}, {"sha": "dc34079b6501ae20da5f6b9b2416b31131e05ddd", "filename": "gcc/testsuite/gcc.dg/weak/weak-1.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-1.c?ref=0766660bf94087754e89959cb4b1f27660f30afe", "patch": "@@ -2,6 +2,8 @@\n /* { dg-require-weak \"\" } */\n /* { dg-options \"-fno-common\" } */\n /* { dg-skip-if \"\" { *-*-mingw* } { \"*\" } { \"\" } } */\n+/* NVPTX's definition of weak looks different to normal.  */\n+/* { dg-skip-if \"\" { nvptx-*-* } { \"*\" } { \"\" } } */\n \n /* { dg-final { scan-assembler \"weak\\[^ \\t\\]*\\[ \\t\\]_?a\" } } */\n /* { dg-final { scan-assembler \"weak\\[^ \\t\\]*\\[ \\t\\]_?b\" } } */"}, {"sha": "72f8991cc9826ee124d8711f1bec04c4d7f9cf81", "filename": "gcc/testsuite/gcc.dg/weak/weak-12.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-12.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-12.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-12.c?ref=0766660bf94087754e89959cb4b1f27660f30afe", "patch": "@@ -2,6 +2,8 @@\n /* { dg-do compile } */\n /* { dg-require-weak \"\" } */\n /* { dg-options \"\" } */\n+/* NVPTX's weak is applied to the definition,  not declaration.  */\n+/* { dg-skip-if \"\" { nvptx-*-* } { \"*\" } { \"\" } } */\n \n /* { dg-final { scan-assembler \"weak\\[^ \\t\\]*\\[ \\t\\]_?foo\" } } */\n "}, {"sha": "d656d21858017f1a7cc075602f335a0f8448e54c", "filename": "gcc/testsuite/gcc.dg/weak/weak-15.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-15.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-15.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-15.c?ref=0766660bf94087754e89959cb4b1f27660f30afe", "patch": "@@ -2,6 +2,8 @@\n /* { dg-require-weak \"\" } */\n /* { dg-options \"-fno-common\" } */\n /* { dg-skip-if \"\" { x86_64-*-mingw* } { \"*\" } { \"\" } } */\n+/* NVPTX's weak is applied to the definition,  not declaration.  */\n+/* { dg-skip-if \"\" { nvptx-*-* } { \"*\" } { \"\" } } */\n \n /* { dg-final { scan-assembler \"weak\\[^ \\t\\]*\\[ \\t\\]_?a\" } } */\n /* { dg-final { scan-assembler-not \"weak\\[^ \\t\\]*\\[ \\t\\]_?b\" } } */"}, {"sha": "b1a08eadb09f344002a4709e08218f48b70cce38", "filename": "gcc/testsuite/gcc.dg/weak/weak-16.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-16.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-16.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-16.c?ref=0766660bf94087754e89959cb4b1f27660f30afe", "patch": "@@ -5,6 +5,8 @@\n /* { dg-final { scan-assembler \"weak\\[^ \\t\\]*\\[ \\t\\]_?kallsyms_token_index\" } } */\n /* { dg-final { scan-assembler \"weak\\[^ \\t\\]*\\[ \\t\\]_?kallsyms_token_table\" } } */\n /* { dg-skip-if \"\" { x86_64-*-mingw* } { \"*\" } { \"\" } } */\n+/* NVPTX's weak is applied to the definition,  not declaration.  */\n+/* { dg-skip-if \"\" { nvptx-*-* } { \"*\" } { \"\" } } */\n \n extern int kallsyms_token_index[] __attribute__((weak));\n extern int kallsyms_token_table[] __attribute__((weak));"}, {"sha": "cad6e7b166d4f8eccf696b6f1fde9fe9c9f259ca", "filename": "gcc/testsuite/gcc.dg/weak/weak-2.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-2.c?ref=0766660bf94087754e89959cb4b1f27660f30afe", "patch": "@@ -2,6 +2,8 @@\n /* { dg-require-weak \"\" } */\n /* { dg-options \"-fno-common\" } */\n /* { dg-skip-if \"\" { x86_64-*-mingw* } { \"*\" } { \"\" } } */\n+/* NVPTX's definition of weak looks different to normal.  */\n+/* { dg-skip-if \"\" { nvptx-*-* } { \"*\" } { \"\" } } */\n \n /* { dg-final { scan-assembler \"weak\\[^ \\t\\]*\\[ \\t\\]_?ffoo1a\" } } */\n /* { dg-final { scan-assembler \"weak\\[^ \\t\\]*\\[ \\t\\]_?ffoo1b\" } } */"}, {"sha": "d2d0e68b403caccb82515bfea5b005de63db668d", "filename": "gcc/testsuite/gcc.dg/weak/weak-4.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fweak%2Fweak-4.c?ref=0766660bf94087754e89959cb4b1f27660f30afe", "patch": "@@ -2,6 +2,8 @@\n /* { dg-require-weak \"\" } */\n /* { dg-options \"-fno-common\" } */\n /* { dg-skip-if \"\" { x86_64-*-mingw* } { \"*\" } { \"\" } } */\n+/* NVPTX's definition of weak looks different to normal.  */\n+/* { dg-skip-if \"\" { nvptx-*-* } { \"*\" } { \"\" } } */\n \n /* { dg-final { scan-assembler \"weak\\[^ \\t\\]*\\[ \\t\\]_?vfoo1a\" } } */\n /* { dg-final { scan-assembler \"weak\\[^ \\t\\]*\\[ \\t\\]_?vfoo1b\" } } */"}, {"sha": "66fc10019c5308164d4c02501c73421bc8478214", "filename": "gcc/testsuite/lib/target-supports.exp", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0766660bf94087754e89959cb4b1f27660f30afe/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp?ref=0766660bf94087754e89959cb4b1f27660f30afe", "patch": "@@ -292,6 +292,12 @@ proc check_weak_available { } {\n \treturn 0\n     }\n \n+    # nvptx (nearly) supports it\n+\n+    if { [istarget nvptx-*-*] } {\n+\treturn 1\n+    }\n+\n     # ELF and ECOFF support it. a.out does with gas/gld but may also with\n     # other linkers, so we should try it\n "}]}