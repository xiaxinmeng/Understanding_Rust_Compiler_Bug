{"sha": "b67bc44c269f315287544ab501aa91b9cdc7bd4f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjY3YmM0NGMyNjlmMzE1Mjg3NTQ0YWI1MDFhYTkxYjljZGM3YmQ0Zg==", "commit": {"author": {"name": "Nicola Pero", "email": "nicola.pero@meta-innovation.com", "date": "2010-10-06T22:07:08Z"}, "committer": {"name": "Nicola Pero", "email": "nicola@gcc.gnu.org", "date": "2010-10-06T22:07:08Z"}, "message": "In gcc/cp/: 2010-10-06 Nicola Pero <nicola.pero@meta-innovation.com>\n\nIn gcc/cp/:\n2010-10-06  Nicola Pero  <nicola.pero@meta-innovation.com>\n\n        Merge from apple/trunk branch on FSF servers.\n        * cp-tree.def: Added AT_ENCODE_EXPR here instead of to the no\n        longer existing gcc/c-common.def.\n        \n        2005-12-14  Fariborz Jahanian <fjahanian@apple.com>\n\n        Radar 4278774\n        * pt.c (tsubst_copy_and_build): Instantiate @endcode(T).\n        * parser.c (cp_parser_objc_encode_expression): Build a templatized \n        parse tree for @encode(T).\n\n        2005-12-14  Fariborz Jahanian <fjahanian@apple.com>\n\n        Radar 4278774\n        * c-common.def: Add new expression code AT_ENCODE_EXPR.\n        \nIn gcc/testsuite/:\n2010-10-06  Nicola Pero  <nicola.pero@meta-innovation.com>\n\n        Merge from 'apple/trunk' branch on FSF servers.\n        \n        2005-12-14  Fariborz Jahanian <fjahanian@apple.com>\n\n        Radar 4278774\n        * obj-c++.dg/encode-9.mm: New.\n\nFrom-SVN: r165067", "tree": {"sha": "f630788a4a59144e2b1ebfe49c7d13711afac1e9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f630788a4a59144e2b1ebfe49c7d13711afac1e9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b67bc44c269f315287544ab501aa91b9cdc7bd4f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b67bc44c269f315287544ab501aa91b9cdc7bd4f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b67bc44c269f315287544ab501aa91b9cdc7bd4f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b67bc44c269f315287544ab501aa91b9cdc7bd4f/comments", "author": {"login": "Nico-31415", "id": 94470564, "node_id": "U_kgDOBaGBpA", "avatar_url": "https://avatars.githubusercontent.com/u/94470564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nico-31415", "html_url": "https://github.com/Nico-31415", "followers_url": "https://api.github.com/users/Nico-31415/followers", "following_url": "https://api.github.com/users/Nico-31415/following{/other_user}", "gists_url": "https://api.github.com/users/Nico-31415/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nico-31415/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nico-31415/subscriptions", "organizations_url": "https://api.github.com/users/Nico-31415/orgs", "repos_url": "https://api.github.com/users/Nico-31415/repos", "events_url": "https://api.github.com/users/Nico-31415/events{/privacy}", "received_events_url": "https://api.github.com/users/Nico-31415/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6e9bd0f8983779325b34a9645c2634dafd14d3c9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e9bd0f8983779325b34a9645c2634dafd14d3c9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6e9bd0f8983779325b34a9645c2634dafd14d3c9"}], "stats": {"total": 77, "additions": 77, "deletions": 0}, "files": [{"sha": "6219f041484dcb55da79cd13caac73b04285ff8a", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b67bc44c269f315287544ab501aa91b9cdc7bd4f/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b67bc44c269f315287544ab501aa91b9cdc7bd4f/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=b67bc44c269f315287544ab501aa91b9cdc7bd4f", "patch": "@@ -1,3 +1,21 @@\n+2010-10-06  Nicola Pero  <nicola.pero@meta-innovation.com>\n+\n+\tMerge from apple/trunk branch on FSF servers.\n+\t* cp-tree.def: Added AT_ENCODE_EXPR here instead of to the no\n+\tlonger existing gcc/c-common.def.\n+\t\n+\t2005-12-14  Fariborz Jahanian <fjahanian@apple.com>\n+\n+\tRadar 4278774\n+\t* pt.c (tsubst_copy_and_build): Instantiate @endcode(T).\n+\t* parser.c (cp_parser_objc_encode_expression): Build a templatized \n+\tparse tree for @encode(T).\n+\n+\t2005-12-14  Fariborz Jahanian <fjahanian@apple.com>\n+\n+\tRadar 4278774\n+\t* c-common.def: Add new expression code AT_ENCODE_EXPR.\n+\t\n 2010-10-06  Eric Botcazou  <ebotcazou@adacore.com>\n \n \tPR c++/45908"}, {"sha": "1065c80f6cffd36c60d0d1f879dfeaa9044ef38f", "filename": "gcc/cp/cp-tree.def", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b67bc44c269f315287544ab501aa91b9cdc7bd4f/gcc%2Fcp%2Fcp-tree.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b67bc44c269f315287544ab501aa91b9cdc7bd4f/gcc%2Fcp%2Fcp-tree.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.def?ref=b67bc44c269f315287544ab501aa91b9cdc7bd4f", "patch": "@@ -335,6 +335,10 @@ DEFTREECODE (ARROW_EXPR, \"arrow_expr\", tcc_expression, 1)\n    expansion.  */\n DEFTREECODE (ALIGNOF_EXPR, \"alignof_expr\", tcc_expression, 1)\n \n+/* Represents an Objective-C++ '@encode' expression during template\n+   expansion.  */\n+DEFTREECODE (AT_ENCODE_EXPR, \"at_encode_expr\", tcc_unary, 1)\n+\n /* A STMT_EXPR represents a statement-expression during template\n    expansion.  This is the GCC extension { ( ... ) }.  The\n    STMT_EXPR_STMT is the statement given by the expression.  */"}, {"sha": "7e251570753252923231f0789cbffc96452f9887", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b67bc44c269f315287544ab501aa91b9cdc7bd4f/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b67bc44c269f315287544ab501aa91b9cdc7bd4f/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=b67bc44c269f315287544ab501aa91b9cdc7bd4f", "patch": "@@ -21128,6 +21128,13 @@ cp_parser_objc_encode_expression (cp_parser* parser)\n       return error_mark_node;\n     }\n \n+  if (dependent_type_p (type))\n+    {\n+      tree value = build_min (AT_ENCODE_EXPR, size_type_node, type);\n+      TREE_READONLY (value) = 1;\n+      return value;\n+    }\n+\n   return objc_build_encode_expr (type);\n }\n "}, {"sha": "506bf9ad3879a9d3b5a14af0ba622541cef32079", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b67bc44c269f315287544ab501aa91b9cdc7bd4f/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b67bc44c269f315287544ab501aa91b9cdc7bd4f/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=b67bc44c269f315287544ab501aa91b9cdc7bd4f", "patch": "@@ -12359,6 +12359,19 @@ tsubst_copy_and_build (tree t,\n \treturn cxx_sizeof_or_alignof_expr (op1, TREE_CODE (t), \n                                            complain & tf_error);\n \n+    case AT_ENCODE_EXPR:\n+      {\n+\top1 = TREE_OPERAND (t, 0);\n+\t++cp_unevaluated_operand;\n+\t++c_inhibit_evaluation_warnings;\n+\top1 = tsubst_copy_and_build (op1, args, complain, in_decl,\n+\t\t\t\t     /*function_p=*/false,\n+\t\t\t\t     /*integral_constant_expression_p=*/false);\n+\t--cp_unevaluated_operand;\n+\t--c_inhibit_evaluation_warnings;\n+\treturn objc_build_encode_expr (op1);\n+      }\n+\n     case NOEXCEPT_EXPR:\n       op1 = TREE_OPERAND (t, 0);\n       ++cp_unevaluated_operand;"}, {"sha": "23919a3cb5943504525ffb61f7fb4d000d763581", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b67bc44c269f315287544ab501aa91b9cdc7bd4f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b67bc44c269f315287544ab501aa91b9cdc7bd4f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b67bc44c269f315287544ab501aa91b9cdc7bd4f", "patch": "@@ -1,3 +1,12 @@\n+2010-10-06  Nicola Pero  <nicola.pero@meta-innovation.com>\n+\n+\tMerge from 'apple/trunk' branch on FSF servers.\n+\t\n+\t2005-12-14  Fariborz Jahanian <fjahanian@apple.com>\n+\n+\tRadar 4278774\n+\t* obj-c++.dg/encode-9.mm: New.\n+\t\n 2010-10-06  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* g++.dg/cpp0x/pr45908.C: New test."}, {"sha": "6b064dfdc09d1ea6aef94bc55776890ce30e7cbe", "filename": "gcc/testsuite/obj-c++.dg/encode-9.mm", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b67bc44c269f315287544ab501aa91b9cdc7bd4f/gcc%2Ftestsuite%2Fobj-c%2B%2B.dg%2Fencode-9.mm", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b67bc44c269f315287544ab501aa91b9cdc7bd4f/gcc%2Ftestsuite%2Fobj-c%2B%2B.dg%2Fencode-9.mm", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fobj-c%2B%2B.dg%2Fencode-9.mm?ref=b67bc44c269f315287544ab501aa91b9cdc7bd4f", "patch": "@@ -0,0 +1,26 @@\n+/* Test than @encode is properly instantiated. */\n+/* { dg-options \"-lobjc\" } */\n+/* { dg-do run } */\n+\n+#include <string.h>           \n+#include <stdlib.h>\n+#include <objc/objc.h>\n+\n+template<typename T>\n+class typeOf {\n+public:\n+    operator const char*() { return @encode(T); }\n+};\n+\n+int main() {\n+    typeOf<int> t;\n+    if (strcmp ((const char *)t, @encode(int)))\n+      abort();\n+\n+    typeOf<const char*> c;\n+    if (strcmp ((const char *)c, @encode(const char*)))\n+      abort();\n+\n+    return 0;\n+}\n+"}]}