{"sha": "5a15be975d24835b9aa9c743c75235adf58ff8f6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWExNWJlOTc1ZDI0ODM1YjlhYTljNzQzYzc1MjM1YWRmNThmZjhmNg==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2016-03-15T11:51:32Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2016-03-15T11:51:32Z"}, "message": "Fix fdump-ipa-all-graph\n\n2016-03-15  Tom de Vries  <tom@codesourcery.com>\n\n\tPR ipa/70161\n\t* cgraph.c (cgraph_node::get_body): Save, reset and restore\n\tdump_file_name.\n\t* passes.c (execute_one_ipa_transform_pass): Add missing argument to\n\texecute_function_dump.\n\t(execute_one_pass): Don't dump function if it will be dumped after ipa\n\ttransform.\n\nFrom-SVN: r234211", "tree": {"sha": "0bb95f7c43d8ad73e0d43270e605c586b2eeece3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0bb95f7c43d8ad73e0d43270e605c586b2eeece3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5a15be975d24835b9aa9c743c75235adf58ff8f6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5a15be975d24835b9aa9c743c75235adf58ff8f6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5a15be975d24835b9aa9c743c75235adf58ff8f6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5a15be975d24835b9aa9c743c75235adf58ff8f6/comments", "author": null, "committer": null, "parents": [{"sha": "3ea33585de3d2b26f65dab8df27b5046981964a7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ea33585de3d2b26f65dab8df27b5046981964a7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3ea33585de3d2b26f65dab8df27b5046981964a7"}], "stats": {"total": 27, "additions": 20, "deletions": 7}, "files": [{"sha": "3b4bdd408451e8da110cbdd15b60278b3084c953", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5a15be975d24835b9aa9c743c75235adf58ff8f6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5a15be975d24835b9aa9c743c75235adf58ff8f6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5a15be975d24835b9aa9c743c75235adf58ff8f6", "patch": "@@ -1,3 +1,13 @@\n+2016-03-15  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR ipa/70161\n+\t* cgraph.c (cgraph_node::get_body): Save, reset and restore\n+\tdump_file_name.\n+\t* passes.c (execute_one_ipa_transform_pass): Add missing argument to\n+\texecute_function_dump.\n+\t(execute_one_pass): Don't dump function if it will be dumped after ipa\n+\ttransform.\n+\n 2016-03-15  Segher Boessenkool  <segher@kernel.crashing.org>\n \n \t* genrecog.c (match_pattern_2): If pred is NULL don't call"}, {"sha": "518ef24c54d1067f30d21ce58bbb9bb46b6e9949", "filename": "gcc/cgraph.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5a15be975d24835b9aa9c743c75235adf58ff8f6/gcc%2Fcgraph.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5a15be975d24835b9aa9c743c75235adf58ff8f6/gcc%2Fcgraph.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.c?ref=5a15be975d24835b9aa9c743c75235adf58ff8f6", "patch": "@@ -3369,7 +3369,9 @@ cgraph_node::get_body (void)\n     {\n       opt_pass *saved_current_pass = current_pass;\n       FILE *saved_dump_file = dump_file;\n+      const char *saved_dump_file_name = dump_file_name;\n       int saved_dump_flags = dump_flags;\n+      dump_file_name = NULL;\n \n       push_cfun (DECL_STRUCT_FUNCTION (decl));\n       execute_all_ipa_transforms ();\n@@ -3381,6 +3383,7 @@ cgraph_node::get_body (void)\n \n       current_pass = saved_current_pass;\n       dump_file = saved_dump_file;\n+      dump_file_name = saved_dump_file_name;\n       dump_flags = saved_dump_flags;\n     }\n   return updated;"}, {"sha": "9d9025116f4666be44e3cb081f38e88bcced97c6", "filename": "gcc/passes.c", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5a15be975d24835b9aa9c743c75235adf58ff8f6/gcc%2Fpasses.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5a15be975d24835b9aa9c743c75235adf58ff8f6/gcc%2Fpasses.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpasses.c?ref=5a15be975d24835b9aa9c743c75235adf58ff8f6", "patch": "@@ -2214,7 +2214,7 @@ execute_one_ipa_transform_pass (struct cgraph_node *node,\n     check_profile_consistency (pass->static_pass_number, 1, true);\n \n   if (dump_file)\n-    do_per_function (execute_function_dump, NULL);\n+    do_per_function (execute_function_dump, pass);\n   pass_fini_dump_file (pass);\n \n   current_pass = NULL;\n@@ -2351,15 +2351,15 @@ execute_one_pass (opt_pass *pass)\n     check_profile_consistency (pass->static_pass_number, 1, true);\n \n   verify_interpass_invariants ();\n-  if (dump_file)\n-    do_per_function (execute_function_dump, pass);\n-  if (pass->type == IPA_PASS)\n+  if (pass->type == IPA_PASS\n+      && ((ipa_opt_pass_d *)pass)->function_transform)\n     {\n       struct cgraph_node *node;\n-      if (((ipa_opt_pass_d *)pass)->function_transform)\n-\tFOR_EACH_FUNCTION_WITH_GIMPLE_BODY (node)\n-\t  node->ipa_transforms_to_apply.safe_push ((ipa_opt_pass_d *)pass);\n+      FOR_EACH_FUNCTION_WITH_GIMPLE_BODY (node)\n+\tnode->ipa_transforms_to_apply.safe_push ((ipa_opt_pass_d *)pass);\n     }\n+  else if (dump_file)\n+    do_per_function (execute_function_dump, pass);\n \n   if (!current_function_decl)\n     symtab->process_new_functions ();"}]}