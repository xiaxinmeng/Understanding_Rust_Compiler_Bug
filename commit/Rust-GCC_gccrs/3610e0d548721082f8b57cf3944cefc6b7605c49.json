{"sha": "3610e0d548721082f8b57cf3944cefc6b7605c49", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzYxMGUwZDU0ODcyMTA4MmY4YjU3Y2YzOTQ0Y2VmYzZiNzYwNWM0OQ==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2001-05-24T05:40:37Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2001-05-24T05:40:37Z"}, "message": "[multiple changes]\n\n2001-05-23  Tom Tromey  <tromey@redhat.com>\n\n\t* posix-threads.cc (_Jv_self_cache): Renamed from self_cache.\n\t* gcj/Makefile.in: Rebuilt.\n\t* gcj/Makefile.am (gcj_HEADERS): Added libgcj-config.h.\n\t* gcj/javaprims.h: Include gcj/libgcj-config.h.\n\t* gcj/libgcj-config.h.in: New file.\n\t* libgcj.spec.in (*jc1): Added @HASH_SYNC_SPEC@.\n\t* configure: Rebuilt.\n\t* configure.in: Enable hash synchronization by default on some\n\tplatforms.\n\t(HASH_SYNC_SPEC): New subst.\n\t(AC_CONFIG_HEADER): Added gcj/libgcj-config.h.\n\tCorrectly use `test -z' instead of `test -n' in a couple places.\n\t(JV_HASH_SYNCHRONIZATION): Use AC_DEFINE; don't add to\n\tLIBGCJ_CXXFLAGS.\n\t* configure.host (enable_java_net_default): Initialize.\n\t(enable_hash_synchronization_default): New variable.\n\n2001-05-23  Hans Boehm <Hans_Boehm@hp.com>\n\n\t* boehm.cc (_Jv_MarkObj): Don't mark sync_info when hash\n\tsynchronization in use.\n\t(_Jv_MarkArray): Likewise.\n\t(_Jv_AllocBytes): Don't check return result.\n\t(handle_out_of_memory): New function.\n\t(_Jv_InitGC): Set GC_oom_fn.\n\t(trace_one_vtable): New global.\n\t(_Jv_AllocTraceOne): New function.\n\t* configure.in: Added --enable-hash-synchronization.\n\t* defineclass.cc, prims.cc, resolve.cc, java/lang/natString.cc,\n\tjava/net/natInetAddress.cc: Remove _Jv_AllocBytesChecked.\n\t* nogc.cc (_Jv_AllocObj): Throw out-of-memory.\n\t(_Jv_AllocArray): Likewise.\n\t(_Jv_AllocBytes): Likewise.\n\t(_Jv_AllocPtrFreeObject): New function.\n\t(_Jv_AllocTraceOne): Likewise.\n\t* posix-threads.cc (_Jv_ThreadRegister): Handle slow\n\tpthread_self().\n\t(self_cache): New global.\n\t(_Jv_ThreadSelf_out_of_line): New function.\n\t* prims.cc (_Jv_AllocBytesChecked): Removed.\n\t(_Jv_ThrowNoMemory): New function.\n\t(_Jv_AllocObject): Don't check for null return from allocator.\n\t(_Jv_NewObjectArray): Likewise.\n\t(_Jv_AllocPtrFreeObject): New function.\n\t(_Jv_NewPrimArray): Allocate pointer-free object if possible.\n\t* include/javaprims.h (_Jv_AllocPtrFreeObject): Declare.\n\t(_Jv_MonitorEnter, _Jv_MonitorExit): Don't return value.\n\t* include/boehm-gc.h (_Jv_AllocObj): Define.\n\t(_Jv_AllocPtrFreeObj): Define.\n\t* include/jvm.h (_Jv_AllocPtrFreeObj): Declare.\n\t(_Jv_ThrowNoMemory): Declare.\n\t(_Jv_AllocTraceOne): Declare.\n\t(_Jv_AllocBytesChecked): Removed.\n\t* include/posix-threads.h (_Jv_MutexInit, _Jv_MutexLock,\n\t_Jv_MutexUnlock): Handle LOCK_DEBUG.\n\t(_Jv_ThreadSelf): Handle case where system pthread_self() is\n\tslow.\n\t* java/lang/Class.h (Class): Declare _Jv_AllocPtrFreeObj as\n\tfriend.\n\t* java/lang/Object.h (sync_info): Conditional upon presence of\n\thash synchronization.\n\t* java/lang/natObject.cc: Much new code to handle thin locks and\n\thash synchronization.\n\t* java/lang/natString.cc (_Jv_AllocString): Allocate pointer-free\n\tobject if possible.\n\nFrom-SVN: r42519", "tree": {"sha": "ee7c6e621432b96c0092733f35d1cc29967a2b97", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ee7c6e621432b96c0092733f35d1cc29967a2b97"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3610e0d548721082f8b57cf3944cefc6b7605c49", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3610e0d548721082f8b57cf3944cefc6b7605c49", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3610e0d548721082f8b57cf3944cefc6b7605c49", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3610e0d548721082f8b57cf3944cefc6b7605c49/comments", "author": null, "committer": null, "parents": [{"sha": "865e0a8389fed526cf9b68b33f7014117f956bca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/865e0a8389fed526cf9b68b33f7014117f956bca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/865e0a8389fed526cf9b68b33f7014117f956bca"}], "stats": {"total": 2318, "additions": 1890, "deletions": 428}, "files": [{"sha": "0dbf84653edc622f9435e536c3988150242324cf", "filename": "libjava/ChangeLog", "status": "modified", "additions": 68, "deletions": 0, "changes": 68, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -1,3 +1,71 @@\n+2001-05-23  Tom Tromey  <tromey@redhat.com>\n+\n+\t* posix-threads.cc (_Jv_self_cache): Renamed from self_cache.\n+\t* gcj/Makefile.in: Rebuilt.\n+\t* gcj/Makefile.am (gcj_HEADERS): Added libgcj-config.h.\n+\t* gcj/javaprims.h: Include gcj/libgcj-config.h.\n+\t* gcj/libgcj-config.h.in: New file.\n+\t* libgcj.spec.in (*jc1): Added @HASH_SYNC_SPEC@.\n+\t* configure: Rebuilt.\n+\t* configure.in: Enable hash synchronization by default on some\n+\tplatforms.\n+\t(HASH_SYNC_SPEC): New subst.\n+\t(AC_CONFIG_HEADER): Added gcj/libgcj-config.h.\n+\tCorrectly use `test -z' instead of `test -n' in a couple places.\n+\t(JV_HASH_SYNCHRONIZATION): Use AC_DEFINE; don't add to\n+\tLIBGCJ_CXXFLAGS.\n+\t* configure.host (enable_java_net_default): Initialize.\n+\t(enable_hash_synchronization_default): New variable.\n+\n+2001-05-23  Hans Boehm <Hans_Boehm@hp.com>\n+\n+\t* boehm.cc (_Jv_MarkObj): Don't mark sync_info when hash\n+\tsynchronization in use.\n+\t(_Jv_MarkArray): Likewise.\n+\t(_Jv_AllocBytes): Don't check return result.\n+\t(handle_out_of_memory): New function.\n+\t(_Jv_InitGC): Set GC_oom_fn.\n+\t(trace_one_vtable): New global.\n+\t(_Jv_AllocTraceOne): New function.\n+\t* configure.in: Added --enable-hash-synchronization.\n+\t* defineclass.cc, prims.cc, resolve.cc, java/lang/natString.cc,\n+\tjava/net/natInetAddress.cc: Remove _Jv_AllocBytesChecked.\n+\t* nogc.cc (_Jv_AllocObj): Throw out-of-memory.\n+\t(_Jv_AllocArray): Likewise.\n+\t(_Jv_AllocBytes): Likewise.\n+\t(_Jv_AllocPtrFreeObject): New function.\n+\t(_Jv_AllocTraceOne): Likewise.\n+\t* posix-threads.cc (_Jv_ThreadRegister): Handle slow\n+\tpthread_self().\n+\t(self_cache): New global.\n+\t(_Jv_ThreadSelf_out_of_line): New function.\n+\t* prims.cc (_Jv_AllocBytesChecked): Removed.\n+\t(_Jv_ThrowNoMemory): New function.\n+\t(_Jv_AllocObject): Don't check for null return from allocator.\n+\t(_Jv_NewObjectArray): Likewise.\n+\t(_Jv_AllocPtrFreeObject): New function.\n+\t(_Jv_NewPrimArray): Allocate pointer-free object if possible.\n+\t* include/javaprims.h (_Jv_AllocPtrFreeObject): Declare.\n+\t(_Jv_MonitorEnter, _Jv_MonitorExit): Don't return value.\n+\t* include/boehm-gc.h (_Jv_AllocObj): Define.\n+\t(_Jv_AllocPtrFreeObj): Define.\n+\t* include/jvm.h (_Jv_AllocPtrFreeObj): Declare.\n+\t(_Jv_ThrowNoMemory): Declare.\n+\t(_Jv_AllocTraceOne): Declare.\n+\t(_Jv_AllocBytesChecked): Removed.\n+\t* include/posix-threads.h (_Jv_MutexInit, _Jv_MutexLock,\n+\t_Jv_MutexUnlock): Handle LOCK_DEBUG.\n+\t(_Jv_ThreadSelf): Handle case where system pthread_self() is\n+\tslow.\n+\t* java/lang/Class.h (Class): Declare _Jv_AllocPtrFreeObj as\n+\tfriend.\n+\t* java/lang/Object.h (sync_info): Conditional upon presence of\n+\thash synchronization.\n+\t* java/lang/natObject.cc: Much new code to handle thin locks and\n+\thash synchronization.\n+\t* java/lang/natString.cc (_Jv_AllocString): Allocate pointer-free\n+\tobject if possible.\n+\n 2001-05-23  Joseph S. Myers  <jsm28@cam.ac.uk>\n \n \t* gij.cc (version): Update copyright year."}, {"sha": "dcf99507b80e937fc59f792c958c6e55312855ef", "filename": "libjava/boehm.cc", "status": "modified", "additions": 54, "deletions": 25, "changes": 79, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fboehm.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fboehm.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fboehm.cc?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -1,6 +1,6 @@\n // boehm.cc - interface between libjava and Boehm GC.\n \n-/* Copyright (C) 1998, 1999, 2000  Free Software Foundation\n+/* Copyright (C) 1998, 1999, 2000, 2001  Free Software Foundation\n \n    This file is part of libgcj.\n \n@@ -97,10 +97,13 @@ _Jv_MarkObj (void *addr, void *msp, void *msl, void * /* env */)\n   if (__builtin_expect (! dt || !(dt -> get_finalizer()), false))\n     return mark_stack_ptr;\n   jclass klass = dt->clas;\n+  ptr_t p;\n \n-  // Every object has a sync_info pointer.\n-  ptr_t p = (ptr_t) obj->sync_info;\n-  MAYBE_MARK (p, mark_stack_ptr, mark_stack_limit, obj, o1label);\n+# ifndef JV_HASH_SYNCHRONIZATION\n+    // Every object has a sync_info pointer.\n+    p = (ptr_t) obj->sync_info;\n+    MAYBE_MARK (p, mark_stack_ptr, mark_stack_limit, obj, o1label);\n+# endif\n   // Mark the object's class.\n   p = (ptr_t) klass;\n   MAYBE_MARK (p, mark_stack_ptr, mark_stack_limit, obj, o2label);\n@@ -300,10 +303,13 @@ _Jv_MarkArray (void *addr, void *msp, void *msl, void * /*env*/)\n   if (__builtin_expect (! dt || !(dt -> get_finalizer()), false))\n     return mark_stack_ptr;\n   jclass klass = dt->clas;\n+  ptr_t p;\n \n-  // Every object has a sync_info pointer.\n-  ptr_t p = (ptr_t) array->sync_info;\n-  MAYBE_MARK (p, mark_stack_ptr, mark_stack_limit, array, e1label);\n+# ifndef JV_HASH_SYNCHRONIZATION\n+    // Every object has a sync_info pointer.\n+    p = (ptr_t) array->sync_info;\n+    MAYBE_MARK (p, mark_stack_ptr, mark_stack_limit, array, e1label);\n+# endif\n   // Mark the object's class.\n   p = (ptr_t) klass;\n   MAYBE_MARK (p, mark_stack_ptr, mark_stack_limit, obj, o2label);\n@@ -326,18 +332,24 @@ _Jv_MarkArray (void *addr, void *msp, void *msl, void * /*env*/)\n // knows this, so in that case everything else will break, too.\n #define GCJ_DEFAULT_DESCR GC_MAKE_PROC(GC_GCJ_RESERVED_MARK_PROC_INDEX,0)\n void *\n-_Jv_BuildGCDescr(jclass klass)\n+_Jv_BuildGCDescr(jclass)\n {\n   /* FIXME: We should really look at the class and build the descriptor. */\n   return (void *)(GCJ_DEFAULT_DESCR);\n }\n #endif\n \n-// Allocate space for a new Java object.\n+// Allocate some space that is known to be pointer-free.\n void *\n-_Jv_AllocObj (jsize size, jclass klass)\n+_Jv_AllocBytes (jsize size)\n {\n-  return GC_GCJ_MALLOC (size, klass->vtable);\n+  void *r = GC_MALLOC_ATOMIC (size);\n+  // We have to explicitly zero memory here, as the GC doesn't\n+  // guarantee that PTRFREE allocations are zeroed.  Note that we\n+  // don't have to do this for other allocation types because we set\n+  // the `ok_init' flag in the type descriptor.\n+  memset (r, 0, size);\n+  return r;\n }\n \n // Allocate space for a new Java array.\n@@ -368,20 +380,6 @@ _Jv_AllocArray (jsize size, jclass klass)\n   return obj;\n }\n \n-// Allocate some space that is known to be pointer-free.\n-void *\n-_Jv_AllocBytes (jsize size)\n-{\n-  void *r = GC_MALLOC_ATOMIC (size);\n-  // We have to explicitly zero memory here, as the GC doesn't\n-  // guarantee that PTRFREE allocations are zeroed.  Note that we\n-  // don't have to do this for other allocation types because we set\n-  // the `ok_init' flag in the type descriptor.\n-  if (__builtin_expect (r != NULL, !NULL))\n-    memset (r, 0, size);\n-  return r;\n-}\n-\n static void\n call_finalizer (GC_PTR obj, GC_PTR client_data)\n {\n@@ -462,6 +460,11 @@ _Jv_EnableGC (void)\n   _Jv_MutexUnlock (&disable_gc_mutex); \n }\n \n+static void * handle_out_of_memory(size_t)\n+{\n+  _Jv_ThrowNoMemory();\n+}\n+\n void\n _Jv_InitGC (void)\n {\n@@ -484,6 +487,10 @@ _Jv_InitGC (void)\n   // stash in the class vtable.\n   GC_init_gcj_malloc (0, (void *) _Jv_MarkObj);  \n \n+  // Cause an out of memory error to be thrown from the allocators,\n+  // instead of returning 0.  This is cheaper than checking on allocation.\n+  GC_oom_fn = handle_out_of_memory;\n+\n   LOCK ();\n   GC_java_finalization = 1;\n \n@@ -511,6 +518,28 @@ _Jv_InitGC (void)\n   ENABLE_SIGNALS ();\n }\n \n+#ifdef JV_HASH_SYNCHRONIZATION\n+// Allocate an object with a fake vtable pointer, which causes only\n+// the first field (beyond the fake vtable pointer) to be traced.\n+// Eventually this should probably be generalized.\n+\n+static _Jv_VTable trace_one_vtable = {\n+    0, \t\t\t// class pointer\n+    (void *)(2 * sizeof(void *)),\n+\t\t\t// descriptor; scan 2 words incl. vtable ptr.\n+\t\t\t// Least significant bits must be zero to\n+\t\t\t// identify this as a lenght descriptor\n+    {0}\t\t\t// First method\n+};\n+\n+void *\n+_Jv_AllocTraceOne (jsize size /* includes vtable slot */) \n+{\n+  return GC_GCJ_MALLOC (size, &trace_one_vtable);\n+}\n+\n+#endif /* JV_HASH_SYNCHRONIZATION */\n+\n #if 0\n void\n _Jv_InitGC (void)"}, {"sha": "a01c5c1ea519423586a7c3509f1636b1b2eb0ac9", "filename": "libjava/configure", "status": "modified", "additions": 337, "deletions": 288, "changes": 625, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fconfigure?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -38,6 +38,9 @@ ac_help=\"$ac_help\n ac_help=\"$ac_help\n   --disable-getenv-properties\n                           don't set system properties from GCJ_PROPERTIES\"\n+ac_help=\"$ac_help\n+  --enable-hash-synchronization\n+                          Use global hash table for monitor locks\"\n ac_help=\"$ac_help\n   --enable-libgcj-debug   enable runtime debugging code\"\n ac_help=\"$ac_help\n@@ -75,6 +78,7 @@ program_suffix=NONE\n program_transform_name=s,x,x,\n silent=\n site=\n+sitefile=\n srcdir=\n target=NONE\n verbose=\n@@ -189,6 +193,7 @@ Configuration:\n   --help                  print this message\n   --no-create             do not create output files\n   --quiet, --silent       do not print \\`checking...' messages\n+  --site-file=FILE        use FILE as the site file\n   --version               print the version of autoconf that created configure\n Directory and file names:\n   --prefix=PREFIX         install architecture-independent files in PREFIX\n@@ -359,6 +364,11 @@ EOF\n   -site=* | --site=* | --sit=*)\n     site=\"$ac_optarg\" ;;\n \n+  -site-file | --site-file | --site-fil | --site-fi | --site-f)\n+    ac_prev=sitefile ;;\n+  -site-file=* | --site-file=* | --site-fil=* | --site-fi=* | --site-f=*)\n+    sitefile=\"$ac_optarg\" ;;\n+\n   -srcdir | --srcdir | --srcdi | --srcd | --src | --sr)\n     ac_prev=srcdir ;;\n   -srcdir=* | --srcdir=* | --srcdi=* | --srcd=* | --src=* | --sr=*)\n@@ -524,12 +534,16 @@ fi\n srcdir=`echo \"${srcdir}\" | sed 's%\\([^/]\\)/*$%\\1%'`\n \n # Prefer explicitly selected file to automatically selected ones.\n-if test -z \"$CONFIG_SITE\"; then\n-  if test \"x$prefix\" != xNONE; then\n-    CONFIG_SITE=\"$prefix/share/config.site $prefix/etc/config.site\"\n-  else\n-    CONFIG_SITE=\"$ac_default_prefix/share/config.site $ac_default_prefix/etc/config.site\"\n+if test -z \"$sitefile\"; then\n+  if test -z \"$CONFIG_SITE\"; then\n+    if test \"x$prefix\" != xNONE; then\n+      CONFIG_SITE=\"$prefix/share/config.site $prefix/etc/config.site\"\n+    else\n+      CONFIG_SITE=\"$ac_default_prefix/share/config.site $ac_default_prefix/etc/config.site\"\n+    fi\n   fi\n+else\n+  CONFIG_SITE=\"$sitefile\"\n fi\n for ac_site_file in $CONFIG_SITE; do\n   if test -r \"$ac_site_file\"; then\n@@ -617,7 +631,7 @@ else { echo \"configure: error: can not run $ac_config_sub\" 1>&2; exit 1; }\n fi\n \n echo $ac_n \"checking host system type\"\"... $ac_c\" 1>&6\n-echo \"configure:621: checking host system type\" >&5\n+echo \"configure:635: checking host system type\" >&5\n \n host_alias=$host\n case \"$host_alias\" in\n@@ -638,7 +652,7 @@ host_os=`echo $host | sed 's/^\\([^-]*\\)-\\([^-]*\\)-\\(.*\\)$/\\3/'`\n echo \"$ac_t\"\"$host\" 1>&6\n \n echo $ac_n \"checking target system type\"\"... $ac_c\" 1>&6\n-echo \"configure:642: checking target system type\" >&5\n+echo \"configure:656: checking target system type\" >&5\n \n target_alias=$target\n case \"$target_alias\" in\n@@ -656,7 +670,7 @@ target_os=`echo $target | sed 's/^\\([^-]*\\)-\\([^-]*\\)-\\(.*\\)$/\\3/'`\n echo \"$ac_t\"\"$target\" 1>&6\n \n echo $ac_n \"checking build system type\"\"... $ac_c\" 1>&6\n-echo \"configure:660: checking build system type\" >&5\n+echo \"configure:674: checking build system type\" >&5\n \n build_alias=$build\n case \"$build_alias\" in\n@@ -679,7 +693,7 @@ test \"$host_alias\" != \"$target_alias\" &&\n   program_prefix=${target_alias}-\n \n echo $ac_n \"checking whether ln -s works\"\"... $ac_c\" 1>&6\n-echo \"configure:683: checking whether ln -s works\" >&5\n+echo \"configure:697: checking whether ln -s works\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_LN_S'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -725,7 +739,7 @@ fi\n # SVR4 /usr/ucb/install, which tries to use the nonexistent group \"staff\"\n # ./install, which can be erroneously created by make from ./install.sh.\n echo $ac_n \"checking for a BSD compatible install\"\"... $ac_c\" 1>&6\n-echo \"configure:729: checking for a BSD compatible install\" >&5\n+echo \"configure:743: checking for a BSD compatible install\" >&5\n if test -z \"$INSTALL\"; then\n if eval \"test \\\"`echo '$''{'ac_cv_path_install'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n@@ -778,7 +792,7 @@ test -z \"$INSTALL_SCRIPT\" && INSTALL_SCRIPT='${INSTALL_PROGRAM}'\n test -z \"$INSTALL_DATA\" && INSTALL_DATA='${INSTALL} -m 644'\n \n echo $ac_n \"checking whether build environment is sane\"\"... $ac_c\" 1>&6\n-echo \"configure:782: checking whether build environment is sane\" >&5\n+echo \"configure:796: checking whether build environment is sane\" >&5\n # Just in case\n sleep 1\n echo timestamp > conftestfile\n@@ -835,7 +849,7 @@ test \"$program_suffix\" != NONE &&\n test \"$program_transform_name\" = \"\" && program_transform_name=\"s,x,x,\"\n \n echo $ac_n \"checking whether ${MAKE-make} sets \\${MAKE}\"\"... $ac_c\" 1>&6\n-echo \"configure:839: checking whether ${MAKE-make} sets \\${MAKE}\" >&5\n+echo \"configure:853: checking whether ${MAKE-make} sets \\${MAKE}\" >&5\n set dummy ${MAKE-make}; ac_make=`echo \"$2\" | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_prog_make_${ac_make}_set'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n@@ -868,12 +882,12 @@ else\n fi\n \n echo $ac_n \"checking for Cygwin environment\"\"... $ac_c\" 1>&6\n-echo \"configure:872: checking for Cygwin environment\" >&5\n+echo \"configure:886: checking for Cygwin environment\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_cygwin'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 877 \"configure\"\n+#line 891 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n@@ -884,7 +898,7 @@ int main() {\n return __CYGWIN__;\n ; return 0; }\n EOF\n-if { (eval echo configure:888: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:902: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   ac_cv_cygwin=yes\n else\n@@ -901,19 +915,19 @@ echo \"$ac_t\"\"$ac_cv_cygwin\" 1>&6\n CYGWIN=\n test \"$ac_cv_cygwin\" = yes && CYGWIN=yes\n echo $ac_n \"checking for mingw32 environment\"\"... $ac_c\" 1>&6\n-echo \"configure:905: checking for mingw32 environment\" >&5\n+echo \"configure:919: checking for mingw32 environment\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_mingw32'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 910 \"configure\"\n+#line 924 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n return __MINGW32__;\n ; return 0; }\n EOF\n-if { (eval echo configure:917: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:931: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   ac_cv_mingw32=yes\n else\n@@ -961,7 +975,7 @@ else { echo \"configure: error: can not run $ac_config_sub\" 1>&2; exit 1; }\n fi\n \n echo $ac_n \"checking host system type\"\"... $ac_c\" 1>&6\n-echo \"configure:965: checking host system type\" >&5\n+echo \"configure:979: checking host system type\" >&5\n \n host_alias=$host\n case \"$host_alias\" in\n@@ -988,7 +1002,7 @@ echo \"$ac_t\"\"$host\" 1>&6\n # Extract the first word of \"gcc\", so it can be a program name with args.\n set dummy gcc; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:992: checking for $ac_word\" >&5\n+echo \"configure:1006: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CC'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1018,7 +1032,7 @@ if test -z \"$CC\"; then\n   # Extract the first word of \"cc\", so it can be a program name with args.\n set dummy cc; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1022: checking for $ac_word\" >&5\n+echo \"configure:1036: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CC'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1069,7 +1083,7 @@ fi\n       # Extract the first word of \"cl\", so it can be a program name with args.\n set dummy cl; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1073: checking for $ac_word\" >&5\n+echo \"configure:1087: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CC'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1102,7 +1116,7 @@ fi\n \n \n echo $ac_n \"checking whether we are using GNU C\"\"... $ac_c\" 1>&6\n-echo \"configure:1106: checking whether we are using GNU C\" >&5\n+echo \"configure:1120: checking whether we are using GNU C\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_gcc'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1111,7 +1125,7 @@ else\n   yes;\n #endif\n EOF\n-if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:1115: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n+if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:1129: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n   ac_cv_prog_gcc=yes\n else\n   ac_cv_prog_gcc=no\n@@ -1130,7 +1144,7 @@ ac_test_CFLAGS=\"${CFLAGS+set}\"\n ac_save_CFLAGS=\"$CFLAGS\"\n CFLAGS=\n echo $ac_n \"checking whether ${CC-cc} accepts -g\"\"... $ac_c\" 1>&6\n-echo \"configure:1134: checking whether ${CC-cc} accepts -g\" >&5\n+echo \"configure:1148: checking whether ${CC-cc} accepts -g\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_cc_g'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1166,7 +1180,7 @@ do\n # Extract the first word of \"$ac_prog\", so it can be a program name with args.\n set dummy $ac_prog; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1170: checking for $ac_word\" >&5\n+echo \"configure:1184: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CXX'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1199,7 +1213,7 @@ test -n \"$CXX\" || CXX=\"gcc\"\n \n \n echo $ac_n \"checking whether we are using GNU C++\"\"... $ac_c\" 1>&6\n-echo \"configure:1203: checking whether we are using GNU C++\" >&5\n+echo \"configure:1217: checking whether we are using GNU C++\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_gxx'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1208,7 +1222,7 @@ else\n   yes;\n #endif\n EOF\n-if { ac_try='${CXX-g++} -E conftest.C'; { (eval echo configure:1212: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n+if { ac_try='${CXX-g++} -E conftest.C'; { (eval echo configure:1226: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n   ac_cv_prog_gxx=yes\n else\n   ac_cv_prog_gxx=no\n@@ -1227,7 +1241,7 @@ ac_test_CXXFLAGS=\"${CXXFLAGS+set}\"\n ac_save_CXXFLAGS=\"$CXXFLAGS\"\n CXXFLAGS=\n echo $ac_n \"checking whether ${CXX-g++} accepts -g\"\"... $ac_c\" 1>&6\n-echo \"configure:1231: checking whether ${CXX-g++} accepts -g\" >&5\n+echo \"configure:1245: checking whether ${CXX-g++} accepts -g\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_cxx_g'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1280,7 +1294,7 @@ EOF\n \n missing_dir=`cd $ac_aux_dir && pwd`\n echo $ac_n \"checking for working aclocal\"\"... $ac_c\" 1>&6\n-echo \"configure:1284: checking for working aclocal\" >&5\n+echo \"configure:1298: checking for working aclocal\" >&5\n # Run test in a subshell; some versions of sh will print an error if\n # an executable is not found, even if stderr is redirected.\n # Redirect stdin to placate older versions of autoconf.  Sigh.\n@@ -1293,7 +1307,7 @@ else\n fi\n \n echo $ac_n \"checking for working autoconf\"\"... $ac_c\" 1>&6\n-echo \"configure:1297: checking for working autoconf\" >&5\n+echo \"configure:1311: checking for working autoconf\" >&5\n # Run test in a subshell; some versions of sh will print an error if\n # an executable is not found, even if stderr is redirected.\n # Redirect stdin to placate older versions of autoconf.  Sigh.\n@@ -1306,7 +1320,7 @@ else\n fi\n \n echo $ac_n \"checking for working automake\"\"... $ac_c\" 1>&6\n-echo \"configure:1310: checking for working automake\" >&5\n+echo \"configure:1324: checking for working automake\" >&5\n # Run test in a subshell; some versions of sh will print an error if\n # an executable is not found, even if stderr is redirected.\n # Redirect stdin to placate older versions of autoconf.  Sigh.\n@@ -1319,7 +1333,7 @@ else\n fi\n \n echo $ac_n \"checking for working autoheader\"\"... $ac_c\" 1>&6\n-echo \"configure:1323: checking for working autoheader\" >&5\n+echo \"configure:1337: checking for working autoheader\" >&5\n # Run test in a subshell; some versions of sh will print an error if\n # an executable is not found, even if stderr is redirected.\n # Redirect stdin to placate older versions of autoconf.  Sigh.\n@@ -1332,7 +1346,7 @@ else\n fi\n \n echo $ac_n \"checking for working makeinfo\"\"... $ac_c\" 1>&6\n-echo \"configure:1336: checking for working makeinfo\" >&5\n+echo \"configure:1350: checking for working makeinfo\" >&5\n # Run test in a subshell; some versions of sh will print an error if\n # an executable is not found, even if stderr is redirected.\n # Redirect stdin to placate older versions of autoconf.  Sigh.\n@@ -1351,7 +1365,7 @@ fi\n # LIBGCJ_CONFIGURE, which doesn't work because that means that it will\n # be run before AC_CANONICAL_HOST.\n echo $ac_n \"checking build system type\"\"... $ac_c\" 1>&6\n-echo \"configure:1355: checking build system type\" >&5\n+echo \"configure:1369: checking build system type\" >&5\n \n build_alias=$build\n case \"$build_alias\" in\n@@ -1372,7 +1386,7 @@ echo \"$ac_t\"\"$build\" 1>&6\n # Extract the first word of \"${ac_tool_prefix}as\", so it can be a program name with args.\n set dummy ${ac_tool_prefix}as; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1376: checking for $ac_word\" >&5\n+echo \"configure:1390: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_AS'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1404,7 +1418,7 @@ fi\n # Extract the first word of \"${ac_tool_prefix}ar\", so it can be a program name with args.\n set dummy ${ac_tool_prefix}ar; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1408: checking for $ac_word\" >&5\n+echo \"configure:1422: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_AR'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1436,7 +1450,7 @@ fi\n # Extract the first word of \"${ac_tool_prefix}ranlib\", so it can be a program name with args.\n set dummy ${ac_tool_prefix}ranlib; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1440: checking for $ac_word\" >&5\n+echo \"configure:1454: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1468,7 +1482,7 @@ if test -n \"$ac_tool_prefix\"; then\n   # Extract the first word of \"ranlib\", so it can be a program name with args.\n set dummy ranlib; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1472: checking for $ac_word\" >&5\n+echo \"configure:1486: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1513,7 +1527,7 @@ fi\n # SVR4 /usr/ucb/install, which tries to use the nonexistent group \"staff\"\n # ./install, which can be erroneously created by make from ./install.sh.\n echo $ac_n \"checking for a BSD compatible install\"\"... $ac_c\" 1>&6\n-echo \"configure:1517: checking for a BSD compatible install\" >&5\n+echo \"configure:1531: checking for a BSD compatible install\" >&5\n if test -z \"$INSTALL\"; then\n if eval \"test \\\"`echo '$''{'ac_cv_path_install'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n@@ -1567,7 +1581,7 @@ test -z \"$INSTALL_DATA\" && INSTALL_DATA='${INSTALL} -m 644'\n \n \n echo $ac_n \"checking whether to enable maintainer-specific portions of Makefiles\"\"... $ac_c\" 1>&6\n-echo \"configure:1571: checking whether to enable maintainer-specific portions of Makefiles\" >&5\n+echo \"configure:1585: checking whether to enable maintainer-specific portions of Makefiles\" >&5\n     # Check whether --enable-maintainer-mode or --disable-maintainer-mode was given.\n if test \"${enable_maintainer_mode+set}\" = set; then\n   enableval=\"$enable_maintainer_mode\"\n@@ -1601,7 +1615,7 @@ if false; then\n   \n \n echo $ac_n \"checking for executable suffix\"\"... $ac_c\" 1>&6\n-echo \"configure:1605: checking for executable suffix\" >&5\n+echo \"configure:1619: checking for executable suffix\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_exeext'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1611,10 +1625,10 @@ else\n   rm -f conftest*\n   echo 'int main () { return 0; }' > conftest.$ac_ext\n   ac_cv_exeext=\n-  if { (eval echo configure:1615: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; }; then\n+  if { (eval echo configure:1629: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; }; then\n     for file in conftest.*; do\n       case $file in\n-      *.c | *.o | *.obj) ;;\n+      *.c | *.o | *.obj | *.ilk | *.pdb) ;;\n       *) ac_cv_exeext=`echo $file | sed -e s/conftest//` ;;\n       esac\n     done\n@@ -1764,7 +1778,7 @@ ac_prog=ld\n if test \"$GCC\" = yes; then\n   # Check if gcc -print-prog-name=ld gives a path.\n   echo $ac_n \"checking for ld used by GCC\"\"... $ac_c\" 1>&6\n-echo \"configure:1768: checking for ld used by GCC\" >&5\n+echo \"configure:1782: checking for ld used by GCC\" >&5\n   case $host in\n   *-*-mingw*)\n     # gcc leaves a trailing carriage return which upsets mingw\n@@ -1794,10 +1808,10 @@ echo \"configure:1768: checking for ld used by GCC\" >&5\n   esac\n elif test \"$with_gnu_ld\" = yes; then\n   echo $ac_n \"checking for GNU ld\"\"... $ac_c\" 1>&6\n-echo \"configure:1798: checking for GNU ld\" >&5\n+echo \"configure:1812: checking for GNU ld\" >&5\n else\n   echo $ac_n \"checking for non-GNU ld\"\"... $ac_c\" 1>&6\n-echo \"configure:1801: checking for non-GNU ld\" >&5\n+echo \"configure:1815: checking for non-GNU ld\" >&5\n fi\n if eval \"test \\\"`echo '$''{'lt_cv_path_LD'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n@@ -1832,7 +1846,7 @@ else\n fi\n test -z \"$LD\" && { echo \"configure: error: no acceptable ld found in \\$PATH\" 1>&2; exit 1; }\n echo $ac_n \"checking if the linker ($LD) is GNU ld\"\"... $ac_c\" 1>&6\n-echo \"configure:1836: checking if the linker ($LD) is GNU ld\" >&5\n+echo \"configure:1850: checking if the linker ($LD) is GNU ld\" >&5\n if eval \"test \\\"`echo '$''{'lt_cv_prog_gnu_ld'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1849,7 +1863,7 @@ with_gnu_ld=$lt_cv_prog_gnu_ld\n \n \n echo $ac_n \"checking for $LD option to reload object files\"\"... $ac_c\" 1>&6\n-echo \"configure:1853: checking for $LD option to reload object files\" >&5\n+echo \"configure:1867: checking for $LD option to reload object files\" >&5\n if eval \"test \\\"`echo '$''{'lt_cv_ld_reload_flag'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1861,7 +1875,7 @@ reload_flag=$lt_cv_ld_reload_flag\n test -n \"$reload_flag\" && reload_flag=\" $reload_flag\"\n \n echo $ac_n \"checking for BSD-compatible nm\"\"... $ac_c\" 1>&6\n-echo \"configure:1865: checking for BSD-compatible nm\" >&5\n+echo \"configure:1879: checking for BSD-compatible nm\" >&5\n if eval \"test \\\"`echo '$''{'lt_cv_path_NM'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1899,7 +1913,7 @@ NM=\"$lt_cv_path_NM\"\n echo \"$ac_t\"\"$NM\" 1>&6\n \n echo $ac_n \"checking how to recognise dependant libraries\"\"... $ac_c\" 1>&6\n-echo \"configure:1903: checking how to recognise dependant libraries\" >&5\n+echo \"configure:1917: checking how to recognise dependant libraries\" >&5\n if eval \"test \\\"`echo '$''{'lt_cv_deplibs_check_method'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2000,7 +2014,7 @@ irix5* | irix6*)\n # This must be Linux ELF.\n linux-gnu*)\n   case $host_cpu in\n-  alpha* | i*86 | powerpc* | sparc* | ia64* )\n+  alpha* | hppa* | i*86 | powerpc* | sparc* | ia64* )\n     lt_cv_deplibs_check_method=pass_all ;;\n   *)\n     # glibc up to 2.1.1 does not perform some relocations on ARM\n@@ -2039,6 +2053,10 @@ solaris*)\n   lt_cv_file_magic_test_file=/lib/libc.so\n   ;;\n \n+sysv5uw[78]* | sysv4*uw2*)\n+  lt_cv_deplibs_check_method=pass_all\n+  ;;\n+\n sysv4 | sysv4.2uw2* | sysv4.3* | sysv5*)\n   case $host_vendor in\n   ncr)\n@@ -2059,13 +2077,13 @@ file_magic_cmd=$lt_cv_file_magic_cmd\n deplibs_check_method=$lt_cv_deplibs_check_method\n \n echo $ac_n \"checking for object suffix\"\"... $ac_c\" 1>&6\n-echo \"configure:2063: checking for object suffix\" >&5\n+echo \"configure:2081: checking for object suffix\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_objext'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   rm -f conftest*\n echo 'int i = 1;' > conftest.$ac_ext\n-if { (eval echo configure:2069: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:2087: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   for ac_file in conftest.*; do\n     case $ac_file in\n     *.c) ;;\n@@ -2089,7 +2107,7 @@ case $deplibs_check_method in\n file_magic*)\n   if test \"$file_magic_cmd\" = '$MAGIC_CMD'; then\n     echo $ac_n \"checking for ${ac_tool_prefix}file\"\"... $ac_c\" 1>&6\n-echo \"configure:2093: checking for ${ac_tool_prefix}file\" >&5\n+echo \"configure:2111: checking for ${ac_tool_prefix}file\" >&5\n if eval \"test \\\"`echo '$''{'lt_cv_path_MAGIC_CMD'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2151,7 +2169,7 @@ fi\n if test -z \"$lt_cv_path_MAGIC_CMD\"; then\n   if test -n \"$ac_tool_prefix\"; then\n     echo $ac_n \"checking for file\"\"... $ac_c\" 1>&6\n-echo \"configure:2155: checking for file\" >&5\n+echo \"configure:2173: checking for file\" >&5\n if eval \"test \\\"`echo '$''{'lt_cv_path_MAGIC_CMD'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2222,7 +2240,7 @@ esac\n # Extract the first word of \"${ac_tool_prefix}ranlib\", so it can be a program name with args.\n set dummy ${ac_tool_prefix}ranlib; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2226: checking for $ac_word\" >&5\n+echo \"configure:2244: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2254,7 +2272,7 @@ if test -n \"$ac_tool_prefix\"; then\n   # Extract the first word of \"ranlib\", so it can be a program name with args.\n set dummy ranlib; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2258: checking for $ac_word\" >&5\n+echo \"configure:2276: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2289,7 +2307,7 @@ fi\n # Extract the first word of \"${ac_tool_prefix}strip\", so it can be a program name with args.\n set dummy ${ac_tool_prefix}strip; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2293: checking for $ac_word\" >&5\n+echo \"configure:2311: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_STRIP'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2321,7 +2339,7 @@ if test -n \"$ac_tool_prefix\"; then\n   # Extract the first word of \"strip\", so it can be a program name with args.\n set dummy strip; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2325: checking for $ac_word\" >&5\n+echo \"configure:2343: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_STRIP'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2388,8 +2406,8 @@ test x\"$pic_mode\" = xno && libtool_flags=\"$libtool_flags --prefer-non-pic\"\n case $host in\n *-*-irix6*)\n   # Find out which ABI we are using.\n-  echo '#line 2392 \"configure\"' > conftest.$ac_ext\n-  if { (eval echo configure:2393: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+  echo '#line 2410 \"configure\"' > conftest.$ac_ext\n+  if { (eval echo configure:2411: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n     case `/usr/bin/file conftest.$ac_objext` in\n     *32-bit*)\n       LD=\"${LD-ld} -32\"\n@@ -2410,7 +2428,7 @@ case $host in\n   SAVE_CFLAGS=\"$CFLAGS\"\n   CFLAGS=\"$CFLAGS -belf\"\n   echo $ac_n \"checking whether the C compiler needs -belf\"\"... $ac_c\" 1>&6\n-echo \"configure:2414: checking whether the C compiler needs -belf\" >&5\n+echo \"configure:2432: checking whether the C compiler needs -belf\" >&5\n if eval \"test \\\"`echo '$''{'lt_cv_cc_needs_belf'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2423,14 +2441,14 @@ ac_link='${CC-cc} -o conftest${ac_exeext} $CFLAGS $CPPFLAGS $LDFLAGS conftest.$a\n cross_compiling=$ac_cv_prog_cc_cross\n \n      cat > conftest.$ac_ext <<EOF\n-#line 2427 \"configure\"\n+#line 2445 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2434: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2452: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   lt_cv_cc_needs_belf=yes\n else\n@@ -2460,7 +2478,7 @@ echo \"$ac_t\"\"$lt_cv_cc_needs_belf\" 1>&6\n esac\n \n echo $ac_n \"checking how to run the C++ preprocessor\"\"... $ac_c\" 1>&6\n-echo \"configure:2464: checking how to run the C++ preprocessor\" >&5\n+echo \"configure:2482: checking how to run the C++ preprocessor\" >&5\n if test -z \"$CXXCPP\"; then\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CXXCPP'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n@@ -2473,12 +2491,12 @@ ac_link='${CXX-g++} -o conftest${ac_exeext} $CXXFLAGS $CPPFLAGS $LDFLAGS conftes\n cross_compiling=$ac_cv_prog_cxx_cross\n   CXXCPP=\"${CXX-g++} -E\"\n   cat > conftest.$ac_ext <<EOF\n-#line 2477 \"configure\"\n+#line 2495 \"configure\"\n #include \"confdefs.h\"\n #include <stdlib.h>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:2482: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:2500: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   :\n@@ -2650,7 +2668,7 @@ if test \"${enable_getenv_properties+set}\" = set; then\n fi\n \n \n-if test -n \"$enable_getenv_properties\"; then\n+if test -z \"$enable_getenv_properties\"; then\n    enable_getenv_properties=${enable_getenv_properties_default-yes}\n fi\n if test \"$enable_getenv_properties\" = no; then\n@@ -2660,6 +2678,28 @@ EOF\n \n fi\n \n+\n+# Check whether --enable-hash-synchronization or --disable-hash-synchronization was given.\n+if test \"${enable_hash_synchronization+set}\" = set; then\n+  enableval=\"$enable_hash_synchronization\"\n+  :\n+fi\n+\n+\n+if test -z \"$enable_hash_synchronization\"; then\n+   enable_hash_synchronization=$enable_hash_synchronization_default\n+fi\n+HASH_SYNC_SPEC=\n+if test \"$enable_hash_synchronization\" = yes; then\n+   HASH_SYNC_SPEC=-fhash-synchronization\n+   cat >> confdefs.h <<\\EOF\n+#define JV_HASH_SYNCHRONIZATION 1\n+EOF\n+\n+fi\n+\n+\n+\n LIBGCJDEBUG=\"false\"\n \n # Check whether --enable-libgcj-debug or --disable-libgcj-debug was given.\n@@ -2695,7 +2735,7 @@ EOF\n fi\n \n echo $ac_n \"checking for exception model to use\"\"... $ac_c\" 1>&6\n-echo \"configure:2699: checking for exception model to use\" >&5\n+echo \"configure:2739: checking for exception model to use\" >&5\n \n ac_ext=C\n # CXXFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.\n@@ -2710,7 +2750,7 @@ if test \"${enable_sjlj_exceptions+set}\" = set; then\n   :\n else\n   cat > conftest.$ac_ext << EOF\n-#line 2714 \"configure\"\n+#line 2754 \"configure\"\n struct S { ~S(); };\n void bar();\n void foo()\n@@ -2721,7 +2761,7 @@ void foo()\n EOF\n old_CXXFLAGS=\"$CXXFLAGS\"  \n CXXFLAGS=-S\n-if { (eval echo configure:2725: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:2765: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   if grep _Unwind_SjLj_Resume conftest.s >/dev/null 2>&1 ; then\n     enable_sjlj_exceptions=yes\n   elif grep _Unwind_Resume conftest.s >/dev/null 2>&1 ; then\n@@ -2753,18 +2793,18 @@ cross_compiling=$ac_cv_prog_cc_cross\n echo \"$ac_t\"\"$ac_exception_model_name\" 1>&6\n \n echo $ac_n \"checking for data_start\"\"... $ac_c\" 1>&6\n-echo \"configure:2757: checking for data_start\" >&5\n+echo \"configure:2797: checking for data_start\" >&5\n LIBDATASTARTSPEC=\n NEEDS_DATA_START=\n cat > conftest.$ac_ext <<EOF\n-#line 2761 \"configure\"\n+#line 2801 \"configure\"\n #include \"confdefs.h\"\n extern int data_start;\n int main() {\n return ((int) &data_start);\n ; return 0; }\n EOF\n-if { (eval echo configure:2768: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2808: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   echo \"$ac_t\"\"found it\" 1>&6\n else\n@@ -2785,7 +2825,7 @@ if test \"${enable_java_net+set}\" = set; then\n fi\n \n \n-if test -n \"$enable_java_net\"; then\n+if test -z \"$enable_java_net\"; then\n    enable_java_net=${enable_java_net_default-yes}\n fi\n if test \"$enable_java_net\" = no; then\n@@ -2834,7 +2874,7 @@ EOF\n esac\n \n echo $ac_n \"checking how to run the C preprocessor\"\"... $ac_c\" 1>&6\n-echo \"configure:2838: checking how to run the C preprocessor\" >&5\n+echo \"configure:2878: checking how to run the C preprocessor\" >&5\n # On Suns, sometimes $CPP names a directory.\n if test -n \"$CPP\" && test -d \"$CPP\"; then\n   CPP=\n@@ -2849,13 +2889,13 @@ else\n   # On the NeXT, cc -E runs the code through the compiler's parser,\n   # not just through cpp.\n   cat > conftest.$ac_ext <<EOF\n-#line 2853 \"configure\"\n+#line 2893 \"configure\"\n #include \"confdefs.h\"\n #include <assert.h>\n Syntax Error\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:2859: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:2899: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   :\n@@ -2866,13 +2906,13 @@ else\n   rm -rf conftest*\n   CPP=\"${CC-cc} -E -traditional-cpp\"\n   cat > conftest.$ac_ext <<EOF\n-#line 2870 \"configure\"\n+#line 2910 \"configure\"\n #include \"confdefs.h\"\n #include <assert.h>\n Syntax Error\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:2876: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:2916: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   :\n@@ -2883,13 +2923,13 @@ else\n   rm -rf conftest*\n   CPP=\"${CC-cc} -nologo -E\"\n   cat > conftest.$ac_ext <<EOF\n-#line 2887 \"configure\"\n+#line 2927 \"configure\"\n #include \"confdefs.h\"\n #include <assert.h>\n Syntax Error\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:2893: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:2933: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   :\n@@ -2914,7 +2954,7 @@ fi\n echo \"$ac_t\"\"$CPP\" 1>&6\n \n cat > conftest.$ac_ext <<EOF\n-#line 2918 \"configure\"\n+#line 2958 \"configure\"\n #include \"confdefs.h\"\n #include <stdint.h>\n EOF\n@@ -2929,7 +2969,7 @@ fi\n rm -f conftest*\n \n cat > conftest.$ac_ext <<EOF\n-#line 2933 \"configure\"\n+#line 2973 \"configure\"\n #include \"confdefs.h\"\n #include <inttypes.h>\n EOF\n@@ -2944,7 +2984,7 @@ fi\n rm -f conftest*\n \n cat > conftest.$ac_ext <<EOF\n-#line 2948 \"configure\"\n+#line 2988 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n EOF\n@@ -2959,7 +2999,7 @@ fi\n rm -f conftest*\n \n cat > conftest.$ac_ext <<EOF\n-#line 2963 \"configure\"\n+#line 3003 \"configure\"\n #include \"confdefs.h\"\n #include <sys/config.h>\n EOF\n@@ -2976,7 +3016,7 @@ rm -f conftest*\n \n \n cat > conftest.$ac_ext <<EOF\n-#line 2980 \"configure\"\n+#line 3020 \"configure\"\n #include \"confdefs.h\"\n #include <time.h>\n EOF\n@@ -2991,7 +3031,7 @@ fi\n rm -f conftest*\n \n cat > conftest.$ac_ext <<EOF\n-#line 2995 \"configure\"\n+#line 3035 \"configure\"\n #include \"confdefs.h\"\n #include <time.h>\n EOF\n@@ -3035,7 +3075,7 @@ ZLIBTESTSPEC=\n libsubdir=.libs\n \n echo $ac_n \"checking for garbage collector to use\"\"... $ac_c\" 1>&6\n-echo \"configure:3039: checking for garbage collector to use\" >&5\n+echo \"configure:3079: checking for garbage collector to use\" >&5\n # Check whether --enable-java-gc or --disable-java-gc was given.\n if test \"${enable_java_gc+set}\" = set; then\n   enableval=\"$enable_java_gc\"\n@@ -3091,7 +3131,7 @@ esac\n \n \n echo $ac_n \"checking for thread model used by GCC\"\"... $ac_c\" 1>&6\n-echo \"configure:3095: checking for thread model used by GCC\" >&5\n+echo \"configure:3135: checking for thread model used by GCC\" >&5\n THREADS=`$CC -v 2>&1 | sed -n 's/^Thread model: //p'`\n echo \"$ac_t\"\"$THREADS\" 1>&6\n \n@@ -3237,12 +3277,12 @@ else\n    for ac_func in strerror ioctl select fstat open fsync sleep\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3241: checking for $ac_func\" >&5\n+echo \"configure:3281: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3246 \"configure\"\n+#line 3286 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3265,7 +3305,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3269: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3309: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3292,12 +3332,12 @@ done\n    for ac_func in gmtime_r localtime_r readdir_r getpwuid_r getcwd\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3296: checking for $ac_func\" >&5\n+echo \"configure:3336: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3301 \"configure\"\n+#line 3341 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3320,7 +3360,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3324: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3364: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3347,12 +3387,12 @@ done\n    for ac_func in access stat mkdir rename rmdir unlink realpath utime chmod\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3351: checking for $ac_func\" >&5\n+echo \"configure:3391: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3356 \"configure\"\n+#line 3396 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3375,7 +3415,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3379: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3419: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3402,12 +3442,12 @@ done\n    for ac_func in iconv nl_langinfo setlocale\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3406: checking for $ac_func\" >&5\n+echo \"configure:3446: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3411 \"configure\"\n+#line 3451 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3430,7 +3470,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3434: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3474: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3457,12 +3497,12 @@ done\n    for ac_func in inet_aton inet_addr\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3461: checking for $ac_func\" >&5\n+echo \"configure:3501: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3466 \"configure\"\n+#line 3506 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3485,7 +3525,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3489: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3529: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3512,12 +3552,12 @@ done\n    for ac_func in inet_pton uname inet_ntoa\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3516: checking for $ac_func\" >&5\n+echo \"configure:3556: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3521 \"configure\"\n+#line 3561 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3540,7 +3580,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3544: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3584: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3567,12 +3607,12 @@ done\n    for ac_func in backtrace fork execvp pipe\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3571: checking for $ac_func\" >&5\n+echo \"configure:3611: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3576 \"configure\"\n+#line 3616 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3595,7 +3635,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3599: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3639: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3623,17 +3663,17 @@ done\n do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:3627: checking for $ac_hdr\" >&5\n+echo \"configure:3667: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3632 \"configure\"\n+#line 3672 \"configure\"\n #include \"confdefs.h\"\n #include <$ac_hdr>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:3637: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:3677: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -3660,15 +3700,15 @@ fi\n done\n  \n    echo $ac_n \"checking for dladdr in -ldl\"\"... $ac_c\" 1>&6\n-echo \"configure:3664: checking for dladdr in -ldl\" >&5\n+echo \"configure:3704: checking for dladdr in -ldl\" >&5\n ac_lib_var=`echo dl'_'dladdr | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-ldl  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 3672 \"configure\"\n+#line 3712 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -3679,7 +3719,7 @@ int main() {\n dladdr()\n ; return 0; }\n EOF\n-if { (eval echo configure:3683: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3723: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -3708,7 +3748,7 @@ do\n \n ac_safe=`echo \"$ac_file\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_file\"\"... $ac_c\" 1>&6\n-echo \"configure:3712: checking for $ac_file\" >&5\n+echo \"configure:3752: checking for $ac_file\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_file_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3743,12 +3783,12 @@ done\n    for ac_func in gethostbyname_r\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3747: checking for $ac_func\" >&5\n+echo \"configure:3787: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3752 \"configure\"\n+#line 3792 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3771,7 +3811,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3775: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3815: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3798,7 +3838,7 @@ EOF\n      # We look for the one that returns `int'.\n      # Hopefully this check is robust enough.\n      cat > conftest.$ac_ext <<EOF\n-#line 3802 \"configure\"\n+#line 3842 \"configure\"\n #include \"confdefs.h\"\n #include <netdb.h>\n EOF\n@@ -3818,7 +3858,7 @@ rm -f conftest*\n      *\" -D_REENTRANT \"*) ;;\n      *)\n \t\techo $ac_n \"checking whether gethostbyname_r declaration requires -D_REENTRANT\"\"... $ac_c\" 1>&6\n-echo \"configure:3822: checking whether gethostbyname_r declaration requires -D_REENTRANT\" >&5\n+echo \"configure:3862: checking whether gethostbyname_r declaration requires -D_REENTRANT\" >&5\n if eval \"test \\\"`echo '$''{'libjava_cv_gethostbyname_r_needs_reentrant'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3831,14 +3871,14 @@ ac_link='${CXX-g++} -o conftest${ac_exeext} $CXXFLAGS $CPPFLAGS $LDFLAGS conftes\n cross_compiling=$ac_cv_prog_cxx_cross\n \n \t  cat > conftest.$ac_ext <<EOF\n-#line 3835 \"configure\"\n+#line 3875 \"configure\"\n #include \"confdefs.h\"\n #include <netdb.h>\n int main() {\n gethostbyname_r(\"\", 0, 0);\n ; return 0; }\n EOF\n-if { (eval echo configure:3842: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:3882: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   libjava_cv_gethostbyname_r_needs_reentrant=no\n else\n@@ -3848,14 +3888,14 @@ else\n   \t\tCPPFLAGS_SAVE=\"$CPPFLAGS\"\n \t\tCPPFLAGS=\"$CPPFLAGS -D_REENTRANT\"\n \t\tcat > conftest.$ac_ext <<EOF\n-#line 3852 \"configure\"\n+#line 3892 \"configure\"\n #include \"confdefs.h\"\n #include <netdb.h>\n int main() {\n gethostbyname_r(\"\", 0, 0);\n ; return 0; }\n EOF\n-if { (eval echo configure:3859: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:3899: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   libjava_cv_gethostbyname_r_needs_reentrant=yes\n else\n@@ -3890,12 +3930,12 @@ EOF\n      esac\n \n      echo $ac_n \"checking for struct hostent_data\"\"... $ac_c\" 1>&6\n-echo \"configure:3894: checking for struct hostent_data\" >&5\n+echo \"configure:3934: checking for struct hostent_data\" >&5\n if eval \"test \\\"`echo '$''{'libjava_cv_struct_hostent_data'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   \tcat > conftest.$ac_ext <<EOF\n-#line 3899 \"configure\"\n+#line 3939 \"configure\"\n #include \"confdefs.h\"\n \n #if GETHOSTBYNAME_R_NEEDS_REENTRANT && !defined(_REENTRANT)\n@@ -3906,7 +3946,7 @@ int main() {\n struct hostent_data data;\n ; return 0; }\n EOF\n-if { (eval echo configure:3910: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:3950: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   libjava_cv_struct_hostent_data=yes\n else\n@@ -3935,12 +3975,12 @@ done\n    for ac_func in gethostbyaddr_r\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3939: checking for $ac_func\" >&5\n+echo \"configure:3979: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3944 \"configure\"\n+#line 3984 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3963,7 +4003,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3967: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4007: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3990,7 +4030,7 @@ EOF\n      # We look for the one that returns `int'.\n      # Hopefully this check is robust enough.\n      cat > conftest.$ac_ext <<EOF\n-#line 3994 \"configure\"\n+#line 4034 \"configure\"\n #include \"confdefs.h\"\n #include <netdb.h>\n EOF\n@@ -4014,12 +4054,12 @@ done\n    for ac_func in gethostname\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4018: checking for $ac_func\" >&5\n+echo \"configure:4058: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4023 \"configure\"\n+#line 4063 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4042,7 +4082,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4046: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4086: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4066,7 +4106,7 @@ EOF\n EOF\n \n      cat > conftest.$ac_ext <<EOF\n-#line 4070 \"configure\"\n+#line 4110 \"configure\"\n #include \"confdefs.h\"\n #include <unistd.h>\n EOF\n@@ -4097,12 +4137,12 @@ done\n       for ac_func in pthread_mutexattr_settype pthread_mutexattr_setkind_np\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4101: checking for $ac_func\" >&5\n+echo \"configure:4141: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4106 \"configure\"\n+#line 4146 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4125,7 +4165,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4129: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4169: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4155,12 +4195,12 @@ done\n       for ac_func in sched_yield\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4159: checking for $ac_func\" >&5\n+echo \"configure:4199: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4164 \"configure\"\n+#line 4204 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4183,7 +4223,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4187: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4227: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4205,15 +4245,15 @@ EOF\n else\n   echo \"$ac_t\"\"no\" 1>&6\n echo $ac_n \"checking for sched_yield in -lrt\"\"... $ac_c\" 1>&6\n-echo \"configure:4209: checking for sched_yield in -lrt\" >&5\n+echo \"configure:4249: checking for sched_yield in -lrt\" >&5\n ac_lib_var=`echo rt'_'sched_yield | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lrt  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4217 \"configure\"\n+#line 4257 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -4224,7 +4264,7 @@ int main() {\n sched_yield()\n ; return 0; }\n EOF\n-if { (eval echo configure:4228: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4268: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4250,15 +4290,15 @@ else\n   echo \"$ac_t\"\"no\" 1>&6\n \n \t  echo $ac_n \"checking for sched_yield in -lposix4\"\"... $ac_c\" 1>&6\n-echo \"configure:4254: checking for sched_yield in -lposix4\" >&5\n+echo \"configure:4294: checking for sched_yield in -lposix4\" >&5\n ac_lib_var=`echo posix4'_'sched_yield | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lposix4  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4262 \"configure\"\n+#line 4302 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -4269,7 +4309,7 @@ int main() {\n sched_yield()\n ; return 0; }\n EOF\n-if { (eval echo configure:4273: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4313: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4305,7 +4345,7 @@ done\n       # We can save a little space at runtime if the mutex has m_count\n       # or __m_count.  This is a nice hack for Linux.\n       cat > conftest.$ac_ext <<EOF\n-#line 4309 \"configure\"\n+#line 4349 \"configure\"\n #include \"confdefs.h\"\n #include <pthread.h>\n int main() {\n@@ -4314,7 +4354,7 @@ int main() {\n         \n ; return 0; }\n EOF\n-if { (eval echo configure:4318: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:4358: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define PTHREAD_MUTEX_HAVE_M_COUNT 1\n@@ -4326,7 +4366,7 @@ else\n   rm -rf conftest*\n   \n \tcat > conftest.$ac_ext <<EOF\n-#line 4330 \"configure\"\n+#line 4370 \"configure\"\n #include \"confdefs.h\"\n #include <pthread.h>\n int main() {\n@@ -4335,7 +4375,7 @@ int main() {\n \t  \n ; return 0; }\n EOF\n-if { (eval echo configure:4339: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:4379: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define PTHREAD_MUTEX_HAVE___M_COUNT 1\n@@ -4355,12 +4395,12 @@ rm -f conftest*\n    for ac_func in gettimeofday time ftime\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4359: checking for $ac_func\" >&5\n+echo \"configure:4399: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4364 \"configure\"\n+#line 4404 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4383,7 +4423,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4387: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4427: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4414,12 +4454,12 @@ done\n    for ac_func in memmove\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4418: checking for $ac_func\" >&5\n+echo \"configure:4458: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4423 \"configure\"\n+#line 4463 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4442,7 +4482,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4446: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4486: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4472,12 +4512,12 @@ done\n    for ac_func in memcpy\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4476: checking for $ac_func\" >&5\n+echo \"configure:4516: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4481 \"configure\"\n+#line 4521 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4500,7 +4540,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4504: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4544: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4548,20 +4588,20 @@ done\n    #--------------------------------------------------------------------\n \n    echo $ac_n \"checking for socket libraries\"\"... $ac_c\" 1>&6\n-echo \"configure:4552: checking for socket libraries\" >&5\n+echo \"configure:4592: checking for socket libraries\" >&5\n if eval \"test \\\"`echo '$''{'gcj_cv_lib_sockets'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   gcj_cv_lib_sockets=\n      gcj_checkBoth=0\n      unset ac_cv_func_connect\n      echo $ac_n \"checking for connect\"\"... $ac_c\" 1>&6\n-echo \"configure:4560: checking for connect\" >&5\n+echo \"configure:4600: checking for connect\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_connect'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4565 \"configure\"\n+#line 4605 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char connect(); below.  */\n@@ -4584,7 +4624,7 @@ connect();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4588: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4628: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_connect=yes\"\n else\n@@ -4607,22 +4647,22 @@ fi\n      if test \"$gcj_checkSocket\" = 1; then\n \t unset ac_cv_func_connect\n \t echo $ac_n \"checking for main in -lsocket\"\"... $ac_c\" 1>&6\n-echo \"configure:4611: checking for main in -lsocket\" >&5\n+echo \"configure:4651: checking for main in -lsocket\" >&5\n ac_lib_var=`echo socket'_'main | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lsocket  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4619 \"configure\"\n+#line 4659 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n main()\n ; return 0; }\n EOF\n-if { (eval echo configure:4626: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4666: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4649,12 +4689,12 @@ fi\n \t LIBS=\"$LIBS -lsocket -lnsl\"\n \t unset ac_cv_func_accept\n \t echo $ac_n \"checking for accept\"\"... $ac_c\" 1>&6\n-echo \"configure:4653: checking for accept\" >&5\n+echo \"configure:4693: checking for accept\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_accept'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4658 \"configure\"\n+#line 4698 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char accept(); below.  */\n@@ -4677,7 +4717,7 @@ accept();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4681: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4721: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_accept=yes\"\n else\n@@ -4704,12 +4744,12 @@ fi\n      gcj_oldLibs=$LIBS\n      LIBS=\"$LIBS $gcj_cv_lib_sockets\"\n      echo $ac_n \"checking for gethostbyname\"\"... $ac_c\" 1>&6\n-echo \"configure:4708: checking for gethostbyname\" >&5\n+echo \"configure:4748: checking for gethostbyname\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_gethostbyname'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4713 \"configure\"\n+#line 4753 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char gethostbyname(); below.  */\n@@ -4732,7 +4772,7 @@ gethostbyname();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4736: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4776: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_gethostbyname=yes\"\n else\n@@ -4750,22 +4790,22 @@ if eval \"test \\\"`echo '$ac_cv_func_'gethostbyname`\\\" = yes\"; then\n else\n   echo \"$ac_t\"\"no\" 1>&6\n echo $ac_n \"checking for main in -lnsl\"\"... $ac_c\" 1>&6\n-echo \"configure:4754: checking for main in -lnsl\" >&5\n+echo \"configure:4794: checking for main in -lnsl\" >&5\n ac_lib_var=`echo nsl'_'main | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lnsl  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4762 \"configure\"\n+#line 4802 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n main()\n ; return 0; }\n EOF\n-if { (eval echo configure:4769: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4809: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4797,15 +4837,15 @@ echo \"$ac_t\"\"$gcj_cv_lib_sockets\" 1>&6\n \n    if test \"$with_system_zlib\" = yes; then\n       echo $ac_n \"checking for deflate in -lz\"\"... $ac_c\" 1>&6\n-echo \"configure:4801: checking for deflate in -lz\" >&5\n+echo \"configure:4841: checking for deflate in -lz\" >&5\n ac_lib_var=`echo z'_'deflate | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lz  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4809 \"configure\"\n+#line 4849 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -4816,7 +4856,7 @@ int main() {\n deflate()\n ; return 0; }\n EOF\n-if { (eval echo configure:4820: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4860: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4846,22 +4886,22 @@ fi\n    # requires -ldl.\n    if test \"$GC\" = boehm; then\n       echo $ac_n \"checking for main in -ldl\"\"... $ac_c\" 1>&6\n-echo \"configure:4850: checking for main in -ldl\" >&5\n+echo \"configure:4890: checking for main in -ldl\" >&5\n ac_lib_var=`echo dl'_'main | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-ldl  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4858 \"configure\"\n+#line 4898 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n main()\n ; return 0; }\n EOF\n-if { (eval echo configure:4865: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4905: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4927,7 +4967,7 @@ fi\n # Extract the first word of \"${ac_tool_prefix}gcj\", so it can be a program name with args.\n set dummy ${ac_tool_prefix}gcj; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4931: checking for $ac_word\" >&5\n+echo \"configure:4971: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_GCJ'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4959,7 +4999,7 @@ if test -n \"$ac_tool_prefix\"; then\n   # Extract the first word of \"gcj\", so it can be a program name with args.\n set dummy gcj; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4963: checking for $ac_word\" >&5\n+echo \"configure:5003: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_GCJ'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -5021,15 +5061,15 @@ exec 5>>./config.log\n CPPFLAGS=$GCJ_SAVE_CPPFLAGS\n \n echo $ac_n \"checking size of void *\"\"... $ac_c\" 1>&6\n-echo \"configure:5025: checking size of void *\" >&5\n+echo \"configure:5065: checking size of void *\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_sizeof_void_p'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test \"$cross_compiling\" = yes; then\n     { echo \"configure: error: can not run test program while cross compiling\" 1>&2; exit 1; }\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5033 \"configure\"\n+#line 5073 \"configure\"\n #include \"confdefs.h\"\n #include <stdio.h>\n main()\n@@ -5040,7 +5080,7 @@ main()\n   exit(0);\n }\n EOF\n-if { (eval echo configure:5044: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:5084: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   ac_cv_sizeof_void_p=`cat conftestval`\n else\n@@ -5138,18 +5178,18 @@ EOF\n \n \n echo $ac_n \"checking for g++ -ffloat-store bug\"\"... $ac_c\" 1>&6\n-echo \"configure:5142: checking for g++ -ffloat-store bug\" >&5\n+echo \"configure:5182: checking for g++ -ffloat-store bug\" >&5\n save_CFLAGS=\"$CFLAGS\"\n CFLAGS=\"-x c++ -O2 -ffloat-store\"\n cat > conftest.$ac_ext <<EOF\n-#line 5146 \"configure\"\n+#line 5186 \"configure\"\n #include \"confdefs.h\"\n #include <math.h>\n int main() {\n \n ; return 0; }\n EOF\n-if { (eval echo configure:5153: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5193: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   echo \"$ac_t\"\"no\" 1>&6\n else\n@@ -5169,17 +5209,17 @@ for ac_hdr in unistd.h bstring.h sys/time.h sys/types.h fcntl.h sys/ioctl.h sys/\n do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:5173: checking for $ac_hdr\" >&5\n+echo \"configure:5213: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5178 \"configure\"\n+#line 5218 \"configure\"\n #include \"confdefs.h\"\n #include <$ac_hdr>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:5183: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:5223: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -5209,17 +5249,17 @@ for ac_hdr in dirent.h\n do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:5213: checking for $ac_hdr\" >&5\n+echo \"configure:5253: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5218 \"configure\"\n+#line 5258 \"configure\"\n #include \"confdefs.h\"\n #include <$ac_hdr>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:5223: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:5263: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -5247,20 +5287,20 @@ done\n \n \n echo $ac_n \"checking for ANSI C header files\"\"... $ac_c\" 1>&6\n-echo \"configure:5251: checking for ANSI C header files\" >&5\n+echo \"configure:5291: checking for ANSI C header files\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_stdc'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5256 \"configure\"\n+#line 5296 \"configure\"\n #include \"confdefs.h\"\n #include <stdlib.h>\n #include <stdarg.h>\n #include <string.h>\n #include <float.h>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:5264: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:5304: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -5277,7 +5317,7 @@ rm -f conftest*\n if test $ac_cv_header_stdc = yes; then\n   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.\n cat > conftest.$ac_ext <<EOF\n-#line 5281 \"configure\"\n+#line 5321 \"configure\"\n #include \"confdefs.h\"\n #include <string.h>\n EOF\n@@ -5295,7 +5335,7 @@ fi\n if test $ac_cv_header_stdc = yes; then\n   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.\n cat > conftest.$ac_ext <<EOF\n-#line 5299 \"configure\"\n+#line 5339 \"configure\"\n #include \"confdefs.h\"\n #include <stdlib.h>\n EOF\n@@ -5316,7 +5356,7 @@ if test \"$cross_compiling\" = yes; then\n   :\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5320 \"configure\"\n+#line 5360 \"configure\"\n #include \"confdefs.h\"\n #include <ctype.h>\n #define ISLOWER(c) ('a' <= (c) && (c) <= 'z')\n@@ -5327,7 +5367,7 @@ if (XOR (islower (i), ISLOWER (i)) || toupper (i) != TOUPPER (i)) exit(2);\n exit (0); }\n \n EOF\n-if { (eval echo configure:5331: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:5371: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   :\n else\n@@ -5351,12 +5391,12 @@ EOF\n fi\n \n echo $ac_n \"checking for ssize_t\"\"... $ac_c\" 1>&6\n-echo \"configure:5355: checking for ssize_t\" >&5\n+echo \"configure:5395: checking for ssize_t\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_type_ssize_t'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5360 \"configure\"\n+#line 5400 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #if STDC_HEADERS\n@@ -5385,9 +5425,9 @@ fi\n \n \n echo $ac_n \"checking for in_addr_t\"\"... $ac_c\" 1>&6\n-echo \"configure:5389: checking for in_addr_t\" >&5\n+echo \"configure:5429: checking for in_addr_t\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 5391 \"configure\"\n+#line 5431 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #if STDC_HEADERS\n@@ -5401,7 +5441,7 @@ int main() {\n in_addr_t foo;\n ; return 0; }\n EOF\n-if { (eval echo configure:5405: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5445: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_IN_ADDR_T 1\n@@ -5417,16 +5457,16 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking whether struct ip_mreq is in netinet/in.h\"\"... $ac_c\" 1>&6\n-echo \"configure:5421: checking whether struct ip_mreq is in netinet/in.h\" >&5\n+echo \"configure:5461: checking whether struct ip_mreq is in netinet/in.h\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 5423 \"configure\"\n+#line 5463 \"configure\"\n #include \"confdefs.h\"\n #include <netinet/in.h>\n int main() {\n struct ip_mreq mreq;\n ; return 0; }\n EOF\n-if { (eval echo configure:5430: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5470: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_STRUCT_IP_MREQ 1\n@@ -5442,16 +5482,16 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking whether struct sockaddr_in6 is in netinet/in.h\"\"... $ac_c\" 1>&6\n-echo \"configure:5446: checking whether struct sockaddr_in6 is in netinet/in.h\" >&5\n+echo \"configure:5486: checking whether struct sockaddr_in6 is in netinet/in.h\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 5448 \"configure\"\n+#line 5488 \"configure\"\n #include \"confdefs.h\"\n #include <netinet/in.h>\n int main() {\n struct sockaddr_in6 addr6;\n ; return 0; }\n EOF\n-if { (eval echo configure:5455: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5495: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_INET6 1\n@@ -5467,17 +5507,17 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking for socklen_t in sys/socket.h\"\"... $ac_c\" 1>&6\n-echo \"configure:5471: checking for socklen_t in sys/socket.h\" >&5\n+echo \"configure:5511: checking for socklen_t in sys/socket.h\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 5473 \"configure\"\n+#line 5513 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #include <sys/socket.h>\n int main() {\n socklen_t x = 5;\n ; return 0; }\n EOF\n-if { (eval echo configure:5481: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5521: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_SOCKLEN_T 1\n@@ -5493,16 +5533,16 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking for tm_gmtoff in struct tm\"\"... $ac_c\" 1>&6\n-echo \"configure:5497: checking for tm_gmtoff in struct tm\" >&5\n+echo \"configure:5537: checking for tm_gmtoff in struct tm\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 5499 \"configure\"\n+#line 5539 \"configure\"\n #include \"confdefs.h\"\n #include <time.h>\n int main() {\n struct tm tim; tim.tm_gmtoff = 0;\n ; return 0; }\n EOF\n-if { (eval echo configure:5506: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5546: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define STRUCT_TM_HAS_GMTOFF 1\n@@ -5515,16 +5555,16 @@ else\n   rm -rf conftest*\n   echo \"$ac_t\"\"no\" 1>&6\n    echo $ac_n \"checking for global timezone variable\"\"... $ac_c\" 1>&6\n-echo \"configure:5519: checking for global timezone variable\" >&5\n+echo \"configure:5559: checking for global timezone variable\" >&5\n             cat > conftest.$ac_ext <<EOF\n-#line 5521 \"configure\"\n+#line 5561 \"configure\"\n #include \"confdefs.h\"\n #include <time.h>\n int main() {\n long z2 = timezone;\n ; return 0; }\n EOF\n-if { (eval echo configure:5528: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:5568: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_TIMEZONE 1\n@@ -5544,19 +5584,19 @@ rm -f conftest*\n # The Ultrix 4.2 mips builtin alloca declared by alloca.h only works\n # for constant arguments.  Useless!\n echo $ac_n \"checking for working alloca.h\"\"... $ac_c\" 1>&6\n-echo \"configure:5548: checking for working alloca.h\" >&5\n+echo \"configure:5588: checking for working alloca.h\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_alloca_h'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5553 \"configure\"\n+#line 5593 \"configure\"\n #include \"confdefs.h\"\n #include <alloca.h>\n int main() {\n char *p = alloca(2 * sizeof(int));\n ; return 0; }\n EOF\n-if { (eval echo configure:5560: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:5600: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_header_alloca_h=yes\n else\n@@ -5577,12 +5617,12 @@ EOF\n fi\n \n echo $ac_n \"checking for alloca\"\"... $ac_c\" 1>&6\n-echo \"configure:5581: checking for alloca\" >&5\n+echo \"configure:5621: checking for alloca\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_alloca_works'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5586 \"configure\"\n+#line 5626 \"configure\"\n #include \"confdefs.h\"\n \n #ifdef __GNUC__\n@@ -5610,7 +5650,7 @@ int main() {\n char *p = (char *) alloca(1);\n ; return 0; }\n EOF\n-if { (eval echo configure:5614: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:5654: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_func_alloca_works=yes\n else\n@@ -5642,12 +5682,12 @@ EOF\n \n \n echo $ac_n \"checking whether alloca needs Cray hooks\"\"... $ac_c\" 1>&6\n-echo \"configure:5646: checking whether alloca needs Cray hooks\" >&5\n+echo \"configure:5686: checking whether alloca needs Cray hooks\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_os_cray'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5651 \"configure\"\n+#line 5691 \"configure\"\n #include \"confdefs.h\"\n #if defined(CRAY) && ! defined(CRAY2)\n webecray\n@@ -5672,12 +5712,12 @@ echo \"$ac_t\"\"$ac_cv_os_cray\" 1>&6\n if test $ac_cv_os_cray = yes; then\n for ac_func in _getb67 GETB67 getb67; do\n   echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:5676: checking for $ac_func\" >&5\n+echo \"configure:5716: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5681 \"configure\"\n+#line 5721 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -5700,7 +5740,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:5704: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:5744: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -5727,15 +5767,15 @@ done\n fi\n \n echo $ac_n \"checking stack direction for C alloca\"\"... $ac_c\" 1>&6\n-echo \"configure:5731: checking stack direction for C alloca\" >&5\n+echo \"configure:5771: checking stack direction for C alloca\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_c_stack_direction'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test \"$cross_compiling\" = yes; then\n   ac_cv_c_stack_direction=0\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5739 \"configure\"\n+#line 5779 \"configure\"\n #include \"confdefs.h\"\n find_stack_direction ()\n {\n@@ -5754,7 +5794,7 @@ main ()\n   exit (find_stack_direction() < 0);\n }\n EOF\n-if { (eval echo configure:5758: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:5798: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   ac_cv_c_stack_direction=1\n else\n@@ -5781,7 +5821,7 @@ do\n # Extract the first word of \"$ac_prog\", so it can be a program name with args.\n set dummy $ac_prog; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:5785: checking for $ac_word\" >&5\n+echo \"configure:5825: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_PERL'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -5853,7 +5893,7 @@ fi\n # Uses ac_ vars as temps to allow command line to override cache and checks.\n # --without-x overrides everything else, but does not touch the cache.\n echo $ac_n \"checking for X\"\"... $ac_c\" 1>&6\n-echo \"configure:5857: checking for X\" >&5\n+echo \"configure:5897: checking for X\" >&5\n \n # Check whether --with-x or --without-x was given.\n if test \"${with_x+set}\" = set; then\n@@ -5915,12 +5955,12 @@ if test \"$ac_x_includes\" = NO; then\n \n   # First, try using that file with no special directory specified.\n cat > conftest.$ac_ext <<EOF\n-#line 5919 \"configure\"\n+#line 5959 \"configure\"\n #include \"confdefs.h\"\n #include <$x_direct_test_include>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:5924: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:5964: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -5989,14 +6029,14 @@ if test \"$ac_x_libraries\" = NO; then\n   ac_save_LIBS=\"$LIBS\"\n   LIBS=\"-l$x_direct_test_library $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 5993 \"configure\"\n+#line 6033 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n ${x_direct_test_function}()\n ; return 0; }\n EOF\n-if { (eval echo configure:6000: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6040: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   LIBS=\"$ac_save_LIBS\"\n # We can link X programs with no special library path.\n@@ -6102,17 +6142,17 @@ else\n     case \"`(uname -sr) 2>/dev/null`\" in\n     \"SunOS 5\"*)\n       echo $ac_n \"checking whether -R must be followed by a space\"\"... $ac_c\" 1>&6\n-echo \"configure:6106: checking whether -R must be followed by a space\" >&5\n+echo \"configure:6146: checking whether -R must be followed by a space\" >&5\n       ac_xsave_LIBS=\"$LIBS\"; LIBS=\"$LIBS -R$x_libraries\"\n       cat > conftest.$ac_ext <<EOF\n-#line 6109 \"configure\"\n+#line 6149 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n \n ; return 0; }\n EOF\n-if { (eval echo configure:6116: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6156: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_R_nospace=yes\n else\n@@ -6128,14 +6168,14 @@ rm -f conftest*\n       else\n \tLIBS=\"$ac_xsave_LIBS -R $x_libraries\"\n \tcat > conftest.$ac_ext <<EOF\n-#line 6132 \"configure\"\n+#line 6172 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n \n ; return 0; }\n EOF\n-if { (eval echo configure:6139: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6179: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_R_space=yes\n else\n@@ -6167,15 +6207,15 @@ rm -f conftest*\n     # libraries were built with DECnet support.  And karl@cs.umb.edu says\n     # the Alpha needs dnet_stub (dnet does not exist).\n     echo $ac_n \"checking for dnet_ntoa in -ldnet\"\"... $ac_c\" 1>&6\n-echo \"configure:6171: checking for dnet_ntoa in -ldnet\" >&5\n+echo \"configure:6211: checking for dnet_ntoa in -ldnet\" >&5\n ac_lib_var=`echo dnet'_'dnet_ntoa | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-ldnet  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 6179 \"configure\"\n+#line 6219 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -6186,7 +6226,7 @@ int main() {\n dnet_ntoa()\n ; return 0; }\n EOF\n-if { (eval echo configure:6190: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6230: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -6208,15 +6248,15 @@ fi\n \n     if test $ac_cv_lib_dnet_dnet_ntoa = no; then\n       echo $ac_n \"checking for dnet_ntoa in -ldnet_stub\"\"... $ac_c\" 1>&6\n-echo \"configure:6212: checking for dnet_ntoa in -ldnet_stub\" >&5\n+echo \"configure:6252: checking for dnet_ntoa in -ldnet_stub\" >&5\n ac_lib_var=`echo dnet_stub'_'dnet_ntoa | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-ldnet_stub  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 6220 \"configure\"\n+#line 6260 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -6227,7 +6267,7 @@ int main() {\n dnet_ntoa()\n ; return 0; }\n EOF\n-if { (eval echo configure:6231: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6271: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -6256,12 +6296,12 @@ fi\n     # The nsl library prevents programs from opening the X display\n     # on Irix 5.2, according to dickey@clark.net.\n     echo $ac_n \"checking for gethostbyname\"\"... $ac_c\" 1>&6\n-echo \"configure:6260: checking for gethostbyname\" >&5\n+echo \"configure:6300: checking for gethostbyname\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_gethostbyname'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 6265 \"configure\"\n+#line 6305 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char gethostbyname(); below.  */\n@@ -6284,7 +6324,7 @@ gethostbyname();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:6288: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6328: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_gethostbyname=yes\"\n else\n@@ -6305,15 +6345,15 @@ fi\n \n     if test $ac_cv_func_gethostbyname = no; then\n       echo $ac_n \"checking for gethostbyname in -lnsl\"\"... $ac_c\" 1>&6\n-echo \"configure:6309: checking for gethostbyname in -lnsl\" >&5\n+echo \"configure:6349: checking for gethostbyname in -lnsl\" >&5\n ac_lib_var=`echo nsl'_'gethostbyname | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lnsl  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 6317 \"configure\"\n+#line 6357 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -6324,7 +6364,7 @@ int main() {\n gethostbyname()\n ; return 0; }\n EOF\n-if { (eval echo configure:6328: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6368: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -6354,12 +6394,12 @@ fi\n     # -lsocket must be given before -lnsl if both are needed.\n     # We assume that if connect needs -lnsl, so does gethostbyname.\n     echo $ac_n \"checking for connect\"\"... $ac_c\" 1>&6\n-echo \"configure:6358: checking for connect\" >&5\n+echo \"configure:6398: checking for connect\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_connect'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 6363 \"configure\"\n+#line 6403 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char connect(); below.  */\n@@ -6382,7 +6422,7 @@ connect();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:6386: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6426: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_connect=yes\"\n else\n@@ -6403,15 +6443,15 @@ fi\n \n     if test $ac_cv_func_connect = no; then\n       echo $ac_n \"checking for connect in -lsocket\"\"... $ac_c\" 1>&6\n-echo \"configure:6407: checking for connect in -lsocket\" >&5\n+echo \"configure:6447: checking for connect in -lsocket\" >&5\n ac_lib_var=`echo socket'_'connect | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lsocket $X_EXTRA_LIBS $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 6415 \"configure\"\n+#line 6455 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -6422,7 +6462,7 @@ int main() {\n connect()\n ; return 0; }\n EOF\n-if { (eval echo configure:6426: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6466: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -6446,12 +6486,12 @@ fi\n \n     # gomez@mi.uni-erlangen.de says -lposix is necessary on A/UX.\n     echo $ac_n \"checking for remove\"\"... $ac_c\" 1>&6\n-echo \"configure:6450: checking for remove\" >&5\n+echo \"configure:6490: checking for remove\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_remove'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 6455 \"configure\"\n+#line 6495 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char remove(); below.  */\n@@ -6474,7 +6514,7 @@ remove();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:6478: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6518: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_remove=yes\"\n else\n@@ -6495,15 +6535,15 @@ fi\n \n     if test $ac_cv_func_remove = no; then\n       echo $ac_n \"checking for remove in -lposix\"\"... $ac_c\" 1>&6\n-echo \"configure:6499: checking for remove in -lposix\" >&5\n+echo \"configure:6539: checking for remove in -lposix\" >&5\n ac_lib_var=`echo posix'_'remove | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lposix  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 6507 \"configure\"\n+#line 6547 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -6514,7 +6554,7 @@ int main() {\n remove()\n ; return 0; }\n EOF\n-if { (eval echo configure:6518: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6558: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -6538,12 +6578,12 @@ fi\n \n     # BSDI BSD/OS 2.1 needs -lipc for XOpenDisplay.\n     echo $ac_n \"checking for shmat\"\"... $ac_c\" 1>&6\n-echo \"configure:6542: checking for shmat\" >&5\n+echo \"configure:6582: checking for shmat\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_shmat'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 6547 \"configure\"\n+#line 6587 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char shmat(); below.  */\n@@ -6566,7 +6606,7 @@ shmat();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:6570: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6610: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_shmat=yes\"\n else\n@@ -6587,15 +6627,15 @@ fi\n \n     if test $ac_cv_func_shmat = no; then\n       echo $ac_n \"checking for shmat in -lipc\"\"... $ac_c\" 1>&6\n-echo \"configure:6591: checking for shmat in -lipc\" >&5\n+echo \"configure:6631: checking for shmat in -lipc\" >&5\n ac_lib_var=`echo ipc'_'shmat | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lipc  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 6599 \"configure\"\n+#line 6639 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -6606,7 +6646,7 @@ int main() {\n shmat()\n ; return 0; }\n EOF\n-if { (eval echo configure:6610: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6650: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -6639,15 +6679,15 @@ fi\n   # libraries we check for below, so use a different variable.\n   #  --interran@uluru.Stanford.EDU, kb@cs.umb.edu.\n   echo $ac_n \"checking for IceConnectionNumber in -lICE\"\"... $ac_c\" 1>&6\n-echo \"configure:6643: checking for IceConnectionNumber in -lICE\" >&5\n+echo \"configure:6683: checking for IceConnectionNumber in -lICE\" >&5\n ac_lib_var=`echo ICE'_'IceConnectionNumber | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lICE $X_EXTRA_LIBS $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 6651 \"configure\"\n+#line 6691 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -6658,7 +6698,7 @@ int main() {\n IceConnectionNumber()\n ; return 0; }\n EOF\n-if { (eval echo configure:6662: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:6702: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -6840,7 +6880,7 @@ done\n ac_given_srcdir=$srcdir\n ac_given_INSTALL=\"$INSTALL\"\n \n-trap 'rm -fr `echo \"Makefile libgcj.spec libgcj-test.spec gnu/classpath/Configuration.java gcj/Makefile include/Makefile testsuite/Makefile include/config.h\" | sed \"s/:[^ ]*//g\"` conftest*; exit 1' 1 2 15\n+trap 'rm -fr `echo \"Makefile libgcj.spec libgcj-test.spec gnu/classpath/Configuration.java gcj/Makefile include/Makefile testsuite/Makefile include/config.h gcj/libgcj-config.h\" | sed \"s/:[^ ]*//g\"` conftest*; exit 1' 1 2 15\n EOF\n cat >> $CONFIG_STATUS <<EOF\n \n@@ -6923,6 +6963,7 @@ s%@subdirs@%$subdirs%g\n s%@COMPPATH@%$COMPPATH%g\n s%@TESTSUBDIR_TRUE@%$TESTSUBDIR_TRUE%g\n s%@TESTSUBDIR_FALSE@%$TESTSUBDIR_FALSE%g\n+s%@HASH_SYNC_SPEC@%$HASH_SYNC_SPEC%g\n s%@LIBGCJDEBUG@%$LIBGCJDEBUG%g\n s%@LIBDATASTARTSPEC@%$LIBDATASTARTSPEC%g\n s%@CPP@%$CPP%g\n@@ -7098,7 +7139,7 @@ ac_eD='%g'\n if test \"${CONFIG_HEADERS+set}\" != set; then\n EOF\n cat >> $CONFIG_STATUS <<EOF\n-  CONFIG_HEADERS=\"include/config.h\"\n+  CONFIG_HEADERS=\"include/config.h gcj/libgcj-config.h\"\n EOF\n cat >> $CONFIG_STATUS <<\\EOF\n fi\n@@ -7243,7 +7284,15 @@ CXX=\"${CXX}\"\n \n EOF\n cat >> $CONFIG_STATUS <<\\EOF\n-test -z \"$CONFIG_HEADERS\" || echo timestamp > include/stamp-h\n+am_indx=1\n+for am_file in include/config.h gcj/libgcj-config.h; do\n+  case \" $CONFIG_HEADERS \" in\n+  *\" $am_file \"*)\n+    echo timestamp > `echo $am_file | sed -e 's%:.*%%' -e 's%[^/]*$%%'`stamp-h$am_indx\n+    ;;\n+  esac\n+  am_indx=`expr \"$am_indx\" + 1`\n+done\n if test -n \"$CONFIG_FILES\"; then\n   ac_file=Makefile . ${libgcj_basedir}/../config-ml.in\n fi"}, {"sha": "079cccebad29a5f0cc3b65c4eee17acca8c47bb4", "filename": "libjava/configure.host", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fconfigure.host", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fconfigure.host", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fconfigure.host?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -24,6 +24,8 @@ libgcj_cflags=\n libgcj_cxxflags=\n libgcj_javaflags=\n libgcj_interpreter=\n+enable_java_net_default=yes\n+enable_hash_synchronization_default=no\n \n case \"${target_optspace}:${host}\" in\n   yes:*)\n@@ -63,6 +65,7 @@ case \"${host}\" in\n \tlibgcj_cxxflags=\"-D__NO_MATH_INLINES\"\n \tlibgcj_cflags=\"-D__NO_MATH_INLINES\"\n \tDIVIDESPEC=-fno-use-divide-subroutine\n+\tenable_hash_synchronization_default=yes\n \t;;\n   alpha*-*)\n \tlibgcj_flags=\"${libgcj_flags} -mieee\"\n@@ -76,6 +79,7 @@ case \"${host}\" in\n   ia64-*)\n         libgcj_flags=\"${libgcj_flags} -funwind-tables\"\n \tlibgcj_interpreter=yes\n+\tenable_hash_synchronization_default=yes\n \t;;\n esac\n "}, {"sha": "90837b3056f821f3c86d8288c2e420bd411b52a8", "filename": "libjava/configure.in", "status": "modified", "additions": 22, "deletions": 3, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fconfigure.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fconfigure.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fconfigure.in?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -16,7 +16,7 @@ AC_ARG_WITH(cross-host,\n \n LIBGCJ_CONFIGURE(.)\n \n-AM_CONFIG_HEADER(include/config.h)\n+AM_CONFIG_HEADER(include/config.h gcj/libgcj-config.h)\n \n # Only use libltdl for native builds.\n if test -z \"${with_cross_host}\"; then\n@@ -57,13 +57,32 @@ AC_ARG_ENABLE(getenv-properties,\n                           don't set system properties from GCJ_PROPERTIES])\n \n dnl Whether GCJ_PROPERTIES is used depends on the target.\n-if test -n \"$enable_getenv_properties\"; then\n+if test -z \"$enable_getenv_properties\"; then\n    enable_getenv_properties=${enable_getenv_properties_default-yes}\n fi\n if test \"$enable_getenv_properties\" = no; then\n    AC_DEFINE(DISABLE_GETENV_PROPERTIES)\n fi\n \n+\n+dnl Should we use hashtable-based synchronization?\n+dnl Currently works only for Linux X86/ia64\n+dnl Typically faster and more space-efficient\n+AC_ARG_ENABLE(hash-synchronization,\n+[  --enable-hash-synchronization\n+                          Use global hash table for monitor locks])\n+\n+if test -z \"$enable_hash_synchronization\"; then\n+   enable_hash_synchronization=$enable_hash_synchronization_default\n+fi\n+HASH_SYNC_SPEC=\n+if test \"$enable_hash_synchronization\" = yes; then\n+   HASH_SYNC_SPEC=-fhash-synchronization\n+   AC_DEFINE(JV_HASH_SYNCHRONIZATION)\n+fi\n+AC_SUBST(HASH_SYNC_SPEC)\n+\n+\n dnl See if the user has requested runtime debugging.\n LIBGCJDEBUG=\"false\"\n AC_SUBST(LIBGCJDEBUG)\n@@ -150,7 +169,7 @@ AC_ARG_ENABLE(java-net,\n [  --disable-java-net      disable java.net])\n \n dnl Whether java.net is built by default can depend on the target.\n-if test -n \"$enable_java_net\"; then\n+if test -z \"$enable_java_net\"; then\n    enable_java_net=${enable_java_net_default-yes}\n fi\n if test \"$enable_java_net\" = no; then"}, {"sha": "edf14cb098e1ead361572db782992e1ec5f2e430", "filename": "libjava/defineclass.cc", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fdefineclass.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fdefineclass.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fdefineclass.cc?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -360,8 +360,8 @@ _Jv_ClassReader::parse ()\n \n void _Jv_ClassReader::read_constpool ()\n {\n-  tags    = (unsigned char*) _Jv_AllocBytesChecked (pool_count);\n-  offsets = (unsigned int *) _Jv_AllocBytesChecked (sizeof (int)\n+  tags    = (unsigned char*) _Jv_AllocBytes (pool_count);\n+  offsets = (unsigned int *) _Jv_AllocBytes (sizeof (int)\n \t\t\t\t\t\t    * pool_count) ;\n \n   /** first, we scan the constant pool, collecting tags and offsets */\n@@ -625,9 +625,9 @@ void _Jv_ClassReader::handleConstantPool ()\n   /** now, we actually define the class' constant pool */\n \n   // the pool is scanned explicitly by the collector\n-  jbyte *pool_tags = (jbyte*) _Jv_AllocBytesChecked (pool_count);\n+  jbyte *pool_tags = (jbyte*) _Jv_AllocBytes (pool_count);\n   _Jv_word *pool_data\n-    = (_Jv_word*) _Jv_AllocBytesChecked (pool_count * sizeof (_Jv_word));\n+    = (_Jv_word*) _Jv_AllocBytes (pool_count * sizeof (_Jv_word));\n   \n   def->constants.tags = pool_tags;\n   def->constants.data = pool_data;\n@@ -965,7 +965,7 @@ _Jv_ClassReader::checkExtends (jclass sub, jclass super)\n \n void _Jv_ClassReader::handleInterfacesBegin (int count)\n {\n-  def->interfaces = (jclass*) _Jv_AllocBytesChecked (count*sizeof (jclass));\n+  def->interfaces = (jclass*) _Jv_AllocBytes (count*sizeof (jclass));\n   def->interface_count = count;\n }\n \n@@ -1032,10 +1032,10 @@ _Jv_ClassReader::checkImplements (jclass sub, jclass super)\n void _Jv_ClassReader::handleFieldsBegin (int count)\n {\n   def->fields = (_Jv_Field*) \n-    _Jv_AllocBytesChecked (count * sizeof (_Jv_Field));\n+    _Jv_AllocBytes (count * sizeof (_Jv_Field));\n   def->field_count = count;\n   def->field_initializers = (_Jv_ushort*)\n-    _Jv_AllocBytesChecked (count * sizeof (_Jv_ushort));\n+    _Jv_AllocBytes (count * sizeof (_Jv_ushort));\n   for (int i = 0; i < count; i++)\n     def->field_initializers[i] = (_Jv_ushort) 0;\n }\n@@ -1172,11 +1172,11 @@ void\n _Jv_ClassReader::handleMethodsBegin (int count)\n {\n   def->methods = (_Jv_Method*)\n-    _Jv_AllocBytesChecked (sizeof (_Jv_Method)*count);\n+    _Jv_AllocBytes (sizeof (_Jv_Method)*count);\n \n   def->interpreted_methods\n-    = (_Jv_MethodBase **) _Jv_AllocBytesChecked (sizeof (_Jv_MethodBase *)\n-\t\t\t\t\t\t * count);\n+    = (_Jv_MethodBase **) _Jv_AllocBytes (sizeof (_Jv_MethodBase *)\n+\t\t\t\t\t  * count);\n \n   for (int i = 0; i < count; i++)\n     def->interpreted_methods[i] = 0;\n@@ -1235,7 +1235,7 @@ void _Jv_ClassReader::handleCodeAttribute\n {\n   int size = _Jv_InterpMethod::size (exc_table_length, code_length);\n   _Jv_InterpMethod *method = \n-    (_Jv_InterpMethod*) (_Jv_AllocBytesChecked (size));\n+    (_Jv_InterpMethod*) (_Jv_AllocBytes (size));\n \n   method->max_stack      = max_stack;\n   method->max_locals     = max_locals;\n@@ -1282,7 +1282,7 @@ void _Jv_ClassReader::handleMethodsEnd ()\n \t  else\n \t    {\n \t      _Jv_JNIMethod *m = (_Jv_JNIMethod *)\n-\t\t_Jv_AllocBytesChecked (sizeof (_Jv_JNIMethod));\n+\t\t_Jv_AllocBytes (sizeof (_Jv_JNIMethod));\n \t      m->defining_class = def;\n \t      m->self = method;\n \t      m->function = NULL;"}, {"sha": "aa5f6fb16cbff38f8cd00c0003dd553b965ece56", "filename": "libjava/gcj/Makefile.am", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fgcj%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fgcj%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgcj%2FMakefile.am?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -3,4 +3,4 @@\n AUTOMAKE_OPTIONS = foreign\n \n gcjdir = $(includedir)/gcj\n-gcj_HEADERS = array.h cni.h field.h javaprims.h method.h\n+gcj_HEADERS = array.h cni.h field.h javaprims.h method.h libgcj-config.h"}, {"sha": "1b58ce4ab2f4ec8b6e0fb050549058dcf29f0b13", "filename": "libjava/gcj/Makefile.in", "status": "modified", "additions": 49, "deletions": 16, "changes": 65, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fgcj%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fgcj%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgcj%2FMakefile.in?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -85,6 +85,7 @@ GCLIBS = @GCLIBS@\n GCOBJS = @GCOBJS@\n GCSPEC = @GCSPEC@\n GCTESTSPEC = @GCTESTSPEC@\n+HASH_SYNC_SPEC = @HASH_SYNC_SPEC@\n INCLTDL = @INCLTDL@\n JC1GCSPEC = @JC1GCSPEC@\n LIBDATASTARTSPEC = @LIBDATASTARTSPEC@\n@@ -123,13 +124,13 @@ libgcj_basedir = @libgcj_basedir@\n AUTOMAKE_OPTIONS = foreign\n \n gcjdir = $(includedir)/gcj\n-gcj_HEADERS = array.h cni.h field.h javaprims.h method.h\n+gcj_HEADERS = array.h cni.h field.h javaprims.h method.h libgcj-config.h\n mkinstalldirs = $(SHELL) $(top_srcdir)/../mkinstalldirs\n-CONFIG_HEADER = ../include/config.h\n+CONFIG_HEADER = ../include/config.h libgcj-config.h\n CONFIG_CLEAN_FILES = \n HEADERS =  $(gcj_HEADERS)\n \n-DIST_COMMON =  Makefile.am Makefile.in\n+DIST_COMMON =  ./stamp-h2.in Makefile.am Makefile.in libgcj-config.h.in\n \n \n DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)\n@@ -146,6 +147,34 @@ Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status $(BUILT_SOURCES)\n \t  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status\n \n \n+libgcj-config.h: stamp-h2\n+\t@if test ! -f $@; then \\\n+\t\trm -f stamp-h2; \\\n+\t\t$(MAKE) stamp-h2; \\\n+\telse :; fi\n+stamp-h2: $(srcdir)/libgcj-config.h.in $(top_builddir)/config.status\n+\tcd $(top_builddir) \\\n+\t  && CONFIG_FILES= CONFIG_HEADERS=gcj/libgcj-config.h \\\n+\t     $(SHELL) ./config.status\n+\t@echo timestamp > stamp-h2 2> /dev/null\n+$(srcdir)/libgcj-config.h.in: @MAINTAINER_MODE_TRUE@$(srcdir)/stamp-h2.in\n+\t@if test ! -f $@; then \\\n+\t\trm -f $(srcdir)/stamp-h2.in; \\\n+\t\t$(MAKE) $(srcdir)/stamp-h2.in; \\\n+\telse :; fi\n+$(srcdir)/stamp-h2.in: $(top_srcdir)/configure.in $(ACLOCAL_M4) \n+\tcd $(top_srcdir) && $(AUTOHEADER)\n+\t@echo timestamp > $(srcdir)/stamp-h2.in 2> /dev/null\n+\n+mostlyclean-hdr:\n+\n+clean-hdr:\n+\n+distclean-hdr:\n+\t-rm -f libgcj-config.h\n+\n+maintainer-clean-hdr:\n+\n install-gcjHEADERS: $(gcj_HEADERS)\n \t@$(NORMAL_INSTALL)\n \t$(mkinstalldirs) $(DESTDIR)$(gcjdir)\n@@ -171,15 +200,15 @@ ID: $(HEADERS) $(SOURCES) $(LISP)\n \there=`pwd` && cd $(srcdir) \\\n \t  && mkid -f$$here/ID $$unique $(LISP)\n \n-TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) $(LISP)\n+TAGS:  $(HEADERS) $(SOURCES) libgcj-config.h.in $(TAGS_DEPENDENCIES) $(LISP)\n \ttags=; \\\n \there=`pwd`; \\\n \tlist='$(SOURCES) $(HEADERS)'; \\\n \tunique=`for i in $$list; do echo $$i; done | \\\n \t  awk '    { files[$$0] = 1; } \\\n \t       END { for (i in files) print i; }'`; \\\n-\ttest -z \"$(ETAGS_ARGS)$$unique$(LISP)$$tags\" \\\n-\t  || (cd $(srcdir) && etags $(ETAGS_ARGS) $$tags  $$unique $(LISP) -o $$here/TAGS)\n+\ttest -z \"$(ETAGS_ARGS)libgcj-config.h.in$$unique$(LISP)$$tags\" \\\n+\t  || (cd $(srcdir) && etags $(ETAGS_ARGS) $$tags libgcj-config.h.in $$unique $(LISP) -o $$here/TAGS)\n \n mostlyclean-tags:\n \n@@ -218,6 +247,9 @@ check-am: all-am\n check: check-am\n installcheck-am:\n installcheck: installcheck-am\n+all-recursive-am: libgcj-config.h\n+\t$(MAKE) $(AM_MAKEFLAGS) all-recursive\n+\n install-exec-am:\n install-exec: install-exec-am\n \n@@ -229,7 +261,7 @@ install-am: all-am\n install: install-am\n uninstall-am: uninstall-gcjHEADERS\n uninstall: uninstall-am\n-all-am: Makefile $(HEADERS)\n+all-am: Makefile $(HEADERS) libgcj-config.h\n all-redirect: all-am\n install-strip:\n \t$(MAKE) $(AM_MAKEFLAGS) AM_INSTALL_PROGRAM_FLAGS=-s install\n@@ -246,31 +278,32 @@ distclean-generic:\n \t-rm -f config.cache config.log stamp-h stamp-h[0-9]*\n \n maintainer-clean-generic:\n-mostlyclean-am:  mostlyclean-tags mostlyclean-generic\n+mostlyclean-am:  mostlyclean-hdr mostlyclean-tags mostlyclean-generic\n \n mostlyclean: mostlyclean-am\n \n-clean-am:  clean-tags clean-generic mostlyclean-am\n+clean-am:  clean-hdr clean-tags clean-generic mostlyclean-am\n \n clean: clean-am\n \n-distclean-am:  distclean-tags distclean-generic clean-am\n+distclean-am:  distclean-hdr distclean-tags distclean-generic clean-am\n \t-rm -f libtool\n \n distclean: distclean-am\n \n-maintainer-clean-am:  maintainer-clean-tags maintainer-clean-generic \\\n-\t\tdistclean-am\n+maintainer-clean-am:  maintainer-clean-hdr maintainer-clean-tags \\\n+\t\tmaintainer-clean-generic distclean-am\n \t@echo \"This command is intended for maintainers to use;\"\n \t@echo \"it deletes files that may require special tools to rebuild.\"\n \n maintainer-clean: maintainer-clean-am\n \n-.PHONY: uninstall-gcjHEADERS install-gcjHEADERS tags mostlyclean-tags \\\n+.PHONY: mostlyclean-hdr distclean-hdr clean-hdr maintainer-clean-hdr \\\n+uninstall-gcjHEADERS install-gcjHEADERS tags mostlyclean-tags \\\n distclean-tags clean-tags maintainer-clean-tags distdir info-am info \\\n-dvi-am dvi check check-am installcheck-am installcheck install-exec-am \\\n-install-exec install-data-am install-data install-am install \\\n-uninstall-am uninstall all-redirect all-am all installdirs \\\n+dvi-am dvi check check-am installcheck-am installcheck all-recursive-am \\\n+install-exec-am install-exec install-data-am install-data install-am \\\n+install uninstall-am uninstall all-redirect all-am all installdirs \\\n mostlyclean-generic distclean-generic clean-generic \\\n maintainer-clean-generic clean mostlyclean distclean maintainer-clean\n "}, {"sha": "a6111f8f777e71d9b917b670ba3e580204db8cc2", "filename": "libjava/gcj/javaprims.h", "status": "modified", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fgcj%2Fjavaprims.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fgcj%2Fjavaprims.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgcj%2Fjavaprims.h?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -1,6 +1,6 @@\n // javaprims.h - Main external header file for libgcj.  -*- c++ -*-\n \n-/* Copyright (C) 1998, 1999, 2000  Free Software Foundation\n+/* Copyright (C) 1998, 1999, 2000, 2001  Free Software Foundation\n \n    This file is part of libgcj.\n \n@@ -14,6 +14,8 @@ details.  */\n // Force C++ compiler to use Java-style exceptions.\n #pragma GCC java_exceptions\n \n+#include <gcj/libgcj-config.h>\n+\n // FIXME: this is a hack until we get a proper gcjh.\n // It is needed to work around system header files that define TRUE\n // and FALSE.\n@@ -367,14 +369,24 @@ typedef struct _Jv_Field *jfieldID;\n typedef struct _Jv_Method *jmethodID;\n \n extern \"C\" jobject _Jv_AllocObject (jclass, jint) __attribute__((__malloc__));\n+#ifdef JV_HASH_SYNCHRONIZATION\n+  extern \"C\" jobject _Jv_AllocPtrFreeObject (jclass, jint)\n+  \t\t\t    __attribute__((__malloc__));\n+#else\n+  // Collector still needs to scan sync_info\n+  static inline jobject _Jv_AllocPtrFreeObject (jclass klass, jint sz)\n+  {\n+    return _Jv_AllocObject(klass, sz);\n+  }\n+#endif\n extern \"C\" jboolean _Jv_IsInstanceOf(jobject, jclass);\n extern \"C\" jstring _Jv_AllocString(jsize) __attribute__((__malloc__));\n extern \"C\" jstring _Jv_NewString (const jchar*, jsize)\n   __attribute__((__malloc__));\n extern jint _Jv_FormatInt (jchar* bufend, jint num);\n extern \"C\" jchar* _Jv_GetStringChars (jstring str);\n-extern \"C\" jint _Jv_MonitorEnter (jobject);\n-extern \"C\" jint _Jv_MonitorExit (jobject);\n+extern \"C\" void _Jv_MonitorEnter (jobject);\n+extern \"C\" void _Jv_MonitorExit (jobject);\n extern \"C\" jstring _Jv_NewStringLatin1(const char*, jsize)\n   __attribute__((__malloc__));\n extern \"C\" jsize _Jv_GetStringUTFLength (jstring);\n@@ -400,4 +412,5 @@ struct _Jv_Utf8Const\n   char data[1];\t\t/* In Utf8 format, with final '\\0'. */\n };\n \n+\n #endif /* __JAVAPRIMS_H__ */"}, {"sha": "8bc71e7a2e167dccb145ca1b6cf14d17bf1b6a46", "filename": "libjava/gcj/libgcj-config.h.in", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fgcj%2Flibgcj-config.h.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fgcj%2Flibgcj-config.h.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgcj%2Flibgcj-config.h.in?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -0,0 +1,5 @@\n+/* The header derived from this file is installed, so this file should\n+   only contain defines which are named safely.  */\n+\n+/* Define if hash synchronization is in use.  */\n+#undef JV_HASH_SYNCHRONIZATION"}, {"sha": "a911f316b77a63d7ffdb21dbaa7e3214757d64b4", "filename": "libjava/include/Makefile.in", "status": "modified", "additions": 13, "deletions": 12, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Finclude%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Finclude%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Finclude%2FMakefile.in?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -85,6 +85,7 @@ GCLIBS = @GCLIBS@\n GCOBJS = @GCOBJS@\n GCSPEC = @GCSPEC@\n GCTESTSPEC = @GCTESTSPEC@\n+HASH_SYNC_SPEC = @HASH_SYNC_SPEC@\n INCLTDL = @INCLTDL@\n JC1GCSPEC = @JC1GCSPEC@\n LIBDATASTARTSPEC = @LIBDATASTARTSPEC@\n@@ -124,11 +125,11 @@ AUTOMAKE_OPTIONS = foreign\n \n include_HEADERS = jni.h jvmpi.h\n mkinstalldirs = $(SHELL) $(top_srcdir)/../mkinstalldirs\n-CONFIG_HEADER = config.h\n+CONFIG_HEADER = config.h ../gcj/libgcj-config.h\n CONFIG_CLEAN_FILES = \n HEADERS =  $(include_HEADERS)\n \n-DIST_COMMON =  ./stamp-h.in Makefile.am Makefile.in config.h.in\n+DIST_COMMON =  ./stamp-h1.in Makefile.am Makefile.in config.h.in\n \n \n DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)\n@@ -145,24 +146,24 @@ Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status $(BUILT_SOURCES)\n \t  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status\n \n \n-config.h: stamp-h\n+config.h: stamp-h1\n \t@if test ! -f $@; then \\\n-\t\trm -f stamp-h; \\\n-\t\t$(MAKE) stamp-h; \\\n+\t\trm -f stamp-h1; \\\n+\t\t$(MAKE) stamp-h1; \\\n \telse :; fi\n-stamp-h: $(srcdir)/config.h.in $(top_builddir)/config.status\n+stamp-h1: $(srcdir)/config.h.in $(top_builddir)/config.status\n \tcd $(top_builddir) \\\n \t  && CONFIG_FILES= CONFIG_HEADERS=include/config.h \\\n \t     $(SHELL) ./config.status\n-\t@echo timestamp > stamp-h 2> /dev/null\n-$(srcdir)/config.h.in: @MAINTAINER_MODE_TRUE@$(srcdir)/stamp-h.in\n+\t@echo timestamp > stamp-h1 2> /dev/null\n+$(srcdir)/config.h.in: @MAINTAINER_MODE_TRUE@$(srcdir)/stamp-h1.in\n \t@if test ! -f $@; then \\\n-\t\trm -f $(srcdir)/stamp-h.in; \\\n-\t\t$(MAKE) $(srcdir)/stamp-h.in; \\\n+\t\trm -f $(srcdir)/stamp-h1.in; \\\n+\t\t$(MAKE) $(srcdir)/stamp-h1.in; \\\n \telse :; fi\n-$(srcdir)/stamp-h.in: $(top_srcdir)/configure.in $(ACLOCAL_M4) \n+$(srcdir)/stamp-h1.in: $(top_srcdir)/configure.in $(ACLOCAL_M4) \n \tcd $(top_srcdir) && $(AUTOHEADER)\n-\t@echo timestamp > $(srcdir)/stamp-h.in 2> /dev/null\n+\t@echo timestamp > $(srcdir)/stamp-h1.in 2> /dev/null\n \n mostlyclean-hdr:\n "}, {"sha": "cd421a44358fa55bb51a3ea72c4b0c158d57bfa9", "filename": "libjava/include/boehm-gc.h", "status": "modified", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Finclude%2Fboehm-gc.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Finclude%2Fboehm-gc.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Finclude%2Fboehm-gc.h?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -21,4 +21,35 @@ extern \"C\"\n   JV_MARKARRAY_DECL;\n };\n \n+// Enough stuff to inline _Jv_AllocObj.  Ugly.\n+#include <gcj/javaprims.h>\n+#include <java/lang/Class.h>\n+#include <string.h>\n+\n+extern \"C\" void * GC_gcj_malloc(size_t, void *);\n+extern \"C\" void * GC_malloc_atomic(size_t);\n+\n+inline void *\n+_Jv_AllocObj (jsize size, jclass klass)\n+{\n+  // This should call GC_GCJ_MALLOC, but that would involve\n+  // including gc.h.\n+  return GC_gcj_malloc (size, klass->vtable);\n+}\n+\n+inline void *\n+_Jv_AllocPtrFreeObj (jsize size, jclass klass)\n+{\n+#ifdef JV_HASH_SYNCHRONIZATION\n+  void * obj = GC_malloc_atomic(size);\n+  *((_Jv_VTable **) obj) = klass->vtable;\n+#else\n+  void * obj = GC_gcj_malloc(size, klass->vtable);\n+#endif\n+  return obj;\n+}\n+\n+// _Jv_AllocBytes (jsize size) should go here, too.  But clients don't\n+// usually include this header.\n+\n #endif /* __JV_BOEHM_GC__ */"}, {"sha": "9088df1a414b198ec4738a3c11cd16898681df10", "filename": "libjava/include/jvm.h", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Finclude%2Fjvm.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Finclude%2Fjvm.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Finclude%2Fjvm.h?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -107,10 +107,18 @@ typedef void _Jv_FinalizerFunc (jobject);\n \n /* Allocate space for a new Java object.  */\n void *_Jv_AllocObj (jsize size, jclass cl) __attribute__((__malloc__));\n+/* Allocate space for a potentially uninitialized pointer-free object.\n+   Interesting only with JV_HASH_SYNCHRONIZATION.  */\n+void *_Jv_AllocPtrFreeObj (jsize size, jclass cl) __attribute__((__malloc__));\n /* Allocate space for an array of Java objects.  */\n void *_Jv_AllocArray (jsize size, jclass cl) __attribute__((__malloc__));\n /* Allocate space that is known to be pointer-free.  */\n void *_Jv_AllocBytes (jsize size) __attribute__((__malloc__));\n+/* Explicitly throw an out-of-memory exception.\t*/\n+void _Jv_ThrowNoMemory();\n+/* Allocate an object with a single pointer.  The first word is reserved\n+   for the GC, and the second word is the traced pointer.  */\n+void *_Jv_AllocTraceOne (jsize size /* incl. reserved slot */);\n /* Initialize the GC.  */\n void _Jv_InitGC (void);\n /* Register a finalizer.  */\n@@ -157,9 +165,6 @@ void _Jv_SetInitialHeapSize (const char *arg);\n    _Jv_GCSetMaximumHeapSize.  */\n void _Jv_SetMaximumHeapSize (const char *arg);\n \n-/* Allocate some unscanned bytes.  Throw exception if out of memory.  */\n-void *_Jv_AllocBytesChecked (jsize size) __attribute__((__malloc__));\n-\n extern \"C\" void JvRunMain (jclass klass, int argc, const char **argv);\n void _Jv_RunMain (const char* name, int argc, const char **argv, bool is_jar);\n "}, {"sha": "e033209d0883ee343529ec311d575b8a5d94e6c6", "filename": "libjava/include/posix-threads.h", "status": "modified", "additions": 159, "deletions": 4, "changes": 163, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Finclude%2Fposix-threads.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Finclude%2Fposix-threads.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Finclude%2Fposix-threads.h?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -1,7 +1,7 @@\n // -*- c++ -*-\n // posix-threads.h - Defines for using POSIX threads.\n \n-/* Copyright (C) 1998, 1999  Free Software Foundation\n+/* Copyright (C) 1998, 1999, 2001  Free Software Foundation\n \n    This file is part of libgcj.\n \n@@ -106,10 +106,21 @@ _Jv_CondInit (_Jv_ConditionVariable_t *cv)\n // Mutexes.\n //\n \n+#ifdef LOCK_DEBUG\n+# include <stdio.h>\n+#endif\n+\n inline void\n _Jv_MutexInit (_Jv_Mutex_t *mu)\n {\n+# ifdef LOCK_DEBUG /* Assumes Linuxthreads */\n+  pthread_mutexattr_t attr;\n+  pthread_mutexattr_init(&attr);\n+  pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_ERRORCHECK);\n+  pthread_mutex_init (&mu->mutex, &attr);\n+# else\n   pthread_mutex_init (&mu->mutex, 0);\n+# endif\n \n   mu->count = 0;\n   mu->owner = 0;\n@@ -125,7 +136,16 @@ _Jv_MutexLock (_Jv_Mutex_t *mu)\n     }\n   else\n     {\n-      pthread_mutex_lock (&mu->mutex);\n+#     ifdef LOCK_DEBUG\n+\tint result = pthread_mutex_lock (&mu->mutex);\n+\tif (0 != result)\n+\t  {\n+\t    fprintf(stderr, \"Pthread_mutex_lock returned %d\\n\", result);\n+\t    for (;;) {}\n+\t  }\n+#     else\n+        pthread_mutex_lock (&mu->mutex);\n+#     endif\n       mu->count = 1;\n       mu->owner = self;\n     }\n@@ -136,14 +156,29 @@ inline int\n _Jv_MutexUnlock (_Jv_Mutex_t *mu)\n {\n   if (_Jv_PthreadCheckMonitor (mu))\n-    return 1;\n+    {\n+#     ifdef LOCK_DEBUG\n+\tfprintf(stderr, \"_Jv_MutexUnlock: Not owner\\n\");\n+\tfor (;;) {}\n+#     endif\n+      return 1;\n+    }\n     \n   mu->count--;\n \n   if (mu->count == 0)\n     {\n       mu->owner = 0;\n-      pthread_mutex_unlock (&mu->mutex);\n+#     ifdef LOCK_DEBUG\n+\tint result = pthread_mutex_unlock (&mu->mutex);\n+\tif (0 != result)\n+\t  {\n+\t    fprintf(stderr, \"Pthread_mutex_unlock returned %d\\n\", result);\n+\t    for (;;) {}\n+\t  }\n+#     else\n+        pthread_mutex_unlock (&mu->mutex);\n+#     endif\n     }\n   return 0;\n }\n@@ -179,6 +214,126 @@ _Jv_ThreadCurrent (void)\n   return (java::lang::Thread *) pthread_getspecific (_Jv_ThreadKey);\n }\n \n+#ifdef JV_HASH_SYNCHRONIZATION\n+// Should be specialized to just load the \"current thread\" register\n+// on platforms that support it.   Speed is of the essence.  The value\n+// of the descriptor is not, so long as there is a one-to-one correspondence\n+// to threads.\n+\n+\n+#ifdef __i386__\n+\n+#define SLOW_PTHREAD_SELF\n+\t// Add a cache for pthread_self() if we don't have the thread\n+\t// pointer in a register.\n+\n+#endif  /* __i386__ */\n+\n+#ifdef __ia64__\n+\n+typedef size_t _Jv_ThreadId_t;\n+\n+register size_t _Jv_self __asm__(\"r13\");\n+\t// For linux_threads this is really a pointer to its thread data\n+\t// structure.  We treat it as opaque.  That should also work\n+\t// on other operating systems that follow the ABI standard.\n+\n+// This should become the prototype for machines that maintain a thread\n+// pointer in a register.\n+inline _Jv_ThreadId_t\n+_Jv_ThreadSelf (void)\n+{\n+  return _Jv_self;\n+}\n+\n+#define JV_SELF_DEFINED\n+\n+#endif /* __ia64__ */\n+\n+#if defined(SLOW_PTHREAD_SELF)\n+\n+typedef pthread_t _Jv_ThreadId_t;\n+\n+// E.g. on X86 Linux, pthread_self() is too slow for our purpose.\n+// Instead we maintain a cache based on the current sp value.\n+// This is similar to what's done for thread local allocation in the\n+// GC, only far simpler.\n+// This code should probably go away when Linux/X86 starts using a\n+// segment register to hold the thread id.\n+# define LOG_THREAD_SPACING 12\n+\t\t\t// If two thread pointer values are closer than\n+\t\t\t// 1 << LOG_THREAD_SPACING, we assume they belong\n+\t\t\t// to the same thread.\n+# define SELF_CACHE_SIZE 1024\n+# define SC_INDEX(sp) (((unsigned long)(sp) >> 19) & (SELF_CACHE_SIZE-1))\n+\t\t        // Mapping from sp value to cache index.\n+\t\t\t// Note that this is not in any real sense a hash\n+\t\t\t// function, since we need to be able to clear\n+\t\t\t// all possibly matching slots on thread startup.\n+\t\t\t// Thus all entries that might correspond to\n+\t\t\t// a given thread are intentionally contiguous.\n+\t\t\t// Works well with anything that allocates at least\n+\t\t\t// 512KB stacks.\n+# define SC_CLEAR_MIN (-16)\t// When starting a new thread, we clear\n+# define SC_CLEAR_MAX 0\t\t// all self cache entries between\n+\t\t\t\t// SC_INDEX(sp)+SC_CLEAR_MIN and\n+\t\t\t\t// SC_INDEX(sp)+SC_CLEAR_MAX to ensure\n+\t\t\t\t// we never see stale values.  The\n+\t\t\t\t// current values assume a downward\n+\t\t\t\t// growing stack of size <= 7.5 MB.\n+# define BAD_HIGH_SP_VALUE ((size_t)(-1))\n+\n+extern volatile\n+struct self_cache_entry {\n+  size_t high_sp_bits;\t// sp value >> LOG_THREAD_SPACING\n+  pthread_t self;\t// Corresponding thread\n+} _Jv_self_cache[];\n+\n+void _Jv_Self_Cache_Init();\n+\n+_Jv_ThreadId_t\n+_Jv_ThreadSelf_out_of_line(volatile self_cache_entry *sce,\n+\t\t\t   size_t high_sp_bits);\n+  \n+inline _Jv_ThreadId_t\n+_Jv_ThreadSelf (void)\n+{\n+  int dummy;\n+  size_t sp = (size_t)(&dummy);\n+  unsigned h = SC_INDEX(sp);\n+  volatile self_cache_entry *sce = _Jv_self_cache + h;\n+  pthread_t candidate_self = sce -> self;  // Read must precede following one.\n+  // Read barrier goes here, if needed.\n+  if (sce -> high_sp_bits == sp >> LOG_THREAD_SPACING)\n+    {\n+      // The sce -> self value we read must be valid.  An intervening\n+      // cache replacement by another thread would have first replaced\n+      // high_sp_bits by something else, and it can't possibly change\n+      // back without our intervention.\n+      return candidate_self;\n+    }\n+  else\n+    return _Jv_ThreadSelf_out_of_line(sce, sp >> LOG_THREAD_SPACING);\n+}\n+\n+#define JV_SELF_DEFINED\n+\n+#endif /* SLOW_PTHREAD_SELF */\n+\n+#ifndef JV_SELF_DEFINED /* If all else fails, call pthread_self directly */\n+\n+typedef pthread_t _Jv_ThreadId_t;\n+\n+inline _Jv_ThreadId_t\n+_Jv_ThreadSelf (void)\n+{\n+  return pthread_self();\n+}\n+\n+#endif /* !JV_SELF_DEFINED */\n+\n+#endif /* JV_HASH_SYNCHRONIZATION */\n+\n inline _Jv_Thread_t *\n _Jv_ThreadCurrentData (void)\n {"}, {"sha": "4986dbf391bd83d190be02bdd377fb044012f20a", "filename": "libjava/java/lang/Class.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fjava%2Flang%2FClass.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fjava%2Flang%2FClass.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FClass.h?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -267,6 +267,7 @@ class java::lang::Class : public java::lang::Object\n \n   friend jobject _Jv_AllocObject (jclass, jint);\n   friend void *_Jv_AllocObj (jint, jclass);\n+  friend void *_Jv_AllocPtrFreeObj (jint, jclass);\n   friend void *_Jv_AllocArray (jint, jclass);\n \n   friend jobject _Jv_JNI_ToReflectedField (_Jv_JNIEnv *, jclass, jfieldID,"}, {"sha": "93e207fc467699c0a8efa7805da8f348688bc3f8", "filename": "libjava/java/lang/Object.h", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fjava%2Flang%2FObject.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fjava%2Flang%2FObject.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FObject.h?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -42,8 +42,8 @@ class java::lang::Object : public _JvObjectPrefix\n   void wait (void);\n   void wait (jlong timeout);\n \n-  friend jint _Jv_MonitorEnter (jobject obj);\n-  friend jint _Jv_MonitorExit (jobject obj);\n+  friend void _Jv_MonitorEnter (jobject obj);\n+  friend void _Jv_MonitorExit (jobject obj);\n   friend void _Jv_InitializeSyncMutex (void);\n   friend void _Jv_FinalizeObject (jobject obj);\n \n@@ -63,10 +63,12 @@ class java::lang::Object : public _JvObjectPrefix\n   // This does not actually refer to a Java object.  Instead it is a\n   // placeholder for a piece of internal data (the synchronization\n   // information).\n-  jobject sync_info;\n+# ifndef JV_HASH_SYNCHRONIZATION\n+    jobject sync_info;\n+# endif\n \n-  // Initialize the sync_info field.\n-  void sync_init (void);\n+    // Initialize the sync_info field.  Not called with JV_HASH_SYNCHRONIZATION.\n+    void sync_init (void);\n };\n \n #endif /* __JAVA_LANG_OBJECT_H__ */"}, {"sha": "fb2c6d45355eeb4f867956e6a3f75f7edafcf969", "filename": "libjava/java/lang/natObject.cc", "status": "modified", "additions": 941, "deletions": 11, "changes": 952, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fjava%2Flang%2FnatObject.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fjava%2Flang%2FnatObject.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FnatObject.cc?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -28,6 +28,10 @@ details.  */\n #include <java/lang/Cloneable.h>\n #include <java/lang/Thread.h>\n \n+#ifdef LOCK_DEBUG\n+#  include <stdio.h>\n+#endif\n+\n \f\n \n // This is used to represent synchronization information.\n@@ -100,11 +104,26 @@ java::lang::Object::clone (void)\n   return r;\n }\n \n+void\n+_Jv_FinalizeObject (jobject obj)\n+{\n+  // Ignore exceptions.  From section 12.6 of the Java Language Spec.\n+  try\n+    {\n+      obj->finalize ();\n+    }\n+  catch (java::lang::Throwable *t)\n+    {\n+      // Ignore.\n+    }\n+}\n+\n \n //\n // Synchronization code.\n //\n \n+#ifndef JV_HASH_SYNCHRONIZATION\n // This global is used to make sure that only one thread sets an\n // object's `sync_info' field.\n static _Jv_Mutex_t sync_mutex;\n@@ -153,7 +172,7 @@ java::lang::Object::sync_init (void)\n       // been finalized.  So if we just reinitialize the old one,\n       // we'll never be able to (re-)destroy the mutex and/or\n       // condition variable.\n-      si = (_Jv_SyncInfo *) _Jv_AllocBytesChecked (sizeof (_Jv_SyncInfo));\n+      si = (_Jv_SyncInfo *) _Jv_AllocBytes (sizeof (_Jv_SyncInfo));\n       _Jv_MutexInit (&si->mutex);\n       _Jv_CondInit (&si->condition);\n #if defined (_Jv_HaveCondDestroy) || defined (_Jv_HaveMutexDestroy)\n@@ -219,7 +238,7 @@ _Jv_InitializeSyncMutex (void)\n   _Jv_MutexInit (&sync_mutex);\n }\n \n-jint\n+void\n _Jv_MonitorEnter (jobject obj)\n {\n #ifndef HANDLE_SEGV\n@@ -229,30 +248,941 @@ _Jv_MonitorEnter (jobject obj)\n   if (__builtin_expect (INIT_NEEDED (obj), false))\n     obj->sync_init ();\n   _Jv_SyncInfo *si = (_Jv_SyncInfo *) obj->sync_info;\n-  return _Jv_MutexLock (&si->mutex);\n+  _Jv_MutexLock (&si->mutex);\n+  // FIXME: In the Windows case, this can return a nonzero error code.\n+  // We should turn that into some exception ...\n }\n \n-jint\n+void\n _Jv_MonitorExit (jobject obj)\n {\n   JvAssert (obj);\n   JvAssert (! INIT_NEEDED (obj));\n   _Jv_SyncInfo *si = (_Jv_SyncInfo *) obj->sync_info;\n   if (__builtin_expect (_Jv_MutexUnlock (&si->mutex), false))\n     throw new java::lang::IllegalMonitorStateException;\n-  return 0;\n }\n \n+#else /* JV_HASH_SYNCHRONIZATION */\n+\n+// FIXME: We shouldn't be calling GC_register_finalizer directly.\n+#ifndef HAVE_BOEHM_GC\n+# error Hash synchronization currently requires boehm-gc\n+// That's actually a bit of a lie: It should also work with the null GC,\n+// probably even better than the alternative.\n+// To really support alternate GCs here, we would need to widen the\n+// interface to finalization, since we sometimes have to register a\n+// second finalizer for an object that already has one.\n+// We might also want to move the GC interface to a .h file, since\n+// the number of procedure call levels involved in some of these\n+// operations is already ridiculous, and would become worse if we\n+// went through the proper intermediaries.\n+#else\n+# include \"gc.h\"\n+#endif\n+\n+// What follows currenly assumes a Linux-like platform.\n+// Some of it specifically assumes X86 or IA64 Linux, though that\n+// should be easily fixable.\n+\n+// A Java monitor implemention based on a table of locks.\n+// Each entry in the table describes\n+// locks held for objects that hash to that location.\n+// This started out as a reimplementation of the technique used in SGIs JVM,\n+// for which we obtained permission from SGI.\n+// But in fact, this ended up quite different, though some ideas are\n+// still shared with the original.\n+// It was also influenced by some of the published IBM work,\n+// though it also differs in many ways from that.\n+// We could speed this up if we had a way to atomically update\n+// an entire cache entry, i.e. 2 contiguous words of memory.\n+// That would usually be the case with a 32 bit ABI on a 64 bit processor.\n+// But we don't currently go out of our way to target those.\n+// I don't know how to do much better with a N bit ABI on a processor\n+// that can atomically update only N bits at a time.\n+// Author: Hans-J. Boehm  (Hans_Boehm@hp.com, boehm@acm.org)\n+\n+#include <assert.h>\n+#include <limits.h>\n+#include <unistd.h>\t// for usleep, sysconf.\n+#include <sched.h>\t// for sched_yield.\n+#include <gcj/javaprims.h>\n+\n+typedef size_t obj_addr_t;\t/* Integer type big enough for object\t*/\n+\t\t\t\t/* address.\t\t\t\t*/\n+\n+// The following should move to some standard place. Linux-threads\n+// already defines roughly these, as do more recent versions of boehm-gc.\n+// The problem is that neither exports them.\n+\n+#if defined(__GNUC__) && defined(__i386__)\n+  // Atomically replace *addr by new_val if it was initially equal to old.\n+  // Return true if the comparison succeeded.\n+  // Assumed to have acquire semantics, i.e. later memory operations\n+  // cannot execute before the compare_and_swap finishes.\n+  inline static bool\n+  compare_and_swap(volatile obj_addr_t *addr,\n+\t\t  \t\t\t\tobj_addr_t old,\n+\t\t\t\t\t\tobj_addr_t new_val) \n+  {\n+    char result;\n+    __asm__ __volatile__(\"lock; cmpxchgl %2, %0; setz %1\"\n+\t    \t: \"=m\"(*(addr)), \"=q\"(result)\n+\t\t: \"r\" (new_val), \"0\"(*(addr)), \"a\"(old) : \"memory\");\n+    return (bool) result;\n+  }\n+\n+  // Set *addr to new_val with release semantics, i.e. making sure\n+  // that prior loads and stores complete before this\n+  // assignment.\n+  // On X86, the hardware shouldn't reorder reads and writes,\n+  // so we just have to convince gcc not to do it either.\n+  inline static void\n+  release_set(volatile obj_addr_t *addr, obj_addr_t new_val)\n+  {\n+    __asm__ __volatile__(\" \" : : : \"memory\");\n+    *(addr) = new_val;\n+  }\n+\n+  // Compare_and_swap with release semantics instead of acquire semantics.\n+  // On many architecture, the operation makes both guarantees, so the\n+  // implementation can be the same.\n+  inline static bool\n+  compare_and_swap_release(volatile obj_addr_t *addr,\n+\t\t  \t\t\t\t       obj_addr_t old,\n+\t\t\t\t\t\t       obj_addr_t new_val)\n+  {\n+    return compare_and_swap(addr, old, new_val);\n+  }\n+#endif\n+\n+#if defined(__GNUC__) && defined(__ia64__) && SIZEOF_VOID_P == 8\n+  inline static bool\n+  compare_and_swap(volatile obj_addr_t *addr,\n+\t \t\t\t\t        obj_addr_t old,\n+\t\t\t\t\t\tobj_addr_t new_val) \n+  {\n+    unsigned long oldval;\n+    __asm__ __volatile__(\"mov ar.ccv=%4 ;; cmpxchg8.acq %0=%1,%2,ar.ccv\"\n+\t\t: \"=r\"(oldval), \"=m\"(*addr)\n+\t\t: \"r\"(new_val), \"1\"(*addr), \"r\"(old) : \"memory\");\n+    return (oldval == old);\n+  }\n+\n+  // The fact that *addr is volatile should cause the compiler to\n+  // automatically generate an st8.rel.\n+  inline static void\n+  release_set(volatile obj_addr_t *addr, obj_addr_t new_val)\n+  {\n+    __asm__ __volatile__(\" \" : : : \"memory\");\n+    *(addr) = new_val;\n+  }\n+\n+  inline static bool\n+  compare_and_swap_release(volatile obj_addr_t *addr,\n+\t \t\t\t\t               obj_addr_t old,\n+\t\t\t\t\t\t       obj_addr_t new_val) \n+  {\n+    unsigned long oldval;\n+    __asm__ __volatile__(\"mov ar.ccv=%4 ;; cmpxchg8.rel %0=%1,%2,ar.ccv\"\n+\t\t: \"=r\"(oldval), \"=m\"(*addr)\n+\t\t: \"r\"(new_val), \"1\"(*addr), \"r\"(old) : \"memory\");\n+    return (oldval == old);\n+  }\n+#endif\n+\n+// Try to determine whether we are on a multiprocessor, i.e. whether\n+// spinning may be profitable.\n+// This should really use a suitable autoconf macro.\n+// False is the conservative answer, though the right one is much better.\n+static bool\n+is_mp()\n+{\n+  long nprocs = sysconf(_SC_NPROCESSORS_ONLN);\n+  return (nprocs > 1);\n+}\n+\n+// A call to keep_live(p) forces p to be accessible to the GC\n+// at this point.\n+inline static void\n+keep_live(obj_addr_t p)\n+{\n+    __asm__ __volatile__(\"\" : : \"rm\"(p) : \"memory\");\n+}\n+\n+\n+// Each hash table entry holds a single preallocated \"lightweight\" lock.\n+// In addition, it holds a chain of \"heavyweight\" locks.  Lightweight\n+// locks do not support Object.wait(), and are converted to heavyweight\n+// status in response to contention.  Unlike the SGI scheme, both\n+// ligtweight and heavyweight locks in one hash entry can be simultaneously\n+// in use.  (The SGI scheme requires that we be able to acquire a heavyweight\n+// lock on behalf of another thread, and can thus convert a lock we don't\n+// hold to heavyweight status.  Here we don't insist on that, and thus\n+// let the original holder of the lighweight lock keep it.)\n+\n+struct heavy_lock {\n+  void * reserved_for_gc;\n+  struct heavy_lock *next;\t// Hash chain link.\n+\t\t\t\t// The only field traced by GC.\n+  obj_addr_t address;\t\t// Object to which this lock corresponds.\n+\t\t\t\t// Should not be traced by GC.\n+  _Jv_SyncInfo si;\n+  // The remaining fields save prior finalization info for\n+  // the object, which we needed to replace in order to arrange\n+  // for cleanup of the lock structure.\n+  GC_finalization_proc old_finalization_proc;\n+  void * old_client_data;\n+};\n+\n+#ifdef LOCK_DEBUG\n void\n-_Jv_FinalizeObject (jobject obj)\n+print_hl_list(heavy_lock *hl)\n {\n-  // Ignore exceptions.  From section 12.6 of the Java Language Spec.\n-  try\n+    heavy_lock *p = hl;\n+    for (; 0 != p; p = p->next)\n+      fprintf (stderr, \"(hl = %p, addr = %p)\", p, (void *)(p -> address));\n+}\n+#endif /* LOCK_DEBUG */\n+\n+#if defined (_Jv_HaveCondDestroy) || defined (_Jv_HaveMutexDestroy)\n+// If we have to run a destructor for a sync_info member, then this\n+// function is registered as a finalizer for the sync_info.\n+static void\n+heavy_lock_finalization_proc (jobject obj)\n+{\n+  heavy_lock *hl = (heavy_lock *) obj;\n+#if defined (_Jv_HaveCondDestroy)\n+  _Jv_CondDestroy (&hl->si.condition);\n+#endif\n+#if defined (_Jv_HaveMutexDestroy)\n+  _Jv_MutexDestroy (&hl->si.mutex);\n+#endif\n+  hl->si.init = false;\n+}\n+#endif /* defined (_Jv_HaveCondDestroy) || defined (_Jv_HaveMutexDestroy) */\n+\n+// We convert the lock back to lightweight status when\n+// we exit, so that a single contention episode doesn't doom the lock\n+// forever.  But we also need to make sure that lock structures for dead\n+// objects are eventually reclaimed.  We do that in a an additional\n+// finalizer on the underlying object.\n+// Note that if the corresponding object is dead, it is safe to drop\n+// the heavy_lock structure from its list.  It is not necessarily\n+// safe to deallocate it, since the unlock code could still be running.\n+\n+struct hash_entry {\n+  volatile obj_addr_t address;\t// Address of object for which lightweight\n+  \t\t\t\t// k is held.\n+\t\t\t\t// We assume the 3 low order bits are zero.\n+\t\t\t\t// With the Boehm collector and bitmap\n+\t\t\t\t// allocation, objects of size 4 bytes are\n+\t\t\t\t// broken anyway.  Thus this is primarily\n+\t\t\t\t// a constraint on statically allocated\n+\t\t\t\t// objects used for synchronization.\n+\t\t\t\t// This allows us to use the low order\n+  \t\t\t\t// bits as follows:\n+#   define LOCKED \t1 \t// This hash entry is locked, and its\n+  \t\t\t\t// state may be invalid.\n+  \t\t\t\t// The lock protects both the hash_entry\n+  \t\t\t\t// itself (except for the light_count\n+  \t\t\t\t// and light_thr_id fields, which\n+  \t\t\t\t// are protected by the lightweight\n+  \t\t\t\t// lock itself), and any heavy_monitor\n+  \t\t\t\t// structures attached to it.\n+#   define HEAVY\t2\t// There may be heavyweight locks\n+\t\t\t\t// associated with this cache entry.\n+\t\t\t\t// The lightweight entry is still valid,\n+  \t\t\t\t// if the leading bits of the address\n+  \t\t\t\t// field are nonzero.\n+ \t\t\t\t// Set if heavy_count is > 0 .\n+  \t\t\t\t// Stored redundantly so a single\n+  \t\t\t\t// compare-and-swap works in the easy case.\n+#   define REQUEST_CONVERSION 4 // The lightweight lock is held.  But\n+  \t\t\t\t// one or more other threads have tried\n+  \t\t\t\t// to acquire the lock, and hence request\n+  \t\t\t\t// conversion to heavyweight status.\n+#   define FLAGS (LOCKED | HEAVY | REQUEST_CONVERSION)\n+  volatile _Jv_ThreadId_t light_thr_id;\n+\t\t\t\t// Thr_id of holder of lightweight lock.\n+  \t\t\t\t// Only updated by lightweight lock holder.\n+\t\t\t\t// Must be recognizably invalid if the\n+\t\t\t\t// lightweight lock is not held.\n+#   define INVALID_THREAD_ID 0  // Works for Linux?\n+\t\t\t\t// If zero doesn't work, we have to\n+\t\t\t\t// initialize lock table.\n+  volatile unsigned short light_count;\n+\t\t\t\t// Number of times the lightweight lock\n+  \t\t\t\t// is held minus one.  Zero if lightweight\n+  \t\t\t\t// lock is not held.\n+  unsigned short heavy_count; \t// Total number of times heavyweight locks\n+  \t\t\t\t// associated with this hash entry are held\n+  \t\t\t\t// or waiting to be acquired.\n+  \t\t\t\t// Threads in wait() are included eventhough\n+  \t\t\t\t// they have temporarily released the lock.\n+  struct heavy_lock * heavy_locks;\n+  \t\t\t\t// Chain of heavy locks.  Protected\n+  \t\t\t\t// by lockbit for he.  Locks may\n+  \t\t\t\t// remain allocated here even if HEAVY\n+  \t\t\t\t// is not set and heavy_count is 0.\n+  \t\t\t\t// If a lightweight and hevyweight lock\n+  \t\t\t\t// correspond to the same address, the\n+  \t\t\t\t// lightweight lock is the right one.\n+};\n+\n+#ifndef JV_SYNC_TABLE_SZ\n+# define JV_SYNC_TABLE_SZ 1024\n+#endif\n+\n+hash_entry light_locks[JV_SYNC_TABLE_SZ];\n+\n+#define JV_SYNC_HASH(p) (((long)p ^ ((long)p >> 10)) % JV_SYNC_TABLE_SZ)\n+\n+#ifdef LOCK_DEBUG\n+  void print_he(hash_entry *he)\n+  {\n+     fprintf(stderr, \"lock hash entry = %p, index = %d, address = 0x%lx\\n\"\n+\t\t     \"\\tlight_thr_id = 0x%lx, light_count = %d, \"\n+\t\t     \"heavy_count = %d\\n\\theavy_locks:\", he,\n+\t\t     he - light_locks, he -> address, he -> light_thr_id,\n+\t\t     he -> light_count, he -> heavy_count);\n+     print_hl_list(he -> heavy_locks);\n+     fprintf(stderr, \"\\n\");\n+  }\n+#endif /* LOCK_DEBUG */\n+\n+// Wait for roughly 2^n units, touching as little memory as possible.\n+static void\n+spin(unsigned n)\n+{\n+  const unsigned MP_SPINS = 10;\n+  const unsigned YIELDS = 4;\n+  const unsigned SPINS_PER_UNIT = 30;\n+  const unsigned MIN_SLEEP_USECS = 2001; // Shorter times spin under Linux.\n+  const unsigned MAX_SLEEP_USECS = 200000;\n+  static unsigned spin_limit = 0;\n+  static unsigned yield_limit = YIELDS;\n+  static bool mp = false;\n+  static bool spin_initialized = false;\n+\n+  if (!spin_initialized)\n     {\n-      obj->finalize ();\n+      mp = is_mp();\n+      if (mp)\n+\t{\n+\t  spin_limit = MP_SPINS;\n+\t  yield_limit = MP_SPINS + YIELDS;\n+\t}\n+      spin_initialized = true;\n     }\n-  catch (java::lang::Throwable *t)\n+  if (n < spin_limit)\n     {\n-      // Ignore.\n+      unsigned i = SPINS_PER_UNIT << n;\n+      for (; i > 0; --i)\n+        __asm__ __volatile__(\"\");\n+    }\n+  else if (n < yield_limit)\n+    {\n+      sched_yield();\n+    }\n+  else\n+    {\n+      unsigned duration = MIN_SLEEP_USECS << (n - yield_limit);\n+      if (n >= 15 + yield_limit || duration > MAX_SLEEP_USECS)\n+\tduration = MAX_SLEEP_USECS;\n+      usleep(duration);\n+    }\n+}\n+\n+// Wait for a hash entry to become unlocked.\n+static void\n+wait_unlocked (hash_entry *he)\n+{\n+  unsigned i = 0;\n+  while (he -> address & LOCKED)\n+    spin (i++);\n+}\n+\n+// Return the heavy lock for addr if it was already allocated.\n+// The client passes in the appropriate hash_entry.\n+// We hold the lock for he.\n+static inline heavy_lock *\n+find_heavy (obj_addr_t addr, hash_entry *he)\n+{\n+  heavy_lock *hl = he -> heavy_locks;\n+  while (hl != 0 && hl -> address != addr) hl = hl -> next;\n+  return hl;\n+}\n+\n+// Unlink the heavy lock for the given address from its hash table chain.\n+// Dies miserably and conspicuously if it's not there, since that should\n+// be impossible.\n+static inline void\n+unlink_heavy (obj_addr_t addr, hash_entry *he)\n+{\n+  heavy_lock **currentp = &(he -> heavy_locks);\n+  while ((*currentp) -> address != addr)\n+    currentp = &((*currentp) -> next);\n+  *currentp = (*currentp) -> next;\n+}\n+\n+// Finalization procedure for objects that have associated heavy-weight\n+// locks.  This may replace the real finalization procedure.\n+static void\n+heavy_lock_obj_finalization_proc (void *obj, void *cd)\n+{\n+  heavy_lock *hl = (heavy_lock *)cd;\n+  obj_addr_t addr = (obj_addr_t)obj;\n+  GC_finalization_proc old_finalization_proc = hl -> old_finalization_proc;\n+  void * old_client_data = hl -> old_client_data;\n+\n+  if (old_finalization_proc != 0)\n+    {\n+      // We still need to run a real finalizer.  In an idealized\n+      // world, in which people write thread-safe finalizers, that is\n+      // likely to require synchronization.  Thus we reregister\n+      // ourselves as the only finalizer, and simply run the real one.\n+      // Thus we don't clean up the lock yet, but we're likely to do so\n+      // on the next GC cycle.\n+      hl -> old_finalization_proc = 0;\n+      hl -> old_client_data = 0;\n+#     ifdef HAVE_BOEHM_GC\n+        GC_REGISTER_FINALIZER_NO_ORDER(obj, heavy_lock_obj_finalization_proc, cd, 0, 0);\n+#     endif\n+      old_finalization_proc(obj, old_client_data);\n+    }\n+  else\n+    {\n+      // The object is really dead, although it's conceivable that\n+      // some thread may still be in the process of releasing the\n+      // heavy lock.  Unlink it and, if necessary, register a finalizer\n+      // to distroy sync_info.\n+      hash_entry *he = light_locks + JV_SYNC_HASH(addr);\n+      obj_addr_t address = (he -> address & ~LOCKED);\n+      while (!compare_and_swap(&(he -> address), address, address | LOCKED ))\n+\t{\n+\t  // Hash table entry is currently locked.  We can't safely touch\n+\t  // touch the list of heavy locks.  \n+\t  wait_unlocked(he);\n+\t  address = (he -> address & ~LOCKED);\n+\t}\n+      unlink_heavy(addr, light_locks + JV_SYNC_HASH(addr));\n+      release_set(&(he -> address), address);\n+#     if defined (_Jv_HaveCondDestroy) || defined (_Jv_HaveMutexDestroy)\n+        // Register a finalizer, yet again.\n+          hl->si.init = true;\n+          _Jv_RegisterFinalizer (hl, heavy_lock_finalization_proc);\n+#     endif\n+    }\n+}\n+\n+// Allocate a new heavy lock for addr, returning its address.\n+// Assumes we already have the hash_entry locked, and there\n+// is currently no lightweight or allocated lock for addr.\n+// We register a finalizer for addr, which is responsible for\n+// removing the heavy lock when addr goes away, in addition\n+// to the responsibilities of any prior finalizer.\n+static heavy_lock *\n+alloc_heavy(obj_addr_t addr, hash_entry *he)\n+{\n+  heavy_lock * hl = (heavy_lock *) _Jv_AllocTraceOne(sizeof (heavy_lock));\n+  \n+  hl -> address = addr;\n+  _Jv_MutexInit (&(hl -> si.mutex));\n+  _Jv_CondInit (&(hl -> si.condition));\n+# if defined (_Jv_HaveCondDestroy) || defined (_Jv_HaveMutexDestroy)\n+    si->init = true;  // needed ?\n+# endif\n+  hl -> next = he -> heavy_locks;\n+  he -> heavy_locks = hl;\n+  // FIXME: The only call that cheats and goes directly to the GC interface.\n+# ifdef HAVE_BOEHM_GC\n+    GC_REGISTER_FINALIZER_NO_ORDER(\n+\t\t    \t  (void *)addr, heavy_lock_obj_finalization_proc,\n+\t\t\t  hl, &hl->old_finalization_proc,\n+\t\t\t  &hl->old_client_data);\n+# endif /* HAVE_BOEHM_GC */\n+  return hl;\n+}\n+\n+// Return the heavy lock for addr, allocating if necessary.\n+// Assumes we have the cache entry locked, and there is no lightweight\n+// lock for addr.\n+static heavy_lock *\n+get_heavy(obj_addr_t addr, hash_entry *he)\n+{\n+  heavy_lock *hl = find_heavy(addr, he);\n+  if (0 == hl)\n+    hl = alloc_heavy(addr, he);\n+  return hl;\n+}\n+\n+void\n+_Jv_MonitorEnter (jobject obj)\n+{\n+  obj_addr_t addr = (obj_addr_t)obj;\n+  obj_addr_t address;\n+  unsigned hash = JV_SYNC_HASH(addr);\n+  hash_entry * he = light_locks + hash;\n+  _Jv_ThreadId_t self = _Jv_ThreadSelf();\n+  unsigned count;\n+  const unsigned N_SPINS = 18;\n+\n+  assert(!(addr & FLAGS));\n+retry:\n+  if (__builtin_expect(compare_and_swap(&(he -> address),\n+\t\t\t\t\t0, addr),true))\n+    {\n+      assert(he -> light_thr_id == INVALID_THREAD_ID);\n+      assert(he -> light_count == 0);\n+      he -> light_thr_id = self;\n+      // Count fields are set correctly.  Heavy_count was also zero,\n+      // but can change asynchronously.\n+      // This path is hopefully both fast and the most common.\n+      return;\n+    }\n+  address = he -> address;\n+  if ((address & ~(HEAVY | REQUEST_CONVERSION)) == addr)\n+    {\n+      if (he -> light_thr_id == self)\n+\t{\n+\t  // We hold the lightweight lock, and it's for the right\n+\t  // address.\n+\t  count = he -> light_count;\n+\t  if (count == USHRT_MAX)\n+\t    {\n+\t      // I think most JVMs don't check for this.\n+\t      // But I'm not convinced I couldn't turn this into a security\n+\t      // hole, even with a 32 bit counter.\n+\t      throw new java::lang::IllegalMonitorStateException(\n+\t\tJvNewStringLatin1(\"maximum monitor nesting level exceeded\")); \n+\t    }\n+\t  he -> light_count = count + 1;\n+\t  return;\n+\t}\n+      else\n+\t{\n+\t  // Lightweight lock is held, but by somone else.\n+          // Spin a few times.  This avoids turning this into a heavyweight\n+    \t  // lock if the current holder is about to release it.\n+          for (unsigned int i = 0; i < N_SPINS; ++i)\n+\t    {\n+\t      if ((he -> address & ~LOCKED) != (address & ~LOCKED)) goto retry;\n+\t      spin(i);\n+            }\n+\t  address &= ~LOCKED;\n+\t  if (!compare_and_swap(&(he -> address), address, address | LOCKED ))\n+\t    {\n+\t      wait_unlocked(he);      \n+\t      goto retry;\n+\t    }\n+\t  heavy_lock *hl = get_heavy(addr, he);\n+\t  ++ (he -> heavy_count);\n+\t  // The hl lock acquisition can't block for long, since it can\n+\t  // only be held by other threads waiting for conversion, and\n+\t  // they, like us, drop it quickly without blocking.\n+\t  _Jv_MutexLock(&(hl->si.mutex));\n+\t  assert(he -> address == address | LOCKED );\n+\t  release_set(&(he -> address), (address | REQUEST_CONVERSION | HEAVY));\n+\t\t\t\t// release lock on he\n+\t  while ((he -> address & ~FLAGS) == (address & ~FLAGS))\n+\t    {\n+\t      // Once converted, the lock has to retain heavyweight\n+\t      // status, since heavy_count > 0 . \n+\t      _Jv_CondWait (&(hl->si.condition), &(hl->si.mutex), 0, 0);\n+\t    }\n+\t  keep_live(addr);\n+\t\t// Guarantee that hl doesn't get unlinked by finalizer.\n+\t\t// This is only an issue if the client fails to release\n+\t\t// the lock, which is unlikely.\n+\t  assert(he -> address & HEAVY);\n+\t  // Lock has been converted, we hold the heavyweight lock,\n+\t  // heavy_count has been incremented.\n+\t  return;\n+        }\n+    }\n+  obj_addr_t was_heavy = (address & HEAVY);\n+  address &= ~LOCKED;\n+  if (!compare_and_swap(&(he -> address), address, (address | LOCKED )))\n+    {\n+      wait_unlocked(he);\n+      goto retry;\n+    }\n+  if ((address & ~(HEAVY | REQUEST_CONVERSION)) == 0)\n+    {\n+      // Either was_heavy is true, or something changed out from under us,\n+      // since the initial test for 0 failed.\n+      assert(!(address & REQUEST_CONVERSION));\n+\t// Can't convert a nonexistent lightweight lock.\n+      heavy_lock *hl;\n+      hl = (was_heavy? find_heavy(addr, he) : 0);\n+      if (0 == hl)\n+        {\n+\t  // It is OK to use the lighweight lock, since either the\n+\t  // heavyweight lock does not exist, or none of the\n+\t  // heavyweight locks currently exist.  Future threads\n+\t  // trying to acquire the lock will see the lightweight\n+\t  // one first and use that.\n+\t  he -> light_thr_id = self;  // OK, since nobody else can hold\n+\t\t\t\t      // light lock or do this at the same time.\n+\t  assert(he -> light_count == 0);\n+\t  assert(was_heavy == (he -> address & HEAVY));\n+\t  release_set(&(he -> address), (addr | was_heavy));\n+        }\n+      else\n+\t{\n+\t  // Must use heavy lock.\n+\t  ++ (he -> heavy_count);\n+\t  assert(0 == (address & ~HEAVY));\n+          release_set(&(he -> address), HEAVY);\n+          _Jv_MutexLock(&(hl->si.mutex));\n+\t  keep_live(addr);\n+        }\n+      return;\n+    }\n+  // Lightweight lock is held, but does not correspond to this object.\n+  // We hold the lock on the hash entry, and he -> address can't\n+  // change from under us.  Neither can the chain of heavy locks.\n+    {\n+      assert(0 == he -> heavy_count || (address & HEAVY));\n+      heavy_lock *hl = get_heavy(addr, he);\n+      ++ (he -> heavy_count);\n+      release_set(&(he -> address), address | HEAVY);\n+      _Jv_MutexLock(&(hl->si.mutex));\n+      keep_live(addr);\n     }\n }\n+\n+\n+void\n+_Jv_MonitorExit (jobject obj)\n+{\n+  obj_addr_t addr = (obj_addr_t)obj;\n+  _Jv_ThreadId_t self = _Jv_ThreadSelf();\n+  unsigned hash = JV_SYNC_HASH(addr);\n+  hash_entry * he = light_locks + hash;\n+  _Jv_ThreadId_t light_thr_id;\n+  unsigned count;\n+  obj_addr_t address;\n+\n+retry:\n+  light_thr_id = he -> light_thr_id;\n+  // Unfortunately, it turns out we always need to read the address\n+  // first.  Even if we are going to update it with compare_and_swap,\n+  // we need to reset light_thr_id, and that's not safe unless we know\n+  // know that we hold the lock.\n+  address = he -> address;\n+  // First the (relatively) fast cases:\n+  if (__builtin_expect(light_thr_id == self, true))\n+    {\n+      count = he -> light_count;\n+      if (__builtin_expect((address & ~HEAVY) == addr, true))\n+\t{\n+          if (count != 0)\n+            {\n+\t      // We held the lightweight lock all along.  Thus the values\n+\t      // we saw for light_thr_id and light_count must have been valid. \n+\t      he -> light_count = count - 1;\n+\t      return;\n+            }\n+\t  else\n+\t    {\n+\t      // We hold the lightweight lock once.\n+\t      he -> light_thr_id = INVALID_THREAD_ID;\n+              if (compare_and_swap_release(&(he -> address), address,\n+\t\t\t\t\t   address & HEAVY))\n+\t        return;\n+\t      else\n+\t\t{\n+\t          he -> light_thr_id = light_thr_id; // Undo prior damage.\n+\t          goto retry;\n+\t        }\n+            }\n+        }\n+      // else lock is not for this address, conversion is requested,\n+      // or the lock bit in the address field is set.\n+    }\n+  else\n+    {\n+      if ((address & ~(HEAVY | REQUEST_CONVERSION)) == addr)\n+\t{\n+#\t  ifdef LOCK_DEBUG\n+\t    fprintf(stderr, \"Lightweight lock held by other thread\\n\\t\"\n+\t\t\t    \"light_thr_id = 0x%lx, self = 0x%lx, \"\n+\t\t\t    \"address = 0x%lx, pid = %d\\n\",\n+\t\t\t    light_thr_id, self, address, getpid());\n+\t    print_he(he);\n+\t    for(;;) {}\n+#\t  endif\n+\t  // Someone holds the lightweight lock for this object, and\n+\t  // it can't be us.\n+\t  throw new java::lang::IllegalMonitorStateException(\n+\t\t\tJvNewStringLatin1(\"current thread not owner\"));\n+        }\n+      else\n+\tcount = he -> light_count;\n+    }\n+  if (address & LOCKED)\n+    {\n+      wait_unlocked(he);\n+      goto retry;\n+    }\n+  // Now the unlikely cases.\n+  // We do know that:\n+  // - Address is set, and doesn't contain the LOCKED bit.\n+  // - If address refers to the same object as addr, then he -> light_thr_id\n+  //   refers to this thread, and count is valid.\n+  // - The case in which we held the lightweight lock has been\n+  //   completely handled, except for the REQUEST_CONVERSION case.\n+  //   \n+  if ((address & ~FLAGS) == addr)\n+    {\n+      // The lightweight lock is assigned to this object.\n+      // Thus we must be in the REQUEST_CONVERSION case.\n+      if (0 != count)\n+        {\n+\t  // Defer conversion until we exit completely.\n+\t  he -> light_count = count - 1;\n+\t  return;\n+        }\n+      assert(he -> light_thr_id == self);\n+      assert(address & REQUEST_CONVERSION);\n+      // Conversion requested\n+      // Convert now.\n+      if (!compare_and_swap(&(he -> address), address, address | LOCKED))\n+\tgoto retry;\n+      heavy_lock *hl = find_heavy(addr, he);\n+      assert (0 != hl);\n+\t\t// Requestor created it.\n+      he -> light_count = 0;\n+      assert(he -> heavy_count > 0);\n+\t  \t// was incremented by requestor.\n+      _Jv_MutexLock(&(hl->si.mutex));\n+\t// Release the he lock after acquiring the mutex.\n+\t// Otherwise we can accidentally\n+\t// notify a thread that has already seen a heavyweight\n+\t// lock.\n+      he -> light_thr_id = INVALID_THREAD_ID;\n+      release_set(&(he -> address), HEAVY);\n+\t  \t// lightweight lock now unused.\n+      _Jv_CondNotifyAll(&(hl->si.condition), &(hl->si.mutex));\n+      _Jv_MutexUnlock(&(hl->si.mutex));\n+      // heavy_count was already incremented by original requestor.\n+      keep_live(addr);\n+      return;\n+    }\n+  // lightweight lock not for this object.\n+  assert(!(address & LOCKED));\n+  assert((address & ~FLAGS) != addr);\n+  if (!compare_and_swap(&(he -> address), address, address | LOCKED))\n+\tgoto retry;\n+  heavy_lock *hl = find_heavy(addr, he);\n+  if (NULL == hl)\n+    {\n+#     ifdef LOCK_DEBUG\n+\tfprintf(stderr, \"Failed to find heavyweight lock for addr 0x%lx\"\n+\t\t\t\" pid = %d\\n\", addr, getpid());\n+\tprint_he(he);\n+\tfor(;;) {}\n+#     endif\n+      throw new java::lang::IllegalMonitorStateException(\n+\t\t\tJvNewStringLatin1(\"current thread not owner\"));\n+    }\n+  assert(address & HEAVY);\n+  count = he -> heavy_count;\n+  assert(count > 0);\n+  --count;\n+  if (0 == count) address &= ~HEAVY;\n+  he -> heavy_count = count;\n+  release_set(&(he -> address), address);\n+    \t\t\t\t// release lock bit, preserving\n+\t\t\t\t// REQUEST_CONVERSION\n+    \t\t\t\t// and object address.\n+  _Jv_MutexUnlock(&(hl->si.mutex));\n+  \t\t\t// Unlock after releasing the lock bit, so that\n+  \t\t\t// we don't switch to another thread prematurely.\n+  keep_live(addr);\n+}     \n+\n+// The rest of these are moderately thin veneers on _Jv_Cond ops.\n+// The current version of Notify might be able to make the pthread\n+// call AFTER releasing the lock, thus saving some context switches??\n+\n+void\n+java::lang::Object::wait (jlong timeout, jint nanos)\n+{\n+  obj_addr_t addr = (obj_addr_t)this;\n+  _Jv_ThreadId_t self = _Jv_ThreadSelf();\n+  unsigned hash = JV_SYNC_HASH(addr);\n+  hash_entry * he = light_locks + hash;\n+  unsigned count;\n+  obj_addr_t address;\n+  heavy_lock *hl;\n+    \n+  if (__builtin_expect (timeout < 0 || nanos < 0 || nanos > 999999, false))\n+    throw new IllegalArgumentException;\n+retry:\n+  address = he -> address;\n+  address &= ~LOCKED;\n+  if (!compare_and_swap(&(he -> address), address, address | LOCKED))\n+    {\n+      wait_unlocked(he);\n+      goto retry;\n+    }\n+  // address does not have the lock bit set.  We hold the lock on he.\n+  if ((address & ~FLAGS) == addr)\n+    {\n+      // Convert to heavyweight.\n+\tif (he -> light_thr_id != self)\n+\t  {\n+#\t    ifdef LOCK_DEBUG\n+\t      fprintf(stderr, \"Found wrong lightweight lock owner in wait \"\n+\t\t\t      \"address = 0x%lx pid = %d\\n\", address, getpid());\n+\t      print_he(he);\n+\t      for(;;) {}\n+#\t    endif\n+\t    release_set(&(he -> address), address);\n+\t    throw new IllegalMonitorStateException (JvNewStringLatin1 \n+                          (\"current thread not owner\"));\n+\t  }\n+\tcount = he -> light_count;\n+\thl = get_heavy(addr, he);\n+\the -> light_count = 0;\n+\the -> heavy_count += count + 1;\n+\tfor (unsigned i = 0; i <= count; ++i)\n+\t  _Jv_MutexLock(&(hl->si.mutex));\n+\t// Again release the he lock after acquiring the mutex.\n+        he -> light_thr_id = INVALID_THREAD_ID;\n+\trelease_set(&(he -> address), HEAVY);  // lightweight lock now unused.\n+\tif (address & REQUEST_CONVERSION)\n+\t  _Jv_CondNotify (&(hl->si.condition), &(hl->si.mutex));\n+    }\n+  else /* We should hold the heavyweight lock. */\n+    {\n+      hl = find_heavy(addr, he);\n+      release_set(&(he -> address), address);\n+      if (0 == hl)\n+\t{\n+#\t  ifdef LOCK_DEBUG\n+\t    fprintf(stderr, \"Couldn't find heavy lock in wait \"\n+\t\t \t    \"addr = 0x%lx pid = %d\\n\", addr, getpid());\n+\t    print_he(he);\n+\t    for(;;) {}\n+#\t  endif\n+\t  throw new IllegalMonitorStateException (JvNewStringLatin1 \n+                          (\"current thread not owner\"));\n+\t}\n+      assert(address & HEAVY);\n+    }\n+  switch (_Jv_CondWait (&(hl->si.condition), &(hl->si.mutex), timeout, nanos))\n+    {\n+      case _JV_NOT_OWNER:\n+\tthrow new IllegalMonitorStateException (JvNewStringLatin1 \n+                          (\"current thread not owner\"));        \n+      case _JV_INTERRUPTED:\n+\tif (Thread::interrupted ())\n+\t  throw new InterruptedException;        \n+    }\n+}\n+\n+void\n+java::lang::Object::notify (void)\n+{\n+  obj_addr_t addr = (obj_addr_t)this;\n+  _Jv_ThreadId_t self = _Jv_ThreadSelf();\n+  unsigned hash = JV_SYNC_HASH(addr);\n+  hash_entry * he = light_locks + hash;\n+  heavy_lock *hl;\n+  obj_addr_t address;\n+  int result;\n+\n+retry:\n+  address = ((he -> address) & ~LOCKED);\n+  if (!compare_and_swap(&(he -> address), address, address | LOCKED))\n+    {\n+      wait_unlocked(he);\n+      goto retry;\n+    }\n+  if ((address & ~FLAGS) == addr && he -> light_thr_id == self)\n+    {\n+      // We hold lightweight lock.  Since it has not\n+      // been inflated, there are no waiters.\n+      release_set(&(he -> address), address);\t// unlock\n+      return;\n+    }\n+  hl = find_heavy(addr, he);\n+  // Hl can't disappear since we point to the underlying object.\n+  // It's important that we release the lock bit before the notify, since\n+  // otherwise we will try to wake up thee target while we still hold the\n+  // bit.  This results in lock bit contention, which we don't handle\n+  // terribly well.\n+  release_set(&(he -> address), address); // unlock\n+  if (0 == hl)\n+    {\n+      throw new IllegalMonitorStateException(JvNewStringLatin1 \n+                                              (\"current thread not owner\"));\n+      return;\n+    }\n+  result = _Jv_CondNotify(&(hl->si.condition), &(hl->si.mutex));\n+  keep_live(addr);\n+  if (__builtin_expect (result, 0))\n+    throw new IllegalMonitorStateException(JvNewStringLatin1 \n+                                              (\"current thread not owner\"));\n+}\n+\n+void\n+java::lang::Object::notifyAll (void)\n+{\n+  obj_addr_t addr = (obj_addr_t)this;\n+  _Jv_ThreadId_t self = _Jv_ThreadSelf();\n+  unsigned hash = JV_SYNC_HASH(addr);\n+  hash_entry * he = light_locks + hash;\n+  heavy_lock *hl;\n+  obj_addr_t address;\n+  int result;\n+\n+retry:\n+  address = (he -> address) & ~LOCKED;\n+  if (!compare_and_swap(&(he -> address), address, address | LOCKED))\n+    {\n+      wait_unlocked(he);\n+      goto retry;\n+    }\n+  hl = find_heavy(addr, he);\n+  if ((address & ~FLAGS) == addr && he -> light_thr_id == self)\n+    {\n+      // We hold lightweight lock.  Since it has not\n+      // been inflated, there are no waiters.\n+      release_set(&(he -> address), address);\t// unlock\n+      return;\n+    }\n+  release_set(&(he -> address), address); // unlock\n+  if (0 == hl)\n+    {\n+      throw new IllegalMonitorStateException(JvNewStringLatin1 \n+                                              (\"current thread not owner\"));\n+    }\n+  result = _Jv_CondNotifyAll(&(hl->si.condition), &(hl->si.mutex));\n+  if (__builtin_expect (result, 0))\n+    throw new IllegalMonitorStateException(JvNewStringLatin1 \n+                                              (\"current thread not owner\"));\n+}\n+\n+// This is declared in Java code and in Object.h.\n+// It should never be called with JV_HASH_SYNCHRONIZATION\n+void\n+java::lang::Object::sync_init (void)\n+{\n+  throw new IllegalMonitorStateException(JvNewStringLatin1 \n+                                              (\"internal error: sync_init\"));\n+}\n+\n+// This is called on startup and declared in Object.h.\n+// For now we just make it a no-op.\n+void\n+_Jv_InitializeSyncMutex (void)\n+{\n+}\n+\n+#endif /* JV_HASH_SYNCHRONIZATION */\n+"}, {"sha": "520188274f6432312a00490645c4d2cc3bd1ec7f", "filename": "libjava/java/lang/natString.cc", "status": "modified", "additions": 14, "deletions": 6, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fjava%2Flang%2FnatString.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fjava%2Flang%2FnatString.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FnatString.cc?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -121,17 +121,15 @@ java::lang::String::rehash()\n   if (strhash == NULL)\n     {\n       strhash_size = 1024;\n-      strhash = (jstring *) _Jv_AllocBytesChecked (strhash_size\n-\t\t\t\t\t\t   * sizeof (jstring));\n+      strhash = (jstring *) _Jv_AllocBytes (strhash_size * sizeof (jstring));\n       memset (strhash, 0, strhash_size * sizeof (jstring));\n     }\n   else\n     {\n       int i = strhash_size;\n       jstring* ptr = strhash + i;\n       int nsize = strhash_size * 2;\n-      jstring *next = (jstring *) _Jv_AllocBytesChecked (nsize\n-\t\t\t\t\t\t\t * sizeof (jstring));\n+      jstring *next = (jstring *) _Jv_AllocBytes (nsize * sizeof (jstring));\n       memset (next, 0, nsize * sizeof (jstring));\n \n       while (--i >= 0)\n@@ -392,8 +390,18 @@ _Jv_AllocString(jsize len)\n {\n   jsize sz = sizeof(java::lang::String) + len * sizeof(jchar);\n \n-  jstring obj = (jstring) JvAllocObject(&StringClass, sz);\n-\n+  // We assert that for strings allocated this way, the data field\n+  // will always point to the object itself.  Thus there is no reason\n+  // for the garbage collector to scan any of it.\n+  // Furthermore, we're about to overwrite the string data, so\n+  // initialization of the object is not an issue.\n+#ifdef ENABLE_JVMPI\n+  jstring obj = (jstring) _Jv_AllocPtrFreeObject(&StringClass, sz);\n+#else\n+  // Class needs no initialization, and there is no finalizer, so\n+  // we can go directly to the collector's allocator interface.\n+  jstring obj = (jstring) _Jv_AllocPtrFreeObj(&StringClass, sz);\n+#endif\n   obj->data = obj;\n   obj->boffset = sizeof(java::lang::String);\n   obj->count = len;"}, {"sha": "cd281fc5b3ea4638964109b80a18ec8b228a3d23", "filename": "libjava/java/net/natInetAddress.cc", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fjava%2Fnet%2FnatInetAddress.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fjava%2Fnet%2FnatInetAddress.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Fnet%2FnatInetAddress.cc?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -95,7 +95,7 @@ java::net::InetAddress::aton (jstring host)\n   if (len < 100)\n     hostname = buf;\n   else\n-    hostname = (char*) _Jv_AllocBytesChecked (len+1);\n+    hostname = (char*) _Jv_AllocBytes (len+1);\n   JvGetStringUTFRegion (host, 0, host->length(), hostname);\n   buf[len] = '\\0';\n   char* bytes = NULL;\n@@ -180,7 +180,7 @@ java::net::InetAddress::lookup (jstring host, java::net::InetAddress* iaddr,\n       if (len < 100)\n \thostname = buf;\n       else\n-\thostname = (char*) _Jv_AllocBytesChecked (len+1);\n+\thostname = (char*) _Jv_AllocBytes (len+1);\n       JvGetStringUTFRegion (host, 0, host->length(), hostname);\n       buf[len] = '\\0';\n #ifdef HAVE_GETHOSTBYNAME_R\n@@ -201,7 +201,7 @@ java::net::InetAddress::lookup (jstring host, java::net::InetAddress* iaddr,\n \t  if (! ok && herr == ERANGE)\n \t    {\n \t      size_r *= 2;\n-\t      buffer_r = (char *) _Jv_AllocBytesChecked (size_r);\n+\t      buffer_r = (char *) _Jv_AllocBytes (size_r);\n \t    }\n \t  else\n #endif /* HAVE_STRUCT_HOSTENT_DATA */\n@@ -255,7 +255,7 @@ java::net::InetAddress::lookup (jstring host, java::net::InetAddress* iaddr,\n \t  if (! ok && herr == ERANGE)\n \t    {\n \t      size_r *= 2;\n-\t      buffer_r = (char *) _Jv_AllocBytesChecked (size_r);\n+\t      buffer_r = (char *) _Jv_AllocBytes (size_r);\n \t    }\n \t  else \n #endif /* HAVE_STRUCT_HOSTENT_DATA */"}, {"sha": "90e4883340294348340611fd644a26fdb4c28921", "filename": "libjava/libgcj.spec.in", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Flibgcj.spec.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Flibgcj.spec.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Flibgcj.spec.in?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -6,7 +6,7 @@\n %rename lib liborig\n *lib: -lgcj -lm @GCSPEC@ @THREADSPEC@ @ZLIBSPEC@ @SYSTEMSPEC@ %(libgcc) %(liborig)\n \n-*jc1: @DIVIDESPEC@ @JC1GCSPEC@ @EXCEPTIONSPEC@\n+*jc1: @HASH_SYNC_SPEC@ @DIVIDESPEC@ @JC1GCSPEC@ @EXCEPTIONSPEC@\n \n #\n # On some systems we force in a data_start symbol so that the GC will work"}, {"sha": "7cdd58277246769407adc41df2894b7e0d3a8328", "filename": "libjava/nogc.cc", "status": "modified", "additions": 26, "deletions": 2, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fnogc.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fnogc.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fnogc.cc?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -1,6 +1,6 @@\n // nogc.cc - Implement null garbage collector.\n \n-/* Copyright (C) 1998, 1999, 2000  Free Software Foundation\n+/* Copyright (C) 1998, 1999, 2000, 2001  Free Software Foundation\n \n    This file is part of libgcj.\n \n@@ -32,6 +32,17 @@ _Jv_AllocObj (jsize size, jclass klass)\n {\n   total += size;\n   void *obj = calloc (size, 1);\n+  if (!obj) _Jv_ThrowNoMemory();\n+  *((_Jv_VTable **) obj) = klass->vtable;\n+  return obj;\n+}\n+\n+void *\n+_Jv_AllocPtrFreeObj (jsize size, jclass klass)\n+{\n+  total += size;\n+  ptr_t obj = malloc (size, 1);\n+  if (!obj) _Jv_ThrowNoMemory();\n   *((_Jv_VTable **) obj) = klass->vtable;\n   return obj;\n }\n@@ -41,6 +52,7 @@ _Jv_AllocArray (jsize size, jclass klass)\n {\n   total += size;\n   void *obj = calloc (size, 1);\n+  if (!obj) _Jv_ThrowNoMemory();\n   *((_Jv_VTable **) obj) = klass->vtable;\n   return obj;\n }\n@@ -49,7 +61,9 @@ void *\n _Jv_AllocBytes (jsize size)\n {\n   total += size;\n-  return calloc (size, 1);\n+  ptr_t obj = calloc (size, 1);\n+  if (!obj) _Jv_ThrowNoMemory();\n+  return obj;\n }\n \n void\n@@ -111,3 +125,13 @@ void\n _Jv_InitGC (void)\n {\n }\n+\n+#ifdef JV_HASH_SYNCHRONIZATION\n+void *\n+_Jv_AllocTraceOne (jsize size /* includes vtable slot */) \n+{\n+  ptr_t obj = calloc(size, 1);\n+  if (!obj) _Jv_ThrowNoMemory();\n+  return result;\n+}\n+#endif /* JV_HASH_SYNCHRONIZATION */"}, {"sha": "21f61370df243ec1d034f991ec648d46693c47e2", "filename": "libjava/posix-threads.cc", "status": "modified", "additions": 39, "deletions": 3, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fposix-threads.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fposix-threads.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fposix-threads.cc?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -1,6 +1,6 @@\n // posix-threads.cc - interface between libjava and POSIX threads.\n \n-/* Copyright (C) 1998, 1999, 2000  Free Software Foundation\n+/* Copyright (C) 1998, 1999, 2000, 2001  Free Software Foundation\n \n    This file is part of libgcj.\n \n@@ -336,6 +336,22 @@ _Jv_ThreadRegister (_Jv_Thread_t *data)\n   // is called. Since it may need to be accessed from the new thread, work \n   // around the potential race here by explicitly setting it again.\n   data->thread = pthread_self ();\n+\n+# ifdef SLOW_PTHREAD_SELF\n+    // Clear all self cache slots that might be needed by this thread.\n+    int dummy;\n+    int low_index = SC_INDEX(&dummy) + SC_CLEAR_MIN;\n+    int high_index = SC_INDEX(&dummy) + SC_CLEAR_MAX;\n+    for (int i = low_index; i <= high_index; ++i) \n+      {\n+        int current_index = i;\n+\tif (current_index < 0)\n+\t  current_index += SELF_CACHE_SIZE;\n+\tif (current_index >= SELF_CACHE_SIZE)\n+\t  current_index -= SELF_CACHE_SIZE;\n+\t_Jv_self_cache[current_index].high_sp_bits = BAD_HIGH_SP_VALUE;\n+      }\n+# endif\n }\n \n void\n@@ -356,7 +372,7 @@ really_start (void *x)\n   _Jv_ThreadRegister (info->data);\n \n   info->method (info->data->thread_obj);\n-  \n+\n   if (! (info->data->flags & FLAG_DAEMON))\n     {\n       pthread_mutex_lock (&daemon_mutex);\n@@ -365,7 +381,7 @@ really_start (void *x)\n \tpthread_cond_signal (&daemon_cond);\n       pthread_mutex_unlock (&daemon_mutex);\n     }\n-  \n+\n   return NULL;\n }\n \n@@ -418,3 +434,23 @@ _Jv_ThreadWait (void)\n     pthread_cond_wait (&daemon_cond, &daemon_mutex);\n   pthread_mutex_unlock (&daemon_mutex);\n }\n+\n+#if defined(SLOW_PTHREAD_SELF)\n+\n+// Support for pthread_self() lookup cache.\n+\n+volatile self_cache_entry _Jv_self_cache[SELF_CACHE_SIZE];\n+\n+\n+_Jv_ThreadId_t\n+_Jv_ThreadSelf_out_of_line(volatile self_cache_entry *sce, size_t high_sp_bits)\n+{\n+  pthread_t self = pthread_self();\n+  // The ordering between the following writes matters.\n+  // On Alpha, we probably need a memory barrier in the middle.\n+  sce -> high_sp_bits = high_sp_bits;\n+  sce -> self = self;\n+  return self;\n+}\n+\n+#endif /* SLOW_PTHREAD_SELF */"}, {"sha": "954f1aa9a60692fa1cf602cfb8a1867fdda75d88", "filename": "libjava/prims.cc", "status": "modified", "additions": 63, "deletions": 19, "changes": 82, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fprims.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fprims.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fprims.cc?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -221,11 +221,11 @@ _Jv_strLengthUtf8(char* str, int len)\n   ptr = (unsigned char*) str;\n   limit = ptr + len;\n   str_length = 0;\n-  for (; ptr < limit; str_length++) {\n-    if (UTF8_GET (ptr, limit) < 0) {\n-      return (-1);\n+  for (; ptr < limit; str_length++)\n+    {\n+      if (UTF8_GET (ptr, limit) < 0)\n+\treturn (-1);\n     }\n-  }\n   return (str_length);\n }\n \n@@ -271,7 +271,7 @@ _Jv_makeUtf8Const (jstring string)\n   jint len = _Jv_GetStringUTFLength (string);\n \n   Utf8Const* m = (Utf8Const*)\n-    _Jv_AllocBytesChecked (sizeof(Utf8Const) + len + 1);\n+    _Jv_AllocBytes (sizeof(Utf8Const) + len + 1);\n \n   m->hash = hash;\n   m->length = len;\n@@ -331,14 +331,11 @@ _Jv_ThrowNullPointerException ()\n   throw new java::lang::NullPointerException;\n }\n \n-// Allocate some unscanned memory and throw an exception if no memory.\n-void *\n-_Jv_AllocBytesChecked (jsize size)\n+// Explicitly throw a no memory exception.\n+// The collector calls this when it encounters an out-of-memory condition.\n+void _Jv_ThrowNoMemory()\n {\n-  void *r = _Jv_AllocBytes (size);\n-  if (! r)\n-    throw no_memory;\n-  return r;\n+  _Jv_Throw (no_memory);\n }\n \n // Allocate a new object of class KLASS.  SIZE is the size of the object\n@@ -350,8 +347,6 @@ _Jv_AllocObject (jclass klass, jint size)\n   _Jv_InitClass (klass);\n \n   jobject obj = (jobject) _Jv_AllocObj (size, klass);\n-  if (__builtin_expect (! obj, false))\n-    throw no_memory;\n \n   // If this class has inherited finalize from Object, then don't\n   // bother registering a finalizer.  We know that finalize() is the\n@@ -379,6 +374,14 @@ _Jv_AllocObject (jclass klass, jint size)\n       event.u.obj_alloc.size = size;\n       event.u.obj_alloc.obj_id = (jobjectID) obj;\n \n+      // FIXME:  This doesn't look right for the Boehm GC.  A GC may\n+      // already be in progress.  _Jv_DisableGC () doesn't wait for it.\n+      // More importantly, I don't see the need for disabling GC, since we\n+      // blatantly have a pointer to obj on our stack, ensuring that the\n+      // object can't be collected.  Even for a nonconservative collector,\n+      // it appears to me that this must be true, since we are about to\n+      // return obj. Isn't this whole approach way too intrusive for\n+      // a useful profiling interface?\t\t\t- HB\n       _Jv_DisableGC ();\n       (*_Jv_JVMPI_Notify_OBJECT_ALLOC) (&event);\n       _Jv_EnableGC ();\n@@ -388,6 +391,43 @@ _Jv_AllocObject (jclass klass, jint size)\n   return obj;\n }\n \n+// A version of the above that assumes the object contains no pointers,\n+// and requires no finalization.  This can't happen if we need pointers\n+// to locks.\n+#ifdef JV_HASH_SYNCHRONIZATION\n+jobject\n+_Jv_AllocPtrFreeObject (jclass klass, jint size)\n+{\n+  _Jv_InitClass (klass);\n+\n+  jobject obj = (jobject) _Jv_AllocPtrFreeObj (size, klass);\n+\n+#ifdef ENABLE_JVMPI\n+  // Service JVMPI request.\n+\n+  if (__builtin_expect (_Jv_JVMPI_Notify_OBJECT_ALLOC != 0, false))\n+    {\n+      JVMPI_Event event;\n+\n+      event.event_type = JVMPI_EVENT_OBJECT_ALLOC;\n+      event.env_id = NULL;\n+      event.u.obj_alloc.arena_id = 0;\n+      event.u.obj_alloc.class_id = (jobjectID) klass;\n+      event.u.obj_alloc.is_array = 0;\n+      event.u.obj_alloc.size = size;\n+      event.u.obj_alloc.obj_id = (jobjectID) obj;\n+\n+      _Jv_DisableGC ();\n+      (*_Jv_JVMPI_Notify_OBJECT_ALLOC) (&event);\n+      _Jv_EnableGC ();\n+    }\n+#endif\n+\n+  return obj;\n+}\n+#endif /* JV_HASH_SYNCHRONIZATION */\n+\n+\n // Allocate a new array of Java objects.  Each object is of type\n // `elementClass'.  `init' is used to initialize each slot in the\n // array.\n@@ -408,8 +448,6 @@ _Jv_NewObjectArray (jsize count, jclass elementClass, jobject init)\n   jclass klass = _Jv_GetArrayClass (elementClass, 0);\n \n   obj = (jobjectArray) _Jv_AllocArray (size, klass);\n-  if (__builtin_expect (! obj, false))\n-    throw no_memory;\n   // Cast away const.\n   jsize *lp = const_cast<jsize *> (&obj->length);\n   *lp = count;\n@@ -444,13 +482,19 @@ _Jv_NewPrimArray (jclass eltype, jint count)\n \n   jclass klass = _Jv_GetArrayClass (eltype, 0);\n \n+# ifdef JV_HASH_SYNCHRONIZATION\n+  // Since the vtable is always statically allocated,\n+  // these are completely pointerfree!  Make sure the GC doesn't touch them.\n+  __JArray *arr =\n+    (__JArray*) _Jv_AllocPtrFreeObj (size + elsize * count, klass);\n+  memset((char *)arr + size, 0, elsize * count);\n+# else\n   __JArray *arr = (__JArray*) _Jv_AllocObj (size + elsize * count, klass);\n-  if (__builtin_expect (! arr, false))\n-    throw no_memory;\n+  // Note that we assume we are given zeroed memory by the allocator.\n+# endif\n   // Cast away const.\n   jsize *lp = const_cast<jsize *> (&arr->length);\n   *lp = count;\n-  // Note that we assume we are given zeroed memory by the allocator.\n \n   return arr;\n }"}, {"sha": "9fbc963064563edab1399ec2a9b40778056c9c7d", "filename": "libjava/resolve.cc", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fresolve.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Fresolve.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fresolve.cc?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -583,7 +583,7 @@ _Jv_PrepareClass(jclass klass)\n   // allocate static memory\n   if (static_size != 0)\n     {\n-      char *static_data = (char*)_Jv_AllocBytesChecked (static_size);\n+      char *static_data = (char*)_Jv_AllocBytes (static_size);\n \n       memset (static_data, 0, static_size);\n \n@@ -697,7 +697,7 @@ _Jv_PrepareClass(jclass klass)\n \n   /* allocate vtable structure */\n   _Jv_VTable *vtable = (_Jv_VTable*) \n-    _Jv_AllocBytesChecked (sizeof (_Jv_VTable) \n+    _Jv_AllocBytes (sizeof (_Jv_VTable) \n \t\t\t   + (sizeof (void*) * (vtable_count)));\n   vtable->clas = clz;\n   vtable->gc_descr = _Jv_BuildGCDescr(clz);\n@@ -1076,7 +1076,7 @@ _Jv_InterpMethod::ncode ()\n   int arg_count = count_arguments (self->signature, staticp);\n \n   ncode_closure *closure =\n-    (ncode_closure*)_Jv_AllocBytesChecked (sizeof (ncode_closure)\n+    (ncode_closure*)_Jv_AllocBytes (sizeof (ncode_closure)\n \t\t\t\t\t+ arg_count * sizeof (ffi_type*));\n \n   init_cif (self->signature,\n@@ -1126,8 +1126,8 @@ _Jv_JNIMethod::ncode ()\n   int arg_count = count_arguments (self->signature, staticp);\n \n   ncode_closure *closure =\n-    (ncode_closure*)_Jv_AllocBytesChecked (sizeof (ncode_closure)\n-\t\t\t\t\t+ arg_count * sizeof (ffi_type*));\n+    (ncode_closure*)_Jv_AllocBytes (sizeof (ncode_closure)\n+\t\t\t\t    + arg_count * sizeof (ffi_type*));\n \n   ffi_type *rtype;\n   init_cif (self->signature,\n@@ -1187,8 +1187,8 @@ _Jv_BuildResolvedMethod (_Jv_Method* method,\n   int arg_count = count_arguments (method->signature, staticp);\n \n   _Jv_ResolvedMethod* result = (_Jv_ResolvedMethod*)\n-    _Jv_AllocBytesChecked (sizeof (_Jv_ResolvedMethod)\n-\t\t\t   + arg_count*sizeof (ffi_type*));\n+    _Jv_AllocBytes (sizeof (_Jv_ResolvedMethod)\n+\t\t    + arg_count*sizeof (ffi_type*));\n \n   result->stack_item_count\n     = init_cif (method->signature,"}, {"sha": "6fea5010a3749a97b4fcd8683813574ff17b463d", "filename": "libjava/testsuite/Makefile.in", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Ftestsuite%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3610e0d548721082f8b57cf3944cefc6b7605c49/libjava%2Ftestsuite%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Ftestsuite%2FMakefile.in?ref=3610e0d548721082f8b57cf3944cefc6b7605c49", "patch": "@@ -85,6 +85,7 @@ GCLIBS = @GCLIBS@\n GCOBJS = @GCOBJS@\n GCSPEC = @GCSPEC@\n GCTESTSPEC = @GCTESTSPEC@\n+HASH_SYNC_SPEC = @HASH_SYNC_SPEC@\n INCLTDL = @INCLTDL@\n JC1GCSPEC = @JC1GCSPEC@\n LIBDATASTARTSPEC = @LIBDATASTARTSPEC@\n@@ -123,15 +124,19 @@ libgcj_basedir = @libgcj_basedir@\n AUTOMAKE_OPTIONS = foreign dejagnu\n \n # Setup the testing framework, if you have one\n-EXPECT = `if [ -f $(top_builddir)/../expect/expect ] ; then             echo $(top_builddir)/../expect/expect ;           else echo expect ; fi`\n+EXPECT = `if [ -f $(top_builddir)/../expect/expect ] ; then \\\n+            echo $(top_builddir)/../expect/expect ; \\\n+          else echo expect ; fi`\n \n \n-RUNTEST = `if [ -f $(top_srcdir)/../dejagnu/runtest ] ; then \t       echo $(top_srcdir)/../dejagnu/runtest ; \t    else echo runtest; fi`\n+RUNTEST = `if [ -f $(top_srcdir)/../dejagnu/runtest ] ; then \\\n+\t       echo $(top_srcdir)/../dejagnu/runtest ; \\\n+\t    else echo runtest; fi`\n \n \n RUNTESTFLAGS = @AM_RUNTESTFLAGS@\n mkinstalldirs = $(SHELL) $(top_srcdir)/../mkinstalldirs\n-CONFIG_HEADER = ../include/config.h\n+CONFIG_HEADER = ../include/config.h ../gcj/libgcj-config.h\n CONFIG_CLEAN_FILES = \n DIST_COMMON =  ChangeLog Makefile.am Makefile.in\n "}]}