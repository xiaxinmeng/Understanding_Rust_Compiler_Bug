{"sha": "a3bd50cc4b053aa1224977404494b856eb625154", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTNiZDUwY2M0YjA1M2FhMTIyNDk3NzQwNDQ5NGI4NTZlYjYyNTE1NA==", "commit": {"author": {"name": "Paolo Bonzini", "email": "bonzini@gnu.org", "date": "2006-10-10T14:21:05Z"}, "committer": {"name": "Paolo Bonzini", "email": "bonzini@gcc.gnu.org", "date": "2006-10-10T14:21:05Z"}, "message": "configure.ac [...]: Set X86_DARWIN symbol and conditional.\n\n2006-10-10  Paolo Bonzini  <bonzini@gnu.org>\n\t    Sandro Tolaini  <tolaini@libero.it>\n\n\t* configure.ac [i*86-*-darwin*]: Set X86_DARWIN symbol and \n\tconditional.\n\t* configure: Regenerated.\n\t* Makefile.am (nodist_libffi_la_SOURCES) [X86_DARWIN]: New case.\n\t(EXTRA_DIST): Add src/x86/darwin.S.\n\t* Makefile.in: Regenerated.\n\t* include/Makefile.in: Regenerated.\n\t* testsuite/Makefile.in: Regenerated.\n\n\t* src/x86/ffi.c (ffi_prep_cif_machdep) [X86_DARWIN]: Treat like\n\tX86_WIN32, and additionally align stack to 16 bytes.\n\t* src/x86/darwin.S: New, based on sysv.S.\n\t* src/prep_cif.c (ffi_prep_cif) [X86_DARWIN]: Align > 8-byte structs.\n\n\nCo-Authored-By: Sandro Tolaini <tolaini@libero.it>\n\nFrom-SVN: r117602", "tree": {"sha": "762c9f3aff10eba9cc749027b216a10980d66258", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/762c9f3aff10eba9cc749027b216a10980d66258"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a3bd50cc4b053aa1224977404494b856eb625154", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3bd50cc4b053aa1224977404494b856eb625154", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a3bd50cc4b053aa1224977404494b856eb625154", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3bd50cc4b053aa1224977404494b856eb625154/comments", "author": {"login": "bonzini", "id": 42082, "node_id": "MDQ6VXNlcjQyMDgy", "avatar_url": "https://avatars.githubusercontent.com/u/42082?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bonzini", "html_url": "https://github.com/bonzini", "followers_url": "https://api.github.com/users/bonzini/followers", "following_url": "https://api.github.com/users/bonzini/following{/other_user}", "gists_url": "https://api.github.com/users/bonzini/gists{/gist_id}", "starred_url": "https://api.github.com/users/bonzini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bonzini/subscriptions", "organizations_url": "https://api.github.com/users/bonzini/orgs", "repos_url": "https://api.github.com/users/bonzini/repos", "events_url": "https://api.github.com/users/bonzini/events{/privacy}", "received_events_url": "https://api.github.com/users/bonzini/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0ded1615b8deae7fb1e3e2019bc652585c044587", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0ded1615b8deae7fb1e3e2019bc652585c044587", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0ded1615b8deae7fb1e3e2019bc652585c044587"}], "stats": {"total": 595, "additions": 537, "deletions": 58}, "files": [{"sha": "1ab090278720fd5a02408a3c4ae19a64c67e0f95", "filename": "libffi/ChangeLog", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2FChangeLog?ref=a3bd50cc4b053aa1224977404494b856eb625154", "patch": "@@ -1,3 +1,20 @@\n+2006-10-10  Paolo Bonzini  <bonzini@gnu.org>\n+\t    Sandro Tolaini  <tolaini@libero.it>\n+\n+\t* configure.ac [i*86-*-darwin*]: Set X86_DARWIN symbol and \n+\tconditional.\n+\t* configure: Regenerated.\n+\t* Makefile.am (nodist_libffi_la_SOURCES) [X86_DARWIN]: New case.\n+\t(EXTRA_DIST): Add src/x86/darwin.S.\n+\t* Makefile.in: Regenerated.\n+\t* include/Makefile.in: Regenerated.\n+\t* testsuite/Makefile.in: Regenerated.\n+\n+\t* src/x86/ffi.c (ffi_prep_cif_machdep) [X86_DARWIN]: Treat like\n+\tX86_WIN32, and additionally align stack to 16 bytes.\n+\t* src/x86/darwin.S: New, based on sysv.S.\n+\t* src/prep_cif.c (ffi_prep_cif) [X86_DARWIN]: Align > 8-byte structs.\n+\n 2006-09-12  David Daney  <ddaney@avtrex.com>\n \n \tPR libffi/23935"}, {"sha": "dc8f26ee78ddfd4ab28c2ac78553e243798c192c", "filename": "libffi/Makefile.am", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2FMakefile.am?ref=a3bd50cc4b053aa1224977404494b856eb625154", "patch": "@@ -24,7 +24,7 @@ EXTRA_DIST = LICENSE ChangeLog.v1 \\\n \tsrc/sh64/ffi.c src/sh64/sysv.S src/sh64/ffitarget.h \\\n \tsrc/sparc/v8.S src/sparc/v9.S src/sparc/ffitarget.h \\\n \tsrc/sparc/ffi.c \\\n-\tsrc/x86/ffi.c src/x86/sysv.S src/x86/win32.S \\\n+\tsrc/x86/ffi.c src/x86/sysv.S src/x86/win32.S src/x86/darwin.S \\\n \tsrc/x86/ffi64.c src/x86/unix64.S src/x86/ffitarget.h \\\n \tsrc/pa/ffi.c src/pa/linux.S src/pa/hpux32.S \\\n \tsrc/frv/eabi.S src/frv/ffitarget.h\n@@ -94,6 +94,9 @@ endif\n if X86_WIN32\n nodist_libffi_la_SOURCES += src/x86/ffi.c src/x86/win32.S\n endif\n+if X86_DARWIN\n+nodist_libffi_la_SOURCES += src/x86/ffi.c src/x86/darwin.S\n+endif\n if SPARC\n nodist_libffi_la_SOURCES += src/sparc/ffi.c src/sparc/v8.S src/sparc/v9.S\n endif"}, {"sha": "a4810e6a5cf5e2c676af23bd2a90c6c6051ab4d9", "filename": "libffi/Makefile.in", "status": "modified", "additions": 60, "deletions": 47, "changes": 107, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2FMakefile.in?ref=a3bd50cc4b053aa1224977404494b856eb625154", "patch": "@@ -41,24 +41,25 @@ target_triplet = @target@\n @MIPS_LINUX_TRUE@am__append_2 = src/mips/ffi.c src/mips/o32.S\n @X86_TRUE@am__append_3 = src/x86/ffi.c src/x86/sysv.S\n @X86_WIN32_TRUE@am__append_4 = src/x86/ffi.c src/x86/win32.S\n-@SPARC_TRUE@am__append_5 = src/sparc/ffi.c src/sparc/v8.S src/sparc/v9.S\n-@ALPHA_TRUE@am__append_6 = src/alpha/ffi.c src/alpha/osf.S\n-@IA64_TRUE@am__append_7 = src/ia64/ffi.c src/ia64/unix.S\n-@M32R_TRUE@am__append_8 = src/m32r/sysv.S src/m32r/ffi.c\n-@M68K_TRUE@am__append_9 = src/m68k/ffi.c src/m68k/sysv.S\n-@POWERPC_TRUE@am__append_10 = src/powerpc/ffi.c src/powerpc/sysv.S src/powerpc/ppc_closure.S src/powerpc/linux64.S src/powerpc/linux64_closure.S\n-@POWERPC_AIX_TRUE@am__append_11 = src/powerpc/ffi_darwin.c src/powerpc/aix.S src/powerpc/aix_closure.S\n-@POWERPC_DARWIN_TRUE@am__append_12 = src/powerpc/ffi_darwin.c src/powerpc/darwin.S src/powerpc/darwin_closure.S\n-@POWERPC_FREEBSD_TRUE@am__append_13 = src/powerpc/ffi.c src/powerpc/sysv.S src/powerpc/ppc_closure.S\n-@ARM_TRUE@am__append_14 = src/arm/sysv.S src/arm/ffi.c\n-@LIBFFI_CRIS_TRUE@am__append_15 = src/cris/sysv.S src/cris/ffi.c\n-@FRV_TRUE@am__append_16 = src/frv/eabi.S src/frv/ffi.c\n-@S390_TRUE@am__append_17 = src/s390/sysv.S src/s390/ffi.c\n-@X86_64_TRUE@am__append_18 = src/x86/ffi64.c src/x86/unix64.S src/x86/ffi.c src/x86/sysv.S\n-@SH_TRUE@am__append_19 = src/sh/sysv.S src/sh/ffi.c\n-@SH64_TRUE@am__append_20 = src/sh64/sysv.S src/sh64/ffi.c\n-@PA_LINUX_TRUE@am__append_21 = src/pa/linux.S src/pa/ffi.c\n-@PA_HPUX_TRUE@am__append_22 = src/pa/hpux32.S src/pa/ffi.c\n+@X86_DARWIN_TRUE@am__append_5 = src/x86/ffi.c src/x86/darwin.S\n+@SPARC_TRUE@am__append_6 = src/sparc/ffi.c src/sparc/v8.S src/sparc/v9.S\n+@ALPHA_TRUE@am__append_7 = src/alpha/ffi.c src/alpha/osf.S\n+@IA64_TRUE@am__append_8 = src/ia64/ffi.c src/ia64/unix.S\n+@M32R_TRUE@am__append_9 = src/m32r/sysv.S src/m32r/ffi.c\n+@M68K_TRUE@am__append_10 = src/m68k/ffi.c src/m68k/sysv.S\n+@POWERPC_TRUE@am__append_11 = src/powerpc/ffi.c src/powerpc/sysv.S src/powerpc/ppc_closure.S src/powerpc/linux64.S src/powerpc/linux64_closure.S\n+@POWERPC_AIX_TRUE@am__append_12 = src/powerpc/ffi_darwin.c src/powerpc/aix.S src/powerpc/aix_closure.S\n+@POWERPC_DARWIN_TRUE@am__append_13 = src/powerpc/ffi_darwin.c src/powerpc/darwin.S src/powerpc/darwin_closure.S\n+@POWERPC_FREEBSD_TRUE@am__append_14 = src/powerpc/ffi.c src/powerpc/sysv.S src/powerpc/ppc_closure.S\n+@ARM_TRUE@am__append_15 = src/arm/sysv.S src/arm/ffi.c\n+@LIBFFI_CRIS_TRUE@am__append_16 = src/cris/sysv.S src/cris/ffi.c\n+@FRV_TRUE@am__append_17 = src/frv/eabi.S src/frv/ffi.c\n+@S390_TRUE@am__append_18 = src/s390/sysv.S src/s390/ffi.c\n+@X86_64_TRUE@am__append_19 = src/x86/ffi64.c src/x86/unix64.S src/x86/ffi.c src/x86/sysv.S\n+@SH_TRUE@am__append_20 = src/sh/sysv.S src/sh/ffi.c\n+@SH64_TRUE@am__append_21 = src/sh64/sysv.S src/sh64/ffi.c\n+@PA_LINUX_TRUE@am__append_22 = src/pa/linux.S src/pa/ffi.c\n+@PA_HPUX_TRUE@am__append_23 = src/pa/hpux32.S src/pa/ffi.c\n DIST_COMMON = README $(am__configure_deps) $(srcdir)/../compile \\\n \t$(srcdir)/../config.guess $(srcdir)/../config.sub \\\n \t$(srcdir)/../depcomp $(srcdir)/../install-sh \\\n@@ -95,58 +96,59 @@ am_libffi_la_OBJECTS = src/debug.lo src/prep_cif.lo src/types.lo \\\n @MIPS_LINUX_TRUE@am__objects_2 = src/mips/ffi.lo src/mips/o32.lo\n @X86_TRUE@am__objects_3 = src/x86/ffi.lo src/x86/sysv.lo\n @X86_WIN32_TRUE@am__objects_4 = src/x86/ffi.lo src/x86/win32.lo\n-@SPARC_TRUE@am__objects_5 = src/sparc/ffi.lo src/sparc/v8.lo \\\n+@X86_DARWIN_TRUE@am__objects_5 = src/x86/ffi.lo src/x86/darwin.lo\n+@SPARC_TRUE@am__objects_6 = src/sparc/ffi.lo src/sparc/v8.lo \\\n @SPARC_TRUE@\tsrc/sparc/v9.lo\n-@ALPHA_TRUE@am__objects_6 = src/alpha/ffi.lo src/alpha/osf.lo\n-@IA64_TRUE@am__objects_7 = src/ia64/ffi.lo src/ia64/unix.lo\n-@M32R_TRUE@am__objects_8 = src/m32r/sysv.lo src/m32r/ffi.lo\n-@M68K_TRUE@am__objects_9 = src/m68k/ffi.lo src/m68k/sysv.lo\n-@POWERPC_TRUE@am__objects_10 = src/powerpc/ffi.lo src/powerpc/sysv.lo \\\n+@ALPHA_TRUE@am__objects_7 = src/alpha/ffi.lo src/alpha/osf.lo\n+@IA64_TRUE@am__objects_8 = src/ia64/ffi.lo src/ia64/unix.lo\n+@M32R_TRUE@am__objects_9 = src/m32r/sysv.lo src/m32r/ffi.lo\n+@M68K_TRUE@am__objects_10 = src/m68k/ffi.lo src/m68k/sysv.lo\n+@POWERPC_TRUE@am__objects_11 = src/powerpc/ffi.lo src/powerpc/sysv.lo \\\n @POWERPC_TRUE@\tsrc/powerpc/ppc_closure.lo \\\n @POWERPC_TRUE@\tsrc/powerpc/linux64.lo \\\n @POWERPC_TRUE@\tsrc/powerpc/linux64_closure.lo\n-@POWERPC_AIX_TRUE@am__objects_11 = src/powerpc/ffi_darwin.lo \\\n+@POWERPC_AIX_TRUE@am__objects_12 = src/powerpc/ffi_darwin.lo \\\n @POWERPC_AIX_TRUE@\tsrc/powerpc/aix.lo \\\n @POWERPC_AIX_TRUE@\tsrc/powerpc/aix_closure.lo\n-@POWERPC_DARWIN_TRUE@am__objects_12 = src/powerpc/ffi_darwin.lo \\\n+@POWERPC_DARWIN_TRUE@am__objects_13 = src/powerpc/ffi_darwin.lo \\\n @POWERPC_DARWIN_TRUE@\tsrc/powerpc/darwin.lo \\\n @POWERPC_DARWIN_TRUE@\tsrc/powerpc/darwin_closure.lo\n-@POWERPC_FREEBSD_TRUE@am__objects_13 = src/powerpc/ffi.lo \\\n+@POWERPC_FREEBSD_TRUE@am__objects_14 = src/powerpc/ffi.lo \\\n @POWERPC_FREEBSD_TRUE@\tsrc/powerpc/sysv.lo \\\n @POWERPC_FREEBSD_TRUE@\tsrc/powerpc/ppc_closure.lo\n-@ARM_TRUE@am__objects_14 = src/arm/sysv.lo src/arm/ffi.lo\n-@LIBFFI_CRIS_TRUE@am__objects_15 = src/cris/sysv.lo src/cris/ffi.lo\n-@FRV_TRUE@am__objects_16 = src/frv/eabi.lo src/frv/ffi.lo\n-@S390_TRUE@am__objects_17 = src/s390/sysv.lo src/s390/ffi.lo\n-@X86_64_TRUE@am__objects_18 = src/x86/ffi64.lo src/x86/unix64.lo \\\n+@ARM_TRUE@am__objects_15 = src/arm/sysv.lo src/arm/ffi.lo\n+@LIBFFI_CRIS_TRUE@am__objects_16 = src/cris/sysv.lo src/cris/ffi.lo\n+@FRV_TRUE@am__objects_17 = src/frv/eabi.lo src/frv/ffi.lo\n+@S390_TRUE@am__objects_18 = src/s390/sysv.lo src/s390/ffi.lo\n+@X86_64_TRUE@am__objects_19 = src/x86/ffi64.lo src/x86/unix64.lo \\\n @X86_64_TRUE@\tsrc/x86/ffi.lo src/x86/sysv.lo\n-@SH_TRUE@am__objects_19 = src/sh/sysv.lo src/sh/ffi.lo\n-@SH64_TRUE@am__objects_20 = src/sh64/sysv.lo src/sh64/ffi.lo\n-@PA_LINUX_TRUE@am__objects_21 = src/pa/linux.lo src/pa/ffi.lo\n-@PA_HPUX_TRUE@am__objects_22 = src/pa/hpux32.lo src/pa/ffi.lo\n+@SH_TRUE@am__objects_20 = src/sh/sysv.lo src/sh/ffi.lo\n+@SH64_TRUE@am__objects_21 = src/sh64/sysv.lo src/sh64/ffi.lo\n+@PA_LINUX_TRUE@am__objects_22 = src/pa/linux.lo src/pa/ffi.lo\n+@PA_HPUX_TRUE@am__objects_23 = src/pa/hpux32.lo src/pa/ffi.lo\n nodist_libffi_la_OBJECTS = $(am__objects_1) $(am__objects_2) \\\n \t$(am__objects_3) $(am__objects_4) $(am__objects_5) \\\n \t$(am__objects_6) $(am__objects_7) $(am__objects_8) \\\n \t$(am__objects_9) $(am__objects_10) $(am__objects_11) \\\n \t$(am__objects_12) $(am__objects_13) $(am__objects_14) \\\n \t$(am__objects_15) $(am__objects_16) $(am__objects_17) \\\n \t$(am__objects_18) $(am__objects_19) $(am__objects_20) \\\n-\t$(am__objects_21) $(am__objects_22)\n+\t$(am__objects_21) $(am__objects_22) $(am__objects_23)\n libffi_la_OBJECTS = $(am_libffi_la_OBJECTS) \\\n \t$(nodist_libffi_la_OBJECTS)\n libffi_convenience_la_LIBADD =\n-am__objects_23 = src/debug.lo src/prep_cif.lo src/types.lo \\\n+am__objects_24 = src/debug.lo src/prep_cif.lo src/types.lo \\\n \tsrc/raw_api.lo src/java_raw_api.lo\n-am_libffi_convenience_la_OBJECTS = $(am__objects_23)\n-am__objects_24 = $(am__objects_1) $(am__objects_2) $(am__objects_3) \\\n+am_libffi_convenience_la_OBJECTS = $(am__objects_24)\n+am__objects_25 = $(am__objects_1) $(am__objects_2) $(am__objects_3) \\\n \t$(am__objects_4) $(am__objects_5) $(am__objects_6) \\\n \t$(am__objects_7) $(am__objects_8) $(am__objects_9) \\\n \t$(am__objects_10) $(am__objects_11) $(am__objects_12) \\\n \t$(am__objects_13) $(am__objects_14) $(am__objects_15) \\\n \t$(am__objects_16) $(am__objects_17) $(am__objects_18) \\\n \t$(am__objects_19) $(am__objects_20) $(am__objects_21) \\\n-\t$(am__objects_22)\n-nodist_libffi_convenience_la_OBJECTS = $(am__objects_24)\n+\t$(am__objects_22) $(am__objects_23)\n+nodist_libffi_convenience_la_OBJECTS = $(am__objects_25)\n libffi_convenience_la_OBJECTS = $(am_libffi_convenience_la_OBJECTS) \\\n \t$(nodist_libffi_convenience_la_OBJECTS)\n DEFAULT_INCLUDES = -I. -I$(srcdir) -I.\n@@ -232,6 +234,7 @@ F77 = @F77@\n FFLAGS = @FFLAGS@\n FRV_FALSE = @FRV_FALSE@\n FRV_TRUE = @FRV_TRUE@\n+GREP = @GREP@\n HAVE_LONG_DOUBLE = @HAVE_LONG_DOUBLE@\n IA64_FALSE = @IA64_FALSE@\n IA64_TRUE = @IA64_TRUE@\n@@ -300,16 +303,15 @@ TESTSUBDIR_TRUE = @TESTSUBDIR_TRUE@\n VERSION = @VERSION@\n X86_64_FALSE = @X86_64_FALSE@\n X86_64_TRUE = @X86_64_TRUE@\n+X86_DARWIN_FALSE = @X86_DARWIN_FALSE@\n+X86_DARWIN_TRUE = @X86_DARWIN_TRUE@\n X86_FALSE = @X86_FALSE@\n X86_TRUE = @X86_TRUE@\n X86_WIN32_FALSE = @X86_WIN32_FALSE@\n X86_WIN32_TRUE = @X86_WIN32_TRUE@\n-ac_ct_AR = @ac_ct_AR@\n ac_ct_CC = @ac_ct_CC@\n ac_ct_CXX = @ac_ct_CXX@\n ac_ct_F77 = @ac_ct_F77@\n-ac_ct_RANLIB = @ac_ct_RANLIB@\n-ac_ct_STRIP = @ac_ct_STRIP@\n am__fastdepCC_FALSE = @am__fastdepCC_FALSE@\n am__fastdepCC_TRUE = @am__fastdepCC_TRUE@\n am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@\n@@ -326,24 +328,31 @@ build_cpu = @build_cpu@\n build_os = @build_os@\n build_vendor = @build_vendor@\n datadir = @datadir@\n+datarootdir = @datarootdir@\n+docdir = @docdir@\n+dvidir = @dvidir@\n exec_prefix = @exec_prefix@\n host = @host@\n host_alias = @host_alias@\n host_cpu = @host_cpu@\n host_os = @host_os@\n host_vendor = @host_vendor@\n+htmldir = @htmldir@\n includedir = @includedir@\n infodir = @infodir@\n install_sh = @install_sh@\n libdir = @libdir@\n libexecdir = @libexecdir@\n+localedir = @localedir@\n localstatedir = @localstatedir@\n mandir = @mandir@\n mkdir_p = @mkdir_p@\n multi_basedir = @multi_basedir@\n oldincludedir = @oldincludedir@\n+pdfdir = @pdfdir@\n prefix = @prefix@\n program_transform_name = @program_transform_name@\n+psdir = @psdir@\n sbindir = @sbindir@\n sharedstatedir = @sharedstatedir@\n sysconfdir = @sysconfdir@\n@@ -376,7 +385,7 @@ EXTRA_DIST = LICENSE ChangeLog.v1 \\\n \tsrc/sh64/ffi.c src/sh64/sysv.S src/sh64/ffitarget.h \\\n \tsrc/sparc/v8.S src/sparc/v9.S src/sparc/ffitarget.h \\\n \tsrc/sparc/ffi.c \\\n-\tsrc/x86/ffi.c src/x86/sysv.S src/x86/win32.S \\\n+\tsrc/x86/ffi.c src/x86/sysv.S src/x86/win32.S src/x86/darwin.S \\\n \tsrc/x86/ffi64.c src/x86/unix64.S src/x86/ffitarget.h \\\n \tsrc/pa/ffi.c src/pa/linux.S src/pa/hpux32.S \\\n \tsrc/frv/eabi.S src/frv/ffitarget.h\n@@ -432,7 +441,7 @@ nodist_libffi_la_SOURCES = $(am__append_1) $(am__append_2) \\\n \t$(am__append_12) $(am__append_13) $(am__append_14) \\\n \t$(am__append_15) $(am__append_16) $(am__append_17) \\\n \t$(am__append_18) $(am__append_19) $(am__append_20) \\\n-\t$(am__append_21) $(am__append_22)\n+\t$(am__append_21) $(am__append_22) $(am__append_23)\n libffi_convenience_la_SOURCES = $(libffi_la_SOURCES)\n nodist_libffi_convenience_la_SOURCES = $(nodist_libffi_la_SOURCES)\n AM_CFLAGS = -Wall -g -fexceptions\n@@ -565,6 +574,8 @@ src/x86/sysv.lo: src/x86/$(am__dirstamp) \\\n \tsrc/x86/$(DEPDIR)/$(am__dirstamp)\n src/x86/win32.lo: src/x86/$(am__dirstamp) \\\n \tsrc/x86/$(DEPDIR)/$(am__dirstamp)\n+src/x86/darwin.lo: src/x86/$(am__dirstamp) \\\n+\tsrc/x86/$(DEPDIR)/$(am__dirstamp)\n src/sparc/$(am__dirstamp):\n \t@$(mkdir_p) src/sparc\n \t@: > src/sparc/$(am__dirstamp)\n@@ -812,6 +823,8 @@ mostlyclean-compile:\n \t-rm -f src/sparc/v9.lo\n \t-rm -f src/types.$(OBJEXT)\n \t-rm -f src/types.lo\n+\t-rm -f src/x86/darwin.$(OBJEXT)\n+\t-rm -f src/x86/darwin.lo\n \t-rm -f src/x86/ffi.$(OBJEXT)\n \t-rm -f src/x86/ffi.lo\n \t-rm -f src/x86/ffi64.$(OBJEXT)"}, {"sha": "fb53fa495796b63b3ac3006a831e9592f86677f8", "filename": "libffi/configure", "status": "modified", "additions": 21, "deletions": 1, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Fconfigure?ref=a3bd50cc4b053aa1224977404494b856eb625154", "patch": "@@ -310,7 +310,7 @@ ac_includes_default=\"\\\n # include <unistd.h>\n #endif\"\n \n-ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS multi_basedir build build_cpu build_vendor build_os host host_cpu host_vendor host_os target target_cpu target_vendor target_os INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA CYGPATH_W PACKAGE VERSION ACLOCAL AUTOCONF AUTOMAKE AUTOHEADER MAKEINFO install_sh STRIP ac_ct_STRIP INSTALL_STRIP_PROGRAM mkdir_p AWK SET_MAKE am__leading_dot AMTAR am__tar am__untar CC ac_ct_CC EXEEXT OBJEXT DEPDIR am__include am__quote AMDEP_TRUE AMDEP_FALSE AMDEPBACKSLASH CCDEPMODE am__fastdepCC_TRUE am__fastdepCC_FALSE CFLAGS CCAS CCASFLAGS LN_S RANLIB ac_ct_RANLIB LIBTOOL MAINTAINER_MODE_TRUE MAINTAINER_MODE_FALSE MAINT CPP CPPFLAGS EGREP TESTSUBDIR_TRUE TESTSUBDIR_FALSE AM_RUNTESTFLAGS MIPS_IRIX_TRUE MIPS_IRIX_FALSE MIPS_LINUX_TRUE MIPS_LINUX_FALSE SPARC_TRUE SPARC_FALSE X86_TRUE X86_FALSE X86_WIN32_TRUE X86_WIN32_FALSE ALPHA_TRUE ALPHA_FALSE IA64_TRUE IA64_FALSE M32R_TRUE M32R_FALSE M68K_TRUE M68K_FALSE POWERPC_TRUE POWERPC_FALSE POWERPC_AIX_TRUE POWERPC_AIX_FALSE POWERPC_DARWIN_TRUE POWERPC_DARWIN_FALSE POWERPC_FREEBSD_TRUE POWERPC_FREEBSD_FALSE ARM_TRUE ARM_FALSE LIBFFI_CRIS_TRUE LIBFFI_CRIS_FALSE FRV_TRUE FRV_FALSE S390_TRUE S390_FALSE X86_64_TRUE X86_64_FALSE SH_TRUE SH_FALSE SH64_TRUE SH64_FALSE PA_LINUX_TRUE PA_LINUX_FALSE PA_HPUX_TRUE PA_HPUX_FALSE PA64_HPUX_TRUE PA64_HPUX_FALSE ALLOCA HAVE_LONG_DOUBLE TARGET TARGETDIR toolexecdir toolexeclibdir LIBOBJS LTLIBOBJS'\n+ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS multi_basedir build build_cpu build_vendor build_os host host_cpu host_vendor host_os target target_cpu target_vendor target_os INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA CYGPATH_W PACKAGE VERSION ACLOCAL AUTOCONF AUTOMAKE AUTOHEADER MAKEINFO install_sh STRIP ac_ct_STRIP INSTALL_STRIP_PROGRAM mkdir_p AWK SET_MAKE am__leading_dot AMTAR am__tar am__untar CC ac_ct_CC EXEEXT OBJEXT DEPDIR am__include am__quote AMDEP_TRUE AMDEP_FALSE AMDEPBACKSLASH CCDEPMODE am__fastdepCC_TRUE am__fastdepCC_FALSE CFLAGS CCAS CCASFLAGS LN_S RANLIB ac_ct_RANLIB LIBTOOL MAINTAINER_MODE_TRUE MAINTAINER_MODE_FALSE MAINT CPP CPPFLAGS EGREP TESTSUBDIR_TRUE TESTSUBDIR_FALSE AM_RUNTESTFLAGS MIPS_IRIX_TRUE MIPS_IRIX_FALSE MIPS_LINUX_TRUE MIPS_LINUX_FALSE SPARC_TRUE SPARC_FALSE X86_TRUE X86_FALSE X86_WIN32_TRUE X86_WIN32_FALSE X86_DARWIN_TRUE X86_DARWIN_FALSE ALPHA_TRUE ALPHA_FALSE IA64_TRUE IA64_FALSE M32R_TRUE M32R_FALSE M68K_TRUE M68K_FALSE POWERPC_TRUE POWERPC_FALSE POWERPC_AIX_TRUE POWERPC_AIX_FALSE POWERPC_DARWIN_TRUE POWERPC_DARWIN_FALSE POWERPC_FREEBSD_TRUE POWERPC_FREEBSD_FALSE ARM_TRUE ARM_FALSE LIBFFI_CRIS_TRUE LIBFFI_CRIS_FALSE FRV_TRUE FRV_FALSE S390_TRUE S390_FALSE X86_64_TRUE X86_64_FALSE SH_TRUE SH_FALSE SH64_TRUE SH64_FALSE PA_LINUX_TRUE PA_LINUX_FALSE PA_HPUX_TRUE PA_HPUX_FALSE PA64_HPUX_TRUE PA64_HPUX_FALSE ALLOCA HAVE_LONG_DOUBLE TARGET TARGETDIR toolexecdir toolexeclibdir LIBOBJS LTLIBOBJS'\n ac_subst_files=''\n \n # Initialize some variables set by options.\n@@ -5381,6 +5381,7 @@ i*86-*-gnu*) TARGET=X86; TARGETDIR=x86;;\n i*86-*-solaris2.1[0-9]*) TARGET=X86_64; TARGETDIR=x86;;\n i*86-*-solaris*) TARGET=X86; TARGETDIR=x86;;\n i*86-*-beos*) TARGET=X86; TARGETDIR=x86;;\n+i*86-*-darwin*) TARGET=X86_DARWIN; TARGETDIR=x86;;\n i*86-*-freebsd* | i*86-*-kfreebsd*-gnu) TARGET=X86; TARGETDIR=x86;;\n i*86-*-netbsdelf* | i*86-*-knetbsd*-gnu) TARGET=X86; TARGETDIR=x86;;\n i*86-*-rtems*) TARGET=X86; TARGETDIR=x86;;\n@@ -5482,6 +5483,16 @@ fi\n \n \n \n+if test x$TARGET = xX86_DARWIN; then\n+  X86_DARWIN_TRUE=\n+  X86_DARWIN_FALSE='#'\n+else\n+  X86_DARWIN_TRUE='#'\n+  X86_DARWIN_FALSE=\n+fi\n+\n+\n+\n if test x$TARGET = xALPHA; then\n   ALPHA_TRUE=\n   ALPHA_FALSE='#'\n@@ -7818,6 +7829,13 @@ echo \"$as_me: error: conditional \\\"X86_WIN32\\\" was never defined.\n Usually this means the macro was only invoked conditionally.\" >&2;}\n    { (exit 1); exit 1; }; }\n fi\n+if test -z \"${X86_DARWIN_TRUE}\" && test -z \"${X86_DARWIN_FALSE}\"; then\n+  { { echo \"$as_me:$LINENO: error: conditional \\\"X86_DARWIN\\\" was never defined.\n+Usually this means the macro was only invoked conditionally.\" >&5\n+echo \"$as_me: error: conditional \\\"X86_DARWIN\\\" was never defined.\n+Usually this means the macro was only invoked conditionally.\" >&2;}\n+   { (exit 1); exit 1; }; }\n+fi\n if test -z \"${ALPHA_TRUE}\" && test -z \"${ALPHA_FALSE}\"; then\n   { { echo \"$as_me:$LINENO: error: conditional \\\"ALPHA\\\" was never defined.\n Usually this means the macro was only invoked conditionally.\" >&5\n@@ -8573,6 +8591,8 @@ s,@X86_TRUE@,$X86_TRUE,;t t\n s,@X86_FALSE@,$X86_FALSE,;t t\n s,@X86_WIN32_TRUE@,$X86_WIN32_TRUE,;t t\n s,@X86_WIN32_FALSE@,$X86_WIN32_FALSE,;t t\n+s,@X86_DARWIN_TRUE@,$X86_DARWIN_TRUE,;t t\n+s,@X86_DARWIN_FALSE@,$X86_DARWIN_FALSE,;t t\n s,@ALPHA_TRUE@,$ALPHA_TRUE,;t t\n s,@ALPHA_FALSE@,$ALPHA_FALSE,;t t\n s,@IA64_TRUE@,$IA64_TRUE,;t t"}, {"sha": "9d04cf5dcd035673c212a483b0ce28e4448fc748", "filename": "libffi/configure.ac", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Fconfigure.ac?ref=a3bd50cc4b053aa1224977404494b856eb625154", "patch": "@@ -46,6 +46,7 @@ i*86-*-gnu*) TARGET=X86; TARGETDIR=x86;;\n i*86-*-solaris2.1[[0-9]]*) TARGET=X86_64; TARGETDIR=x86;;\n i*86-*-solaris*) TARGET=X86; TARGETDIR=x86;;\n i*86-*-beos*) TARGET=X86; TARGETDIR=x86;;\n+i*86-*-darwin*) TARGET=X86_DARWIN; TARGETDIR=x86;;\n i*86-*-freebsd* | i*86-*-kfreebsd*-gnu) TARGET=X86; TARGETDIR=x86;;\n i*86-*-netbsdelf* | i*86-*-knetbsd*-gnu) TARGET=X86; TARGETDIR=x86;;\n i*86-*-rtems*) TARGET=X86; TARGETDIR=x86;;\n@@ -98,6 +99,7 @@ AM_CONDITIONAL(MIPS_LINUX, test x$TARGET = xMIPS_LINUX)\n AM_CONDITIONAL(SPARC, test x$TARGET = xSPARC)\n AM_CONDITIONAL(X86, test x$TARGET = xX86)\n AM_CONDITIONAL(X86_WIN32, test x$TARGET = xX86_WIN32)\n+AM_CONDITIONAL(X86_DARWIN, test x$TARGET = xX86_DARWIN)\n AM_CONDITIONAL(ALPHA, test x$TARGET = xALPHA)\n AM_CONDITIONAL(IA64, test x$TARGET = xIA64)\n AM_CONDITIONAL(M32R, test x$TARGET = xM32R)"}, {"sha": "ed2fd5977f8ec26b9a73e7edc1ebac0964e2035d", "filename": "libffi/include/Makefile.in", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2Finclude%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2Finclude%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Finclude%2FMakefile.in?ref=a3bd50cc4b053aa1224977404494b856eb625154", "patch": "@@ -101,6 +101,7 @@ F77 = @F77@\n FFLAGS = @FFLAGS@\n FRV_FALSE = @FRV_FALSE@\n FRV_TRUE = @FRV_TRUE@\n+GREP = @GREP@\n HAVE_LONG_DOUBLE = @HAVE_LONG_DOUBLE@\n IA64_FALSE = @IA64_FALSE@\n IA64_TRUE = @IA64_TRUE@\n@@ -169,16 +170,15 @@ TESTSUBDIR_TRUE = @TESTSUBDIR_TRUE@\n VERSION = @VERSION@\n X86_64_FALSE = @X86_64_FALSE@\n X86_64_TRUE = @X86_64_TRUE@\n+X86_DARWIN_FALSE = @X86_DARWIN_FALSE@\n+X86_DARWIN_TRUE = @X86_DARWIN_TRUE@\n X86_FALSE = @X86_FALSE@\n X86_TRUE = @X86_TRUE@\n X86_WIN32_FALSE = @X86_WIN32_FALSE@\n X86_WIN32_TRUE = @X86_WIN32_TRUE@\n-ac_ct_AR = @ac_ct_AR@\n ac_ct_CC = @ac_ct_CC@\n ac_ct_CXX = @ac_ct_CXX@\n ac_ct_F77 = @ac_ct_F77@\n-ac_ct_RANLIB = @ac_ct_RANLIB@\n-ac_ct_STRIP = @ac_ct_STRIP@\n am__fastdepCC_FALSE = @am__fastdepCC_FALSE@\n am__fastdepCC_TRUE = @am__fastdepCC_TRUE@\n am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@\n@@ -195,24 +195,31 @@ build_cpu = @build_cpu@\n build_os = @build_os@\n build_vendor = @build_vendor@\n datadir = @datadir@\n+datarootdir = @datarootdir@\n+docdir = @docdir@\n+dvidir = @dvidir@\n exec_prefix = @exec_prefix@\n host = @host@\n host_alias = @host_alias@\n host_cpu = @host_cpu@\n host_os = @host_os@\n host_vendor = @host_vendor@\n+htmldir = @htmldir@\n includedir = @includedir@\n infodir = @infodir@\n install_sh = @install_sh@\n libdir = @libdir@\n libexecdir = @libexecdir@\n+localedir = @localedir@\n localstatedir = @localstatedir@\n mandir = @mandir@\n mkdir_p = @mkdir_p@\n multi_basedir = @multi_basedir@\n oldincludedir = @oldincludedir@\n+pdfdir = @pdfdir@\n prefix = @prefix@\n program_transform_name = @program_transform_name@\n+psdir = @psdir@\n sbindir = @sbindir@\n sharedstatedir = @sharedstatedir@\n sysconfdir = @sysconfdir@"}, {"sha": "0e202cfe1f77a002bd297776b555011ee5b17e3b", "filename": "libffi/src/prep_cif.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2Fsrc%2Fprep_cif.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2Fsrc%2Fprep_cif.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Fsrc%2Fprep_cif.c?ref=a3bd50cc4b053aa1224977404494b856eb625154", "patch": "@@ -115,7 +115,10 @@ ffi_status ffi_prep_cif(ffi_cif *cif, ffi_abi abi, unsigned int nargs,\n #ifdef SPARC\n       && (cif->abi != FFI_V9 || cif->rtype->size > 32)\n #endif\n-      )\n+#ifdef X86_DARWIN\n+      && (cif->rtype->size > 8)\n+#endif\n+     )\n     bytes = STACK_ARG_SIZE(sizeof(void*));\n #endif\n "}, {"sha": "aec9b8212a7d0861f1afffa97643389b6ed7e28e", "filename": "libffi/src/x86/darwin.S", "status": "added", "additions": 403, "deletions": 0, "changes": 403, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2Fsrc%2Fx86%2Fdarwin.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2Fsrc%2Fx86%2Fdarwin.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Fsrc%2Fx86%2Fdarwin.S?ref=a3bd50cc4b053aa1224977404494b856eb625154", "patch": "@@ -0,0 +1,403 @@\n+/* -----------------------------------------------------------------------\n+   sysv.S - Copyright (c) 1996, 1998, 2001, 2002, 2003, 2005  Red Hat, Inc.\n+   \n+   X86 Foreign Function Interface \n+\n+   Permission is hereby granted, free of charge, to any person obtaining\n+   a copy of this software and associated documentation files (the\n+   ``Software''), to deal in the Software without restriction, including\n+   without limitation the rights to use, copy, modify, merge, publish,\n+   distribute, sublicense, and/or sell copies of the Software, and to\n+   permit persons to whom the Software is furnished to do so, subject to\n+   the following conditions:\n+\n+   The above copyright notice and this permission notice shall be included\n+   in all copies or substantial portions of the Software.\n+\n+   THE SOFTWARE IS PROVIDED ``AS IS'', WITHOUT WARRANTY OF ANY KIND, EXPRESS\n+   OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n+   MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n+   IN NO EVENT SHALL CYGNUS SOLUTIONS BE LIABLE FOR ANY CLAIM, DAMAGES OR\n+   OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,\n+   ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n+   OTHER DEALINGS IN THE SOFTWARE.\n+   ----------------------------------------------------------------------- */\n+\n+#ifndef __x86_64__\n+\n+#define LIBFFI_ASM\t\n+#include <fficonfig.h>\n+#include <ffi.h>\n+\n+.text\n+\n+.globl _ffi_prep_args\n+\n+\t.align 4\n+.globl _ffi_call_SYSV\n+\n+_ffi_call_SYSV:\n+.LFB1:\n+        pushl %ebp\n+.LCFI0:\n+        movl  %esp,%ebp\n+.LCFI1:\n+        subl $8,%esp\n+\t/* Make room for all of the new args.  */\n+\tmovl  16(%ebp),%ecx\n+\tsubl  %ecx,%esp\n+\n+\tmovl  %esp,%eax\n+\n+\t/* Place all of the ffi_prep_args in position  */\n+\tsubl  $8,%esp\n+\tpushl 12(%ebp)\n+\tpushl %eax\n+\tcall  *8(%ebp)\n+\n+\t/* Return stack to previous state and call the function  */\n+\taddl  $16,%esp\t\n+\n+\tcall  *28(%ebp)\n+\n+\t/* Remove the space we pushed for the args  */\n+\tmovl  16(%ebp),%ecx\n+\taddl  %ecx,%esp\n+\n+\t/* Load %ecx with the return type code  */\n+\tmovl  20(%ebp),%ecx\t\n+\n+\t/* If the return value pointer is NULL, assume no return value.  */\n+\tcmpl  $0,24(%ebp)\n+\tjne   retint\n+\n+\t/* Even if there is no space for the return value, we are \n+\t   obliged to handle floating-point values.  */\n+\tcmpl  $FFI_TYPE_FLOAT,%ecx\n+\tjne   noretval\n+\tfstp  %st(0)\n+\n+        jmp   epilogue\n+\n+retint:\n+\tcmpl  $FFI_TYPE_INT,%ecx\n+\tjne   retfloat\n+\t/* Load %ecx with the pointer to storage for the return value  */\n+\tmovl  24(%ebp),%ecx\t\n+\tmovl  %eax,0(%ecx)\n+\tjmp   epilogue\n+\n+retfloat:\n+\tcmpl  $FFI_TYPE_FLOAT,%ecx\n+\tjne   retdouble\n+\t/* Load %ecx with the pointer to storage for the return value  */\n+\tmovl  24(%ebp),%ecx\t\n+\tfstps (%ecx)\n+\tjmp   epilogue\n+\n+retdouble:\n+\tcmpl  $FFI_TYPE_DOUBLE,%ecx\n+\tjne   retlongdouble\n+\t/* Load %ecx with the pointer to storage for the return value  */\n+\tmovl  24(%ebp),%ecx\t\n+\tfstpl (%ecx)\n+\tjmp   epilogue\n+\n+retlongdouble:\n+\tcmpl  $FFI_TYPE_LONGDOUBLE,%ecx\n+\tjne   retint64\n+\t/* Load %ecx with the pointer to storage for the return value  */\n+\tmovl  24(%ebp),%ecx\t\n+\tfstpt (%ecx)\n+\tjmp   epilogue\n+\t\n+retint64:\t\n+\tcmpl  $FFI_TYPE_SINT64,%ecx\n+        jne   retstruct1b\n+\t/* Load %ecx with the pointer to storage for the return value  */\n+\tmovl  24(%ebp),%ecx\t\n+\tmovl  %eax,0(%ecx)\n+\tmovl  %edx,4(%ecx)\n+\tjmp   epilogue\n+\t\n+retstruct1b:\t\n+\tcmpl  $FFI_TYPE_SINT8,%ecx\n+        jne   retstruct2b\n+\t/* Load %ecx with the pointer to storage for the return value  */\n+\tmovl  24(%ebp),%ecx\t\n+\tmovb  %al,0(%ecx)\n+\tjmp   epilogue\n+\n+retstruct2b:\t\n+\tcmpl  $FFI_TYPE_SINT16,%ecx\n+        jne   retstruct\n+\t/* Load %ecx with the pointer to storage for the return value  */\n+\tmovl  24(%ebp),%ecx\t\n+\tmovw  %ax,0(%ecx)\n+\tjmp   epilogue\n+\n+retstruct:\n+\tcmpl  $FFI_TYPE_STRUCT,%ecx\n+        jne   noretval\n+\t/* Nothing to do!  */\n+        addl $4,%esp\n+        popl %ebp\n+        ret\n+\n+noretval:\n+epilogue:\n+        addl $8,%esp\n+        movl %ebp,%esp\n+        popl %ebp\n+        ret\n+.LFE1:\n+.ffi_call_SYSV_end:\n+\n+\t.align\t4\n+FFI_HIDDEN (ffi_closure_SYSV)\n+.globl _ffi_closure_SYSV\n+\n+_ffi_closure_SYSV:\n+.LFB2:\n+\tpushl\t%ebp\n+.LCFI2:\n+\tmovl\t%esp, %ebp\n+.LCFI3:\n+\tsubl\t$40, %esp\n+\tleal\t-24(%ebp), %edx\n+\tmovl\t%edx, -12(%ebp)\t/* resp */\n+\tleal\t8(%ebp), %edx\n+\tmovl\t%edx, 4(%esp)\t/* args = __builtin_dwarf_cfa () */\n+\tleal\t-12(%ebp), %edx\n+\tmovl\t%edx, (%esp)\t/* &resp */\n+\tmovl\t%ebx, 8(%esp)\n+.LCFI7:\n+\tcall\tL_ffi_closure_SYSV_inner$stub\n+\tmovl\t8(%esp), %ebx\n+\tmovl\t-12(%ebp), %ecx\n+\tcmpl\t$FFI_TYPE_INT, %eax\n+\tje\t.Lcls_retint\n+\tcmpl\t$FFI_TYPE_FLOAT, %eax\n+\tje\t.Lcls_retfloat\n+\tcmpl\t$FFI_TYPE_DOUBLE, %eax\n+\tje\t.Lcls_retdouble\n+\tcmpl\t$FFI_TYPE_LONGDOUBLE, %eax\n+\tje\t.Lcls_retldouble\n+\tcmpl\t$FFI_TYPE_SINT64, %eax\n+\tje\t.Lcls_retllong\n+\tcmpl\t$FFI_TYPE_SINT8, %eax\n+\tje\t.Lcls_retstruct1\n+\tcmpl\t$FFI_TYPE_SINT16, %eax\n+\tje\t.Lcls_retstruct2\n+\tcmpl\t$FFI_TYPE_STRUCT, %eax\n+\tje\t.Lcls_retstruct\n+.Lcls_epilogue:\n+\tmovl\t%ebp, %esp\n+\tpopl\t%ebp\n+\tret\n+.Lcls_retint:\n+\tmovl\t(%ecx), %eax\n+\tjmp\t.Lcls_epilogue\n+.Lcls_retfloat:\n+\tflds\t(%ecx)\n+\tjmp\t.Lcls_epilogue\n+.Lcls_retdouble:\n+\tfldl\t(%ecx)\n+\tjmp\t.Lcls_epilogue\n+.Lcls_retldouble:\n+\tfldt\t(%ecx)\n+\tjmp\t.Lcls_epilogue\n+.Lcls_retllong:\n+\tmovl\t(%ecx), %eax\n+\tmovl\t4(%ecx), %edx\n+\tjmp\t.Lcls_epilogue\n+.Lcls_retstruct1:\n+\tmovsbl\t(%ecx), %eax\n+\tjmp\t.Lcls_epilogue\n+.Lcls_retstruct2:\n+\tmovswl\t(%ecx), %eax\n+\tjmp\t.Lcls_epilogue\n+.Lcls_retstruct:\n+\tlea -8(%ebp),%esp\n+\tmovl\t%ebp, %esp\n+\tpopl\t%ebp\n+\tret $4\n+.LFE2:\n+\n+#if !FFI_NO_RAW_API\n+\n+#define RAW_CLOSURE_CIF_OFFSET ((FFI_TRAMPOLINE_SIZE + 3) & ~3)\n+#define RAW_CLOSURE_FUN_OFFSET (RAW_CLOSURE_CIF_OFFSET + 4)\n+#define RAW_CLOSURE_USER_DATA_OFFSET (RAW_CLOSURE_FUN_OFFSET + 4)\n+#define CIF_FLAGS_OFFSET 20\n+\n+\t.align\t4\n+FFI_HIDDEN (ffi_closure_raw_SYSV)\n+.globl _ffi_closure_raw_SYSV\n+\n+_ffi_closure_raw_SYSV:\n+.LFB3:\n+\tpushl\t%ebp\n+.LCFI4:\n+\tmovl\t%esp, %ebp\n+.LCFI5:\n+\tpushl\t%esi\n+.LCFI6:\n+\tsubl\t$36, %esp\n+\tmovl\tRAW_CLOSURE_CIF_OFFSET(%eax), %esi\t /* closure->cif */\n+\tmovl\tRAW_CLOSURE_USER_DATA_OFFSET(%eax), %edx /* closure->user_data */\n+\tmovl\t%edx, 12(%esp)\t/* user_data */\n+\tleal\t8(%ebp), %edx\t/* __builtin_dwarf_cfa () */\n+\tmovl\t%edx, 8(%esp)\t/* raw_args */\n+\tleal\t-24(%ebp), %edx\n+\tmovl\t%edx, 4(%esp)\t/* &res */\n+\tmovl\t%esi, (%esp)\t/* cif */\n+\tcall\t*RAW_CLOSURE_FUN_OFFSET(%eax)\t\t /* closure->fun */\n+\tmovl\tCIF_FLAGS_OFFSET(%esi), %eax\t\t /* rtype */\n+\tcmpl\t$FFI_TYPE_INT, %eax\n+\tje\t.Lrcls_retint\n+\tcmpl\t$FFI_TYPE_FLOAT, %eax\n+\tje\t.Lrcls_retfloat\n+\tcmpl\t$FFI_TYPE_DOUBLE, %eax\n+\tje\t.Lrcls_retdouble\n+\tcmpl\t$FFI_TYPE_LONGDOUBLE, %eax\n+\tje\t.Lrcls_retldouble\n+\tcmpl\t$FFI_TYPE_SINT64, %eax\n+\tje\t.Lrcls_retllong\n+.Lrcls_epilogue:\n+\taddl\t$36, %esp\n+\tpopl\t%esi\n+\tpopl\t%ebp\n+\tret\n+.Lrcls_retint:\n+\tmovl\t-24(%ebp), %eax\n+\tjmp\t.Lrcls_epilogue\n+.Lrcls_retfloat:\n+\tflds\t-24(%ebp)\n+\tjmp\t.Lrcls_epilogue\n+.Lrcls_retdouble:\n+\tfldl\t-24(%ebp)\n+\tjmp\t.Lrcls_epilogue\n+.Lrcls_retldouble:\n+\tfldt\t-24(%ebp)\n+\tjmp\t.Lrcls_epilogue\n+.Lrcls_retllong:\n+\tmovl\t-24(%ebp), %eax\n+\tmovl\t-20(%ebp), %edx\n+\tjmp\t.Lrcls_epilogue\n+.LFE3:\n+#endif\n+\n+.section __IMPORT,__jump_table,symbol_stubs,self_modifying_code+pure_instructions,5\n+L_ffi_closure_SYSV_inner$stub:\n+\t.indirect_symbol _ffi_closure_SYSV_inner\n+\thlt ; hlt ; hlt ; hlt ; hlt\n+\n+\n+.section __TEXT,__eh_frame,coalesced,no_toc+strip_static_syms+live_support\n+EH_frame1:\n+\t.set\tL$set$0,LECIE1-LSCIE1\n+\t.long\tL$set$0\n+LSCIE1:\n+\t.long\t0x0\n+\t.byte\t0x1\n+\t.ascii \"zR\\0\"\n+\t.byte\t0x1\n+\t.byte\t0x7c\n+\t.byte\t0x8\n+\t.byte\t0x1\n+\t.byte\t0x10\n+\t.byte\t0xc\n+\t.byte\t0x5\n+\t.byte\t0x4\n+\t.byte\t0x88\n+\t.byte\t0x1\n+\t.align 2\n+LECIE1:\n+.globl _ffi_call_SYSV.eh\n+_ffi_call_SYSV.eh:\n+LSFDE1:\n+\t.set\tL$set$1,LEFDE1-LASFDE1\n+\t.long\tL$set$1\n+LASFDE1:\n+\t.long\tLASFDE1-EH_frame1\n+\t.long\t.LFB1-.\n+\t.set L$set$2,.LFE1-.LFB1\n+\t.long L$set$2\n+\t.byte\t0x0\n+\t.byte\t0x4\n+\t.set L$set$3,.LCFI0-.LFB1\n+\t.long L$set$3\n+\t.byte\t0xe\n+\t.byte\t0x8\n+\t.byte\t0x84\n+\t.byte\t0x2\n+\t.byte\t0x4\n+\t.set L$set$4,.LCFI1-.LCFI0\n+\t.long L$set$4\n+\t.byte\t0xd\n+\t.byte\t0x4\n+\t.align 2\n+LEFDE1:\n+.globl _ffi_closure_SYSV.eh\n+_ffi_closure_SYSV.eh:\n+LSFDE2:\n+\t.set\tL$set$5,LEFDE2-LASFDE2\n+\t.long\tL$set$5\n+LASFDE2:\n+\t.long\tLASFDE2-EH_frame1\n+\t.long\t.LFB2-.\n+\t.set L$set$6,.LFE2-.LFB2\n+\t.long L$set$6\n+\t.byte\t0x0\n+\t.byte\t0x4\n+\t.set L$set$7,.LCFI2-.LFB2\n+\t.long L$set$7\n+\t.byte\t0xe\n+\t.byte\t0x8\n+\t.byte\t0x84\n+\t.byte\t0x2\n+\t.byte\t0x4\n+\t.set L$set$8,.LCFI3-.LCFI2\n+\t.long L$set$8\n+\t.byte\t0xd\n+\t.byte\t0x4\n+\t.align 2\n+LEFDE2:\n+\n+#if !FFI_NO_RAW_API\n+\n+.globl _ffi_closure_raw_SYSV.eh\n+_ffi_closure_raw_SYSV.eh:\n+LSFDE3:\n+\t.set\tL$set$10,LEFDE3-LASFDE3\n+\t.long\tL$set$10\n+LASFDE3:\n+\t.long\tLASFDE3-EH_frame1\n+\t.long\t.LFB3-.\n+\t.set L$set$11,.LFE3-.LFB3\n+\t.long L$set$11\n+\t.byte\t0x0\n+\t.byte\t0x4\n+\t.set L$set$12,.LCFI4-.LFB3\n+\t.long L$set$12\n+\t.byte\t0xe\n+\t.byte\t0x8\n+\t.byte\t0x84\n+\t.byte\t0x2\n+\t.byte\t0x4\n+\t.set L$set$13,.LCFI5-.LCFI4\n+\t.long L$set$13\n+\t.byte\t0xd\n+\t.byte\t0x4\n+\t.byte\t0x4\n+\t.set L$set$14,.LCFI6-.LCFI5\n+\t.long L$set$14\n+\t.byte\t0x85\n+\t.byte\t0x3\n+\t.align 2\n+LEFDE3:\n+\n+#endif\n+\n+#endif /* ifndef __x86_64__ */"}, {"sha": "55921b6c06d83674ad4ee0a9ff67066b1242c460", "filename": "libffi/src/x86/ffi.c", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2Fsrc%2Fx86%2Fffi.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2Fsrc%2Fx86%2Fffi.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Fsrc%2Fx86%2Fffi.c?ref=a3bd50cc4b053aa1224977404494b856eb625154", "patch": "@@ -119,7 +119,7 @@ ffi_status ffi_prep_cif_machdep(ffi_cif *cif)\n   switch (cif->rtype->type)\n     {\n     case FFI_TYPE_VOID:\n-#ifndef X86_WIN32\n+#ifdef X86\n     case FFI_TYPE_STRUCT:\n #endif\n     case FFI_TYPE_SINT64:\n@@ -133,7 +133,7 @@ ffi_status ffi_prep_cif_machdep(ffi_cif *cif)\n       cif->flags = FFI_TYPE_SINT64;\n       break;\n \n-#ifdef X86_WIN32\n+#ifndef X86\n     case FFI_TYPE_STRUCT:\n       if (cif->rtype->size == 1)\n         {\n@@ -163,6 +163,10 @@ ffi_status ffi_prep_cif_machdep(ffi_cif *cif)\n       break;\n     }\n \n+#ifdef X86_DARWIN\n+  cif->bytes = (cif->bytes + 15) & ~0xF;\n+#endif\n+\n   return FFI_OK;\n }\n "}, {"sha": "e5a7e42b71d1e8c587ab2bbe4762c6584f483c02", "filename": "libffi/testsuite/Makefile.in", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2Ftestsuite%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3bd50cc4b053aa1224977404494b856eb625154/libffi%2Ftestsuite%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Ftestsuite%2FMakefile.in?ref=a3bd50cc4b053aa1224977404494b856eb625154", "patch": "@@ -90,6 +90,7 @@ F77 = @F77@\n FFLAGS = @FFLAGS@\n FRV_FALSE = @FRV_FALSE@\n FRV_TRUE = @FRV_TRUE@\n+GREP = @GREP@\n HAVE_LONG_DOUBLE = @HAVE_LONG_DOUBLE@\n IA64_FALSE = @IA64_FALSE@\n IA64_TRUE = @IA64_TRUE@\n@@ -158,16 +159,15 @@ TESTSUBDIR_TRUE = @TESTSUBDIR_TRUE@\n VERSION = @VERSION@\n X86_64_FALSE = @X86_64_FALSE@\n X86_64_TRUE = @X86_64_TRUE@\n+X86_DARWIN_FALSE = @X86_DARWIN_FALSE@\n+X86_DARWIN_TRUE = @X86_DARWIN_TRUE@\n X86_FALSE = @X86_FALSE@\n X86_TRUE = @X86_TRUE@\n X86_WIN32_FALSE = @X86_WIN32_FALSE@\n X86_WIN32_TRUE = @X86_WIN32_TRUE@\n-ac_ct_AR = @ac_ct_AR@\n ac_ct_CC = @ac_ct_CC@\n ac_ct_CXX = @ac_ct_CXX@\n ac_ct_F77 = @ac_ct_F77@\n-ac_ct_RANLIB = @ac_ct_RANLIB@\n-ac_ct_STRIP = @ac_ct_STRIP@\n am__fastdepCC_FALSE = @am__fastdepCC_FALSE@\n am__fastdepCC_TRUE = @am__fastdepCC_TRUE@\n am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@\n@@ -184,24 +184,31 @@ build_cpu = @build_cpu@\n build_os = @build_os@\n build_vendor = @build_vendor@\n datadir = @datadir@\n+datarootdir = @datarootdir@\n+docdir = @docdir@\n+dvidir = @dvidir@\n exec_prefix = @exec_prefix@\n host = @host@\n host_alias = @host_alias@\n host_cpu = @host_cpu@\n host_os = @host_os@\n host_vendor = @host_vendor@\n+htmldir = @htmldir@\n includedir = @includedir@\n infodir = @infodir@\n install_sh = @install_sh@\n libdir = @libdir@\n libexecdir = @libexecdir@\n+localedir = @localedir@\n localstatedir = @localstatedir@\n mandir = @mandir@\n mkdir_p = @mkdir_p@\n multi_basedir = @multi_basedir@\n oldincludedir = @oldincludedir@\n+pdfdir = @pdfdir@\n prefix = @prefix@\n program_transform_name = @program_transform_name@\n+psdir = @psdir@\n sbindir = @sbindir@\n sharedstatedir = @sharedstatedir@\n sysconfdir = @sysconfdir@"}]}