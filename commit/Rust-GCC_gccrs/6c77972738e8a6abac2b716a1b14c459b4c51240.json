{"sha": "6c77972738e8a6abac2b716a1b14c459b4c51240", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmM3Nzk3MjczOGU4YTZhYmFjMmI3MTZhMWIxNGM0NTliNGM1MTI0MA==", "commit": {"author": {"name": "Ilya Enkovich", "email": "ilya.enkovich@intel.com", "date": "2014-12-09T08:00:52Z"}, "committer": {"name": "Ilya Enkovich", "email": "ienkovich@gcc.gnu.org", "date": "2014-12-09T08:00:52Z"}, "message": "lto-partition.c (privatize_symbol_name): Correctly privatize instrumentation clones.\n\ngcc/\n\n\t* lto/lto-partition.c (privatize_symbol_name): Correctly\n\tprivatize instrumentation clones.\n\ngcc/testsuite/\n\n\t* gcc.dg/lto/lto.exp: Load mpx-dg.exp.\n\t* gcc.dg/lto/chkp-privatize_0.c: New.\n\t* gcc.dg/lto/chkp-privatize_1.c: New.\n\nFrom-SVN: r218508", "tree": {"sha": "aaafbd6893bb320d7e43d58e992f19015ce6cb24", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/aaafbd6893bb320d7e43d58e992f19015ce6cb24"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6c77972738e8a6abac2b716a1b14c459b4c51240", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6c77972738e8a6abac2b716a1b14c459b4c51240", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6c77972738e8a6abac2b716a1b14c459b4c51240", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6c77972738e8a6abac2b716a1b14c459b4c51240/comments", "author": {"login": "ienkovich", "id": 18308708, "node_id": "MDQ6VXNlcjE4MzA4NzA4", "avatar_url": "https://avatars.githubusercontent.com/u/18308708?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ienkovich", "html_url": "https://github.com/ienkovich", "followers_url": "https://api.github.com/users/ienkovich/followers", "following_url": "https://api.github.com/users/ienkovich/following{/other_user}", "gists_url": "https://api.github.com/users/ienkovich/gists{/gist_id}", "starred_url": "https://api.github.com/users/ienkovich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ienkovich/subscriptions", "organizations_url": "https://api.github.com/users/ienkovich/orgs", "repos_url": "https://api.github.com/users/ienkovich/repos", "events_url": "https://api.github.com/users/ienkovich/events{/privacy}", "received_events_url": "https://api.github.com/users/ienkovich/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6a73516d838ce30e52f576df0dee882e410038b3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6a73516d838ce30e52f576df0dee882e410038b3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6a73516d838ce30e52f576df0dee882e410038b3"}], "stats": {"total": 71, "additions": 61, "deletions": 10}, "files": [{"sha": "5ca94246784ac7455e37317ec60ee9432826da41", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c77972738e8a6abac2b716a1b14c459b4c51240/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c77972738e8a6abac2b716a1b14c459b4c51240/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6c77972738e8a6abac2b716a1b14c459b4c51240", "patch": "@@ -1,3 +1,8 @@\n+2014-12-09  Ilya Enkovich  <ilya.enkovich@intel.com>\n+\n+\t* lto/lto-partition.c (privatize_symbol_name): Correctly\n+\tprivatize instrumentation clones.\n+\n 2014-12-09  Ilya Enkovich  <ilya.enkovich@intel.com>\n \n \t* lto-cgraph.c (input_cgraph_1): Don't break existing"}, {"sha": "809a4937b663d205f05c8c31cb87c0ca8659028b", "filename": "gcc/lto/lto-partition.c", "status": "modified", "additions": 23, "deletions": 10, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c77972738e8a6abac2b716a1b14c459b4c51240/gcc%2Flto%2Flto-partition.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c77972738e8a6abac2b716a1b14c459b4c51240/gcc%2Flto%2Flto-partition.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto-partition.c?ref=6c77972738e8a6abac2b716a1b14c459b4c51240", "patch": "@@ -787,8 +787,16 @@ static bool\n privatize_symbol_name (symtab_node *node)\n {\n   tree decl = node->decl;\n-  const char *name = IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (decl));\n-  cgraph_node *cnode;\n+  cgraph_node *cnode = dyn_cast <cgraph_node *> (node);\n+  const char *name;\n+\n+  /* If we want to privatize instrumentation clone\n+     then we need to change original function name\n+     which is used via transparent alias chain.  */\n+  if (cnode && cnode->instrumentation_clone)\n+    decl = cnode->orig_decl;\n+\n+  name = IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (decl));\n \n   /* Our renaming machinery do not handle more than one change of assembler name.\n      We should not need more than one anyway.  */\n@@ -821,15 +829,20 @@ privatize_symbol_name (symtab_node *node)\n \t\t\t     (DECL_ASSEMBLER_NAME (decl)));\n   /* We could change name which is a target of transparent alias\n      chain of instrumented function name.  Fix alias chain if so  .*/\n-  if ((cnode = dyn_cast <cgraph_node *> (node))\n-      && !cnode->instrumentation_clone\n-      && cnode->instrumented_version\n-      && cnode->instrumented_version->orig_decl == decl)\n+  if (cnode)\n     {\n-      tree iname = DECL_ASSEMBLER_NAME (cnode->instrumented_version->decl);\n-\n-      gcc_assert (IDENTIFIER_TRANSPARENT_ALIAS (iname));\n-      TREE_CHAIN (iname) = DECL_ASSEMBLER_NAME (decl);\n+      tree iname = NULL_TREE;\n+      if (cnode->instrumentation_clone)\n+\tiname = DECL_ASSEMBLER_NAME (cnode->decl);\n+      else if (cnode->instrumented_version\n+\t       && cnode->instrumented_version->orig_decl == decl)\n+\tiname = DECL_ASSEMBLER_NAME (cnode->instrumented_version->decl);\n+\n+      if (iname)\n+\t{\n+\t  gcc_assert (IDENTIFIER_TRANSPARENT_ALIAS (iname));\n+\t  TREE_CHAIN (iname) = DECL_ASSEMBLER_NAME (decl);\n+\t}\n     }\n   if (symtab->dump_file)\n     fprintf (symtab->dump_file,"}, {"sha": "31f740dba876673eb00a3471c03294071188a890", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c77972738e8a6abac2b716a1b14c459b4c51240/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c77972738e8a6abac2b716a1b14c459b4c51240/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6c77972738e8a6abac2b716a1b14c459b4c51240", "patch": "@@ -1,3 +1,9 @@\n+2014-12-09  Ilya Enkovich  <ilya.enkovich@intel.com>\n+\n+\t* gcc.dg/lto/lto.exp: Load mpx-dg.exp.\n+\t* gcc.dg/lto/chkp-privatize_0.c: New.\n+\t* gcc.dg/lto/chkp-privatize_1.c: New.\n+\n 2014-12-09  Ilya Enkovich  <ilya.enkovich@intel.com>\n \n \tPR bootstrap/63995"}, {"sha": "4c899e864de33c85f394becb020c33906b19b1fe", "filename": "gcc/testsuite/gcc.dg/lto/chkp-privatize_0.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c77972738e8a6abac2b716a1b14c459b4c51240/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fchkp-privatize_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c77972738e8a6abac2b716a1b14c459b4c51240/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fchkp-privatize_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fchkp-privatize_0.c?ref=6c77972738e8a6abac2b716a1b14c459b4c51240", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-lto-do link } */\n+/* { dg-require-effective-target mpx { target { i?86-*-* x86_64-*-* } } } */\n+/* { dg-lto-options { { -fPIC -flto -flto-partition=max -fcheck-pointer-bounds -mmpx } } } */\n+\n+static int\n+__attribute__ ((noinline))\n+func1 (int i)\n+{\n+  return i + 2;\n+}\n+\n+extern int func2 (int i);\n+\n+int\n+main (int argc, char **argv)\n+{\n+  return func1 (argc) + func2 (argc) + 1;\n+}"}, {"sha": "db39e7fa9efae853d63578cab3ef9372bbbbe6d4", "filename": "gcc/testsuite/gcc.dg/lto/chkp-privatize_1.c", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c77972738e8a6abac2b716a1b14c459b4c51240/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fchkp-privatize_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c77972738e8a6abac2b716a1b14c459b4c51240/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fchkp-privatize_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fchkp-privatize_1.c?ref=6c77972738e8a6abac2b716a1b14c459b4c51240", "patch": "@@ -0,0 +1,8 @@\n+int func1 = 10;\n+\n+int\n+func2 (int i)\n+{\n+  func1++;\n+  return i + func1;\n+}"}, {"sha": "797c02f9e6c60c22f8d68e5974291dfff6d68678", "filename": "gcc/testsuite/gcc.dg/lto/lto.exp", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6c77972738e8a6abac2b716a1b14c459b4c51240/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Flto.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6c77972738e8a6abac2b716a1b14c459b4c51240/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Flto.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Flto.exp?ref=6c77972738e8a6abac2b716a1b14c459b4c51240", "patch": "@@ -30,6 +30,7 @@ if $tracelevel then {\n # Load procedures from common libraries. \n load_lib standard.exp\n load_lib gcc.exp\n+load_lib mpx-dg.exp\n \n # Load the language-independent compabibility support procedures.\n load_lib lto.exp"}]}