{"sha": "4f4da4e99bbb2464aa37b00ba12f734b7c86db06", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGY0ZGE0ZTk5YmJiMjQ2NGFhMzdiMDBiYTEyZjczNGI3Yzg2ZGIwNg==", "commit": {"author": {"name": "Benjamin Kosnik", "email": "bkoz@rhino.cygnus.com", "date": "1997-12-18T13:03:54Z"}, "committer": {"name": "Benjamin Kosnik", "email": "bkoz@gcc.gnu.org", "date": "1997-12-18T13:03:54Z"}, "message": "c++: Don't inject friends while processing templates\n\n\t\n* pt.c (instantiate_class_template): Don't do injection when\n \tprocessing_template_decl is true, as pollutes current_binding_level\n        for base classes.\nPR g++/13911/14438\n\nFrom-SVN: r17128", "tree": {"sha": "4e24dd44f3d33dc37995b897ef2695ed71eda672", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4e24dd44f3d33dc37995b897ef2695ed71eda672"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4f4da4e99bbb2464aa37b00ba12f734b7c86db06", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f4da4e99bbb2464aa37b00ba12f734b7c86db06", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f4da4e99bbb2464aa37b00ba12f734b7c86db06", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f4da4e99bbb2464aa37b00ba12f734b7c86db06/comments", "author": null, "committer": null, "parents": [{"sha": "80aab652d43c4bfd855ff6340c2058fabf5b0970", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/80aab652d43c4bfd855ff6340c2058fabf5b0970", "html_url": "https://github.com/Rust-GCC/gccrs/commit/80aab652d43c4bfd855ff6340c2058fabf5b0970"}], "stats": {"total": 28, "additions": 19, "deletions": 9}, "files": [{"sha": "c6bd7b6c1876325cc74189a6f78ae0b10b8d0ed8", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4da4e99bbb2464aa37b00ba12f734b7c86db06/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4da4e99bbb2464aa37b00ba12f734b7c86db06/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=4f4da4e99bbb2464aa37b00ba12f734b7c86db06", "patch": "@@ -1,3 +1,9 @@\n+Wed Dec 17 17:08:52 1997  Benjamin Kosnik  <bkoz@rhino.cygnus.com>\n+\n+\t* pt.c (instantiate_class_template): Don't do injection when\n+ \tprocessing_template_decl is true, as pollutes current_binding_level \n+        for base classes.\n+\n Wed Dec 17 21:17:39 1997  Peter Schmid <schmid@ltoi.iap.physik.tu-darmstadt.de>\n \n \t* pt.c (maybe_fold_nontype_arg): Add prototype."}, {"sha": "c1cfa9253f5ca22c092c8216f35c8e07b93b8d56", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 13, "deletions": 9, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f4da4e99bbb2464aa37b00ba12f734b7c86db06/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f4da4e99bbb2464aa37b00ba12f734b7c86db06/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=4f4da4e99bbb2464aa37b00ba12f734b7c86db06", "patch": "@@ -1956,18 +1956,22 @@ instantiate_class_template (type)\n     for (; d; d = TREE_CHAIN (d))\n       TREE_VALUE (d) = xref_tag_from_type (TREE_VALUE (d), NULL_TREE, 1);\n \n-    d = tsubst (DECL_TEMPLATE_INJECT (template), args,\n+    /* This does injection for friend functions. */\n+    if (!processing_template_decl)\n+      {\n+\td = tsubst (DECL_TEMPLATE_INJECT (template), args,\n \t\tTREE_VEC_LENGTH (args), NULL_TREE);\n \n-    for (; d; d = TREE_CHAIN (d))\n-      {\n-\ttree t = TREE_VALUE (d);\n+\tfor (; d; d = TREE_CHAIN (d))\n+\t  {\n+\t    tree t = TREE_VALUE (d);\n \n-\tif (TREE_CODE (t) == TYPE_DECL)\n-\t  /* Already injected.  */;\n-\telse\n-\t  pushdecl (t);\n-      }\n+\t    if (TREE_CODE (t) == TYPE_DECL)\n+\t      /* Already injected.  */;\n+\t    else\n+\t      pushdecl (t);\n+\t  }\n+      } \n   }\n \n   if (! uses_template_parms (type))"}]}