{"sha": "6447c55dea95705018ff2bb3de7a81c160a71d4e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjQ0N2M1NWRlYTk1NzA1MDE4ZmYyYmIzZGU3YTgxYzE2MGE3MWQ0ZQ==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2014-06-05T05:30:39Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2014-06-05T05:30:39Z"}, "message": "re PR c/48062 (`shadowed declaration is here' should be a note)\n\n\tPR c/48062\n\t* c-decl.c (warn_if_shadowing): Call inform instead of warning_at.\n\tPrint note only if the warning was printed.\n\n\t* gcc.dg/Wshadow-1.c: Use dg-message for \"shadowed declaration\".\n\t* gcc.dg/Wshadow-3.c: Likewise.\n\t* gcc.dg/pr48062.c: New test.\n\nFrom-SVN: r211254", "tree": {"sha": "c4f8e2e13a568c7cf9471b9cf3520957becc359c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c4f8e2e13a568c7cf9471b9cf3520957becc359c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6447c55dea95705018ff2bb3de7a81c160a71d4e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6447c55dea95705018ff2bb3de7a81c160a71d4e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6447c55dea95705018ff2bb3de7a81c160a71d4e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6447c55dea95705018ff2bb3de7a81c160a71d4e/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1f5dc1b6f06b4dde9538d81e341feae7d9c9c441", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f5dc1b6f06b4dde9538d81e341feae7d9c9c441", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1f5dc1b6f06b4dde9538d81e341feae7d9c9c441"}], "stats": {"total": 58, "additions": 44, "deletions": 14}, "files": [{"sha": "7bd3ce3689720c835484e400c9d3b7e79f8401f5", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6447c55dea95705018ff2bb3de7a81c160a71d4e/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6447c55dea95705018ff2bb3de7a81c160a71d4e/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=6447c55dea95705018ff2bb3de7a81c160a71d4e", "patch": "@@ -1,3 +1,9 @@\n+2014-06-05  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c/48062\n+\t* c-decl.c (warn_if_shadowing): Call inform instead of warning_at.\n+\tPrint note only if the warning was printed.\n+\n 2014-06-04  Igor Zamyatin  <igor.zamyatin@intel.com>\n \n \tPR c/58942"}, {"sha": "8fb329691ec96e933de85be24cb02211d570821c", "filename": "gcc/c/c-decl.c", "status": "modified", "additions": 13, "deletions": 9, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6447c55dea95705018ff2bb3de7a81c160a71d4e/gcc%2Fc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6447c55dea95705018ff2bb3de7a81c160a71d4e/gcc%2Fc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-decl.c?ref=6447c55dea95705018ff2bb3de7a81c160a71d4e", "patch": "@@ -2601,6 +2601,7 @@ warn_if_shadowing (tree new_decl)\n \t\t\t\t\t     DECL_SOURCE_LOCATION (b->decl))))\n       {\n \ttree old_decl = b->decl;\n+\tbool warned = false;\n \n \tif (old_decl == error_mark_node)\n \t  {\n@@ -2609,8 +2610,9 @@ warn_if_shadowing (tree new_decl)\n \t    break;\n \t  }\n \telse if (TREE_CODE (old_decl) == PARM_DECL)\n-\t  warning (OPT_Wshadow, \"declaration of %q+D shadows a parameter\",\n-\t\t   new_decl);\n+\t  warned = warning (OPT_Wshadow,\n+\t\t\t    \"declaration of %q+D shadows a parameter\",\n+\t\t\t    new_decl);\n \telse if (DECL_FILE_SCOPE_P (old_decl))\n \t  {\n \t    /* Do not warn if a variable shadows a function, unless\n@@ -2620,9 +2622,10 @@ warn_if_shadowing (tree new_decl)\n \t\t&& !FUNCTION_POINTER_TYPE_P (TREE_TYPE (new_decl)))\n \t\tcontinue;\n \n-\t    warning_at (DECL_SOURCE_LOCATION (new_decl), OPT_Wshadow, \n-\t\t\t\"declaration of %qD shadows a global declaration\",\n-\t\t\tnew_decl);\n+\t    warned = warning_at (DECL_SOURCE_LOCATION (new_decl), OPT_Wshadow,\n+\t\t\t\t \"declaration of %qD shadows a global \"\n+\t\t\t\t \"declaration\",\n+\t\t\t\t new_decl);\n \t  }\n \telse if (TREE_CODE (old_decl) == FUNCTION_DECL\n \t\t && DECL_BUILT_IN (old_decl))\n@@ -2632,11 +2635,12 @@ warn_if_shadowing (tree new_decl)\n \t    break;\n \t  }\n \telse\n-\t  warning (OPT_Wshadow, \"declaration of %q+D shadows a previous local\",\n-\t\t   new_decl);\n+\t  warned = warning (OPT_Wshadow, \"declaration of %q+D shadows a \"\n+\t\t\t    \"previous local\", new_decl);\n \n-\twarning_at (DECL_SOURCE_LOCATION (old_decl), OPT_Wshadow,\n-\t\t    \"shadowed declaration is here\");\n+\tif (warned)\n+\t  inform (DECL_SOURCE_LOCATION (old_decl),\n+\t\t  \"shadowed declaration is here\");\n \n \tbreak;\n       }"}, {"sha": "6c7943bda60fe370391cdc5326595f7e425876ed", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6447c55dea95705018ff2bb3de7a81c160a71d4e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6447c55dea95705018ff2bb3de7a81c160a71d4e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6447c55dea95705018ff2bb3de7a81c160a71d4e", "patch": "@@ -1,3 +1,10 @@\n+2014-06-05  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c/48062\n+\t* gcc.dg/Wshadow-1.c: Use dg-message for \"shadowed declaration\".\n+\t* gcc.dg/Wshadow-3.c: Likewise.\n+\t* gcc.dg/pr48062.c: New test.\n+\n 2014-06-04  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/43453"}, {"sha": "6075711f5da6762f4c0ba4be52d2be9ccf4ad3f2", "filename": "gcc/testsuite/gcc.dg/Wshadow-1.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6447c55dea95705018ff2bb3de7a81c160a71d4e/gcc%2Ftestsuite%2Fgcc.dg%2FWshadow-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6447c55dea95705018ff2bb3de7a81c160a71d4e/gcc%2Ftestsuite%2Fgcc.dg%2FWshadow-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWshadow-1.c?ref=6447c55dea95705018ff2bb3de7a81c160a71d4e", "patch": "@@ -5,7 +5,7 @@\n \n /* Source: Neil Booth, 5 Dec 2001.  */\n \n-int decl1;\t\t\t/* { dg-warning \"shadowed declaration\" } */\n+int decl1;\t\t\t/* { dg-message \"shadowed declaration\" } */\n void foo (double decl1)\t\t/* { dg-warning \"shadows a global decl\" } */\n {\t\t\t\t\n }\n@@ -16,7 +16,7 @@ void foo1 (int d)\t\t/* { dg-message \"note: previous definition\" } */\n   /* { dg-error \"redeclared as different\" \"\" { target *-*-* } 15 } */\n }\n \n-void foo2 (int d)\t\t/* { dg-warning \"shadowed declaration\" } */\n+void foo2 (int d)\t\t/* { dg-message \"shadowed declaration\" } */\n {\n   {\n     double d;\t\t\t/* { dg-warning \"shadows a parameter\" } */\n@@ -25,7 +25,7 @@ void foo2 (int d)\t\t/* { dg-warning \"shadowed declaration\" } */\n \n void foo3 ()\n {\n-  int local;\t\t\t/* { dg-warning \"shadowed declaration\" } */\n+  int local;\t\t\t/* { dg-message \"shadowed declaration\" } */\n   {\n     int local;\t\t\t/* { dg-warning \"shadows a previous local\" } */\n   }"}, {"sha": "ce2879c0fb8d77a03a3596e01e59068e8406b7b7", "filename": "gcc/testsuite/gcc.dg/Wshadow-3.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6447c55dea95705018ff2bb3de7a81c160a71d4e/gcc%2Ftestsuite%2Fgcc.dg%2FWshadow-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6447c55dea95705018ff2bb3de7a81c160a71d4e/gcc%2Ftestsuite%2Fgcc.dg%2FWshadow-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWshadow-3.c?ref=6447c55dea95705018ff2bb3de7a81c160a71d4e", "patch": "@@ -5,7 +5,7 @@\n /* { dg-do compile } */\n /* { dg-options \"-std=gnu89 -Wshadow\" } */\n \n-int v; /* { dg-warning \"shadowed declaration\" } */\n+int v; /* { dg-message \"shadowed declaration\" } */\n int f1(int v);\n int f2(int v, int x[v]); /* { dg-warning \"declaration of 'v' shadows a global declaration\" } */\n int f3(int v, int y[sizeof(v)]); /* { dg-warning \"declaration of 'v' shadows a global declaration\" } */\n@@ -18,4 +18,4 @@ int f9(x) int x; { return 0; }\n int f10(v) { return 0; } /* { dg-warning \"declaration of 'v' shadows a global declaration\" } */\n int f11(int a, int b(int a));\n int f12(int a, int b(int a, int x[a])); /* { dg-warning \"declaration of 'a' shadows a parameter\" } */\n-/* { dg-warning \"shadowed declaration\" \"outer parm\" { target *-*-* } 20 } */\n+/* { dg-message \"shadowed declaration\" \"outer parm\" { target *-*-* } 20 } */"}, {"sha": "0f4cdde2e16499e6bf78ff84720baca43817bc91", "filename": "gcc/testsuite/gcc.dg/pr48062.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6447c55dea95705018ff2bb3de7a81c160a71d4e/gcc%2Ftestsuite%2Fgcc.dg%2Fpr48062.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6447c55dea95705018ff2bb3de7a81c160a71d4e/gcc%2Ftestsuite%2Fgcc.dg%2Fpr48062.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr48062.c?ref=6447c55dea95705018ff2bb3de7a81c160a71d4e", "patch": "@@ -0,0 +1,13 @@\n+/* PR c/48062 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wshadow\" } */\n+\n+int\n+main (void)\n+{\n+  int i; /* { dg-bogus \"shadowed declaration\" } */\n+#pragma GCC diagnostic push\n+#pragma GCC diagnostic ignored \"-Wshadow\"\n+  { int i; }\n+#pragma GCC diagnostic pop\n+}"}]}