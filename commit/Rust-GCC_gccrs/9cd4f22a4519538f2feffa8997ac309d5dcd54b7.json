{"sha": "9cd4f22a4519538f2feffa8997ac309d5dcd54b7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWNkNGYyMmE0NTE5NTM4ZjJmZWZmYTg5OTdhYzMwOWQ1ZGNkNTRiNw==", "commit": {"author": {"name": "Peter Bergner", "email": "bergner@vnet.ibm.com", "date": "2011-02-02T20:08:06Z"}, "committer": {"name": "Peter Bergner", "email": "bergner@gcc.gnu.org", "date": "2011-02-02T20:08:06Z"}, "message": "re PR rtl-optimization/47525 (DCE fails to eliminate a dead call to a pure function when compiled with -maltivec)\n\n\tPR rtl-optimization/47525\n\t* df-scan.c: Update copyright years.\n\t(df_get_call_refs): Do not mark global registers as DF_REF_REG_USE\n\tand non-clobber DF_REF_REG_DEF for calls to const and pure functions.\n\nFrom-SVN: r169768", "tree": {"sha": "2a6c8c9833162d25bb4977072dccdd2ac9b0af48", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2a6c8c9833162d25bb4977072dccdd2ac9b0af48"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9cd4f22a4519538f2feffa8997ac309d5dcd54b7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9cd4f22a4519538f2feffa8997ac309d5dcd54b7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9cd4f22a4519538f2feffa8997ac309d5dcd54b7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9cd4f22a4519538f2feffa8997ac309d5dcd54b7/comments", "author": {"login": "peter-bergner", "id": 17504345, "node_id": "MDQ6VXNlcjE3NTA0MzQ1", "avatar_url": "https://avatars.githubusercontent.com/u/17504345?v=4", "gravatar_id": "", "url": "https://api.github.com/users/peter-bergner", "html_url": "https://github.com/peter-bergner", "followers_url": "https://api.github.com/users/peter-bergner/followers", "following_url": "https://api.github.com/users/peter-bergner/following{/other_user}", "gists_url": "https://api.github.com/users/peter-bergner/gists{/gist_id}", "starred_url": "https://api.github.com/users/peter-bergner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/peter-bergner/subscriptions", "organizations_url": "https://api.github.com/users/peter-bergner/orgs", "repos_url": "https://api.github.com/users/peter-bergner/repos", "events_url": "https://api.github.com/users/peter-bergner/events{/privacy}", "received_events_url": "https://api.github.com/users/peter-bergner/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8e2bc95be59aa82767921fe0b83e0da93caaa611", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8e2bc95be59aa82767921fe0b83e0da93caaa611", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8e2bc95be59aa82767921fe0b83e0da93caaa611"}], "stats": {"total": 32, "additions": 21, "deletions": 11}, "files": [{"sha": "d63c0dfa78f8f2d004cc8588daf52d2219edf51f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cd4f22a4519538f2feffa8997ac309d5dcd54b7/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cd4f22a4519538f2feffa8997ac309d5dcd54b7/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9cd4f22a4519538f2feffa8997ac309d5dcd54b7", "patch": "@@ -1,3 +1,10 @@\n+2011-02-02  Peter Bergner  <bergner@vnet.ibm.com>\n+\n+\tPR rtl-optimization/47525\n+\t* df-scan.c: Update copyright years.\n+\t(df_get_call_refs): Do not mark global registers as DF_REF_REG_USE\n+\tand non-clobber DF_REF_REG_DEF for calls to const and pure functions.\n+\n 2011-02-02  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \t* config/i386/sysv4.h (TARGET_VERSION): Remove."}, {"sha": "42b4b145c02d98459d67f8b21324cf8538f14643", "filename": "gcc/df-scan.c", "status": "modified", "additions": 14, "deletions": 11, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cd4f22a4519538f2feffa8997ac309d5dcd54b7/gcc%2Fdf-scan.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cd4f22a4519538f2feffa8997ac309d5dcd54b7/gcc%2Fdf-scan.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdf-scan.c?ref=9cd4f22a4519538f2feffa8997ac309d5dcd54b7", "patch": "@@ -1,6 +1,6 @@\n /* Scanning of rtl for dataflow analysis.\n    Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007,\n-   2008, 2009, 2010 Free Software Foundation, Inc.\n+   2008, 2009, 2010, 2011 Free Software Foundation, Inc.\n    Originally contributed by Michael P. Hayes\n              (m.hayes@elec.canterbury.ac.nz, mhayes@redhat.com)\n    Major rewrite contributed by Danny Berlin (dberlin@dberlin.org)\n@@ -3360,16 +3360,19 @@ df_get_call_refs (struct df_collection_rec * collection_rec,\n \t\t NULL, bb, insn_info, DF_REF_REG_USE,\n \t\t DF_REF_CALL_STACK_USAGE | flags);\n \n-  /* Calls may also reference any of the global registers,\n-     so they are recorded as used.  */\n-  for (i = 0; i < FIRST_PSEUDO_REGISTER; i++)\n-    if (global_regs[i])\n-      {\n-\tdf_ref_record (DF_REF_BASE, collection_rec, regno_reg_rtx[i],\n-\t\t       NULL, bb, insn_info, DF_REF_REG_USE, flags);\n-\tdf_ref_record (DF_REF_BASE, collection_rec, regno_reg_rtx[i],\n-\t\t       NULL, bb, insn_info, DF_REF_REG_DEF, flags);\n-      }\n+  /* Calls to const functions cannot access any global registers and calls to\n+     pure functions cannot set them.  All other calls may reference any of the\n+     global registers, so they are recorded as used.  */\n+  if (!RTL_CONST_CALL_P (insn_info->insn))\n+    for (i = 0; i < FIRST_PSEUDO_REGISTER; i++)\n+      if (global_regs[i])\n+\t{\n+\t  df_ref_record (DF_REF_BASE, collection_rec, regno_reg_rtx[i],\n+\t\t\t NULL, bb, insn_info, DF_REF_REG_USE, flags);\n+\t  if (!RTL_PURE_CALL_P (insn_info->insn))\n+\t    df_ref_record (DF_REF_BASE, collection_rec, regno_reg_rtx[i],\n+\t\t\t   NULL, bb, insn_info, DF_REF_REG_DEF, flags);\n+\t}\n \n   is_sibling_call = SIBLING_CALL_P (insn_info->insn);\n   EXECUTE_IF_SET_IN_BITMAP (regs_invalidated_by_call_regset, 0, ui, bi)"}]}