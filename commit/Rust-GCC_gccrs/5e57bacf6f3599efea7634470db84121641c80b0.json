{"sha": "5e57bacf6f3599efea7634470db84121641c80b0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWU1N2JhY2Y2ZjM1OTllZmVhNzYzNDQ3MGRiODQxMjE2NDFjODBiMA==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-08-31T07:13:20Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-08-31T09:38:01Z"}, "message": "middle-end/102129 - avoid TER of possibly trapping expressions\n\nThe following avoids applying TER to possibly trapping expressions,\npreventing a trapping FP multiplication to be moved across a call\nthat should not be executed.\n\n2021-08-31  Richard Biener  <rguenther@suse.de>\n\n\tPR middle-end/102129\n\t* tree-ssa-ter.c (find_replaceable_in_bb): Do not move\n\tpossibly trapping expressions across calls.", "tree": {"sha": "931b4ea75778eaf33ec6f52abea8483852e7676f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/931b4ea75778eaf33ec6f52abea8483852e7676f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5e57bacf6f3599efea7634470db84121641c80b0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e57bacf6f3599efea7634470db84121641c80b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5e57bacf6f3599efea7634470db84121641c80b0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e57bacf6f3599efea7634470db84121641c80b0/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dd779c509e56d9300ceb03e3b009d5e0411380b8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dd779c509e56d9300ceb03e3b009d5e0411380b8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dd779c509e56d9300ceb03e3b009d5e0411380b8"}], "stats": {"total": 10, "additions": 7, "deletions": 3}, "files": [{"sha": "3a057c2d25f0f485c37d0f5a4856835e10870347", "filename": "gcc/tree-ssa-ter.c", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e57bacf6f3599efea7634470db84121641c80b0/gcc%2Ftree-ssa-ter.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e57bacf6f3599efea7634470db84121641c80b0/gcc%2Ftree-ssa-ter.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-ter.c?ref=5e57bacf6f3599efea7634470db84121641c80b0", "patch": "@@ -658,11 +658,15 @@ find_replaceable_in_bb (temp_expr_table *tab, basic_block bb)\n \t\t substitution list, or the def and use span a call such that\n \t\t we'll expand lifetimes across a call.  We also don't want to\n \t\t replace across these expressions that may call libcalls that\n-\t\t clobber the register involved.  See PR 70184.  */\n+\t\t clobber the register involved.  See PR 70184.  Neither\n+\t\t do we want to move possibly trapping expressions across\n+\t\t a call.  See PRs 102129 and 33593.  */\n \t      if (gimple_has_volatile_ops (stmt) || same_root_var\n \t\t  || (tab->call_cnt[ver] != cur_call_cnt\n-\t\t      && SINGLE_SSA_USE_OPERAND (SSA_NAME_DEF_STMT (use), SSA_OP_USE)\n-\t\t\t == NULL_USE_OPERAND_P)\n+\t\t      && (SINGLE_SSA_USE_OPERAND (SSA_NAME_DEF_STMT (use),\n+\t\t\t\t\t\t  SSA_OP_USE)\n+\t\t\t    == NULL_USE_OPERAND_P\n+\t\t\t  || gimple_could_trap_p (SSA_NAME_DEF_STMT (use))))\n \t\t  || tab->reg_vars_cnt[ver] != cur_reg_vars_cnt)\n \t\tfinished_with_expr (tab, ver, true);\n \t      else"}]}