{"sha": "0652a1512130cfda8a7ffb192f47bf19c9be2525", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDY1MmExNTEyMTMwY2ZkYThhN2ZmYjE5MmY0N2JmMTljOWJlMjUyNQ==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-12-23T05:18:27Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-12-23T05:18:27Z"}, "message": "re PR fortran/88328 (ICE in resolve_tag_format, at fortran/io.c:1641)\n\n2018-12-22  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/88328\n\t* io.c (resolve_tag_format): Add error for zero-sized array.\n\t(gfc_resolve_dt): Manipulate gfc_current_locus to get sensible error\n\tmessage locus.\n\n2018-12-22  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/88328\n\t* gfortran.dg/pr88328.f90: New test.\n\nFrom-SVN: r267367", "tree": {"sha": "c8b9de71d19f18e386c81abe1751e200bfdcd8f9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c8b9de71d19f18e386c81abe1751e200bfdcd8f9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0652a1512130cfda8a7ffb192f47bf19c9be2525", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0652a1512130cfda8a7ffb192f47bf19c9be2525", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0652a1512130cfda8a7ffb192f47bf19c9be2525", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0652a1512130cfda8a7ffb192f47bf19c9be2525/comments", "author": null, "committer": null, "parents": [{"sha": "e2385f4e812bd9f0172e8c28c50c3a51a6fcbcb8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2385f4e812bd9f0172e8c28c50c3a51a6fcbcb8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e2385f4e812bd9f0172e8c28c50c3a51a6fcbcb8"}], "stats": {"total": 35, "additions": 34, "deletions": 1}, "files": [{"sha": "d351d50790c8e944352b33a25069a61f8502de11", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0652a1512130cfda8a7ffb192f47bf19c9be2525/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0652a1512130cfda8a7ffb192f47bf19c9be2525/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=0652a1512130cfda8a7ffb192f47bf19c9be2525", "patch": "@@ -1,3 +1,10 @@\n+2018-12-22  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/88328\n+\t* io.c (resolve_tag_format): Add error for zero-sized array.\n+\t(gfc_resolve_dt): Manipulate gfc_current_locus to get sensible error\n+\tmessage locus.\n+\n 2018-12-22  Steven G . Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/85798"}, {"sha": "541e6ef997e5cf6d87d3e7981a8c4ba210499e06", "filename": "gcc/fortran/io.c", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0652a1512130cfda8a7ffb192f47bf19c9be2525/gcc%2Ffortran%2Fio.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0652a1512130cfda8a7ffb192f47bf19c9be2525/gcc%2Ffortran%2Fio.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fio.c?ref=0652a1512130cfda8a7ffb192f47bf19c9be2525", "patch": "@@ -1636,6 +1636,12 @@ resolve_tag_format (gfc_expr *e)\n \t  gfc_expr *r;\n \t  gfc_char_t *dest, *src;\n \n+\t  if (e->value.constructor == NULL)\n+\t   {\n+\t     gfc_error (\"FORMAT tag at %C cannot be a zero-sized array\");\n+\t     return false;\n+\t   }\n+\n \t  n = 0;\n \t  c = gfc_constructor_first (e->value.constructor);\n \t  len = c->expr->value.character.length;\n@@ -3245,12 +3251,21 @@ gfc_resolve_dt (gfc_dt *dt, locus *loc)\n {\n   gfc_expr *e;\n   io_kind k;\n+  locus tmp;\n \n   /* This is set in any case.  */\n   gcc_assert (dt->dt_io_kind);\n   k = dt->dt_io_kind->value.iokind;\n \n-  RESOLVE_TAG (&tag_format, dt->format_expr);\n+  tmp = gfc_current_locus;\n+  gfc_current_locus = *loc;\n+  if (!resolve_tag (&tag_format, dt->format_expr))\n+    {\n+      gfc_current_locus = tmp;\n+      return false;\n+    }\n+  gfc_current_locus = tmp;\n+\n   RESOLVE_TAG (&tag_rec, dt->rec);\n   RESOLVE_TAG (&tag_spos, dt->pos);\n   RESOLVE_TAG (&tag_advance, dt->advance);"}, {"sha": "806b141de78d8036a1b28898f92cab219fad59e4", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0652a1512130cfda8a7ffb192f47bf19c9be2525/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0652a1512130cfda8a7ffb192f47bf19c9be2525/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0652a1512130cfda8a7ffb192f47bf19c9be2525", "patch": "@@ -1,3 +1,8 @@\n+2018-12-22  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/88328\n+\t* gfortran.dg/pr88328.f90: New test.\n+\n 2018-12-21  Jan Hubicka  <jh@suse.cz>\n \n \t* g++.dg/ipa/devirt-30.C: Add dg-do."}, {"sha": "cd1c6eb95fa6bb25ac4a606a404a38873e23329d", "filename": "gcc/testsuite/gfortran.dg/pr88328.f90", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0652a1512130cfda8a7ffb192f47bf19c9be2525/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr88328.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0652a1512130cfda8a7ffb192f47bf19c9be2525/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr88328.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr88328.f90?ref=0652a1512130cfda8a7ffb192f47bf19c9be2525", "patch": "@@ -0,0 +1,6 @@\n+! { dg-do compile }\n+! PR fortran/88328\n+program p\n+   character(3), parameter :: a(0) = [character(3)::]\n+   print a ! { dg-error \"zero-sized array\" }\n+end"}]}