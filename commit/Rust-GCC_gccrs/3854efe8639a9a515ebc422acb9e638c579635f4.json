{"sha": "3854efe8639a9a515ebc422acb9e638c579635f4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mzg1NGVmZTg2MzlhOWE1MTVlYmM0MjJhY2I5ZTYzOGM1Nzk2MzVmNA==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2014-10-26T10:41:06Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2014-10-26T10:41:06Z"}, "message": "mips.c (mips_rewrite_small_data_1): Take the context as a parameter instead of the containing MEM.\n\ngcc/\n\t* config/mips/mips.c (mips_rewrite_small_data_1): Take the context\n\tas a parameter instead of the containing MEM.  Iterate over all\n\tsubrtxes.  Don't return a value.\n\t(mips_rewrite_small_data): Update call accordingly.\n\nFrom-SVN: r216708", "tree": {"sha": "f66c239a9e40134bca571be34db862208aaf65ff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f66c239a9e40134bca571be34db862208aaf65ff"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3854efe8639a9a515ebc422acb9e638c579635f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3854efe8639a9a515ebc422acb9e638c579635f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3854efe8639a9a515ebc422acb9e638c579635f4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3854efe8639a9a515ebc422acb9e638c579635f4/comments", "author": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "187804d41fded84fdf8dc733e9cd746c20b8f569", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/187804d41fded84fdf8dc733e9cd746c20b8f569", "html_url": "https://github.com/Rust-GCC/gccrs/commit/187804d41fded84fdf8dc733e9cd746c20b8f569"}], "stats": {"total": 46, "additions": 27, "deletions": 19}, "files": [{"sha": "dae8c32d146b6e16651a67ee5f69492413e6041e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3854efe8639a9a515ebc422acb9e638c579635f4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3854efe8639a9a515ebc422acb9e638c579635f4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3854efe8639a9a515ebc422acb9e638c579635f4", "patch": "@@ -1,3 +1,10 @@\n+2014-10-26  Richard Sandiford  <richard.sandiford@arm.com>\n+\n+\t* config/mips/mips.c (mips_rewrite_small_data_1): Take the context\n+\tas a parameter instead of the containing MEM.  Iterate over all\n+\tsubrtxes.  Don't return a value.\n+\t(mips_rewrite_small_data): Update call accordingly.\n+\n 2014-10-26  Richard Sandiford  <richard.sandiford@arm.com>\n \n \t* config/mips/mips.c: Include rtl-iter.h."}, {"sha": "4d16d9b81fa8d13803af49521e8e685d8f7c2fb8", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 20, "deletions": 19, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3854efe8639a9a515ebc422acb9e638c579635f4/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3854efe8639a9a515ebc422acb9e638c579635f4/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=3854efe8639a9a515ebc422acb9e638c579635f4", "patch": "@@ -3487,28 +3487,29 @@ mips_small_data_pattern_p (rtx op)\n   return mips_small_data_pattern_1 (op, SYMBOL_CONTEXT_LEA);\n }\n \n-/* A for_each_rtx callback, used by mips_rewrite_small_data.\n-   DATA is the containing MEM, or null if none.  */\n+/* Rewrite *LOC so that it refers to small data using explicit\n+   relocations.  CONTEXT is the context in which *LOC appears.  */\n \n-static int\n-mips_rewrite_small_data_1 (rtx *loc, void *data)\n+static void\n+mips_rewrite_small_data_1 (rtx *loc, enum mips_symbol_context context)\n {\n-  enum mips_symbol_context context;\n-\n-  if (MEM_P (*loc))\n+  subrtx_ptr_iterator::array_type array;\n+  FOR_EACH_SUBRTX_PTR (iter, array, loc, ALL)\n     {\n-      for_each_rtx (&XEXP (*loc, 0), mips_rewrite_small_data_1, *loc);\n-      return -1;\n+      rtx *loc = *iter;\n+      if (MEM_P (*loc))\n+\t{\n+\t  mips_rewrite_small_data_1 (&XEXP (*loc, 0), SYMBOL_CONTEXT_MEM);\n+\t  iter.skip_subrtxes ();\n+\t}\n+      else if (mips_rewrite_small_data_p (*loc, context))\n+\t{\n+\t  *loc = gen_rtx_LO_SUM (Pmode, pic_offset_table_rtx, *loc);\n+\t  iter.skip_subrtxes ();\n+\t}\n+      else if (GET_CODE (*loc) == LO_SUM)\n+\titer.skip_subrtxes ();\n     }\n-\n-  context = data ? SYMBOL_CONTEXT_MEM : SYMBOL_CONTEXT_LEA;\n-  if (mips_rewrite_small_data_p (*loc, context))\n-    *loc = gen_rtx_LO_SUM (Pmode, pic_offset_table_rtx, *loc);\n-\n-  if (GET_CODE (*loc) == LO_SUM)\n-    return -1;\n-\n-  return 0;\n }\n \n /* Rewrite instruction pattern PATTERN so that it refers to small data\n@@ -3518,7 +3519,7 @@ rtx\n mips_rewrite_small_data (rtx pattern)\n {\n   pattern = copy_insn (pattern);\n-  for_each_rtx (&pattern, mips_rewrite_small_data_1, NULL);\n+  mips_rewrite_small_data_1 (&pattern, SYMBOL_CONTEXT_LEA);\n   return pattern;\n }\n \f"}]}