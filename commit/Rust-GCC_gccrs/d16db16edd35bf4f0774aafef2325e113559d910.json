{"sha": "d16db16edd35bf4f0774aafef2325e113559d910", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDE2ZGIxNmVkZDM1YmY0ZjA3NzRhYWZlZjIzMjVlMTEzNTU5ZDkxMA==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2019-11-19T19:11:21Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2020-01-23T13:48:05Z"}, "message": "analyzer: introduce analyzer-torture.exp\n\ngcc/testsuite/ChangeLog:\n\t* gcc.dg/analyzer/data-model-3.c: Remove hardcoded \"-O2\" and move\n\tto torture/conftest-1.c.\n\t* gcc.dg/analyzer/torture/analyzer-torture.exp: New.\n\t* gcc.dg/analyzer/torture/conftest-1.c: Move here from\n\tanalyzer/data-model-3.c.\n\t* gcc.dg/analyzer/torture/poc.c: New test.", "tree": {"sha": "656dfc7cff2f7108897962dd1809f5c911bf4a99", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/656dfc7cff2f7108897962dd1809f5c911bf4a99"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d16db16edd35bf4f0774aafef2325e113559d910", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d16db16edd35bf4f0774aafef2325e113559d910", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d16db16edd35bf4f0774aafef2325e113559d910", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d16db16edd35bf4f0774aafef2325e113559d910/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e9ee848dcdc644aa9cd57371fab0a70dba443424", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e9ee848dcdc644aa9cd57371fab0a70dba443424", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e9ee848dcdc644aa9cd57371fab0a70dba443424"}], "stats": {"total": 102, "additions": 87, "deletions": 15}, "files": [{"sha": "8ad220e6941d0010a941b86e45fc5949fb0d9a9b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d16db16edd35bf4f0774aafef2325e113559d910/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d16db16edd35bf4f0774aafef2325e113559d910/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d16db16edd35bf4f0774aafef2325e113559d910", "patch": "@@ -1,3 +1,12 @@\n+2020-01-23  David Malcolm  <dmalcolm@redhat.com>\n+\n+\t* gcc.dg/analyzer/data-model-3.c: Remove hardcoded \"-O2\" and move\n+\tto torture/conftest-1.c.\n+\t* gcc.dg/analyzer/torture/analyzer-torture.exp: New.\n+\t* gcc.dg/analyzer/torture/conftest-1.c: Move here from\n+\tanalyzer/data-model-3.c.\n+\t* gcc.dg/analyzer/torture/poc.c: New test.\n+\n 2020-01-23  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/93381"}, {"sha": "3d572eb8d73f0f0f542a49df1eff6a17de007b3e", "filename": "gcc/testsuite/gcc.dg/analyzer/data-model-3.c", "status": "removed", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9ee848dcdc644aa9cd57371fab0a70dba443424/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fdata-model-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9ee848dcdc644aa9cd57371fab0a70dba443424/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fdata-model-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fdata-model-3.c?ref=e9ee848dcdc644aa9cd57371fab0a70dba443424", "patch": "@@ -1,15 +0,0 @@\n-/* { dg-additional-options \"-O2\" } */\n-/* TODO:is there a way to automatically run the tests on various\n-   optimizations levels, and with/without debuginfo, rather than\n-   hardcoding options?  Adapt from torture .exp, presumably.  */\n-\n-#include <stdio.h>\n-int\n-main ()\n-{\n-  FILE *f = fopen (\"conftest.out\", \"w\");\n-  return ferror (f) || fclose (f) != 0;\n-\n-  ;\n-  return 0;\n-}"}, {"sha": "a4d98bb2297fc6e3d135bb53e361f27877b5ee03", "filename": "gcc/testsuite/gcc.dg/analyzer/torture/analyzer-torture.exp", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d16db16edd35bf4f0774aafef2325e113559d910/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ftorture%2Fanalyzer-torture.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d16db16edd35bf4f0774aafef2325e113559d910/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ftorture%2Fanalyzer-torture.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ftorture%2Fanalyzer-torture.exp?ref=d16db16edd35bf4f0774aafef2325e113559d910", "patch": "@@ -0,0 +1,44 @@\n+#   Copyright (C) 2020 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+# \n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+# \n+# You should have received a copy of the GNU General Public License\n+# along with GCC; see the file COPYING3.  If not see\n+# <http://www.gnu.org/licenses/>.\n+\n+# This harness is for tests that should be run at all optimisation levels.\n+\n+load_lib gcc-dg.exp\n+\n+# If the analyzer has not been enabled, bail.\n+if { ![check_effective_target_analyzer] } {\n+    return\n+}\n+\n+dg-init\n+\n+global DEFAULT_CFLAGS\n+if [info exists DEFAULT_CFLAGS] then {\n+  set save_default_cflags $DEFAULT_CFLAGS\n+}\n+\n+# If a testcase doesn't have special options, use these.\n+set DEFAULT_CFLAGS \"-fanalyzer -fdiagnostics-path-format=separate-events -Wanalyzer-too-complex -fanalyzer-call-summaries\"\n+\n+gcc-dg-runtest [lsort [glob $srcdir/$subdir/*.c]] \"\" $DEFAULT_CFLAGS\n+\n+dg-finish\n+\n+if [info exists save_default_cflags] {\n+  set DEFAULT_CFLAGS $save_default_cflags\n+} else {\n+  unset DEFAULT_CFLAGS\n+}"}, {"sha": "0cf85f0ebe190f4442271b8e3e329deb08c539a8", "filename": "gcc/testsuite/gcc.dg/analyzer/torture/conftest-1.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d16db16edd35bf4f0774aafef2325e113559d910/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ftorture%2Fconftest-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d16db16edd35bf4f0774aafef2325e113559d910/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ftorture%2Fconftest-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ftorture%2Fconftest-1.c?ref=d16db16edd35bf4f0774aafef2325e113559d910", "patch": "@@ -0,0 +1,10 @@\n+#include <stdio.h>\n+int\n+main ()\n+{\n+  FILE *f = fopen (\"conftest.out\", \"w\");\n+  return ferror (f) || fclose (f) != 0;\n+\n+  ;\n+  return 0;\n+}"}, {"sha": "1ad45b2f63ebf7e232c996ddc023676828fcbd11", "filename": "gcc/testsuite/gcc.dg/analyzer/torture/poc.c", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d16db16edd35bf4f0774aafef2325e113559d910/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ftorture%2Fpoc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d16db16edd35bf4f0774aafef2325e113559d910/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ftorture%2Fpoc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ftorture%2Fpoc.c?ref=d16db16edd35bf4f0774aafef2325e113559d910", "patch": "@@ -0,0 +1,24 @@\n+/* { dg-do link } */\n+\n+#include <stdlib.h>\n+\n+void test_1 (void *ptr)\n+{\n+  free (ptr);\n+  free (ptr); /* { dg-warning \"double-free\" } */\n+}\n+\n+struct s\n+{\n+  void *ptr;\n+};\n+\n+void test_2 (struct s *x)\n+{\n+  free (x->ptr);\n+  free (x->ptr); /* { dg-warning \"double-free\" } */\n+}\n+\n+/* TODO: be more precise about what is freed.  */\n+\n+int main () {}"}]}