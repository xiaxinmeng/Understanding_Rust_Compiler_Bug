{"sha": "a9b98c2c559e553035ca5115cd0cbb9f2c32dab0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTliOThjMmM1NTllNTUzMDM1Y2E1MTE1Y2QwY2JiOWYyYzMyZGFiMA==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2008-09-24T07:01:18Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2008-09-24T07:01:18Z"}, "message": "re PR fortran/37626 (ICE for automatic deallocation of character result variable)\n\n2008-09-24  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/37626\n        * trans-array.c (gfc_trans_deferred_array): Don't auto-deallocate\n        result variables.\n\n2008-09-24  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/37626\n        * gfortran.dg/allocatable_function_4.f90: New test.\n\nFrom-SVN: r140624", "tree": {"sha": "c0506931aec66b48c8d93f6b98854e14ef6028c2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c0506931aec66b48c8d93f6b98854e14ef6028c2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a9b98c2c559e553035ca5115cd0cbb9f2c32dab0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a9b98c2c559e553035ca5115cd0cbb9f2c32dab0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a9b98c2c559e553035ca5115cd0cbb9f2c32dab0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a9b98c2c559e553035ca5115cd0cbb9f2c32dab0/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "34971398456227555b7ca26065816d8316169ed7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/34971398456227555b7ca26065816d8316169ed7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/34971398456227555b7ca26065816d8316169ed7"}], "stats": {"total": 69, "additions": 68, "deletions": 1}, "files": [{"sha": "3d99ae35e70d6670830bfa794ce1ec6e5b07f152", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9b98c2c559e553035ca5115cd0cbb9f2c32dab0/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9b98c2c559e553035ca5115cd0cbb9f2c32dab0/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=a9b98c2c559e553035ca5115cd0cbb9f2c32dab0", "patch": "@@ -1,3 +1,9 @@\n+2008-09-24  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/37626\n+\t* trans-array.c (gfc_trans_deferred_array): Don't auto-deallocate\n+\tresult variables.\n+\n 2008-09-23  Daniel Kraft  <d@domob.eu>\n \n \tPR fortran/37588"}, {"sha": "c5aff65eeaa891b34699bafdc483dd59e27e1441", "filename": "gcc/fortran/trans-array.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9b98c2c559e553035ca5115cd0cbb9f2c32dab0/gcc%2Ffortran%2Ftrans-array.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9b98c2c559e553035ca5115cd0cbb9f2c32dab0/gcc%2Ffortran%2Ftrans-array.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.c?ref=a9b98c2c559e553035ca5115cd0cbb9f2c32dab0", "patch": "@@ -5754,7 +5754,7 @@ gfc_trans_deferred_array (gfc_symbol * sym, tree body)\n       gfc_add_expr_to_block (&fnblock, tmp);\n     }\n \n-  if (sym->attr.allocatable && !sym->attr.save)\n+  if (sym->attr.allocatable && !sym->attr.save && !sym->attr.result)\n     {\n       tmp = gfc_trans_dealloc_allocated (sym->backend_decl);\n       gfc_add_expr_to_block (&fnblock, tmp);"}, {"sha": "aa736dc4aaefb332ff8c5efa4b8a7258e1d3248c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9b98c2c559e553035ca5115cd0cbb9f2c32dab0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9b98c2c559e553035ca5115cd0cbb9f2c32dab0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a9b98c2c559e553035ca5115cd0cbb9f2c32dab0", "patch": "@@ -1,3 +1,8 @@\n+2008-09-24  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/37626\n+\t* gfortran.dg/allocatable_function_4.f90: New test.\n+\n 2008-09-23  Steve Ellcey  <sje@cup.hp.com>\n \n \t* lib/target-supports.exp (check_effective_target_pow10): New."}, {"sha": "9aff3a85a2d8498a70d479c7b1a4e8dcc162216d", "filename": "gcc/testsuite/gfortran.dg/allocatable_function_4.f90", "status": "added", "additions": 56, "deletions": 0, "changes": 56, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9b98c2c559e553035ca5115cd0cbb9f2c32dab0/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocatable_function_4.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9b98c2c559e553035ca5115cd0cbb9f2c32dab0/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocatable_function_4.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocatable_function_4.f90?ref=a9b98c2c559e553035ca5115cd0cbb9f2c32dab0", "patch": "@@ -0,0 +1,56 @@\n+! { dg-do compile }\n+! { dg-options \"-fdump-tree-original\" }\n+!\n+! PR fortran/37626\n+! Contributed by Rich Townsend\n+!\n+! The problem was an ICE when trying to deallocate the\n+! result variable \"x_unique\".\n+!\n+function unique_A (x, sorted) result (x_unique)\n+  implicit none\n+  character(*), dimension(:), intent(in)       :: x\n+  logical, intent(in), optional                :: sorted\n+  character(LEN(x)), dimension(:), allocatable :: x_unique\n+\n+  logical                                      :: sorted_\n+  character(LEN(x)), dimension(SIZE(x))        :: x_sorted\n+  integer                                      :: n_x\n+  logical, dimension(SIZE(x))                  :: mask\n+\n+  integer, external                            :: b3ss_index\n+\n+! Set up sorted_\n+\n+  if(PRESENT(sorted)) then\n+     sorted_ = sorted\n+  else\n+     sorted_ = .FALSE.\n+  endif\n+\n+! If necessary, sort x\n+\n+  if(sorted_) then\n+     x_sorted = x\n+  else\n+     x_sorted = x(b3ss_index(x))\n+  endif\n+\n+! Set up the unique array\n+\n+  n_x = SIZE(x)\n+\n+  mask = (/.TRUE.,x_sorted(2:n_x) /= x_sorted(1:n_x-1)/)\n+\n+  allocate(x_unique(COUNT(mask)))\n+\n+  x_unique = PACK(x_sorted, MASK=mask)\n+\n+! Finish\n+\n+  return\n+end function unique_A\n+\n+! { dg-final { scan-tree-dump-times \"__builtin_free\" 5 \"original\" } }\n+! { dg-final { cleanup-tree-dump \"original\" } }\n+"}]}