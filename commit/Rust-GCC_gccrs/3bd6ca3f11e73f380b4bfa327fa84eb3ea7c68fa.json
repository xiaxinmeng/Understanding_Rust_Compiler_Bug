{"sha": "3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2JkNmNhM2YxMWU3M2YzODBiNGJmYTMyN2ZhODRlYjNlYTdjNjhmYQ==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2010-10-25T17:44:05Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2010-10-25T17:44:05Z"}, "message": "utils.c (update_pointer_to): Clear TYPE_POINTER_TO and TYPE_REFERENCE_TO of the old type after redirecting...\n\n\t* gcc-interface/utils.c (update_pointer_to): Clear TYPE_POINTER_TO and\n\tTYPE_REFERENCE_TO of the old type after redirecting its pointer and\n\treference types.\n\nFrom-SVN: r165926", "tree": {"sha": "67216bfc58d92117407b469fde87c6996575c7b9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/67216bfc58d92117407b469fde87c6996575c7b9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa/comments", "author": null, "committer": null, "parents": [{"sha": "8c211c83bba629be6318b5b3fba7137cf633ef9a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c211c83bba629be6318b5b3fba7137cf633ef9a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8c211c83bba629be6318b5b3fba7137cf633ef9a"}], "stats": {"total": 56, "additions": 56, "deletions": 0}, "files": [{"sha": "b5162f79c8749028d41488a97eeda0529e0dad38", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa", "patch": "@@ -1,3 +1,9 @@\n+2010-10-25  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gcc-interface/utils.c (update_pointer_to): Clear TYPE_POINTER_TO and\n+\tTYPE_REFERENCE_TO of the old type after redirecting its pointer and\n+\treference types.\n+\n 2010-10-25  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc-interface/decl.c (gnat_to_gnu_entity) <E_Array_Type>: Do not set"}, {"sha": "1a5081d43e933a216a0f72682b84595a44db94e2", "filename": "gcc/ada/gcc-interface/utils.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa/gcc%2Fada%2Fgcc-interface%2Futils.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa/gcc%2Fada%2Fgcc-interface%2Futils.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Futils.c?ref=3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa", "patch": "@@ -3427,6 +3427,7 @@ update_pointer_to (tree old_type, tree new_type)\n       for (; ptr; ptr = TYPE_NEXT_PTR_TO (ptr))\n \tfor (t = TYPE_MAIN_VARIANT (ptr); t; t = TYPE_NEXT_VARIANT (t))\n \t  TREE_TYPE (t) = new_type;\n+      TYPE_POINTER_TO (old_type) = NULL_TREE;\n \n       /* Chain REF and its variants at the end.  */\n       new_ref = TYPE_REFERENCE_TO (new_type);\n@@ -3443,6 +3444,7 @@ update_pointer_to (tree old_type, tree new_type)\n       for (; ref; ref = TYPE_NEXT_REF_TO (ref))\n \tfor (t = TYPE_MAIN_VARIANT (ref); t; t = TYPE_NEXT_VARIANT (t))\n \t  TREE_TYPE (t) = new_type;\n+      TYPE_REFERENCE_TO (old_type) = NULL_TREE;\n     }\n \n   /* Now deal with the unconstrained array case.  In this case the pointer"}, {"sha": "da3c04677ae5231ace1e71d22d33b1008150fd80", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa", "patch": "@@ -1,3 +1,10 @@\n+2010-10-25  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/pointer_discr1.adb: New test.\n+\t* gnat.dg/pointer_discr1_pkg1.ads: New helper.\n+\t* gnat.dg/pointer_discr1_pkg2.ads: Likewise.\n+\t* gnat.dg/pointer_discr1_pkg3.ads: Likewise.\n+\n 2010-10-25  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/loop_optimization8.adb: New test."}, {"sha": "e3c171e16e8375b5a887dc695c4b720f241476fd", "filename": "gcc/testsuite/gnat.dg/pointer_discr1.adb", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa/gcc%2Ftestsuite%2Fgnat.dg%2Fpointer_discr1.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa/gcc%2Ftestsuite%2Fgnat.dg%2Fpointer_discr1.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fpointer_discr1.adb?ref=3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa", "patch": "@@ -0,0 +1,9 @@\n+-- { dg-do compile }\n+\n+with Pointer_Discr1_Pkg1;\n+with Pointer_Discr1_Pkg3;\n+\n+procedure Pointer_Discr1 is\n+begin\n+  Pointer_Discr1_Pkg3.Map(Pointer_Discr1_Pkg1.Window(1));\n+end;"}, {"sha": "a930af2fdd11b9d5d8f0ed6852ea955a3421d60a", "filename": "gcc/testsuite/gnat.dg/pointer_discr1_pkg1.ads", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa/gcc%2Ftestsuite%2Fgnat.dg%2Fpointer_discr1_pkg1.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa/gcc%2Ftestsuite%2Fgnat.dg%2Fpointer_discr1_pkg1.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fpointer_discr1_pkg1.ads?ref=3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa", "patch": "@@ -0,0 +1,9 @@\n+with Pointer_Discr1_Pkg2;\n+\n+package Pointer_Discr1_Pkg1 is\n+\n+  type Arr is array (1..4) of Pointer_Discr1_Pkg2.T_WINDOW;\n+\n+  Window : Arr;\n+\n+end Pointer_Discr1_Pkg1;"}, {"sha": "c5106907387d0eed6edd7b8a504a5b38d56f26e5", "filename": "gcc/testsuite/gnat.dg/pointer_discr1_pkg2.ads", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa/gcc%2Ftestsuite%2Fgnat.dg%2Fpointer_discr1_pkg2.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa/gcc%2Ftestsuite%2Fgnat.dg%2Fpointer_discr1_pkg2.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fpointer_discr1_pkg2.ads?ref=3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa", "patch": "@@ -0,0 +1,10 @@\n+with Unchecked_Conversion;\n+with Pointer_Discr1_Pkg3;\n+\n+package Pointer_Discr1_Pkg2 is\n+\n+  subtype T_WINDOW is Pointer_Discr1_Pkg3.T_WINDOW(Pointer_Discr1_Pkg3.One);\n+\n+  function TO_WINDOW is new Unchecked_Conversion(Integer, T_WINDOW);\n+\n+end Pointer_Discr1_Pkg2;"}, {"sha": "b27b5149ae96f1315aaa306fe285e08ed653ec36", "filename": "gcc/testsuite/gnat.dg/pointer_discr1_pkg3.ads", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa/gcc%2Ftestsuite%2Fgnat.dg%2Fpointer_discr1_pkg3.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa/gcc%2Ftestsuite%2Fgnat.dg%2Fpointer_discr1_pkg3.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fpointer_discr1_pkg3.ads?ref=3bd6ca3f11e73f380b4bfa327fa84eb3ea7c68fa", "patch": "@@ -0,0 +1,13 @@\n+package Pointer_Discr1_Pkg3 is\n+\n+  type T_TYPE is (One, Two, Three);\n+\n+  type T_DATA (D : T_TYPE);\n+\n+  type T_DATA (D : T_TYPE) is null record;\n+\n+  type T_WINDOW is access T_DATA;\n+\n+  procedure Map (Window : in T_WINDOW);\n+\n+end Pointer_Discr1_Pkg3;"}]}