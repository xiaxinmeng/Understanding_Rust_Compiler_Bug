{"sha": "52560c7b98c6fe25b891b558029b456437802125", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTI1NjBjN2I5OGM2ZmUyNWI4OTFiNTU4MDI5YjQ1NjQzNzgwMjEyNQ==", "commit": {"author": {"name": "Geoffrey Keating", "email": "geoffk@redhat.com", "date": "2001-11-04T07:37:48Z"}, "committer": {"name": "Geoffrey Keating", "email": "geoffk@gcc.gnu.org", "date": "2001-11-04T07:37:48Z"}, "message": "stormy16.h (ASM_OUTPUT_MI_THUNK): Call stormy16_asm_output_mi_thunk.\n\n\t* config/stormy16/stormy16.h (ASM_OUTPUT_MI_THUNK): Call\n\tstormy16_asm_output_mi_thunk.\n\t* config/stormy16/stormy16.c (stormy16_asm_output_mi_thunk): New\n\tfunction.\n\t* config/stormy16/stormy16-protos.h\n\t(stormy16_asm_output_mi_thunk): New prototype.\n\nFrom-SVN: r46762", "tree": {"sha": "9b125e0bc27128b153873d26aa12f7ce2e4367ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9b125e0bc27128b153873d26aa12f7ce2e4367ca"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/52560c7b98c6fe25b891b558029b456437802125", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52560c7b98c6fe25b891b558029b456437802125", "html_url": "https://github.com/Rust-GCC/gccrs/commit/52560c7b98c6fe25b891b558029b456437802125", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52560c7b98c6fe25b891b558029b456437802125/comments", "author": null, "committer": null, "parents": [{"sha": "cb3f834fb6ad5268fe9640218d7285da0394f857", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb3f834fb6ad5268fe9640218d7285da0394f857", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cb3f834fb6ad5268fe9640218d7285da0394f857"}], "stats": {"total": 62, "additions": 56, "deletions": 6}, "files": [{"sha": "d955a324bf650c92c0644c9466c48669abb09bda", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52560c7b98c6fe25b891b558029b456437802125/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52560c7b98c6fe25b891b558029b456437802125/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=52560c7b98c6fe25b891b558029b456437802125", "patch": "@@ -1,3 +1,12 @@\n+2001-11-03  Geoffrey Keating  <geoffk@redhat.com>\n+\n+\t* config/stormy16/stormy16.h (ASM_OUTPUT_MI_THUNK): Call\n+\tstormy16_asm_output_mi_thunk.\n+\t* config/stormy16/stormy16.c (stormy16_asm_output_mi_thunk): New\n+\tfunction.\n+\t* config/stormy16/stormy16-protos.h\n+\t(stormy16_asm_output_mi_thunk): New prototype.\n+\n 2001-11-04  Joseph S. Myers  <jsm28@cam.ac.uk>\n \n \t* ChangeLog.2, ChangeLog.4, ChangeLog.5, ChangeLog,"}, {"sha": "2e96055fa3c7a0f07544bdb2f03c51fa9e1f802a", "filename": "gcc/config/stormy16/stormy16-protos.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52560c7b98c6fe25b891b558029b456437802125/gcc%2Fconfig%2Fstormy16%2Fstormy16-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52560c7b98c6fe25b891b558029b456437802125/gcc%2Fconfig%2Fstormy16%2Fstormy16-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fstormy16%2Fstormy16-protos.h?ref=52560c7b98c6fe25b891b558029b456437802125", "patch": "@@ -46,6 +46,7 @@ extern void    stormy16_expand_builtin_va_start PARAMS ((int, tree, rtx));\n extern rtx     stormy16_expand_builtin_va_arg PARAMS ((tree, tree));\n extern void    stormy16_initialize_trampoline PARAMS ((rtx, rtx, rtx));\n extern rtx     stormy16_function_value PARAMS ((tree, tree));\n+extern void    stormy16_asm_output_mi_thunk PARAMS ((FILE *, tree, int, tree));\n #endif\n \n #ifdef RTX_CODE"}, {"sha": "ef4951d3262f584c64e4202540cc2e7d06513ebd", "filename": "gcc/config/stormy16/stormy16.c", "status": "modified", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52560c7b98c6fe25b891b558029b456437802125/gcc%2Fconfig%2Fstormy16%2Fstormy16.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52560c7b98c6fe25b891b558029b456437802125/gcc%2Fconfig%2Fstormy16%2Fstormy16.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fstormy16%2Fstormy16.c?ref=52560c7b98c6fe25b891b558029b456437802125", "patch": "@@ -1335,6 +1335,51 @@ stormy16_function_value (valtype, func)\n   return gen_rtx_REG (mode, RETURN_VALUE_REGNUM);\n }\n \n+/* A C compound statement that outputs the assembler code for a thunk function,\n+   used to implement C++ virtual function calls with multiple inheritance.  The\n+   thunk acts as a wrapper around a virtual function, adjusting the implicit\n+   object parameter before handing control off to the real function.\n+\n+   First, emit code to add the integer DELTA to the location that contains the\n+   incoming first argument.  Assume that this argument contains a pointer, and\n+   is the one used to pass the `this' pointer in C++.  This is the incoming\n+   argument *before* the function prologue, e.g. `%o0' on a sparc.  The\n+   addition must preserve the values of all other incoming arguments.\n+\n+   After the addition, emit code to jump to FUNCTION, which is a\n+   `FUNCTION_DECL'.  This is a direct pure jump, not a call, and does not touch\n+   the return address.  Hence returning from FUNCTION will return to whoever\n+   called the current `thunk'.\n+\n+   The effect must be as if @var{function} had been called directly\n+   with the adjusted first argument.  This macro is responsible for\n+   emitting all of the code for a thunk function;\n+   TARGET_ASM_FUNCTION_PROLOGUE and TARGET_ASM_FUNCTION_EPILOGUE are\n+   not invoked.\n+\n+   The THUNK_FNDECL is redundant.  (DELTA and FUNCTION have already been\n+   extracted from it.)  It might possibly be useful on some targets, but\n+   probably not.  */\n+\n+void\n+stormy16_asm_output_mi_thunk (file, thunk_fndecl, delta, function)\n+     FILE *file;\n+     tree thunk_fndecl ATTRIBUTE_UNUSED;\n+     int delta;\n+     tree function;\n+{\n+  int regnum = FIRST_ARGUMENT_REGISTER;\n+  \n+  /* There might be a hidden first argument for a returned structure.  */\n+  if (aggregate_value_p (TREE_TYPE (TREE_TYPE (function))))\n+    regnum += 1;\n+  \n+  fprintf (file, \"\\tadd %s,#0x%x\\n\", reg_names[regnum], (delta) & 0xFFFF);\n+  fputs (\"\\tjmpf \", file);\n+  assemble_name (file, XSTR (XEXP (DECL_RTL (function), 0), 0));\n+  putc ('\\n', file);\n+}\n+\n /* Mark functions with SYMBOL_REF_FLAG.  */\n \n void"}, {"sha": "e3bedf56ba6e973bc709e0602b4d6854df362f45", "filename": "gcc/config/stormy16/stormy16.h", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52560c7b98c6fe25b891b558029b456437802125/gcc%2Fconfig%2Fstormy16%2Fstormy16.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52560c7b98c6fe25b891b558029b456437802125/gcc%2Fconfig%2Fstormy16%2Fstormy16.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fstormy16%2Fstormy16.h?ref=52560c7b98c6fe25b891b558029b456437802125", "patch": "@@ -2435,12 +2435,7 @@ typedef int CUMULATIVE_ARGS;\n    FUNCTION instead of jumping to it.  The generic approach does not support\n    varargs.  */\n #define ASM_OUTPUT_MI_THUNK(FILE, THUNK_FNDECL, DELTA, FUNCTION)\t\\\n-{\t\t\t\t\t\t\t\t\t\\\n-  fprintf (FILE, \"\\tadd r2,#0x%x\\n\", (DELTA) & 0xFFFF);\t\t\t\\\n-  fputs (\"\\tjmpf \", FILE);\t\t\t\t\t\t\\\n-  assemble_name (FILE, XSTR (XEXP (DECL_RTL (function), 0), 0));\t\\\n-  putc ('\\n', FILE);\t\t\t\t\t\t\t\\\n-}  \n+  stormy16_asm_output_mi_thunk (FILE, THUNK_FNDECL, DELTA, FUNCTION)\n \n \f\n /* Generating Code for Profiling.  */"}]}