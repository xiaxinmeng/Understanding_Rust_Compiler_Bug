{"sha": "6f7c1f65027e3372ce540398e55781f84bf575d3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmY3YzFmNjUwMjdlMzM3MmNlNTQwMzk4ZTU1NzgxZjg0YmY1NzVkMw==", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2019-06-18T22:14:14Z"}, "committer": {"name": "Thomas Schwinge", "email": "tschwinge@gcc.gnu.org", "date": "2019-06-18T22:14:14Z"}, "message": "[PR90861] Document status quo for OpenACC 'declare' not cleaning up for VLAs\n\n\tgcc/testsuite/\n\tPR testsuite/90861\n\t* c-c++-common/goacc/declare-pr90861.c: New file.\n\tlibgomp/\n\tPR testsuite/90861\n\t* testsuite/libgomp.oacc-c-c++-common/declare-vla.c: Update.\n\nFrom-SVN: r272446", "tree": {"sha": "cf478264aa4ea8333ed6d6c9fc9b5fbeada78dc5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cf478264aa4ea8333ed6d6c9fc9b5fbeada78dc5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6f7c1f65027e3372ce540398e55781f84bf575d3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f7c1f65027e3372ce540398e55781f84bf575d3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6f7c1f65027e3372ce540398e55781f84bf575d3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f7c1f65027e3372ce540398e55781f84bf575d3/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5c9c7e19e63e0a6d9ed9e51601b4221f2fed5b13", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5c9c7e19e63e0a6d9ed9e51601b4221f2fed5b13", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5c9c7e19e63e0a6d9ed9e51601b4221f2fed5b13"}], "stats": {"total": 74, "additions": 71, "deletions": 3}, "files": [{"sha": "699a94b3ed40ff8a8239bcaca3fb6e809d628041", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6f7c1f65027e3372ce540398e55781f84bf575d3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6f7c1f65027e3372ce540398e55781f84bf575d3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6f7c1f65027e3372ce540398e55781f84bf575d3", "patch": "@@ -1,5 +1,8 @@\n 2019-06-18  Thomas Schwinge  <thomas@codesourcery.com>\n \n+\tPR testsuite/90861\n+\t* c-c++-common/goacc/declare-pr90861.c: New file.\n+\n \tPR testsuite/90868\n \t* c-c++-common/goacc/declare-1.c: Update.\n \t* c-c++-common/goacc/declare-2.c: Likewise."}, {"sha": "7c905624f7a1d7b2686424dacb46b9800e280dfa", "filename": "gcc/testsuite/c-c++-common/goacc/declare-pr90861.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6f7c1f65027e3372ce540398e55781f84bf575d3/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Fdeclare-pr90861.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6f7c1f65027e3372ce540398e55781f84bf575d3/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Fdeclare-pr90861.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Fdeclare-pr90861.c?ref=6f7c1f65027e3372ce540398e55781f84bf575d3", "patch": "@@ -0,0 +1,21 @@\n+/* Verify that OpenACC 'declare' cleans up for VLAs.  */\n+\n+/* { dg-additional-options \"-fdump-tree-gimple\" } */\n+\n+void f1 (void)\n+{\n+#define N_f1 1000\n+  int A_f1[N_f1];\n+#pragma acc declare copy(A_f1)\n+  /* { dg-final { scan-tree-dump-times {#pragma omp target oacc_declare map\\(to:A_f1} 1 gimple } }\n+     { dg-final { scan-tree-dump-times {#pragma omp target oacc_declare map\\(from:A_f1} 1 gimple } } */\n+}\n+\n+void f2 (void)\n+{\n+  int N_f2 = 1000;\n+  int A_f2[N_f2];\n+#pragma acc declare copy(A_f2)\n+  /* { dg-final { scan-tree-dump-times {#pragma omp target oacc_declare map\\(to:\\(\\*A_f2} 1 gimple } }\n+     { dg-final { scan-tree-dump-times {#pragma omp target oacc_declare map\\(from:\\(\\*A_f2} 1 gimple { xfail *-*-* } } } TODO PR90861 */\n+}"}, {"sha": "1a0d363e4ba24227b3916c5cf0aad46df5660db7", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6f7c1f65027e3372ce540398e55781f84bf575d3/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6f7c1f65027e3372ce540398e55781f84bf575d3/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=6f7c1f65027e3372ce540398e55781f84bf575d3", "patch": "@@ -1,5 +1,8 @@\n 2019-06-18  Thomas Schwinge  <thomas@codesourcery.com>\n \n+\tPR testsuite/90861\n+\t* testsuite/libgomp.oacc-c-c++-common/declare-vla.c: Update.\n+\n \tPR middle-end/90862\n \t* testsuite/libgomp.oacc-c-c++-common/declare-1.c: Update.\n "}, {"sha": "0f51badca42e5f7723f481c234905e4504257f2a", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/declare-vla.c", "status": "modified", "additions": 44, "deletions": 3, "changes": 47, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6f7c1f65027e3372ce540398e55781f84bf575d3/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fdeclare-vla.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6f7c1f65027e3372ce540398e55781f84bf575d3/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fdeclare-vla.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fdeclare-vla.c?ref=6f7c1f65027e3372ce540398e55781f84bf575d3", "patch": "@@ -1,9 +1,10 @@\n-/* Verify that acc declare accept VLA variables.  */\n+/* Verify OpenACC 'declare' with VLAs.  */\n \n #include <assert.h>\n \n-int\n-main ()\n+\n+void\n+f (void)\n {\n   int N = 1000;\n   int i, A[N];\n@@ -20,6 +21,46 @@ main ()\n \n   for (i = 0; i < N; i++)\n     assert (A[i] == i);\n+}\n+\n+\n+/* The same as 'f' but everything contained in an OpenACC 'data' construct.  */\n+\n+void\n+f_data (void)\n+{\n+#pragma acc data\n+  {\n+    int N = 1000;\n+    int i, A[N];\n+# pragma acc declare copy(A)\n+\n+    for (i = 0; i < N; i++)\n+      A[i] = -i;\n+\n+# pragma acc kernels\n+    for (i = 0; i < N; i++)\n+      A[i] = i;\n+\n+# pragma acc update host(A)\n+\n+    for (i = 0; i < N; i++)\n+      assert (A[i] == i);\n+  }\n+}\n+\n+\n+int\n+main ()\n+{\n+  f ();\n+\n+  f_data ();\n \n   return 0;\n }\n+\n+\n+/* { dg-xfail-run-if \"TODO PR90861\" { *-*-* } { \"-DACC_MEM_SHARED=0\" } }\n+   This might XPASS if the compiler happens to put the two 'A' VLAs at the same\n+   address.  */"}]}