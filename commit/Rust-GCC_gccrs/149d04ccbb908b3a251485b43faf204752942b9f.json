{"sha": "149d04ccbb908b3a251485b43faf204752942b9f", "node_id": "C_kwDOANBUbNoAKDE0OWQwNGNjYmI5MDhiM2EyNTE0ODViNDNmYWYyMDQ3NTI5NDJiOWY", "commit": {"author": {"name": "Kewen Lin", "email": "linkw@linux.ibm.com", "date": "2022-05-24T06:00:22Z"}, "committer": {"name": "Kewen Lin", "email": "linkw@linux.ibm.com", "date": "2022-05-24T06:00:22Z"}, "message": "rs6000: Skip debug insns for union [PR105627]\n\nAs PR105627 exposes, pass analyze_swaps should skip debug\ninsn when doing unionfind_union.  One debug insn can use\nseveral pseudos, if we take debug insn into account, we can\nunion those insns defining them and generate some unexpected\nunions.\n\nBased on the assumption that it's impossible to have one\npseudo which is defined by one debug insn but is used by one\nnondebug insn, we just asserts debug insn never shows up in\nfunction union_defs.\n\n\tPR target/105627\n\ngcc/ChangeLog:\n\n\t* config/rs6000/rs6000-p8swap.cc (union_defs): Assert def_insn can't\n\tbe a debug insn.\n\t(union_uses): Skip debug use_insn.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/powerpc/pr105627.c: New test.", "tree": {"sha": "d3ff209c92b6ce00e98a20cd108eb7f3a7008b31", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d3ff209c92b6ce00e98a20cd108eb7f3a7008b31"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/149d04ccbb908b3a251485b43faf204752942b9f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/149d04ccbb908b3a251485b43faf204752942b9f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/149d04ccbb908b3a251485b43faf204752942b9f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/149d04ccbb908b3a251485b43faf204752942b9f/comments", "author": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "168fc8bda14e2ec24c17d19630cec29fc646ed2f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/168fc8bda14e2ec24c17d19630cec29fc646ed2f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/168fc8bda14e2ec24c17d19630cec29fc646ed2f"}], "stats": {"total": 36, "additions": 32, "deletions": 4}, "files": [{"sha": "275702fee1bcb804daac3cff0fc5df826e37a98e", "filename": "gcc/config/rs6000/rs6000-p8swap.cc", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/149d04ccbb908b3a251485b43faf204752942b9f/gcc%2Fconfig%2Frs6000%2Frs6000-p8swap.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/149d04ccbb908b3a251485b43faf204752942b9f/gcc%2Fconfig%2Frs6000%2Frs6000-p8swap.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000-p8swap.cc?ref=149d04ccbb908b3a251485b43faf204752942b9f", "patch": "@@ -214,8 +214,9 @@ union_defs (swap_web_entry *insn_entry, rtx insn, df_ref use)\n       if (DF_REF_INSN_INFO (link->ref))\n \t{\n \t  rtx def_insn = DF_REF_INSN (link->ref);\n-\t  (void)unionfind_union (insn_entry + INSN_UID (insn),\n-\t\t\t\t insn_entry + INSN_UID (def_insn));\n+\t  gcc_assert (NONDEBUG_INSN_P (def_insn));\n+\t  unionfind_union (insn_entry + INSN_UID (insn),\n+\t\t\t   insn_entry + INSN_UID (def_insn));\n \t}\n \n       link = link->next;\n@@ -242,8 +243,9 @@ union_uses (swap_web_entry *insn_entry, rtx insn, df_ref def)\n       if (DF_REF_INSN_INFO (link->ref))\n \t{\n \t  rtx use_insn = DF_REF_INSN (link->ref);\n-\t  (void)unionfind_union (insn_entry + INSN_UID (insn),\n-\t\t\t\t insn_entry + INSN_UID (use_insn));\n+\t  if (NONDEBUG_INSN_P (use_insn))\n+\t    unionfind_union (insn_entry + INSN_UID (insn),\n+\t\t\t     insn_entry + INSN_UID (use_insn));\n \t}\n \n       link = link->next;"}, {"sha": "bafb31ff0619b308bd5507b9defe18be79ca1d25", "filename": "gcc/testsuite/gcc.target/powerpc/pr105627.c", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/149d04ccbb908b3a251485b43faf204752942b9f/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr105627.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/149d04ccbb908b3a251485b43faf204752942b9f/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr105627.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr105627.c?ref=149d04ccbb908b3a251485b43faf204752942b9f", "patch": "@@ -0,0 +1,26 @@\n+/* Specify -w to disable some warnings, such as: -Wpsabi.  */\n+/* { dg-options \"-Og -fcompare-debug -mdejagnu-cpu=power8 -w\" } */\n+\n+typedef unsigned char __attribute__ ((__vector_size__ (8))) U;\n+typedef unsigned char __attribute__ ((__vector_size__ (64))) V;\n+\n+U u;\n+char c;\n+V v;\n+\n+V\n+foo (void)\n+{\n+  V w = c\n+\t& __builtin_shufflevector (u, (V){0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n+\t\t\t\t\t  0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n+\t\t\t\t\t  0, 0, 0, 0, 0, 0, 0, 5},\n+\t\t\t\t   24, 24, 41, 45, 53, 60, 22, 35, 45, 12, 61,\n+\t\t\t\t   9, 52, 15, 44, 46, 5, 5, 1, 0, 4, 9, 0, 8, 5,\n+\t\t\t\t   7, 2, 5, 9, 2, 7, 7, 5, 6, 0, 2, 6, 1, 7, 7,\n+\t\t\t\t   0, 4, 0, 1, 7, 2, 5, 3, 2, 3, 5, 6, 6, 6, 0,\n+\t\t\t\t   6, 1, 9, 0, 5, 4, 3, 5, 4);\n+  w = w + v;\n+  return w;\n+}\n+"}]}