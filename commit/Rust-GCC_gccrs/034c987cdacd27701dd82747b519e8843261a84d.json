{"sha": "034c987cdacd27701dd82747b519e8843261a84d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDM0Yzk4N2NkYWNkMjc3MDFkZDgyNzQ3YjUxOWU4ODQzMjYxYTg0ZA==", "commit": {"author": {"name": "Chung-Lin Tang", "email": "cltang@codesourcery.com", "date": "2010-10-15T07:07:26Z"}, "committer": {"name": "Chung-Lin Tang", "email": "cltang@gcc.gnu.org", "date": "2010-10-15T07:07:26Z"}, "message": "ifcvt.c (find_active_insn_before): New function.\n\n2010-10-15  Chung-Lin Tang  <cltang@codesourcery.com>\n\n\t* ifcvt.c (find_active_insn_before): New function.\n\t(find_active_insn_after): New function.\n\t(cond_exec_process_if_block): Use new functions to replace\n\tprev_active_insn() and next_active_insn().\n\n\ttestsuite/\n\t* gcc.dg/20101010-1.c: New testcase.\n\nFrom-SVN: r165495", "tree": {"sha": "45497f46c16643e152b5e896913581b294552190", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/45497f46c16643e152b5e896913581b294552190"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/034c987cdacd27701dd82747b519e8843261a84d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/034c987cdacd27701dd82747b519e8843261a84d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/034c987cdacd27701dd82747b519e8843261a84d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/034c987cdacd27701dd82747b519e8843261a84d/comments", "author": {"login": "cltang", "id": 4055966, "node_id": "MDQ6VXNlcjQwNTU5NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/4055966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cltang", "html_url": "https://github.com/cltang", "followers_url": "https://api.github.com/users/cltang/followers", "following_url": "https://api.github.com/users/cltang/following{/other_user}", "gists_url": "https://api.github.com/users/cltang/gists{/gist_id}", "starred_url": "https://api.github.com/users/cltang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cltang/subscriptions", "organizations_url": "https://api.github.com/users/cltang/orgs", "repos_url": "https://api.github.com/users/cltang/repos", "events_url": "https://api.github.com/users/cltang/events{/privacy}", "received_events_url": "https://api.github.com/users/cltang/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "af41386e7c41d4c76b75ea87acd4b3c0479143fe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af41386e7c41d4c76b75ea87acd4b3c0479143fe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/af41386e7c41d4c76b75ea87acd4b3c0479143fe"}], "stats": {"total": 79, "additions": 74, "deletions": 5}, "files": [{"sha": "534386cd998642de64506fc4edd2e3c4ef196612", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/034c987cdacd27701dd82747b519e8843261a84d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/034c987cdacd27701dd82747b519e8843261a84d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=034c987cdacd27701dd82747b519e8843261a84d", "patch": "@@ -1,3 +1,10 @@\n+2010-10-15  Chung-Lin Tang  <cltang@codesourcery.com>\n+\n+\t* ifcvt.c (find_active_insn_before): New function.\n+\t(find_active_insn_after): New function.\n+\t(cond_exec_process_if_block): Use new functions to replace\n+\tprev_active_insn() and next_active_insn().\n+\n 2010-10-14  Yao Qi  <yao@codesourcery.com>\n \n \tPR target/45447"}, {"sha": "eb9618291f1701b445e78b6877c1b98a725d5a3c", "filename": "gcc/ifcvt.c", "status": "modified", "additions": 49, "deletions": 5, "changes": 54, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/034c987cdacd27701dd82747b519e8843261a84d/gcc%2Fifcvt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/034c987cdacd27701dd82747b519e8843261a84d/gcc%2Fifcvt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fifcvt.c?ref=034c987cdacd27701dd82747b519e8843261a84d", "patch": "@@ -88,6 +88,8 @@ static int count_bb_insns (const_basic_block);\n static bool cheap_bb_rtx_cost_p (const_basic_block, int);\n static rtx first_active_insn (basic_block);\n static rtx last_active_insn (basic_block, int);\n+static rtx find_active_insn_before (basic_block, rtx);\n+static rtx find_active_insn_after (basic_block, rtx);\n static basic_block block_fallthru (basic_block);\n static int cond_exec_process_insns (ce_if_block_t *, rtx, rtx, rtx, rtx, int);\n static rtx cond_exec_get_condition (rtx);\n@@ -229,6 +231,48 @@ last_active_insn (basic_block bb, int skip_use_p)\n   return insn;\n }\n \n+/* Return the active insn before INSN inside basic block CURR_BB. */\n+\n+static rtx\n+find_active_insn_before (basic_block curr_bb, rtx insn)\n+{\n+  if (!insn || insn == BB_HEAD (curr_bb))\n+    return NULL_RTX;\n+\n+  while ((insn = PREV_INSN (insn)) != NULL_RTX)\n+    {\n+      if (NONJUMP_INSN_P (insn) || JUMP_P (insn) || CALL_P (insn))\n+        break;\n+\n+      /* No other active insn all the way to the start of the basic block. */\n+      if (insn == BB_HEAD (curr_bb))\n+        return NULL_RTX;\n+    }\n+\n+  return insn;\n+}\n+\n+/* Return the active insn after INSN inside basic block CURR_BB. */\n+\n+static rtx\n+find_active_insn_after (basic_block curr_bb, rtx insn)\n+{\n+  if (!insn || insn == BB_END (curr_bb))\n+    return NULL_RTX;\n+\n+  while ((insn = NEXT_INSN (insn)) != NULL_RTX)\n+    {\n+      if (NONJUMP_INSN_P (insn) || JUMP_P (insn) || CALL_P (insn))\n+        break;\n+\n+      /* No other active insn all the way to the end of the basic block. */\n+      if (insn == BB_END (curr_bb))\n+        return NULL_RTX;\n+    }\n+\n+  return insn;\n+}\n+\n /* Return the basic block reached by falling though the basic block BB.  */\n \n static basic_block\n@@ -447,9 +491,9 @@ cond_exec_process_if_block (ce_if_block_t * ce_info,\n       if (n_matching > 0)\n \t{\n \t  if (then_end)\n-\t    then_end = prev_active_insn (then_first_tail);\n+\t    then_end = find_active_insn_before (then_bb, then_first_tail);\n \t  if (else_end)\n-\t    else_end = prev_active_insn (else_first_tail);\n+\t    else_end = find_active_insn_before (else_bb, else_first_tail);\n \t  n_insns -= 2 * n_matching;\n \t}\n \n@@ -487,9 +531,9 @@ cond_exec_process_if_block (ce_if_block_t * ce_info,\n \t  if (n_matching > 0)\n \t    {\n \t      if (then_start)\n-\t\tthen_start = next_active_insn (then_last_head);\n+\t\tthen_start = find_active_insn_after (then_bb, then_last_head);\n \t      if (else_start)\n-\t\telse_start = next_active_insn (else_last_head);\n+\t\telse_start = find_active_insn_after (else_bb, else_last_head);\n \t      n_insns -= 2 * n_matching;\n \t    }\n \t}\n@@ -645,7 +689,7 @@ cond_exec_process_if_block (ce_if_block_t * ce_info,\n     {\n       rtx from = then_first_tail;\n       if (!INSN_P (from))\n-\tfrom = next_active_insn (from);\n+\tfrom = find_active_insn_after (then_bb, from);\n       delete_insn_chain (from, BB_END (then_bb), false);\n     }\n   if (else_last_head)"}, {"sha": "e27d0d139dcd0b25c58339331fb89bad52eaa1cb", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/034c987cdacd27701dd82747b519e8843261a84d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/034c987cdacd27701dd82747b519e8843261a84d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=034c987cdacd27701dd82747b519e8843261a84d", "patch": "@@ -1,3 +1,7 @@\n+2010-10-15  Chung-Lin Tang  <cltang@codesourcery.com>\n+\n+\t* gcc.dg/20101010-1.c: New testcase.\n+\n 2010-10-15  Jie Zhang  <jie@codesourcery.com>\n \n \t* lib/lto.exp (lto-link-and-maybe-run): Use the default linker"}, {"sha": "8d74bbf5a1d987676b5509434f2b7e3244f127a6", "filename": "gcc/testsuite/gcc.dg/20101010-1.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/034c987cdacd27701dd82747b519e8843261a84d/gcc%2Ftestsuite%2Fgcc.dg%2F20101010-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/034c987cdacd27701dd82747b519e8843261a84d/gcc%2Ftestsuite%2Fgcc.dg%2F20101010-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2F20101010-1.c?ref=034c987cdacd27701dd82747b519e8843261a84d", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fno-crossjumping\" } */\n+\n+int foo (void)\n+{\n+  int len;\n+  if (bar1 (&len))\n+    {\n+      char devpath [len];\n+      if (bar2 (devpath) == len)\n+        return len;\n+    }\n+  return -1;\n+}"}]}