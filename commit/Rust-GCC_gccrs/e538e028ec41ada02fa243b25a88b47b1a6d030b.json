{"sha": "e538e028ec41ada02fa243b25a88b47b1a6d030b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTUzOGUwMjhlYzQxYWRhMDJmYTI0M2IyNWE4OGI0N2IxYTZkMDMwYg==", "commit": {"author": {"name": "Richard Sandiford", "email": "rdsandiford@googlemail.com", "date": "2008-08-09T18:11:19Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2008-08-09T18:11:19Z"}, "message": "mips.h (STATIC_CHAIN_REGNUM): Remap to $15.\n\ngcc/\n\t* config/mips/mips.h (STATIC_CHAIN_REGNUM): Remap to $15.\n\t(FUNCTION_PROFILER): Save the static chain pointer into $2\n\tbeforehand and restore it aftewards.\n\t(TRAMPOLINE_TEMPLATE): Adjust accordingly.  Load the target\n\taddress directly into $25 and call the function through $25;\n\tdo not clobber $3.  Pad the DImode version to cover the space\n\tleft by the deleted $25 <- $3 move.\n\t(TRAMPOLINE_SIZE): Adjust the size of the SImode version after\n\tthe removal of the $25 <- $3 move.\n\t(INITIALIZE_TRAMPOLINE): Update offsets accordingly.\n\t* config/mips/sdemtk.h (FUNCTION_PROFILER): As for mips.h.\n\nFrom-SVN: r138909", "tree": {"sha": "38db689918460ec7f1bb4f5cf2cee25d2b6952b4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/38db689918460ec7f1bb4f5cf2cee25d2b6952b4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e538e028ec41ada02fa243b25a88b47b1a6d030b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e538e028ec41ada02fa243b25a88b47b1a6d030b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e538e028ec41ada02fa243b25a88b47b1a6d030b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e538e028ec41ada02fa243b25a88b47b1a6d030b/comments", "author": {"login": "rsandifo", "id": 4235983, "node_id": "MDQ6VXNlcjQyMzU5ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/4235983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo", "html_url": "https://github.com/rsandifo", "followers_url": "https://api.github.com/users/rsandifo/followers", "following_url": "https://api.github.com/users/rsandifo/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo/orgs", "repos_url": "https://api.github.com/users/rsandifo/repos", "events_url": "https://api.github.com/users/rsandifo/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b2b6160771d3f0fb783b7f18a3a015126e55ead3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b2b6160771d3f0fb783b7f18a3a015126e55ead3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b2b6160771d3f0fb783b7f18a3a015126e55ead3"}], "stats": {"total": 49, "additions": 39, "deletions": 10}, "files": [{"sha": "608a3f7f00e6a35e48471ed61be0a539e85fc0f8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e538e028ec41ada02fa243b25a88b47b1a6d030b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e538e028ec41ada02fa243b25a88b47b1a6d030b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e538e028ec41ada02fa243b25a88b47b1a6d030b", "patch": "@@ -1,3 +1,17 @@\n+2008-08-09  Richard Sandiford  <rdsandiford@googlemail.com>\n+\n+\t* config/mips/mips.h (STATIC_CHAIN_REGNUM): Remap to $15.\n+\t(FUNCTION_PROFILER): Save the static chain pointer into $2\n+\tbeforehand and restore it aftewards.\n+\t(TRAMPOLINE_TEMPLATE): Adjust accordingly.  Load the target\n+\taddress directly into $25 and call the function through $25;\n+\tdo not clobber $3.  Pad the DImode version to cover the space\n+\tleft by the deleted $25 <- $3 move.\n+\t(TRAMPOLINE_SIZE): Adjust the size of the SImode version after\n+\tthe removal of the $25 <- $3 move.\n+\t(INITIALIZE_TRAMPOLINE): Update offsets accordingly.\n+\t* config/mips/sdemtk.h (FUNCTION_PROFILER): As for mips.h.\n+\n 2008-08-09  Richard Sandiford  <rdsandiford@googlemail.com>\n \t    Daniel Jacobowitz  <dan@codesourcery.com>\n "}, {"sha": "2d55104ae27029bb6a2a3ef8da5ee26ccdc0ea81", "filename": "gcc/config/mips/mips.h", "status": "modified", "additions": 17, "deletions": 10, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e538e028ec41ada02fa243b25a88b47b1a6d030b/gcc%2Fconfig%2Fmips%2Fmips.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e538e028ec41ada02fa243b25a88b47b1a6d030b/gcc%2Fconfig%2Fmips%2Fmips.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.h?ref=e538e028ec41ada02fa243b25a88b47b1a6d030b", "patch": "@@ -1657,7 +1657,7 @@ enum mips_code_readable_setting {\n #define FRAME_POINTER_REQUIRED (mips_frame_pointer_required ())\n \n /* Register in which static-chain is passed to a function.  */\n-#define STATIC_CHAIN_REGNUM (GP_REG_FIRST + 2)\n+#define STATIC_CHAIN_REGNUM (GP_REG_FIRST + 15)\n \n /* Registers used as temporaries in prologue/epilogue code.  If we're\n    generating mips16 code, these registers must come from the core set\n@@ -2181,6 +2181,10 @@ typedef struct mips_args {\n   fprintf (FILE, \"\\t.set\\tnoat\\n\");\t\t\t\t\t\\\n   fprintf (FILE, \"\\tmove\\t%s,%s\\t\\t# save current return address\\n\",\t\\\n \t   reg_names[GP_REG_FIRST + 1], reg_names[GP_REG_FIRST + 31]);\t\\\n+  /* _mcount treats $2 as the static chain register.  */\t\t\\\n+  if (cfun->static_chain_decl != NULL)\t\t\t\t\t\\\n+    fprintf (FILE, \"\\tmove\\t%s,%s\\n\", reg_names[2],\t\t\t\\\n+\t     reg_names[STATIC_CHAIN_REGNUM]);\t\t\t\t\\\n   if (!TARGET_NEWABI)\t\t\t\t\t\t\t\\\n     {\t\t\t\t\t\t\t\t\t\\\n       fprintf (FILE,\t\t\t\t\t\t\t\\\n@@ -2192,6 +2196,10 @@ typedef struct mips_args {\n     }\t\t\t\t\t\t\t\t\t\\\n   fprintf (FILE, \"\\tjal\\t_mcount\\n\");                                   \\\n   fprintf (FILE, \"\\t.set\\tat\\n\");\t\t\t\t\t\\\n+  /* _mcount treats $2 as the static chain register.  */\t\t\\\n+  if (cfun->static_chain_decl != NULL)\t\t\t\t\t\\\n+    fprintf (FILE, \"\\tmove\\t%s,%s\\n\", reg_names[STATIC_CHAIN_REGNUM],\t\\\n+\t     reg_names[2]);\t\t\t\t\t\t\\\n }\n \n /* The profiler preserves all interesting registers, including $31.  */\n@@ -2231,20 +2239,19 @@ typedef struct mips_args {\n   fprintf (STREAM, \"\\t.word\\t0x00000000\\t\\t# nop\\n\");\t\t\t\\\n   if (ptr_mode == DImode)\t\t\t\t\t\t\\\n     {\t\t\t\t\t\t\t\t\t\\\n-      fprintf (STREAM, \"\\t.word\\t0xdfe30014\\t\\t# ld     $3,20($31)\\n\");\t\\\n-      fprintf (STREAM, \"\\t.word\\t0xdfe2001c\\t\\t# ld     $2,28($31)\\n\");\t\\\n-      fprintf (STREAM, \"\\t.word\\t0x0060c82d\\t\\t# dmove  $25,$3\\n\");\t\\\n+      fprintf (STREAM, \"\\t.word\\t0xdff90014\\t\\t# ld     $25,20($31)\\n\"); \\\n+      fprintf (STREAM, \"\\t.word\\t0xdfef001c\\t\\t# ld     $15,28($31)\\n\"); \\\n     }\t\t\t\t\t\t\t\t\t\\\n   else\t\t\t\t\t\t\t\t\t\\\n     {\t\t\t\t\t\t\t\t\t\\\n-      fprintf (STREAM, \"\\t.word\\t0x8fe30014\\t\\t# lw     $3,20($31)\\n\");\t\\\n-      fprintf (STREAM, \"\\t.word\\t0x8fe20018\\t\\t# lw     $2,24($31)\\n\");\t\\\n-      fprintf (STREAM, \"\\t.word\\t0x0060c821\\t\\t# move   $25,$3\\n\");\t\\\n+      fprintf (STREAM, \"\\t.word\\t0x8ff90010\\t\\t# lw     $25,16($31)\\n\"); \\\n+      fprintf (STREAM, \"\\t.word\\t0x8fef0014\\t\\t# lw     $15,20($31)\\n\"); \\\n     }\t\t\t\t\t\t\t\t\t\\\n-  fprintf (STREAM, \"\\t.word\\t0x00600008\\t\\t# jr     $3\\n\");\t\t\\\n+  fprintf (STREAM, \"\\t.word\\t0x03200008\\t\\t# jr     $25\\n\");\t\t\\\n   if (ptr_mode == DImode)\t\t\t\t\t\t\\\n     {\t\t\t\t\t\t\t\t\t\\\n       fprintf (STREAM, \"\\t.word\\t0x0020f82d\\t\\t# dmove   $31,$1\\n\");\t\\\n+      fprintf (STREAM, \"\\t.word\\t0x00000000\\t\\t# <padding>\\n\");\t\t\\\n       fprintf (STREAM, \"\\t.dword\\t0x00000000\\t\\t# <function address>\\n\"); \\\n       fprintf (STREAM, \"\\t.dword\\t0x00000000\\t\\t# <static chain value>\\n\"); \\\n     }\t\t\t\t\t\t\t\t\t\\\n@@ -2259,7 +2266,7 @@ typedef struct mips_args {\n /* A C expression for the size in bytes of the trampoline, as an\n    integer.  */\n \n-#define TRAMPOLINE_SIZE (32 + GET_MODE_SIZE (ptr_mode) * 2)\n+#define TRAMPOLINE_SIZE (ptr_mode == DImode ? 48 : 36)\n \n /* Alignment required for trampolines, in bits.  */\n \n@@ -2289,7 +2296,7 @@ typedef struct mips_args {\n {\t\t\t\t\t\t\t\t\t    \\\n   rtx func_addr, chain_addr, end_addr;                                      \\\n \t\t\t\t\t\t\t\t\t    \\\n-  func_addr = plus_constant (ADDR, 32);\t\t\t\t\t    \\\n+  func_addr = plus_constant (ADDR, ptr_mode == DImode ? 32 : 28);\t    \\\n   chain_addr = plus_constant (func_addr, GET_MODE_SIZE (ptr_mode));\t    \\\n   mips_emit_move (gen_rtx_MEM (ptr_mode, func_addr), FUNC);\t\t    \\\n   mips_emit_move (gen_rtx_MEM (ptr_mode, chain_addr), CHAIN);\t\t    \\"}, {"sha": "f6b609707275f66f2157676ea5efd30d12b20eb8", "filename": "gcc/config/mips/sdemtk.h", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e538e028ec41ada02fa243b25a88b47b1a6d030b/gcc%2Fconfig%2Fmips%2Fsdemtk.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e538e028ec41ada02fa243b25a88b47b1a6d030b/gcc%2Fconfig%2Fmips%2Fsdemtk.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fsdemtk.h?ref=e538e028ec41ada02fa243b25a88b47b1a6d030b", "patch": "@@ -94,12 +94,20 @@ extern void mips_sync_icache (void *beg, unsigned long len);\n #define FUNCTION_PROFILER(FILE, LABELNO)\t\t\t\t\\\n   {\t\t\t\t\t\t\t\t\t\\\n     fprintf (FILE, \"\\t.set\\tnoat\\n\");\t\t\t\t\t\\\n+    /* _mcount treats $2 as the static chain register.  */\t\t\\\n+    if (cfun->static_chain_decl != NULL)\t\t\t\t\\\n+      fprintf (FILE, \"\\tmove\\t%s,%s\\n\", reg_names[2],\t\t\t\\\n+\t       reg_names[STATIC_CHAIN_REGNUM]);\t\t\t\t\\\n     /* MIPS16 code passes saved $ra in $v1 instead of $at.  */\t\t\\\n     fprintf (FILE, \"\\tmove\\t%s,%s\\n\",\t\t\t\t\t\\\n \t     reg_names[GP_REG_FIRST + (TARGET_MIPS16 ? 3 : 1)],\t\t\\\n \t     reg_names[GP_REG_FIRST + 31]);\t\t\t\t\\\n     fprintf (FILE, \"\\tjal\\t_mcount\\n\");\t\t\t\t\t\\\n     fprintf (FILE, \"\\t.set\\tat\\n\");\t\t\t\t\t\\\n+    /* _mcount treats $2 as the static chain register.  */\t\t\\\n+    if (cfun->static_chain_decl != NULL)\t\t\t\t\\\n+      fprintf (FILE, \"\\tmove\\t%s,%s\\n\", reg_names[STATIC_CHAIN_REGNUM],\t\\\n+\t       reg_names[2]);\t\t\t\t\t\t\\\n   }\n \n /* ...nor does the call sequence preserve $31.  */"}]}