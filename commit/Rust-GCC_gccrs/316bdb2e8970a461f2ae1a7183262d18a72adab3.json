{"sha": "316bdb2e8970a461f2ae1a7183262d18a72adab3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzE2YmRiMmU4OTcwYTQ2MWYyYWUxYTcxODMyNjJkMThhNzJhZGFiMw==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-05-25T08:21:41Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-05-25T09:11:02Z"}, "message": "middle-end/100727 - fix call expansion with WITH_SIZE_EXPR arg\n\ncall expansion used the result of get_base_address to switch between\nABIs - with get_base_address now never returning NULL we have to\nre-instantiate the check in a more explicit way.  This also adjusts\nmark_addressable to skip WITH_SIZE_EXPRs, consistent with how\nbuild_fold_addr_expr handles it.\n\n2021-05-25  Richard Biener  <rguenther@suse.de>\n\n\tPR middle-end/100727\n\t* calls.c (initialize_argument_information): Explicitely test\n\tfor WITH_SIZE_EXPR.\n\t* gimple-expr.c (mark_addressable): Skip outer WITH_SIZE_EXPR.", "tree": {"sha": "54cf30bf2a06382386086dc5e426039c798cbc0c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/54cf30bf2a06382386086dc5e426039c798cbc0c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/316bdb2e8970a461f2ae1a7183262d18a72adab3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/316bdb2e8970a461f2ae1a7183262d18a72adab3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/316bdb2e8970a461f2ae1a7183262d18a72adab3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/316bdb2e8970a461f2ae1a7183262d18a72adab3/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3a81735c1c8cea4323dcb912b7a8879b54aa3bc0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3a81735c1c8cea4323dcb912b7a8879b54aa3bc0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3a81735c1c8cea4323dcb912b7a8879b54aa3bc0"}], "stats": {"total": 5, "additions": 4, "deletions": 1}, "files": [{"sha": "dd8ff2aa7cbb7260c9241e71101cf1f77c68d318", "filename": "gcc/calls.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/316bdb2e8970a461f2ae1a7183262d18a72adab3/gcc%2Fcalls.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/316bdb2e8970a461f2ae1a7183262d18a72adab3/gcc%2Fcalls.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcalls.c?ref=316bdb2e8970a461f2ae1a7183262d18a72adab3", "patch": "@@ -2397,7 +2397,8 @@ initialize_argument_information (int num_actuals ATTRIBUTE_UNUSED,\n \t     already in memory, instead of making a copy.  Likewise if we want\n \t     to make the copy in the callee instead of the caller.  */\n \t  if ((call_from_thunk_p || callee_copies)\n-\t      && (base = get_base_address (args[i].tree_value))\n+\t      && TREE_CODE (args[i].tree_value) != WITH_SIZE_EXPR\n+\t      && ((base = get_base_address (args[i].tree_value)), true)\n \t      && TREE_CODE (base) != SSA_NAME\n \t      && (!DECL_P (base) || MEM_P (DECL_RTL (base))))\n \t    {"}, {"sha": "c3211795d33dfffd5c7636d5387dfcb850b60572", "filename": "gcc/gimple-expr.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/316bdb2e8970a461f2ae1a7183262d18a72adab3/gcc%2Fgimple-expr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/316bdb2e8970a461f2ae1a7183262d18a72adab3/gcc%2Fgimple-expr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-expr.c?ref=316bdb2e8970a461f2ae1a7183262d18a72adab3", "patch": "@@ -900,6 +900,8 @@ flush_mark_addressable_queue ()\n void\n mark_addressable (tree x)\n {\n+  if (TREE_CODE (x) == WITH_SIZE_EXPR)\n+    x = TREE_OPERAND (x, 0);\n   while (handled_component_p (x))\n     x = TREE_OPERAND (x, 0);\n   if (TREE_CODE (x) == MEM_REF"}]}