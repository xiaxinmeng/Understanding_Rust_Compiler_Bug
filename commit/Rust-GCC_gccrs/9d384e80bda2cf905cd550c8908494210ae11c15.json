{"sha": "9d384e80bda2cf905cd550c8908494210ae11c15", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWQzODRlODBiZGEyY2Y5MDVjZDU1MGM4OTA4NDk0MjEwYWUxMWMxNQ==", "commit": {"author": {"name": "Bin Cheng", "email": "bin.cheng@arm.com", "date": "2017-03-28T15:35:56Z"}, "committer": {"name": "Bin Cheng", "email": "amker@gcc.gnu.org", "date": "2017-03-28T15:35:56Z"}, "message": "tree-vect-loop.c (optimize_mask_stores): Add bb to the right loop.\n\n\t* tree-vect-loop.c (optimize_mask_stores): Add bb to the right\n\tloop.\n\nFrom-SVN: r246541", "tree": {"sha": "8a5453ed2ca619ddeb6950e881cbe6b779430443", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8a5453ed2ca619ddeb6950e881cbe6b779430443"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9d384e80bda2cf905cd550c8908494210ae11c15", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d384e80bda2cf905cd550c8908494210ae11c15", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9d384e80bda2cf905cd550c8908494210ae11c15", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d384e80bda2cf905cd550c8908494210ae11c15/comments", "author": null, "committer": null, "parents": [{"sha": "3e907b90563ad90752acf1b318bdac33d546c7f7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e907b90563ad90752acf1b318bdac33d546c7f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3e907b90563ad90752acf1b318bdac33d546c7f7"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "b57d40b08635d7198557e61254ebe52779a20f74", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d384e80bda2cf905cd550c8908494210ae11c15/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d384e80bda2cf905cd550c8908494210ae11c15/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9d384e80bda2cf905cd550c8908494210ae11c15", "patch": "@@ -1,3 +1,8 @@\n+2017-03-28  Bin Cheng  <bin.cheng@arm.com>\n+\n+\t* tree-vect-loop.c (optimize_mask_stores): Add bb to the right\n+\tloop.\n+\n 2017-03-28  Bin Cheng  <bin.cheng@arm.com>\n \n \t* tree-vect-loop-manip.c (slpeel_add_loop_guard): New param and"}, {"sha": "af874e7ad8e448ef896999fc85e83a711b6c045c", "filename": "gcc/tree-vect-loop.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d384e80bda2cf905cd550c8908494210ae11c15/gcc%2Ftree-vect-loop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d384e80bda2cf905cd550c8908494210ae11c15/gcc%2Ftree-vect-loop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop.c?ref=9d384e80bda2cf905cd550c8908494210ae11c15", "patch": "@@ -7229,6 +7229,7 @@ optimize_mask_stores (struct loop *loop)\n   unsigned nbbs = loop->num_nodes;\n   unsigned i;\n   basic_block bb;\n+  struct loop *bb_loop;\n   gimple_stmt_iterator gsi;\n   gimple *stmt;\n   auto_vec<gimple *> worklist;\n@@ -7267,11 +7268,16 @@ optimize_mask_stores (struct loop *loop)\n       last = worklist.pop ();\n       mask = gimple_call_arg (last, 2);\n       bb = gimple_bb (last);\n-      /* Create new bb.  */\n+      /* Create then_bb and if-then structure in CFG, then_bb belongs to\n+\t the same loop as if_bb.  It could be different to LOOP when two\n+\t level loop-nest is vectorized and mask_store belongs to the inner\n+\t one.  */\n       e = split_block (bb, last);\n+      bb_loop = bb->loop_father;\n+      gcc_assert (loop == bb_loop || flow_loop_nested_p (loop, bb_loop));\n       join_bb = e->dest;\n       store_bb = create_empty_bb (bb);\n-      add_bb_to_loop (store_bb, loop);\n+      add_bb_to_loop (store_bb, bb_loop);\n       e->flags = EDGE_TRUE_VALUE;\n       efalse = make_edge (bb, store_bb, EDGE_FALSE_VALUE);\n       /* Put STORE_BB to likely part.  */"}]}