{"sha": "2ad04111c305ea6a20fc99323e0c479ba661c479", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmFkMDQxMTFjMzA1ZWE2YTIwZmM5OTMyM2UwYzQ3OWJhNjYxYzQ3OQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2019-01-25T08:13:34Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2019-01-25T08:13:34Z"}, "message": "re PR tree-optimization/86865 (Wrong code w/ -O2 -floop-parallelize-all -fstack-reuse=none -fwrapv -fno-tree-ch -fno-tree-dce -fno-tree-dominator-opts -fno-tree-loop-ivcanon)\n\n2019-01-25  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/86865\n\t* graphite-scop-detection.c (scop_detection::can_represent_loop):\n\tReject non-do-while loops.\n\n\t* gcc.dg/graphite/pr86865.c: New testcase.\n\t* gcc.dg/graphite/pr69728.c: XFAIL.\n\t* gcc.dg/graphite/scop-21.c: Likewise.\n\nFrom-SVN: r268257", "tree": {"sha": "0895a3402a18d5b16e628c339b2743b3ae8640ed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0895a3402a18d5b16e628c339b2743b3ae8640ed"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2ad04111c305ea6a20fc99323e0c479ba661c479", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ad04111c305ea6a20fc99323e0c479ba661c479", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2ad04111c305ea6a20fc99323e0c479ba661c479", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ad04111c305ea6a20fc99323e0c479ba661c479/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "bb58a17bebea1be9ab0d753c61826dab8b4077f9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bb58a17bebea1be9ab0d753c61826dab8b4077f9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bb58a17bebea1be9ab0d753c61826dab8b4077f9"}], "stats": {"total": 66, "additions": 62, "deletions": 4}, "files": [{"sha": "bdcd4739fa402be6e3224f958eba952a93843477", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ad04111c305ea6a20fc99323e0c479ba661c479/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ad04111c305ea6a20fc99323e0c479ba661c479/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2ad04111c305ea6a20fc99323e0c479ba661c479", "patch": "@@ -1,3 +1,9 @@\n+2019-01-25  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/86865\n+\t* graphite-scop-detection.c (scop_detection::can_represent_loop):\n+\tReject non-do-while loops.\n+\n 2019-01-24  Peter Bergner  <bergner@linux.ibm.com>\n \n \t* config/rs6000/altivec.md (build_vector_mask_for_load): Use MEM_P."}, {"sha": "7e8d42cab0d17ba65f50f190e91ca1290bab231f", "filename": "gcc/graphite-scop-detection.c", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ad04111c305ea6a20fc99323e0c479ba661c479/gcc%2Fgraphite-scop-detection.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ad04111c305ea6a20fc99323e0c479ba661c479/gcc%2Fgraphite-scop-detection.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgraphite-scop-detection.c?ref=2ad04111c305ea6a20fc99323e0c479ba661c479", "patch": "@@ -555,8 +555,15 @@ scop_detection::can_represent_loop (loop_p loop, sese_l scop)\n   tree niter;\n   struct tree_niter_desc niter_desc;\n \n-  return single_exit (loop)\n-    && !(loop_preheader_edge (loop)->flags & EDGE_IRREDUCIBLE_LOOP)\n+  /* We can only handle do {} while () style loops correctly.  */\n+  edge exit = single_exit (loop);\n+  if (!exit\n+      || !single_pred_p (loop->latch)\n+      || exit->src != single_pred (loop->latch)\n+      || !empty_block_p (loop->latch))\n+    return false;\n+\n+  return !(loop_preheader_edge (loop)->flags & EDGE_IRREDUCIBLE_LOOP)\n     && number_of_iterations_exit (loop, single_exit (loop), &niter_desc, false)\n     && niter_desc.control.no_overflow\n     && (niter = number_of_latch_executions (loop))"}, {"sha": "9803c91e40bc261f23ec2e9f5e1d7240568fe047", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ad04111c305ea6a20fc99323e0c479ba661c479/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ad04111c305ea6a20fc99323e0c479ba661c479/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2ad04111c305ea6a20fc99323e0c479ba661c479", "patch": "@@ -1,3 +1,10 @@\n+2019-01-25  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/86865\n+\t* gcc.dg/graphite/pr86865.c: New testcase.\n+\t* gcc.dg/graphite/pr69728.c: XFAIL.\n+\t* gcc.dg/graphite/scop-21.c: Likewise.\n+\n 2019-01-24  Martin Sebor  <msebor@redhat.com>\n \n \tPR c/86125"}, {"sha": "69e28318aafe957e1c8f1df4c57e3ee07045d92f", "filename": "gcc/testsuite/gcc.dg/graphite/pr69728.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ad04111c305ea6a20fc99323e0c479ba661c479/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr69728.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ad04111c305ea6a20fc99323e0c479ba661c479/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr69728.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr69728.c?ref=2ad04111c305ea6a20fc99323e0c479ba661c479", "patch": "@@ -24,4 +24,6 @@ fn1 ()\n    run into scheduling issues before here, not being able to handle\n    empty domains.  */\n \n-/* { dg-final { scan-tree-dump \"loop nest optimized\" \"graphite\" } }  */\n+/* XFAILed by fix for PR86865.  */\n+\n+/* { dg-final { scan-tree-dump \"loop nest optimized\" \"graphite\" { xfail *-*-* } } }  */"}, {"sha": "a6b4208d83050b794deec668561b16f005e8941c", "filename": "gcc/testsuite/gcc.dg/graphite/pr86865.c", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ad04111c305ea6a20fc99323e0c479ba661c479/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr86865.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ad04111c305ea6a20fc99323e0c479ba661c479/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr86865.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr86865.c?ref=2ad04111c305ea6a20fc99323e0c479ba661c479", "patch": "@@ -0,0 +1,35 @@\n+/* { dg-do run } */\n+/* { dg-options \"-O2 -fgraphite-identity -fstack-reuse=none -fwrapv -fno-tree-ch -fno-tree-dce -fno-tree-dominator-opts -fno-tree-loop-ivcanon\" } */\n+\n+int xy, tb;\n+\n+void\n+bt (void)\n+{\n+  for (xy = 0; xy >= 0; --xy)\n+    {\n+      int yt[8] = { 0 };\n+      int pz[2] = { 0 };\n+      int sa[32] = { 0 };\n+      int us;\n+\n+      for (us = 0; us < 8; ++us)\n+\tyt[us] = 0;\n+\n+      (void) yt;\n+      (void) pz;\n+      (void) sa;\n+    }\n+\n+  tb = 1;\n+}\n+\n+int\n+main (void)\n+{\n+  bt ();\n+  if (xy != -1)\n+    __builtin_abort ();\n+\n+  return 0;\n+}"}, {"sha": "304e0792b2bfd2deedb5f697e1b205a11aa11eb9", "filename": "gcc/testsuite/gcc.dg/graphite/scop-21.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ad04111c305ea6a20fc99323e0c479ba661c479/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fscop-21.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ad04111c305ea6a20fc99323e0c479ba661c479/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fscop-21.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fscop-21.c?ref=2ad04111c305ea6a20fc99323e0c479ba661c479", "patch": "@@ -30,4 +30,5 @@ int test ()\n \n   return a[20];\n }\n-/* { dg-final { scan-tree-dump-times \"number of SCoPs: 1\" 1 \"graphite\"} } */\n+/* XFAILed by the fix for PR86865.  */\n+/* { dg-final { scan-tree-dump-times \"number of SCoPs: 1\" 1 \"graphite\" { xfail *-*-* } } } */"}]}