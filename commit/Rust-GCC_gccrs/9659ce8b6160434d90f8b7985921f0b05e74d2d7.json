{"sha": "9659ce8b6160434d90f8b7985921f0b05e74d2d7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTY1OWNlOGI2MTYwNDM0ZDkwZjhiNzk4NTkyMWYwYjA1ZTc0ZDJkNw==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2006-08-04T17:03:32Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2006-08-04T17:03:32Z"}, "message": "re PR tree-optimization/24888 (duplication of local variables after versioning/inlining)\n\n\tPR tree-optimization/24888\n\t* tree-inline.c (expand_call_inline): Do not re-record variables.\n\t(declare_inline_vars): Add variable to unexpanded_var_list.\n\nFrom-SVN: r115927", "tree": {"sha": "d0caa9a1ab904708ee4a7426cf34ec43d34b434f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d0caa9a1ab904708ee4a7426cf34ec43d34b434f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9659ce8b6160434d90f8b7985921f0b05e74d2d7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9659ce8b6160434d90f8b7985921f0b05e74d2d7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9659ce8b6160434d90f8b7985921f0b05e74d2d7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9659ce8b6160434d90f8b7985921f0b05e74d2d7/comments", "author": null, "committer": null, "parents": [{"sha": "824a4527c15e4ae4664a56366030bc4f6e8243b0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/824a4527c15e4ae4664a56366030bc4f6e8243b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/824a4527c15e4ae4664a56366030bc4f6e8243b0"}], "stats": {"total": 16, "additions": 13, "deletions": 3}, "files": [{"sha": "642cde8cdb94e5256ed599743de172121dbdc07c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9659ce8b6160434d90f8b7985921f0b05e74d2d7/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9659ce8b6160434d90f8b7985921f0b05e74d2d7/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9659ce8b6160434d90f8b7985921f0b05e74d2d7", "patch": "@@ -1,3 +1,9 @@\n+2006-08-04  Jan Hubicka  <jh@suse.cz>\n+\n+\tPR tree-optimization/24888\n+\t* tree-inline.c (expand_call_inline): Do not re-record variables.\n+\t(declare_inline_vars): Add variable to unexpanded_var_list.\n+\n 2006-08-04  John David Anglin  <dave.anglin@nrc-cnrc.gc.ca>\n \t    Roger Sayle  <roger@eyesopen.com>\n "}, {"sha": "b05bf2665f550888b5e222995a03131c07c50be7", "filename": "gcc/tree-inline.c", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9659ce8b6160434d90f8b7985921f0b05e74d2d7/gcc%2Ftree-inline.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9659ce8b6160434d90f8b7985921f0b05e74d2d7/gcc%2Ftree-inline.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-inline.c?ref=9659ce8b6160434d90f8b7985921f0b05e74d2d7", "patch": "@@ -2163,8 +2163,6 @@ expand_call_inline (basic_block bb, tree stmt, tree *tp, void *data)\n   /* Update callgraph if needed.  */\n   cgraph_remove_node (cg_edge->callee);\n \n-  /* Declare the 'auto' variables added with this inlined body.  */\n-  record_vars (BLOCK_VARS (id->block));\n   id->block = NULL_TREE;\n   successfully_inlined = TRUE;\n \n@@ -2556,7 +2554,13 @@ declare_inline_vars (tree block, tree vars)\n {\n   tree t;\n   for (t = vars; t; t = TREE_CHAIN (t))\n-    DECL_SEEN_IN_BIND_EXPR_P (t) = 1;\n+    {\n+      DECL_SEEN_IN_BIND_EXPR_P (t) = 1;\n+      gcc_assert (!TREE_STATIC (t) && !TREE_ASM_WRITTEN (t));\n+      cfun->unexpanded_var_list =\n+\ttree_cons (NULL_TREE, t,\n+\t\t   cfun->unexpanded_var_list);\n+    }\n \n   if (block)\n     BLOCK_VARS (block) = chainon (BLOCK_VARS (block), vars);"}]}