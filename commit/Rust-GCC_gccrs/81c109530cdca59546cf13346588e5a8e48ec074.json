{"sha": "81c109530cdca59546cf13346588e5a8e48ec074", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODFjMTA5NTMwY2RjYTU5NTQ2Y2YxMzM0NjU4OGU1YThlNDhlYzA3NA==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2008-03-09T19:38:51Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2008-03-09T19:38:51Z"}, "message": "re PR fortran/35474 (Reading module file with COMMON and EQUIVALENCE)\n\n2008-03-09  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/35474\n\t* module.c (mio_symtree_ref): After providing a symbol for a\n\tmissing equivalence member, resolve and NULL the fixups.\n\n2008-03-09  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/35474\n\t* gfortran.dg/module_commons_2.f90 : New test.\n\nFrom-SVN: r133063", "tree": {"sha": "f16e6056a26aa61c3d1da107510fbc2a9e3df577", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f16e6056a26aa61c3d1da107510fbc2a9e3df577"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/81c109530cdca59546cf13346588e5a8e48ec074", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81c109530cdca59546cf13346588e5a8e48ec074", "html_url": "https://github.com/Rust-GCC/gccrs/commit/81c109530cdca59546cf13346588e5a8e48ec074", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81c109530cdca59546cf13346588e5a8e48ec074/comments", "author": null, "committer": null, "parents": [{"sha": "802e3f8c818a594430066173ab0beb8bde96a74a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/802e3f8c818a594430066173ab0beb8bde96a74a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/802e3f8c818a594430066173ab0beb8bde96a74a"}], "stats": {"total": 38, "additions": 38, "deletions": 0}, "files": [{"sha": "e660d9cd8fff76414d86eda4f14f45696b8e7418", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81c109530cdca59546cf13346588e5a8e48ec074/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81c109530cdca59546cf13346588e5a8e48ec074/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=81c109530cdca59546cf13346588e5a8e48ec074", "patch": "@@ -1,3 +1,9 @@\n+2008-03-09  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/35474\n+\t* module.c (mio_symtree_ref): After providing a symbol for a\n+\tmissing equivalence member, resolve and NULL the fixups.\n+\n 2008-03-09  Ralf Wildenhues  <Ralf.Wildenhues@gmx.de>\n \n \t* invoke.texi (Error and Warning Options): Document"}, {"sha": "bc45e9eb9c14315571458d9c78086b163b7e4282", "filename": "gcc/fortran/module.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81c109530cdca59546cf13346588e5a8e48ec074/gcc%2Ffortran%2Fmodule.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81c109530cdca59546cf13346588e5a8e48ec074/gcc%2Ffortran%2Fmodule.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmodule.c?ref=81c109530cdca59546cf13346588e5a8e48ec074", "patch": "@@ -2310,6 +2310,12 @@ mio_symtree_ref (gfc_symtree **stp)\n \t  p->u.rsym.symtree->n.sym = p->u.rsym.sym;\n \t  p->u.rsym.symtree->n.sym->refs++;\n \t  p->u.rsym.referenced = 1;\n+\n+\t  /* If the symbol is PRIVATE and in COMMON, load_commons will\n+\t     generate a fixup symbol, which must be associated.  */\n+\t  if (p->fixup)\n+\t    resolve_fixups (p->fixup, p->u.rsym.sym);\n+\t  p->fixup = NULL;\n \t}\n       \n       if (p->type == P_UNKNOWN)"}, {"sha": "5db1398385576216fb2fd9a1d7b188851b63315c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81c109530cdca59546cf13346588e5a8e48ec074/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81c109530cdca59546cf13346588e5a8e48ec074/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=81c109530cdca59546cf13346588e5a8e48ec074", "patch": "@@ -1,3 +1,8 @@\n+2008-03-09  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/35474\n+\t* gfortran.dg/module_commons_2.f90: New test.\n+\n 2008-03-09  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/frame_overflow.adb: Improve portability."}, {"sha": "3c3214c20ff3662b41022373b01d098dba3f5726", "filename": "gcc/testsuite/gfortran.dg/module_commons_2.f90", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81c109530cdca59546cf13346588e5a8e48ec074/gcc%2Ftestsuite%2Fgfortran.dg%2Fmodule_commons_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81c109530cdca59546cf13346588e5a8e48ec074/gcc%2Ftestsuite%2Fgfortran.dg%2Fmodule_commons_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fmodule_commons_2.f90?ref=81c109530cdca59546cf13346588e5a8e48ec074", "patch": "@@ -0,0 +1,21 @@\n+! { dg-do compile }\n+! Tests the fix for PR35474, in which the PRIVATE statement would\n+! cause the error Internal Error at (1): free_pi_tree(): Unresolved fixup\n+! This arose because the symbol for 'i' emanating from the COMMON was\n+! not being fixed-up as the EQUIVALENCE was built.\n+!\n+! Contributed by FX Coudert <fxcoudert@gcc.gnu.org>\n+!\n+module h5global\n+  integer i\n+  integer j\n+  common /c/ i\n+  equivalence (i, j)\n+  private\n+end module h5global\n+\n+program bug\n+  use h5global\n+end\n+\n+! { dg-final { cleanup-modules \"h5global\" } }"}]}