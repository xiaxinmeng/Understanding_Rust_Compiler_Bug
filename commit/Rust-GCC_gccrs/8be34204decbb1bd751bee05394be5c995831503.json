{"sha": "8be34204decbb1bd751bee05394be5c995831503", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGJlMzQyMDRkZWNiYjFiZDc1MWJlZTA1Mzk0YmU1Yzk5NTgzMTUwMw==", "commit": {"author": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2019-11-11T15:59:48Z"}, "committer": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2019-11-11T15:59:48Z"}, "message": "Bump minimum MPFR version to 3.1.0\n\nBump the minimum MPFR version to 3.1.0, released 2011-10-03. With this\nrequirement one can still build GCC with the operating system provided\nMPFR on old but still supported operating systems like SLES 12 (MPFR\n3.1.2) or RHEL/CentOS 7.x (MPFR 3.1.1).\n\nThis allows removing some code in the Fortran frontend, as well as\nfixing PR 91828.\n\nChangeLog:\n\n2019-11-11  Janne Blomqvist  <jb@gcc.gnu.org>\n\n\tPR fortran/91828\n\t* configure.ac: Bump minimum MPFR to 3.1.0, recommended to 3.1.6+.\n\t* configure: Regenerated.\n\ngcc/ChangeLog:\n\n2019-11-11  Janne Blomqvist  <jb@gcc.gnu.org>\n\n\tPR fortran/91828\n\t* doc/install.texi: Document that the minimum MPFR version is\n\t3.1.0.\n\ngcc/fortran/ChangeLog:\n\n2019-11-11  Janne Blomqvist  <jb@gcc.gnu.org>\n\n\tPR fortran/91828\n\t* simplify.c (gfc_simplify_fraction): Remove fallback path for\n\tMPFR < 3.1.0.\n\nFrom-SVN: r278058", "tree": {"sha": "14e0d7c76e0a849340fee0e636f65740e96ff3d4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/14e0d7c76e0a849340fee0e636f65740e96ff3d4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8be34204decbb1bd751bee05394be5c995831503", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8be34204decbb1bd751bee05394be5c995831503", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8be34204decbb1bd751bee05394be5c995831503", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8be34204decbb1bd751bee05394be5c995831503/comments", "author": null, "committer": null, "parents": [{"sha": "5fcb3f62fc2467e5049030da56ff5f76af9a03a7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5fcb3f62fc2467e5049030da56ff5f76af9a03a7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5fcb3f62fc2467e5049030da56ff5f76af9a03a7"}], "stats": {"total": 69, "additions": 25, "deletions": 44}, "files": [{"sha": "1d67b867f19d01fd80d167e4db7d2a3c1a9abf88", "filename": "ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8be34204decbb1bd751bee05394be5c995831503/ChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8be34204decbb1bd751bee05394be5c995831503/ChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ChangeLog?ref=8be34204decbb1bd751bee05394be5c995831503", "patch": "@@ -1,3 +1,9 @@\n+2019-11-11  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+        PR fortran/91828\n+        * configure.ac: Bump minimum MPFR to 3.1.0, recommended to 3.1.6+.\n+        * configure: Regenerated.\n+\n 2019-10-21  Jason Merrill  <jason@redhat.com>\n \n \t* .gitattributes: Also check ChangeLog whitespace."}, {"sha": "ce146591655ddbaf478447e7e0091db816a3c91a", "filename": "configure", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8be34204decbb1bd751bee05394be5c995831503/configure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8be34204decbb1bd751bee05394be5c995831503/configure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/configure?ref=8be34204decbb1bd751bee05394be5c995831503", "patch": "@@ -5755,7 +5755,7 @@ int\n main ()\n {\n \n-    #if MPFR_VERSION < MPFR_VERSION_NUM(2,4,0)\n+    #if MPFR_VERSION < MPFR_VERSION_NUM(3,1,0)\n     choke me\n     #endif\n \n@@ -5772,7 +5772,7 @@ int\n main ()\n {\n \n-    #if MPFR_VERSION < MPFR_VERSION_NUM(2,4,2)\n+    #if MPFR_VERSION < MPFR_VERSION_NUM(3,1,6)\n     choke me\n     #endif\n \n@@ -5898,7 +5898,7 @@ rm -f core conftest.err conftest.$ac_objext \\\n # The library versions listed in the error message below should match\n # the HARD-minimums enforced above.\n   if test x$have_gmp != xyes; then\n-    as_fn_error $? \"Building GCC requires GMP 4.2+, MPFR 2.4.0+ and MPC 0.8.0+.\n+    as_fn_error $? \"Building GCC requires GMP 4.2+, MPFR 3.1.0+ and MPC 0.8.0+.\n Try the --with-gmp, --with-mpfr and/or --with-mpc options to specify\n their locations.  Source code for these libraries can be found at\n their respective hosting sites as well as at"}, {"sha": "d63a8bae940495588ef3ba5a7fd71cbba482bf7d", "filename": "configure.ac", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8be34204decbb1bd751bee05394be5c995831503/configure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8be34204decbb1bd751bee05394be5c995831503/configure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/configure.ac?ref=8be34204decbb1bd751bee05394be5c995831503", "patch": "@@ -1601,12 +1601,12 @@ if test -d ${srcdir}/gcc && test \"x$have_gmp\" = xno; then\n     AC_MSG_CHECKING([for the correct version of mpfr.h])\n     AC_TRY_COMPILE([#include <gmp.h>\n     #include <mpfr.h>],[\n-    #if MPFR_VERSION < MPFR_VERSION_NUM(2,4,0)\n+    #if MPFR_VERSION < MPFR_VERSION_NUM(3,1,0)\n     choke me\n     #endif\n     ], [AC_TRY_COMPILE([#include <gmp.h>\n     #include <mpfr.h>],[\n-    #if MPFR_VERSION < MPFR_VERSION_NUM(2,4,2)\n+    #if MPFR_VERSION < MPFR_VERSION_NUM(3,1,6)\n     choke me\n     #endif\n     ], [AC_MSG_RESULT([yes])], [AC_MSG_RESULT([buggy but acceptable])])],\n@@ -1661,7 +1661,7 @@ if test -d ${srcdir}/gcc && test \"x$have_gmp\" = xno; then\n # The library versions listed in the error message below should match\n # the HARD-minimums enforced above.\n   if test x$have_gmp != xyes; then\n-    AC_MSG_ERROR([Building GCC requires GMP 4.2+, MPFR 2.4.0+ and MPC 0.8.0+.\n+    AC_MSG_ERROR([Building GCC requires GMP 4.2+, MPFR 3.1.0+ and MPC 0.8.0+.\n Try the --with-gmp, --with-mpfr and/or --with-mpc options to specify\n their locations.  Source code for these libraries can be found at\n their respective hosting sites as well as at"}, {"sha": "9bb851367258e23a5d89ed1edbb1b90d587665b3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8be34204decbb1bd751bee05394be5c995831503/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8be34204decbb1bd751bee05394be5c995831503/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8be34204decbb1bd751bee05394be5c995831503", "patch": "@@ -1,3 +1,9 @@\n+2019-11-11  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+        PR fortran/91828\n+        * doc/install.texi: Document that the minimum MPFR version is\n+        3.1.0.\n+\n 2019-11-11  Claudiu Zissulescu <claziss@gmail.com>\n \n \t* config/arc/arc.md (movsi_ne): Reorder instruction variants and"}, {"sha": "93b01ff7971dfcaa9c58a06b1108a2ece019f653", "filename": "gcc/doc/install.texi", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8be34204decbb1bd751bee05394be5c995831503/gcc%2Fdoc%2Finstall.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8be34204decbb1bd751bee05394be5c995831503/gcc%2Fdoc%2Finstall.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finstall.texi?ref=8be34204decbb1bd751bee05394be5c995831503", "patch": "@@ -384,7 +384,7 @@ and @option{--with-gmp-include}.\n The in-tree build is only supported with the GMP version that\n download_prerequisites installs.\n \n-@item MPFR Library version 2.4.2 (or later)\n+@item MPFR Library version 3.1.0 (or later)\n \n Necessary to build GCC@.  It can be downloaded from\n @uref{https://www.mpfr.org}.  If an MPFR source distribution is found"}, {"sha": "0f14ad1277cf46ea9c87b05fa6979276e0f7b13d", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8be34204decbb1bd751bee05394be5c995831503/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8be34204decbb1bd751bee05394be5c995831503/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=8be34204decbb1bd751bee05394be5c995831503", "patch": "@@ -1,3 +1,9 @@\n+2019-11-11  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+        PR fortran/91828\n+        * simplify.c (gfc_simplify_fraction): Remove fallback path for\n+        MPFR < 3.1.0.\n+\n 2019-11-11  Tobias Burnus  <tobias@codesourcery.com>\n \t    Kwok Cheung Yeung  <kcy@codesourcery.com>\n "}, {"sha": "0461d31cd8866b770fb13b86f540fdb49b07f5ba", "filename": "gcc/fortran/simplify.c", "status": "modified", "additions": 0, "deletions": 37, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8be34204decbb1bd751bee05394be5c995831503/gcc%2Ffortran%2Fsimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8be34204decbb1bd751bee05394be5c995831503/gcc%2Ffortran%2Fsimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsimplify.c?ref=8be34204decbb1bd751bee05394be5c995831503", "patch": "@@ -3076,12 +3076,7 @@ gfc_expr *\n gfc_simplify_fraction (gfc_expr *x)\n {\n   gfc_expr *result;\n-\n-#if MPFR_VERSION < MPFR_VERSION_NUM(3,1,0)\n-  mpfr_t absv, exp, pow2;\n-#else\n   mpfr_exp_t e;\n-#endif\n \n   if (x->expr_type != EXPR_CONSTANT)\n     return NULL;\n@@ -3095,41 +3090,9 @@ gfc_simplify_fraction (gfc_expr *x)\n       return result;\n     }\n \n-#if MPFR_VERSION < MPFR_VERSION_NUM(3,1,0)\n-\n-  /* MPFR versions before 3.1.0 do not include mpfr_frexp.\n-     TODO: remove the kludge when MPFR 3.1.0 or newer will be required */\n-\n-  if (mpfr_sgn (x->value.real) == 0)\n-    {\n-      mpfr_set (result->value.real, x->value.real, GFC_RND_MODE);\n-      return result;\n-    }\n-\n-  gfc_set_model_kind (x->ts.kind);\n-  mpfr_init (exp);\n-  mpfr_init (absv);\n-  mpfr_init (pow2);\n-\n-  mpfr_abs (absv, x->value.real, GFC_RND_MODE);\n-  mpfr_log2 (exp, absv, GFC_RND_MODE);\n-\n-  mpfr_trunc (exp, exp);\n-  mpfr_add_ui (exp, exp, 1, GFC_RND_MODE);\n-\n-  mpfr_ui_pow (pow2, 2, exp, GFC_RND_MODE);\n-\n-  mpfr_div (result->value.real, x->value.real, pow2, GFC_RND_MODE);\n-\n-  mpfr_clears (exp, absv, pow2, NULL);\n-\n-#else\n-\n   /* mpfr_frexp() correctly handles zeros and NaNs.  */\n   mpfr_frexp (&e, result->value.real, x->value.real, GFC_RND_MODE);\n \n-#endif\n-\n   return range_check (result, \"FRACTION\");\n }\n "}]}