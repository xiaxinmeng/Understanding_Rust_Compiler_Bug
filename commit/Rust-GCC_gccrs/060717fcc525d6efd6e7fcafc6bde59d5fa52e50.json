{"sha": "060717fcc525d6efd6e7fcafc6bde59d5fa52e50", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDYwNzE3ZmNjNTI1ZDZlZmQ2ZTdmY2FmYzZiZGU1OWQ1ZmE1MmU1MA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2009-04-27T19:11:23Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2009-04-27T19:11:23Z"}, "message": "re PR testsuite/39807 (Reporting of testsuite failures are messed up when using -j)\n\n\tPR testsuite/39807\n\t* dg-extract-results.sh: Close open files and use >> instead of >\n\tto decrease number of concurrently open files from awk.  Avoid\n\t= at the beginning of a regexp and redirect to a file determined\n\tby curfile variable rather than concatenated strings to workaround\n\tSolaris nawk bug.\n\nFrom-SVN: r146850", "tree": {"sha": "4bacee12efc59a4042926285318fd3d24caf3da9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4bacee12efc59a4042926285318fd3d24caf3da9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/060717fcc525d6efd6e7fcafc6bde59d5fa52e50", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/060717fcc525d6efd6e7fcafc6bde59d5fa52e50", "html_url": "https://github.com/Rust-GCC/gccrs/commit/060717fcc525d6efd6e7fcafc6bde59d5fa52e50", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/060717fcc525d6efd6e7fcafc6bde59d5fa52e50/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5345cf689ed92391b912bfc6baa49b18c91e671f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5345cf689ed92391b912bfc6baa49b18c91e671f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5345cf689ed92391b912bfc6baa49b18c91e671f"}], "stats": {"total": 38, "additions": 27, "deletions": 11}, "files": [{"sha": "6ab29eb71d971c484ce787c1253bffc19e4aa072", "filename": "contrib/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/060717fcc525d6efd6e7fcafc6bde59d5fa52e50/contrib%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/060717fcc525d6efd6e7fcafc6bde59d5fa52e50/contrib%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2FChangeLog?ref=060717fcc525d6efd6e7fcafc6bde59d5fa52e50", "patch": "@@ -1,3 +1,12 @@\n+2009-04-27  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR testsuite/39807\n+\t* dg-extract-results.sh: Close open files and use >> instead of >\n+\tto decrease number of concurrently open files from awk.  Avoid\n+\t= at the beginning of a regexp and redirect to a file determined\n+\tby curfile variable rather than concatenated strings to workaround\n+\tSolaris nawk bug.\n+\n 2009-04-25  Gerald Pfeifer  <gerald@pfeifer.com>\n \n \t* test_summary: Only include LAST_UPDATED if it exists."}, {"sha": "518c19f6bee0a9e44f594c59c029763401d3a1bb", "filename": "contrib/dg-extract-results.sh", "status": "modified", "additions": 18, "deletions": 11, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/060717fcc525d6efd6e7fcafc6bde59d5fa52e50/contrib%2Fdg-extract-results.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/060717fcc525d6efd6e7fcafc6bde59d5fa52e50/contrib%2Fdg-extract-results.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fdg-extract-results.sh?ref=060717fcc525d6efd6e7fcafc6bde59d5fa52e50", "patch": "@@ -6,7 +6,7 @@\n # The resulting file can be used with test result comparison scripts for\n # results from tests that were run in parallel.  See usage() below.\n \n-# Copyright (C) 2008 Free Software Foundation\n+# Copyright (C) 2008, 2009 Free Software Foundation\n # Contributed by Janis Johnson <janis187@us.ibm.com>\n #\n # This file is part of GCC.\n@@ -148,26 +148,28 @@ if [ \"$TOOL\" = acats ]; then\n   ACATS_AWK=${TMP}/acats.awk\n   cat <<EOF > $ACATS_AWK\n BEGIN {\n-  print_prologue=1; chapter=\"\"; insummary=0\n+  print_prologue=1; curfile=\"\"; insummary=0\n   passcnt=0; failcnt=0; unsupcnt=0; failures=\"\"\n }\n-/=== acats configuration ===/ {\n+/^[ \\t]*=== acats configuration ===/ {\n   insummary=0\n   if (print_prologue) print\n   next\n }\n-/=== acats tests ===/ {\n+/^[ \\t]*=== acats tests ===/ {\n   if (print_prologue) print\n   print_prologue=0\n   next\n }\n /^Running chapter / {\n-  chapter=\\$3\n-  print > \"${TMP}/chapter-\"chapter\n+  if (curfile) close (curfile)\n+  curfile=\"${TMP}/chapter-\"\\$3\n+  print >> curfile\n   next\n }\n-/=== acats Summary ===/ {\n-  chapter=\"\"\n+/^[ \\t]*=== acats Summary ===/ {\n+  if (curfile) close (curfile)\n+  curfile=\"\"\n   insummary=1\n   next\n }\n@@ -182,7 +184,7 @@ BEGIN {\n }\n {\n   if (print_prologue) { print; next }\n-  if (chapter) print > \"${TMP}/chapter-\"chapter\n+  if (curfile) print >> curfile\n }\n END {\n   system (\"cat ${TMP}/chapter-*\")\n@@ -194,6 +196,7 @@ END {\n }\n EOF\n \n+  rm -f ${TMP}/chapter-*\n   $AWK -f $ACATS_AWK $SUM_FILES\n   exit 0\n fi\n@@ -270,6 +273,7 @@ BEGIN {\n   expfileno=1\n   cnt=0\n   print_using=0\n+  need_close=0\n }\n /^EXPFILE: / {\n   expfiles[expfileno] = \\$2\n@@ -287,8 +291,10 @@ BEGIN {\n /^Running / {\n   print_using=0\n   if (variant == curvar) {\n+    if (need_close) close(curfile)\n     curfile=\"${TMP}/list\"expfilesr[\\$2]\n     expfileseen[\\$2]=expfileseen[\\$2] + 1\n+    need_close=0\n     testname=\"00\"\n     next\n   }\n@@ -303,11 +309,12 @@ BEGIN {\n /^$/ { if (\"$MODE\" == \"sum\") next }\n { if (variant == curvar && curfile) {\n     if (\"$MODE\" == \"sum\") {\n-      printf \"%s %08d|\", testname, cnt > curfile\n+      printf \"%s %08d|\", testname, cnt >> curfile\n       cnt = cnt + 1\n     }\n     filewritten[curfile]=1\n-    print > curfile\n+    need_close=1\n+    print >> curfile\n   } else\n     next\n }"}]}