{"sha": "06e4f02a16465f976c9f1a179fd2c60fb76e9659", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDZlNGYwMmExNjQ2NWY5NzZjOWYxYTE3OWZkMmM2MGZiNzZlOTY1OQ==", "commit": {"author": {"name": "Paul Brook", "email": "pbrook@gcc.gnu.org", "date": "2004-10-04T15:33:18Z"}, "committer": {"name": "Paul Brook", "email": "pbrook@gcc.gnu.org", "date": "2004-10-04T15:33:18Z"}, "message": "re PR libfortran/17706 (reading a value of 0.0 gives a value of -0.0)\n\n2004-10-04  Paul Brook  <paul@codesourcery.com>\n\tBud Davis  <bdavis9659@comcast.net>\n\n\tPR fortran/17706\n\tPR fortran/16434\n\t* io/format.c (parse_format_list): Set repeat count for S, SP, SS,\n\tBN and BZ formats.\n\t* io/write.c (output_float): Don't output minus zero.\nlibgfortran/\n\t* gfortran/pr17706.f90: New test.\n\t* gfortran.dg/g77/f77-edit-s-out.f: Remove xfail.\n\nActually apply the patch this time.\n\nFrom-SVN: r88513", "tree": {"sha": "4114a0c97da613eea429829446e76db65fd5d026", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4114a0c97da613eea429829446e76db65fd5d026"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/06e4f02a16465f976c9f1a179fd2c60fb76e9659", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/06e4f02a16465f976c9f1a179fd2c60fb76e9659", "html_url": "https://github.com/Rust-GCC/gccrs/commit/06e4f02a16465f976c9f1a179fd2c60fb76e9659", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/06e4f02a16465f976c9f1a179fd2c60fb76e9659/comments", "author": null, "committer": null, "parents": [{"sha": "f3e41701124d2c5a838c28b99bbc4d8fd69e381e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f3e41701124d2c5a838c28b99bbc4d8fd69e381e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f3e41701124d2c5a838c28b99bbc4d8fd69e381e"}], "stats": {"total": 20, "additions": 17, "deletions": 3}, "files": [{"sha": "89a8df2caffd313a1f4ef8cdb1ebc568e23a4a04", "filename": "gcc/testsuite/gfortran.dg/g77/f77-edit-s-out.f", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06e4f02a16465f976c9f1a179fd2c60fb76e9659/gcc%2Ftestsuite%2Fgfortran.dg%2Fg77%2Ff77-edit-s-out.f", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06e4f02a16465f976c9f1a179fd2c60fb76e9659/gcc%2Ftestsuite%2Fgfortran.dg%2Fg77%2Ff77-edit-s-out.f", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fg77%2Ff77-edit-s-out.f?ref=06e4f02a16465f976c9f1a179fd2c60fb76e9659", "patch": "@@ -16,5 +16,5 @@\n       write(*,40) 0           ! { dg-output \" \\\\+0(\\n|\\r\\n|\\r)\" }\n C 15.5.9 - Note 5: When SP editing is in effect, the plus sign is not optional\n       write(*,50) 11          ! { dg-output \"\\\\*\\\\*(\\n|\\r\\n|\\r)\" }\n-C { dg-output \"\\$\" {xfail *-*-*} } gfortran PR 16434\n+C { dg-output \"\\$\" }\n       end"}, {"sha": "0e42810873ef0c946ee5fe783014318b07108a20", "filename": "libgfortran/io/format.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06e4f02a16465f976c9f1a179fd2c60fb76e9659/libgfortran%2Fio%2Fformat.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06e4f02a16465f976c9f1a179fd2c60fb76e9659/libgfortran%2Fio%2Fformat.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fformat.c?ref=06e4f02a16465f976c9f1a179fd2c60fb76e9659", "patch": "@@ -552,6 +552,7 @@ parse_format_list (void)\n     case FMT_BN:\n     case FMT_BZ:\n       get_fnode (&head, &tail, t);\n+      tail->repeat = 1;\n       goto between_desc;\n \n     case FMT_COLON:"}, {"sha": "f98ec1f1f36196203da9a6bbf89dd18db4b69537", "filename": "libgfortran/io/write.c", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06e4f02a16465f976c9f1a179fd2c60fb76e9659/libgfortran%2Fio%2Fwrite.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06e4f02a16465f976c9f1a179fd2c60fb76e9659/libgfortran%2Fio%2Fwrite.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fwrite.c?ref=06e4f02a16465f976c9f1a179fd2c60fb76e9659", "patch": "@@ -425,9 +425,12 @@ output_float (fnode *f, double value, int len)\n     }\n \n   /* Round the value.  */\n-  if (nbefore + nafter < ndigits && nbefore + nafter > 0)\n+  if (nbefore + nafter == 0)\n+    ndigits = 0;\n+  else if (nbefore + nafter < ndigits)\n     {\n-      i = nbefore + nafter;\n+      ndigits = nbefore + nafter;\n+      i = ndigits;\n       if (digits[i] >= '5')\n \t{\n \t  /* Propagate the carry.  */\n@@ -513,6 +516,16 @@ output_float (fnode *f, double value, int len)\n   if (out == NULL)\n     return;\n \n+  /* Zero values always output as positive, even if the value was negative\n+     before rounding.  */\n+  for (i = 0; i < ndigits; i++)\n+    {\n+      if (digits[i] != '0')\n+\tbreak;\n+    }\n+  if (i == ndigits)\n+    sign = calculate_sign (0);\n+\n   /* Work out how much padding is needed.  */\n   nblanks = w - (nbefore + nzero + nafter + edigits + 1);\n   if (sign != SIGN_NONE)"}]}