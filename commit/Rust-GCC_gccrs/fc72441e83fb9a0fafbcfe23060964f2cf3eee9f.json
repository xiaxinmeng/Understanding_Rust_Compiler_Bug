{"sha": "fc72441e83fb9a0fafbcfe23060964f2cf3eee9f", "node_id": "C_kwDOANBUbNoAKGZjNzI0NDFlODNmYjlhMGZhZmJjZmUyMzA2MDk2NGYyY2YzZWVlOWY", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2023-01-05T08:36:42Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2023-01-05T08:36:42Z"}, "message": "Merge #1709\n\n1709: Check const functions for mutable references r=CohenArthur a=dme2\n\nFixes #1552\n\nCo-authored-by: Dave <dme2223@gmail.com>", "tree": {"sha": "94c413486df42172df582f342e4186ebc2a7e748", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/94c413486df42172df582f342e4186ebc2a7e748"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fc72441e83fb9a0fafbcfe23060964f2cf3eee9f", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJjtowaCRBK7hj4Ov3rIwAAc6AIAJ6HDfnFj8NhyAJIw4WVx4LB\nKtmfnyXpBMvRCEVT/JCemh6h8ZIFKtlfgBAKoSjZ2vyaOBSXpAgnQOGYxGxS3tk8\ntmvuNxmGLPT7SAgdy6k4PNaGtzxo0DeXIVdAvB8Vr07rTF7+xvbBnw4GXDQgsvW/\nF0WDFLhe1jQkjh819QB8816HwXAz4T2cCzzo/wh2bZfv4jvsiigKNGhw80S9EcsU\nDTs5Ah+G2lrBN8Ksd2wqYx9bYFEAdRspxa05PlH4Fu9yvIcIGvu3dWfAhtlcC/9/\nXwtj4K4MZUeXTCqIdWLAppH4+BaRrMIUfckjhwqMO3PN/TXD7eWoEw5zo8I+sX8=\n=97k5\n-----END PGP SIGNATURE-----\n", "payload": "tree 94c413486df42172df582f342e4186ebc2a7e748\nparent 8742e54052355beaa18fef9242a87fe84de51adb\nparent 5918059fd3a28915546c08e0d3adbc62b9ca3977\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1672907802 +0000\ncommitter GitHub <noreply@github.com> 1672907802 +0000\n\nMerge #1709\n\n1709: Check const functions for mutable references r=CohenArthur a=dme2\n\nFixes #1552\n\nCo-authored-by: Dave <dme2223@gmail.com>\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fc72441e83fb9a0fafbcfe23060964f2cf3eee9f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fc72441e83fb9a0fafbcfe23060964f2cf3eee9f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fc72441e83fb9a0fafbcfe23060964f2cf3eee9f/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8742e54052355beaa18fef9242a87fe84de51adb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8742e54052355beaa18fef9242a87fe84de51adb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8742e54052355beaa18fef9242a87fe84de51adb"}, {"sha": "5918059fd3a28915546c08e0d3adbc62b9ca3977", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5918059fd3a28915546c08e0d3adbc62b9ca3977", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5918059fd3a28915546c08e0d3adbc62b9ca3977"}], "stats": {"total": 11, "additions": 9, "deletions": 2}, "files": [{"sha": "5f20437b7fcc334df5d1baed9f913f970be448a5", "filename": "gcc/rust/checks/errors/rust-const-checker.cc", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fc72441e83fb9a0fafbcfe23060964f2cf3eee9f/gcc%2Frust%2Fchecks%2Ferrors%2Frust-const-checker.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fc72441e83fb9a0fafbcfe23060964f2cf3eee9f/gcc%2Frust%2Fchecks%2Ferrors%2Frust-const-checker.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fchecks%2Ferrors%2Frust-const-checker.cc?ref=fc72441e83fb9a0fafbcfe23060964f2cf3eee9f", "patch": "@@ -898,8 +898,12 @@ ConstChecker::visit (RawPointerType &)\n {}\n \n void\n-ConstChecker::visit (ReferenceType &)\n-{}\n+ConstChecker::visit (ReferenceType &type)\n+{\n+  if (const_context.is_in_context () && type.is_mut ())\n+    rust_error_at (type.get_locus (),\n+\t\t   \"mutable references are not allowed in constant functions\");\n+}\n \n void\n ConstChecker::visit (ArrayType &type)"}, {"sha": "9ab82744fbd8af978f115535e331f5d9df49b412", "filename": "gcc/testsuite/rust/compile/const10.rs", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fc72441e83fb9a0fafbcfe23060964f2cf3eee9f/gcc%2Ftestsuite%2Frust%2Fcompile%2Fconst10.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fc72441e83fb9a0fafbcfe23060964f2cf3eee9f/gcc%2Ftestsuite%2Frust%2Fcompile%2Fconst10.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Fconst10.rs?ref=fc72441e83fb9a0fafbcfe23060964f2cf3eee9f", "patch": "@@ -0,0 +1,3 @@\n+const fn foo (a: &mut i32) { // { dg-error \"mutable references are not allowed in constant functions\" }\n+\t*a = 1;\n+}"}]}