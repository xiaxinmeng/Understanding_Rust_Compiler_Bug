{"sha": "335d03387408e2ce580e59ace0a593d7d9e1950d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzM1ZDAzMzg3NDA4ZTJjZTU4MGU1OWFjZTBhNTkzZDdkOWUxOTUwZA==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2018-03-24T17:37:21Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2018-03-24T17:37:21Z"}, "message": "re PR fortran/70068 (ICE: out of memory on involving empty substring)\n\n2018-03-24  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/70068\n\t* expr.c (find_substring_ref): Change types of start, end\n\tand length variables to gfc_charlen_t. Set length to zero\n\tfor empty substring.\n\n2018-03-24  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/70068\n\t* gfortran.dg/substr_7.f90: New test.\n\nFrom-SVN: r258835", "tree": {"sha": "658e0a2b9fedcc9dcd5671990949f4b417428c02", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/658e0a2b9fedcc9dcd5671990949f4b417428c02"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/335d03387408e2ce580e59ace0a593d7d9e1950d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/335d03387408e2ce580e59ace0a593d7d9e1950d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/335d03387408e2ce580e59ace0a593d7d9e1950d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/335d03387408e2ce580e59ace0a593d7d9e1950d/comments", "author": null, "committer": null, "parents": [{"sha": "ba77f7bad0f0898454cdef193a24a825cbc3f953", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba77f7bad0f0898454cdef193a24a825cbc3f953", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ba77f7bad0f0898454cdef193a24a825cbc3f953"}], "stats": {"total": 40, "additions": 34, "deletions": 6}, "files": [{"sha": "12348f1674d9372fc2065e01c54e9f6c9fc28eda", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/335d03387408e2ce580e59ace0a593d7d9e1950d/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/335d03387408e2ce580e59ace0a593d7d9e1950d/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=335d03387408e2ce580e59ace0a593d7d9e1950d", "patch": "@@ -1,3 +1,10 @@\n+2018-03-24  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/70068\n+\t* expr.c (find_substring_ref): Change types of start, end\n+\tand length variables to gfc_charlen_t. Set length to zero\n+\tfor empty substring.\n+\n 2018-03-24  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/42651"}, {"sha": "9e113d26a59311c85f5356c5eed46860217431f4", "filename": "gcc/fortran/expr.c", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/335d03387408e2ce580e59ace0a593d7d9e1950d/gcc%2Ffortran%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/335d03387408e2ce580e59ace0a593d7d9e1950d/gcc%2Ffortran%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fexpr.c?ref=335d03387408e2ce580e59ace0a593d7d9e1950d", "patch": "@@ -1662,9 +1662,9 @@ find_array_section (gfc_expr *expr, gfc_ref *ref)\n static bool\n find_substring_ref (gfc_expr *p, gfc_expr **newp)\n {\n-  int end;\n-  int start;\n-  int length;\n+  gfc_charlen_t end;\n+  gfc_charlen_t start;\n+  gfc_charlen_t length;\n   gfc_char_t *chr;\n \n   if (p->ref->u.ss.start->expr_type != EXPR_CONSTANT\n@@ -1674,9 +1674,12 @@ find_substring_ref (gfc_expr *p, gfc_expr **newp)\n   *newp = gfc_copy_expr (p);\n   free ((*newp)->value.character.string);\n \n-  end = (int) mpz_get_ui (p->ref->u.ss.end->value.integer);\n-  start = (int) mpz_get_ui (p->ref->u.ss.start->value.integer);\n-  length = end - start + 1;\n+  end = (gfc_charlen_t) mpz_get_ui (p->ref->u.ss.end->value.integer);\n+  start = (gfc_charlen_t) mpz_get_ui (p->ref->u.ss.start->value.integer);\n+  if (end >= start)\n+    length = end - start + 1;\n+  else\n+    length = 0;\n \n   chr = (*newp)->value.character.string = gfc_get_wide_string (length + 1);\n   (*newp)->value.character.length = length;"}, {"sha": "1e1f51566b84574ccc47682b9540f40c4b3650ad", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/335d03387408e2ce580e59ace0a593d7d9e1950d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/335d03387408e2ce580e59ace0a593d7d9e1950d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=335d03387408e2ce580e59ace0a593d7d9e1950d", "patch": "@@ -1,3 +1,8 @@\n+2018-03-24  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/70068\n+\t* gfortran.dg/substr_7.f90: New test.\n+\n 2018-03-24  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/42651"}, {"sha": "3d8f2e1bd55f3f3aff6e3ff54e49aef94fff020a", "filename": "gcc/testsuite/gfortran.dg/substr_7.f90", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/335d03387408e2ce580e59ace0a593d7d9e1950d/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubstr_7.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/335d03387408e2ce580e59ace0a593d7d9e1950d/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubstr_7.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubstr_7.f90?ref=335d03387408e2ce580e59ace0a593d7d9e1950d", "patch": "@@ -0,0 +1,13 @@\n+! { dg-do  run }\n+! PR 70068 - used to allocate too much memory\n+! Original test cases by Gerhard Steinmetz\n+program p\n+   integer :: i\n+   character(3), parameter :: x(3) = ['abc', 'ijk', 'xyz']\n+   character(3) :: y(2)\n+   character(99), parameter :: x2(2) = ' '\n+   character(99), parameter :: y2=x(2)(99:1)\n+   y = [(x(i)(i:1), i=2,3)]\n+   if (any(y /= '')) stop 1\n+   if (y2 /= '') stop 2\n+end"}]}