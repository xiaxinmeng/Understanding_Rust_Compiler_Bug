{"sha": "45c4d9193dd33013522ff7e7f8f90f77d20cb7be", "node_id": "C_kwDOANBUbNoAKDQ1YzRkOTE5M2RkMzMwMTM1MjJmZjdlN2Y4ZjkwZjc3ZDIwY2I3YmU", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2022-01-20T17:05:39Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2022-05-10T08:19:28Z"}, "message": "[Ada] Remove repeated conversions between Source_Ptr and Int\n\nBoth Source_Ptr and Int are integer types (and even happen to have equal\nranges). Their values can be calculated without converting\nback-and-forth, e.g.:\n\n  Int (Loc1) - Int (Loc2)\n\ncan be written simply as:\n\n  Int (Loc1 - Loc2)\n\nCode cleanup related to handling of references to unset objects.\nOffending occurrences found with various invocations of grep.\n\ngcc/ada/\n\n\t* par-ch10.adb, scng.adb, sem_res.adb, sinfo-utils.adb,\n\ttreepr.adb: Simplify calculations with Source_Ptr and Loc\n\tvalues.", "tree": {"sha": "8223f62aacf8b603688862ab8c2366dd91740f3f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8223f62aacf8b603688862ab8c2366dd91740f3f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/45c4d9193dd33013522ff7e7f8f90f77d20cb7be", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/45c4d9193dd33013522ff7e7f8f90f77d20cb7be", "html_url": "https://github.com/Rust-GCC/gccrs/commit/45c4d9193dd33013522ff7e7f8f90f77d20cb7be", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/45c4d9193dd33013522ff7e7f8f90f77d20cb7be/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ce63a97b518915b3b6c1221da60af719c7eccd5a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce63a97b518915b3b6c1221da60af719c7eccd5a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ce63a97b518915b3b6c1221da60af719c7eccd5a"}], "stats": {"total": 18, "additions": 7, "deletions": 11}, "files": [{"sha": "613be37fe751839192871b55ef0a1b7d0c8db66b", "filename": "gcc/ada/par-ch10.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/45c4d9193dd33013522ff7e7f8f90f77d20cb7be/gcc%2Fada%2Fpar-ch10.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/45c4d9193dd33013522ff7e7f8f90f77d20cb7be/gcc%2Fada%2Fpar-ch10.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fpar-ch10.adb?ref=45c4d9193dd33013522ff7e7f8f90f77d20cb7be", "patch": "@@ -1194,7 +1194,7 @@ package body Ch10 is\n       Write_Int (Int (Line));\n \n       Write_Str (\", file offset \");\n-      Write_Int (Int (Loc) - Int (Source_First (Sind)));\n+      Write_Int (Int (Loc - Source_First (Sind)));\n    end Unit_Location;\n \n end Ch10;"}, {"sha": "c50a41e94dc3237451f5a777399ab39ae31330e5", "filename": "gcc/ada/scng.adb", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/45c4d9193dd33013522ff7e7f8f90f77d20cb7be/gcc%2Fada%2Fscng.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/45c4d9193dd33013522ff7e7f8f90f77d20cb7be/gcc%2Fada%2Fscng.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fscng.adb?ref=45c4d9193dd33013522ff7e7f8f90f77d20cb7be", "patch": "@@ -130,11 +130,7 @@ package body Scng is\n \n    procedure Check_End_Of_Line is\n       Len : constant Int :=\n-              Int (Scan_Ptr) -\n-                Int (Current_Line_Start) -\n-                  Wide_Char_Byte_Count;\n-\n-   --  Start of processing for Check_End_Of_Line\n+              Int (Scan_Ptr - Current_Line_Start) - Wide_Char_Byte_Count;\n \n    begin\n       if Style_Check then"}, {"sha": "125366b49737f5dbfcb32ab77ae1df715d506164", "filename": "gcc/ada/sem_res.adb", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/45c4d9193dd33013522ff7e7f8f90f77d20cb7be/gcc%2Fada%2Fsem_res.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/45c4d9193dd33013522ff7e7f8f90f77d20cb7be/gcc%2Fada%2Fsem_res.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_res.adb?ref=45c4d9193dd33013522ff7e7f8f90f77d20cb7be", "patch": "@@ -11754,7 +11754,7 @@ package body Sem_Res is\n \n                   Error_Msg\n                     (\"literal out of range of type Standard.Character\",\n-                     Source_Ptr (Int (Loc) + J));\n+                     Loc + Source_Ptr (J));\n                   return;\n                end if;\n             end loop;\n@@ -11783,7 +11783,7 @@ package body Sem_Res is\n \n                   Error_Msg\n                     (\"literal out of range of type Standard.Wide_Character\",\n-                     Source_Ptr (Int (Loc) + J));\n+                     Loc + Source_Ptr (J));\n                   return;\n                end if;\n             end loop;"}, {"sha": "35288916b8aff58dffba26b1c52d9d78a1463b33", "filename": "gcc/ada/sinfo-utils.adb", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/45c4d9193dd33013522ff7e7f8f90f77d20cb7be/gcc%2Fada%2Fsinfo-utils.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/45c4d9193dd33013522ff7e7f8f90f77d20cb7be/gcc%2Fada%2Fsinfo-utils.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsinfo-utils.adb?ref=45c4d9193dd33013522ff7e7f8f90f77d20cb7be", "patch": "@@ -191,7 +191,7 @@ package body Sinfo.Utils is\n    function End_Location (N : Node_Id) return Source_Ptr is\n       L : constant Valid_Uint := End_Span (N);\n    begin\n-      return Source_Ptr (Int (Sloc (N)) + UI_To_Int (L));\n+      return Sloc (N) + Source_Ptr (UI_To_Int (L));\n    end End_Location;\n \n    --------------------\n@@ -214,7 +214,7 @@ package body Sinfo.Utils is\n    procedure Set_End_Location (N : Node_Id; S : Source_Ptr) is\n    begin\n       Set_End_Span (N,\n-        UI_From_Int (Int (S) - Int (Sloc (N))));\n+        UI_From_Int (Int (S - Sloc (N))));\n    end Set_End_Location;\n \n    --------------------------"}, {"sha": "3173668d82a7dbf636f578cf959a87a4d85b2d9e", "filename": "gcc/ada/treepr.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/45c4d9193dd33013522ff7e7f8f90f77d20cb7be/gcc%2Fada%2Ftreepr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/45c4d9193dd33013522ff7e7f8f90f77d20cb7be/gcc%2Fada%2Ftreepr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ftreepr.adb?ref=45c4d9193dd33013522ff7e7f8f90f77d20cb7be", "patch": "@@ -1229,7 +1229,7 @@ package body Treepr is\n \n          else\n             Sfile := Get_Source_File_Index (Sloc (N));\n-            Print_Int (Int (Sloc (N)) - Int (Source_Text (Sfile)'First));\n+            Print_Int (Int (Sloc (N) - Source_Text (Sfile)'First));\n             Write_Str (\"  \");\n             Write_Location (Sloc (N));\n          end if;"}]}