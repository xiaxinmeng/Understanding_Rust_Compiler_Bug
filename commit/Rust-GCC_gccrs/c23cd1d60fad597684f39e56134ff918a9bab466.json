{"sha": "c23cd1d60fad597684f39e56134ff918a9bab466", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzIzY2QxZDYwZmFkNTk3Njg0ZjM5ZTU2MTM0ZmY5MThhOWJhYjQ2Ng==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2010-01-29T12:14:47Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2010-01-29T12:14:47Z"}, "message": "re PR rtl-optimization/42889 (\"-fcompare-debug failure (length)\" with \"-O1 -fgcse\")\n\n\tPR rtl-optimization/42889\n\t* df.h (df_set_bb_dirty_nonlr): New prototype.\n\t* df-core.c (df_set_bb_dirty_nonlr): New function.\n\t* df-scan.c (df_insn_rescan): Call it instead of\n\tdf_set_bb_dirty for DEBUG_INSNs.\n\n\t* gcc.dg/pr42889.c: New test.\n\nFrom-SVN: r156344", "tree": {"sha": "099818190b187b032b4dfe2e1e0061d89697cfca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/099818190b187b032b4dfe2e1e0061d89697cfca"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c23cd1d60fad597684f39e56134ff918a9bab466", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c23cd1d60fad597684f39e56134ff918a9bab466", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c23cd1d60fad597684f39e56134ff918a9bab466", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c23cd1d60fad597684f39e56134ff918a9bab466/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "38bc76da3d0f12058f0fba2ee1d3dff17abb2dc7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38bc76da3d0f12058f0fba2ee1d3dff17abb2dc7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/38bc76da3d0f12058f0fba2ee1d3dff17abb2dc7"}], "stats": {"total": 56, "additions": 55, "deletions": 1}, "files": [{"sha": "5856b0ce06d6668703af775d244712753b882f9a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c23cd1d60fad597684f39e56134ff918a9bab466/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c23cd1d60fad597684f39e56134ff918a9bab466/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c23cd1d60fad597684f39e56134ff918a9bab466", "patch": "@@ -1,3 +1,11 @@\n+2010-01-29  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR rtl-optimization/42889\n+\t* df.h (df_set_bb_dirty_nonlr): New prototype.\n+\t* df-core.c (df_set_bb_dirty_nonlr): New function.\n+\t* df-scan.c (df_insn_rescan): Call it instead of\n+\tdf_set_bb_dirty for DEBUG_INSNs.\n+\n 2010-01-29  Richard Guenther  <rguenther@suse.de>\n \n \tPR middle-end/37448"}, {"sha": "cee00b9dafd6b51256897bdaea7a9ad48e8a7a89", "filename": "gcc/df-core.c", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c23cd1d60fad597684f39e56134ff918a9bab466/gcc%2Fdf-core.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c23cd1d60fad597684f39e56134ff918a9bab466/gcc%2Fdf-core.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdf-core.c?ref=c23cd1d60fad597684f39e56134ff918a9bab466", "patch": "@@ -1354,6 +1354,30 @@ df_set_bb_dirty (basic_block bb)\n }\n \n \n+/* Mark BB as needing it's transfer functions as being out of\n+   date, except for LR problem.  Used when analyzing DEBUG_INSNs,\n+   as LR problem can trigger DCE, and DEBUG_INSNs shouldn't ever\n+   shorten or enlarge lifetime of regs.  */\n+\n+void\n+df_set_bb_dirty_nonlr (basic_block bb)\n+{\n+  if (df)\n+    {\n+      int p;\n+      for (p = 1; p < df->num_problems_defined; p++)\n+\t{\n+\t  struct dataflow *dflow = df->problems_in_order[p];\n+\t  if (dflow == df_lr)\n+\t    continue;\n+\t  if (dflow->out_of_date_transfer_functions)\n+\t    bitmap_set_bit (dflow->out_of_date_transfer_functions, bb->index);\n+\t  dflow->solutions_dirty = true;\n+\t}\n+    }\n+}\n+\n+\n /* Clear the dirty bits.  This is called from places that delete\n    blocks.  */\n static void"}, {"sha": "c3a3dc70c8909696cc5fda54c18b14085d65e33f", "filename": "gcc/df-scan.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c23cd1d60fad597684f39e56134ff918a9bab466/gcc%2Fdf-scan.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c23cd1d60fad597684f39e56134ff918a9bab466/gcc%2Fdf-scan.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdf-scan.c?ref=c23cd1d60fad597684f39e56134ff918a9bab466", "patch": "@@ -1301,7 +1301,10 @@ df_insn_rescan (rtx insn)\n     }\n \n   df_refs_add_to_chains (&collection_rec, bb, insn);\n-  df_set_bb_dirty (bb);\n+  if (DEBUG_INSN_P (insn))\n+    df_set_bb_dirty_nonlr (bb);\n+  else\n+    df_set_bb_dirty (bb);\n \n   VEC_free (df_ref, stack, collection_rec.def_vec);\n   VEC_free (df_ref, stack, collection_rec.use_vec);"}, {"sha": "194cbcf26393c73d266f5a237666d63f9e2161be", "filename": "gcc/df.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c23cd1d60fad597684f39e56134ff918a9bab466/gcc%2Fdf.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c23cd1d60fad597684f39e56134ff918a9bab466/gcc%2Fdf.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdf.h?ref=c23cd1d60fad597684f39e56134ff918a9bab466", "patch": "@@ -912,6 +912,7 @@ extern void df_simple_dataflow (enum df_flow_dir, df_init_function,\n extern void df_mark_solutions_dirty (void);\n extern bool df_get_bb_dirty (basic_block);\n extern void df_set_bb_dirty (basic_block);\n+extern void df_set_bb_dirty_nonlr (basic_block);\n extern void df_compact_blocks (void);\n extern void df_bb_replace (int, basic_block);\n extern void df_bb_delete (int);"}, {"sha": "d7648a99becc2cadc5bad195a534c1369bdda63e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c23cd1d60fad597684f39e56134ff918a9bab466/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c23cd1d60fad597684f39e56134ff918a9bab466/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c23cd1d60fad597684f39e56134ff918a9bab466", "patch": "@@ -1,3 +1,8 @@\n+2010-01-29  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR rtl-optimization/42889\n+\t* gcc.dg/pr42889.c: New test.\n+\n 2010-01-28  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* gcc.target/i386/pr42881.c: Use SSE2."}, {"sha": "d3421736debec05ad43384ae825505618f80048e", "filename": "gcc/testsuite/gcc.dg/pr42889.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c23cd1d60fad597684f39e56134ff918a9bab466/gcc%2Ftestsuite%2Fgcc.dg%2Fpr42889.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c23cd1d60fad597684f39e56134ff918a9bab466/gcc%2Ftestsuite%2Fgcc.dg%2Fpr42889.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr42889.c?ref=c23cd1d60fad597684f39e56134ff918a9bab466", "patch": "@@ -0,0 +1,13 @@\n+/* PR rtl-optimization/42889 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O -fgcse -fcompare-debug\" } */\n+\n+extern int A[], B[];\n+\n+int\n+foo (int x, int c, int i)\n+{\n+  if (A[i] && B[i])\n+    x = x % ((c & 4) ? 8 : 4);\n+  return x;\n+}"}]}