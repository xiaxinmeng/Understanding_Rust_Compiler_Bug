{"sha": "4c1b27f961aadecf643d11f2e3e8abb89121fbfb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGMxYjI3Zjk2MWFhZGVjZjY0M2QxMWYyZTNlOGFiYjg5MTIxZmJmYg==", "commit": {"author": {"name": "Jeff Law", "email": "law@torsion.usersys.redhat.com", "date": "2020-05-17T17:20:39Z"}, "committer": {"name": "Jeff Law", "email": "law@torsion.usersys.redhat.com", "date": "2020-05-17T17:22:38Z"}, "message": "Use pc_or_label_operand to collapse a couple more patterns in preparation for the cc0->CC_REG transition.\n\n\t* config/h8300/predicates.md (pc_or_label_operand): New predicate.\n\t* config/h8300/jumpcall.md (branch_true, branch_false): Consolidate\n\tinto a single pattern using pc_or_label_operand.\n\t* config/h8300/combiner.md (bit branch patterns): Likewise.\n\t* config/h8300/peepholes.md (HImode and SImode branches): Likewise.", "tree": {"sha": "cacb8fdbb0d62fe6f422c42239ef26a6c9001a6b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cacb8fdbb0d62fe6f422c42239ef26a6c9001a6b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4c1b27f961aadecf643d11f2e3e8abb89121fbfb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4c1b27f961aadecf643d11f2e3e8abb89121fbfb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4c1b27f961aadecf643d11f2e3e8abb89121fbfb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4c1b27f961aadecf643d11f2e3e8abb89121fbfb/comments", "author": null, "committer": null, "parents": [{"sha": "266f44a91c0c9705d3d18e82d7c5bab32927a18f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/266f44a91c0c9705d3d18e82d7c5bab32927a18f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/266f44a91c0c9705d3d18e82d7c5bab32927a18f"}], "stats": {"total": 481, "additions": 236, "deletions": 245}, "files": [{"sha": "3a090452a969d5bbb249a6546bdc4837f0120792", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c1b27f961aadecf643d11f2e3e8abb89121fbfb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c1b27f961aadecf643d11f2e3e8abb89121fbfb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4c1b27f961aadecf643d11f2e3e8abb89121fbfb", "patch": "@@ -1,3 +1,11 @@\n+2020-05-17 Jeff Law  <law@redhat.com>\n+\n+\t* config/h8300/predicates.md (pc_or_label_operand): New predicate.\n+\t* config/h8300/jumpcall.md (branch_true, branch_false): Consolidate\n+\tinto a single pattern using pc_or_label_operand.\n+\t* config/h8300/combiner.md (bit branch patterns): Likewise.\n+\t* config/h8300/peepholes.md (HImode and SImode branches): Likewise.\n+\n 2020-05-17  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR target/95021"}, {"sha": "4f49c7fba3498d91cf73b1d9e27b5f884a71e93b", "filename": "gcc/config/h8300/combiner.md", "status": "modified", "additions": 10, "deletions": 12, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c1b27f961aadecf643d11f2e3e8abb89121fbfb/gcc%2Fconfig%2Fh8300%2Fcombiner.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c1b27f961aadecf643d11f2e3e8abb89121fbfb/gcc%2Fconfig%2Fh8300%2Fcombiner.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fh8300%2Fcombiner.md?ref=4c1b27f961aadecf643d11f2e3e8abb89121fbfb", "patch": "@@ -740,36 +740,34 @@\n \t\t\t\t\t   (const_int 1)\n \t\t\t\t\t   (const_int 7))\n \t\t\t  (const_int 0))\n-\t\t      (label_ref (match_operand 1 \"\" \"\"))\n-\t\t      (pc)))]\n-  \"\"\n+\t\t      (match_operand 1 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")))]\n+  \"operands[1] == pc_rtx || operands[2] == pc_rtx\"\n   \"#\"\n   \"\"\n   [(set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n \t(if_then_else (ge (cc0)\n \t\t\t  (const_int 0))\n-\t\t      (label_ref (match_dup 1))\n-\t\t      (pc)))]\n-  \"\")\n+\t\t      (match_dup 1)\n+\t\t      (match_dup 2)))])\n \n (define_insn_and_split \"\"\n   [(set (pc)\n \t(if_then_else (ne (zero_extract:SI (subreg:SI (match_operand:QI 0 \"register_operand\" \"\") 0)\n \t\t\t\t\t   (const_int 1)\n \t\t\t\t\t   (const_int 7))\n \t\t\t  (const_int 0))\n-\t\t      (label_ref (match_operand 1 \"\" \"\"))\n-\t\t      (pc)))]\n-  \"\"\n+\t\t      (match_operand 1 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")))]\n+  \"operands[1] == pc_rtx || operands[2] == pc_rtx\"\n   \"#\"\n   \"\"\n   [(set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n \t(if_then_else (lt (cc0)\n \t\t\t  (const_int 0))\n-\t\t      (label_ref (match_dup 1))\n-\t\t      (pc)))]\n-  \"\")\n+\t\t      (match_dup 1)\n+\t\t      (match_dup 2)))])"}, {"sha": "7208fb6d86b550a39efd16ca1da795177162b1ba", "filename": "gcc/config/h8300/jumpcall.md", "status": "modified", "additions": 25, "deletions": 41, "changes": 66, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c1b27f961aadecf643d11f2e3e8abb89121fbfb/gcc%2Fconfig%2Fh8300%2Fjumpcall.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c1b27f961aadecf643d11f2e3e8abb89121fbfb/gcc%2Fconfig%2Fh8300%2Fjumpcall.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fh8300%2Fjumpcall.md?ref=4c1b27f961aadecf643d11f2e3e8abb89121fbfb", "patch": "@@ -37,60 +37,44 @@\n     DONE;\n   })\n \n-(define_insn \"branch_true\"\n+(define_insn \"branch\"\n   [(set (pc)\n-\t(if_then_else (match_operator 1 \"comparison_operator\"\n+\t(if_then_else (match_operator 2 \"comparison_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 0 \"\" \"\"))\n-\t\t      (pc)))]\n-  \"\"\n+\t\t      (match_operand 0 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 1 \"pc_or_label_operand\" \"\")))]\n+  \"operands[0] == pc_rtx || operands[1] == pc_rtx\"\n {\n   if ((cc_status.flags & CC_OVERFLOW_UNUSABLE) != 0\n-      && (GET_CODE (operands[1]) == GT\n-\t  || GET_CODE (operands[1]) == GE\n-\t  || GET_CODE (operands[1]) == LE\n-\t  || GET_CODE (operands[1]) == LT))\n+      && (GET_CODE (operands[2]) == GT\n+\t  || GET_CODE (operands[2]) == GE\n+\t  || GET_CODE (operands[2]) == LE\n+\t  || GET_CODE (operands[2]) == LT))\n     {\n       cc_status.flags &= ~CC_OVERFLOW_UNUSABLE;\n       return 0;\n     }\n \n-  if (get_attr_length (insn) == 2)\n-    return \"b%j1\t%l0\";\n-  else if (get_attr_length (insn) == 4)\n-    return \"b%j1\t%l0:16\";\n-  else\n-    return \"b%k1\t.Lh8BR%=\\;jmp\t@%l0\\\\n.Lh8BR%=:\";\n-}\n- [(set_attr \"type\" \"branch\")\n-   (set_attr \"cc\" \"none\")])\n-\n-(define_insn \"branch_false\"\n-  [(set (pc)\n-\t(if_then_else (match_operator 1 \"comparison_operator\"\n-\t\t       [(cc0) (const_int 0)])\n-\t\t      (pc)\n-\t\t      (label_ref (match_operand 0 \"\" \"\"))))]\n-  \"\"\n-{\n-  if ((cc_status.flags & CC_OVERFLOW_UNUSABLE) != 0\n-      && (GET_CODE (operands[1]) == GT\n-\t  || GET_CODE (operands[1]) == GE\n-\t  || GET_CODE (operands[1]) == LE\n-\t  || GET_CODE (operands[1]) == LT))\n+  if (operands[0] != pc_rtx)\n     {\n-      cc_status.flags &= ~CC_OVERFLOW_UNUSABLE;\n-      return 0;\n+      if (get_attr_length (insn) == 2)\n+\treturn \"b%j2\t%l0\";\n+      else if (get_attr_length (insn) == 4)\n+\treturn \"b%j2\t%l0:16\";\n+      else\n+\treturn \"b%k2\t.Lh8BR%=\\;jmp\t@%l0\\\\n.Lh8BR%=:\";\n     }\n-\n-  if (get_attr_length (insn) == 2)\n-    return \"b%k1\t%l0\";\n-  else if (get_attr_length (insn) == 4)\n-    return \"b%k1\t%l0:16\";\n   else\n-    return \"b%j1\t.Lh8BR%=\\;jmp\t@%l0\\\\n.Lh8BR%=:\";\n+    {\n+      if (get_attr_length (insn) == 2)\n+\treturn \"b%k2\t%l1\";\n+      else if (get_attr_length (insn) == 4)\n+\treturn \"b%k2\t%l1:16\";\n+      else\n+\treturn \"b%j2\t.Lh8BR%=\\;jmp\t@%l1\\\\n.Lh8BR%=:\";\n+    }\n }\n-  [(set_attr \"type\" \"branch\")\n+ [(set_attr \"type\" \"branch\")\n    (set_attr \"cc\" \"none\")])\n \n (define_insn \"*brabc\""}, {"sha": "8442cd80a5e8be92b1e1418f5af9b04bf405df5f", "filename": "gcc/config/h8300/peepholes.md", "status": "modified", "additions": 187, "deletions": 192, "changes": 379, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c1b27f961aadecf643d11f2e3e8abb89121fbfb/gcc%2Fconfig%2Fh8300%2Fpeepholes.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c1b27f961aadecf643d11f2e3e8abb89121fbfb/gcc%2Fconfig%2Fh8300%2Fpeepholes.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fh8300%2Fpeepholes.md?ref=4c1b27f961aadecf643d11f2e3e8abb89121fbfb", "patch": "@@ -367,10 +367,10 @@\n    (set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_operator 3 \"eqne_operator\"\n+\t(if_then_else (match_operator 4 \"eqne_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 2 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"\"\n   [(set (match_operand:HI 0 \"register_operand\" \"\")\n \t(unspec:HI [(match_dup 0)\n@@ -379,10 +379,9 @@\n    (set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_op_dup 3 [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_dup 2))\n-\t\t      (pc)))]\n-  \"\")\n+\t(if_then_else (match_op_dup 4 [(cc0) (const_int 0)])\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))])\n \n ;; The SImode version of the previous pattern.\n \n@@ -393,10 +392,10 @@\n    (set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_operator 3 \"eqne_operator\"\n+\t(if_then_else (match_operator 4 \"eqne_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 2 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"\"\n   [(set (match_operand:SI 0 \"register_operand\" \"\")\n \t(unspec:SI [(match_dup 0)\n@@ -405,10 +404,9 @@\n    (set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_op_dup 3 [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_dup 2))\n-\t\t      (pc)))]\n-  \"\")\n+\t(if_then_else (match_op_dup 4 [(cc0) (const_int 0)])\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))])\n \n (define_peephole2\n   [(parallel [(set (cc0)\n@@ -418,19 +416,19 @@\n \t\t\t    (const_int 0)))\n \t      (clobber (scratch:QI))])\n    (set (pc)\n-\t(if_then_else (match_operator 1 \"eqne_operator\"\n+\t(if_then_else (match_operator 4 \"eqne_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 2 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"\"\n   [(set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_op_dup 3 [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_dup 2))\n-\t\t      (pc)))]\n+\t(if_then_else (match_op_dup 4 [(cc0) (const_int 0)])\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n-    operands[3] = ((GET_CODE (operands[1]) == EQ)\n+    operands[4] = ((GET_CODE (operands[4]) == EQ)\n \t\t   ? gen_rtx_GE (VOIDmode, cc0_rtx, const0_rtx)\n \t\t   : gen_rtx_LT (VOIDmode, cc0_rtx, const0_rtx));\n   })\n@@ -598,23 +596,23 @@\n \t(compare (match_operand:HI 0 \"register_operand\" \"\")\n \t\t (match_operand:HI 1 \"incdec_operand\" \"\")))\n    (set (pc)\n-\t(if_then_else (match_operator 3 \"eqne_operator\"\n+\t(if_then_else (match_operator 4 \"eqne_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 2 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"INTVAL (operands[1]) != 0 && peep2_reg_dead_p (1, operands[0])\"\n   [(set (match_dup 0)\n \t(unspec:HI [(match_dup 0)\n-\t\t    (match_dup 4)]\n+\t\t    (match_dup 5)]\n \t\t   UNSPEC_INCDEC))\n    (set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_op_dup 3 [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_dup 2))\n-\t\t      (pc)))]\n+\t(if_then_else (match_op_dup 4 [(cc0) (const_int 0)])\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n-    operands[4] = GEN_INT (- INTVAL (operands[1]));\n+    operands[5] = GEN_INT (- INTVAL (operands[1]));\n   })\n \n ;; Transform\n@@ -632,25 +630,25 @@\n \t(compare (match_operand:HI 0 \"register_operand\" \"\")\n \t\t (match_operand:HI 1 \"const_int_operand\" \"\")))\n    (set (pc)\n-\t(if_then_else (match_operator 2 \"gtle_operator\"\n+\t(if_then_else (match_operator 4 \"gtle_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 3 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"peep2_reg_dead_p (1, operands[0])\n    && (INTVAL (operands[1]) == 1\n        || (TARGET_H8300S && INTVAL (operands[1]) == 3))\"\n   [(parallel [(set (match_dup 0)\n \t\t   (ashiftrt:HI (match_dup 0)\n-\t\t\t\t(match_dup 4)))\n+\t\t\t\t(match_dup 5)))\n \t      (clobber (scratch:QI))])\n    (set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_dup 2)\n-\t\t      (label_ref (match_dup 3))\n-\t\t      (pc)))]\n+\t(if_then_else (match_dup 4)\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n-    operands[4] = GEN_INT (exact_log2 (INTVAL (operands[1]) + 1));\n+    operands[5] = GEN_INT (exact_log2 (INTVAL (operands[1]) + 1));\n   })\n \n ;; Transform\n@@ -668,26 +666,26 @@\n \t(compare (match_operand:HI 0 \"register_operand\" \"\")\n \t\t (match_operand:HI 1 \"const_int_operand\" \"\")))\n    (set (pc)\n-\t(if_then_else (match_operator 2 \"gtuleu_operator\"\n+\t(if_then_else (match_operator 4 \"gtuleu_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 3 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"peep2_reg_dead_p (1, operands[0])\n    && (INTVAL (operands[1]) == 1\n        || (TARGET_H8300S && INTVAL (operands[1]) == 3))\"\n   [(parallel [(set (match_dup 0)\n \t\t   (ashiftrt:HI (match_dup 0)\n-\t\t\t\t(match_dup 4)))\n+\t\t\t\t(match_dup 5)))\n \t      (clobber (scratch:QI))])\n    (set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_dup 5)\n-\t\t      (label_ref (match_dup 3))\n-\t\t      (pc)))]\n+\t(if_then_else (match_dup 6)\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n-    operands[4] = GEN_INT (exact_log2 (INTVAL (operands[1]) + 1));\n-    operands[5] = gen_rtx_fmt_ee (GET_CODE (operands[2]) == GTU ? NE : EQ,\n+    operands[5] = GEN_INT (exact_log2 (INTVAL (operands[1]) + 1));\n+    operands[6] = gen_rtx_fmt_ee (GET_CODE (operands[4]) == GTU ? NE : EQ,\n \t\t\t\t  VOIDmode, cc0_rtx, const0_rtx);\n   })\n \n@@ -708,17 +706,16 @@\n    (set (pc)\n \t(if_then_else (match_operator 1 \"gtle_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 2 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"\"\n   [(set (cc0) (compare (and:HI (match_dup 0)\n \t\t\t       (const_int -256))\n \t\t       (const_int 0)))\n    (set (pc)\n \t(if_then_else (match_dup 1)\n-\t\t      (label_ref (match_dup 2))\n-\t\t      (pc)))]\n-  \"\")\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))])\n \n ;; Transform\n ;;\n@@ -737,18 +734,18 @@\n    (set (pc)\n \t(if_then_else (match_operator 1 \"gtuleu_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 2 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"\"\n   [(set (cc0) (compare (and:HI (match_dup 0)\n \t\t\t       (const_int -256))\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_dup 3)\n-\t\t      (label_ref (match_dup 2))\n-\t\t      (pc)))]\n+\t(if_then_else (match_dup 4)\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n-    operands[3] = gen_rtx_fmt_ee (GET_CODE (operands[1]) == GTU ? NE : EQ,\n+    operands[4] = gen_rtx_fmt_ee (GET_CODE (operands[1]) == GTU ? NE : EQ,\n \t\t\t\t  VOIDmode, cc0_rtx, const0_rtx);\n   })\n \n@@ -829,23 +826,23 @@\n \t(compare (match_operand:SI 0 \"register_operand\" \"\")\n \t\t (match_operand:SI 1 \"incdec_operand\" \"\")))\n    (set (pc)\n-\t(if_then_else (match_operator 3 \"eqne_operator\"\n+\t(if_then_else (match_operator 4 \"eqne_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 2 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"INTVAL (operands[1]) != 0 && peep2_reg_dead_p (1, operands[0])\"\n   [(set (match_dup 0)\n \t(unspec:SI [(match_dup 0)\n-\t\t    (match_dup 4)]\n+\t\t    (match_dup 5)]\n \t\t   UNSPEC_INCDEC))\n    (set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_op_dup 3 [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_dup 2))\n-\t\t      (pc)))]\n+\t(if_then_else (match_op_dup 4 [(cc0) (const_int 0)])\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n-    operands[4] = GEN_INT (- INTVAL (operands[1]));\n+    operands[5] = GEN_INT (- INTVAL (operands[1]));\n   })\n \n ;; Transform\n@@ -863,26 +860,26 @@\n \t(compare (match_operand:SI 0 \"register_operand\" \"\")\n \t\t (match_operand:SI 1 \"const_int_operand\" \"\")))\n    (set (pc)\n-\t(if_then_else (match_operator 3 \"eqne_operator\"\n+\t(if_then_else (match_operator 4 \"eqne_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 2 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"peep2_reg_dead_p (1, operands[0])\n    && (INTVAL (operands[1]) == -131072\n        || INTVAL (operands[1]) == -65536\n        || INTVAL (operands[1]) == 65536\n        || INTVAL (operands[1]) == 131072)\"\n   [(set (match_dup 0)\n \t(plus:SI (match_dup 0)\n-\t\t (match_dup 4)))\n+\t\t (match_dup 5)))\n    (set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_op_dup 3 [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_dup 2))\n-\t\t      (pc)))]\n+\t(if_then_else (match_op_dup 4 [(cc0) (const_int 0)])\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n-    operands[4] = GEN_INT (- INTVAL (operands[1]));\n+    operands[5] = GEN_INT (- INTVAL (operands[1]));\n   })\n \n ;; Transform\n@@ -901,10 +898,10 @@\n \t(compare (match_operand:SI 0 \"register_operand\" \"\")\n \t\t (match_operand:SI 1 \"const_int_operand\" \"\")))\n    (set (pc)\n-\t(if_then_else (match_operator 3 \"eqne_operator\"\n+\t(if_then_else (match_operator 4 \"eqne_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 2 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"peep2_reg_dead_p (1, operands[0])\n    && ((INTVAL (operands[1]) & 0x00ff) == INTVAL (operands[1])\n        || (INTVAL (operands[1]) & 0xff00) == INTVAL (operands[1])\n@@ -918,10 +915,9 @@\n    (set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_op_dup 3 [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_dup 2))\n-\t\t      (pc)))]\n-  \"\")\n+\t(if_then_else (match_op_dup 4 [(cc0) (const_int 0)])\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))])\n \n ;; Transform\n ;;\n@@ -939,28 +935,28 @@\n \t(compare (match_operand:SI 0 \"register_operand\" \"\")\n \t\t (match_operand:SI 1 \"const_int_operand\" \"\")))\n    (set (pc)\n-\t(if_then_else (match_operator 3 \"eqne_operator\"\n+\t(if_then_else (match_operator 4 \"eqne_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 2 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"peep2_reg_dead_p (1, operands[0])\n    && ((INTVAL (operands[1]) | 0x00ff) == -1\n        || (INTVAL (operands[1]) | 0xff00) == -1)\n    && INTVAL (operands[1]) != -1\n    && INTVAL (operands[1]) != -2\"\n   [(set (match_dup 0)\n \t(xor:SI (match_dup 0)\n-\t\t(match_dup 4)))\n+\t\t(match_dup 5)))\n    (set (match_dup 0)\n \t(not:SI (match_dup 0)))\n    (set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_op_dup 3 [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_dup 2))\n-\t\t      (pc)))]\n+\t(if_then_else (match_op_dup 4 [(cc0) (const_int 0)])\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n-    operands[4] = GEN_INT (INTVAL (operands[1]) ^ -1);\n+    operands[5] = GEN_INT (INTVAL (operands[1]) ^ -1);\n   })\n \n ;; Transform\n@@ -979,28 +975,28 @@\n \t(compare (match_operand:SI 0 \"register_operand\" \"\")\n \t\t (match_operand:SI 1 \"const_int_operand\" \"\")))\n    (set (pc)\n-\t(if_then_else (match_operator 3 \"eqne_operator\"\n+\t(if_then_else (match_operator 4 \"eqne_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 2 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"peep2_reg_dead_p (1, operands[0])\n    && (INTVAL (operands[1]) == -2147483647 - 1\n        || (TARGET_H8300S && INTVAL (operands[1]) == 1073741824))\"\n   [(set (match_dup 0)\n \t(rotate:SI (match_dup 0)\n-\t\t   (match_dup 4)))\n+\t\t   (match_dup 5)))\n    (set (match_dup 0)\n \t(unspec:SI [(match_dup 0)\n \t\t    (const_int -1)]\n \t\t   UNSPEC_INCDEC))\n    (set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_op_dup 3 [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_dup 2))\n-\t\t      (pc)))]\n+\t(if_then_else (match_op_dup 4 [(cc0) (const_int 0)])\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n-    operands[4] = GEN_INT (INTVAL (operands[1]) == -2147483647 - 1 ? 1 : 2);\n+    operands[5] = GEN_INT (INTVAL (operands[1]) == -2147483647 - 1 ? 1 : 2);\n   })\n \n ;; Transform\n@@ -1018,33 +1014,33 @@\n ;; same compare insn immediately before this one.\n \n (define_peephole2\n-  [(match_scratch:SI 4 \"r\")\n+  [(match_scratch:SI 5 \"r\")\n    (set (cc0)\n \t(compare (match_operand:SI 0 \"register_operand\" \"\")\n \t\t (match_operand:SI 1 \"const_int_operand\" \"\")))\n    (set (pc)\n-\t(if_then_else (match_operator 2 \"gtle_operator\"\n+\t(if_then_else (match_operator 4 \"gtle_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 3 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"!peep2_reg_dead_p (1, operands[0])\n    && (INTVAL (operands[1]) == 1\n        || (TARGET_H8300S && INTVAL (operands[1]) == 3))\n    && !same_cmp_preceding_p (insn)\"\n-  [(set (match_dup 4)\n+  [(set (match_dup 5)\n \t(match_dup 0))\n-   (parallel [(set (match_dup 4)\n-\t\t   (ashiftrt:SI (match_dup 4)\n-\t\t\t\t(match_dup 5)))\n+   (parallel [(set (match_dup 5)\n+\t\t   (ashiftrt:SI (match_dup 5)\n+\t\t\t\t(match_dup 6)))\n \t      (clobber (scratch:QI))])\n-   (set (cc0) (compare (match_dup 4)\n+   (set (cc0) (compare (match_dup 5)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_dup 2)\n-\t\t      (label_ref (match_dup 3))\n-\t\t      (pc)))]\n+\t(if_then_else (match_dup 4)\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n-    operands[5] = GEN_INT (exact_log2 (INTVAL (operands[1]) + 1));\n+    operands[6] = GEN_INT (exact_log2 (INTVAL (operands[1]) + 1));\n   })\n \n ;; Transform\n@@ -1062,34 +1058,34 @@\n ;; same compare insn immediately before this one.\n \n (define_peephole2\n-  [(match_scratch:SI 4 \"r\")\n+  [(match_scratch:SI 5 \"r\")\n    (set (cc0)\n \t(compare (match_operand:SI 0 \"register_operand\" \"\")\n \t\t (match_operand:SI 1 \"const_int_operand\" \"\")))\n    (set (pc)\n-\t(if_then_else (match_operator 2 \"gtuleu_operator\"\n+\t(if_then_else (match_operator 4 \"gtuleu_operator\"\n \t\t         [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 3 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"!peep2_reg_dead_p (1, operands[0])\n    && (INTVAL (operands[1]) == 1\n        || (TARGET_H8300S && INTVAL (operands[1]) == 3))\n    && !same_cmp_preceding_p (insn)\"\n-  [(set (match_dup 4)\n+  [(set (match_dup 5)\n \t(match_dup 0))\n-   (parallel [(set (match_dup 4)\n-\t\t   (ashiftrt:SI (match_dup 4)\n-\t\t\t\t(match_dup 5)))\n+   (parallel [(set (match_dup 5)\n+\t\t   (ashiftrt:SI (match_dup 5)\n+\t\t\t\t(match_dup 6)))\n \t      (clobber (scratch:QI))])\n-   (set (cc0) (compare (match_dup 4)\n+   (set (cc0) (compare (match_dup 5)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_dup 6)\n-\t\t      (label_ref (match_dup 3))\n-\t\t      (pc)))]\n+\t(if_then_else (match_dup 7)\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n-    operands[5] = GEN_INT (exact_log2 (INTVAL (operands[1]) + 1));\n-    operands[6] = gen_rtx_fmt_ee (GET_CODE (operands[2]) == GTU ? NE : EQ,\n+    operands[6] = GEN_INT (exact_log2 (INTVAL (operands[1]) + 1));\n+    operands[7] = gen_rtx_fmt_ee (GET_CODE (operands[4]) == GTU ? NE : EQ,\n \t\t\t\t  VOIDmode, cc0_rtx, const0_rtx);\n   })\n \n@@ -1108,25 +1104,25 @@\n \t(compare (match_operand:SI 0 \"register_operand\" \"\")\n \t\t (match_operand:SI 1 \"const_int_operand\" \"\")))\n    (set (pc)\n-\t(if_then_else (match_operator 2 \"gtle_operator\"\n+\t(if_then_else (match_operator 4 \"gtle_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 3 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"peep2_reg_dead_p (1, operands[0])\n    && (INTVAL (operands[1]) == 1\n        || (TARGET_H8300S && INTVAL (operands[1]) == 3))\"\n   [(parallel [(set (match_dup 0)\n \t\t   (ashiftrt:SI (match_dup 0)\n-\t\t\t\t(match_dup 4)))\n+\t\t\t\t(match_dup 5)))\n \t      (clobber (scratch:QI))])\n    (set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_dup 2)\n-\t\t      (label_ref (match_dup 3))\n-\t\t      (pc)))]\n+\t(if_then_else (match_dup 4)\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n-    operands[4] = GEN_INT (exact_log2 (INTVAL (operands[1]) + 1));\n+    operands[5] = GEN_INT (exact_log2 (INTVAL (operands[1]) + 1));\n   })\n \n ;; Transform\n@@ -1144,26 +1140,26 @@\n \t(compare (match_operand:SI 0 \"register_operand\" \"\")\n \t\t (match_operand:SI 1 \"const_int_operand\" \"\")))\n    (set (pc)\n-\t(if_then_else (match_operator 2 \"gtuleu_operator\"\n+\t(if_then_else (match_operator 4 \"gtuleu_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 3 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"peep2_reg_dead_p (1, operands[0])\n    && (INTVAL (operands[1]) == 1\n        || (TARGET_H8300S && INTVAL (operands[1]) == 3))\"\n   [(parallel [(set (match_dup 0)\n \t\t   (ashiftrt:SI (match_dup 0)\n-\t\t\t\t(match_dup 4)))\n+\t\t\t\t(match_dup 5)))\n \t      (clobber (scratch:QI))])\n    (set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_dup 5)\n-\t\t      (label_ref (match_dup 3))\n-\t\t      (pc)))]\n+\t(if_then_else (match_dup 6)\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n-    operands[4] = GEN_INT (exact_log2 (INTVAL (operands[1]) + 1));\n-    operands[5] = gen_rtx_fmt_ee (GET_CODE (operands[2]) == GTU ? NE : EQ,\n+    operands[5] = GEN_INT (exact_log2 (INTVAL (operands[1]) + 1));\n+    operands[6] = gen_rtx_fmt_ee (GET_CODE (operands[4]) == GTU ? NE : EQ,\n \t\t\t\t  VOIDmode, cc0_rtx, const0_rtx);\n   })\n \n@@ -1183,10 +1179,10 @@\n \t(compare (match_operand:SI 0 \"register_operand\" \"\")\n \t\t (match_operand:SI 1 \"const_int_operand\" \"\")))\n    (set (pc)\n-\t(if_then_else (match_operator 2 \"gtle_operator\"\n+\t(if_then_else (match_operator 4 \"gtle_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 3 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"peep2_reg_dead_p (1, operands[0])\n    && (INTVAL (operands[1]) == 3\n        || INTVAL (operands[1]) == 7\n@@ -1197,15 +1193,15 @@\n        || INTVAL (operands[1]) == 255)\"\n   [(set (match_dup 0)\n \t(and:SI (match_dup 0)\n-\t\t(match_dup 4)))\n+\t\t(match_dup 5)))\n    (set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_dup 2)\n-\t\t      (label_ref (match_dup 3))\n-\t\t      (pc)))]\n+\t(if_then_else (match_dup 4)\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n-    operands[4] = GEN_INT (~INTVAL (operands[1]));\n+    operands[5] = GEN_INT (~INTVAL (operands[1]));\n   })\n \n ;; Transform\n@@ -1224,10 +1220,10 @@\n \t(compare (match_operand:SI 0 \"register_operand\" \"\")\n \t\t (match_operand:SI 1 \"const_int_operand\" \"\")))\n    (set (pc)\n-\t(if_then_else (match_operator 2 \"gtuleu_operator\"\n+\t(if_then_else (match_operator 4 \"gtuleu_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 3 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"peep2_reg_dead_p (1, operands[0])\n    && ((TARGET_H8300H && INTVAL (operands[1]) == 3)\n \t|| INTVAL (operands[1]) == 7\n@@ -1238,16 +1234,16 @@\n \t|| INTVAL (operands[1]) == 255)\"\n   [(set (match_dup 0)\n \t(and:SI (match_dup 0)\n-\t\t(match_dup 4)))\n+\t\t(match_dup 5)))\n    (set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_dup 5)\n-\t\t      (label_ref (match_dup 3))\n-\t\t      (pc)))]\n+\t(if_then_else (match_dup 6)\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n-    operands[4] = GEN_INT (~INTVAL (operands[1]));\n-    operands[5] = gen_rtx_fmt_ee (GET_CODE (operands[2]) == GTU ? NE : EQ,\n+    operands[5] = GEN_INT (~INTVAL (operands[1]));\n+    operands[6] = gen_rtx_fmt_ee (GET_CODE (operands[4]) == GTU ? NE : EQ,\n \t\t\t\t  VOIDmode, cc0_rtx, const0_rtx);\n   })\n \n@@ -1268,17 +1264,16 @@\n    (set (pc)\n \t(if_then_else (match_operator 1 \"gtle_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 2 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"\"\n   [(set (cc0) (compare (and:SI (match_dup 0)\n \t\t\t       (const_int -65536))\n \t\t       (const_int 0)))\n    (set (pc)\n \t(if_then_else (match_dup 1)\n-\t\t      (label_ref (match_dup 2))\n-\t\t      (pc)))]\n-  \"\")\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))])\n \n ;; Transform\n ;;\n@@ -1297,18 +1292,18 @@\n    (set (pc)\n \t(if_then_else (match_operator 1 \"gtuleu_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 2 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"\"\n   [(set (cc0) (compare (and:SI (match_dup 0)\n \t\t\t       (const_int -65536))\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_dup 3)\n-\t\t      (label_ref (match_dup 2))\n-\t\t      (pc)))]\n+\t(if_then_else (match_dup 4)\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n-    operands[3] = gen_rtx_fmt_ee (GET_CODE (operands[1]) == GTU ? NE : EQ,\n+    operands[4] = gen_rtx_fmt_ee (GET_CODE (operands[1]) == GTU ? NE : EQ,\n \t\t\t\t  VOIDmode, cc0_rtx, const0_rtx);\n   })\n \n@@ -1327,32 +1322,32 @@\n ;; same compare insn.\n \n (define_peephole2\n-  [(match_scratch:SI 4 \"r\")\n+  [(match_scratch:SI 5 \"r\")\n    (set (cc0)\n \t(compare (match_operand:SI 0 \"register_operand\" \"\")\n \t\t (match_operand:SI 1 \"incdec_operand\" \"\")))\n    (set (pc)\n-\t(if_then_else (match_operator 3 \"eqne_operator\"\n+\t(if_then_else (match_operator 4 \"eqne_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 2 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"INTVAL (operands[1]) != 0\n    && !peep2_reg_dead_p (1, operands[0])\n    && !same_cmp_following_p (insn)\"\n-  [(set (match_dup 4)\n+  [(set (match_dup 5)\n \t(match_dup 0))\n-   (set (match_dup 4)\n-\t(unspec:SI [(match_dup 4)\n-\t\t    (match_dup 5)]\n+   (set (match_dup 5)\n+\t(unspec:SI [(match_dup 5)\n+\t\t    (match_dup 6)]\n \t\t   UNSPEC_INCDEC))\n-   (set (cc0) (compare (match_dup 4)\n+   (set (cc0) (compare (match_dup 5)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_op_dup 3 [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_dup 2))\n-\t\t      (pc)))]\n+\t(if_then_else (match_op_dup 4 [(cc0) (const_int 0)])\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n-    operands[5] = GEN_INT (- INTVAL (operands[1]));\n+    operands[6] = GEN_INT (- INTVAL (operands[1]));\n   })\n \n ;; Narrow the mode of testing if possible.\n@@ -1364,28 +1359,28 @@\n    (set (cc0) (compare (match_dup 0)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_operator 3 \"eqne_operator\"\n+\t(if_then_else (match_operator 4 \"eqne_operator\"\n \t\t       [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_operand 2 \"\" \"\"))\n-\t\t      (pc)))]\n+\t\t      (match_operand 2 \"pc_or_label_operand\" \"\")\n+\t\t      (match_operand 3 \"pc_or_label_operand\" \"\")))]\n   \"((const_int_qi_operand (operands[1], QImode)\n      || (GET_MODE (operands[0]) == SImode\n \t && const_int_hi_operand (operands[1], HImode)))\n     && peep2_reg_dead_p (2, operands[0]))\"\n-  [(set (match_dup 4) (match_dup 6))\n-   (set (cc0) (compare (match_dup 4)\n+  [(set (match_dup 5) (match_dup 7))\n+   (set (cc0) (compare (match_dup 5)\n \t\t       (const_int 0)))\n    (set (pc)\n-\t(if_then_else (match_op_dup 3 [(cc0) (const_int 0)])\n-\t\t      (label_ref (match_dup 2))\n-\t\t      (pc)))]\n+\t(if_then_else (match_op_dup 4 [(cc0) (const_int 0)])\n+\t\t      (match_dup 2)\n+\t\t      (match_dup 3)))]\n   {\n     enum machine_mode mode;\n \n     mode = const_int_qi_operand (operands[1], QImode) ? QImode : HImode;\n-    operands[4] = gen_rtx_REG (mode, REGNO (operands[0]));\n-    operands[5] = gen_int_mode (INTVAL (operands[1]), mode);\n-    operands[6] = gen_rtx_AND (mode, operands[4], operands[5]);\n+    operands[5] = gen_rtx_REG (mode, REGNO (operands[0]));\n+    operands[6] = gen_int_mode (INTVAL (operands[1]), mode);\n+    operands[7] = gen_rtx_AND (mode, operands[5], operands[6]);\n   })\n \n ;; These triggers right at the end of allocation of locals in the"}, {"sha": "b530c2cb23ebc297bb64ed3314b15ed1d38a39dc", "filename": "gcc/config/h8300/predicates.md", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c1b27f961aadecf643d11f2e3e8abb89121fbfb/gcc%2Fconfig%2Fh8300%2Fpredicates.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c1b27f961aadecf643d11f2e3e8abb89121fbfb/gcc%2Fconfig%2Fh8300%2Fpredicates.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fh8300%2Fpredicates.md?ref=4c1b27f961aadecf643d11f2e3e8abb89121fbfb", "patch": "@@ -495,3 +495,9 @@\n \n   return (code == IOR || code == XOR);\n })\n+\n+;; Used to detect valid targets for conditional branches\n+;; Used to detect (pc) or (label_ref) in some jumping patterns\n+(define_predicate \"pc_or_label_operand\"\n+  (match_code \"pc,label_ref\"))\n+"}]}