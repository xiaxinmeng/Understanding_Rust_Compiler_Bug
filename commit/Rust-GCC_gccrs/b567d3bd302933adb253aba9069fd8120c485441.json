{"sha": "b567d3bd302933adb253aba9069fd8120c485441", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjU2N2QzYmQzMDI5MzNhZGIyNTNhYmE5MDY5ZmQ4MTIwYzQ4NTQ0MQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-09-02T10:18:46Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-09-02T10:18:46Z"}, "message": "fortran: Fix o'...' boz to integer/real conversions [PR96859]\n\nThe standard says that excess digits from boz are truncated.\nFor hexadecimal or binary, the routines copy just the number of digits\nthat will be needed, but for octal we copy number of digits that\ncontain one extra bit (for 8-bit, 32-bit or 128-bit, i.e. kind 1, 4 and 16)\nor two extra bits (for 16-bit or 64-bit, i.e. kind 2 and 8).\nThe clearing of the first bit is done correctly by changing the first digit\nif it is 4-7 to one smaller by 4 (i.e. modulo 4).\nThe clearing of the first two bits is done by changing 4 or 6 to 0\nand 5 or 7 to 1, which is incorrect, because we really want to change the\nfirst digit to 0 if it was even, or to 1 if it was odd, so digits\n2 and 3 are mishandled by keeping them as is, rather than changing 2 to 0\nand 3 to 1.\n\n2020-09-02  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR fortran/96859\n\t* check.c (gfc_boz2real, gfc_boz2int): When clearing first two bits,\n\tchange also '2' to '0' and '3' to '1' rather than just handling '4'\n\tthrough '7'.\n\n\t* gfortran.dg/pr96859.f90: New test.", "tree": {"sha": "145a7d1cdb18bf3e1c9330c35ac3443da8f193c7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/145a7d1cdb18bf3e1c9330c35ac3443da8f193c7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b567d3bd302933adb253aba9069fd8120c485441", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b567d3bd302933adb253aba9069fd8120c485441", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b567d3bd302933adb253aba9069fd8120c485441", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b567d3bd302933adb253aba9069fd8120c485441/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6640a5b9e7c6f66a7d0c3de1bf01f24c3b20b692", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6640a5b9e7c6f66a7d0c3de1bf01f24c3b20b692", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6640a5b9e7c6f66a7d0c3de1bf01f24c3b20b692"}], "stats": {"total": 33, "additions": 29, "deletions": 4}, "files": [{"sha": "1e64fab3401944c6bf43ce6e5a905a78b53ceb2c", "filename": "gcc/fortran/check.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b567d3bd302933adb253aba9069fd8120c485441/gcc%2Ffortran%2Fcheck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b567d3bd302933adb253aba9069fd8120c485441/gcc%2Ffortran%2Fcheck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fcheck.c?ref=b567d3bd302933adb253aba9069fd8120c485441", "patch": "@@ -340,9 +340,9 @@ gfc_boz2real (gfc_expr *x, int kind)\n       /* Clear first two bits.  */\n       else\n \t{\n-\t  if (buf[0] == '4' || buf[0] == '6')\n+\t  if (buf[0] == '2' || buf[0] == '4' || buf[0] == '6')\n \t    buf[0] = '0';\n-\t  else if (buf[0] == '5' || buf[0] == '7')\n+\t  else if (buf[0] == '3' || buf[0] == '5' || buf[0] == '7')\n \t    buf[0] = '1';\n \t}\n     }\n@@ -429,9 +429,9 @@ gfc_boz2int (gfc_expr *x, int kind)\n       /* Clear first two bits.  */\n       else\n \t{\n-\t  if (buf[0] == '4' || buf[0] == '6')\n+\t  if (buf[0] == '2' || buf[0] == '4' || buf[0] == '6')\n \t    buf[0] = '0';\n-\t  else if (buf[0] == '5' || buf[0] == '7')\n+\t  else if (buf[0] == '3' || buf[0] == '5' || buf[0] == '7')\n \t    buf[0] = '1';\n \t}\n     }"}, {"sha": "ca41cefc7824742bf555e9784c1b1c9ab777a932", "filename": "gcc/testsuite/gfortran.dg/pr96859.f90", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b567d3bd302933adb253aba9069fd8120c485441/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr96859.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b567d3bd302933adb253aba9069fd8120c485441/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr96859.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr96859.f90?ref=b567d3bd302933adb253aba9069fd8120c485441", "patch": "@@ -0,0 +1,25 @@\n+! PR fortran/96859\n+! { dg-do run }\n+\n+program pr96859\n+  if (merge_bits(32767_2, o'1234567', 32767_2).ne.32767_2) stop 1\n+  if (merge_bits(o'1234567', 32767_2, o'1234567').ne.32767_2) stop 2\n+  if (merge_bits(32767_2, o'1234567', b'010101').ne.14711_2) stop 3\n+  if (merge_bits(32767_2, o'1234567', z'12345678').ne.32639_2) stop 4\n+  if (int (o'1034567', 2).ne.14711_2) stop 5\n+  if (int (o'1234567', 2).ne.14711_2) stop 6\n+  if (int (o'1434567', 2).ne.14711_2) stop 7\n+  if (int (o'1634567', 2).ne.14711_2) stop 8\n+  if (int (o'1134567', 2).ne.-18057_2) stop 9\n+  if (int (o'1334567', 2).ne.-18057_2) stop 10\n+  if (int (o'1534567', 2).ne.-18057_2) stop 11\n+  if (int (o'1734567', 2).ne.-18057_2) stop 12\n+  if (int (o'70123456776543211234567', 8).ne.1505855851274254711_8) stop 13\n+  if (int (o'72123456776543211234567', 8).ne.1505855851274254711_8) stop 14\n+  if (int (o'74123456776543211234567', 8).ne.1505855851274254711_8) stop 15\n+  if (int (o'76123456776543211234567', 8).ne.1505855851274254711_8) stop 16\n+  if (int (o'71123456776543211234567', 8).ne.-7717516185580521097_8) stop 17\n+  if (int (o'73123456776543211234567', 8).ne.-7717516185580521097_8) stop 18\n+  if (int (o'75123456776543211234567', 8).ne.-7717516185580521097_8) stop 19\n+  if (int (o'77123456776543211234567', 8).ne.-7717516185580521097_8) stop 20\n+end"}]}