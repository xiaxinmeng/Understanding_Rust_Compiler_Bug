{"sha": "f2c9f71da9fd748bb452e69e7825e5f28e7c741d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjJjOWY3MWRhOWZkNzQ4YmI0NTJlNjllNzgyNWU1ZjI4ZTdjNzQxZA==", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2015-09-23T14:46:55Z"}, "committer": {"name": "Thomas Schwinge", "email": "tschwinge@gcc.gnu.org", "date": "2015-09-23T14:46:55Z"}, "message": "Refactor omp_reduction_init: omp_reduction_init_op\n\n\tgcc/\n\t* omp-low.h (omp_reduction_init_op): Declare.\n\t* omp-low.c (omp_reduction_init_op): New, broken out of ...\n\t(omp_reduction_init): ... here.  Call it.\n\t* tree-parloops.c (initialize_reductions): Use\n\tomp_reduction_init_op.\n\nCo-Authored-By: Nathan Sidwell <nathan@codesourcery.com>\n\nFrom-SVN: r228052", "tree": {"sha": "ee3493395b810e3e0800b948507eda00f9269e2e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ee3493395b810e3e0800b948507eda00f9269e2e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f2c9f71da9fd748bb452e69e7825e5f28e7c741d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f2c9f71da9fd748bb452e69e7825e5f28e7c741d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f2c9f71da9fd748bb452e69e7825e5f28e7c741d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f2c9f71da9fd748bb452e69e7825e5f28e7c741d/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ef537cc859dd149230454398078da6d3128cfd9a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ef537cc859dd149230454398078da6d3128cfd9a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ef537cc859dd149230454398078da6d3128cfd9a"}], "stats": {"total": 42, "additions": 27, "deletions": 15}, "files": [{"sha": "0e9b728e6e5df70fc5ee7e560b1ec12dfd9e3c93", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2c9f71da9fd748bb452e69e7825e5f28e7c741d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2c9f71da9fd748bb452e69e7825e5f28e7c741d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f2c9f71da9fd748bb452e69e7825e5f28e7c741d", "patch": "@@ -1,3 +1,12 @@\n+2015-09-23  Thomas Schwinge  <thomas@codesourcery.com>\n+\t    Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* omp-low.h (omp_reduction_init_op): Declare.\n+\t* omp-low.c (omp_reduction_init_op): New, broken out of ...\n+\t(omp_reduction_init): ... here.  Call it.\n+\t* tree-parloops.c (initialize_reductions): Use\n+\tomp_reduction_init_op.\n+\n 2015-09-23   Richard Biener  <rguenther@suse.de>\n \n \tPR middle-end/67662"}, {"sha": "cb007582cf29d8ee8375c4c863bdc058bdd951d9", "filename": "gcc/omp-low.c", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2c9f71da9fd748bb452e69e7825e5f28e7c741d/gcc%2Fomp-low.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2c9f71da9fd748bb452e69e7825e5f28e7c741d/gcc%2Fomp-low.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-low.c?ref=f2c9f71da9fd748bb452e69e7825e5f28e7c741d", "patch": "@@ -3372,13 +3372,12 @@ maybe_lookup_decl_in_outer_ctx (tree decl, omp_context *ctx)\n }\n \n \n-/* Construct the initialization value for reduction CLAUSE.  */\n+/* Construct the initialization value for reduction operation OP.  */\n \n tree\n-omp_reduction_init (tree clause, tree type)\n+omp_reduction_init_op (location_t loc, enum tree_code op, tree type)\n {\n-  location_t loc = OMP_CLAUSE_LOCATION (clause);\n-  switch (OMP_CLAUSE_REDUCTION_CODE (clause))\n+  switch (op)\n     {\n     case PLUS_EXPR:\n     case MINUS_EXPR:\n@@ -3451,6 +3450,15 @@ omp_reduction_init (tree clause, tree type)\n     }\n }\n \n+/* Construct the initialization value for reduction CLAUSE.  */\n+\n+tree\n+omp_reduction_init (tree clause, tree type)\n+{\n+  return omp_reduction_init_op (OMP_CLAUSE_LOCATION (clause),\n+\t\t\t\tOMP_CLAUSE_REDUCTION_CODE (clause), type);\n+}\n+\n /* Return alignment to be assumed for var in CLAUSE, which should be\n    OMP_CLAUSE_ALIGNED.  */\n "}, {"sha": "44e35a3591896fc7f7e34aa89bb2092c4afbce11", "filename": "gcc/omp-low.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2c9f71da9fd748bb452e69e7825e5f28e7c741d/gcc%2Fomp-low.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2c9f71da9fd748bb452e69e7825e5f28e7c741d/gcc%2Fomp-low.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-low.h?ref=f2c9f71da9fd748bb452e69e7825e5f28e7c741d", "patch": "@@ -25,6 +25,7 @@ struct omp_region;\n extern tree find_omp_clause (tree, enum omp_clause_code);\n extern void omp_expand_local (basic_block);\n extern void free_omp_regions (void);\n+extern tree omp_reduction_init_op (location_t, enum tree_code, tree);\n extern tree omp_reduction_init (tree, tree);\n extern bool make_gimple_omp_edges (basic_block, struct omp_region **, int *);\n extern void omp_finish_file (void);"}, {"sha": "741392bf937c74694112fd71972c414f14f1ebfb", "filename": "gcc/tree-parloops.c", "status": "modified", "additions": 5, "deletions": 11, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2c9f71da9fd748bb452e69e7825e5f28e7c741d/gcc%2Ftree-parloops.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2c9f71da9fd748bb452e69e7825e5f28e7c741d/gcc%2Ftree-parloops.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-parloops.c?ref=f2c9f71da9fd748bb452e69e7825e5f28e7c741d", "patch": "@@ -565,8 +565,8 @@ reduc_stmt_res (gimple *stmt)\n int\n initialize_reductions (reduction_info **slot, struct loop *loop)\n {\n-  tree init, c;\n-  tree bvar, type, arg;\n+  tree init;\n+  tree type, arg;\n   edge e;\n \n   struct reduction_info *const reduc = *slot;\n@@ -577,16 +577,10 @@ initialize_reductions (reduction_info **slot, struct loop *loop)\n   /* In the phi node at the header, replace the argument coming\n      from the preheader with the reduction initialization value.  */\n \n-  /* Create a new variable to initialize the reduction.  */\n+  /* Initialize the reduction.  */\n   type = TREE_TYPE (PHI_RESULT (reduc->reduc_phi));\n-  bvar = create_tmp_var (type, \"reduction\");\n-\n-  c = build_omp_clause (gimple_location (reduc->reduc_stmt),\n-\t\t\tOMP_CLAUSE_REDUCTION);\n-  OMP_CLAUSE_REDUCTION_CODE (c) = reduc->reduction_code;\n-  OMP_CLAUSE_DECL (c) = SSA_NAME_VAR (reduc_stmt_res (reduc->reduc_stmt));\n-\n-  init = omp_reduction_init (c, TREE_TYPE (bvar));\n+  init = omp_reduction_init_op (gimple_location (reduc->reduc_stmt),\n+\t\t\t\treduc->reduction_code, type);\n   reduc->init = init;\n \n   /* Replace the argument representing the initialization value"}]}