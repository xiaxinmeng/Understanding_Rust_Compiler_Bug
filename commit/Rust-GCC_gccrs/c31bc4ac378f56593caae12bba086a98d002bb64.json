{"sha": "c31bc4ac378f56593caae12bba086a98d002bb64", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzMxYmM0YWMzNzhmNTY1OTNjYWFlMTJiYmEwODZhOThkMDAyYmI2NA==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2018-02-07T10:37:55Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2018-02-07T10:37:55Z"}, "message": "[openacc] Fix diff_type in expand_oacc_collapse_init\n\n2018-02-07  Tom de Vries  <tom@codesourcery.com>\n\n\tPR libgomp/84217\n\t* omp-expand.c (expand_oacc_collapse_init): Ensure diff_type is large\n\tenough.\n\n\t* c-c++-common/goacc/pr84217.c: New test.\n\t* gfortran.dg/goacc/pr84217.f90: New test.\n\n\t* testsuite/libgomp.oacc-c-c++-common/pr84217.c: New test.\n\nFrom-SVN: r257443", "tree": {"sha": "dfa3bfa19dcae0483c3e1882e6aa1463d0f22550", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dfa3bfa19dcae0483c3e1882e6aa1463d0f22550"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c31bc4ac378f56593caae12bba086a98d002bb64", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c31bc4ac378f56593caae12bba086a98d002bb64", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c31bc4ac378f56593caae12bba086a98d002bb64", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c31bc4ac378f56593caae12bba086a98d002bb64/comments", "author": null, "committer": null, "parents": [{"sha": "26a823f03b214ce8412c4a255e483cc81c315bb4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26a823f03b214ce8412c4a255e483cc81c315bb4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/26a823f03b214ce8412c4a255e483cc81c315bb4"}], "stats": {"total": 58, "additions": 58, "deletions": 0}, "files": [{"sha": "1caefb6aabe9496684000c7dc7a29b457c56934e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c31bc4ac378f56593caae12bba086a98d002bb64/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c31bc4ac378f56593caae12bba086a98d002bb64/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c31bc4ac378f56593caae12bba086a98d002bb64", "patch": "@@ -1,3 +1,9 @@\n+2018-02-07  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR libgomp/84217\n+\t* omp-expand.c (expand_oacc_collapse_init): Ensure diff_type is large\n+\tenough.\n+\n 2018-02-07  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/84204"}, {"sha": "bb204906ea64efa94a78b42bbc606c0e61f29192", "filename": "gcc/omp-expand.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c31bc4ac378f56593caae12bba086a98d002bb64/gcc%2Fomp-expand.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c31bc4ac378f56593caae12bba086a98d002bb64/gcc%2Fomp-expand.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-expand.c?ref=c31bc4ac378f56593caae12bba086a98d002bb64", "patch": "@@ -1433,6 +1433,8 @@ expand_oacc_collapse_init (const struct omp_for_data *fd,\n \tplus_type = sizetype;\n       if (POINTER_TYPE_P (diff_type) || TYPE_UNSIGNED (diff_type))\n \tdiff_type = signed_type_for (diff_type);\n+      if (TYPE_PRECISION (diff_type) < TYPE_PRECISION (integer_type_node))\n+\tdiff_type = integer_type_node;\n \n       if (tiling)\n \t{"}, {"sha": "49e52ea8385e127603fdf2b2cc23ef1b39cd37f7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c31bc4ac378f56593caae12bba086a98d002bb64/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c31bc4ac378f56593caae12bba086a98d002bb64/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c31bc4ac378f56593caae12bba086a98d002bb64", "patch": "@@ -1,3 +1,9 @@\n+2018-02-07  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR libgomp/84217\n+\t* c-c++-common/goacc/pr84217.c: New test.\n+\t* gfortran.dg/goacc/pr84217.f90: New test.\n+\n 2018-02-07  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/84204"}, {"sha": "c4f2920d88b8c10ac26fc5a92b4cfdc9c25e2ce7", "filename": "gcc/testsuite/c-c++-common/goacc/pr84217.c", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c31bc4ac378f56593caae12bba086a98d002bb64/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Fpr84217.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c31bc4ac378f56593caae12bba086a98d002bb64/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Fpr84217.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Fpr84217.c?ref=c31bc4ac378f56593caae12bba086a98d002bb64", "patch": "@@ -0,0 +1,8 @@\n+void\n+foo (void)\n+{\n+#pragma acc parallel loop tile (2, 3)\n+  for (short i = 0; i < 10; ++i)\n+    for (short j = 0; j < 10; ++j)\n+      ;\n+}"}, {"sha": "cee49e9aba279094faea1d42c9441b2784e25e98", "filename": "gcc/testsuite/gfortran.dg/goacc/pr84217.f90", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c31bc4ac378f56593caae12bba086a98d002bb64/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr84217.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c31bc4ac378f56593caae12bba086a98d002bb64/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr84217.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr84217.f90?ref=c31bc4ac378f56593caae12bba086a98d002bb64", "patch": "@@ -0,0 +1,9 @@\n+subroutine foo\n+  integer(2) :: i, j\n+  !$acc parallel loop tile(2,3)\n+  do i = 1, 10\n+     do j = 1, 10\n+     end do\n+  end do\n+  !$acc end parallel loop\n+end"}, {"sha": "91b47ce713731e413c60b2aef4f6e9fb2321912d", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c31bc4ac378f56593caae12bba086a98d002bb64/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c31bc4ac378f56593caae12bba086a98d002bb64/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=c31bc4ac378f56593caae12bba086a98d002bb64", "patch": "@@ -1,3 +1,8 @@\n+2018-02-07  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR libgomp/84217\n+\t* testsuite/libgomp.oacc-c-c++-common/pr84217.c: New test.\n+\n 2018-01-29  Christoph Spiel  <cspiel@freenet.de>\n \t    Jakub Jelinek  <jakub@redhat.com>\n "}, {"sha": "18ff66a560b0faa9e921cbbb71432320a1f23ec3", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/pr84217.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c31bc4ac378f56593caae12bba086a98d002bb64/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr84217.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c31bc4ac378f56593caae12bba086a98d002bb64/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr84217.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr84217.c?ref=c31bc4ac378f56593caae12bba086a98d002bb64", "patch": "@@ -0,0 +1,22 @@\n+extern void abort (void);\n+\n+#define N 10\n+\n+int\n+main (void)\n+{\n+  int a[N];\n+\n+  for (short i = 0; i < N; ++i)\n+    a[i] = -1;\n+\n+#pragma acc parallel loop tile (2)\n+  for (short i = 0; i < N; ++i)\n+    a[i] = i;\n+\n+  for (short i = 0; i < N; ++i)\n+    if (a[i] != i)\n+      abort ();\n+\n+  return 0;\n+}"}]}