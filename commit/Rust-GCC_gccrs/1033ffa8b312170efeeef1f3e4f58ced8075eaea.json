{"sha": "1033ffa8b312170efeeef1f3e4f58ced8075eaea", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTAzM2ZmYThiMzEyMTcwZWZlZWVmMWYzZTRmNThjZWQ4MDc1ZWFlYQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2008-01-29T23:19:07Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2008-01-29T23:19:07Z"}, "message": "re PR c/35017 (PR11377 pedwarns even about valid code)\n\n\tPR c/35017\n\t* c-decl.c (start_decl): Don't pedwarn about TREE_READONLY\n\tstatic decls.\n\t* c-typeck.c (build_external_ref): Don't pedwarn about\n\tstatic vars in current function's scope.\n\n\t* gcc.dg/inline-25.c: New test.\n\t* gcc.dg/inline-26.c: New test.\n\t* gcc.dg/inline-27.c: New test.\n\nFrom-SVN: r131945", "tree": {"sha": "851070f24a1e8ac4d3680a5d4b7ec7cfc67ec58b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/851070f24a1e8ac4d3680a5d4b7ec7cfc67ec58b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1033ffa8b312170efeeef1f3e4f58ced8075eaea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1033ffa8b312170efeeef1f3e4f58ced8075eaea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1033ffa8b312170efeeef1f3e4f58ced8075eaea", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1033ffa8b312170efeeef1f3e4f58ced8075eaea/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "bdba22639b5a609adfccc08c74d3c5fb7b87b581", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bdba22639b5a609adfccc08c74d3c5fb7b87b581", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bdba22639b5a609adfccc08c74d3c5fb7b87b581"}], "stats": {"total": 456, "additions": 454, "deletions": 2}, "files": [{"sha": "5c5c8848e43b9c4c3c20693a08eeaa9975d91cbd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1033ffa8b312170efeeef1f3e4f58ced8075eaea/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1033ffa8b312170efeeef1f3e4f58ced8075eaea/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1033ffa8b312170efeeef1f3e4f58ced8075eaea", "patch": "@@ -1,3 +1,11 @@\n+2008-01-30  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/35017\n+\t* c-decl.c (start_decl): Don't pedwarn about TREE_READONLY\n+\tstatic decls.\n+\t* c-typeck.c (build_external_ref): Don't pedwarn about\n+\tstatic vars in current function's scope.\n+\n 2008-01-29  Joseph Myers  <joseph@codesourcery.com>\n \n \t* config.gcc (i[34567]86-*-nto-qnx*): Remove deprecation."}, {"sha": "1af84da39402e0420ddb9aed1a6f6d8f042887e7", "filename": "gcc/c-decl.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1033ffa8b312170efeeef1f3e4f58ced8075eaea/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1033ffa8b312170efeeef1f3e4f58ced8075eaea/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=1033ffa8b312170efeeef1f3e4f58ced8075eaea", "patch": "@@ -3320,6 +3320,7 @@ start_decl (struct c_declarator *declarator, struct c_declspecs *declspecs,\n   if (TREE_CODE (decl) == VAR_DECL\n       && current_scope != file_scope\n       && TREE_STATIC (decl)\n+      && !TREE_READONLY (decl)\n       && DECL_DECLARED_INLINE_P (current_function_decl)\n       && DECL_EXTERNAL (current_function_decl))\n     pedwarn (\"%q+D is static but declared in inline function %qD \""}, {"sha": "60b0b02fc042a38a88c21238a8a35dd64c31566d", "filename": "gcc/c-typeck.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1033ffa8b312170efeeef1f3e4f58ced8075eaea/gcc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1033ffa8b312170efeeef1f3e4f58ced8075eaea/gcc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-typeck.c?ref=1033ffa8b312170efeeef1f3e4f58ced8075eaea", "patch": "@@ -1,6 +1,6 @@\n /* Build expressions with type checking for C compiler.\n    Copyright (C) 1987, 1988, 1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998,\n-   1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007\n+   1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008\n    Free Software Foundation, Inc.\n \n This file is part of GCC.\n@@ -2234,7 +2234,8 @@ build_external_ref (tree id, int fun, location_t loc)\n \t   && DECL_EXTERNAL (current_function_decl)\n \t   && VAR_OR_FUNCTION_DECL_P (ref)\n \t   && (TREE_CODE (ref) != VAR_DECL || TREE_STATIC (ref))\n-\t   && ! TREE_PUBLIC (ref))\n+\t   && ! TREE_PUBLIC (ref)\n+\t   && DECL_CONTEXT (ref) != current_function_decl)\n     pedwarn (\"%H%qD is static but used in inline function %qD \"\n \t     \"which is not static\", &loc, ref, current_function_decl);\n "}, {"sha": "11239a5e9cc694725a8ab864308944853d4853a6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1033ffa8b312170efeeef1f3e4f58ced8075eaea/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1033ffa8b312170efeeef1f3e4f58ced8075eaea/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1033ffa8b312170efeeef1f3e4f58ced8075eaea", "patch": "@@ -1,3 +1,10 @@\n+2008-01-30  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/35017\n+\t* gcc.dg/inline-25.c: New test.\n+\t* gcc.dg/inline-26.c: New test.\n+\t* gcc.dg/inline-27.c: New test.\n+\n 2008-01-29  Richard Guenther  <rguenther@suse.de>\n \n \tPR middle-end/35006"}, {"sha": "8063d6cd5876c7b0f1197ecb908b52f27ef14379", "filename": "gcc/testsuite/gcc.dg/inline-25.c", "status": "added", "additions": 145, "deletions": 0, "changes": 145, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1033ffa8b312170efeeef1f3e4f58ced8075eaea/gcc%2Ftestsuite%2Fgcc.dg%2Finline-25.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1033ffa8b312170efeeef1f3e4f58ced8075eaea/gcc%2Ftestsuite%2Fgcc.dg%2Finline-25.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Finline-25.c?ref=1033ffa8b312170efeeef1f3e4f58ced8075eaea", "patch": "@@ -0,0 +1,145 @@\n+/* PR c/35017 */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=iso9899:1999 -pedantic-errors\" } */\n+\n+static int a = 6;\n+static const int b = 6;\n+int c = 6;\n+\n+inline int\n+fn1 (void)\n+{\n+  return a;\t\t/* { dg-error \"used in inline\" } */\n+}\n+\n+inline int\n+fn2 (void)\n+{\n+  return b;\t\t/* { dg-error \"used in inline\" } */\n+}\n+\n+inline int\n+fn3 (void)\n+{\n+  return c;\n+}\n+\n+inline int\n+fn4 (void)\n+{\n+  static int d = 6;\t/* { dg-error \"declared in inline\" } */\n+  return d;\n+}\n+\n+inline int\n+fn5 (void)\n+{\n+  static const int e = 6;\n+  return e;\n+}\n+\n+inline int\n+fn6 (void)\n+{\n+  int f = 6;\n+  return f;\n+}\n+\n+inline int\n+fn7 (int i)\n+{\n+  static const char g[10] = \"abcdefghij\";\n+  return g[i];\n+}\n+\n+extern inline int\n+fn8 (void)\n+{\n+  return a;\n+}\n+\n+extern inline int\n+fn9 (void)\n+{\n+  return b;\n+}\n+\n+extern inline int\n+fn10 (void)\n+{\n+  return c;\n+}\n+\n+extern inline int\n+fn11 (void)\n+{\n+  static int d = 6;\n+  return d;\n+}\n+\n+extern inline int\n+fn12 (void)\n+{\n+  static const int e = 6;\n+  return e;\n+}\n+\n+extern inline int\n+fn13 (void)\n+{\n+  int f = 6;\n+  return f;\n+}\n+\n+extern inline int\n+fn14 (int i)\n+{\n+  static const char g[10] = \"abcdefghij\";\n+  return g[i];\n+}\n+\n+static inline int\n+fn15 (void)\n+{\n+  return a;\n+}\n+\n+static inline int\n+fn16 (void)\n+{\n+  return b;\n+}\n+\n+static inline int\n+fn17 (void)\n+{\n+  return c;\n+}\n+\n+static inline int\n+fn18 (void)\n+{\n+  static int d = 6;\n+  return d;\n+}\n+\n+static inline int\n+fn19 (void)\n+{\n+  static const int e = 6;\n+  return e;\n+}\n+\n+static inline int\n+fn20 (void)\n+{\n+  int f = 6;\n+  return f;\n+}\n+\n+static inline int\n+fn21 (int i)\n+{\n+  static const char g[10] = \"abcdefghij\";\n+  return g[i];\n+}"}, {"sha": "02f78bb94239a629adc11c9b2e93372f4adc1fcd", "filename": "gcc/testsuite/gcc.dg/inline-26.c", "status": "added", "additions": 145, "deletions": 0, "changes": 145, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1033ffa8b312170efeeef1f3e4f58ced8075eaea/gcc%2Ftestsuite%2Fgcc.dg%2Finline-26.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1033ffa8b312170efeeef1f3e4f58ced8075eaea/gcc%2Ftestsuite%2Fgcc.dg%2Finline-26.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Finline-26.c?ref=1033ffa8b312170efeeef1f3e4f58ced8075eaea", "patch": "@@ -0,0 +1,145 @@\n+/* PR c/35017 */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=gnu99\" } */\n+\n+static int a = 6;\n+static const int b = 6;\n+int c = 6;\n+\n+inline int\n+fn1 (void)\n+{\n+  return a;\t\t/* { dg-warning \"used in inline\" } */\n+}\n+\n+inline int\n+fn2 (void)\n+{\n+  return b;\t\t/* { dg-warning \"used in inline\" } */\n+}\n+\n+inline int\n+fn3 (void)\n+{\n+  return c;\n+}\n+\n+inline int\n+fn4 (void)\n+{\n+  static int d = 6;\t/* { dg-warning \"declared in inline\" } */\n+  return d;\n+}\n+\n+inline int\n+fn5 (void)\n+{\n+  static const int e = 6;\n+  return e;\n+}\n+\n+inline int\n+fn6 (void)\n+{\n+  int f = 6;\n+  return f;\n+}\n+\n+inline int\n+fn7 (int i)\n+{\n+  static const char g[10] = \"abcdefghij\";\n+  return g[i];\n+}\n+\n+extern inline int\n+fn8 (void)\n+{\n+  return a;\n+}\n+\n+extern inline int\n+fn9 (void)\n+{\n+  return b;\n+}\n+\n+extern inline int\n+fn10 (void)\n+{\n+  return c;\n+}\n+\n+extern inline int\n+fn11 (void)\n+{\n+  static int d = 6;\n+  return d;\n+}\n+\n+extern inline int\n+fn12 (void)\n+{\n+  static const int e = 6;\n+  return e;\n+}\n+\n+extern inline int\n+fn13 (void)\n+{\n+  int f = 6;\n+  return f;\n+}\n+\n+extern inline int\n+fn14 (int i)\n+{\n+  static const char g[10] = \"abcdefghij\";\n+  return g[i];\n+}\n+\n+static inline int\n+fn15 (void)\n+{\n+  return a;\n+}\n+\n+static inline int\n+fn16 (void)\n+{\n+  return b;\n+}\n+\n+static inline int\n+fn17 (void)\n+{\n+  return c;\n+}\n+\n+static inline int\n+fn18 (void)\n+{\n+  static int d = 6;\n+  return d;\n+}\n+\n+static inline int\n+fn19 (void)\n+{\n+  static const int e = 6;\n+  return e;\n+}\n+\n+static inline int\n+fn20 (void)\n+{\n+  int f = 6;\n+  return f;\n+}\n+\n+static inline int\n+fn21 (int i)\n+{\n+  static const char g[10] = \"abcdefghij\";\n+  return g[i];\n+}"}, {"sha": "0ecfbcf5adf659968f811bf68ea62bea96d8bc3e", "filename": "gcc/testsuite/gcc.dg/inline-27.c", "status": "added", "additions": 145, "deletions": 0, "changes": 145, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1033ffa8b312170efeeef1f3e4f58ced8075eaea/gcc%2Ftestsuite%2Fgcc.dg%2Finline-27.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1033ffa8b312170efeeef1f3e4f58ced8075eaea/gcc%2Ftestsuite%2Fgcc.dg%2Finline-27.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Finline-27.c?ref=1033ffa8b312170efeeef1f3e4f58ced8075eaea", "patch": "@@ -0,0 +1,145 @@\n+/* PR c/35017 */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=gnu89\" } */\n+\n+static int a = 6;\n+static const int b = 6;\n+int c = 6;\n+\n+inline int\n+fn1 (void)\n+{\n+  return a;\n+}\n+\n+inline int\n+fn2 (void)\n+{\n+  return b;\n+}\n+\n+inline int\n+fn3 (void)\n+{\n+  return c;\n+}\n+\n+inline int\n+fn4 (void)\n+{\n+  static int d = 6;\n+  return d;\n+}\n+\n+inline int\n+fn5 (void)\n+{\n+  static const int e = 6;\n+  return e;\n+}\n+\n+inline int\n+fn6 (void)\n+{\n+  int f = 6;\n+  return f;\n+}\n+\n+inline int\n+fn7 (int i)\n+{\n+  static const char g[10] = \"abcdefghij\";\n+  return g[i];\n+}\n+\n+extern inline int\n+fn8 (void)\n+{\n+  return a;\t\t/* { dg-warning \"used in inline\" } */\n+}\n+\n+extern inline int\n+fn9 (void)\n+{\n+  return b;\t\t/* { dg-warning \"used in inline\" } */\n+}\n+\n+extern inline int\n+fn10 (void)\n+{\n+  return c;\n+}\n+\n+extern inline int\n+fn11 (void)\n+{\n+  static int d = 6;\t/* { dg-warning \"declared in inline\" } */\n+  return d;\n+}\n+\n+extern inline int\n+fn12 (void)\n+{\n+  static const int e = 6;\n+  return e;\n+}\n+\n+extern inline int\n+fn13 (void)\n+{\n+  int f = 6;\n+  return f;\n+}\n+\n+extern inline int\n+fn14 (int i)\n+{\n+  static const char g[10] = \"abcdefghij\";\n+  return g[i];\n+}\n+\n+static inline int\n+fn15 (void)\n+{\n+  return a;\n+}\n+\n+static inline int\n+fn16 (void)\n+{\n+  return b;\n+}\n+\n+static inline int\n+fn17 (void)\n+{\n+  return c;\n+}\n+\n+static inline int\n+fn18 (void)\n+{\n+  static int d = 6;\n+  return d;\n+}\n+\n+static inline int\n+fn19 (void)\n+{\n+  static const int e = 6;\n+  return e;\n+}\n+\n+static inline int\n+fn20 (void)\n+{\n+  int f = 6;\n+  return f;\n+}\n+\n+static inline int\n+fn21 (int i)\n+{\n+  static const char g[10] = \"abcdefghij\";\n+  return g[i];\n+}"}]}