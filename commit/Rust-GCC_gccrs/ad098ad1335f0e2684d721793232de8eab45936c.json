{"sha": "ad098ad1335f0e2684d721793232de8eab45936c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWQwOThhZDEzMzVmMGUyNjg0ZDcyMTc5MzIzMmRlOGVhYjQ1OTM2Yw==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely.gcc@gmail.com", "date": "2013-11-18T13:52:39Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2013-11-18T13:52:39Z"}, "message": "shared_ptr_base.h (_Sp_counted_base<_S_single>): Use non-atomic operations.\n\n\t* include/bits/shared_ptr_base.h (_Sp_counted_base<_S_single>): Use\n\tnon-atomic operations.\n\t* testsuite/20_util/shared_ptr/cons/43820_neg.cc: Adjust line number.\n\t* testsuite/20_util/shared_ptr/cons/void_neg.cc: Likewise.\n\nFrom-SVN: r204949", "tree": {"sha": "fd998863a3c6a189e7248fe2024450ae6b8ca589", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fd998863a3c6a189e7248fe2024450ae6b8ca589"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ad098ad1335f0e2684d721793232de8eab45936c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ad098ad1335f0e2684d721793232de8eab45936c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ad098ad1335f0e2684d721793232de8eab45936c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ad098ad1335f0e2684d721793232de8eab45936c/comments", "author": null, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6d3f673cf6a37752959803a28eee39190d800d8a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d3f673cf6a37752959803a28eee39190d800d8a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6d3f673cf6a37752959803a28eee39190d800d8a"}], "stats": {"total": 54, "additions": 47, "deletions": 7}, "files": [{"sha": "5af235f1c7b23597fafee3d9110ea16e9a6a3216", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ad098ad1335f0e2684d721793232de8eab45936c/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ad098ad1335f0e2684d721793232de8eab45936c/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=ad098ad1335f0e2684d721793232de8eab45936c", "patch": "@@ -1,3 +1,10 @@\n+2013-11-18  Jonathan Wakely  <jwakely.gcc@gmail.com>\n+\n+\t* include/bits/shared_ptr_base.h (_Sp_counted_base<_S_single>): Use\n+\tnon-atomic operations.\n+\t* testsuite/20_util/shared_ptr/cons/43820_neg.cc: Adjust line number.\n+\t* testsuite/20_util/shared_ptr/cons/void_neg.cc: Likewise.\n+\n 2013-11-16  Edward Smith-Rowland  <3dw4rd@verizon.net>\n \n \tImplement N3762 string_view: a non-owning reference to a string."}, {"sha": "68ccc9e1150d3fac8ab01a8cfa364bf3ace2b950", "filename": "libstdc++-v3/include/bits/shared_ptr_base.h", "status": "modified", "additions": 38, "deletions": 5, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ad098ad1335f0e2684d721793232de8eab45936c/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fshared_ptr_base.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ad098ad1335f0e2684d721793232de8eab45936c/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fshared_ptr_base.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fshared_ptr_base.h?ref=ad098ad1335f0e2684d721793232de8eab45936c", "patch": "@@ -209,11 +209,9 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n     _Sp_counted_base<_S_single>::\n     _M_add_ref_lock()\n     {\n-      if (__gnu_cxx::__exchange_and_add_dispatch(&_M_use_count, 1) == 0)\n-\t{\n-\t  _M_use_count = 0;\n-\t  __throw_bad_weak_ptr();\n-\t}\n+      if (_M_use_count == 0)\n+\t__throw_bad_weak_ptr();\n+      ++_M_use_count;\n     }\n \n   template<>\n@@ -248,6 +246,41 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t\t\t\t\t  __ATOMIC_RELAXED));\n     }\n \n+  template<>\n+    inline void\n+    _Sp_counted_base<_S_single>::_M_add_ref_copy()\n+    { ++_M_use_count; }\n+\n+  template<>\n+    inline void\n+    _Sp_counted_base<_S_single>::_M_release() noexcept\n+    {\n+      if (--_M_use_count == 0)\n+        {\n+          _M_dispose();\n+          if (--_M_weak_count == 0)\n+            _M_destroy();\n+        }\n+    }\n+\n+  template<>\n+    inline void\n+    _Sp_counted_base<_S_single>::_M_weak_add_ref() noexcept\n+    { ++_M_weak_count; }\n+\n+  template<>\n+    inline void\n+    _Sp_counted_base<_S_single>::_M_weak_release() noexcept\n+    {\n+      if (--_M_weak_count == 0)\n+        _M_destroy();\n+    }\n+\n+  template<>\n+    inline long\n+    _Sp_counted_base<_S_single>::_M_get_use_count() const noexcept\n+    { return _M_use_count; }\n+\n \n   // Forward declarations.\n   template<typename _Tp, _Lock_policy _Lp = __default_lock_policy>"}, {"sha": "01acca53fc8f2782866833e1ef6673b817049168", "filename": "libstdc++-v3/testsuite/20_util/shared_ptr/cons/43820_neg.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ad098ad1335f0e2684d721793232de8eab45936c/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcons%2F43820_neg.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ad098ad1335f0e2684d721793232de8eab45936c/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcons%2F43820_neg.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcons%2F43820_neg.cc?ref=ad098ad1335f0e2684d721793232de8eab45936c", "patch": "@@ -32,7 +32,7 @@ void test01()\n {\n   X* px = 0;\n   std::shared_ptr<X> p1(px);   // { dg-error \"here\" }\n-  // { dg-error \"incomplete\" \"\" { target *-*-* } 779 }\n+  // { dg-error \"incomplete\" \"\" { target *-*-* } 812 }\n \n   std::shared_ptr<X> p9(ap());  // { dg-error \"here\" }\n   // { dg-error \"incomplete\" \"\" { target *-*-* } 307 }"}, {"sha": "53891597fb32af221304eba851e928bec08b0729", "filename": "libstdc++-v3/testsuite/20_util/shared_ptr/cons/void_neg.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ad098ad1335f0e2684d721793232de8eab45936c/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcons%2Fvoid_neg.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ad098ad1335f0e2684d721793232de8eab45936c/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcons%2Fvoid_neg.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcons%2Fvoid_neg.cc?ref=ad098ad1335f0e2684d721793232de8eab45936c", "patch": "@@ -25,5 +25,5 @@\n void test01()\n {\n   std::shared_ptr<void> p((void*)nullptr);   // { dg-error \"here\" }\n-  // { dg-error \"incomplete\" \"\" { target *-*-* } 778 }\n+  // { dg-error \"incomplete\" \"\" { target *-*-* } 811 }\n }"}]}