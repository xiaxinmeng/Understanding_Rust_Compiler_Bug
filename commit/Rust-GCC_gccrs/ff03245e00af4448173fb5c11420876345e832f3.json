{"sha": "ff03245e00af4448173fb5c11420876345e832f3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmYwMzI0NWUwMGFmNDQ0ODE3M2ZiNWMxMTQyMDg3NjM0NWU4MzJmMw==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2018-05-17T15:03:29Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2018-05-17T15:03:29Z"}, "message": "PR libstdc++/85812 fix memory leak in std::make_exception_ptr\n\n\tPR libstdc++/85812\n\t* libsupc++/cxxabi_init_exception.h (__cxa_free_exception): Declare.\n\t* libsupc++/exception_ptr.h (make_exception_ptr) [__cpp_exceptions]:\n\tRefactor to separate non-throwing and throwing implementations.\n\t[__cpp_rtti && !_GLIBCXX_HAVE_CDTOR_CALLABI]: Deallocate the memory\n\tif constructing the object throws.\n\nFrom-SVN: r260323", "tree": {"sha": "012b0c91f48ccf16f484697d398f4d10e71ad096", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/012b0c91f48ccf16f484697d398f4d10e71ad096"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ff03245e00af4448173fb5c11420876345e832f3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff03245e00af4448173fb5c11420876345e832f3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff03245e00af4448173fb5c11420876345e832f3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff03245e00af4448173fb5c11420876345e832f3/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f1bcb061d172ca7e3bdcc46476b20776382a2974", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f1bcb061d172ca7e3bdcc46476b20776382a2974", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f1bcb061d172ca7e3bdcc46476b20776382a2974"}], "stats": {"total": 36, "additions": 27, "deletions": 9}, "files": [{"sha": "142f7c8317f980e5a249f5a1c43ff998d70c6ca8", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff03245e00af4448173fb5c11420876345e832f3/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff03245e00af4448173fb5c11420876345e832f3/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=ff03245e00af4448173fb5c11420876345e832f3", "patch": "@@ -1,3 +1,12 @@\n+2018-05-17  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\tPR libstdc++/85812\n+\t* libsupc++/cxxabi_init_exception.h (__cxa_free_exception): Declare.\n+\t* libsupc++/exception_ptr.h (make_exception_ptr) [__cpp_exceptions]:\n+\tRefactor to separate non-throwing and throwing implementations.\n+\t[__cpp_rtti && !_GLIBCXX_HAVE_CDTOR_CALLABI]: Deallocate the memory\n+\tif constructing the object throws.\n+\n 2018-05-15  Jonathan Wakely  <jwakely@redhat.com>\n \n \tPR libstdc++/85749"}, {"sha": "e438c1008d9b0bc2b7fad66eecea19e4fe0aade3", "filename": "libstdc++-v3/libsupc++/cxxabi_init_exception.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff03245e00af4448173fb5c11420876345e832f3/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fcxxabi_init_exception.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff03245e00af4448173fb5c11420876345e832f3/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fcxxabi_init_exception.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fcxxabi_init_exception.h?ref=ff03245e00af4448173fb5c11420876345e832f3", "patch": "@@ -62,6 +62,9 @@ namespace __cxxabiv1\n       void*\n       __cxa_allocate_exception(size_t) _GLIBCXX_NOTHROW;\n \n+      void\n+      __cxa_free_exception(void*) _GLIBCXX_NOTHROW;\n+\n       // Initialize exception (this is a GNU extension)\n       __cxa_refcounted_exception*\n       __cxa_init_primary_exception(void *object, std::type_info *tinfo,"}, {"sha": "bd355ed880bdbdcc7c504f137f8a8139519ad0d0", "filename": "libstdc++-v3/libsupc++/exception_ptr.h", "status": "modified", "additions": 15, "deletions": 9, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff03245e00af4448173fb5c11420876345e832f3/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fexception_ptr.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff03245e00af4448173fb5c11420876345e832f3/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fexception_ptr.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fexception_ptr.h?ref=ff03245e00af4448173fb5c11420876345e832f3", "patch": "@@ -178,25 +178,31 @@ namespace std\n     exception_ptr \n     make_exception_ptr(_Ex __ex) _GLIBCXX_USE_NOEXCEPT\n     {\n-#if __cpp_exceptions\n+#if __cpp_exceptions && __cpp_rtti && !_GLIBCXX_HAVE_CDTOR_CALLABI\n+      void* __e = __cxxabiv1::__cxa_allocate_exception(sizeof(_Ex));\n+      (void) __cxxabiv1::__cxa_init_primary_exception(\n+\t  __e, const_cast<std::type_info*>(&typeid(__ex)),\n+\t  __exception_ptr::__dest_thunk<_Ex>);\n       try\n \t{\n-#if __cpp_rtti && !_GLIBCXX_HAVE_CDTOR_CALLABI\n-          void *__e = __cxxabiv1::__cxa_allocate_exception(sizeof(_Ex));\n-          (void)__cxxabiv1::__cxa_init_primary_exception(\n-\t      __e, const_cast<std::type_info*>(&typeid(__ex)),\n-\t      __exception_ptr::__dest_thunk<_Ex>);\n           ::new (__e) _Ex(__ex);\n           return exception_ptr(__e);\n-#else\n+\t}\n+      catch(...)\n+\t{\n+\t  __cxxabiv1::__cxa_free_exception(__e);\n+\t  return current_exception();\n+\t}\n+#elif __cpp_exceptions\n+      try\n+\t{\n           throw __ex;\n-#endif\n \t}\n       catch(...)\n \t{\n \t  return current_exception();\n \t}\n-#else\n+#else // no RTTI and no exceptions\n       return exception_ptr();\n #endif\n     }"}]}