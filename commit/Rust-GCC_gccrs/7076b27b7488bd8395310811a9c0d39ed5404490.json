{"sha": "7076b27b7488bd8395310811a9c0d39ed5404490", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzA3NmIyN2I3NDg4YmQ4Mzk1MzEwODExYTljMGQzOWVkNTQwNDQ5MA==", "commit": {"author": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2019-03-27T22:40:22Z"}, "committer": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2019-03-27T22:40:22Z"}, "message": "re PR fortran/85537 ([F08] Invalid memory reference at runtime when calling subroutine through procedure pointer)\n\nfix PR 85537\n\n2019-03-27  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/85537\n\t* expr.c (gfc_check_assign_symbol): Reject internal and dummy procedures\n\tin procedure pointer initialization.\n\n2019-03-27  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/85537\n\t* gfortran.dg/dummy_procedure_11.f90: Fix test case.\n\t* gfortran.dg/pointer_init_11.f90: New test case.\n\nFrom-SVN: r269980", "tree": {"sha": "fd50b2e9fc5cb909cf8ae451ab199db21cd69738", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fd50b2e9fc5cb909cf8ae451ab199db21cd69738"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7076b27b7488bd8395310811a9c0d39ed5404490", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7076b27b7488bd8395310811a9c0d39ed5404490", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7076b27b7488bd8395310811a9c0d39ed5404490", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7076b27b7488bd8395310811a9c0d39ed5404490/comments", "author": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "303d6cb2760304f5e6d00c4419c0dd1144588180", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/303d6cb2760304f5e6d00c4419c0dd1144588180", "html_url": "https://github.com/Rust-GCC/gccrs/commit/303d6cb2760304f5e6d00c4419c0dd1144588180"}], "stats": {"total": 76, "additions": 74, "deletions": 2}, "files": [{"sha": "372c517487f8a7b5b3f0e463492f94cfa93bcc52", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7076b27b7488bd8395310811a9c0d39ed5404490/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7076b27b7488bd8395310811a9c0d39ed5404490/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=7076b27b7488bd8395310811a9c0d39ed5404490", "patch": "@@ -1,3 +1,9 @@\n+2019-03-27  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/85537\n+\t* expr.c (gfc_check_assign_symbol): Reject internal and dummy procedures\n+\tin procedure pointer initialization.\n+\n 2019-03-27  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/88247"}, {"sha": "478a55577237c6e9fdd420c5252b9280a09b8783", "filename": "gcc/fortran/expr.c", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7076b27b7488bd8395310811a9c0d39ed5404490/gcc%2Ffortran%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7076b27b7488bd8395310811a9c0d39ed5404490/gcc%2Ffortran%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fexpr.c?ref=7076b27b7488bd8395310811a9c0d39ed5404490", "patch": "@@ -4407,6 +4407,20 @@ gfc_check_assign_symbol (gfc_symbol *sym, gfc_component *comp, gfc_expr *rvalue)\n \t\t     \"may not be a procedure pointer\", &rvalue->where);\n \t  return false;\n \t}\n+      if (attr.proc == PROC_INTERNAL)\n+\t{\n+\t  gfc_error (\"Internal procedure %qs is invalid in \"\n+\t\t     \"procedure pointer initialization at %L\",\n+\t\t     rvalue->symtree->name, &rvalue->where);\n+\t  return false;\n+\t}\n+      if (attr.dummy)\n+\t{\n+\t  gfc_error (\"Dummy procedure %qs is invalid in \"\n+\t\t     \"procedure pointer initialization at %L\",\n+\t\t     rvalue->symtree->name, &rvalue->where);\n+\t  return false;\n+\t}\n     }\n \n   return true;"}, {"sha": "f29455331f51857c8134141bf2d2884e56eb35da", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7076b27b7488bd8395310811a9c0d39ed5404490/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7076b27b7488bd8395310811a9c0d39ed5404490/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7076b27b7488bd8395310811a9c0d39ed5404490", "patch": "@@ -1,3 +1,9 @@\n+2019-03-27  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/85537\n+\t* gfortran.dg/dummy_procedure_11.f90: Fix test case.\n+\t* gfortran.dg/pointer_init_11.f90: New test case.\n+\n 2019-03-27  Mateusz B  <mateuszb@poczta.onet.pl>\n \n \tPR target/85667"}, {"sha": "3e4b2b1d6f03c34328d786345e04340212c807ef", "filename": "gcc/testsuite/gfortran.dg/dummy_procedure_11.f90", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7076b27b7488bd8395310811a9c0d39ed5404490/gcc%2Ftestsuite%2Fgfortran.dg%2Fdummy_procedure_11.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7076b27b7488bd8395310811a9c0d39ed5404490/gcc%2Ftestsuite%2Fgfortran.dg%2Fdummy_procedure_11.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdummy_procedure_11.f90?ref=7076b27b7488bd8395310811a9c0d39ed5404490", "patch": "@@ -5,16 +5,18 @@\n ! Contributed by Vladimir Fuka <vladimir.fuka@gmail.com>\n \n type :: t\n-  procedure(g), pointer, nopass :: ppc => g\n+  procedure(g), pointer, nopass :: ppc\n end type\n \n-procedure(g), pointer :: pp => g\n+procedure(g), pointer :: pp\n type(t)::x\n \n print *, f(g)\n print *, f(g())      ! { dg-error \"Expected a procedure for argument\" }\n+pp => g\n print *, f(pp)\n print *, f(pp())     ! { dg-error \"Expected a procedure for argument\" }\n+x%ppc => g\n print *, f(x%ppc)\n print *, f(x%ppc())  ! { dg-error \"Expected a procedure for argument\" }\n "}, {"sha": "3113e1576875f043c58741363ba9a6b23ab516e9", "filename": "gcc/testsuite/gfortran.dg/pointer_init_11.f90", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7076b27b7488bd8395310811a9c0d39ed5404490/gcc%2Ftestsuite%2Fgfortran.dg%2Fpointer_init_11.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7076b27b7488bd8395310811a9c0d39ed5404490/gcc%2Ftestsuite%2Fgfortran.dg%2Fpointer_init_11.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpointer_init_11.f90?ref=7076b27b7488bd8395310811a9c0d39ed5404490", "patch": "@@ -0,0 +1,44 @@\n+! { dg-do compile }\n+!\n+! PR 85537: [F08] Invalid memory reference at runtime when calling subroutine through procedure pointer\n+!\n+! Contributed by Tiziano M\u00fcller <dev-zero@gentoo.org>\n+\n+module m1\n+    implicit none\n+contains\n+    subroutine foo()\n+      integer :: a\n+\n+      abstract interface\n+        subroutine ibar()\n+        end subroutine\n+      end interface\n+\n+      procedure(ibar), pointer :: bar_ptr => bar_impl  ! { dg-error \"invalid in procedure pointer initialization\" }\n+\n+    contains\n+      subroutine bar_impl()\n+        write (*,*) \"foo\"\n+        a = a + 1\n+      end subroutine\n+\n+    end subroutine\n+end module\n+\n+\n+module m2\n+    implicit none\n+contains\n+    subroutine foo(dbar)\n+      interface\n+        subroutine dbar()\n+        end subroutine\n+      end interface\n+\n+      procedure(dbar), pointer :: bar_ptr => dbar  ! { dg-error \"invalid in procedure pointer initialization\" }\n+\n+      call bar_ptr()\n+\n+    end subroutine\n+end module"}]}