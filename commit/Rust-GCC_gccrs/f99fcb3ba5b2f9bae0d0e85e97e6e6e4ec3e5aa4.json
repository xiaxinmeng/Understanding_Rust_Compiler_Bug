{"sha": "f99fcb3ba5b2f9bae0d0e85e97e6e6e4ec3e5aa4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Zjk5ZmNiM2JhNWIyZjliYWUwZDBlODVlOTdlNmU2ZTRlYzNlNWFhNA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2010-05-21T09:26:31Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2010-05-21T09:26:31Z"}, "message": "re PR debug/44205 (Wrong .debug_line for -O0 -g)\n\n\tPR debug/44205\n\t* tree-cfgcleanup.c (tree_forwarder_block_p): Return false if\n\tat -O0 goto_locus of any of the incoming edges differs from\n\tgoto_locus of outgoing edge, or gimple_location of any of the\n\tlabels differs.\n\nFrom-SVN: r159652", "tree": {"sha": "85e23c5f0a86207c9d08ae7c77431e63ddb68e01", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/85e23c5f0a86207c9d08ae7c77431e63ddb68e01"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f99fcb3ba5b2f9bae0d0e85e97e6e6e4ec3e5aa4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f99fcb3ba5b2f9bae0d0e85e97e6e6e4ec3e5aa4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f99fcb3ba5b2f9bae0d0e85e97e6e6e4ec3e5aa4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f99fcb3ba5b2f9bae0d0e85e97e6e6e4ec3e5aa4/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9db7d6ef74214e9737927193233935a7ac0d3907", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9db7d6ef74214e9737927193233935a7ac0d3907", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9db7d6ef74214e9737927193233935a7ac0d3907"}], "stats": {"total": 23, "additions": 18, "deletions": 5}, "files": [{"sha": "f666191353a9c873d888811e1469be66ee2bd6ca", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f99fcb3ba5b2f9bae0d0e85e97e6e6e4ec3e5aa4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f99fcb3ba5b2f9bae0d0e85e97e6e6e4ec3e5aa4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f99fcb3ba5b2f9bae0d0e85e97e6e6e4ec3e5aa4", "patch": "@@ -1,3 +1,11 @@\n+2010-05-21  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/44205\n+\t* tree-cfgcleanup.c (tree_forwarder_block_p): Return false if\n+\tat -O0 goto_locus of any of the incoming edges differs from\n+\tgoto_locus of outgoing edge, or gimple_location of any of the\n+\tlabels differs.\n+\n 2009-09-14  Vladimir Makarov <vmakarov@redhat.com>\n \n \t* ira.c (ira_non_ordered_class_hard_regs): Define."}, {"sha": "db7fb000af8d6d56aad257db7961c9c7a67cfba6", "filename": "gcc/tree-cfgcleanup.c", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f99fcb3ba5b2f9bae0d0e85e97e6e6e4ec3e5aa4/gcc%2Ftree-cfgcleanup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f99fcb3ba5b2f9bae0d0e85e97e6e6e4ec3e5aa4/gcc%2Ftree-cfgcleanup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfgcleanup.c?ref=f99fcb3ba5b2f9bae0d0e85e97e6e6e4ec3e5aa4", "patch": "@@ -267,6 +267,7 @@ static bool\n tree_forwarder_block_p (basic_block bb, bool phi_wanted)\n {\n   gimple_stmt_iterator gsi;\n+  location_t locus;\n \n   /* BB must have a single outgoing edge.  */\n   if (single_succ_p (bb) != 1\n@@ -285,6 +286,8 @@ tree_forwarder_block_p (basic_block bb, bool phi_wanted)\n   gcc_assert (bb != ENTRY_BLOCK_PTR);\n #endif\n \n+  locus = single_succ_edge (bb)->goto_locus;\n+\n   /* There should not be an edge coming from entry, or an EH edge.  */\n   {\n     edge_iterator ei;\n@@ -293,6 +296,10 @@ tree_forwarder_block_p (basic_block bb, bool phi_wanted)\n     FOR_EACH_EDGE (e, ei, bb->preds)\n       if (e->src == ENTRY_BLOCK_PTR || (e->flags & EDGE_EH))\n \treturn false;\n+      /* If goto_locus of any of the edges differs, prevent removing\n+\t the forwarder block for -O0.  */\n+      else if (optimize == 0 && e->goto_locus != locus)\n+\treturn false;\n   }\n \n   /* Now walk through the statements backward.  We can ignore labels,\n@@ -306,6 +313,8 @@ tree_forwarder_block_p (basic_block bb, bool phi_wanted)\n \tcase GIMPLE_LABEL:\n \t  if (DECL_NONLOCAL (gimple_label_label (stmt)))\n \t    return false;\n+\t  if (optimize == 0 && gimple_location (stmt) != locus)\n+\t    return false;\n \t  break;\n \n \t  /* ??? For now, hope there's a corresponding debug\n@@ -608,11 +617,7 @@ cleanup_tree_cfg_bb (basic_block bb)\n \n   retval = cleanup_control_flow_bb (bb);\n \n-  /* Forwarder blocks can carry line number information which is\n-     useful when debugging, so we only clean them up when\n-     optimizing.  */\n-  if (optimize > 0\n-      && tree_forwarder_block_p (bb, false)\n+  if (tree_forwarder_block_p (bb, false)\n       && remove_forwarder_block (bb))\n     return true;\n "}]}