{"sha": "ace725989eef16efea050619597f5c7f71667e1d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWNlNzI1OTg5ZWVmMTZlZmVhMDUwNjE5NTk3ZjVjN2Y3MTY2N2UxZA==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2017-11-02T20:13:18Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2017-11-02T20:13:18Z"}, "message": "Add selftest for diagnostic_get_location_text\n\ngcc/ChangeLog:\n\t* diagnostic.c: Include \"selftest-diagnostic.h\".\n\t(selftest::assert_location_text): New function.\n\t(selftest::test_diagnostic_get_location_text): New function.\n\t(selftest::diagnostic_c_tests): Call it.\n\nFrom-SVN: r254355", "tree": {"sha": "0fcf51848d421799ddb04ca6eab844a355620a32", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0fcf51848d421799ddb04ca6eab844a355620a32"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ace725989eef16efea050619597f5c7f71667e1d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ace725989eef16efea050619597f5c7f71667e1d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ace725989eef16efea050619597f5c7f71667e1d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ace725989eef16efea050619597f5c7f71667e1d/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ba7bfd9f049d00f41be1240adebf27e13bcac261", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba7bfd9f049d00f41be1240adebf27e13bcac261", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ba7bfd9f049d00f41be1240adebf27e13bcac261"}], "stats": {"total": 48, "additions": 48, "deletions": 0}, "files": [{"sha": "43df16a8933ecd4b5f29cad8762cd33e239a8943", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ace725989eef16efea050619597f5c7f71667e1d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ace725989eef16efea050619597f5c7f71667e1d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ace725989eef16efea050619597f5c7f71667e1d", "patch": "@@ -1,3 +1,10 @@\n+2017-11-02  David Malcolm  <dmalcolm@redhat.com>\n+\n+\t* diagnostic.c: Include \"selftest-diagnostic.h\".\n+\t(selftest::assert_location_text): New function.\n+\t(selftest::test_diagnostic_get_location_text): New function.\n+\t(selftest::diagnostic_c_tests): Call it.\n+\n 2017-11-02  David Malcolm  <dmalcolm@redhat.com>\n \n \t* Makefile.in (OBJS-libcommon): Add selftest-diagnostic.o."}, {"sha": "813bca6f65d3ff0611f4a961056e85f3bdb92a7a", "filename": "gcc/diagnostic.c", "status": "modified", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ace725989eef16efea050619597f5c7f71667e1d/gcc%2Fdiagnostic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ace725989eef16efea050619597f5c7f71667e1d/gcc%2Fdiagnostic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdiagnostic.c?ref=ace725989eef16efea050619597f5c7f71667e1d", "patch": "@@ -33,6 +33,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"diagnostic-color.h\"\n #include \"edit-context.h\"\n #include \"selftest.h\"\n+#include \"selftest-diagnostic.h\"\n \n #ifdef HAVE_TERMIOS_H\n # include <termios.h>\n@@ -1627,6 +1628,45 @@ test_print_parseable_fixits_replace ()\n \t\tpp_formatted_text (&pp));\n }\n \n+/* Verify that\n+     diagnostic_get_location_text (..., SHOW_COLUMN)\n+   generates EXPECTED_LOC_TEXT, given FILENAME, LINE, COLUMN, with\n+   colorization disabled.  */\n+\n+static void\n+assert_location_text (const char *expected_loc_text,\n+\t\t      const char *filename, int line, int column,\n+\t\t      bool show_column)\n+{\n+  test_diagnostic_context dc;\n+  dc.show_column = show_column;\n+\n+  expanded_location xloc;\n+  xloc.file = filename;\n+  xloc.line = line;\n+  xloc.column = column;\n+  xloc.data = NULL;\n+  xloc.sysp = false;\n+\n+  char *actual_loc_text = diagnostic_get_location_text (&dc, xloc);\n+  ASSERT_STREQ (expected_loc_text, actual_loc_text);\n+  free (actual_loc_text);\n+}\n+\n+/* Verify that diagnostic_get_location_text works as expected.  */\n+\n+static void\n+test_diagnostic_get_location_text ()\n+{\n+  const char *old_progname = progname;\n+  progname = \"PROGNAME\";\n+  assert_location_text (\"PROGNAME:\", NULL, 0, 0, true);\n+  assert_location_text (\"<built-in>:\", \"<built-in>\", 42, 10, true);\n+  assert_location_text (\"foo.c:42:10:\", \"foo.c\", 42, 10, true);\n+  assert_location_text (\"foo.c:42:\", \"foo.c\", 42, 10, false);\n+  progname = old_progname;\n+}\n+\n /* Run all of the selftests within this file.  */\n \n void\n@@ -1637,6 +1677,7 @@ diagnostic_c_tests ()\n   test_print_parseable_fixits_insert ();\n   test_print_parseable_fixits_remove ();\n   test_print_parseable_fixits_replace ();\n+  test_diagnostic_get_location_text ();\n }\n \n } // namespace selftest"}]}