{"sha": "d45871da6e9ec5907510d65834ab69e781b3afa5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDQ1ODcxZGE2ZTllYzU5MDc1MTBkNjU4MzRhYjY5ZTc4MWIzYWZhNQ==", "commit": {"author": {"name": "Emmanuel Briot", "email": "briot@adacore.com", "date": "2009-04-29T09:52:34Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-29T09:52:34Z"}, "message": "prj-ext.adb, [...]: Fix memory leaks.\n\n2009-04-29  Emmanuel Briot  <briot@adacore.com>\n\n\t* prj-ext.adb, prj.adb, prj.ads: Fix memory leaks.\n\n\t* clean.adb (Ultimate_Extension_Of): removed, since duplicate of\n\t Prj.Ultimate_Extending_Project_Of\n\nFrom-SVN: r146940", "tree": {"sha": "8c7c972f643916965294bb7ff102908a09236dcf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8c7c972f643916965294bb7ff102908a09236dcf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d45871da6e9ec5907510d65834ab69e781b3afa5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d45871da6e9ec5907510d65834ab69e781b3afa5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d45871da6e9ec5907510d65834ab69e781b3afa5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d45871da6e9ec5907510d65834ab69e781b3afa5/comments", "author": {"login": "briot", "id": 42402, "node_id": "MDQ6VXNlcjQyNDAy", "avatar_url": "https://avatars.githubusercontent.com/u/42402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/briot", "html_url": "https://github.com/briot", "followers_url": "https://api.github.com/users/briot/followers", "following_url": "https://api.github.com/users/briot/following{/other_user}", "gists_url": "https://api.github.com/users/briot/gists{/gist_id}", "starred_url": "https://api.github.com/users/briot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/briot/subscriptions", "organizations_url": "https://api.github.com/users/briot/orgs", "repos_url": "https://api.github.com/users/briot/repos", "events_url": "https://api.github.com/users/briot/events{/privacy}", "received_events_url": "https://api.github.com/users/briot/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4f87ded359716679d2b3c6225e7569ff4cb4b76f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f87ded359716679d2b3c6225e7569ff4cb4b76f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f87ded359716679d2b3c6225e7569ff4cb4b76f"}], "stats": {"total": 79, "additions": 29, "deletions": 50}, "files": [{"sha": "968ec55e1a6698a875f9221d60a9cf218f5dd820", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d45871da6e9ec5907510d65834ab69e781b3afa5/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d45871da6e9ec5907510d65834ab69e781b3afa5/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=d45871da6e9ec5907510d65834ab69e781b3afa5", "patch": "@@ -1,3 +1,10 @@\n+2009-04-29  Emmanuel Briot  <briot@adacore.com>\n+\n+\t* prj-ext.adb, prj.adb, prj.ads: Fix memory leaks.\n+\n+\t* clean.adb (Ultimate_Extension_Of): removed, since duplicate of\n+\t Prj.Ultimate_Extending_Project_Of\n+\n 2009-04-29  Ed Schonberg  <schonberg@adacore.com>\n \n \t* exp_ch7.adb (Build_Final_List): If the designated type is a Taft"}, {"sha": "eac192903b374da9219c11cfcf532b96a1a357c2", "filename": "gcc/ada/clean.adb", "status": "modified", "additions": 4, "deletions": 27, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d45871da6e9ec5907510d65834ab69e781b3afa5/gcc%2Fada%2Fclean.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d45871da6e9ec5907510d65834ab69e781b3afa5/gcc%2Fada%2Fclean.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fclean.adb?ref=d45871da6e9ec5907510d65834ab69e781b3afa5", "patch": "@@ -242,11 +242,6 @@ package body Clean is\n    --  Returns True iff Prj is an extension of Of_Project or if Of_Project is\n    --  an extension of Prj.\n \n-   function Ultimate_Extension_Of (Project : Project_Id) return Project_Id;\n-   --  Returns either Project, if it is not extended by another project, or\n-   --  the project that extends Project, directly or indirectly, and that is\n-   --  not itself extended. Returns No_Project if Project is No_Project.\n-\n    procedure Usage;\n    --  Display the usage. If called several times, the usage is displayed only\n    --  the first time.\n@@ -582,7 +577,7 @@ package body Clean is\n                      loop\n                         Unit := Project_Tree.Units.Table (Index);\n \n-                        if Ultimate_Extension_Of\n+                        if Ultimate_Extending_Project_Of\n                           (Unit.File_Names (Body_Part).Project) = Project\n                           and then\n                             Get_Name_String\n@@ -593,7 +588,7 @@ package body Clean is\n                            exit;\n                         end if;\n \n-                        if Ultimate_Extension_Of\n+                        if Ultimate_Extending_Project_Of\n                           (Unit.File_Names (Specification).Project) = Project\n                           and then\n                             Get_Name_String\n@@ -749,7 +744,7 @@ package body Clean is\n                               if Unit.File_Names (Body_Part).Project /=\n                                 No_Project\n                               then\n-                                 if Ultimate_Extension_Of\n+                                 if Ultimate_Extending_Project_Of\n                                    (Unit.File_Names (Body_Part).Project) =\n                                    Project\n                                  then\n@@ -766,7 +761,7 @@ package body Clean is\n                                     end if;\n                                  end if;\n \n-                              elsif Ultimate_Extension_Of\n+                              elsif Ultimate_Extending_Project_Of\n                                 (Unit.File_Names (Specification).Project) =\n                                 Project\n                               then\n@@ -1905,24 +1900,6 @@ package body Clean is\n       return Src & Tree_Suffix;\n    end Tree_File_Name;\n \n-   ---------------------------\n-   -- Ultimate_Extension_Of --\n-   ---------------------------\n-\n-   function Ultimate_Extension_Of (Project : Project_Id) return Project_Id is\n-      Result : Project_Id := Project;\n-\n-   begin\n-      if Project /= No_Project then\n-         loop\n-            exit when Result.Extended_By = No_Project;\n-            Result := Result.Extended_By;\n-         end loop;\n-      end if;\n-\n-      return Result;\n-   end Ultimate_Extension_Of;\n-\n    -----------\n    -- Usage --\n    -----------"}, {"sha": "50751c22c3ecad12caac951cb94407853dbec80c", "filename": "gcc/ada/prj-ext.adb", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d45871da6e9ec5907510d65834ab69e781b3afa5/gcc%2Fada%2Fprj-ext.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d45871da6e9ec5907510d65834ab69e781b3afa5/gcc%2Fada%2Fprj-ext.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-ext.adb?ref=d45871da6e9ec5907510d65834ab69e781b3afa5", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2000-2008, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2000-2009, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -281,6 +281,8 @@ package body Prj.Ext is\n                              \"..\" & Directory_Separator &\n                              \"..\" & Directory_Separator & \"gnat\");\n             end if;\n+\n+            Free (Prefix);\n          end;\n       end if;\n "}, {"sha": "b5f924d3aa5936f28a9af6dab9141e61acfb5f7e", "filename": "gcc/ada/prj.adb", "status": "modified", "additions": 11, "deletions": 15, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d45871da6e9ec5907510d65834ab69e781b3afa5/gcc%2Fada%2Fprj.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d45871da6e9ec5907510d65834ab69e781b3afa5/gcc%2Fada%2Fprj.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.adb?ref=d45871da6e9ec5907510d65834ab69e781b3afa5", "patch": "@@ -143,7 +143,7 @@ package body Prj is\n    --  Table to store the path name of all the created temporary files, so that\n    --  they can be deleted at the end, or when the program is interrupted.\n \n-   procedure Free (Project : in out Project_Id; Reset_Only : Boolean);\n+   procedure Free (Project : in out Project_Id);\n    --  Free memory allocated for Project\n \n    procedure Free_List (Languages : in out Language_Ptr);\n@@ -825,7 +825,7 @@ package body Prj is\n    -- Free --\n    ----------\n \n-   procedure Free (Project : in out Project_Id; Reset_Only : Boolean) is\n+   procedure Free (Project : in out Project_Id) is\n       procedure Unchecked_Free is new Ada.Unchecked_Deallocation\n         (Project_Data, Project_Id);\n \n@@ -835,13 +835,9 @@ package body Prj is\n          Free (Project.Ada_Include_Path);\n          Free (Project.Objects_Path);\n          Free (Project.Ada_Objects_Path);\n-\n          Free_List (Project.Imported_Projects, Free_Project => False);\n          Free_List (Project.All_Imported_Projects, Free_Project => False);\n-\n-         if not Reset_Only then\n-            Free_List (Project.Languages);\n-         end if;\n+         Free_List (Project.Languages);\n \n          Unchecked_Free (Project);\n       end if;\n@@ -886,8 +882,7 @@ package body Prj is\n \n    procedure Free_List\n      (List         : in out Project_List;\n-      Free_Project : Boolean;\n-      Reset_Only   : Boolean := True)\n+      Free_Project : Boolean)\n    is\n       procedure Unchecked_Free is new Ada.Unchecked_Deallocation\n         (Project_List_Element, Project_List);\n@@ -898,7 +893,7 @@ package body Prj is\n          Tmp := List.Next;\n \n          if Free_Project then\n-            Free (List.Project, Reset_Only => Reset_Only);\n+            Free (List.Project);\n          end if;\n \n          Unchecked_Free (List);\n@@ -944,18 +939,19 @@ package body Prj is\n          Source_Paths_Htable.Reset (Tree.Source_Paths_HT);\n          Unit_Sources_Htable.Reset (Tree.Unit_Sources_HT);\n \n-         Free_List (Tree.Projects, Free_Project => True, Reset_Only => False);\n+         Free_List (Tree.Projects, Free_Project => True);\n \n          --  Private part\n \n-         Naming_Table.Free (Tree.Private_Part.Namings);\n-         Path_File_Table.Free (Tree.Private_Part.Path_Files);\n+         Naming_Table.Free      (Tree.Private_Part.Namings);\n+         Path_File_Table.Free   (Tree.Private_Part.Path_Files);\n          Source_Path_Table.Free (Tree.Private_Part.Source_Paths);\n          Object_Path_Table.Free (Tree.Private_Part.Object_Paths);\n \n          Free (Tree.Private_Part.Ada_Path_Buffer);\n \n-         --  Naming data (nothing to free ?)\n+         --  Naming data (nothing to free ???)\n+\n          null;\n \n          Unchecked_Free (Tree);\n@@ -981,7 +977,7 @@ package body Prj is\n       Source_Paths_Htable.Reset     (Tree.Source_Paths_HT);\n       Unit_Sources_Htable.Reset     (Tree.Unit_Sources_HT);\n \n-      Free_List (Tree.Projects, Free_Project => True, Reset_Only => True);\n+      Free_List (Tree.Projects, Free_Project => True);\n \n       --  Private part table\n "}, {"sha": "e903fbc39465d9045ea142fd63276db65594f9bb", "filename": "gcc/ada/prj.ads", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d45871da6e9ec5907510d65834ab69e781b3afa5/gcc%2Fada%2Fprj.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d45871da6e9ec5907510d65834ab69e781b3afa5/gcc%2Fada%2Fprj.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.ads?ref=d45871da6e9ec5907510d65834ab69e781b3afa5", "patch": "@@ -161,7 +161,7 @@ package Prj is\n    No_Path_Information : constant Path_Information := (No_Path, No_Path);\n \n    type Project_Data;\n-   type Project_Id is access Project_Data;\n+   type Project_Id is access all Project_Data;\n    No_Project : constant Project_Id := null;\n    --  Id of a Project File\n \n@@ -604,7 +604,7 @@ package Prj is\n                          Next          => No_Language_Index);\n \n    type Language_List_Element;\n-   type Language_List is access Language_List_Element;\n+   type Language_List is access all Language_List_Element;\n    type Language_List_Element is record\n       Language : Language_Ptr := No_Language_Index;\n       Next     : Language_List;\n@@ -928,7 +928,7 @@ package Prj is\n    --  not considering Specs and Bodies.\n \n    type Project_List_Element;\n-   type Project_List is access Project_List_Element;\n+   type Project_List is access all Project_List_Element;\n    type Project_List_Element is record\n       Project : Project_Id   := No_Project;\n       Next    : Project_List := null;\n@@ -937,11 +937,8 @@ package Prj is\n \n    procedure Free_List\n      (List         : in out Project_List;\n-      Free_Project : Boolean;\n-      Reset_Only   : Boolean := True);\n+      Free_Project : Boolean);\n    --  Free the list of projects. If Free_Project, each project is also freed.\n-   --  When Free_Project is True, Reset_Only indicates whether the specific\n-   --  languages should also be freed.\n \n    type Response_File_Format is\n      (None,"}]}