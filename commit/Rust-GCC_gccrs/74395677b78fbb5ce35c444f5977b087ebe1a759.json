{"sha": "74395677b78fbb5ce35c444f5977b087ebe1a759", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzQzOTU2NzdiNzhmYmI1Y2UzNWM0NDRmNTk3N2IwODdlYmUxYTc1OQ==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2005-10-18T03:12:55Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2005-10-18T03:12:55Z"}, "message": "builtins.c (expand_builtin_synchronize): Build a new-style asm with a memory clobber.\n\n        * builtins.c (expand_builtin_synchronize): Build a new-style asm\n        with a memory clobber.\n\nFrom-SVN: r105535", "tree": {"sha": "1a015ec6e9cf29438c20526eaeedcef23eecd008", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1a015ec6e9cf29438c20526eaeedcef23eecd008"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/74395677b78fbb5ce35c444f5977b087ebe1a759", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/74395677b78fbb5ce35c444f5977b087ebe1a759", "html_url": "https://github.com/Rust-GCC/gccrs/commit/74395677b78fbb5ce35c444f5977b087ebe1a759", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/74395677b78fbb5ce35c444f5977b087ebe1a759/comments", "author": null, "committer": null, "parents": [{"sha": "1b2914a08690ba27783457d7ebe250afba9bd9f2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1b2914a08690ba27783457d7ebe250afba9bd9f2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1b2914a08690ba27783457d7ebe250afba9bd9f2"}], "stats": {"total": 18, "additions": 12, "deletions": 6}, "files": [{"sha": "91973cd7465ff1dcd732d80537a9df67172b1b44", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/74395677b78fbb5ce35c444f5977b087ebe1a759/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/74395677b78fbb5ce35c444f5977b087ebe1a759/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=74395677b78fbb5ce35c444f5977b087ebe1a759", "patch": "@@ -1,3 +1,8 @@\n+2005-10-17  Richard Henderson  <rth@redhat.com>\n+\n+\t* builtins.c (expand_builtin_synchronize): Build a new-style asm\n+\twith a memory clobber.\n+\n 2005-10-17  James E Wilson  <wilson@specifix.com>\n \n \tPR rtl-optimization/17356"}, {"sha": "a9fe858250187c566a9d412177abd131c1af831a", "filename": "gcc/builtins.c", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/74395677b78fbb5ce35c444f5977b087ebe1a759/gcc%2Fbuiltins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/74395677b78fbb5ce35c444f5977b087ebe1a759/gcc%2Fbuiltins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.c?ref=74395677b78fbb5ce35c444f5977b087ebe1a759", "patch": "@@ -5501,7 +5501,7 @@ expand_builtin_lock_test_and_set (enum machine_mode mode, tree arglist,\n static void\n expand_builtin_synchronize (void)\n {\n-  rtx body;\n+  tree x;\n \n #ifdef HAVE_memory_barrier\n   if (HAVE_memory_barrier)\n@@ -5511,11 +5511,12 @@ expand_builtin_synchronize (void)\n     }\n #endif\n \n-  /* If no explicit memory barrier instruction is available, create an empty\n-     asm stmt that will prevent compiler movement across the barrier.  */\n-  body = gen_rtx_ASM_INPUT (VOIDmode, \"\");\n-  MEM_VOLATILE_P (body) = 1;\n-  emit_insn (body);\n+  /* If no explicit memory barrier instruction is available, create an\n+     empty asm stmt with a memory clobber.  */\n+  x = build4 (ASM_EXPR, void_type_node, build_string (0, \"\"), NULL, NULL,\n+\t      tree_cons (NULL, build_string (6, \"memory\"), NULL));\n+  ASM_VOLATILE_P (x) = 1;\n+  expand_asm_expr (x);\n }\n \n /* Expand the __sync_lock_release intrinsic.  ARGLIST is the operands list"}]}