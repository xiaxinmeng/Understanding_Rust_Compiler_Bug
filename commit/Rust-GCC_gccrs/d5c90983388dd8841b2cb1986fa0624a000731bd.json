{"sha": "d5c90983388dd8841b2cb1986fa0624a000731bd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDVjOTA5ODMzODhkZDg4NDFiMmNiMTk4NmZhMDYyNGEwMDA3MzFiZA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2012-05-14T17:06:19Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2012-05-14T17:06:19Z"}, "message": "dwarf2out.c (have_macinfo): Define.\n\n\t* dwarf2out.c (have_macinfo): Define.\n\t(dwarf2out_finish): Don't emit DW_AT_GNU_macros or DW_AT_macro_info\n\tattribute, don't force empty compilation unit and don't emit any\n\t.debug_macinfo/.debug_macro section if macinfo_table is empty.\n\nFrom-SVN: r187473", "tree": {"sha": "6f616a680652148a97d51b2779585b212e19dac5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6f616a680652148a97d51b2779585b212e19dac5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d5c90983388dd8841b2cb1986fa0624a000731bd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d5c90983388dd8841b2cb1986fa0624a000731bd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d5c90983388dd8841b2cb1986fa0624a000731bd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d5c90983388dd8841b2cb1986fa0624a000731bd/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6052c299313c0cb62c2ff2666c94d92d3a039b83", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6052c299313c0cb62c2ff2666c94d92d3a039b83", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6052c299313c0cb62c2ff2666c94d92d3a039b83"}], "stats": {"total": 24, "additions": 18, "deletions": 6}, "files": [{"sha": "5efbfe5ff96f8b8eae26b8d1ae4c04873c13c66f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5c90983388dd8841b2cb1986fa0624a000731bd/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5c90983388dd8841b2cb1986fa0624a000731bd/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d5c90983388dd8841b2cb1986fa0624a000731bd", "patch": "@@ -1,3 +1,10 @@\n+2012-05-14  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* dwarf2out.c (have_macinfo): Define.\n+\t(dwarf2out_finish): Don't emit DW_AT_GNU_macros or DW_AT_macro_info\n+\tattribute, don't force empty compilation unit and don't emit any\n+\t.debug_macinfo/.debug_macro section if macinfo_table is empty.\n+\n 2012-05-14  Georg-Johann Lay  <avr@gjlay.de>\n \n \tPR target/53344"}, {"sha": "a92881b2d9cfe8cbed9c540eb4f8fab994383a13", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5c90983388dd8841b2cb1986fa0624a000731bd/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5c90983388dd8841b2cb1986fa0624a000731bd/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=d5c90983388dd8841b2cb1986fa0624a000731bd", "patch": "@@ -2799,6 +2799,12 @@ static GTY (()) VEC (pubname_entry, gc) * pubtype_table;\n    defines/undefines (and file start/end markers).  */\n static GTY (()) VEC (macinfo_entry, gc) * macinfo_table;\n \n+/* True if .debug_macinfo or .debug_macros section is going to be\n+   emitted.  */\n+#define have_macinfo \\\n+  (debug_info_level >= DINFO_LEVEL_VERBOSE \\\n+   && !VEC_empty (macinfo_entry, macinfo_table))\n+\n /* Array of dies for which we should generate .debug_ranges info.  */\n static GTY ((length (\"ranges_table_allocated\"))) dw_ranges_ref ranges_table;\n \n@@ -22140,7 +22146,7 @@ dwarf2out_finish (const char *filename)\n     add_AT_lineptr (comp_unit_die (), DW_AT_stmt_list,\n \t\t    debug_line_section_label);\n \n-  if (debug_info_level >= DINFO_LEVEL_VERBOSE)\n+  if (have_macinfo)\n     add_AT_macptr (comp_unit_die (),\n \t\t   dwarf_strict ? DW_AT_macro_info : DW_AT_GNU_macros,\n \t\t   macinfo_section_label);\n@@ -22175,8 +22181,8 @@ dwarf2out_finish (const char *filename)\n   htab_delete (comdat_type_table);\n \n   /* Output the main compilation unit if non-empty or if .debug_macinfo\n-     will be emitted.  */\n-  output_comp_unit (comp_unit_die (), debug_info_level >= DINFO_LEVEL_VERBOSE);\n+     or .debug_macro will be emitted.  */\n+  output_comp_unit (comp_unit_die (), have_macinfo);\n \n   /* Output the abbreviation table.  */\n   if (abbrev_die_table_in_use != 1)\n@@ -22256,12 +22262,11 @@ dwarf2out_finish (const char *filename)\n     }\n \n   /* Have to end the macro section.  */\n-  if (debug_info_level >= DINFO_LEVEL_VERBOSE)\n+  if (have_macinfo)\n     {\n       switch_to_section (debug_macinfo_section);\n       ASM_OUTPUT_LABEL (asm_out_file, macinfo_section_label);\n-      if (!VEC_empty (macinfo_entry, macinfo_table))\n-\toutput_macinfo ();\n+      output_macinfo ();\n       dw2_asm_output_data (1, 0, \"End compilation unit\");\n     }\n "}]}