{"sha": "3e4d188a5fe6df5994af7ee800614305afb7f8f7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2U0ZDE4OGE1ZmU2ZGY1OTk0YWY3ZWU4MDA2MTQzMDVhZmI3ZjhmNw==", "commit": {"author": {"name": "Andre Vehreschild", "email": "vehre@gcc.gnu.org", "date": "2015-11-08T17:37:42Z"}, "committer": {"name": "Andre Vehreschild", "email": "vehre@gcc.gnu.org", "date": "2015-11-08T17:37:42Z"}, "message": "re PR fortran/68218 (ALLOCATE with size given by a module function)\n\ngcc/fortran/ChangeLog:\n\n2015-11-08  Andre Vehreschild  <vehre@gcc.gnu.org>\n\n\tPR fortran/68218\n\t* trans-array.c (gfc_array_init_size): Add gfc_evaluate_now() when\n\tarray spec in allocate is a function call.\n\ngcc/testsuite/ChangeLog:\n\n2015-11-08  Andre Vehreschild  <vehre@gcc.gnu.org>\n\n\tPR fortran/68218\n\t* gfortran.dg/allocate_with_arrayspec_1.f90: New test.\n\nFrom-SVN: r229956", "tree": {"sha": "0dd2be76bd06a73d4408b68fe1cf35636d5f4734", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0dd2be76bd06a73d4408b68fe1cf35636d5f4734"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3e4d188a5fe6df5994af7ee800614305afb7f8f7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e4d188a5fe6df5994af7ee800614305afb7f8f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3e4d188a5fe6df5994af7ee800614305afb7f8f7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e4d188a5fe6df5994af7ee800614305afb7f8f7/comments", "author": null, "committer": null, "parents": [{"sha": "28bc117f586fbb15b887e6517e2b08330fec91c0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/28bc117f586fbb15b887e6517e2b08330fec91c0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/28bc117f586fbb15b887e6517e2b08330fec91c0"}], "stats": {"total": 42, "additions": 42, "deletions": 0}, "files": [{"sha": "78644b876b11c6d9f2e15c674ed8bd6e49011db4", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e4d188a5fe6df5994af7ee800614305afb7f8f7/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e4d188a5fe6df5994af7ee800614305afb7f8f7/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=3e4d188a5fe6df5994af7ee800614305afb7f8f7", "patch": "@@ -1,3 +1,9 @@\n+2015-11-08  Andre Vehreschild  <vehre@gcc.gnu.org>\n+\n+\tPR fortran/68218\n+\t* trans-array.c (gfc_array_init_size): Add gfc_evaluate_now() when\n+\tarray spec in allocate is a function call.\n+\n 2015-11-08  Steven G. Kargl  <kargl@gc.gnu.org>\n \n \tPR fortran/68224"}, {"sha": "e28a5ce3c0bb572ffe45000f84017e103a1b2507", "filename": "gcc/fortran/trans-array.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e4d188a5fe6df5994af7ee800614305afb7f8f7/gcc%2Ffortran%2Ftrans-array.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e4d188a5fe6df5994af7ee800614305afb7f8f7/gcc%2Ffortran%2Ftrans-array.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.c?ref=3e4d188a5fe6df5994af7ee800614305afb7f8f7", "patch": "@@ -5150,6 +5150,8 @@ gfc_array_init_size (tree descriptor, int rank, int corank, tree * poffset,\n \t  gcc_assert (ubound);\n \t  gfc_conv_expr_type (&se, ubound, gfc_array_index_type);\n \t  gfc_add_block_to_block (pblock, &se.pre);\n+\t  if (ubound->expr_type == EXPR_FUNCTION)\n+\t    se.expr = gfc_evaluate_now (se.expr, pblock);\n \t}\n       gfc_conv_descriptor_ubound_set (descriptor_block, descriptor,\n \t\t\t\t      gfc_rank_cst[n], se.expr);"}, {"sha": "a95aa8dda8163593e1a19659013360ccf1b78a6e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e4d188a5fe6df5994af7ee800614305afb7f8f7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e4d188a5fe6df5994af7ee800614305afb7f8f7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3e4d188a5fe6df5994af7ee800614305afb7f8f7", "patch": "@@ -1,3 +1,8 @@\n+2015-11-08  Andre Vehreschild  <vehre@gcc.gnu.org>\n+\n+\tPR fortran/68218\n+\t* gfortran.dg/allocate_with_arrayspec_1.f90: New test.\n+\n 2015-11-08  Steven G. Kargl  <kargl@gc.gnu.org>\n \n \tPR fortran/68224"}, {"sha": "686b612408a640fde43f027687cdc68e7dda976a", "filename": "gcc/testsuite/gfortran.dg/allocate_with_arrayspec_1.f90", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e4d188a5fe6df5994af7ee800614305afb7f8f7/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_arrayspec_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e4d188a5fe6df5994af7ee800614305afb7f8f7/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_arrayspec_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_arrayspec_1.f90?ref=3e4d188a5fe6df5994af7ee800614305afb7f8f7", "patch": "@@ -0,0 +1,29 @@\n+! { dg-do run }\n+! { dg-options \"-fdump-tree-original\" }\n+\n+MODULE mo_test\n+\n+  integer :: n = 0\n+CONTAINS\n+\n+  FUNCTION nquery()\n+    INTEGER :: nquery\n+    WRITE (0,*) \"hello!\"\n+    n = n + 1\n+    nquery = n\n+  END FUNCTION nquery\n+\n+END MODULE mo_test\n+\n+\n+! ----------------------------------------------------------------------\n+! MAIN PROGRAM\n+! ----------------------------------------------------------------------\n+PROGRAM example\n+   USE mo_test\n+   INTEGER, ALLOCATABLE :: query_buf(:)\n+   ALLOCATE(query_buf(nquery()))\n+   if (n /= 1 .or. size(query_buf) /= n) call abort()\n+END PROGRAM example\n+\n+! { dg-final { scan-tree-dump-times \"nquery\" 5 \"original\" } }"}]}