{"sha": "c4712597e1c5c51dc348628a52846026083c467d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzQ3MTI1OTdlMWM1YzUxZGMzNDg2MjhhNTI4NDYwMjYwODNjNDY3ZA==", "commit": {"author": {"name": "Shujing Zhao", "email": "pearly.zhao@oracle.com", "date": "2010-04-12T03:43:21Z"}, "committer": {"name": "Shujing Zhao", "email": "pzhao@gcc.gnu.org", "date": "2010-04-12T03:43:21Z"}, "message": "re PR c/36774 (-Wmissing-prototypes triggers on nested functions)\n\ngcc/\n2010-04-12  Shujing Zhao  <pearly.zhao@oracle.com>\n\n        PR c/36774\n        * c-decl.c (start_function): Move forward check for nested function.\n\ngcc/testsuite/\n2010-04-12  Shujing Zhao  <pearly.zhao@oracle.com>\n\n        PR c/36774\n        * gcc.dg/pr36774-1.c: New test.\n        * gcc.dg/pr36774-2.c: New test.\n\nFrom-SVN: r158214", "tree": {"sha": "c9d1a94f68ad29d1a4a8f141264498a069c139af", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c9d1a94f68ad29d1a4a8f141264498a069c139af"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c4712597e1c5c51dc348628a52846026083c467d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4712597e1c5c51dc348628a52846026083c467d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c4712597e1c5c51dc348628a52846026083c467d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4712597e1c5c51dc348628a52846026083c467d/comments", "author": null, "committer": null, "parents": [{"sha": "fe5859f04b306556fcba138b4f30a6553378c23a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fe5859f04b306556fcba138b4f30a6553378c23a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fe5859f04b306556fcba138b4f30a6553378c23a"}], "stats": {"total": 37, "additions": 33, "deletions": 4}, "files": [{"sha": "66b45437841cce64a428a26c77cb2298384bfbe0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4712597e1c5c51dc348628a52846026083c467d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4712597e1c5c51dc348628a52846026083c467d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c4712597e1c5c51dc348628a52846026083c467d", "patch": "@@ -1,3 +1,8 @@\n+2010-04-12  Shujing Zhao  <pearly.zhao@oracle.com>\n+\n+\tPR c/36774\n+\t* c-decl.c (start_function): Move forward check for nested function.\n+\n 2010-04-11  Kaz Kojima  <kkojima@gcc.gnu.org>\n \n \t* config/sh/sh-protos.h (sh_legitimize_reload_address): Declare."}, {"sha": "bf8555715b072ec92f91be31ccc444491f7e434d", "filename": "gcc/c-decl.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4712597e1c5c51dc348628a52846026083c467d/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4712597e1c5c51dc348628a52846026083c467d/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=c4712597e1c5c51dc348628a52846026083c467d", "patch": "@@ -7443,6 +7443,10 @@ start_function (struct c_declspecs *declspecs, struct c_declarator *declarator,\n      error_mark_node is replaced below (in pop_scope) with the BLOCK.  */\n   DECL_INITIAL (decl1) = error_mark_node;\n \n+  /* A nested function is not global.  */\n+  if (current_function_decl != 0)\n+    TREE_PUBLIC (decl1) = 0;\n+\n   /* If this definition isn't a prototype and we had a prototype declaration\n      before, copy the arg type info from that prototype.  */\n   old_decl = lookup_name_in_scope (DECL_NAME (decl1), current_scope);\n@@ -7543,10 +7547,6 @@ start_function (struct c_declspecs *declspecs, struct c_declarator *declarator,\n      (This does not mean `static' in the C sense!)  */\n   TREE_STATIC (decl1) = 1;\n \n-  /* A nested function is not global.  */\n-  if (current_function_decl != 0)\n-    TREE_PUBLIC (decl1) = 0;\n-\n   /* This is the earliest point at which we might know the assembler\n      name of the function.  Thus, if it's set before this, die horribly.  */\n   gcc_assert (!DECL_ASSEMBLER_NAME_SET_P (decl1));"}, {"sha": "d5cddd4cf345dba9175d6e452b9627cfe4c87b13", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4712597e1c5c51dc348628a52846026083c467d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4712597e1c5c51dc348628a52846026083c467d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c4712597e1c5c51dc348628a52846026083c467d", "patch": "@@ -1,3 +1,9 @@\n+2010-04-12  Shujing Zhao  <pearly.zhao@oracle.com>\n+\n+\tPR c/36774\n+\t* gcc.dg/pr36774-1.c: New test.\n+\t* gcc.dg/pr36774-2.c: New test.\n+\n 2010-04-11  Kaushik Phatak  <kaushik.phatak@kpitcummins.com>\n \n \t* gcc.target/sh/rte-delay-slot.c: New test."}, {"sha": "10a5e5fb09d7164d6b6e4ebcafef10917350260c", "filename": "gcc/testsuite/gcc.dg/pr36774-1.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4712597e1c5c51dc348628a52846026083c467d/gcc%2Ftestsuite%2Fgcc.dg%2Fpr36774-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4712597e1c5c51dc348628a52846026083c467d/gcc%2Ftestsuite%2Fgcc.dg%2Fpr36774-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr36774-1.c?ref=c4712597e1c5c51dc348628a52846026083c467d", "patch": "@@ -0,0 +1,9 @@\n+/* Nested functions shouldn't produce warnings if defined before first use.\n+   Bug 36774. Test with -Wmissing-prototypes. */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wmissing-prototypes\" } */\n+\n+int foo(int a) { /* { dg-warning \"no previous prototype\" } */\n+    int bar(int b) { return b; } /* { dg-bogus \"no previous prototype\" } */\n+    return bar(a);\n+}"}, {"sha": "bf394c9cac914000d5b5127d068ca82d0c339d56", "filename": "gcc/testsuite/gcc.dg/pr36774-2.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4712597e1c5c51dc348628a52846026083c467d/gcc%2Ftestsuite%2Fgcc.dg%2Fpr36774-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4712597e1c5c51dc348628a52846026083c467d/gcc%2Ftestsuite%2Fgcc.dg%2Fpr36774-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr36774-2.c?ref=c4712597e1c5c51dc348628a52846026083c467d", "patch": "@@ -0,0 +1,9 @@\n+/* Nested functions shouldn't produce warnings if defined before first use.\n+   Bug 36774. Test with -Wmissing-declarations. */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wmissing-declarations\" } */\n+\n+int foo(int a) { /* { dg-warning \"no previous declaration\" } */\n+    int bar(int b) { return b; } /* { dg-bogus \"no previous declaration\" } */\n+    return bar(a);\n+}"}]}