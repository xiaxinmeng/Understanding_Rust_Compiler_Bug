{"sha": "ea15e254ea970653f092da0993d99b15b1f2283b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWExNWUyNTRlYTk3MDY1M2YwOTJkYTA5OTNkOTliMTViMWYyMjgzYg==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2014-01-23T16:31:52Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2014-01-23T16:31:52Z"}, "message": "re PR c++/58980 (ICE with invalid enum declaration)\n\n/cp\n2014-01-23  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/58980\n\t* parser.c (cp_parser_enum_specifier): Handle TYPENAME_TYPE as\n\tnested_name_specifier.\n\n/testsuite\n2014-01-23  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/58980\n\t* g++.dg/parse/enum11.C: New.\n\nFrom-SVN: r206979", "tree": {"sha": "3b27514e1daba4a08c81b12038a6738835367068", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3b27514e1daba4a08c81b12038a6738835367068"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ea15e254ea970653f092da0993d99b15b1f2283b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ea15e254ea970653f092da0993d99b15b1f2283b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ea15e254ea970653f092da0993d99b15b1f2283b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ea15e254ea970653f092da0993d99b15b1f2283b/comments", "author": null, "committer": null, "parents": [{"sha": "f9a4c9a61396acaea09951aa26b57375a14ac632", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f9a4c9a61396acaea09951aa26b57375a14ac632", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f9a4c9a61396acaea09951aa26b57375a14ac632"}], "stats": {"total": 35, "additions": 31, "deletions": 4}, "files": [{"sha": "bc49f24482565028ec734996ce462b4b905809c5", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ea15e254ea970653f092da0993d99b15b1f2283b/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ea15e254ea970653f092da0993d99b15b1f2283b/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=ea15e254ea970653f092da0993d99b15b1f2283b", "patch": "@@ -1,3 +1,9 @@\n+2014-01-23  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/58980\n+\t* parser.c (cp_parser_enum_specifier): Handle TYPENAME_TYPE as\n+\tnested_name_specifier.\n+\n 2014-01-23  Balaji V. Iyer  <balaji.v.iyer@intel.com>\n \n \t* parser.c (cp_parser_direct_declarator): When Cilk Plus is enabled"}, {"sha": "c02de3bf9edcd681d8aea1838e85c744cbd298a8", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ea15e254ea970653f092da0993d99b15b1f2283b/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ea15e254ea970653f092da0993d99b15b1f2283b/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=ea15e254ea970653f092da0993d99b15b1f2283b", "patch": "@@ -15474,9 +15474,18 @@ cp_parser_enum_specifier (cp_parser* parser)\n \t    error_at (type_start_token->location, \"cannot add an enumerator \"\n \t\t      \"list to a template instantiation\");\n \n+\t  if (TREE_CODE (nested_name_specifier) == TYPENAME_TYPE)\n+\t    {\n+\t      error_at (type_start_token->location,\n+\t\t\t\"%<%T::%E%> has not been declared\",\n+\t\t\tTYPE_CONTEXT (nested_name_specifier),\n+\t\t\tnested_name_specifier);\n+\t      type = error_mark_node;\n+\t    }\n \t  /* If that scope does not contain the scope in which the\n \t     class was originally declared, the program is invalid.  */\n-\t  if (prev_scope && !is_ancestor (prev_scope, nested_name_specifier))\n+\t  else if (prev_scope && !is_ancestor (prev_scope,\n+\t\t\t\t\t       nested_name_specifier))\n \t    {\n \t      if (at_namespace_scope_p ())\n \t\terror_at (type_start_token->location,\n@@ -15485,7 +15494,8 @@ cp_parser_enum_specifier (cp_parser* parser)\n \t\t\t  type, prev_scope, nested_name_specifier);\n \t      else\n \t\terror_at (type_start_token->location,\n-\t\t\t  \"declaration of %qD in %qD which does not enclose %qD\",\n+\t\t\t  \"declaration of %qD in %qD which does not \"\n+\t\t\t  \"enclose %qD\",\n \t\t\t  type, prev_scope, nested_name_specifier);\n \t      type = error_mark_node;\n \t    }\n@@ -19877,12 +19887,12 @@ cp_parser_class_head (cp_parser* parser,\n   if (cp_lexer_next_token_is (parser->lexer, CPP_COLON))\n     {\n       /* PR59482: enter the class scope so that base-specifiers are looked\n-\t up correctly */\n+\t up correctly.  */\n       if (type)\n \tpushclass (type);\n       bases = cp_parser_base_clause (parser);\n       /* PR59482: get out of the previously pushed class scope so that the\n-\t subsequent pops pop the right thing */\n+\t subsequent pops pop the right thing.  */\n       if (type)\n \tpopclass ();\n     }"}, {"sha": "564d4258c7b1c088ada21d394449f1650ab7412d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ea15e254ea970653f092da0993d99b15b1f2283b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ea15e254ea970653f092da0993d99b15b1f2283b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ea15e254ea970653f092da0993d99b15b1f2283b", "patch": "@@ -1,3 +1,8 @@\n+2014-01-23  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/58980\n+\t* g++.dg/parse/enum11.C: New.\n+\n 2014-01-23  Alex Velenko  <Alex.Velenko@arm.com>\n \n \t* gcc.target/aarch64/sshr64_1.c: New testcase."}, {"sha": "68ddedbeeeca2a45a5de1e9d8903f333c8360fdf", "filename": "gcc/testsuite/g++.dg/parse/enum11.C", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ea15e254ea970653f092da0993d99b15b1f2283b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fenum11.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ea15e254ea970653f092da0993d99b15b1f2283b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fenum11.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fenum11.C?ref=ea15e254ea970653f092da0993d99b15b1f2283b", "patch": "@@ -0,0 +1,6 @@\n+// PR c++/58980\n+\n+template<typename> struct A\n+{ \n+  enum A::B::C {};   // { dg-error \"has not been declared\" }\n+};"}]}