{"sha": "52554dde7bf625c66192504cef01890bacc79694", "node_id": "C_kwDOANBUbNoAKDUyNTU0ZGRlN2JmNjI1YzY2MTkyNTA0Y2VmMDE4OTBiYWNjNzk2OTQ", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-11-23T12:51:10Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-11-24T08:03:05Z"}, "message": "Avoid redundant get_loop_body calls in IVOPTs\n\nThis removes redundant get_loop_body calls in IVOPTs by passing\naround the body we're gathering early.\n\n2021-11-23  Richard Biener  <rguenther@suse.de>\n\n\t* tree-ssa-loop-ivopts.c (find_givs): Take loop body as\n\targument instead of re-computing it.\n\t(find_interesting_uses): Likewise.\n\t(find_induction_variables): Pass through loop body.\n\t(tree_ssa_iv_optimize_loop): Pass down loop body.", "tree": {"sha": "77d7b3f0a60ff83f9aac010747c2f496d5551c2c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/77d7b3f0a60ff83f9aac010747c2f496d5551c2c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/52554dde7bf625c66192504cef01890bacc79694", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52554dde7bf625c66192504cef01890bacc79694", "html_url": "https://github.com/Rust-GCC/gccrs/commit/52554dde7bf625c66192504cef01890bacc79694", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52554dde7bf625c66192504cef01890bacc79694/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "755c2e7d71cbab89b2bd1d787db46428a604efb2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/755c2e7d71cbab89b2bd1d787db46428a604efb2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/755c2e7d71cbab89b2bd1d787db46428a604efb2"}], "stats": {"total": 16, "additions": 6, "deletions": 10}, "files": [{"sha": "4769b65b5d3b4c145bd8a4835909bcc9919823e2", "filename": "gcc/tree-ssa-loop-ivopts.c", "status": "modified", "additions": 6, "deletions": 10, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52554dde7bf625c66192504cef01890bacc79694/gcc%2Ftree-ssa-loop-ivopts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52554dde7bf625c66192504cef01890bacc79694/gcc%2Ftree-ssa-loop-ivopts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-ivopts.c?ref=52554dde7bf625c66192504cef01890bacc79694", "patch": "@@ -1462,30 +1462,28 @@ find_givs_in_bb (struct ivopts_data *data, basic_block bb)\n /* Finds general ivs.  */\n \n static void\n-find_givs (struct ivopts_data *data)\n+find_givs (struct ivopts_data *data, basic_block *body)\n {\n   class loop *loop = data->current_loop;\n-  basic_block *body = get_loop_body_in_dom_order (loop);\n   unsigned i;\n \n   for (i = 0; i < loop->num_nodes; i++)\n     find_givs_in_bb (data, body[i]);\n-  free (body);\n }\n \n /* For each ssa name defined in LOOP determines whether it is an induction\n    variable and if so, its initial value and step.  */\n \n static bool\n-find_induction_variables (struct ivopts_data *data)\n+find_induction_variables (struct ivopts_data *data, basic_block *body)\n {\n   unsigned i;\n   bitmap_iterator bi;\n \n   if (!find_bivs (data))\n     return false;\n \n-  find_givs (data);\n+  find_givs (data, body);\n   mark_bivs (data);\n \n   if (dump_file && (dump_flags & TDF_DETAILS))\n@@ -2736,11 +2734,10 @@ split_address_groups (struct ivopts_data *data)\n /* Finds uses of the induction variables that are interesting.  */\n \n static void\n-find_interesting_uses (struct ivopts_data *data)\n+find_interesting_uses (struct ivopts_data *data, basic_block *body)\n {\n   basic_block bb;\n   gimple_stmt_iterator bsi;\n-  basic_block *body = get_loop_body (data->current_loop);\n   unsigned i;\n   edge e;\n \n@@ -2760,7 +2757,6 @@ find_interesting_uses (struct ivopts_data *data)\n \tif (!is_gimple_debug (gsi_stmt (bsi)))\n \t  find_interesting_uses_stmt (data, gsi_stmt (bsi));\n     }\n-  free (body);\n \n   split_address_groups (data);\n \n@@ -8077,11 +8073,11 @@ tree_ssa_iv_optimize_loop (struct ivopts_data *data, class loop *loop,\n \n   /* For each ssa name determines whether it behaves as an induction variable\n      in some loop.  */\n-  if (!find_induction_variables (data))\n+  if (!find_induction_variables (data, body))\n     goto finish;\n \n   /* Finds interesting uses (item 1).  */\n-  find_interesting_uses (data);\n+  find_interesting_uses (data, body);\n   if (data->vgroups.length () > MAX_CONSIDERED_GROUPS)\n     goto finish;\n "}]}