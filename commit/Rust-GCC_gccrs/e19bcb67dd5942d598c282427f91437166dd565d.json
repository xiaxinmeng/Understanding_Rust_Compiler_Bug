{"sha": "e19bcb67dd5942d598c282427f91437166dd565d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTE5YmNiNjdkZDU5NDJkNTk4YzI4MjQyN2Y5MTQzNzE2NmRkNTY1ZA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2010-02-19T18:30:22Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2010-02-19T18:30:22Z"}, "message": "re PR debug/43084 (ICE -fipa-struct-reorg -g (VTA))\n\n\tPR debug/43084\n\t* ipa-struct-reorg.c (add_access_to_acc_sites): For debug stmts don't\n\tpopulate vars array.\n\t(create_new_general_access): For debug stmts just reset value.\n\t(get_stmt_accesses): For accesses within debug stmts just record them\n\tusing add_access_to_acc_sites instead of preventing the peeling or\n\tcounting them as accesses.\n\n\t* gcc.dg/pr43084.c: New test.\n\nFrom-SVN: r156904", "tree": {"sha": "db800fe98bd9a288ba2a6bd2ff267e530c78e46d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/db800fe98bd9a288ba2a6bd2ff267e530c78e46d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e19bcb67dd5942d598c282427f91437166dd565d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e19bcb67dd5942d598c282427f91437166dd565d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e19bcb67dd5942d598c282427f91437166dd565d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e19bcb67dd5942d598c282427f91437166dd565d/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8ac074e8e2e321aa7e73d416f4e598a2be89e8cd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ac074e8e2e321aa7e73d416f4e598a2be89e8cd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8ac074e8e2e321aa7e73d416f4e598a2be89e8cd"}], "stats": {"total": 63, "additions": 59, "deletions": 4}, "files": [{"sha": "850880ad37f5b3ba35d490ac8f3294b38a00d9a1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e19bcb67dd5942d598c282427f91437166dd565d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e19bcb67dd5942d598c282427f91437166dd565d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e19bcb67dd5942d598c282427f91437166dd565d", "patch": "@@ -1,5 +1,13 @@\n 2010-02-19  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR debug/43084\n+\t* ipa-struct-reorg.c (add_access_to_acc_sites): For debug stmts don't\n+\tpopulate vars array.\n+\t(create_new_general_access): For debug stmts just reset value.\n+\t(get_stmt_accesses): For accesses within debug stmts just record them\n+\tusing add_access_to_acc_sites instead of preventing the peeling or\n+\tcounting them as accesses.\n+\n \tPR middle-end/42233\n \t* dojump.c (do_jump) <case TRUTH_NOT_EXPR>: Invert priority.\n "}, {"sha": "66b3ab40d23e8d6624a2199f2b83448c6157fbd4", "filename": "gcc/ipa-struct-reorg.c", "status": "modified", "additions": 30, "deletions": 4, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e19bcb67dd5942d598c282427f91437166dd565d/gcc%2Fipa-struct-reorg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e19bcb67dd5942d598c282427f91437166dd565d/gcc%2Fipa-struct-reorg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-struct-reorg.c?ref=e19bcb67dd5942d598c282427f91437166dd565d", "patch": "@@ -1,5 +1,5 @@\n /* Struct-reorg optimization.\n-   Copyright (C) 2007, 2008, 2009 Free Software Foundation, Inc.\n+   Copyright (C) 2007, 2008, 2009, 2010 Free Software Foundation, Inc.\n    Contributed by Olga Golovanevsky <olga@il.ibm.com>\n    (Initial version of this code was developed\n    by Caroline Tice and Mostafa Hagog.)\n@@ -497,13 +497,16 @@ add_access_to_acc_sites (gimple stmt, tree var, htab_t accs)\n \n        acc = (struct access_site *) xmalloc (sizeof (struct access_site));\n        acc->stmt = stmt;\n-       acc->vars = VEC_alloc (tree, heap, 10);\n+       if (!is_gimple_debug (stmt))\n+\t acc->vars = VEC_alloc (tree, heap, 10);\n+       else\n+\t acc->vars = NULL;\n        slot = htab_find_slot_with_hash (accs, stmt,\n \t\t\t\t\thtab_hash_pointer (stmt), INSERT);\n        *slot = acc;\n-\n      }\n-   VEC_safe_push (tree, heap, acc->vars, var);\n+   if (!is_gimple_debug (stmt))\n+     VEC_safe_push (tree, heap, acc->vars, var);\n }\n \n /* This function adds NEW_DECL to function\n@@ -1383,6 +1386,13 @@ create_new_general_access (struct access_site *acc, d_str str)\n       create_new_stmts_for_cond_expr (stmt);\n       break;\n \n+    case GIMPLE_DEBUG:\n+      /* It is very hard to maintain usable debug info after struct peeling,\n+\t for now just reset all debug stmts referencing objects that have\n+\t been peeled.  */\n+      gimple_debug_bind_reset_value (stmt);\n+      break;\n+\n     default:\n       create_new_stmts_for_general_acc (acc, str);\n     }\n@@ -2494,6 +2504,15 @@ get_stmt_accesses (tree *tp, int *walk_subtrees, void *data)\n \n \tif (i != VEC_length (structure, structures))\n \t  {\n+\t    if (is_gimple_debug (stmt))\n+\t      {\n+\t\td_str str;\n+\n+\t\tstr = VEC_index (structure, structures, i);\n+\t\tadd_access_to_acc_sites (stmt, NULL, str->accs);\n+\t\t*walk_subtrees = 0;\n+\t\tbreak;\n+\t      }\n \t    if (dump_file)\n \t      {\n \t\tfprintf (dump_file, \"\\nThe type \");\n@@ -2525,6 +2544,13 @@ get_stmt_accesses (tree *tp, int *walk_subtrees, void *data)\n \t\tstruct field_entry * field =\n \t\t  find_field_in_struct (str, field_decl);\n \n+\t\tif (is_gimple_debug (stmt))\n+\t\t  {\n+\t\t    add_access_to_acc_sites (stmt, NULL, str->accs);\n+\t\t    *walk_subtrees = 0;\n+\t\t    break;\n+\t\t  }\n+\n \t\tif (field)\n \t\t  {\n \t\t    struct field_access_site *acc = make_field_acc_node ();"}, {"sha": "14b2ea426f3515b1a991e18360223849b3baaa4a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e19bcb67dd5942d598c282427f91437166dd565d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e19bcb67dd5942d598c282427f91437166dd565d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e19bcb67dd5942d598c282427f91437166dd565d", "patch": "@@ -1,3 +1,8 @@\n+2010-02-19  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/43084\n+\t* gcc.dg/pr43084.c: New test.\n+\n 2010-02-19  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/42916"}, {"sha": "a590fa272cb3256450811a66c6e7fd9eac5d22a4", "filename": "gcc/testsuite/gcc.dg/pr43084.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e19bcb67dd5942d598c282427f91437166dd565d/gcc%2Ftestsuite%2Fgcc.dg%2Fpr43084.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e19bcb67dd5942d598c282427f91437166dd565d/gcc%2Ftestsuite%2Fgcc.dg%2Fpr43084.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr43084.c?ref=e19bcb67dd5942d598c282427f91437166dd565d", "patch": "@@ -0,0 +1,16 @@\n+/* PR debug/43084 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O1 -fipa-struct-reorg -fwhole-program -fipa-type-escape -fcompare-debug\" } */\n+\n+struct S\n+{\n+  int a;\n+};\n+\n+int\n+main ()\n+{\n+  struct S s;\n+  struct S *p = &s;\n+  return p->a;\n+}"}]}