{"sha": "24272dc03779501835117ee8782f4888b4d6a3d4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjQyNzJkYzAzNzc5NTAxODM1MTE3ZWU4NzgyZjQ4ODhiNGQ2YTNkNA==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2001-04-16T05:51:38Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2001-04-16T05:51:38Z"}, "message": "cp-tree.h (TYPE_PTRMEM_CLASS_TYPE): Improve documentation.\n\n\t* cp-tree.h (TYPE_PTRMEM_CLASS_TYPE): Improve documentation.\n\t* mangle.c (write_pointer_to_member_type): Fix mangling of\n\tpointers to cv-qualified member function types.\n\nFrom-SVN: r41373", "tree": {"sha": "bda6d31238e203eb31d8661c77632d5151ff1746", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bda6d31238e203eb31d8661c77632d5151ff1746"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/24272dc03779501835117ee8782f4888b4d6a3d4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/24272dc03779501835117ee8782f4888b4d6a3d4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/24272dc03779501835117ee8782f4888b4d6a3d4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/24272dc03779501835117ee8782f4888b4d6a3d4/comments", "author": null, "committer": null, "parents": [{"sha": "1b4a93f79b44e6cffbd43cbdfa0f649b9b43158a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1b4a93f79b44e6cffbd43cbdfa0f649b9b43158a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1b4a93f79b44e6cffbd43cbdfa0f649b9b43158a"}], "stats": {"total": 36, "additions": 34, "deletions": 2}, "files": [{"sha": "7809c0a286c4325f040efb9e613abcdb1abcebea", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/24272dc03779501835117ee8782f4888b4d6a3d4/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/24272dc03779501835117ee8782f4888b4d6a3d4/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=24272dc03779501835117ee8782f4888b4d6a3d4", "patch": "@@ -1,5 +1,9 @@\n 2001-04-15  Mark Mitchell  <mark@codesourcery.com>\n \n+\t* cp-tree.h (TYPE_PTRMEM_CLASS_TYPE): Improve documentation.\n+\t* mangle.c (write_pointer_to_member_type): Fix mangling of\n+\tpointers to cv-qualified member function types.\n+\n \t* init.c (build_delete): Create a SAVE_EXPR for the address if\n \twe're going to use it more than once.\n "}, {"sha": "a30623a7bd7bca6c499f4072ddb32e5af6d8fa33", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/24272dc03779501835117ee8782f4888b4d6a3d4/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/24272dc03779501835117ee8782f4888b4d6a3d4/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=24272dc03779501835117ee8782f4888b4d6a3d4", "patch": "@@ -2691,7 +2691,11 @@ extern int flag_new_for_scope;\n /* Returns the pfn field from a TYPE_PTRMEMFUNC_P.  */\n #define PFN_FROM_PTRMEMFUNC(NODE) pfn_from_ptrmemfunc ((NODE))\n \n-/* For a pointer-to-member type of the form `T X::*', this is `X'.  */\n+/* For a pointer-to-member type of the form `T X::*', this is `X'.\n+   For a type like `void (X::*)() const', this type is `X', not `const\n+   X'.  To get at the `const X' you have to look at the\n+   TYPE_PTRMEM_POINTED_TO_TYPE; there, the first parameter will have\n+   type `const X*'.  */\n #define TYPE_PTRMEM_CLASS_TYPE(NODE)\t\t\t\\\n   (TYPE_PTRMEM_P ((NODE))\t\t\t\t\\\n    ? TYPE_OFFSET_BASETYPE (TREE_TYPE ((NODE)))\t\t\\"}, {"sha": "18f99a10fbfc7c278ef12f19e201d40e12de49de", "filename": "gcc/cp/mangle.c", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/24272dc03779501835117ee8782f4888b4d6a3d4/gcc%2Fcp%2Fmangle.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/24272dc03779501835117ee8782f4888b4d6a3d4/gcc%2Fcp%2Fmangle.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fmangle.c?ref=24272dc03779501835117ee8782f4888b4d6a3d4", "patch": "@@ -1928,7 +1928,24 @@ write_pointer_to_member_type (type)\n      tree type;\n {\n   write_char ('M');\n-  write_type (TYPE_PTRMEM_CLASS_TYPE (type));\n+  /* For a pointer-to-function member, the class type may be\n+     cv-qualified, bug that won't be reflected in\n+     TYPE_PTRMEM_CLASS_TYPE.  So, we go fishing around in\n+     TYPE_PTRMEM_POINTED_TO_TYPE instead.  */\n+  if (TYPE_PTRMEMFUNC_P (type))\n+    {\n+      tree fn_type;\n+      tree this_type;\n+\n+      fn_type = TYPE_PTRMEM_POINTED_TO_TYPE (type);\n+      /* The first parameter must be a POINTER_TYPE pointing to the\n+\t `this' parameter.  */\n+      this_type = TREE_TYPE (TREE_VALUE (TYPE_ARG_TYPES (fn_type)));\n+      write_type (this_type);\n+    }\n+  /* For a pointer-to-data member, things are simpler.  */\n+  else\n+    write_type (TYPE_PTRMEM_CLASS_TYPE (type));\n   write_type (TYPE_PTRMEM_POINTED_TO_TYPE (type));\n }\n "}, {"sha": "70f0ccee0be0ca7cebe1737b0b0834f82e2f5528", "filename": "gcc/testsuite/g++.old-deja/g++.abi/mangle1.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/24272dc03779501835117ee8782f4888b4d6a3d4/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.abi%2Fmangle1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/24272dc03779501835117ee8782f4888b4d6a3d4/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.abi%2Fmangle1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.abi%2Fmangle1.C?ref=24272dc03779501835117ee8782f4888b4d6a3d4", "patch": "@@ -0,0 +1,7 @@\n+// Build don't link:\n+// Origin: Mark Mitchell <mark@codesourcery.com>\n+\n+struct S {};\n+\n+void f (void (S::*)()) {}\n+void f (void (S::*)() const) {}"}]}