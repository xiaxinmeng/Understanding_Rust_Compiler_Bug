{"sha": "e1fcf14f33e4f371aae8ae497ca58a760d53ca6d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTFmY2YxNGYzM2U0ZjM3MWFhZThhZTQ5N2NhNThhNzYwZDUzY2E2ZA==", "commit": {"author": {"name": "Christoph Muellner", "email": "cmuellner@gcc.gnu.org", "date": "2021-05-05T19:23:41Z"}, "committer": {"name": "Jim Wilson", "email": "jimw@sifive.com", "date": "2021-05-06T01:15:42Z"}, "message": "RISC-V: Generate helpers for cbranch4.\n\nOn RISC-V we are facing the fact, that our conditional branches\nrequire Pmode conditions. Currently, we generate them explicitly\nwith a check for Pmode and then calling the proper generator\n(i.e. gen_cbranchdi4 on RV64 and gen_cbranchsi4 on RV32).\nLet's simplify this code by generating the INSN helpers\nand use gen_cbranch4 (Pmode).\n\n\tgcc/\n\tPR target/100266\n\t* config/riscv/riscv.c (riscv_block_move_loop): Use cbranch helper.\n\t* config/riscv/riscv.md (cbranch<mode>4): Generate helpers.\n\t(stack_protect_test): Use cbranch helper.", "tree": {"sha": "60f7b28fbcbdb2fe4b8582e029db5e2cb4f717cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/60f7b28fbcbdb2fe4b8582e029db5e2cb4f717cf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e1fcf14f33e4f371aae8ae497ca58a760d53ca6d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e1fcf14f33e4f371aae8ae497ca58a760d53ca6d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e1fcf14f33e4f371aae8ae497ca58a760d53ca6d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e1fcf14f33e4f371aae8ae497ca58a760d53ca6d/comments", "author": {"login": "cmuellner", "id": 92810, "node_id": "MDQ6VXNlcjkyODEw", "avatar_url": "https://avatars.githubusercontent.com/u/92810?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cmuellner", "html_url": "https://github.com/cmuellner", "followers_url": "https://api.github.com/users/cmuellner/followers", "following_url": "https://api.github.com/users/cmuellner/following{/other_user}", "gists_url": "https://api.github.com/users/cmuellner/gists{/gist_id}", "starred_url": "https://api.github.com/users/cmuellner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cmuellner/subscriptions", "organizations_url": "https://api.github.com/users/cmuellner/orgs", "repos_url": "https://api.github.com/users/cmuellner/repos", "events_url": "https://api.github.com/users/cmuellner/events{/privacy}", "received_events_url": "https://api.github.com/users/cmuellner/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "449480114aa5ee7e400b75c654f548e38fd03a64", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/449480114aa5ee7e400b75c654f548e38fd03a64", "html_url": "https://github.com/Rust-GCC/gccrs/commit/449480114aa5ee7e400b75c654f548e38fd03a64"}], "stats": {"total": 17, "additions": 5, "deletions": 12}, "files": [{"sha": "27665e5b58f91b79721061459c947fb79bfbf518", "filename": "gcc/config/riscv/riscv.c", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1fcf14f33e4f371aae8ae497ca58a760d53ca6d/gcc%2Fconfig%2Friscv%2Friscv.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1fcf14f33e4f371aae8ae497ca58a760d53ca6d/gcc%2Fconfig%2Friscv%2Friscv.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Friscv%2Friscv.c?ref=e1fcf14f33e4f371aae8ae497ca58a760d53ca6d", "patch": "@@ -3258,10 +3258,7 @@ riscv_block_move_loop (rtx dest, rtx src, unsigned HOST_WIDE_INT length,\n \n   /* Emit the loop condition.  */\n   test = gen_rtx_NE (VOIDmode, src_reg, final_src);\n-  if (Pmode == DImode)\n-    emit_jump_insn (gen_cbranchdi4 (test, src_reg, final_src, label));\n-  else\n-    emit_jump_insn (gen_cbranchsi4 (test, src_reg, final_src, label));\n+  emit_jump_insn (gen_cbranch4 (Pmode, test, src_reg, final_src, label));\n \n   /* Mop up any left-over bytes.  */\n   if (leftover)"}, {"sha": "f88877fd59664007422593660e21a708a5f340bc", "filename": "gcc/config/riscv/riscv.md", "status": "modified", "additions": 4, "deletions": 8, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1fcf14f33e4f371aae8ae497ca58a760d53ca6d/gcc%2Fconfig%2Friscv%2Friscv.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1fcf14f33e4f371aae8ae497ca58a760d53ca6d/gcc%2Fconfig%2Friscv%2Friscv.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Friscv%2Friscv.md?ref=e1fcf14f33e4f371aae8ae497ca58a760d53ca6d", "patch": "@@ -2153,7 +2153,7 @@\n \t\t      (label_ref (match_operand 1))\n \t\t      (pc)))])\n \n-(define_expand \"cbranch<mode>4\"\n+(define_expand \"@cbranch<mode>4\"\n   [(set (pc)\n \t(if_then_else (match_operator 0 \"comparison_operator\"\n \t\t      [(match_operand:BR 1 \"register_operand\")\n@@ -2167,7 +2167,7 @@\n   DONE;\n })\n \n-(define_expand \"cbranch<mode>4\"\n+(define_expand \"@cbranch<mode>4\"\n   [(set (pc)\n \t(if_then_else (match_operator 0 \"fp_branch_comparison\"\n \t\t       [(match_operand:ANYF 1 \"register_operand\")\n@@ -2829,12 +2829,8 @@\n \t\t\t\t\t        operands[0],\n \t\t\t\t\t        operands[1]));\n \n-  if (mode == DImode)\n-    emit_jump_insn (gen_cbranchdi4 (gen_rtx_EQ (VOIDmode, result, const0_rtx),\n-\t\t\t\t    result, const0_rtx, operands[2]));\n-  else\n-    emit_jump_insn (gen_cbranchsi4 (gen_rtx_EQ (VOIDmode, result, const0_rtx),\n-\t\t\t\t    result, const0_rtx, operands[2]));\n+  rtx cond = gen_rtx_EQ (VOIDmode, result, const0_rtx);\n+  emit_jump_insn (gen_cbranch4 (mode, cond, result, const0_rtx, operands[2]));\n \n   DONE;\n })"}]}