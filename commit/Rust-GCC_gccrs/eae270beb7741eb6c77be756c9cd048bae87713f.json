{"sha": "eae270beb7741eb6c77be756c9cd048bae87713f", "node_id": "C_kwDOANBUbNoAKGVhZTI3MGJlYjc3NDFlYjZjNzdiZTc1NmM5Y2QwNDhiYWU4NzcxM2Y", "commit": {"author": {"name": "Xianmiao Qu", "email": "cooper.qu@linux.alibaba.com", "date": "2022-09-07T09:19:54Z"}, "committer": {"name": "Xianmiao Qu", "email": "cooper.qu@linux.alibaba.com", "date": "2022-09-07T11:03:10Z"}, "message": "C-SKY: Fix expanding of float LE comparing with zero for fpuv3.\n\nThe original code will cause the warning:\n/usr/lib/gcc-snapshot/bin/g++  -fno-PIE -c   -g -O2   -DIN_GCC  -DCROSS_DIRECTORY_STRUCTURE   -fno-exceptions -fno-rtti -fasynchronous-unwind-tables -W -Wall -Wno-narrowing -Wwrite-strings -Wcast-qual -Wmissing-format-attribute -Woverloaded-virtual -pedantic -Wno-long-long -Wno-variadic-macros -Wno-overlength-strings -Werror -fno-common  -DHAVE_CONFIG_H -I. -I. -I../../gcc/gcc -I../../gcc/gcc/. -I../../gcc/gcc/../include -I../../gcc/gcc/../libcpp/include -I../../gcc/gcc/../libcody  -I../../gcc/gcc/../libdecnumber -I../../gcc/gcc/../libdecnumber/dpd -I../libdecnumber -I../../gcc/gcc/../libbacktrace   -o csky.o -MT csky.o -MMD -MP -MF ./.deps/csky.TPo ../../gcc/gcc/config/csky/csky.cc\nIn file included from ../../gcc/gcc/config/csky/csky.h:183,\n                from ./tm.h:20,\n                from ../../gcc/gcc/backend.h:28,\n                from ../../gcc/gcc/config/csky/csky.cc:27:\n../../gcc/gcc/config/csky/csky.cc: In function 'bool csky_emit_compare_float(rtx_code, rtx, rtx)':\n../../gcc/gcc/config/csky/csky_isa.h:29:37: error: enum constant in boolean context [-Werror=int-in-bool-context]\n  29 | #define CSKY_ISA_FEATURE_DEFINE(x)  isa_bit_ ## x\n      |                                     ^~~~~~~~\n../../gcc/gcc/config/csky/csky_isa.h:30:37: note: in expansion of macro 'CSKY_ISA_FEATURE_DEFINE'\n  30 | #define CSKY_ISA_FEATURE_GET(x)     CSKY_ISA_FEATURE_DEFINE (x)\n      |                                     ^~~~~~~~~~~~~~~~~~~~~~~\n../../gcc/gcc/config/csky/csky.cc:6346:43: note: in expansion of macro 'CSKY_ISA_FEATURE_GET'\n6346 |                                        || CSKY_ISA_FEATURE_GET(fpv2_df)\n      |                                           ^~~~~~~~~~~~~~~~~~~~\n../../gcc/gcc/config/csky/csky_isa.h:29:37: error: enum constant in boolean context [-Werror=int-in-bool-context]\n  29 | #define CSKY_ISA_FEATURE_DEFINE(x)  isa_bit_ ## x\n      |                                     ^~~~~~~~\n../../gcc/gcc/config/csky/csky_isa.h:30:37: note: in expansion of macro 'CSKY_ISA_FEATURE_DEFINE'\n  30 | #define CSKY_ISA_FEATURE_GET(x)     CSKY_ISA_FEATURE_DEFINE (x)\n      |                                     ^~~~~~~~~~~~~~~~~~~~~~~\n../../gcc/gcc/config/csky/csky.cc:6346:43: note: in expansion of macro 'CSKY_ISA_FEATURE_GET'\n6346 |                                        || CSKY_ISA_FEATURE_GET(fpv2_df)\n      |                                           ^~~~~~~~~~~~~~~~~~~~\n../../gcc/gcc/config/csky/csky_isa.h:29:37: error: enum constant in boolean context [-Werror=int-in-bool-context]\n  29 | #define CSKY_ISA_FEATURE_DEFINE(x)  isa_bit_ ## x\n      |                                     ^~~~~~~~\n../../gcc/gcc/config/csky/csky_isa.h:30:37: note: in expansion of macro 'CSKY_ISA_FEATURE_DEFINE'\n  30 | #define CSKY_ISA_FEATURE_GET(x)     CSKY_ISA_FEATURE_DEFINE (x)\n      |                                     ^~~~~~~~~~~~~~~~~~~~~~~\n../../gcc/gcc/config/csky/csky.cc:6347:43: note: in expansion of macro 'CSKY_ISA_FEATURE_GET'\n6347 |                                        || CSKY_ISA_FEATURE_GET(fpv2_divd)))\n      |                                           ^~~~~~~~~~~~~~~~~~~~\n\nThe 'CSKY_ISA_FEATURE_DEFINE (x)' is an enum contant, it will cause the condition always being true.\nIn addition to warning, it will let FPUV3 to generate a move instruction, which is unnecessary.\nIn a simple test case, the move instruction can be combined, so it was not found in the testsuite.\nBut in some complex scenarios, this may generate some redundant instructions.\nThe correct way is to use 'CSKY_ISA_FEATURE' instead of 'CSKY_ISA_FEATURE_DEFINE'.\n\ngcc/\n\t* config/csky/csky.cc (csky_emit_compare_float): Fix the expanding of\n\tfloat LE comparing with zero for fpuv3.\n\t* config/csky/csky.h (TARGET_SUPPORT_FPV2): New, true if any fpuv2\n\tfeatures are enabled.", "tree": {"sha": "f732e00fe5a570c6e97fa7f2818d4cb4d2f21636", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f732e00fe5a570c6e97fa7f2818d4cb4d2f21636"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/eae270beb7741eb6c77be756c9cd048bae87713f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eae270beb7741eb6c77be756c9cd048bae87713f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eae270beb7741eb6c77be756c9cd048bae87713f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eae270beb7741eb6c77be756c9cd048bae87713f/comments", "author": {"login": "Cooper-Qu", "id": 68842787, "node_id": "MDQ6VXNlcjY4ODQyNzg3", "avatar_url": "https://avatars.githubusercontent.com/u/68842787?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Cooper-Qu", "html_url": "https://github.com/Cooper-Qu", "followers_url": "https://api.github.com/users/Cooper-Qu/followers", "following_url": "https://api.github.com/users/Cooper-Qu/following{/other_user}", "gists_url": "https://api.github.com/users/Cooper-Qu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Cooper-Qu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Cooper-Qu/subscriptions", "organizations_url": "https://api.github.com/users/Cooper-Qu/orgs", "repos_url": "https://api.github.com/users/Cooper-Qu/repos", "events_url": "https://api.github.com/users/Cooper-Qu/events{/privacy}", "received_events_url": "https://api.github.com/users/Cooper-Qu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Cooper-Qu", "id": 68842787, "node_id": "MDQ6VXNlcjY4ODQyNzg3", "avatar_url": "https://avatars.githubusercontent.com/u/68842787?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Cooper-Qu", "html_url": "https://github.com/Cooper-Qu", "followers_url": "https://api.github.com/users/Cooper-Qu/followers", "following_url": "https://api.github.com/users/Cooper-Qu/following{/other_user}", "gists_url": "https://api.github.com/users/Cooper-Qu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Cooper-Qu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Cooper-Qu/subscriptions", "organizations_url": "https://api.github.com/users/Cooper-Qu/orgs", "repos_url": "https://api.github.com/users/Cooper-Qu/repos", "events_url": "https://api.github.com/users/Cooper-Qu/events{/privacy}", "received_events_url": "https://api.github.com/users/Cooper-Qu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0386609923577e07354ee63754795b2f729e7e00", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0386609923577e07354ee63754795b2f729e7e00", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0386609923577e07354ee63754795b2f729e7e00"}], "stats": {"total": 8, "additions": 5, "deletions": 3}, "files": [{"sha": "4dc74d8924f6a86b318c626e228e3590a753b8cc", "filename": "gcc/config/csky/csky.cc", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eae270beb7741eb6c77be756c9cd048bae87713f/gcc%2Fconfig%2Fcsky%2Fcsky.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eae270beb7741eb6c77be756c9cd048bae87713f/gcc%2Fconfig%2Fcsky%2Fcsky.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fcsky%2Fcsky.cc?ref=eae270beb7741eb6c77be756c9cd048bae87713f", "patch": "@@ -6342,9 +6342,7 @@ csky_emit_compare_float (enum rtx_code code, rtx op0, rtx op1)\n     case GT:\n     case LT:\n     case LE:\n-      if (op1 == CONST0_RTX (mode) && (CSKY_ISA_FEATURE_GET(fpv2_sf)\n-\t\t\t\t       || CSKY_ISA_FEATURE_GET(fpv2_df)\n-\t\t\t\t       || CSKY_ISA_FEATURE_GET(fpv2_divd)))\n+      if (op1 == CONST0_RTX (mode) && TARGET_SUPPORT_FPV2)\n \top1 = force_reg (mode, op1);\n       break;\n     case ORDERED:"}, {"sha": "f786ad55d43f1ea349accb86241acdaff8a45c8b", "filename": "gcc/config/csky/csky.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eae270beb7741eb6c77be756c9cd048bae87713f/gcc%2Fconfig%2Fcsky%2Fcsky.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eae270beb7741eb6c77be756c9cd048bae87713f/gcc%2Fconfig%2Fcsky%2Fcsky.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fcsky%2Fcsky.h?ref=eae270beb7741eb6c77be756c9cd048bae87713f", "patch": "@@ -165,6 +165,10 @@\n \t\t\t     || CSKY_ISA_FEATURE (fpv3_sf) \\\n \t\t\t     || CSKY_ISA_FEATURE (fpv3_df))\n \n+#define TARGET_SUPPORT_FPV2 (CSKY_ISA_FEATURE(fpv2_sf)    \\\n+\t\t\t     || CSKY_ISA_FEATURE(fpv2_df) \\\n+\t\t\t     || CSKY_ISA_FEATURE(fpv2_divd))\n+\n /* Number of loads/stores handled by ldm/stm.  */\n #define CSKY_MIN_MULTIPLE_STLD\t3\n #define CSKY_MAX_MULTIPLE_STLD\t12"}]}