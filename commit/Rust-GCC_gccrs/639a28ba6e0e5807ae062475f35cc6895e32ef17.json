{"sha": "639a28ba6e0e5807ae062475f35cc6895e32ef17", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjM5YTI4YmE2ZTBlNTgwN2FlMDYyNDc1ZjM1Y2M2ODk1ZTMyZWYxNw==", "commit": {"author": {"name": "Alexandre Oliva", "email": "oliva@adacore.com", "date": "2019-09-27T01:59:55Z"}, "committer": {"name": "Alexandre Oliva", "email": "aoliva@gcc.gnu.org", "date": "2019-09-27T01:59:55Z"}, "message": "set DECL_SIZE_UNIT for zero-sized fields\n\nZero-sized fields do not get processed by finish_record_type: they're\nremoved from the field list before and reinserted after, so their\nDECL_SIZE_UNIT remains unset, causing the translation of assignment\nstatements with use_memset_p, in quite unusual circumstances, to use a\nNULL_TREE as the memset length.  This patch sets DECL_SIZE_UNIT for\nthe zero-sized fields, that don't go through language-independent\nlayout, in language-specific layout.\n\n\nfor  gcc/ada/ChangeLog\n\n\t* gcc-interface/decl.c (components_to_record): Set\n\tDECL_SIZE_UNIT for zero-sized fields.\n\nFrom-SVN: r276173", "tree": {"sha": "8357cec521fab8b93a5e2ebb697ae8dcd3877b67", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8357cec521fab8b93a5e2ebb697ae8dcd3877b67"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/639a28ba6e0e5807ae062475f35cc6895e32ef17", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/639a28ba6e0e5807ae062475f35cc6895e32ef17", "html_url": "https://github.com/Rust-GCC/gccrs/commit/639a28ba6e0e5807ae062475f35cc6895e32ef17", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/639a28ba6e0e5807ae062475f35cc6895e32ef17/comments", "author": null, "committer": null, "parents": [{"sha": "09704140c7f3e4341d66a32e40359c4d146a4350", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/09704140c7f3e4341d66a32e40359c4d146a4350", "html_url": "https://github.com/Rust-GCC/gccrs/commit/09704140c7f3e4341d66a32e40359c4d146a4350"}], "stats": {"total": 6, "additions": 6, "deletions": 0}, "files": [{"sha": "8e5a19bc9e84f9025090db5e5b2a350af9cb7ef8", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/639a28ba6e0e5807ae062475f35cc6895e32ef17/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/639a28ba6e0e5807ae062475f35cc6895e32ef17/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=639a28ba6e0e5807ae062475f35cc6895e32ef17", "patch": "@@ -1,3 +1,8 @@\n+2019-09-26  Alexandre Oliva <oliva@adacore.com>\n+\n+\t* gcc-interface/decl.c (components_to_record): Set\n+\tDECL_SIZE_UNIT for zero-sized fields.\n+\n 2019-09-26  Arnaud Charlet  <charlet@adacore.com>\n \n \t* osint.adb (OS_Time_To_GNAT_Time): Remove dependency on To_C/To_Ada"}, {"sha": "77c6c9f12e76cd75ade52045a55919bfa04eb720", "filename": "gcc/ada/gcc-interface/decl.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/639a28ba6e0e5807ae062475f35cc6895e32ef17/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/639a28ba6e0e5807ae062475f35cc6895e32ef17/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Fdecl.c?ref=639a28ba6e0e5807ae062475f35cc6895e32ef17", "patch": "@@ -7928,6 +7928,7 @@ components_to_record (Node_Id gnat_component_list, Entity_Id gnat_record_type,\n \n       if (DECL_SIZE (gnu_field) && integer_zerop (DECL_SIZE (gnu_field)))\n \t{\n+\t  DECL_SIZE_UNIT (gnu_field) = size_zero_node;\n \t  DECL_FIELD_OFFSET (gnu_field) = size_zero_node;\n \t  SET_DECL_OFFSET_ALIGN (gnu_field, BIGGEST_ALIGNMENT);\n \t  DECL_FIELD_BIT_OFFSET (gnu_field) = bitsize_zero_node;"}]}