{"sha": "4a9658279646ba0d7c8bf7c11ba709fb612e6cf0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGE5NjU4Mjc5NjQ2YmEwZDdjOGJmN2MxMWJhNzA5ZmI2MTJlNmNmMA==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2007-09-18T06:34:30Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2007-09-18T06:34:30Z"}, "message": "re PR fortran/33231 (Reject for -std=f* calls to elementar functions where array and scalar are mixed)\n\n2007-09-18  Tobias Burnus  <burnus@net-b.de>\n\n\tPR fortran/33231\n\t* resolve.c (resolve_elemental_actual): Check for conformance\n\tof intent out/inout dummies.\n\n2007-09-18  Tobias Burnus  <burnus@net-b.de>\n\n\tPR fortran/33231\n\t* gfortran.dg/elemental_optional_args_1.f90: Make valid Fortran.\n\t* gfortran.dg/elemental_subroutine_1.f90: Ditto.\n\t* gfortran.dg/elemental_subroutine_5.f90: New.\n\nFrom-SVN: r128570", "tree": {"sha": "20cf832532f35a69f339af7e05cd88816ef6b9fb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/20cf832532f35a69f339af7e05cd88816ef6b9fb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4a9658279646ba0d7c8bf7c11ba709fb612e6cf0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a9658279646ba0d7c8bf7c11ba709fb612e6cf0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4a9658279646ba0d7c8bf7c11ba709fb612e6cf0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a9658279646ba0d7c8bf7c11ba709fb612e6cf0/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0e01499666a5032861459cd9fd07bdb8df149637", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0e01499666a5032861459cd9fd07bdb8df149637", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0e01499666a5032861459cd9fd07bdb8df149637"}], "stats": {"total": 70, "additions": 64, "deletions": 6}, "files": [{"sha": "ad04007c119f9e5d263ca8902371c3353a6219c0", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a9658279646ba0d7c8bf7c11ba709fb612e6cf0/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a9658279646ba0d7c8bf7c11ba709fb612e6cf0/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=4a9658279646ba0d7c8bf7c11ba709fb612e6cf0", "patch": "@@ -1,3 +1,9 @@\n+2007-09-18  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/33231\n+\t* resolve.c (resolve_elemental_actual): Check for conformance\n+\tof intent out/inout dummies.\n+\n 2007-09-17  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/33106"}, {"sha": "5d1c1160de26f504f03e2c29a481b875c00e108c", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a9658279646ba0d7c8bf7c11ba709fb612e6cf0/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a9658279646ba0d7c8bf7c11ba709fb612e6cf0/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=4a9658279646ba0d7c8bf7c11ba709fb612e6cf0", "patch": "@@ -1286,6 +1286,22 @@ resolve_elemental_actual (gfc_expr *expr, gfc_code *c)\n \te = arg->expr;\n     }\n \n+  /* INTENT(OUT) is only allowed for subroutines; if any actual argument\n+     is an array, the intent inout/out variable needs to be also an array.  */\n+  if (rank > 0 && esym && expr == NULL)\n+    for (eformal = esym->formal, arg = arg0; arg && eformal;\n+\t arg = arg->next, eformal = eformal->next)\n+      if ((eformal->sym->attr.intent == INTENT_OUT\n+\t   || eformal->sym->attr.intent == INTENT_INOUT)\n+\t  && arg->expr && arg->expr->rank == 0)\n+\t{\n+\t  gfc_error (\"Actual argument at %L for INTENT(%s) dummy '%s' of \"\n+\t\t     \"ELEMENTAL subroutine '%s' is a scalar, but another \"\n+\t\t     \"actual argument is an array\", &arg->expr->where,\n+\t\t     (eformal->sym->attr.intent == INTENT_OUT) ? \"OUT\"\n+\t\t     : \"INOUT\", eformal->sym->name, esym->name);\n+\t  return FAILURE;\n+\t}\n   return SUCCESS;\n }\n "}, {"sha": "a07270af87de748b69ecc8015eabe689fd4db352", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a9658279646ba0d7c8bf7c11ba709fb612e6cf0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a9658279646ba0d7c8bf7c11ba709fb612e6cf0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4a9658279646ba0d7c8bf7c11ba709fb612e6cf0", "patch": "@@ -1,3 +1,10 @@\n+2007-09-18  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/33231\n+\t* gfortran.dg/elemental_optional_args_1.f90: Make valid Fortran.\n+\t* gfortran.dg/elemental_subroutine_1.f90: Ditto.\n+\t* gfortran.dg/elemental_subroutine_5.f90: New.\n+\n 2007-09-18  Richard Sandiford  <rsandifo@nildram.co.uk>\n \n \t* lib/target-supports.exp (check_profiling_available): Extend"}, {"sha": "aed6cadc350d1938d6f4732a8ccfa60108b8ad2b", "filename": "gcc/testsuite/gfortran.dg/elemental_optional_args_1.f90", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a9658279646ba0d7c8bf7c11ba709fb612e6cf0/gcc%2Ftestsuite%2Fgfortran.dg%2Felemental_optional_args_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a9658279646ba0d7c8bf7c11ba709fb612e6cf0/gcc%2Ftestsuite%2Fgfortran.dg%2Felemental_optional_args_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Felemental_optional_args_1.f90?ref=4a9658279646ba0d7c8bf7c11ba709fb612e6cf0", "patch": "@@ -11,7 +11,7 @@\n   CALL T1(1,2)\n CONTAINS\n   SUBROUTINE T1(A1,A2,A3)\n-    INTEGER           :: A1,A2, A4(2)\n+    INTEGER           :: A1,A2, A4(2), A5(2)\n     INTEGER, OPTIONAL :: A3(2)\n     interface\n       elemental function efoo (B1,B2,B3) result(bar)\n@@ -34,9 +34,9 @@ end function efoo\n     write(6,*) efoo(A1,A3,A2)\n     write(6,*) efoo(A1,A4,A3)\n ! check an elemental subroutine\n-    call foobar (A1,A2,A3) ! { dg-warning \"array and OPTIONAL\" } \n-    call foobar (A1,A2,A4)\n-    call foobar (A1,A4,A4)\n+    call foobar (A5,A2,A3) ! { dg-warning \"array and OPTIONAL\" } \n+    call foobar (A5,A2,A4)\n+    call foobar (A5,A4,A4)\n   END SUBROUTINE\n   elemental function foo (B1,B2,B3) result(bar)\n     INTEGER, intent(in)           :: B1, B2"}, {"sha": "298b54eee3d41b21cb8fc89aeed9413571fcaf2d", "filename": "gcc/testsuite/gfortran.dg/elemental_subroutine_1.f90", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a9658279646ba0d7c8bf7c11ba709fb612e6cf0/gcc%2Ftestsuite%2Fgfortran.dg%2Felemental_subroutine_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a9658279646ba0d7c8bf7c11ba709fb612e6cf0/gcc%2Ftestsuite%2Fgfortran.dg%2Felemental_subroutine_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Felemental_subroutine_1.f90?ref=4a9658279646ba0d7c8bf7c11ba709fb612e6cf0", "patch": "@@ -41,10 +41,12 @@ end module pr22146\n   call foobar (u, v)\n   if (v.ne.-42.0) call abort ()\n \n-  call foobar (x, v)\n-  if (v.ne.-2.0) call abort ()\n+  v = 2.0\n+  call foobar (v, x)\n+  if (any(x /= -2.0)) call abort ()\n \n ! Test an expression in the INTENT(IN) argument\n+  x = (/1.0, 2.0/)\n   call foobar (cos (x) + u, y)\n   if (any(abs (y + cos (x) + u) .gt. 2.0e-6)) call abort ()\n "}, {"sha": "efadb6d14390b9196ab98a236e98ebce25e7e8db", "filename": "gcc/testsuite/gfortran.dg/elemental_subroutine_5.f90", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a9658279646ba0d7c8bf7c11ba709fb612e6cf0/gcc%2Ftestsuite%2Fgfortran.dg%2Felemental_subroutine_5.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a9658279646ba0d7c8bf7c11ba709fb612e6cf0/gcc%2Ftestsuite%2Fgfortran.dg%2Felemental_subroutine_5.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Felemental_subroutine_5.f90?ref=4a9658279646ba0d7c8bf7c11ba709fb612e6cf0", "patch": "@@ -0,0 +1,27 @@\n+! { dg-do compile }\n+!\n+! PR fortran/33231\n+!\n+! Elemental function:\n+! Intent OUT/INOUT dummy: Actual needs to be an array\n+! if any actual is an array\n+!\n+program prog\n+implicit none\n+integer :: i, j(2)\n+call sub(i,1,2) ! OK, only scalar\n+call sub(j,1,2) ! OK, scalar IN, array OUT\n+call sub(j,[1,2],3) ! OK, scalar & array IN, array OUT\n+call sub(j,[1,2],[1,2]) ! OK, all arrays\n+\n+call sub(i,1,2) ! OK, only scalar\n+call sub(i,[1,2],3) ! { dg-error \"is a scalar\" }\n+call sub(i,[1,2],[1,2]) ! { dg-error \"is a scalar\" }\n+contains\n+elemental subroutine sub(a,b,c)\n+  integer :: func, a, b, c\n+  intent(in) :: b,c\n+  intent(out) :: a\n+  a = b +c\n+end subroutine sub\n+end program prog"}]}