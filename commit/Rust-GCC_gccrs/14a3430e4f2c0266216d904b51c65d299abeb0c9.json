{"sha": "14a3430e4f2c0266216d904b51c65d299abeb0c9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTRhMzQzMGU0ZjJjMDI2NjIxNmQ5MDRiNTFjNjVkMjk5YWJlYjBjOQ==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2011-10-25T18:24:28Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2011-10-25T18:24:28Z"}, "message": "re PR c++/50866 (ICE in verify_gimple_stmt, at tree-cfg.c:4175)\n\n\tPR c++/50866\n\tPR c++/41449\n\t* semantics.c (maybe_cleanup_point_expr_void): No longer static.\n\t* typeck2.c (split_nonconstant_init_1): Use it.\n\t* cp-tree.h: Declare it.\n\t* decl.c (wrap_cleanups_r): Stop at CLEANUP_POINT_EXPR.\n\nFrom-SVN: r180442", "tree": {"sha": "5895a2df3e28a6de8edc59ef0ff6cc7b4434707f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5895a2df3e28a6de8edc59ef0ff6cc7b4434707f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/14a3430e4f2c0266216d904b51c65d299abeb0c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/14a3430e4f2c0266216d904b51c65d299abeb0c9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/14a3430e4f2c0266216d904b51c65d299abeb0c9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/14a3430e4f2c0266216d904b51c65d299abeb0c9/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0c59fd2fd22fa78fa357d6f509ac5e9be17316c1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0c59fd2fd22fa78fa357d6f509ac5e9be17316c1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0c59fd2fd22fa78fa357d6f509ac5e9be17316c1"}], "stats": {"total": 31, "additions": 29, "deletions": 2}, "files": [{"sha": "2ca141d00eb7805996c092901a3ae714f25d97a2", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14a3430e4f2c0266216d904b51c65d299abeb0c9/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14a3430e4f2c0266216d904b51c65d299abeb0c9/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=14a3430e4f2c0266216d904b51c65d299abeb0c9", "patch": "@@ -1,5 +1,12 @@\n 2011-10-25  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/50866\n+\tPR c++/41449\n+\t* semantics.c (maybe_cleanup_point_expr_void): No longer static.\n+\t* typeck2.c (split_nonconstant_init_1): Use it.\n+\t* cp-tree.h: Declare it.\n+\t* decl.c (wrap_cleanups_r): Stop at CLEANUP_POINT_EXPR.\n+\n \tPR c++/49996\n \t* tree.c (stabilize_init): Stabilize scalar elements of a\n \tCONSTRUCTOR, too."}, {"sha": "b20e7d1aac581c5b91857072aecf100e48f10e8f", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14a3430e4f2c0266216d904b51c65d299abeb0c9/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14a3430e4f2c0266216d904b51c65d299abeb0c9/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=14a3430e4f2c0266216d904b51c65d299abeb0c9", "patch": "@@ -5372,6 +5372,7 @@ extern int stmts_are_full_exprs_p\t\t(void);\n extern void init_cp_semantics\t\t\t(void);\n extern tree do_poplevel\t\t\t\t(tree);\n extern void add_decl_expr\t\t\t(tree);\n+extern tree maybe_cleanup_point_expr_void\t(tree);\n extern tree finish_expr_stmt\t\t\t(tree);\n extern tree begin_if_stmt\t\t\t(void);\n extern void finish_if_stmt_cond\t\t\t(tree, tree);"}, {"sha": "26e9847f4fd0ebdf0d0086cf888d83dde36d6236", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14a3430e4f2c0266216d904b51c65d299abeb0c9/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14a3430e4f2c0266216d904b51c65d299abeb0c9/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=14a3430e4f2c0266216d904b51c65d299abeb0c9", "patch": "@@ -5718,7 +5718,9 @@ make_rtl_for_nonlocal_decl (tree decl, tree init, const char* asmspec)\n static tree\n wrap_cleanups_r (tree *stmt_p, int *walk_subtrees, void *data)\n {\n-  if (TYPE_P (*stmt_p))\n+  /* Stop at types or full-expression boundaries.  */\n+  if (TYPE_P (*stmt_p)\n+      || TREE_CODE (*stmt_p) == CLEANUP_POINT_EXPR)\n     {\n       *walk_subtrees = 0;\n       return NULL_TREE;"}, {"sha": "84f112cd3cb7d1bd0c14844855a778a2f57b7623", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14a3430e4f2c0266216d904b51c65d299abeb0c9/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14a3430e4f2c0266216d904b51c65d299abeb0c9/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=14a3430e4f2c0266216d904b51c65d299abeb0c9", "patch": "@@ -424,7 +424,7 @@ maybe_cleanup_point_expr (tree expr)\n    expression.  The reason why we do this is because the original type might be\n    an aggregate and we cannot create a temporary variable for that type.  */\n \n-static tree\n+tree\n maybe_cleanup_point_expr_void (tree expr)\n {\n   if (!processing_template_decl && stmts_are_full_exprs_p ())"}, {"sha": "57cd5e01d8c9a4e4396d9dbd2a42b2732f744290", "filename": "gcc/cp/typeck2.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14a3430e4f2c0266216d904b51c65d299abeb0c9/gcc%2Fcp%2Ftypeck2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14a3430e4f2c0266216d904b51c65d299abeb0c9/gcc%2Fcp%2Ftypeck2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck2.c?ref=14a3430e4f2c0266216d904b51c65d299abeb0c9", "patch": "@@ -573,6 +573,7 @@ split_nonconstant_init_1 (tree dest, tree init)\n \n \t      code = build2 (INIT_EXPR, inner_type, sub, value);\n \t      code = build_stmt (input_location, EXPR_STMT, code);\n+\t      code = maybe_cleanup_point_expr_void (code);\n \t      add_stmt (code);\n \t      if (!TYPE_HAS_TRIVIAL_DESTRUCTOR (inner_type))\n \t\t{"}, {"sha": "2696fb61874e2df7d4ac08775c02290135841d36", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14a3430e4f2c0266216d904b51c65d299abeb0c9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14a3430e4f2c0266216d904b51c65d299abeb0c9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=14a3430e4f2c0266216d904b51c65d299abeb0c9", "patch": "@@ -1,5 +1,8 @@\n 2011-10-25  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/50866\n+\t* g++.dg/init/aggr7.C: New.\n+\n \tPR c++/49996\n \t* g++.dg/cpp0x/initlist59.C: New.\n "}, {"sha": "bec952c230cb93e60f6c6772419def01068d4b81", "filename": "gcc/testsuite/g++.dg/init/aggr7.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14a3430e4f2c0266216d904b51c65d299abeb0c9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Faggr7.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14a3430e4f2c0266216d904b51c65d299abeb0c9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Faggr7.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Faggr7.C?ref=14a3430e4f2c0266216d904b51c65d299abeb0c9", "patch": "@@ -0,0 +1,13 @@\n+// PR c++/50866\n+\n+struct A { A(); ~A(); };\n+struct B { B(const char *, const A& = A()); ~B(); };\n+struct C {\n+  B b1, b2;\n+};\n+void f()\n+{\n+     C c = {\n+          \"a\",\"b\"\n+     };\n+}"}]}